---
title: 如何使用 VLV 搜尋
description: Active Directory 支援 (VLV) 搜尋的虛擬清單視圖。 這種搜尋樣式專門針對大型結果集而設計，可讓應用程式顯示上千個專案的子集，而不需要取得每個專案。
ms.assetid: fea04190-0846-4b62-99f4-7d8fb35fd510
ms.tgt_platform: multiple
keywords:
- 如何使用 VLV 搜尋
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8f4a24250c8e54ccb7917f86b193152c62810b93
ms.sourcegitcommit: b0ebdefc3dcd5c04bede94091833aa1015a2f95c
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/21/2020
ms.locfileid: "103933617"
---
# <a name="how-to-search-using-vlv"></a><span data-ttu-id="7f55c-105">如何使用 VLV 搜尋</span><span class="sxs-lookup"><span data-stu-id="7f55c-105">How to Search Using VLV</span></span>

<span data-ttu-id="7f55c-106">Active Directory 支援 (VLV) 搜尋的虛擬清單視圖。</span><span class="sxs-lookup"><span data-stu-id="7f55c-106">Active Directory supports virtual list view (VLV) searches.</span></span> <span data-ttu-id="7f55c-107">這種搜尋樣式專門針對大型結果集而設計，可讓應用程式顯示上千個專案的子集，而不需要取得每個專案。</span><span class="sxs-lookup"><span data-stu-id="7f55c-107">This style of search is specifically designed for large result sets and enables an application to display a subset of thousands of entries without actually having to retrieve every entry.</span></span>

<span data-ttu-id="7f55c-108">您可以使用兩種不同的方式來使用 VLV 搜尋。</span><span class="sxs-lookup"><span data-stu-id="7f55c-108">There are two distinct ways that a VLV search can be used.</span></span> <span data-ttu-id="7f55c-109">第一個是根據數值位移來取得特定專案的屬性。</span><span class="sxs-lookup"><span data-stu-id="7f55c-109">The first is to retrieve the attributes for particular entries based on a numeric offset.</span></span> <span data-ttu-id="7f55c-110">當您抓取搜尋結果以回應滾動操作時，此方法很有用。</span><span class="sxs-lookup"><span data-stu-id="7f55c-110">This method is useful when retrieving search results in response to a scrolling operation.</span></span>

<span data-ttu-id="7f55c-111">使用 VLV 搜尋的第二種方式是搜尋部分或全部的文字屬性，並只顯示搜尋的結果。</span><span class="sxs-lookup"><span data-stu-id="7f55c-111">The second way to use VLV searches is to search for part or all of a textual attribute and only display the results of the search.</span></span> <span data-ttu-id="7f55c-112">這是通訊錄的使用範例。</span><span class="sxs-lookup"><span data-stu-id="7f55c-112">An example usage of this is an address book.</span></span> <span data-ttu-id="7f55c-113">如果使用者輸入 "s"，則應用程式可以使用 VLV 搜尋來搜尋一般名稱開頭為 "s" 的專案。</span><span class="sxs-lookup"><span data-stu-id="7f55c-113">If the user types an "s", then the application can use a VLV search to search for entries that have a common-name that begins with "s".</span></span> <span data-ttu-id="7f55c-114">如果使用者接著將 "m" 新增至 "s"，則應用程式可以使用另一個 VLV 搜尋來搜尋一般名稱開頭為 "sm" 的專案。</span><span class="sxs-lookup"><span data-stu-id="7f55c-114">If the user then adds an "m" to the "s", the application can use another VLV search to search for entries that have a common-name that begins with "sm".</span></span>

<span data-ttu-id="7f55c-115">若要執行 VLV 搜尋，請指示 ADSI 使用 VLV 控制項。</span><span class="sxs-lookup"><span data-stu-id="7f55c-115">To perform a VLV search, instruct ADSI to use the VLV control.</span></span> <span data-ttu-id="7f55c-116">若要這樣做，請使用 **ADS \_ SEARCHPREF \_ VLV** 搜尋選項（具有 **ADSTYPE \_ >prov 的 \_ 特定** 值）來呼叫 [**>idirectorysearch：： SetSearchPreference**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-setsearchpreference)方法。</span><span class="sxs-lookup"><span data-stu-id="7f55c-116">To do this, call the [**IDirectorySearch::SetSearchPreference**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-setsearchpreference) method with an **ADS\_SEARCHPREF\_VLV** search option with an **ADSTYPE\_PROV\_SPECIFIC** value.</span></span> <span data-ttu-id="7f55c-117">**ADSTYPE \_ >prov 的 \_ 特定** 值是 [**ADS \_ VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv)結構的指標，其中包含搜尋的相關資料。</span><span class="sxs-lookup"><span data-stu-id="7f55c-117">The **ADSTYPE\_PROV\_SPECIFIC** value is a pointer to an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure that contains data about the search.</span></span> <span data-ttu-id="7f55c-118">[**GetVLVItemCount**](example-code-for-using-a-vlv-search.md)範例函式顯示如何設定這兩個搜尋喜好設定。</span><span class="sxs-lookup"><span data-stu-id="7f55c-118">The [**GetVLVItemCount**](example-code-for-using-a-vlv-search.md) example function shows how to set both of these search preferences.</span></span>

<span data-ttu-id="7f55c-119">所有 VLV 搜尋都必須使用伺服器端結果排序，這是透過在搜尋喜好設定 **上設定 ADS \_ SEARCHPREF \_ 排序 \_** 所執行。</span><span class="sxs-lookup"><span data-stu-id="7f55c-119">All VLV searches must use server-side result sorting, which is performed by setting the **ADS\_SEARCHPREF\_SORT\_ON** search preference.</span></span> <span data-ttu-id="7f55c-120">如需 **ADS \_ SEARCHPREF \_ 排序 \_** 搜尋喜好設定的詳細資訊，請參閱 [使用 >idirectorysearch 排序搜尋結果](sorting-the-search-results-with-idirectorysearch.md)。</span><span class="sxs-lookup"><span data-stu-id="7f55c-120">For more information about the **ADS\_SEARCHPREF\_SORT\_ON** search preference, see [Sorting the Search Results with IDirectorySearch](sorting-the-search-results-with-idirectorysearch.md).</span></span>

<span data-ttu-id="7f55c-121">執行 VLV 搜尋時，會透過呼叫 [**>idirectorysearch：： GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) 與 **ADS \_ VLV \_ 回應** 識別碼，在抓取的資料行中傳回特定數量的搜尋中繼資料。</span><span class="sxs-lookup"><span data-stu-id="7f55c-121">When a VLV search is performed, a certain amount of metadata about the search is returned in a column that is retrieved by calling [**IDirectorySearch::GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) with the **ADS\_VLV\_RESPONSE** identifier.</span></span> <span data-ttu-id="7f55c-122">這項資料會包含在 [**ADS \_ VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) 結構中。</span><span class="sxs-lookup"><span data-stu-id="7f55c-122">This data is contained in an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure.</span></span> <span data-ttu-id="7f55c-123">特別重要的是 **dwContentCount** 與 **lpCoNtextID** 成員。</span><span class="sxs-lookup"><span data-stu-id="7f55c-123">Of particular importance are the **dwContentCount** and **lpContextID** members.</span></span> <span data-ttu-id="7f55c-124">**DwContentCount** 成員將包含符合 VLV 搜尋準則的結果數目。</span><span class="sxs-lookup"><span data-stu-id="7f55c-124">The **dwContentCount** member will contain the number of results that meet the VLV search criteria.</span></span> <span data-ttu-id="7f55c-125">這個值可以用來做為搜尋該類型時，所要傳回之專案總數的估計值。</span><span class="sxs-lookup"><span data-stu-id="7f55c-125">This value can be used as an estimate of the total number of items that would be returned for a search of that type.</span></span> <span data-ttu-id="7f55c-126">**LpCoNtextID** 成員包含伺服器定義的值，可傳遞給下一個搜尋來識別搜尋。</span><span class="sxs-lookup"><span data-stu-id="7f55c-126">The **lpContextID** member contains a server-defined value that can be passed to the next search to identify the search.</span></span> <span data-ttu-id="7f55c-127">使用 **lpCoNtextID** 可以增強搜尋效能。</span><span class="sxs-lookup"><span data-stu-id="7f55c-127">Using the **lpContextID** can enhance the search performance.</span></span> <span data-ttu-id="7f55c-128">請注意， **lpCoNtextID** 是伺服器定義的值，且其長度會包含在 **dwCoNtextIDLength** 成員中。</span><span class="sxs-lookup"><span data-stu-id="7f55c-128">Be aware that the **lpContextID** is a server-defined value and its length is contained in the **dwContextIDLength** member.</span></span> <span data-ttu-id="7f55c-129">呼叫 [**>idirectorysearch：： FreeColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-freecolumn) 方法時，就會釋放這個緩衝區，因此呼叫端必須配置適當大小的緩衝區，然後複製並儲存搜尋之間的緩衝區內容。</span><span class="sxs-lookup"><span data-stu-id="7f55c-129">This buffer is freed when the [**IDirectorySearch::FreeColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-freecolumn) method is called, so the caller must allocate a buffer of the appropriate size and copy and save the contents of the buffer between searches.</span></span>

<span data-ttu-id="7f55c-130">如需 LDAP VLV 控制項的詳細資訊，請參閱 [使用 LDAP VLV 控制項來搜尋](/previous-versions/windows/desktop/ldap/searching-with-the-ldap-vlv-control)。</span><span class="sxs-lookup"><span data-stu-id="7f55c-130">For more information about the LDAP VLV control, see [Searching with the LDAP VLV Control](/previous-versions/windows/desktop/ldap/searching-with-the-ldap-vlv-control).</span></span>

<span data-ttu-id="7f55c-131">如需詳細資訊，請參閱</span><span class="sxs-lookup"><span data-stu-id="7f55c-131">For more information, see:</span></span>

-   <span data-ttu-id="7f55c-132">取得專案數目</span><span class="sxs-lookup"><span data-stu-id="7f55c-132">Obtaining the Number of Items</span></span>
-   <span data-ttu-id="7f55c-133">依位移搜尋</span><span class="sxs-lookup"><span data-stu-id="7f55c-133">Searching by Offset</span></span>
-   <span data-ttu-id="7f55c-134">依字串搜尋</span><span class="sxs-lookup"><span data-stu-id="7f55c-134">Searching by String</span></span>
-   [<span data-ttu-id="7f55c-135">使用 VLV 搜尋的範例程式碼</span><span class="sxs-lookup"><span data-stu-id="7f55c-135">Example Code for Using a VLV Search</span></span>](example-code-for-using-a-vlv-search.md)

## <a name="obtaining-the-number-of-items"></a><span data-ttu-id="7f55c-136">取得專案數目</span><span class="sxs-lookup"><span data-stu-id="7f55c-136">Obtaining the Number of Items</span></span>

<span data-ttu-id="7f55c-137">**若要取得特定搜尋將傳回的專案數估計值，請執行下列步驟。**</span><span class="sxs-lookup"><span data-stu-id="7f55c-137">**To obtain an estimate of the number of items that will be returned for a particular search, perform the following steps.**</span></span>

1.  <span data-ttu-id="7f55c-138">以所有零或 **Null** 值填滿 [**ADS \_ VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv)結構。</span><span class="sxs-lookup"><span data-stu-id="7f55c-138">Fill an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure with all zero or **NULL** values.</span></span>
2.  <span data-ttu-id="7f55c-139">使用下列值填滿 [**ADS \_ SEARCHPREF \_ 資訊**](/windows/desktop/api/Iads/ns-iads-ads_searchpref_info) 。</span><span class="sxs-lookup"><span data-stu-id="7f55c-139">Fill an [**ADS\_SEARCHPREF\_INFO**](/windows/desktop/api/Iads/ns-iads-ads_searchpref_info) with the following values.</span></span>

    -   <span data-ttu-id="7f55c-140">將 **dwSearchPref** 成員設定為 **ADS \_ SEARCHPREF \_ VLV**。</span><span class="sxs-lookup"><span data-stu-id="7f55c-140">Set the **dwSearchPref** member to **ADS\_SEARCHPREF\_VLV**.</span></span>
    -   <span data-ttu-id="7f55c-141">將 **VValue dwType** 成員設定為 **ADSTYPE \_ >prov \_ 特定** 的成員。</span><span class="sxs-lookup"><span data-stu-id="7f55c-141">Set the **vValue.dwType** member to **ADSTYPE\_PROV\_SPECIFIC**.</span></span>
    -   <span data-ttu-id="7f55c-142">將 **vValue. ProviderSpecific. dwLength** 成員設定為 [**ADS \_ VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) 結構的大小。</span><span class="sxs-lookup"><span data-stu-id="7f55c-142">Set the **vValue.ProviderSpecific.dwLength** member to the size of the [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure.</span></span>
    -   <span data-ttu-id="7f55c-143">將 **vValue. ProviderSpecific. lpValue** 成員設為步驟1中 [**ADS \_ VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) 結構的位址。</span><span class="sxs-lookup"><span data-stu-id="7f55c-143">Set the **vValue.ProviderSpecific.lpValue** member to the address of the [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure from Step 1.</span></span>

3.  <span data-ttu-id="7f55c-144">填妥 [**ADS \_**](/windows/desktop/api/Iads/ns-iads-ads_sortkey) 分類結構，如 [使用 >idirectorysearch 排序搜尋結果](sorting-the-search-results-with-idirectorysearch.md) 所示，以針對所需的屬性進行排序。</span><span class="sxs-lookup"><span data-stu-id="7f55c-144">Fill an [**ADS\_SORTKEY**](/windows/desktop/api/Iads/ns-iads-ads_sortkey) structure as shown in [Sorting the Search Results with IDirectorySearch](sorting-the-search-results-with-idirectorysearch.md) to sort on the desired attribute.</span></span>
4.  <span data-ttu-id="7f55c-145">填寫另一個 [**廣告 \_ SEARCHPREF \_ 資訊**](/windows/desktop/api/Iads/ns-iads-ads_searchpref_info) ，將 [**ADS \_**](/windows/desktop/api/Iads/ns-iads-ads_sortkey) 分類結構新增至搜尋喜好設定，如 [使用 >idirectorysearch 排序搜尋結果](sorting-the-search-results-with-idirectorysearch.md)所示。</span><span class="sxs-lookup"><span data-stu-id="7f55c-145">Fill another [**ADS\_SEARCHPREF\_INFO**](/windows/desktop/api/Iads/ns-iads-ads_searchpref_info) to add the [**ADS\_SORTKEY**](/windows/desktop/api/Iads/ns-iads-ads_sortkey) structure to the search preferences as shown in [Sorting the Search Results with IDirectorySearch](sorting-the-search-results-with-idirectorysearch.md).</span></span>
5.  <span data-ttu-id="7f55c-146">新增任何其他所需的搜尋喜好設定，並呼叫 [**>idirectorysearch：： SetSearchPreference**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-setsearchpreference) 來設定搜尋喜好設定。</span><span class="sxs-lookup"><span data-stu-id="7f55c-146">Add any other desired search preferences and call [**IDirectorySearch::SetSearchPreference**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-setsearchpreference) to set the search preferences.</span></span>
6.  <span data-ttu-id="7f55c-147">使用 [**>idirectorysearch：： ExecuteSearch**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-executesearch)執行搜尋。</span><span class="sxs-lookup"><span data-stu-id="7f55c-147">Perform the search with [**IDirectorySearch::ExecuteSearch**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-executesearch).</span></span>
7.  <span data-ttu-id="7f55c-148">藉由呼叫 [**>idirectorysearch：： GetFirstRow**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getfirstrow)來取得結果的第一個資料列。</span><span class="sxs-lookup"><span data-stu-id="7f55c-148">Get the first row of results by calling [**IDirectorySearch::GetFirstRow**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getfirstrow).</span></span>
8.  <span data-ttu-id="7f55c-149">呼叫 [**>idirectorysearch：： GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) 與 **ADS \_ VLV \_ 回應** ，以取得 VLV 搜尋中繼資料。</span><span class="sxs-lookup"><span data-stu-id="7f55c-149">Call [**IDirectorySearch::GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) with **ADS\_VLV\_RESPONSE** to obtain the VLV search metadata.</span></span>
9.  <span data-ttu-id="7f55c-150">將 [**ads \_ 搜尋資料 \_ 行**](/windows/desktop/api/Iads/ns-iads-ads_search_column)結構的 **pADsValues->ProviderSpecific** 轉換成 [**ads \_ VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv)結構指標。</span><span class="sxs-lookup"><span data-stu-id="7f55c-150">Cast the **pADsValues->ProviderSpecific.lpValue** of the [**ADS\_SEARCH\_COLUMN**](/windows/desktop/api/Iads/ns-iads-ads_search_column) structure to an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure pointer.</span></span> <span data-ttu-id="7f55c-151">此 **ADS \_ VLV** 結構的 **dwContentCount** 成員會包含搜尋該類型所傳回的大約專案數。</span><span class="sxs-lookup"><span data-stu-id="7f55c-151">The **dwContentCount** member of this **ADS\_VLV** structure contains the approximate number of items that would be returned by a search of that type.</span></span>
10. <span data-ttu-id="7f55c-152">如果將執行相同類型的其他 VLV 搜尋，請複製 **lpCoNtextID** 的資料，並將其保留供下一次 VLV 搜尋之用。</span><span class="sxs-lookup"><span data-stu-id="7f55c-152">If other VLV searches of the same type will be performed, make a copy of the **lpContextID** data and preserve it for the next VLV search.</span></span>

<span data-ttu-id="7f55c-153">[**GetVLVItemCount**](example-code-for-using-a-vlv-search.md)範例函式示範如何進行此作業。</span><span class="sxs-lookup"><span data-stu-id="7f55c-153">The [**GetVLVItemCount**](example-code-for-using-a-vlv-search.md) example function shows how to do this.</span></span>

## <a name="searching-by-offset"></a><span data-ttu-id="7f55c-154">依位移搜尋</span><span class="sxs-lookup"><span data-stu-id="7f55c-154">Searching by Offset</span></span>

<span data-ttu-id="7f55c-155">讓 VLV 搜尋快速搜尋的其中一件事，就是可以依數值位移來搜尋特定的結果。</span><span class="sxs-lookup"><span data-stu-id="7f55c-155">One thing that makes VLV searches so quick is that it is possible to search for a specific result by a numerical offset.</span></span> <span data-ttu-id="7f55c-156">例如，如果搜尋會導致傳回10000個專案，則 VLV 搜尋可讓您取得大約4072nd 專案的相關資訊，而不需要取得有問題專案的所有專案。</span><span class="sxs-lookup"><span data-stu-id="7f55c-156">For example, if a search would result in 10,000 items being returned, a VLV search makes it possible to obtain the information for approximately the 4072nd item without having to retrieve all of the items before the item in question.</span></span>

<span data-ttu-id="7f55c-157">位移會指定為位移和內容計數之間的比率。</span><span class="sxs-lookup"><span data-stu-id="7f55c-157">Offsets are specified as a ratio between the offset and the content count.</span></span> <span data-ttu-id="7f55c-158">比例會很有用，因為伺服器可能無法精確估計清單中的專案數，或清單大小可能會在使用者流覽時變更。</span><span class="sxs-lookup"><span data-stu-id="7f55c-158">Ratios are useful because the server may not have an accurate estimate of the number of entries that exist in the list or the list size may be changing during the time the user is browsing it.</span></span> <span data-ttu-id="7f55c-159">因為您必須指出清單的開頭和結尾，所以您可以在第一個搜尋要求中使用內容計數的估計值，以及位移值。</span><span class="sxs-lookup"><span data-stu-id="7f55c-159">Because you must indicate the beginning and end of the list, you can use an estimated value for the content count in the first search request, along with an offset value.</span></span> <span data-ttu-id="7f55c-160">伺服器會使用這項資料，根據其內容計數的概念，在清單中計算對應的位移，這是透過 [**ADS \_ VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv)結構的 **dwContentCount** 成員傳送至用戶端的回應。</span><span class="sxs-lookup"><span data-stu-id="7f55c-160">The server uses this data to compute the corresponding offsets within the list, based on its idea of content count, which is sent in its response to the client through the **dwContentCount** member of the [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure.</span></span> <span data-ttu-id="7f55c-161">例如，如果您將清單大小估計為3000，而且您想要讓位移成為清單輸入1500，則會將 **dwContentCount** 設定為3000並 **dwOffset** 為1500。</span><span class="sxs-lookup"><span data-stu-id="7f55c-161">For example, if you estimate the list size to be 3000, and you want the offset to be list entry 1500, you would set **dwContentCount** to 3000 and **dwOffset** to 1500.</span></span> <span data-ttu-id="7f55c-162">如果伺服器將實際的清單大小估計為4500，則會將位移重新計算為2250，並在 **dwContentCount** 和 **dwOffset** 中傳回新的估計值。</span><span class="sxs-lookup"><span data-stu-id="7f55c-162">If the server estimates the actual list size to be 4500, it will recalculate the offset to 2250, and return the new estimates in **dwContentCount** and **dwOffset**.</span></span>

> [!Note]
>
> <span data-ttu-id="7f55c-163">VLV 搜尋中的所有數值都是近似值，不應該用於絕對值。</span><span class="sxs-lookup"><span data-stu-id="7f55c-163">All of the numeric values in a VLV search are approximations and should not be used for absolute values.</span></span> <span data-ttu-id="7f55c-164">例如，如果您針對比例100中的第50個專案發出 VLV 搜尋，則不保證會取得確切的中間專案。</span><span class="sxs-lookup"><span data-stu-id="7f55c-164">For example, if you issue a VLV search for the 50th item in a ration of 100, you are not guaranteed to get the exact middle item.</span></span>
>
> <span data-ttu-id="7f55c-165">**若要依位移搜尋特定專案，請執行下列步驟。**</span><span class="sxs-lookup"><span data-stu-id="7f55c-165">**To search for a particular item by offset, perform the following steps.**</span></span>
>
> 1.  <span data-ttu-id="7f55c-166">以下列值填滿 [**ADS \_ VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) 結構。</span><span class="sxs-lookup"><span data-stu-id="7f55c-166">Fill an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure with the following values.</span></span> <span data-ttu-id="7f55c-167">結構的其他成員應設定為零或 **Null**。</span><span class="sxs-lookup"><span data-stu-id="7f55c-167">Additional members of the structure should be set to zero or **NULL**.</span></span>
>
>     -   <span data-ttu-id="7f55c-168">將 **dwContentCount** 成員設定為要抓取之專案比例的最大值。</span><span class="sxs-lookup"><span data-stu-id="7f55c-168">Set the **dwContentCount** member to the maximum value of the ratio of items to retrieve.</span></span>
>     -   <span data-ttu-id="7f55c-169">將 **dwOffset** 成員設定為要取得之專案或專案的比率（相對於 **dwContentCount**）。</span><span class="sxs-lookup"><span data-stu-id="7f55c-169">Set the **dwOffset** member to the ratio, relative to **dwContentCount**, of the item or items to retrieve.</span></span>
>     -   <span data-ttu-id="7f55c-170">將 **lpCoNtextID** 成員設定為內容識別碼緩衝區複本的位址，並將 **dwCoNtextIDLength** 設定為內容識別碼緩衝區的長度（以位元組為單位）。</span><span class="sxs-lookup"><span data-stu-id="7f55c-170">Set the **lpContextID** member to the address of the copy of the context ID buffer and the **dwContextIDLength** to the length, in bytes, of the context ID buffer.</span></span> <span data-ttu-id="7f55c-171">如果未儲存任何內容識別碼，則這兩個成員都應該是零或 **Null**。</span><span class="sxs-lookup"><span data-stu-id="7f55c-171">If no context ID has been saved, both of the these members should be zero or **NULL**.</span></span>
>
> 2.  <span data-ttu-id="7f55c-172">設定搜尋喜好設定，如取得專案數目的步驟2到5中所示。</span><span class="sxs-lookup"><span data-stu-id="7f55c-172">Set the search preferences as shown in Steps 2 through 5 of the Obtaining the Number of Items procedure.</span></span>
> 3.  <span data-ttu-id="7f55c-173">使用 [**>idirectorysearch：： ExecuteSearch**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-executesearch)執行搜尋。</span><span class="sxs-lookup"><span data-stu-id="7f55c-173">Perform the search with [**IDirectorySearch::ExecuteSearch**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-executesearch).</span></span>
> 4.  <span data-ttu-id="7f55c-174">藉由呼叫 [**>idirectorysearch：： GetFirstRow**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getfirstrow)來取得結果的第一個資料列。</span><span class="sxs-lookup"><span data-stu-id="7f55c-174">Get the first row of results by calling [**IDirectorySearch::GetFirstRow**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getfirstrow).</span></span>
> 5.  <span data-ttu-id="7f55c-175">使用要抓取的屬性名稱來呼叫 [**>idirectorysearch：： GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) ，以取得所要求專案的實際資料。</span><span class="sxs-lookup"><span data-stu-id="7f55c-175">Call [**IDirectorySearch::GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) with the name of the attribute to retrieve to get the actual data for the requested item.</span></span>
> 6.  <span data-ttu-id="7f55c-176">呼叫 [**>idirectorysearch：： GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) 與 **ADS \_ VLV \_ 回應** ，以取得 VLV 搜尋中繼資料。</span><span class="sxs-lookup"><span data-stu-id="7f55c-176">Call [**IDirectorySearch::GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) with **ADS\_VLV\_RESPONSE** to obtain the VLV search metadata.</span></span>
> 7.  <span data-ttu-id="7f55c-177">將 [**ads \_ 搜尋資料 \_ 行**](/windows/desktop/api/Iads/ns-iads-ads_search_column)結構的 **pADsValues->ProviderSpecific** 轉換成 [**ads \_ VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv)結構指標。</span><span class="sxs-lookup"><span data-stu-id="7f55c-177">Cast the **pADsValues->ProviderSpecific.lpValue** of the [**ADS\_SEARCH\_COLUMN**](/windows/desktop/api/Iads/ns-iads-ads_search_column) structure to an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure pointer.</span></span>
> 8.  <span data-ttu-id="7f55c-178">製作 **lpCoNtextID** 資料的複本，並將其保留供下一次 VLV 搜尋之用。</span><span class="sxs-lookup"><span data-stu-id="7f55c-178">Make a copy of the **lpContextID** data and preserve it for the next VLV search.</span></span>

 

<span data-ttu-id="7f55c-179">[**GetVLVItemText**](example-code-for-using-a-vlv-search.md)範例函式示範如何進行此作業。</span><span class="sxs-lookup"><span data-stu-id="7f55c-179">The [**GetVLVItemText**](example-code-for-using-a-vlv-search.md) example function shows how to do this.</span></span>

<span data-ttu-id="7f55c-180">您也可以使用單一搜尋呼叫來取出多個資料列。</span><span class="sxs-lookup"><span data-stu-id="7f55c-180">It is also possible to retrieve more than one row of data with a single search call.</span></span> <span data-ttu-id="7f55c-181">這是在步驟1中，適當地設定 [**ADS \_ VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv)結構的 **dwBeforeCount** 和 **dwAfterCount** 成員來完成。</span><span class="sxs-lookup"><span data-stu-id="7f55c-181">This is done in Step 1 by setting the **dwBeforeCount** and **dwAfterCount** members of the [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure appropriately.</span></span> <span data-ttu-id="7f55c-182">**DwBeforeCount** 成員包含有問題專案之前出現在清單中的專案數，而 **dwAfterCount** 成員包含有問題專案之後出現在清單中的專案數。</span><span class="sxs-lookup"><span data-stu-id="7f55c-182">The **dwBeforeCount** member contains the number of items that appear in the list prior to the item in question and the **dwAfterCount** member contains the number of items that appear in the list after to the item in question.</span></span> <span data-ttu-id="7f55c-183">這兩個計數都會排除專案本身，因此將 **dwBeforeCount** 設定為10，並將 **dwAfterCount** 設定為10，將會導致總共傳回21個專案。</span><span class="sxs-lookup"><span data-stu-id="7f55c-183">Both of these counts exclude the item itself, so setting **dwBeforeCount** to 10 and **dwAfterCount** to 10 will result in a total of 21 items returned.</span></span> <span data-ttu-id="7f55c-184">此選項可讓您快取用戶端上的搜尋結果。</span><span class="sxs-lookup"><span data-stu-id="7f55c-184">This option enables caching the search results on the client side.</span></span>

## <a name="searching-by-string"></a><span data-ttu-id="7f55c-185">依字串搜尋</span><span class="sxs-lookup"><span data-stu-id="7f55c-185">Searching by String</span></span>

<span data-ttu-id="7f55c-186">您也可以使用 VLV 搜尋來尋找具有字串屬性的專案，其值符合全部或部分字串，而不需要取得所有專案。</span><span class="sxs-lookup"><span data-stu-id="7f55c-186">It is also possible to use a VLV search to find items that have a string attribute whose value matches all or part of a string without having to retrieve all items.</span></span> <span data-ttu-id="7f55c-187">字串比對會針對 **ads \_ SEARCHPREF \_ SORT \_ ON** 搜尋喜好設定的 [**ads \_**](/windows/desktop/api/Iads/ns-iads-ads_sortkey)排序結構中所指定的屬性來執行。</span><span class="sxs-lookup"><span data-stu-id="7f55c-187">The string matching is performed against the attribute specified in the [**ADS\_SORTKEY**](/windows/desktop/api/Iads/ns-iads-ads_sortkey) structure of the **ADS\_SEARCHPREF\_SORT\_ON** search preference.</span></span>

<span data-ttu-id="7f55c-188">**若要依字串搜尋特定專案，請執行下列步驟。**</span><span class="sxs-lookup"><span data-stu-id="7f55c-188">**To search for a particular item by string, perform the following steps.**</span></span>

1.  <span data-ttu-id="7f55c-189">以下列值填滿 [**ADS \_ VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) 結構。</span><span class="sxs-lookup"><span data-stu-id="7f55c-189">Fill an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure with the following values.</span></span> <span data-ttu-id="7f55c-190">結構的其他成員應設定為零或 **Null**。</span><span class="sxs-lookup"><span data-stu-id="7f55c-190">Additional members of the structure should be set to zero or **NULL**.</span></span>

    -   <span data-ttu-id="7f55c-191">將 **pszTarget** 成員設定為以 Null 結束的字串指標，其中包含要搜尋的字串。</span><span class="sxs-lookup"><span data-stu-id="7f55c-191">Set the **pszTarget** member to a pointer to a NULL-terminated string that contains the string to search for.</span></span>
    -   <span data-ttu-id="7f55c-192">將 **lpCoNtextID** 成員設定為內容識別碼緩衝區複本的位址，並將 **dwCoNtextIDLength** 設定為內容識別碼緩衝區的長度（以位元組為單位）。</span><span class="sxs-lookup"><span data-stu-id="7f55c-192">Set the **lpContextID** member to the address of the copy of the context ID buffer and the **dwContextIDLength** to the length, in bytes, of the context ID buffer.</span></span> <span data-ttu-id="7f55c-193">如果未儲存任何內容識別碼，則這兩個成員都應該是零或 **Null**。</span><span class="sxs-lookup"><span data-stu-id="7f55c-193">If no context ID has been saved, both of the these members should be zero or **NULL**.</span></span>

2.  <span data-ttu-id="7f55c-194">設定搜尋喜好設定，如取得專案數目的步驟2到5中所示。</span><span class="sxs-lookup"><span data-stu-id="7f55c-194">Set the search preferences as shown in Steps 2 through 5 of the Obtaining the Number of Items procedure.</span></span>
3.  <span data-ttu-id="7f55c-195">使用 [**>idirectorysearch：： ExecuteSearch**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-executesearch)執行搜尋。</span><span class="sxs-lookup"><span data-stu-id="7f55c-195">Perform the search with [**IDirectorySearch::ExecuteSearch**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-executesearch).</span></span>
4.  <span data-ttu-id="7f55c-196">藉由呼叫 [**>idirectorysearch：： GetFirstRow**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getfirstrow)來取得結果的第一個資料列。</span><span class="sxs-lookup"><span data-stu-id="7f55c-196">Get the first row of results by calling [**IDirectorySearch::GetFirstRow**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getfirstrow).</span></span>
5.  <span data-ttu-id="7f55c-197">使用要抓取的屬性名稱來呼叫 [**>idirectorysearch：： GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) ，以取得所要求專案的實際資料。</span><span class="sxs-lookup"><span data-stu-id="7f55c-197">Call [**IDirectorySearch::GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) with the name of the attribute to retrieve to get the actual data for the requested item.</span></span>
6.  <span data-ttu-id="7f55c-198">呼叫 [**>idirectorysearch：： GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) 與 **ADS \_ VLV \_ 回應** ，以取得 VLV 搜尋中繼資料。</span><span class="sxs-lookup"><span data-stu-id="7f55c-198">Call [**IDirectorySearch::GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) with **ADS\_VLV\_RESPONSE** to obtain the VLV search metadata.</span></span>
7.  <span data-ttu-id="7f55c-199">將 [**ads \_ 搜尋資料 \_ 行**](/windows/desktop/api/Iads/ns-iads-ads_search_column)結構的 **pADsValues->ProviderSpecific** 轉換成 [**ads \_ VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv)結構指標。</span><span class="sxs-lookup"><span data-stu-id="7f55c-199">Cast the **pADsValues->ProviderSpecific.lpValue** of the [**ADS\_SEARCH\_COLUMN**](/windows/desktop/api/Iads/ns-iads-ads_search_column) structure to an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure pointer.</span></span>
8.  <span data-ttu-id="7f55c-200">製作 **lpCoNtextID** 資料的複本，並將其保留供下一次 VLV 搜尋之用。</span><span class="sxs-lookup"><span data-stu-id="7f55c-200">Make a copy of the **lpContextID** data and preserve it for the next VLV search.</span></span> <span data-ttu-id="7f55c-201">如有需要， **dwOffset** 成員會包含第一個專案的索引，其字串屬性以 **pszTarget** 中指定的值開頭。</span><span class="sxs-lookup"><span data-stu-id="7f55c-201">If required, the **dwOffset** member contains the one-based index of the first item whose string attribute begins with the value specified in **pszTarget**.</span></span>

<span data-ttu-id="7f55c-202">[**GetVLVItemsByString**](example-code-for-using-a-vlv-search.md)範例函式示範如何進行此作業。</span><span class="sxs-lookup"><span data-stu-id="7f55c-202">The [**GetVLVItemsByString**](example-code-for-using-a-vlv-search.md) example function shows how to do this.</span></span>

<span data-ttu-id="7f55c-203">類似于依索引搜尋，也可以使用單一搜尋呼叫來取出多個資料列。</span><span class="sxs-lookup"><span data-stu-id="7f55c-203">Similarly to searching by index, it is also possible to retrieve more than one row of data with a single search call.</span></span> <span data-ttu-id="7f55c-204">這項作業的完成方式是以同樣的方式設定 [**ADS \_ VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv)結構的 **dwBeforeCount** 和 **dwAfterCount** 成員。</span><span class="sxs-lookup"><span data-stu-id="7f55c-204">This is accomplished in the same manner by setting the **dwBeforeCount** and **dwAfterCount** members of the [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure appropriately.</span></span>

 

 