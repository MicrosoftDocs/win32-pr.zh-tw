---
title: Teredo 位址
ms.assetid: e2e185c2-e53d-471d-aedb-54d75f9db0bb
description: 深入瞭解： Teredo 位址
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bc08a53da2f710423d948e9479df2aeb08f20178
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "104320835"
---
# <a name="teredo-addresses"></a><span data-ttu-id="2b12d-103">Teredo 位址</span><span class="sxs-lookup"><span data-stu-id="2b12d-103">Teredo Addresses</span></span>

<span data-ttu-id="2b12d-104">Teredo 位址包含下列各項：</span><span class="sxs-lookup"><span data-stu-id="2b12d-104">A Teredo address consists of the following:</span></span>

-   <span data-ttu-id="2b12d-105">**Teredo 首碼**</span><span class="sxs-lookup"><span data-stu-id="2b12d-105">**Teredo prefix**</span></span>

    <span data-ttu-id="2b12d-106">前32位是針對 Teredo 首碼，這對所有 Teredo 位址都相同。</span><span class="sxs-lookup"><span data-stu-id="2b12d-106">The first 32 bits are for the Teredo prefix, which is the same for all Teredo addresses.</span></span> <span data-ttu-id="2b12d-107">Windows XP 和 Windows Server 2003 一開始使用的是3FFE：831F：：/32 Teredo 前置詞。</span><span class="sxs-lookup"><span data-stu-id="2b12d-107">Windows XP and Windows Server 2003 initially used the 3FFE:831F::/32 Teredo prefix.</span></span> <span data-ttu-id="2b12d-108">在 RFC 4380 中為 Teredo 定義的前置詞是2001::/32，而是 Windows Vista 和 Windows Server 2008 中 Teredo 所使用的前置詞。</span><span class="sxs-lookup"><span data-stu-id="2b12d-108">The prefix defined for Teredo in RFC 4380 is 2001::/32 and is the prefix used by Teredo in Windows Vista and Windows Server 2008.</span></span> <span data-ttu-id="2b12d-109">使用 Microsoft 資訊安全公告 MS06-064 更新時，執行 Windows XP 和 Windows Server 2003 的電腦將使用 2001::/32 Teredo 首碼。</span><span class="sxs-lookup"><span data-stu-id="2b12d-109">Computers running Windows XP and Windows Server 2003 will use the 2001::/32 Teredo prefix when updated with Microsoft Security Bulletin MS06-064.</span></span>

-   <span data-ttu-id="2b12d-110">**Teredo 伺服器 IPv4 位址**</span><span class="sxs-lookup"><span data-stu-id="2b12d-110">**Teredo server IPv4 address**</span></span>

    <span data-ttu-id="2b12d-111">下一個32位包含協助設定此 Teredo 位址之 Teredo 伺服器的 IPv4 公用位址。</span><span class="sxs-lookup"><span data-stu-id="2b12d-111">The next 32 bits contain the IPv4 public address of the Teredo server that helped configure this Teredo address.</span></span> <span data-ttu-id="2b12d-112">如需詳細資訊，請參閱本文中的「Teredo 用戶端的初始設定」。</span><span class="sxs-lookup"><span data-stu-id="2b12d-112">For more information, see "Initial configuration for Teredo clients" in this article.</span></span>

-   <span data-ttu-id="2b12d-113">**旗標**</span><span class="sxs-lookup"><span data-stu-id="2b12d-113">**Flags**</span></span>

    <span data-ttu-id="2b12d-114">接下來的16個位是保留給 Teredo 旗標。</span><span class="sxs-lookup"><span data-stu-id="2b12d-114">The next 16 bits for are reserved for Teredo flags.</span></span> <span data-ttu-id="2b12d-115">針對以 Windows XP 為基礎的 Teredo 用戶端，唯一定義的旗標是高序位位，稱為錐形旗標。</span><span class="sxs-lookup"><span data-stu-id="2b12d-115">For Windows XP-based Teredo clients, the only defined flag is the high order bit known as the Cone flag.</span></span> <span data-ttu-id="2b12d-116">當 Teredo 用戶端位於錐形 NAT 後方時，會設定錐形旗標。</span><span class="sxs-lookup"><span data-stu-id="2b12d-116">The Cone flag is set when Teredo client is behind a cone NAT.</span></span> <span data-ttu-id="2b12d-117">在 Teredo 用戶端的初始設定期間，判斷連接到網際網路的 NAT 是否為錐形 NAT。</span><span class="sxs-lookup"><span data-stu-id="2b12d-117">The determination of whether the NAT connected to the Internet is a cone NAT occurs during the Teredo client's initial configuration.</span></span> <span data-ttu-id="2b12d-118">如需詳細資訊，請參閱本文中的「Teredo 用戶端的初始設定」。</span><span class="sxs-lookup"><span data-stu-id="2b12d-118">For more information, see "Initial configuration for Teredo clients" in this article.</span></span>

    <span data-ttu-id="2b12d-119">針對 Windows Vista 和 Windows Server 2008 型 Teredo 用戶端，[旗標] 欄位中未使用的位可提供保護，防止惡意使用者的位址掃描。</span><span class="sxs-lookup"><span data-stu-id="2b12d-119">For Windows Vista and Windows Server 2008-based Teredo clients, unused bits within the Flags field provide a level of protection from address scans by malicious users.</span></span> <span data-ttu-id="2b12d-120">Windows Vista 和 Windows Server 2008 型 Teredo 用戶端的 [旗標] 欄位中的16個位包含下列各項： CRAAAAUG AAAAAAAA。</span><span class="sxs-lookup"><span data-stu-id="2b12d-120">The 16 bits within the Flags field for Windows Vista and Windows Server 2008-based Teredo clients consists of the following: CRAAAAUG AAAAAAAA.</span></span> <span data-ttu-id="2b12d-121">C 位適用于錐形旗標。</span><span class="sxs-lookup"><span data-stu-id="2b12d-121">The C bit is for the Cone flag.</span></span> <span data-ttu-id="2b12d-122">R 位是保留供日後使用。</span><span class="sxs-lookup"><span data-stu-id="2b12d-122">The R bit is reserved for future use.</span></span> <span data-ttu-id="2b12d-123">U 位適用于通用/本機旗標 (設定為 0) 。</span><span class="sxs-lookup"><span data-stu-id="2b12d-123">The U bit is for the Universal/Local flag (set to 0).</span></span> <span data-ttu-id="2b12d-124">G 位是個別/群組旗標 (設定為 0) 。</span><span class="sxs-lookup"><span data-stu-id="2b12d-124">The G bit is Individual/Group flag (set to 0).</span></span> <span data-ttu-id="2b12d-125">A 位會設為12位隨機產生的數位。</span><span class="sxs-lookup"><span data-stu-id="2b12d-125">The A bits are set to a 12-bit randomly generated number.</span></span> <span data-ttu-id="2b12d-126">藉由使用亂數字來表示在 Teredo 用戶端與 Teredo 伺服器之間，藉由捕捉封包的初始設定交換來判斷 Teredo 位址的其餘部分，將必須嘗試最多 4096 (212) 不同的位址，以在位址掃描期間判斷 Teredo 用戶端的位址。</span><span class="sxs-lookup"><span data-stu-id="2b12d-126">By using a random number for the A bits, a malicious user that has determined the rest of the Teredo address by capturing the initial configuration exchange of packets between the Teredo client and Teredo server will have to try up to 4,096 (212) different addresses to determine a Teredo client's address during an address scan.</span></span>

-   <span data-ttu-id="2b12d-127">**遮蔽外部埠**</span><span class="sxs-lookup"><span data-stu-id="2b12d-127">**Obscured external port**</span></span>

    <span data-ttu-id="2b12d-128">接下來的16個位會儲存與此 Teredo 用戶端之所有 Teredo 流量對應的外部 UDP 埠遮蔽版本。</span><span class="sxs-lookup"><span data-stu-id="2b12d-128">The next 16 bits store an obscured version of the external UDP port corresponding to all Teredo traffic for this Teredo client.</span></span> <span data-ttu-id="2b12d-129">當 Teredo 用戶端傳送其初始封包到 Teredo 伺服器時，封包的來源 UDP 埠會被 NAT 對應到不同的外部 UDP 埠。</span><span class="sxs-lookup"><span data-stu-id="2b12d-129">When the Teredo client sends its initial packet to a Teredo server, the source UDP port of the packet is mapped by the NAT to a different, external UDP port.</span></span> <span data-ttu-id="2b12d-130">Teredo 用戶端會維護此埠對應，使其保留在 NAT 的轉譯表中。</span><span class="sxs-lookup"><span data-stu-id="2b12d-130">The Teredo client maintains this port mapping so that it remains in the NAT's translation table.</span></span> <span data-ttu-id="2b12d-131">因此，主機的所有 Teredo 流量都使用相同的外部對應 UDP 埠。</span><span class="sxs-lookup"><span data-stu-id="2b12d-131">Therefore, all Teredo traffic for the host uses the same external, mapped UDP port.</span></span> <span data-ttu-id="2b12d-132">外部 UDP 埠是由 teredo 伺服器從 Teredo 用戶端傳送之傳入初始封包的來源 UDP 埠所決定，並傳送回 Teredo 用戶端。</span><span class="sxs-lookup"><span data-stu-id="2b12d-132">The external UDP port is determined by the Teredo server from the source UDP port of the incoming initial packet sent by the Teredo client and sent back to the Teredo client.</span></span>

    <span data-ttu-id="2b12d-133">外部埠會以0xFFFF 由外部埠來遮蔽。</span><span class="sxs-lookup"><span data-stu-id="2b12d-133">The external port is obscured by XORing the external port with 0xFFFF.</span></span> <span data-ttu-id="2b12d-134">例如，以十六進位格式表示的外部埠5000遮蔽版本是 EC77 (5000 = 0x1388，0x1388 XOR 0xFFFF = 0xEC77) 。</span><span class="sxs-lookup"><span data-stu-id="2b12d-134">For example, the obscured version of the external port 5000 in hexadecimal format is EC77 (5000 = 0x1388, 0x1388 XOR 0xFFFF = 0xEC77).</span></span> <span data-ttu-id="2b12d-135">遮蔽外部埠可避免 Nat 在轉送的封包承載內轉譯外部埠。</span><span class="sxs-lookup"><span data-stu-id="2b12d-135">Obscuring the external port prevents NATs from translating the external port within the payload of the packets that they are forwarding.</span></span>

-   <span data-ttu-id="2b12d-136">**遮蔽外部地址**</span><span class="sxs-lookup"><span data-stu-id="2b12d-136">**Obscured external address**</span></span>

    <span data-ttu-id="2b12d-137">最後一個32位會儲存與此 Teredo 用戶端之所有 Teredo 流量對應之外部 IPv4 位址的遮蔽版本。</span><span class="sxs-lookup"><span data-stu-id="2b12d-137">The last 32 bits store an obscured version of the external IPv4 address corresponding to all Teredo traffic for this Teredo client.</span></span> <span data-ttu-id="2b12d-138">就像外部埠，當 Teredo 用戶端傳送其初始封包到 Teredo 伺服器時，封包的來源 IP 位址會被 NAT 對應到不同的外部 (公用) 位址。</span><span class="sxs-lookup"><span data-stu-id="2b12d-138">Just like the external port, when the Teredo client sends its initial packet to a Teredo server, the source IP address of the packet is mapped by the NAT to a different, external (public) address.</span></span> <span data-ttu-id="2b12d-139">Teredo 用戶端會維護此位址對應，使其保留在 NAT 的轉譯表中。</span><span class="sxs-lookup"><span data-stu-id="2b12d-139">The Teredo client maintains this address mapping so that it remains in the NAT's translation table.</span></span> <span data-ttu-id="2b12d-140">因此，主機的所有 Teredo 流量都使用相同的外部、對應的公用 IPv4 位址。</span><span class="sxs-lookup"><span data-stu-id="2b12d-140">Therefore, all Teredo traffic for the host uses the same external, mapped, public IPv4 address.</span></span> <span data-ttu-id="2b12d-141">從 Teredo 用戶端傳送之傳入初始封包的來源 IPv4 位址，以及傳送回 Teredo 用戶端之傳入初始封包的來源 IPv4 位址，會決定外部 IPv4 位址。</span><span class="sxs-lookup"><span data-stu-id="2b12d-141">The external IPv4 address is determined by the Teredo server from the source IPv4 address of the incoming initial packet sent by the Teredo client and sent back to the Teredo client.</span></span>

    <span data-ttu-id="2b12d-142">使用0xFFFFFFFF 由外部地址來遮蔽外部地址。</span><span class="sxs-lookup"><span data-stu-id="2b12d-142">The external address is obscured by XORing the external address with 0xFFFFFFFF.</span></span> <span data-ttu-id="2b12d-143">例如，以冒號十六進位格式131.107.0.1 的公用 IPv4 位址的遮蔽版本是7C94： FFFE (131.107.0.1 = 0x836B0001，0x836B0001 XOR 0xFFFFFFFF = 0x7C94FFFE) 。</span><span class="sxs-lookup"><span data-stu-id="2b12d-143">For example, the obscured version of the public IPv4 address 131.107.0.1 in colon-hexadecimal format is 7C94:FFFE (131.107.0.1 = 0x836B0001, 0x836B0001 XOR 0xFFFFFFFF = 0x7C94FFFE).</span></span> <span data-ttu-id="2b12d-144">遮蔽外部地址可避免 Nat 在轉送的封包承載內轉譯外部地址。</span><span class="sxs-lookup"><span data-stu-id="2b12d-144">Obscuring the external address prevents NATs from translating the external address within the payload of the packets that they are forwarding.</span></span>

 

 




