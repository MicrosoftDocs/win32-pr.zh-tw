---
title: 虛擬化根中的快取狀態
description: 描述不同的快取狀態：提供者所管理的檔案或目錄可能具有。
ms.assetid: <GUID-GOES-HERE>
ms.date: 01/17/2020
ms.topic: article
ms.openlocfilehash: 43d62ceb1f5ef5bf07000666f336077270b1e86a
ms.sourcegitcommit: 62e758931c610782807c7c9fad284921a6c56232
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/22/2020
ms.locfileid: "104374162"
---
# <a name="cache-state-in-the-virtualization-root"></a>虛擬化根中的快取狀態

提供者會使用虛擬根目錄下的本機檔案系統作為其所管理專案的快取。   (檔案或目錄) 的專案可以在本機檔案系統上的六種狀態之一：

* 網路

  專案不存在於本機磁片上。  它會在其父目錄的列舉期間進行投影，例如合成。  虛擬專案會與可能存在於磁片上的任何專案合併，以呈現上層目錄的完整內容。

* 預留位置

  對於檔案：檔案的內容 (主要資料流程) 不會出現在磁片上。  檔案的中繼資料 (名稱、大小、時間戳記、屬性等 ) 會快取在磁片上。
  
  針對目錄：部分或所有目錄的直屬子系 (目錄) 中的檔案和目錄不存在於磁片上，也就是它們仍為虛擬。  目錄的中繼資料 (名稱、時間戳記、屬性等 ) 會快取在磁片上。

* 水合預留位置

  對於檔案：檔案的內容和中繼資料已快取到磁片。  也稱為「部分檔案」。
  
  針對目錄：在磁片上以預留位置建立的目錄永遠不會變成水合的預留位置目錄。  這可讓提供者在其備份存放區中新增或移除目錄中的專案，並讓這些變更反映在本機快取中。

*  (水合或不) 的中途預留位置

  專案的中繼資料已在本機修改，而且不再是提供者存放區中其狀態的快取。 請注意，在預留位置目錄下建立或刪除檔案或目錄會導致該預留位置目錄變回。

* 完整檔案/目錄

  檔案：檔案的內容 (主要資料流程) 已修改。  在提供者的存放區中，該檔案已不再是其狀態的快取。  在本機檔案系統上建立的檔案 (亦即，在所有) 的提供者存放區中都不存在的檔案，也會被視為完整的檔案。
  
  若為目錄：在本機檔案系統上建立的目錄 (亦即，在所有) 的提供者存放區中都不存在，則會被視為完整目錄。  在磁片上建立為預留位置的目錄永遠不會成為完整目錄。
  
* 墓碑

  表示已從本機檔案系統刪除之專案的特殊隱藏預留位置。  列舉目錄時 ProjFS 會將本機專案的集合 (預留位置、完整檔案等 ) 與一組虛擬投射專案合併。  如果專案同時出現在本機和投射的集合中，則會優先使用本機專案。  如果檔案不存在於本機檔案系統中，就不會有本機狀態，因此它會出現在列舉中。  但是，如果該專案已被刪除，則將它顯示在列舉中會是非預期的。  使用標記來取代已刪除的專案會產生下列效果：

  * 不顯示專案的列舉。
  * 檔案開啟時，預期專案存在會失敗，例如「找不到檔案」。
  * 只有當專案不存在時，才會建立預期成功的檔案;ProjFS 會在作業中移除標記。

若要說明上述狀態，請考慮下列順序（假設有一個 ProjFS 提供者，該提供者位於虛擬根目錄中的單一檔案 "foo.txt" C:\root。

1. 應用程式會列舉 C:\root。  它會看到虛擬檔案「foo.txt」。  由於尚未存取檔案，因此檔案不存在於磁片上。
1. 應用程式會開啟 C:\root\foo.txt 的控制碼。  ProjFS 會告訴提供者為它建立預留位置。
1. 應用程式會讀取檔案的內容。  提供者會將檔案內容提供給 ProjFS，並快取至 C:\root\foo.txt。  檔案現在是水合預留位置。
1. 應用程式會更新上次修改的時間戳記。  檔案現在是中途水合預留位置。
1. 應用程式會開啟檔案寫入存取的控制碼。  C:\root\foo.txt 現在是完整的檔案。
1. 應用程式會刪除 C:\root\foo.txt。  ProjFS 會以標記取代檔案。  現在，當應用程式列舉 C:\root 時，不會看到 foo.txt。  如果它嘗試開啟檔案，開啟會失敗並 ERROR_FILE_NOT_FOUND。
