---
title: 對應在磚集區中
description: 使用 D3D11 資源的「其他並排顯示」旗標來建立資源時 \_ \_ \_ ，構成資源的磚會指向磚集區中的位置。
ms.assetid: 1DBE23B2-A1E6-4491-9B74-4E92508A68FC
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1537113d6685e39cab94445c8d3f16d406638820
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/20/2020
ms.locfileid: "104990907"
---
# <a name="mappings-are-into-a-tile-pool"></a><span data-ttu-id="3a6fb-103">對應在磚集區中</span><span class="sxs-lookup"><span data-stu-id="3a6fb-103">Mappings are into a tile pool</span></span>

<span data-ttu-id="3a6fb-104">使用 [**D3D11 資源的「 \_ \_ 其他 \_**](/windows/desktop/api/D3D11/ne-d3d11-d3d11_resource_misc_flag) 並排顯示」旗標來建立資源時，構成資源的磚會指向磚集區中的位置。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-104">When a resource is created with the [**D3D11\_RESOURCE\_MISC\_TILED**](/windows/desktop/api/D3D11/ne-d3d11-d3d11_resource_misc_flag) flag, the tiles that make up the resource come from pointing at locations in a tile pool.</span></span> <span data-ttu-id="3a6fb-105">磚集區是記憶體的集區 (由一或多個配置於幕後備份 - 應用程式中看不見)。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-105">A tile pool is a pool of memory (backed by one or more allocations behind the scenes - unseen by the application).</span></span> <span data-ttu-id="3a6fb-106">作業系統和顯示器驅動程式管理這個記憶體集區，讓應用程式容易了解磁碟使用量。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-106">The operating system and display driver manage this pool of memory, and the memory footprint is easily understood by an application.</span></span> <span data-ttu-id="3a6fb-107">並排顯示的資源會指向磚集區中的位置，以對應64KB 個區域。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-107">Tiled resources map 64KB regions by pointing to locations in a tile pool.</span></span> <span data-ttu-id="3a6fb-108">這項設定的一個附帶結果是，它可以讓多資源共用及重複使用相同的動態磚，如有需要，也讓相同的動態磚在資源內的不同位置重複使用。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-108">One fallout of this setup is it allows multiple resources to share and reuse the same tiles, and also for the same tiles to be reused at different locations within a resource if desired.</span></span>

<span data-ttu-id="3a6fb-109">從磚集區彈性填入磚的成本是，該資源必須定義和維護磚集區中的磚對應代表資源所需的動態磚。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-109">The cost for the flexibility of populating the tiles for a resource out of a tile pool is that the resource has to do the work of defining and maintaining the mapping of which tiles in the tile pool represent the tiles needed for the resource.</span></span> <span data-ttu-id="3a6fb-110">您可以變更磚對應。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-110">Tile mappings can be changed.</span></span> <span data-ttu-id="3a6fb-111">並非所有資源中的磚每次都需要對應一次。資源可以有 **NULL** 對應。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-111">Also, not all tiles in a resource need to be mapped at a time; a resource can have **NULL** mappings.</span></span> <span data-ttu-id="3a6fb-112">**NULL** 對應定義為從存取之資源的觀點無法使用磚。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-112">A **NULL** mapping defines a tile as not being available from the point of view of the resource accessing it.</span></span>

<span data-ttu-id="3a6fb-113">您可以建立多個磚集區，而且任何數目的並排顯示資源都可以同時對應到任何指定的磚集區。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-113">Multiple tile pools can be created, and any number of tiled resources can map into any given tile pool at the same time.</span></span> <span data-ttu-id="3a6fb-114">磚集區也可以變大或縮小。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-114">Tile pools can also be grown or shrunk.</span></span> <span data-ttu-id="3a6fb-115">如需詳細資訊，請參閱[調整磚集區大小](tile-pool-resizing.md)。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-115">For more info, see [Tile pool resizing](tile-pool-resizing.md).</span></span> <span data-ttu-id="3a6fb-116">一個可簡化顯示驅動程式和執行時間執行的條件約束，就是指定的並排顯示資源一次只能有一個磚集區的對應 (而不是同時對應到多個磚集區) 。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-116">One constraint that exists to simplify display driver and runtime implementation is that a given tiled resource can only have mappings into at most one tile pool at a time (as opposed to having simultaneous mapping to multiple tile pools).</span></span>

<span data-ttu-id="3a6fb-117">與並排顯示的資源本身相關聯的儲存體數量 (也就是獨立的磚集區記憶體) 大約與實際對應到集區的圖格數目成正比。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-117">The amount of storage that is associated with a tiled resource itself (that is, independent tile-pool memory) is roughly proportional to the number of tiles actually mapped to the pool at any given time.</span></span> <span data-ttu-id="3a6fb-118">因此，對於硬體便需使用對應的磚數量大約調整分頁表儲存空間的磁碟使用量 (例如，視情況使用多層次頁面表格配置)。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-118">In hardware, this fact boils down to scaling the memory footprint for page table storage roughly with the amount of tiles that are mapped (for example, using a multilevel page table scheme as appropriate).</span></span>

<span data-ttu-id="3a6fb-119">磚集區可以視為完全軟體抽象，能使 Direct3D 應用程式有效地能有效地規劃圖形處理器 (GPU) 的網頁表格，而不需要知道低層實作細節 (或直接處理指標地址)。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-119">The tile pool can be thought of as an entirely software abstraction that enables Direct3D applications to effectively be able to program the page tables on the graphics processing unit (GPU) without having to know the low level implementation details (or deal with pointer addresses directly).</span></span> <span data-ttu-id="3a6fb-120">在硬體中，磚集區不套用任何其他間接取值層級。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-120">Tile pools don't apply any additional levels of indirection in hardware.</span></span> <span data-ttu-id="3a6fb-121">使用像是與磚集區概念無關的頁面目錄的建構的單層分頁表最佳化。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-121">Optimizations of a single level page table using constructs like page directories are independent of the tile pool concept.</span></span>

<span data-ttu-id="3a6fb-122">讓我們瀏覽分頁表本身在最糟情況可能要求的儲存體 (雖然實際上實作只需要和所對應者大約一致的儲存體)。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-122">Let us explore what storage the page table itself could require in the worst case (though in practice implementations only require storage roughly proportional to what is mapped).</span></span>

<span data-ttu-id="3a6fb-123">假設每個分頁表項目是 64 位元。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-123">Suppose each page table entry is 64 bits.</span></span>

<span data-ttu-id="3a6fb-124">針對單一介面的最差案例頁面資料表大小，假設 Direct3D 11 中的資源限制，假設已建立並排的資源，並以128位的每個元素格式建立 (例如，RGBA 浮動) ，所以64KB 磚只包含4096圖元。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-124">For the worst-case page table size hit for a single surface, given the resource limits in Direct3D 11, suppose a tiled resource is created with a 128 bit-per-element format (for example, a RGBA float), so a 64KB tile contains only 4096 pixels.</span></span> <span data-ttu-id="3a6fb-125">支援的 [**Texture2DArray**](/windows/desktop/direct3dhlsl/sm5-object-texture2darray) 大小上限為 16384 \* 16384 \* 2048 (但只有單一 mipmap) 如果完整填入 (不包括使用64位資料表專案的 mipmap) ，則在頁面資料表中需要大約1gb 的儲存體。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-125">The maximum supported [**Texture2DArray**](/windows/desktop/direct3dhlsl/sm5-object-texture2darray) size of 16384\*16384\*2048 (but with only a single mipmap) would require about 1GB of storage in the page table if fully populated (not including mipmaps) using 64 bit table entries.</span></span> <span data-ttu-id="3a6fb-126">新增 Mipmap 會增加完全對應 (最糟情況) 分頁表儲存空間約 1.3GB 的三分之一。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-126">Adding mipmaps would grow the fully-mapped (worst case) page table storage by about a third, to about 1.3GB.</span></span>

<span data-ttu-id="3a6fb-127">這種情形存取約 10.6 TB 可定址記憶體。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-127">This case would give access to about 10.6 terabytes of addressable memory.</span></span> <span data-ttu-id="3a6fb-128">但可能會限制可定址記憶體數量，這會使數量減少至約 TB 範圍。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-128">There might be a limit on the amount of addressable memory however, which would reduce these amounts, perhaps to around the terabyte range.</span></span>

<span data-ttu-id="3a6fb-129">另一個要考慮的情況是，以單一 [**Texture2D**](/windows/desktop/direct3dhlsl/sm5-object-texture2d) 的方式，將 16384 16384 的資源並排顯示為 \* 每個元素32位的格式，包括 mipmap。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-129">Another case to consider is a single [**Texture2D**](/windows/desktop/direct3dhlsl/sm5-object-texture2d) tiled resource of 16384\*16384 with a 32 bit-per-element format, including mipmaps.</span></span> <span data-ttu-id="3a6fb-130">完整填入分頁表所需的空間約 170 KB，具有 64 位元資料表項目。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-130">The space needed in a fully populated page table would be roughly 170KB with 64 bit table entries.</span></span>

<span data-ttu-id="3a6fb-131">最後，請考慮使用 BC 格式的範例，例如 BC7 含每個磚 128 位元 4x4 像素。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-131">Finally, consider an example using a BC format, say BC7 with 128 bits per tile of 4x4 pixels.</span></span> <span data-ttu-id="3a6fb-132">這是每個像素一個位元組。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-132">That is one byte per pixel.</span></span> <span data-ttu-id="3a6fb-133">16384 [](/windows/desktop/direct3dhlsl/sm5-object-texture2darray) \* 16384 2048 的 Texture2DArray \* （包括 MIPMAP）需要大約85MB 才能將此記憶體完整填入頁面資料表中。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-133">A [**Texture2DArray**](/windows/desktop/direct3dhlsl/sm5-object-texture2darray) of 16384\*16384\*2048 including mipmaps would require roughly 85MB to fully populate this memory in a page table.</span></span> <span data-ttu-id="3a6fb-134">這並不難考慮這種情況下，在此案例中，有一個並排的資源可跨越 550 gigapixels (512 GB 的記憶體) 。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-134">That is not bad considering this allows one tiled resource to span 550 gigapixels (512 GB of memory in this case).</span></span>

<span data-ttu-id="3a6fb-135">實際上，如果實體可用記憶體數量不允許每次都對應和參考，便不定義這些完整對應。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-135">In practice, nowhere near these full mappings would be defined given that the amount of physical memory available wouldn't allow anywhere near that much to be mapped and referenced at a time.</span></span> <span data-ttu-id="3a6fb-136">但若有磚集區，應用程式便可以選擇重複使用動態磚 (例如，重複使用「黑」色磚針對影像中大型塊黑色區域) - 有效使用磚集區 (也就是分頁表對應) 當做記憶體壓縮工具。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-136">But with a tile pool, applications could choose to reuse tiles (as a simple example, reusing a "black" colored tile for large black regions in an image) - effectively using the tile pool (that is, page table mappings) as a tool for memory compression.</span></span>

<span data-ttu-id="3a6fb-137">分頁表所有項目的初始內容為 **NULL**。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-137">The initial contents of the page table are **NULL** for all entries.</span></span> <span data-ttu-id="3a6fb-138">應用程式也無法傳遞表面的記憶體內容的初始資料，因為它一開始便沒有輔助記憶體。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-138">Applications also can't pass initial data for the memory contents of the surface since it starts off with no memory backing.</span></span>

## <a name="in-this-section"></a><span data-ttu-id="3a6fb-139">本節內容</span><span class="sxs-lookup"><span data-stu-id="3a6fb-139">In this section</span></span>



| <span data-ttu-id="3a6fb-140">主題</span><span class="sxs-lookup"><span data-stu-id="3a6fb-140">Topic</span></span>                                                                                                   | <span data-ttu-id="3a6fb-141">描述</span><span class="sxs-lookup"><span data-stu-id="3a6fb-141">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                |
|---------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="3a6fb-142">建立磚集區</span><span class="sxs-lookup"><span data-stu-id="3a6fb-142">Tile pool creation</span></span>](tile-pool-creation.md)<br/>                                                 | <span data-ttu-id="3a6fb-143">磚集區會透過 [**ID3D11Device：： CreateBuffer**](/windows/desktop/api/D3D11/nf-d3d11-id3d11device-createbuffer) API 來建立，其方式是在 *D3D11* 參數指向之 [**PDesc \_ 緩衝區 \_ DESC**](/windows/desktop/api/D3D11/ns-d3d11-d3d11_buffer_desc)結構的 **MiscFlags** 成員中傳遞 [**D3D11 \_ 資源 \_ 其他 \_ 磚 \_ 集**](/windows/desktop/api/D3D11/ne-d3d11-d3d11_resource_misc_flag)區旗標。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-143">A tile pool is created via the [**ID3D11Device::CreateBuffer**](/windows/desktop/api/D3D11/nf-d3d11-id3d11device-createbuffer) API by passing the [**D3D11\_RESOURCE\_MISC\_TILE\_POOL**](/windows/desktop/api/D3D11/ne-d3d11-d3d11_resource_misc_flag) flag in the **MiscFlags** member of the [**D3D11\_BUFFER\_DESC**](/windows/desktop/api/D3D11/ns-d3d11-d3d11_buffer_desc) structure that the *pDesc* parameter points to.</span></span> <br/> |
| [<span data-ttu-id="3a6fb-144">調整磚集區大小</span><span class="sxs-lookup"><span data-stu-id="3a6fb-144">Tile pool resizing</span></span>](tile-pool-resizing.md)<br/>                                                 | <span data-ttu-id="3a6fb-145">如果應用程式需要更多的工作集，以將並排顯示的資源對應至磚集區，或如果需要較少的空間，請使用 [**ID3D11DeviceCoNtext2：： ResizeTilePool**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-resizetilepool) API 來放大磚集區。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-145">Use the [**ID3D11DeviceContext2::ResizeTilePool**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-resizetilepool) API to grow a tile pool if the application needs more working set for the tiled resources mapping into it or to shrink if less space is needed.</span></span> <br/>                                                                                                                    |
| [<span data-ttu-id="3a6fb-146">危險追蹤與磚集區資源</span><span class="sxs-lookup"><span data-stu-id="3a6fb-146">Hazard tracking versus tile pool resources</span></span>](hazard-tracking-versus-tile-pool-resources.md)<br/> | <span data-ttu-id="3a6fb-147">針對非並排顯示的資源，Direct3D 可以在轉譯期間防止特定的危險情況，但因為危險追蹤是在並排顯示的資源圖層級上，所以在呈現並排顯示的資源時追蹤危險的情況可能會太昂貴。</span><span class="sxs-lookup"><span data-stu-id="3a6fb-147">For non-tiled resources, Direct3D can prevent certain hazard conditions during rendering, but because hazard tracking would be at a tile level for tiled resources, tracking hazard conditions during rendering of tiled resources might be too expensive.</span></span> <br/>                                                                                                     |



 

## <a name="related-topics"></a><span data-ttu-id="3a6fb-148">相關主題</span><span class="sxs-lookup"><span data-stu-id="3a6fb-148">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="3a6fb-149">建立磚資源</span><span class="sxs-lookup"><span data-stu-id="3a6fb-149">Creating tiled resources</span></span>](creating-tiled-resources.md)
</dt> </dl>

 

