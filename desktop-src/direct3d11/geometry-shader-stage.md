---
title: 幾何著色器階段
description: 幾何著色器 (GS) 階段會執行應用程式指定的著色器程式碼，並以頂點作為輸入，以及在輸出上產生頂點的能力。
ms.assetid: F3208862-980E-403F-9154-13B34A882787
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: da66b1e3f9abf4e7db8010887f3e78676d02a874
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/20/2020
ms.locfileid: "103682629"
---
# <a name="geometry-shader-stage"></a><span data-ttu-id="f3760-103">幾何著色器階段</span><span class="sxs-lookup"><span data-stu-id="f3760-103">Geometry Shader Stage</span></span>

<span data-ttu-id="f3760-104">幾何著色器 (GS) 階段會執行應用程式指定的著色器程式碼，並以頂點作為輸入，以及在輸出上產生頂點的能力。</span><span class="sxs-lookup"><span data-stu-id="f3760-104">The geometry-shader (GS) stage runs application-specified shader code with vertices as input and the ability to generate vertices on output.</span></span>

## <a name="the-geometry-shader"></a><span data-ttu-id="f3760-105">幾何著色器</span><span class="sxs-lookup"><span data-stu-id="f3760-105">The Geometry Shader</span></span>

<span data-ttu-id="f3760-106">不同于在單一頂點上操作的頂點著色器，幾何著色器的輸入是完整基本 (兩個頂點的頂點、三角形的三個頂點，或點) 的單一頂點。</span><span class="sxs-lookup"><span data-stu-id="f3760-106">Unlike vertex shaders, which operate on a single vertex, the geometry shader's inputs are the vertices for a full primitive (two vertices for lines, three vertices for triangles, or single vertex for point).</span></span> <span data-ttu-id="f3760-107">幾何著色器也可以將邊緣-相鄰基本專案的頂點資料帶入輸入 (兩個線條的額外兩個頂點，另外三個用於三角形) 。</span><span class="sxs-lookup"><span data-stu-id="f3760-107">Geometry shaders can also bring in the vertex data for the edge-adjacent primitives as input (an additional two vertices for a line, an additional three for a triangle).</span></span> <span data-ttu-id="f3760-108">下圖顯示具有相鄰頂點的三角形和線條。</span><span class="sxs-lookup"><span data-stu-id="f3760-108">The following illustration shows a triangle and a line with adjacent vertices.</span></span>

![有相鄰頂點的三角形和線條的圖](images/d3d10-gs.png)

|     |                 |
|-----|-----------------|
| <span data-ttu-id="f3760-110">電視</span><span class="sxs-lookup"><span data-stu-id="f3760-110">TV</span></span>  | <span data-ttu-id="f3760-111">三角形頂點</span><span class="sxs-lookup"><span data-stu-id="f3760-111">Triangle vertex</span></span> |
| <span data-ttu-id="f3760-112">AV</span><span class="sxs-lookup"><span data-stu-id="f3760-112">AV</span></span>  | <span data-ttu-id="f3760-113">相鄰頂點</span><span class="sxs-lookup"><span data-stu-id="f3760-113">Adjacent vertex</span></span> |
| <span data-ttu-id="f3760-114">LV</span><span class="sxs-lookup"><span data-stu-id="f3760-114">LV</span></span>  | <span data-ttu-id="f3760-115">線條頂點</span><span class="sxs-lookup"><span data-stu-id="f3760-115">Line vertex</span></span>     |



 

<span data-ttu-id="f3760-116">幾何著色器階段可以使用 \_ 由 IA 自動產生的 SV PrimitiveID [系統產生的值](d3d10-graphics-programming-guide-input-assembler-stage-using.md) 。</span><span class="sxs-lookup"><span data-stu-id="f3760-116">The geometry-shader stage can consume the SV\_PrimitiveID [system-generated value](d3d10-graphics-programming-guide-input-assembler-stage-using.md) that is auto-generated by the IA.</span></span> <span data-ttu-id="f3760-117">這樣就可以在需要時提取或運算每個基本類型資料。</span><span class="sxs-lookup"><span data-stu-id="f3760-117">This allows per-primitive data to be fetched or computed if desired.</span></span>

<span data-ttu-id="f3760-118">幾何著色器階段可以輸出多個頂點來形成單一選取的拓撲 (GS 階段輸出拓撲可用： tristrip、linestrip 和 pointlist) 。</span><span class="sxs-lookup"><span data-stu-id="f3760-118">The geometry-shader stage is capable of outputting multiple vertices forming a single selected topology (GS stage output topologies available are: tristrip, linestrip, and pointlist).</span></span> <span data-ttu-id="f3760-119">發出的基本類型數目可在幾何著色器的任何叫用內自由改變，雖然可發出的頂點最大數目必須以靜態方式宣告。</span><span class="sxs-lookup"><span data-stu-id="f3760-119">The number of primitives emitted can vary freely within any invocation of the geometry shader, though the maximum number of vertices that could be emitted must be declared statically.</span></span> <span data-ttu-id="f3760-120">從幾何著色器調用發出的移除長度可以是任意的，而且可以透過 [RestartStrip](/windows/desktop/direct3dhlsl/dx-graphics-hlsl-so-restartstrip) HLSL 函式建立新的帶狀。</span><span class="sxs-lookup"><span data-stu-id="f3760-120">Strip lengths emitted from a geometry shader invocation can be arbitrary, and new strips can be created via the [RestartStrip](/windows/desktop/direct3dhlsl/dx-graphics-hlsl-so-restartstrip) HLSL function.</span></span>

<span data-ttu-id="f3760-121">幾何著色器輸出可能會在記憶體中透過資料流輸出階段，對點陣化階段和/或頂點緩衝區供給。</span><span class="sxs-lookup"><span data-stu-id="f3760-121">Geometry shader output may be fed to the rasterizer stage and/or to a vertex buffer in memory via the stream output stage.</span></span> <span data-ttu-id="f3760-122">對記憶體供給的輸出會擴充至個別點/線條/三角形清單 (與它們傳遞進入點陣化一模一樣)。</span><span class="sxs-lookup"><span data-stu-id="f3760-122">Output fed to memory is expanded to individual point/line/triangle lists (exactly as they would be passed to the rasterizer).</span></span>

<span data-ttu-id="f3760-123">當幾何著色器為使用中時，它會針對向下傳遞或先前在管線中產生的每個基本類型叫用一次。</span><span class="sxs-lookup"><span data-stu-id="f3760-123">When a geometry shader is active, it is invoked once for every primitive passed down or generated earlier in the pipeline.</span></span> <span data-ttu-id="f3760-124">每次叫用幾何著色器，都會視為輸入叫用基本類型的資料，無論是單一點、單一線條或單一三角形。</span><span class="sxs-lookup"><span data-stu-id="f3760-124">Each invocation of the geometry shader sees as input the data for the invoking primitive, whether that is a single point, a single line, or a single triangle.</span></span> <span data-ttu-id="f3760-125">管線中較早的三角形連環會導致針對連環中每個個別三角形叫用幾何著色器 (就像是連環向外擴充至三角形清單)。</span><span class="sxs-lookup"><span data-stu-id="f3760-125">A triangle strip from earlier in the pipeline would result in an invocation of the geometry shader for each individual triangle in the strip (as if the strip were expanded out into a triangle list).</span></span> <span data-ttu-id="f3760-126">您可以使用個別基本型別中每個頂點的所有輸入資料 (例如，三角形) 的3個頂點，以及連續的頂點資料（如果適用/可用）。</span><span class="sxs-lookup"><span data-stu-id="f3760-126">All the input data for each vertex in the individual primitive is available (i.e. 3 vertices for triangle), plus adjacent vertex data if applicable/available.</span></span>

<span data-ttu-id="f3760-127">幾何著色器一次輸出一個頂點的資料，藉由將頂點附加至輸出資料流物件。</span><span class="sxs-lookup"><span data-stu-id="f3760-127">A geometry shader outputs data one vertex at a time by appending vertices to an output stream object.</span></span> <span data-ttu-id="f3760-128">資料流程的拓撲取決於固定的宣告，選擇下列其中一個： PointStream、LineStream 或 TriangleStream 做為 GS 階段的輸出。</span><span class="sxs-lookup"><span data-stu-id="f3760-128">The topology of the streams is determined by a fixed declaration, choosing one of: PointStream, LineStream, or TriangleStream as the output for the GS stage.</span></span> <span data-ttu-id="f3760-129">有三種類型的資料流程物件可用、PointStream、LineStream 和 TriangleStream，它們都是樣板化物件。</span><span class="sxs-lookup"><span data-stu-id="f3760-129">There are three types of stream objects available, PointStream, LineStream and TriangleStream which are all templated objects.</span></span> <span data-ttu-id="f3760-130">輸出的拓撲是由各自的物件類型決定，而附加至資料流的頂點的格式是由範本類型決定。</span><span class="sxs-lookup"><span data-stu-id="f3760-130">The topology of the output is determined by their respective object type, while the format of the vertices appended to the stream is determined by the template type.</span></span> <span data-ttu-id="f3760-131">從其他叫用執行幾何著色器執行個體是不可部分完成的，除非新增至資料流的資料為序列。</span><span class="sxs-lookup"><span data-stu-id="f3760-131">Execution of a geometry shader instance is atomic from other invocations, except that data added to the streams is serial.</span></span> <span data-ttu-id="f3760-132">特定幾合著色器叫用的輸出與其他叫用無關 (雖然會遵循順序)。</span><span class="sxs-lookup"><span data-stu-id="f3760-132">The outputs of a given invocation of a geometry shader are independent of other invocations (though ordering is respected).</span></span> <span data-ttu-id="f3760-133">產生三角形連環的幾何著色易會在每次叫用時開始新的連環。</span><span class="sxs-lookup"><span data-stu-id="f3760-133">A geometry shader generating triangle strips will start a new strip on every invocation.</span></span>

<span data-ttu-id="f3760-134">當幾何著色器輸出識別為系統轉譯值 (例如 SV \_ RenderTargetArrayIndex 或 sv \_ 位置) 時，硬體除了能夠將資料本身傳遞給下一個著色器階段以進行輸入之外，還會查看此資料並執行一些行為。</span><span class="sxs-lookup"><span data-stu-id="f3760-134">When a geometry shader output is identified as a System Interpreted Value (e.g. SV\_RenderTargetArrayIndex or SV\_Position), hardware looks at this data and performs some behavior dependent on the value, in addition to being able to pass the data itself to the next shader stage for input.</span></span> <span data-ttu-id="f3760-135">當幾何著色器的這類資料輸出對每個基本型 (例如 SV \_ RenderTargetArrayIndex 或 sv \_ ViewportArrayIndex) ，而不是依每個頂點的基礎 (例如 sv \_ CLIPDISTANCE \[ n \] 或 sv \_ 位置) 時，會從針對原始物件發出的開頭頂點取得每個基本資料。</span><span class="sxs-lookup"><span data-stu-id="f3760-135">When such data output from the geometry shader has meaning to the hardware on a per-primitive basis (such as SV\_RenderTargetArrayIndex or SV\_ViewportArrayIndex), rather than on a per-vertex basis (such as SV\_ClipDistance\[n\] or SV\_Position), the per-primitive data is taken from the leading vertex emitted for the primitive.</span></span>

<span data-ttu-id="f3760-136">部分完成的基本類型可能是由幾合著色器產生，如果幾何著色器結束且基本類型未完成。</span><span class="sxs-lookup"><span data-stu-id="f3760-136">Partially completed primitives could be generated by the geometry shader if the geometry shader ends and the primitive is incomplete.</span></span> <span data-ttu-id="f3760-137">未完成的基本類型會捨棄且無訊息。</span><span class="sxs-lookup"><span data-stu-id="f3760-137">Incomplete primitives are silently discarded.</span></span> <span data-ttu-id="f3760-138">這類似 IA 處理部分未完成基本類型的方式。</span><span class="sxs-lookup"><span data-stu-id="f3760-138">This is similar to the way the IA treats partially completed primitives.</span></span>

<span data-ttu-id="f3760-139">幾何著色器可以執行載入和紋理取樣作業，在不需要螢幕空間衍生項目時 (samplelevel、samplecmplevelzero、samplegrad)。</span><span class="sxs-lookup"><span data-stu-id="f3760-139">The geometry shader can perform load and texture sampling operations where screen-space derivatives are not required (samplelevel, samplecmplevelzero, samplegrad).</span></span>

<span data-ttu-id="f3760-140">可以在幾何著色器中執行的演算法包括：</span><span class="sxs-lookup"><span data-stu-id="f3760-140">Algorithms that can be implemented in the geometry shader include:</span></span>

-   <span data-ttu-id="f3760-141">Point Sprite Expansion</span><span class="sxs-lookup"><span data-stu-id="f3760-141">Point Sprite Expansion</span></span>
-   <span data-ttu-id="f3760-142">Dynamic Particle Systems</span><span class="sxs-lookup"><span data-stu-id="f3760-142">Dynamic Particle Systems</span></span>
-   <span data-ttu-id="f3760-143">Fur/Fin Generation</span><span class="sxs-lookup"><span data-stu-id="f3760-143">Fur/Fin Generation</span></span>
-   <span data-ttu-id="f3760-144">Shadow Volume Generation</span><span class="sxs-lookup"><span data-stu-id="f3760-144">Shadow Volume Generation</span></span>
-   <span data-ttu-id="f3760-145">Single Pass Render-to-Cubemap</span><span class="sxs-lookup"><span data-stu-id="f3760-145">Single Pass Render-to-Cubemap</span></span>
-   <span data-ttu-id="f3760-146">Per-Primitive Material Swapping</span><span class="sxs-lookup"><span data-stu-id="f3760-146">Per-Primitive Material Swapping</span></span>
-   <span data-ttu-id="f3760-147">Per-Primitive 材質設定-包括將 barycentric 座標產生為基本資料，讓圖元著色器可以執行自訂屬性插補 (如需更高順序的正常插補範例，請參閱 [CubeMapGS 範例](https://msdn.microsoft.com/library/Ee416398(v=VS.85).aspx)) 。</span><span class="sxs-lookup"><span data-stu-id="f3760-147">Per-Primitive Material Setup - Including generation of barycentric coordinates as primitive data so that a pixel shader can perform custom attribute interpolation (for an example of higher-order normal interpolation, see [CubeMapGS Sample](https://msdn.microsoft.com/library/Ee416398(v=VS.85).aspx)).</span></span>

## <a name="related-topics"></a><span data-ttu-id="f3760-148">相關主題</span><span class="sxs-lookup"><span data-stu-id="f3760-148">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="f3760-149">圖形管線</span><span class="sxs-lookup"><span data-stu-id="f3760-149">Graphics Pipeline</span></span>](overviews-direct3d-11-graphics-pipeline.md)
</dt> <dt>

[<span data-ttu-id="f3760-150"> (Direct3D 10) 的管線階段 </span><span class="sxs-lookup"><span data-stu-id="f3760-150">Pipeline Stages (Direct3D 10)</span></span>](/windows/desktop/direct3d10/d3d10-graphics-programming-guide-pipeline-stages)
</dt> </dl>

 

 