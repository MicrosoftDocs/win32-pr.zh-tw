---
description: 您可以使用 IDirect3DSurface9：： LockRect 方法，直接存取 surface 記憶體。
ms.assetid: ad669c22-6163-4fbb-bad0-160ced5bc558
title: 直接存取 (Direct3D 9) 的介面記憶體
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e7ed9a65265671e6509172eccd9a1b66ea91507f
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104317864"
---
# <a name="accessing-surface-memory-directly-direct3d-9"></a><span data-ttu-id="f3197-103">直接存取 (Direct3D 9) 的介面記憶體</span><span class="sxs-lookup"><span data-stu-id="f3197-103">Accessing Surface Memory Directly (Direct3D 9)</span></span>

<span data-ttu-id="f3197-104">您可以使用 [**IDirect3DSurface9：： LockRect**](/windows/desktop/api) 方法，直接存取 surface 記憶體。</span><span class="sxs-lookup"><span data-stu-id="f3197-104">You can directly access the surface memory by using the [**IDirect3DSurface9::LockRect**](/windows/desktop/api) method.</span></span> <span data-ttu-id="f3197-105">當您呼叫這個方法時，pRect 參數是 [**矩形**](/previous-versions//dd162897(v=vs.85)) 結構的指標，可描述介面上要直接存取的矩形。</span><span class="sxs-lookup"><span data-stu-id="f3197-105">When you call this method, the pRect parameter is a pointer to a [**RECT**](/previous-versions//dd162897(v=vs.85)) structure that describes the rectangle on the surface to access directly.</span></span> <span data-ttu-id="f3197-106">若要要求鎖定整個介面，請將 pRect 設定為 **Null**。</span><span class="sxs-lookup"><span data-stu-id="f3197-106">To request that the entire surface be locked, set pRect to **NULL**.</span></span> <span data-ttu-id="f3197-107">此外，您也可以指定只涵蓋介面一部分的 **矩形** 。</span><span class="sxs-lookup"><span data-stu-id="f3197-107">Also, you can specify a **RECT** that covers only a portion of the surface.</span></span> <span data-ttu-id="f3197-108">如果沒有兩個矩形重迭，則兩個執行緒或進程可以同時鎖定介面中的多個矩形。</span><span class="sxs-lookup"><span data-stu-id="f3197-108">Providing that no two rectangles overlap, two threads or processes can simultaneously lock multiple rectangles in a surface.</span></span> <span data-ttu-id="f3197-109">請注意，無法鎖定多級取樣背景緩衝區。</span><span class="sxs-lookup"><span data-stu-id="f3197-109">Note that a multisample back buffer cannot be locked.</span></span>

<span data-ttu-id="f3197-110">[**IDirect3DSurface9：： LockRect**](/windows/desktop/api)方法會以所有資訊填入 [**D3DLOCKED \_ RECT**](d3dlocked-rect.md)結構，以適當地存取介面記憶體。</span><span class="sxs-lookup"><span data-stu-id="f3197-110">The [**IDirect3DSurface9::LockRect**](/windows/desktop/api) method fills a [**D3DLOCKED\_RECT**](d3dlocked-rect.md) structure with all the information to properly access the surface memory.</span></span> <span data-ttu-id="f3197-111">結構包含了有關音調的資訊，並且具有鎖定位的指標。</span><span class="sxs-lookup"><span data-stu-id="f3197-111">The structure includes information about the pitch and has a pointer to the locked bits.</span></span> <span data-ttu-id="f3197-112">當您完成介面記憶體的存取時，請呼叫 [**IDirect3DSurface9：： UnlockRect**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3dsurface9-unlockrect) 方法將它解除鎖定。</span><span class="sxs-lookup"><span data-stu-id="f3197-112">When you finish accessing the surface memory, call the [**IDirect3DSurface9::UnlockRect**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3dsurface9-unlockrect) method to unlock it.</span></span>

<span data-ttu-id="f3197-113">當您鎖定了介面時，可以直接操作內容。</span><span class="sxs-lookup"><span data-stu-id="f3197-113">While you have a surface locked, you can directly manipulate the contents.</span></span> <span data-ttu-id="f3197-114">下列清單描述一些可避免直接呈現介面記憶體常見問題的秘訣。</span><span class="sxs-lookup"><span data-stu-id="f3197-114">The following list describes some tips for avoiding common problems with directly rendering surface memory.</span></span>

-   <span data-ttu-id="f3197-115">絕對不要採用常數顯示音調。</span><span class="sxs-lookup"><span data-stu-id="f3197-115">Never assume a constant display pitch.</span></span> <span data-ttu-id="f3197-116">一律檢查 [**IDirect3DSurface9：： LockRect**](/windows/desktop/api) 方法所傳回的音調資訊。</span><span class="sxs-lookup"><span data-stu-id="f3197-116">Always examine the pitch information returned by the [**IDirect3DSurface9::LockRect**](/windows/desktop/api) method.</span></span> <span data-ttu-id="f3197-117">這種方式可能會因許多原因而有所不同，包括介面記憶體的位置、顯示配接器類型，或甚至是 Direct3D 驅動程式的版本。</span><span class="sxs-lookup"><span data-stu-id="f3197-117">This pitch can vary for a number of reasons, including the location of the surface memory, the display card type, or even the version of the Direct3D driver.</span></span> <span data-ttu-id="f3197-118">如需詳細資訊，請參閱 [Width 與音調 (Direct3D 9) ](width-vs--pitch.md)。</span><span class="sxs-lookup"><span data-stu-id="f3197-118">For more information, see [Width vs. Pitch (Direct3D 9)](width-vs--pitch.md).</span></span>
-   <span data-ttu-id="f3197-119">確定您已複製到未鎖定的表面。</span><span class="sxs-lookup"><span data-stu-id="f3197-119">Make certain you copy to unlocked surfaces.</span></span> <span data-ttu-id="f3197-120">如果在鎖定的介面上呼叫，Direct3D 複製方法將會失敗。</span><span class="sxs-lookup"><span data-stu-id="f3197-120">Direct3D copy methods will fail if called on a locked surface.</span></span>
-   <span data-ttu-id="f3197-121">鎖定介面時限制應用程式的活動。</span><span class="sxs-lookup"><span data-stu-id="f3197-121">Limit your application's activity while a surface is locked.</span></span>
-   <span data-ttu-id="f3197-122">一律複製對齊顯示記憶體的資料。</span><span class="sxs-lookup"><span data-stu-id="f3197-122">Always copy data aligned to display memory.</span></span> <span data-ttu-id="f3197-123">Windows 98 使用分頁錯誤處理常式（Vflatd）來針對具有 bank 切換記憶體的顯示器卡片，執行虛擬的一般框架緩衝區。</span><span class="sxs-lookup"><span data-stu-id="f3197-123">Windows 98 uses a page fault handler, Vflatd.386, to implement a virtual flat-frame buffer for display cards with bank-switched memory.</span></span> <span data-ttu-id="f3197-124">此處理程式可讓這些顯示裝置對 Direct3D 呈現線性框架緩衝區。</span><span class="sxs-lookup"><span data-stu-id="f3197-124">The handler allows these display devices to present a linear frame buffer to Direct3D.</span></span> <span data-ttu-id="f3197-125">將未配置的資料複製到顯示記憶體，可能會導致系統在複本跨越記憶體 bank 時暫停作業。</span><span class="sxs-lookup"><span data-stu-id="f3197-125">Copying data unaligned to display memory can cause the system to suspend operations if the copy spans memory banks.</span></span>
-   <span data-ttu-id="f3197-126">如果介面屬於指派給 D3DPOOL 預設記憶體集區的資源，則介面可能無法鎖定， \_ 除非它是動態材質或使用 [**IDirect3DDevice9：： CreateOffscreenPlainSurface**](/windows/desktop/api)建立的介面。</span><span class="sxs-lookup"><span data-stu-id="f3197-126">A surface may not be locked if it belongs to a resource assigned to the D3DPOOL\_DEFAULT memory pool unless it is a dynamic texture or a surface created using [**IDirect3DDevice9::CreateOffscreenPlainSurface**](/windows/desktop/api).</span></span> <span data-ttu-id="f3197-127">您可以使用 [**IDirect3DDevice9：： GetBackBuffer**](/windows/desktop/api) 和 [**IDirect3DSwapChain9：： GetBackBuffer**](/windows/desktop/api) 方法存取的背景緩衝區介面，只有在使用 [**D3DPRESENT \_ 參數**](d3dpresent-parameters.md) 的旗標成員建立交換鏈，以包含 D3DPRESENTFLAG 可鎖定背景緩衝區時，才會鎖定 \_ \_ 。</span><span class="sxs-lookup"><span data-stu-id="f3197-127">Back buffer surfaces, which may be accessed using the [**IDirect3DDevice9::GetBackBuffer**](/windows/desktop/api) and [**IDirect3DSwapChain9::GetBackBuffer**](/windows/desktop/api) methods, may be locked only if the swap chain was created with the Flags member of [**D3DPRESENT\_PARAMETERS**](d3dpresent-parameters.md) to include D3DPRESENTFLAG\_LOCKABLE\_BACKBUFFER.</span></span>

## <a name="related-topics"></a><span data-ttu-id="f3197-128">相關主題</span><span class="sxs-lookup"><span data-stu-id="f3197-128">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="f3197-129">Direct3D 表面</span><span class="sxs-lookup"><span data-stu-id="f3197-129">Direct3D Surfaces</span></span>](direct3d-surfaces.md)
</dt> </dl>

 

 
