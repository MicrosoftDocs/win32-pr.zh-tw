---
description: 置換地圖類似于材質地圖，但由頂點引擎存取。
ms.assetid: d6f16ff2-5a66-48a3-82c4-523faaafa6ae
title: " (Direct3D 9) 的置換對應"
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b687583b0109223d8c2dac807425e235ddf280e4
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/06/2021
ms.locfileid: "104467781"
---
# <a name="displacement-mapping-direct3d-9"></a><span data-ttu-id="37aa4-103"> (Direct3D 9) 的置換對應</span><span class="sxs-lookup"><span data-stu-id="37aa4-103">Displacement Mapping (Direct3D 9)</span></span>

<span data-ttu-id="37aa4-104">置換地圖類似于材質地圖，但由頂點引擎存取。</span><span class="sxs-lookup"><span data-stu-id="37aa4-104">Displacement maps are similar to texture maps but are accessed by the vertex engine.</span></span>

## <a name="block-diagram"></a><span data-ttu-id="37aa4-105">框圖</span><span class="sxs-lookup"><span data-stu-id="37aa4-105">Block Diagram</span></span>

<span data-ttu-id="37aa4-106">頂點管道的早期部分會出現額外的取樣器階段，如下圖所示，它可以取樣置換圖來提供頂點置換資料。</span><span class="sxs-lookup"><span data-stu-id="37aa4-106">An additional sampler stage is present in the early part of the vertex pipe, as shown in the following diagram, which can sample a displacement map to provide vertex displacement data.</span></span>

![頂點管線中取樣器階段的圖表](images/tessellatordx9.png)

<span data-ttu-id="37aa4-108">您可以使用階段編號256（這是新的階段號）， [**SetSamplerState**](/windows/desktop/api) 設定置換地圖取樣器狀態。</span><span class="sxs-lookup"><span data-stu-id="37aa4-108">The displacement map sampler state can be set by the [**SetSamplerState**](/windows/desktop/api) using stage number 256, which is a new stage number.</span></span> <span data-ttu-id="37aa4-109">置換地圖材質是由 [**SetTexture**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-settexture)所設定。</span><span class="sxs-lookup"><span data-stu-id="37aa4-109">The displacement map texture is set by [**SetTexture**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-settexture).</span></span>

<span data-ttu-id="37aa4-110">地圖可以是 presampled 的，這表示可以用可在不進行篩選的情況下查閱置換值的方式來排序。</span><span class="sxs-lookup"><span data-stu-id="37aa4-110">The map can be presampled or not, which means that it can be ordered in a way that enables the lookup of the displacement values without filtering.</span></span>

-   <span data-ttu-id="37aa4-111">置換地圖類似于材質地圖，但由頂點引擎存取。</span><span class="sxs-lookup"><span data-stu-id="37aa4-111">Displacement maps are analogous to texture maps but are accessed by the vertex engine.</span></span>
-   <span data-ttu-id="37aa4-112">在可取樣置換圖的頂點管道早期部分中，會出現額外的取樣器階段。</span><span class="sxs-lookup"><span data-stu-id="37aa4-112">An additional sampler stage is present in the early part of the vertex pipe that can sample a displacement map.</span></span> <span data-ttu-id="37aa4-113">這個階段是由一般 SetSamplerState API 存取，但階段號碼是 D3DDMAPSAMPLER = 256。</span><span class="sxs-lookup"><span data-stu-id="37aa4-113">This stage is accessed by the usual SetSamplerState API but the stage number is D3DDMAPSAMPLER = 256.</span></span>
-   <span data-ttu-id="37aa4-114">SetSamplerState (D3DDMAPSAMPLER，... ) API 可設定置換地圖取樣器狀態。</span><span class="sxs-lookup"><span data-stu-id="37aa4-114">The displacement map sampler state can be set by the SetSamplerState(D3DDMAPSAMPLER, ...) API.</span></span>
-   <span data-ttu-id="37aa4-115">置換地圖材質是由 SetTexture (D3DDMAPSAMPLER、材質) API 所設定。</span><span class="sxs-lookup"><span data-stu-id="37aa4-115">The displacement map texture is set by the SetTexture(D3DDMAPSAMPLER, texture) API.</span></span>
-   <span data-ttu-id="37aa4-116">地圖可以預先取樣。</span><span class="sxs-lookup"><span data-stu-id="37aa4-116">The map can be pre-sampled or not.</span></span> <span data-ttu-id="37aa4-117">這表示可以用特定的方式來排序，而不需要篩選即可查閱置換值。</span><span class="sxs-lookup"><span data-stu-id="37aa4-117">This means that it can be ordered in a particular way that enables the lookup of the displacement values without filtering.</span></span>
-   <span data-ttu-id="37aa4-118">宣告結構中的變更允許用來查閱材質地圖的材質座標規格。</span><span class="sxs-lookup"><span data-stu-id="37aa4-118">The changes in the declaration structure allow the specification of the texture coordinate used to look up the texture map.</span></span> <span data-ttu-id="37aa4-119">例如，Stream0、Offset、FLOAT2、LOOKUP、位移 \_ 值。</span><span class="sxs-lookup"><span data-stu-id="37aa4-119">For example, Stream0, Offset, FLOAT2, LOOKUP, Displacement\_value.</span></span> <span data-ttu-id="37aa4-120">這會告訴鑲嵌在特定位移的 stream0 中，使用2D 浮點數向量作為材質座標，以查詢置換圖，並將置換 \_ 值使用方式的語法與它產生關聯。</span><span class="sxs-lookup"><span data-stu-id="37aa4-120">This tells the tessellator to use the 2D float vector in stream0 at a certain offset as a texture coordinate to look up the displacement map and associate the Displacement\_value usage semantic to it.</span></span> <span data-ttu-id="37aa4-121">頂點著色器宣告會包含類似于 {dcl \_ texture0，v0} 的行，指出 texture0 語義與 v0 輸入暫存器相關聯。</span><span class="sxs-lookup"><span data-stu-id="37aa4-121">The vertex shader declaration would contain a line similar to {dcl\_texture0, v0} indicating that the texture0 semantic is to be associated with the v0 input register.</span></span> <span data-ttu-id="37aa4-122">查閱的置換值會複製到輸入暫存器 v0 中。</span><span class="sxs-lookup"><span data-stu-id="37aa4-122">The displacement value looked up is copied into input register v0.</span></span>
-   <span data-ttu-id="37aa4-123">預先取樣紋理對應時，會有一種特殊的置換對應。</span><span class="sxs-lookup"><span data-stu-id="37aa4-123">There is a special type of displacement mapping, when the texture map is pre-sampled.</span></span> <span data-ttu-id="37aa4-124">產生之頂點的連續索引會當做材質圖的材質座標使用。</span><span class="sxs-lookup"><span data-stu-id="37aa4-124">Sequential index of generated vertices is used as a texture coordinate to a texture map.</span></span> <span data-ttu-id="37aa4-125">例如，0、0、 (D3DDECLTYPE) 0、D3DDECLMETHOD \_ LOOKUPPRESAMPLED、Usage、UsageIndex。</span><span class="sxs-lookup"><span data-stu-id="37aa4-125">For example, 0,0,(D3DDECLTYPE)0,D3DDECLMETHOD\_LOOKUPPRESAMPLED, Usage, UsageIndex.</span></span>
-   <span data-ttu-id="37aa4-126">查閱的輸出為4個浮點數。</span><span class="sxs-lookup"><span data-stu-id="37aa4-126">The output of the lookup is 4 floats.</span></span>
-   <span data-ttu-id="37aa4-127">只有 N 個修補程式才支援置換對應。</span><span class="sxs-lookup"><span data-stu-id="37aa4-127">Displacement mapping is supported only with N-patches.</span></span>
-   <span data-ttu-id="37aa4-128">如果驅動程式不處理置換對應，則必須忽略 SetTextureStageState 中的 D3DDMAPSAMPLER。</span><span class="sxs-lookup"><span data-stu-id="37aa4-128">Drivers need to ignore D3DDMAPSAMPLER in SetTextureStageState if they do not handle displacement maps.</span></span>
-   <span data-ttu-id="37aa4-129">\_不支援 D3DTEXF 的非等向篩選模式。</span><span class="sxs-lookup"><span data-stu-id="37aa4-129">D3DTEXF\_ANISOTROPIC filter mode is not supported.</span></span>
-   <span data-ttu-id="37aa4-130">當 \_ 置換地圖取樣器中的 D3DSAMP MIPFILTER 不是 D3DTEXF \_ NONE 時，會計算詳細資料層級，如下所示 (請注意，即使 D3DRS ENABLEADAPTIVETESSELLATION 為 FALSE) ，也會使用自動調整鑲嵌狀態 \_ ： Tmax = render state D3DRS  \_ MAXTESSELLATIONLEVEL</span><span class="sxs-lookup"><span data-stu-id="37aa4-130">When D3DSAMP\_MIPFILTER in the displacement map sampler is not D3DTEXF\_NONE, the level of detail is computed as follows (Note that the adaptive tessellation state is used even if the D3DRS\_ENABLEADAPTIVETESSELLATION is **FALSE**): Tmax = render state D3DRS\_MAXTESSELLATIONLEVEL</span></span>
-   <span data-ttu-id="37aa4-131">適用于頂點 Vi 的計算鑲嵌層級 Te： (Xi、Yi、Zi) 和「彈性鑲嵌」一節中所述的方式相同。</span><span class="sxs-lookup"><span data-stu-id="37aa4-131">Compute tessellation level Te for a vertex Vi: (Xi, Yi, Zi) the same way as described in the "Adaptive tessellation" section.</span></span> <span data-ttu-id="37aa4-132">詳細資料層級 L = log2 (Tmax) log2 (Te) 。</span><span class="sxs-lookup"><span data-stu-id="37aa4-132">Level of detail L = log2(Tmax) - log2 (Te).</span></span>
-   <span data-ttu-id="37aa4-133">材質篩選和取樣作業會遵循與圖元管線相同的規則， (詳細資料的層級 (」 LOD 套用) 偏差等 ) 。</span><span class="sxs-lookup"><span data-stu-id="37aa4-133">Texture filtering and sampling operations follow the same rules as the pixel pipeline (level of detail (LOD) bias is applied, etc.).</span></span>
-   <span data-ttu-id="37aa4-134">並非所有格式都可用來做為置換圖，但僅可支援 D3DUSAGE \_ DMAP。</span><span class="sxs-lookup"><span data-stu-id="37aa4-134">Not all formats can be used as displacement maps but only those that support the D3DUSAGE\_DMAP.</span></span> <span data-ttu-id="37aa4-135">應用程式可以使用 CheckDeviceFormat [**CheckDeviceFormat**](/windows/win32/api/d3d9/nf-d3d9-idirect3d9-checkdeviceformat)來查詢。</span><span class="sxs-lookup"><span data-stu-id="37aa4-135">The application can query that with the CheckDeviceFormat [**CheckDeviceFormat**](/windows/win32/api/d3d9/nf-d3d9-idirect3d9-checkdeviceformat).</span></span>
-   <span data-ttu-id="37aa4-136">您 \_ 必須在 [**CreateTexture**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createtexture) 中指定 D3DUSAGE DMAP，以通知驅動程式此材質將用作置換地圖。</span><span class="sxs-lookup"><span data-stu-id="37aa4-136">D3DUSAGE\_DMAP must be specified in [**CreateTexture**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createtexture) to notify the driver that this texture is to be used as a displacement map.</span></span>
-   <span data-ttu-id="37aa4-137">D3DUSAGE \_ DMAP 只能搭配紋理使用。</span><span class="sxs-lookup"><span data-stu-id="37aa4-137">D3DUSAGE\_DMAP can only be used with textures.</span></span> <span data-ttu-id="37aa4-138">它不能與 cube 對應或磁片區一起使用。</span><span class="sxs-lookup"><span data-stu-id="37aa4-138">It cannot be used with cube maps or volumes.</span></span>
-   <span data-ttu-id="37aa4-139">使用 D3DUSAGE DMAP 建立的材質和轉譯目標 \_ 可以設定為一般取樣器階段和轉譯目標。</span><span class="sxs-lookup"><span data-stu-id="37aa4-139">Textures and render targets created with D3DUSAGE\_DMAP can be set at regular sampler stages and as render targets.</span></span>
-   <span data-ttu-id="37aa4-140">用來設定材質座標換行模式的轉譯狀態，會在位移對應中忽略。</span><span class="sxs-lookup"><span data-stu-id="37aa4-140">The render states to set the wrap mode for the texture coordinates are ignored in displacement mapping.</span></span> <span data-ttu-id="37aa4-141">一般而言，鑲嵌引擎沒有換行模式。</span><span class="sxs-lookup"><span data-stu-id="37aa4-141">In general, there are no wrap modes for the tessellator engine.</span></span>
-   <span data-ttu-id="37aa4-142">置換圖取樣器的行為與圖元材質取樣器的行為相同。</span><span class="sxs-lookup"><span data-stu-id="37aa4-142">A displacement map sampler has behavior identical to that of the pixel texture samplers.</span></span> <span data-ttu-id="37aa4-143">如果查閱的材質小於四個通道 (例如 R32f) ，則查閱的值會移至目的地註冊的適當通道 (以範例語義) 標記的頂點著色器輸入暫存器 \_ ，而其他通道預設為 (1，1，1) 。</span><span class="sxs-lookup"><span data-stu-id="37aa4-143">If a texture with less than four channels (like R32f) is looked up, the looked-up values go to the appropriate channels of the destination register (the vertex shader input register tagged with the \_sample semantic), while the other channels default to (1, 1, 1).</span></span> <span data-ttu-id="37aa4-144">當查閱時，D3DFMT \_ 的 L8 會廣播到 R、G、B 通道，並將預設值設定為1。</span><span class="sxs-lookup"><span data-stu-id="37aa4-144">When looked up, D3DFMT\_L8 gets broadcast into the R, G, B channels and A defaults to 1.</span></span> <span data-ttu-id="37aa4-145">參考轉譯器具有完整的執行詳細資料。</span><span class="sxs-lookup"><span data-stu-id="37aa4-145">The reference rasterizer has the full implementation details.</span></span>

## <a name="pre-sampled-displacement-mapping"></a><span data-ttu-id="37aa4-146">預先取樣的置換對應</span><span class="sxs-lookup"><span data-stu-id="37aa4-146">Pre-Sampled Displacement Mapping</span></span>

-   <span data-ttu-id="37aa4-147">引進新的取樣器狀態： D3DSAMP \_ DMAPOFFSET (DWORD) -位移 (在預取樣的置換地圖中的頂點) 。</span><span class="sxs-lookup"><span data-stu-id="37aa4-147">New sampler state is introduced: D3DSAMP\_DMAPOFFSET (DWORD) - offset (in vertices) in a pre-sampled displacement map.</span></span>
-   <span data-ttu-id="37aa4-148">引進新的宣告方法： D3DDECLMETHOD \_ LOOKUPPRESAMPLED。</span><span class="sxs-lookup"><span data-stu-id="37aa4-148">New declaration method is introduced: D3DDECLMETHOD\_LOOKUPPRESAMPLED.</span></span>
-   <span data-ttu-id="37aa4-149">應停用調適型鑲嵌。</span><span class="sxs-lookup"><span data-stu-id="37aa4-149">Adaptive tessellation should be disabled.</span></span>
-   <span data-ttu-id="37aa4-150">材質篩選設定會被忽略。</span><span class="sxs-lookup"><span data-stu-id="37aa4-150">Texture filter settings are ignored.</span></span> <span data-ttu-id="37aa4-151">點取樣完成。</span><span class="sxs-lookup"><span data-stu-id="37aa4-151">Point sampling is done.</span></span> <span data-ttu-id="37aa4-152">Mip 材質篩選準則假設為 D3DTEXF \_ NONE。</span><span class="sxs-lookup"><span data-stu-id="37aa4-152">The mip texture filter is assumed to be D3DTEXF\_NONE.</span></span> <span data-ttu-id="37aa4-153">所有其他材質篩選模式都假設為 D3DTEXF \_ 點。</span><span class="sxs-lookup"><span data-stu-id="37aa4-153">All other texture filter modes are assumed to be D3DTEXF\_POINT.</span></span>
-   <span data-ttu-id="37aa4-154">紋理座標的計算方式為： U = (Index% TextureWidthInPixeles) / (float)  (TextureWidthInPixeles) V = (Index/TextureWidthInPixeles) / (float)  (TextureHeightInPixeles) 其中 Index 是產生的頂點加上 TSS D3DSAMP DMAPOFFSET 的連續索引 \[ \_ \] 。</span><span class="sxs-lookup"><span data-stu-id="37aa4-154">Texture coordinates are computed as: U = (Index % TextureWidthInPixeles) / (float)(TextureWidthInPixeles) V = (Index / TextureWidthInPixeles) / (float)(TextureHeightInPixeles) where Index is a sequential index of generated vertices plus TSS\[D3DSAMP\_DMAPOFFSET\].</span></span> <span data-ttu-id="37aa4-155">在每個基本的開頭，順序索引會設定為零，並在產生頂點之後增加。</span><span class="sxs-lookup"><span data-stu-id="37aa4-155">The sequential index is set to zero at the start of each primitive and is increased after a vertex is generated.</span></span>

<span data-ttu-id="37aa4-156">這些是支援置換對應的 API 變更。</span><span class="sxs-lookup"><span data-stu-id="37aa4-156">These are the API changes that support displacement mapping.</span></span>

-   <span data-ttu-id="37aa4-157">已新增單一通道格式，D3DFMT \_ l16 也。</span><span class="sxs-lookup"><span data-stu-id="37aa4-157">A single channel format added, D3DFMT\_L16.</span></span>
-   <span data-ttu-id="37aa4-158">新的使用旗標，D3DUSAGE \_ DMAP。</span><span class="sxs-lookup"><span data-stu-id="37aa4-158">A new usage flag, D3DUSAGE\_DMAP.</span></span>
-   <span data-ttu-id="37aa4-159">用來設定置換地圖材質（D3DDMAPSAMPLER）的特殊材質階段。</span><span class="sxs-lookup"><span data-stu-id="37aa4-159">A special texture stage, used to set a displacement map texture, D3DDMAPSAMPLER.</span></span>
-   <span data-ttu-id="37aa4-160">已新增硬體 cap，D3DDEVCAPS2 \_ DMAPNPATCH 和 D3DDEVCAPS2 \_ PRESAMPLEDDMAPNPATCH。</span><span class="sxs-lookup"><span data-stu-id="37aa4-160">New hardware caps have been added, D3DDEVCAPS2\_DMAPNPATCH and D3DDEVCAPS2\_PRESAMPLEDDMAPNPATCH.</span></span> <span data-ttu-id="37aa4-161">請參閱 [D3DDEVCAPS2](d3ddevcaps2.md)。</span><span class="sxs-lookup"><span data-stu-id="37aa4-161">See [D3DDEVCAPS2](d3ddevcaps2.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="37aa4-162">相關主題</span><span class="sxs-lookup"><span data-stu-id="37aa4-162">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="37aa4-163">頂點管線</span><span class="sxs-lookup"><span data-stu-id="37aa4-163">Vertex Pipeline</span></span>](vertex-pipeline.md)
</dt> </dl>

 

 
