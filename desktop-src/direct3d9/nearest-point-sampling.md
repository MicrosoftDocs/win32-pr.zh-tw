---
description: 使用紋理篩選不需要應用程式。
ms.assetid: bba0e485-ac5a-4e43-9eb7-25cd0c90d316
title: Nearest-Point (Direct3D 9) 的取樣
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b11cf98ee917b124b35f3c30ff263365ec3c46e1
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/06/2021
ms.locfileid: "104385689"
---
# <a name="nearest-point-sampling-direct3d-9"></a><span data-ttu-id="4cfcd-103">Nearest-Point (Direct3D 9) 的取樣</span><span class="sxs-lookup"><span data-stu-id="4cfcd-103">Nearest-Point Sampling (Direct3D 9)</span></span>

<span data-ttu-id="4cfcd-104">使用紋理篩選不需要應用程式。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-104">Applications are not required to use texture filtering.</span></span> <span data-ttu-id="4cfcd-105">可設定 Direct3D 讓它計算紋素位址，其通常不評估整數，並以最接近的整數位址複製紋素色彩。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-105">Direct3D can be set so that it computes the texel address, which often does not evaluate to integers, and copies the color of the texel with the closest integer address.</span></span> <span data-ttu-id="4cfcd-106">這個過程稱作最近點取樣。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-106">This process is called nearest-point sampling.</span></span> <span data-ttu-id="4cfcd-107">如果材質的大小與螢幕上基本影像的大小類似，這可以是快速且有效率的材質處理方式。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-107">This can be a fast and efficient way to process textures if the size of the texture is similar to the size of the primitive's image on the screen.</span></span> <span data-ttu-id="4cfcd-108">若非如此，則必須放大或縮小紋理。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-108">If not, the texture must be magnified or minified.</span></span> <span data-ttu-id="4cfcd-109">結果可以是大量、別名或模糊的影像。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-109">The result can be a chunky, aliased, or blurred image.</span></span>

<span data-ttu-id="4cfcd-110">您的 c + + 應用程式可以藉由呼叫 [**IDirect3DDevice9：： SetSamplerState**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-setsamplerstate) 方法，來選取最接近點的取樣。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-110">Your C++ application can select nearest-point sampling by calling the [**IDirect3DDevice9::SetSamplerState**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-setsamplerstate) method.</span></span> <span data-ttu-id="4cfcd-111">將第一個參數的值設定為您要選取材質篩選方法之材質 (0-7) 的整數索引編號。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-111">Set the value of the first parameter to the integer index number (0-7) of the texture for which you are selecting a texture filtering method.</span></span> <span data-ttu-id="4cfcd-112">\_ \_ 針對第二個參數傳遞 D3DSAMP MAGFILTER、D3DSAMP MINFILTER 或 D3DSAMP \_ MIPFILTER，以設定放大、縮制或 mipmap 篩選。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-112">Pass D3DSAMP\_MAGFILTER, D3DSAMP\_MINFILTER, or D3DSAMP\_MIPFILTER for the second parameter to set the magnification, minification, or mipmapping filter.</span></span> <span data-ttu-id="4cfcd-113">\_在第三個參數中傳遞 D3DTEXF 點。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-113">Pass D3DTEXF\_POINT in the third parameter.</span></span>

<span data-ttu-id="4cfcd-114">您應該小心使用最接近的點取樣，因為在兩個材質之間的界限上取樣材質時，有時可能會導致圖形構件。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-114">You should use nearest-point sampling carefully, because it can sometimes cause graphic artifacts when the texture is sampled at the boundary between two texels.</span></span> <span data-ttu-id="4cfcd-115">這個邊界是沿著紋理 (u or v) 的定位，取樣的紋素在此位置從一個紋素轉換到下一個紋素。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-115">This boundary is the position along the texture (u or v) at which the sampled texel transitions from one texel to the next.</span></span> <span data-ttu-id="4cfcd-116">使用點取樣時，系統會選擇一個樣本紋素或另一個樣本紋素，而且當跨越邊界時，結果會突然從一個紋素突然變換到下一個紋素。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-116">When point sampling is used, the system chooses one sample texel or the other, and the result can change abruptly from one texel to the next texel as the boundary is crossed.</span></span> <span data-ttu-id="4cfcd-117">這個效果會以不想要的圖形假性影像出現在顯示的紋理中。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-117">This effect can appear as undesired graphic artifacts in the displayed texture.</span></span> <span data-ttu-id="4cfcd-118">使用線性篩選功能時，所產生的紋素會從這兩個相鄰紋素計算，並在紋理指數穿過邊界時，平順地進行混合。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-118">When linear filtering is used, the resulting texel is computed from both adjacent texels and smoothly blends between them as the texture index moves through the boundary.</span></span>

<span data-ttu-id="4cfcd-119">當對應非常小的紋理到非常大的多邊形時，就可以看到這個效果︰通常稱為縮放比例。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-119">This effect can be seen when mapping a very small texture onto a very large polygon: an operation often called magnification.</span></span> <span data-ttu-id="4cfcd-120">例如，當使用看起來像棋盤的紋理，最接近點取樣就會導致較大棋盤顯示不同的邊緣。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-120">For example, when using a texture that looks like a checkerboard, nearest-point sampling results in a larger checkerboard that shows distinct edges.</span></span> <span data-ttu-id="4cfcd-121">相對地，線性紋理篩選所產生的影像中，棋盤色彩會在多邊形上平順地變化。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-121">By contrast, linear texture filtering results in an image where the checkerboard colors vary smoothly across the polygon.</span></span>

<span data-ttu-id="4cfcd-122">在大部分情況，應用程式會盡可能避免最接近點取樣，以獲得最佳結果。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-122">In most cases, applications receive the best results by avoiding nearest-point sample wherever possible.</span></span> <span data-ttu-id="4cfcd-123">現今絕大部分的硬體會針對線形篩選做最佳化，使您的應用程式效能不會降低。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-123">The majority of hardware today is optimized for linear filtering, so your application should not suffer degraded performance.</span></span> <span data-ttu-id="4cfcd-124">如果您想要的效果非常需要使用最接近點取樣 (例如當使用紋理顯示可讀取的文字字元時)，那麼您的應用程式應非常小心避免在紋理邊界取樣，否則可能產生不想要的效果。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-124">If the effect you desire absolutely requires the use of the nearest-point sampling - such as when using textures to display readable text characters - then your application should be extremely careful to avoid sampling at the texel boundaries, which might result in undesired effects.</span></span> <span data-ttu-id="4cfcd-125">下圖顯示這些假性影像的外觀。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-125">The following illustration shows what these artifacts can look like.</span></span>

![在右上角的兩個方形中，有具不連續水平線的六分段方塊的圖例](images/ptrtfct.png)

<span data-ttu-id="4cfcd-127">請注意，群組右上角的兩個方塊與其鄰近專案的顯示方式不同，而對角線位移會透過它們來執行。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-127">Notice that the two squares in the upper right of the group appear different than their neighbors, with diagonal offsets running through them.</span></span> <span data-ttu-id="4cfcd-128">若要避免類似的圖形假性影像，您必須熟悉最接近點篩選的 Direct3D 紋理取樣規則。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-128">To avoid graphic artifacts like these, you must be familiar with Direct3D texture sampling rules for nearest-point filtering.</span></span> <span data-ttu-id="4cfcd-129">Direct3D 會將浮點材質座標（範圍從 \[ 0.0、1.0 \] (0.0）對應至1.0，內含) 至整數材質空間值（範圍從 \[ -0.5，n-0.5 \] ），其中 n 是在紋理上給定維度中的材質數目。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-129">Direct3D maps a floating-point texture coordinate ranging from \[0.0, 1.0\] (0.0 to 1.0, inclusive) to an integer texel space value ranging from \[ - 0.5, n - 0.5\], where n is the number of texels in a given dimension on the texture.</span></span> <span data-ttu-id="4cfcd-130">捨入到最近整數的結果紋理指數。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-130">The resulting texture index is rounded to the nearest integer.</span></span> <span data-ttu-id="4cfcd-131">這項對應可能導致紋素邊界取樣失準。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-131">This mapping can introduce sampling inaccuracies at texel boundaries.</span></span>

<span data-ttu-id="4cfcd-132">如需簡單的範例，請想像以 D3DTADDRESS \_ WRAP 材質定址模式呈現多邊形的應用程式。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-132">For a simple example, imagine an application that renders polygons with the D3DTADDRESS\_WRAP texture addressing mode.</span></span> <span data-ttu-id="4cfcd-133">使用 Direct3D 所使用的對應，u 紋理指數對應如下圖所示之寬度為 4 紋素的紋理。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-133">Using the mapping employed by Direct3D, the u texture index maps as show in the following diagram for a texture with a width of 4 texels.</span></span>

![紋理座標 0.0 和 1.0 於紋素之間邊界的圖表](images/ptsmpprb.png)

<span data-ttu-id="4cfcd-135">請注意，此圖的材質座標（0.0 和1.0）正好在材質之間的界限上。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-135">Notice that the texture coordinates, 0.0 and 1.0 for this illustration, are exactly at the boundary between texels.</span></span> <span data-ttu-id="4cfcd-136">使用 Direct3D 對應值的方法，紋理座標的範圍為 \[ -0.5，4-0.5 \] ，其中4是材質的寬度。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-136">Using the method by which Direct3D maps values, the texture coordinates range from \[ - 0.5, 4 - 0.5\], where 4 is the width of the texture.</span></span> <span data-ttu-id="4cfcd-137">對於這種情形，針對紋理指數 1.0，取樣的紋素是 0。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-137">For this case, the sampled texel is the 0 texel for a texture index of 1.0.</span></span> <span data-ttu-id="4cfcd-138">不過，如果紋理座標只是稍微小於 1.0，取樣的紋素會是 n 紋素，而不是 0 紋素。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-138">However, if the texture coordinate was only slightly less than 1.0, the sampled texel would be the n texel instead of the 0 texel.</span></span>

<span data-ttu-id="4cfcd-139">這個的含義是，使用紋理座標正好為 0.0 和 1.0 放大小紋理，螢幕空間對齊三角形的最接近點篩選，針對產生的像素在紋素之間邊界取樣紋理對應。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-139">The implication of this is that magnifying a small texture using texture coordinates of exactly 0.0 and 1.0 with nearest-point filtering on a screen-space aligned triangle results in pixels for which the texture map is sampled at the boundary between texels.</span></span> <span data-ttu-id="4cfcd-140">任何紋理座標的不正確計算，不論多小的錯誤，都會在呈現影像中 (對應紋理圖的紋素邊緣) 產生假性影像。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-140">Any inaccuracies in the computation of texture coordinates, however small, results in artifacts along the areas in the rendered image which correspond to the texel edges of the texture map.</span></span>

<span data-ttu-id="4cfcd-141">要完全精準地執行此對應的浮點紋理座標至整數紋素並不容易，運算起來很花時間，而且通常不需要。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-141">Performing this mapping of floating point texture coordinates to integer texels with perfect accuracy is difficult, computationally time-consuming, and generally not necessary.</span></span> <span data-ttu-id="4cfcd-142">大部分硬體實作在三角形內每個像素位置使用運算紋理座標的反覆式方法。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-142">Most hardware implementations use an iterative approach for computing texture coordinates at each pixel location within a triangle.</span></span> <span data-ttu-id="4cfcd-143">反覆式方法通常會隱藏這些錯誤，因為錯誤會在反覆運算中平均地累積。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-143">Iterative approaches tend to hide these inaccuracies because the errors are accumulated evenly during iteration.</span></span>

<span data-ttu-id="4cfcd-144">Direct3D 軟體模擬轉譯器使用直接評估方法，在每個像素位置運算紋理指數。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-144">The Direct3D reference rasterizer uses a direct-evaluation approach for computing texture indexes at each pixel location.</span></span> <span data-ttu-id="4cfcd-145">直接評估不同於反覆式方法，操作中任何不準確會更加隨機顯示錯誤散發。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-145">Direct evaluation differs from the iterative approach in that any inaccuracy in the operation exhibits a more random error distribution.</span></span> <span data-ttu-id="4cfcd-146">此結果是在邊界發生的取樣錯誤會更明顯，因為 Direct3D 軟體模擬轉譯器未準確地執行此作業。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-146">The result of this is that the sampling errors that occur at the boundaries can be more noticeable because the reference rasterizer does not perform this operation with perfect accuracy.</span></span>

<span data-ttu-id="4cfcd-147">最好的方法是只在需要時使用最接近點篩選。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-147">The best approach is to use nearest-point filtering only when necessary.</span></span> <span data-ttu-id="4cfcd-148">當您必須使用它時，建議您將紋理座標稍微從邊界位置偏移，以避免造成假性影像。</span><span class="sxs-lookup"><span data-stu-id="4cfcd-148">When you must use it, it is recommended that you offset texture coordinates slightly from the boundary positions to avoid artifacts.</span></span>

## <a name="related-topics"></a><span data-ttu-id="4cfcd-149">相關主題</span><span class="sxs-lookup"><span data-stu-id="4cfcd-149">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="4cfcd-150">材質篩選</span><span class="sxs-lookup"><span data-stu-id="4cfcd-150">Texture Filtering</span></span>](texture-filtering.md)
</dt> </dl>

 

 
