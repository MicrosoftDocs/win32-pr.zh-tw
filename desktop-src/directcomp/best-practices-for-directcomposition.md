---
title: DirectComposition 的最佳作法
description: 本主題說明使用 Microsoft DirectComposition 的最佳作法。
ms.assetid: D3A1ECD4-9358-44B9-8A84-7D901219D5CD
keywords:
- DirectComposition 的最佳作法
- DirectComposition 的建議做法
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2f0d19b82b188105c7914e89282c08b12dd4bdc4
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/20/2020
ms.locfileid: "103683007"
---
# <a name="best-practices-for-directcomposition"></a><span data-ttu-id="c485b-105">DirectComposition 的最佳作法</span><span class="sxs-lookup"><span data-stu-id="c485b-105">Best practices for DirectComposition</span></span>

> [!NOTE]
> <span data-ttu-id="c485b-106">針對 Windows 10 上的應用程式，我們建議使用 DirectComposition，而不是使用。</span><span class="sxs-lookup"><span data-stu-id="c485b-106">For apps on Windows 10, we recommend using Windows.UI.Composition APIs instead of DirectComposition.</span></span> <span data-ttu-id="c485b-107">如需詳細資訊，請參閱 [使用視覺分層將您的桌面應用程式現代化](/windows/uwp/composition/visual-layer-in-desktop-apps)。</span><span class="sxs-lookup"><span data-stu-id="c485b-107">For more info, see [Modernize your desktop app using the Visual layer](/windows/uwp/composition/visual-layer-in-desktop-apps).</span></span>

<span data-ttu-id="c485b-108">本主題說明使用 Microsoft DirectComposition 的最佳作法。</span><span class="sxs-lookup"><span data-stu-id="c485b-108">This topic describes best practices for using Microsoft DirectComposition.</span></span>

-   [<span data-ttu-id="c485b-109">最佳做法</span><span class="sxs-lookup"><span data-stu-id="c485b-109">Best practices</span></span>](#best-practices-for-directcomposition)
-   [<span data-ttu-id="c485b-110">安全性考量</span><span class="sxs-lookup"><span data-stu-id="c485b-110">Security considerations</span></span>](#security-considerations)
-   [<span data-ttu-id="c485b-111">相關主題</span><span class="sxs-lookup"><span data-stu-id="c485b-111">Related topics</span></span>](#related-topics)

## <a name="best-practices"></a><span data-ttu-id="c485b-112">最佳作法</span><span class="sxs-lookup"><span data-stu-id="c485b-112">Best practices</span></span>

<span data-ttu-id="c485b-113">下表提供使用 Microsoft DirectComposition 視覺效果的建議作法。</span><span class="sxs-lookup"><span data-stu-id="c485b-113">The following table presents the practices recommended for working with Microsoft DirectComposition visuals.</span></span>



| <span data-ttu-id="c485b-114">作法</span><span class="sxs-lookup"><span data-stu-id="c485b-114">Practice</span></span>                                                                                                                                                                                                                                                        | <span data-ttu-id="c485b-115">Description</span><span class="sxs-lookup"><span data-stu-id="c485b-115">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="c485b-116">建立 DirectComposition 裝置之後，請呼叫 [**IDCompositionDevice：： CheckDeviceState**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-checkdevicestate) 方法以回應每個 [**WM \_ 油漆**](/windows/desktop/gdi/wm-paint) 訊息，以確保裝置仍然有效。</span><span class="sxs-lookup"><span data-stu-id="c485b-116">After creating a DirectComposition device, call the [**IDCompositionDevice::CheckDeviceState**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-checkdevicestate) method in response to each [**WM\_PAINT**](/windows/desktop/gdi/wm-paint) message to ensure that the device is still valid.</span></span><br/> | <span data-ttu-id="c485b-117">如果 Microsoft DirectX Graphic Infrastructure (DXGI) 裝置遺失，與 DXGI 裝置相關聯的 DirectComposition 裝置也會遺失。</span><span class="sxs-lookup"><span data-stu-id="c485b-117">If the Microsoft DirectX Graphics Infrastructure (DXGI) device is lost, the DirectComposition device associated with the DXGI device is also lost.</span></span> <span data-ttu-id="c485b-118">當偵測到遺失的裝置時，DirectComposition 會將 [**WM \_ 油漆**](/windows/desktop/gdi/wm-paint) 訊息傳送到所有視窗。</span><span class="sxs-lookup"><span data-stu-id="c485b-118">When it detects a lost device, DirectComposition sends the [**WM\_PAINT**](/windows/desktop/gdi/wm-paint) message to all windows.</span></span> <span data-ttu-id="c485b-119">呼叫 [**CheckDeviceState**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-checkdevicestate) 以回應每個 **WM \_ 油漆** 訊息，可讓您判斷 DirectComposition 裝置物件是否仍然有效，如果不是，則採取步驟來復原內容。</span><span class="sxs-lookup"><span data-stu-id="c485b-119">Calling [**CheckDeviceState**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-checkdevicestate) in response to each **WM\_PAINT** message lets you determine whether the DirectComposition device object is still valid and, if not, take steps to recover content.</span></span> <br/> <span data-ttu-id="c485b-120">如需詳細資訊，請參閱 [裝置物件](basic-concepts.md)。</span><span class="sxs-lookup"><span data-stu-id="c485b-120">For more information, see [Device object](basic-concepts.md).</span></span><br/> |
| <span data-ttu-id="c485b-121">只建立組合或動畫所需的視覺效果數目，並在 DirectComposition 完成使用後立即終結視覺效果。</span><span class="sxs-lookup"><span data-stu-id="c485b-121">Create only the number of visuals needed for a composition or animation, and destroy the visuals immediately after DirectComposition finishes using them.</span></span><br/>                                                                                            | <span data-ttu-id="c485b-122">DirectComposition 使用圖形處理器 (GPU) ，也就是您的應用程式與其他應用程式和作業系統共用的資源。</span><span class="sxs-lookup"><span data-stu-id="c485b-122">DirectComposition uses the graphics processing unit (GPU), a resource that your application shares with other applications and the operating system.</span></span> <span data-ttu-id="c485b-123">這種作法可確保所有應用程式和作業系統都會收到足夠的 GPU 資源。</span><span class="sxs-lookup"><span data-stu-id="c485b-123">This practice ensures that all applications and the operating system receive adequate GPU resources.</span></span><br/> <span data-ttu-id="c485b-124">如需詳細資訊，請參閱 [視覺效果](basic-concepts.md)。</span><span class="sxs-lookup"><span data-stu-id="c485b-124">For more information, see [Visuals](basic-concepts.md).</span></span><br/>                                                                                                                                                                                                                                                                     |
| <span data-ttu-id="c485b-125">請勿將透明度設為0% 來隱藏視覺效果;相反地，請從視覺化樹狀結構移除視覺效果。</span><span class="sxs-lookup"><span data-stu-id="c485b-125">Do not hide visuals by setting opacity to 0%; instead, remove visuals from the visual tree.</span></span><br/>                                                                                                                                                          | <span data-ttu-id="c485b-126">將不透明度設定為0% 需要的系統資源比從視覺化樹狀結構中移除更多。</span><span class="sxs-lookup"><span data-stu-id="c485b-126">Setting opacity to 0% requires more system resources than removing them from the visual tree.</span></span><br/> <span data-ttu-id="c485b-127">如需詳細資訊，請參閱 [不透明度](effects.md) 和 [視覺化樹狀結構](basic-concepts.md)。</span><span class="sxs-lookup"><span data-stu-id="c485b-127">For more information, see [Opacity](effects.md) and [Visual tree](basic-concepts.md).</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                      |
| <span data-ttu-id="c485b-128">請勿將空白 (零大小的空白) 裁剪矩形套用至視覺效果，以隱藏視覺效果。</span><span class="sxs-lookup"><span data-stu-id="c485b-128">Do not hide a visual by applying an empty (zero sized) clip rectangle to a visual.</span></span> <span data-ttu-id="c485b-129">請改為從視覺化樹狀結構移除視覺效果。</span><span class="sxs-lookup"><span data-stu-id="c485b-129">Instead, remove the visual from the visual tree.</span></span> <br/>                                                                                                                 | <span data-ttu-id="c485b-130">從視覺化樹狀結構移除視覺效果，可提供比套用空白剪輯矩形更好的效能。</span><span class="sxs-lookup"><span data-stu-id="c485b-130">Removing a visual from the visual tree results in better performance than applying an empty clip rectangle.</span></span><br/> <span data-ttu-id="c485b-131">如需詳細資訊，請參閱 [裁剪](clipping.md)。</span><span class="sxs-lookup"><span data-stu-id="c485b-131">For more information, see [Clipping](clipping.md).</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                |
| <span data-ttu-id="c485b-132">如果不需要剪切矩形，例如包含視覺效果整個點陣圖內容的剪輯矩形，請勿將剪輯矩形套用至視覺效果。</span><span class="sxs-lookup"><span data-stu-id="c485b-132">Do not apply a clip rectangle to a visual if the clip rectangle is not needed, such as a clip rectangle that includes the entire bitmap content of the visual.</span></span><br/>                                                                                       | <span data-ttu-id="c485b-133">不必要的剪輯矩形會危害系統效能。</span><span class="sxs-lookup"><span data-stu-id="c485b-133">Unnecessary clip rectangles harm system performance.</span></span><br/> <span data-ttu-id="c485b-134">如需詳細資訊，請參閱 [裁剪](clipping.md)。</span><span class="sxs-lookup"><span data-stu-id="c485b-134">For more information, see [Clipping](clipping.md).</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| <span data-ttu-id="c485b-135">如果您需要大型的單一色彩點陣圖，請建立較小的點陣圖介面，然後套用尺規轉換，而不是建立完整大小的表面。</span><span class="sxs-lookup"><span data-stu-id="c485b-135">If you need a large, single-color bitmap, create a smaller bitmap surface and then apply a scale transform instead of creating a full-sized surface.</span></span> <br/>                                                                                                | <span data-ttu-id="c485b-136">將縮放轉換套用至較小的介面時，所使用的系統資源比全尺寸介面少。</span><span class="sxs-lookup"><span data-stu-id="c485b-136">Applying a scale transform to a smaller surface is uses fewer system resources than a full-size surface.</span></span><br/> <span data-ttu-id="c485b-137">如需詳細資訊，請參閱 [點陣圖物件](bitmap-surfaces.md) 和 [轉換](transforms.md)。</span><span class="sxs-lookup"><span data-stu-id="c485b-137">For more information, see [Bitmap objects](bitmap-surfaces.md) and [Transforms](transforms.md).</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                     |
| <span data-ttu-id="c485b-138">避免將3D 轉換套用至視覺化樹狀結構的多個層級，例如父代及其子代 (s) 。</span><span class="sxs-lookup"><span data-stu-id="c485b-138">Avoid applying 3D transforms to multiple levels of a visual tree, such as to a parent and its descendent(s).</span></span> <br/>                                                                                                                                        | <span data-ttu-id="c485b-139">將3D 轉換套用至視覺化樹狀結構的多個層級可能會產生非預期的結果，因為3D 轉換不會在樹狀結構中相乘。</span><span class="sxs-lookup"><span data-stu-id="c485b-139">Applying 3D transforms to multiple levels of a visual tree can produce unintended results because 3D transformations are not multiplied out in the tree.</span></span> <span data-ttu-id="c485b-140">例如，在子系上 y 軸的90度旋轉，以及圍繞父代 y 軸的90度旋轉，會導致兩個視覺效果都旋轉到 nothing。</span><span class="sxs-lookup"><span data-stu-id="c485b-140">For example, a 90 degree rotation around the y-axis on a child, and a  90 degree rotation around the y-axis on a parent, results in both visuals being rotated away to nothing.</span></span><br/> <span data-ttu-id="c485b-141">如需詳細資訊，請參閱[效果](effects.md)。</span><span class="sxs-lookup"><span data-stu-id="c485b-141">For more information, see [Effects](effects.md).</span></span><br/>                                                                                                                                                                                                     |



 

## <a name="security-considerations"></a><span data-ttu-id="c485b-142">安全性考量</span><span class="sxs-lookup"><span data-stu-id="c485b-142">Security considerations</span></span>

<span data-ttu-id="c485b-143">下列文章提供撰寫安全 c + + 程式碼的指引。</span><span class="sxs-lookup"><span data-stu-id="c485b-143">The following articles provide guidance for writing secure C++ code.</span></span>

-   [<span data-ttu-id="c485b-144">C + + 的安全性最佳作法</span><span class="sxs-lookup"><span data-stu-id="c485b-144">Security Best Practices for C++</span></span>](/cpp/security/security-best-practices-for-cpp?view=vs-2019)
-   <span data-ttu-id="c485b-145">[適用于應用程式的模式 & 實務安全性指引](/previous-versions/msp-n-p/ff650760(v=pandp.10))</span><span class="sxs-lookup"><span data-stu-id="c485b-145">[Patterns & Practices Security Guidance for Applications](/previous-versions/msp-n-p/ff650760(v=pandp.10))</span></span>

## <a name="related-topics"></a><span data-ttu-id="c485b-146">相關主題</span><span class="sxs-lookup"><span data-stu-id="c485b-146">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="c485b-147">如何使用 DirectComposition</span><span class="sxs-lookup"><span data-stu-id="c485b-147">How to Use DirectComposition</span></span>](how-to-use-directcomposition.md)
</dt> </dl>

 

