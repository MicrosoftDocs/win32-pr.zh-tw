---
title: " (DirectComposition 的基本概念) "
description: 本主題概要說明 Microsoft DirectComposition 的基本概念。
ms.assetid: F442BDCA-C913-4438-BFFA-D3F28B68EE85
keywords:
- DirectComposition 概念
- DirectComposition 基本概念
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0550dc12cb0dcc5262701658d8e3883ee1ce8d82
ms.sourcegitcommit: 73417d55867c804274a55abe5ca71bcba7006119
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/20/2020
ms.locfileid: "104565485"
---
# <a name="basic-concepts"></a><span data-ttu-id="699a9-105">基本概念</span><span class="sxs-lookup"><span data-stu-id="699a9-105">Basic concepts</span></span>

> [!NOTE]
> <span data-ttu-id="699a9-106">針對 Windows 10 上的應用程式，我們建議使用 DirectComposition，而不是使用。</span><span class="sxs-lookup"><span data-stu-id="699a9-106">For apps on Windows 10, we recommend using Windows.UI.Composition APIs instead of DirectComposition.</span></span> <span data-ttu-id="699a9-107">如需詳細資訊，請參閱 [使用視覺分層將您的桌面應用程式現代化](/windows/uwp/composition/visual-layer-in-desktop-apps)。</span><span class="sxs-lookup"><span data-stu-id="699a9-107">For more info, see [Modernize your desktop app using the Visual layer](/windows/uwp/composition/visual-layer-in-desktop-apps).</span></span>

<span data-ttu-id="699a9-108">本主題概要說明 Microsoft DirectComposition 的基本概念。</span><span class="sxs-lookup"><span data-stu-id="699a9-108">This topic provides an overview of the basic concepts of Microsoft DirectComposition.</span></span> <span data-ttu-id="699a9-109">它包含下列區段：</span><span class="sxs-lookup"><span data-stu-id="699a9-109">It contains the following sections:</span></span>

-   [<span data-ttu-id="699a9-110">Composition</span><span class="sxs-lookup"><span data-stu-id="699a9-110">Composition</span></span>](#composition-target-window)
-   [<span data-ttu-id="699a9-111">視覺效果</span><span class="sxs-lookup"><span data-stu-id="699a9-111">Visuals</span></span>](#visuals)
    -   [<span data-ttu-id="699a9-112">視覺化樹狀結構</span><span class="sxs-lookup"><span data-stu-id="699a9-112">Visual tree</span></span>](#visual-tree)
    -   [<span data-ttu-id="699a9-113">視覺物件的屬性</span><span class="sxs-lookup"><span data-stu-id="699a9-113">Properties of a visual object</span></span>](#properties-of-a-visual-object)
-   [<span data-ttu-id="699a9-114">裝置物件</span><span class="sxs-lookup"><span data-stu-id="699a9-114">Device object</span></span>](#device-object)
-   [<span data-ttu-id="699a9-115">撰寫目標視窗</span><span class="sxs-lookup"><span data-stu-id="699a9-115">Composition target window</span></span>](#composition-target-window)
-   [<span data-ttu-id="699a9-116">交易式撰寫</span><span class="sxs-lookup"><span data-stu-id="699a9-116">Transactional composition</span></span>](#transactional-composition)
    -   [<span data-ttu-id="699a9-117">批次處理</span><span class="sxs-lookup"><span data-stu-id="699a9-117">Batching</span></span>](#batching)
    -   [<span data-ttu-id="699a9-118">同步處理</span><span class="sxs-lookup"><span data-stu-id="699a9-118">Synchronization</span></span>](#synchronization)
    -   [<span data-ttu-id="699a9-119">跨裝置的視覺化樹狀結構</span><span class="sxs-lookup"><span data-stu-id="699a9-119">Cross-device visual trees</span></span>](#cross-device-visual-trees)
-   [<span data-ttu-id="699a9-120">相關主題</span><span class="sxs-lookup"><span data-stu-id="699a9-120">Related topics</span></span>](#related-topics)

## <a name="composition"></a><span data-ttu-id="699a9-121">Composition</span><span class="sxs-lookup"><span data-stu-id="699a9-121">Composition</span></span>

<span data-ttu-id="699a9-122">DirectComposition 會將 *組合* 定義為點陣圖的集合，這些點陣圖會透過套用各種轉換、效果和動畫來產生應用程式 UI 中的視覺效果結果來結合和操作。</span><span class="sxs-lookup"><span data-stu-id="699a9-122">DirectComposition defines a *composition* as a collection of bitmaps that are combined and manipulated by applying various transforms, effects, and animations to produce a visual result in an application UI.</span></span> <span data-ttu-id="699a9-123">DirectComposition 僅適用于點陣圖內容;它不支援向量或文字。</span><span class="sxs-lookup"><span data-stu-id="699a9-123">DirectComposition works with bitmap content only; it does not support vectors or text.</span></span> <span data-ttu-id="699a9-124">DirectComposition 不提供點陣圖內容。</span><span class="sxs-lookup"><span data-stu-id="699a9-124">DirectComposition does not provide bitmap content.</span></span> <span data-ttu-id="699a9-125">相反地，它會提供可讓使用者使用 D2D、DXGI 或上傳自己的材質內容來繪製的介面。</span><span class="sxs-lookup"><span data-stu-id="699a9-125">Instead it provides interfaces in which users can draw with D2D, DXGI, or upload their own texture content.</span></span>

<span data-ttu-id="699a9-126">DirectComposition 應用程式會建立兩組物件來組成場景：組合在一起的點陣圖，以及定義點陣圖之間空間關聯性的視覺效果。</span><span class="sxs-lookup"><span data-stu-id="699a9-126">A DirectComposition application creates two sets of objects to compose a scene: bitmaps that are composed together, and visuals that define the spatial relationships among the bitmaps.</span></span> <span data-ttu-id="699a9-127">如需 DirectComposition 所支援點陣圖物件的詳細資訊，請參閱 [點陣圖物件](bitmap-surfaces.md)。</span><span class="sxs-lookup"><span data-stu-id="699a9-127">For more information about the bitmap objects supported by DirectComposition, see [Bitmap objects](bitmap-surfaces.md).</span></span>

## <a name="visuals"></a><span data-ttu-id="699a9-128">視覺效果</span><span class="sxs-lookup"><span data-stu-id="699a9-128">Visuals</span></span>

<span data-ttu-id="699a9-129">*視覺效果* (或 *視覺物件*) 是 DirectComposition 的基本元素。</span><span class="sxs-lookup"><span data-stu-id="699a9-129">*Visuals* (or *visual objects*) are the fundamental elements of DirectComposition.</span></span> <span data-ttu-id="699a9-130">它們是您用來在應用程式 UI 中建立組合和動畫的基本組建區塊。</span><span class="sxs-lookup"><span data-stu-id="699a9-130">They are the basic building blocks that you use to create compositions and animations in your application UI.</span></span>

<span data-ttu-id="699a9-131">在程式設計術語中，視覺效果是具有一組屬性的物件，並公開用來設定屬性值的介面。</span><span class="sxs-lookup"><span data-stu-id="699a9-131">In programming terms, a visual is an object that has a set of properties, and exposes an interface that you use to set the value of the properties.</span></span> <span data-ttu-id="699a9-132">視覺效果的 [內容] 屬性會將特定點陣圖與視覺效果建立關聯，而其他屬性則會控制 DirectComposition 在轉譯至螢幕時的位置和操作視覺效果。</span><span class="sxs-lookup"><span data-stu-id="699a9-132">A visual's Content property associates a particular bitmap with the visual, while other properties control how DirectComposition positions and manipulates the visual as it is rendered to the screen.</span></span>

<span data-ttu-id="699a9-133">如需詳細資訊，請參閱 [視覺效果的屬性](#properties-of-a-visual-object)。</span><span class="sxs-lookup"><span data-stu-id="699a9-133">For more information, see [Properties of a Visual](#properties-of-a-visual-object).</span></span>

### <a name="visual-tree"></a><span data-ttu-id="699a9-134">視覺化樹狀結構</span><span class="sxs-lookup"><span data-stu-id="699a9-134">Visual tree</span></span>

<span data-ttu-id="699a9-135">DirectComposition 會從名為 *視覺化樹狀* 結構的視覺化物件階層式集合建立組合。</span><span class="sxs-lookup"><span data-stu-id="699a9-135">DirectComposition creates a composition from a hierarchical collection of visual objects called a *visual tree*.</span></span> <span data-ttu-id="699a9-136">樹狀結構根目錄的視覺效果稱為 *根視覺* 效果，而且可以有一或多 *個子視覺效果* 與其相關聯。</span><span class="sxs-lookup"><span data-stu-id="699a9-136">The visual at the root of a tree is called the *root visual* and it can have one or more *child visuals* associated with it.</span></span> <span data-ttu-id="699a9-137">子視覺效果可以有自己的一或多個子視覺效果。</span><span class="sxs-lookup"><span data-stu-id="699a9-137">A child visual can have one or more child visuals of its own.</span></span> <span data-ttu-id="699a9-138">任何有相關聯子視覺效果的視覺效果稱為 *父視覺* 效果，而且共用相同父系的所有子視覺效果都稱為「 *同級視覺效果*」。</span><span class="sxs-lookup"><span data-stu-id="699a9-138">Any visual that has associated child visuals is called a *parent visual*, and all child visuals that share the same parent are called *sibling visuals*.</span></span> <span data-ttu-id="699a9-139">特定視覺效果及其所有子系和附屬視覺效果都稱為 *視覺化子樹*。</span><span class="sxs-lookup"><span data-stu-id="699a9-139">A particular visual along with all its child and descendent visuals is called a *visual subtree*.</span></span>

<span data-ttu-id="699a9-140">樹狀結構中的視覺位置可協助您決定其螢幕位置，以及相對於組合中其他視覺效果的迭置順序。</span><span class="sxs-lookup"><span data-stu-id="699a9-140">A visual's location in the tree helps determine its screen position and z-order relative to the other visuals in the composition.</span></span> <span data-ttu-id="699a9-141">根視覺效果的位置相對於轉譯轉譯之目標視窗的工作區左上角。</span><span class="sxs-lookup"><span data-stu-id="699a9-141">The root visual is positioned relative to the upper-left corner of the client area of the target window where the composition is rendered.</span></span> <span data-ttu-id="699a9-142">所有子視覺效果都是相對於其父項視覺效果 (的左上角，或是 TransformParent 屬性) 所指定的視覺效果，而且一律會以迭置順序出現在其父系的前方。</span><span class="sxs-lookup"><span data-stu-id="699a9-142">All child visuals are positioned relative to the upper-left corner of their parent visual (or the visual specified by the TransformParent property), and always appear in front of their parent in the z-order.</span></span>

<span data-ttu-id="699a9-143">下圖顯示視覺效果的組合，以及用來產生組合的視覺化樹狀結構結構。</span><span class="sxs-lookup"><span data-stu-id="699a9-143">The following illustration shows a composition of visuals and the structure of the visual tree used to produce the composition.</span></span> <span data-ttu-id="699a9-144">Visual 1 是根視覺效果，也是子視覺效果2和3的父系，也就是同級視覺效果。</span><span class="sxs-lookup"><span data-stu-id="699a9-144">Visual 1 is the root visual and is also the parent of child Visuals 2 and 3, which are sibling visuals.</span></span> <span data-ttu-id="699a9-145">Visual 3 有其本身的兩個子視覺效果，也就是視覺效果4和5。</span><span class="sxs-lookup"><span data-stu-id="699a9-145">Visual 3 has two child visuals of its own, Visuals 4 and 5.</span></span> <span data-ttu-id="699a9-146">視覺效果三至5組成的視覺效果子樹。</span><span class="sxs-lookup"><span data-stu-id="699a9-146">Together, Visuals 3 through 5 make up a visual subtree.</span></span>

![視覺效果和對應的視覺化樹狀結構的組合](images/visuals-and-corresponding-tree.png)

<span data-ttu-id="699a9-148">父視覺效果會維護其子視覺效果的排序清單。</span><span class="sxs-lookup"><span data-stu-id="699a9-148">A parent visual maintains an ordered list of its child visuals.</span></span> <span data-ttu-id="699a9-149">當同級視覺效果的位置，使其彼此重迭時，DirectComposition 會根據其在父視覺效果的子清單中出現的順序，來設定同級的迭置順序。</span><span class="sxs-lookup"><span data-stu-id="699a9-149">When sibling visuals are positioned such that they overlap one another, DirectComposition sets the z-order of the siblings based on the order in which they appear in the parent visual's children list.</span></span> <span data-ttu-id="699a9-150">稍後在清單中的同級會放置在清單中稍早出現的所有兄弟前面。</span><span class="sxs-lookup"><span data-stu-id="699a9-150">A sibling that appears later in the list is placed in front of all siblings that appear earlier in the list.</span></span> <span data-ttu-id="699a9-151">下圖顯示重迭子視覺效果的迭置順序。</span><span class="sxs-lookup"><span data-stu-id="699a9-151">The following illustration shows the z-order of overlapping child visuals.</span></span>

![重迭子視覺效果的迭置順序](images/overlapping-child-visuals.png)

### <a name="properties-of-a-visual-object"></a><span data-ttu-id="699a9-153">視覺物件的屬性</span><span class="sxs-lookup"><span data-stu-id="699a9-153">Properties of a visual object</span></span>

<span data-ttu-id="699a9-154">視覺物件會公開一組屬性，可讓您設定視覺效果的點陣圖內容，以及控制 DirectComposition 的位置和操作視覺內容。</span><span class="sxs-lookup"><span data-stu-id="699a9-154">A visual object exposes a set of properties that enable you to set the bitmap content for the visual, and to control how DirectComposition positions and manipulates the visual content.</span></span> <span data-ttu-id="699a9-155">下列各節將詳細說明每個屬性。</span><span class="sxs-lookup"><span data-stu-id="699a9-155">The following sections describe each property in detail.</span></span>

-   [<span data-ttu-id="699a9-156">內容屬性</span><span class="sxs-lookup"><span data-stu-id="699a9-156">Content property</span></span>](#content-property)
-   [<span data-ttu-id="699a9-157">剪輯屬性</span><span class="sxs-lookup"><span data-stu-id="699a9-157">Clip property</span></span>](#clip-property)
-   [<span data-ttu-id="699a9-158">BorderMode 屬性</span><span class="sxs-lookup"><span data-stu-id="699a9-158">BorderMode property</span></span>](#bordermode-property)
-   [<span data-ttu-id="699a9-159">BitmapInterpolationMode 屬性</span><span class="sxs-lookup"><span data-stu-id="699a9-159">BitmapInterpolationMode property</span></span>](#bitmapinterpolationmode-property)
-   [<span data-ttu-id="699a9-160">CompositeMode 屬性</span><span class="sxs-lookup"><span data-stu-id="699a9-160">CompositeMode property</span></span>](#compositemode-property)
-   [<span data-ttu-id="699a9-161">OffsetX 和 OffsetY 屬性</span><span class="sxs-lookup"><span data-stu-id="699a9-161">OffsetX and OffsetY properties</span></span>](#offsetx-and-offsety-properties)
-   [<span data-ttu-id="699a9-162">Effect 屬性</span><span class="sxs-lookup"><span data-stu-id="699a9-162">Effect property</span></span>](#effect-property)
-   [<span data-ttu-id="699a9-163">Transform 屬性</span><span class="sxs-lookup"><span data-stu-id="699a9-163">Transform property</span></span>](#transform-property)
-   [<span data-ttu-id="699a9-164">TransformParent 屬性</span><span class="sxs-lookup"><span data-stu-id="699a9-164">TransformParent property</span></span>](#transformparent-property)

### <a name="content-property"></a><span data-ttu-id="699a9-165">內容屬性</span><span class="sxs-lookup"><span data-stu-id="699a9-165">Content property</span></span>

<span data-ttu-id="699a9-166">視覺效果的 Content 屬性會指定與視覺效果相關聯的點陣圖內容。</span><span class="sxs-lookup"><span data-stu-id="699a9-166">A visual's Content property specifies the bitmap content that is associated with the visual.</span></span> <span data-ttu-id="699a9-167">這是當您在組合中包含視覺效果時，DirectComposition 所使用的點陣圖。</span><span class="sxs-lookup"><span data-stu-id="699a9-167">This is the bitmap that DirectComposition uses when you include the visual in a composition.</span></span>

<span data-ttu-id="699a9-168">您可以藉由呼叫 [**IDCompositionVisual：： SetContent**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-setcontent) 方法來設定視覺效果的 Content 屬性。</span><span class="sxs-lookup"><span data-stu-id="699a9-168">You set the Content property of a visual by calling the [**IDCompositionVisual::SetContent**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-setcontent) method.</span></span>

<span data-ttu-id="699a9-169">如需 DirectComposition 所支援點陣圖內容類型的詳細資訊，請參閱 [點陣圖物件](bitmap-surfaces.md)。</span><span class="sxs-lookup"><span data-stu-id="699a9-169">For more information about the types of bitmap content supported by DirectComposition, see [Bitmap objects](bitmap-surfaces.md).</span></span>

### <a name="clip-property"></a><span data-ttu-id="699a9-170">剪輯屬性</span><span class="sxs-lookup"><span data-stu-id="699a9-170">Clip property</span></span>

<span data-ttu-id="699a9-171">視覺效果的 [剪輯] 屬性會指定一個矩形區域，稱為 *裁剪區域* (或 *裁剪矩形*) 。</span><span class="sxs-lookup"><span data-stu-id="699a9-171">The Clip property of a visual specifies a rectangular area called the *clipping region* (or *clip rectangle*).</span></span> <span data-ttu-id="699a9-172">轉譯視覺效果時，只會顯示落在裁剪區域內的視覺效果部分，而在裁剪區域外部延伸的任何內容則會被裁剪 (也就是不會顯示) 。</span><span class="sxs-lookup"><span data-stu-id="699a9-172">When a visual is rendered, only the portion of the visual that falls inside the clipping region is displayed, while any content that extends outside the clipping region is clipped (that is, not displayed).</span></span> <span data-ttu-id="699a9-173">DirectComposition 支援具有圓角或方框的裁剪區域。</span><span class="sxs-lookup"><span data-stu-id="699a9-173">DirectComposition supports clipping regions that have rounded or squared corners.</span></span>

<span data-ttu-id="699a9-174">您可以藉由呼叫 [**IDCompositionVisual：： SetClip**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-setclip(constd2d_rect_f_)) 方法來設定視覺效果的剪輯屬性。</span><span class="sxs-lookup"><span data-stu-id="699a9-174">You set the Clip property of a visual by calling the [**IDCompositionVisual::SetClip**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-setclip(constd2d_rect_f_)) method.</span></span>

<span data-ttu-id="699a9-175">如需詳細資訊，請參閱 [裁剪](clipping.md)。</span><span class="sxs-lookup"><span data-stu-id="699a9-175">For more information, see [Clipping](clipping.md).</span></span>

### <a name="bordermode-property"></a><span data-ttu-id="699a9-176">BorderMode 屬性</span><span class="sxs-lookup"><span data-stu-id="699a9-176">BorderMode property</span></span>

<span data-ttu-id="699a9-177">BorderMode 屬性會指定如何撰寫與此視覺效果相關聯的點陣圖和剪輯邊緣，或在子樹中的視覺效果中使用視覺效果。</span><span class="sxs-lookup"><span data-stu-id="699a9-177">The BorderMode property specifies how to compose the edges of bitmaps and clips associated with this visual, or with visuals in the subtree rooted at this visual.</span></span>

<span data-ttu-id="699a9-178">框線模式會影響點陣圖的邊緣在轉換點陣圖時的組成方式，讓邊緣不會與整數座標組齊軸。</span><span class="sxs-lookup"><span data-stu-id="699a9-178">The border mode affects how the edges of a bitmap are composed when the bitmap is transformed such that the edges are not axis-aligned with integer coordinates.</span></span> <span data-ttu-id="699a9-179">它也會影響在具有圓角的剪輯角落以及已轉換之剪輯邊緣的內容裁剪方式，讓邊緣與整數座標不對齊軸。</span><span class="sxs-lookup"><span data-stu-id="699a9-179">It also affects how content is clipped at the corners of a clip that has rounded corners, and at the edge of a clip that is transformed such that the edges are not axis-aligned with integer coordinates.</span></span>

<span data-ttu-id="699a9-180">如需詳細資訊，請參閱 [**IDCompositionVisual：： SetBorderMode**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-setbordermode)。</span><span class="sxs-lookup"><span data-stu-id="699a9-180">For more information, see [**IDCompositionVisual::SetBorderMode**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-setbordermode).</span></span>

### <a name="bitmapinterpolationmode-property"></a><span data-ttu-id="699a9-181">BitmapInterpolationMode 屬性</span><span class="sxs-lookup"><span data-stu-id="699a9-181">BitmapInterpolationMode property</span></span>

<span data-ttu-id="699a9-182">BitmapInterpolationMode 屬性會告知 DirectComposition 如何在轉換點陣圖時撰寫點陣圖，讓點陣圖中的圖元與螢幕上的圖元之間沒有一對一的對應關係。</span><span class="sxs-lookup"><span data-stu-id="699a9-182">The BitmapInterpolationMode property tells DirectComposition how to compose a bitmap when it is transformed such that there is no one-to-one correspondence between pixels in the bitmap and pixels on the screen.</span></span>

<span data-ttu-id="699a9-183">您可以藉由呼叫 [**IDCompositionVisual：： SetBitmapInterpolationMode**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-setbitmapinterpolationmode) 方法來設定視覺效果的 BitmapInterpolationMode 屬性。</span><span class="sxs-lookup"><span data-stu-id="699a9-183">You set the BitmapInterpolationMode property of a visual by calling the [**IDCompositionVisual::SetBitmapInterpolationMode**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-setbitmapinterpolationmode) method.</span></span>

### <a name="compositemode-property"></a><span data-ttu-id="699a9-184">CompositeMode 屬性</span><span class="sxs-lookup"><span data-stu-id="699a9-184">CompositeMode property</span></span>

<span data-ttu-id="699a9-185">CompositeMode 屬性會指示 DirectComposition 如何 blend 視覺效果的點陣圖內容與轉譯目標。</span><span class="sxs-lookup"><span data-stu-id="699a9-185">The CompositeMode property tells DirectComposition how to blend the bitmap content of a visual with the render target.</span></span> <span data-ttu-id="699a9-186">如需支援的複合模式的描述，請參閱 [**DCOMPOSITION \_ 複合 \_ 模式**](/windows/desktop/api/DcompTypes/ne-dcomptypes-dcomposition_composite_mode)。</span><span class="sxs-lookup"><span data-stu-id="699a9-186">For a description of the supported composite modes, see [**DCOMPOSITION\_COMPOSITE\_MODE**](/windows/desktop/api/DcompTypes/ne-dcomptypes-dcomposition_composite_mode).</span></span>

<span data-ttu-id="699a9-187">您可以藉由呼叫 [**IDCompositionVisual：： SetCompositeMode**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-setcompositemode) 方法來設定視覺效果的 CompositeMode 屬性。</span><span class="sxs-lookup"><span data-stu-id="699a9-187">You set the CompositeMode property of a visual by calling the [**IDCompositionVisual::SetCompositeMode**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-setcompositemode) method.</span></span>

### <a name="offsetx-and-offsety-properties"></a><span data-ttu-id="699a9-188">OffsetX 和 OffsetY 屬性</span><span class="sxs-lookup"><span data-stu-id="699a9-188">OffsetX and OffsetY properties</span></span>

<span data-ttu-id="699a9-189">OffsetX 和 OffsetY 屬性會指示 DirectComposition 要以水準和垂直方式放置視覺效果的位置。</span><span class="sxs-lookup"><span data-stu-id="699a9-189">The OffsetX and OffsetY properties tell DirectComposition where to position a visual horizontally and vertically.</span></span> <span data-ttu-id="699a9-190">它們會定義二維固定位置，而視覺效果的所有轉換和效果都會從這個位置計算。</span><span class="sxs-lookup"><span data-stu-id="699a9-190">They define the two-dimensional fixed position from which all transforms and effects for the visual are calculated.</span></span>

<span data-ttu-id="699a9-191">針對根視覺效果，OffsetX 和 OffsetY 屬性會定義相對於主控視覺效果的視窗左上角之點的 x 座標和 y 座標。</span><span class="sxs-lookup"><span data-stu-id="699a9-191">For a root visual, the OffsetX and OffsetY properties define the x-coordinate and y-coordinate of a point relative to the upper-left corner of the window that hosts the visual.</span></span> <span data-ttu-id="699a9-192">針對子視覺效果，座標是相對於父代的左上角，如果指定了 [TransformParent 屬性](#transformparent-property) ，則為指定之視覺效果的左上角。</span><span class="sxs-lookup"><span data-stu-id="699a9-192">For a child visual, the coordinates are relative to the upper-left corner of the parent or, if the [TransformParent property](#transformparent-property) is specified, the upper-left corner of the specified visual.</span></span> <span data-ttu-id="699a9-193">轉譯視覺效果時，會將視覺效果左上角的位置與指定的座標相符。</span><span class="sxs-lookup"><span data-stu-id="699a9-193">When a visual is rendered, it is positioned such that the visual's upper-left corner coincides with the specified coordinates.</span></span>

<span data-ttu-id="699a9-194">您可以藉由呼叫 [**IDCompositionVisual：： SetOffsetX**](/previous-versions/windows/desktop/legacy/hh449126(v=vs.85)) 和 [**SetOffsetY**](/previous-versions/windows/desktop/legacy/hh449131(v=vs.85)) 方法來設定視覺效果的 OffsetX 和 OffsetY 屬性。</span><span class="sxs-lookup"><span data-stu-id="699a9-194">You set the OffsetX and OffsetY properties of a visual by calling the [**IDCompositionVisual::SetOffsetX**](/previous-versions/windows/desktop/legacy/hh449126(v=vs.85)) and [**SetOffsetY**](/previous-versions/windows/desktop/legacy/hh449131(v=vs.85)) methods.</span></span>

### <a name="effect-property"></a><span data-ttu-id="699a9-195">Effect 屬性</span><span class="sxs-lookup"><span data-stu-id="699a9-195">Effect property</span></span>

<span data-ttu-id="699a9-196">[效果] 屬性可讓您指定效果或效果群組，以修改視覺效果及其子樹的組成方式。</span><span class="sxs-lookup"><span data-stu-id="699a9-196">The Effect property lets you specify an effect, or group of effects, that will modify how a visual and its subtree is composed.</span></span> <span data-ttu-id="699a9-197">例如，您可以指定控制視覺效果不透明度的效果，並以各種方式混合視覺效果與另一個點陣圖，並將透視圖轉換套用至視覺效果。</span><span class="sxs-lookup"><span data-stu-id="699a9-197">For example, you can specify effects that control the opacity of a visual, blend the visual with another bitmap in various ways, and apply perspective transforms to the visual.</span></span>

<span data-ttu-id="699a9-198">您可以藉由呼叫 [**IDCompositionVisual：： SetEffect**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-seteffect) 方法來設定視覺效果的效果屬性。</span><span class="sxs-lookup"><span data-stu-id="699a9-198">You set the Effect property of a visual by calling the [**IDCompositionVisual::SetEffect**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-seteffect) method.</span></span>

<span data-ttu-id="699a9-199">如需詳細資訊，請參閱[效果](effects.md)。</span><span class="sxs-lookup"><span data-stu-id="699a9-199">For more information, see [Effects](effects.md).</span></span>

### <a name="transform-property"></a><span data-ttu-id="699a9-200">Transform 屬性</span><span class="sxs-lookup"><span data-stu-id="699a9-200">Transform property</span></span>

<span data-ttu-id="699a9-201">轉換屬性會指定二維 (2D) 轉換或2D 轉換的群組，以便 DirectComposition 在視覺效果上執行。</span><span class="sxs-lookup"><span data-stu-id="699a9-201">The Transform property specifies a two-dimensional (2D) transformation, or group of 2D transformations, for DirectComposition to perform on the visual.</span></span> <span data-ttu-id="699a9-202">轉換 (或轉換) 是一種作業，可修改視覺效果相對於其父代的座標系統，或是相對於 [TransformParent 屬性](#transformparent-property)所指定的視覺效果。</span><span class="sxs-lookup"><span data-stu-id="699a9-202">A transformation (or transform) is an operation that modifies the coordinate system of a visual relative to its parent, or relative to the visual specified by the [TransformParent property](#transformparent-property).</span></span> <span data-ttu-id="699a9-203">您可以使用轉換來改變視覺效果的位置、大小或本質，方法是將它移到另一個位置， (轉譯) ，使其變得更大或更小 (調整) 、將它轉換 (旋轉) 、扭曲圖形 (扭曲) 等等。</span><span class="sxs-lookup"><span data-stu-id="699a9-203">You can use transforms to alter the position, size, or nature of a visual by moving it to another location (translation), making it larger or smaller (scaling), turning it (rotation), distorting its shape (skewing), and so on.</span></span>

<span data-ttu-id="699a9-204">您可以藉由呼叫 [**IDCompositionVisual：： SetTransform**](/previous-versions/windows/desktop/legacy/hh449178(v=vs.85)) 方法來設定視覺效果的轉換屬性。</span><span class="sxs-lookup"><span data-stu-id="699a9-204">You set the Transform property of a visual by calling the [**IDCompositionVisual::SetTransform**](/previous-versions/windows/desktop/legacy/hh449178(v=vs.85)) method.</span></span>

<span data-ttu-id="699a9-205">如需詳細資訊，請參閱[轉換](transforms.md)。</span><span class="sxs-lookup"><span data-stu-id="699a9-205">For more information, see [Transforms](transforms.md).</span></span>

### <a name="transformparent-property"></a><span data-ttu-id="699a9-206">TransformParent 屬性</span><span class="sxs-lookup"><span data-stu-id="699a9-206">TransformParent property</span></span>

<span data-ttu-id="699a9-207">視覺效果的座標系統是由 OffsetX、OffsetY 和 Transform 屬性修改。</span><span class="sxs-lookup"><span data-stu-id="699a9-207">The coordinate system of a visual is modified by the OffsetX, OffsetY, and Transform properties.</span></span> <span data-ttu-id="699a9-208">一般來說，這些屬性會定義視覺效果相對於其直屬父系的座標系統。</span><span class="sxs-lookup"><span data-stu-id="699a9-208">Normally, these properties define the coordinate system of a visual relative to its immediate parent.</span></span> <span data-ttu-id="699a9-209">若要使用父系以外的某些視覺作為子視覺效果座標系統的基礎，請使用 TransformParent 屬性，將不同的視覺效果指定為「父系」，以供轉換之用。</span><span class="sxs-lookup"><span data-stu-id="699a9-209">To use some visual other than the parent as the basis for the coordinate system of a child visual, use the TransformParent property to specify a different visual as the "parent" for transform purposes.</span></span>

<span data-ttu-id="699a9-210">您可以藉由呼叫 [**IDCompositionVisual：： SetTransformParent**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-settransformparent) 方法來設定視覺效果的 TransformParent 屬性。</span><span class="sxs-lookup"><span data-stu-id="699a9-210">You set the TransformParent property of a visual by calling the [**IDCompositionVisual::SetTransformParent**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-settransformparent) method.</span></span>

## <a name="device-object"></a><span data-ttu-id="699a9-211">裝置物件</span><span class="sxs-lookup"><span data-stu-id="699a9-211">Device object</span></span>

<span data-ttu-id="699a9-212">若要使用 DirectComposition，您必須建立和操作 (COM) 物件的各種元件物件模型。</span><span class="sxs-lookup"><span data-stu-id="699a9-212">To use DirectComposition, you must create and manipulate a variety of Component Object Model (COM) objects.</span></span> <span data-ttu-id="699a9-213">您需要建立的第一個物件是 DirectComposition *裝置物件* ，因為它是用來建立組合中所有其他物件的 factory。</span><span class="sxs-lookup"><span data-stu-id="699a9-213">The first object that you need to create is the DirectComposition *device object* because it serves as the factory for creating all other objects used in a composition.</span></span>

<span data-ttu-id="699a9-214">您可以藉由呼叫 [**DCompositionCreateDevice**](/windows/desktop/api/Dcomp/nf-dcomp-dcompositioncreatedevice) 函式來建立裝置物件，該函式會傳回 [**IDCompositionDevice**](/windows/win32/api/dcomp/nn-dcomp-idcompositiondevice) 介面指標。</span><span class="sxs-lookup"><span data-stu-id="699a9-214">You create a device object by calling the [**DCompositionCreateDevice**](/windows/desktop/api/Dcomp/nf-dcomp-dcompositioncreatedevice) function, which returns an [**IDCompositionDevice**](/windows/win32/api/dcomp/nn-dcomp-idcompositiondevice) interface pointer.</span></span> <span data-ttu-id="699a9-215">這個介面會公開一組方法，您可以用來建立視覺物件、剪輯物件、動畫物件、轉換物件、效果物件等等。</span><span class="sxs-lookup"><span data-stu-id="699a9-215">This interface exposes a set of methods that you use to create visual objects, clip objects, animation objects, transform objects, effect objects, and so on.</span></span>

<span data-ttu-id="699a9-216">裝置物件除了做為建立其他物件的 factory 之外，還提供另一個用途。</span><span class="sxs-lookup"><span data-stu-id="699a9-216">The device object serves one other purpose besides being a factory for creating other objects.</span></span> <span data-ttu-id="699a9-217">它會公開稱為 [**Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit) 的方法，此方法會將視覺化樹狀結構傳遞至 DirectComposition 進行處理。</span><span class="sxs-lookup"><span data-stu-id="699a9-217">It exposes a method called [**Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit) that passes a visual tree to DirectComposition for processing.</span></span> <span data-ttu-id="699a9-218">如需詳細資訊，請參閱 [交易式組合](#transactional-composition)。</span><span class="sxs-lookup"><span data-stu-id="699a9-218">For more information, see [Transactional Composition](#transactional-composition).</span></span>

<span data-ttu-id="699a9-219">請記住，雖然您可以在應用程式中建立裝置物件的多個實例，但您在特定組合中使用的所有物件都必須由相同的裝置物件建立，但有一個例外：您可以在相同的視覺化樹狀結構中結合來自不同裝置物件的視覺物件。</span><span class="sxs-lookup"><span data-stu-id="699a9-219">Remember that, while you can create multiple instances of the device object in your application, all of the objects that you use in a particular composition must be created by the same device object—with one exception: You can combine visual objects from different device objects in the same visual tree.</span></span> <span data-ttu-id="699a9-220">當您這樣做時，DirectComposition 會如往常般將視覺化樹狀結構視為一樣，只不過樹狀結構中特定視覺物件的變更只會在建立視覺物件的裝置物件上呼叫 [**Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit) 方法時才會生效。</span><span class="sxs-lookup"><span data-stu-id="699a9-220">When you do so, DirectComposition treats the visual tree as it normally would, except that changes to a particular visual object in the tree take effect only when the [**Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit) method is called on the device object that created the visual object.</span></span>

<span data-ttu-id="699a9-221">從相同視覺化樹狀結構中的不同裝置使用視覺效果的能力，可讓多個執行緒建立和操作單一視覺化樹狀結構，同時維護兩個獨立的裝置，可用來以非同步方式認可變更。</span><span class="sxs-lookup"><span data-stu-id="699a9-221">The ability to use visuals from different devices in the same visual tree enables multiple threads to create and manipulate a single visual tree while maintaining two independent devices that can be used to commit changes asynchronously.</span></span> <span data-ttu-id="699a9-222">如需詳細資訊，請參閱 [跨裝置的視覺化樹狀](#cross-device-visual-trees)結構。</span><span class="sxs-lookup"><span data-stu-id="699a9-222">For more information, see [Cross-Device Visual Trees](#cross-device-visual-trees).</span></span>

## <a name="composition-target-window"></a><span data-ttu-id="699a9-223">撰寫目標視窗</span><span class="sxs-lookup"><span data-stu-id="699a9-223">Composition target window</span></span>

<span data-ttu-id="699a9-224">視覺化樹狀結構必須系結至視窗，您才能在畫面上顯示任何樹狀結構的視覺效果。</span><span class="sxs-lookup"><span data-stu-id="699a9-224">A visual tree must be bound to a window before any of the tree's visuals can be displayed on the screen.</span></span> <span data-ttu-id="699a9-225">稱為「 *撰寫目標」視窗* 的視窗可以是最上層視窗或子視窗。</span><span class="sxs-lookup"><span data-stu-id="699a9-225">The window, called the *composition target window*, can be a top-level window or a child window.</span></span> <span data-ttu-id="699a9-226">此外，撰寫目標視窗可以是分層視窗;也就是說，它可以有 [**WS \_ EX \_ 分層**](/windows/desktop/winmsg/extended-window-styles) 視窗樣式。</span><span class="sxs-lookup"><span data-stu-id="699a9-226">Also, the composition target window can be a layered window; that is, it can have the [**WS\_EX\_LAYERED**](/windows/desktop/winmsg/extended-window-styles) window style.</span></span>

<span data-ttu-id="699a9-227">DirectComposition 可讓應用程式將最多兩個視覺樹狀結構系結至每個視窗。</span><span class="sxs-lookup"><span data-stu-id="699a9-227">DirectComposition allows an application to bind a maximum of two visual trees to each window.</span></span> <span data-ttu-id="699a9-228">視覺化樹狀結構包含一個是以視窗本身為基礎，但在所有視窗的子視窗後方，另一個則是在視窗頂端和子視窗上方組成的。</span><span class="sxs-lookup"><span data-stu-id="699a9-228">The visual trees include one that is composed on top of the window itself, but behind all of the window’s child windows, and another that is composed on top of the window and on top of the child windows.</span></span> <span data-ttu-id="699a9-229">換句話說，每個視窗都有四個概念層，而且所有圖層都會裁剪至目標視窗的可見區域。</span><span class="sxs-lookup"><span data-stu-id="699a9-229">In other words, each window has four conceptual layers, and all layers are clipped to the target window's visible region.</span></span> <span data-ttu-id="699a9-230">下圖顯示視窗的四個概念層。</span><span class="sxs-lookup"><span data-stu-id="699a9-230">The following illustration shows the four conceptual layers of a window.</span></span>

![視窗的概念層](images/directcomposition-layers.png)

## <a name="transactional-composition"></a><span data-ttu-id="699a9-232">交易式撰寫</span><span class="sxs-lookup"><span data-stu-id="699a9-232">Transactional composition</span></span>

<span data-ttu-id="699a9-233">DirectComposition 會使用交易式模型，在此模型中，您會建立一組批次的視覺效果變更，然後「認可」設定為 DirectComposition，以便一次處理所有的變更。</span><span class="sxs-lookup"><span data-stu-id="699a9-233">DirectComposition uses a transactional model where you create a batched set of changes to a visual and then "commit" the set to DirectComposition for processing all at once.</span></span> <span data-ttu-id="699a9-234">您可以修改相同的 DirectComposition 視覺物件，並認可任何次數的變更。</span><span class="sxs-lookup"><span data-stu-id="699a9-234">You can modify the same DirectComposition visual object and commit the changes any number of times.</span></span> <span data-ttu-id="699a9-235">當桌面視窗管理員 (DWM) 收取批次時，它會挑選所有暫止的批次，並依認可的順序將它們套用至下一個框架。</span><span class="sxs-lookup"><span data-stu-id="699a9-235">When the Desktop Window Manager (DWM) picks up batches, it picks up all pending batches and applies them to the next frame in the order they were committed.</span></span>

<span data-ttu-id="699a9-236">單一認可內的所有變更都保證會套用至單一框架。</span><span class="sxs-lookup"><span data-stu-id="699a9-236">All changes within a single commit are guaranteed to be applied to a single frame.</span></span> <span data-ttu-id="699a9-237">因為 DWM 會針對每個畫面格收集一次批次，所以您只能針對每個畫面格修改任何特定的物件。</span><span class="sxs-lookup"><span data-stu-id="699a9-237">Because DWM collects batches once per frame, you can modify any particular object only once per frame.</span></span> <span data-ttu-id="699a9-238">修改不同物件的後續認可也可能套用至目前的框架，但 DirectComposition 並不保證這些變更會發生在相同的框架中。</span><span class="sxs-lookup"><span data-stu-id="699a9-238">Subsequent commits that modify different objects might also be applied to the current frame, but DirectComposition does not guarantee that the changes will occur in the same frame.</span></span>

<span data-ttu-id="699a9-239">[**IDCompositionSurface：： BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw)和 [**IDCompositionSurface：： EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw)方法可讓您同步處理轉譯更新與視覺效果更新。</span><span class="sxs-lookup"><span data-stu-id="699a9-239">The [**IDCompositionSurface::BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) and [**IDCompositionSurface::EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) methods let you synchronize rendering updates with visual updates.</span></span> <span data-ttu-id="699a9-240">例如，您可以呼叫 **IDCompositionSurface：： BeginDraw**、更新視覺效果的 OffsetX 和剪輯屬性、呼叫 [**IDCompositionDevice：： Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit)、使用 Microsoft DirectX 繪製內容，然後呼叫 **IDCompositionSurface：： EndDraw**。</span><span class="sxs-lookup"><span data-stu-id="699a9-240">For example, you can call **IDCompositionSurface::BeginDraw**, update the OffsetX and Clip properties of a visual, call [**IDCompositionDevice::Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit), draw content with Microsoft DirectX, and then call **IDCompositionSurface::EndDraw**.</span></span> <span data-ttu-id="699a9-241">在此情況下，Microsoft DirectComposition 可確保同時更新點陣圖內容和視覺屬性。</span><span class="sxs-lookup"><span data-stu-id="699a9-241">In this case, Microsoft DirectComposition ensures that bitmap content and the visual properties are updated at the same time.</span></span>

### <a name="batching"></a><span data-ttu-id="699a9-242">批次處理</span><span class="sxs-lookup"><span data-stu-id="699a9-242">Batching</span></span>

<span data-ttu-id="699a9-243">您可以在相同的框架內，針對相同的視覺效果或多項不同視覺效果的變更，認可多個變更。</span><span class="sxs-lookup"><span data-stu-id="699a9-243">You can commit multiple changes to the same visual, or multiple changes to different visuals, within the same frame.</span></span> <span data-ttu-id="699a9-244">在相同的框架內對相同的視覺效果進行多項變更時，請記住下列幾點：</span><span class="sxs-lookup"><span data-stu-id="699a9-244">When making multiple changes to the same visual within the same frame, keep the following points in mind:</span></span>

-   <span data-ttu-id="699a9-245">如果您對視覺效果的相同屬性進行多項變更，則只會套用最後一個變更。</span><span class="sxs-lookup"><span data-stu-id="699a9-245">If you make multiple changes to the same property of a visual, only the last change is applied.</span></span> <span data-ttu-id="699a9-246">例如，如果您將不透明度設定為0，然後設定為0.5，最後到1.0，則只會將不透明度1.0 套用至視覺效果。</span><span class="sxs-lookup"><span data-stu-id="699a9-246">For example, if you set the opacity to 0, then to 0.5, and finally to 1.0, only an opacity of 1.0 is applied to the visual.</span></span>
-   <span data-ttu-id="699a9-247">如果您變更相同視覺效果的多個屬性，DirectComposition 會先將變更套用至視覺效果，再套用至任何子視覺效果。</span><span class="sxs-lookup"><span data-stu-id="699a9-247">If you change multiple properties of the same visual, DirectComposition applies the changes first to the visual and then to any child visuals.</span></span> <span data-ttu-id="699a9-248">屬性會依下列順序套用，而不論您指定的順序為何：</span><span class="sxs-lookup"><span data-stu-id="699a9-248">The properties are applied in the following order regardless of the order in which you specify them:</span></span>

    1.  <span data-ttu-id="699a9-249">Offset</span><span class="sxs-lookup"><span data-stu-id="699a9-249">Offset</span></span>
    2.  <span data-ttu-id="699a9-250">轉換</span><span class="sxs-lookup"><span data-stu-id="699a9-250">Transform</span></span>
    3.  <span data-ttu-id="699a9-251">裁剪</span><span class="sxs-lookup"><span data-stu-id="699a9-251">Clip</span></span>
    4.  <span data-ttu-id="699a9-252">效果</span><span class="sxs-lookup"><span data-stu-id="699a9-252">Effect</span></span>

    <span data-ttu-id="699a9-253">下圖顯示將這四個屬性套用至視覺效果的結果。</span><span class="sxs-lookup"><span data-stu-id="699a9-253">The following illustration shows the result of applying all four properties to a visual.</span></span>

    ![將全部四個屬性套用至視覺效果的結果](images/order-of-properties.png)

    <span data-ttu-id="699a9-255">請記住，所有變更會一次套用至相同框架內容中的視覺效果。</span><span class="sxs-lookup"><span data-stu-id="699a9-255">Remember that all changes are applied to the visual at once within the context of the same frame.</span></span> <span data-ttu-id="699a9-256">這表示，從使用者的觀點來看，視覺效果的變更會立即發生。</span><span class="sxs-lookup"><span data-stu-id="699a9-256">This means that, from the user's perspective, the changes to the visual occur instantaneously.</span></span>

-   <span data-ttu-id="699a9-257">針對 [轉換] 屬性，您可以使用 [**IDCompositionDevice：： CreateTransformGroup**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-createtransformgroup) 來建立一組要套用至視覺效果的轉換。</span><span class="sxs-lookup"><span data-stu-id="699a9-257">For the Transform property, you can use [**IDCompositionDevice::CreateTransformGroup**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-createtransformgroup) to create a group of transforms to apply to a visual all at once.</span></span> <span data-ttu-id="699a9-258">DirectComposition 會依照您指定的順序套用轉換。</span><span class="sxs-lookup"><span data-stu-id="699a9-258">DirectComposition applies the transforms in the order that you specify.</span></span>
-   <span data-ttu-id="699a9-259">針對 [效果] 屬性，您可以使用 [**IDCompositionEffectGroup**](/windows/win32/api/dcomp/nn-dcomp-idcompositioneffectgroup) 來套用一組效果。</span><span class="sxs-lookup"><span data-stu-id="699a9-259">For the Effect property, you can use [**IDCompositionEffectGroup**](/windows/win32/api/dcomp/nn-dcomp-idcompositioneffectgroup) to apply a group of effects.</span></span> <span data-ttu-id="699a9-260">DirectComposition 會依照您指定的順序套用效果。</span><span class="sxs-lookup"><span data-stu-id="699a9-260">DirectComposition applies the effects in the order that you specify.</span></span> <span data-ttu-id="699a9-261">此外，在套用目前視覺效果中的所有3D 轉換之後，3D 透視轉換會導致視覺化樹狀結構的簡維化。</span><span class="sxs-lookup"><span data-stu-id="699a9-261">In addition, 3D perspective transformations result in flattening of the visual tree after all 3D transformations in the current visual have been applied.</span></span> <span data-ttu-id="699a9-262">這有助於確保產生的視覺效果盡可能接近3D。</span><span class="sxs-lookup"><span data-stu-id="699a9-262">This helps ensure that the resulting visual looks as close to 3D as possible.</span></span>

### <a name="synchronization"></a><span data-ttu-id="699a9-263">同步處理</span><span class="sxs-lookup"><span data-stu-id="699a9-263">Synchronization</span></span>

<span data-ttu-id="699a9-264">您的應用程式可以同時從多個執行緒呼叫 DirectComposition。</span><span class="sxs-lookup"><span data-stu-id="699a9-264">Your application can call DirectComposition from multiple threads at the same time.</span></span> <span data-ttu-id="699a9-265">執行順序可保證順序調用，但不能用於並行呼叫。</span><span class="sxs-lookup"><span data-stu-id="699a9-265">The order of execution is guaranteed for sequential calls, but not for concurrent calls.</span></span> <span data-ttu-id="699a9-266">例如，如果執行緒 A 修改了視覺效果，而執行緒 B 同時認可該批次，則不會定義該視覺效果變更是否包含在認可的批次中，或是否要啟動新的批次。</span><span class="sxs-lookup"><span data-stu-id="699a9-266">For example, if thread A modifies a visual and thread B commits the batch at the same time, it is not defined whether that visual change is included in the committed batch or whether it starts a new batch.</span></span> <span data-ttu-id="699a9-267">另一方面，如果您的應用程式使用其他同步處理機制來確保在另一個方法之前呼叫，DirectComposition 會接受呼叫順序，並處理這些呼叫的方式，就好像這兩個呼叫都是從單一執行緒的順序發出。</span><span class="sxs-lookup"><span data-stu-id="699a9-267">On the other hand, if your application uses other synchronization mechanisms to ensure that one method is called before the other, DirectComposition honors the call order and processes them as if both calls were issued in that order from a single thread.</span></span>

### <a name="cross-device-visual-trees"></a><span data-ttu-id="699a9-268">跨裝置的視覺化樹狀結構</span><span class="sxs-lookup"><span data-stu-id="699a9-268">Cross-device visual trees</span></span>

<span data-ttu-id="699a9-269">DirectComposition 物件不是執行緒系結;您可以使用多個執行緒來修改相同的物件集。</span><span class="sxs-lookup"><span data-stu-id="699a9-269">DirectComposition objects are not thread bound; you can use multiple threads to modify the same set of objects.</span></span> <span data-ttu-id="699a9-270">不過，共用相同的裝置物件時，請注意下列問題。</span><span class="sxs-lookup"><span data-stu-id="699a9-270">However, be aware of the following issues when sharing the same device object.</span></span>

-   <span data-ttu-id="699a9-271">這兩個執行緒都必須能夠呼叫 [**IDCompositionDevice：： Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit)。</span><span class="sxs-lookup"><span data-stu-id="699a9-271">Both threads need to be able to call [**IDCompositionDevice::Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit).</span></span> <span data-ttu-id="699a9-272">如果只有一個執行緒呼叫 **IDCompositionDevice：： Commit**，另一個執行緒無法將其任何變更認可至 DirectComposition。</span><span class="sxs-lookup"><span data-stu-id="699a9-272">If only one of the threads calls **IDCompositionDevice::Commit**, the other thread cannot commit any of its changes to DirectComposition.</span></span>
-   <span data-ttu-id="699a9-273">當某個執行緒呼叫 [**IDCompositionDevice：： Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit) 時，如果另一個執行緒仍進行的變更要成為相同交易的一部分，交易行為可能會遺失。</span><span class="sxs-lookup"><span data-stu-id="699a9-273">Transactional behavior might be lost if one thread calls [**IDCompositionDevice::Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit) while the other thread is still making changes that are intended to be part of the same transaction.</span></span>

<span data-ttu-id="699a9-274">如果您需要將多個同時交易認可至 DirectComposition，您必須使用多個裝置物件，可能來自多個執行緒。</span><span class="sxs-lookup"><span data-stu-id="699a9-274">If you need to commit multiple simultaneous transactions to DirectComposition, you must use multiple device objects, possibly from multiple threads.</span></span> <span data-ttu-id="699a9-275">在此案例中，兩個裝置物件會共用相同的視覺化樹狀結構，而每個裝置物件會認可自己的交易。</span><span class="sxs-lookup"><span data-stu-id="699a9-275">In this scenario, the same visual tree is shared by both device objects, and each device object commits its own transactions.</span></span>

<span data-ttu-id="699a9-276">下圖顯示由兩個裝置物件共用的視覺化樹狀結構。</span><span class="sxs-lookup"><span data-stu-id="699a9-276">The following illustration shows a visual tree that is shared by two device objects.</span></span> <span data-ttu-id="699a9-277">視覺效果1、2、4和5是由一或多個裝置所擁有，但 visual 3 會由這兩個裝置共用，因此可用於將兩個子樹狀結構連接至單一、較大的視覺化樹狀結構。</span><span class="sxs-lookup"><span data-stu-id="699a9-277">Visuals 1, 2, 4 and 5 are owned by one device or the other, but visual 3 is shared by both devices, and can therefore be used to connect two sub-trees into a single, larger visual tree.</span></span> <span data-ttu-id="699a9-278">共用視覺化樹狀結構可讓您以非同步方式從兩個不同的執行緒操作兩個裝置。</span><span class="sxs-lookup"><span data-stu-id="699a9-278">Sharing the visual tree allows the two devices to be manipulated from two different threads asynchronously.</span></span>

![由兩個裝置共用的視覺化樹狀結構](images/shared-visual-tree-1.png)

<span data-ttu-id="699a9-280">若要說明在兩個裝置之間共用視覺樹狀結構的實用性，請考慮啟用低延遲觸控輸入的架構。</span><span class="sxs-lookup"><span data-stu-id="699a9-280">To illustrate the usefulness of sharing a visual tree between two devices, consider an architecture that enables low-latency touch input.</span></span> <span data-ttu-id="699a9-281">架構可以使用兩個執行緒，一個處理大部分的 UI 工作，另一個則是專門用來處理觸控輸入事件的執行緒。</span><span class="sxs-lookup"><span data-stu-id="699a9-281">The architecture could use two threads, one that handles most UI tasks, and a second thread dedicated to processing touch input events.</span></span> <span data-ttu-id="699a9-282">觸控執行緒會根據使用者輸入手勢來更新特定視覺效果的轉換。</span><span class="sxs-lookup"><span data-stu-id="699a9-282">The touch thread updates the transform of a particular visual based on the user input gesture.</span></span> <span data-ttu-id="699a9-283">藉由更新轉換，觸控執行緒可以讓該視覺效果底下的整個子樹遵循使用者的手指、在使用者執行多點觸控手勢等情況下擴大或縮小。</span><span class="sxs-lookup"><span data-stu-id="699a9-283">By updating the transform, the touch thread can make the entire subtree under that visual follow the user’s finger, scale up or down as the user executes a multi-touch gesture, and so on.</span></span> <span data-ttu-id="699a9-284">UI 執行緒會保留大部分組合樹狀結構的擁有權，而觸控執行緒只擁有標記為非同步觸控回應的幾個視覺效果。</span><span class="sxs-lookup"><span data-stu-id="699a9-284">The UI thread retains ownership of most of the composition tree, with the touch thread owning only the few visuals that are tagged for asynchronous touch response.</span></span> <span data-ttu-id="699a9-285">下圖顯示這類組合樹狀結構的簡化版本：</span><span class="sxs-lookup"><span data-stu-id="699a9-285">The following illustration shows a simplified version of such a composition tree:</span></span>

![ui 執行緒和觸控執行緒之間共用的視覺化樹狀結構](images/shared-visual-tree-2.png)

<span data-ttu-id="699a9-287">一般而言，UI 執行緒只會修改它所擁有的視覺效果，而觸控執行緒只會修改共用視覺效果。</span><span class="sxs-lookup"><span data-stu-id="699a9-287">Typically, the UI thread modifies only the visuals that it owns exclusively, and the touch thread modifies only the shared visual.</span></span> <span data-ttu-id="699a9-288">唯一的例外狀況是建立或終結已啟用觸控的子樹。</span><span class="sxs-lookup"><span data-stu-id="699a9-288">The only exception occurs when creating or destroying a touch-enabled subtree.</span></span>

## <a name="related-topics"></a><span data-ttu-id="699a9-289">相關主題</span><span class="sxs-lookup"><span data-stu-id="699a9-289">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="699a9-290">**IDCompositionSurface::BeginDraw**</span><span class="sxs-lookup"><span data-stu-id="699a9-290">**IDCompositionSurface::BeginDraw**</span></span>](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw)
</dt> <dt>

[<span data-ttu-id="699a9-291">**IDCompositionSurface::EndDraw**</span><span class="sxs-lookup"><span data-stu-id="699a9-291">**IDCompositionSurface::EndDraw**</span></span>](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw)
</dt> <dt>

[<span data-ttu-id="699a9-292">**IDCompositonDevice：： Commit**</span><span class="sxs-lookup"><span data-stu-id="699a9-292">**IDCompositonDevice::Commit**</span></span>](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit)
</dt> <dt>

[<span data-ttu-id="699a9-293">DirectComposition 概念</span><span class="sxs-lookup"><span data-stu-id="699a9-293">DirectComposition Concepts</span></span>](directcomposition-concepts.md)
</dt> </dl>

 

 