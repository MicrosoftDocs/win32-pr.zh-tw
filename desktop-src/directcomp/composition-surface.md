---
title: 組合介面
description: 本主題說明 Microsoft DirectComposition 支援的表面類型類型。
ms.assetid: E19B4F0E-1CFA-4E93-BB6A-BFB701BC72CA
keywords:
- 組合介面
- DirectComposition 邏輯介面
- DirectComposition 虛擬介面
- 更新邏輯介面
- 邏輯介面，更新
- 修剪虛擬介面
- 虛擬介面，修剪
- 修剪虛擬介面
- 調整虛擬表面的大小
- 虛擬 surace，調整大小
- 調整虛擬表面的大小
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9f4bd30bfbd1de91444b7076184db597cd7a8c82
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/20/2020
ms.locfileid: "104023653"
---
# <a name="composition-surface"></a><span data-ttu-id="8ccbc-114">組合介面</span><span class="sxs-lookup"><span data-stu-id="8ccbc-114">Composition surface</span></span>

> [!NOTE]
> <span data-ttu-id="8ccbc-115">針對 Windows 10 上的應用程式，我們建議使用 DirectComposition，而不是使用。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-115">For apps on Windows 10, we recommend using Windows.UI.Composition APIs instead of DirectComposition.</span></span> <span data-ttu-id="8ccbc-116">如需詳細資訊，請參閱 [使用視覺分層將您的桌面應用程式現代化](/windows/uwp/composition/visual-layer-in-desktop-apps)。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-116">For more info, see [Modernize your desktop app using the Visual layer](/windows/uwp/composition/visual-layer-in-desktop-apps).</span></span>

<span data-ttu-id="8ccbc-117">本主題說明 Microsoft DirectComposition 支援的表面類型類型。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-117">This topic describes the types of types of surfaces that Microsoft DirectComposition supports.</span></span>

-   [<span data-ttu-id="8ccbc-118">DirectComposition 邏輯介面</span><span class="sxs-lookup"><span data-stu-id="8ccbc-118">DirectComposition logical surface</span></span>](#directcomposition-logical-surface)
    -   [<span data-ttu-id="8ccbc-119">更新邏輯介面</span><span class="sxs-lookup"><span data-stu-id="8ccbc-119">Updating a logical surface</span></span>](#updating-a-logical-surface)
    -   [<span data-ttu-id="8ccbc-120">暫停邏輯介面的更新</span><span class="sxs-lookup"><span data-stu-id="8ccbc-120">Suspending updates to a logical surface</span></span>](#suspending-updates-to-a-logical-surface)
    -   [<span data-ttu-id="8ccbc-121">繼續更新邏輯介面</span><span class="sxs-lookup"><span data-stu-id="8ccbc-121">Resuming updates to a logical surface</span></span>](#resuming-updates-to-a-logical-surface)
    -   [<span data-ttu-id="8ccbc-122">結束對邏輯介面的更新</span><span class="sxs-lookup"><span data-stu-id="8ccbc-122">Ending updates to a logical surface</span></span>](#suspending-updates-to-a-logical-surface)
    -   [<span data-ttu-id="8ccbc-123">使用邏輯介面的範例</span><span class="sxs-lookup"><span data-stu-id="8ccbc-123">Example of using a logical surface</span></span>](#example-of-using-a-logical-surface)
-   [<span data-ttu-id="8ccbc-124">DirectComposition 虛擬介面</span><span class="sxs-lookup"><span data-stu-id="8ccbc-124">DirectComposition virtual surface</span></span>](#directcomposition-virtual-surface)
    -   [<span data-ttu-id="8ccbc-125">調整虛擬表面的大小</span><span class="sxs-lookup"><span data-stu-id="8ccbc-125">Resizing a virtual surface</span></span>](#resizing-a-virtual-surface)
    -   [<span data-ttu-id="8ccbc-126">修剪虛擬介面</span><span class="sxs-lookup"><span data-stu-id="8ccbc-126">Trimming a virtual surface</span></span>](#trimming-a-virtual-surface)
-   [<span data-ttu-id="8ccbc-127">相關主題</span><span class="sxs-lookup"><span data-stu-id="8ccbc-127">Related topics</span></span>](#related-topics)

## <a name="directcomposition-logical-surface"></a><span data-ttu-id="8ccbc-128">DirectComposition 邏輯介面</span><span class="sxs-lookup"><span data-stu-id="8ccbc-128">DirectComposition logical surface</span></span>

<span data-ttu-id="8ccbc-129">DirectComposition 會公開 [**IDCompositionSurface**](/windows/win32/api/dcomp/nn-dcomp-idcompositionsurface) 物件來代表邏輯組合介面。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-129">DirectComposition exposes the [**IDCompositionSurface**](/windows/win32/api/dcomp/nn-dcomp-idcompositionsurface) object to represent a logical composition surface.</span></span> <span data-ttu-id="8ccbc-130">DirectComposition 會公開您可用來建立、更新及刪除這些邏輯介面的 Api。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-130">DirectComposition exposes APIs that you can use to create, update, and delete these logical surfaces.</span></span> <span data-ttu-id="8ccbc-131">每個介面都可以與一或多個視覺效果相關聯。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-131">Each surface can be associated with one or more visuals.</span></span> <span data-ttu-id="8ccbc-132">應用程式負責管理邏輯介面的存留期。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-132">An application is responsible for managing the lifetime of logical surfaces.</span></span>

### <a name="updating-a-logical-surface"></a><span data-ttu-id="8ccbc-133">更新邏輯介面</span><span class="sxs-lookup"><span data-stu-id="8ccbc-133">Updating a logical surface</span></span>

<span data-ttu-id="8ccbc-134">應用程式可以藉由呼叫 [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) ，並在應用程式想要更新的邏輯介面上指定矩形的大小和位移，來更新邏輯介面。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-134">An application can update a logical surface by calling [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) and specifying the size and offset of the rectangle on the logical surface that the app wants to update.</span></span> <span data-ttu-id="8ccbc-135">DirectComposition 會配置指定大小的矩形，然後傳回介面和應用程式需要繪製或更新的對應位移。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-135">DirectComposition allocates a rectangle of the specified size, and then returns the surface and the corresponding offset that the application needs to draw or update.</span></span> <span data-ttu-id="8ccbc-136">更新矩形的限制會依介面大小來系結。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-136">The update rectangle’s limits are bound by the surface size.</span></span> <span data-ttu-id="8ccbc-137">例如，40 100 圖元介面的更新矩形最多可 (0、0、40100) 。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-137">For example, the update rectangle for a 40-by-100 pixel surface can be up to (0,0,40,100).</span></span> <span data-ttu-id="8ccbc-138">此外，可更新的區域會由 guard 矩形強制執行。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-138">Also, the updatable region is enforced by a guard rectangle.</span></span> <span data-ttu-id="8ccbc-139">因為一次只能有一個防護矩形，所以一次只能更新一個邏輯介面。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-139">Because there can be only one guard rectangle at a time, only one logical surface can be updated at a time.</span></span> <span data-ttu-id="8ccbc-140">如果未在先前呼叫 **BeginDraw** 之後呼叫 [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw)或 [**SuspendDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw) ， **BeginDraw** 會傳回錯誤碼。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-140">**BeginDraw** returns an error code if [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) or [**SuspendDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw) has not been called after a previous call to **BeginDraw**.</span></span> <span data-ttu-id="8ccbc-141">應用程式可以將 **BeginDraw** 的認可呼叫新增至批次，但在呼叫和認可 **EndDraw** 之前不會生效。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-141">An application can add a committed call to **BeginDraw** to a batch, but it does not take effect until **EndDraw** is called and committed.</span></span>

### <a name="suspending-updates-to-a-logical-surface"></a><span data-ttu-id="8ccbc-142">暫停邏輯介面的更新</span><span class="sxs-lookup"><span data-stu-id="8ccbc-142">Suspending updates to a logical surface</span></span>

<span data-ttu-id="8ccbc-143">需要更新不同表面的應用程式可以在目前的更新上呼叫 [**SuspendDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw) ，然後呼叫 [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) 來開始新的更新。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-143">An application that needs to update different surfaces can call [**SuspendDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw) on the current update, and then call [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) to begin a new update.</span></span> <span data-ttu-id="8ccbc-144">Microsoft DirectComposition 允許多個更新，但是一次只能有一個作用中。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-144">Microsoft DirectComposition allows multiple updates, but only one can be active at a time.</span></span> <span data-ttu-id="8ccbc-145">這表示您必須先在某個介面上呼叫 **SuspendDraw** 或 [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) ，然後再于下一個介面上呼叫 **BeginDraw** 。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-145">This means that you need to call **SuspendDraw** or [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) on one surface before calling **BeginDraw** on the next one.</span></span> <span data-ttu-id="8ccbc-146">不同于 **EndDraw**，認可的批次可以包含處於 **SuspendDraw** 狀態的介面，但在呼叫 **EndDraw** 之前，這類更新將不會顯示在畫面上。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-146">Unlike **EndDraw**, a committed batch can contain a surface that is in a **SuspendDraw** state, but such updates won’t be shown on the screen until **EndDraw** is called.</span></span>

### <a name="resuming-updates-to-a-logical-surface"></a><span data-ttu-id="8ccbc-147">繼續更新邏輯介面</span><span class="sxs-lookup"><span data-stu-id="8ccbc-147">Resuming updates to a logical surface</span></span>

<span data-ttu-id="8ccbc-148">應用程式可以藉由呼叫 [**ResumeDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-resumedraw)來繼續更新處於 [**SuspendDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw)狀態的介面。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-148">An application can resume an update to a surface that is in a [**SuspendDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw) state by calling [**ResumeDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-resumedraw).</span></span> <span data-ttu-id="8ccbc-149">只有在已暫停的介面上才能呼叫這個方法。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-149">This method can be called only on a suspended surface.</span></span>

### <a name="ending-updates-to-a-logical-surface"></a><span data-ttu-id="8ccbc-150">結束對邏輯介面的更新</span><span class="sxs-lookup"><span data-stu-id="8ccbc-150">Ending updates to a logical surface</span></span>

<span data-ttu-id="8ccbc-151">呼叫 [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) 和 [**Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit) 是在螢幕上查看點陣圖更新變更的唯一方式。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-151">Calling [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) and [**Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit) is the only way to see bitmap update changes on the screen.</span></span> <span data-ttu-id="8ccbc-152">對 **EndDraw** 的每個呼叫都必須有對應的 [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) 呼叫，才能移除防護矩形。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-152">Each call to **EndDraw** must have a corresponding call to [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) to remove the guard rectangle.</span></span> <span data-ttu-id="8ccbc-153">邏輯介面會保留所有更新，直到呼叫 **Commit** 為止。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-153">The logical surface retains all the updates until **Commit** is called.</span></span> <span data-ttu-id="8ccbc-154">您也可以在處於 [**SuspendDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw)狀態的介面上呼叫 **EndDraw** ，因為 **EndDraw** 是隱含的 resume/end。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-154">You can also call **EndDraw** on a surface that is in the [**SuspendDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw) state because **EndDraw** is an implied resume/end.</span></span> <span data-ttu-id="8ccbc-155">在您呼叫 **EndDraw** 之後，更新的內容會顯示在畫面上並予以捨棄，如此一來，就可以重複使用更新的記憶體來進行後續更新。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-155">After you call **EndDraw**, the updated content is presented to the screen and discarded so that the memory for the update can be reused for a later update.</span></span>

### <a name="example-of-using-a-logical-surface"></a><span data-ttu-id="8ccbc-156">使用邏輯介面的範例</span><span class="sxs-lookup"><span data-stu-id="8ccbc-156">Example of using a logical surface</span></span>

<span data-ttu-id="8ccbc-157">下列範例說明當應用程式建立由兩個視覺效果組成的視覺化樹狀結構，然後需要更新與視覺效果相關聯的兩個邏輯介面的特定區域時，應用程式會採取的步驟：</span><span class="sxs-lookup"><span data-stu-id="8ccbc-157">The following example describes the steps that an application would take if it created a visual tree consisting of two visuals, and then needed to update specific regions of the two logical surfaces associated with the visuals:</span></span>

1.  <span data-ttu-id="8ccbc-158">建立 DirectComposition 裝置。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-158">Create a DirectComposition device.</span></span>
2.  <span data-ttu-id="8ccbc-159">建立由根節點和視覺效果1和2組成的視覺化樹狀結構。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-159">Create the visual tree consisting of a root node and visuals 1 and 2.</span></span>
3.  <span data-ttu-id="8ccbc-160">建立邏輯介面1和2。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-160">Create logical surfaces 1 and 2.</span></span>
4.  <span data-ttu-id="8ccbc-161">呼叫 [**SetContent**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-setcontent) 以將邏輯介面與視覺效果1和2產生關聯。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-161">Call [**SetContent**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-setcontent) to associate a logical surface with visuals 1 and 2.</span></span>
5.  <span data-ttu-id="8ccbc-162">在邏輯介面1的子矩形上呼叫 [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) 。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-162">Call [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) on a sub-rectangle of logical surface 1.</span></span>
6.  <span data-ttu-id="8ccbc-163">更新 DirectComposition 所傳回之位移上的介面。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-163">Update the surface at the offset returned by DirectComposition.</span></span>
7.  <span data-ttu-id="8ccbc-164">選擇性步驟：</span><span class="sxs-lookup"><span data-stu-id="8ccbc-164">Optional steps:</span></span>
    1.  <span data-ttu-id="8ccbc-165">在邏輯介面1上呼叫 [**SuspendDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw) 。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-165">Call [**SuspendDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw) on logical surface 1.</span></span>
    2.  <span data-ttu-id="8ccbc-166">在邏輯介面2的子矩形上呼叫 [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) 。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-166">Call [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) on sub-rect of logical surface 2.</span></span>
    3.  <span data-ttu-id="8ccbc-167">更新 DirectComposition 所傳回之位移上的介面。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-167">Update the surface at the offset returned by DirectComposition.</span></span>
    4.  <span data-ttu-id="8ccbc-168">在邏輯介面2上呼叫 [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) 。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-168">Call [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) on logical surface 2.</span></span>
    5.  <span data-ttu-id="8ccbc-169">在邏輯介面1上呼叫 [**ResumeDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-resumedraw) 。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-169">Call [**ResumeDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-resumedraw) on logical surface 1.</span></span>
8.  <span data-ttu-id="8ccbc-170">更新 DirectComposition 所傳回之位移上的介面。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-170">Update the surface at the offset returned by DirectComposition.</span></span>
9.  <span data-ttu-id="8ccbc-171">在邏輯介面1上呼叫 [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) 。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-171">Call [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) on logical surface 1.</span></span>
10. <span data-ttu-id="8ccbc-172">呼叫 [**Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit)。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-172">Call [**Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit).</span></span>

## <a name="directcomposition-virtual-surface"></a><span data-ttu-id="8ccbc-173">DirectComposition 虛擬介面</span><span class="sxs-lookup"><span data-stu-id="8ccbc-173">DirectComposition virtual surface</span></span>

<span data-ttu-id="8ccbc-174">DirectComposition 會公開 [**IDCompositionVirtualSurface**](/windows/win32/api/dcomp/nn-dcomp-idcompositionvirtualsurface) 介面，以代表一個虛擬介面，也就是邏輯介面的集合 (圖格) 排列在固定的方格中，並具有固定大小的磚。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-174">DirectComposition exposes the [**IDCompositionVirtualSurface**](/windows/win32/api/dcomp/nn-dcomp-idcompositionvirtualsurface) interface to represent a virtual surface, which is a collection of logical surfaces (tiles) arranged in a fixed grid with tiles of a fixed size.</span></span> <span data-ttu-id="8ccbc-175">應用程式會在建立時指定虛擬材質的大小。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-175">The application specifies the size of the virtual texture at creation time.</span></span> <span data-ttu-id="8ccbc-176">大小會建立虛擬介面的界限。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-176">The size establishes the boundaries for the virtual surface.</span></span> <span data-ttu-id="8ccbc-177">介面可以與一或多個視覺效果相關聯。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-177">The surface can be associated with one or more visuals.</span></span>

<span data-ttu-id="8ccbc-178">當虛擬介面初始化時，不會受到實際配置的支援。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-178">When a virtual surface is initialized, it is not backed by actual allocations.</span></span> <span data-ttu-id="8ccbc-179">換句話說，它並不會保留任何位。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-179">In other words, it doesn’t hold any bits.</span></span> <span data-ttu-id="8ccbc-180">DirectComposition 會配置磚 (也就是，在應用程式開始更新介面之後) 組合表面物件。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-180">DirectComposition allocates tiles (that is, composition surface objects) after the application starts updating the surface.</span></span> <span data-ttu-id="8ccbc-181">應用程式會藉由呼叫 [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) ，並指定與虛擬介面座標相關的區域，來更新虛擬介面。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-181">The application updates the virtual surface by calling [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) and specifying the region of interest with respect to the coordinates of the virtual surface.</span></span> <span data-ttu-id="8ccbc-182">然後，DirectComposition 會配置必要的磚來保存更新，並傳回復合介面和 offset 以進行更新。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-182">Then, DirectComposition allocates the necessary tiles to hold the update, and returns the composition surface and offset to update.</span></span>

<span data-ttu-id="8ccbc-183">如同邏輯介面，您可以在虛擬介面上呼叫 [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw)、 [**SuspendDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw)、 [**ResumeDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-resumedraw) 和 [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) 。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-183">As with logical surfaces, you can call [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw), [**SuspendDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw), [**ResumeDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-resumedraw) and [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) on a virtual surface.</span></span> <span data-ttu-id="8ccbc-184">此外，DirectComposition 會公開可用來調整大小和修剪現有虛擬介面的方法。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-184">In addition, DirectComposition exposes methods that you can use to resize and trim an existing virtual surface.</span></span>

### <a name="resizing-a-virtual-surface"></a><span data-ttu-id="8ccbc-185">調整虛擬表面的大小</span><span class="sxs-lookup"><span data-stu-id="8ccbc-185">Resizing a virtual surface</span></span>

<span data-ttu-id="8ccbc-186">重 [**設大小**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvirtualsurface-resize) 方法會變更虛擬介面的界限，這表示任何新的更新或配置都必須落在新大小所設定的界限內。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-186">The [**Resize**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvirtualsurface-resize) method changes the boundaries of the virtual surface, meaning that any new updates or allocations must fall in the boundaries set by the new size.</span></span> <span data-ttu-id="8ccbc-187">應用程式會使用重 **設大小** 來告訴 DirectComposition，虛擬介面的特定區域不再需要，而且可以回收。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-187">An application uses **Resize** to tell DirectComposition that a particular region of the virtual surface is no longer needed and can be reclaimed.</span></span> <span data-ttu-id="8ccbc-188">如果重 **設大小** 會縮小虛擬介面，應用程式就無法再更新新界限以外的區域。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-188">If **Resize** shrinks the virtual surface, the application can no longer update the regions outside the new boundaries.</span></span>

<span data-ttu-id="8ccbc-189">下圖顯示 3 x 3 的虛擬介面，調整大小為2。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-189">The following illustration shows a 3-by-3 virtual surface resized to 2-by-2.</span></span> <span data-ttu-id="8ccbc-190">紅色區域代表在調整大小作業中捨棄的圖格，而 DirectComposition 會回收記憶體。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-190">The red region represents tiles that are discarded as part of the resize operation, and the memory is reclaimed by DirectComposition.</span></span> <span data-ttu-id="8ccbc-191">在調整大小之後，應用程式無法在不重新調整虛擬介面大小的情況下，對紅色區域進行更新。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-191">After the resize, the application can't make updates to the red region without resizing the virtual surface again.</span></span>

![<span data-ttu-id="8ccbc-192">調整虛擬表面的大小</span><span class="sxs-lookup"><span data-stu-id="8ccbc-192">resizing a virtual surface</span></span> ](images/resize-virtual-surface.png)

<span data-ttu-id="8ccbc-193">調整大小作業會立即生效。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-193">The resize operation takes effect immediately.</span></span> <span data-ttu-id="8ccbc-194">DirectComposition 不會等待應用程式呼叫 [**Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit) 以進行調整大小的更新。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-194">DirectComposition doesn't wait for the application to call [**Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit) to make the resize updates.</span></span> <span data-ttu-id="8ccbc-195">例如，假設應用程式會進行下列呼叫順序。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-195">For example, suppose an application makes the following sequence of calls.</span></span>


```
pVirtualSurface->Resize(0, 0);
pVirtualSurface->Resize(INT_MAX, INT_MAX);
pDevice->Commit();
```



<span data-ttu-id="8ccbc-196">在此範例中，應用程式會失去第一次調整大小的所有內容。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-196">In this example, the application loses all content on the first resize.</span></span> <span data-ttu-id="8ccbc-197">第二個調整大小沒有任何作用，即使在 [**Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit)之前呼叫它也一樣。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-197">The second resize has no effect even though it was called before [**Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit).</span></span> <span data-ttu-id="8ccbc-198">在此情況下，螢幕上不會顯示任何內容。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-198">In this case nothing shows on the screen.</span></span>

### <a name="trimming-a-virtual-surface"></a><span data-ttu-id="8ccbc-199">修剪虛擬介面</span><span class="sxs-lookup"><span data-stu-id="8ccbc-199">Trimming a virtual surface</span></span>

<span data-ttu-id="8ccbc-200">[**Trim**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvirtualsurface-trim)方法會識別應用程式所需的虛擬介面區域。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-200">The [**Trim**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvirtualsurface-trim) method identifies the region of the virtual surface that the application needs.</span></span> <span data-ttu-id="8ccbc-201">它不會調整虛擬介面界限的大小，但會告訴 DirectComposition 目前需要配置哪些邏輯表面。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-201">It doesn't resize the boundaries of the virtual surface, but it does tell DirectComposition which logical surfaces currently need to be allocated.</span></span>

<span data-ttu-id="8ccbc-202">在下圖中，綠色方形是應用程式的視口。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-202">In the following illustration, the green square is the application’s viewport.</span></span> <span data-ttu-id="8ccbc-203">應用程式一開始會轉譯為虛擬介面 (藍色) 的前六個磚， (位於此圖格的淺灰色) 。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-203">The application initially renders to the first six tiles (blue) of the virtual surface (light gray) that are in the viewport.</span></span> <span data-ttu-id="8ccbc-204">當虛擬介面所表示的頁面滾動時，應用程式需要轉譯最後六個磚。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-204">As the page that is represented by the virtual surface scrolls, the application needs to render the last six tiles.</span></span> <span data-ttu-id="8ccbc-205">應用程式會呼叫 [**Trim**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvirtualsurface-trim) 來指出最後六個磚所定義的區域是內容所在的位置，而其餘的時間則不需要。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-205">The application calls [**Trim**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvirtualsurface-trim) to indicate that the region defined by the last six tiles is where the content is, and the rest is not needed at the moment.</span></span> <span data-ttu-id="8ccbc-206">DirectComposition 接著可以選擇回收最初表示前六個磚的邏輯表面 (暗灰色) 。</span><span class="sxs-lookup"><span data-stu-id="8ccbc-206">DirectComposition can then choose to recycle the logical surfaces that originally represented the first six tiles (dark gray).</span></span>

![修剪虛擬介面](images/trim-virtual-surface.png)

## <a name="related-topics"></a><span data-ttu-id="8ccbc-208">相關主題</span><span class="sxs-lookup"><span data-stu-id="8ccbc-208">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="8ccbc-209">DirectComposition 概念</span><span class="sxs-lookup"><span data-stu-id="8ccbc-209">DirectComposition Concepts</span></span>](directcomposition-concepts.md)
</dt> </dl>

 

 