---
title: OLE 元件物件模型
description: OLE 元件物件模型
ms.assetid: f3200d81-c2fa-4cc7-bf85-54f6c753a529
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 211c41de8c16eb1cabb1e62f475adbbf603e2c92
ms.sourcegitcommit: 52d79b29f3b9933c8bef43207ff80c668a81cb73
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/20/2020
ms.locfileid: "103933710"
---
# <a name="the-ole-component-object-model"></a><span data-ttu-id="0c870-103">OLE 元件物件模型</span><span class="sxs-lookup"><span data-stu-id="0c870-103">The OLE Component Object Model</span></span>

<span data-ttu-id="0c870-104">AVIFile 程式庫所使用的物件都是 OLE 元件物件模型的一部分。</span><span class="sxs-lookup"><span data-stu-id="0c870-104">The objects used by the AVIFile library are all part of the OLE Component Object Model.</span></span> <span data-ttu-id="0c870-105">這主要是指它們共用一些可讓您更容易使用的方法，而它們所傳回的值是大部分 OLE 介面方法的通用值。</span><span class="sxs-lookup"><span data-stu-id="0c870-105">Primarily, this means they share certain methods that make them easier to work with, and the values they return are common to most OLE interface methods.</span></span>

<span data-ttu-id="0c870-106">檔案和資料流程處理常式的 OLE 元件物件模型會使用 OLE **IClassFactory** 介面來建立其物件類別的實例。</span><span class="sxs-lookup"><span data-stu-id="0c870-106">The OLE Component Object Model of the file and stream handlers uses the OLE **IClassFactory** interface to create instances of their object class.</span></span> <span data-ttu-id="0c870-107">作為元件物件時，它們會執行 [IUnknown](/windows/win32/api/unknwn/nn-unknwn-iunknown) 介面，其中包含 [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(refiid_void))、 [**Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release)和 [**AddRef**](/windows/win32/api/unknwn/nf-unknwn-iunknown-addref) 方法。</span><span class="sxs-lookup"><span data-stu-id="0c870-107">As component objects, they implement the [IUnknown](/windows/win32/api/unknwn/nn-unknwn-iunknown) interface, which consists of the [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(refiid_void)), [**Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release), and [**AddRef**](/windows/win32/api/unknwn/nf-unknwn-iunknown-addref) methods.</span></span> <span data-ttu-id="0c870-108">**IUnknown** 介面可讓應用程式取得相同物件所支援之其他介面的指標。</span><span class="sxs-lookup"><span data-stu-id="0c870-108">The **IUnknown** interface lets an application obtain pointers to other interfaces supported by the same object.</span></span>

<span data-ttu-id="0c870-109">您可以使用 **QueryInterface** 方法來判斷物件是否支援特定介面。</span><span class="sxs-lookup"><span data-stu-id="0c870-109">You can determine if an object supports a specific interface by using the **QueryInterface** method.</span></span> <span data-ttu-id="0c870-110">如果物件支援指定的介面， **QueryInterface** 會傳回該介面的指標。</span><span class="sxs-lookup"><span data-stu-id="0c870-110">If an object supports a specified interface, **QueryInterface** returns a pointer to that interface.</span></span>

<span data-ttu-id="0c870-111">您可以使用 [**AddRef**](/previous-versions//dd757100(v=vs.85)) 和 [**發行**](/previous-versions//dd757102(v=vs.85)) 方法，來遞增和遞減與物件相關聯的參考計數。</span><span class="sxs-lookup"><span data-stu-id="0c870-111">You can increment and decrement the reference count associated with an object by using the [**AddRef**](/previous-versions//dd757100(v=vs.85)) and [**Release**](/previous-versions//dd757102(v=vs.85)) methods.</span></span> <span data-ttu-id="0c870-112">參考計數可讓多個用戶端存取物件。</span><span class="sxs-lookup"><span data-stu-id="0c870-112">The reference count lets multiple clients access an object.</span></span> <span data-ttu-id="0c870-113">當第一個應用程式使用物件時，它的參考計數會設定為1。</span><span class="sxs-lookup"><span data-stu-id="0c870-113">When an object is used by the first application, its reference count is set to 1.</span></span> <span data-ttu-id="0c870-114">然後，應用程式會使用 **AddRef** 方法來遞增計數，讓物件能夠追蹤其存取次數。</span><span class="sxs-lookup"><span data-stu-id="0c870-114">Applications subsequently use the **AddRef** method to increment the count to let the object keep track of the number of times it is accessed.</span></span>

<span data-ttu-id="0c870-115">當應用程式使用物件完成時，它會呼叫 **Release** 方法來遞減參考計數。</span><span class="sxs-lookup"><span data-stu-id="0c870-115">When an application is done using an object, it calls the **Release** method to decrement the reference count.</span></span> <span data-ttu-id="0c870-116">當參考計數為零時，就不再需要物件， **釋放** 會釋出其使用的任何資源，並終結物件。</span><span class="sxs-lookup"><span data-stu-id="0c870-116">When the reference count is zero, the object is no longer needed and **Release** frees any resources it uses and destroys the object.</span></span> <span data-ttu-id="0c870-117">因為物件使用對應用程式而言是透明的內部資源，所以物件會負責釋放這些資源。</span><span class="sxs-lookup"><span data-stu-id="0c870-117">Because an object uses internal resources transparent to the application, the object is responsible for freeing them.</span></span> <span data-ttu-id="0c870-118">例如，在發行時，檔案處理常式可能需要關閉開啟的磁片檔案和可用的緩衝區記憶體。</span><span class="sxs-lookup"><span data-stu-id="0c870-118">For example, a file handler might need to close open disk files and free buffer memory when released.</span></span>

<span data-ttu-id="0c870-119">大部分的 OLE 介面方法都會傳回使用 **HRESULT** 資料類型定義的結果控制碼。</span><span class="sxs-lookup"><span data-stu-id="0c870-119">Most OLE interface methods return result handles that are defined by using the **HRESULT** data type.</span></span> <span data-ttu-id="0c870-120">此資料類型是由嚴重性代碼、內容資訊、設施碼和狀態碼所組成。</span><span class="sxs-lookup"><span data-stu-id="0c870-120">This data type is made of a severity code, contextual information, a facility code, and a status code.</span></span> <span data-ttu-id="0c870-121">傳回結果控制碼，指出 success 的值為零。</span><span class="sxs-lookup"><span data-stu-id="0c870-121">A return result handle that indicates success has the value zero.</span></span> <span data-ttu-id="0c870-122">非零值表示失敗，而傳回結果控制碼的狀態碼成員會提供其他轉譯的基礎。</span><span class="sxs-lookup"><span data-stu-id="0c870-122">A nonzero value indicates failure and the status code member of the return result handle provides a basis for additional interpretation.</span></span> <span data-ttu-id="0c870-123">如需 OLE 傳回結果控制碼的詳細資訊，請參閱 Ole 程式設計 *人員參考*。</span><span class="sxs-lookup"><span data-stu-id="0c870-123">For additional information about OLE return result handles, see the *OLE Programmer's Reference*.</span></span>

 

 