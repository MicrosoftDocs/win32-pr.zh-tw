---
title: Image-Data 解壓縮
description: Image-Data 解壓縮
ms.assetid: 4bff02be-dac8-41f4-a3af-2da6a2693ffe
keywords:
- 影片壓縮管理員 (BC-VCM-LVM-HYPERV) 、映射資料解壓縮
- BC-VCM-LVM-HYPERV (video 壓縮管理員) ，映射-資料解壓縮
- ICDecompressEx 函式
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 25614f157436056f7f24c340f6cc6f4dbc62d9ae
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/19/2020
ms.locfileid: "104314869"
---
# <a name="image-data-decompression"></a><span data-ttu-id="f59d6-106">Image-Data 解壓縮</span><span class="sxs-lookup"><span data-stu-id="f59d6-106">Image-Data Decompression</span></span>

<span data-ttu-id="f59d6-107">您的應用程式會使用一系列的 [**ICDecompressEx**](/windows/desktop/api/Vfw/nf-vfw-icdecompressex) 函式來控制解壓縮程式。</span><span class="sxs-lookup"><span data-stu-id="f59d6-107">Your application uses a series of [**ICDecompressEx**](/windows/desktop/api/Vfw/nf-vfw-icdecompressex) functions to control the decompressor.</span></span> <span data-ttu-id="f59d6-108">這些函式可協助您執行下列工作：</span><span class="sxs-lookup"><span data-stu-id="f59d6-108">The functions can help you perform the following tasks:</span></span>

-   <span data-ttu-id="f59d6-109">選取解壓縮。</span><span class="sxs-lookup"><span data-stu-id="f59d6-109">Select a decompressor.</span></span>
-   <span data-ttu-id="f59d6-110">準備解壓縮解壓縮。</span><span class="sxs-lookup"><span data-stu-id="f59d6-110">Prepare the decompressor.</span></span>
-   <span data-ttu-id="f59d6-111">將資料解壓縮。</span><span class="sxs-lookup"><span data-stu-id="f59d6-111">Decompress the data.</span></span>
-   <span data-ttu-id="f59d6-112">結束解壓縮。</span><span class="sxs-lookup"><span data-stu-id="f59d6-112">End decompression.</span></span>

<span data-ttu-id="f59d6-113">您的應用程式處理壓縮的方式類似于處理壓縮的方式，不同之處在于輸入格式是壓縮格式，而且輸出格式是可顯示的格式。</span><span class="sxs-lookup"><span data-stu-id="f59d6-113">Your application handles decompression similarly to the way it handles compression, except that the input format is a compressed format and the output format is a displayable format.</span></span> <span data-ttu-id="f59d6-114">解壓縮的輸入格式通常是從資料流程標頭取得。</span><span class="sxs-lookup"><span data-stu-id="f59d6-114">The input format for decompression is usually obtained from the stream header.</span></span> <span data-ttu-id="f59d6-115">判斷輸入格式之後，您的應用程式可以使用 [**ICLocate**](/windows/desktop/api/Vfw/nf-vfw-iclocate) 或 [**ICOpen**](/windows/desktop/api/Vfw/nf-vfw-icopen) 函式來尋找可以處理它的解壓縮程式。</span><span class="sxs-lookup"><span data-stu-id="f59d6-115">After determining the input format, your application can use the [**ICLocate**](/windows/desktop/api/Vfw/nf-vfw-iclocate) or [**ICOpen**](/windows/desktop/api/Vfw/nf-vfw-icopen) functions to find a decompressor that can handle it.</span></span>

<span data-ttu-id="f59d6-116">[**ICDecompressEx**](/windows/desktop/api/Vfw/nf-vfw-icdecompressex)函式和宏是 [**ICDecompress**](/windows/desktop/api/Vfw/nf-vfw-icdecompress)函式群組的超集合，並提供更多功能。</span><span class="sxs-lookup"><span data-stu-id="f59d6-116">The [**ICDecompressEx**](/windows/desktop/api/Vfw/nf-vfw-icdecompressex) functions and macros are a superset of the [**ICDecompress**](/windows/desktop/api/Vfw/nf-vfw-icdecompress) function group and provide more capabilities.</span></span> <span data-ttu-id="f59d6-117">**ICDecompressEx**、 [**ICDecompressExBegin**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexbegin)、 [**ICDecompressExEnd**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexend)和 [**ICDecompressExQuery**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexquery)的功能取代 **ICDecompress**、 [**ICDecompressBegin**](/windows/desktop/api/Vfw/nf-vfw-icdecompressbegin)、 [**ICDecompressEnd**](/windows/desktop/api/Vfw/nf-vfw-icdecompressend)和 [**ICDecompressQuery**](/windows/desktop/api/Vfw/nf-vfw-icdecompressquery)函式的功能。</span><span class="sxs-lookup"><span data-stu-id="f59d6-117">The functionality of **ICDecompressEx**, [**ICDecompressExBegin**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexbegin), [**ICDecompressExEnd**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexend), and [**ICDecompressExQuery**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexquery) replaces that of the **ICDecompress**, [**ICDecompressBegin**](/windows/desktop/api/Vfw/nf-vfw-icdecompressbegin), [**ICDecompressEnd**](/windows/desktop/api/Vfw/nf-vfw-icdecompressend), and [**ICDecompressQuery**](/windows/desktop/api/Vfw/nf-vfw-icdecompressquery) functions.</span></span> <span data-ttu-id="f59d6-118">使用 **ICDecompressEx** 函式和宏取代 **ICDecompress** 對應專案。</span><span class="sxs-lookup"><span data-stu-id="f59d6-118">Use the **ICDecompressEx** functions and macros in place of the **ICDecompress** equivalents.</span></span>

## <a name="decompressor-and-decompression-format-selection"></a><span data-ttu-id="f59d6-119">解壓縮和解壓縮格式選取專案</span><span class="sxs-lookup"><span data-stu-id="f59d6-119">Decompressor and Decompression Format Selection</span></span>

<span data-ttu-id="f59d6-120">如果您想要解壓縮資料，而您的應用程式需要特定的輸出格式，您可以使用 [**ICDecompressExQuery**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexquery) 函數來查詢解壓縮程式，以判斷它是否支援輸入和輸出格式。</span><span class="sxs-lookup"><span data-stu-id="f59d6-120">If you want to decompress data and your application requires a specific output format, you can use the [**ICDecompressExQuery**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexquery) function to query the decompressor to determine if it supports the input and output formats.</span></span>

<span data-ttu-id="f59d6-121">如果輸出格式在您的應用程式中並不重要，您只需要尋找可以處理輸入格式的解壓縮程式。</span><span class="sxs-lookup"><span data-stu-id="f59d6-121">If the output format is not important in your application, you need only find a decompressor that can handle the input format.</span></span> <span data-ttu-id="f59d6-122">若要判斷解壓縮程式是否可以處理輸入格式，請使用 [**ICDecompressExQuery**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexquery)並為 *LpbiDst* 參數指定 **Null** 。</span><span class="sxs-lookup"><span data-stu-id="f59d6-122">To determine if a decompressor can handle the input format, use [**ICDecompressExQuery**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexquery) and specify **NULL** for the *lpbiDst* parameter.</span></span> <span data-ttu-id="f59d6-123">您的應用程式可以藉由傳送 [**ICM \_ 解壓縮 \_ 取得 \_ 格式**](icm-decompress-get-format.md) 訊息 (或使用 [**ICDecompressGetFormatSize**](/windows/desktop/api/Vfw/nf-vfw-icdecompressgetformatsize) 宏) ，判斷指定解壓縮格式的資料所需的緩衝區大小。</span><span class="sxs-lookup"><span data-stu-id="f59d6-123">Your application can determine the buffer size needed for the data specifying the decompression format by sending the [**ICM\_DECOMPRESS\_GET\_FORMAT**](icm-decompress-get-format.md) message (or use the [**ICDecompressGetFormatSize**](/windows/desktop/api/Vfw/nf-vfw-icdecompressgetformatsize) macro).</span></span> <span data-ttu-id="f59d6-124">您也可以傳送 **ICM \_ 解壓縮 \_ 取得 \_ 格式** (或 [**ICDecompressGetFormat**](/windows/desktop/api/Vfw/nf-vfw-icdecompressgetformat) 宏) 來取出格式資料。</span><span class="sxs-lookup"><span data-stu-id="f59d6-124">You can also send **ICM\_DECOMPRESS\_GET\_FORMAT** (or the [**ICDecompressGetFormat**](/windows/desktop/api/Vfw/nf-vfw-icdecompressgetformat) macro) to retrieve the format data.</span></span> <span data-ttu-id="f59d6-125">解壓縮解壓縮會在 [**BITMAPINFO**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfo) 結構中傳回其建議的格式。</span><span class="sxs-lookup"><span data-stu-id="f59d6-125">The decompressor returns its suggested format in a [**BITMAPINFO**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfo) structure.</span></span> <span data-ttu-id="f59d6-126">此格式通常會在解壓縮期間保留大部分的資訊。</span><span class="sxs-lookup"><span data-stu-id="f59d6-126">This format typically preserves the most information during decompression.</span></span> <span data-ttu-id="f59d6-127">您的應用程式應該在解壓縮資訊之前，確保解壓縮程式會成功傳回。</span><span class="sxs-lookup"><span data-stu-id="f59d6-127">Your application should ensure that the decompressor returns successfully before it decompresses the information.</span></span>

<span data-ttu-id="f59d6-128">因為您的應用程式會配置解壓縮所需的記憶體，所以必須判斷解壓縮程式針對輸出格式所能要求的最大記憶體。</span><span class="sxs-lookup"><span data-stu-id="f59d6-128">Because your application allocates the memory required for decompression, it needs to determine the maximum memory the decompressor can require for the output format.</span></span> <span data-ttu-id="f59d6-129">**ICM \_ 解壓縮 \_ 取得 \_ 格式** 訊息會取得解壓縮程式針對預設格式使用的位元組數目。</span><span class="sxs-lookup"><span data-stu-id="f59d6-129">The **ICM\_DECOMPRESS\_GET\_FORMAT** message obtains the number of bytes the decompressor uses for the default format.</span></span>

<span data-ttu-id="f59d6-130">如果您的應用程式使用 [**ICDecompressExQuery**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexquery)來定義它自己的格式，它也必須取得點陣圖的調色板。 **ICDecompressExQuery** 不提供調色板定義。</span><span class="sxs-lookup"><span data-stu-id="f59d6-130">If your application defines its own format by using [**ICDecompressExQuery**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexquery), it must also obtain a palette for the bitmap; **ICDecompressExQuery** does not provide palette definitions.</span></span> <span data-ttu-id="f59d6-131"> (大部分的應用程式都使用標準格式，且不需要取得調色板。 ) 您的應用程式可以傳送 [**ICM \_ 解壓縮 \_ GET \_**](icm-decompress-get-palette.md) 選擇區訊息來取得調色板， (或使用 [**ICDecompressGetPalette**](/windows/desktop/api/Vfw/nf-vfw-icdecompressgetpalette) 宏) 。</span><span class="sxs-lookup"><span data-stu-id="f59d6-131">(Most applications use standard formats and do not need to obtain a palette.) Your application can obtain the palette by sending the [**ICM\_DECOMPRESS\_GET\_PALETTE**](icm-decompress-get-palette.md) message (or use the [**ICDecompressGetPalette**](/windows/desktop/api/Vfw/nf-vfw-icdecompressgetpalette) macro).</span></span>

## <a name="decompressor-initialization"></a><span data-ttu-id="f59d6-132">解壓縮初始化</span><span class="sxs-lookup"><span data-stu-id="f59d6-132">Decompressor Initialization</span></span>

<span data-ttu-id="f59d6-133">當您的應用程式選取的解壓縮程式可處理所需的輸入和輸出格式時，您可以使用 [**ICDecompressExBegin**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexbegin) 函式來初始化解壓縮程式。</span><span class="sxs-lookup"><span data-stu-id="f59d6-133">After your application selects a decompressor that can handle the input and output formats it needs, you can initialize the decompressor by using the [**ICDecompressExBegin**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexbegin) function.</span></span> <span data-ttu-id="f59d6-134">此函式需要解壓縮控制碼以及輸入和輸出格式。</span><span class="sxs-lookup"><span data-stu-id="f59d6-134">This function requires the decompressor handle and the input and output formats.</span></span>

## <a name="data-decompression"></a><span data-ttu-id="f59d6-135">資料解壓縮</span><span class="sxs-lookup"><span data-stu-id="f59d6-135">Data Decompression</span></span>

<span data-ttu-id="f59d6-136">您可以使用 [**ICDecompressEx**](/windows/desktop/api/Vfw/nf-vfw-icdecompressex) 函式來解壓縮框架。</span><span class="sxs-lookup"><span data-stu-id="f59d6-136">You can use the [**ICDecompressEx**](/windows/desktop/api/Vfw/nf-vfw-icdecompressex) function to decompress a frame.</span></span> <span data-ttu-id="f59d6-137">您的應用程式必須重複使用這個函式，直到序列中的所有框架都已解壓縮為止。</span><span class="sxs-lookup"><span data-stu-id="f59d6-137">Your application must use this function repeatedly until all the frames in a sequence are decompressed.</span></span>

<span data-ttu-id="f59d6-138">如果您的影片串流在播放期間落後其他元件 (例如音訊) ，您的應用程式可以指定 **ICDECOMPRESS \_ HURRYUP** 旗標來加速解壓縮。</span><span class="sxs-lookup"><span data-stu-id="f59d6-138">If your video stream lags behind other components (such as audio) during playback, your application can specify the **ICDECOMPRESS\_HURRYUP** flag to speed decompression.</span></span> <span data-ttu-id="f59d6-139">若要這樣做，解壓縮可能只會解壓縮下一個框架所需的資訊，而不會完全解壓縮目前的畫面格。</span><span class="sxs-lookup"><span data-stu-id="f59d6-139">To do this, a decompressor might extract only the information it needs to decompress the next frame and not fully decompress the current frame.</span></span> <span data-ttu-id="f59d6-140">因此，當您的應用程式使用這個旗標時，不應該嘗試繪製解壓縮的資料。</span><span class="sxs-lookup"><span data-stu-id="f59d6-140">Therefore, your application should not try to draw the decompressed data when it uses this flag.</span></span>

<span data-ttu-id="f59d6-141">當您的應用程式將資料解壓縮之後，它就可以傳送 [**ICM \_ DECOMPRESSEX \_ END**](icm-decompressex-end.md) Message (或使用 [**ICDecompressExEnd**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexend) 宏) 通知解壓縮程式已完成。</span><span class="sxs-lookup"><span data-stu-id="f59d6-141">After your application has decompressed the data, it can send the [**ICM\_DECOMPRESSEX\_END**](icm-decompressex-end.md) message (or use the [**ICDecompressExEnd**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexend) macro) to notify the decompressor that it has finished.</span></span> <span data-ttu-id="f59d6-142">如果您想要在使用此函式之後重新開機解壓縮，您的應用程式必須使用 [**ICDecompressExBegin**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexbegin)重新初始化解壓縮程式。</span><span class="sxs-lookup"><span data-stu-id="f59d6-142">If you want to restart decompression after using this function, your application must reinitialize the decompressor by using [**ICDecompressExBegin**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexbegin).</span></span>

## <a name="related-topics"></a><span data-ttu-id="f59d6-143">相關主題</span><span class="sxs-lookup"><span data-stu-id="f59d6-143">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="f59d6-144">BC-VCM-LVM-HYPERV 服務</span><span class="sxs-lookup"><span data-stu-id="f59d6-144">VCM Services</span></span>](vcm-services.md)
</dt> </dl>

 

 