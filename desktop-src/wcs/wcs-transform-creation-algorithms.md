---
title: WCS 轉換建立演算法
description: WCS 轉換建立演算法
ms.assetid: 526bbbfc-fb60-415d-b4f0-6a44a5d11a55
keywords:
- Windows Color System (WCS) 、轉換建立
- WCS (Windows 色彩系統) ，轉換建立
- 影像色彩管理、轉換建立
- 色彩管理，轉換建立
- 色彩，轉換建立
- 轉換建立
- WCS 轉換建立
- 演算法，轉換建立
ms.localizationpriority: high
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 418596c0e57571f3e504727d4606921d36ff9461
ms.sourcegitcommit: d39e82e232f6510f843fdb8d55d25b4e9e02e880
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 02/03/2021
ms.locfileid: "104571500"
---
# <a name="wcs-transform-creation-algorithms"></a><span data-ttu-id="5bdfa-111">WCS 轉換建立演算法</span><span class="sxs-lookup"><span data-stu-id="5bdfa-111">WCS Transform Creation Algorithms</span></span>

[<span data-ttu-id="5bdfa-112">建立轉換</span><span class="sxs-lookup"><span data-stu-id="5bdfa-112">Creation of Transforms</span></span>](#creation-of-transforms)

 

[<span data-ttu-id="5bdfa-113">順序轉換執行</span><span class="sxs-lookup"><span data-stu-id="5bdfa-113">Sequential Transform Execution</span></span>](#sequential-transform-execution)

 

[<span data-ttu-id="5bdfa-114">建立優化的轉換</span><span class="sxs-lookup"><span data-stu-id="5bdfa-114">Creation of Optimized Transforms</span></span>](#creation-of-optimized-transforms)

 

[<span data-ttu-id="5bdfa-115">ICCProfileFromWCSProfile</span><span class="sxs-lookup"><span data-stu-id="5bdfa-115">ICCProfileFromWCSProfile</span></span>](#iccprofilefromwcsprofile)

 

[<span data-ttu-id="5bdfa-116">黑色保留和黑色世代</span><span class="sxs-lookup"><span data-stu-id="5bdfa-116">Black Preservation and Black Generation</span></span>](#black-preservation-and-black-generation)

 

[<span data-ttu-id="5bdfa-117">檢查 Gamut</span><span class="sxs-lookup"><span data-stu-id="5bdfa-117">Check Gamut</span></span>](#checkgamut)

## <a name="creation-of-transforms"></a><span data-ttu-id="5bdfa-118">建立轉換</span><span class="sxs-lookup"><span data-stu-id="5bdfa-118">Creation of Transforms</span></span>

<span data-ttu-id="5bdfa-119">若要適當地說明色彩轉換的運作方式，請透過 ICM 2.0 和 CTE 的內部說明完整的處理路徑。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-119">To properly explain how color transforms work, it is helpful to explain the complete processing path through both ICM 2.0 and the internals of the CTE.</span></span> <span data-ttu-id="5bdfa-120">ICM 2.0 [**CreateColorTransformW**](/windows/win32/api/icm/nf-icm-createcolortransformw) 函式會建立應用程式可用來執行色彩管理的色彩轉換。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-120">The ICM 2.0 [**CreateColorTransformW**](/windows/win32/api/icm/nf-icm-createcolortransformw) function creates a color transform that applications can use to perform color management.</span></span> <span data-ttu-id="5bdfa-121">此函式會從 [**LOGCOLORSPACE**](/windows/desktop/api/Wingdi/ns-wingdi-taglogcolorspacea) 和意圖輸入建立色彩內容。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-121">This function creates a color context from the [**LOGCOLORSPACE**](/windows/desktop/api/Wingdi/ns-wingdi-taglogcolorspacea) and intent inputs.</span></span> <span data-ttu-id="5bdfa-122">這些意圖會對應至基準 ICC gamut 對應演算法相互關聯。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-122">The intents are mapped to baseline ICC gamut mapping algorithm correlates.</span></span> <span data-ttu-id="5bdfa-123">然後，此函式會呼叫 ICM 2.0 函式 [**CreateMultiProfileTransform**](/windows/desktop/api/Wingdi/) ，以進行一致的色彩處理。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-123">The function then calls ICM 2.0 function [**CreateMultiProfileTransform**](/windows/desktop/api/Wingdi/) for consistent color processing.</span></span> <span data-ttu-id="5bdfa-124">**CreateColorTransform** 函數通常會將資料複製到內部優化的轉換結構。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-124">The **CreateColorTransform** function generally copies data into the internal optimized transform structure.</span></span>

<span data-ttu-id="5bdfa-125">ICM 2.0 CreateMultiProfileTransform 函式會接受設定檔陣列和意圖陣列，或單一裝置連結設定檔，並建立應用程式可用來執行色彩對應的色彩轉換。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-125">The ICM 2.0 CreateMultiProfileTransform function accepts an array of profiles and an array of intents or a single device link profile and creates a color transform that applications can use to perform color mapping.</span></span> <span data-ttu-id="5bdfa-126">它會處理這些輸入設定檔和意圖，以建立裝置模型、色彩外觀模型、gamut 界限描述和範圍對應模型。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-126">It processes those input profiles and intents to create device models, color appearance models, gamut boundary descriptions, and gamut mapping models.</span></span> <span data-ttu-id="5bdfa-127">做法如下：</span><span class="sxs-lookup"><span data-stu-id="5bdfa-127">Here's how this is done:</span></span>

-   <span data-ttu-id="5bdfa-128">裝置模型會直接從 DM 設定檔初始化。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-128">Device models are initialized directly from DM profiles.</span></span> <span data-ttu-id="5bdfa-129">在 [**CreateMultiProfileTransform**](/windows/desktop/api/Wingdi/)的呼叫中，會為每個設定檔建立一個裝置模型。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-129">There is one device model created for each profile in the call to [**CreateMultiProfileTransform**](/windows/desktop/api/Wingdi/).</span></span>
-   <span data-ttu-id="5bdfa-130">色彩外觀模型會直接從 CAM 設定檔初始化。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-130">Color appearance models are initialized directly from CAM profiles.</span></span> <span data-ttu-id="5bdfa-131">[**CreateMultiProfileTransform**](/windows/desktop/api/Wingdi/)呼叫中的每個設定檔都有一個 CAM 設定檔。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-131">There is one CAM profile for each profile in the call to [**CreateMultiProfileTransform**](/windows/desktop/api/Wingdi/).</span></span> <span data-ttu-id="5bdfa-132">不過，您可以為一個以上的設定檔指定相同的 CAM 設定檔。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-132">The same CAM profile can be specified for more than one profile, however.</span></span>
-   <span data-ttu-id="5bdfa-133">範圍界限描述是從裝置模型物件和凸輪物件初始化。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-133">Gamut boundary descriptions are initialized from a device model object and a CAM object.</span></span> <span data-ttu-id="5bdfa-134">在 [**CreateMultiProfileTransform**](/windows/desktop/api/Wingdi/)的呼叫中，每個設定檔都有一個 gamut 界限描述。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-134">There is one gamut boundary description for each profile in the call to [**CreateMultiProfileTransform**](/windows/desktop/api/Wingdi/).</span></span>
-   <span data-ttu-id="5bdfa-135">Gamut 對應模型會從兩個範圍界限和意圖初始化。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-135">Gamut mapping models are initialized from two gamut boundaries and an intent.</span></span> <span data-ttu-id="5bdfa-136">您必須在從呼叫 [**CreateMultiProfileTransform**](/windows/desktop/api/Wingdi/)所建立的每一對裝置模型之間建立 gamut 對應模型。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-136">You must create a gamut mapping model between each pair of device models created from the call to [**CreateMultiProfileTransform**](/windows/desktop/api/Wingdi/).</span></span> <span data-ttu-id="5bdfa-137">請注意，這表示您使用的 gamut 地圖模型比裝置模型少一個。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-137">Note that this means that you use one fewer gamut map model than device model.</span></span> <span data-ttu-id="5bdfa-138">由於意圖的數目符合裝置型號的數目，因此還有一個意圖比所需的還要多。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-138">Because the number of intents matches the number of device models, there is also one more intent than required.</span></span> <span data-ttu-id="5bdfa-139">會略過清單中的第一個意圖。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-139">The first intent in the list is skipped.</span></span> <span data-ttu-id="5bdfa-140">您將逐步解說裝置模型和意圖的清單，並建立 gamut 對應模型。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-140">You walk through the list of device models and intents, creating gamut mapping models.</span></span> <span data-ttu-id="5bdfa-141">挑選第一個和第二個裝置模型和第二個意圖，然後初始化第一個 gamut 對應模型。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-141">Pick up the first and second device models and the second intent, and then initialize the first gamut mapping model.</span></span> <span data-ttu-id="5bdfa-142">挑選第二個和第三個裝置模型和第三個意圖，然後初始化第二個 gamut 對應模型。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-142">Pick up the second and third device models and the third intent, and then initialize the second gamut mapping model.</span></span> <span data-ttu-id="5bdfa-143">以這種方式繼續進行，直到您已建立所有範圍對應模型為止。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-143">Continue in this manner until you have created all the gamut mapping models.</span></span>

<span data-ttu-id="5bdfa-144">當設定檔已正確處理，而且所有中繼物件都已建立並初始化之後，您就可以使用下列呼叫來建立引用轉換。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-144">When the profiles have been properly processed and all intermediate objects have been created and initialized, then you can create the CITE transform with the following call.</span></span> <span data-ttu-id="5bdfa-145">*PDestCAM* 和 *PDestDM* 是與 [**CreateMultiProfileTransform**](/windows/desktop/api/Wingdi/)的呼叫中最後一個設定檔相關聯的。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-145">The *pDestCAM* and *pDestDM* are those associated with the last profile in the call to [**CreateMultiProfileTransform**](/windows/desktop/api/Wingdi/).</span></span>


```C++
HRESULT CreateCITEColorTransform(
 __inout     IDeviceModel          *pSourceDM,
 __inout     IColorAppearanceModel *pSourceCAM,
 __in        GamutMapArray         *pGamutMapArray,
 __inout     IColorAppearanceModel *pDestCAM,
 __inout     IDeviceModel          *pDestDM,
             EColorTransformMode    eTransformMode,
 __deref_out IColorTransform      **ppCTS
 );
```



## <a name="support-for-plug-ins"></a><span data-ttu-id="5bdfa-146">支援外掛程式</span><span class="sxs-lookup"><span data-stu-id="5bdfa-146">Support for plug-ins</span></span>

<span data-ttu-id="5bdfa-147">設定轉換清單的其中一個問題是驗證是否有必要的外掛程式可供使用。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-147">One issue involved in setting up the transform list is to validate whether a required plug-in is available.</span></span> <span data-ttu-id="5bdfa-148">下列模型參數提供此原則來控制這項行為。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-148">The following model switch provides this policy to control this behavior.</span></span> <span data-ttu-id="5bdfa-149">此轉換清單的管理是內部優化轉換結構中的方法，但每個模型方法會提供其本身及其本身參數值集的指標。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-149">The management of this transform list is a method in the internal optimized transform structure, but each model method provides the pointer to itself and its own set of parameter values.</span></span>

<span data-ttu-id="5bdfa-150">此模式必須是下列其中一項。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-150">The mode must be one of the following.</span></span>

-   <span data-ttu-id="5bdfa-151">TfmRobust：如果測量設定檔指定慣用外掛程式，且外掛程式無法使用，則新的 CTE 系統將會使用基準外掛程式。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-151">TfmRobust: If a measurement profile specifies a preferred plug-in and the plug-in is not available, the new CTE system will use the baseline plug-in.</span></span> <span data-ttu-id="5bdfa-152">如果沒有可用的外掛程式，轉換將會報告錯誤。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-152">If neither plug-in is available, the transform will report an error.</span></span>
-   <span data-ttu-id="5bdfa-153">TfmStrict：如果 ColorCoNtext 指定慣用的外掛程式，就必須可以使用外掛程式。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-153">TfmStrict: If the ColorContext specifies a preferred plug-in, the plug-in must be available.</span></span> <span data-ttu-id="5bdfa-154">如果找不到任何慣用外掛程式，則會使用基準外掛程式。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-154">If no preferred plug-in is found, the baseline plug-in will be used.</span></span> <span data-ttu-id="5bdfa-155">如果沒有可用的外掛程式，轉換將會報告錯誤。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-155">If neither plug-in is available, the transform will report an error.</span></span>
-   <span data-ttu-id="5bdfa-156">TfmBaseline：只有基準外掛程式可以在 AddMeasurementStep 中使用。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-156">TfmBaseline: Only baseline plug-ins can be used in AddMeasurementStep.</span></span> <span data-ttu-id="5bdfa-157">如果 ColorCoNtext 指定慣用外掛程式，將會忽略外掛程式。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-157">If the ColorContext specifies a preferred plug-in, the plug-in will be ignored.</span></span> <span data-ttu-id="5bdfa-158">如果無法使用基準外掛程式，轉換將會報告錯誤。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-158">If the baseline plug-in is not available, the transform will report an error.</span></span>

## <a name="transform-execution"></a><span data-ttu-id="5bdfa-159">轉換執行</span><span class="sxs-lookup"><span data-stu-id="5bdfa-159">Transform execution</span></span>

<span data-ttu-id="5bdfa-160">ICM 2.0 API [**TranslateColors**](/windows/win32/api/icm/nf-icm-translatecolors) 函式會將色彩的陣列從來源 [色彩空間](c.md) 轉譯為目的色彩空間，如色彩轉換所定義。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-160">The ICM 2.0 API [**TranslateColors**](/windows/win32/api/icm/nf-icm-translatecolors) function translates an array of colors from the source [color space](c.md) to the destination color space as defined by a color transform.</span></span> <span data-ttu-id="5bdfa-161">此函式會在內部檢查快取色彩的陣列，以便立即符合常用的轉換色彩。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-161">This function internally checks against an array of cached colors to enable immediate matching of commonly transformed colors.</span></span> <span data-ttu-id="5bdfa-162">這種轉換支援每個通道位元組陣列8位，每個通道的 float 陣列都有32位。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-162">This transform supports 8-bit per channel byte arrays and 32-bit per channel float arrays.</span></span> <span data-ttu-id="5bdfa-163">所有其他格式將會在傳遞至新的 CTE 之前轉換。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-163">All other formats will be converted prior to passing off to the new CTE.</span></span>

<span data-ttu-id="5bdfa-164">ICM 2.0 API [**TranslateBitmapBits**](/windows/win32/api/icm/nf-icm-translatebitmapbits) 函式會轉譯具有所定義格式之點陣圖的色彩，以產生所要求格式的另一個點陣圖。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-164">The ICM 2.0 API [**TranslateBitmapBits**](/windows/win32/api/icm/nf-icm-translatebitmapbits) function translates the colors of a bitmap having a defined format to produce another bitmap in a requested format.</span></span> <span data-ttu-id="5bdfa-165">此函式會在內部檢查快取色彩的陣列，以便立即符合常用的轉換色彩。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-165">This function internally checks against an array of cached colors to enable immediate matching of commonly transformed colors.</span></span> <span data-ttu-id="5bdfa-166">為了避免太多程式碼路徑、支援和測試複雜度，轉換和插補引擎實際上只支援有限數目的點陣圖格式。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-166">To avoid too many code paths, support, and testing complexity, only a limited number of bitmap formats are actually supported in the transform and interpolation engine.</span></span> <span data-ttu-id="5bdfa-167">此函式必須將非原生傳入和傳出點陣圖格式轉譯成原生支援的格式，才能進行處理。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-167">This function must translate the non-native incoming and outgoing bitmap formats into natively supported formats for processing.</span></span> <span data-ttu-id="5bdfa-168">此轉換只支援每個通道的8位點陣圖，以及每個通道的 float 點陣圖32位。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-168">This transform only supports 8-bit per channel byte bitmaps and 32-bit per channel float bitmaps.</span></span> <span data-ttu-id="5bdfa-169">所有其他格式將會在傳遞至新的 CTE 之前轉換。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-169">All other formats will be converted prior to passing off to the new CTE.</span></span>

 

### <a name="sequential-transform-execution"></a><span data-ttu-id="5bdfa-170">順序轉換執行</span><span class="sxs-lookup"><span data-stu-id="5bdfa-170">Sequential Transform Execution</span></span>

<span data-ttu-id="5bdfa-171">如果 \_ 呼叫 ICM 函數 [**CreateColorTransformW**](/windows/win32/api/icm/nf-icm-createcolortransformw)或 **CreateMultiProfileTransform** 時，dwFlags 參數已設定順序轉換位，則會循序執行轉換步驟。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-171">If the *dwFlags* parameter has the SEQUENTIAL\_TRANSFORM bit set when the ICM functions [**CreateColorTransformW**](/windows/win32/api/icm/nf-icm-createcolortransformw) or **CreateMultiProfileTransform** are called, then the transform steps are executed sequentially.</span></span> <span data-ttu-id="5bdfa-172">這表示程式碼會依 **CreateColorTransform** 或 **CreateMultiProfileTransform** 呼叫所指定，分別逐步執行每個裝置模型、色彩外觀模型，以及 gamut 對應模型。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-172">This means that the code steps through each device model, color appearance model, and gamut mapping model separately, as specified by the **CreateColorTransform** or **CreateMultiProfileTransform** call.</span></span> <span data-ttu-id="5bdfa-173">這可能有助於偵測外掛程式模組，但速度會比透過優化轉換執行慢很多。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-173">This may be helpful for debugging plug-in modules, but it is much slower than executing through an optimized transform.</span></span> <span data-ttu-id="5bdfa-174">因此，不建議在生產環境軟體中以連續模式執行。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-174">Running in sequential mode is therefore not recommended for production software.</span></span> <span data-ttu-id="5bdfa-175">此外，在連續模式和優化模式中取得的結果可能會有些微差異。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-175">Also, there may be slight differences in the results obtained in sequential mode and in optimized mode.</span></span> <span data-ttu-id="5bdfa-176">這是因為函數串連在一起時所引進的變化。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-176">This is due to variations introduced when the functions are concatenated together.</span></span>

### <a name="creation-of-optimized-transforms"></a><span data-ttu-id="5bdfa-177">建立優化的轉換</span><span class="sxs-lookup"><span data-stu-id="5bdfa-177">Creation of Optimized Transforms</span></span>

<span data-ttu-id="5bdfa-178">優化的轉換是一種多維度的查閱資料表。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-178">An optimized transform is a multi-dimensional lookup table.</span></span> <span data-ttu-id="5bdfa-179">資料表可以透過將輸入色彩套用至轉換的多維度插補引擎（例如 tetrahedral 插補）來處理。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-179">The table can be processed by a multi-dimensional interpolation engine, such as tetrahedral interpolation, that applies the input colors to the transform.</span></span> <span data-ttu-id="5bdfa-180">下一節將說明如何建立優化的查閱資料表。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-180">The following section describes how the optimized lookup tables are created.</span></span> <span data-ttu-id="5bdfa-181">後面的區段描述如何在優化的查閱資料表中插入。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-181">The section after that describes how to interpolate within the optimized lookup tables.</span></span>

## <a name="sparse-lookup-tables"></a><span data-ttu-id="5bdfa-182">稀疏查閱資料表</span><span class="sxs-lookup"><span data-stu-id="5bdfa-182">Sparse lookup tables</span></span>

<span data-ttu-id="5bdfa-183">傳統印表機具有 CMYK 墨水。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-183">Conventional printers have CMYK inks.</span></span> <span data-ttu-id="5bdfa-184">若要延伸範圍，其中一個方法是將新的墨水加入系統中。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-184">To extend the gamut, one approach is to add new inks to the system.</span></span> <span data-ttu-id="5bdfa-185">通常會加入的墨水是 CMYK 油墨難以重現的色彩。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-185">The inks typically added are colors that CMYK inks have difficulty reproducing.</span></span> <span data-ttu-id="5bdfa-186">常見的選項為橙色、綠色、紅色、藍色等等。若要增加「明顯的解析度」，可使用具有不同色調的油墨，例如淺青、淺洋紅色等等。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-186">Common choices are orange, green, red, blue, etc. To increase the "apparent resolution," inks with different tints can be used, for example, light cyan, light magenta, and so on.</span></span> <span data-ttu-id="5bdfa-187">實際上，印表機裝置有四個以上的通道。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-187">In effect, the printer device has more than four channels.</span></span>

<span data-ttu-id="5bdfa-188">雖然印表機是輸出裝置，但它們也會執行從裝置空間到另一個色彩空間的色彩轉換。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-188">Although printers are output devices, they also perform the color conversion from the device space to another color space.</span></span> <span data-ttu-id="5bdfa-189">在 CMYK 印表機的情況下，這會是從 CMYK 到 XYZ 的轉換，或印表機的「轉寄模型」。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-189">In the case of a CMYK printer, this would be a transformation from CMYK to XYZ, or the "forward model" of the printer.</span></span> <span data-ttu-id="5bdfa-190">藉由結合轉寄模型與其他轉換，您可以在另一部裝置上模擬 CMYK 列印。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-190">By combining the forward model with other transformations, it is possible to emulate a CMYK print on another device.</span></span> <span data-ttu-id="5bdfa-191">例如，印表機 CMYK 到監視器 RGB 可能會有一個可在監視器上模擬該 CMYK 印表機列印的校對機制。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-191">For example, a printer CMYK to a monitor RGB would make possible a proofing mechanism that emulates a print of that CMYK printer on a monitor.</span></span> <span data-ttu-id="5bdfa-192">同樣地，也適用于 wi-fi 印表機。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-192">Similarly, the same also applies for hi-fi printers.</span></span> <span data-ttu-id="5bdfa-193">CMYKOG 至 RGB 轉換可讓您在監視器上進行 CMYKOG 印表機的校對。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-193">A CMYKOG to RGB conversion allows proofing of the CMYKOG printer on a monitor.</span></span>

<span data-ttu-id="5bdfa-194">執行這類色彩轉換的傳統方法是使用統一的 LUT。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-194">The conventional approach to implementing such color conversion is by using a uniform LUT.</span></span> <span data-ttu-id="5bdfa-195">例如，在 CMYKOG 印表機的 ICC 設定檔中，ICC 規格會要求 A2B1 標記，此標記會在轉寄模型的 CMYKOG 裝置空間中儲存統一的 LUT，以從 CMYKOG 至 ICC 設定檔連線空間， (CIELAB 或 CIEXYZ) 。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-195">For example, in an ICC profile for a CMYKOG printer, the ICC specification mandates an A2B1 tag that stores a uniform LUT representing a uniform sampling in the CMYKOG device space of the forward model, which goes from CMYKOG to the ICC profile connection space (either CIELAB or CIEXYZ).</span></span> <span data-ttu-id="5bdfa-196">ICC 裝置連結設定檔可讓您直接從 CMYKOG 裝置空間轉換成任何色彩空間，包括裝置空間，也就是在 CMYKOG 空間中一致取樣的 LUT 形式。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-196">The ICC device link profile enables a direct transformation from CMYKOG device space to any color space including a device space, also in the form of a LUT sampled uniformly in CMYKOG space.</span></span> <span data-ttu-id="5bdfa-197">因為 LUT 會產生很大的，所以不會對256層級進行取樣， (位深度 8) ，但在單色裝置 (1 個通道) 時除外。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-197">Sampling is never done with 256 levels (bit depth 8) because of the huge LUT resulting, except in the case of monochrome devices (1 channel).</span></span> <span data-ttu-id="5bdfa-198">相反地，會使用使用較低位深度的取樣;有些典型選項是 9 (位深度 3) 、17 (位深度 4) 、33 (位深度 5) 。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-198">Instead, sampling with lower bit depth is used; some typical choices are 9 (bit depth 3), 17 (bit depth 4), 33 (bit depth 5).</span></span> <span data-ttu-id="5bdfa-199">如果每個通道中的層級數目小於256，則 LUT 會搭配插補演算法使用，以在層級介於兩個取樣層級之間產生結果。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-199">With the number of levels less than 256 in each channel, the LUT is used in conjunction with an interpolation algorithm to produce the result if a level is between two sampled levels.</span></span>

<span data-ttu-id="5bdfa-200">雖然統一的 LUT 在概念上很容易執行，而且統一 LUT 上的插補通常是有效率的，但 LUT 的大小會隨著輸入維度以指數方式增加。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-200">While a uniform LUT is conceptually simple to implement, and interpolation on a uniform LUT is generally efficient, the LUT size increases exponentially with the input dimension.</span></span> <span data-ttu-id="5bdfa-201">事實上，如果 *d* 是在統一 LUT 中使用的步驟數目，而 *n* 是來源色彩空間中的通道數目，則 LUT 中的節點數目會 ![ 顯示 LUT 中節點數目的變數 ](images/transformcreation-image002.gif) 。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-201">In fact, if *d* is the number of steps used in the uniform LUT, and *n* is the number of channels in the source color space, then the number of nodes in the LUT is ![Shows the variable for the number of nodes in an LUT.](images/transformcreation-image002.gif).</span></span> <span data-ttu-id="5bdfa-202">很明顯地，節點數目很快就需要在記憶體中儲存太多儲存體，即使是頂尖的運算系統也難以處理需求。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-202">Clearly, the number of nodes quickly demands so much storage in memory that even top-of-the-line computing systems have difficulty handling the demand.</span></span> <span data-ttu-id="5bdfa-203">若為具有六個或八個通道的裝置，則裝置設定檔的 ICC 執行需要使用 LUT 中的幾個步驟，有時甚至是 A2B1 資料表中的五個步驟，以將設定檔保留為 mb （而非 gb）。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-203">For devices with six or eight channels, an ICC implementation of the device profile requires using few steps in the LUT, sometimes even down to five steps in the A2B1 table to keep the profile within megabytes instead of gigabytes.</span></span> <span data-ttu-id="5bdfa-204">很明顯地，使用較少的步驟會增加插補誤差，因為現在有較少的範例。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-204">Clearly, using a smaller number of steps increases interpolation error, because there are now fewer samples.</span></span> <span data-ttu-id="5bdfa-205">由於 LUT 必須是一致的，因此即使在裝置值的小型變更可能造成顯著色彩差異的空間區域中，整個色彩空間的精確度也會降低。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-205">Because the LUT must be uniform, accuracy over the whole color space is degraded even in those regions of the space where a significant color difference can be caused by small change in the device value.</span></span>

<span data-ttu-id="5bdfa-206">在四個以上 colorants 的裝置中，整個裝置空間的特定 subspaces 比其他空間更重要。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-206">In devices with more than four colorants, certain subspaces of the whole device space are more important than others.</span></span> <span data-ttu-id="5bdfa-207">例如，在 CMYKOG 空間中，不常使用青色和綠色油墨，因為它們的色調大多互相重迭。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-207">For example, in CMYKOG space, cyan and green inks are seldom used together because their hues largely overlap each other.</span></span> <span data-ttu-id="5bdfa-208">同樣地，黃色和橙色的油墨大多互相重迭。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-208">Similarly, yellow and orange inks largely overlap each other.</span></span> <span data-ttu-id="5bdfa-209">您可以在整個色彩空間中，以整體品質的整體效能降低來查看步驟數的整體降低程度，這是您可以為未必筆跡組合提供的功能，但不適合可能或重要的組合。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-209">A uniform reduction in the number of steps can be viewed as an overall degradation in quality across the whole color space, which is something you can afford for the improbable ink combinations, but not for the likely or important combinations.</span></span>

<span data-ttu-id="5bdfa-210">雖然一致取樣的 LUT 是簡單且有效率的插補，但它會在維度增加時產生龐大的記憶體需求。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-210">While a uniformly sampled LUT is simple and efficient for interpolation, it imposes huge memory requirements as dimension increases.</span></span> <span data-ttu-id="5bdfa-211">實際上，雖然裝置可能會有六個或八個通道，但很少會同時使用它們。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-211">In reality, while a device might have six or eight channels, they are rarely used simultaneously.</span></span> <span data-ttu-id="5bdfa-212">在大部分的情況下，[色彩轉換] 的輸入色彩只有一些「作用中」的 colorants，因此位於較低的維度色彩空間中。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-212">In most cases, the input color to color transformation has only a few "active" colorants and so resides in a lower dimensional color space.</span></span> <span data-ttu-id="5bdfa-213">這也表示可以更有效率地在較低的維度空間中完成插補，因為當維度較低時，插補會更快。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-213">This also means that interpolation can be done more efficiently in that lower dimensional space because interpolation is faster when the dimension is lower.</span></span>

<span data-ttu-id="5bdfa-214">因此，其方法是將整個裝置空間分層依據至各種維度的 subspaces。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-214">Therefore, the approach is to stratify the whole device space into subspaces of various dimensions.</span></span> <span data-ttu-id="5bdfa-215">此外，由於較低的維度 (結合三或四個 colorants) 更重要的是，藉由 stratifying 空間，您也可以套用不同的取樣率;也就是不同的步驟數，也就是各項：針對較低的維度增加取樣率，將它們縮減為較高的維度。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-215">And because lower dimensions (those combining three or four colorants) are more important, by stratifying the space, you can also apply different sampling rates; that is, a different number of steps, to the pieces; increasing sampling rates for lower dimensions, reducing them for higher dimensions.</span></span>

<span data-ttu-id="5bdfa-216">為了修正標記法， *n* 是您想要取樣之色彩轉換來源色彩空間中的通道數目。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-216">To fix notations, *n* is the number of channels in the source color space of the color transformation that you want to sample.</span></span> <span data-ttu-id="5bdfa-217">您也可以將 *n* 參考為輸入維度，並 ![ 顯示 n 大於或等於5。](images/transformcreation-image004.gif)</span><span class="sxs-lookup"><span data-stu-id="5bdfa-217">You can also refer to *n* as the input dimension, and ![Shows n greater than or equal to 5.](images/transformcreation-image004.gif)</span></span> <span data-ttu-id="5bdfa-218">除非另有指定，否則為。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-218">, unless otherwise specified.</span></span>

<span data-ttu-id="5bdfa-219">基本組建區塊是各種輸入 *維度* 和大小的 LUTs，而不是一個具有輸入維度 *n* 的統一 LUT。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-219">The basic building blocks are LUTs of various input *dimensions* and sizes, instead of one uniform LUT with input dimension *n*.</span></span> <span data-ttu-id="5bdfa-220">為了更加精確，*LUT* 是對單位 cube 施加的矩形 >lattice;也就是說，所有裝置座標都會正規化至範圍 \[ 0、1 \]) 。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-220">To be more precise, a *LUT* is a rectangular lattice imposed on a unit cube; that is, all the device coordinates are normalized to the range \[0, 1\]).</span></span> <span data-ttu-id="5bdfa-221">如果是 lut 的輸入維度 (請注意，它不一定等於 *n*，不過會 ![ 顯示 V 小於或等於 n。](images/transformcreation-image006.gif)</span><span class="sxs-lookup"><span data-stu-id="5bdfa-221">if   is the input dimension of the lut (note that   does not have to be equal to *n*, although ![Shows V less than or equal to n.](images/transformcreation-image006.gif)</span></span> <span data-ttu-id="5bdfa-222">是必要的) ，它是由ν一維的取樣方格所組成：</span><span class="sxs-lookup"><span data-stu-id="5bdfa-222">is required), then it consists of ν one-dimensional sampling grids:</span></span>

<span data-ttu-id="5bdfa-223">Samp *i*： ![ 顯示一維取樣方格。](images/transformcreation-image008.gif)</span><span class="sxs-lookup"><span data-stu-id="5bdfa-223">Samp *i*: ![Shows a one-dimensional sampling grid.](images/transformcreation-image008.gif)</span></span>

<span data-ttu-id="5bdfa-224">其中所有 *x <sub>j</sub>s* 都必須在範圍 \[ 0 （1）中 \] ， ![ 顯示 (我) 的上標 d。](images/transformcreation-image010.gif)</span><span class="sxs-lookup"><span data-stu-id="5bdfa-224">where all the *x<sub>j</sub>s* must lie in the range \[0, 1\], ![Shows a superscript d(i).](images/transformcreation-image010.gif)</span></span> <span data-ttu-id="5bdfa-225">這是 *我* 第一次通道取樣的步驟數，其必須至少為1，並 ![ 顯示 X (注標) d (我) 的 spuperscript。](images/transformcreation-image012.gif)</span><span class="sxs-lookup"><span data-stu-id="5bdfa-225">is the number of steps for the *i* th channel sampling which must be at least 1, and ![Shows a spuperscript of X (subscript) d(i).](images/transformcreation-image012.gif)</span></span> <span data-ttu-id="5bdfa-226">必須是1。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-226">must be 1.</span></span> <span data-ttu-id="5bdfa-227">另一方面，會 ![ 顯示上標 X (注標 1) 。](images/transformcreation-image014.gif)</span><span class="sxs-lookup"><span data-stu-id="5bdfa-227">On the other hand, ![Shows a superscript X (subscript 1).](images/transformcreation-image014.gif)</span></span> <span data-ttu-id="5bdfa-228">不需要是0。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-228">is not required to be 0.</span></span>

<span data-ttu-id="5bdfa-229">只會定義下列兩個特殊的 LUT 案例。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-229">Only the following two special cases of LUT will be defined.</span></span>

<span data-ttu-id="5bdfa-230">*封閉式 LUT*：這是一個 LUT，其中包含每個 Samp *<sub>i</sub>* 的額外需求， ![ 顯示上標 X (注標 1) 等於0。](images/transformcreation-image016.gif)</span><span class="sxs-lookup"><span data-stu-id="5bdfa-230">*Closed LUT*: This is a LUT with the additional requirement that for each Samp *<sub>i</sub>*, ![Shows a superscript X (subscript 1) equals 0.](images/transformcreation-image016.gif)</span></span> <span data-ttu-id="5bdfa-231">，並 ![ 顯示 (i) 大於或等於2的上標 d。](images/transformcreation-image018.gif)</span><span class="sxs-lookup"><span data-stu-id="5bdfa-231">, and ![Shows a superscript d(i) greater than or equal to 2.](images/transformcreation-image018.gif)</span></span> <span data-ttu-id="5bdfa-232">.</span><span class="sxs-lookup"><span data-stu-id="5bdfa-232">.</span></span> <span data-ttu-id="5bdfa-233">統一封閉的 LUT 是一種封閉的 LUT，其 ![ 顯示的是上標 d (我) 。](images/transformcreation-image010.gif)</span><span class="sxs-lookup"><span data-stu-id="5bdfa-233">A uniform closed LUT is a closed LUT that has the same ![Shows a superscript d(i).](images/transformcreation-image010.gif)</span></span> <span data-ttu-id="5bdfa-234">針對每個通道，而節點會在0和1之間保持一致。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-234">for each channel, and the nodes are uniformly spaced between 0 and 1.</span></span>

<span data-ttu-id="5bdfa-235">*開啟 LUT*：這是一個 LUT，其中包含每個 Samp *i* 的額外需求， ![ 顯示上標 X (注標 1) 大於0。](images/transformcreation-image020.gif)</span><span class="sxs-lookup"><span data-stu-id="5bdfa-235">*Open LUT*: This is a LUT with the additional requirement that for each Samp *i*, ![SHows a superscript X (subscript 1) greater than 0.](images/transformcreation-image020.gif)</span></span> <span data-ttu-id="5bdfa-236">.</span><span class="sxs-lookup"><span data-stu-id="5bdfa-236">.</span></span> <span data-ttu-id="5bdfa-237">好的，它可以 ![ 顯示上標 d (我) 等於1。](images/transformcreation-image022.gif)</span><span class="sxs-lookup"><span data-stu-id="5bdfa-237">It is OK to have ![Shows a superscript d(i) equal to 1.](images/transformcreation-image022.gif)</span></span> <span data-ttu-id="5bdfa-238">.</span><span class="sxs-lookup"><span data-stu-id="5bdfa-238">.</span></span>

<span data-ttu-id="5bdfa-239">其目標是要將單元 cube \[ 0、1 \] *n* 分層依據至封閉式 LUTs 和 open LUTs 的集合，讓整個集合都涵蓋單元 cube。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-239">The goal is to stratify the unit cube \[0, 1\] *n* into a collection of closed LUTs and open LUTs, such that the whole collection will cover the unit cube.</span></span> <span data-ttu-id="5bdfa-240">概念上，您可以根據維度的維度來整理這些「LUT 分層」，以便在最上層：</span><span class="sxs-lookup"><span data-stu-id="5bdfa-240">It is conceptually simpler to organize these "LUT strata" by their dimensions, so that on the top level:</span></span>

![顯示依據維度來組織 L U T 階層式最上層。](images/transformcreation-image024.png)

<span data-ttu-id="5bdfa-242">其中 ![ 顯示 sigma 注標 k。](images/transformcreation-image026.gif)</span><span class="sxs-lookup"><span data-stu-id="5bdfa-242">where ![Shows sigma subscript k.](images/transformcreation-image026.gif)</span></span> <span data-ttu-id="5bdfa-243">這是「*k* 維度的分層集合」。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-243">is the "*k* -dimensional strata collection."</span></span> <span data-ttu-id="5bdfa-244">請注意，分層維度的開頭是3，而不是 0;也就是說，由於三 colorant 組合的插補可以處理，而不需要太多記憶體需求。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-244">Note that the strata dimension starts from 3 instead of 0; that is, points, because interpolation of three-colorant combinations can be handled without too much memory requirement.</span></span>

## <a name="description-of-the-lut-strata"></a><span data-ttu-id="5bdfa-245">LUT 階層式描述</span><span class="sxs-lookup"><span data-stu-id="5bdfa-245">Description of the LUT strata</span></span>

<span data-ttu-id="5bdfa-246">在此執行中：</span><span class="sxs-lookup"><span data-stu-id="5bdfa-246">In this implementation:</span></span>

1. <span data-ttu-id="5bdfa-247">![顯示 sigma 注標3。](images/transformcreation-image028.gif)</span><span class="sxs-lookup"><span data-stu-id="5bdfa-247">![Shows sigma subscript 3.](images/transformcreation-image028.gif)</span></span> <span data-ttu-id="5bdfa-248">是由具有三個輸入的封閉式 LUTs 所組成，這是從 *n* colorants 選擇的三個 colorants 的每個可能組合所組成。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-248">consists of closed LUTs with three inputs, one from every possible combination of three colorants chosen out of the *n* colorants.</span></span>

2. ![顯示 sigma 注標4。](images/transformcreation-image030.gif) <span data-ttu-id="5bdfa-250">包含組合 CMYK (或前四個 colorants) 的一個封閉 LUT，以及</span><span class="sxs-lookup"><span data-stu-id="5bdfa-250">consists of one closed LUT for the combination CMYK (or the first four colorants), together with</span></span> ![顯示 (n 超過 4) 減1。](images/transformcreation-image032.png) <span data-ttu-id="5bdfa-252">針對所有其他四 colorant 組合開啟 LUTs。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-252">open LUTs for all other four-colorant combinations.</span></span> <span data-ttu-id="5bdfa-253">藉由 singling CMYK 組合，您就可以確認它是一項重要的組合。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-253">By singling out the CMYK combination, you acknowledge that it is an important combination.</span></span>

3. <span data-ttu-id="5bdfa-254">若為， ![ 則顯示 k 等於5、...、n。](images/transformcreation-image034.gif)</span><span class="sxs-lookup"><span data-stu-id="5bdfa-254">For ![Shows k equal to 5, ..., n.](images/transformcreation-image034.gif)</span></span> <span data-ttu-id="5bdfa-255">， ![ 顯示 sigma 注標 k。](images/transformcreation-image026.gif)</span><span class="sxs-lookup"><span data-stu-id="5bdfa-255">, ![Shows sigma subscript k.](images/transformcreation-image026.gif)</span></span> <span data-ttu-id="5bdfa-256">包含 ![ (n 超過 k) 的顯示。](images/transformcreation-image037.gif)</span><span class="sxs-lookup"><span data-stu-id="5bdfa-256">consists of ![Shows (n over k).](images/transformcreation-image037.gif)</span></span> <span data-ttu-id="5bdfa-257">開啟 LUTs，每個可能的組合，從 *n* 個 colorants 的總計選擇 *k* colorants。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-257">open LUTs, one for each possible combination of choosing *k* colorants from the total of *n* colorants.</span></span>

<span data-ttu-id="5bdfa-258">它仍會指定 LUTs 的大小。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-258">It remains to specify the sizes of the LUTs.</span></span> <span data-ttu-id="5bdfa-259">Open 和 closed LUTs 之間的主要差異在於，開啟的 LUTs 不會重迭，而封閉的 LUTs 可能會在界限面重迭。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-259">The key difference between open and closed LUTs is that open LUTs don't overlap, and closed LUTs might overlap at the boundary faces.</span></span> <span data-ttu-id="5bdfa-260">在開啟的 LUT 中，一維取樣不包含0，基本上表示開啟的 LUT 遺失邊界臉部的一半，因此名稱為 "open"。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-260">The fact that the one-dimensional sampling in an open LUT does not contain 0, essentially means that an open LUT is missing half of the boundary faces, hence the name "open."</span></span> <span data-ttu-id="5bdfa-261">如果兩個 LUTs 不重迭，您可以在每個通道中使用不同數目的步驟或節點位置。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-261">If two LUTs don't overlap, you can use a different number of steps or node locations in each channel.</span></span> <span data-ttu-id="5bdfa-262">如果兩個 LUTs 重迭，就不會發生這種情況。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-262">The same is not true if two LUTs overlap.</span></span> <span data-ttu-id="5bdfa-263">在這種情況下，如果步驟數目或節點位置不同，則在兩個 LUTs 的交集處，將會根據在插補中使用的 LUT 來接收不同的插補值。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-263">In that case, if the number of steps or the node locations are different, a point lying in the intersection of the two LUTs will receive a different interpolation value depending on which LUT is used in the interpolation.</span></span> <span data-ttu-id="5bdfa-264">解決此問題的一個簡單解決方案，是在兩個 LUTs 重迭時，使用相同數目的步驟進行統一取樣。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-264">A simple solution to this problem is to use uniform sampling with the same number of steps whenever two LUTs overlap.</span></span> <span data-ttu-id="5bdfa-265">換句話說：</span><span class="sxs-lookup"><span data-stu-id="5bdfa-265">In other words:</span></span>

<span data-ttu-id="5bdfa-266">所有封閉的 LUTs (此實) 中的所有三 colorant LUTs 和 CMYK LUT 都必須一致，且具有相同數目的步驟（以 *d* 表示）。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-266">All closed LUTs (all three-colorant LUTs and the CMYK LUT in this implementation) must be uniform and have the same number of steps, which are denoted *d*.</span></span>

<span data-ttu-id="5bdfa-267">您可以使用下列兩種演算法來判斷已關閉 LUTs 的步驟 *d* 數目，以及開啟 LUTs 的步驟數目。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-267">The following two algorithms can be used to determine the number of steps *d* for closed LUTs and the number of steps for open LUTs.</span></span>

## <a name="algorithm-1"></a><span data-ttu-id="5bdfa-268">演算法 \# 1</span><span class="sxs-lookup"><span data-stu-id="5bdfa-268">Algorithm \#1</span></span>

<span data-ttu-id="5bdfa-269">此演算法不需要外部輸入。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-269">This algorithm does not require external input.</span></span>

<span data-ttu-id="5bdfa-270">所有關閉的 LUTs 都會與 *d* 個步驟一致。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-270">All the closed LUTs will be uniform with *d* number of steps.</span></span>

<span data-ttu-id="5bdfa-271">維度 *k* 的所有開啟 LUTs 都會有相同數目的步驟 ![ 顯示 d (k) 。](images/transformcreation-image039.gif)</span><span class="sxs-lookup"><span data-stu-id="5bdfa-271">All the open LUTs of dimension *k* will have same number of steps ![Shows d(k).](images/transformcreation-image039.gif)</span></span> <span data-ttu-id="5bdfa-272">在每個輸入通道中，節點的間距也相同;也就是說，每個 ![ 節目都等於1，2，...，k。](images/transformcreation-image041.gif)</span><span class="sxs-lookup"><span data-stu-id="5bdfa-272">in each input channel, and the nodes are equally spaced; that is, for each ![Shows i equal to 1, 2, ..., k.](images/transformcreation-image041.gif)</span></span> <span data-ttu-id="5bdfa-273">.</span><span class="sxs-lookup"><span data-stu-id="5bdfa-273">.</span></span>

<span data-ttu-id="5bdfa-274">Samp *i*： ![ 顯示 Samp i 演算法。](images/transformcreation-image043.png)</span><span class="sxs-lookup"><span data-stu-id="5bdfa-274">Samp *i*: ![Shows samp i algorithm.](images/transformcreation-image043.png)</span></span>

<span data-ttu-id="5bdfa-275">最後，在下表1中指定 *d* 和 *d* (*k* ) 。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-275">Finally, specify *d* and *d* (*k* ) in the following Table 1.</span></span> <span data-ttu-id="5bdfa-276">三種模式「證明」、「正常」和「最佳」是 ICM 2.0 品質設定。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-276">The three modes, "proof," "normal," and "best" are the ICM 2.0 quality settings.</span></span> <span data-ttu-id="5bdfa-277">在這個執行中，證明模式具有最小的記憶體使用量，而最佳模式的記憶體使用量最大。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-277">In this implementation, the proof mode has the smallest memory footprint, and best mode has the largest memory footprint.</span></span>

<span data-ttu-id="5bdfa-278">若要執行此演算法，您必須呼叫下列演算法 \# 2。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-278">To implement this algorithm, you must call the following Algorithm \#2.</span></span> <span data-ttu-id="5bdfa-279">使用者可以使用資料表做為指南，來指定自己的取樣位置。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-279">Users can specify their own sampling locations, using the tables as a guide.</span></span>

## <a name="algorithm-2"></a><span data-ttu-id="5bdfa-280">演算法 \# 2</span><span class="sxs-lookup"><span data-stu-id="5bdfa-280">Algorithm \#2</span></span>

<span data-ttu-id="5bdfa-281">此演算法需要以「重要」取樣位置清單形式的外部輸入，但它更適合調整，而且可能會節省記憶體空間。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-281">This algorithm requires external input in the form of a list of "important" sampling locations, but it is more adaptive and can save memory space potentially.</span></span>

<span data-ttu-id="5bdfa-282">必要的輸入是使用者提供的裝置值陣列。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-282">The required input is an array of device values supplied by the user.</span></span> <span data-ttu-id="5bdfa-283">這些裝置值會指出裝置色彩空間的哪個區域很重要;亦即，應更多取樣的區域。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-283">These device values indicate which region of the device color space is important; that is, which region should be sampled more.</span></span>

<span data-ttu-id="5bdfa-284">所有關閉的 LUTs 都會與 *d* 個步驟一致，如演算法1中所述 \# 。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-284">All the closed LUTs will be uniform with *d* number of steps as described in Algorithm \#1.</span></span> <span data-ttu-id="5bdfa-285">[表 1] 提供 *d* 的值。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-285">Values for *d* are provided in Table 1.</span></span>

<span data-ttu-id="5bdfa-286">*() 的統一封閉 LUT*</span><span class="sxs-lookup"><span data-stu-id="5bdfa-286">*(a) Uniform Closed LUT*</span></span>



|         | <span data-ttu-id="5bdfa-287">證明模式</span><span class="sxs-lookup"><span data-stu-id="5bdfa-287">Proof mode</span></span> | <span data-ttu-id="5bdfa-288">標準模式</span><span class="sxs-lookup"><span data-stu-id="5bdfa-288">Normal mode</span></span> | <span data-ttu-id="5bdfa-289">最佳模式</span><span class="sxs-lookup"><span data-stu-id="5bdfa-289">Best mode</span></span> |
|---------|------------|-------------|-----------|
| <span data-ttu-id="5bdfa-290">***d***</span><span class="sxs-lookup"><span data-stu-id="5bdfa-290">***d***</span></span> | <span data-ttu-id="5bdfa-291">9</span><span class="sxs-lookup"><span data-stu-id="5bdfa-291">9</span></span>          | <span data-ttu-id="5bdfa-292">17</span><span class="sxs-lookup"><span data-stu-id="5bdfa-292">17</span></span>          | <span data-ttu-id="5bdfa-293">33</span><span class="sxs-lookup"><span data-stu-id="5bdfa-293">33</span></span>        |



 

<span data-ttu-id="5bdfa-294">*(b) 開啟 LUT*</span><span class="sxs-lookup"><span data-stu-id="5bdfa-294">*(b) Open LUT*</span></span>



| <span data-ttu-id="5bdfa-295">輸入維度</span><span class="sxs-lookup"><span data-stu-id="5bdfa-295">Input dimension</span></span> | <span data-ttu-id="5bdfa-296">證明模式</span><span class="sxs-lookup"><span data-stu-id="5bdfa-296">Proof mode</span></span> | <span data-ttu-id="5bdfa-297">標準模式</span><span class="sxs-lookup"><span data-stu-id="5bdfa-297">Normal mode</span></span> | <span data-ttu-id="5bdfa-298">最佳模式</span><span class="sxs-lookup"><span data-stu-id="5bdfa-298">Best mode</span></span> |
|-----------------|------------|-------------|-----------|
| <span data-ttu-id="5bdfa-299">4</span><span class="sxs-lookup"><span data-stu-id="5bdfa-299">4</span></span>               | <span data-ttu-id="5bdfa-300">5</span><span class="sxs-lookup"><span data-stu-id="5bdfa-300">5</span></span>          | <span data-ttu-id="5bdfa-301">7</span><span class="sxs-lookup"><span data-stu-id="5bdfa-301">7</span></span>           | <span data-ttu-id="5bdfa-302">9</span><span class="sxs-lookup"><span data-stu-id="5bdfa-302">9</span></span>         |
| <span data-ttu-id="5bdfa-303">5</span><span class="sxs-lookup"><span data-stu-id="5bdfa-303">5</span></span>               | <span data-ttu-id="5bdfa-304">2</span><span class="sxs-lookup"><span data-stu-id="5bdfa-304">2</span></span>          | <span data-ttu-id="5bdfa-305">3</span><span class="sxs-lookup"><span data-stu-id="5bdfa-305">3</span></span>           | <span data-ttu-id="5bdfa-306">3</span><span class="sxs-lookup"><span data-stu-id="5bdfa-306">3</span></span>         |
| <span data-ttu-id="5bdfa-307">6</span><span class="sxs-lookup"><span data-stu-id="5bdfa-307">6</span></span>               | <span data-ttu-id="5bdfa-308">2</span><span class="sxs-lookup"><span data-stu-id="5bdfa-308">2</span></span>          | <span data-ttu-id="5bdfa-309">3</span><span class="sxs-lookup"><span data-stu-id="5bdfa-309">3</span></span>           | <span data-ttu-id="5bdfa-310">3</span><span class="sxs-lookup"><span data-stu-id="5bdfa-310">3</span></span>         |
| <span data-ttu-id="5bdfa-311">7</span><span class="sxs-lookup"><span data-stu-id="5bdfa-311">7</span></span>               | <span data-ttu-id="5bdfa-312">2</span><span class="sxs-lookup"><span data-stu-id="5bdfa-312">2</span></span>          | <span data-ttu-id="5bdfa-313">2</span><span class="sxs-lookup"><span data-stu-id="5bdfa-313">2</span></span>           | <span data-ttu-id="5bdfa-314">2</span><span class="sxs-lookup"><span data-stu-id="5bdfa-314">2</span></span>         |
| <span data-ttu-id="5bdfa-315">8或更多</span><span class="sxs-lookup"><span data-stu-id="5bdfa-315">8 or more</span></span>       | <span data-ttu-id="5bdfa-316">2</span><span class="sxs-lookup"><span data-stu-id="5bdfa-316">2</span></span>          | <span data-ttu-id="5bdfa-317">2</span><span class="sxs-lookup"><span data-stu-id="5bdfa-317">2</span></span>           | <span data-ttu-id="5bdfa-318">2</span><span class="sxs-lookup"><span data-stu-id="5bdfa-318">2</span></span>         |



 

<span data-ttu-id="5bdfa-319">**表1：** 演算法中使用的 LUT 大小</span><span class="sxs-lookup"><span data-stu-id="5bdfa-319">**Table 1:** LUT sizes used in the algorithm</span></span>

<span data-ttu-id="5bdfa-320">每個開啟的 LUT 在每個輸入通道中可能會有不同數目的步驟，而取樣位置不需要相同的間距。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-320">Each open LUT can have a different number of steps in each input channel, and the sampling locations do not have to be equally spaced.</span></span> <span data-ttu-id="5bdfa-321">針對指定的 open LUT 層次，有一個相關聯的 colorant 組合，例如， ![ 顯示 c 注標1、...、c 注標 k。](images/transformcreation-image045.gif)</span><span class="sxs-lookup"><span data-stu-id="5bdfa-321">For a given open LUT stratum, there is an associated colorant combination, for example, ![Shows C subscript 1, ..., C subscript k.](images/transformcreation-image045.gif)</span></span> <span data-ttu-id="5bdfa-322">，其中 ![ 顯示 C 注標 i。](images/transformcreation-image047.gif)</span><span class="sxs-lookup"><span data-stu-id="5bdfa-322">, where the ![Shows C subscript i.](images/transformcreation-image047.gif)</span></span> <span data-ttu-id="5bdfa-323">s 是1到 *n* 之間的相異整數。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-323">s are distinct integers between 1 and *n*.</span></span> <span data-ttu-id="5bdfa-324">它們是對應至此分層中「作用中」 colorants 的通道索引。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-324">They are the channel indices corresponding to the "active" colorants in this strata.</span></span>

<span data-ttu-id="5bdfa-325">步驟1：篩選出未包含在此分層中之裝置值的輸入陣列。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-325">STEP 1: Filter out the inputted array of device values that are not contained in this strata.</span></span> <span data-ttu-id="5bdfa-326">裝置值 ![ 顯示 x 注標1、x 注標2、...、x 注標 n。](images/transformcreation-image049.gif)</span><span class="sxs-lookup"><span data-stu-id="5bdfa-326">A device value ![Shows X subscript 1, X subscript 2, ..., X subscript n.](images/transformcreation-image049.gif)</span></span> <span data-ttu-id="5bdfa-327">只有在 ![ 顯示通道的一組值時，才會包含在分層中。](images/transformcreation-image051.gif)</span><span class="sxs-lookup"><span data-stu-id="5bdfa-327">is contained in the strata, if and only if ![Shows a set of values for a channel.](images/transformcreation-image051.gif)</span></span> <span data-ttu-id="5bdfa-328">和所有其他通道都是0。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-328">and all other channels are 0.</span></span> <span data-ttu-id="5bdfa-329">如果篩選的集合有 *N* 個專案，請讓</span><span class="sxs-lookup"><span data-stu-id="5bdfa-329">If the filtered set has *N* entries, let</span></span>

![顯示篩選的集合有 N 個專案時所要使用的方程式。](images/transformcreation-image053.png)

<span data-ttu-id="5bdfa-331">針對每個</span><span class="sxs-lookup"><span data-stu-id="5bdfa-331">For each</span></span> ![顯示我等於1，2，...，k。](images/transformcreation-image041.gif) <span data-ttu-id="5bdfa-333">，重複執行下列步驟2-5：</span><span class="sxs-lookup"><span data-stu-id="5bdfa-333">, iterate the following steps 2-5:</span></span>

<span data-ttu-id="5bdfa-334">步驟2：如果 ![ 顯示 d 注標暫時 (k) 等於1。](images/transformcreation-image055.gif)</span><span class="sxs-lookup"><span data-stu-id="5bdfa-334">STEP 2: If ![Shows d subscript tentative (k) equal to 1.](images/transformcreation-image055.gif)</span></span> <span data-ttu-id="5bdfa-335">，Samp *i* 只有1個點，其必須為1.0。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-335">, Samp *i* has only 1 point, which must be 1.0.</span></span> <span data-ttu-id="5bdfa-336">*繼續下一* 步。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-336">Move on to the next *i*.</span></span> <span data-ttu-id="5bdfa-337">否則，請繼續進行步驟3。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-337">Otherwise, continue to STEP 3.</span></span>

<span data-ttu-id="5bdfa-338">步驟3：在中以遞增順序排序篩選的範例</span><span class="sxs-lookup"><span data-stu-id="5bdfa-338">STEP 3: Sort the filtered samples in ascending order in the</span></span> ![顯示 C 注標 i。](images/transformcreation-image047.gif) <span data-ttu-id="5bdfa-340">通道。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-340">channel.</span></span>

<span data-ttu-id="5bdfa-341">步驟4：使用節點定義「暫時性」取樣方格</span><span class="sxs-lookup"><span data-stu-id="5bdfa-341">STEP 4: Define the "tentative" sampling grid using the nodes</span></span>

![顯示用來定義「暫時」取樣方格的節點。](images/transformcreation-image057.png)

<span data-ttu-id="5bdfa-343">其中</span><span class="sxs-lookup"><span data-stu-id="5bdfa-343">where</span></span> ![顯示 j 等於1、2、...、d 注標暫時 (k) 。](images/transformcreation-image059.gif) <span data-ttu-id="5bdfa-345">.</span><span class="sxs-lookup"><span data-stu-id="5bdfa-345">.</span></span>

<span data-ttu-id="5bdfa-346">步驟5： Regularize 暫時性方格，以確定它符合嚴格的單一性，而且其結尾為1.0。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-346">STEP 5: Regularize the tentative grid to ensure that it conforms with strict monotonicity and also that it ends with 1.0.</span></span> <span data-ttu-id="5bdfa-347">因為陣列已經過排序，所以暫時性方格中的節點已經單純 nondecreasing。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-347">Because the array is already sorted, the nodes in the tentative grid are already monotonic nondecreasing.</span></span> <span data-ttu-id="5bdfa-348">不過，相鄰節點可能會完全相同。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-348">However, adjacent nodes might be identical.</span></span> <span data-ttu-id="5bdfa-349">如有必要，您可以移除相同的節點來修正此問題。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-349">You can fix this by removing identical nodes, if necessary.</span></span> <span data-ttu-id="5bdfa-350">最後，在此程式之後，如果結束點小於1.0，請將它取代為1.0。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-350">Finally, after this procedure, if the end point is less than 1.0, replace it with 1.0.</span></span>

<span data-ttu-id="5bdfa-351">請注意，步驟5是 LUT 分層在每個通道中的步驟數目可能不同的原因。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-351">Note that STEP 5 is the reason that the LUT strata may have a different number of steps in each channel.</span></span> <span data-ttu-id="5bdfa-352">正規化之後，通道中的步驟數目可能會小於</span><span class="sxs-lookup"><span data-stu-id="5bdfa-352">After the regularization, the number of steps in a channel may be less than</span></span> ![顯示 d 注標暫時 (k) 。](images/transformcreation-image061.gif) <span data-ttu-id="5bdfa-354">.</span><span class="sxs-lookup"><span data-stu-id="5bdfa-354">.</span></span>

## <a name="interpolation"></a><span data-ttu-id="5bdfa-355">插 值</span><span class="sxs-lookup"><span data-stu-id="5bdfa-355">Interpolation</span></span>

<span data-ttu-id="5bdfa-356">您可以藉由 open LUT 分層和 closed LUT 分層來建立 unit cube 的分層。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-356">You can construct the stratification of the unit cube by open LUT strata and closed LUT strata.</span></span> <span data-ttu-id="5bdfa-357">若要使用這個「稀疏 LUT 結構」執行插補，請遵循下列步驟。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-357">To perform interpolation using this "sparse LUT structure," follow these steps.</span></span> <span data-ttu-id="5bdfa-358">假設指定的輸入裝置值</span><span class="sxs-lookup"><span data-stu-id="5bdfa-358">Assume a given input device value</span></span> ![顯示 (X 注標1，X 注標2，...，X 注標 n) 。](images/transformcreation-image049.gif) <span data-ttu-id="5bdfa-360">.</span><span class="sxs-lookup"><span data-stu-id="5bdfa-360">.</span></span>

<span data-ttu-id="5bdfa-361">步驟1：決定「作用中」通道的數目。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-361">STEP 1: Determine the number of "active" channels.</span></span> <span data-ttu-id="5bdfa-362">這是非零的通道數目。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-362">This is the number of non-zero channels.</span></span> <span data-ttu-id="5bdfa-363">這會決定要搜尋包含層次的分層維度 *k* 。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-363">This determines the strata dimension *k* to search for the containing stratum.</span></span> <span data-ttu-id="5bdfa-364">更精確地說，如果使用中通道的數目 ![ 顯示小於或等於3，分層維度就會是3。](images/transformcreation-image063.gif)</span><span class="sxs-lookup"><span data-stu-id="5bdfa-364">More precisely, the strata dimension is 3 if the number of active channels is ![Shows less than or equal to 3.](images/transformcreation-image063.gif)</span></span> <span data-ttu-id="5bdfa-365">否則，分層維度與使用中通道的數目相同。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-365">, otherwise, the strata dimension is the same as the number of active channels.</span></span>

<span data-ttu-id="5bdfa-366">步驟2：內部</span><span class="sxs-lookup"><span data-stu-id="5bdfa-366">STEP 2: Within</span></span> ![顯示 sigma 注標 k。](images/transformcreation-image026.gif) <span data-ttu-id="5bdfa-368">搜尋包含的層次。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-368">, search for the containing stratum.</span></span> <span data-ttu-id="5bdfa-369">如果對應至層次的所有通道都有非零值，而且所有其他通道都是零，則裝置值會包含在開放式層次中。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-369">A device value is contained in an open stratum if all the channels corresponding to the stratum have non-zero value, and all other channels are zero.</span></span> <span data-ttu-id="5bdfa-370">如果層次未表示的每個通道都是零，則裝置值會包含在封閉的層次中。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-370">A device value is contained in a closed stratum if every channel not represented by the stratum is zero.</span></span> <span data-ttu-id="5bdfa-371">如果找不到包含的層次，則會發生錯誤狀況。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-371">If no containing stratum is found, there is an error condition.</span></span> <span data-ttu-id="5bdfa-372">取消和報告失敗。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-372">Cancel and report failure.</span></span> <span data-ttu-id="5bdfa-373">如果找到包含的層次，請繼續進行下一個步驟。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-373">If a containing stratum is found, proceed to the next step.</span></span>

<span data-ttu-id="5bdfa-374">步驟3：如果包含的層次已關閉，則任何已知的插補演算法都可以完成層次內的插補。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-374">STEP 3: If the containing stratum is closed, then interpolation within the stratum can be done by any known interpolation algorithm.</span></span> <span data-ttu-id="5bdfa-375">在此執行中，演算法的選擇是 tetrahedral 插補。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-375">In this implementation, the choice of algorithm is tetrahedral interpolation.</span></span> <span data-ttu-id="5bdfa-376">如果包含的層次是開啟的，且裝置值嚴格位於層次內，也就是</span><span class="sxs-lookup"><span data-stu-id="5bdfa-376">If the containing stratum is open, and the device value lies strictly within the stratum, that is,</span></span>

<span data-ttu-id="5bdfa-377">![顯示 X 注標 i 大於或等於 ... ](images/transformcreation-image065.gif)*第一個通道中的* 第一個節點</span><span class="sxs-lookup"><span data-stu-id="5bdfa-377">![Shows X subscript i greater than or equal to...](images/transformcreation-image065.gif) first node in *i* th channel</span></span>

<span data-ttu-id="5bdfa-378">如果 *我* 是層次的通道索引，則標準插補演算法（例如 tetrahedral 插補）可以運作。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-378">where *i* is a channel index for the stratum, then standard interpolation algorithm, such as tetrahedral interpolation, works.</span></span>

<span data-ttu-id="5bdfa-379">如果 ![ 某些 i 的第 i 個頻道顯示 [X 注 i 小於 ... ](images/transformcreation-image067.gif) ] 第一個節點，則裝置值會落在層次與較低維度 subspaces 之間的「間距 」。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-379">If ![Shows X subscript i less than...](images/transformcreation-image067.gif) first node in *i* th channel for some *i*, then the device value falls into the "gap" between the stratum and the lower dimensional subspaces.</span></span> <span data-ttu-id="5bdfa-380">這項 MOI 與每個 se 的插補演算法無關，因此任何插補演算法都可以用來在此「間距」內插補，雖然慣用的演算法是下列 transfinite 插補。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-380">This MOI is not concerned with an interpolation algorithm per se, so any interpolation algorithm can be used to interpolate within this "gap," although the preferred algorithm is the following transfinite interpolation.</span></span>

<span data-ttu-id="5bdfa-381">[圖 1] 的兩個部分說明插補模組的架構。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-381">The architecture of the interpolation module is illustrated in the two parts of Figure 1.</span></span>

![此圖顯示插補模組架構的第一部分。](images/transformcreation-image068.png)

![顯示插補模組架構第二部分的圖表。](images/transformcreation-image070.png)

<span data-ttu-id="5bdfa-384">**圖1：** Intepolation 模組架構</span><span class="sxs-lookup"><span data-stu-id="5bdfa-384">**Figure 1:** Intepolation module architecture</span></span>

<span data-ttu-id="5bdfa-385">如先前所述，此演算法能夠在包含 colorants 重要組合的裝置空間區域中達到相當密集的取樣，同時將所需的 LUTs 大小總計降至最低。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-385">As explained earlier, this algorithm is able to achieve reasonably dense sampling in regions of the device space that contain important combination of colorants, while minimizing the total size of LUTs needed.</span></span> <span data-ttu-id="5bdfa-386">下表顯示使用演算法 \# 1 和一般模式) 和對應的統一 LUT 實 (，進行稀疏 LUT 實所需的節點數目比較。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-386">The following table shows a comparison of the number of nodes needed for the sparse LUT implementation (using Algorithm \#1 and normal mode) and the corresponding uniform LUT implementation.</span></span>



| <span data-ttu-id="5bdfa-387">**輸入通道的數目**</span><span class="sxs-lookup"><span data-stu-id="5bdfa-387">**Number of input channels**</span></span> | <span data-ttu-id="5bdfa-388">**稀疏 LUT**</span><span class="sxs-lookup"><span data-stu-id="5bdfa-388">**Sparse LUT**</span></span> | <span data-ttu-id="5bdfa-389">**統一 LUT**</span><span class="sxs-lookup"><span data-stu-id="5bdfa-389">**Uniform LUT**</span></span> |
|------------------------------|----------------|-----------------|
| <span data-ttu-id="5bdfa-390">5</span><span class="sxs-lookup"><span data-stu-id="5bdfa-390">5</span></span>                            | <span data-ttu-id="5bdfa-391">142498</span><span class="sxs-lookup"><span data-stu-id="5bdfa-391">142498</span></span>         | <span data-ttu-id="5bdfa-392">1419857</span><span class="sxs-lookup"><span data-stu-id="5bdfa-392">1419857</span></span>         |
| <span data-ttu-id="5bdfa-393">6</span><span class="sxs-lookup"><span data-stu-id="5bdfa-393">6</span></span>                            | <span data-ttu-id="5bdfa-394">217582</span><span class="sxs-lookup"><span data-stu-id="5bdfa-394">217582</span></span>         | <span data-ttu-id="5bdfa-395">24137567</span><span class="sxs-lookup"><span data-stu-id="5bdfa-395">24137567</span></span>        |
| <span data-ttu-id="5bdfa-396">7</span><span class="sxs-lookup"><span data-stu-id="5bdfa-396">7</span></span>                            | <span data-ttu-id="5bdfa-397">347444</span><span class="sxs-lookup"><span data-stu-id="5bdfa-397">347444</span></span>         | <span data-ttu-id="5bdfa-398">410338673</span><span class="sxs-lookup"><span data-stu-id="5bdfa-398">410338673</span></span>       |
| <span data-ttu-id="5bdfa-399">8</span><span class="sxs-lookup"><span data-stu-id="5bdfa-399">8</span></span>                            | <span data-ttu-id="5bdfa-400">559618</span><span class="sxs-lookup"><span data-stu-id="5bdfa-400">559618</span></span>         | <span data-ttu-id="5bdfa-401">6975757441</span><span class="sxs-lookup"><span data-stu-id="5bdfa-401">6975757441</span></span>      |



 

## <a name="interpolation-within-a-unit-cube"></a><span data-ttu-id="5bdfa-402">單位 cube 內的插補</span><span class="sxs-lookup"><span data-stu-id="5bdfa-402">Interpolation within a unit cube</span></span>

<span data-ttu-id="5bdfa-403">矩形方格的基本步驟是在封閉儲存格內的插補。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-403">A basic step in the case of rectangular grid is interpolation within an enclosing cell.</span></span> <span data-ttu-id="5bdfa-404">針對輸入點，您可以輕鬆地判斷封閉資料格。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-404">For an input point, you can determine the enclosing cell easily.</span></span> <span data-ttu-id="5bdfa-405">在矩形方格中，會指定每個頂點的輸出值 (角落點) 的封閉儲存格。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-405">In a rectangular grid, the output value at each of the vertices (corner points) of the enclosing cell is specified.</span></span> <span data-ttu-id="5bdfa-406">它們也是 interpolant 必須滿足的唯一 (BCs) 的界限條件： interpolant 必須通過所有這些點。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-406">They are also the only boundary conditions (BCs) that an interpolant must satisfy: The interpolant must pass through all these points.</span></span> <span data-ttu-id="5bdfa-407">請注意，這些界限條件是在「離散」點上，在此案例中是資料格的2n 角落點，其中 n 是色彩空間的維度。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-407">Note that these boundary conditions are on "discrete" points, in this case the 2n corner points of the cell, where n is the dimension of the color space.</span></span>

<span data-ttu-id="5bdfa-408">在繼續進行之前，先將界限條件的概念正規化會很有用。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-408">It is useful to formalize the concept of boundary conditions before moving on.</span></span> <span data-ttu-id="5bdfa-409">針對封入資料格界限界限的任何子集 (在 n 維度) 的單位 cube，S 的界限條件是函數 BC： S → Rm 的規格，其中 m 是輸出維度。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-409">For any subset S of the boundary of the enclosing cell (the unit cube in n dimensions), a boundary condition on S is a specification of a function BC: S → Rm, where m is the output dimension.</span></span> <span data-ttu-id="5bdfa-410">換句話說，interpolant，其可能表示 Interp： \[ 0，1 \] n → Rm，必須滿足下列條件： Interp (x) = BC (x) 適用于所有 x。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-410">In other words, an interpolant, which may be denoted Interp: \[0,1\]n→ Rm, is required to satisfy: Interp(x) = BC(x) for all x in S.</span></span>

<span data-ttu-id="5bdfa-411">在單元 cube 的插補的標準案例中，S 是 cube 的2n 頂點的離散點集合。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-411">In the standard scenario of interpolation on the unit cube, S is the set of discrete points that are the 2n vertices of the cube.</span></span>

<span data-ttu-id="5bdfa-412">您現在可以將界限條件一般化，以解決稍早所述的問題，並在單元 cube 內提供新的插補演算法。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-412">You can now generalize the boundary conditions to solve the issues described earlier and provide a new interpolation algorithm within the unit cube.</span></span> <span data-ttu-id="5bdfa-413">界限條件可以強加于 cube 的整個界限面，而不只允許離散界限點。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-413">Instead of allowing only discrete boundary points, boundary conditions can be imposed on a whole boundary face of the cube.</span></span> <span data-ttu-id="5bdfa-414">確切的假設如下：</span><span class="sxs-lookup"><span data-stu-id="5bdfa-414">The precise assumptions are as follows:</span></span>

<span data-ttu-id="5bdfa-415"> () point vn = (1，1,..., 1) 是特殊的，而且只允許離散界限條件。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-415">(a) The point vn =(1,1,…,1) is special and only a discrete boundary condition is allowed.</span></span> <span data-ttu-id="5bdfa-416">換句話說，沒有任何連續界限條件可以強加于 n 界限，也就是 xi = 1 (i = 1,..., n) 。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-416">In other words, no continuous boundary conditions can be imposed on the n boundary faces xi=1 (i=1,…,n).</span></span>

<span data-ttu-id="5bdfa-417">針對其餘 n 個界限的每個)  (b (i = 1,..., n) ，界限條件可以強加于整個臉部，以及如果兩個臉部交集，則臉部上的界限條件應該同意交集。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-417">(b) For each of the remaining n boundary faces xi=0 (i=1,…,n), boundary condition can be imposed on the whole face, with the compatibility condition that if two faces intersect, the boundary conditions on the faces should agree on the intersection.</span></span>

<span data-ttu-id="5bdfa-418"> (c) 具有界限條件之臉部內未包含的任何頂點都會有個別的 (離散) 界限條件。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-418">(c) Any vertices not contained in the faces with boundary condition will have an individual (discrete) boundary condition.</span></span>

<span data-ttu-id="5bdfa-419">您可以將離散界限條件稱為有限資料，並將連續界限條件視為 transfinite 資料，以討論有限和 transfinite 資料的插補。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-419">You can refer to a discrete boundary condition as finite data, and a continuous boundary condition as transfinite data in discussing interpolation on finite and transfinite data.</span></span>

<span data-ttu-id="5bdfa-420">首先，請參閱標準 tetrahedral 插補 (（例如 Sakamoto 的) 專利中所使用的），這可協助您針對此問題的特殊形式來設定標記法。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-420">First, review the standard tetrahedral interpolation (such as that used in Sakamoto's patent) which helps set the notations for this particular formulation of the problem.</span></span> <span data-ttu-id="5bdfa-421">已知單位 cube \[ 0，1 \] n 可以細分為 n！</span><span class="sxs-lookup"><span data-stu-id="5bdfa-421">It is known that the unit cube \[0,1\]n can be subdivided into n!</span></span> <span data-ttu-id="5bdfa-422">tetrahedra，以 n 符號上的排列集合參數化。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-422">tetrahedra, parameterized by the set of permutations on n symbols.</span></span> <span data-ttu-id="5bdfa-423">更具體來說，每個這類四面體是由到差異所定義</span><span class="sxs-lookup"><span data-stu-id="5bdfa-423">More specifically, each such tetrahedron is defined by inequalities</span></span>

![顯示 tetrahedrons inequalites 的公式。](images/transformcreation-image073.gif)

<span data-ttu-id="5bdfa-425">其中σ： {1，2,.., n} → {1，2,..., n} 是 "符號" 1，2，...，n，也就是一組 n 符號的 bijective 對應。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-425">where σ:{1,2,..,n}→{1,2,…,n} is a permutation of "symbols" 1, 2, …, n, that is, it is a bijective mapping of the set of n symbols.</span></span> <span data-ttu-id="5bdfa-426">例如，如果 n = 3 和σ = (3，2，1) ，表示σ (1) = 3，σ (2) = 2，σ (3) = 1，則對應的四面體是由 z ≥ y ≥ x 定義，其中的一般標記法 x、y、z 用於 x1、x2、x3。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-426">For example, if n = 3 and σ = (3, 2, 1), meaning σ(1)=3, σ(2)=2, σ(3)=1, then the corresponding tetrahedron is defined by z≥y≥x, where the common notation x, y, z is used for x1, x2, x3.</span></span> <span data-ttu-id="5bdfa-427">請注意，這些 tetrahedrons 不會彼此相交。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-427">Note that these tetrahedrons are not disjoint from each other.</span></span> <span data-ttu-id="5bdfa-428">基於插補的目的，在兩個不同 tetrahedrons 的共通點上，會有相同的插補值（不論在插補中使用哪一個四面體）。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-428">For the purpose of interpolation, points lying on a common face of two distinct tetrahedrons will have the same interpolation value regardless of which tetrahedron is used in the interpolation.</span></span> <span data-ttu-id="5bdfa-429">同樣地，在有限點上插入的標準案例中，針對給定的輸入點 (x1、...、xn) ，先判斷它所在的四面體（或同等的對應排列σ），然後將 tetrahedral interpolant 定義為</span><span class="sxs-lookup"><span data-stu-id="5bdfa-429">Still, in the standard scenario of interpolating on finite points, for a given input point (x1, …, xn), first determine which tetrahedron it lies in, or equivalently, the corresponding permutation σ, then the tetrahedral interpolant is defined as</span></span>

![顯示定義 tetrahedral interpolant 的方程式。](images/transformcreation-image075.png)

<span data-ttu-id="5bdfa-431">其中</span><span class="sxs-lookup"><span data-stu-id="5bdfa-431">where</span></span> ![顯示標準基礎向量的方程式。](images/transformcreation-image077.png) <span data-ttu-id="5bdfa-433">針對 i = 1、...、n 和 e1，...，en 是標準的基礎向量。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-433">for i=1, …, n, and e1, …, en are the standard basis vectors.</span></span> <span data-ttu-id="5bdfa-434">在繼續進行一般化之前，請注意 v0、v1、...、vn 是四面體的頂點，而</span><span class="sxs-lookup"><span data-stu-id="5bdfa-434">Before moving on to the generalization, note that v0, v1, …, vn are the vertices of the tetrahedron, and</span></span> ![顯示 barycentric 座標。](images/transformcreation-image079.png) <span data-ttu-id="5bdfa-436">是「barycentric 座標」。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-436">are the "barycentric coordinates."</span></span>

<span data-ttu-id="5bdfa-437">對於在邊界臉部上的 BCs 的一般情況，您可以使用 barycentric 投影的概念。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-437">For the general case of BCs on boundary faces, you can use the concept of barycentric projection.</span></span> <span data-ttu-id="5bdfa-438">如同之前，針對指定的輸入點 (x1、...、xn) ，請先判斷它所在的四面體，或等同于對應的排列σ。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-438">As before, for a given input point (x1, …, xn), first determine in which tetrahedron it lies, or equivalently, the corresponding permutation σ.</span></span> <span data-ttu-id="5bdfa-439">然後執行一系列的 barycentric 投影，如下所示。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-439">Then perform a series of barycentric projections, as follows.</span></span> <span data-ttu-id="5bdfa-440">第一個投射</span><span class="sxs-lookup"><span data-stu-id="5bdfa-440">The first projection</span></span> ![顯示 BProj 的注標 1 (x) 。](images/transformcreation-image081.gif) <span data-ttu-id="5bdfa-442">將點傳送至平面</span><span class="sxs-lookup"><span data-stu-id="5bdfa-442">sends the point to the plane</span></span> ![顯示 X 注標差異 (1) 等於0。](images/transformcreation-image083.gif) <span data-ttu-id="5bdfa-444">除非</span><span class="sxs-lookup"><span data-stu-id="5bdfa-444">unless</span></span> ![顯示 X 等於 V 注標 n。](images/transformcreation-image085.gif) <span data-ttu-id="5bdfa-446">在這種情況下，它不會變更。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-446">in which case it is not changed.</span></span> <span data-ttu-id="5bdfa-447">地圖 BProj 的精確定義定義如下：</span><span class="sxs-lookup"><span data-stu-id="5bdfa-447">The precise definition of the map BProj is defined as follows:</span></span>

![顯示地圖 BProj 精確定義的方程式。](images/transformcreation-image087.png)

<span data-ttu-id="5bdfa-449">取代為</span><span class="sxs-lookup"><span data-stu-id="5bdfa-449">with</span></span> ![顯示 P 注標 k 的方程式。](images/transformcreation-image089.png) <span data-ttu-id="5bdfa-451">和 k = 1、2、...、n。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-451">and k = 1, 2, …, n.</span></span>

<span data-ttu-id="5bdfa-452">在案例中</span><span class="sxs-lookup"><span data-stu-id="5bdfa-452">In the case</span></span> ![顯示 X 等於 V 注標 n。](images/transformcreation-image085.gif) <span data-ttu-id="5bdfa-454">，您可以停止，因為 BC 是在 vn 中定義的，並假設 () 。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-454">, you can stop, because BC is defined at vn by Assumption (a).</span></span> <span data-ttu-id="5bdfa-455">在案例中</span><span class="sxs-lookup"><span data-stu-id="5bdfa-455">In the case</span></span> ![顯示 X 不等於 V 注標 n。](images/transformcreation-image091.gif) <span data-ttu-id="5bdfa-457">，顯然</span><span class="sxs-lookup"><span data-stu-id="5bdfa-457">, it is clear that</span></span> ![顯示 BProj 的注標 1 (X) 。](images/transformcreation-image081.gif) <span data-ttu-id="5bdfa-459">具有σ (1) 第一個元件的 annihilated。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-459">has the σ(1)th component annihilated.</span></span> <span data-ttu-id="5bdfa-460">換句話說，它是在其中一個界限面上。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-460">In other words, it is on one of boundary faces.</span></span> <span data-ttu-id="5bdfa-461">可能是在定義 BC 的臉部上，您可以停止，或執行另一個 barycentric 投影</span><span class="sxs-lookup"><span data-stu-id="5bdfa-461">Either it is on a face on which BC is defined, in which case you can stop, or you perform another barycentric projection</span></span> ![顯示 BProj 的注標 2 (X ' ) 。](images/transformcreation-image093.gif) <span data-ttu-id="5bdfa-463">其中</span><span class="sxs-lookup"><span data-stu-id="5bdfa-463">where</span></span> ![顯示 X 等於 BProj 的注標 1 (X) 。](images/transformcreation-image095.gif) <span data-ttu-id="5bdfa-465">.</span><span class="sxs-lookup"><span data-stu-id="5bdfa-465">.</span></span> <span data-ttu-id="5bdfa-466">如果</span><span class="sxs-lookup"><span data-stu-id="5bdfa-466">And if</span></span> ![顯示 X ' ' = Bproj 下標 1 (X ' ) 。](images/transformcreation-image097.gif) <span data-ttu-id="5bdfa-468">在定義 BC 的臉部上，您可以停止;否則，請執行另一個投射</span><span class="sxs-lookup"><span data-stu-id="5bdfa-468">is on a face on which BC is defined, you can stop; otherwise, perform yet another projection</span></span> ![顯示 BProj 的注標 3 (X ' ' ) 。](images/transformcreation-image099.gif) <span data-ttu-id="5bdfa-470">.</span><span class="sxs-lookup"><span data-stu-id="5bdfa-470">.</span></span> <span data-ttu-id="5bdfa-471">因為每個投射都 annihilates 一個元件，所以有效的維度會減少，因此您知道進程最後必須停止。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-471">Because every projection annihilates one component, the effective dimension decreases, so you know the process must eventually stop.</span></span> <span data-ttu-id="5bdfa-472">在最糟的情況下，您會對維度0（也就是 cube 上的頂點，根據假設 (c) ）執行 n 預測，您知道 BC 將會定義在上。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-472">In the worst case scenario, you perform n projections down to dimension 0, that is, vertices on the cube, which according to Assumption (c), you know BC will be defined on.</span></span>

<span data-ttu-id="5bdfa-473">假設已執行 K 個預測，</span><span class="sxs-lookup"><span data-stu-id="5bdfa-473">Assuming that K projections have been performed, with</span></span>

![顯示假設已執行 K 投射時要使用的方程式。](images/transformcreation-image101.png)

<span data-ttu-id="5bdfa-475">x (0) = x、輸入點和 BC 定義于 x (k) 。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-475">x(0)= x, the input point, and BC is defined at x(k).</span></span> <span data-ttu-id="5bdfa-476">然後藉由定義一連串的輸出向量來回溯投影：</span><span class="sxs-lookup"><span data-stu-id="5bdfa-476">Then unwind the projections by defining a series of output vectors:</span></span>

![顯示一連串輸出向量的方程式。](images/transformcreation-image103.png)

<span data-ttu-id="5bdfa-478">其中</span><span class="sxs-lookup"><span data-stu-id="5bdfa-478">where</span></span> ![顯示 Y 上標 (K) 的方程式。](images/transformcreation-image105.gif) <span data-ttu-id="5bdfa-480">，最後取得答案</span><span class="sxs-lookup"><span data-stu-id="5bdfa-480">, and you finally obtain the answer</span></span>

![顯示 Interp (x) 等於 y 上標 (0) 。](images/transformcreation-image107.gif)

## <a name="worked-example"></a><span data-ttu-id="5bdfa-482">作用中範例</span><span class="sxs-lookup"><span data-stu-id="5bdfa-482">Worked example</span></span>

![此圖顯示使用單元 cube 的插補範例。](images/transformcreation-image108.png)

<span data-ttu-id="5bdfa-484">**圖2：** 作用中範例</span><span class="sxs-lookup"><span data-stu-id="5bdfa-484">**Figure 2:** Worked example</span></span>

<span data-ttu-id="5bdfa-485">請考慮 [圖 2] 中所描述的情況，其中 n = 3、m = 1，而且您有下列的 BCs：</span><span class="sxs-lookup"><span data-stu-id="5bdfa-485">Consider the situation depicted in Figure 2, where n = 3, m = 1, and you have the following BCs:</span></span>

<span data-ttu-id="5bdfa-486">在頂點上 () 四個離散的 BCs</span><span class="sxs-lookup"><span data-stu-id="5bdfa-486">(a) Four discrete BCs on the vertices</span></span>

<span data-ttu-id="5bdfa-487"> (0、0、1) ：β001</span><span class="sxs-lookup"><span data-stu-id="5bdfa-487">(0, 0, 1): β001</span></span>

<span data-ttu-id="5bdfa-488"> (0，1，1) ：β011</span><span class="sxs-lookup"><span data-stu-id="5bdfa-488">(0, 1, 1): β011</span></span>

<span data-ttu-id="5bdfa-489"> (1、0、1) ：β101</span><span class="sxs-lookup"><span data-stu-id="5bdfa-489">(1, 0, 1): β101</span></span>

<span data-ttu-id="5bdfa-490"> (1，1，1) ：β111</span><span class="sxs-lookup"><span data-stu-id="5bdfa-490">(1, 1, 1): β111</span></span>

<span data-ttu-id="5bdfa-491"> (b) 在臉部 x3 = 0 上的持續 BC = 0： F (x1、x2) </span><span class="sxs-lookup"><span data-stu-id="5bdfa-491">(b) A continuous BC on the face x3=0: F(x1, x2)</span></span>

<span data-ttu-id="5bdfa-492">計算 \# 1：輸入點 x = (0.8、0.5、0.2) 。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-492">Computation \#1: Input point x = (0.8, 0.5, 0.2).</span></span> <span data-ttu-id="5bdfa-493">封閉的四面體與排列 &lt; 1、2、3相關聯 &gt; 。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-493">The enclosing tetrahedron is associated with the permutation &lt;1, 2, 3&gt;.</span></span>

<span data-ttu-id="5bdfa-494">第1個投射：</span><span class="sxs-lookup"><span data-stu-id="5bdfa-494">1st projection:</span></span> ![顯示第一個投射的方程式。](images/transformcreation-image110.png)

<span data-ttu-id="5bdfa-496">這已在臉部 x3 = 0 上，因此您可以停止。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-496">This is already on the face x3=0, so you can stop.</span></span> <span data-ttu-id="5bdfa-497">回溯替代，然後提供</span><span class="sxs-lookup"><span data-stu-id="5bdfa-497">Backward substitution then gives</span></span>

![顯示第一個投射的答案。](images/transformcreation-image112.png) <span data-ttu-id="5bdfa-499">這就是答案。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-499">which is the answer.</span></span>

<span data-ttu-id="5bdfa-500">計算 \# 2：輸入點 x = (0.2、0.5、0.8) 。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-500">Computation \#2 : Input point x = (0.2, 0.5, 0.8).</span></span> <span data-ttu-id="5bdfa-501">封閉的四面體與排列 &lt; 3、2、1相關聯 &gt; 。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-501">The enclosing tetrahedron is associated with the permutation &lt;3, 2, 1&gt;.</span></span>

<span data-ttu-id="5bdfa-502">第1個投射：</span><span class="sxs-lookup"><span data-stu-id="5bdfa-502">1st projection:</span></span> ![顯示第一次投影計算2的方程式。](images/transformcreation-image113.png)

<span data-ttu-id="5bdfa-504">第2個投射：</span><span class="sxs-lookup"><span data-stu-id="5bdfa-504">2nd projection:</span></span> ![顯示運算2的第二個投射的方程式。](images/transformcreation-image115.png)

<span data-ttu-id="5bdfa-506">第三個投射：</span><span class="sxs-lookup"><span data-stu-id="5bdfa-506">3rd projection:</span></span> ![顯示計算2的第三個投影的方程式。](images/transformcreation-image117.png) <span data-ttu-id="5bdfa-508">，位於臉部 x3 = 0。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-508">, which is on the face x3=0.</span></span> <span data-ttu-id="5bdfa-509">回溯替代，然後提供</span><span class="sxs-lookup"><span data-stu-id="5bdfa-509">Backward substitution then gives</span></span>

![顯示後向替代的前兩個方程式。](images/transformcreation-image119.png)

![顯示反向替代的第三個方程式。](images/transformcreation-image123.png)<span data-ttu-id="5bdfa-512">，這是最後的答案。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-512">, which is the final answer.</span></span>

## <a name="applications"></a><span data-ttu-id="5bdfa-513">應用程式</span><span class="sxs-lookup"><span data-stu-id="5bdfa-513">Applications</span></span>

<span data-ttu-id="5bdfa-514">*() 順序 Tetrahedral 插補*</span><span class="sxs-lookup"><span data-stu-id="5bdfa-514">*(a) Sequential Tetrahedral Interpolation*</span></span>

![顯示連續 tetrahedral 插補的圖表。](images/transformcreation-image124.png)

<span data-ttu-id="5bdfa-516">**圖3：** 順序 tetrahedral 插補</span><span class="sxs-lookup"><span data-stu-id="5bdfa-516">**Figure 3:** Sequential tetrahedral interpolation</span></span>

<span data-ttu-id="5bdfa-517">請參閱 [圖 3]。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-517">Refer to Figure 3.</span></span> <span data-ttu-id="5bdfa-518">若要在兩個不相容格線的平面之間進行插入，請考慮將圖中所示的指定點 P 括住的儲存格。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-518">To interpolate between two planes on which incompatible grids have been imposed, consider a cell enclosing a given point P shown in the figure.</span></span> <span data-ttu-id="5bdfa-519">儲存格的「頂端」頂點直接來自于頂端平面的方格。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-519">The "top" vertices of the cell come directly from the grid in the top plane.</span></span> <span data-ttu-id="5bdfa-520">底部臉部中的頂點與底部平面中的方格不相容，因此整個臉部會被視為具有 BC，其值是由底平面方格中的插補所取得。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-520">The vertices in the bottom face are not compatible with the grid in the bottom plane, so the whole face is treated as having a BC with values obtained by interpolation on the grid in the bottom plane.</span></span> <span data-ttu-id="5bdfa-521">然後，這項設定會明確指出此設定符合假設 () 、 (b) 和上述 (c) ，而且您可以套用插補演算法。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-521">It is then clear that this setup satisfies Assumptions (a), (b), and (c) above, and you can apply the interpolation algorithm.</span></span>

<span data-ttu-id="5bdfa-522">此外，演算法也會將插補問題的維度縮減1，因為結果是在上方格頂點的線性組合，以及較低平面中的插補，其維度較少1。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-522">It is also clear that the algorithm has reduced the dimension of the interpolation problem by 1, because the result is a linear combination of values at the vertices in the upper grid, and interpolation in the lower plane, which has dimension less 1.</span></span> <span data-ttu-id="5bdfa-523">如果較低的平面中有類似的將平面設定，您可以在該平面中套用程式，進一步將維度縮減1。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-523">If a similar sandwiching plane configuration exists in the lower plane, you can apply the procedure in that plane, further reducing the dimension by 1.</span></span> <span data-ttu-id="5bdfa-524">此程式可繼續進行，直到您到達維度0為止。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-524">This procedure can continue until you reach dimension 0.</span></span> <span data-ttu-id="5bdfa-525">這個投射和插補可以稱為「連續 Tetrahedral 插補」。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-525">This cascade of projections and interpolations can be called "Sequential Tetrahedral Interpolation."</span></span>

<span data-ttu-id="5bdfa-526">*(b) 間隙插補*</span><span class="sxs-lookup"><span data-stu-id="5bdfa-526">*(b) Gap Interpolation*</span></span>

![顯示間隙插補的圖表。](images/transformcreation-image126.jpg)

<span data-ttu-id="5bdfa-528">**圖4：** 間隙插補</span><span class="sxs-lookup"><span data-stu-id="5bdfa-528">**Figure 4:** Gap interpolation</span></span>

<span data-ttu-id="5bdfa-529">這是在正面象限中嚴格放置的 cube 上所強加的方格。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-529">This is a grid imposed on a cube sitting strictly inside the positive quadrant.</span></span> <span data-ttu-id="5bdfa-530">Cube 本身具有方格，而且每個座標平面都有不一定相容的格線。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-530">The cube itself has a grid on it, and each coordinate plane has grids that are not necessarily compatible.</span></span> <span data-ttu-id="5bdfa-531">Cube 和座標平面之間的「間距」具有「L 形」的跨區段，而且不會適合至標準技術。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-531">The "gap" between the cube and the coordinate planes has a cross-section that is "L-shaped" and is not amenable to standard techniques.</span></span> <span data-ttu-id="5bdfa-532">不過，在這裡引進的技術，您可以輕鬆地導入涵蓋此間距的儲存格。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-532">However, with the technique introduced here, you can easily introduce cells that cover this gap.</span></span> <span data-ttu-id="5bdfa-533">[圖 4] 描繪其中一種。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-533">Figure 4 depicts one of these.</span></span> <span data-ttu-id="5bdfa-534">座標平面上的方格支援插補，為數據格的所有最下方臉部提供必要的 BC，還有一個剩餘的頂點，而該頂點的 BC 是由 cube 的右下角提供。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-534">The grids on the coordinate planes support interpolation that provides the necessary BCs for all the bottom faces of the cell, with one remaining vertex whose BC is provided by the lower corner of the cube.</span></span>

## <a name="final-note-on-implementation"></a><span data-ttu-id="5bdfa-535">執行的最終注意事項</span><span class="sxs-lookup"><span data-stu-id="5bdfa-535">Final note on implementation</span></span>

<span data-ttu-id="5bdfa-536">在實際的應用程式中，會從較大的 lattices 中解壓縮演算法基本設定的「單位 cube」，而頂點上的值可能需要昂貴的計算。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-536">In actual application, the "unit cube" that is the basic setting of the algorithm is extracted from larger lattices, and the values at the vertices may require expensive calculation.</span></span> <span data-ttu-id="5bdfa-537">另一方面，也可以明確地說，tetrahedral 插補只需要四面體頂點的值，也就是 unit cube 中所有頂點的子集。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-537">On the other hand, it is also clear that tetrahedral interpolation requires only the values at the vertices of the tetrahedron, which is a subset of all the vertices of the unit cube.</span></span> <span data-ttu-id="5bdfa-538">因此，您可以更有效率地執行所謂的「延後評估」。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-538">Therefore, it is more efficient to implement what can be called "deferred evaluation."</span></span> <span data-ttu-id="5bdfa-539">在上述演算法的軟體執行中，通常會有副程式接受單位 cube 和其頂點的值做為輸入。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-539">In a software implementation of the preceding algorithm, it is typical to have a subroutine that takes the unit cube and values at its vertices as input.</span></span> <span data-ttu-id="5bdfa-540">延後評估表示不會在頂點上傳遞值，而是會傳遞評估頂點值所需的資訊，而不會實際執行評估。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-540">Deferred evaluation means that instead of passing the values at the vertices, the necessary information to evaluate the values of the vertices is passed, without actually carrying out the evaluation.</span></span> <span data-ttu-id="5bdfa-541">在副程式中，在決定封入四面體之後，這些值的實際評估將只會針對屬於封閉四面體的頂點執行。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-541">Inside the subroutine, actual evaluation of these values will be carried out only for those vertices that belong to the enclosing tetrahedron, after the enclosing tetrahedron is determined.</span></span>

## <a name="lookup-table-for-use-with-high-dynamic-range-virtual-rgb-source-devices"></a><span data-ttu-id="5bdfa-542">用於高動態範圍虛擬 RGB 來源裝置的查閱資料表</span><span class="sxs-lookup"><span data-stu-id="5bdfa-542">Lookup table for use with high dynamic range virtual RGB source devices</span></span>

<span data-ttu-id="5bdfa-543">在使用模型化為虛擬 RGB 裝置的來源裝置來建立轉換的情況下，來源 colorant 值可能會是負數或大於 unity (1.0) 。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-543">In the case where a transform is constructed with a source device that is modeled as a virtual RGB device, it is possible that source colorant values may be negative or greater than unity (1.0).</span></span> <span data-ttu-id="5bdfa-544">發生這種情況時，來源裝置會被稱為具有高動態範圍 (HDR) 。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-544">When this occurs, the source device is referred to as having a high dynamic range(HDR).</span></span> <span data-ttu-id="5bdfa-545">在此情況下，會進行特別考慮。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-545">Special consideration is made for this case.</span></span>

<span data-ttu-id="5bdfa-546">在 HDR 轉換的情況下，每個 colorant 頻道的最小值和最大值都可以從裝置的範圍界限來決定。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-546">In the case of HDR transforms, the minimum and maximum values for each colorant channel can be determined from the gamut boundary of the device.</span></span> <span data-ttu-id="5bdfa-547">藉由使用這些值，就會套用每個 colorant 通道的簡單縮放，讓等於最小 colorant 的 colorant 值會轉換為0.0，而等於最大 colorant 的 colorant 值會轉換為1.0，並以線性方式調整介於0.0 和1.0 之間的值。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-547">By using these values, a simple scaling for each colorant channel is applied so that colorant values equal to the minimum colorant would be converted to 0.0, and colorant values equal to the maximum colorant would be converted to 1.0, with a linear scaling of values between to map linearly between 0.0 and 1.0.</span></span>

### <a name="iccprofilefromwcsprofile"></a><span data-ttu-id="5bdfa-548">ICCProfileFromWCSProfile</span><span class="sxs-lookup"><span data-stu-id="5bdfa-548">ICCProfileFromWCSProfile</span></span>

<span data-ttu-id="5bdfa-549">由於這項功能的主要目的是要支援 Windows Vista 之前的版本，因此您必須產生2.2 版的 ICC 設定檔（如 ICC 規格中所定義）。1： 1998-09。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-549">Because the main purpose of this feature is to support pre-Vista versions of Windows, you must generate Version 2.2 ICC profiles as defined in ICC Specification ICC.1:1998-09.</span></span> <span data-ttu-id="5bdfa-550">在某些情況下 (請參閱下表「基準裝置至 ICC 設定檔類別對應」 ) ，您可以從 WCS 設定檔建立矩陣或 >FLIGHTRECORDERCURRENT.TRC 型的 ICC 設定檔。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-550">In certain cases (see the following table "Baseline Device To ICC Profile Class Mapping"), you can create a matrix or TRC-based ICC profile from a WCS profile.</span></span> <span data-ttu-id="5bdfa-551">在其他情況下，ICC 設定檔是由 LUTs 所組成。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-551">In other cases, the ICC profile consists of LUTs.</span></span> <span data-ttu-id="5bdfa-552">下列程式說明如何建立 AToB 和 BToA LUTs。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-552">The following process describes how to create the AToB and BToA LUTs.</span></span> <span data-ttu-id="5bdfa-553">當然，ICC 設定檔也有其他欄位。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-553">Of course, ICC profiles have other fields as well.</span></span> <span data-ttu-id="5bdfa-554">某些資料可以衍生自 WCS 設定檔。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-554">Some of the data can be derived from the WCS profile.</span></span> <span data-ttu-id="5bdfa-555">對於其他資料，您必須開發智慧型預設值。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-555">For other data, you'll have to develop intelligent defaults.</span></span> <span data-ttu-id="5bdfa-556">系統會將著作權指派給 Microsoft;因為它是用來建立 LUTs 的 Microsoft 技術。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-556">The copyright will be assigned to Microsoft; since it is Microsoft technology that is being used to create the LUTs.</span></span>

<span data-ttu-id="5bdfa-557">這項設計應該適用于所有類型的裝置模型，包括外掛程式。只要外掛程式有相關聯的基準裝置模型，就可以決定基礎裝置類型。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-557">This design should work for all types of device models, including plug-ins. As long as the plug-in has an associated baseline device model, the underlying device type can be determined.</span></span>

<span data-ttu-id="5bdfa-558">建立 ICC 設定檔的困難部分是建立 AToB 和 BToA 查閱資料表。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-558">The hard part of creating an ICC profile is creating the AToB and BToA lookup tables.</span></span> <span data-ttu-id="5bdfa-559">這些資料表會在裝置空間之間進行對應，例如 RGB 或 CMYK，以及設定檔連接空間 (電腦) ，也就是 CIELAB 的變化。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-559">These tables map between the device space, for example, RGB or CMYK, and the Profile Connection Space (PCS), which is a variant of CIELAB.</span></span> <span data-ttu-id="5bdfa-560">這基本上與在引用轉換中用來從裝置空間對應到裝置空間的色彩管理程式相同。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-560">This is fundamentally the same as the color management process used in the CITE transform to map from device space to device space.</span></span> <span data-ttu-id="5bdfa-561">不過，您必須擁有下列資訊才能進行轉換。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-561">However, you must have the following information to make the transformation.</span></span>

1) <span data-ttu-id="5bdfa-562">電腦的參考視圖條件。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-562">Reference viewing conditions for the PCS.</span></span>

2) <span data-ttu-id="5bdfa-563">參考電腦的範圍。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-563">Reference PCS gamut.</span></span>

3) <span data-ttu-id="5bdfa-564">在電腦值和 colorimetry 之間轉換的裝置型號。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-564">Device model that converts between PCS values and colorimetry.</span></span>

<span data-ttu-id="5bdfa-565">WCS 設定檔及其相關聯的凸輪會以參數形式提供。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-565">The WCS profile and its associated CAM are provided as parameters.</span></span> <span data-ttu-id="5bdfa-566">Colorimetry 和電腦編碼之間有兩種基準裝置模型可進行轉換。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-566">There are two baseline device models that convert between colorimetry and the PCS encoding.</span></span> <span data-ttu-id="5bdfa-567">您需要兩個的原因，如下所述。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-567">The reason you need two is explained below.</span></span>

1) <span data-ttu-id="5bdfa-568">您可以從「ICC 設定檔」格式規格取得電腦的參考視圖條件。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-568">You can obtain the reference viewing conditions for the PCS from the ICC profile format specification.</span></span> <span data-ttu-id="5bdfa-569">在 ICC 配置檔案格式規格中提供的資訊，足以計算將 CMS 所使用的凸輪初始化所需的所有資料。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-569">The information provided in the ICC profile format specification is sufficient to compute all the data required to initialize the CAM used by the CMS.</span></span> <span data-ttu-id="5bdfa-570">基於一致性和彈性，此資訊會儲存在 WCS 色彩設定檔中。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-570">For consistency and flexibility, this information is stored in a WCS color profile.</span></span>

2) <span data-ttu-id="5bdfa-571">您也可以使用 WCS 設定檔來儲存定義電腦參考範圍的範例。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-571">You can also use a WCS profile to store samples that define the reference gamut of the PCS.</span></span> <span data-ttu-id="5bdfa-572">引用色彩管理系統 (CMS) 有兩種建立範圍界限的方式。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-572">The CITE color management system (CMS) has two ways to create gamut boundaries.</span></span> <span data-ttu-id="5bdfa-573">其中一個是將完整的裝置空間取樣，並使用裝置模型來建立測量值。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-573">One is to sample the complete device space and use the device model to create measurement values.</span></span> <span data-ttu-id="5bdfa-574">第二種方法是使用設定檔中的測量樣本來建立參考範圍界限。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-574">The second method is to use measured samples from the profile to create a reference gamut boundary.</span></span> <span data-ttu-id="5bdfa-575">由於 ICC 電腦的範圍太大而無法提供有用的參考範圍，因此第一個方法是不適當的。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-575">Because the gamut of the ICC PCS is too large to make a useful reference gamut, the first method is inappropriate.</span></span> <span data-ttu-id="5bdfa-576">但第二個方法是彈性、以設定檔為基礎的方法。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-576">But the second method is a flexible, profile-based approach.</span></span> <span data-ttu-id="5bdfa-577">若要重新定義參照電腦範圍，您可以變更電腦裝置設定檔中的測量資料。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-577">To redefine the reference PCS gamut, you can change the measurement data in the PCS device profile.</span></span>

3) <span data-ttu-id="5bdfa-578">ICC 電腦是理想裝置的模型。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-578">The ICC PCS is a modeling of an ideal device.</span></span> <span data-ttu-id="5bdfa-579">藉由將電腦的模型建立為真實裝置，您就可以利用智慧型 CMM 中所使用的色彩管理流程。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-579">By creating a model of the PCS as a real device, you can take advantage of the color management process used in the Smart CMM.</span></span> <span data-ttu-id="5bdfa-580">從 colorimetry 建立裝置型號至電腦編碼很簡單。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-580">Creating a device model from colorimetry to the PCS encoding is straightforward.</span></span> <span data-ttu-id="5bdfa-581">您只需在真正的色度值和電腦編碼值之間進行對應。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-581">You simply map between the true colorimetric values and the PCS encoded values.</span></span> <span data-ttu-id="5bdfa-582">由於裝置型號的 CMS 介面僅支援 XYZ 值，您可能也必須在 XYZ 和 LAB 之間進行對應。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-582">Since the CMS interface for device models only supports XYZ values, you might also have to map between XYZ and LAB.</span></span> <span data-ttu-id="5bdfa-583">這是知名的轉換。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-583">This is a well-known transformation.</span></span> <span data-ttu-id="5bdfa-584">此模型會在7.9 和7.10 章節的 < 基準裝置模型2.2.02 檔中說明。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-584">This model is described in the document 2.2.02 "Baseline Device Models" in sections 7.9 and 7.10.</span></span>

<span data-ttu-id="5bdfa-585">如果裝置的範圍大於電腦的範圍，您可能必須執行一些 gamut 對應。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-585">You might have to perform some gamut mapping, if the gamut of the device is larger than the gamut of the PCS.</span></span> <span data-ttu-id="5bdfa-586">基準 GMMs 可用於此用途。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-586">The baseline GMMs can be used for this purpose.</span></span> <span data-ttu-id="5bdfa-587">請注意，已正確建立的 ICC 設定檔具有相對色度、感知和飽和度意圖的查閱資料表，不過它們在內部都可能指向相同的 LUT。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-587">Note that a properly created ICC profile has lookup tables for the Relative Colorimetric, Perceptual, and Saturation intents, although these may all point to the same LUT internally.</span></span>

![此圖顯示如何建立 T o B L U T。](images/transformcreation-image128.png)

<span data-ttu-id="5bdfa-589">**圖5：** 建立 AToB LUT</span><span class="sxs-lookup"><span data-stu-id="5bdfa-589">**Figure 5:** Creation of an AToB LUT</span></span>

<span data-ttu-id="5bdfa-590">[圖 5] 說明此進程。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-590">This process is illustrated in Figure 5.</span></span> <span data-ttu-id="5bdfa-591">首先，裝置模型會從 DM 設定檔中的資料初始化。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-591">First, the device model is initialized from the data in the DM profile.</span></span> <span data-ttu-id="5bdfa-592">然後，依照下列方式來建立裝置範圍界限。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-592">Then, construct a device gamut boundary as follows.</span></span> <span data-ttu-id="5bdfa-593">裝置模型的資料取樣是透過裝置模型執行，以取得色度資料。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-593">A sampling of data from the device model is run through the device model to obtain colorimetric data.</span></span> <span data-ttu-id="5bdfa-594">色度資料是透過凸輪執行，以建立外觀資料。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-594">The colorimetric data is run through the CAM to create appearance data.</span></span> <span data-ttu-id="5bdfa-595">外觀資料會用來建立裝置範圍界限。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-595">The appearance data is used to create the device gamut boundary.</span></span>

<span data-ttu-id="5bdfa-596">接下來，使用參照電腦測量設定檔中的資料來建立電腦的範圍界限。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-596">Next, use data from the reference PCS measurement profile to create a gamut boundary for the PCS.</span></span>

<span data-ttu-id="5bdfa-597">使用剛剛建立的兩個 gamut 界限來初始化 GMM。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-597">Use the two gamut boundaries just created to initialize a GMM.</span></span> <span data-ttu-id="5bdfa-598">然後，使用裝置型號、GMM 和電腦裝置模型來建立轉換。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-598">Then, use the device model, the GMM, and the PCS device model to create a transform.</span></span> <span data-ttu-id="5bdfa-599">透過轉換執行裝置空間的取樣，以建立 AToB LUT。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-599">Run a sampling of device space through the transform to create an AToB LUT.</span></span>

![此圖顯示如何使用 P C S 空間的取樣來建立 T o B L U T。](images/transformcreation-image130.png)

<span data-ttu-id="5bdfa-601">**圖6：** 建立 BToA LUT</span><span class="sxs-lookup"><span data-stu-id="5bdfa-601">**Figure 6:** Creation of a BToA LUT</span></span>

<span data-ttu-id="5bdfa-602">圖6說明如何建立 BToA LUT。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-602">Figure 6 illustrates the creation of the BToA LUT.</span></span> <span data-ttu-id="5bdfa-603">這幾乎與建立 AToB LUT，並交換來源和目的地的角色相同。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-603">This is almost identical to creating an AToB LUT, with the roles of source and destination exchanged.</span></span> <span data-ttu-id="5bdfa-604">此外，您必須將完整的電腦範圍取樣，才能建立 LUT。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-604">Also, you must sample the full PCS gamut to create the LUT.</span></span>

<span data-ttu-id="5bdfa-605">請注意，由於 CIECAM02) 中的凸輪 (是在程式中進行，所以彩色會在媒體的白色點和電腦的白色 (點之間進行調整，而由 D50 所規定的) 會由凸輪透明地影響。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-605">Note that because the CAM (CIECAM02 in WCS) is involved in the process, chromatic adaptation between the media white point and the PCS white point (mandated by ICC to be that of D50) is effected transparently by the CAM.</span></span>

## <a name="hdr-virtual-rgb-devices"></a><span data-ttu-id="5bdfa-606">HDR 虛擬 RGB 裝置</span><span class="sxs-lookup"><span data-stu-id="5bdfa-606">HDR virtual RGB devices</span></span>

<span data-ttu-id="5bdfa-607">產生適用于 HDR 虛擬 RGB 裝置的設定檔時，必須提供特殊考慮;亦即，colorant 值可能小於0.0 或大於1.0 的裝置。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-607">Special consideration must be given when generating profiles for HDR virtual RGB devices; that is, devices for which the colorant values may be less than 0.0 or greater than 1.0.</span></span> <span data-ttu-id="5bdfa-608">在產生 ATOB LUT 時，會建立一組較大的1D 輸入 LUTs。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-608">In the generation of the ATOB LUT, a larger set of 1D input LUTs is built.</span></span> <span data-ttu-id="5bdfa-609">Colorant 值會縮放並位移至範圍0。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-609">Colorant values are scaled and offset to the range 0 ..</span></span> <span data-ttu-id="5bdfa-610">1使用 WCS 設定檔中的最小和最大 colorant 值。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-610">1 using the minimum and maximum colorant values in the WCS profile.</span></span>

<span data-ttu-id="5bdfa-611">因為 HDR 裝置的 colorant 空間不太可能完全擴展，所以也會在 3D LUT 中針對標記提供特殊支援。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-611">Because the colorant space for HDR devices is not likely to be completely populated, special support is provided in the 3-D LUT for the tag as well.</span></span> <span data-ttu-id="5bdfa-612">為了處理稀疏擴展區域中的色彩，colorants 會重新編碼，因此可以達成超過0.0 和1.0 的推斷。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-612">In order to handle colors in the sparsely populated region, the colorants are recoded so that extrapolation beyond 0.0 and 1.0 can be achieved.</span></span> <span data-ttu-id="5bdfa-613">使用的範圍為-1。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-613">The range used is -1 ..</span></span> <span data-ttu-id="5bdfa-614">+ 4。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-614">+4.</span></span>

<span data-ttu-id="5bdfa-615">由於適用于 3-d LUT 的重新調整已套用，因此會建立一組1D 輸出 LUTs，以將結果對應至範圍0。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-615">Because of the rescaling applied for the 3-D LUT, a set of 1D output LUTs is built to map the result back to the range 0 ..</span></span> <span data-ttu-id="5bdfa-616">1.</span><span class="sxs-lookup"><span data-stu-id="5bdfa-616">1.</span></span>

## <a name="more-than-one-pcs"></a><span data-ttu-id="5bdfa-617">一部以上的電腦</span><span class="sxs-lookup"><span data-stu-id="5bdfa-617">More than one PCS</span></span>

<span data-ttu-id="5bdfa-618">ICC 發現一台電腦沒有足夠的彈性可符合 CMS 的所有用途。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-618">The ICC found that one PCS was not sufficiently flexible to meet all the intended uses of a CMS.</span></span> <span data-ttu-id="5bdfa-619">在設定檔規格的第4版中，ICC 闡明瞭實際上有兩種電腦編碼。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-619">In version 4 of the Profile Specification, the ICC clarified that there are actually two PCS encodings.</span></span> <span data-ttu-id="5bdfa-620">一個用於色度意圖;另一個用於可感知意圖。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-620">One is used for the colorimetric intents; another is used for the perceptual intent.</span></span> <span data-ttu-id="5bdfa-621"> (飽和度意圖未指定任何電腦。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-621">(No PCS is specified for the Saturation intent.</span></span> <span data-ttu-id="5bdfa-622">ICC 已將此部分省略。 ) 色度電腦的最小和最大亮度都已指定，但色度和色調值的範圍大約為±127。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-622">The ICC has left this part ambiguous.) The colorimetric PCS has a minimum and maximum lightness specified, but the chroma and hue values range to roughly ± 127.</span></span> <span data-ttu-id="5bdfa-623">這台電腦看起來像是一個矩形 prism。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-623">This PCS looks like a rectangular prism.</span></span> <span data-ttu-id="5bdfa-624">如先前所述，可感知的電腦音量與噴墨印表機的範圍類似。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-624">As mentioned previously, the perceptual PCS volume resembles the gamut of an inkjet printer.</span></span>

<span data-ttu-id="5bdfa-625">這兩個 ICC PCSs 也有兩種不同的數位編碼。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-625">The two ICC PCSs also have two different digital encodings.</span></span> <span data-ttu-id="5bdfa-626">在感知電腦中，值為零表示亮度為零。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-626">In the perceptual PCS, a value of zero represents a lightness of zero.</span></span> <span data-ttu-id="5bdfa-627">在色度電腦中，值為0代表電腦的最小亮度（大於零）。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-627">In the colorimetric PCS, a value of zero represents the minimum lightness of the PCS, which is greater than zero.</span></span> <span data-ttu-id="5bdfa-628">您可以針對每部電腦編碼使用不同的裝置型號，以解決此問題。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-628">You can solve this problem by having a different device model for each of the PCS encodings.</span></span>

## <a name="gamut-mapping"></a><span data-ttu-id="5bdfa-629">Gamut 對應</span><span class="sxs-lookup"><span data-stu-id="5bdfa-629">Gamut mapping</span></span>

<span data-ttu-id="5bdfa-630">若要在 ICC 設定檔中建立 AToB LUTs，您可以從裝置範圍對應到適當的電腦空間。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-630">To create the AToB LUTs in an ICC profile, you map from the device gamut to the appropriate PCS space.</span></span> <span data-ttu-id="5bdfa-631">若要建立 BToA LUTs，您可以從 [電腦] 空間對應到裝置範圍。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-631">To create the BToA LUTs, you map from the PCS space to the device gamut.</span></span> <span data-ttu-id="5bdfa-632">AToB LUTs 的對應相當類似于以測量為基礎的 CMS 中所使用的對應。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-632">The mapping for the AToB LUTs is quite similar to that used in a measurement-based CMS.</span></span> <span data-ttu-id="5bdfa-633">針對可感知的電腦，使用任何超出範圍色彩的裁剪或壓縮，將裝置合理範圍對應到可感知的電腦範圍界限。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-633">For the perceptual PCS, map the device plausible gamut to the perceptual PCS gamut boundary, using either clipping or compression for any out-of-gamut colors.</span></span> <span data-ttu-id="5bdfa-634">針對色度意圖，您可能必須裁剪亮度，但色度和色調值全都會放在色階電腦範圍內。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-634">For the colorimetric intents, you might have to clip lightness, but the chroma and hue values are all going to fit in the colorimetric PCS gamut.</span></span>

<span data-ttu-id="5bdfa-635">BToA LUTs 的對應有點不同。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-635">The mapping for the BToA LUTs is a little different.</span></span> <span data-ttu-id="5bdfa-636">色度意圖仍很簡單;您只需將電腦值裁剪到裝置範圍中。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-636">The colorimetric intents are still easy; you just clip PCS values to the device gamut.</span></span> <span data-ttu-id="5bdfa-637">但 ICC 要求所有可能的電腦值都必須對應至某些裝置值，而不只是在可感知電腦的參考範圍內的值。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-637">But the ICC requires that all possible PCS values map to some device value, not merely those within the reference gamut of the perceptual PCS.</span></span> <span data-ttu-id="5bdfa-638">因此，您必須確定 GMMs 可以處理位於參考範圍外的來源色彩。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-638">So, you must make sure that the GMMs can handle source colors that are outside the reference gamut.</span></span> <span data-ttu-id="5bdfa-639">將這些色彩裁剪至裝置範圍界限，即可處理此情況。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-639">This can be handled by clipping those colors to the device gamut boundary.</span></span>

## <a name="baseline-device-to-icc-profile-class-mapping"></a><span data-ttu-id="5bdfa-640">基準裝置與 ICC 設定檔類別的對應</span><span class="sxs-lookup"><span data-stu-id="5bdfa-640">Baseline device to ICC profile class mapping</span></span>



| <span data-ttu-id="5bdfa-641">基準裝置類型</span><span class="sxs-lookup"><span data-stu-id="5bdfa-641">Baseline Device Type</span></span>              | <span data-ttu-id="5bdfa-642">ICC 設定檔類別</span><span class="sxs-lookup"><span data-stu-id="5bdfa-642">ICC Profile Class</span></span>       | <span data-ttu-id="5bdfa-643">備註</span><span class="sxs-lookup"><span data-stu-id="5bdfa-643">Remark</span></span>                                                                      |
|-----------------------------------|-------------------------|-----------------------------------------------------------------------------|
| <span data-ttu-id="5bdfa-644">RGB 捕獲裝置</span><span class="sxs-lookup"><span data-stu-id="5bdfa-644">RGB Capture Device</span></span>                | <span data-ttu-id="5bdfa-645">輸入裝置 ( "scnr" ) </span><span class="sxs-lookup"><span data-stu-id="5bdfa-645">Input Device ("scnr")</span></span>   | <span data-ttu-id="5bdfa-646">電腦 CIELAB。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-646">PCS is CIELAB.</span></span> <span data-ttu-id="5bdfa-647">AToB0Tag 是裝置到具有相對色度意圖的電腦。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-647">AToB0Tag is Device to PCS with relative colorimetric intent.</span></span> |
| <span data-ttu-id="5bdfa-648">CRT、LCD 監視器</span><span class="sxs-lookup"><span data-stu-id="5bdfa-648">CRT, LCD monitor</span></span>                  | <span data-ttu-id="5bdfa-649">顯示裝置 ( "mntr" ) </span><span class="sxs-lookup"><span data-stu-id="5bdfa-649">Display Device ("mntr")</span></span> | <span data-ttu-id="5bdfa-650">電腦 CIEXYZ。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-650">PCS is CIEXYZ.</span></span> <span data-ttu-id="5bdfa-651">請參閱下列模型轉換。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-651">See the following for model conversion.</span></span>                      |
| <span data-ttu-id="5bdfa-652">RGB 投影機</span><span class="sxs-lookup"><span data-stu-id="5bdfa-652">RGB Projector</span></span>                     | <span data-ttu-id="5bdfa-653">色彩空間 ( "spac" ) </span><span class="sxs-lookup"><span data-stu-id="5bdfa-653">Color Space ("spac")</span></span>    | <span data-ttu-id="5bdfa-654">電腦 CIELAB。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-654">PCS is CIELAB.</span></span>                                                              |
| <span data-ttu-id="5bdfa-655">RGB 和 CMYK 印表機</span><span class="sxs-lookup"><span data-stu-id="5bdfa-655">RGB and CMYK printer</span></span>              | <span data-ttu-id="5bdfa-656">輸出裝置 ( "prtr" ) </span><span class="sxs-lookup"><span data-stu-id="5bdfa-656">Output Device ("prtr")</span></span>  | <span data-ttu-id="5bdfa-657">電腦 CIELAB。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-657">PCS is CIELAB.</span></span>                                                              |
| <span data-ttu-id="5bdfa-658">RGB 虛擬裝置 (非 HDR 案例) </span><span class="sxs-lookup"><span data-stu-id="5bdfa-658">RGB Virtual Device (non-HDR case)</span></span> | <span data-ttu-id="5bdfa-659">顯示裝置 ( "mntr" ) </span><span class="sxs-lookup"><span data-stu-id="5bdfa-659">Display Device ("mntr")</span></span> | <span data-ttu-id="5bdfa-660">電腦 CIEXYZ。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-660">PCS is CIEXYZ.</span></span>                                                              |
| <span data-ttu-id="5bdfa-661">RGB 虛擬裝置 (HDR 案例) </span><span class="sxs-lookup"><span data-stu-id="5bdfa-661">RGB Virtual Device (HDR case)</span></span>     | <span data-ttu-id="5bdfa-662">色彩空間 ( "spac" ) </span><span class="sxs-lookup"><span data-stu-id="5bdfa-662">Color Space ("spac")</span></span>    | <span data-ttu-id="5bdfa-663">電腦 CIELAB。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-663">PCS is CIELAB.</span></span>                                                              |



 

<span data-ttu-id="5bdfa-664">監視設定檔的轉換不牽涉到建立 LUTs，而是包含建立矩陣或 >FLIGHTRECORDERCURRENT.TRC 模型。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-664">The conversion of monitor profiles does not involving building LUTs, but instead consists of building a matrix or TRC model.</span></span> <span data-ttu-id="5bdfa-665">在 ICC 中使用的模型與 WCS CRT 或 LCD 模型中使用的模型略有不同，因為缺少「黑色更正」詞彙。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-665">The model used in ICC is slightly different from the one used in the WCS CRT or LCD modeling in that the "black correction" term is missing.</span></span> <span data-ttu-id="5bdfa-666">具體而言，</span><span class="sxs-lookup"><span data-stu-id="5bdfa-666">Specifically,</span></span>

<span data-ttu-id="5bdfa-667">WCS 模型：</span><span class="sxs-lookup"><span data-stu-id="5bdfa-667">WCS model:</span></span> ![顯示 W C S 模型。](images/transformcreation-image132.png)

<span data-ttu-id="5bdfa-669">ICC 模型：</span><span class="sxs-lookup"><span data-stu-id="5bdfa-669">ICC model:</span></span> ![顯示 I C C 模型。](images/transformcreation-image134.png)

<span data-ttu-id="5bdfa-671">從 WCS 模型到 ICC 模型的轉換如下所示。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-671">The conversion from WCS model to ICC model is done as follows.</span></span>

<span data-ttu-id="5bdfa-672">定義新曲線：</span><span class="sxs-lookup"><span data-stu-id="5bdfa-672">Define new curves:</span></span>

![顯示定義新曲線的矩陣。](images/transformcreation-image136.png)

<span data-ttu-id="5bdfa-674">這些都不是音訊複製曲線，因為它們不會將1對應至1。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-674">These are not tone reproduction curves because they do not map 1 to 1.</span></span> <span data-ttu-id="5bdfa-675">正規化將達成此目標。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-675">A normalization will achieve that.</span></span> <span data-ttu-id="5bdfa-676">ICC 模型的最終定義如下：</span><span class="sxs-lookup"><span data-stu-id="5bdfa-676">The final definitions of the ICC model are:</span></span>

![顯示 I C C C 模型的最後定義。](images/transformcreation-image138.png)

![顯示 C # c C 模型的最終矩陣。](images/transformcreation-image140.png)

<span data-ttu-id="5bdfa-679">針對非 HDR RGB 虛擬裝置，您也會產生顯示的 ICC 設定檔以取得空間效率。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-679">For non-HDR RGB virtual devices, you are also generating a display ICC profile for space efficiency.</span></span> <span data-ttu-id="5bdfa-680">在此情況下，您可以直接從 WCS 設定檔的主要複本取得 tristimulus 矩陣 *M ICC* ，而不需要上述模型轉換。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-680">In that case, the tristimulus matrix *M ICC* can be obtained directly from the primaries of the WCS profile without the above model conversion.</span></span> <span data-ttu-id="5bdfa-681">最後一點要注意的是，這個 tristimulus 矩陣必須 chromatically 調整成 D50，才能符合電腦的 ICC 規格。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-681">One final, but important, note is that this tristimulus matrix must be chromatically adapted to D50 to conform with the ICC specification of the PCS.</span></span> <span data-ttu-id="5bdfa-682">換句話說，要在 ICC 設定檔中編碼之矩陣的每個資料列上的專案，必須分別加總為96.42、100和82.49。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-682">In other words, the entries on each row of the matrix to be encoded in the ICC profile must sum respectively to 96.42, 100, and 82.49.</span></span> <span data-ttu-id="5bdfa-683">在目前的執行中，彩色的調整是由 CAT02 完成，也就是 CAM02 中使用的彩色調整轉換。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-683">In the current implementation, the chromatic adaptation is done by CAT02, which is also the chromatic adaptation transform used in CAM02.</span></span>

## <a name="black-preservation-and-black-generation"></a><span data-ttu-id="5bdfa-684">黑色保留和黑色世代</span><span class="sxs-lookup"><span data-stu-id="5bdfa-684">Black Preservation and Black Generation</span></span>

<span data-ttu-id="5bdfa-685">黑色保留的執行會與支援黑色通道的裝置產生黑色通道相關聯。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-685">Implementation of black preservation is tied together with the generation of the black channel in devices that support a black channel.</span></span> <span data-ttu-id="5bdfa-686">為了達成此目的，會收集每個來源色彩的相關資訊，以允許支援黑色頻道的裝置型號判斷輸出上的黑色通道的最佳設定。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-686">To accomplish this, information about each source color is collected to allow device models that support a black channel to determine how best to set the black channel on output.</span></span> <span data-ttu-id="5bdfa-687">雖然黑色保留適用于將一個黑色通道裝置轉換成另一個黑色通道裝置的色彩轉換，但是針對所有涉及黑色通道目的地裝置的轉換，都會實行黑色世代。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-687">While black preservation is pertinent for color transforms that convert between one black-channel device to another, black generation is implemented for all transform involving a black-channel destination device.</span></span>

<span data-ttu-id="5bdfa-688">黑色通道資訊會記錄在名為 [**BlackInformation**](/previous-versions/windows/desktop/api/WcsPlugIn/ns-wcsplugin-_blackinformation)的資料結構中。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-688">Black channel information is recorded in a data structure called [**BlackInformation**](/previous-versions/windows/desktop/api/WcsPlugIn/ns-wcsplugin-_blackinformation).</span></span> <span data-ttu-id="5bdfa-689">**BlackInformation** 結構包含布林值，指出色彩是否只包含黑色 colorant，以及表示 "blackness" 角度的數值（稱為黑色權數）。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-689">The **BlackInformation** structure contains a boolean indicating whether the color contains only black colorant and a numeric value indicating the degree of "blackness" called black weight.</span></span> <span data-ttu-id="5bdfa-690">針對支援黑色通道的來源裝置，黑色權數是來源色彩中黑色 colorant 的百分比。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-690">For source devices that support a black channel, the black weight is the percentage of black colorant in the source color.</span></span> <span data-ttu-id="5bdfa-691">如果來源裝置不包含黑色通道，則會使用其他 colorants 和外觀值來計算黑色權數。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-691">For source devices that do not contain a black channel, the black weight is computed using the other colorants and the appearance value.</span></span> <span data-ttu-id="5bdfa-692">名為 "color 純度" 的值是藉由讓最大 colorant 值與最小 colorant 值之間的差異除以最大 colorant 值來計算。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-692">A value called "color purity" is computed by taking the difference between the maximum colorant value and the minimum colorant value divided by the maximum colorant value.</span></span> <span data-ttu-id="5bdfa-693">稱為「相對亮度」的值是藉由讓色彩的亮度與目的地裝置的最小亮度之間的差異除以目的地裝置的最小和最大亮度之間的差異來計算。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-693">A value called "relative lightness" is computed by taking the difference between the lightness of the color and the minimum lightness for the destination device divided by the difference between the minimum and maximum lightness for the destination device.</span></span> <span data-ttu-id="5bdfa-694">如果來源裝置是 (監視器或投影機) 的加法裝置，則會將黑色權數判斷為1.0 減去色彩純度乘以相對亮度。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-694">If the source device is an additive device (monitor or projector), the black weight is determined to be the 1.0 minus the color purity multiplied by the relative lightness.</span></span> <span data-ttu-id="5bdfa-695">例如，如果來源裝置是 RGB 監視器，則會計算每個色彩的最大值和 R、G 和 B 的最大值，並以公式來決定黑色權數：</span><span class="sxs-lookup"><span data-stu-id="5bdfa-695">For example, if the source device is an RGB monitor, the maximum value and minimum value of R, G, and B for each color is computed and the black weight is determined by the formula:</span></span>

<span data-ttu-id="5bdfa-696">BW = (1.0 – (max (R、G、B) – min (R、G、B) ) /max (R、G、B) ) \* 相對亮度</span><span class="sxs-lookup"><span data-stu-id="5bdfa-696">BW = (1.0 – (max(R,G,B) – min(R,G,B)) / max(R, G, B)) \* relative lightness</span></span>

<span data-ttu-id="5bdfa-697">如果來源裝置支援 subtractive 色彩（例如，CMY 印表機），則個別的 colorants 必須是在上述公式中使用之前，從 1.0) 減去 (。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-697">If the source device supports subtractive coloration, for example, a CMY printer, then the individual colorants must be "ones complemented" (subtracted from 1.0) before use in the preceding formula.</span></span> <span data-ttu-id="5bdfa-698">因此，若是 CMY 印表機，R = 1.0 – C、G = 1.0 – M 和 B = 1.0 – Y。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-698">Therefore, for a CMY printer, R = 1.0 – C, G = 1.0 – M, and B = 1.0 – Y.</span></span>

<span data-ttu-id="5bdfa-699">色彩轉譯程式期間會決定色彩轉換所處理的每個色彩的黑色資訊。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-699">The black information for each color processed by the color transform is determined during the color translation process.</span></span> <span data-ttu-id="5bdfa-700">只有在指定了黑色保留時，才會決定僅限黑色的資訊。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-700">The black-only information is only determined if black preservation is specified.</span></span> <span data-ttu-id="5bdfa-701">如果目的地裝置型號支援黑色 colorant，一律會決定黑色權數。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-701">Black weight is always determined if the destination device model support a black colorant.</span></span> <span data-ttu-id="5bdfa-702">黑色資訊會透過 [**ColorimetricToDeviceColorsWithBlack**](/previous-versions/windows/desktop/api/WcsPlugIn/nf-wcsplugin-idevicemodelplugin-colorimetrictodevicecolorswithblack) 方法傳遞至目的地裝置模型，該方法會使用產生的 LUT。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-702">The black information is passed to the destination device model via the [**ColorimetricToDeviceColorsWithBlack**](/previous-versions/windows/desktop/api/WcsPlugIn/nf-wcsplugin-idevicemodelplugin-colorimetrictodevicecolorswithblack) method, which uses the resulting LUT.</span></span>

<span data-ttu-id="5bdfa-703">請注意，由於色彩轉換優化，上述進程只會在建立優化的轉換 LUT 期間發生，而不是在 TranslateColors 方法執行期間發生。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-703">Note that, because of color transform optimization, the above process occurs only during the creation of the optimized transform LUT, not during the execution of the TranslateColors method.</span></span>

## <a name="optimization-for-transforms-with-more-than-three-source-channels"></a><span data-ttu-id="5bdfa-704">使用三個以上的來源頻道進行轉換的優化</span><span class="sxs-lookup"><span data-stu-id="5bdfa-704">Optimization for transforms with more than three source channels</span></span>

<span data-ttu-id="5bdfa-705">優化轉換的大小取決於數個因素：來源裝置中的色彩頻道數目、每個來源色頻的表格步驟數目，以及輸出裝置中的色彩頻道數目。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-705">The size of the optimized transform is determined by several factors: the number of color channels in the source device, the number of steps in the table for each source color channel, and the number of color channels in the output device.</span></span> <span data-ttu-id="5bdfa-706">判斷轉換資料表大小的公式如下：</span><span class="sxs-lookup"><span data-stu-id="5bdfa-706">The formula for determining the transform table size is:</span></span>

<span data-ttu-id="5bdfa-707">大小 = 每個通道來源的步驟數 <sub>\ 裝置 (數目 \ 通道 \ in \ 來源 \ 裝置) </sub> x 輸出裝置中的通道數目</span><span class="sxs-lookup"><span data-stu-id="5bdfa-707">Size = Number of steps per channel <sub>source\ device(Number\ of\ channels\ in\ source\ device)</sub> x number of channels in output device</span></span>

<span data-ttu-id="5bdfa-708">如您所見，資料表的大小會根據來源裝置中的通道數目以指數方式成長。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-708">As you can see, the size of the table grows exponentially depending on the number of channels in the source device.</span></span> <span data-ttu-id="5bdfa-709">許多來源裝置都支援三色通道，例如紅色、綠色和藍色。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-709">Many source devices support three color channels, for example,Red, Green, and Blue.</span></span> <span data-ttu-id="5bdfa-710">但是，如果來源裝置支援四個通道，例如 CMYK，則資料表的大小和建立資料表所需的時間會隨著步驟數目的因素成長。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-710">However, if a source device supports four channels, such as CMYK, the size of the table and the time required to construct the table grow by a factor of the number of steps.</span></span> <span data-ttu-id="5bdfa-711">在以度量為基礎的 CMS 中，轉換是「即時」的，這次可能無法接受。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-711">In a measurement-based CMS where transforms are constructed "on the fly," this time may well be unacceptable.</span></span>

<span data-ttu-id="5bdfa-712">若要減少建立色彩轉換表所需的時間，您可以利用兩個事實。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-712">To reduce the time required to construct the color conversion table, it is possible to take advantage of two facts.</span></span> <span data-ttu-id="5bdfa-713">首先，雖然來源裝置可支援三個以上的色頻，但與中繼裝置無關的色彩空間 (CIECAM02 Ja-jp <sub>c</sub> b <sub>c</sub> ) 只有三個色頻。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-713">First, while the source device may support more than three color channels, the intermediate device-independent color space (CIECAM02 Ja <sub>C</sub> b <sub>C</sub> ) has only three color channels.</span></span> <span data-ttu-id="5bdfa-714">其次，處理常式中最耗時的部分不是裝置模型 (從裝置色彩座標轉換成 tristimulus 值) ，但是範圍對應。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-714">Second, the most time-consuming part of the processing is not the device modeling (converting from device color coordinates to tristimulus values), but the gamut mapping.</span></span> <span data-ttu-id="5bdfa-715">您可以使用這些事實來建立初步的色彩轉換表，以透過範圍對應步驟來轉換裝置獨立色彩空間中的色彩，最後再透過輸出裝置色彩模型來轉換。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-715">Using these facts, you can construct a preliminary color conversion table that converts colors in the device-independent color space through the gamut mapping steps, and finally, through the output device color model.</span></span> <span data-ttu-id="5bdfa-716">此資料表的結構是三個維度。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-716">Construction of this table is of dimension three.</span></span> <span data-ttu-id="5bdfa-717">接著，我們會藉由將來源色彩組合轉換成中繼裝置獨立空間，然後使用初稿的色彩轉換表，完成轉換輸出裝置色彩空間，來構成四個最終的色彩轉換表。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-717">Then we construct the dimension four final color-conversion table by converting the source color combinations to intermediate device-independent space, and then, using the preliminary color-conversion table, finish the conversion to the output device color space.</span></span> <span data-ttu-id="5bdfa-718">因此，您可以減少查閱資料表中的 (步驟數目，) <sub>number \ of \ 通道</sub> 範圍將計算對應到中繼資料表₃範圍對應計算中的步驟數目。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-718">So you reduce from computing (number of steps in the lookup table) <sub>number\ of\ channels</sub> gamut mapping computations to the number of steps in the intermediate table ₃ gamut mapping computations.</span></span> <span data-ttu-id="5bdfa-719">雖然您必須在 (查閱資料表中執行步驟的數目，) 裝置模型化和三維資料表查閱的 # \ <sub>通道計算數目</sub> ，但這仍比原始計算快得多。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-719">Even though you have to perform number of steps in the (lookup table) <sub>number\ of\ channels</sub> computations of device modeling and three-dimensional table lookups, this is still much faster than the original calculation.</span></span>

<span data-ttu-id="5bdfa-720">上述程式可正常運作，因為不需要在來源裝置模型和色彩轉換中的任何其他元件之間傳遞資訊。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-720">The preceding process will work well provided that there is no need for information to pass between the source device model and any other component in the color transform.</span></span> <span data-ttu-id="5bdfa-721">但是，如果輸出裝置和來源裝置都支援黑色 colorant，而來源黑色 colorant 用於判斷輸出黑色 colorant，則程式將無法正確地傳達來源黑色資訊。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-721">However, if the output device and the source device both support a black colorant, and the source black colorant is used in determining the output black colorant, the process will fail to properly communicate the source black information.</span></span> <span data-ttu-id="5bdfa-722">替代程式是建立初步的色彩轉換表，只透過範圍對應步驟來轉換裝置獨立色彩空間中的色彩。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-722">An alternative process is to construct a preliminary color conversion table that converts colors in the device-independent color space through the gamut mapping steps only.</span></span> <span data-ttu-id="5bdfa-723">然後使用下列步驟來建立維度四個最終的色彩轉換表：) 將來源色彩組合轉換成與中繼裝置無關的空間，b) 執行範圍對應步驟，方法是在初步色彩表中進行插入，而不是套用實際的 gamut 對應進程，而 c) 使用範圍對應步驟中所產生的值和任何來源黑色通道資訊，使用輸出裝置模型來計算輸出裝置 colorants。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-723">Then construct the dimension four final color-conversion table using the following steps: a) convert the source color combinations to intermediate device-independent space, b) perform the gamut mapping steps by interpolating in the preliminary color table instead of applying the actual gamut mapping processes, and c) use the resulting values from the gamut mapping steps and any source black channel information to compute the output device colorants using the output device model.</span></span> <span data-ttu-id="5bdfa-724">當來源和輸出裝置模型之間有資訊傳輸時，即使沒有黑色通道，也可以使用此程式。例如，如果兩個模組是使用允許在模組之間進行資料交換的外掛程式架構所執行。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-724">This process also can be used when there is information transferred between the source and output device models even if there is no black channel; for example, if the two modules are implemented with a plug-in architecture that allows for data interchange between modules.</span></span>

<span data-ttu-id="5bdfa-725">先前的兩個處理常式可以用來有效地改善建立四維色彩轉換資料表所需的時間。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-725">The preceding two processes can be used to effectively improve the time required to construct the four-dimensional color transform table.</span></span>

### <a name="checkgamut"></a><span data-ttu-id="5bdfa-726">CheckGamut</span><span class="sxs-lookup"><span data-stu-id="5bdfa-726">CheckGamut</span></span>

<span data-ttu-id="5bdfa-727">ICM 呼叫 CreateTransform 和 **CreateMultiProfileTransform** 會取得旗標值的文字，其中一個是啟用範圍 \_ \_ 檢查。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-727">The ICM calls CreateTransform and **CreateMultiProfileTransform** take a word of flag values, one of which is ENABLE\_GAMUT\_CHECKING.</span></span> <span data-ttu-id="5bdfa-728">當設定這個旗標時，引用必須以不同的方式建立轉換。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-728">When this flag is set, CITE must create the transform differently.</span></span> <span data-ttu-id="5bdfa-729">初始步驟相同：必須初始化來源和目的地攝影機，然後必須初始化來源和目的地範圍界限描述元。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-729">The initial steps are the same: the source and destination CAMs must be initialized, then the source and destination gamut boundary descriptors must be initialized.</span></span> <span data-ttu-id="5bdfa-730">無論指定的意圖為何，都必須使用 CheckGamut GMM。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-730">Regardless of the specified intent, the CheckGamut GMM must be used.</span></span> <span data-ttu-id="5bdfa-731">CheckGamut GMM 應該使用來源和目的地裝置模型和範圍界限描述項進行初始化。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-731">The CheckGamut GMM should be initialized using the source and destination device models and gamut boundary descriptors.</span></span> <span data-ttu-id="5bdfa-732">不過，轉換接著應建立截斷的轉換，其中包含來源裝置模型、來源凸輪、任何仲介 GMMs 和 CheckGamut GMM。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-732">However, the transform should then create a truncated transform comprising the source device model, the source CAM, any intervening GMMs, and the CheckGamut GMM.</span></span> <span data-ttu-id="5bdfa-733">這可確保 CheckGamut CMM 輸出的 delta J、delta C 和 delta h 值會成為最後產生的值。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-733">This assures that the delta J, delta C, and delta h values output by the CheckGamut CMM become the final resulting values.</span></span>

<span data-ttu-id="5bdfa-734">當轉換中只有兩個裝置設定檔時，CheckGamut 的意義很清楚。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-734">The meaning of CheckGamut is clear when there are only two device profiles in the transform.</span></span> <span data-ttu-id="5bdfa-735">當有兩個以上的裝置設定檔和兩個以上的 GMMs 時，CheckGamut 會報告是否已透過第一個裝置型號轉換的色彩，以及最後一個 GMM 以外的所有色彩是否落在目的地裝置的範圍內。</span><span class="sxs-lookup"><span data-stu-id="5bdfa-735">When there are more than two device profiles and more than two GMMs, then CheckGamut reports whether the colors which have been transformed through the first device model and all but the last GMM fall within the gamut of the destination device.</span></span>

## <a name="related-topics"></a><span data-ttu-id="5bdfa-736">相關主題</span><span class="sxs-lookup"><span data-stu-id="5bdfa-736">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="5bdfa-737">基本色彩管理概念</span><span class="sxs-lookup"><span data-stu-id="5bdfa-737">Basic color management concepts</span></span>](basic-color-management-concepts.md)
</dt> <dt>

[<span data-ttu-id="5bdfa-738">Windows 色彩系統架構和演算法</span><span class="sxs-lookup"><span data-stu-id="5bdfa-738">Windows Color System Schemas and Algorithms</span></span>](windows-color-system-schemas-and-algorithms.md)
</dt> </dl>

 

 




