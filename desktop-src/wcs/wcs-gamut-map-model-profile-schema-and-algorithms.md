---
title: WCS Gamut 地圖模型設定檔架構和演算法
description: WCS Gamut 地圖模型設定檔架構和演算法
ms.assetid: 64b9871a-1b4f-4e9a-be4d-4c25b3198b91
keywords:
- 'Windows Color System (WCS) 、gamut 對應模型設定檔 (GMMP) '
- 'WCS (Windows Color System) 、gamut 地圖模型設定檔 (GMMP) '
- '影像色彩管理、gamut 地圖模型設定檔 (GMMP) '
- '色彩管理、gamut 地圖模型設定檔 (GMMP) '
- '色彩、gamut 地圖模型設定檔 (GMMP) '
- Windows Color System (WCS) ，設定檔
- WCS (Windows 色彩系統) ，設定檔
- 影像色彩管理，設定檔
- 色彩管理，設定檔
- 色彩，設定檔
- GMMP) 的 gamut 地圖模型設定檔 (
- 'GMMP (gamut 地圖模型設定檔) '
- WCS gamut 地圖模型設定檔
- '架構、gamut 地圖模型設定檔 (GMMP) '
- '演算法、gamut 對應模型設定檔 (GMMP) '
ms.localizationpriority: high
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3714e5d7592cb1fbbbfa98e238642a2fcb38bafd
ms.sourcegitcommit: de72a1294df274b0a71dc0fdc42d757e5f6df0f3
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/05/2021
ms.locfileid: "104554539"
---
# <a name="wcs-gamut-map-model-profile-schema-and-algorithms"></a><span data-ttu-id="95662-118">WCS Gamut 地圖模型設定檔架構和演算法</span><span class="sxs-lookup"><span data-stu-id="95662-118">WCS Gamut Map Model Profile Schema and Algorithms</span></span>

-   [<span data-ttu-id="95662-119">概觀</span><span class="sxs-lookup"><span data-stu-id="95662-119">Overview</span></span>](#overview)
-   [<span data-ttu-id="95662-120">Gamut 地圖模型設定檔架構</span><span class="sxs-lookup"><span data-stu-id="95662-120">Gamut Map Model Profile Architecture</span></span>](#gamut-map-model-profile-architecture)
-   [<span data-ttu-id="95662-121">範圍界限的產生</span><span class="sxs-lookup"><span data-stu-id="95662-121">Generation of the Gamut Boundary</span></span>](#generation-of-the-gamut-boundary)
-   [<span data-ttu-id="95662-122">GMMP 架構</span><span class="sxs-lookup"><span data-stu-id="95662-122">The GMMP Schema</span></span>](#the-gmmp-schema)
-   [<span data-ttu-id="95662-123">GMMP 架構元素</span><span class="sxs-lookup"><span data-stu-id="95662-123">The GMMP Schema Elements</span></span>](#the-gmmp-schema-elements)
-   [<span data-ttu-id="95662-124">GamutMapModel</span><span class="sxs-lookup"><span data-stu-id="95662-124">GamutMapModel</span></span>](#defaultbaselinegamutmapmodel-type)
    -   [<span data-ttu-id="95662-125">Namespace</span><span class="sxs-lookup"><span data-stu-id="95662-125">Namespace</span></span>](#namespace)
    -   [<span data-ttu-id="95662-126">版本</span><span class="sxs-lookup"><span data-stu-id="95662-126">Version</span></span>](#version)
    -   [<span data-ttu-id="95662-127">文件集</span><span class="sxs-lookup"><span data-stu-id="95662-127">Documentation</span></span>](#documentation)
    -   [<span data-ttu-id="95662-128">DefaultBaselineGamutMapModel 類型</span><span class="sxs-lookup"><span data-stu-id="95662-128">DefaultBaselineGamutMapModel type</span></span>](#defaultbaselinegamutmapmodel-type)
    -   [<span data-ttu-id="95662-129">PlugInGamutMapType</span><span class="sxs-lookup"><span data-stu-id="95662-129">PlugInGamutMapType</span></span>](#plugingamutmaptype)
    -   [<span data-ttu-id="95662-130">ExtensionType</span><span class="sxs-lookup"><span data-stu-id="95662-130">ExtensionType</span></span>](#extensiontype)
-   [<span data-ttu-id="95662-131">GMMP 基準演算法</span><span class="sxs-lookup"><span data-stu-id="95662-131">The GMMP Baseline Algorithms</span></span>](#the-gmmp-baseline-algorithms)
-   [<span data-ttu-id="95662-132">對齊中性軸</span><span class="sxs-lookup"><span data-stu-id="95662-132">Aligning the Neutral Axes</span></span>](#aligning-the-neutral-axes)
    -   [<span data-ttu-id="95662-133"> (MinCD) 的最小色彩差異 </span><span class="sxs-lookup"><span data-stu-id="95662-133">Minimum Color Difference (MinCD)</span></span>](#minimum-color-difference-mincd)
    -   [<span data-ttu-id="95662-134">BasicPhoto</span><span class="sxs-lookup"><span data-stu-id="95662-134">BasicPhoto</span></span>](#basicphoto)
    -   [<span data-ttu-id="95662-135">概觀</span><span class="sxs-lookup"><span data-stu-id="95662-135">Overview</span></span>](#overview)
    -   [<span data-ttu-id="95662-136">單一 gamut shell 的案例</span><span class="sxs-lookup"><span data-stu-id="95662-136">The case of single gamut shell</span></span>](#the-case-of-single-gamut-shell)
    -   [<span data-ttu-id="95662-137">黑色增強功能</span><span class="sxs-lookup"><span data-stu-id="95662-137">Black enhancement</span></span>](#black-enhancement)
    -   [<span data-ttu-id="95662-138">雙 gamut shell 的案例</span><span class="sxs-lookup"><span data-stu-id="95662-138">The case of dual gamut shells</span></span>](#the-case-of-dual-gamut-shells)
    -   [<span data-ttu-id="95662-139">CIE TC8-03 建議的變更原因</span><span class="sxs-lookup"><span data-stu-id="95662-139">Reasons for changes from the CIE TC8-03 recommendations</span></span>](#reasons-for-changes-from-the-cie-tc8-03-recommendations)
    -   [<span data-ttu-id="95662-140">色調對應</span><span class="sxs-lookup"><span data-stu-id="95662-140">Hue mapping</span></span>](#hue-mapping)
-   [<span data-ttu-id="95662-141">範圍界限描述和 Gamut Shell 演算法</span><span class="sxs-lookup"><span data-stu-id="95662-141">Gamut Boundary Description and Gamut Shell Algorithms</span></span>](#gamut-boundary-description-and-gamut-shell-algorithms)
    -   [<span data-ttu-id="95662-142">範圍界限的三邊</span><span class="sxs-lookup"><span data-stu-id="95662-142">Triangulation of the Gamut Boundary</span></span>](#triangulation-of-the-gamut-boundary)
    -   [<span data-ttu-id="95662-143">界限線元素</span><span class="sxs-lookup"><span data-stu-id="95662-143">Boundary Line Elements</span></span>](#boundary-line-elements)
    -   [<span data-ttu-id="95662-144">Gamut 運算： CheckGamut</span><span class="sxs-lookup"><span data-stu-id="95662-144">Gamut Operation: CheckGamut</span></span>](#gamut-operation-checkgamut)
    -   [<span data-ttu-id="95662-145">完整色調平面： Intersect</span><span class="sxs-lookup"><span data-stu-id="95662-145">Full Hue Plane: Intersect</span></span>](#full-hue-plane-intersect)
    -   [<span data-ttu-id="95662-146">Gamut 運算： CheckGamut (繼續) </span><span class="sxs-lookup"><span data-stu-id="95662-146">Gamut Operation: CheckGamut (continued)</span></span>](#gamut-operation-checkgamut-continued)
    -   [<span data-ttu-id="95662-147">最小色彩差異範圍對應</span><span class="sxs-lookup"><span data-stu-id="95662-147">Minimum Color Difference Gamut Mapping</span></span>](#minimum-color-difference-gamut-mapping)
    -   [<span data-ttu-id="95662-148">色調平滑</span><span class="sxs-lookup"><span data-stu-id="95662-148">Hue Smoothing</span></span>](#hue-smoothing)
    -   [<span data-ttu-id="95662-149">在範圍界限描述中設定主要複本和次要資料庫</span><span class="sxs-lookup"><span data-stu-id="95662-149">Setting Primaries and Secondaries in the Gamut Boundary Description</span></span>](#setting-primaries-and-secondaries-in-the-gamut-boundary-description)
    -   [<span data-ttu-id="95662-150">在色域界限描述中設定中性軸</span><span class="sxs-lookup"><span data-stu-id="95662-150">Setting the Neutral Axis in the Gamut Boundary Description</span></span>](#setting-the-neutral-axis-in-the-gamut-boundary-description)
-   [<span data-ttu-id="95662-151">相關主題</span><span class="sxs-lookup"><span data-stu-id="95662-151">Related topics</span></span>](#related-topics)

## <a name="overview"></a><span data-ttu-id="95662-152">概觀</span><span class="sxs-lookup"><span data-stu-id="95662-152">Overview</span></span>

<span data-ttu-id="95662-153">此架構可用來指定 gamut 地圖模型設定檔 (GMMP) 的內容。</span><span class="sxs-lookup"><span data-stu-id="95662-153">This schema is used to specify the content of a gamut map model profile (GMMP).</span></span> <span data-ttu-id="95662-154">相關聯的基準演算法將在下列主題中說明。</span><span class="sxs-lookup"><span data-stu-id="95662-154">The associated baseline algorithms are described in the following topic.</span></span>

<span data-ttu-id="95662-155">基本 GMMP 架構是由通用的標頭資訊、慣用的 Gamut 地圖模型外掛程式的選擇性參考，以及擴充標記所組成。</span><span class="sxs-lookup"><span data-stu-id="95662-155">The basic GMMP schema consists of common header information, an optional reference to a preferred Gamut Map Model plug-in, and extension tags.</span></span>

<span data-ttu-id="95662-156">此外，GMMP 也會提供有關目標的「範圍」地圖模型的明確資訊，並提供在目標模型無法使用時要使用的基準回溯 Gamut 地圖模型原則。</span><span class="sxs-lookup"><span data-stu-id="95662-156">In addition, the GMMP provides explicit information on the targeted Gamut Map Model, and provides a policy on the baseline fallback Gamut Map Model to use if the targeted model is unavailable.</span></span> <span data-ttu-id="95662-157">架構可以包含私用 extensional 資訊，但不會包含其他任何無關的資訊。</span><span class="sxs-lookup"><span data-stu-id="95662-157">The schema can include private extensional information, but will include no other extraneous information.</span></span>

## <a name="gamut-map-model-profile-architecture"></a><span data-ttu-id="95662-158">Gamut 地圖模型設定檔架構</span><span class="sxs-lookup"><span data-stu-id="95662-158">Gamut Map Model Profile Architecture</span></span>

![顯示 Gamut 地圖模型設定檔的圖表。](images/gmmp-image002.png)

<span data-ttu-id="95662-160">輸出裝置 colorant 空間的取樣是藉由將 colorants 從0.0 逐一查看至1.0，並使用小數步驟、在每個步驟累積每個 colorant 的所有組合，然後將它們從裝置 colorant 空間轉換成色彩外觀空間，方法是使用 DM：:D eviceToColorimetricColors 方法，後面接著凸輪：： ColorimetricToAppearanceColors 方法。</span><span class="sxs-lookup"><span data-stu-id="95662-160">The sampling of the output device colorant space is done by iterating through the colorants from 0.0 to 1.0 with a fractional step, accumulating all combinations of each colorant at each step, and then converting them from device colorant space to color appearance space using the DM::DeviceToColorimetricColors method followed by the CAM::ColorimetricToAppearanceColors method.</span></span> <span data-ttu-id="95662-161">以下是如何為 RGB 完成這項操作的範例。</span><span class="sxs-lookup"><span data-stu-id="95662-161">The following is an example of how this is done for RGB.</span></span>


```C++
For (red= 0.0; red <= 1.0; red += redStep) {

     For (green = 0.0; green <= 1.0; green += greenStep) {

          For (blue = 0.0; blue <= 1.0; blue += blueStep) {

               Colorants[0] = red; colorants[1] = green; colorants[2] = blue;

               pRGBDM->DeviceToColorimetricColors(1, colorants, &amp;XYZ);

               pCAM->ColorimetricToAppearanceColors(1, &amp;XYZ, &amp;JCh);

          }

     }

}

```



## <a name="generation-of-the-gamut-boundary"></a><span data-ttu-id="95662-162">範圍界限的產生</span><span class="sxs-lookup"><span data-stu-id="95662-162">Generation of the Gamut Boundary</span></span>

<span data-ttu-id="95662-163">範圍界限有三個元件：主要複本、中性範例和 shell。</span><span class="sxs-lookup"><span data-stu-id="95662-163">There are three components to the gamut boundary: the primaries, the neutral samples, and the shells.</span></span> <span data-ttu-id="95662-164">主要複本是藉由取得裝置主要複本並套用 DeviceToColorimetric/ColorimetricToAppearance 轉換來產生。</span><span class="sxs-lookup"><span data-stu-id="95662-164">The primaries are generated by taking the device primaries and applying the DeviceToColorimetric/ColorimetricToAppearance transformation.</span></span> <span data-ttu-id="95662-165">中性範例是藉由取樣中性區域中的裝置 colorant 空間，並套用相同的轉換來產生。</span><span class="sxs-lookup"><span data-stu-id="95662-165">The neutral samples are generated by sampling the device colorant space in the neutral area and applying the same transformation.</span></span> <span data-ttu-id="95662-166">針對 (RGB 或 CMY) 的三個 colorant 裝置，中性樣本會定義為所有 colorants 相等，例如 R = = G = = B。若為 CMYK，中性範例會定義為具有 C = = M = = Y = = 0。</span><span class="sxs-lookup"><span data-stu-id="95662-166">For three colorant devices (RGB or CMY), the neutral samples are defined as having all of the colorants equal, for example, R == G == B. For CMYK, the neutral samples are defined as having C == M == Y == 0.</span></span>

<span data-ttu-id="95662-167">影響用來建立範圍界限之資料的因素，只是 (基準裝置的資料樣本) 和查看條件。</span><span class="sxs-lookup"><span data-stu-id="95662-167">The factors that influence the data used to create the gamut boundary are the data samples (baseline devices only) and the viewing conditions.</span></span> <span data-ttu-id="95662-168">用來對監視器和合理) shell 進行完整取樣 colorant 空間 (的步驟大小是內部常數，而且不適用於外部操作。</span><span class="sxs-lookup"><span data-stu-id="95662-168">The step size used to do the full sampling of the colorant space (for monitors and for plausible shell) is an internal constant and isn't available for outside manipulation.</span></span> <span data-ttu-id="95662-169">變更視圖條件會變更色彩外觀模型 (凸輪) 的行為，並改變範圍界限的形狀，所以您必須產生系結至「觀看條件」設定檔的範圍界限。</span><span class="sxs-lookup"><span data-stu-id="95662-169">Changing the viewing conditions changes the behavior of the color appearance model (CAM) and alters the shape of the gamut boundary, so you must generate a gamut boundary tied to the viewing conditions profile.</span></span> <span data-ttu-id="95662-170">如果使用範例資料，例如基準印表機和捕獲裝置，則範例會對參考範圍的形狀有很大的影響，並且會影響模型本身的行為。</span><span class="sxs-lookup"><span data-stu-id="95662-170">If sample data is used, as in the case of baseline printers and capture devices, then the samples will have a lot of impact on the shape of the reference gamut and affect the behavior of the model itself.</span></span>

<span data-ttu-id="95662-171">針對輸入裝置（例如攝影機和掃描器），會使用不同的取樣來產生參考 shell 和合理 shell。</span><span class="sxs-lookup"><span data-stu-id="95662-171">For input devices, such as cameras and scanners, different samplings are used to generate the reference shell and the plausible shell.</span></span> <span data-ttu-id="95662-172">從用來初始化裝置模型的測量結果產生參考 shell。</span><span class="sxs-lookup"><span data-stu-id="95662-172">The reference shell is generated from the measurements used to initialize the device model.</span></span> <span data-ttu-id="95662-173">合理 shell 產生的結果類似于輸出裝置的先前圖例。</span><span class="sxs-lookup"><span data-stu-id="95662-173">The plausible shell is generated similar to the prior illustration for output devices.</span></span> <span data-ttu-id="95662-174">當您輸入一般目標時，不會取得完整的飽和值， (R、G 或 B = 255) 。</span><span class="sxs-lookup"><span data-stu-id="95662-174">The difference it that when you input a typical target, you don't get fully saturated values (where R, G, or B = 255).</span></span> <span data-ttu-id="95662-175">您必須使用裝置模型來評估這些值。</span><span class="sxs-lookup"><span data-stu-id="95662-175">You must extrapolate using the device model to estimate those values.</span></span>

## <a name="the-gmmp-schema"></a><span data-ttu-id="95662-176">GMMP 架構</span><span class="sxs-lookup"><span data-stu-id="95662-176">The GMMP Schema</span></span>


```C++
<?xml version="1.0" encoding="UTF-8"?>
<xs:schema 
  xmlns:gmm="http://schemas.microsoft.com/windows/2005/02/color/GamutMapModel"
  xmlns:wcs="http://schemas.microsoft.com/windows/2005/02/color/WcsCommonProfileTypes"
  targetNamespace="http://schemas.microsoft.com/windows/2005/02/color/GamutMapModel"
  xmlns:xs="http://www.w3.org/2001/XMLSchema"
  elementFormDefault="qualified"
  attributeFormDefault="unqualified"
  blockDefault="#all"
  version="1.0">

  <xs:annotation>
    <xs:documentation>
      Gamut Map Model profile schema.
      Copyright (C) Microsoft. All rights reserved.
    </xs:documentation>
  </xs:annotation>

  <xs:import namespace="http://schemas.microsoft.com/windows/2005/02/color/WcsCommonProfileTypes" />

  <xs:element name="GamutMapModel">
    <xs:complexType>
      <xs:sequence>
        <xs:element name="ProfileName" type="wcs:MultiLocalizedTextType"/>
        <xs:element name="Description" type="wcs:MultiLocalizedTextType" minOccurs="0"/>
        <xs:element name="Author" type="wcs:MultiLocalizedTextType" minOccurs="0"/>
        <xs:element name="DefaultBaselineGamutMapModel">
          <xs:simpleType>
            <xs:restriction base="xs:string">
              <xs:enumeration value="HPMinCD_Absolute"/>
              <xs:enumeration value="HPMinCD_Relative"/>
              <xs:enumeration value="SGCK"/>
              <xs:enumeration value="HueMap"/>
            </xs:restriction>
          </xs:simpleType>
        </xs:element>
        <xs:element name="PlugInGamutMapModel" minOccurs="0">
          <xs:complexType>
            <xs:sequence>
              <xs:any namespace="##other" processContents="skip"
                minOccurs="0" maxOccurs="unbounded" />
            </xs:sequence>
            <xs:attribute name="GUID" type="wcs:GUIDType" use="required"/>
          </xs:complexType>
        </xs:element>
      </xs:sequence>
      <xs:attribute name="ID" type="xs:string" use="optional" />
    </xs:complexType>
  </xs:element>
</xs:schema>
```



## <a name="the-gmmp-schema-elements"></a><span data-ttu-id="95662-177">GMMP 架構元素</span><span class="sxs-lookup"><span data-stu-id="95662-177">The GMMP Schema Elements</span></span>

## <a name="gamutmapmodel"></a><span data-ttu-id="95662-178">GamutMapModel</span><span class="sxs-lookup"><span data-stu-id="95662-178">GamutMapModel</span></span>

<span data-ttu-id="95662-179">這個元素是下列子項目的序列：</span><span class="sxs-lookup"><span data-stu-id="95662-179">This element is a sequence of the following sub-elements:</span></span>

1.  <span data-ttu-id="95662-180">ProfileName 字串，</span><span class="sxs-lookup"><span data-stu-id="95662-180">ProfileName string,</span></span>
2.  <span data-ttu-id="95662-181">DefaultBaselineGamutMapModel,</span><span class="sxs-lookup"><span data-stu-id="95662-181">DefaultBaselineGamutMapModel,</span></span>
3.  <span data-ttu-id="95662-182">選擇性描述字串，</span><span class="sxs-lookup"><span data-stu-id="95662-182">Optional Description string,</span></span>
4.  <span data-ttu-id="95662-183">選用的作者字串，</span><span class="sxs-lookup"><span data-stu-id="95662-183">Optional Author string,</span></span>
5.  <span data-ttu-id="95662-184">選擇性 PlugInGamutMap 和</span><span class="sxs-lookup"><span data-stu-id="95662-184">Optional PlugInGamutMap, and</span></span>
6.  <span data-ttu-id="95662-185">選擇性 ExtensionType。</span><span class="sxs-lookup"><span data-stu-id="95662-185">Optional ExtensionType.</span></span>

<span data-ttu-id="95662-186">**驗證條件** ：每個子項目都是由它自己的類型來驗證。</span><span class="sxs-lookup"><span data-stu-id="95662-186">**Validation conditions** : Each sub-element is validated by its own type.</span></span>

### <a name="namespace"></a><span data-ttu-id="95662-187">命名空間</span><span class="sxs-lookup"><span data-stu-id="95662-187">Namespace</span></span>

<span data-ttu-id="95662-188">xmlns： gmm = " http://schemas.microsoft.com/windows/2005/02/color/GamutMapModel "</span><span class="sxs-lookup"><span data-stu-id="95662-188">xmlns:gmm="http://schemas.microsoft.com/windows/2005/02/color/GamutMapModel"</span></span>

<span data-ttu-id="95662-189">targetNamespace = " http://schemas.microsoft.com/windows/2005/02/color/GamutMapModel "</span><span class="sxs-lookup"><span data-stu-id="95662-189">targetNamespace="http://schemas.microsoft.com/windows/2005/02/color/GamutMapModel"</span></span>

### <a name="version"></a><span data-ttu-id="95662-190">版本</span><span class="sxs-lookup"><span data-stu-id="95662-190">Version</span></span>

<span data-ttu-id="95662-191">第一版的 Windows Vista 版本為 "1.0"。</span><span class="sxs-lookup"><span data-stu-id="95662-191">Version "1.0" with the first release of Windows Vista.</span></span>

<span data-ttu-id="95662-192">**驗證條件** ： Windows Vista 中的1.0。</span><span class="sxs-lookup"><span data-stu-id="95662-192">**Validation conditions** : 1.0 in Windows Vista.</span></span> <span data-ttu-id="95662-193">版本 &lt; 2.0 也是有效的，以便支援格式的非重大變更。</span><span class="sxs-lookup"><span data-stu-id="95662-193">Versions &lt;2.0 are also valid in order to support non-breaking changes to the format.</span></span>

### <a name="documentation"></a><span data-ttu-id="95662-194">文件</span><span class="sxs-lookup"><span data-stu-id="95662-194">Documentation</span></span>

<span data-ttu-id="95662-195">Gamut 地圖模型設定檔架構。</span><span class="sxs-lookup"><span data-stu-id="95662-195">Gamut Map Model Profile schema.</span></span>

<span data-ttu-id="95662-196">著作權 (C) Microsoft。</span><span class="sxs-lookup"><span data-stu-id="95662-196">Copyright (C) Microsoft.</span></span> <span data-ttu-id="95662-197">著作權所有，並保留一切權利。</span><span class="sxs-lookup"><span data-stu-id="95662-197">All rights reserved.</span></span>

<span data-ttu-id="95662-198">**驗證條件** ：每個子項目都是由它自己的類型來驗證。</span><span class="sxs-lookup"><span data-stu-id="95662-198">**Validation conditions** : Each sub-element is validated by its own type.</span></span>

### <a name="defaultbaselinegamutmapmodel-type"></a><span data-ttu-id="95662-199">DefaultBaselineGamutMapModel 類型</span><span class="sxs-lookup"><span data-stu-id="95662-199">DefaultBaselineGamutMapModel type</span></span>

<span data-ttu-id="95662-200">UINT 類型</span><span class="sxs-lookup"><span data-stu-id="95662-200">UINT type</span></span>

<span data-ttu-id="95662-201">列舉值：</span><span class="sxs-lookup"><span data-stu-id="95662-201">Enumeration values:</span></span>

<dl> <span data-ttu-id="95662-202">"MinCD \_ 絕對"</span><span class="sxs-lookup"><span data-stu-id="95662-202">"MinCD\_Absolute"</span></span>  
<span data-ttu-id="95662-203">「MinCD \_ 相對」</span><span class="sxs-lookup"><span data-stu-id="95662-203">"MinCD\_Relative"</span></span>  
<span data-ttu-id="95662-204">"SIG \_ KNEE BRACE"</span><span class="sxs-lookup"><span data-stu-id="95662-204">"SIG\_KNEE"</span></span>  
<span data-ttu-id="95662-205">"HueMap"</span><span class="sxs-lookup"><span data-stu-id="95662-205">"HueMap"</span></span>  
</dl>

<span data-ttu-id="95662-206">**驗證條件** ：這些值必須符合上述的其中一個列舉值。</span><span class="sxs-lookup"><span data-stu-id="95662-206">**Validation conditions** : The values must match one of the enumerations above.</span></span>

### <a name="plugingamutmaptype"></a><span data-ttu-id="95662-207">PlugInGamutMapType</span><span class="sxs-lookup"><span data-stu-id="95662-207">PlugInGamutMapType</span></span>

<span data-ttu-id="95662-208">此元素是 GUID GUIDType 和任何子項目的序列。</span><span class="sxs-lookup"><span data-stu-id="95662-208">This element is a sequence of a GUID GUIDType and any sub-elements.</span></span>

<span data-ttu-id="95662-209">**驗證條件** ： GUID 是用來與 GMM 外掛程式 DLL guid 相符。</span><span class="sxs-lookup"><span data-stu-id="95662-209">**Validation conditions** : The GUID is used to match the GMM PlugIn DLL GUID.</span></span> <span data-ttu-id="95662-210">最多可以有100000個自訂子項目。</span><span class="sxs-lookup"><span data-stu-id="95662-210">There are a maximum of 100,000 custom sub-elements.</span></span>

### <a name="extensiontype"></a><span data-ttu-id="95662-211">ExtensionType</span><span class="sxs-lookup"><span data-stu-id="95662-211">ExtensionType</span></span>

<span data-ttu-id="95662-212">此元素是任何子項目的選擇性序列。</span><span class="sxs-lookup"><span data-stu-id="95662-212">This element is a optional sequence of any sub-elements.</span></span>

<span data-ttu-id="95662-213">**驗證條件** ：最多可有100000個子項目。</span><span class="sxs-lookup"><span data-stu-id="95662-213">**Validation conditions** : There can be a maximum of 100,000 sub-elements.</span></span>

## <a name="the-gmmp-baseline-algorithms"></a><span data-ttu-id="95662-214">GMMP 基準演算法</span><span class="sxs-lookup"><span data-stu-id="95662-214">The GMMP Baseline Algorithms</span></span>

## <a name="aligning-the-neutral-axes"></a><span data-ttu-id="95662-215">對齊中性軸</span><span class="sxs-lookup"><span data-stu-id="95662-215">Aligning the Neutral Axes</span></span>

<span data-ttu-id="95662-216">大部分的範圍對應演算法的目標是將來源裝置的中性軸對應至目的地裝置的中性軸：亦即，白色會變成白色、黑色到黑色，以及灰色到灰色。</span><span class="sxs-lookup"><span data-stu-id="95662-216">Most gamut mapping algorithms have a goal of mapping the neutral axis of the source device to the neutral axis of the destination device: that is, white goes to white, black to black, and gray to gray.</span></span> <span data-ttu-id="95662-217">這在部分的解決方式是調整來源色彩的亮度，以符合目的地裝置的亮度範圍。</span><span class="sxs-lookup"><span data-stu-id="95662-217">This is addressed in part by scaling the lightness of source colors to match the lightness range of the destination device.</span></span> <span data-ttu-id="95662-218">但這並不會完全解決問題。</span><span class="sxs-lookup"><span data-stu-id="95662-218">But that does not completely address the problem.</span></span>

<span data-ttu-id="95662-219">它是大多數影像裝置的實體屬性，chromaticity 裝置的白色不完全符合裝置黑色的 chromaticity。</span><span class="sxs-lookup"><span data-stu-id="95662-219">It is a physical property of most imaging devices that the chromaticity of the device white does not exactly match the chromaticity of the device black.</span></span> <span data-ttu-id="95662-220">例如，監視器白色取決於三個主要複本的 chromaticities 和相對 luminances 總和，而 [監視黑色] 則取決於顯示器介面的反射率。</span><span class="sxs-lookup"><span data-stu-id="95662-220">For example, monitor white depends on the sum of the chromaticities and relative luminances of the three primaries, while monitor black depends on the reflectance of the display surface.</span></span> <span data-ttu-id="95662-221">印表機白色取決於紙張的 chromaticity，而印表機黑色則取決於所使用的筆墨或碳粉。</span><span class="sxs-lookup"><span data-stu-id="95662-221">Printer white depends on the chromaticity of the paper, while printer black depends on the ink or toner used.</span></span> <span data-ttu-id="95662-222">外觀模型會將裝置明確對應至外觀空間的中性軸， (色度完全等於零) 不會將裝置黑色對應至中性軸。</span><span class="sxs-lookup"><span data-stu-id="95662-222">An appearance model that maps device white exactly to the neutral axis of the appearance space (chroma exactly equal to zero) will not map device black to the neutral axis.</span></span> <span data-ttu-id="95662-223">因為在亮度增加的情況下，會對色度的差異造成更大的影響，所以中間灰色的呈現方式會比裝置黑色更彩色。</span><span class="sxs-lookup"><span data-stu-id="95662-223">Because the eye is more sensitive to chroma differences as lightness increases, mid-grays will be represented as even more chromatic than device black.</span></span> <span data-ttu-id="95662-224"> (圖1說明兩個維度中中性軸的曲率。</span><span class="sxs-lookup"><span data-stu-id="95662-224">(Figure 1 illustrates the curvature of the neutral axes in two dimensions.</span></span> <span data-ttu-id="95662-225">事實上，中性軸在三個維度中形成更複雜的曲線。 ) </span><span class="sxs-lookup"><span data-stu-id="95662-225">In fact, the neutral axes form a more complex curve in three dimensions.)</span></span>

<span data-ttu-id="95662-226">當凸輪預測這些裝置中性色彩會顯示為彩色時，實際的觀察者似乎會彌補這一點。</span><span class="sxs-lookup"><span data-stu-id="95662-226">While the CAM predicts that these device neutral colors will appear chromatic, actual observers seem to compensate for this.</span></span> <span data-ttu-id="95662-227">大部分的人都不會將這些裝置中性值視為彩色。</span><span class="sxs-lookup"><span data-stu-id="95662-227">Most people do not consider these device neutral values to be chromatic.</span></span> <span data-ttu-id="95662-228">對於大部分的 gamut 對應模型，您應該繼續將來源 neutrals 對應至裝置 neutrals。</span><span class="sxs-lookup"><span data-stu-id="95662-228">For most gamut mapping models, therefore, you should continue to map source neutrals to device neutrals.</span></span>

<span data-ttu-id="95662-229">若要將來源 neutrals 對應至裝置 neutrals，請調整來源和目的地範圍界限，以及當您套用 gamut 對應演算法時的每個圖元。</span><span class="sxs-lookup"><span data-stu-id="95662-229">To map source neutrals to device neutrals, adjust the source and destination gamut boundaries and each pixel when you apply the gamut mapping algorithm.</span></span> <span data-ttu-id="95662-230">首先調整來源色彩中的每個值，使來源裝置的中性軸在來源色彩的亮度上直接落在外觀空間的中性軸上。</span><span class="sxs-lookup"><span data-stu-id="95662-230">First adjust each value in the source color so that the source device's neutral axis at the source color's lightness falls directly on the neutral axis of the appearance space.</span></span> <span data-ttu-id="95662-231"> (請參閱 [圖 1] 左邊的 [圖 1]。 ) 然後調整目的地裝置的範圍界限描述，如此一來，目的地裝置的中性軸上的每個色彩都會直接落在外觀空間的中性軸上。</span><span class="sxs-lookup"><span data-stu-id="95662-231">(See the left side of Figure 1.) Then adjust the destination device's gamut boundary description so that each color on the destination device's neutral axis at the destination device gamut boundary color's lightness falls directly on the neutral axis of the appearance space.</span></span> <span data-ttu-id="95662-232"> (參閱 [圖 1] 的右側。 ) </span><span class="sxs-lookup"><span data-stu-id="95662-232">(See the right side of Figure 1.)</span></span>

![圖表，顯示左側的來源範圍界限圖形，以及右邊的目的地範圍界限。](images/gmmp-image004.png)

<span data-ttu-id="95662-234">**圖 1** ：說明中性軸的對齊方式。</span><span class="sxs-lookup"><span data-stu-id="95662-234">**Figure 1** : Alignment of the neutral axes illustrated.</span></span> <span data-ttu-id="95662-235">左方：調整相對於來源裝置中性軸的來源點。</span><span class="sxs-lookup"><span data-stu-id="95662-235">Left: Adjusting source points relative to the source device neutral axis.</span></span> <span data-ttu-id="95662-236">Right：調整相對於目的地範圍界限描述的目的地範圍界限描述。</span><span class="sxs-lookup"><span data-stu-id="95662-236">Right: Adjusting the destination gamut boundary description relative to the destination gamut boundary description.</span></span>

<span data-ttu-id="95662-237">請注意，您會在該亮度值上調整相對於中性軸的每個來源圖元值。</span><span class="sxs-lookup"><span data-stu-id="95662-237">Note that you adjust each source pixel value relative to the neutral axis at that lightness value.</span></span> <span data-ttu-id="95662-238">這可確保來源裝置 neutrals 會落在外觀模型的中性軸上。</span><span class="sxs-lookup"><span data-stu-id="95662-238">This assures that source device neutrals will fall on the neutral axis of the appearance model.</span></span> <span data-ttu-id="95662-239">您也可以將該亮度的所有其他色彩移至相同數量，如此一來，來源範圍的標記法中就不會有不連續。</span><span class="sxs-lookup"><span data-stu-id="95662-239">You also shift all other colors at that lightness by the same amount, so that there are no discontinuities in the representation of the source gamut.</span></span> <span data-ttu-id="95662-240">您必須在不同的亮度層級轉移不同的數量，因為來源裝置 neutrals 不會在不同的亮度層級呈現為相同的彩色。</span><span class="sxs-lookup"><span data-stu-id="95662-240">You have to shift by different amounts at different lightness levels, because the source device neutrals are not represented as equally chromatic at the different lightness levels.</span></span> <span data-ttu-id="95662-241">很明顯地，這不是簡單的轉換。</span><span class="sxs-lookup"><span data-stu-id="95662-241">Clearly, this is not a trivial transformation.</span></span>

<span data-ttu-id="95662-242">處理目的地裝置值比較複雜一點。</span><span class="sxs-lookup"><span data-stu-id="95662-242">Handling the destination device values is a little more tricky.</span></span> <span data-ttu-id="95662-243">一開始，您會以類似的方式調整整個目的地範圍界限，但相對於目的地裝置中性軸。</span><span class="sxs-lookup"><span data-stu-id="95662-243">Initially, you adjust the entire destination gamut boundary in a similar manner, but relative to the destination device neutral axis.</span></span> <span data-ttu-id="95662-244">右側的 [圖 1] 所示。</span><span class="sxs-lookup"><span data-stu-id="95662-244">This is illustrated in Figure 1 on the right side.</span></span> <span data-ttu-id="95662-245">該調整可確保來源灰色值會對應至目的地灰色值。</span><span class="sxs-lookup"><span data-stu-id="95662-245">That adjustment assures that source gray values will map to destination gray values.</span></span> <span data-ttu-id="95662-246">這是 gamut 對應演算法運作的空間。</span><span class="sxs-lookup"><span data-stu-id="95662-246">This is the space in which the gamut mapping algorithms operate.</span></span>

<span data-ttu-id="95662-247">不過，此空間不會正確描述目的地裝置的真正行為。</span><span class="sxs-lookup"><span data-stu-id="95662-247">However, this space does not accurately describe the true behavior of the destination device.</span></span> <span data-ttu-id="95662-248">您必須先將對應反轉，然後才會將 gamut 對應的色彩傳遞給外觀模型和目的地裝置模型。</span><span class="sxs-lookup"><span data-stu-id="95662-248">You must invert the mapping before gamut mapped colors are handed to the appearance model and destination device model.</span></span> <span data-ttu-id="95662-249">您可以使用稍早套用至目的地裝置中性軸的位移相反的方式，來位移所有對應的值。</span><span class="sxs-lookup"><span data-stu-id="95662-249">You offset all the mapped values by the opposite of the offset applied earlier to the destination device neutral axis.</span></span> <span data-ttu-id="95662-250">這會將目的地中性軸對應回凸輪最初表示的值。</span><span class="sxs-lookup"><span data-stu-id="95662-250">This maps the destination neutral axis back to the value represented originally by the CAM.</span></span> <span data-ttu-id="95662-251">它針對範圍界限和所有中繼值執行相同的工作。</span><span class="sxs-lookup"><span data-stu-id="95662-251">It does the same for the gamut boundary and all intermediate values.</span></span>

![圖表，顯示用於復原目的地裝置中性軸對齊的圖形。](images/gmmp-image008.png)

<span data-ttu-id="95662-253">**圖 2** ：復原目的地裝置中性軸的對齊</span><span class="sxs-lookup"><span data-stu-id="95662-253">**Figure 2** : Undoing the alignment of the destination device neutral axis</span></span>

### <a name="minimum-color-difference-mincd"></a><span data-ttu-id="95662-254"> (MinCD) 的最小色彩差異</span><span class="sxs-lookup"><span data-stu-id="95662-254">Minimum Color Difference (MinCD)</span></span>

<span data-ttu-id="95662-255">色彩差異的最小 (MinCD) 相對和絕對版本-相當於 ICC 色度意圖。</span><span class="sxs-lookup"><span data-stu-id="95662-255">Minimum Color Difference(MinCD) Relative and Absolute versions - equivalent to the ICC colorimetric intent.</span></span>

> [!Note]  
> <span data-ttu-id="95662-256">MinCD GMM 適合用來將圖形和藝術線條（包含「標誌」色彩） () 的色彩、使用一些超出範圍色彩的標誌色彩漸層，以及最後一階段的「校對」轉換。</span><span class="sxs-lookup"><span data-stu-id="95662-256">The MinCD GMM is suitable for mapping graphics and line art containing "logo" colors (spot colors), logo color gradients with some out-of-gamut colors, and for the final stage of proofing transforms.</span></span> <span data-ttu-id="95662-257">雖然 MinCD GMM 可用於完全位於目的範圍內的照片影像，但不建議用於一般的相片影像呈現。</span><span class="sxs-lookup"><span data-stu-id="95662-257">While the MinCD GMM could be used for photographic images that are entirely within the destination gamut, it is not recommended for general rendering of photographic images.</span></span> <span data-ttu-id="95662-258">將超出範圍的色彩對應到目的範圍介面上的色彩，可能會導致不必要的成品，例如，在跨越範圍界限的平滑漸層中有色調或色度的異常。</span><span class="sxs-lookup"><span data-stu-id="95662-258">The mapping of out-of-gamut colors to colors on the destination gamut surface can result in unwanted artifacts, such as tone or chroma irregularities in smooth gradients that cross the gamut boundary.</span></span> <span data-ttu-id="95662-259">建議將 BasicPhoto 用於影像映射。</span><span class="sxs-lookup"><span data-stu-id="95662-259">BasicPhoto is recommended for photographic images.</span></span> <span data-ttu-id="95662-260">如果影像或 contone 影像需要 BasicPhoto 以外的 gamut 對應，則替代方法應該是建立外掛程式 GMM 來執行該對應，而不是使用 MinCD。</span><span class="sxs-lookup"><span data-stu-id="95662-260">If a photographic or contone image requires a gamut mapping other than BasicPhoto, then the alternative should be to create a plug-in GMM implementing that mapping, instead of using MinCD.</span></span>

 

<span data-ttu-id="95662-261">色域內的色彩會保持不變。</span><span class="sxs-lookup"><span data-stu-id="95662-261">In-gamut colors are left unchanged.</span></span> <span data-ttu-id="95662-262">如果是超出範圍的色彩，則會藉由找出目的範圍中的點與超出範圍輸入點的最小色彩距離，來調整亮度和色度。</span><span class="sxs-lookup"><span data-stu-id="95662-262">For out-of-gamut colors, lightness and chroma are adjusted by finding the point in the destination gamut that has the minimum color distance from out-of-gamut input points.</span></span> <span data-ttu-id="95662-263">色彩距離是在 JCh 空間中計算。</span><span class="sxs-lookup"><span data-stu-id="95662-263">The color distance is computed in JCh space.</span></span> <span data-ttu-id="95662-264">不過，您要將亮度的距離加權 (J) 和色度 (C) 或色調 (h) 有不同的距離。</span><span class="sxs-lookup"><span data-stu-id="95662-264">However, you weight the distance in lightness (J) and the distance in chroma (C) or hue (h) differently.</span></span> <span data-ttu-id="95662-265">與色度相關的權數函式用於以亮度為間隔的距離，因此，小色度的權數較小，較大的小色度，直到達到臨界值色度為止，在這種情況下，權數會維持為1，也就是與色度或色調的距離相同的權數。</span><span class="sxs-lookup"><span data-stu-id="95662-265">A chroma-dependent weight function is used for the distance in lightness so that the weight is smaller for small chroma and larger for large chroma until a threshold chroma is reached, after which the weight stays at 1, that is, the same weight as distance in chroma or hue.</span></span> <span data-ttu-id="95662-266">這會遵循 CMC 和 CIEDE2000 的建議使用方式。</span><span class="sxs-lookup"><span data-stu-id="95662-266">This follows recommended usage for CMC and CIEDE2000.</span></span> <span data-ttu-id="95662-267">有兩種變體：相對色度和絕對色度。</span><span class="sxs-lookup"><span data-stu-id="95662-267">There are two variants: Relative colorimetric and absolute colorimetric.</span></span>

<span data-ttu-id="95662-268">**相對色度：** 首先，請將來源和目的地中性軸對齊，如先前所述。</span><span class="sxs-lookup"><span data-stu-id="95662-268">**Relative colorimetric:** First, align the source and destination neutral axes as described previously.</span></span> <span data-ttu-id="95662-269">然後將已調整的來源色彩裁剪至已調整的目的地範圍界限。</span><span class="sxs-lookup"><span data-stu-id="95662-269">Then clip the adjusted source color to the adjusted destination gamut boundary.</span></span> <span data-ttu-id="95662-270"> (請參閱圖4。</span><span class="sxs-lookup"><span data-stu-id="95662-270">(See Figure 4.</span></span> <span data-ttu-id="95662-271">沿著固定亮度的色度對應。 ) 重新調整目的地裝置值（如先前所述）。</span><span class="sxs-lookup"><span data-stu-id="95662-271">Chroma mapping along constant lightness.) Readjust the destination device values as described previously.</span></span> <span data-ttu-id="95662-272">在單色目的地範圍界限的情況下，色度裁剪表示 (C) 的色度值設定為零 (0.0) 。</span><span class="sxs-lookup"><span data-stu-id="95662-272">In the case of a monochrome destination gamut boundary, the chroma clipping means that the chroma value (C) is set to zero (0.0).</span></span>

<span data-ttu-id="95662-273">**絕對色度：** 這類似于相對色度，但不會對齊來源和目的地中立軸。</span><span class="sxs-lookup"><span data-stu-id="95662-273">**Absolute colorimetric:** This is similar to relative colorimetric, but without the alignment of the source and destination neutral axis.</span></span> <span data-ttu-id="95662-274">來源值會直接裁剪至目的地中性軸。</span><span class="sxs-lookup"><span data-stu-id="95662-274">The source value is clipped directly to the destination neutral axis.</span></span> <span data-ttu-id="95662-275">請注意，如果來源和目的地範圍界限都是單色，則行為會與相對色度變異相同;也就是說，會執行中性軸對齊，然後將色度裁剪成零。</span><span class="sxs-lookup"><span data-stu-id="95662-275">Note that if both the source and destination gamut boundaries are monochrome, the behavior is identical to the relative colorimetric variant; that is, the neutral axes alignment is performed, and then the chroma is clipped to zero.</span></span> <span data-ttu-id="95662-276">如此可確保即使媒體和 colorants 的差異很大，仍可獲得合理的輸出。</span><span class="sxs-lookup"><span data-stu-id="95662-276">This ensures that a reasonable output is attained even if the media and colorants are significantly different.</span></span>

![此圖顯示 MinCD 裁剪至已調整範圍的圖形。](images/gmmp-image010.png)

<span data-ttu-id="95662-278">**圖 3** ： MinCD 裁剪到調整的範圍</span><span class="sxs-lookup"><span data-stu-id="95662-278">**Figure 3** : MinCD clipping to the adjusted gamut</span></span>

### <a name="basicphoto"></a><span data-ttu-id="95662-279">BasicPhoto</span><span class="sxs-lookup"><span data-stu-id="95662-279">BasicPhoto</span></span>

### <a name="overview"></a><span data-ttu-id="95662-280">概觀</span><span class="sxs-lookup"><span data-stu-id="95662-280">Overview</span></span>

<span data-ttu-id="95662-281">BasicPhoto-相當於 ICC 慣用、圖形化或感知意圖。</span><span class="sxs-lookup"><span data-stu-id="95662-281">BasicPhoto - equivalent to the ICC preferred, pictorial, or perceptual intent.</span></span>

<span data-ttu-id="95662-282">此演算法是一種與色度相依的 sigmoidal 亮度對應和單向 knee brace 調整 (SGCK) 在 TC8：2004中 CIE CIE156-03 所述的變異。</span><span class="sxs-lookup"><span data-stu-id="95662-282">This algorithm is a variant of the chroma-dependent sigmoidal lightness mapping and cusp knee scaling (SGCK) described by CIE TC8-03 in CIE156:2004.</span></span> <span data-ttu-id="95662-283">此變異演算法支援使用雙範圍 shell (GBDs) 的 gamut 界限描述項;也就是使用參考 shell 和合理 shell 來 GBDs。</span><span class="sxs-lookup"><span data-stu-id="95662-283">This variant algorithm supports gamut boundary descriptors (GBDs) with dual gamut shells; that is, GBDs with a reference shell and a plausible shell.</span></span> <span data-ttu-id="95662-284">SGCK 演算法（最初隻會在 GBD 中假設一個 gamut shell）是以 \_ (Braun 1999) 的 SIG knee brace 演算法為基礎，其中併入 sigmoidal 與 knee brace (1999) 所建議的 Braun 亮度對應和 Fairchild 函式調整，並結合來自 GCUSP (Morovic，1998) 的色度相依性。</span><span class="sxs-lookup"><span data-stu-id="95662-284">The SGCK algorithm, which originally assumes only one gamut shell in the GBD, is based on the SIG\_KNEE algorithm (Braun 1999), that incorporates the sigmoidal lightness mapping and knee function scaling proposed by Braun and Fairchild (1999), combined with the chroma dependence from GCUSP (Morovic, 1998).</span></span> <span data-ttu-id="95662-285">它會讓察覺的色調常數（例如，色調中的色調角度更正的 Jab），並使用泛型 (影像無關的) sigmoidal 亮度縮放比例，這會以與色度相依的方式套用，並使用90% 的 knee brace 函式色度。</span><span class="sxs-lookup"><span data-stu-id="95662-285">It keeps perceived hue constant, for example, hue angle in hue-corrected Jab, and uses a generic (image-independent) sigmoidal lightness scaling which is applied in a chroma-dependent way and a 90 percent knee function chroma.</span></span> <span data-ttu-id="95662-286">變異會沿著常數的亮度來調整。</span><span class="sxs-lookup"><span data-stu-id="95662-286">The variant scales along lines of constant lightness.</span></span>

### <a name="the-case-of-single-gamut-shell"></a><span data-ttu-id="95662-287">單一 gamut shell 的案例</span><span class="sxs-lookup"><span data-stu-id="95662-287">The case of single gamut shell</span></span>

<span data-ttu-id="95662-288">在來源和目的地 GBDs 只有一個 gamut shell 的情況下，檢查演算法是很有説明的。</span><span class="sxs-lookup"><span data-stu-id="95662-288">It is helpful to review the algorithm in the case where both source and destination GBDs have only one gamut shell.</span></span> <span data-ttu-id="95662-289">在此情況下，演算法包含下列計算。</span><span class="sxs-lookup"><span data-stu-id="95662-289">In this case, the algorithm consists of the following calculations.</span></span>

<span data-ttu-id="95662-290">首先，使用下列公式執行初始的亮度對應：</span><span class="sxs-lookup"><span data-stu-id="95662-290">First, perform initial lightness mapping using the following formula:</span></span>

![顯示初始亮度對應的公式。](images/gmmp-image012.png) <span data-ttu-id="95662-292">(1)</span><span class="sxs-lookup"><span data-stu-id="95662-292">(1)</span></span>

<span data-ttu-id="95662-293">其中 *j ₒ* 是原始的亮度，而 *j <sub>R</sub>* 是重現的亮度。</span><span class="sxs-lookup"><span data-stu-id="95662-293">where *Jₒ* is the original lightness and *J<sub>R</sub>* is the reproduction lightness.</span></span>

![顯示第二個亮度對應公式。](images/gmmp-image014.png) <span data-ttu-id="95662-295">(2)</span><span class="sxs-lookup"><span data-stu-id="95662-295">(2)</span></span>

<span data-ttu-id="95662-296">當來源範圍界限為單色時，單色界限的色度值會是零，因為中性軸對齊。</span><span class="sxs-lookup"><span data-stu-id="95662-296">When the source gamut boundary is monochrome, the chroma value will be zero for the monochrome boundary due to neutral axis alignment.</span></span> <span data-ttu-id="95662-297">這會導致發生的情況下，C 等於零。</span><span class="sxs-lookup"><span data-stu-id="95662-297">This will result in the degenerate case where C is equal to zero.</span></span> <span data-ttu-id="95662-298">在此情況下， *p <sub>C</sub>* 會設定為1。</span><span class="sxs-lookup"><span data-stu-id="95662-298">In this case, *p<sub>C</sub>* is set to 1.</span></span>

<span data-ttu-id="95662-299">*p <sub>C</sub>* 是一種與色度相依的加權因素 (Morovic，1998) 相依于原始色彩的色度，C 和 *J <sub>S</sub>* 則是使用 sigmoidal 函數來對應原始亮度的結果。</span><span class="sxs-lookup"><span data-stu-id="95662-299">*p <sub>C</sub>* is a chroma-dependent weighting factor (Morovic, 1998) that depends on the chroma of the original color, C and *J<sub>S</sub>* are the result of the original lightness being mapped using a sigmoidal function.</span></span>

 

<span data-ttu-id="95662-300">若要 *計算 <sub></sub> J* (Braun 和 Fairchild，1999) ，一維的查閱資料表 (LUT) 在原始和複製的亮度值之間，先根據離散的累計標準函式 () 來設定。</span><span class="sxs-lookup"><span data-stu-id="95662-300">To calculate *J<sub>S</sub>* (Braun and Fairchild, 1999), a one-dimensional lookup table (LUT) between original and reproduction lightness values is first set up on the basis of a discrete cumulative normal function (S).</span></span>

![顯示計算 J s 的公式。](images/gmmp-image016.png) <span data-ttu-id="95662-302">(3)</span><span class="sxs-lookup"><span data-stu-id="95662-302">(3)</span></span>

<span data-ttu-id="95662-303">其中 x ₀和 S 分別是一般分佈的平均值和標準差，而 *i* = 0，1，2 .。。 *m*，*m* 是 LUT 中所使用的點數目。</span><span class="sxs-lookup"><span data-stu-id="95662-303">where x ₀ and S are the mean and standard deviation of the normal distribution respectively and *i* = 0,1,2... *m*,*m* is the number of points used in the LUT.</span></span> <span data-ttu-id="95662-304">*S <sub></sub>* 是 *i*  / *m* % 的累計標準函式的值。</span><span class="sxs-lookup"><span data-stu-id="95662-304">*S <sub>i</sub>* is the value of the cumulative normal function for *i* /*m* percent.</span></span> <span data-ttu-id="95662-305">這些參數取決於複製範圍的黑色點亮度，並且可以從表1中插入。</span><span class="sxs-lookup"><span data-stu-id="95662-305">The parameters depend on the lightness of the black point of the reproduction gamut and can be interpolated from Table 1.</span></span> <span data-ttu-id="95662-306">如需計算這些參數的詳細資訊，請參閱 Braun 和 Fairchild (1999，p。</span><span class="sxs-lookup"><span data-stu-id="95662-306">For details of calculating these parameters see Braun and Fairchild (1999, p.</span></span> <span data-ttu-id="95662-307">391) 。</span><span class="sxs-lookup"><span data-stu-id="95662-307">391).</span></span>

:::row:::
    :::column:::
        <span data-ttu-id="95662-308">J <sub>minOut</sub></span><span class="sxs-lookup"><span data-stu-id="95662-308">J <sub>minOut</sub></span></span>
    :::column-end:::
    :::column:::
       <span data-ttu-id="95662-309">5.0</span><span class="sxs-lookup"><span data-stu-id="95662-309">5.0</span></span>
    :::column-end:::
    :::column:::
        <span data-ttu-id="95662-310">10.0</span><span class="sxs-lookup"><span data-stu-id="95662-310">10.0</span></span>
    :::column-end:::
    :::column:::
        <span data-ttu-id="95662-311">15.0</span><span class="sxs-lookup"><span data-stu-id="95662-311">15.0</span></span>
    :::column-end:::
    :::column:::
        <span data-ttu-id="95662-312">20.0</span><span class="sxs-lookup"><span data-stu-id="95662-312">20.0</span></span>
    :::column-end:::
:::row-end:::
:::row:::
    :::column:::
        <span data-ttu-id="95662-313">x ₀</span><span class="sxs-lookup"><span data-stu-id="95662-313">x ₀</span></span>
    :::column-end:::
    :::column:::
       <span data-ttu-id="95662-314">53.7</span><span class="sxs-lookup"><span data-stu-id="95662-314">53.7</span></span>
    :::column-end:::
    :::column:::
        <span data-ttu-id="95662-315">56.8</span><span class="sxs-lookup"><span data-stu-id="95662-315">56.8</span></span>
    :::column-end:::
    :::column:::
        <span data-ttu-id="95662-316">58.2</span><span class="sxs-lookup"><span data-stu-id="95662-316">58.2</span></span>
    :::column-end:::
    :::column:::
        <span data-ttu-id="95662-317">60.6</span><span class="sxs-lookup"><span data-stu-id="95662-317">60.6</span></span>
    :::column-end:::
:::row-end:::
:::row:::
    :::column:::
        <span data-ttu-id="95662-318">S</span><span class="sxs-lookup"><span data-stu-id="95662-318">S</span></span>
    :::column-end:::
    :::column:::
       <span data-ttu-id="95662-319">43.0</span><span class="sxs-lookup"><span data-stu-id="95662-319">43.0</span></span>
    :::column-end:::
    :::column:::
        <span data-ttu-id="95662-320">40.0</span><span class="sxs-lookup"><span data-stu-id="95662-320">40.0</span></span>
    :::column-end:::
    :::column:::
        <span data-ttu-id="95662-321">35.0</span><span class="sxs-lookup"><span data-stu-id="95662-321">35.0</span></span>
    :::column-end:::
    :::column:::
        <span data-ttu-id="95662-322">34.5</span><span class="sxs-lookup"><span data-stu-id="95662-322">34.5</span></span>
    :::column-end:::
:::row-end:::


<span data-ttu-id="95662-323">**表 1** ： BasicPhoto 亮度壓縮參數計算</span><span class="sxs-lookup"><span data-stu-id="95662-323">**Table 1** : BasicPhoto lightness compression parameter calculation</span></span>

<span data-ttu-id="95662-324">若要使用 S 作為亮度對應 LUT (S <sub>LUT</sub> ) ，它必須先正規化為0100的亮度範圍 \[ \] 。</span><span class="sxs-lookup"><span data-stu-id="95662-324">To use S as a lightness mapping LUT (S <sub>LUT</sub> ) it must first be normalized into the lightness range of \[0,100\].</span></span> <span data-ttu-id="95662-325">然後，將正規化的資料調整成目的地裝置的動態範圍，如方程式4所示，其中 *j*<sub>min- *Out*</sub>和 *j*<sub>max- *out*</sub>是黑色點的亮度值和重現媒體的白色點。</span><span class="sxs-lookup"><span data-stu-id="95662-325">The normalized data is then scaled into the dynamic range of the destination device, as shown in Equation 4, where *J*<sub>min\ *Out*</sub> and *J*<sub>max\ *Out*</sub> are the values of lightness of the black point and the white point of the reproduction medium, respectively.</span></span>

![顯示作為亮度對應 LUT 的公式。](images/gmmp-image018.png) <span data-ttu-id="95662-327">(4)</span><span class="sxs-lookup"><span data-stu-id="95662-327">(4)</span></span>

<span data-ttu-id="95662-328">到目前為止，您可以從 LUT 中，藉由在對應 *J O '* 的 *m* 點和它所包含的 *j S* 值之間插插，然後使用下列方程式做為輸入，從 s <sub></sub>取得 *J s* 值。</span><span class="sxs-lookup"><span data-stu-id="95662-328">At this point, the *J S* values can be obtained from the S <sub>LUT</sub> by interpolating between the *m* points of corresponding *J O'* and *J S* values it contains, and using the following equation as the input.</span></span>

![顯示用來取得 J S 值的公式。](images/gmmp-image020.png) <span data-ttu-id="95662-330">(5)</span><span class="sxs-lookup"><span data-stu-id="95662-330">(5)</span></span>

<span data-ttu-id="95662-331">J <sub>minIn</sub> 是原始媒體黑色點的亮度值，j <sub>maxIn</sub> 是原始媒體的白色點的亮度值，而 j <sub>O</sub> 是原始的亮度。</span><span class="sxs-lookup"><span data-stu-id="95662-331">J <sub>minIn</sub> is the lightness value of the black point of the original medium, J <sub>maxIn</sub> is the lightness value of the white point of the original medium, and J <sub>O</sub> is the original lightness.</span></span> <span data-ttu-id="95662-332">在稍後的參考中，您可以用 *剛剛所述的方式來表示* sigmoidal 函式，如下列圖4所示。</span><span class="sxs-lookup"><span data-stu-id="95662-332">For later reference, you can denote by *S* the sigmoidal function defined in the manner just outlined, as illustrated in the following Figure 4.</span></span>

![此圖顯示以固定亮度表示的色度地圖圖形。](images/gmmp-image024.png)

<span data-ttu-id="95662-334">**圖 4** ：沿著固定亮度的色度對應</span><span class="sxs-lookup"><span data-stu-id="95662-334">**Figure 4** : Chroma mapping along constant lightness</span></span>

<span data-ttu-id="95662-335">其次，如果目的地範圍界限是彩色，請在固定亮度 (l) 壓縮色階，然後執行壓縮，如下所示。</span><span class="sxs-lookup"><span data-stu-id="95662-335">Second, if the destination gamut boundary is chromatic, compress chroma along lines of constant lightness (l) and perform the compression as follows.</span></span>

![顯示執行色度壓縮的公式。](images/gmmp-image026.png) <span data-ttu-id="95662-337">(6)</span><span class="sxs-lookup"><span data-stu-id="95662-337">(6)</span></span>

<span data-ttu-id="95662-338">其中 *d* 代表從 *E* 到 *l* 的距離;*g* 表示中度範圍界限; *r* 代表重現;和 *原始* 的圖5。</span><span class="sxs-lookup"><span data-stu-id="95662-338">where *d* represents distance from *E* on *l*;*g* represents the medium gamut boundary; *r* represents the reproduction; and *o* the original Figure 5.</span></span>

![此圖顯示 BasicPhoto 中的色度和亮度壓縮的圖形。](images/gmmp-image028.png)

<span data-ttu-id="95662-340">**圖 5** ： BasicPhoto 中的色度和亮度壓縮</span><span class="sxs-lookup"><span data-stu-id="95662-340">**Figure 5** : Chroma and lightness compression in BasicPhoto</span></span>

<span data-ttu-id="95662-341">如果目的地範圍界限為單色，則會將色度值裁剪為零。</span><span class="sxs-lookup"><span data-stu-id="95662-341">If the destination gamut boundary is monochrome, then the chroma value is clipped to zero.</span></span>

<span data-ttu-id="95662-342">第三，使用先前) 所述 (MinCD 剪輯來消除任何剩餘的錯誤。</span><span class="sxs-lookup"><span data-stu-id="95662-342">Third, use a MinCD clip (described earlier) to eliminate any residual error.</span></span>

### <a name="black-enhancement"></a><span data-ttu-id="95662-343">黑色增強功能</span><span class="sxs-lookup"><span data-stu-id="95662-343">Black enhancement</span></span>

<span data-ttu-id="95662-344">當目的地為印表機裝置時，可以修改上述的演算法來改善黑色。</span><span class="sxs-lookup"><span data-stu-id="95662-344">The preceding algorithm can be modified to improve the black when the destination is a printer device.</span></span> <span data-ttu-id="95662-345">此問題與選擇 *J <sub>minOut</sub>* 有關，這通常不會對應至印表機可以產生的最暗色彩。</span><span class="sxs-lookup"><span data-stu-id="95662-345">The issue has to do with the choice of *J<sub>minOut</sub>*, which usually does not correspond to the darkest color a printer can produce.</span></span>

<span data-ttu-id="95662-346">更具體來說，具有最高密度的色彩（藉由將100% 的筆墨 (或最大可能的涵蓋範圍）取得，如果 GCR/筆墨限制) 效果，在色彩外觀空間中通常不會是「中性」。</span><span class="sxs-lookup"><span data-stu-id="95662-346">More specifically, the color with highest density, obtained by putting 100 percent inks (or maximum possible coverage, if GCR/ink limiting is in effect), is usually not "neutral" in the color appearance space.</span></span> <span data-ttu-id="95662-347">請參閱圖6。</span><span class="sxs-lookup"><span data-stu-id="95662-347">See Figure 6.</span></span> <span data-ttu-id="95662-348">換句話說，如果目的地裝置使用中性最小亮度，則所建立的亮度 scaler 會對應到不是印表機可達成之最高密度的最小亮度。</span><span class="sxs-lookup"><span data-stu-id="95662-348">In other words, if neutral minimum lightness is used for the destination device, the lightness scaler constructed will map to a minimum lightness that is not the highest density that can be achieved by the printer.</span></span> <span data-ttu-id="95662-349">請考慮使用監視器至印表機的進一步使用案例。</span><span class="sxs-lookup"><span data-stu-id="95662-349">Consider the further use case of monitor to printer.</span></span> <span data-ttu-id="95662-350">然後，會將監視器黑色（R = G = B = 0）列印為最高密度。</span><span class="sxs-lookup"><span data-stu-id="95662-350">The monitor black, R=G=B=0, will then be printed as not the highest density.</span></span> <span data-ttu-id="95662-351">影像品質的影響是缺乏深度和對比。</span><span class="sxs-lookup"><span data-stu-id="95662-351">The impact on the image quality is that there is a lack of depth and contrast.</span></span>

![顯示裝置黑色點可能會比中性最小亮度更暗的圖表。](images/gmmp-seqfigure01.png)

<span data-ttu-id="95662-353">**圖 6** ：裝置黑色點可能會比中性的最小亮度還深。</span><span class="sxs-lookup"><span data-stu-id="95662-353">**Figure 6** : The device black point may be darker than the neutral minimum lightness.</span></span>

<span data-ttu-id="95662-354">假設目的地「裝置黑點」是 Jkakbk/JkCkh k。</span><span class="sxs-lookup"><span data-stu-id="95662-354">Suppose the destination "device black point" is Jₖaₖbₖ/JₖCₖh ₖ.</span></span> <span data-ttu-id="95662-355">如果 C k 不是零，則裝置的黑色點不會與 CAM02 相對中立。</span><span class="sxs-lookup"><span data-stu-id="95662-355">If C ₖ is not zero, then the device black point is not neutral relative to CAM02.</span></span> <span data-ttu-id="95662-356">如果您在 [亮度] scaler 的結構中使用 J k 作為目的地「中性最小亮度」;亦即，設定</span><span class="sxs-lookup"><span data-stu-id="95662-356">If you use J ₖ for the destination "neutral minimum lightness" in the construction of the lightness scaler; that is, setting</span></span>

<span data-ttu-id="95662-357">*J <sub>minOut</sub> = Jk*</span><span class="sxs-lookup"><span data-stu-id="95662-357">*J<sub>minOut</sub> = Jₖ*</span></span>

<span data-ttu-id="95662-358">然後將它套用到來源範圍 shell，取得圖7所示的設定。</span><span class="sxs-lookup"><span data-stu-id="95662-358">and apply it to the source gamut shell, you obtain the configuration depicted in Figure 7.</span></span> <span data-ttu-id="95662-359">在圖中，色調平面對應于 h k。</span><span class="sxs-lookup"><span data-stu-id="95662-359">In the figure, the hue plane corresponds to h ₖ.</span></span>

![顯示修改過的亮度 scaler 與目的地裝置黑色點的圖表。](images/gmmp-seqfigure02.png)

<span data-ttu-id="95662-361">**圖 7** ：使用修改過的亮度 scaler 與目的地裝置黑色點的幾何</span><span class="sxs-lookup"><span data-stu-id="95662-361">**Figure 7** : Geometry using the modified lightness scaler with destination device black point</span></span>

<span data-ttu-id="95662-362">為了讓後續的色度壓縮演算法繼續進行，您想要對齊來源和目的地 shell 上的最大和最小 lightnesses。</span><span class="sxs-lookup"><span data-stu-id="95662-362">To allow the subsequent chroma compression algorithm to proceed, you want to align the maximum and minimum lightnesses on the source and destination shells.</span></span> <span data-ttu-id="95662-363">您可以藉由將點向左移動，藉由調整 J <sub>neutralMin</sub> 和 j k 之間的目的地 shell 來達成這個目的。</span><span class="sxs-lookup"><span data-stu-id="95662-363">This can be achieved by adjusting the destination shell between J <sub>neutralMin</sub> and J ₖ by shifting points to the left.</span></span> <span data-ttu-id="95662-364">此外，這種轉換必須套用到整個 Jab 空間，而不只是對應至 h k 的色調平面。</span><span class="sxs-lookup"><span data-stu-id="95662-364">Furthermore, this transformation must be applied on the whole Jab space, not just the hue plane corresponding to h ₖ.</span></span>

<span data-ttu-id="95662-365">轉換為</span><span class="sxs-lookup"><span data-stu-id="95662-365">The transformation is</span></span>

![顯示轉換的公式。](images/gmmp-seqfigure03.png)

<span data-ttu-id="95662-367">[圖 8] 顯示轉換的效果。</span><span class="sxs-lookup"><span data-stu-id="95662-367">Figure 8 shows the effect of the transformation.</span></span>

![顯示修改過的亮度 scaler 與目的地裝置黑色點效果的圖表。](images/gmmp-seqfigure04.png)

<span data-ttu-id="95662-369">**圖 8** ：使用修改過的亮度 scaler 與目的地裝置黑色點的幾何</span><span class="sxs-lookup"><span data-stu-id="95662-369">**Figure 8** : Geometry using the modified lightness scaler with destination device black point</span></span>

<span data-ttu-id="95662-370">套用一般的色度壓縮演算法之後，點必須「回頭移動」; 也就是說，必須套用反向轉換來取得最終對應的色彩。</span><span class="sxs-lookup"><span data-stu-id="95662-370">After applying the usual chroma compression algorithm, the point must then be "shifted back;" that is, the inverse transformation must be applied to obtain the final mapped color.</span></span>

![顯示反向轉換的公式，以取得最終對應的色彩。](images/gmmp-seqfigure05.png)

### <a name="the-case-of-dual-gamut-shells"></a><span data-ttu-id="95662-372">雙 gamut shell 的案例</span><span class="sxs-lookup"><span data-stu-id="95662-372">The case of dual gamut shells</span></span>

<span data-ttu-id="95662-373">其目標是要將 \_ 單一 gamut shell 的 SIG knee brace 一般化至來源裝置 GBD 或目的地裝置 GBD 有雙 shell 結構的情況。</span><span class="sxs-lookup"><span data-stu-id="95662-373">The goal is to generalize SIG\_KNEE for single gamut shell to the case where either the source device GBD or the destination device GBD has a two-shell structure.</span></span> <span data-ttu-id="95662-374">內部 shell 將稱為參考 Shell，而外部 shell 則稱為合理 Shell。</span><span class="sxs-lookup"><span data-stu-id="95662-374">The inner shell will be called the Reference Shell, while the outer shell will be called the Plausible Shell.</span></span> <span data-ttu-id="95662-375">您想要考慮下列案例。</span><span class="sxs-lookup"><span data-stu-id="95662-375">You want to consider the following cases.</span></span>

<span data-ttu-id="95662-376"> () 來源 GBD 和目的地 GBD 都有兩個 shell 的結構。</span><span class="sxs-lookup"><span data-stu-id="95662-376">(a) Both the source GBD and destination GBD have a two-shell structure.</span></span>

<span data-ttu-id="95662-377"> (b) 來源 GBD 有一個雙 shell 結構;目的地 GBD 只有一個 shell。</span><span class="sxs-lookup"><span data-stu-id="95662-377">(b) The source GBD has a two-shell structure; the destination GBD has only one shell.</span></span>

<span data-ttu-id="95662-378"> (c) 來源 GBD 只有一個 shell;目的地 GBD 有一個雙 shell 結構。</span><span class="sxs-lookup"><span data-stu-id="95662-378">(c) The source GBD has only one shell; the destination GBD has a two-shell structure.</span></span>

<span data-ttu-id="95662-379"> (d) 來源 GBD 和目的地 GBD 只有一個 shell。</span><span class="sxs-lookup"><span data-stu-id="95662-379">(d) Both the source GBD and destination GBD have only one shell.</span></span>

<span data-ttu-id="95662-380">案例 (d) 是先前討論過的單一 gamut shell 案例。</span><span class="sxs-lookup"><span data-stu-id="95662-380">Case (d) is the case of single gamut shell that was discussed previously.</span></span> <span data-ttu-id="95662-381">針對 () 、 (b) 和 (c) 的情況，您可以將亮度重新調整一般化，以使用雙重 shell 結構中的額外資訊。</span><span class="sxs-lookup"><span data-stu-id="95662-381">For cases (a), (b), and (c), you can generalize the lightness rescaling to use the extra information from the dual shell structure.</span></span> <span data-ttu-id="95662-382">在某些情況下 (b) 和 (c) 其中來源或目的地只有一個 shell 時，您會引進「引發的參考 shell」，接下來的「產生的參考 shell」一節會加以討論。</span><span class="sxs-lookup"><span data-stu-id="95662-382">In cases (b) and (c) where either the source or the destination has only one shell, you introduce an "induced reference shell" which will be discussed in a subsequent section, "Induced Reference Shell."</span></span> <span data-ttu-id="95662-383">針對 () 的案例，將會描述兩個 shell 的一般演算法。</span><span class="sxs-lookup"><span data-stu-id="95662-383">The general algorithm for two shells will be described for case (a).</span></span> <span data-ttu-id="95662-384">說明引發的參考 Shell 結構之後，也可以將演算法套用至案例 (b) 和 (c) 。</span><span class="sxs-lookup"><span data-stu-id="95662-384">After the Induced Reference Shell construction is explained, the algorithm can be applied to case (b) and (c), as well.</span></span> <span data-ttu-id="95662-385">針對色度壓縮，壓縮比例將取決於可用的最大 shell。</span><span class="sxs-lookup"><span data-stu-id="95662-385">As for chroma compression, the compression ratio will be determined by the largest shells available.</span></span> <span data-ttu-id="95662-386">換句話說，如果合理 Shell 和 Reference Shell 都可使用，則會使用合理 Shell;否則，將會使用參考 Shell。</span><span class="sxs-lookup"><span data-stu-id="95662-386">In other words, if both the Plausible Shell and Reference Shell are available, the Plausible Shell will be used; otherwise, the Reference Shell will be used.</span></span>

<span data-ttu-id="95662-387">*一般化的亮度重新調整*</span><span class="sxs-lookup"><span data-stu-id="95662-387">*Generalized Lightness Rescaling*</span></span>

<span data-ttu-id="95662-388">來源和目的地 GBD 都有兩個 shell，表示您必須將來自來源 GBD 的四個點集合對應至目的地 GBD 中的對應集合。</span><span class="sxs-lookup"><span data-stu-id="95662-388">The existence of two shells for both source and destination GBD means that you must map a set of four points from the source GBD to a corresponding set in the destination GBD.</span></span>

![顯示如何將四個點的集合對應至對應的集合。](images/gmmp-image030.png)

<span data-ttu-id="95662-390">注標具有下列意義。</span><span class="sxs-lookup"><span data-stu-id="95662-390">The subscripts have the following meanings.</span></span>

<span data-ttu-id="95662-391">o 或 r：「原始」 (來源) 或「複製」 (目的地) </span><span class="sxs-lookup"><span data-stu-id="95662-391">o or r: "original" (source) or "reproduction" (destination)</span></span>

<span data-ttu-id="95662-392">最小或最大值：最小中性亮度或最大中性亮度</span><span class="sxs-lookup"><span data-stu-id="95662-392">min or max: minimum neutral lightness or maximum neutral lightness</span></span>

<span data-ttu-id="95662-393">pla 或 ref：合理 Shell 或 Reference Shell</span><span class="sxs-lookup"><span data-stu-id="95662-393">pla or ref: Plausible Shell or Reference Shell</span></span>

<span data-ttu-id="95662-394">每四個四個的順序也是這些點預期的相對大小。</span><span class="sxs-lookup"><span data-stu-id="95662-394">The ordering in each quadruple is also the expected relative magnitude of these points.</span></span>

<span data-ttu-id="95662-395">亮度重新調整地圖會使用與單一 shell 相同的前兩個方程式，但 *J S* 的定義方式如下分段。</span><span class="sxs-lookup"><span data-stu-id="95662-395">The Lightness Rescaling map uses the same first two equations as the single shell, but *J S* is defined in a piecewise manner as follows.</span></span>

![以分段的方式顯示 J # 的公式。](images/gmmp-image032.png) <span data-ttu-id="95662-397">(7)</span><span class="sxs-lookup"><span data-stu-id="95662-397">(7)</span></span>

<span data-ttu-id="95662-398">換句話說，它是在參考 shell 內 sigmoidal，而線性在外。</span><span class="sxs-lookup"><span data-stu-id="95662-398">In other words, it is sigmoidal within the reference shell, and linear outside.</span></span> <span data-ttu-id="95662-399">請參閱圖 9。</span><span class="sxs-lookup"><span data-stu-id="95662-399">See Figure 9.</span></span>

![此圖顯示兩個 shell GBDs 的亮度重新調整函式圖形。](images/gmmp-image033.png)

<span data-ttu-id="95662-401">**圖 9** ：雙 shell GBDs 的亮度縮放功能</span><span class="sxs-lookup"><span data-stu-id="95662-401">**Figure 9** : Lightness Rescaling function for two-shell GBDs</span></span>

<span data-ttu-id="95662-402">**引發的參考 SHELL**</span><span class="sxs-lookup"><span data-stu-id="95662-402">**INDUCED REFERENCE SHELL**</span></span>

<span data-ttu-id="95662-403">其中一個 GBD 具有一個 shell，而另一個 GBD 有兩個 shell，您必須為 GBD 建立一個只含一個 shell 的「參考 Shell」。</span><span class="sxs-lookup"><span data-stu-id="95662-403">Where one GBD has one shell and the other GBD has two shells, you must create a "Reference Shell" for the GBD with only one shell.</span></span> <span data-ttu-id="95662-404">現有的 shell （稱為參考 Shell）將會變更為「合理 Shell」。事實上，您實際上不需要在完整 Jab 空間中建立 shell。</span><span class="sxs-lookup"><span data-stu-id="95662-404">The existing shell, which would be called the Reference Shell, will be changed to the "Plausible Shell."In fact, you don't actually have to create a shell in the full Jab space.</span></span> <span data-ttu-id="95662-405">由於亮度重新調整只會使用 *j 最大* 值和 *j 分鐘*，因此您只需要為所引發的參考 Shell 組成這些值。</span><span class="sxs-lookup"><span data-stu-id="95662-405">Because the lightness rescaling only uses *J max* and *J min*, you only have to make up these values for the induced Reference Shell.</span></span> <span data-ttu-id="95662-406">有兩種情況，取決於哪個 GBD 有兩個 shell。</span><span class="sxs-lookup"><span data-stu-id="95662-406">There are two cases, depending on which GBD has two shells.</span></span>

<span data-ttu-id="95662-407">案例1：來源 GBD 有兩個 shell;目的地 GBD 有一個 shell。</span><span class="sxs-lookup"><span data-stu-id="95662-407">Case 1: Source GBD has two shells; destination GBD has one shell.</span></span>

<span data-ttu-id="95662-408">判斷中性軸上的目的地引發的參考 Shell;亦即，shell 的 J <sub>r、\ min、\ ref</sub> 和 j <sub>r、\ max、\ ref</sub> 。</span><span class="sxs-lookup"><span data-stu-id="95662-408">Determine the destination induced Reference Shell on the neutral axis; that is, the J <sub>r,\ min,\ ref</sub> and J <sub>r,\ max,\ ref</sub> of the shell.</span></span> <span data-ttu-id="95662-409">這是使用下列演算法來完成的。</span><span class="sxs-lookup"><span data-stu-id="95662-409">This is done using the following algorithm.</span></span>

![顯示用來判斷目的地所引發參考 Shell 的演算法。](images/gmmp-induced01.png)

<span data-ttu-id="95662-411">這些因素？</span><span class="sxs-lookup"><span data-stu-id="95662-411">The factors ?</span></span> <span data-ttu-id="95662-412"><sub>低</sub> ？</span><span class="sxs-lookup"><span data-stu-id="95662-412"><sub>low</sub> and ?</span></span> <span data-ttu-id="95662-413"><sub>高度</sub> 控制合理 Shell 和參考 shell 之間的分隔。</span><span class="sxs-lookup"><span data-stu-id="95662-413"><sub>high</sub> control the separation between the Plausible Shell and the Reference Shell.</span></span> <span data-ttu-id="95662-414">值為1表示 J <sub>min</sub> 值或 j m ₐₓ值一致。</span><span class="sxs-lookup"><span data-stu-id="95662-414">A value of 1 means that the J <sub>min</sub> values or J ₘₐₓ values coincide.</span></span> <span data-ttu-id="95662-415">它們的值會從來源參考 Shell 和來源合理 Shell 「引發」。</span><span class="sxs-lookup"><span data-stu-id="95662-415">Their values are "induced" from the source Reference Shell and source Plausible Shell.</span></span>

![顯示來源參考 Shell 和來源合理 Shell 值的公式。](images/gmmp-induced02.png)

<span data-ttu-id="95662-417">「巧克力因數」 F <sub>低</sub> 和 f <sub>high</sub> 是可 *調式參數* ，必須介於0和1之間。</span><span class="sxs-lookup"><span data-stu-id="95662-417">The "fudge factors" F <sub>low</sub> and F <sub>high</sub> are *tunable parameters* that must lie between 0 and 1.</span></span> <span data-ttu-id="95662-418">如果值為0，則會直接從來源 shell 引發 J <sub>分鐘</sub> 或 j m ₐₓ。</span><span class="sxs-lookup"><span data-stu-id="95662-418">If the value is 0, then the J <sub>min</sub> or J ₘₐₓ are directly induced from the source shells.</span></span> <span data-ttu-id="95662-419">在此情況下，請選擇 F <sub>low</sub> = 0.95 和 f <sub>high</sub> = 0.1。</span><span class="sxs-lookup"><span data-stu-id="95662-419">For this case, choose F <sub>low</sub> = 0.95, and F <sub>high</sub> = 0.1.</span></span>

<span data-ttu-id="95662-420">案例2：來源 GBD 有一個 shell;目的地 GBD 有兩個 shell。</span><span class="sxs-lookup"><span data-stu-id="95662-420">Case 2: Source GBD has one shell; destination GBD has two shells.</span></span>

<span data-ttu-id="95662-421">判斷中性軸上引發的來源參考 Shell;亦即，shell 的 J <sub>o、\ min、\ ref</sub> 和 j <sub>o、\ max、\ ref</sub> 。</span><span class="sxs-lookup"><span data-stu-id="95662-421">Determine the source induced Reference Shell on the neutral axis; that is, the J <sub>o,\ min,\ ref</sub> and J <sub>o,\ max,\ ref</sub> of the shell.</span></span> <span data-ttu-id="95662-422">這是使用下列演算法來完成的。</span><span class="sxs-lookup"><span data-stu-id="95662-422">This is done using the following algorithm.</span></span>

![顯示演算法，以判斷中性軸上的目的地所引發的參考 Shell。](images/gmmp-induced03.png)

<span data-ttu-id="95662-424">同樣地，這些因素呢？</span><span class="sxs-lookup"><span data-stu-id="95662-424">Again, the factors ?</span></span> <span data-ttu-id="95662-425"><sub>低</sub> ？</span><span class="sxs-lookup"><span data-stu-id="95662-425"><sub>low</sub> and ?</span></span> <span data-ttu-id="95662-426"><sub>高度</sub> 控制合理 Shell 和參考 shell 之間的分隔。</span><span class="sxs-lookup"><span data-stu-id="95662-426"><sub>high</sub> control the separation between the Plausible Shell and Reference Shell.</span></span> <span data-ttu-id="95662-427">值為1表示 J <sub>min</sub> 值或 j m ₐₓ值一致。</span><span class="sxs-lookup"><span data-stu-id="95662-427">A value of 1 means the J <sub>min</sub> values or J ₘₐₓ values coincide.</span></span> <span data-ttu-id="95662-428">它們的值會從來源參考 Shell 和來源合理 Shell 「引發」：</span><span class="sxs-lookup"><span data-stu-id="95662-428">Their values are "induced" from the source Reference Shell and source Plausible Shell:</span></span>

![顯示演算法來控制參考 Shell 和來源合理 Shell 之間的分隔。](images/gmmp-induced04.png)

### <a name="reasons-for-changes-from-the-cie-tc8-03-recommendations"></a><span data-ttu-id="95662-430">CIE TC8-03 建議的變更原因</span><span class="sxs-lookup"><span data-stu-id="95662-430">Reasons for changes from the CIE TC8-03 recommendations</span></span>

<span data-ttu-id="95662-431">BasicPhoto 與 CIE TC8-03 建議的差異在於下列方面。</span><span class="sxs-lookup"><span data-stu-id="95662-431">BasicPhoto differs from the CIE TC8-03 recommendations in the following ways.</span></span>

1.  <span data-ttu-id="95662-432">色度不會針對尖點進行壓縮，而是沿著固定亮度的行。</span><span class="sxs-lookup"><span data-stu-id="95662-432">Chroma is not compressed toward the cusp but along lines of constant lightness.</span></span>
2.  <span data-ttu-id="95662-433">亮度範圍會使用範圍中最深色彩的亮度，而不是範圍界限跨越中性軸的時間點。</span><span class="sxs-lookup"><span data-stu-id="95662-433">The lightness range uses the lightness of the darkest color in the gamut rather than the point at which the gamut boundary crosses the neutral axis.</span></span>
3.  <span data-ttu-id="95662-434">BasicPhoto 支援參考範圍 shell 和合理 gamut shell，如果轉換中的任一個範圍界限有兩個 shell。</span><span class="sxs-lookup"><span data-stu-id="95662-434">BasicPhoto supports both a reference gamut shell and a plausible gamut shell, if either gamut boundary in the transform has two shells.</span></span>
4.  <span data-ttu-id="95662-435">BasicPhoto 使用 CIECAM02;而不是使用 CIECAM97s，在 400 cd/m2 上轉換成 D65，然後使用 RIT IPT 色彩空間。</span><span class="sxs-lookup"><span data-stu-id="95662-435">BasicPhoto uses CIECAM02; instead of using CIECAM97s to convert to D65 at 400 cd/m2, and then using RIT IPT color space.</span></span>

<span data-ttu-id="95662-436">進行第一次的變更，以防止在將壓縮用於尖點時可能發生的色調反轉問題。</span><span class="sxs-lookup"><span data-stu-id="95662-436">The first change was made to prevent tone inversion problems that can occur when using compression toward a cusp.</span></span> <span data-ttu-id="95662-437">如圖10所示，尖點壓縮可能會導致語氣反轉。</span><span class="sxs-lookup"><span data-stu-id="95662-437">As shown in Figure 10, cusp compression can cause tone inversions.</span></span> <span data-ttu-id="95662-438">當高色度的色彩比低色度的色彩輕時，就會發生這種情況。</span><span class="sxs-lookup"><span data-stu-id="95662-438">This can happen when colors of high chroma are lighter than colors of lower chroma.</span></span> <span data-ttu-id="95662-439">因為 SGCK 會在亮度和色度中個別壓縮每個圖元，所以不保證會在壓縮後的圖元值之間保留亮度關聯性。</span><span class="sxs-lookup"><span data-stu-id="95662-439">Because SGCK compresses each pixel independently in both lightness and chroma, it is not guaranteed to preserve the lightness relationship between the pixel values after the compression.</span></span> <span data-ttu-id="95662-440">這項決定在固定亮度行上進行壓縮的已知缺點是，您可能會降低色度，特別是在目的範圍界限非常平坦的區域中，就像是明亮的黃色一樣。</span><span class="sxs-lookup"><span data-stu-id="95662-440">The well-known downside to this decision to compress on lines of constant lightness is that you can suffer losses of chroma, particular in areas where the destination gamut boundary is very flat, as happens with bright yellows.</span></span>

![顯示 SGCK 所造成之色調反轉的圖表。](images/gmmp-toneinversion.png)

<span data-ttu-id="95662-442">**圖 10** ： SGCK 所造成的音調反轉</span><span class="sxs-lookup"><span data-stu-id="95662-442">**Figure 10** : Tone inversion caused by SGCK</span></span>

![顯示茶壺的原始影像。](images/originalteapot.jpg)![顯示茶壺影像的 SGCK 結果。](images/badteapot.jpg)![顯示茶壺影像的 BasicPhoto 結果。](images/betterteapot.jpg)

<span data-ttu-id="95662-446">**圖 11** ：原始影像、SGCK 結果和 BasicPhoto 結果</span><span class="sxs-lookup"><span data-stu-id="95662-446">**Figure 11** : Original image, SGCK result, and BasicPhoto result</span></span>

<span data-ttu-id="95662-447">[圖 11] 說明這種語氣反轉。</span><span class="sxs-lookup"><span data-stu-id="95662-447">Figure 11 illustrates this tone inversion.</span></span> <span data-ttu-id="95662-448">左邊是由數位相機所捕捉的原始影像;在中央，SGCK 所重現的影像;右側的影像是由 BasicPhoto 重現。</span><span class="sxs-lookup"><span data-stu-id="95662-448">On the left is an original image captured by a digital camera; in the center, the image as reproduced by SGCK; and on the right, the image as reproduced by BasicPhoto.</span></span> <span data-ttu-id="95662-449">左邊的影像位於數位相機的色彩空間，而中央和右邊影像則位於 LCD 顯示器的色彩空間中。</span><span class="sxs-lookup"><span data-stu-id="95662-449">The image on the left is in the digital camera's color space, the center and right images are in the color space of an LCD video display.</span></span> <span data-ttu-id="95662-450">在原始影像中，茶壺的上半部會比底部更暗，因為底部會反映其坐在的桌布。</span><span class="sxs-lookup"><span data-stu-id="95662-450">In the original image, the top part of the teapot is darker than the bottom, because the bottom is reflecting the tablecloth that it is sitting upon.</span></span> <span data-ttu-id="95662-451">在 SGCK 影像中，最上層的部分實際上比底部更淺，因為色調反轉。</span><span class="sxs-lookup"><span data-stu-id="95662-451">In the SGCK image, the top part is actually lighter than the bottom, because of the tone inversion.</span></span> <span data-ttu-id="95662-452">此外，您也很難看到茶壺的下半部所反映的專案。</span><span class="sxs-lookup"><span data-stu-id="95662-452">Also, it is difficult to see the items reflected in the lower part of the teapot.</span></span> <span data-ttu-id="95662-453">右邊的 BasicPhoto 已修正色調反轉，反映的文章更清楚。</span><span class="sxs-lookup"><span data-stu-id="95662-453">On the right, BasicPhoto has fixed the tone inversion and the reflected articles are more clearly distinguishable.</span></span>

<span data-ttu-id="95662-454">第二項變更是為了改善 blackest 黑色不直接落在 CIECAM02 中立軸上的印表機上幾乎黑色色彩的複製品。</span><span class="sxs-lookup"><span data-stu-id="95662-454">The second change was made to improve the reproduction of nearly black colors on printers where the blackest black does not fall directly on the CIECAM02 neutral axis.</span></span> <span data-ttu-id="95662-455">下圖12顯示轉換成 sRGB 的影像;使用 SGCK 為 RGB 噴墨印表機重現並使用 BasicPhoto 在相同的印表機上重現。</span><span class="sxs-lookup"><span data-stu-id="95662-455">The following Figure 12 shows an image converted to sRGB; reproduced for an RGB inkjet printer using SGCK; and reproduced for the same printer using BasicPhoto.</span></span> <span data-ttu-id="95662-456">中心內的影像未使用全裝置黑色，因此缺少原始的對比。</span><span class="sxs-lookup"><span data-stu-id="95662-456">The image in the center is not using the full device black, and so it lacks the contrast seen in the original.</span></span> <span data-ttu-id="95662-457">對比會以 BasicPhoto 還原。</span><span class="sxs-lookup"><span data-stu-id="95662-457">The contrast is restored with BasicPhoto.</span></span>

![顯示 playset 的原始影像。](images/playstructure.jpg)![針對使用 SGCK 的 R G B 噴墨印表機，顯示 playset 重現的影像。](images/playstructurebad.jpg)![針對使用 BasicPhoto 的 R G B 噴墨印表機，顯示 playset 重現的影像。](images/betterplaystructure.jpg)

<span data-ttu-id="95662-461">**圖 12** ：增強的黑色</span><span class="sxs-lookup"><span data-stu-id="95662-461">**Figure 12** : Enhanced black</span></span>

<span data-ttu-id="95662-462">第三個變更是為了改善數位攝影機的色彩複製。</span><span class="sxs-lookup"><span data-stu-id="95662-462">The third change was made to improve the color reproduction for digital cameras.</span></span> <span data-ttu-id="95662-463">尤其是在使用參考目標分析數位相機的情況下，從測量色彩建立的範圍界限描述可能不包含可能在真實世界場景中捕捉的所有色彩。</span><span class="sxs-lookup"><span data-stu-id="95662-463">Particularly in cases where the digital camera has been profiled using a reference target, a gamut boundary description built from measured colors might not include all the colors that might be captured in a real world scene.</span></span> <span data-ttu-id="95662-464">您可以使用外推來產生合理範圍界限，而不是將所有色彩裁剪成測量色目標的範圍。</span><span class="sxs-lookup"><span data-stu-id="95662-464">Rather than clipping all colors to the gamut of the measured color target, you allow for extrapolation to produce a plausible gamut boundary.</span></span> <span data-ttu-id="95662-465">BasicPhoto 演算法的設計是為了支援這類推斷的範圍界限。</span><span class="sxs-lookup"><span data-stu-id="95662-465">The BasicPhoto algorithm is designed to support such an extrapolated gamut boundary.</span></span>

<span data-ttu-id="95662-466">第四個變更的原因是 CIECAM02 很適合用於 gamut 對應。</span><span class="sxs-lookup"><span data-stu-id="95662-466">The fourth change was made because CIECAM02 works well for gamut mapping.</span></span> <span data-ttu-id="95662-467">TC8-03 將裝置色彩轉換成 D65 at 400 cd/m2，然後使用 RIT IPT 色彩空間的程式，是需要大量計算和耗時的。</span><span class="sxs-lookup"><span data-stu-id="95662-467">The process recommended by TC8-03 of converting device colors to D65 at 400 cd/m2, and then using the RIT IPT color space is both computation-intensive and time-consuming.</span></span>

### <a name="hue-mapping"></a><span data-ttu-id="95662-468">色調對應</span><span class="sxs-lookup"><span data-stu-id="95662-468">Hue mapping</span></span>

<span data-ttu-id="95662-469">HueMap 等同于 ICC 飽和度意圖。</span><span class="sxs-lookup"><span data-stu-id="95662-469">HueMap is the equivalent of the ICC Saturation intent.</span></span>

<span data-ttu-id="95662-470">如果來源範圍界限或目的地範圍界限不包含主要複本，此模型會還原為 MinCD (上一節所述的相對) 模型;例如，無法判斷主要複本的裝置 (具有四個通道) 或單色 ICC 設定檔的 ICC 設定檔。</span><span class="sxs-lookup"><span data-stu-id="95662-470">If either the source gamut boundary or the destination gamut boundary does not contain primaries, this model reverts to the MinCD (relative) model described in a preceding section; for example, devices for which the primaries cannot be determined (ICC profiles with more than four channels) or monochrome ICC profiles.</span></span>

<span data-ttu-id="95662-471">此演算法會先調整輸入色彩值的色調。</span><span class="sxs-lookup"><span data-stu-id="95662-471">This algorithm first adjusts the hue of the input color value.</span></span> <span data-ttu-id="95662-472">然後，它會使用剪下對應來同時調整亮度和色度。</span><span class="sxs-lookup"><span data-stu-id="95662-472">Then it simultaneously adjusts the lightness and chroma, using a shearing mapping.</span></span> <span data-ttu-id="95662-473">最後，它會裁剪色彩值，以確保其在範圍內。</span><span class="sxs-lookup"><span data-stu-id="95662-473">Finally, it clips color value to make sure it is within gamut.</span></span>

<span data-ttu-id="95662-474">第一個步驟是判斷「色調輪子」。</span><span class="sxs-lookup"><span data-stu-id="95662-474">The first step is to determine the "Hue Wheels."</span></span> <span data-ttu-id="95662-475">尋找來源和目的地裝置的主要和次要色彩的 JCh 值。</span><span class="sxs-lookup"><span data-stu-id="95662-475">Find the JCh values for primary and secondary colors for both source and destination device.</span></span> <span data-ttu-id="95662-476">您只會考慮色調元件。</span><span class="sxs-lookup"><span data-stu-id="95662-476">You are only considering the hue components.</span></span> <span data-ttu-id="95662-477">這會導致每個裝置具有六個色點的主要或次要色調滾輪。</span><span class="sxs-lookup"><span data-stu-id="95662-477">This results in a primary or secondary hue wheel with six color points for each device.</span></span> <span data-ttu-id="95662-478"> (請參閱 [圖 13] ) </span><span class="sxs-lookup"><span data-stu-id="95662-478">(See Figure 13.)</span></span>

![顯示具有六個色點之色調輪子的圖表。](images/gmmp-figure12.png)

<span data-ttu-id="95662-480">**圖 13** ：色調輪子</span><span class="sxs-lookup"><span data-stu-id="95662-480">**Figure 13** : Hue wheels</span></span>

<span data-ttu-id="95662-481">如果來源藍色主要未旋轉至目的地藍色主要複本，則可以取得更好的結果。</span><span class="sxs-lookup"><span data-stu-id="95662-481">Better results can be obtained if the source blue primary is not rotated to the destination blue primary.</span></span> <span data-ttu-id="95662-482">相反地，來源藍色主要色調角度會用來作為目的地藍色主要色調角度。</span><span class="sxs-lookup"><span data-stu-id="95662-482">Instead, the source blue primary hue angle is used as the destination blue primary hue angle.</span></span>

<span data-ttu-id="95662-483">接下來，從來源影像執行每個輸入色彩的色調旋轉，</span><span class="sxs-lookup"><span data-stu-id="95662-483">Next, perform the hue rotations for each input color from the source image,</span></span>

<span data-ttu-id="95662-484">使用輸入色彩色調角度的) ，決定相對於兩個相鄰主要或次要色彩的來源色調滾輪上的色彩位置。</span><span class="sxs-lookup"><span data-stu-id="95662-484">a)Using the hue angle of the input color, determine the location of the color on the source hue wheel relative to the two adjacent primary or secondary color.</span></span> <span data-ttu-id="95662-485">您可以將位置視為主要複本之間距離的百分比。</span><span class="sxs-lookup"><span data-stu-id="95662-485">The location can be thought of as a percentage of the distance between the primaries.</span></span> <span data-ttu-id="95662-486">例如，輸入色彩色調是從洋紅色的色相值到紅色的色調值的40%。</span><span class="sxs-lookup"><span data-stu-id="95662-486">For example, the input color hue is 40 percent of the way from the hue value of Magenta to the hue value of Red.</span></span>

<span data-ttu-id="95662-487">b) 在目的色調滾輪上，找出相關聯的色調角度，例如，從洋紅到紅色的40%。</span><span class="sxs-lookup"><span data-stu-id="95662-487">b)On the destination hue wheel, find the associated hue angle, for example, 40 percent from Magenta to Red.</span></span> <span data-ttu-id="95662-488">此值將會是目的地色調角度。</span><span class="sxs-lookup"><span data-stu-id="95662-488">This value will be the destination hue angle.</span></span>

<span data-ttu-id="95662-489">一般情況下，來源主要複本和次要資料庫將不會與目的地主要複本和次要資料庫具有相同的色調角度;也就是說，目的地色調角度通常會與來源色調角度不同。</span><span class="sxs-lookup"><span data-stu-id="95662-489">In general, the source primaries and secondaries will not be at the same hue angles as the destination primaries and secondaries; that is, the destination hue angle usually will be different from the source hue angle.</span></span>

<span data-ttu-id="95662-490">例如，假設色調輪子產生下列值：</span><span class="sxs-lookup"><span data-stu-id="95662-490">For example, suppose the hue wheels produce the following values:</span></span>

<span data-ttu-id="95662-491">來源 M = 295 度，來源 R = 355 度。</span><span class="sxs-lookup"><span data-stu-id="95662-491">Source M = 295 degrees, Source R = 355 degrees.</span></span>

<span data-ttu-id="95662-492">目的地 M = 290 度，目的地 R = 346 度。</span><span class="sxs-lookup"><span data-stu-id="95662-492">Destination M = 290 degrees, Destination R = 346 degrees.</span></span>

<span data-ttu-id="95662-493">如果輸入色彩的色調角度是319度，則會是從來源 M 到來源 R (24) 度的40% 角度。從 M 到 R 的角度是60度，而從 M 到輸入色調的角度是24度。</span><span class="sxs-lookup"><span data-stu-id="95662-493">If the hue angle of the input color is 319 degrees, it is 40 percent of the angle (24 degrees) from source M to source R. The angle from M to R is 60 degrees, and the angle from M to input hue is 24 degrees.</span></span> <span data-ttu-id="95662-494">計算目的地為40% 的目的地，從目的地 M 到目的地 R (22 度) ，所以目的地色彩的色調角度是312度。</span><span class="sxs-lookup"><span data-stu-id="95662-494">Calculate the angle on the destination that is 40 percent from destination M to destination R (22 degrees), so the hue angle of the destination color is 312 degrees.</span></span>

<span data-ttu-id="95662-495">接下來，計算來源色調和目的地色調的色調參考點。</span><span class="sxs-lookup"><span data-stu-id="95662-495">Next, calculate the hue reference points for the source hue and the destination hue.</span></span> <span data-ttu-id="95662-496">若要計算特定 h (色調) 值的色調參考點，您想要尋找 J (亮度) 值和 C (色度) 值。</span><span class="sxs-lookup"><span data-stu-id="95662-496">To calculate the hue reference point for a particular h (hue) value, you want to find the J (lightness) value and C (chroma) value.</span></span>

-   <span data-ttu-id="95662-497">使用色調的相對位置，在相鄰主要或次要點的 J 值之間插插，以找出色調參考點的 J 值;例如，在此範例中為40%。</span><span class="sxs-lookup"><span data-stu-id="95662-497">Find the J value of the hue reference point by interpolating between the J values for the adjacent primary or secondary points, using the relative position of the hue; for example, 40 percent in this example.</span></span>
-   <span data-ttu-id="95662-498">找出這個 J 值和 h 值的最大 C 值。</span><span class="sxs-lookup"><span data-stu-id="95662-498">Find the maximum C value at this J value and h value.</span></span> <span data-ttu-id="95662-499">您現在有該色調的色調參考點 JCh。</span><span class="sxs-lookup"><span data-stu-id="95662-499">You now have the JCh of the hue reference point for that hue.</span></span>

![顯示色調分葉的圖表。](images/gmmp-figure13.png)

<span data-ttu-id="95662-501">**圖 14** ：色調分葉 (特定色調的範圍界限配量的視覺效果) </span><span class="sxs-lookup"><span data-stu-id="95662-501">**Figure 14** : A hue leaf (visualization of a gamut boundary slice at a specific hue)</span></span>

<span data-ttu-id="95662-502">下一步是為每個圖元計算切變對應。</span><span class="sxs-lookup"><span data-stu-id="95662-502">The next step is to compute the shear mapping for each pixel.</span></span> <span data-ttu-id="95662-503">首先，將來源色彩色調角度的來源範圍中的色調分葉視覺化，以及在色調旋轉期間計算的目的地色調角度的色相分葉。</span><span class="sxs-lookup"><span data-stu-id="95662-503">First, visualize a hue leaf from the source gamut for the source color hue angle, and a hue leaf from the destination gamut for the destination hue angle computed during hue rotation.</span></span> <span data-ttu-id="95662-504">色調離開的建立方式是從 JCh 範圍界限介面中的特定色調角度取得「配量」 (參閱圖 14) 。</span><span class="sxs-lookup"><span data-stu-id="95662-504">The hue leaves are created by taking a "slice" from the JCh gamut boundary surface at a specific hue angle (see Figure 14).</span></span>

<span data-ttu-id="95662-505">注意：基於效能優化的理由，不會實際建立色調離開;這裡僅針對視覺效果用途描述並顯示這些內容。</span><span class="sxs-lookup"><span data-stu-id="95662-505">NOTE: For performance optimization reasons, hue leaves are not actually created; they are described and shown here for visualization purposes only.</span></span> <span data-ttu-id="95662-506">作業會以指定的色調直接在範圍界限介面上執行。</span><span class="sxs-lookup"><span data-stu-id="95662-506">The operations are performed directly on the gamut boundary surface at the specified hue.</span></span> <span data-ttu-id="95662-507">然後，您可以計算色相參考點來判斷切變對應。</span><span class="sxs-lookup"><span data-stu-id="95662-507">You then compute the hue reference points to determine the shear mapping.</span></span>

-   <span data-ttu-id="95662-508">執行亮度重新調整以將來源分葉的黑色和白色點對應至目的地分葉 (請參閱 [圖 15]) 。</span><span class="sxs-lookup"><span data-stu-id="95662-508">Perform a lightness rescaling to map the black and white points of the source leaf to the destination leaf (see Figure 15).</span></span> <span data-ttu-id="95662-509">來源色調分葉的黑色和白色點會以線性方式對應至目的地色調分葉的黑色和白色點，方法是調整來源界限的所有 J 座標。</span><span class="sxs-lookup"><span data-stu-id="95662-509">The black and white points of the source hue leaf are mapped linearly to the black and white points of the destination hue leaf, by scaling all the J coordinates of the source boundary.</span></span> <span data-ttu-id="95662-510">色調對應的輸入色彩值會以相同方式進行縮放。</span><span class="sxs-lookup"><span data-stu-id="95662-510">The hue-mapped input color value is scaled in the same manner.</span></span>

![顯示亮度對應的圖表。](images/gmmp-figure14.png)

<span data-ttu-id="95662-512">**圖 15** ：亮度對應</span><span class="sxs-lookup"><span data-stu-id="95662-512">**Figure 15** : Lightness mapping</span></span>

-   <span data-ttu-id="95662-513">判斷每個色調分葉的色調參考點。</span><span class="sxs-lookup"><span data-stu-id="95662-513">Determine the hue reference points for each hue leaf.</span></span> <span data-ttu-id="95662-514">將切變對應套用至來源分葉，讓來源和目的地參考點一致 (請參閱 [圖 16]) 。</span><span class="sxs-lookup"><span data-stu-id="95662-514">Apply a shear mapping to the source leaf so that the source and destination reference points coincide (see Figure 16).</span></span> <span data-ttu-id="95662-515">特定色調的範圍參考點是相鄰主要複本之間的插補色相參考點。</span><span class="sxs-lookup"><span data-stu-id="95662-515">The reference point for a gamut at a specific hue is the interpolated hue reference point between the adjacent primaries.</span></span> <span data-ttu-id="95662-516">來源色調分葉的參考點會以線性方式對應至目的地色調分葉的參考點，並使用會鎖定 J 軸的「切變」作業，讓黑色點和白色點保持固定。</span><span class="sxs-lookup"><span data-stu-id="95662-516">The reference point of the source hue leaf is mapped linearly to the reference point of the destination hue leaf, using a "shear" operation that locks the J axis, keeping the black points and the white points stationary.</span></span> <span data-ttu-id="95662-517">來源和目的地色調的黑色點、白色點和參考點應該一致。</span><span class="sxs-lookup"><span data-stu-id="95662-517">The black points, white points, and reference points of the source and destination hue leaves should coincide.</span></span>
-   <span data-ttu-id="95662-518">將切變對應套用至亮度調整的輸入色彩值。</span><span class="sxs-lookup"><span data-stu-id="95662-518">Apply the shear mapping to the lightness-adjusted input color value.</span></span> <span data-ttu-id="95662-519">來源色彩值的 J 和 C 座標會依比例調整，相對於其與 J 軸的距離。</span><span class="sxs-lookup"><span data-stu-id="95662-519">The J and C coordinates of the source color value are proportionally scaled, relative to its distance from the J axis.</span></span>
-   <span data-ttu-id="95662-520">接下來，會在傾斜對應的色彩點上，對色相參考點的 J 值進行微妙的色度相依亮度壓縮。</span><span class="sxs-lookup"><span data-stu-id="95662-520">Next, a subtle chroma-dependent lightness compression toward the J-value of the hue reference point is performed on the shear-mapped color point.</span></span> <span data-ttu-id="95662-521">壓縮到色調參考 J 是以類似 gamma 的方式完成，其中的白色、黑色、灰色和點都不會受到影響。</span><span class="sxs-lookup"><span data-stu-id="95662-521">The compression toward hue reference J is done in a gamma-like fashion, where white, black, grays, and points on the hue reference J are not affected.</span></span> <span data-ttu-id="95662-522">所有其他的點通常會以平滑方式在色調參考 J 附近，稍微 bunching 接近色調的參考 J，並使色度保持不變。</span><span class="sxs-lookup"><span data-stu-id="95662-522">All other points tend toward the hue reference J in a smooth fashion, slightly bunching up near the hue reference J, with chroma remaining constant.</span></span> <span data-ttu-id="95662-523">色度相依性可確保中性色彩不會受到影響，而且會以較高的色度來增加效果的色彩。</span><span class="sxs-lookup"><span data-stu-id="95662-523">The chroma dependency assures that neutral colors are not affected, and the effect is increased on colors with higher chroma.</span></span>

<span data-ttu-id="95662-524">以下是針對色調參考 J 的亮度壓縮的數學描述，或調整目的地點的 J 值。</span><span class="sxs-lookup"><span data-stu-id="95662-524">The following is a mathematical description of the lightness compression toward the hue reference J, or adjusting the J-value of the destination point.</span></span> <span data-ttu-id="95662-525">它稱為「目的點」（destination point），因為它已在剪切至目的範圍中。</span><span class="sxs-lookup"><span data-stu-id="95662-525">It is called the destination point because it has been shear mapped into the destination gamut.</span></span>

<span data-ttu-id="95662-526">首先，計算 "factorC" (為目的地點) 的色度相依性因素，以決定亮度壓縮會有多少效果。</span><span class="sxs-lookup"><span data-stu-id="95662-526">First, compute "factorC" (chroma dependency factor) for the destination point, which determines how much effect the lightness compression will have.</span></span> <span data-ttu-id="95662-527">接近或等於 J 軸的點將會有少量或無壓縮;遠離 J 軸的點 (高色度) 會套用更多的壓縮。</span><span class="sxs-lookup"><span data-stu-id="95662-527">Points near or on the J-axis will have little or no compression; points farther away from the J-axis (high-chroma) will have more compression applied.</span></span> <span data-ttu-id="95662-528">乘以0.5 以確保 factorC 小於1，因為 sourceC 可能會稍微大於 referenceC，但不能超過兩倍。</span><span class="sxs-lookup"><span data-stu-id="95662-528">Multiply by 0.5 to ensure that factorC is less than 1, because it is possible that sourceC could be slightly greater than referenceC, but not twice as great.</span></span>

<span data-ttu-id="95662-529">factorC = (destinationC/referenceC) ？</span><span class="sxs-lookup"><span data-stu-id="95662-529">factorC = (destinationC / referenceC) ?</span></span> <span data-ttu-id="95662-530">0.5</span><span class="sxs-lookup"><span data-stu-id="95662-530">0.5</span></span>

<span data-ttu-id="95662-531">其中：</span><span class="sxs-lookup"><span data-stu-id="95662-531">where:</span></span>

<span data-ttu-id="95662-532">destinationC 是目標點的 C 值。</span><span class="sxs-lookup"><span data-stu-id="95662-532">destinationC is the C-value of the destination point.</span></span>

<span data-ttu-id="95662-533">referenceC 是色調參考點的 C 值。</span><span class="sxs-lookup"><span data-stu-id="95662-533">referenceC is the C-value of the Hue Reference point.</span></span>

<span data-ttu-id="95662-534">接下來，判斷目的點 J 是在色調參考 J 的上方或下方。如果以上，請執行下列動作：</span><span class="sxs-lookup"><span data-stu-id="95662-534">Next, determine whether the destination point J is above or below the hue reference J. If it is above, do the following:</span></span>

1.  <span data-ttu-id="95662-535">計算相對於 referenceJ 之目的點的「factorJ」。</span><span class="sxs-lookup"><span data-stu-id="95662-535">Compute "factorJ" for the destination point relative to the referenceJ.</span></span> <span data-ttu-id="95662-536">如果在 referenceJ 上，這個 factorJ 值會介於0和 1 (0 之間;如果在 maxJ) ，則為1。</span><span class="sxs-lookup"><span data-stu-id="95662-536">This factorJ value will be between 0 and 1 (0 if on the referenceJ; 1 if at maxJ).</span></span>
2.  <span data-ttu-id="95662-537">factorJ = (destinationJ-referenceJ) / (maxJ-referenceJ) </span><span class="sxs-lookup"><span data-stu-id="95662-537">factorJ = (destinationJ - referenceJ) / (maxJ - referenceJ)</span></span>

    <span data-ttu-id="95662-538">其中：</span><span class="sxs-lookup"><span data-stu-id="95662-538">where:</span></span>

    <span data-ttu-id="95662-539">destinationJ 是目的地點的 J 值。</span><span class="sxs-lookup"><span data-stu-id="95662-539">destinationJ is the J-value of the destination point.</span></span>

    <span data-ttu-id="95662-540">referenceJ 是色調參考點的 J 值。</span><span class="sxs-lookup"><span data-stu-id="95662-540">referenceJ is the J-value of the hue reference point.</span></span>

    <span data-ttu-id="95662-541">maxJ 是色域的最大 J 值。</span><span class="sxs-lookup"><span data-stu-id="95662-541">maxJ is the maximum J-value of the gamut.</span></span>

3.  <span data-ttu-id="95662-542">將類似 gamma 的 power 函式套用至 factorJ，以減少特定數量的 factorJ。</span><span class="sxs-lookup"><span data-stu-id="95662-542">Apply a gamma-like power function to factorJ, which will reduce factorJ by a certain amount.</span></span> <span data-ttu-id="95662-543">此範例使用 2 (平方) 的乘冪。</span><span class="sxs-lookup"><span data-stu-id="95662-543">This example uses the power of 2 (the square).</span></span> <span data-ttu-id="95662-544">從原始 factorJ 中減去減少的 factorJ，然後將結果乘以主要 referenceJ 上方的總 J 範圍，以找出 "deltaJ"，代表在亮度壓縮之後的 J 變更，但不包含色度相依性。</span><span class="sxs-lookup"><span data-stu-id="95662-544">Subtract the reduced factorJ from the original factorJ and multiply the result by the total J-range above the primary referenceJ to find the "deltaJ," which represents the change in J after the lightness compression, but not including the chroma dependency.</span></span>
4.  <span data-ttu-id="95662-545">deltaJ = (factorJ- (factorJ？</span><span class="sxs-lookup"><span data-stu-id="95662-545">deltaJ = (factorJ - (factorJ ?</span></span> <span data-ttu-id="95662-546">factorJ) ) ？</span><span class="sxs-lookup"><span data-stu-id="95662-546">factorJ)) ?</span></span> <span data-ttu-id="95662-547"> (maxJ-referenceJ) </span><span class="sxs-lookup"><span data-stu-id="95662-547">(maxJ - referenceJ)</span></span>

5.  <span data-ttu-id="95662-548">將 factorC 套用至 deltaJ (色度愈高、效果愈大) ，並計算目的地點的新 J 值。</span><span class="sxs-lookup"><span data-stu-id="95662-548">Apply factorC to the deltaJ (the higher the chroma, the greater the effect), and compute the new J-value for the destination point.</span></span>
6.  <span data-ttu-id="95662-549">destinationJ = destinationJ- (deltaJ？</span><span class="sxs-lookup"><span data-stu-id="95662-549">destinationJ = destinationJ - (deltaJ ?</span></span> <span data-ttu-id="95662-550">factorC) </span><span class="sxs-lookup"><span data-stu-id="95662-550">factorC)</span></span>

<span data-ttu-id="95662-551">如果目的地點的 J-值低於 referenceJ，則會使用 minJ 而不是 maxJ 來尋找 J 中的範圍來計算 factorJ，並將作業的極性納入 referenceJ 的下方，以執行上述步驟 A 的類似計算</span><span class="sxs-lookup"><span data-stu-id="95662-551">If J-value for the destination point is below referenceJ, then a similar computation to the preceding steps A-C is performed, using minJ instead of maxJ to find the range in J to compute the factorJ, and taking into account the polarity of the operations "underneath" the referenceJ.</span></span>

<span data-ttu-id="95662-552">factorJ = (referenceJ-destinationJ) / (referenceJ-minJ) </span><span class="sxs-lookup"><span data-stu-id="95662-552">factorJ = (referenceJ - destinationJ) / (referenceJ - minJ)</span></span>

<span data-ttu-id="95662-553">deltaJ = (factorJ- (factorJ？</span><span class="sxs-lookup"><span data-stu-id="95662-553">deltaJ = (factorJ - (factorJ ?</span></span> <span data-ttu-id="95662-554">factorJ) ) ？</span><span class="sxs-lookup"><span data-stu-id="95662-554">factorJ)) ?</span></span> <span data-ttu-id="95662-555"> (referenceJ-minJ) </span><span class="sxs-lookup"><span data-stu-id="95662-555">(referenceJ - minJ)</span></span>

<span data-ttu-id="95662-556">destinationJ = destinationJ + (deltaJ？</span><span class="sxs-lookup"><span data-stu-id="95662-556">destinationJ = destinationJ + (deltaJ ?</span></span> <span data-ttu-id="95662-557">factorC) </span><span class="sxs-lookup"><span data-stu-id="95662-557">factorC)</span></span>

<span data-ttu-id="95662-558">其中：</span><span class="sxs-lookup"><span data-stu-id="95662-558">where:</span></span>

<span data-ttu-id="95662-559">minJ 是色域的最小 J 值。</span><span class="sxs-lookup"><span data-stu-id="95662-559">minJ is the minimum J-value of the gamut.</span></span>

<span data-ttu-id="95662-560">輸入色彩點的色度會以線性方式展開 () 盡可能地以最大程度的亮度與來源和目的地 gamuts 的最大色度值成正比，也就是色調和亮度。</span><span class="sxs-lookup"><span data-stu-id="95662-560">The chroma for input color points is expanded linearly (when possible) along constant lightness proportional to the maximum chroma value of the source and destination gamuts at that hue and lightness.</span></span> <span data-ttu-id="95662-561">相較于上述與色度相關的亮度壓縮，這有助於保留飽和度，因為使用參考點的切變對應有時候會導致來源點在色度中過度壓縮 (請參閱 [圖 16]) 。</span><span class="sxs-lookup"><span data-stu-id="95662-561">Combined with the preceding chroma-dependent lightness compression, this helps preserve the saturation because shear mapping using the reference points sometimes causes the source point to over-compress in chroma (see Figure 16).</span></span>

![顯示切變對應以符合色調參考點的圖表，位於左邊的切變之後，在右方的扭曲之後。](images/gmmp-shearmapping.png)

<span data-ttu-id="95662-563">**圖 16** ：切變對應、亮度壓縮到色調參考 J 和色度展開</span><span class="sxs-lookup"><span data-stu-id="95662-563">**Figure 16** : Shear mapping, lightness compression toward hue reference J, and chroma expansion</span></span>

<span data-ttu-id="95662-564">以下是色度擴充進程的數學描述，或調整目的地點的 C-值。</span><span class="sxs-lookup"><span data-stu-id="95662-564">The following is a mathematical description of the chroma expansion process, or adjusting the C-value of the destination point.</span></span> <span data-ttu-id="95662-565">它稱為「目的點」（destination point），因為它已經過扭曲對應，並已壓縮到目的範圍中。</span><span class="sxs-lookup"><span data-stu-id="95662-565">It is called the destination point because it has been shear mapped and lightness compressed into the destination gamut.</span></span>

1.  <span data-ttu-id="95662-566">在切變對應之前，請判斷 sourceExtentC 在來源點) 的亮度和色調 (的色度範圍。</span><span class="sxs-lookup"><span data-stu-id="95662-566">Before the shear mapping, determine sourceExtentC (the chroma extent at the lightness and hue of the source point).</span></span>
2.  <span data-ttu-id="95662-567">在將來源點轉換成目標點的切變地圖和亮度壓縮之後，請在目的地點) 的亮度和色調上判斷 destExtentC (的色度範圍。</span><span class="sxs-lookup"><span data-stu-id="95662-567">After the shear mapping and lightness compression which transforms the source point into the destination point, determine the destExtentC (the chroma extent at the lightness and hue of the destination point).</span></span>
3.  <span data-ttu-id="95662-568">如果 sourceExtentC 大於 destExtentC，就不需要對目的地點進行色度調整，而您可以略過下一個步驟。</span><span class="sxs-lookup"><span data-stu-id="95662-568">If the sourceExtentC is greater than the destExtentC, no chroma adjustment to the destination point is necessary, and you can skip the next step.</span></span>
4.  <span data-ttu-id="95662-569">調整 destinationC (目的地點的色度) ，以符合此亮度和色調的目的地色度範圍內。</span><span class="sxs-lookup"><span data-stu-id="95662-569">Adjust destinationC (the chroma of the destination point) to fit within the destination chroma extent at this lightness and hue.</span></span>
5.  <span data-ttu-id="95662-570">destinationC = destinationC？</span><span class="sxs-lookup"><span data-stu-id="95662-570">destinationC = destinationC ?</span></span> <span data-ttu-id="95662-571"> (destExtentC/sourceExtentC) </span><span class="sxs-lookup"><span data-stu-id="95662-571">(destExtentC / sourceExtentC)</span></span>

    <span data-ttu-id="95662-572">其中：</span><span class="sxs-lookup"><span data-stu-id="95662-572">where:</span></span>

    <span data-ttu-id="95662-573">destinationC 是目的地點 C-值。</span><span class="sxs-lookup"><span data-stu-id="95662-573">destinationC is the destination point C-value.</span></span>

    <span data-ttu-id="95662-574">sourceExtentC 是來源範圍的最大 C 值，以來源點的亮度和色調為限。</span><span class="sxs-lookup"><span data-stu-id="95662-574">sourceExtentC is the maximum C-value of the source gamut at the lightness and hue of the source point.</span></span>

    <span data-ttu-id="95662-575">destExtentC 是目的範圍的最大 C-值（以目標點的亮度和色調為限）。</span><span class="sxs-lookup"><span data-stu-id="95662-575">destExtentC is the maximum C-value of the destination gamut at the lightness and hue of the destination point.</span></span>

<span data-ttu-id="95662-576">最後，執行最低距離剪輯。</span><span class="sxs-lookup"><span data-stu-id="95662-576">Finally, perform the mimimum distance clipping.</span></span> <span data-ttu-id="95662-577">如果色調旋轉、亮度調整和切變對應輸入色彩仍稍微超出目的範圍，請將它 (移) 至目的地範圍界限的最接近點 (請參閱 [圖 17]) 。</span><span class="sxs-lookup"><span data-stu-id="95662-577">If the hue-rotated, lightness-adjusted, and shear-mapped input color is still slightly outside the destination gamut, clip it (move it) to the closest point on the destination gamut boundary (see Figure 17).</span></span>

![顯示最小距離裁剪的圖表。](images/gmmp-figure15.png)

<span data-ttu-id="95662-579">**圖 17** ：最短距離剪切</span><span class="sxs-lookup"><span data-stu-id="95662-579">**Figure 17** : Minimum distance clipping</span></span>

## <a name="gamut-boundary-description-and-gamut-shell-algorithms"></a><span data-ttu-id="95662-580">範圍界限描述和 Gamut Shell 演算法</span><span class="sxs-lookup"><span data-stu-id="95662-580">Gamut Boundary Description and Gamut Shell Algorithms</span></span>

<span data-ttu-id="95662-581">裝置範圍界限函式會使用裝置模型引擎和分析參數來衍生色彩裝置範圍界限，此界限會以裝置範圍的輪廓的索引頂點清單的形式來說明。</span><span class="sxs-lookup"><span data-stu-id="95662-581">The device gamut boundary function uses the device model engine and analytical parameters to derive a color device gamut boundary, described as an indexed vertex list of the hull of the device gamut.</span></span> <span data-ttu-id="95662-582">此輪廓的計算方式不同，取決於您使用的是裝置（例如監視器和投影機）或 subtractive 裝置。</span><span class="sxs-lookup"><span data-stu-id="95662-582">The hull is computed differently depending on whether you are working with additive devices, such as monitors and projectors, or subtractive devices.</span></span> <span data-ttu-id="95662-583">索引頂點清單會儲存在 CIEJab 中。</span><span class="sxs-lookup"><span data-stu-id="95662-583">The indexed vertex list is stored in CIEJab.</span></span> <span data-ttu-id="95662-584">已編制索引之頂點清單的結構已針對 DirectX 的硬體加速進行優化。</span><span class="sxs-lookup"><span data-stu-id="95662-584">The structure of the indexed vertex list is optimized for hardware acceleration by DirectX.</span></span>

<span data-ttu-id="95662-585">這種方法有許多知名的解決方案。</span><span class="sxs-lookup"><span data-stu-id="95662-585">This approach has many well-known solutions.</span></span> <span data-ttu-id="95662-586">如果您在網路上搜尋「凸殼 DirectX」，則會獲得超過100的點擊次數。</span><span class="sxs-lookup"><span data-stu-id="95662-586">If you search for "convex hull DirectX" on the Web, you get more than 100 hits.</span></span> <span data-ttu-id="95662-587">例如，在本主題中有1983的參考 (電腦圖形理論和應用程式、「Shiphulls、b 曲線表面和 cadcam」、「pp. 34-49) ，其中的參考可追溯從1970到1982。</span><span class="sxs-lookup"><span data-stu-id="95662-587">For example, there is a reference from 1983 on this specific topic (Computer Graphics Theory and Application, "Shiphulls, b-spline surfaces, and cadcam," pp. 34-49) with references dating from 1970 to 1982 on the topic.</span></span>

<span data-ttu-id="95662-588">您可以從外部的可用資訊判中斷點集合，如下所示：</span><span class="sxs-lookup"><span data-stu-id="95662-588">The collection of points can be determined from externally available information, as follows:</span></span>

-   <span data-ttu-id="95662-589">監視器的參考 shell 的點是使用裝置 colorant 空間中的色彩 cube 取樣來產生的。</span><span class="sxs-lookup"><span data-stu-id="95662-589">Points for the reference shell for monitors are generated using a sampling of the color cube in device colorant space.</span></span>
-   <span data-ttu-id="95662-590">印表機和 capture 裝置的參考 shell 的點是從用來初始化模型的範例資料取得。</span><span class="sxs-lookup"><span data-stu-id="95662-590">Points for the reference shell for printers and capture devices are obtained from the sample data used to initialize the model.</span></span>
-   <span data-ttu-id="95662-591">ScRGB 和 sRGB 的參考 shell 的點會使用 sRGB 的色彩 cube 取樣來產生。</span><span class="sxs-lookup"><span data-stu-id="95662-591">Points for the reference shell for scRGB and sRGB are generated using a sampling of the color cube for sRGB.</span></span>
-   <span data-ttu-id="95662-592">適用于 capture 裝置之合理 shell 的點會使用裝置 colorant 空間中的色彩 cube 取樣來產生。</span><span class="sxs-lookup"><span data-stu-id="95662-592">Points for the plausible shell for capture devices are generated using a sampling of the color cube in device colorant space.</span></span>
-   <span data-ttu-id="95662-593">投影機的參考 shell 的點是在裝置 colorant 空間的色彩 cube 中使用多面體取樣所產生。</span><span class="sxs-lookup"><span data-stu-id="95662-593">Points for the reference shell for projectors are generated using a sampling of a polyhedron in the color cube in device colorant space.</span></span>
-   <span data-ttu-id="95662-594">寬動態範圍色彩空間的可能 shell 的點會使用空間本身的色彩 cube 取樣來產生。</span><span class="sxs-lookup"><span data-stu-id="95662-594">Points for the possible shell for wide dynamic range color spaces are generated using a sampling of the color cube in the space itself.</span></span>

<span data-ttu-id="95662-595">如果有裝置設定檔和系統支援服務，您可以建立可有效率地描述色彩裝置範圍的頂點清單。</span><span class="sxs-lookup"><span data-stu-id="95662-595">You can create a vertex list that efficiently describes the color device gamut, given a device profile and system support services.</span></span>

<span data-ttu-id="95662-596">針對輸出裝置，範圍界限描述裝置可顯示的色彩範圍。</span><span class="sxs-lookup"><span data-stu-id="95662-596">For output devices, the gamut boundary describes the range of colors that can be displayed by the device.</span></span> <span data-ttu-id="95662-597">範圍界限是由用來建立裝置行為的相同資料所產生。</span><span class="sxs-lookup"><span data-stu-id="95662-597">A gamut boundary is generated from the same data used to model the behavior of the device.</span></span> <span data-ttu-id="95662-598">在概念上，您會輸出裝置可產生的色彩範圍取樣、測量色彩、將度量轉換成外觀空間，然後使用結果來建立範圍界限。</span><span class="sxs-lookup"><span data-stu-id="95662-598">Conceptually, you output a sampling of the range of colors the device can produce, measure the colors, convert the measurements into appearance space, and then use the results to create the gamut boundary.</span></span>

<span data-ttu-id="95662-599">輸入裝置更棘手。</span><span class="sxs-lookup"><span data-stu-id="95662-599">Input devices are trickier.</span></span> <span data-ttu-id="95662-600">輸入影像中的每個圖元都必須有一個值。</span><span class="sxs-lookup"><span data-stu-id="95662-600">Each pixel in an input image must have some value.</span></span> <span data-ttu-id="95662-601">每個圖元都必須能夠以某種方式來代表真實世界中找到的任何色彩。</span><span class="sxs-lookup"><span data-stu-id="95662-601">Each pixel must be able to represent any color found in the real world in some way.</span></span> <span data-ttu-id="95662-602">在這種情況下，輸入裝置不會有「超出範圍」的色彩，因為它們一律可以表示。</span><span class="sxs-lookup"><span data-stu-id="95662-602">In this sense, no colors are "out of gamut" for an input device, because they can always be represented.</span></span>

<span data-ttu-id="95662-603">所有數位影像格式都有固定的動態範圍。</span><span class="sxs-lookup"><span data-stu-id="95662-603">All digital image formats have some fixed dynamic range.</span></span> <span data-ttu-id="95662-604">由於這項限制，一律會有一些對應到相同數位值的相異刺激。</span><span class="sxs-lookup"><span data-stu-id="95662-604">Because of this limitation, there is always some distinct stimuli that map to the same digital value.</span></span> <span data-ttu-id="95662-605">因此，您無法在真實世界的色彩與數位相機值之間建立一對一的對應。</span><span class="sxs-lookup"><span data-stu-id="95662-605">So, you cannot establish a one-to-one mapping between real-world colors and digital camera values.</span></span> <span data-ttu-id="95662-606">相反地，範圍界限是藉由估計可產生相機數位回應的真實世界色彩來形成。</span><span class="sxs-lookup"><span data-stu-id="95662-606">Instead, the gamut boundary is formed by estimating a range of real-world colors that can produce the digital responses of the camera.</span></span> <span data-ttu-id="95662-607">您可以使用該估計範圍做為輸入裝置的範圍。</span><span class="sxs-lookup"><span data-stu-id="95662-607">You use that estimated range as the gamut for the input device.</span></span>

<span data-ttu-id="95662-608">提供主要複本是為了供應商務圖形意圖類型的 gamut 對應。</span><span class="sxs-lookup"><span data-stu-id="95662-608">Primaries are included to provide for business graphics intent-type gamut mapping.</span></span>

<span data-ttu-id="95662-609">在真正的物件導向樣式中，您可以抽象化範圍界限的基礎標記法。</span><span class="sxs-lookup"><span data-stu-id="95662-609">In true object-oriented style, you abstract the underlying representation of the gamut boundary.</span></span> <span data-ttu-id="95662-610">這可讓您彈性地變更未來的表示。</span><span class="sxs-lookup"><span data-stu-id="95662-610">This allows you the flexibility to change the representation in the future.</span></span> <span data-ttu-id="95662-611">若要瞭解新 CTE 中使用的範圍界限描述元 (GBD) ，您必須先瞭解 (GMAs) 如何運作的範圍對應演算法。</span><span class="sxs-lookup"><span data-stu-id="95662-611">To understand the gamut boundary descriptor (GBD) used in the new CTE, you must first understand how gamut mapping algorithms (GMAs) work.</span></span> <span data-ttu-id="95662-612">傳統上，GMAs 的設計是為了符合圖形藝術社區的需求;也就是說，若要重現已針對建立輸入映射的裝置正確轉譯的映射。</span><span class="sxs-lookup"><span data-stu-id="95662-612">Traditionally, GMAs have been designed to meet the needs of the graphic art community; that is, to reproduce images that have already been properly rendered for the device on which the input image was created.</span></span> <span data-ttu-id="95662-613">圖形藝術 GMAs 的目標是要在輸出裝置上盡可能地複製輸入影像。</span><span class="sxs-lookup"><span data-stu-id="95662-613">The goal of graphic arts GMAs is to make the best possible reproduction of the input image on the output device.</span></span> <span data-ttu-id="95662-614">新的 CTE GBD 的設計目的是要解決四個主要問題。</span><span class="sxs-lookup"><span data-stu-id="95662-614">The new CTE GBD is designed to solve four key problems.</span></span>

<span data-ttu-id="95662-615">由於輸入影像是針對輸入裝置轉譯，因此所有色彩都能容納在中型的白色點和黑色點之間的範圍內。</span><span class="sxs-lookup"><span data-stu-id="95662-615">Because the input image is rendered for the input device, all colors fit within the range between the medium's white point and black point.</span></span> <span data-ttu-id="95662-616">假設影像是場景的相片，其中有一個擴散白色，例如白色 t 恤的人，以及高光，例如反映視窗或 chrome 緩衝器的燈光。</span><span class="sxs-lookup"><span data-stu-id="95662-616">Suppose that the image is a photograph of a scene in which there is a diffuse white, such as a person in a white tee shirt, and a specular highlight, such as light reflecting off a window or chrome bumper.</span></span> <span data-ttu-id="95662-617">場景將會轉譯成輸入媒體，讓反射反白顯示對應到中型的白色點，而漫射白色則對應到與中型的白色點較暗的中性色彩。</span><span class="sxs-lookup"><span data-stu-id="95662-617">The scene will be rendered to the input medium so that the specular highlight is mapped to the medium's white point, and the diffuse white is mapped to some neutral color darker than the medium's white point.</span></span> <span data-ttu-id="95662-618">如何將色彩從場景對應到輸入媒體的選擇，是與場景相依的決策和美觀的決策。</span><span class="sxs-lookup"><span data-stu-id="95662-618">The choice of how to map colors from the scene to the input medium is both a scene-dependent decision and an aesthetic decision.</span></span> <span data-ttu-id="95662-619">如果原始場景中缺少高光，則擴散白色可能會對應到中型的白色點。</span><span class="sxs-lookup"><span data-stu-id="95662-619">If the specular highlight was missing from the original scene, then the diffuse white would probably be mapped to the medium's white point.</span></span> <span data-ttu-id="95662-620">在具有許多醒目提示詳細資料的場景中，會在高光和漫射白色之間留下更多範圍。</span><span class="sxs-lookup"><span data-stu-id="95662-620">In a scene with a lot of highlight detail, more range would be left between the specular white and the diffuse white.</span></span> <span data-ttu-id="95662-621">在反白顯示不重要的場景中，可能會留下極少的範圍。</span><span class="sxs-lookup"><span data-stu-id="95662-621">In a scene where the highlight is not significant, very little range might be left.</span></span>

<span data-ttu-id="95662-622">針對預先轉譯的影像，gamut 對應相當簡單。</span><span class="sxs-lookup"><span data-stu-id="95662-622">For pre-rendered images, gamut mapping is relatively straightforward.</span></span> <span data-ttu-id="95662-623">基本上，原始媒體的白色點會對應到重現媒體的白色點、來源黑色點會對應到目的黑色點，而大部分的對應都已完成。</span><span class="sxs-lookup"><span data-stu-id="95662-623">Basically, the original medium's white point is mapped to the reproduction medium's white point, the source black point is mapped to the destination black point, and most of the mapping is complete.</span></span> <span data-ttu-id="95662-624">不同的 GMAs 存在，可提供各種不同的方式來對應來源媒體的音調尺規上的其他點，以及處理超出範圍的色度值的不同方式。</span><span class="sxs-lookup"><span data-stu-id="95662-624">The different GMAs in existence provide variations for mapping other points on the source medium's tone scale and different ways to handle out-of-gamut chroma values.</span></span> <span data-ttu-id="95662-625">但是，在這些變化中，白色與白色與黑色之間的對應是一致的。</span><span class="sxs-lookup"><span data-stu-id="95662-625">But the mapping of white to white and black to black is consistent throughout these variations.</span></span> <span data-ttu-id="95662-626">這項實行需要將白色放在50的 J \* 和小於50的 j 下方的黑色 \* 。</span><span class="sxs-lookup"><span data-stu-id="95662-626">This implementation requires that white be above a J\* of 50 and black below a J\* of 50.</span></span>

<span data-ttu-id="95662-627">並非所有色彩編碼都限制輸入影像的色彩範圍。</span><span class="sxs-lookup"><span data-stu-id="95662-627">Not all color encodings limit color ranges for input images.</span></span> <span data-ttu-id="95662-628">IEC 標準色彩編碼 scRGB (IEC 61966-2-2) 為三個色頻（紅色、綠色和藍色 (RGB) ）提供16個位。</span><span class="sxs-lookup"><span data-stu-id="95662-628">The IEC standard color encoding scRGB (IEC 61966-2-2) provides 16 bits for each of the three color channels red, green, and blue (RGB).</span></span> <span data-ttu-id="95662-629">在該編碼中，參考黑色未編碼為 RGB 三 (0、0、0) ，但 (4096、4096、4096) 。</span><span class="sxs-lookup"><span data-stu-id="95662-629">In that encoding, reference black is not encoded as the RGB triple (0, 0, 0), but as (4096, 4096, 4096).</span></span> <span data-ttu-id="95662-630">參考白色的編碼方式為 (12288、12288、12288) 。</span><span class="sxs-lookup"><span data-stu-id="95662-630">Reference white is encoded as (12288, 12288, 12288).</span></span> <span data-ttu-id="95662-631">ScRGB 編碼可以用來表示高光和陰影詳細資料。</span><span class="sxs-lookup"><span data-stu-id="95662-631">The scRGB encoding can be used to represent specular highlights and shadow detail.</span></span> <span data-ttu-id="95662-632">它包含不太可能的 RGB 三合一，因為它們需要負面的光線，以及位於 CIE 光譜 locus 以外的編碼。</span><span class="sxs-lookup"><span data-stu-id="95662-632">It includes RGB triples that are not physically possible because they require negative amounts of light, and encodings that are outside the CIE spectral locus.</span></span> <span data-ttu-id="95662-633">很明顯地，沒有任何裝置可能會產生 scRGB 範圍中的所有色彩。</span><span class="sxs-lookup"><span data-stu-id="95662-633">Clearly, no device can possibly produce all the colors in the scRGB gamut.</span></span> <span data-ttu-id="95662-634">事實上，沒有任何裝置可以產生人們可以看到的所有色彩。</span><span class="sxs-lookup"><span data-stu-id="95662-634">In fact, no device can produce all the colors that a human being can see.</span></span> <span data-ttu-id="95662-635">因此，裝置無法填滿 scRGB 範圍，而且能夠代表它們所填滿的範圍部分會很有用。</span><span class="sxs-lookup"><span data-stu-id="95662-635">So, devices cannot fill the scRGB gamut, and it would be useful to be able to represent the part of the gamut that they do fill.</span></span> <span data-ttu-id="95662-636">每個裝置都有一個可產生的 scRGB 空間值範圍。</span><span class="sxs-lookup"><span data-stu-id="95662-636">Each device has a range of values in scRGB space that it can produce.</span></span> <span data-ttu-id="95662-637">這些是裝置的「預期」色彩;裝置產生此範圍以外的色彩可能會令人驚訝。</span><span class="sxs-lookup"><span data-stu-id="95662-637">These are the "expected" colors for the device; it would be surprising for the device to produce colors outside this gamut.</span></span> <span data-ttu-id="95662-638">有一個從 scRGB 空間到外觀空間的定義轉換，因此每個裝置也會有一系列的外觀值，而這些值應該會重現。</span><span class="sxs-lookup"><span data-stu-id="95662-638">There is a defined transformation from scRGB space to appearance space, so each device also has a range of appearance values that it is expected to reproduce.</span></span>

<span data-ttu-id="95662-639">在具有固定目標的「捕獲」裝置的 scRGB 和輸入中，可以取得超出預期值範圍的值。</span><span class="sxs-lookup"><span data-stu-id="95662-639">In both scRGB and input from capture devices characterized with a fixed target, it is possible to get a value outside the range of expected values.</span></span> <span data-ttu-id="95662-640">如果有人將攝影機校正至測試目標，然後，利用高光來捕捉場景，可能會有比目標的白色點更亮的圖元。</span><span class="sxs-lookup"><span data-stu-id="95662-640">If someone calibrates a camera to a test target; and then captures a scene with specular highlights, there might be pixels that are brighter than the target's white point.</span></span> <span data-ttu-id="95662-641">如果自然發生的紅色比目標紅色更彩色，則可能會發生相同的情況。</span><span class="sxs-lookup"><span data-stu-id="95662-641">The same thing can happen if a naturally occurring red is more chromatic than the target red.</span></span> <span data-ttu-id="95662-642">如果有人從裝置取得 scRGB 影像，然後手動編輯影像中的色彩，則可以建立落在裝置範圍的預期範圍之外的圖元，即使它們是在完整的 scRGB 範圍內也一樣。</span><span class="sxs-lookup"><span data-stu-id="95662-642">If someone takes an scRGB image from a device, and then manually edits the colors in the image, it is possible to create pixels that fall outside the expected range of the device gamut, even though they are within the full scRGB gamut.</span></span>

<span data-ttu-id="95662-643">第二個問題可能不會一開始就與此相關。</span><span class="sxs-lookup"><span data-stu-id="95662-643">A second problem may not, at first, seem to be related to this.</span></span> <span data-ttu-id="95662-644">當您使用色彩目標來描繪輸入裝置（例如相機或掃描器）的特性時，就會發生這種情況。</span><span class="sxs-lookup"><span data-stu-id="95662-644">It arises when you use a color target to characterize an input device, such as a camera or scanner.</span></span> <span data-ttu-id="95662-645">反射目標通常會在紙張上產生，並且包含一些彩色的修補程式。</span><span class="sxs-lookup"><span data-stu-id="95662-645">Reflective targets are typically produced on paper and contain a number of colored patches.</span></span> <span data-ttu-id="95662-646">Manufaturers 會在每個顏色修補程式的固定觀賞條件下，為資料檔案提供色彩度量。</span><span class="sxs-lookup"><span data-stu-id="95662-646">Manufaturers provide data files with color measurements taken under a fixed viewing condition for each color patch.</span></span> <span data-ttu-id="95662-647">色彩分析工具會建立這些測量值與裝置中的色彩感應器所傳回值之間的對應。</span><span class="sxs-lookup"><span data-stu-id="95662-647">Color profiling tools create a mapping between these measured values and the values returned by the color sensors in the devices.</span></span> <span data-ttu-id="95662-648">問題在於，這些色彩目標通常不涵蓋完整的裝置值範圍。</span><span class="sxs-lookup"><span data-stu-id="95662-648">The problem is that often these color targets do not cover the full range of device values.</span></span> <span data-ttu-id="95662-649">例如，掃描器或相機可能會傳回參考白色的 (253、253、253) 值，而參考紅色修補程式可能會有 (254、12、4) 的 RGB 值。</span><span class="sxs-lookup"><span data-stu-id="95662-649">For example, the scanner or camera might return a value of (253, 253, 253) for the reference white point, and a reference red patch might have an RGB value of (254, 12, 4).</span></span> <span data-ttu-id="95662-650">這些表示輸入裝置的預期值範圍（以目標值為基礎）。</span><span class="sxs-lookup"><span data-stu-id="95662-650">These represent the range of expected values for the input device, based on the target values.</span></span> <span data-ttu-id="95662-651">如果您根據目標的回應來描述輸入裝置的特性，則您只會預期此窄範圍內的色彩。</span><span class="sxs-lookup"><span data-stu-id="95662-651">If you characterize the input device based on the responses to the target, then you only expect colors within this narrow range.</span></span> <span data-ttu-id="95662-652">此範圍不僅小於人類可以看到的色彩範圍，也小於裝置可產生的色彩範圍。</span><span class="sxs-lookup"><span data-stu-id="95662-652">This range is not only smaller than the range of colors humans can see, it is smaller than the range of colors the device can produce.</span></span>

<span data-ttu-id="95662-653">在這兩種情況下，雖然參考範圍或度量存在，但很難預估輸入裝置或影像的範圍。</span><span class="sxs-lookup"><span data-stu-id="95662-653">In both cases, it is difficult to estimate the gamut of the input device or image, despite the existence of a reference gamut or measurements.</span></span> <span data-ttu-id="95662-654">第一個問題是，輸入裝置的合理範圍小於整個 scRGB 的範圍。</span><span class="sxs-lookup"><span data-stu-id="95662-654">In the first problem, the plausible gamut of the input device is less than the full gamut of scRGB.</span></span> <span data-ttu-id="95662-655">在第二個問題中，目標的參考範圍小於輸入裝置的完整可能範圍。</span><span class="sxs-lookup"><span data-stu-id="95662-655">In the second problem, the reference gamut of the target is less than the full possible gamut of the input device.</span></span>

<span data-ttu-id="95662-656">第三個問題牽涉到語氣對應。</span><span class="sxs-lookup"><span data-stu-id="95662-656">The third problem involves tone mapping.</span></span> <span data-ttu-id="95662-657">許多可充分代表圖形藝術中所使用預先轉譯影像的範圍界限模型，例如 Braun 和 Fairchild 山地範圍 GBD (Braun \[ 97 \]) ，以及 Morovic 的區段 Maxima 界限描述項 (Morovic \[ 98 \]) 。</span><span class="sxs-lookup"><span data-stu-id="95662-657">Many models of gamut boundaries that can adequately represent pre-rendered images used in the graphic arts have been proposed, for example, the Braun and Fairchild Mountain range GBD (Braun\[97\]), and Morovic's Segment Maxima boundary descriptor (Morovic\[98\]).</span></span> <span data-ttu-id="95662-658">但是這些模型只會提供裝置範圍極端的相關資訊;它們遺漏了色調對應中其他點的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="95662-658">But these models only provide information about the extremes of the device's gamut; they are missing information about other points in the tonal mapping.</span></span> <span data-ttu-id="95662-659">如果沒有這類資訊，GMAs 只會對最佳的色調對應進行粗略估計。</span><span class="sxs-lookup"><span data-stu-id="95662-659">Without such information, GMAs can only make rough estimates of optimal tone mapping.</span></span> <span data-ttu-id="95662-660">更糟的是，這些模型不會針對 scRGB 和數位相機影像中的延伸動態範圍提供協助。</span><span class="sxs-lookup"><span data-stu-id="95662-660">Worse, these models provide no help for the extended dynamic range in scRGB and in digital camera images.</span></span>

<span data-ttu-id="95662-661">這項問題在攝影和 videographic 產業中的解決方式為何？</span><span class="sxs-lookup"><span data-stu-id="95662-661">How is this problem resolved in the photographic and videographic industries?</span></span> <span data-ttu-id="95662-662">相機會捕捉映射。</span><span class="sxs-lookup"><span data-stu-id="95662-662">The camera captures an image.</span></span> <span data-ttu-id="95662-663">專家可能會爭論在捕獲裝置中發生多少轉譯;但他們同意它不是很大的數量。</span><span class="sxs-lookup"><span data-stu-id="95662-663">Experts might debate how much rendering occurs in the capture device; but they agree that it is not a significant amount.</span></span> <span data-ttu-id="95662-664">這兩種技術都不會將所捕捉場景中的擴散白色對應到中型的白色點。</span><span class="sxs-lookup"><span data-stu-id="95662-664">Both technologies do not map a diffuse white in a captured scene to the medium's white point.</span></span> <span data-ttu-id="95662-665">同樣地，它們也不會將場景的黑色點對應到中度的黑色點。</span><span class="sxs-lookup"><span data-stu-id="95662-665">Similarly, they do not map the black point from the scene to the medium's black point.</span></span> <span data-ttu-id="95662-666">使用特性曲線（通常稱為 Hurter 和 Driffield，或 H&D 曲線），會在密度空間中說明攝影電影的行為。</span><span class="sxs-lookup"><span data-stu-id="95662-666">The behavior of photographic film is described in density space using a characteristic curve, often called a Hurter and Driffield, or H&D curve.</span></span> <span data-ttu-id="95662-667">曲線會顯示原始場景的密度和電影上產生的密度。</span><span class="sxs-lookup"><span data-stu-id="95662-667">The curve shows the density of the original scene and the resulting density on the film.</span></span> <span data-ttu-id="95662-668">[圖 18] 顯示典型的 H&D 曲線。</span><span class="sxs-lookup"><span data-stu-id="95662-668">Figure 18 shows a typical H&D curve.</span></span> <span data-ttu-id="95662-669">X 軸代表增加記錄檔的風險。</span><span class="sxs-lookup"><span data-stu-id="95662-669">The x-axis represents increasing log exposure.</span></span> <span data-ttu-id="95662-670">Y 軸表示投影片上的密度。</span><span class="sxs-lookup"><span data-stu-id="95662-670">The y-axis represents the density on the slide.</span></span> <span data-ttu-id="95662-671">在曲線上標記五個參考點：黑色沒有詳細資料，代表負的最小密度;包含詳細資料的黑色;參考中間灰色卡片;包含詳細資料的白色而白色則沒有詳細資料。</span><span class="sxs-lookup"><span data-stu-id="95662-671">Five reference points are marked on the curve: black without detail, which represents the minimum density on the negative; black with detail; reference mid-gray card; white with detail; and white without detail.</span></span> <span data-ttu-id="95662-672">請注意，黑色之間沒有詳細的空格 (代表裝置黑色) 和黑色，以及 (陰影黑色) 的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="95662-672">Note that there is space between black without detail (which represents device black) and black with detail (shadow black).</span></span> <span data-ttu-id="95662-673">同樣地，白色與詳細 (擴散白色) 和白色沒有詳細 (代表裝置的白色) 。</span><span class="sxs-lookup"><span data-stu-id="95662-673">Similarly, there is space between white with detail (diffuse white) and white without detail (which represents device white).</span></span>

![顯示投影片之 H 和 D 曲線的圖表。](images/gmmp-image079.png)

<span data-ttu-id="95662-675">**圖 18** ：投影片的 H&D 曲線</span><span class="sxs-lookup"><span data-stu-id="95662-675">**Figure 18** : H&D curve for slide film</span></span>

<span data-ttu-id="95662-676">影片產業提供映射中的「空間」和「footroom」。</span><span class="sxs-lookup"><span data-stu-id="95662-676">The video industry provides "headroom" and "footroom" in images.</span></span> <span data-ttu-id="95662-677">在 ITU 709 規格中，名為 Y) 的亮度 (是以8位編碼，範圍為0到255。</span><span class="sxs-lookup"><span data-stu-id="95662-677">In the ITU 709 specification, luminance (called Y) is encoded in 8 bits, with a range of 0 to 255.</span></span> <span data-ttu-id="95662-678">不過，參考黑色的編碼是15，而參考白色則編碼為235。</span><span class="sxs-lookup"><span data-stu-id="95662-678">However, reference black is encoded at 15 and reference white is encoded as 235.</span></span> <span data-ttu-id="95662-679">這會讓編碼範圍介於236到255之間，以表示高光。</span><span class="sxs-lookup"><span data-stu-id="95662-679">This leaves the encoding range between 236 and 255 to represent specular highlights.</span></span>

<span data-ttu-id="95662-680">影片產業呈現基本上封閉的循環系統。</span><span class="sxs-lookup"><span data-stu-id="95662-680">The video industry presents an essentially closed loop system.</span></span> <span data-ttu-id="95662-681">雖然有許多不同的設備廠商，但影片系統是以參考裝置為基礎。</span><span class="sxs-lookup"><span data-stu-id="95662-681">While there are many different equipment vendors, video systems are based upon reference devices.</span></span> <span data-ttu-id="95662-682">影片影像有標準編碼。</span><span class="sxs-lookup"><span data-stu-id="95662-682">There is a standard encoding for video images.</span></span> <span data-ttu-id="95662-683">不需要與影片影像溝通範圍界限，因為所有影像都經過編碼，以在相同的參照裝置上重現。</span><span class="sxs-lookup"><span data-stu-id="95662-683">There is no need to communicate a gamut boundary with video images, because all images are encoded for reproduction on the same reference device.</span></span> <span data-ttu-id="95662-684">因為不需要在不同的元件之間傳遞中繼資料，所以電影也會關閉迴圈。</span><span class="sxs-lookup"><span data-stu-id="95662-684">Film is also closed loop because there is no need to convey intermediate data between different components.</span></span> <span data-ttu-id="95662-685">您想要使用不同 gamuts 的裝置來啟用影像的解決方案，並代表在具有不同 gamuts 的輸出上重現預先轉譯和 unrendered 的場景。</span><span class="sxs-lookup"><span data-stu-id="95662-685">You want a solution that enables images from devices with varying gamuts and representing both pre-rendered and unrendered scenes to be reproduced on output with varying gamuts.</span></span>

<span data-ttu-id="95662-686">新 CTE 必須解決的第四個問題，就是裝置產生的視覺灰色色彩（例如，當顯示器上的紅色 = 綠色 = 藍色時），通常不會落在色度 = 0.0) 時的凸輪 (中性軸。</span><span class="sxs-lookup"><span data-stu-id="95662-686">A fourth problem that the new CTE must resolve is that the visually gray colors produced by a device, for example, when red=green=blue on a monitor, frequently do not fall upon the neutral axis of the CAM (when the chroma = 0.0).</span></span> <span data-ttu-id="95662-687">這會造成 GMAs 的絕佳難題。</span><span class="sxs-lookup"><span data-stu-id="95662-687">This causes great difficulties for GMAs.</span></span> <span data-ttu-id="95662-688">若要讓 GMAs 正常運作，您必須調整裝置範圍和輸入點的描述，讓裝置的中性軸落在外觀空間的中性軸上。</span><span class="sxs-lookup"><span data-stu-id="95662-688">To make GMAs work well, you have to adjust the description of the device's gamut and of the input points so that the device's neutral axis falls on the appearance space's neutral axis.</span></span> <span data-ttu-id="95662-689">您必須以類似的數量來調整中性軸的點。</span><span class="sxs-lookup"><span data-stu-id="95662-689">You have to adjust points off the neutral axis by a similar amount.</span></span> <span data-ttu-id="95662-690">否則，您無法透過影像進行平滑的進行。</span><span class="sxs-lookup"><span data-stu-id="95662-690">Otherwise, you cannot make smooth gradations through the image.</span></span> <span data-ttu-id="95662-691">從 GMA 之後，您可以復原相對於輸出裝置中性軸的對應。</span><span class="sxs-lookup"><span data-stu-id="95662-691">On the way out of the GMA, you undo this mapping, relative to the output device's neutral axis.</span></span> <span data-ttu-id="95662-692">這稱為軸的「chiropractic」伸直。</span><span class="sxs-lookup"><span data-stu-id="95662-692">This is referred to as a "chiropractic" straightening of the axis.</span></span> <span data-ttu-id="95662-693">如同 chiropractor，您不只會將基本架構 (中性軸) ，還可以調整主體的其餘部分，以隨著基本架構一起移動。</span><span class="sxs-lookup"><span data-stu-id="95662-693">Like a chiropractor, you not only straighten the skeleton (neutral axis), but you adjust the rest of the body to move along with the skeleton.</span></span> <span data-ttu-id="95662-694">如同 chiropractor，您不會透過整個空間調整相同數量的基本架構。</span><span class="sxs-lookup"><span data-stu-id="95662-694">Like a chiropractor, you do not adjust the skeleton by the same amount through the entire space.</span></span> <span data-ttu-id="95662-695">相反地，您會以不同的方式調整不同的區段。</span><span class="sxs-lookup"><span data-stu-id="95662-695">Instead, you adjust different sections differently.</span></span>

![此圖顯示相對於 CIECAM 中性軸的裝置中性軸曲率。](images/gmmp-image081.png)

<span data-ttu-id="95662-697">**圖19：** 相對於 CIECAM 中性軸的裝置中性軸曲率</span><span class="sxs-lookup"><span data-stu-id="95662-697">**Figure 19:** Curvature of the device neutral axis relative to the CIECAM neutral axis</span></span>

<span data-ttu-id="95662-698">新的 CTE 所需的是範圍界限模型，可用來表示轉譯和 unrendered 來源影像、提供裝置 neutrals 外觀的相關資訊，以及提供具有寬亮度範圍之音調地圖影像的資訊。</span><span class="sxs-lookup"><span data-stu-id="95662-698">What the new CTE requires is a model of a gamut boundary that can be used to represent both rendered and unrendered source images, provide information about the appearance of device neutrals, and provide information for tone mapping images with a wide luminance range.</span></span>

![顯示三個 gamut shell 的圖表。](images/gmmp-image083.png)

<span data-ttu-id="95662-700">**圖 20** ：三個 gamut shell</span><span class="sxs-lookup"><span data-stu-id="95662-700">**Figure 20** : Three gamut shells</span></span>

<span data-ttu-id="95662-701">範圍界限是由三個定義三個區域的 shell 所組成。</span><span class="sxs-lookup"><span data-stu-id="95662-701">The gamut boundary is composed of three shells that define three regions.</span></span>

<span data-ttu-id="95662-702">在新的 CTE 中，範圍的外部 shell 會以裝置範圍中範例點所建立的凸殼形成。</span><span class="sxs-lookup"><span data-stu-id="95662-702">In the new CTE, the outer shell of the gamut is formed with a convex hull made from sample points in the device gamut.</span></span> <span data-ttu-id="95662-703">輪廓的組成方式是採用一組範例點，並將其圍繞在介面周圍。</span><span class="sxs-lookup"><span data-stu-id="95662-703">A hull is formed by taking a set of sample points and surrounding them by a surface.</span></span> <span data-ttu-id="95662-704">凸殼的其他屬性則是凸形。</span><span class="sxs-lookup"><span data-stu-id="95662-704">A convex hull has the additional property of being convex everywhere.</span></span> <span data-ttu-id="95662-705">因此，這不是可符合資料的最小可能的輪廓。</span><span class="sxs-lookup"><span data-stu-id="95662-705">Therefore, this is not the smallest possible hull that can be fit to the data.</span></span> <span data-ttu-id="95662-706">但是測試已顯示，將範例點調整得太緊密會導致影像中的 unappealing 構件，例如缺乏平滑陰影。</span><span class="sxs-lookup"><span data-stu-id="95662-706">But experimentation has shown that fitting the sample points too tightly causes unappealing artifacts in images, such as a lack of smooth shading.</span></span> <span data-ttu-id="95662-707">凸殼似乎可解決這些問題。</span><span class="sxs-lookup"><span data-stu-id="95662-707">The convex hull seems to solve these problems.</span></span>

<span data-ttu-id="95662-708">在演算法中，會為從裝置取樣的一組點取得色彩外觀值。</span><span class="sxs-lookup"><span data-stu-id="95662-708">In the algorithm, color appearance values are obtained for a set of points sampled from the device.</span></span> <span data-ttu-id="95662-709">針對監視器和印表機，色彩外觀值是藉由輸出樣本來取得，然後加以測量。</span><span class="sxs-lookup"><span data-stu-id="95662-709">For monitors and printers, the color appearance values are obtained by outputting samples, and then measuring them.</span></span> <span data-ttu-id="95662-710">您也可以建立裝置型號，然後透過裝置模型執行綜合資料來預測測量的值。</span><span class="sxs-lookup"><span data-stu-id="95662-710">You can also create a device model, and then run synthetic data through the device model to predict measured values.</span></span> <span data-ttu-id="95662-711">然後，測量的值會從色度空間 (XYZ) 轉換為外觀空間 (Jab) ，且輪廓會包裝在各點周圍。</span><span class="sxs-lookup"><span data-stu-id="95662-711">The measured values are then converted from colorimetric space (XYZ) to appearance space (Jab), and the hull is wrapped around the points.</span></span>

<span data-ttu-id="95662-712">這種演算法的關鍵點是，從色度轉換成外觀空間所使用的採用的白色點，不一定是中型的白色點。</span><span class="sxs-lookup"><span data-stu-id="95662-712">The key point to this algorithm is that the adopted white point used in the conversion from colorimetric to appearance space does not have to be the medium's white point.</span></span> <span data-ttu-id="95662-713">相反地，您可以選取範圍內的某個點，並在 (或附近) 中性軸。</span><span class="sxs-lookup"><span data-stu-id="95662-713">Instead, you can select a point farther inside the gamut and on (or near) the neutral axis.</span></span> <span data-ttu-id="95662-714">然後該點會有一個 J-值100。</span><span class="sxs-lookup"><span data-stu-id="95662-714">That point will then have a J-value of 100.</span></span> <span data-ttu-id="95662-715">測量的 Y 值高於採用的白色點的樣本最後會有大於100的 J 值。</span><span class="sxs-lookup"><span data-stu-id="95662-715">Samples with a measured Y-value higher than the adopted white point will end up with a J-value greater than 100.</span></span>

<span data-ttu-id="95662-716">如果您將場景的擴散白色點放置為色彩空間轉換的採用白色點，場景中的高光將可輕易地偵測為具有大於100的 J 值。</span><span class="sxs-lookup"><span data-stu-id="95662-716">If you place the scene's diffuse white point as the adopted white point for the color space conversion, then specular highlights in the scene will be easily detected as having a J-value greater than 100.</span></span>

<span data-ttu-id="95662-717">由於 CIECAM02 色彩模型是以「人為視覺」系統為基礎，因此選取了 [採用的白色] 之後，該模型會自動決定黑色點 (J = 0) 的亮度層級。</span><span class="sxs-lookup"><span data-stu-id="95662-717">Because the CIECAM02 color model is based on the human visual system, after an adopted white is selected, the luminance level of the black point (J = 0) is automatically determined by the model.</span></span> <span data-ttu-id="95662-718">如果輸入影像有寬動態範圍，可能會有對應至 J 值小於零的值。</span><span class="sxs-lookup"><span data-stu-id="95662-718">If the input image has a wide dynamic range, it is possible that there might be values that map to J-values less than zero.</span></span>

<span data-ttu-id="95662-719">下圖21顯示透過合理和參考 gamuts 的中心執行的裝置 neutrals。</span><span class="sxs-lookup"><span data-stu-id="95662-719">The following Figure 21 shows the device neutrals running through the center of the plausible and reference gamuts.</span></span>

![顯示新增至範圍界限之裝置中性軸的圖表。](images/gmmp-image085.png)

<span data-ttu-id="95662-721">**圖 21** ：新增至 gamut 界限的裝置中性軸</span><span class="sxs-lookup"><span data-stu-id="95662-721">**Figure 21** : Device neutral axis added to gamut boundary</span></span>

<span data-ttu-id="95662-722">所有的 gamut 對應都牽涉到將輸入範圍裁剪至輸出範圍，或將輸入範圍壓縮以符合輸出範圍。</span><span class="sxs-lookup"><span data-stu-id="95662-722">All gamut mappings involve either clipping an input range to an output gamut, or compressing the input gamut to fit within the output gamut.</span></span> <span data-ttu-id="95662-723">更複雜的演算法會以不同的方向進行壓縮和裁剪，或將範圍分成不同的區域，然後在不同區域中執行裁剪或壓縮來形成更複雜的演算法。</span><span class="sxs-lookup"><span data-stu-id="95662-723">More complex algorithms are formed by compressing and clipping in different directions, or by dividing the gamut into different regions, and then performing clipping or compression in the different regions.</span></span>

<span data-ttu-id="95662-724">新的 CTE 會擴充這個概念，以支援可能的範圍、合理範圍和參考範圍的區域，並讓 GMAs 以不同的方式對應它們。</span><span class="sxs-lookup"><span data-stu-id="95662-724">The new CTE extends this concept to support the regions of a possible gamut, a plausible gamut, and a reference gamut, and enables GMAs to map them in different ways.</span></span> <span data-ttu-id="95662-725">此外，GMAs 還具有裝置中立軸的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="95662-725">In addition, the GMAs have information about the device neutral axis.</span></span> <span data-ttu-id="95662-726">下列討論說明如何處理合理 gamuts 和 reference gamuts 已彼此折迭的情況。</span><span class="sxs-lookup"><span data-stu-id="95662-726">The following discussion addresses how to handle situations where the plausible gamuts and reference gamuts have collapsed on each other.</span></span>

![顯示具有兩個未折迭範圍描述元之 G M A 的圖表。](images/gmmp-image091.png)

<span data-ttu-id="95662-728">**圖 22** ：使用兩個未折迭的 gamut 描述元的 GMA</span><span class="sxs-lookup"><span data-stu-id="95662-728">**Figure 22** : GMA with two un-collapsed gamut descriptors</span></span>

<span data-ttu-id="95662-729">如果您從輸入裝置（例如，具有反射目標的相機或掃描器）對應到 scRGB 空間，您可能會看到此範例。</span><span class="sxs-lookup"><span data-stu-id="95662-729">You might see this example if you map from an input device, such as a camera or scanner that is characterized with a reflective target, to scRGB space.</span></span> <span data-ttu-id="95662-730">在此，比參考白色更淺的合理色彩會顯示為高光。</span><span class="sxs-lookup"><span data-stu-id="95662-730">Here the plausible colors that are lighter than reference white are specular highlights.</span></span> <span data-ttu-id="95662-731">在實務上，將具有目標的相機特性描述可能不會產生相機中可能的完整值範圍;不過，本質上會有高光和很彩色的色彩。</span><span class="sxs-lookup"><span data-stu-id="95662-731">In practice, characterizing a camera with a target might not generate the full range of values possible in the camera; however, specular highlights and very chromatic colors found in nature would.</span></span> <span data-ttu-id="95662-732"> (Transmissive 目標通常會有一個修補程式，也就是媒體上可能最小的密度。</span><span class="sxs-lookup"><span data-stu-id="95662-732">(Transmissive targets usually have a patch that is the minimum density possible on the medium.</span></span> <span data-ttu-id="95662-733">使用這種目標時，高光會落在目標範圍內。 ) 反射目標的黑色參考會是陰影黑色區域的開頭。</span><span class="sxs-lookup"><span data-stu-id="95662-733">With such a target, specular highlights would fall within the target's range.) The reference black for a reflective target would be the beginning of the shadow black region.</span></span> <span data-ttu-id="95662-734">也就是說，陰影中的色彩可能會比目標上的黑色深。</span><span class="sxs-lookup"><span data-stu-id="95662-734">That is, there are likely to be colors in the shadows that are darker than the black on the target.</span></span> <span data-ttu-id="95662-735">如果影像在該區域中包含許多有趣的內容，則可能需要保留該色調的變化。</span><span class="sxs-lookup"><span data-stu-id="95662-735">If the image contains a lot of interesting content in that region, it may be worthwhile preserving that tonal variation.</span></span>

![顯示具有折迭目的範圍之 G M A 的圖表。](images/gmmp-image095.png)

<span data-ttu-id="95662-737">**圖 23** ：具有折迭目的範圍的 GMA</span><span class="sxs-lookup"><span data-stu-id="95662-737">**Figure 23** : GMA with collapsed destination gamut</span></span>

<span data-ttu-id="95662-738">[圖 23] 顯示一個可能的範圍對應演算法（當目的地範圍只提供從裝置白色到黑色的範圍），而且此範圍外沒有可能的色彩。</span><span class="sxs-lookup"><span data-stu-id="95662-738">Figure 23 shows one possible gamut mapping algorithm when the destination gamut only provides the range from device white to black, and there are no possible colors outside this gamut.</span></span> <span data-ttu-id="95662-739">一般輸出裝置（如印表機）可能會發生這種情況。</span><span class="sxs-lookup"><span data-stu-id="95662-739">This is likely to happen for typical output devices, such as printers.</span></span> <span data-ttu-id="95662-740">可能的色彩會對應到目的範圍的邊緣。</span><span class="sxs-lookup"><span data-stu-id="95662-740">The possible colors are mapped to the edge of the destination gamut.</span></span> <span data-ttu-id="95662-741">但它缺少輸出裝置的音訊曲線。</span><span class="sxs-lookup"><span data-stu-id="95662-741">But it lacks a tone curve for the output device.</span></span> <span data-ttu-id="95662-742">GMA 必須選取一些較低亮度的中性點，才能用來作為參考白色的對應目的地。</span><span class="sxs-lookup"><span data-stu-id="95662-742">The GMA must select some neutral point of lower luminance to use as a mapping destination for the reference white.</span></span> <span data-ttu-id="95662-743">精密的演算法是藉由 histogramming 來源影像中的 lightnesses，並查看預期的範圍中有多少落在參考白色的範圍內，來達成這個目的。</span><span class="sxs-lookup"><span data-stu-id="95662-743">A sophisticated algorithm can do this by histogramming the lightnesses in the source image and seeing how many fall in the range of expected but lighter than the reference white.</span></span> <span data-ttu-id="95662-744">更 lightnesses 的是，在反射反白顯示和參考白色的對應點之間，目的地裝置需要更多的空間。</span><span class="sxs-lookup"><span data-stu-id="95662-744">The more lightnesses, the more space is required in the destination device between the mapped points for the specular highlights and reference white.</span></span> <span data-ttu-id="95662-745">較簡單的演算法可能會從裝置白色挑選任意距離的亮度尺規，例如5%。</span><span class="sxs-lookup"><span data-stu-id="95662-745">A simpler algorithm might pick an arbitrary distance down the lightness scale from device white, such as 5 percent.</span></span> <span data-ttu-id="95662-746">類似的方法適用于最大的黑色和陰影黑色的對應。</span><span class="sxs-lookup"><span data-stu-id="95662-746">A similar approach applies for the mapping of the maximum black and shadow black.</span></span>

<span data-ttu-id="95662-747">當您產生目的地語氣曲線之後，您可以在類似于上圖23所使用的方法中進行對應。</span><span class="sxs-lookup"><span data-stu-id="95662-747">After you generate the destination tone curve, you can map in a method similar to that used in the preceding Figure 23.</span></span> <span data-ttu-id="95662-748">目的地語氣曲線中的所有點都將落在裝置範圍內，而且對應中的所有點都必須落在裝置範圍內。</span><span class="sxs-lookup"><span data-stu-id="95662-748">All points in the destination tone curve will fall within the device gamut, and all points in the mapping must fall within the device gamut.</span></span>

<span data-ttu-id="95662-749">如果您反轉左邊的數位和右圖，以及 [圖 23] 中箭號的方向，則可以描述來源影像只有參考範圍的情況，而且輸出裝置的三個 gamuts 尚未折迭。</span><span class="sxs-lookup"><span data-stu-id="95662-749">If you reverse the left figures and right figures, and the directions of the arrows in Figure 23, you can describe the case where the source image has only a reference gamut, and the three gamuts of the output device have not collapsed onto each other.</span></span> <span data-ttu-id="95662-750">這可能是從監視器對應到 scRGB 的範例。</span><span class="sxs-lookup"><span data-stu-id="95662-750">An example of this might be mapping from a monitor to scRGB.</span></span> <span data-ttu-id="95662-751">同樣地，您必須在來源影像的色調曲線上合成五點的控制點。</span><span class="sxs-lookup"><span data-stu-id="95662-751">Again, the GMA must synthesize the control points for the five points on the tone curve for the source image.</span></span> <span data-ttu-id="95662-752">某些對應可能會將語氣曲線的所有點放在 scRGB 裝置範圍內，而其他對應可能會使用更多的 scRGB 範圍，方法是將擴散白色對應到參考白色，並允許反射白色對應到較淺的值。</span><span class="sxs-lookup"><span data-stu-id="95662-752">Some mappings might put all points of the tone curve within the scRGB device gamut, while other mappings might use more of the scRGB gamut by mapping diffuse white to the reference white and allowing specular white to map to a lighter value.</span></span>

<span data-ttu-id="95662-753">最後，您會有兩個裝置只有參考範圍的情況，也就是最多範圍對應演算法的運作方式。</span><span class="sxs-lookup"><span data-stu-id="95662-753">Finally, you have the case where both devices have only the reference gamut, which is how most gamut mapping algorithms work.</span></span> <span data-ttu-id="95662-754">因此只要回到目前的演算法，就可以解決這個問題。</span><span class="sxs-lookup"><span data-stu-id="95662-754">So you can resolve this by just falling back to current algorithms.</span></span> <span data-ttu-id="95662-755">或者，如果您有合理的方式來判斷來源和目的地裝置的五個參考點，則可以排列以對應參考點。</span><span class="sxs-lookup"><span data-stu-id="95662-755">Alternatively, if you have a reasonable way to determine the five reference points for the source and destination devices, then you can arrange to map the reference points.</span></span>

<span data-ttu-id="95662-756">裝置 gamuts 在中性軸上包含五個以上的參考點。</span><span class="sxs-lookup"><span data-stu-id="95662-756">Device gamuts contain more than the five reference points on the neutral axis.</span></span> <span data-ttu-id="95662-757">這些只代表影像中可能區域之間的界限。</span><span class="sxs-lookup"><span data-stu-id="95662-757">These just represent the boundaries between potential regions in the image.</span></span> <span data-ttu-id="95662-758">在每個參考點之間，您可以使用任何現有的 gamut 對應技術。</span><span class="sxs-lookup"><span data-stu-id="95662-758">Between each of the reference points, you can use any of the existing gamut mapping techniques.</span></span> <span data-ttu-id="95662-759">因此，您可能會裁剪非預期的色彩範圍，並在預期的白色與黑色之間壓縮所有色彩，或是將所有色彩裁剪到參考範圍之外，並在該範圍內壓縮。</span><span class="sxs-lookup"><span data-stu-id="95662-759">So you might clip the range of unexpected colors, and compress all colors between the expected white and black, or you might clip all colors outside the reference range and compress within that range.</span></span> <span data-ttu-id="95662-760">有許多可能性可在不同的 GMAs 中執行。</span><span class="sxs-lookup"><span data-stu-id="95662-760">There are many possibilities, which can be implemented in different GMAs.</span></span> <span data-ttu-id="95662-761">此外，GMAs 可以不同的方式進行壓縮和剪輯。</span><span class="sxs-lookup"><span data-stu-id="95662-761">Further, the GMAs can compress and clip in different ways.</span></span> <span data-ttu-id="95662-762">這些組合全都涵蓋在此發明中。</span><span class="sxs-lookup"><span data-stu-id="95662-762">All of those combinations are covered within this invention.</span></span>

<span data-ttu-id="95662-763">到目前為止，在此討論中，已將範圍視為只是建立、捕獲或顯示映射的裝置功能。</span><span class="sxs-lookup"><span data-stu-id="95662-763">So far in this discussion, the gamut has been treated as if it were solely a function of the device on which the image was created, captured, or displayed.</span></span> <span data-ttu-id="95662-764">不過，裝置的所有映射都必須有相同的範圍，因此沒有原因。</span><span class="sxs-lookup"><span data-stu-id="95662-764">However, there is no reason why all images for a device must have the same gamut.</span></span> <span data-ttu-id="95662-765">GMAs 取決於 GBD 中的資料。</span><span class="sxs-lookup"><span data-stu-id="95662-765">The GMAs depend on the data in the GBD.</span></span> <span data-ttu-id="95662-766">如果映射之間的描述元有所變更，GMAs 就沒有辦法知道。</span><span class="sxs-lookup"><span data-stu-id="95662-766">If the descriptor is changed between images, there is no way for the GMAs to know.</span></span> <span data-ttu-id="95662-767">尤其是，如果影像沒有高光，則如果範圍描述項沒有顯示比擴散白色更淺的色彩，GMAs 執行得更好。</span><span class="sxs-lookup"><span data-stu-id="95662-767">In particular, if images have no specular highlights, GMAs perform better if the gamut descriptor does not show that there are colors lighter than diffuse white.</span></span>

<span data-ttu-id="95662-768">在新的 CTE 架構中，您可以使用一個以上的 GMA。</span><span class="sxs-lookup"><span data-stu-id="95662-768">In the new CTE architecture, it is possible to use more than one GMA.</span></span> <span data-ttu-id="95662-769">本質上，使用多個 GMAs 的定義錯誤。</span><span class="sxs-lookup"><span data-stu-id="95662-769">Using multiple GMAs is inherently ill-defined.</span></span> <span data-ttu-id="95662-770">比方說，如果捕捉裝置將 GMA 與其「外觀及操作」建立關聯，則它通常會使用「目標」目的地範圍來完成。</span><span class="sxs-lookup"><span data-stu-id="95662-770">For example, if a capture device associates a GMA with its "look and feel," it tends to do so with a "targeted" destination gamut.</span></span> <span data-ttu-id="95662-771">輸出裝置和「目標」來源 gamuts 也是如此。</span><span class="sxs-lookup"><span data-stu-id="95662-771">The same is true for output devices and "targeted" source gamuts.</span></span> <span data-ttu-id="95662-772">SRGB 範圍是一個經常被鎖定的隱含範圍。</span><span class="sxs-lookup"><span data-stu-id="95662-772">The sRGB gamut is one commonly targeted implied gamut.</span></span> <span data-ttu-id="95662-773">因此，強烈建議您使用單一的 GMA （如果可預測性為優先）。</span><span class="sxs-lookup"><span data-stu-id="95662-773">Therefore, it is strongly recommended that you use a single GMA, if predictability is a priority.</span></span> <span data-ttu-id="95662-774">單一的 GMA 工作流程應該是所有工作流程的預設值，特別是取用者和 prosumer 工作流程。</span><span class="sxs-lookup"><span data-stu-id="95662-774">A single GMA workflow should be the default for all workflows, especially consumer and prosumer workflows.</span></span> <span data-ttu-id="95662-775">雖然偏好複製的 gamut 對應應該執行一次，但有多個對應程式都包含在其中。</span><span class="sxs-lookup"><span data-stu-id="95662-775">While gamut mapping for preferred reproduction should be done one time, there are instances where multiple mapping processes are included.</span></span> <span data-ttu-id="95662-776">首先，為了進行校對，您可以對最終目標裝置的範圍進行慣用的對應，然後再以濃度轉譯至校對裝置的範圍。</span><span class="sxs-lookup"><span data-stu-id="95662-776">First, for proofing, you do a preferred mapping to the gamut of the final target device, and then a colorimetric rendering to the gamut of the proofing device.</span></span> <span data-ttu-id="95662-777">其次，某些類型的對應會用來改變影像的特性，但不會包含在對應至裝置範圍（例如，調整色調曲線或 chromaticity）。</span><span class="sxs-lookup"><span data-stu-id="95662-777">Second, some types of mapping are used to alter the characteristics of the image, but aren't included to map to a device gamut, for example, adjusting the tone curve or the chromaticity.</span></span> <span data-ttu-id="95662-778">如果使用多個 GMAs，則轉換介面會採用系結的 gamut 對應陣列，也就是已使用一對範圍界限描述初始化的 gamut 對應。</span><span class="sxs-lookup"><span data-stu-id="95662-778">If multiple GMAs are used, the transform interface takes an array of bound gamut maps, that is, gamut maps that have been initialized with a pair of gamut boundary descriptions.</span></span> <span data-ttu-id="95662-779">當有多個範圍對應時，後續 gamut 對應的輸入範圍界限必須和其前置項的輸出 gamut 界限相同。</span><span class="sxs-lookup"><span data-stu-id="95662-779">When there is more than one gamut map, the input gamut boundary for a succeeding gamut map must be the same as the output gamut boundary of its predecessor.</span></span>

<span data-ttu-id="95662-780">裝置範圍界限函式會採用裝置模型引擎和分析參數，並衍生色彩裝置範圍界限，此界限描述為裝置範圍之凸殼的排序頂點清單。</span><span class="sxs-lookup"><span data-stu-id="95662-780">The device gamut boundary function takes the device model engine and analytical parameters and derives a color device gamut boundary described as an ordered vertex list of the convex hull of the device gamut.</span></span> <span data-ttu-id="95662-781">已排序的頂點清單會儲存在 CIEJab 中。</span><span class="sxs-lookup"><span data-stu-id="95662-781">The ordered vertex list is stored in CIEJab.</span></span> <span data-ttu-id="95662-782">已排序頂點清單的結構已針對 DirectX 優化硬體加速。</span><span class="sxs-lookup"><span data-stu-id="95662-782">The structure of the ordered vertex list is optimized for hardware acceleration by DirectX.</span></span> <span data-ttu-id="95662-783">這種方法有許多知名的解決方案 (在網路上搜尋「凸殼 DirectX」，而您可以) 獲得超過100的點擊。</span><span class="sxs-lookup"><span data-stu-id="95662-783">This approach has many well known solutions (search for "convex hull DirectX" on the web and you get well over 100 hits).</span></span> <span data-ttu-id="95662-784">本主題也有1983的參考 (電腦圖形理論和應用程式、「Shiphulls、b 曲線表面和 cadcam」 pp 34-49) ，以及主題的參考可追溯從1970到1982。</span><span class="sxs-lookup"><span data-stu-id="95662-784">There is also a reference from 1983 on this topic (Computer Graphics Theory and Application, "Shiphulls, b-spline surfaces and cadcam" pp. 34-49), with references dating from 1970 to 1982 on the topic.</span></span>

<span data-ttu-id="95662-785">您可以使用兩種不同的技術來計算 gamut shell 中的三角形。</span><span class="sxs-lookup"><span data-stu-id="95662-785">Two different techniques can be used to compute the triangles in the gamut shell.</span></span> <span data-ttu-id="95662-786">針對加法 RGB 裝置以外的其他裝置，您可以計算凸殼。</span><span class="sxs-lookup"><span data-stu-id="95662-786">For other devices other than additive RGB devices, you compute a convex hull.</span></span> <span data-ttu-id="95662-787">如果您可以直接存取這類裝置來驗證演算法的可靠性、效能和精確度，則可以考慮調查其他裝置的非凸殼支援。</span><span class="sxs-lookup"><span data-stu-id="95662-787">You can consider investigating non-convex hull support for other devices if you have direct access to such devices to validate the robustness, performance, and fidelity of the algorithms.</span></span> <span data-ttu-id="95662-788">這是已知的進程，不需要進一步的說明。</span><span class="sxs-lookup"><span data-stu-id="95662-788">This is a well-known process that does not require further description.</span></span> <span data-ttu-id="95662-789">用於加法 RGB 裝置的技術如下所述。</span><span class="sxs-lookup"><span data-stu-id="95662-789">The technique used for additive RGB devices is described as follows.</span></span>

<span data-ttu-id="95662-790">不同的 GBDs 有其優點和缺點。</span><span class="sxs-lookup"><span data-stu-id="95662-790">Different GBDs have advantages and drawbacks.</span></span> <span data-ttu-id="95662-791">凸殼標記法可保證美觀的幾何屬性，例如凸色調配量，可提供唯一的交集點，並從中性軸上的點 mouseleave 光線。</span><span class="sxs-lookup"><span data-stu-id="95662-791">The convex hull representation guarantees nice geometric properties, such as convex hue slices that provide a unique intersection point with a ray emanating from a point on the neutral axis.</span></span> <span data-ttu-id="95662-792">凸殼標記法的缺點也是凸凸。</span><span class="sxs-lookup"><span data-stu-id="95662-792">The downside of the convex hull representation is also convexity.</span></span> <span data-ttu-id="95662-793">您知道有許多裝置（特別是顯示裝置）都有遠不是凸的 gamuts。</span><span class="sxs-lookup"><span data-stu-id="95662-793">It is known that many devices, specifically display devices, have gamuts that are far from being convex.</span></span> <span data-ttu-id="95662-794">如果實際的範圍偏離凸假設，則凸殼標記法可能會不正確，可能會是不代表實際的程度。</span><span class="sxs-lookup"><span data-stu-id="95662-794">If the actual gamut deviates significantly from the convexity assumption, the convex hull representation would be inaccurate, possibly to the extent that it doesn't represent reality.</span></span>

<span data-ttu-id="95662-795">在您採用可提供精確的實際範圍標記法的 GBD 之後，就會發生其他問題，因為色調配量的概念很高。</span><span class="sxs-lookup"><span data-stu-id="95662-795">After you adopt a GBD that gives a reasonably accurate representation of the actual gamut, other problems arise, some due to the very concept of hue slice.</span></span> <span data-ttu-id="95662-796">至少有兩個異常的情況。</span><span class="sxs-lookup"><span data-stu-id="95662-796">There are at least two pathological situations.</span></span> <span data-ttu-id="95662-797">在下圖24中，CRT 範圍讓色調配量與「群島」有上升。</span><span class="sxs-lookup"><span data-stu-id="95662-797">In the following Figure 24, a CRT gamut gives rise to hue slices with "islands."</span></span> <span data-ttu-id="95662-798">在 [圖 25] 中，印表機範圍會增加到色調配量，但缺少中性軸的一部分。</span><span class="sxs-lookup"><span data-stu-id="95662-798">In Figure 25, a printer gamut gives rise to a hue slice with part of the neutral axis missing.</span></span> <span data-ttu-id="95662-799">在這些情況下，異常的色調配量並不是特別異常的範圍界限所造成。</span><span class="sxs-lookup"><span data-stu-id="95662-799">The pathological hue slices are not caused by particularly pathological gamut boundaries in these cases.</span></span> <span data-ttu-id="95662-800">它們是由色調配量的概念所造成，因為 () 它是沿著常數色調來取得，而 (b) 則只會採用對應到色調角度的平面一半。</span><span class="sxs-lookup"><span data-stu-id="95662-800">They are caused by the very concept of hue slice, because (a) it is taken along constant hue, and (b) it only takes one-half of the plane that corresponds to the hue angle.</span></span>

![顯示藍色色相中「內框線」的上方視圖和側邊視圖的圖表。](images/gmmp-image097.jpg)

<span data-ttu-id="95662-802">**圖 24** ：典型的 CRT 監視器有一個範圍，顯示藍色色調中的什麼嗎「曲線」。</span><span class="sxs-lookup"><span data-stu-id="95662-802">**Figure 24** : A typical CRT monitor has a gamut that shows peculiar "curving in" in the blue hues.</span></span> <span data-ttu-id="95662-803">如果在這個色調範圍內取得色調配量，則會在色調配量中顯示隔離的島。</span><span class="sxs-lookup"><span data-stu-id="95662-803">If hue slices are taken within this hue range, isolated islands may appear in the hue slices.</span></span>

![範圍在其中性軸中具有「間距」的範圍圖表。](images/gmmp-image099.jpg)

<span data-ttu-id="95662-805">**圖 25** ：印表機的範圍在其中性軸中的範圍可能會有「間隙」。</span><span class="sxs-lookup"><span data-stu-id="95662-805">**Figure 25** : A printer may have a gamut that has "gap" in its neutral axis.</span></span> <span data-ttu-id="95662-806">當 (色調配量時，只是平面) 的一半，在界限的部分為中性軸的「繼續引來大量」。</span><span class="sxs-lookup"><span data-stu-id="95662-806">When a hue slice is taken (which is only one-half the plane), there is a "dent" on the part of the boundary that is the neutral axis.</span></span> <span data-ttu-id="95662-807">這可能很難解決演算法。</span><span class="sxs-lookup"><span data-stu-id="95662-807">This can be hard to resolve algorithmically.</span></span>

<span data-ttu-id="95662-808">為了解決這些 pathologies，會建議新的架構，放棄用來作為起點的色調配量概念。</span><span class="sxs-lookup"><span data-stu-id="95662-808">To resolve these pathologies, a new framework is proposed that abandons the concept of hue slice that used as the starting point.</span></span> <span data-ttu-id="95662-809">相反地，架構會使用一組「界限線元素」或位於範圍界限的行。</span><span class="sxs-lookup"><span data-stu-id="95662-809">Instead, the framework uses the set of "boundary line elements," or lines that lie on the gamut boundary.</span></span> <span data-ttu-id="95662-810">它們不一定會提供一致的幾何視覺效果（例如色調配量），但支援所有通用的 gamut 作業。</span><span class="sxs-lookup"><span data-stu-id="95662-810">They do not necessarily provide a coherent geometric visualization like hue slices, but they support all the common gamut operations.</span></span> <span data-ttu-id="95662-811">除了解決先前所述的問題之外，此方法也會建議色調配量的結構（即使可能的話），也就是計算浪費。</span><span class="sxs-lookup"><span data-stu-id="95662-811">Besides solving the problems mentioned previously, this approach also suggests that the construction of hue slices, even when it is possible, is computationally wasteful.</span></span>

### <a name="triangulation-of-the-gamut-boundary"></a><span data-ttu-id="95662-812">範圍界限的三邊</span><span class="sxs-lookup"><span data-stu-id="95662-812">Triangulation of the Gamut Boundary</span></span>

<span data-ttu-id="95662-813">起始點是由範圍界限的三邊組成的 GBD。</span><span class="sxs-lookup"><span data-stu-id="95662-813">The starting point is a GBD consisting of a triangulation of the gamut boundary.</span></span> <span data-ttu-id="95662-814">已知的 GBDs 方法，通常會提供該內三角。</span><span class="sxs-lookup"><span data-stu-id="95662-814">Known methods of constructing GBDs usually provide that triangulation.</span></span> <span data-ttu-id="95662-815">在 concreteness 中，有一個為加法類裝置建立 GBDs 的方法會在此描述其裝置空間。</span><span class="sxs-lookup"><span data-stu-id="95662-815">For concreteness, one method of constructing GBDs for additive devices its device space is described here.</span></span> <span data-ttu-id="95662-816">這些裝置包含 (CRT 型和 LCD 型) 和投影機的監視器。</span><span class="sxs-lookup"><span data-stu-id="95662-816">These devices include monitors (both CRT-based and LCD-based) and projectors.</span></span> <span data-ttu-id="95662-817">Cube 的簡單幾何可讓您在 cube 上引進一般 >lattice。</span><span class="sxs-lookup"><span data-stu-id="95662-817">The simple geometry of the cube enables you to introduce a regular lattice on the cube.</span></span> <span data-ttu-id="95662-818">Cube 的界限臉部可以在數個 fashions 中進行三角化，例如圖26所示。</span><span class="sxs-lookup"><span data-stu-id="95662-818">The boundary faces of the cube can be triangulated in a number of fashions, such as the one shown in Figure 26.</span></span> <span data-ttu-id="95662-819">此架構會提供裝置的裝置型號，以演算法 >lattice 點的濃度值，或直接對這些點進行測量。</span><span class="sxs-lookup"><span data-stu-id="95662-819">The architecture provides either a device model for the device so that colorimetric values of the lattice points can be obtained algorithmically, or measurements have been made directly for those points.</span></span> <span data-ttu-id="95662-820">此架構也提供 CIECAM02，讓您可以假設起始資料已對應到 CIECAM02 Jab 空間。</span><span class="sxs-lookup"><span data-stu-id="95662-820">The architecture also provides CIECAM02, so that you can assume the starting data has already been mapped into CIECAM02 Jab space.</span></span> <span data-ttu-id="95662-821">然後，每個 >lattice 點在 RGB cube 的界限面上都有對應的點 Jab 空間。</span><span class="sxs-lookup"><span data-stu-id="95662-821">Then each lattice point on the boundary faces of the RGB cube has a corresponding point in Jab space.</span></span> <span data-ttu-id="95662-822">在 RGB 空間中形成一組三角形的點連接，也會在 Jab 空間中引發一組三角形。</span><span class="sxs-lookup"><span data-stu-id="95662-822">The connections of points that form the set of triangles in RGB space also induces a set of triangles in Jab space.</span></span> <span data-ttu-id="95662-823">如果 () RGB cube 上的 >lattice 足夠，並 (b) 從裝置空間到統一色彩空間的轉換，則會在拓撲運作正常的情況下形成適當的範圍界限：也就是說，它會將界限對應到界限，而不會將範圍變成內部，使內部點變成界限點。</span><span class="sxs-lookup"><span data-stu-id="95662-823">This set of triangles forms a reasonable triangulation of the gamut boundary if (a) the lattice on the RGB cube is fine enough, and (b) the transformation from device space to the uniform color space is topologically well-behaved; that is, it maps boundary to boundary, and it doesn't turn the gamut inside out so that interior points become boundary points.</span></span>

![此圖顯示一個簡單的方法，用來 triangluate 裝置的範圍界限（具有 R G B 作為其裝置空間）。](images/gmmp-image100.png)

<span data-ttu-id="95662-825">**圖 26** ：使用 RGB 作為裝置空間的簡單方法，分成三角形裝置的範圍界限</span><span class="sxs-lookup"><span data-stu-id="95662-825">**Figure 26** : A simple method to triangulate the gamut boundary of a device with RGB as its device space</span></span>

### <a name="boundary-line-elements"></a><span data-ttu-id="95662-826">界限線元素</span><span class="sxs-lookup"><span data-stu-id="95662-826">Boundary Line Elements</span></span>

<span data-ttu-id="95662-827">此架構的核心是界限線元素的概念; () 的一組線段位於範圍界限，而 (b) 位於平面上。</span><span class="sxs-lookup"><span data-stu-id="95662-827">Central to this framework is the concept of boundary line elements; a set of line segments that (a) lie on the gamut boundary, and (b) lie on a plane.</span></span> <span data-ttu-id="95662-828">在此情況下，平面是色調平面。</span><span class="sxs-lookup"><span data-stu-id="95662-828">In this case, the plane is a hue plane.</span></span> <span data-ttu-id="95662-829">每個線條區段都是將平面與範圍界限三角形相交的結果。</span><span class="sxs-lookup"><span data-stu-id="95662-829">Each line segment is the result of intersecting the plane with a gamut boundary triangle.</span></span> <span data-ttu-id="95662-830">雖然許多研究人員都使用以邊界三角形來交集平面的結構，但它們通常會分析這些線段之間的關聯性，並嘗試從線段中建立一致的幾何物件。</span><span class="sxs-lookup"><span data-stu-id="95662-830">Although many researchers have used the construction of intersecting a plane with boundary triangles, they generally analyze the relationship among these line segments, and attempt to construct a coherent geometric object out of the line segments.</span></span> <span data-ttu-id="95662-831">設計不同的演算法之後，請先將這些線段放在另一個，直到取得整個色調配量為止，並嘗試進行許多嘗試以加速搜尋程式。</span><span class="sxs-lookup"><span data-stu-id="95662-831">Different algorithms have been devised to follow these line segments one after the other until a whole hue slice is obtained, and many attempts have been made to speed up the process of searching.</span></span>

<span data-ttu-id="95662-832">這種方法不同。</span><span class="sxs-lookup"><span data-stu-id="95662-832">This approach is different.</span></span> <span data-ttu-id="95662-833">您會將平面與三角形相交，以取得線段。</span><span class="sxs-lookup"><span data-stu-id="95662-833">You intersect the plane with the triangles to obtain the line segments.</span></span> <span data-ttu-id="95662-834">然後，您可以將這些線段視為 *基本* 的概念物件。</span><span class="sxs-lookup"><span data-stu-id="95662-834">You then consider these line segments as the *basic* conceptual objects.</span></span> <span data-ttu-id="95662-835">您必須分析線段之間的關聯性;您不需要知道彼此互相連接的方式。</span><span class="sxs-lookup"><span data-stu-id="95662-835">It is necessary to analyze the relationship among the line segments; you don't have to know how they are interconnected with each other.</span></span> <span data-ttu-id="95662-836">這種觀點可解決使用島的色調配量問題。</span><span class="sxs-lookup"><span data-stu-id="95662-836">This point of view solves the problem of hue slice with islands.</span></span> <span data-ttu-id="95662-837">嘗試建立「色調」配量的已知方法假設一開始有一個行區段，並遵循下一個線段，依此類推。最後，它會導向回到起點，此時會建立整個色調配量。</span><span class="sxs-lookup"><span data-stu-id="95662-837">The known approaches that attempt to construct hue slice assume that, if one starts with one line segment and follows it to the next line segment, and so on; it eventually leads back to the starting point, at which point a whole hue slice would be constructed.</span></span> <span data-ttu-id="95662-838">可惜的是，這種方法會錯過島 (，而在最糟的情況下，大陸) 。</span><span class="sxs-lookup"><span data-stu-id="95662-838">Unfortunately, this approach would miss the island (and in the worst scenario, the continent).</span></span> <span data-ttu-id="95662-839">未工作取得一致幾何圖片;也就是說，色調配量可讓您輕鬆處理島問題。</span><span class="sxs-lookup"><span data-stu-id="95662-839">By not insisting on obtaining a coherent geometric picture; that is, hue slice, you can handle the island problem effortlessly.</span></span> <span data-ttu-id="95662-840">這種方法還有另一個重要的差異，就是為了加快線段的結構，它會使用「三角形篩選」。</span><span class="sxs-lookup"><span data-stu-id="95662-840">Another important difference in this approach is that, to speed up the construction of line segments, it uses a "triangle filter."</span></span> <span data-ttu-id="95662-841">三角形篩選器會擲回特定的三角形，這絕對不會產生在目前 gamut 作業中很有用的線段。</span><span class="sxs-lookup"><span data-stu-id="95662-841">The triangle filter throws out certain triangles that will definitely not produce line segments that would be useful in the current gamut operation.</span></span> <span data-ttu-id="95662-842">因為與平面相交的三角形是大量的運算，所以這可改善速度。</span><span class="sxs-lookup"><span data-stu-id="95662-842">Because intersecting a triangle with the plane is expensive computationally, this improves speed.</span></span> <span data-ttu-id="95662-843">副作用是，您無法建立色調配量，因為有些線條區段因為三角形篩選而遺失。</span><span class="sxs-lookup"><span data-stu-id="95662-843">A side effect is that, you cannot construct hue slice because some line segments would be missing due to the triangle filtering.</span></span>

### <a name="gamut-operation-checkgamut"></a><span data-ttu-id="95662-844">Gamut 運算： CheckGamut</span><span class="sxs-lookup"><span data-stu-id="95662-844">Gamut Operation: CheckGamut</span></span>

<span data-ttu-id="95662-845">下列範例將說明架構的運作方式，以及如何執行 CheckGamut，也就是檢查色彩是否在範圍內的作業。</span><span class="sxs-lookup"><span data-stu-id="95662-845">The following example will explain how the framework works, and how CheckGamut is carried out, that is, the operation of checking if a color is in-gamut.</span></span>

<span data-ttu-id="95662-846">下圖27說明一般架構。</span><span class="sxs-lookup"><span data-stu-id="95662-846">The general framework is illustrated in the following Figure 27.</span></span> <span data-ttu-id="95662-847">有各種不同的元件。</span><span class="sxs-lookup"><span data-stu-id="95662-847">There are various components.</span></span> <span data-ttu-id="95662-848">以斜體標示的元件是視問題中的範圍作業而定，可能會有不同的元件。</span><span class="sxs-lookup"><span data-stu-id="95662-848">The components labeled in italics are components that may be different in implementation depending on the gamut operation in question.</span></span> <span data-ttu-id="95662-849">其他元件在所有範圍作業之間都是不變的。</span><span class="sxs-lookup"><span data-stu-id="95662-849">The other components are invariant across all gamut operations.</span></span> <span data-ttu-id="95662-850">首先， ***輸入*** 是一組色彩屬性。</span><span class="sxs-lookup"><span data-stu-id="95662-850">To begin, the ***Input*** is a set of color attributes.</span></span> <span data-ttu-id="95662-851">在 CheckGamut 的案例中，它是查詢色彩。</span><span class="sxs-lookup"><span data-stu-id="95662-851">In the case of CheckGamut, it is the query color.</span></span> <span data-ttu-id="95662-852">在 [圖 27] 和下列討論中，假設色調角度是輸入色彩屬性，或是可以從中取得。</span><span class="sxs-lookup"><span data-stu-id="95662-852">In Figure 27 and the following discussion, it is assumed that the hue angle is either among the input color attributes, or can be obtained from them.</span></span> <span data-ttu-id="95662-853">如果輸入是整個色彩點（在 Jab 或 JCh 中），您接著可以在其中計算色調角度，這就是很明顯的情況。</span><span class="sxs-lookup"><span data-stu-id="95662-853">This is clearly the case if the input is the whole color point, either in Jab or JCh, from which you can then compute the hue angle.</span></span> <span data-ttu-id="95662-854">請注意，因為正在使用色調平面，所以只需要色調角度。</span><span class="sxs-lookup"><span data-stu-id="95662-854">Note that the hue angle is only needed because hue planes are being used.</span></span> <span data-ttu-id="95662-855">根據有問題的 gamut 作業，可能不需要使用色調平面。</span><span class="sxs-lookup"><span data-stu-id="95662-855">Depending on the gamut operation in question, it might not be necessary to use the hue plane.</span></span> <span data-ttu-id="95662-856">例如，在常式 CheckGamut 的結構中，您可能會想要使用常數 J 的平面。這是不會進一步使用或討論的一般性;但是，當色調平面可能不是最佳選擇時，請記住這種方法的彈性，以支援其他 gamut 作業。</span><span class="sxs-lookup"><span data-stu-id="95662-856">For example, in the construction of the routine CheckGamut, you might want to use planes of constant J. This is a generality that will not be used or discussed further; but it might be helpful to remember this flexibility of the methodology to support other gamut operations when hue plane might not be the best choice.</span></span>

![顯示支援 gamut 作業之流程的圖表。](images/gmmp-image112.jpg)

<span data-ttu-id="95662-858">**圖 27** ：支援 gamut 作業的架構</span><span class="sxs-lookup"><span data-stu-id="95662-858">**Figure 27** : The framework to support gamut operations</span></span>

<span data-ttu-id="95662-859">從輸入中直接取得或從輸入計算出來的色調角度，會用來初始化圖中標示為 **完整色調平面** 的色調平面。</span><span class="sxs-lookup"><span data-stu-id="95662-859">The hue angle, which is obtained directly from the inputs or computed from the inputs, is used to initialize the hue plane labeled **Full Hue Plane** in the figure.</span></span> <span data-ttu-id="95662-860">因為這是完整的平面，而不只是包含色調的半平面，所以會強調「完整」。</span><span class="sxs-lookup"><span data-stu-id="95662-860">"Full" is emphasized because this is the full plane, not just the half-plane containing the hue.</span></span> <span data-ttu-id="95662-861">完整平面同時包含輸入的色調角度和角度180度。</span><span class="sxs-lookup"><span data-stu-id="95662-861">The full plane contains both the input hue angle and the angle 180 degrees opposite to it.</span></span> <span data-ttu-id="95662-862">色調平面的主要功能是 Intersect 函式，如下列小節中的「完整色調平面： Intersect」所述。</span><span class="sxs-lookup"><span data-stu-id="95662-862">The key functionality of the hue plane is the Intersect function, which is explained in the following subsection, Full Hue Plane: Intersect.</span></span> <span data-ttu-id="95662-863">假設已建立 GBD，且有一組範圍 **界限三角形** 可用。</span><span class="sxs-lookup"><span data-stu-id="95662-863">Assume that the GBD has already been constructed, and the set of **Gamut Boundary Triangles** is available.</span></span> <span data-ttu-id="95662-864">與使用 Intersect 的色相平面，交集于 \**_三角形濾波器_* _ 的三角形。</span><span class="sxs-lookup"><span data-stu-id="95662-864">Intersect the triangles that have survived the \**_Triangle Filter_* _ with the hue plane using Intersect.</span></span> <span data-ttu-id="95662-865">_三角形濾波器 \* 元件會以斜體標示，這表示元件針對不同的範圍作業會有不同的執行方式。CheckGamut 的 *三角形篩選準則* 會在 [Gamut 作業： CheckGamut] (繼續) 的區段中加以說明。將三角形與色調平面相交的結果為空白或 **界限線元素**，也就是一對不同的點。如果結果不是空的，則會將它傳遞至 \**_Line 元素處理器_*_ ，這會根據範圍作業再次執行不同的作業。</span><span class="sxs-lookup"><span data-stu-id="95662-865">The _Triangle Filter\* component is labeled in italics, which means that the component varies in implementation for different gamut operations. The *Triangle Filter* for CheckGamut is explained in the section, Gamut Operation: CheckGamut (continued). The result of intersecting a triangle with the hue plane is either empty or a **Boundary Line Element** , that is, a pair of distinct points. If the result is non-empty, it is passed into the \**_Line Element Processor_*_ , which again does different things depending on the gamut operation.</span></span> <span data-ttu-id="95662-866">_Line Element Processor \* 會更新內部資料結構（\***內部處理的資料**_ ），其內容或配置也取決於 gamut 作業。</span><span class="sxs-lookup"><span data-stu-id="95662-866">The _Line Element Processor\* updates the internal data structure, \***Internal Processed Data**_ , whose content or layout also depends on the gamut operation.</span></span> <span data-ttu-id="95662-867">一般而言，_內部處理的資料 \* 包含問題的「解答」，這會在每個找到的新界限線元素持續更新。當所有界限線元素都經過處理之後，就可以找到答案。它仍會透過 \***輸出配接器** 來存取它_。</span><span class="sxs-lookup"><span data-stu-id="95662-867">Generally, the _Internal Processed Data\* contains the "answer" to the problem, which is continually updated with each new Boundary Line Element found. When all the Boundary Line Elements have been processed, the answer has been found. It remains to access it through the \***Output Adaptor**_.</span></span> <span data-ttu-id="95662-868">因為 _Internal 處理的資料 \* 是範圍專屬的作業，所以 *輸出配接器* 也會將作業指定為 gamut。</span><span class="sxs-lookup"><span data-stu-id="95662-868">Because the _Internal Processed Data\* is gamut operation specific, the *Output Adaptor* is also gamut operation specific.</span></span>

### <a name="full-hue-plane-intersect"></a><span data-ttu-id="95662-869">完整色調平面： Intersect</span><span class="sxs-lookup"><span data-stu-id="95662-869">Full Hue Plane: Intersect</span></span>

<span data-ttu-id="95662-870">Intersect 函數會計算色調平面和三角形的交集。</span><span class="sxs-lookup"><span data-stu-id="95662-870">The Intersect function calculates the intersection of the hue plane and a triangle.</span></span> <span data-ttu-id="95662-871">簡單來說，此函式很重要，原因有二。</span><span class="sxs-lookup"><span data-stu-id="95662-871">As simple as it sounds, this function is important for two reasons.</span></span>

<span data-ttu-id="95662-872">首先，將三角形的每個邊緣與平面相交，可能會產生三個交集點，也就是幾何不可能的情況。</span><span class="sxs-lookup"><span data-stu-id="95662-872">First, intersecting each edge of the triangle with the plane might yield three intersection points, a geometrically impossible situation.</span></span> <span data-ttu-id="95662-873">這種情況可能發生在計算中的原因是，當計算是以浮點數（例如 IEEE 格式）完成時，每個步驟中都有不確定性或「數值雜訊」，會影響邊緣與平面相交的結果。</span><span class="sxs-lookup"><span data-stu-id="95662-873">The reason why this might happen in the computation is that, when calculations are done in floating point, for example, IEEE format, there are uncertainties, or "numeric noise," in each step that affects the conclusion of whether an edge intersects the plane.</span></span> <span data-ttu-id="95662-874">當平面與接近遺漏的情況下的邊緣相交時，交集點會彼此接近，且判斷交集點是否位於邊緣內是隨機的。</span><span class="sxs-lookup"><span data-stu-id="95662-874">When the plane intersects the edges in a near-miss situation, the intersection points are close to each other, and the determination whether an intersection point lies within the edge is random.</span></span> <span data-ttu-id="95662-875">雖然點數值中的雜訊很小，但是有兩個以上的交集點是幾何不可能的，而且難以在演算法中正確處理。</span><span class="sxs-lookup"><span data-stu-id="95662-875">Although noise in the numeric values of the points is small, the qualitative conclusion that there are more than two intersection points is geometrically impossible and difficult to handle correctly in the algorithm.</span></span>

<span data-ttu-id="95662-876">其次，此函式在每個篩選三角形的每個邊緣的重大迴圈中，因此請務必盡可能將其效率優化。</span><span class="sxs-lookup"><span data-stu-id="95662-876">Second, this function is in the critical loop for each edge of each filtered triangle, so it is important that you optimize its efficiency as much as possible.</span></span>

<span data-ttu-id="95662-877">若要解決數值雜訊的第一個問題，請以整數執行計算。</span><span class="sxs-lookup"><span data-stu-id="95662-877">To address the first issue Of numeric noise, perform the calculations in integers.</span></span> <span data-ttu-id="95662-878">若要解決優化其效率的第二個問題，請快取每個頂點最常使用的屬性，或是與每個頂點相關聯的「點積」。</span><span class="sxs-lookup"><span data-stu-id="95662-878">To address the second issue of optimizing its efficiency, cache the most used attribute of each vertex, or the "dot product" associated with each vertex.</span></span> <span data-ttu-id="95662-879">傳遞至整數是保證幾何一致性的典型方式。</span><span class="sxs-lookup"><span data-stu-id="95662-879">Passing into integers is a typical way to guarantee geometric consistency.</span></span> <span data-ttu-id="95662-880">基本概念是，如果您必須量化，請在一開始就進行。</span><span class="sxs-lookup"><span data-stu-id="95662-880">The basic idea is that if you have to quantize, do it at the beginning.</span></span> <span data-ttu-id="95662-881">然後可以在整數中執行後續的計算，如果整數的寬度夠大，就不會有溢位的風險，則可以使用無限有效位數來完成計算。</span><span class="sxs-lookup"><span data-stu-id="95662-881">Then subsequent calculations can be performed in integers, and if the integers are wide enough so that there is no danger of overflow, the calculations can be done with infinite precision.</span></span> <span data-ttu-id="95662-882">下列量化函數適用于此用途。</span><span class="sxs-lookup"><span data-stu-id="95662-882">The following quantization function useful for this purpose.</span></span>

<span data-ttu-id="95662-883">ScaleAndTruncate (x) = x 10000 的整數部分 \*</span><span class="sxs-lookup"><span data-stu-id="95662-883">ScaleAndTruncate(x) = Integer part of x\*10000</span></span>

<span data-ttu-id="95662-884">縮放比例10000表示輸入浮點數有四個小數位數，這對這個應用程式來說夠精確。</span><span class="sxs-lookup"><span data-stu-id="95662-884">The scaling factor 10000 means that the input floating-point number has four decimal places, which is precise enough for this application.</span></span> <span data-ttu-id="95662-885">視色彩外觀空間的值範圍而定，您想要選擇寬度足以容納中繼計算的整數類型。</span><span class="sxs-lookup"><span data-stu-id="95662-885">Depending on the range of values of the color appearance space, you want to choose an integer type with bits wide enough to hold the intermediate calculations.</span></span> <span data-ttu-id="95662-886">在大部分的色彩外觀空間中，每個座標的範圍在-1000 到1000的範圍內。</span><span class="sxs-lookup"><span data-stu-id="95662-886">In most color appearance spaces, the range of each coordinate is within the range -1,000 to 1,000.</span></span> <span data-ttu-id="95662-887">量化座標的最大可能絕對值為 1000 \* 10000 = 10000000。</span><span class="sxs-lookup"><span data-stu-id="95662-887">The quantized coordinate has a maximum possible absolute value of 1,000\*10,000 = 10,000,000.</span></span> <span data-ttu-id="95662-888">如您所見，中繼數量是點乘積，也就是兩個座標乘積的總和，因此它的最大可能絕對值為 2 \* (10000000) ₂ = 2？10₁₄。</span><span class="sxs-lookup"><span data-stu-id="95662-888">As you will see, the intermediate quantity is a dot product, which is a sum of two products of coordinates, so it has a maximum possible absolute value of 2\*(10,000,000) ₂ = 2?10 ₁₄.</span></span> <span data-ttu-id="95662-889">需要的位數是 log ₂ (2？10₁₄ ) = 47.51。</span><span class="sxs-lookup"><span data-stu-id="95662-889">The number of bits required is log ₂ (2?10 ₁₄ ) = 47.51.</span></span> <span data-ttu-id="95662-890">整數類型的方便選擇是，因此是64位整數。</span><span class="sxs-lookup"><span data-stu-id="95662-890">A convenient choice for the integer type is, therefore, 64-bit integers.</span></span>

<span data-ttu-id="95662-891">為了保證與三角形相交的平面一律會提供空的集合或一組兩個點，您必須將三角形視為整個三角形，而不是個別的三角形個別邊緣。</span><span class="sxs-lookup"><span data-stu-id="95662-891">To guarantee that intersecting a plane with a triangle always gives either empty set or a set of two points, you must consider the triangle as a whole, not as individual edges of the triangle separately.</span></span> <span data-ttu-id="95662-892">若要瞭解幾何狀況，請考慮色調平面中三角形頂點的「帶正負號距離」。</span><span class="sxs-lookup"><span data-stu-id="95662-892">To understand the geometric situation, consider the "signed distances" of the vertices of the triangle from the hue plane.</span></span> <span data-ttu-id="95662-893">請勿直接計算這些已簽署的距離;改為使用平面的量化一般向量，計算頂點位置向量的點乘積。</span><span class="sxs-lookup"><span data-stu-id="95662-893">Do not calculate these signed distances directly; instead calculate the dot products of the position vectors of the vertices with the quantized normal vector to the plane.</span></span> <span data-ttu-id="95662-894">更明確地說，在色調平面的初始化期間，量化一般向量的計算方式如下。</span><span class="sxs-lookup"><span data-stu-id="95662-894">More specifically, during the initialization of the hue plane, the quantized normal vector is calculated as follows.</span></span>

<span data-ttu-id="95662-895">NormalVector = (ScaleAndTruncate (-sin (色調) ) 、ScaleAndTruncate (cos (色調) ) ) </span><span class="sxs-lookup"><span data-stu-id="95662-895">NormalVector = (ScaleAndTruncate(-sin(hue)), ScaleAndTruncate(cos(hue)))</span></span>

<span data-ttu-id="95662-896">請注意，這個向量是二維向量。</span><span class="sxs-lookup"><span data-stu-id="95662-896">Note that this vector is a two-dimensional vector.</span></span> <span data-ttu-id="95662-897">您可以使用二維向量，因為色調平面是垂直的，所以一般向量的第三個元件一律為零。</span><span class="sxs-lookup"><span data-stu-id="95662-897">You can use a two-dimensional vector because the hue plane is vertical, so the third component of the normal vector is always zero.</span></span> <span data-ttu-id="95662-898">此外，點乘積的查閱資料表會初始化為具有範圍界限三角形中每個頂點的專案，並將對應的點乘積設定為無效值。</span><span class="sxs-lookup"><span data-stu-id="95662-898">Moreover, a lookup table of dot products is initialized to have an entry for each vertex from the Gamut Boundary Triangles and the corresponding dot product set to an invalid value.</span></span>

<span data-ttu-id="95662-899">在將色調平面與三角形相交的一個作業期間，會查閱三角形每個頂點的點乘積。</span><span class="sxs-lookup"><span data-stu-id="95662-899">During one operation of intersecting the hue plane with a triangle, the dot product of each vertex of the triangle is looked up.</span></span> <span data-ttu-id="95662-900">如果查閱資料表中的值是不正確值，則會使用下列運算式來計算點乘積。</span><span class="sxs-lookup"><span data-stu-id="95662-900">If the value in the lookup table is the invalid value, then the dot product is computed using the following expression.</span></span>

<span data-ttu-id="95662-901">NormalVector。 \* ScaleAndTruncate (頂點。 a) + NormalVector. b \* ScaleAndTruncate (頂點. b) </span><span class="sxs-lookup"><span data-stu-id="95662-901">NormalVector.a\*ScaleAndTruncate(vertex.a) + NormalVector.b\*ScaleAndTruncate(vertex.b)</span></span>

<span data-ttu-id="95662-902">同樣地，也不會使用頂點的 J 元件，因為一般向量是水準的。</span><span class="sxs-lookup"><span data-stu-id="95662-902">Again, the J-component of the vertex is never used, because the normal vector is horizontal.</span></span> <span data-ttu-id="95662-903">然後，這個點乘積會儲存在查閱資料表中，因此，如果稍後查詢頂點的點乘積，就不需要再次計算。</span><span class="sxs-lookup"><span data-stu-id="95662-903">This dot product is then saved in the lookup table so that it doesn't have to be computed again if the dot product of the vertex is queried later.</span></span>

<span data-ttu-id="95662-904">快取可讓您快速判斷邊緣是否與平面相交，在查閱資料表中以表格形式表示點乘積之後，會隨著頂點的處理而逐漸建立。</span><span class="sxs-lookup"><span data-stu-id="95662-904">Caching allows for a quick determination of whether an edge intersects the plane, after the dot products are tabulated in the lookup table, which is built progressively as the vertices are processed.</span></span>

![顯示色調平面與三角形交集的圖表。](images/gmmp-image114.jpg)

<span data-ttu-id="95662-906">**圖 28** ：將色調平面與三角形相交</span><span class="sxs-lookup"><span data-stu-id="95662-906">**Figure 28** : Intersecting the hue plane with a triangle</span></span>

<span data-ttu-id="95662-907">若要讓圖28中的三角形與非退化線段中的色調平面相交，則在以遞增順序排序時，頂點的點乘積必須是下列其中一個模式。</span><span class="sxs-lookup"><span data-stu-id="95662-907">For the triangle in Figure 28 to intersect the hue plane in a non-degenerate line segment, the dot products of the vertices must be in one of the following patterns, when sorted in ascending order.</span></span>

<span data-ttu-id="95662-908">0、0、+;-、0、0、-、0、+;-,-,+;-,+,+</span><span class="sxs-lookup"><span data-stu-id="95662-908">0,0,+; -,0,0; -,0,+; -,-,+; -,+,+</span></span>

<span data-ttu-id="95662-909">當平面以具有不同正負號之頂點的邊緣交集時，就會出現線段的結束點。</span><span class="sxs-lookup"><span data-stu-id="95662-909">An end point of the line segment arises when the plane is intersected by an edge with vertices that have different signs in the dot product.</span></span> <span data-ttu-id="95662-910">如果正負號為零，則頂點會在平面上，而邊緣與平面的交集則是頂點本身。</span><span class="sxs-lookup"><span data-stu-id="95662-910">If the sign is zero, then the vertex lies right on the plane, and the intersection of the edge with the plane is the vertex itself.</span></span> <span data-ttu-id="95662-911">也請注意，案例0、0、0、-,-, 0;不報告0、+、+。</span><span class="sxs-lookup"><span data-stu-id="95662-911">Note also that the cases 0,0,0; -,-,0; 0,+,+ are not reported.</span></span> <span data-ttu-id="95662-912">第一個案例 (0、0、0) 表示整個三角形位於平面上。</span><span class="sxs-lookup"><span data-stu-id="95662-912">The first case (0,0,0) means the whole triangle lies on the plane.</span></span> <span data-ttu-id="95662-913">這是不會回報的，因為三角形的每個邊緣都必須屬於不完全落在平面上的鄰近三角形。</span><span class="sxs-lookup"><span data-stu-id="95662-913">This is not reported because each edge of the triangle should belong to a neighboring triangle that does not also lie entirely on the plane.</span></span> <span data-ttu-id="95662-914">當考慮該三角形時，將會報告 edge。</span><span class="sxs-lookup"><span data-stu-id="95662-914">The edge will be reported when that triangle is considered.</span></span> <span data-ttu-id="95662-915">另外兩個案例 (-,-, 0 和0、+、+) 對應至三角形在一個頂點中接觸平面的幾何設定。</span><span class="sxs-lookup"><span data-stu-id="95662-915">The other two cases (-,-,0 and 0,+,+) correspond to the geometric configuration that the triangle touches the plane in one vertex.</span></span> <span data-ttu-id="95662-916">這些案例不會被報告，因為它們不會造成非退化的線段。</span><span class="sxs-lookup"><span data-stu-id="95662-916">These cases are not reported because they don't give rise to a non-degenerate line segment.</span></span>

<span data-ttu-id="95662-917">上述的演算法會決定何時要計算三角形邊緣與色調平面之間的交集。</span><span class="sxs-lookup"><span data-stu-id="95662-917">The preceding algorithm determines when to calculate an intersection between an edge of the triangle and the hue plane.</span></span> <span data-ttu-id="95662-918">決定邊緣之後，會使用參數化方程式來計算交集。</span><span class="sxs-lookup"><span data-stu-id="95662-918">After an edge is determined, the intersection is calculated using parametric equations.</span></span> <span data-ttu-id="95662-919">如果其中一個點乘積為零，則交集是頂點本身，因此不需要計算。</span><span class="sxs-lookup"><span data-stu-id="95662-919">If one of the dot products is zero, the intersection is the vertex itself, so no calculation is necessary.</span></span> <span data-ttu-id="95662-920">假設邊緣頂點的兩個點乘積都不是零，則 vertex1 是具有 *負* 點乘積 dotProduct1 的頂點;而 vertex2 是具有 *正面* 點乘積 dotProduct2 的頂點。</span><span class="sxs-lookup"><span data-stu-id="95662-920">Assuming that both dot products of the vertices of the edge are non-zero , vertex1 is the vertex with *negative* dot product dotProduct1; and vertex2 is the vertex with *positive* dot product dotProduct2.</span></span> <span data-ttu-id="95662-921">此順序很重要，可確保計算交集點不取決於在邊緣的標記法中出現的頂點順序。</span><span class="sxs-lookup"><span data-stu-id="95662-921">This order is important to ensure that the calculated intersection point does not depend on how the ordering of the vertices appears in the representation of the edge.</span></span> <span data-ttu-id="95662-922">邊緣的幾何概念與其頂點對稱。</span><span class="sxs-lookup"><span data-stu-id="95662-922">The geometric concept of the edge is symmetrical with respect to its vertices.</span></span> <span data-ttu-id="95662-923">使用邊緣的參數化方程式的計算層面引進了不對稱的 (開始頂點) 的選擇，因為要解決線性方程序的數值雜訊和空調，可能會提供稍微不同的交集點。</span><span class="sxs-lookup"><span data-stu-id="95662-923">The computational aspect of using parametric equations of the edge introduces asymmetry (choice of starting vertex), which may give a slightly different intersection point due to numeric noise and conditioning of the linear equations to be solved.</span></span> <span data-ttu-id="95662-924">也就是說，交集點（交集）是由下列各項所提供。</span><span class="sxs-lookup"><span data-stu-id="95662-924">With this said, the intersection point, intersection,is given by the following.</span></span>

<span data-ttu-id="95662-925">t = dotProduct1/ (dotProduct1-dotProduct2) </span><span class="sxs-lookup"><span data-stu-id="95662-925">t = dotProduct1/(dotProduct1 - dotProduct2)</span></span>

<span data-ttu-id="95662-926">交叉 口。J = vertex1。J + t \* (vertex2。J-vertex1。J) </span><span class="sxs-lookup"><span data-stu-id="95662-926">intersection.J = vertex1.J + t \* (vertex2.J - vertex1.J)</span></span>

<span data-ttu-id="95662-927">交集。 a = vertex1. a + t \* (vertex2. a-vertex1. a) </span><span class="sxs-lookup"><span data-stu-id="95662-927">intersection.a = vertex1.a + t \* (vertex2.a - vertex1.a)</span></span>

<span data-ttu-id="95662-928">交集。 b = vertex1. b + t \* (vertex2. b-vertex1. b) </span><span class="sxs-lookup"><span data-stu-id="95662-928">intersection.b = vertex1.b + t \* (vertex2.b - vertex1.b)</span></span>

### <a name="gamut-operation-checkgamut-continued"></a><span data-ttu-id="95662-929">Gamut 運算： CheckGamut (繼續) </span><span class="sxs-lookup"><span data-stu-id="95662-929">Gamut Operation: CheckGamut (continued)</span></span>

<span data-ttu-id="95662-930">用於 gamut 檢查的基本幾何演算法是計算光線交點的數目。</span><span class="sxs-lookup"><span data-stu-id="95662-930">The basic geometric algorithm used for gamut checking is to count the number of ray crossings.</span></span> <span data-ttu-id="95662-931">針對給定的查詢點，請考慮以查詢點開始的光線，然後指向 (J 方向) 。</span><span class="sxs-lookup"><span data-stu-id="95662-931">For a given query point, consider a ray starting with the query point and pointing upwards (J-direction).</span></span> <span data-ttu-id="95662-932">計算此光線與範圍界限相交的次數。</span><span class="sxs-lookup"><span data-stu-id="95662-932">Count the number of times this ray crosses the gamut boundary.</span></span> <span data-ttu-id="95662-933">如果這個數位為偶數，則表示查詢點超出範圍。</span><span class="sxs-lookup"><span data-stu-id="95662-933">If this number is even, then the query point is out-of-gamut.</span></span> <span data-ttu-id="95662-934">如果這個數位是奇數，則點是在內部。</span><span class="sxs-lookup"><span data-stu-id="95662-934">If this number is odd, the point is inside.</span></span> <span data-ttu-id="95662-935">基本上，這個演算法可在3-d 中執行，通常是由退化狀況所造成的問題所造成，例如 (部分) 界限三角形的光線，或較低的維度 degeneracy （例如，在界限三角形邊緣 (部分) 的光線）。</span><span class="sxs-lookup"><span data-stu-id="95662-935">In principle, this algorithm can be implemented in 3-D, it is generally plagued by difficulties caused by degenerate situations, such as the ray lying (partly) on a boundary triangle, or lower dimensional degeneracy, such as the ray lying (partly) on an edge of a boundary triangle.</span></span> <span data-ttu-id="95662-936">即使是在2-d，您也必須處理這些退化情況;但是問題更簡單，而且是以滿意的方式解決。</span><span class="sxs-lookup"><span data-stu-id="95662-936">Even in 2-D, you have to deal with these degenerate situations; but the problem is simpler and has been addressed in a satisfactory manner.</span></span> <span data-ttu-id="95662-937">請參閱 \[ O'Rourke \] 。</span><span class="sxs-lookup"><span data-stu-id="95662-937">See \[O'Rourke\].</span></span>

<span data-ttu-id="95662-938">針對指定的輸入點 Jab，判斷其色調角度 h，如下所示。</span><span class="sxs-lookup"><span data-stu-id="95662-938">For a given input point Jab, determine its hue angle h as follows.</span></span>

<span data-ttu-id="95662-939">h = atan (b/a) ，</span><span class="sxs-lookup"><span data-stu-id="95662-939">h = atan(b/a),</span></span>

<span data-ttu-id="95662-940">初始化色調平面，然後判斷對應至這個色調平面的界限線元素。</span><span class="sxs-lookup"><span data-stu-id="95662-940">Initialize the hue plane, and then determine the Boundary Line Elements corresponding to this hue plane.</span></span> <span data-ttu-id="95662-941">因為界限線條元素與向上光線相交，所以請設定三角形篩選器來移除三角形，以將不會與向上光線相交的線條元素。</span><span class="sxs-lookup"><span data-stu-id="95662-941">Because the Boundary Line Elements are only relevant if they intersect the upward ray, set up a Triangle Filter to remove triangles that give line elements that definitely will not intersect the upward ray.</span></span> <span data-ttu-id="95662-942">在此情況下，請考慮三角形的周框方塊。</span><span class="sxs-lookup"><span data-stu-id="95662-942">In this case, consider the bounding box of the triangle.</span></span> <span data-ttu-id="95662-943">如果正上方的光線來源，則如果查詢點位於周框方塊的「陰影」轉換外，則最高的光線不會相交三角形。</span><span class="sxs-lookup"><span data-stu-id="95662-943">The upward ray will not intersect the triangle if the query point is outside the "shadow" cast by the bounding box if a light source was directly above.</span></span> <span data-ttu-id="95662-944">使用預先固定的容錯來使其稍微擴大，以允許數值雜訊，讓您不會不慎擲出可能提供有用線條元素的三角形。</span><span class="sxs-lookup"><span data-stu-id="95662-944">Inflate this slightly with a pre-fixed tolerance to allow for numeric noise so that you don't inadvertently throw away triangles that might give useful line elements.</span></span> <span data-ttu-id="95662-945">結果是如圖29所示的半無限矩形圓柱。</span><span class="sxs-lookup"><span data-stu-id="95662-945">The result is the semi-infinite rectangular cylinder shown in Figure 29.</span></span> <span data-ttu-id="95662-946">檢查此圓柱內或外部的查詢點是否可以使用簡單的到差異有效率地執行。</span><span class="sxs-lookup"><span data-stu-id="95662-946">Checking whether the query point is inside or outside this cylinder can be efficiently implemented using simple inequalities.</span></span>

![顯示 CheckGamut 的三角形篩選。](images/gmmp-image116.jpg)

<span data-ttu-id="95662-948">**圖 29** ： CheckGamut 的三角形篩選</span><span class="sxs-lookup"><span data-stu-id="95662-948">**Figure 29** : Triangle Filter for CheckGamut</span></span>

<span data-ttu-id="95662-949">CheckGamut 有三個 gamut 作業專用元件： *內部處理的資料*、*線條元素處理器* 和 *輸出配接器*。</span><span class="sxs-lookup"><span data-stu-id="95662-949">CheckGamut has three gamut operation specific components: *Internal Processed Data*,*Line Element Processor*, and *Output Adaptor*.</span></span> <span data-ttu-id="95662-950">*內部處理的資料* 是由 *線條元素處理器* 所處理的線條專案清單。</span><span class="sxs-lookup"><span data-stu-id="95662-950">The *Internal Processed Data* is a list of line elements that have been processed by *Line Element Processor*.</span></span> <span data-ttu-id="95662-951">在此情況下， *線條元素處理器* 只會將線條元素加入至清單。</span><span class="sxs-lookup"><span data-stu-id="95662-951">In this case, the *Line Element Processor* simply adds a line element to the list.</span></span> <span data-ttu-id="95662-952">*內部處理資料* 的內部資料結構可以是連結的清單，或是可以成長大小的陣列。</span><span class="sxs-lookup"><span data-stu-id="95662-952">The internal data structure for *Internal Processed Data* can be either a linked list or an array that can grow in size.</span></span>

<span data-ttu-id="95662-953">*輸出適配* 卡是存取行元素清單的模組，可判斷線條元素是否跨越向上的光線 (計數 1) 或不 (計數 0) 。</span><span class="sxs-lookup"><span data-stu-id="95662-953">The *Output Adaptor* is a module that accesses the list of line elements, determines if a line element crosses the upward ray (count 1) or not (count 0).</span></span> <span data-ttu-id="95662-954">所有這些計數的加總會提供總計數。</span><span class="sxs-lookup"><span data-stu-id="95662-954">Summing all these counts gives a total count.</span></span> <span data-ttu-id="95662-955">*輸出配接器* 最後會輸出「是」 (內部) 或「否」 (超出範圍) 的答案，這取決於總計計數是否為奇數或偶數。</span><span class="sxs-lookup"><span data-stu-id="95662-955">The *Output Adaptor* ultimately outputs an answer of "yes" (in-gamut) or "no" (out-of-gamut), depending on whether the total count is odd or even.</span></span> <span data-ttu-id="95662-956">您判斷線條元素是否與向上光線相交的步驟，應該會有一定的注意，因為這是發生 degeneracy 問題的地方，而且也會產生過度計數的問題。</span><span class="sxs-lookup"><span data-stu-id="95662-956">The step where you determine if a line element crosses the upward ray deserves some attention because this is where the problem of degeneracy arises and also the problem of over-counting arises.</span></span> <span data-ttu-id="95662-957">\[在 O'Rourke 之後， \] 若要將線條元素與光線相交，則右端會 (具有較大色度的結束點) 必須嚴格地位於光線的右側。</span><span class="sxs-lookup"><span data-stu-id="95662-957">Following \[O'Rourke\], for a line element to cross the ray, the right end point (the end point with larger chroma) must be strictly on the right side of the ray.</span></span> <span data-ttu-id="95662-958">這可保證如果結束點剛好落在光線上，則只會計算一次。</span><span class="sxs-lookup"><span data-stu-id="95662-958">This guarantees that, if an end point ever lies exactly on the ray, it is only counted one time.</span></span> <span data-ttu-id="95662-959">相同的規則也可解決直線元素剛好在光線上的退化狀況。</span><span class="sxs-lookup"><span data-stu-id="95662-959">The same rule also solves the degenerate situation where the line element lies exactly on the ray.</span></span> <span data-ttu-id="95662-960">您不會遞增此線條元素的計數。</span><span class="sxs-lookup"><span data-stu-id="95662-960">You do not increment the count for this line element.</span></span>

<span data-ttu-id="95662-961">圖30顯示範例範圍的結果行元素，其中包含在不同位置的查詢點。</span><span class="sxs-lookup"><span data-stu-id="95662-961">Figure 30 shows the resulting line elements of a sample gamut with the query point in various positions.</span></span>

![此圖顯示範例範圍的結果線條元素，其中包含在不同位置的查詢點。](images/gmmp-image118.jpg)

<span data-ttu-id="95662-963">**圖 30** ： CheckGamut 的運作方式</span><span class="sxs-lookup"><span data-stu-id="95662-963">**Figure 30** : How CheckGamut works</span></span>

### <a name="minimum-color-difference-gamut-mapping"></a><span data-ttu-id="95662-964">最小色彩差異範圍對應</span><span class="sxs-lookup"><span data-stu-id="95662-964">Minimum Color Difference Gamut Mapping</span></span>

<span data-ttu-id="95662-965">最小色彩差異範圍對應（MinDEMap）具有簡單的規格：如果色彩是在範圍內，則不執行任何動作。</span><span class="sxs-lookup"><span data-stu-id="95662-965">The Minimum Color Difference Gamut Mapping, MinDEMap, has a simple specification: If a color is in-gamut, do nothing.</span></span> <span data-ttu-id="95662-966">如果色彩超出範圍，請將其投射至範圍界限上的「最接近」點。</span><span class="sxs-lookup"><span data-stu-id="95662-966">If a color is out-of-gamut, project it to the "nearest" point on the gamut boundary.</span></span> <span data-ttu-id="95662-967">在您指定要使用的色彩差異方程式之前，不會妥善定義關鍵字「最近」。</span><span class="sxs-lookup"><span data-stu-id="95662-967">The keyword "nearest" is not well-defined until you specify which color difference equation to use.</span></span> <span data-ttu-id="95662-968">在實務上，為了讓計算變得更簡單、更快速，所選色彩外觀空間的 Euclidean 距離或它的變異數，會用來做為色彩差異度量。</span><span class="sxs-lookup"><span data-stu-id="95662-968">In practice, to make computation easier and faster, the Euclidean distance of the chosen color appearance space, or a variant of it, is used as the color difference metric.</span></span> <span data-ttu-id="95662-969">Euclidean 度量的優點是它與空間的點乘積相容，因此可以使用線性代數。</span><span class="sxs-lookup"><span data-stu-id="95662-969">The advantage of the Euclidean metric is that it is compatible with the dot product of the space, which makes it possible to use linear algebra.</span></span> <span data-ttu-id="95662-970">詳細來說，如果空間中有定義「點乘積」，則可以將距離定義為差異向量的點乘積的平方根。</span><span class="sxs-lookup"><span data-stu-id="95662-970">In detail, if a "dot product" is defined in the space, then a distance can be defined as the square root of the dot product of the difference vector with itself.</span></span> <span data-ttu-id="95662-971">點乘積通常可以由正明確的3x3 矩陣 A 定義。</span><span class="sxs-lookup"><span data-stu-id="95662-971">A dot product can generally be defined by a positive definite 3x3 matrix A.</span></span>

<span data-ttu-id="95662-972">u？ v = u <sub>T</sub> Av</span><span class="sxs-lookup"><span data-stu-id="95662-972">u?v = u <sub>T</sub> Av</span></span>

<span data-ttu-id="95662-973">右側是一般矩陣乘法。</span><span class="sxs-lookup"><span data-stu-id="95662-973">where the right hand side is the usual matrix multiplication.</span></span> <span data-ttu-id="95662-974">如果是識別矩陣，則會復原標準的點乘積。</span><span class="sxs-lookup"><span data-stu-id="95662-974">If A is the identity matrix, the standard dot product is recovered.</span></span> <span data-ttu-id="95662-975">在實務上，如果 Jab 是色彩空間，您就不會想要混搭元件，因此可以使用標識矩陣以外的對角線矩陣。</span><span class="sxs-lookup"><span data-stu-id="95662-975">In practice, if Jab is the color space, you do not want to mix up the components, so a diagonal matrix other than the identity matrix can be used.</span></span> <span data-ttu-id="95662-976">此外，您可能會想要保持 a 和 b 的比例保持不變，以保留色調的量值。</span><span class="sxs-lookup"><span data-stu-id="95662-976">In addition, you might want to keep the scale on a and b unchanged so that the measure of hue is preserved.</span></span> <span data-ttu-id="95662-977">因此，標準 Euclidean 點產品有一個很好的變化，如下所示。</span><span class="sxs-lookup"><span data-stu-id="95662-977">So a useful variation of the standard Euclidean dot product is the following.</span></span>

<span data-ttu-id="95662-978">您)  (J 元件中的 w <sub>j</sub> (j 元件 v) + (您)  (a 的元件) b 元件的 v (</span><span class="sxs-lookup"><span data-stu-id="95662-978">w <sub>J</sub> (J component of u)(J component of v) + (a component of u)(a component of v) + (b component of u)(b component of v)</span></span>

<span data-ttu-id="95662-979">其中 w <sub>J</sub> 是正數。</span><span class="sxs-lookup"><span data-stu-id="95662-979">where w <sub>J</sub> is a positive number.</span></span> <span data-ttu-id="95662-980">其中一個進一步的變化是讓 w <sub>J</sub> 與輸入查詢點有所差異：</span><span class="sxs-lookup"><span data-stu-id="95662-980">One further variation is to let w <sub>J</sub> vary with the input query point:</span></span>

<span data-ttu-id="95662-981">w <sub>j \ =</sub> w <sub>j</sub> (queryPoint) </span><span class="sxs-lookup"><span data-stu-id="95662-981">w <sub>J\ =</sub> w <sub>J</sub> (queryPoint)</span></span>

<span data-ttu-id="95662-982">最終結果是與這兩個點有關的距離量值，而且在輸入查詢點不同的情況下，會有不同的亮度和色度或色調的相對權數。</span><span class="sxs-lookup"><span data-stu-id="95662-982">The end result is a measure of distance that is asymmetric with respect to the two points, and with different relative weights on lightness and chroma or hue as the input query point varies.</span></span> <span data-ttu-id="95662-983">這是根據人類色彩認知的一些觀察，而色彩差異在所有維度中都不會平均加權。</span><span class="sxs-lookup"><span data-stu-id="95662-983">This is in accordance with some observations about human color perception that color differences are not weighted equally in all dimensions.</span></span> <span data-ttu-id="95662-984">發現，人們對亮度之間的差異比對色調和色度的差異更不敏感。</span><span class="sxs-lookup"><span data-stu-id="95662-984">It has been found that people are less sensitive to differences in lightness than they are to differences in hue and chroma.</span></span>

<span data-ttu-id="95662-985">下列加權函數很有用。</span><span class="sxs-lookup"><span data-stu-id="95662-985">The following weight function is useful.</span></span>

<span data-ttu-id="95662-986">w <sub>J</sub> = k ₂-k ₁ (C-c m ₐₓ ) n</span><span class="sxs-lookup"><span data-stu-id="95662-986">w <sub>J</sub> = k ₂ - k ₁ (C - C ₘₐₓ ) ₙ</span></span>

<span data-ttu-id="95662-987">其中 k ₂ = 1，k ₁ = 0.75/ (C m ₐₓ ) n，C m ₐₓ = 100，n = 2 和 C 是查詢點和 C m ₐₓ的色度較小。</span><span class="sxs-lookup"><span data-stu-id="95662-987">where k ₂ = 1, k ₁ = 0.75/(C ₘₐₓ ) ₙ, C ₘₐₓ = 100, n = 2 and C is the smaller of chroma of the query point and C ₘₐₓ.</span></span>

<span data-ttu-id="95662-988">如此一來，當色度為零時，就會在 J 詞彙上放置0.25 的權數，而當色度為100時，則權數為1。</span><span class="sxs-lookup"><span data-stu-id="95662-988">so that a weight of 0.25 is put on the J term when chroma is zero, and a weight of 1 when chroma is 100.</span></span> <span data-ttu-id="95662-989">當色度很小時，在 J 上放置較少權數的趨勢，以及當色度很大時，J 上的更多權數，會遵循 CMC 和 CIEDE2000 的建議使用方式。</span><span class="sxs-lookup"><span data-stu-id="95662-989">The trend of putting less weight on J when chroma is small, and more weight on J when chroma is large follows the recommended usage for CMC and CIEDE2000.</span></span>

![此圖表顯示度量的 J 元件上的加權函數。](images/gmmp-image119.png)

<span data-ttu-id="95662-991">**圖 31** ：度量的 J 元件上的權數函數</span><span class="sxs-lookup"><span data-stu-id="95662-991">**Figure 31** : The weight function on the J component of the metric</span></span>

<span data-ttu-id="95662-992">使用 Jab 空間來執行下列範例。</span><span class="sxs-lookup"><span data-stu-id="95662-992">Use Jab space for the following example.</span></span> <span data-ttu-id="95662-993">需要搜尋所有界限三角形，以判斷 Euclidean 計量中最接近的點時，才需要進行計算。</span><span class="sxs-lookup"><span data-stu-id="95662-993">It is computationally demanding to search through all the boundary triangles to determine the closest point in the Euclidean metric.</span></span> <span data-ttu-id="95662-994">以下是一個簡單的方法，讓此程式盡可能有效率，而不會引進可能加速進程的其他假設，最後只會得到大約的答案。</span><span class="sxs-lookup"><span data-stu-id="95662-994">The following is a simple approach to make this process as efficient as possible, without introducing additional assumptions that may speed up the process but also end up in only an approximate answer.</span></span> <span data-ttu-id="95662-995">首先，您必須瞭解將某個點投射到給定三角形的幾何程式。</span><span class="sxs-lookup"><span data-stu-id="95662-995">First, it is necessary to understand the geometric procedure of projecting a point onto the given triangle.</span></span> <span data-ttu-id="95662-996">此處提供描述。</span><span class="sxs-lookup"><span data-stu-id="95662-996">A description is given here.</span></span>

<span data-ttu-id="95662-997">第一次執行包含三角形的無限平面上的正向投射。</span><span class="sxs-lookup"><span data-stu-id="95662-997">An orthogonal projection onto the infinite plane containing the triangle is first performed.</span></span> <span data-ttu-id="95662-998">從平面查詢點的最短距離可透過兩個步驟來決定。</span><span class="sxs-lookup"><span data-stu-id="95662-998">The shortest distance of the query point from the plane can be determined in two steps.</span></span>

<span data-ttu-id="95662-999">**()** 計算三角形的單位法線向量。</span><span class="sxs-lookup"><span data-stu-id="95662-999">**(a)** Calculate the unit normal vector to the triangle.</span></span>

<span data-ttu-id="95662-1000">**(b)** 計算單元一般向量的點乘積，以及從查詢點和三角形上的點形成的向量;也就是它的其中一個頂點。</span><span class="sxs-lookup"><span data-stu-id="95662-1000">**(b)** Calculate the dot product of the unit normal vector and a vector formed from the query point and a point on the triangle; that is, one of its vertices.</span></span> <span data-ttu-id="95662-1001">因為法線向量具有單位長度，所以這個點乘積的絕對值是從平面算起的查詢點距離。</span><span class="sxs-lookup"><span data-stu-id="95662-1001">Because the normal vector has unit length, the absolute value of this dot product is the distance of the query point from the plane.</span></span>

<span data-ttu-id="95662-1002">投射的點可能不是答案，因為它可能位於三角形之外。</span><span class="sxs-lookup"><span data-stu-id="95662-1002">The projected point might not be the answer, because it might lie outside the triangle.</span></span> <span data-ttu-id="95662-1003">因此，您必須先執行檢查。</span><span class="sxs-lookup"><span data-stu-id="95662-1003">So, you must perform a check first.</span></span> <span data-ttu-id="95662-1004">計算相當於計算相對於三角形的投射點 barycentric 座標。</span><span class="sxs-lookup"><span data-stu-id="95662-1004">The calculation is equivalent to calculating the barycentric coordinates of the projected point relative to the triangle.</span></span> <span data-ttu-id="95662-1005">如果投射的點是判斷在三角形內部，就是答案。</span><span class="sxs-lookup"><span data-stu-id="95662-1005">If the projected point is determined to be inside the triangle, it is the answer.</span></span> <span data-ttu-id="95662-1006">如果沒有，則會在三角形的其中一個邊緣取得最接近的點。</span><span class="sxs-lookup"><span data-stu-id="95662-1006">If not, the closest point is acquired on one of the edges of the triangle.</span></span> <span data-ttu-id="95662-1007">在三個邊緣上執行搜尋。</span><span class="sxs-lookup"><span data-stu-id="95662-1007">Perform a search on each of the three edges.</span></span> <span data-ttu-id="95662-1008">判斷查詢點在邊緣上的投射是類似于投影到三角形上的進程，但一個維度較小。</span><span class="sxs-lookup"><span data-stu-id="95662-1008">Determining the projection of the query point onto an edge is a process similar to projection onto the triangle, but one dimension less.</span></span> <span data-ttu-id="95662-1009">系統會先計算正向投射。</span><span class="sxs-lookup"><span data-stu-id="95662-1009">An orthogonal projection is first calculated.</span></span> <span data-ttu-id="95662-1010">如果投射點位於邊緣，則是答案。</span><span class="sxs-lookup"><span data-stu-id="95662-1010">If the projected point lies on the edge, it is the answer.</span></span> <span data-ttu-id="95662-1011">如果沒有，則會在兩個端點中的其中一個端點上取得最接近的點。</span><span class="sxs-lookup"><span data-stu-id="95662-1011">If not, the closest point is acquired on one of the two end points.</span></span> <span data-ttu-id="95662-1012">在兩個端點上執行搜尋;也就是說，會計算每個查詢點之間的距離，並比較哪一個較小。</span><span class="sxs-lookup"><span data-stu-id="95662-1012">Perform a search on the two end points; that is, calculate the distance of query point from each one, and compare which one is smaller.</span></span>

<span data-ttu-id="95662-1013">仔細檢查顯示當您流覽所有三角形時，有許多重複的搜尋，因為邊緣一律會由兩個三角形共用，而一個頂點則由至少三個邊緣所共用。</span><span class="sxs-lookup"><span data-stu-id="95662-1013">Careful examination reveals that there is a lot of repeated searching when you go through all the triangles because an edge is always shared by two triangles, and a vertex shared by at least three edges.</span></span> <span data-ttu-id="95662-1014">此外，您不太希望尋找最接近某個特定三角形的點;相反地，您會想要找出最接近整個範圍界限的點。</span><span class="sxs-lookup"><span data-stu-id="95662-1014">In addition, you are not much interested in finding the closest point to one particular triangle; instead you are interested in finding the closest point to the whole gamut boundary.</span></span> <span data-ttu-id="95662-1015">但是，其中一個特定的三角形就是達成此目的的一個。</span><span class="sxs-lookup"><span data-stu-id="95662-1015">However,one particular triangle would be the one in which this is achieved.</span></span> <span data-ttu-id="95662-1016">有兩種策略可用來加快搜尋速度。</span><span class="sxs-lookup"><span data-stu-id="95662-1016">There are two strategies that you can use to speed up the search.</span></span>

<span data-ttu-id="95662-1017">**策略 I**。每個頂點最多隻會處理一次。</span><span class="sxs-lookup"><span data-stu-id="95662-1017">**Strategy I**. Each vertex will be processed, at most, once.</span></span> <span data-ttu-id="95662-1018">每個邊緣最多隻會處理一次。</span><span class="sxs-lookup"><span data-stu-id="95662-1018">Each edge will be processed, at most, once.</span></span>

<span data-ttu-id="95662-1019">**策略 II**。</span><span class="sxs-lookup"><span data-stu-id="95662-1019">**Strategy II**.</span></span> <span data-ttu-id="95662-1020">在搜尋中的任何時間點，您都有相對應的最佳距離的最佳候選。</span><span class="sxs-lookup"><span data-stu-id="95662-1020">At any point in the search, you have a best candidate with the corresponding best distance.</span></span> <span data-ttu-id="95662-1021">如果您可以透過快速檢查來判斷三角形不能提供更好的距離，就不需要再繼續計算。</span><span class="sxs-lookup"><span data-stu-id="95662-1021">If you can determine, by a quick check, that a triangle is not capable of giving a better distance, there is no need to continue the calculation further.</span></span> <span data-ttu-id="95662-1022">此三角形不需要最接近的點和距離。</span><span class="sxs-lookup"><span data-stu-id="95662-1022">You do not need the closest point and distance for this triangle.</span></span>

![顯示最小取消對應流程的圖表。](images/gmmp-image120.png)

<span data-ttu-id="95662-1024">**圖 32** ：最少的取消對應示意圖</span><span class="sxs-lookup"><span data-stu-id="95662-1024">**Figure 32** : Minimum DE Mapping schematics</span></span>

<span data-ttu-id="95662-1025">圖32顯示「gamut 地圖 MinDEMap 的一般邏輯流程。</span><span class="sxs-lookup"><span data-stu-id="95662-1025">Figure 32 shows the general flow of logic for the gamut map MinDEMap.</span></span> <span data-ttu-id="95662-1026">若為查詢點，則會先叫用 CheckGamut 函數。</span><span class="sxs-lookup"><span data-stu-id="95662-1026">For a query point, the CheckGamut function is first invoked.</span></span> <span data-ttu-id="95662-1027">如果這個點是在範圍內，則地圖不會有任何作用。</span><span class="sxs-lookup"><span data-stu-id="95662-1027">If the point is in-gamut, the map is a no-op.</span></span> <span data-ttu-id="95662-1028">如果該點超出範圍，請呼叫 ProjectPointToBoundary。</span><span class="sxs-lookup"><span data-stu-id="95662-1028">If the point is out-of-gamut, call ProjectPointToBoundary.</span></span> <span data-ttu-id="95662-1029">現在請繼續進行圖33。</span><span class="sxs-lookup"><span data-stu-id="95662-1029">Now move on to Figure 33.</span></span> <span data-ttu-id="95662-1030">此時，會假設已計算下列值。</span><span class="sxs-lookup"><span data-stu-id="95662-1030">At this point, it is assumed that the following values have been computed.</span></span>

<span data-ttu-id="95662-1031">**()** 相對於標準點乘積的每個範圍界限三角形的單位法線向量。</span><span class="sxs-lookup"><span data-stu-id="95662-1031">**(a)** Unit normal vector to each Gamut Boundary Triangle with respect to the standard dot product.</span></span>

<span data-ttu-id="95662-1032">**(b)** 頂點清單和邊緣清單（除了三角形清單以外）。</span><span class="sxs-lookup"><span data-stu-id="95662-1032">**(b)** Vertex list and edge list, in addition to the triangle list.</span></span>

![顯示 ' ProjectPointToBoundary ' 常式的圖表。](images/gmmp-image122.jpg)

<span data-ttu-id="95662-1034">**圖 33** ： ProjectPointToBoundary 常式</span><span class="sxs-lookup"><span data-stu-id="95662-1034">**Figure 33** : The ProjectPointToBoundary routine</span></span>

<span data-ttu-id="95662-1035">這些都是固定的負荷，如果對此範圍界限進行足夠的查詢，就會降低成本。</span><span class="sxs-lookup"><span data-stu-id="95662-1035">All these are constant overhead, and would have diminishing cost if sufficient queries to this gamut boundary are made.</span></span> <span data-ttu-id="95662-1036">一般來說，當您建立從某個裝置到另一個裝置的轉換 LUT 時，只有兩個固定的 gamuts，而轉換 LUT 會在一致取樣方格上的點執行。</span><span class="sxs-lookup"><span data-stu-id="95662-1036">Usually, this is the case when you build a transform LUT from one device to another, where there are only two fixed gamuts, and the transform LUT runs through points on the uniformly sampled grid.</span></span> <span data-ttu-id="95662-1037">您可以預先計算標準點乘積的一般向量，即使 perpendicularity 的概念會以加權的點乘積為基礎，但這取決於先前所述的查詢點。</span><span class="sxs-lookup"><span data-stu-id="95662-1037">You pre-compute the normal vectors with respect to the standard dot product, even though the notion of perpendicularity will be based on the weighted dot product, which depends on the query point as explained previously.</span></span> <span data-ttu-id="95662-1038">原因是因為相對於標準的點乘積，與加權點乘積相關的一般向量可以輕易地從一般向量取得。</span><span class="sxs-lookup"><span data-stu-id="95662-1038">The reason is because a normal vector with respect to the weighted dot product can be obtained easily from the normal vector with respect to the standard dot product.</span></span> <span data-ttu-id="95662-1039">如果 n ₀是與標準點乘積相關的一般向量，則</span><span class="sxs-lookup"><span data-stu-id="95662-1039">If n ₀ is a normal vector with respect to the standard dot product, then</span></span>

<span data-ttu-id="95662-1040">n = (J-n ₀/w <sub>j</sub>的元件，n ₀的 a 元件，b-n ₀的元件 ) </span><span class="sxs-lookup"><span data-stu-id="95662-1040">n = (J-component of n ₀ /w <sub>J</sub>, a-component of n ₀, b-component of n ₀ )</span></span>

<span data-ttu-id="95662-1041">與加權點乘積相關的三角形是正常的。</span><span class="sxs-lookup"><span data-stu-id="95662-1041">is normal to the triangle with respect to the weighted dot product.</span></span> <span data-ttu-id="95662-1042">由於這種關聯性，即使必須根據查詢點來調整，還是可以預先計算 n 個₀。</span><span class="sxs-lookup"><span data-stu-id="95662-1042">Because of this relationship, it is still beneficial to pre-compute n ₀ even though it must be adjusted based on the query point.</span></span>

<span data-ttu-id="95662-1043">ProjectPointToBoundary 常式一開始會重設頂點和邊緣的「處理歷程記錄」。</span><span class="sxs-lookup"><span data-stu-id="95662-1043">The ProjectPointToBoundary routine starts by resetting the "processed history" of the vertices and edges.</span></span> <span data-ttu-id="95662-1044">這些是布林值旗標的表格，可追蹤是否已造訪頂點或邊緣。</span><span class="sxs-lookup"><span data-stu-id="95662-1044">These are tables of BOOLEAN flags that track whether a vertex or edge has been visited before.</span></span> <span data-ttu-id="95662-1045">它也會將變數 ShortestDistance 重設為「無限大」，這是使用的浮點數系統中的最大編碼值。</span><span class="sxs-lookup"><span data-stu-id="95662-1045">It also resets the variable ShortestDistance to "INFINITY," which is the maximum encoded value in the floating-point number system used.</span></span> <span data-ttu-id="95662-1046">然後，它會在迴圈中執行，並使用 ProcessTriangle 呼叫來搜尋每個三角形中最接近的點。</span><span class="sxs-lookup"><span data-stu-id="95662-1046">Then it runs through a loop, searching for the closest point from each triangle using the ProcessTriangle call.</span></span> <span data-ttu-id="95662-1047">ProcessTriangle 是更新 ShortestDistance 變數並清楚地在關鍵迴圈中的常式。</span><span class="sxs-lookup"><span data-stu-id="95662-1047">ProcessTriangle is the routine to update the ShortestDistance variable and is clearly in the critical loop.</span></span> <span data-ttu-id="95662-1048">其中一個優化是在結果夠好時停止。</span><span class="sxs-lookup"><span data-stu-id="95662-1048">One optimization is to stop when the result is good enough.</span></span> <span data-ttu-id="95662-1049">每次呼叫 ProcessTriangle 之後，都會檢查變數 ShortestDistance。</span><span class="sxs-lookup"><span data-stu-id="95662-1049">After each call to ProcessTriangle, the variable ShortestDistance is examined.</span></span> <span data-ttu-id="95662-1050">如果它符合預先定義的閾值，您可以停止。</span><span class="sxs-lookup"><span data-stu-id="95662-1050">If it satisfies a predefined threshold, you can stop.</span></span> <span data-ttu-id="95662-1051">預先定義的閾值取決於所使用的色彩空間，以及色彩影像系統所需的精確度。</span><span class="sxs-lookup"><span data-stu-id="95662-1051">The predefined threshold is dependent on the color space used and on the required accuracy of the color imaging system.</span></span> <span data-ttu-id="95662-1052">若為一般應用程式，如果色彩差異小於人為視覺組合的色彩差異，您就不會想要執行不必要的工作。</span><span class="sxs-lookup"><span data-stu-id="95662-1052">For a typical application, you do not want to do unnecessary work if the color difference is less than what can be discerned by human vision.</span></span> <span data-ttu-id="95662-1053">若為 CIECAM02，此色彩差異為1。</span><span class="sxs-lookup"><span data-stu-id="95662-1053">For CIECAM02, this color difference is 1.</span></span> <span data-ttu-id="95662-1054">不過，在實值中使用臨界值0.005，以保留計算的精確度，因為這可能只是轉換鏈中的中繼步驟。</span><span class="sxs-lookup"><span data-stu-id="95662-1054">Use a threshold value of 0.005 in the implementation, however, to preserve the precision of computations, because this might be only an intermediate step in a chain of transforms.</span></span>

<span data-ttu-id="95662-1055">ProcessTriangle 會實施上述的策略 II。</span><span class="sxs-lookup"><span data-stu-id="95662-1055">ProcessTriangle implements the preceding Strategy II.</span></span> <span data-ttu-id="95662-1056">從預先計算的單位正常向量到與標準點乘積相關的三角形取得一般向量，它會藉由構成單位法線向量和 queryVector 的點乘積（從三角形 vertex1 的其中一個頂點到查詢點的向量），來計算查詢點與包含三角形的無限平面之間的距離, queryPoint.</span><span class="sxs-lookup"><span data-stu-id="95662-1056">Obtaining a normal vector from the pre-computed unit normal vector to the triangle with respect to the standard dot product, it computes the distance of the query point to the infinite plane containing the triangle by forming the dot product of the unit normal vector and the queryVector, the vector from one of the vertices of the triangle, vertex1, to the query point, queryPoint.</span></span>

<span data-ttu-id="95662-1057">queryVector = queryPoint-vertex1</span><span class="sxs-lookup"><span data-stu-id="95662-1057">queryVector = queryPoint - vertex1</span></span>

<span data-ttu-id="95662-1058">距離 = \| normalVector \* queryVector \| / \| \| normalVector\|\|</span><span class="sxs-lookup"><span data-stu-id="95662-1058">distance = \| normalVector \* queryVector \|/\|\|normalVector\|\|</span></span>

<span data-ttu-id="95662-1059">這是相對較便宜的計算，而且需要距離以執行進一步的計算。</span><span class="sxs-lookup"><span data-stu-id="95662-1059">This is a relatively inexpensive calculation, and the distance is required to carry out further calculations.</span></span> <span data-ttu-id="95662-1060">如果這個距離不小於目前的最大距離（ShortestDistance），這個三角形將不會產生更好的距離，因為它不會提供比包含它的平面更好的距離。</span><span class="sxs-lookup"><span data-stu-id="95662-1060">If this distance is not less than the current best distance, ShortestDistance, this triangle will not produce a better distance, because it will not give a better distance than the plane containing it.</span></span> <span data-ttu-id="95662-1061">在此情況下，您會將控制權交還給三角形迴圈。</span><span class="sxs-lookup"><span data-stu-id="95662-1061">In this case, you return control to the triangle loop.</span></span> <span data-ttu-id="95662-1062">如果距離小於 ShortestDistance，您可能會有較接近的點（如果這個點位於三角形內）。</span><span class="sxs-lookup"><span data-stu-id="95662-1062">If the distance is smaller than ShortestDistance, potentially, you have a closer point, if this point lies inside the triangle.</span></span> <span data-ttu-id="95662-1063">您必須執行一些「硬運算」計算 (但除了線性代數) 之外，還沒辦法判斷這一點。</span><span class="sxs-lookup"><span data-stu-id="95662-1063">You must perform some "hard" calculations (though nothing beyond linear algebra) to determine that.</span></span> <span data-ttu-id="95662-1064">如果三角形的其他兩個頂點是 vertex2 和 vertex3，則形成基礎向量 firstBasisVector 和 secondBasisVector。</span><span class="sxs-lookup"><span data-stu-id="95662-1064">If the other two vertices of the triangle are vertex2 and vertex3, then form the basis vectors firstBasisVector and secondBasisVector.</span></span>

<span data-ttu-id="95662-1065">firstBasisVector = vertex2-vertex1</span><span class="sxs-lookup"><span data-stu-id="95662-1065">firstBasisVector = vertex2 - vertex1</span></span>

<span data-ttu-id="95662-1066">secondBasisVector = vertex3-vertex1</span><span class="sxs-lookup"><span data-stu-id="95662-1066">secondBasisVector = vertex3 - vertex1</span></span>

<span data-ttu-id="95662-1067">使用下列方程式線性系統來解決您和 v 的未知問題。</span><span class="sxs-lookup"><span data-stu-id="95662-1067">Use the following linear system of equations to solve for unknowns u and v.</span></span>

<span data-ttu-id="95662-1068">firstBasisVector \* queryVector = (firstBasisVector \* firstBasisVector) u + (firstBasisVector \* secondBasisVector) v</span><span class="sxs-lookup"><span data-stu-id="95662-1068">firstBasisVector \* queryVector = (firstBasisVector \* firstBasisVector)u + (firstBasisVector \* secondBasisVector)v</span></span>

<span data-ttu-id="95662-1069">secondBasisVector \* queryVector = (secondBasisVector \* firstBasisVector) u + (secondBasisVector \* secondBasisVector) v</span><span class="sxs-lookup"><span data-stu-id="95662-1069">secondBasisVector \* queryVector = (secondBasisVector \* firstBasisVector)u + (secondBasisVector \* secondBasisVector)v</span></span>

<span data-ttu-id="95662-1070">而投影點在三角形內的條件如下：</span><span class="sxs-lookup"><span data-stu-id="95662-1070">and the conditions for the projected point to lie inside the triangle are:</span></span>

<span data-ttu-id="95662-1071">0≤ u ≤1、0≤ v ≤1和您 + v ≤1</span><span class="sxs-lookup"><span data-stu-id="95662-1071">0 ≤ u ≤ 1, 0 ≤ v ≤ 1 and u + v ≤ 1</span></span>

<span data-ttu-id="95662-1072">在這項計算之後，如果判斷出投射的點是在三角形中，則表示您找到新的最接近點;您在一開始計算的距離是新的最短距離。</span><span class="sxs-lookup"><span data-stu-id="95662-1072">After this calculation, if it is determined that the projected point lies within the triangle, then you have found a new closest point; the distance that you calculated at the beginning is the new shortest distance.</span></span> <span data-ttu-id="95662-1073">在此情況下，請更新 ShortestDistance 和 ClosestPoint 變數。</span><span class="sxs-lookup"><span data-stu-id="95662-1073">In this case, update the variables ShortestDistance and ClosestPoint.</span></span> <span data-ttu-id="95662-1074">如果投射的點位於三角形之外，您可能會在其中一個邊緣找到更接近的點。</span><span class="sxs-lookup"><span data-stu-id="95662-1074">If the projected point lies outside the triangle, you might find a closer point on one of its edges.</span></span> <span data-ttu-id="95662-1075">因此，您可以在這三個邊緣上呼叫 ProcessEdge 常式。</span><span class="sxs-lookup"><span data-stu-id="95662-1075">So, you can call the ProcessEdge routine on each of the three edges.</span></span>

![顯示 ProcessEdge 和 ProcessVertex 常式流程的圖表。](images/gmmp-image124.jpg)

<span data-ttu-id="95662-1077">**圖 34** ： ProcessEdge 和 ProcessVertex 常式</span><span class="sxs-lookup"><span data-stu-id="95662-1077">**Figure 34** : ProcessEdge and ProcessVertex routines</span></span>

<span data-ttu-id="95662-1078">ProcessEdge 常式會實行策略 I，如圖34所示。</span><span class="sxs-lookup"><span data-stu-id="95662-1078">The ProcessEdge routine implements Strategy I, which is illustrated in Figure 34.</span></span> <span data-ttu-id="95662-1079">ProcessEdge 一開始會先檢查邊緣是否經過處理。</span><span class="sxs-lookup"><span data-stu-id="95662-1079">ProcessEdge starts by checking whether the edge has been processed before.</span></span> <span data-ttu-id="95662-1080">如果是，則不會採取進一步的動作。</span><span class="sxs-lookup"><span data-stu-id="95662-1080">If so, no further action is taken.</span></span> <span data-ttu-id="95662-1081">如果不是，則會繼續將查詢點的正向投射計算到包含邊緣的無限行。</span><span class="sxs-lookup"><span data-stu-id="95662-1081">If not, it proceeds to calculate the orthogonal projection of the query point onto the infinite line containing the edge.</span></span> <span data-ttu-id="95662-1082">計算中所涉及的線性代數類似于前一個三角形方程式。</span><span class="sxs-lookup"><span data-stu-id="95662-1082">The linear algebra involved in the calculation is similar to the previous triangle equations.</span></span> <span data-ttu-id="95662-1083">不過，這項計算比較簡單，但這裡並未說明。</span><span class="sxs-lookup"><span data-stu-id="95662-1083">However, the calculation is simpler, it is not described here.</span></span> <span data-ttu-id="95662-1084">如果投射的點位於邊緣內，則您會發現投影點與查詢點之間的距離。</span><span class="sxs-lookup"><span data-stu-id="95662-1084">If the projected point lies within the edge, you find the distance of the projected point from the query point.</span></span> <span data-ttu-id="95662-1085">如果這個距離小於 ShortestDistance，您就可以找到最近的最新點。</span><span class="sxs-lookup"><span data-stu-id="95662-1085">If this distance is smaller than ShortestDistance, you have found a new closest point.</span></span> <span data-ttu-id="95662-1086">更新 ShortestDistance 和 ClosestPoint。</span><span class="sxs-lookup"><span data-stu-id="95662-1086">Update both ShortestDistance and ClosestPoint.</span></span> <span data-ttu-id="95662-1087">如果投射的點位於邊緣之外，請在兩個端點上呼叫 ProcessVertex。</span><span class="sxs-lookup"><span data-stu-id="95662-1087">If the projected point lies outside the edge, call ProcessVertex on the two end points.</span></span> <span data-ttu-id="95662-1088">傳回控制權之前，請更新 edge 歷程記錄，讓此 edge 標示為「已處理」。</span><span class="sxs-lookup"><span data-stu-id="95662-1088">Before returning control, update the edge history so that this edge is marked as "PROCESSED."</span></span>

<span data-ttu-id="95662-1089">最後，您會提供 ProcessVertex 的描述。</span><span class="sxs-lookup"><span data-stu-id="95662-1089">Finally, you give a description of ProcessVertex.</span></span> <span data-ttu-id="95662-1090">ProjectVertex 常式也會實行策略，並維護頂點歷程記錄資料表。</span><span class="sxs-lookup"><span data-stu-id="95662-1090">The ProjectVertex routine also implements Strategy I and maintains a vertex history table.</span></span> <span data-ttu-id="95662-1091">如圖34所示，它會先檢查是否已處理過頂點。</span><span class="sxs-lookup"><span data-stu-id="95662-1091">As illustrated in Figure 34, it first checks whether the vertex has been processed before.</span></span> <span data-ttu-id="95662-1092">如果是，則不會採取進一步的動作。</span><span class="sxs-lookup"><span data-stu-id="95662-1092">If so, no further action is taken.</span></span> <span data-ttu-id="95662-1093">如果沒有，則會繼續計算頂點與查詢點之間的距離。</span><span class="sxs-lookup"><span data-stu-id="95662-1093">If not, it proceeds to calculate the distance of the vertex from the query point.</span></span> <span data-ttu-id="95662-1094">如果距離小於 ShortestDistance，請更新 ShortestDistance 和 ClosestPoint。</span><span class="sxs-lookup"><span data-stu-id="95662-1094">If the distance is smaller than ShortestDistance, update both ShortestDistance and ClosestPoint.</span></span> <span data-ttu-id="95662-1095">最後，它會更新頂點歷程記錄，讓這個頂點標示為「已處理」。</span><span class="sxs-lookup"><span data-stu-id="95662-1095">At the end, it updates the vertex history so that this vertex is marked as "PROCESSED."</span></span>

<span data-ttu-id="95662-1096">當外部控制迴圈已耗盡所有三角形，或在達到色彩差異閾值之前結束時，就會存取變數 ClosestPoint。</span><span class="sxs-lookup"><span data-stu-id="95662-1096">When the outer control loop has either exhausted all the triangles or exited before color difference threshold has been met, the variable ClosestPoint is accessed.</span></span> <span data-ttu-id="95662-1097">這是 MinDEMap 的結果。</span><span class="sxs-lookup"><span data-stu-id="95662-1097">This is the result of MinDEMap.</span></span> <span data-ttu-id="95662-1098">如果有興趣瞭解對應色彩與查詢色彩之間的距離，呼叫者也可以取出 ShortestDistance。</span><span class="sxs-lookup"><span data-stu-id="95662-1098">The caller can also retrieve ShortestDistance if interested in how far the mapped color is from the query color.</span></span>

### <a name="hue-smoothing"></a><span data-ttu-id="95662-1099">色調平滑</span><span class="sxs-lookup"><span data-stu-id="95662-1099">Hue Smoothing</span></span>

![顯示兩個色調凹凸貼圖的圖表，也就是頂端和色調在底部平滑的色調。](images/gmmp-image125.png)

<span data-ttu-id="95662-1101">**圖 35** ：色調平滑</span><span class="sxs-lookup"><span data-stu-id="95662-1101">**Figure 35** : Hue Smoothing</span></span>

<span data-ttu-id="95662-1102">具有色調條件約束的作業會發生問題;也就是說，此作業只會考慮色調平面內的變數。</span><span class="sxs-lookup"><span data-stu-id="95662-1102">An issue arises with operations that are hue constrained; that is, the operation only considers variables within a hue plane.</span></span> <span data-ttu-id="95662-1103">圖35顯示藍色色相中「不連續」的色調配量範例。</span><span class="sxs-lookup"><span data-stu-id="95662-1103">Figure 35 shows an example of a gamut exhibiting "discontinuous" hue slices in the blue hues.</span></span> <span data-ttu-id="95662-1104">在這個色調範圍內，針對特定色調角度，範圍界限會與色調平面相切。</span><span class="sxs-lookup"><span data-stu-id="95662-1104">Within this hue range, for certain hue angles, the gamut boundary is tangential to the hue plane.</span></span> <span data-ttu-id="95662-1105">實際上，這會導致色調配量的拓撲結構變更。</span><span class="sxs-lookup"><span data-stu-id="95662-1105">In effect, this causes a change in the topological structure of the hue slices.</span></span> <span data-ttu-id="95662-1106">在顯示的範例中，當色調平面跨此色調範圍進行掃描時，會出現「島」並 submerges。</span><span class="sxs-lookup"><span data-stu-id="95662-1106">In the example shown, as the hue plane sweeps across this hue range, an "island" emerges and submerges.</span></span> <span data-ttu-id="95662-1107">拓撲中的這項變更會導致特定色調的作業不連續。</span><span class="sxs-lookup"><span data-stu-id="95662-1107">This change in topology will cause hue specific operations to be discontinuous.</span></span> <span data-ttu-id="95662-1108">例如，固定色調的尖點會隨著色調角度在此範圍內的變化而突然變更。</span><span class="sxs-lookup"><span data-stu-id="95662-1108">For example, the cusp at fixed hue will change abruptly as the hue angle changes across this range.</span></span>

<span data-ttu-id="95662-1109">有一種色彩科學原因需要在特定作業中保留色調。</span><span class="sxs-lookup"><span data-stu-id="95662-1109">There is a color science reason why it is desirable to preserve hue in certain operations.</span></span> <span data-ttu-id="95662-1110">若要解決上述問題，原始的範圍界限三角形必須是「色調平滑」。</span><span class="sxs-lookup"><span data-stu-id="95662-1110">To resolve the preceding issue, the original Gamut Boundary Triangles must be "hue smoothed."</span></span> <span data-ttu-id="95662-1111">一般而言，一組範圍界限三角形的色調平滑處理是一組三角形，因此 () 它會形成新的「範圍」的界限，這可能不會對應到實際的裝置範圍，且包含原始三角形集所定義的範圍;和 (b) 新集合中的三角形會系結至不平行到色調平面。</span><span class="sxs-lookup"><span data-stu-id="95662-1111">Generally speaking, a hue smoothing of a set of Gamut Boundary Triangles is a set of triangles such that (a) it forms the boundary of a new "gamut," which might not correspond to the actual device gamut, and that contains the gamut defined by the original set of triangles; and (b) the triangles in the new set are bounded away from being parallel to the hue planes.</span></span>

<span data-ttu-id="95662-1112">取得一組色相平滑三角形的實際方式，就是採用原始頂點的凸殼。</span><span class="sxs-lookup"><span data-stu-id="95662-1112">One practical way to obtain a hue smoothed set of triangles is to take the convex hull of the original vertices.</span></span> <span data-ttu-id="95662-1113">如圖35所示，凸殼的色調配量在有問題的色調範圍中會有平滑的變化，而不會突然變更拓撲。</span><span class="sxs-lookup"><span data-stu-id="95662-1113">As illustrated in Figure 35, the hue slices of the convex hull vary smoothly in the problematic hue range without a sudden change in topology.</span></span>

### <a name="setting-primaries-and-secondaries-in-the-gamut-boundary-description"></a><span data-ttu-id="95662-1114">在範圍界限描述中設定主要複本和次要資料庫</span><span class="sxs-lookup"><span data-stu-id="95662-1114">Setting Primaries and Secondaries in the Gamut Boundary Description</span></span>

<span data-ttu-id="95662-1115">某些範圍對應方法（例如 HueMap）取決於裝置主要複本和次要資料庫的位置。</span><span class="sxs-lookup"><span data-stu-id="95662-1115">Certain gamut mapping methods, such as HueMap, depend on the location of the device primaries and secondaries.</span></span> <span data-ttu-id="95662-1116">若為加法類裝置，主要複本為紅色、綠色和藍色 (R、G 和 B) ;而次要資料庫為青色、洋紅和黃色 (C、M 和 Y) 。</span><span class="sxs-lookup"><span data-stu-id="95662-1116">For additive devices, the primaries are red, green, and blue (R, G, and B); and the secondaries are cyan, magenta, and yellow (C, M, and Y).</span></span> <span data-ttu-id="95662-1117">針對 subtractive 裝置，主要複本是 C、M 和 Y;而次要資料庫為 R、G 和 B。GBD 會追蹤 Jab 色彩值陣列中的所有六個值，加上白色和黑色 (W 和 K) 。</span><span class="sxs-lookup"><span data-stu-id="95662-1117">For subtractive devices, the primaries are C, M, and Y; and the secondaries are R, G, and B. The GBD keeps track of all six of those values, plus white and black (W and K), in a array of Jab color values.</span></span> <span data-ttu-id="95662-1118">這些值會在建立時設定為範圍界限描述。</span><span class="sxs-lookup"><span data-stu-id="95662-1118">These values are set into the gamut boundary description when it is created.</span></span> <span data-ttu-id="95662-1119">針對輸出裝置，可以透過裝置模型執行裝置控制值的組合來判斷主要複本。</span><span class="sxs-lookup"><span data-stu-id="95662-1119">For output devices, the primaries can be determined by running combinations of device control values through the device model.</span></span> <span data-ttu-id="95662-1120">針對 capture 裝置，這個方法並不適合用來建立參考 GBD，因為幾乎無法抓取產生完全飽和純設備值的映射，例如 (0.0、0.0、1.0) 。</span><span class="sxs-lookup"><span data-stu-id="95662-1120">For capture devices, this approach is not well-suited for creating the reference GBD, because it is almost impossible to capture an image that yields a fully saturated pure device value, such as (0.0, 0.0, 1.0).</span></span> <span data-ttu-id="95662-1121">WCS 裝置設定檔包含主要複本在捕獲目標中的索引。</span><span class="sxs-lookup"><span data-stu-id="95662-1121">WCS device profiles contain the indices of the primaries in the capture target.</span></span> <span data-ttu-id="95662-1122">因為這些值不包含在 ICC 設定檔中，所以在轉換成 Jab 之後，請使用從一般掃描器目標測量的值（相對於 ICC 的查看條件）。</span><span class="sxs-lookup"><span data-stu-id="95662-1122">Because these values are not contained in an ICC profile, use values measured from a typical scanner target after converting to Jab, relative to the ICC viewing conditions.</span></span>

### <a name="setting-the-neutral-axis-in-the-gamut-boundary-description"></a><span data-ttu-id="95662-1123">在色域界限描述中設定中性軸</span><span class="sxs-lookup"><span data-stu-id="95662-1123">Setting the Neutral Axis in the Gamut Boundary Description</span></span>

<span data-ttu-id="95662-1124">HueMap 和相對 MinCD gamut 的對應方法會使用裝置中性軸來進行伸直。</span><span class="sxs-lookup"><span data-stu-id="95662-1124">The HueMap and the Relative MinCD gamut mapping methods use the device neutral axis for straightening.</span></span> <span data-ttu-id="95662-1125">針對基準輸出裝置，可透過 DeviceToColorimetric 方法執行 R = G = B 或 C = M = Y)  (R = G = B 或 C = M = Y 來判斷中性軸，然後透過 CIECAM02 物件的 ColorimetricToAppearance 方法來決定。</span><span class="sxs-lookup"><span data-stu-id="95662-1125">For the baseline output devices, the neutral axis can be determined by running device neutral values (R=G=B or C=M=Y) through the DeviceToColorimetric method, and then through the ColorimetricToAppearance method of the CIECAM02 object.</span></span> <span data-ttu-id="95662-1126">不過，當使用中性樣本呈現時，捕捉裝置不一定會傳回裝置中立值。</span><span class="sxs-lookup"><span data-stu-id="95662-1126">However, capture devices do not always return a device neutral value when presented with a neutral sample.</span></span> <span data-ttu-id="95662-1127">當環境光源並非完全中立時，尤其如此。</span><span class="sxs-lookup"><span data-stu-id="95662-1127">This is particularly true when the ambient lighting is not perfectly neutral.</span></span> <span data-ttu-id="95662-1128">WCS 裝置設定檔包含目標中中性樣本的索引。</span><span class="sxs-lookup"><span data-stu-id="95662-1128">WCS device profiles contain the indices of the neutral samples in the target.</span></span> <span data-ttu-id="95662-1129">使用這些範例來設定中性軸。</span><span class="sxs-lookup"><span data-stu-id="95662-1129">Use those samples to set the neutral axis.</span></span> <span data-ttu-id="95662-1130">因為這項資訊不適用於 ICC 設定檔，所以您必須使用用於輸出裝置的相同方法;透過 DeviceToColorimetric 方法執行裝置中性範例，然後將輸入值和色度結果結合在一起。</span><span class="sxs-lookup"><span data-stu-id="95662-1130">Because this information is not available for ICC profiles, you must use the same method that is used for output devices; run device neutral samples through the DeviceToColorimetric method, and then couple the input values and the colorimetric results.</span></span>

## <a name="related-topics"></a><span data-ttu-id="95662-1131">相關主題</span><span class="sxs-lookup"><span data-stu-id="95662-1131">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="95662-1132">基本色彩管理概念</span><span class="sxs-lookup"><span data-stu-id="95662-1132">Basic color management concepts</span></span>](basic-color-management-concepts.md)
</dt> <dt>

[<span data-ttu-id="95662-1133">Windows 色彩系統架構和演算法</span><span class="sxs-lookup"><span data-stu-id="95662-1133">Windows Color System Schemas and Algorithms</span></span>](windows-color-system-schemas-and-algorithms.md)
</dt> </dl>

 

 




