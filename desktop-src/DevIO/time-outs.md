---
description: 通訊資源的控制碼有一組相關聯的超時參數，這些參數會影響讀取和寫入作業的行為。
ms.assetid: 271d4c68-1f6d-4483-a9a1-703220de761f
title: 逾時
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6db31fafc0f4d98832f1fb7fa5d22b32cba33d73
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "103688844"
---
# <a name="time-outs"></a><span data-ttu-id="90afd-103">逾時</span><span class="sxs-lookup"><span data-stu-id="90afd-103">Time-Outs</span></span>

<span data-ttu-id="90afd-104">通訊資源的控制碼有一組相關聯的超時參數，這些參數會影響讀取和寫入作業的行為。</span><span class="sxs-lookup"><span data-stu-id="90afd-104">A handle to a communications resource has an associated set of time-out parameters that affect the behavior of read and write operations.</span></span> <span data-ttu-id="90afd-105">逾時間隔可能會導致 [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile)、 [**ReadFileEx**](/windows/desktop/api/fileapi/nf-fileapi-readfileex)、 [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile)或 [**WriteFileEx**](/windows/desktop/api/fileapi/nf-fileapi-writefileex) 作業結束，即使未讀取或寫入指定的字元數也是一樣。</span><span class="sxs-lookup"><span data-stu-id="90afd-105">Time-outs can cause a [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**ReadFileEx**](/windows/desktop/api/fileapi/nf-fileapi-readfileex), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile), or [**WriteFileEx**](/windows/desktop/api/fileapi/nf-fileapi-writefileex) operation to conclude when a time-out interval elapses, even though the specified number of characters have not been read or written.</span></span> <span data-ttu-id="90afd-106">在讀取或寫入作業期間發生超時時，不會將它視為錯誤 (也就是說，讀取或寫入函式的傳回值表示成功) 。</span><span class="sxs-lookup"><span data-stu-id="90afd-106">It is not treated as an error when a time-out occurs during a read or write operation (that is, the read or write function's return value indicates success).</span></span> <span data-ttu-id="90afd-107">實際讀取或寫入的位元組計數是由 **ReadFile** 或 **WriteFile** (或 [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) 或 [**FileIOCompletionRoutine**](/windows/desktop/api/minwinbase/nc-minwinbase-lpoverlapped_completion_routine) 函式報告，如果 i/o 是以重迭的作業) 來執行。</span><span class="sxs-lookup"><span data-stu-id="90afd-107">The count of bytes actually read or written is reported by **ReadFile** or **WriteFile** (or by the [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) or [**FileIOCompletionRoutine**](/windows/desktop/api/minwinbase/nc-minwinbase-lpoverlapped_completion_routine) function, if the I/O was performed as an overlapped operation).</span></span>

<span data-ttu-id="90afd-108">當應用程式開啟通訊資源時，系統會將資源的超時值設定為上次使用資源時生效的值。</span><span class="sxs-lookup"><span data-stu-id="90afd-108">When an application opens a communications resource, the system sets the resource's time-out values to the values in effect when the resource was last used.</span></span> <span data-ttu-id="90afd-109">如果通訊資源從未開啟，系統會將超時值設定為某些預設值。</span><span class="sxs-lookup"><span data-stu-id="90afd-109">If the communications resource has never been opened, the system sets the time-out values to some default value.</span></span> <span data-ttu-id="90afd-110">無論是哪一種情況，應用程式都應該一律在開啟資源之後判斷目前的超時值，然後明確地將它們設定為符合其需求。</span><span class="sxs-lookup"><span data-stu-id="90afd-110">In either case, an application should always determine the current time-out values after opening the resource, and then explicitly set them to meet its requirements.</span></span> <span data-ttu-id="90afd-111">若要判斷通訊資源目前的超時值，請使用 [**GetCommTimeouts**](/windows/desktop/api/Winbase/nf-winbase-getcommtimeouts) 函數。</span><span class="sxs-lookup"><span data-stu-id="90afd-111">To determine the current time-out values of a communications resource, use the [**GetCommTimeouts**](/windows/desktop/api/Winbase/nf-winbase-getcommtimeouts) function.</span></span> <span data-ttu-id="90afd-112">若要變更超時值，請使用 [**SetCommTimeouts**](/windows/desktop/api/Winbase/nf-winbase-setcommtimeouts) 函數。</span><span class="sxs-lookup"><span data-stu-id="90afd-112">To change the time-out values, use the [**SetCommTimeouts**](/windows/desktop/api/Winbase/nf-winbase-setcommtimeouts) function.</span></span>

<span data-ttu-id="90afd-113">超時參數會啟用兩種類型的超時。</span><span class="sxs-lookup"><span data-stu-id="90afd-113">Two types of time-outs are enabled by the time-out parameters.</span></span> <span data-ttu-id="90afd-114">當兩個字元的回條之間的時間超過指定的毫秒數時，就會發生間隔超時時間。</span><span class="sxs-lookup"><span data-stu-id="90afd-114">An interval time-out occurs when the time between the receipt of any two characters exceeds a specified number of milliseconds.</span></span> <span data-ttu-id="90afd-115">當收到第一個字元時開始計時，並在每個新字元收到時重新開機。</span><span class="sxs-lookup"><span data-stu-id="90afd-115">Timing starts when the first character is received and is restarted when each new character is received.</span></span> <span data-ttu-id="90afd-116">當讀取作業所耗用的總時間量超過計算的毫秒數時，就會發生總超時時間。</span><span class="sxs-lookup"><span data-stu-id="90afd-116">A total time-out occurs when the total amount of time consumed by a read operation exceeds a calculated number of milliseconds.</span></span> <span data-ttu-id="90afd-117">執行時間會在 i/o 作業開始時立即開始計時。</span><span class="sxs-lookup"><span data-stu-id="90afd-117">Timing starts immediately when the I/O operation begins.</span></span> <span data-ttu-id="90afd-118">寫入作業僅支援總時間。</span><span class="sxs-lookup"><span data-stu-id="90afd-118">Write operations support only total time-outs.</span></span> <span data-ttu-id="90afd-119">讀取作業支援間隔和總超時時間，可分別或合併使用。</span><span class="sxs-lookup"><span data-stu-id="90afd-119">Read operations support both interval and total time-outs, which can be used separately or combined.</span></span>

<span data-ttu-id="90afd-120">讀取或寫入作業之總超時期間的時間（以毫秒為單位）是使用 [**GetCommTimeouts**](/windows/desktop/api/Winbase/nf-winbase-getcommtimeouts)或 [**SetCommTimeouts**](/windows/desktop/api/Winbase/nf-winbase-setcommtimeouts)函數中指定的 [**COMMTIMEOUTS**](/windows/desktop/api/Winbase/ns-winbase-commtimeouts)結構的乘數和常數值計算。</span><span class="sxs-lookup"><span data-stu-id="90afd-120">The time, in milliseconds, of the total time-out period for a read or write operation is calculated by using the multiplier and constant values from the [**COMMTIMEOUTS**](/windows/desktop/api/Winbase/ns-winbase-commtimeouts) structure specified in the [**GetCommTimeouts**](/windows/desktop/api/Winbase/nf-winbase-getcommtimeouts) or [**SetCommTimeouts**](/windows/desktop/api/Winbase/nf-winbase-setcommtimeouts) function.</span></span> <span data-ttu-id="90afd-121">使用下列公式：</span><span class="sxs-lookup"><span data-stu-id="90afd-121">The following formula is used:</span></span>


```C++
Timeout = (MULTIPLIER * number_of_bytes) + CONSTANT
```



<span data-ttu-id="90afd-122">使用乘數和常數，會根據所要求的資料量，讓總逾時間隔有所差異。</span><span class="sxs-lookup"><span data-stu-id="90afd-122">Using both a multiplier and a constant enables the total time-out period to vary, depending on the amount of data being requested.</span></span> <span data-ttu-id="90afd-123">應用程式只能使用常數，方法是將乘數設定為零，或將常數設定為零，只使用乘數。</span><span class="sxs-lookup"><span data-stu-id="90afd-123">An application can use only the constant by setting the multiplier to zero, or use only the multiplier by setting the constant to zero.</span></span> <span data-ttu-id="90afd-124">如果常數和乘數都是零，就不會使用總超時時間。</span><span class="sxs-lookup"><span data-stu-id="90afd-124">If both the constant and multiplier are zero, total time-out is not used.</span></span>

<span data-ttu-id="90afd-125">如果所有讀取超時參數都是零，就不會使用讀取超時值，而且在讀取要求的位元組數目或發生錯誤之前，讀取作業不會完成。</span><span class="sxs-lookup"><span data-stu-id="90afd-125">If all read time-out parameters are zero, read time-outs are not used, and a read operation is not complete until the requested number of bytes have been read or an error occurs.</span></span> <span data-ttu-id="90afd-126">同樣地，如果所有寫入超時參數都是零，寫入作業就會等到寫入要求的位元組數目或發生錯誤時才會完成。</span><span class="sxs-lookup"><span data-stu-id="90afd-126">Similarly, if all write time-out parameters are zero, a write operation is not completed until the requested number of bytes have been written or an error occurs.</span></span>

<span data-ttu-id="90afd-127">如果讀取間隔超時參數是 **MAXDWORD** 值，而且讀取總超時參數都是零，讀取作業會在讀取輸入緩衝區中可用的任何字元之後立即完成，即使它是空的也是一樣。</span><span class="sxs-lookup"><span data-stu-id="90afd-127">If the read interval time-out parameter is the **MAXDWORD** value and both read total time-out parameters are zero, a read operation is completed immediately after reading whatever characters are available in the input buffer, even if it is empty.</span></span>

<span data-ttu-id="90afd-128">當接收中有牢靠時，間隔時間會強制執行讀取作業。</span><span class="sxs-lookup"><span data-stu-id="90afd-128">Interval timing forces a read operation to return when there is a lull in reception.</span></span> <span data-ttu-id="90afd-129">使用間隔時間超時的進程可以設定相當短的間隔參數，讓它可以快速地回應一個或多個字元的小型、隔離的高載，但是在穩定的資料流程中收到資料時，仍可使用單一呼叫來收集大型的字元緩衝區。</span><span class="sxs-lookup"><span data-stu-id="90afd-129">A process using interval time-outs can set a fairly short interval parameter, so it can respond quickly to small, isolated bursts of one or a few characters, yet it can still collect large buffers of characters with a single call when data is received in a steady stream.</span></span>

<span data-ttu-id="90afd-130">當某一種流量控制封鎖傳輸，或呼叫 [**SetCommBreak**](/windows/desktop/api/Winbase/nf-winbase-setcommbreak) 函式來暫停字元傳輸時，寫入作業的超時時間可能很有用。</span><span class="sxs-lookup"><span data-stu-id="90afd-130">Time-outs for a write operation can be useful when transmission is blocked by some kind of flow control or when the [**SetCommBreak**](/windows/desktop/api/Winbase/nf-winbase-setcommbreak) function has been called to suspend character transmission.</span></span>

<span data-ttu-id="90afd-131">下表摘要說明以 total 和 interval 時間的指定值為基礎的讀取作業行為。</span><span class="sxs-lookup"><span data-stu-id="90afd-131">The following table summarizes the behavior of read operations based on the values specified for total and interval time-outs.</span></span>



| <span data-ttu-id="90afd-132">總計</span><span class="sxs-lookup"><span data-stu-id="90afd-132">Total</span></span> | <span data-ttu-id="90afd-133">間隔</span><span class="sxs-lookup"><span data-stu-id="90afd-133">Interval</span></span> | <span data-ttu-id="90afd-134">行為</span><span class="sxs-lookup"><span data-stu-id="90afd-134">Behavior</span></span>                                                                                                                                                                                 |
|-------|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="90afd-135">0</span><span class="sxs-lookup"><span data-stu-id="90afd-135">0</span></span>     | <span data-ttu-id="90afd-136">0</span><span class="sxs-lookup"><span data-stu-id="90afd-136">0</span></span>        | <span data-ttu-id="90afd-137">當緩衝區完全填滿時傳回。</span><span class="sxs-lookup"><span data-stu-id="90afd-137">Returns when the buffer is completely filled.</span></span> <span data-ttu-id="90afd-138">不會使用超時。</span><span class="sxs-lookup"><span data-stu-id="90afd-138">Time-outs are not used.</span></span>                                                                                                                    |
| <span data-ttu-id="90afd-139">T</span><span class="sxs-lookup"><span data-stu-id="90afd-139">T</span></span>     | <span data-ttu-id="90afd-140">0</span><span class="sxs-lookup"><span data-stu-id="90afd-140">0</span></span>        | <span data-ttu-id="90afd-141">當緩衝區完全填滿，或自作業開始後的 T 毫秒經過時，會傳回。</span><span class="sxs-lookup"><span data-stu-id="90afd-141">Returns when the buffer is completely filled or when T milliseconds have elapsed since the beginning of the operation.</span></span>                                                                   |
| <span data-ttu-id="90afd-142">0</span><span class="sxs-lookup"><span data-stu-id="90afd-142">0</span></span>     | <span data-ttu-id="90afd-143">Y</span><span class="sxs-lookup"><span data-stu-id="90afd-143">Y</span></span>        | <span data-ttu-id="90afd-144">當緩衝區填滿或在兩個字元的接收之間經過 Y 毫秒時，會傳回。</span><span class="sxs-lookup"><span data-stu-id="90afd-144">Returns when the buffer is completely filled or when Y milliseconds have elapsed between the receipt of any two characters.</span></span> <span data-ttu-id="90afd-145">直到收到第一個字元時，才會開始計時。</span><span class="sxs-lookup"><span data-stu-id="90afd-145">Timing does not begin until the first character is received.</span></span> |
| <span data-ttu-id="90afd-146">T</span><span class="sxs-lookup"><span data-stu-id="90afd-146">T</span></span>     | <span data-ttu-id="90afd-147">Y</span><span class="sxs-lookup"><span data-stu-id="90afd-147">Y</span></span>        | <span data-ttu-id="90afd-148">當緩衝區完全填滿或發生任何一種超時時，會傳回。</span><span class="sxs-lookup"><span data-stu-id="90afd-148">Returns when the buffer is completely filled or when either type of time-out occurs.</span></span>                                                                                                     |



 

> [!Note]  
> <span data-ttu-id="90afd-149">不過，該時間與控制實體裝置的系統相關。</span><span class="sxs-lookup"><span data-stu-id="90afd-149">However, that timing is relative to the system controlling the physical device.</span></span> <span data-ttu-id="90afd-150">若為遠端裝置（如數據機），時間相對於數據機所連接的伺服器系統。</span><span class="sxs-lookup"><span data-stu-id="90afd-150">For a remote device such as a modem, the timing is relative to the server system to which the modem is attached.</span></span> <span data-ttu-id="90afd-151">在中，不會考慮任何網路傳播延遲。</span><span class="sxs-lookup"><span data-stu-id="90afd-151">Any network propagation delay is not factored in.</span></span> <span data-ttu-id="90afd-152">例如，用戶端應用程式可能會指定計算為500毫秒的總超時時間。</span><span class="sxs-lookup"><span data-stu-id="90afd-152">For example, a client application might specify a total time-out that computes to be 500 milliseconds.</span></span> <span data-ttu-id="90afd-153">當伺服器經過500毫秒時，會傳回用戶端的逾時錯誤。</span><span class="sxs-lookup"><span data-stu-id="90afd-153">When 500 milliseconds have elapsed at the server, a time-out error is returned to the client.</span></span> <span data-ttu-id="90afd-154">如果有50毫秒的網路傳播延遲，用戶端將不會收到超時時間的通知，直到實際發生超時的50毫秒為止。</span><span class="sxs-lookup"><span data-stu-id="90afd-154">If there is a 50 milliseconds network propagation delay, the client will not be notified of the time-out until approximately 50 milliseconds after the time-out actually occurred.</span></span>

 

> [!Note]  
> <span data-ttu-id="90afd-155">超時參數會影響通訊裝置上重迭的讀取和寫入作業行為。</span><span class="sxs-lookup"><span data-stu-id="90afd-155">The time-out parameters affect the behavior of overlapped read and write operations on a communications device.</span></span> <span data-ttu-id="90afd-156">使用重迭的 i/o 時， [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile)、 [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile)、 [**ReadFileEx**](/windows/desktop/api/fileapi/nf-fileapi-readfileex)或 [**WriteFileEx**](/windows/desktop/api/fileapi/nf-fileapi-writefileex) 函數可以在作業完成之前傳回。</span><span class="sxs-lookup"><span data-stu-id="90afd-156">With overlapped I/O, the [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile), [**ReadFileEx**](/windows/desktop/api/fileapi/nf-fileapi-readfileex), or [**WriteFileEx**](/windows/desktop/api/fileapi/nf-fileapi-writefileex) function can return before the operation has been completed.</span></span> <span data-ttu-id="90afd-157">超時參數可判斷作業何時完成。</span><span class="sxs-lookup"><span data-stu-id="90afd-157">The time-out parameters can determine when the operation has been completed.</span></span>

 

 

 
