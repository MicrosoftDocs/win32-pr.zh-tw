---
description: 當 CreateFile 函式開啟序列通訊資源的控制碼時，系統會根據上次開啟資源時所設定的值，初始化和設定資源。
ms.assetid: a39881d8-32af-4846-a2d3-508f1945b666
title: 修改通訊資源設定
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8658029470fae9ee2d70ffb1459312c3c4d80ecf
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104025918"
---
# <a name="modification-of-communications-resource-settings"></a><span data-ttu-id="0453c-103">修改通訊資源設定</span><span class="sxs-lookup"><span data-stu-id="0453c-103">Modification of Communications Resource Settings</span></span>

<span data-ttu-id="0453c-104">當 [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) 函式開啟序列通訊資源的控制碼時，系統會根據上次開啟資源時所設定的值，初始化和設定資源。</span><span class="sxs-lookup"><span data-stu-id="0453c-104">When the [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) function opens a handle to a serial communications resource, the system initializes and configures the resource according to the values set up the last time the resource was opened.</span></span> <span data-ttu-id="0453c-105">保留先前的設定可讓使用者在重新開啟裝置時，保留透過 **模式** 命令指定的設定。</span><span class="sxs-lookup"><span data-stu-id="0453c-105">Preserving the previous settings enables the user to retain the settings specified through a **mode** command when the device is reopened.</span></span> <span data-ttu-id="0453c-106">繼承自先前開啟作業的值包含裝置控制區塊的設定， ([**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) 結構) 和 i/o 作業中使用的超時值。</span><span class="sxs-lookup"><span data-stu-id="0453c-106">The values inherited from the previous open operation include the configuration settings of the device control block (a [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) structure) and the time-out values used in I/O operations.</span></span> <span data-ttu-id="0453c-107">如果裝置從未開啟過，則會使用系統預設值進行設定。</span><span class="sxs-lookup"><span data-stu-id="0453c-107">If the device has never been opened, it is configured with the system defaults.</span></span>

<span data-ttu-id="0453c-108">為了判斷序列通訊資源的初始設定，處理常式會呼叫 [**GetCommState**](/windows/desktop/api/Winbase/nf-winbase-getcommstate) 函式，此函式會以目前的設定來填滿序列埠 [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) 結構。</span><span class="sxs-lookup"><span data-stu-id="0453c-108">To determine the initial configuration of a serial communications resource, a process calls the [**GetCommState**](/windows/desktop/api/Winbase/nf-winbase-getcommstate) function, which fills in a serial port [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) structure with the current configuration settings.</span></span> <span data-ttu-id="0453c-109">若要修改這個設定，進程會在 [**SetCommState**](/windows/desktop/api/Winbase/nf-winbase-setcommstate)函數的呼叫中指定 **DCB** 結構。</span><span class="sxs-lookup"><span data-stu-id="0453c-109">To modify this configuration, a process specifies a **DCB** structure in a call to the [**SetCommState**](/windows/desktop/api/Winbase/nf-winbase-setcommstate) function.</span></span>

<span data-ttu-id="0453c-110">[**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb)結構的成員會指定設定設定，例如串列傳輸速率、每個位元組的資料位數，以及每個位元組的停止位數目。</span><span class="sxs-lookup"><span data-stu-id="0453c-110">Members of the [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) structure specify the configuration settings such as the baud rate, the number of data bits per byte, and the number of stop bits per byte.</span></span> <span data-ttu-id="0453c-111">其他 **DCB** 成員會指定特殊字元，並啟用同位檢查和流量控制。</span><span class="sxs-lookup"><span data-stu-id="0453c-111">Other **DCB** members specify special characters and enable parity checking and flow control.</span></span> <span data-ttu-id="0453c-112">當處理常式只需要修改其中一些設定時，應該先呼叫 [**GetCommState**](/windows/desktop/api/Winbase/nf-winbase-getcommstate) ，以使用目前的設定來填入 **DCB** 結構。</span><span class="sxs-lookup"><span data-stu-id="0453c-112">When a process needs to modify only a few of these configuration settings, it should first call [**GetCommState**](/windows/desktop/api/Winbase/nf-winbase-getcommstate) to fill in a **DCB** structure with the current configuration.</span></span> <span data-ttu-id="0453c-113">然後，此程式可以調整 **DCB** 結構中的重要值，然後藉由呼叫 [**SetCommState**](/windows/desktop/api/Winbase/nf-winbase-setcommstate) 並指定修改過的 **DCB** 結構來重新設定裝置。</span><span class="sxs-lookup"><span data-stu-id="0453c-113">Then the process can adjust the important values in the **DCB** structure and reconfigure the device by calling [**SetCommState**](/windows/desktop/api/Winbase/nf-winbase-setcommstate) and specifying the modified **DCB** structure.</span></span> <span data-ttu-id="0453c-114">此程式可確保 **DCB** 結構的未修改成員包含適當的值。</span><span class="sxs-lookup"><span data-stu-id="0453c-114">This procedure ensures that the unmodified members of the **DCB** structure contain appropriate values.</span></span> <span data-ttu-id="0453c-115">例如，常見的錯誤是使用 **DCB** 結構來設定裝置，其中結構的 **XonChar** 成員等於 **XoffChar** 成員。</span><span class="sxs-lookup"><span data-stu-id="0453c-115">For example, a common error is to configure a device with a **DCB** structure in which the structure's **XonChar** member is equal to the **XoffChar** member.</span></span>

<span data-ttu-id="0453c-116">[**BuildCommDCB**](/windows/desktop/api/Winbase/nf-winbase-buildcommdcba)函式提供另一種修改 [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb)結構的方式。</span><span class="sxs-lookup"><span data-stu-id="0453c-116">The [**BuildCommDCB**](/windows/desktop/api/Winbase/nf-winbase-buildcommdcba) function provides another way to modify a [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) structure.</span></span> <span data-ttu-id="0453c-117">**BuildCommDCB** 使用的字串格式與 **mode** 命令的命令列引數相同，可指定傳輸速率、同位配置、停止位的數目，以及資料位的數目。</span><span class="sxs-lookup"><span data-stu-id="0453c-117">**BuildCommDCB** uses a string with the same form as the command-line arguments of the **mode** command to specify the baud rate, parity scheme, number of stop bits, and number of data bits.</span></span> <span data-ttu-id="0453c-118">除了適當的成員設定為停用 XON/XOFF 和硬體流量控制之外，此函式不會變更其餘的 [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) 成員。</span><span class="sxs-lookup"><span data-stu-id="0453c-118">The remaining members of [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) are not changed by this function, except that the appropriate members are set to disable XON/XOFF and hardware flow control.</span></span> <span data-ttu-id="0453c-119">**BuildCommDCB** 只會修改 **DCB** 結構;它不會重新設定裝置。</span><span class="sxs-lookup"><span data-stu-id="0453c-119">**BuildCommDCB** only modifies a **DCB** structure; it does not reconfigure the device.</span></span>

<span data-ttu-id="0453c-120">處理常式可以使用 [**GetCommProperties**](/windows/desktop/api/Winbase/nf-winbase-getcommproperties) 函式來重新設定通訊資源，以從設備磁碟機取得其所支援之設定的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="0453c-120">A process can reconfigure a communications resource by using the [**GetCommProperties**](/windows/desktop/api/Winbase/nf-winbase-getcommproperties) function to get information from a device driver about the configuration settings that it supports.</span></span> <span data-ttu-id="0453c-121">此程式可以使用這項資訊來避免指定不支援的設定。</span><span class="sxs-lookup"><span data-stu-id="0453c-121">The process can use this information to avoid specifying a configuration that is not supported.</span></span>

<span data-ttu-id="0453c-122">[**SetCommState**](/windows/desktop/api/Winbase/nf-winbase-setcommstate)函式會重新配置通訊資源，但不會影響指定驅動程式的內部輸出和輸入緩衝區。</span><span class="sxs-lookup"><span data-stu-id="0453c-122">The [**SetCommState**](/windows/desktop/api/Winbase/nf-winbase-setcommstate) function reconfigures the communications resource, but it does not affect the internal output and input buffers of the specified driver.</span></span> <span data-ttu-id="0453c-123">緩衝區不會排清，且暫止的讀取和寫入作業不會提前終止。</span><span class="sxs-lookup"><span data-stu-id="0453c-123">The buffers are not flushed, and pending read and write operations are not terminated prematurely.</span></span>

<span data-ttu-id="0453c-124">進程會使用 [**SetupComm**](/windows/desktop/api/Winbase/nf-winbase-setupcomm) 函式重新初始化通訊資源，此函式會執行下列工作：</span><span class="sxs-lookup"><span data-stu-id="0453c-124">A process reinitializes a communications resource by using the [**SetupComm**](/windows/desktop/api/Winbase/nf-winbase-setupcomm) function, which performs the following tasks:</span></span>

-   <span data-ttu-id="0453c-125">終止暫止的讀取和寫入作業，即使它們尚未完成。</span><span class="sxs-lookup"><span data-stu-id="0453c-125">Terminates pending read and write operations, even if they have not been completed.</span></span>
-   <span data-ttu-id="0453c-126">捨棄未讀取的字元，並釋出與指定資源相關聯之驅動程式的內部輸出和輸入緩衝區。</span><span class="sxs-lookup"><span data-stu-id="0453c-126">Discards unread characters and frees the internal output and input buffers of the driver associated with the specified resource.</span></span>
-   <span data-ttu-id="0453c-127">重新配置內部輸出和輸入緩衝區。</span><span class="sxs-lookup"><span data-stu-id="0453c-127">Reallocates the internal output and input buffers.</span></span>

<span data-ttu-id="0453c-128">呼叫 [**SetupComm**](/windows/desktop/api/Winbase/nf-winbase-setupcomm)不需要處理常式。</span><span class="sxs-lookup"><span data-stu-id="0453c-128">A process is not required to call [**SetupComm**](/windows/desktop/api/Winbase/nf-winbase-setupcomm).</span></span> <span data-ttu-id="0453c-129">如果沒有，則資源的驅動程式會在第一次使用通訊資源控制碼時，使用預設設定來初始化裝置。</span><span class="sxs-lookup"><span data-stu-id="0453c-129">If it does not, the resource's driver initializes the device with the default settings the first time that the communications resource handle is used.</span></span>

 

 
