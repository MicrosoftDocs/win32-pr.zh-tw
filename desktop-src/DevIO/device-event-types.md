---
description: 若要在處理 WM DEVICECHANGE 訊息時判斷裝置事件種類 \_ ，請檢查 wParam 參數。
ms.assetid: 17078548-879d-4a11-a268-27d1f30180ab
title: 裝置事件種類
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 35ece6b810ba4d1310638bbfbdcdcaa7f67f79d8
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104025917"
---
# <a name="device-event-types"></a><span data-ttu-id="12ab7-103">裝置事件種類</span><span class="sxs-lookup"><span data-stu-id="12ab7-103">Device Event Types</span></span>

<span data-ttu-id="12ab7-104">若要在處理 [**WM \_ DEVICECHANGE**](wm-devicechange.md) 訊息時判斷裝置事件種類，請檢查 *wParam* 參數。</span><span class="sxs-lookup"><span data-stu-id="12ab7-104">To determine the device event type when processing a [**WM\_DEVICECHANGE**](wm-devicechange.md) message, examine the *wParam* parameter.</span></span> <span data-ttu-id="12ab7-105">*WParam* 的值會決定 *lParam* 參數中事件特定資料的意義。</span><span class="sxs-lookup"><span data-stu-id="12ab7-105">The value of *wParam* determines the meaning of the event-specific data in the *lParam* parameter.</span></span> <span data-ttu-id="12ab7-106">一般而言，事件特定的資料會識別裝置，並提供事件的其他詳細資料。</span><span class="sxs-lookup"><span data-stu-id="12ab7-106">In general, the event-specific data identifies the device and provides additional detail about the event.</span></span> <span data-ttu-id="12ab7-107">這項資料的格式取決於裝置類型，但前幾個位元組的格式一律與 [**開發 \_ 廣播 \_ HDR**](/windows/desktop/api/Dbt/ns-dbt-dev_broadcast_hdr) 結構相同。</span><span class="sxs-lookup"><span data-stu-id="12ab7-107">The format of this data depends on the device type, but the first few bytes always have the same format as the [**DEV\_BROADCAST\_HDR**](/windows/desktop/api/Dbt/ns-dbt-dev_broadcast_hdr) structure.</span></span> <span data-ttu-id="12ab7-108">若要判斷資料的格式，請檢查 **dbch \_ devicetype** 成員。</span><span class="sxs-lookup"><span data-stu-id="12ab7-108">To determine the format of the data, check the **dbch\_devicetype** member.</span></span>

<span data-ttu-id="12ab7-109">系統會廣播 [DBT (\_ DEVICEARRIVAL](dbt-devicearrival.md)類型的裝置事件，也就是每次插入裝置並可供使用時， *wParam* 設定為 DBT DEVICEARRIVAL) 的 [**WM \_ DEVICECHANGE**](wm-devicechange.md)訊息 \_ 。</span><span class="sxs-lookup"><span data-stu-id="12ab7-109">The system broadcasts a device event of type [DBT\_DEVICEARRIVAL](dbt-devicearrival.md) (that is, a [**WM\_DEVICECHANGE**](wm-devicechange.md) message with *wParam* set to DBT\_DEVICEARRIVAL) whenever a device has been inserted and is available for use.</span></span> <span data-ttu-id="12ab7-110">應用程式通常會檢查裝置類型，並在適用時立即開始使用裝置。</span><span class="sxs-lookup"><span data-stu-id="12ab7-110">Applications typically check the device type and begin using the device immediately if it is appropriate.</span></span>

<span data-ttu-id="12ab7-111">系統會廣播 [DBT \_ DEVICEQUERYREMOVE](dbt-devicequeryremove.md) 裝置事件，以要求移除裝置的許可權。</span><span class="sxs-lookup"><span data-stu-id="12ab7-111">The system broadcasts a [DBT\_DEVICEQUERYREMOVE](dbt-devicequeryremove.md) device event to request permission to remove a device.</span></span> <span data-ttu-id="12ab7-112">若要判斷是否需要裝置，應用程式可以顯示對話方塊以提示使用者提供指示。</span><span class="sxs-lookup"><span data-stu-id="12ab7-112">To determine whether it needs the device, an application can display a dialog box to prompt the user for instructions.</span></span> <span data-ttu-id="12ab7-113">如果應用程式判斷它需要裝置，則可以拒絕此要求，並藉由傳回廣播查詢拒絕來取消移除 \_ \_ 。</span><span class="sxs-lookup"><span data-stu-id="12ab7-113">If an application determines that it needs the device, it can deny this request and cancel the removal by returning BROADCAST\_QUERY\_DENY.</span></span> <span data-ttu-id="12ab7-114">如果應用程式不需要裝置，則必須傳回 **TRUE**。</span><span class="sxs-lookup"><span data-stu-id="12ab7-114">If the application does not need the device, it must return **TRUE**.</span></span> <span data-ttu-id="12ab7-115">如果有任何應用程式或驅動程式取消先前的移除裝置要求，系統就會立即傳送 [DBT \_ DEVICEQUERYREMOVEFAILED](dbt-devicequeryremovefailed.md) 訊息。</span><span class="sxs-lookup"><span data-stu-id="12ab7-115">The system immediately sends a [DBT\_DEVICEQUERYREMOVEFAILED](dbt-devicequeryremovefailed.md) message if any application or driver canceled a previous request to remove a device.</span></span>

<span data-ttu-id="12ab7-116">在移除裝置之前，系統會將 [DBT \_ DEVICEREMOVEPENDING](dbt-deviceremovepending.md) 裝置事件廣播為最後一項警告。</span><span class="sxs-lookup"><span data-stu-id="12ab7-116">The system broadcasts a [DBT\_DEVICEREMOVEPENDING](dbt-deviceremovepending.md) device event as a last warning before a device is removed.</span></span> <span data-ttu-id="12ab7-117">此時，應用程式無法取消移除，所以如果它正在使用裝置，它必須準備移除以防止資料遺失。</span><span class="sxs-lookup"><span data-stu-id="12ab7-117">At this point, the application cannot cancel the removal, so if it is using the device it must prepare for its removal to prevent loss of data.</span></span> <span data-ttu-id="12ab7-118">這在移除網路連線時特別重要。</span><span class="sxs-lookup"><span data-stu-id="12ab7-118">This is especially important when a network connection is being removed.</span></span> <span data-ttu-id="12ab7-119">應用程式必須判斷其開啟的檔案或管道是否在該連接上。</span><span class="sxs-lookup"><span data-stu-id="12ab7-119">The application must determine whether any of its open files or pipes are on that connection.</span></span> <span data-ttu-id="12ab7-120">它可以藉由比較訊息的事件特定資料中的網路資源識別碼與先前為檔案和管道取得的資源識別碼，來達成此目的。</span><span class="sxs-lookup"><span data-stu-id="12ab7-120">It can do this by comparing the network resource identifier in the event-specific data of the message with the resource identifiers previously obtained for the files and pipes.</span></span> <span data-ttu-id="12ab7-121">當裝置已移除且無法再使用時，系統會廣播 [DBT \_ DEVICEREMOVECOMPLETE](dbt-deviceremovecomplete.md) 裝置事件。</span><span class="sxs-lookup"><span data-stu-id="12ab7-121">The system broadcasts a [DBT\_DEVICEREMOVECOMPLETE](dbt-deviceremovecomplete.md) device event when a device has been removed and is no longer available.</span></span>

<span data-ttu-id="12ab7-122">系統會廣播 [DBT \_ QUERYCHANGECONFIG](dbt-querychangeconfig.md) 裝置事件，以要求 (dock 或取消停駐) 變更目前設定的許可權。</span><span class="sxs-lookup"><span data-stu-id="12ab7-122">The system broadcasts a [DBT\_QUERYCHANGECONFIG](dbt-querychangeconfig.md) device event to request permission to change the current configuration (dock or undock).</span></span> <span data-ttu-id="12ab7-123">任何應用程式都可以 \_ 傳回 \_ 「廣播查詢拒絕」以拒絕要求，並取消變更。</span><span class="sxs-lookup"><span data-stu-id="12ab7-123">Any application can return BROADCAST\_QUERY\_DENY to deny the request and cancel the change.</span></span> <span data-ttu-id="12ab7-124">如果應用程式拒絕要求，系統會傳送 [DBT \_ CONFIGCHANGECANCELED](dbt-configchangecanceled.md) 訊息。</span><span class="sxs-lookup"><span data-stu-id="12ab7-124">If an application denies the request, the system sends a [DBT\_CONFIGCHANGECANCELED](dbt-configchangecanceled.md) message.</span></span> <span data-ttu-id="12ab7-125">如果目前的設定已變更，由於 dock 或取消停駐，系統會傳送 [DBT \_ CONFIGCHANGED](dbt-configchanged.md) 訊息。</span><span class="sxs-lookup"><span data-stu-id="12ab7-125">If the current configuration has changed, due to a dock or undock, the system sends a [DBT\_CONFIGCHANGED](dbt-configchanged.md) message.</span></span>

<span data-ttu-id="12ab7-126">每當發生裝置特定事件時，系統就會廣播 [DBT \_ DEVICETYPESPECIFIC](dbt-devicetypespecific.md) 裝置事件。</span><span class="sxs-lookup"><span data-stu-id="12ab7-126">The system broadcasts a [DBT\_DEVICETYPESPECIFIC](dbt-devicetypespecific.md) device event whenever a device-specific event occurs.</span></span>

<span data-ttu-id="12ab7-127">驅動程式可以建立自己的自訂事件種類。</span><span class="sxs-lookup"><span data-stu-id="12ab7-127">Drivers can create their own custom event types.</span></span> <span data-ttu-id="12ab7-128">自訂事件只會傳送至已在特定裝置上註冊裝置事件通知的應用程式，而且只能由核心模式驅動程式初始化。</span><span class="sxs-lookup"><span data-stu-id="12ab7-128">Custom events are sent only to application that have registered for device-event notification on a particular device, and can only be initiated by kernel-mode drivers.</span></span> <span data-ttu-id="12ab7-129">如需詳細資訊，請參閱 [DBT \_ CUSTOMEVENT](dbt-customevent.md)。</span><span class="sxs-lookup"><span data-stu-id="12ab7-129">For more information, see [DBT\_CUSTOMEVENT](dbt-customevent.md).</span></span>

 

 



