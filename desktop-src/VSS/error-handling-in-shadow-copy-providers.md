---
description: VSS 允許有許多陰影複製存在一次，但它只允許在呼叫 >ivssbackupcomponents：： StartSnapshotSet 與從呼叫 >ivssbackupcomponents：:D oSnapshotSet 之間進行某個陰影複製集建立。
ms.assetid: 26657fc2-180f-4ebb-820c-2159e7fe7584
title: 陰影複製提供者中的錯誤處理
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f5f040526f63a0fe57fc5a49ac903e8b60b76646
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "106975503"
---
# <a name="error-handling-in-shadow-copy-providers"></a><span data-ttu-id="f507a-103">陰影複製提供者中的錯誤處理</span><span class="sxs-lookup"><span data-stu-id="f507a-103">Error Handling in Shadow Copy Providers</span></span>

<span data-ttu-id="f507a-104">VSS 允許有許多陰影複製存在一次，但它只允許在呼叫 [**>ivssbackupcomponents：： StartSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset) 與從呼叫 [**>ivssbackupcomponents：:D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset)之間進行某個陰影複製集建立。</span><span class="sxs-lookup"><span data-stu-id="f507a-104">VSS allows many shadow copies to exist at once, but it only allows one shadow copy set creation to be in-progress between the call to [**IVssBackupComponents::StartSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset) and the return from the call to [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span></span>

## <a name="no-partial-commit"></a><span data-ttu-id="f507a-105">無部分認可</span><span class="sxs-lookup"><span data-stu-id="f507a-105">No Partial Commit</span></span>

<span data-ttu-id="f507a-106">如果任何提供者無法在陰影複製集中的任何磁片區或 LUN 上進行陰影複製，則建立整個陰影複製集會失敗。</span><span class="sxs-lookup"><span data-stu-id="f507a-106">If any provider fails a shadow copy on any volume or LUN in the shadow copy set, then the creation of the entire shadow copy set fails.</span></span> <span data-ttu-id="f507a-107">這是原廠設定。</span><span class="sxs-lookup"><span data-stu-id="f507a-107">This is by design.</span></span> <span data-ttu-id="f507a-108">這項設計可簡化與部分失敗語義相關聯的行為問題，並在集合中的所有陰影複製間維持一致的時間點。</span><span class="sxs-lookup"><span data-stu-id="f507a-108">This design simplifies the behavioral issues associated with partial failure semantics and maintains a consistent point-in-time across all shadow copies in the set.</span></span>

## <a name="reporting-fault-conditions"></a><span data-ttu-id="f507a-109">報告錯誤狀況</span><span class="sxs-lookup"><span data-stu-id="f507a-109">Reporting Fault Conditions</span></span>

<span data-ttu-id="f507a-110">如果發生提供者錯誤或錯誤狀況，則提供者必須將錯誤記錄到應用程式事件記錄檔。</span><span class="sxs-lookup"><span data-stu-id="f507a-110">If a provider error or fault condition occurs, the provider must log an error to the Application event log.</span></span> <span data-ttu-id="f507a-111">這包括（但不限於）在建立或匯入陰影複製集時的任何提供者特定錯誤，或在建立後寫入複製陰影複製的資源配置失敗。</span><span class="sxs-lookup"><span data-stu-id="f507a-111">This includes, but is not limited to, any provider-specific errors when creating or importing a Shadow Copy Set, or resource allocation failure for copy-on-write shadow copy after creation.</span></span> <span data-ttu-id="f507a-112">當陰影複製組中的磁片區處於凍結狀態時，不一定會發生這項記錄。</span><span class="sxs-lookup"><span data-stu-id="f507a-112">This logging must not take place during the time the volumes in the shadow copy set are in a frozen state.</span></span>

## <a name="valid-provider-return-values"></a><span data-ttu-id="f507a-113">有效的提供者傳回值</span><span class="sxs-lookup"><span data-stu-id="f507a-113">Valid Provider Return Values</span></span>

<span data-ttu-id="f507a-114">下表列出提供者方法的有效傳回碼及其意義。</span><span class="sxs-lookup"><span data-stu-id="f507a-114">The following table lists the valid return codes for provider methods and their meanings.</span></span>



| <span data-ttu-id="f507a-115">值</span><span class="sxs-lookup"><span data-stu-id="f507a-115">Value</span></span>                                                                                                                                                                              | <span data-ttu-id="f507a-116">描述</span><span class="sxs-lookup"><span data-stu-id="f507a-116">Description</span></span>                                                                                                                                                                                                                                            |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="f507a-117"><span id="S_OK"></span><span id="s_ok"></span>S \_ 確定</span><span class="sxs-lookup"><span data-stu-id="f507a-117"><span id="S_OK"></span><span id="s_ok"></span>S\_OK</span></span><br/>                                                                                                                     | <span data-ttu-id="f507a-118">此方法成功。</span><span class="sxs-lookup"><span data-stu-id="f507a-118">The method was successful.</span></span><br/>                                                                                                                                                                                                                  |
| <span data-ttu-id="f507a-119"><span id="E_OUTOFMEMORY"></span><span id="e_outofmemory"></span>E \_ OUTOFMEMORY</span><span class="sxs-lookup"><span data-stu-id="f507a-119"><span id="E_OUTOFMEMORY"></span><span id="e_outofmemory"></span>E\_OUTOFMEMORY</span></span><br/>                                                                                          | <span data-ttu-id="f507a-120">提供者超出記憶體或其他系統資源。</span><span class="sxs-lookup"><span data-stu-id="f507a-120">The provider is out of memory or other system resources.</span></span><br/>                                                                                                                                                                                    |
| <span data-ttu-id="f507a-121"><span id="E_INVALIDARG"></span><span id="e_invalidarg"></span>E \_ INVALIDARG</span><span class="sxs-lookup"><span data-stu-id="f507a-121"><span id="E_INVALIDARG"></span><span id="e_invalidarg"></span>E\_INVALIDARG</span></span><br/>                                                                                             | <span data-ttu-id="f507a-122">其中一個參數值無效。</span><span class="sxs-lookup"><span data-stu-id="f507a-122">One of the parameter values is not valid.</span></span><br/>                                                                                                                                                                                                   |
| <span data-ttu-id="f507a-123"><span id="E_ACCESSDENIED"></span><span id="e_accessdenied"></span>E \_ ACCESSDENIED</span><span class="sxs-lookup"><span data-stu-id="f507a-123"><span id="E_ACCESSDENIED"></span><span id="e_accessdenied"></span>E\_ACCESSDENIED</span></span><br/>                                                                                       | <span data-ttu-id="f507a-124">非特殊許可權的用戶端已嘗試呼叫提供者。</span><span class="sxs-lookup"><span data-stu-id="f507a-124">A non-privileged client has tried to call into the provider.</span></span><br/>                                                                                                                                                                                |
| <span data-ttu-id="f507a-125"><span id="VSS_E_BAD_STATE"></span><span id="vss_e_bad_state"></span>VSS \_ E \_ 不良 \_ 狀態</span><span class="sxs-lookup"><span data-stu-id="f507a-125"><span id="VSS_E_BAD_STATE"></span><span id="vss_e_bad_state"></span>VSS\_E\_BAD\_STATE</span></span><br/>                                                                                  | <span data-ttu-id="f507a-126">任何提供者都不支援要求的作業，或無法在物件上執行作業，因為物件不是處於正確的狀態。</span><span class="sxs-lookup"><span data-stu-id="f507a-126">Either no provider supports the requested operation, or the operation cannot be performed on the object because the object is not in the correct state.</span></span><br/>                                                                                     |
| <span data-ttu-id="f507a-127"><span id="VSS_E_OBJECT_NOT_FOUND"></span><span id="vss_e_object_not_found"></span>\_ \_ \_ \_ 找不到 VSS E 物件</span><span class="sxs-lookup"><span data-stu-id="f507a-127"><span id="VSS_E_OBJECT_NOT_FOUND"></span><span id="vss_e_object_not_found"></span>VSS\_E\_OBJECT\_NOT\_FOUND</span></span><br/>                                                            | <span data-ttu-id="f507a-128">參數指的是找不到的物件 (例如陰影複製識別碼、陰影複製集識別碼或磁片區。 ) </span><span class="sxs-lookup"><span data-stu-id="f507a-128">A parameter refers to an object that was not found (such as a shadow copy ID, shadow copy set ID, or volume.)</span></span><br/>                                                                                                                               |
| <span data-ttu-id="f507a-129"><span id="VSS_E_INSUFFICIENT_STORAGE"></span><span id="vss_e_insufficient_storage"></span>VSS \_ E \_ \_ 儲存體不足</span><span class="sxs-lookup"><span data-stu-id="f507a-129"><span id="VSS_E_INSUFFICIENT_STORAGE"></span><span id="vss_e_insufficient_storage"></span>VSS\_E\_INSUFFICIENT\_STORAGE</span></span><br/>                                                 | <span data-ttu-id="f507a-130">提供者無法執行操作，因為磁碟空間不足。</span><span class="sxs-lookup"><span data-stu-id="f507a-130">The provider cannot perform the operation because there is not enough disk space.</span></span><br/>                                                                                                                                                           |
| <span data-ttu-id="f507a-131"><span id="VSS_E_VOLUME_NOT_SUPPORTED"></span><span id="vss_e_volume_not_supported"></span>\_ \_ \_ 不支援 VSS E 磁片區 \_</span><span class="sxs-lookup"><span data-stu-id="f507a-131"><span id="VSS_E_VOLUME_NOT_SUPPORTED"></span><span id="vss_e_volume_not_supported"></span>VSS\_E\_VOLUME\_NOT\_SUPPORTED</span></span><br/>                                                | <span data-ttu-id="f507a-132">這部電腦上沒有任何提供者支援磁片區上所要求的操作。</span><span class="sxs-lookup"><span data-stu-id="f507a-132">No provider on this computer supports the requested operation on the volume.</span></span><br/>                                                                                                                                                                |
| <span data-ttu-id="f507a-133"><span id="VSS_E_VOLUME_NOT_SUPPORTED_BY_PROVIDER"></span><span id="vss_e_volume_not_supported_by_provider"></span>\_ \_ \_ \_ \_ 提供者不支援的 \_ VSS E 磁片區</span><span class="sxs-lookup"><span data-stu-id="f507a-133"><span id="VSS_E_VOLUME_NOT_SUPPORTED_BY_PROVIDER"></span><span id="vss_e_volume_not_supported_by_provider"></span>VSS\_E\_VOLUME\_NOT\_SUPPORTED\_BY\_PROVIDER</span></span><br/>          | <span data-ttu-id="f507a-134">提供者不支援磁片區。</span><span class="sxs-lookup"><span data-stu-id="f507a-134">The provider does not support the volume.</span></span><br/>                                                                                                                                                                                                   |
| <span data-ttu-id="f507a-135"><span id="VSS_E_MAXIMUM_NUMBER_OF_SNAPSHOTS_REACHED"></span><span id="vss_e_maximum_number_of_snapshots_reached"></span>VSS \_ E \_ 已 \_ \_ \_ 達到快照集數目上限 \_</span><span class="sxs-lookup"><span data-stu-id="f507a-135"><span id="VSS_E_MAXIMUM_NUMBER_OF_SNAPSHOTS_REACHED"></span><span id="vss_e_maximum_number_of_snapshots_reached"></span>VSS\_E\_MAXIMUM\_NUMBER\_OF\_SNAPSHOTS\_REACHED</span></span><br/> | <span data-ttu-id="f507a-136">提供者已達到可支援的陰影複製數目上限。</span><span class="sxs-lookup"><span data-stu-id="f507a-136">The provider has reached the maximum number of shadow copies that it can support.</span></span><br/>                                                                                                                                                           |
| <span data-ttu-id="f507a-137"><span id="VSS_E_PROVIDER_VETO"></span><span id="vss_e_provider_veto"></span>VSS \_ E \_ 提供者 \_ 否決</span><span class="sxs-lookup"><span data-stu-id="f507a-137"><span id="VSS_E_PROVIDER_VETO"></span><span id="vss_e_provider_veto"></span>VSS\_E\_PROVIDER\_VETO</span></span><br/>                                                                      | <span data-ttu-id="f507a-138">提供者遇到未對應到另一個傳回值的內部執行階段錯誤。</span><span class="sxs-lookup"><span data-stu-id="f507a-138">The provider has encountered an internal run-time error that does not map to another return value.</span></span> <span data-ttu-id="f507a-139">提供者也必須將事件寫入應用程式事件記錄檔，以提供使用者如何解決此問題的資訊。</span><span class="sxs-lookup"><span data-stu-id="f507a-139">The provider must also write an event into the Application event log providing the user with information on how to resolve this problem.</span></span><br/> |
| <span data-ttu-id="f507a-140"><span id="VSS_E_CANNOT_REVERT_DISKID"></span><span id="vss_e_cannot_revert_diskid"></span>VSS \_ E \_ 無法 \_ 還原 \_ DISKID</span><span class="sxs-lookup"><span data-stu-id="f507a-140"><span id="VSS_E_CANNOT_REVERT_DISKID"></span><span id="vss_e_cannot_revert_diskid"></span>VSS\_E\_CANNOT\_REVERT\_DISKID</span></span><br/>                                                | <span data-ttu-id="f507a-141">一或多個磁片的 MBR 簽名碼或 GPT 識別碼無法設定為要求的值。</span><span class="sxs-lookup"><span data-stu-id="f507a-141">The MBR signature or GPT ID for one or more disks could not be set to the requested value.</span></span> <span data-ttu-id="f507a-142">查看應用程式事件記錄檔以取得詳細資訊。</span><span class="sxs-lookup"><span data-stu-id="f507a-142">Check the Application event log for more information.</span></span><br/>                                                                                            |



 

<span data-ttu-id="f507a-143">提供者不應嘗試傳回任何其他錯誤代碼。</span><span class="sxs-lookup"><span data-stu-id="f507a-143">The provider should not attempt to return any other error codes.</span></span>

<span data-ttu-id="f507a-144">如果提供者傳回的錯誤碼不是預期的 (例如： **\_ FALSE**、E failed、e 非 **預期 \_** 或 **e \_ ABORT**) ，則 VSS **\_ 會** 將事件寫入事件記錄檔，以提及提供者和失敗的方法，並將錯誤轉譯為 **VSS E 未預期的 \_ \_ \_ 提供者 \_ 錯誤**，然後再返回要求者。</span><span class="sxs-lookup"><span data-stu-id="f507a-144">If the provider returns an error code that is not expected (for example **S\_FALSE**, **E\_FAIL**, **E\_UNEXPECTED**, or **E\_ABORT**), VSS writes an event into the event log mentioning the provider and failed method and translates the error to **VSS\_E\_UNEXPECTED\_PROVIDER\_ERROR** before returning to the requester.</span></span> <span data-ttu-id="f507a-145">[**IVssProviderCreateSnapshotSet：： AbortSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-abortsnapshots)或 [**IVssProviderNotifications：： OnUnload**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidernotifications-onunload)的任何傳回都不會進行這項操作。</span><span class="sxs-lookup"><span data-stu-id="f507a-145">This is not done for any returns from [**IVssProviderCreateSnapshotSet::AbortSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-abortsnapshots) or [**IVssProviderNotifications::OnUnload**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidernotifications-onunload).</span></span>

 

 




