---
description: 寫入器參與增量和差異備份時，通常會在處理 (CVssWriter：： OnIdentify) 、PrepareForBackup (CVssWriter： OnPrepareBackup) 和 PostSnapshot (CVssWriter： OnPostSnapshot) 事件時進行。
ms.assetid: 85c4e003-b531-4283-83aa-dd5cc53f35b1
title: VSS 增量和差異備份中的寫入器角色
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f2cda57d907bed4572f0c0f71f9ee829bee18299
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104511497"
---
# <a name="writer-role-in-vss-incremental-and-differential-backups"></a><span data-ttu-id="b6c05-103">VSS 增量和差異備份中的寫入器角色</span><span class="sxs-lookup"><span data-stu-id="b6c05-103">Writer Role in VSS Incremental and Differential Backups</span></span>

<span data-ttu-id="b6c05-104">寫入器參與增量和差異備份時，通常會 [*在處理 (*](vssgloss-i.md) [**CVssWriter：： OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify)) 、 [*PrepareForBackup*](vssgloss-p.md) ([**CVssWriter： OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup)) 和 *PostSnapshot* ([**CVssWriter： OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot)) 事件時進行。</span><span class="sxs-lookup"><span data-stu-id="b6c05-104">A writer's participation in incremental and differential backups typically takes place while handling [*Identify*](vssgloss-i.md) ([**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify)), [*PrepareForBackup*](vssgloss-p.md) ([**CVssWriter:OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup)), and *PostSnapshot* ([**CVssWriter:OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot)) events.</span></span> <span data-ttu-id="b6c05-105">寫入器的參與方式取決於它是否支援備份戳記和上次修改時間，以及執行備份的要求者是否支援 [*部分檔案作業*](vssgloss-p.md)。</span><span class="sxs-lookup"><span data-stu-id="b6c05-105">How a writer participates is shaped by whether it supports backup stamps and last modification times, and whether the requester running the backup supports [*partial file operations*](vssgloss-p.md).</span></span>

## <a name="handling-identify-events-during-incremental-and-differential-backups"></a><span data-ttu-id="b6c05-106">處理增量和差異備份期間的識別事件</span><span class="sxs-lookup"><span data-stu-id="b6c05-106">Handling Identify Events during Incremental and Differential Backups</span></span>

<span data-ttu-id="b6c05-107">在處理識別事件時，寫入器會透過備份架構 ([**vss \_ 備份 \_ 架構**](/windows/desktop/api/Vss/ne-vss-vss_backup_schema)) 和檔案規格備份類型 ([**vss 檔案 \_ \_ 規格 \_ 備份 \_ 類型**](/windows/desktop/api/Vss/ne-vss-vss_file_spec_backup_type)) 遮罩，來建立增量和差異備份作業的基本架構。</span><span class="sxs-lookup"><span data-stu-id="b6c05-107">While handling the Identify event, writers establish their basic architecture for incremental and differential backup operation through the backup schema ([**VSS\_BACKUP\_SCHEMA**](/windows/desktop/api/Vss/ne-vss-vss_backup_schema)) and file specification backup type ([**VSS\_FILE\_SPEC\_BACKUP\_TYPE**](/windows/desktop/api/Vss/ne-vss-vss_file_spec_backup_type)) masks.</span></span>

<span data-ttu-id="b6c05-108">寫入器會藉由建立 [**VSS \_ 備份 \_ 架構**](/windows/desktop/api/Vss/ne-vss-vss_backup_schema) 值的位遮罩，並將其傳遞至 [**IVssCreateWriterMetadata：： SetBackupSchema**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema) 方法，來指出它在寫入器元資料檔案中支援的作業。</span><span class="sxs-lookup"><span data-stu-id="b6c05-108">A writer indicates which operations it supports in its Writer Metadata Document by creating a bit mask of [**VSS\_BACKUP\_SCHEMA**](/windows/desktop/api/Vss/ne-vss-vss_backup_schema) values and passing it to the [**IVssCreateWriterMetadata::SetBackupSchema**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema) method.</span></span> <span data-ttu-id="b6c05-109">藉此，寫入器可以指出它是否支援下列各項：</span><span class="sxs-lookup"><span data-stu-id="b6c05-109">With this, a writer can indicate whether it supports the following:</span></span>

-   <span data-ttu-id="b6c05-110">增量備份 (**VSS \_ BS \_ 增量**) </span><span class="sxs-lookup"><span data-stu-id="b6c05-110">Incremental backups (**VSS\_BS\_INCREMENTAL**)</span></span>
-   <span data-ttu-id="b6c05-111"> (**VSS \_ BS \_ 差異**) 的差異備份</span><span class="sxs-lookup"><span data-stu-id="b6c05-111">Differential backups (**VSS\_BS\_DIFFERENTIAL**)</span></span>
-   <span data-ttu-id="b6c05-112">增量和差異備份無法混合 (**VSS \_ BS \_ 專有 \_ 增量 \_ 差異**) </span><span class="sxs-lookup"><span data-stu-id="b6c05-112">Incremental and differential backups cannot be mixed (**VSS\_BS\_EXCLUSIVE\_INCREMENTAL\_DIFFERENTIAL**)</span></span>
-   <span data-ttu-id="b6c05-113">使用備份戳記 (**VSS \_ BS 時間 \_ 戳**) 的增量和差異備份</span><span class="sxs-lookup"><span data-stu-id="b6c05-113">Incremental and differential backups using backup stamps (**VSS\_BS\_TIMESTAMPED**)</span></span>
-   <span data-ttu-id="b6c05-114">以檔案上次修改的相關資訊為基礎的增量和差異備份 (**VSS \_ BS \_ 上次 \_ 修改**) </span><span class="sxs-lookup"><span data-stu-id="b6c05-114">Incremental and differential backups on the basis of information about a file's last modification (**VSS\_BS\_LAST\_MODIFY**)</span></span>

<span data-ttu-id="b6c05-115">寫入器會使用檔案規格備份類型遮罩來提供檔案集層級資訊給要求者，以說明如何在增量或差異備份中包含檔案。</span><span class="sxs-lookup"><span data-stu-id="b6c05-115">Writers use the file specification backup type mask to provide file set level information to requesters on how to include files in an incremental or differential backup.</span></span>

<span data-ttu-id="b6c05-116">當寫入器將檔案集新增至元件時，可以藉由建立「 [**VSS 檔案 \_ 規格」 \_ \_ 備份 \_ 類型**](/windows/desktop/api/Vss/ne-vss-vss_file_spec_backup_type) 值的位元遮罩，然後將它傳遞給 [**IVssCreateWriterMetadata：： AddDatabaseFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles)、 [**IVssCreateWriterMetadata：： AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles)或 [**IVssCreateWriterMetadata：： AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup)，來設定檔案集的檔案規格備份類型遮罩。</span><span class="sxs-lookup"><span data-stu-id="b6c05-116">A writer can set a file set's file specification backup type mask when it adds the file set to a component by creating a bit mask of [**VSS\_FILE\_SPEC\_BACKUP\_TYPE**](/windows/desktop/api/Vss/ne-vss-vss_file_spec_backup_type) values and passing it to [**IVssCreateWriterMetadata::AddDatabaseFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), [**IVssCreateWriterMetadata::AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles), or [**IVssCreateWriterMetadata::AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup).</span></span>

<span data-ttu-id="b6c05-117">[**VSS \_ 檔 \_ 規格 \_ 備份 \_ 類型**](/windows/desktop/api/Vss/ne-vss-vss_file_spec_backup_type)列舉有三個「需要備份」值，會影響差異和增量備份：</span><span class="sxs-lookup"><span data-stu-id="b6c05-117">There are three "backup required" values of the [**VSS\_FILE\_SPEC\_BACKUP\_TYPE**](/windows/desktop/api/Vss/ne-vss-vss_file_spec_backup_type) enumeration that affect differential and incremental backups:</span></span>

-   <span data-ttu-id="b6c05-118">**VSS \_ FSBT \_ \_ 需要所有備份 \_**</span><span class="sxs-lookup"><span data-stu-id="b6c05-118">**VSS\_FSBT\_ALL\_BACKUP\_REQUIRED**</span></span>
-   <span data-ttu-id="b6c05-119">**\_需要 VSS FSBT \_ 增量 \_ 備份 \_**</span><span class="sxs-lookup"><span data-stu-id="b6c05-119">**VSS\_FSBT\_INCREMENTAL\_BACKUP\_REQUIRED**</span></span>
-   <span data-ttu-id="b6c05-120">**\_需要 VSS FSBT \_ 差異 \_ 備份 \_**</span><span class="sxs-lookup"><span data-stu-id="b6c05-120">**VSS\_FSBT\_DIFFERENTIAL\_BACKUP\_REQUIRED**</span></span>

<span data-ttu-id="b6c05-121">有三個「需要陰影複製」值：</span><span class="sxs-lookup"><span data-stu-id="b6c05-121">There are three "shadow copy required" values:</span></span>

-   <span data-ttu-id="b6c05-122">**VSS \_ FSBT \_ 需要所有的 \_ 快照 \_ 集**</span><span class="sxs-lookup"><span data-stu-id="b6c05-122">**VSS\_FSBT\_ALL\_SNAPSHOT\_REQUIRED**</span></span>
-   <span data-ttu-id="b6c05-123">**\_需要 VSS FSBT \_ 增量 \_ 快照 \_ 集**</span><span class="sxs-lookup"><span data-stu-id="b6c05-123">**VSS\_FSBT\_INCREMENTAL\_SNAPSHOT\_REQUIRED**</span></span>
-   <span data-ttu-id="b6c05-124">**\_需要 VSS FSBT \_ 差異 \_ 快照 \_ 集**</span><span class="sxs-lookup"><span data-stu-id="b6c05-124">**VSS\_FSBT\_DIFFERENTIAL\_SNAPSHOT\_REQUIRED**</span></span>

<span data-ttu-id="b6c05-125">標記檔案規格備份類型為「需要陰影複製」的檔案集，指出當執行增量、差異或所有 (（包括累加和差異作業) 備份作業）時，要求者是否需要從陰影複製複製資料。</span><span class="sxs-lookup"><span data-stu-id="b6c05-125">File sets tagged with a file specification backup type of "shadow copy required" indicate whether a requester needs to copy data from a shadow copy when performing INCREMENTAL, DIFFERENTIAL, or ALL (which includes both incremental and differential operations) backup operations.</span></span>

<span data-ttu-id="b6c05-126">套用至累加式、差異或所有備份作業的「需要備份」旗標，表示寫入器預期在還原任何備份作業之後，可以使用目前版本的檔案集。</span><span class="sxs-lookup"><span data-stu-id="b6c05-126">The "backup required" flag, applied to INCREMENTAL, DIFFERENTIAL, or ALL backup operations, indicates that the writer expects a copy of the current version of the file set to be available following the restore of any backup operation.</span></span> <span data-ttu-id="b6c05-127">一般而言，這表示如果檔案集標記為「需要備份」，則在增量或差異備份期間，其所有成員都會複製到備份媒體，而不論其備份或修改何時上次發生。</span><span class="sxs-lookup"><span data-stu-id="b6c05-127">Typically, this means that if a file set is tagged with "backup required," all its members will be copied to backup media during an incremental or differential backup, regardless of when their backup or modification last occurred.</span></span>

<span data-ttu-id="b6c05-128">依預設，會將檔案集新增至具有 vss 的檔案規格備份類型的元件 **\_ FSBT \_ 所有 \_ \_** 需要的備份 \| **vss \_ FSBT \_ \_ \_ 需要所有的快照** 集。</span><span class="sxs-lookup"><span data-stu-id="b6c05-128">By default, file sets are added to components with a file specification backup type of **VSS\_FSBT\_ALL\_BACKUP\_REQUIRED** \| **VSS\_FSBT\_ALL\_SNAPSHOT\_REQUIRED**.</span></span> <span data-ttu-id="b6c05-129">因此，除非寫入器開發人員決定不使用預設 (藉由選擇其他檔案規格備份類型、使用部分檔案作業，或使用差異檔案) ，否則大部分檔集中的檔案通常會複製到備份媒體中。</span><span class="sxs-lookup"><span data-stu-id="b6c05-129">Therefore, unless a writer developer decides not to use the default (by choosing another file specification backup type, using partial file operations, or using differenced files), the files in most file sets will typically be copied in their entirety to backup media.</span></span>

<span data-ttu-id="b6c05-130">此時，寫入器的寫入器元資料檔案完全填入了要求者啟動差異或增量備份所需的大部分資訊。</span><span class="sxs-lookup"><span data-stu-id="b6c05-130">At this point, the writer's Writer Metadata Document is fully populated with most of information a requester will need to start a differential or incremental backup.</span></span> <span data-ttu-id="b6c05-131">在 [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) 事件期間，將會處理用來支援備份的檔案集或檔案層級資訊的額外規格。</span><span class="sxs-lookup"><span data-stu-id="b6c05-131">Addition specification of file set or file level information to support the backup will be handled during the [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) event.</span></span>

## <a name="handling-prepareforbackup-events-during-incremental-and-differential-backups"></a><span data-ttu-id="b6c05-132">在累加式和差異備份期間處理 PrepareForBackup 事件</span><span class="sxs-lookup"><span data-stu-id="b6c05-132">Handling PrepareForBackup Events during Incremental and Differential Backups</span></span>

<span data-ttu-id="b6c05-133">在要求者繼續進行實際的備份作業之前，寫入器可以透過 [**>ivsscomponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent)介面改變要求者的備份元件檔，以修改 [*增量*](vssgloss-i.md)或 [*差異*](vssgloss-d.md)備份的規格。</span><span class="sxs-lookup"><span data-stu-id="b6c05-133">Before the requester proceeds with the actual backup operation, writers can modify the specification of an [*incremental*](vssgloss-i.md) or [*differential*](vssgloss-d.md) backup by altering the requester's Backup Components Document through the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface.</span></span>

<span data-ttu-id="b6c05-134">因為寫入器會使用 [**>ivsscomponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) 介面，所以它們通常會在處理 [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) 事件時執行這些準備工作。</span><span class="sxs-lookup"><span data-stu-id="b6c05-134">Because the writers use the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface, they typically perform these preparations while handling the [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) event.</span></span>

<span data-ttu-id="b6c05-135">在 [**CVssWriter： OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup)中，寫入器可以更精確地指定要如何評估某些檔案以進行備份、指定備份時應該使用哪些機制，以及可能設定備份戳記。</span><span class="sxs-lookup"><span data-stu-id="b6c05-135">In [**CVssWriter:OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup), writers can more precisely specify how some files are to be evaluated for backup, specify what mechanisms should be used in backing them up, and possibly set backup stamps.</span></span>

<dl> <dt>

<span data-ttu-id="b6c05-136"><span id="Partial_Files"></span><span id="partial_files"></span><span id="PARTIAL_FILES"></span>部分檔案</span><span class="sxs-lookup"><span data-stu-id="b6c05-136"><span id="Partial_Files"></span><span id="partial_files"></span><span id="PARTIAL_FILES"></span>Partial Files</span></span>
</dt> <dd>

<span data-ttu-id="b6c05-137">如果要求者支援它們，寫入器可以選擇使用部分檔案作業來實作為增量或差異備份。</span><span class="sxs-lookup"><span data-stu-id="b6c05-137">If a requester supports them, a writer can choose to have an incremental or differential backup implemented by using partial file operations.</span></span> <span data-ttu-id="b6c05-138"> (寫入器可以藉由呼叫 [**CVssWriter：： IsPartialFileSupportEnabled**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispartialfilesupportenabled)來判斷要求者是否支援部分檔案作業。 ) </span><span class="sxs-lookup"><span data-stu-id="b6c05-138">(Writers can determine if a requester supports partial file operations by calling [**CVssWriter::IsPartialFileSupportEnabled**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispartialfilesupportenabled).)</span></span>

<span data-ttu-id="b6c05-139">寫入器會使用 [**>ivsscomponent：： AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile) 來指出要在增量或差異作業期間備份所選檔案的部分。</span><span class="sxs-lookup"><span data-stu-id="b6c05-139">Writers use [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile) to indicate those portions of the selected files to be backed up during the incremental or differential operation.</span></span> <span data-ttu-id="b6c05-140">要求者必須遵守此規格，而且一定要備份檔案的指定區段。</span><span class="sxs-lookup"><span data-stu-id="b6c05-140">Requesters must respect this specification, and must always back up the specified sections of the files.</span></span> <span data-ttu-id="b6c05-141"> (如需部分檔案作業的詳細資訊，請參閱 [使用部分](working-with-partial-files.md) 檔案。 ) </span><span class="sxs-lookup"><span data-stu-id="b6c05-141">(See [Working with Partial Files](working-with-partial-files.md) for more information on partial file operations.)</span></span>

<span data-ttu-id="b6c05-142">藉由使用 [**>ivsscomponent：： AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile)，寫入器可以將檔案加入至先前尚未新增至其中一個元件集的備份， (由 [**IVssCreateWriterMetadata：： AddDatabaseFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles)、 [**IVssCreateWriterMetadata：： AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles)或 [**IVssCreateWriterMetadata：： AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup)) 為部分檔案。</span><span class="sxs-lookup"><span data-stu-id="b6c05-142">Using [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile), a writer can add a file to the backup that was not previously added to one of its component sets (by [**IVssCreateWriterMetadata::AddDatabaseFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), [**IVssCreateWriterMetadata::AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles), or [**IVssCreateWriterMetadata::AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup)) as a partial file.</span></span> <span data-ttu-id="b6c05-143">以這種方式新增至備份的任何新檔案，都必須在已為此備份進行陰影複製的磁片區上。</span><span class="sxs-lookup"><span data-stu-id="b6c05-143">Any new files added to the backup in this manner must be on a volume that already is being shadow copied for this backup.</span></span>

<span data-ttu-id="b6c05-144">如果檔案牽涉到部分檔案作業，這會取代任何已忽略的檔案規格備份類型。</span><span class="sxs-lookup"><span data-stu-id="b6c05-144">If a file is involved with partial file operations, this supersedes any file specification backup type, which is ignored.</span></span>

</dd> <dt>

<span data-ttu-id="b6c05-145"><span id="Differenced_Files"></span><span id="differenced_files"></span><span id="DIFFERENCED_FILES"></span>差異檔案</span><span class="sxs-lookup"><span data-stu-id="b6c05-145"><span id="Differenced_Files"></span><span id="differenced_files"></span><span id="DIFFERENCED_FILES"></span>Differenced Files</span></span>
</dt> <dd>

<span data-ttu-id="b6c05-146">支援上次修改的備份架構 (**VSS \_ BS \_ 架構**) 的寫入器可以將 [*差異*](vssgloss-d.md) 檔案新增至增量或差異備份。</span><span class="sxs-lookup"><span data-stu-id="b6c05-146">Writers that support a last modified backup schema (**VSS\_BS\_SCHEMA**) can add [*differenced files*](vssgloss-d.md) to an incremental or differential backup.</span></span>

<span data-ttu-id="b6c05-147">在指定差異檔案時，寫入器會使用 [**>ivsscomponent：： AddDifferencedFileByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) ，並指定路徑、檔案名和遞迴旗標，但不需要符合任何元件中包含的檔案集。</span><span class="sxs-lookup"><span data-stu-id="b6c05-147">In specifying a differenced file, a writer uses [**IVssComponent::AddDifferencedFileByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) and specifies a path, a file name, and a recursive flag—however, these do not have to match a file set included in any component.</span></span>

<span data-ttu-id="b6c05-148">事實上，寫入器可以將先前未加入的檔案新增至其中一個元件集， ([**IVssCreateWriterMetadata：： AddDatabaseFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles)、 [**IVssCreateWriterMetadata：： AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles)或 [**IVssCreateWriterMetadata：： AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup)) 備份為差異檔案。</span><span class="sxs-lookup"><span data-stu-id="b6c05-148">In fact, a writer can add a file not previously added to one of its component sets (by [**IVssCreateWriterMetadata::AddDatabaseFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), [**IVssCreateWriterMetadata::AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles), or [**IVssCreateWriterMetadata::AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup)) to the backup as a differenced file.</span></span> <span data-ttu-id="b6c05-149">以這種方式新增至備份的任何新檔案，都必須在已為此備份進行陰影複製的磁片區上。</span><span class="sxs-lookup"><span data-stu-id="b6c05-149">Any new files added to the backup in this manner must be on a volume that already is being shadow copied for this backup.</span></span>

<span data-ttu-id="b6c05-150">一般而言，寫入器也會在加入差異檔案時，指定上次修改的時間，以編寫器自己的歷程記錄機制為基礎。</span><span class="sxs-lookup"><span data-stu-id="b6c05-150">Typically, a writer will also specify a time of last modification when adding a differenced file—based on the writer's own history mechanism.</span></span> <span data-ttu-id="b6c05-151">上次修改時間（如果有指定）必須一律由要求者用來判斷檔案是否需要包含在增量或差異備份中。</span><span class="sxs-lookup"><span data-stu-id="b6c05-151">This last modification time, if specified, must always be used by requesters in determining if a file needs to be included in an incremental or differential backup.</span></span>

<span data-ttu-id="b6c05-152">將差異檔案新增至增量或差異備份集時，寫入器可能會選擇不指定上次修改時間。</span><span class="sxs-lookup"><span data-stu-id="b6c05-152">A writer may choose not to specify a last modification time when adding a differenced file to an incremental or differential backup set.</span></span> <span data-ttu-id="b6c05-153">如果是這種情況，要求者可以自由使用自己的機制（例如，先前的備份或檔案系統資訊的記錄）來判斷差異檔案是否應該包含在增量或差異備份中。</span><span class="sxs-lookup"><span data-stu-id="b6c05-153">If this is the case, requesters are free to use their own mechanisms—for instance, logs of previous backups or file system information—to determine whether the differenced file should be included in an incremental or differential backup.</span></span>

<span data-ttu-id="b6c05-154">任何差異檔案的檔案規格備份類型都會被忽略。</span><span class="sxs-lookup"><span data-stu-id="b6c05-154">The file specification backup type of any differenced file is ignored.</span></span>

</dd> <dt>

<span data-ttu-id="b6c05-155"><span id="Backup_Stamps"></span><span id="backup_stamps"></span><span id="BACKUP_STAMPS"></span>備份戳記</span><span class="sxs-lookup"><span data-stu-id="b6c05-155"><span id="Backup_Stamps"></span><span id="backup_stamps"></span><span id="BACKUP_STAMPS"></span>Backup Stamps</span></span>
</dt> <dd>

<span data-ttu-id="b6c05-156">支援備份戳記的寫入器 (**VSS \_ BS \_ 時間戳記**) 有自己的私用格式，可用於儲存上次備份時的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="b6c05-156">Writers that support backup stamps (**VSS\_BS\_TIMESTAMP**) have their own private format for storing information about when a backup last occurred.</span></span> <span data-ttu-id="b6c05-157">這項資訊是由寫入器在備份期間產生的。</span><span class="sxs-lookup"><span data-stu-id="b6c05-157">This information is generated by the writer during backup.</span></span>

<span data-ttu-id="b6c05-158">備份戳記會以字串的形式儲存在備份元件檔中，並以 [**>ivsscomponent：： SetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp) 方法作為字串。</span><span class="sxs-lookup"><span data-stu-id="b6c05-158">The backup stamp is stored in the Backup Components Document as a string by the [**IVssComponent::SetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp) method.</span></span> <span data-ttu-id="b6c05-159">備份戳記會套用至元件 (或元件集中的所有檔集，) 對應至 [**>ivsscomponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent)的實例。</span><span class="sxs-lookup"><span data-stu-id="b6c05-159">The backup stamp applies to all file sets in the component (or component set) corresponding to the instance of the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent).</span></span>

<span data-ttu-id="b6c05-160">如果要求者可以存取先前備份的備份戳記，它就會藉由呼叫 [**>ivssbackupcomponents：： SetPreviousBackupStamp**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setpreviousbackupstamp)，將其提供給寫入器。</span><span class="sxs-lookup"><span data-stu-id="b6c05-160">If a requester has access to the backup stamp of a previous backup, it will have made it available to the writer by calling [**IVssBackupComponents::SetPreviousBackupStamp**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setpreviousbackupstamp).</span></span>

<span data-ttu-id="b6c05-161">然後，寫入器可以使用 [**>ivsscomponent：： GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp)檢查這個時間戳記。</span><span class="sxs-lookup"><span data-stu-id="b6c05-161">A writer then can examine this time stamp using [**IVssComponent::GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp).</span></span>

<span data-ttu-id="b6c05-162">請注意，要求者只會儲存並傳回包含備份戳記的字串。</span><span class="sxs-lookup"><span data-stu-id="b6c05-162">Note that the requester merely stores and returns the string containing the backup stamp.</span></span> <span data-ttu-id="b6c05-163">它並不知道字串格式或使用方式的任何資訊;只有寫入器具有該資訊。</span><span class="sxs-lookup"><span data-stu-id="b6c05-163">It does not know anything about the string's format or how to use it; only the writer has that information.</span></span>

<span data-ttu-id="b6c05-164">寫入器在呼叫 [**>ivsscomponent：： GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp)之後，可能會選擇使用 [**>ivsscomponent：： SetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp)來更新目前的備份戳記，因此會以其本身的格式記錄目前增量或差異備份作業的日期。</span><span class="sxs-lookup"><span data-stu-id="b6c05-164">A writer may choose to update the current backup stamp using [**IVssComponent::SetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp) after it has called [**IVssComponent::GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp), thus recording in its own format the date of the current incremental or differential backup operation.</span></span>

</dd> </dl>

 

 



