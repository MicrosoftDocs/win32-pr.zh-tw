---
description: 當寫入器在寫入器元資料檔案中指定其資料的還原方式時，還原作業的設定實際上會在資料備份期間開始。
ms.assetid: b1f948cd-d3b0-4637-b76d-b54a74bb5948
title: 設定 VSS 還原方法
ms.topic: reference
ms.date: 05/31/2018
ms.openlocfilehash: 412cb699fb791a973e280f63fec03bd2854ccd1d
ms.sourcegitcommit: 37f276b5d887a3aad04b1ba86e390dea9d87e591
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 02/04/2021
ms.locfileid: "104195655"
---
# <a name="setting-vss-restore-methods"></a><span data-ttu-id="97c06-103">設定 VSS 還原方法</span><span class="sxs-lookup"><span data-stu-id="97c06-103">Setting VSS Restore Methods</span></span>

<span data-ttu-id="97c06-104">當寫入器在寫入器元資料檔案中指定其資料的還原方式時，還原作業的設定實際上會在資料備份期間開始。</span><span class="sxs-lookup"><span data-stu-id="97c06-104">The configuration of restore operations actually begins during data backup, when writers specify, in their Writer Metadata Documents, how their data should be restored.</span></span>

<span data-ttu-id="97c06-105">這些規格（稱為 [*還原方法*](vssgloss-r.md) 或原始 [*還原目標*](vssgloss-r.md)）可以在還原期間由寫入器設定新的還原目標或由要求者還原至新位置來修改， (查看 [非預設備份和還原位置](non-default-backup-and-restore-locations.md)) 。</span><span class="sxs-lookup"><span data-stu-id="97c06-105">These specifications, referred to either as [*restore methods*](vssgloss-r.md) or original [*restore targets*](vssgloss-r.md), can be modified during restore by writers setting new restore targets or by requesters restoring to new locations (see [Non-Default Backup and Restore Locations](non-default-backup-and-restore-locations.md)).</span></span>

<span data-ttu-id="97c06-106">藉由呼叫 [**IVssCreateWriterMetadata：： SetRestoreMethod**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setrestoremethod)，寫入器會指出應該在其寫入器元資料檔案中使用哪一個還原方法。</span><span class="sxs-lookup"><span data-stu-id="97c06-106">By calling [**IVssCreateWriterMetadata::SetRestoreMethod**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setrestoremethod), a writer indicates which restore method should be used in its Writer Metadata Document.</span></span> <span data-ttu-id="97c06-107">Restore 方法是設定為全作者，並套用至寫入器管理之所有元件中的所有檔案。</span><span class="sxs-lookup"><span data-stu-id="97c06-107">The restore method is set writer wide and applied to all files in all components that a writer manages.</span></span>

<span data-ttu-id="97c06-108">要求者取得 (，且必須藉由呼叫 [**IVssExamineWriterMetadata：： GetRestoreMethod**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getrestoremethod)來) 這項資訊。</span><span class="sxs-lookup"><span data-stu-id="97c06-108">A requester obtains (and must respect) this information by calling [**IVssExamineWriterMetadata::GetRestoreMethod**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getrestoremethod).</span></span>

<span data-ttu-id="97c06-109">Restore 方法是由 [**VSS \_ RESTOREMETHOD \_ 列舉**](/windows/desktop/api/VsWriter/ne-vswriter-vss_restoremethod_enum) 列舉所定義，它會傳遞至 [**IVssCreateWriterMetadata：： SetRestoreMethod**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setrestoremethod) ，並從 [**IVssExamineWriterMetadata：： GetRestoreMethod**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getrestoremethod)傳回。</span><span class="sxs-lookup"><span data-stu-id="97c06-109">The restore method is defined by a [**VSS\_RESTOREMETHOD\_ENUM**](/windows/desktop/api/VsWriter/ne-vswriter-vss_restoremethod_enum) enumeration, which is passed to [**IVssCreateWriterMetadata::SetRestoreMethod**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setrestoremethod) and returned from [**IVssExamineWriterMetadata::GetRestoreMethod**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getrestoremethod).</span></span>

<span data-ttu-id="97c06-110">寫入器元資料檔案支援下列有效的還原方法 (VSS \_ RME 未定義的還原方法 \_ 表示) 的寫入器錯誤。</span><span class="sxs-lookup"><span data-stu-id="97c06-110">The Writer Metadata Document supports the following valid restore methods (a restore method of VSS\_RME\_UNDEFINED indicates a writer error).</span></span> <span data-ttu-id="97c06-111">這些圖表摘要說明各種支援和已定義的還原方法， (VSS \_ RME \_ 自訂並沒有相關聯的圖表，因為根據定義，它是寫入器特有的，而且必須遵循特定的寫入器 api 和檔) ：</span><span class="sxs-lookup"><span data-stu-id="97c06-111">The figures summarize how the various supported and defined restore methods should be implemented (VSS\_RME\_CUSTOM has no figure associated with it, because by definition it is specific to the writer and must follow the specific writer APIs and documentation):</span></span>

-   <span data-ttu-id="97c06-112">VSS \_ RME \_ 還原（ \_ 如果沒有的話） \_ \_ 。</span><span class="sxs-lookup"><span data-stu-id="97c06-112">VSS\_RME\_RESTORE\_IF\_NOT\_THERE.</span></span> <span data-ttu-id="97c06-113">如果磁片上沒有任何檔案，請將元件檔案還原至磁片。</span><span class="sxs-lookup"><span data-stu-id="97c06-113">Restore component files to disk if none of the files are on the disk already.</span></span> <span data-ttu-id="97c06-114">[**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore)事件之後，應檢查目標檔案狀態。</span><span class="sxs-lookup"><span data-stu-id="97c06-114">Target file status should be checked after a [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) event.</span></span>
    <span data-ttu-id="97c06-115">![此圖顯示 VSS_RME_RESTORE_IF_NOT_THERE 的疑難排解樹狀目錄。](images/rint.png)</span><span class="sxs-lookup"><span data-stu-id="97c06-115">![Diagram that shows a troubleshooting tree for VSS_RME_RESTORE_IF_NOT_THERE.](images/rint.png)</span></span>
-   <span data-ttu-id="97c06-116">VSS \_ RME \_ RESTORE \_ 是否 \_ 可以 \_ REPLACE。</span><span class="sxs-lookup"><span data-stu-id="97c06-116">VSS\_RME\_RESTORE\_IF\_CAN\_REPLACE.</span></span> <span data-ttu-id="97c06-117">如果可以取代所有檔案，請將檔案還原至磁片。</span><span class="sxs-lookup"><span data-stu-id="97c06-117">Restore files to disk if all the files can be replaced.</span></span> <span data-ttu-id="97c06-118">[**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore)事件之後，應檢查目標檔案狀態。</span><span class="sxs-lookup"><span data-stu-id="97c06-118">Target file status should be checked after a [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) event.</span></span>
    <span data-ttu-id="97c06-119">![此圖顯示 VSS_RME_RESTORE_IF_CAN_REPLACE 的疑難排解樹狀目錄。](images/ricr.png)</span><span class="sxs-lookup"><span data-stu-id="97c06-119">![Diagram that shows a troubleshooting tree for VSS_RME_RESTORE_IF_CAN_REPLACE.](images/ricr.png)</span></span>
-   <span data-ttu-id="97c06-120">VSS \_ RME \_ 停止 \_ 還原 \_ 啟動。</span><span class="sxs-lookup"><span data-stu-id="97c06-120">VSS\_RME\_STOP\_RESTORE\_START.</span></span> <span data-ttu-id="97c06-121">在還原檔案之前，將會停止服務。</span><span class="sxs-lookup"><span data-stu-id="97c06-121">A service will be stopped prior to restoring the files.</span></span>
    <span data-ttu-id="97c06-122">![此圖顯示 VSS_RME_STOP_RESTORE_START 的疑難排解樹狀目錄。](images/srr.png)</span><span class="sxs-lookup"><span data-stu-id="97c06-122">![Diagram that shows a troubleshooting tree for VSS_RME_STOP_RESTORE_START.](images/srr.png)</span></span>
-   <span data-ttu-id="97c06-123">VSS \_ RME \_ 還原 \_ 至 \_ 替代 \_ 位置。</span><span class="sxs-lookup"><span data-stu-id="97c06-123">VSS\_RME\_RESTORE\_TO\_ALTERNATE\_LOCATION.</span></span> <span data-ttu-id="97c06-124">將檔案還原到其他位置的磁片。</span><span class="sxs-lookup"><span data-stu-id="97c06-124">Restore files to disk in an alternate location.</span></span> <span data-ttu-id="97c06-125">替代位置對應是在寫入器元資料檔案中指定。</span><span class="sxs-lookup"><span data-stu-id="97c06-125">The alternate location mappings are specified in the Writer Metadata Document.</span></span>
    <span data-ttu-id="97c06-126">![此圖顯示 VSS_RME_RESTORE_TO_ALTERNATE_LOCATION 的疑難排解樹狀目錄。](images/rtal.png)</span><span class="sxs-lookup"><span data-stu-id="97c06-126">![Diagram that shows a troubleshooting tree for VSS_RME_RESTORE_TO_ALTERNATE_LOCATION.](images/rtal.png)</span></span>
-   <span data-ttu-id="97c06-127">VSS \_ RME \_ \_ 在 \_ 重新開機時還原。</span><span class="sxs-lookup"><span data-stu-id="97c06-127">VSS\_RME\_RESTORE\_AT\_REBOOT.</span></span> <span data-ttu-id="97c06-128">重新開機電腦時，會將檔案還原 (覆寫) 。</span><span class="sxs-lookup"><span data-stu-id="97c06-128">Cause files to be restored (overwritten) when the computer is rebooted.</span></span>
    <span data-ttu-id="97c06-129">![此圖顯示 VSS_RME_RESTORE_AT_REBOOT 的疑難排解樹狀目錄。](images/rar.png)</span><span class="sxs-lookup"><span data-stu-id="97c06-129">![Diagram that shows a troubleshooting tree for VSS_RME_RESTORE_AT_REBOOT.](images/rar.png)</span></span>
-   <span data-ttu-id="97c06-130">\_ \_ \_ \_ \_ 如果 \_ 無法 \_ 取代，VSS RME 會在重新開機時還原。</span><span class="sxs-lookup"><span data-stu-id="97c06-130">VSS\_RME\_RESTORE\_AT\_REBOOT\_IF\_CANNOT\_REPLACE.</span></span> <span data-ttu-id="97c06-131">如果檔案無法還原到執行中系統上的磁片，則會在電腦重新開機時還原 (覆寫) 。</span><span class="sxs-lookup"><span data-stu-id="97c06-131">If a file could not be restored to disk on a running system, then it is restored (overwritten) when the computer is rebooted.</span></span>
    <span data-ttu-id="97c06-132">![顯示疑難排解樹 forVSS_RME_RESTORE_AT_REBOOT_IF_CANNOT_REPLACE 的圖表。</span><span class="sxs-lookup"><span data-stu-id="97c06-132">![Diagram that shows a troubleshooting tree forVSS_RME_RESTORE_AT_REBOOT_IF_CANNOT_REPLACE.</span></span> ](images/raricr.png)
-   <span data-ttu-id="97c06-133">VSS \_ RME \_ 自訂。</span><span class="sxs-lookup"><span data-stu-id="97c06-133">VSS\_RME\_CUSTOM.</span></span> <span data-ttu-id="97c06-134">沒有任何預先定義的方法可運作;備份應用程式必須使用特製化的 Api 來執行還原作業。</span><span class="sxs-lookup"><span data-stu-id="97c06-134">None of the predefined methods will work; the backup application must use specialized APIs to perform the restore operation.</span></span> <span data-ttu-id="97c06-135">針對此備份方法，要求者必須完全瞭解有問題的寫入器。</span><span class="sxs-lookup"><span data-stu-id="97c06-135">For this backup method, the requester must completely understand the writer in question.</span></span> <span data-ttu-id="97c06-136">請參閱目前支援之實例的 [特殊 VSS 使用案例](special-vss-usage-cases.md) 。</span><span class="sxs-lookup"><span data-stu-id="97c06-136">See [Special VSS Usage Cases](special-vss-usage-cases.md) for currently supported instances.</span></span>

 

 



