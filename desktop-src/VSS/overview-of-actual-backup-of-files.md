---
description: VSS 可讓要求者存取包含要備份之資料的磁片區陰影複製，以及將資料複製到備份媒體。
ms.assetid: 187f26f2-f191-4703-9bde-3357f1ceef0c
title: 檔的實際備份總覽
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 98a504ff5a41725e33a2eb27792a3c6c89d00276
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "106974399"
---
# <a name="overview-of-actual-backup-of-files"></a><span data-ttu-id="7a935-103">檔的實際備份總覽</span><span class="sxs-lookup"><span data-stu-id="7a935-103">Overview of Actual Backup Of Files</span></span>

<span data-ttu-id="7a935-104">VSS 可讓要求者存取包含要備份之資料的磁片區陰影複製，以及將資料複製到備份媒體。</span><span class="sxs-lookup"><span data-stu-id="7a935-104">VSS enables a requester to access the shadow copy of volumes containing data for backup and to copy data to backup media.</span></span> <span data-ttu-id="7a935-105">寫入器通常會在此程式期間繼續正常運作。</span><span class="sxs-lookup"><span data-stu-id="7a935-105">Writers generally proceed with normal operation during this process.</span></span> <span data-ttu-id="7a935-106">如需詳細資訊，請參閱 [在 VSS 下處理備份的總覽](overview-of-processing-a-backup-under-vss.md)。</span><span class="sxs-lookup"><span data-stu-id="7a935-106">For more information, see [Overview of Processing a Backup Under VSS](overview-of-processing-a-backup-under-vss.md).</span></span>

<span data-ttu-id="7a935-107">下表顯示備份檔案所需的動作和事件順序。</span><span class="sxs-lookup"><span data-stu-id="7a935-107">The following table shows the sequence of actions and events that are required for files to be backed up.</span></span>



<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th><span data-ttu-id="7a935-108">要求者動作</span><span class="sxs-lookup"><span data-stu-id="7a935-108">Requester action</span></span></th>
<th><span data-ttu-id="7a935-109">事件</span><span class="sxs-lookup"><span data-stu-id="7a935-109">Event</span></span></th>
<th><span data-ttu-id="7a935-110">寫入器動作</span><span class="sxs-lookup"><span data-stu-id="7a935-110">Writer action</span></span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span data-ttu-id="7a935-111">存取陰影複製磁片區上的檔案 (參閱 <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getsnapshotproperties"><strong>>ivssbackupcomponents：： GetSnapshotProperties</strong></a>、 <a href="/windows/desktop/api/Vss/ns-vss-vss_snapshot_prop"><strong>VSS_SNAPSHOT_PROP</strong></a>) </span><span class="sxs-lookup"><span data-stu-id="7a935-111">Access files on the shadow-copied volume (see <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getsnapshotproperties"><strong>IVssBackupComponents::GetSnapshotProperties</strong></a>, <a href="/windows/desktop/api/Vss/ns-vss-vss_snapshot_prop"><strong>VSS_SNAPSHOT_PROP</strong></a>)</span></span></td>
<td><span data-ttu-id="7a935-112">無</span><span class="sxs-lookup"><span data-stu-id="7a935-112">None</span></span></td>
<td><span data-ttu-id="7a935-113">無</span><span class="sxs-lookup"><span data-stu-id="7a935-113">None</span></span></td>
</tr>
<tr class="even">
<td><span data-ttu-id="7a935-114">產生要備份的檔案清單，並將檔案資料複製到備份媒體。</span><span class="sxs-lookup"><span data-stu-id="7a935-114">Generate the list of files to back up, and copy file data to backup media.</span></span></td>
<td><span data-ttu-id="7a935-115">無</span><span class="sxs-lookup"><span data-stu-id="7a935-115">None</span></span></td>
<td><span data-ttu-id="7a935-116">無</span><span class="sxs-lookup"><span data-stu-id="7a935-116">None</span></span></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="7a935-117">使用 <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded"><strong>>ivssbackupcomponents：： SetBackupSucceeded</strong></a>指出備份成功或失敗。</span><span class="sxs-lookup"><span data-stu-id="7a935-117">Indicate the success or failure of the backup with <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded"><strong>IVssBackupComponents::SetBackupSucceeded</strong></a>.</span></span></td>
<td><span data-ttu-id="7a935-118">無</span><span class="sxs-lookup"><span data-stu-id="7a935-118">None</span></span></td>
<td><span data-ttu-id="7a935-119">無</span><span class="sxs-lookup"><span data-stu-id="7a935-119">None</span></span></td>
</tr>
<tr class="even">
<td><span data-ttu-id="7a935-120">要求者會藉由呼叫 <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete"><strong>>ivssbackupcomponents：： BackupComplete</strong></a>來指出備份已完成。</span><span class="sxs-lookup"><span data-stu-id="7a935-120">The requester indicates that the backup has completed by calling <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete"><strong>IVssBackupComponents::BackupComplete</strong></a>.</span></span></td>
<td><span data-ttu-id="7a935-121"><a href="vssgloss-b.md"><em>BackupComplete</em></a></span><span class="sxs-lookup"><span data-stu-id="7a935-121"><a href="vssgloss-b.md"><em>BackupComplete</em></a></span></span></td>
<td><span data-ttu-id="7a935-122">執行任何備份後清除 (參閱 <a href="/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete"><strong>CVssWriter：： OnBackupComplete</strong></a>、 <a href="/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents"><strong>IVssWriterComponents</strong></a>、 <a href="/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent"><strong>>ivsscomponent</strong></a>) 。</span><span class="sxs-lookup"><span data-stu-id="7a935-122">Perform any post-backup cleanup (see <a href="/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete"><strong>CVssWriter::OnBackupComplete</strong></a>, <a href="/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents"><strong>IVssWriterComponents</strong></a>, <a href="/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent"><strong>IVssComponent</strong></a>).</span></span></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="7a935-123">要求者會使用<a href="/windows/desktop/api/Vss/nn-vss-ivssasync"><strong>IVssAsync</strong></a>來等候所有寫入器認可<a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete"><strong>>ivssbackupcomponents：： BackupComplete</strong></a>事件的接收。</span><span class="sxs-lookup"><span data-stu-id="7a935-123">The requester waits for all writers to acknowledge receipt of the <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete"><strong>IVssBackupComponents::BackupComplete</strong></a> event using <a href="/windows/desktop/api/Vss/nn-vss-ivssasync"><strong>IVssAsync</strong></a>.</span></span> <span data-ttu-id="7a935-124">它也應該驗證寫入器狀態 (請參閱 <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus"><strong>>ivssbackupcomponents：： GatherWriterStatus</strong></a>， <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus"><strong>>ivssbackupcomponents：： GetWriterStatus</strong></a>) 。</span><span class="sxs-lookup"><span data-stu-id="7a935-124">It should also verify writer status (see <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus"><strong>IVssBackupComponents::GatherWriterStatus</strong></a>, <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus"><strong>IVssBackupComponents::GetWriterStatus</strong></a>).</span></span> <span data-ttu-id="7a935-125">要求者目前必須呼叫 <strong>GatherWriterStatus</strong> ，使寫入器會話設定為已完成狀態。</span><span class="sxs-lookup"><span data-stu-id="7a935-125">The requester must call <strong>GatherWriterStatus</strong> at this time to cause the writer session to be set to a completed state.</span></span>
<blockquote>
[!Note]<br />
<span data-ttu-id="7a935-126">只有在 Windows Server 2008 Service Pack 2 (SP2) 及更早版本才需要此功能。</span><span class="sxs-lookup"><span data-stu-id="7a935-126">This is only necessary on Windows Server 2008 with Service Pack 2 (SP2) and earlier.</span></span>
</blockquote>
<br/></td>
<td><span data-ttu-id="7a935-127">無</span><span class="sxs-lookup"><span data-stu-id="7a935-127">None</span></span></td>
<td><span data-ttu-id="7a935-128">無</span><span class="sxs-lookup"><span data-stu-id="7a935-128">None</span></span></td>
</tr>
<tr class="even">
<td><span data-ttu-id="7a935-129">將備份元件檔和每個寫入器元資料檔案儲存至 XML 檔，這些檔可以寫入至備份媒體 (參閱 <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml"><strong>>ivssbackupcomponents：： SaveAsXML</strong></a> 和 <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-saveasxml"><strong>IVssExamineWriterMetadata：： SaveAsXML</strong></a>) 。</span><span class="sxs-lookup"><span data-stu-id="7a935-129">Save the Backup Components Document and each Writer Metadata Document to XML documents, which can be written to the backup media (see <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml"><strong>IVssBackupComponents::SaveAsXML</strong></a> and <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-saveasxml"><strong>IVssExamineWriterMetadata::SaveAsXML</strong></a>).</span></span></td>
<td><span data-ttu-id="7a935-130">無</span><span class="sxs-lookup"><span data-stu-id="7a935-130">None</span></span></td>
<td><span data-ttu-id="7a935-131">無</span><span class="sxs-lookup"><span data-stu-id="7a935-131">None</span></span></td>
</tr>
</tbody>
</table>



 

## <a name="writer-actions-during-backup-of-files"></a><span data-ttu-id="7a935-132">備份檔案期間的寫入器動作</span><span class="sxs-lookup"><span data-stu-id="7a935-132">Writer Actions during Backup of Files</span></span>

<span data-ttu-id="7a935-133">陰影複製完成之後，要備份之系統上的所有 i/o 作業都應該能夠繼續，而不會中斷備份的完整性。</span><span class="sxs-lookup"><span data-stu-id="7a935-133">After the shadow copy has been completed, all I/O operations on the system that is being backed up should be able to resume without disrupting the integrity of the backup.</span></span> <span data-ttu-id="7a935-134">這是具有陰影複製功能的其中一個主要動機。</span><span class="sxs-lookup"><span data-stu-id="7a935-134">This is one of the prime motivations for having the shadow copy functionality.</span></span>

<span data-ttu-id="7a935-135">因此，如同在探索階段 (請參閱 [備份探索階段](overview-of-the-backup-discovery-phase.md)) 的總覽，寫入器在檔案實際備份時有一些需求。</span><span class="sxs-lookup"><span data-stu-id="7a935-135">Therefore, as in the discovery phase (see [Overview of the Backup Discovery Phase](overview-of-the-backup-discovery-phase.md)), there are few demands placed on the writers while files are actually being backed up.</span></span>

<span data-ttu-id="7a935-136">備份完成後，如果要求者已產生 [*BackupComplete*](vssgloss-b.md) 事件，則 VSS 會呼叫每個寫入器的 [**CVssWriter：： OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete) 方法，預設只會傳回 **TRUE** 的虛擬方法。</span><span class="sxs-lookup"><span data-stu-id="7a935-136">After a backup has completed, and a requester has generated a [*BackupComplete*](vssgloss-b.md) event, VSS will call each writer's [**CVssWriter::OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete) method, a virtual method that by default simply returns **TRUE**.</span></span> <span data-ttu-id="7a935-137">但是，寫入器可以覆寫預設的執行，並採取這類動作來移除剩餘的暫存檔，或使用呼叫它的 [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents)介面來檢查每個 [*包含之明確*](vssgloss-e.md)元件的備份狀態 (以及它們可能會藉由取出對應的 [**>ivsscomponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent)物件來定義) 的任何 [*元件集*](vssgloss-c.md)。</span><span class="sxs-lookup"><span data-stu-id="7a935-137">However, writers can override the default implementation and take such actions as removing remaining temporary files, or use the [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) interface it is called with to check the state of the backup of each of its [*included explicitly*](vssgloss-e.md) components (and any [*component set*](vssgloss-c.md) they might define) by retrieving the corresponding [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) object.</span></span> <span data-ttu-id="7a935-138">然後，寫入器可以藉由呼叫 [**>ivsscomponent： GetBackupSucceeded**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupsucceeded)，判斷備份成功或失敗。</span><span class="sxs-lookup"><span data-stu-id="7a935-138">The writer can then determine, and act on, the success or failure of the backup by calling [**IVssComponent:GetBackupSucceeded**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupsucceeded).</span></span> <span data-ttu-id="7a935-139">**>ivsscomponent： GetBackupSucceeded** 所傳回的值只有在元件中明確包含的所有檔案，[*而且全部都*](vssgloss-i.md)已成功地備份任何 [*子元件*](vssgloss-s.md)時，才會是 **TRUE** 。</span><span class="sxs-lookup"><span data-stu-id="7a935-139">The value returned by **IVssComponent:GetBackupSucceeded** will be **TRUE** only if all explicitly included files in the component and all [*implicitly included*](vssgloss-i.md) of any of its [*subcomponents*](vssgloss-s.md) have been successfully backed up.</span></span>

<span data-ttu-id="7a935-140">當 [**CVssWriter：： OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete) 的呼叫完成時，要求者應該針對每個寫入器呼叫 [**>ivssbackupcomponents：： GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) 和 [**>ivssbackupcomponents：： GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus) (最後一次) 。</span><span class="sxs-lookup"><span data-stu-id="7a935-140">When the call to [**CVssWriter::OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete) has completed, the requester should call [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) and [**IVssBackupComponents::GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus) (for each writer) one last time.</span></span> <span data-ttu-id="7a935-141">寫入器會話狀態記憶體是有限的資源，而寫入器最後必須重複使用會話狀態。</span><span class="sxs-lookup"><span data-stu-id="7a935-141">The writer session state memory is a limited resource and writers must eventually reuse session states.</span></span> <span data-ttu-id="7a935-142">此步驟會將寫入器的備份會話狀態標示為已完成，並通知 VSS 此備份會話位置可以由後續的備份作業重複使用。</span><span class="sxs-lookup"><span data-stu-id="7a935-142">This step marks the writer’s backup session state as completed and notifies VSS that this backup session slot can be reused by a subsequent backup operation.</span></span>

## <a name="requester-actions-during-backup-of-files"></a><span data-ttu-id="7a935-143">備份檔案期間的要求者動作</span><span class="sxs-lookup"><span data-stu-id="7a935-143">Requester Actions during Backup of Files</span></span>

<span data-ttu-id="7a935-144">如同 [備份探索階段](overview-of-the-backup-discovery-phase.md)所述，您不應該產生要備份的實際檔案清單，直到陰影複製完成為止。</span><span class="sxs-lookup"><span data-stu-id="7a935-144">As noted in [Overview of the Backup Discovery Phase](overview-of-the-backup-discovery-phase.md), you should not generate the actual list of files to be backed up until the shadow copy has completed.</span></span>

<span data-ttu-id="7a935-145">當陰影複製完成之後，會使用對應于指定磁片區陰影複製的 [*裝置物件*](vssgloss-d.md) 來存取陰影複製磁片區上的檔案。</span><span class="sxs-lookup"><span data-stu-id="7a935-145">The [*device object*](vssgloss-d.md) corresponding to the shadow copy of a given volume is used to get access to files on the shadow copied volume once the shadow copy has completed.</span></span> <span data-ttu-id="7a935-146">裝置物件是從 [**>ivssbackupcomponents：： GetSnapshotProperties**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getsnapshotproperties)所傳回的 [**VSS \_ 快照 \_**](/windows/desktop/api/Vss/ns-vss-vss_snapshot_prop)集內容物件取得。</span><span class="sxs-lookup"><span data-stu-id="7a935-146">The device object is obtained from the [**VSS\_SNAPSHOT\_PROP**](/windows/desktop/api/Vss/ns-vss-vss_snapshot_prop) object returned by [**IVssBackupComponents::GetSnapshotProperties**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getsnapshotproperties).</span></span> <span data-ttu-id="7a935-147">陰影複製集的每個陰影複製都有自己的裝置物件。</span><span class="sxs-lookup"><span data-stu-id="7a935-147">Each shadow copy of a shadow copy set will have its own device object.</span></span>

<span data-ttu-id="7a935-148">接著會使用裝置物件以及從元件的寫入器元資料檔案規格取得的路徑，來選取要備份的檔案。</span><span class="sxs-lookup"><span data-stu-id="7a935-148">The device object and the paths obtained from the Writer Metadata Document specifications of components are then used to select files for backup.</span></span> <span data-ttu-id="7a935-149">如需詳細資訊，請參閱要求者 [存取陰影複製的資料](requestor-access-to-shadow-copied-data.md) 。</span><span class="sxs-lookup"><span data-stu-id="7a935-149">See [Requester Access to Shadow Copied Data](requestor-access-to-shadow-copied-data.md) for more information.</span></span>

<span data-ttu-id="7a935-150">哪些檔案將包含在備份清單中，取決於特定備份的本質、在元件 [*selectability 進行備份*](vssgloss-s.md)時，以及寫入器的邏輯路徑結構 (請參閱使用 [selectability 進行備份](working-with-selectability-for-backup.md)) 。</span><span class="sxs-lookup"><span data-stu-id="7a935-150">Which files will be included in the backup list depends on the nature of the particular backup, upon component [*selectability for backup*](vssgloss-s.md), and the logical path structure of the writer (see [Working with Selectability for Backup](working-with-selectability-for-backup.md)).</span></span>

<span data-ttu-id="7a935-151">除了元件中指定的檔案之外，指定的寫入器也可能已明確排除檔案。</span><span class="sxs-lookup"><span data-stu-id="7a935-151">In addition to files specified in the components, a given writer may also have explicitly excluded files.</span></span> <span data-ttu-id="7a935-152">無論選取哪一個元件，都必須遵守檔案排除。</span><span class="sxs-lookup"><span data-stu-id="7a935-152">File exclusion must always be respected, regardless of which components are selected.</span></span>

<span data-ttu-id="7a935-153">此外，如「 [備份探索」階段所](overview-of-the-backup-discovery-phase.md)述，已掛接的資料夾或重新分析點可能會出現在陰影複製中，並可進行備份。</span><span class="sxs-lookup"><span data-stu-id="7a935-153">Also as noted in [Overview of the Backup Discovery Phase](overview-of-the-backup-discovery-phase.md), a mounted folder or reparse point can appear in a shadow copy and can be backed up.</span></span> <span data-ttu-id="7a935-154">但是，無法在陰影複製的磁片區上，執行裝載的資料夾或重新分析點 (請參閱) 使用掛接的 [資料夾和重新分析點](working-with-reparse-and-mount-points.md) 。</span><span class="sxs-lookup"><span data-stu-id="7a935-154">However, a mounted folder or reparse point cannot be traversed on the shadow-copied volume (see [Working with Mounted Folders and Reparse Points](working-with-reparse-and-mount-points.md)).</span></span>

<span data-ttu-id="7a935-155">如果 [**IVssWMFiledesc：： GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation)所傳回的 [*替代路徑*](vssgloss-a.md)不是空白，則在備份作業期間也應該小心。</span><span class="sxs-lookup"><span data-stu-id="7a935-155">Care should also be taken during a backup operation, if the [*alternate path*](vssgloss-a.md) returned by [**IVssWMFiledesc::GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) is not blank.</span></span> <span data-ttu-id="7a935-156">替代的路徑不同于 [*替代位置對應*](vssgloss-a.md) ，因為它只會在備份期間使用，而替代位置對應只會在還原期間使用。</span><span class="sxs-lookup"><span data-stu-id="7a935-156">An alternate path differs from an [*alternate location mapping*](vssgloss-a.md) in that it is used only during backups, while an alternate location mapping is used only during restores.</span></span>

<span data-ttu-id="7a935-157">在此情況下，資料不會從它的一般位置進行備份 (由 [**IVssWMFiledesc：： GetPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath)) 指定，而是從 [**IVssWMFiledesc：： GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation)所傳回的位置。</span><span class="sxs-lookup"><span data-stu-id="7a935-157">In this case, the data is not to be backed up from its normal location (indicated by [**IVssWMFiledesc::GetPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath)), but from the location returned by [**IVssWMFiledesc::GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation).</span></span> <span data-ttu-id="7a935-158">還原時，應該會將檔案傳回至其正常位置。</span><span class="sxs-lookup"><span data-stu-id="7a935-158">On restore, the file should be returned to its normal location.</span></span> <span data-ttu-id="7a935-159">如需詳細資訊，請參閱 [非預設的備份與還原位置](non-default-backup-and-restore-locations.md) 。</span><span class="sxs-lookup"><span data-stu-id="7a935-159">See [Non-Default Backup and Restore Locations](non-default-backup-and-restore-locations.md) for more information.</span></span>

<span data-ttu-id="7a935-160">VSS 對於將資料備份到儲存媒體或選擇該媒體的實際機制沒有任何限制。</span><span class="sxs-lookup"><span data-stu-id="7a935-160">VSS places no restrictions on the actual mechanism of backing up data to a storage medium or the choice of that medium.</span></span> <span data-ttu-id="7a935-161">不過，建議您將每個 [*寫入器實例*](vssgloss-w.md) 的每個元件檔案視為一個單位來處理。</span><span class="sxs-lookup"><span data-stu-id="7a935-161">However, it is recommended that the files of each component of each [*writer instance*](vssgloss-w.md) be processed as a unit.</span></span> <span data-ttu-id="7a935-162">如需有關產生備份檔案清單中的最佳作法的討論，請參閱 [產生備份組](generating-a-backup-set.md) 。</span><span class="sxs-lookup"><span data-stu-id="7a935-162">See [Generating A Backup Set](generating-a-backup-set.md) for a discussion of best practices in generating the backup file list.</span></span>

<span data-ttu-id="7a935-163">備份指定元件所管理之任何檔案的成功或失敗，如果它定義 [*元件集*](vssgloss-c.md) ，) 其 [*子*](vssgloss-s.md) 元件針對指定的寫入器實例 (，應該透過呼叫 [**>ivssbackupcomponents：： SetBackupSucceeded**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded)保留在備份元件檔中。</span><span class="sxs-lookup"><span data-stu-id="7a935-163">The success or failure of backing up any of the files managed by a given component and (if it defines a [*component set*](vssgloss-c.md)) its [*subcomponents*](vssgloss-s.md) for a given writer instance should be preserved in the Backup Components Document by calling [**IVssBackupComponents::SetBackupSucceeded**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded).</span></span> <span data-ttu-id="7a935-164">如果元件或元件集所管理的任何檔案無法備份，就會將整個元件視為失敗。</span><span class="sxs-lookup"><span data-stu-id="7a935-164">If any file managed by a component or component set fails to back up, the entire component is said to fail.</span></span> <span data-ttu-id="7a935-165">應該一律記錄哪些檔案無法備份的確切資訊。</span><span class="sxs-lookup"><span data-stu-id="7a935-165">Exact information about which file failed to back up should always be logged.</span></span>

<span data-ttu-id="7a935-166">開發人員可能會發現，將記錄儲存在備份媒體上的檔案、其所屬的元件與元件、規格，以及它們的原始路徑，都很有説明。</span><span class="sxs-lookup"><span data-stu-id="7a935-166">Developers may find it helpful to store a record on the backup media of which files are backed up, the components and component set they were a member of, their specification, and what their original paths were.</span></span> <span data-ttu-id="7a935-167">儲存每個寫入器元件定義等資訊也可能很有用。</span><span class="sxs-lookup"><span data-stu-id="7a935-167">It may also be useful to store information such as each writer's component definition.</span></span> <span data-ttu-id="7a935-168">這樣做可能會讓抓取作業更簡單。</span><span class="sxs-lookup"><span data-stu-id="7a935-168">Doing this may make the retrieval operation simpler.</span></span> <span data-ttu-id="7a935-169">不過，這類詳細資料會留給要求者開發人員。</span><span class="sxs-lookup"><span data-stu-id="7a935-169">However, such details are left to the requester developer.</span></span>

<span data-ttu-id="7a935-170">因為寫入器可以在處理要求者呼叫 [**>ivssbackupcomponents：:D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset)所產生的 [**PostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot)事件時，修改備份元件檔，所以必須等到非同步呼叫完成之後，才會儲存備份元件檔。</span><span class="sxs-lookup"><span data-stu-id="7a935-170">Because writers can modify the Backup Components Document while handling the [**PostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) event generated by the requester's call to [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset), the Backup Components Document should not be saved until after that asynchronous call has completed.</span></span>

<span data-ttu-id="7a935-171">雖然先前可能會發生這種情況，但這也是儲存寫入器元資料檔案的便利時機。</span><span class="sxs-lookup"><span data-stu-id="7a935-171">Although it may take place earlier, this is also a convenient time to save the Writer Metadata Document.</span></span>

<span data-ttu-id="7a935-172">請務必使用 [**>ivssbackupcomponents：： SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml) 和 [**IVssExamineWriterMetadata：： SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-saveasxml)保留備份元件檔和寫入器元資料檔案。</span><span class="sxs-lookup"><span data-stu-id="7a935-172">It is very important that both the Backup Components Document and the Writer Metadata Documents be preserved using [**IVssBackupComponents::SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml) and [**IVssExamineWriterMetadata::SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-saveasxml).</span></span> <span data-ttu-id="7a935-173">如果不是，則在檔案還原期間將無法使用 VSS。</span><span class="sxs-lookup"><span data-stu-id="7a935-173">If they are not, it will not be possible to make use of VSS during file restoration.</span></span>

<span data-ttu-id="7a935-174">除了儲存原始的中繼資料之外，某些備份應用程式可能會發現，將自己的檔案)  (清單（也就是其相關聯的寫入器、元件、還原程式和位置資訊）儲存到備份媒體以供稍後抓取，是很有用的。</span><span class="sxs-lookup"><span data-stu-id="7a935-174">In addition to storing the original metadata, some backup applications may find it useful to save a copy of their own list of the files (in their own optimized format)—and their associated writer, component, restore procedure, and location information—to the backup media for later retrieval.</span></span> <span data-ttu-id="7a935-175">這類清單可以用來避免在還原期間剖析和比較寫入器元資料檔案與備份元件檔。</span><span class="sxs-lookup"><span data-stu-id="7a935-175">Such a list can be used to avoid some of the parsing and comparing of Writer Metadata Documents and the Backup Component Documents during restore.</span></span>

<span data-ttu-id="7a935-176">正在備份的磁片區可能會有不受 VSS 寫入器管理的資料。</span><span class="sxs-lookup"><span data-stu-id="7a935-176">Volumes being backed up may have data that is not managed by VSS writers.</span></span> <span data-ttu-id="7a935-177">這項資料可以和應該從陰影複製的磁片區進行備份，在這種情況下，它會處於損 [*毀一致的狀態*](vssgloss-c.md)。</span><span class="sxs-lookup"><span data-stu-id="7a935-177">This data can and should be backed up from the shadow copied volume, where it will be in a [*crash-consistent state*](vssgloss-c.md).</span></span> <span data-ttu-id="7a935-178">如需詳細資訊，請參閱 [不含 Writer 參與的備份](backups-without-writer-participation.md) 。</span><span class="sxs-lookup"><span data-stu-id="7a935-178">See [Backups without Writer Participation](backups-without-writer-participation.md) for more information.</span></span>

 

 




