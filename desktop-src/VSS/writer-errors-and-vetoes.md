---
description: 寫入器可能會因為許多程式設計的原因而失敗。
ms.assetid: 50eced73-3917-4d7e-96cc-2d793b448738
title: 寫入器錯誤和 Vetoes
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7c24c15ad10766fc6ec395ed058ab3cb72a689d9
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104191358"
---
# <a name="writer-errors-and-vetoes"></a><span data-ttu-id="0b472-103">寫入器錯誤和 Vetoes</span><span class="sxs-lookup"><span data-stu-id="0b472-103">Writer Errors and Vetoes</span></span>

<span data-ttu-id="0b472-104">寫入器可能會因為許多程式設計的原因而失敗。</span><span class="sxs-lookup"><span data-stu-id="0b472-104">A writer can fail for numerous programmatic reasons.</span></span> <span data-ttu-id="0b472-105">發生這種情況時，它應該會在其中一個處理常式方法中呼叫 [**CVssWriter：： SetWriterFailure**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-setwriterfailure) 方法，以禁止進行中的備份、還原或陰影複製作業 (例如， [**CVssWriter：： OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze) 或 [**CVssWriter：： OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore)) 並傳回 **TRUE**。</span><span class="sxs-lookup"><span data-stu-id="0b472-105">When this happens, it should veto the ongoing backup, restore, or shadow copy operation by calling the [**CVssWriter::SetWriterFailure**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-setwriterfailure) method in one of its handler methods (for example, [**CVssWriter::OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze) or [**CVssWriter::OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore)) and returning **TRUE**.</span></span> <span data-ttu-id="0b472-106">它也可以選擇性地使用 [**IVssComponentEx：： SetPrepareForBackupFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-setprepareforbackupfailuremsg)、 [**IVssComponentEx：： SetPostSnapshotFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-setpostsnapshotfailuremsg)、 [**>ivsscomponent：： SetPreRestoreFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setprerestorefailuremsg)和 [**>ivsscomponent：： SetPostRestoreFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setpostrestorefailuremsg) 方法，以回應特定處理常式方法中的失敗狀況。</span><span class="sxs-lookup"><span data-stu-id="0b472-106">It can also optionally set an error message string in response to a failure condition in certain handler methods with the [**IVssComponentEx::SetPrepareForBackupFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-setprepareforbackupfailuremsg), [**IVssComponentEx::SetPostSnapshotFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-setpostsnapshotfailuremsg), [**IVssComponent::SetPreRestoreFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setprerestorefailuremsg), and [**IVssComponent::SetPostRestoreFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setpostrestorefailuremsg) methods.</span></span> <span data-ttu-id="0b472-107">要求者可以接受拒絕或繼續進行備份，忽略拒絕。</span><span class="sxs-lookup"><span data-stu-id="0b472-107">The requester can accept the veto or continue with the backup, ignoring the veto.</span></span>

<span data-ttu-id="0b472-108">要求者應該使用 [**>ivssbackupcomponents：： GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) 和 [**>ivssbackupcomponents：：) GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus) ，在它產生的每個事件之後，檢查寫入器狀態 (。</span><span class="sxs-lookup"><span data-stu-id="0b472-108">A requester should check the writer status (using [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) and [**IVssBackupComponents::GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus)) following each event it generates.</span></span>

<span data-ttu-id="0b472-109">在某些情況下，您可以使用 [**IVssComponentEx：： GetPrepareForBackupFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-getprepareforbackupfailuremsg)、 [**>ivsscomponent：： GetPreRestoreFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getprerestorefailuremsg)、 [**IVssComponentEx：： GetPostSnapshotFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-getpostsnapshotfailuremsg)和 [**>ivsscomponent：： GetPostRestoreFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpostrestorefailuremsg) 方法) ，從這些失敗中取出錯誤訊息 (，否則寫入器可能會選擇使用 [**>ivsscomponent：： SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata) 和 [**>ivsscomponent：： SetBackupMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupmetadata) （具有錯誤狀態資訊) ）來設定中繼資料 (。</span><span class="sxs-lookup"><span data-stu-id="0b472-109">In some cases, error messages can be retrieved from these failures (using the [**IVssComponentEx::GetPrepareForBackupFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-getprepareforbackupfailuremsg), [**IVssComponent::GetPreRestoreFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getprerestorefailuremsg), [**IVssComponentEx::GetPostSnapshotFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-getpostsnapshotfailuremsg), and [**IVssComponent::GetPostRestoreFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpostrestorefailuremsg) methods), or a writer may choose to set metadata (using [**IVssComponent::SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata) and [**IVssComponent::SetBackupMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupmetadata) with error state information).</span></span> <span data-ttu-id="0b472-110">如需顯示如何查看這類錯誤訊息的範例程式碼，請參閱 [**IVssComponentEx：： GetPrepareForBackupFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-getprepareforbackupfailuremsg)。</span><span class="sxs-lookup"><span data-stu-id="0b472-110">For example code that shows how to view such error messages, see [**IVssComponentEx::GetPrepareForBackupFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-getprepareforbackupfailuremsg).</span></span>

<span data-ttu-id="0b472-111">根據錯誤狀態，要求者或其操作員可以使用備份作業或系統狀態的任何必要修改，重新開機備份和陰影複製。</span><span class="sxs-lookup"><span data-stu-id="0b472-111">Depending on the error state, a requester or its operator could restart the backup and shadow copy with any necessary modification to the state of the backup job or system.</span></span>

<span data-ttu-id="0b472-112">例如，假設 [**GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus) 傳回下列內容：</span><span class="sxs-lookup"><span data-stu-id="0b472-112">For example, suppose [**GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus) returned the following:</span></span>

-   <span data-ttu-id="0b472-113">**VSS \_E \_ WRITERERROR \_ INCONSISTENTSNAPSHOT** 建議要求者可能會將其他磁片區新增至陰影複製</span><span class="sxs-lookup"><span data-stu-id="0b472-113">**VSS\_E\_WRITERERROR\_INCONSISTENTSNAPSHOT** suggests that a requester might add additional volumes to the shadow copy</span></span>
-   <span data-ttu-id="0b472-114">**VSS \_E \_ WRITERERROR \_** 可重試表示重試而不重新設定可能會正常運作。</span><span class="sxs-lookup"><span data-stu-id="0b472-114">**VSS\_E\_WRITERERROR\_RETRYABLE** indicates that retrying without reconfiguration might work.</span></span> <span data-ttu-id="0b472-115">如果寫入器在數次重試之後仍繼續傳回錯誤，請嘗試重新開機裝載寫入器的服務。</span><span class="sxs-lookup"><span data-stu-id="0b472-115">If the writer continues to return the error after several retries, try restarting the service that hosts the writer.</span></span> <span data-ttu-id="0b472-116">下列寫入器裝載于 VSS 服務：登錄寫入器、COM + 類別註冊資料庫寫入器、陰影複製優化寫入器，以及自動系統復原 (ASR) 寫入器中。</span><span class="sxs-lookup"><span data-stu-id="0b472-116">The following writers are hosted in the VSS service: registry writer, COM+ class registration database writer, shadow copy optimization writer, and Automated System Recovery (ASR) writer.</span></span> <span data-ttu-id="0b472-117">如果寫入器屬於在它自己的進程中裝載寫入器的應用程式，請嘗試重新開機應用程式。</span><span class="sxs-lookup"><span data-stu-id="0b472-117">If the writer belongs to an application that hosts the writer in its own process, try restarting the application.</span></span>

    <span data-ttu-id="0b472-118">**Windows Server 2003 和 WINDOWS XP：** 下列寫入器裝載于 VSS 服務：登錄寫入器、COM + 類別註冊資料庫寫入器、應用程式事件記錄檔寫入器，以及 Microsoft SQL Server 2000 桌面引擎 (MSDE) 寫入器。</span><span class="sxs-lookup"><span data-stu-id="0b472-118">**Windows Server 2003 and Windows XP:** The following writers are hosted in the VSS service: registry writer, COM+ class registration database writer, application event log writer, and Microsoft SQL Server 2000 Desktop Engine (MSDE) writer.</span></span>

-   <span data-ttu-id="0b472-119">VSS \_ E \_ 寫入器 \_ 狀態 \_ 無法 \_ 使用指出寫入器可能已達可用備份和還原會話的數目上限，而且當系統較不忙碌時，重試可能會正常運作。</span><span class="sxs-lookup"><span data-stu-id="0b472-119">VSS\_E\_WRITER\_STATUS\_NOT\_AVAILABLE indicates that a writer may have reached the maximum number of available backup and restore sessions, and retrying might work when the system is less busy.</span></span>
-   <span data-ttu-id="0b472-120">**VSS \_E \_ WRITERERROR \_ OUTOFRESOURCES** 或 **VSS \_ e \_ WRITERERROR \_ TIMEOUT** 可能會建議您在重試之前先降低系統負載</span><span class="sxs-lookup"><span data-stu-id="0b472-120">**VSS\_E\_WRITERERROR\_OUTOFRESOURCES** or **VSS\_E\_WRITERERROR\_TIMEOUT** might suggest that system load be reduced prior to retrying</span></span>
-   <span data-ttu-id="0b472-121">**VSS \_E \_ WRITERERROR \_ NONRETRYABLE** 或 **VSS \_ E \_ 寫入 \_ 器沒有 \_ 回應** 可能會指出寫入器錯誤，因此嚴重的原因是不會嘗試使用 VSS 來備份其資料。</span><span class="sxs-lookup"><span data-stu-id="0b472-121">**VSS\_E\_WRITERERROR\_NONRETRYABLE** or **VSS\_E\_WRITER\_NOT\_RESPONDING** would likely indicate a writer error so severe as to preclude trying to back up its data with VSS.</span></span>

<span data-ttu-id="0b472-122">根據所產生的寫入器和哪些元件而定，備份應用程式不一定需要在拒絕或錯誤之後中止。</span><span class="sxs-lookup"><span data-stu-id="0b472-122">Depending on which writer and which components generate them, it is not always necessary for a backup application to abort following a veto or error.</span></span>

<span data-ttu-id="0b472-123">例如，要求者可能會決定陰影複製的目的是要備份應用程式 A，並且已從備份應用程式 B 的寫入器收到拒絕。在此情況下，您可以在略過拒絕時繼續備份應用程式 A。</span><span class="sxs-lookup"><span data-stu-id="0b472-123">For example, a requester may decide that the intent of the shadow copy is to back up application A and the veto has been received from the writer for backup application B. In this case, it is perfectly acceptable to continue to back up application A while ignoring the veto.</span></span>

<span data-ttu-id="0b472-124">以下是寫入器否決的範例：</span><span class="sxs-lookup"><span data-stu-id="0b472-124">The following are examples of a writer veto:</span></span>

-   <span data-ttu-id="0b472-125">當寫入器在建立陰影複製時無法暫停其活動時，寫入器會 vetoes 陰影複製建立程式。</span><span class="sxs-lookup"><span data-stu-id="0b472-125">The writer vetoes the shadow copy creation process when it could not suspend its activities during the time the shadow copy was being created.</span></span> <span data-ttu-id="0b472-126">這表示由於在凍結狀態期間發生寫入作業，導致陰影複製不正確機率很高。</span><span class="sxs-lookup"><span data-stu-id="0b472-126">This indicates that there is a high probability that the shadow copy is not valid because a write operation has occurred during the Freeze state.</span></span>
-   <span data-ttu-id="0b472-127">備份應用程式要求僅限磁片區 C 的陰影複製，而寫入器會判斷 C：和 D：的陰影複製是要備份其資料。</span><span class="sxs-lookup"><span data-stu-id="0b472-127">A backup application has requested a shadow copy of only volume C: and a writer determines that a shadow copy of C: and D: is to back up its data.</span></span> <span data-ttu-id="0b472-128">在此情況下，寫入器將會被拒絕。</span><span class="sxs-lookup"><span data-stu-id="0b472-128">In this case, the writer will veto.</span></span> <span data-ttu-id="0b472-129">備份應用程式可能會檢查中繼資料，並判斷是否要忽略寫入器，或是將會中止陰影複製建立程式，並于稍後重新開機。</span><span class="sxs-lookup"><span data-stu-id="0b472-129">The backup application may examine the metadata and determine whether the writer will be ignored or the shadow copy creation process will be aborted and later restarted.</span></span>

 

 



