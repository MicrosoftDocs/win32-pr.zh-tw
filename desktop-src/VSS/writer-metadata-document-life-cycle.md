---
description: 為了回應識別事件，系統中出現的每個寫入器都會使用 IVssCreateWriterMetadata 來建立自己的寫入器元資料檔案。 識別事件通常是由呼叫 >ivssbackupcomponents：： GatherWriterMetadata 的要求者所產生。
ms.assetid: bae9bbe7-ca55-47cb-b253-8092007cb181
title: 寫入器元資料檔案生命週期
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 45be5748625d21f99abe3e77e0d6474a62210904
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "106972225"
---
# <a name="writer-metadata-document-life-cycle"></a><span data-ttu-id="5424f-104">寫入器元資料檔案生命週期</span><span class="sxs-lookup"><span data-stu-id="5424f-104">Writer Metadata Document Life Cycle</span></span>

<span data-ttu-id="5424f-105">為了回應 [*識別事件*](vssgloss-i.md)，系統中出現的每個寫入器都會使用 [**IVssCreateWriterMetadata**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscreatewritermetadata)來建立自己的寫入器元資料檔案。</span><span class="sxs-lookup"><span data-stu-id="5424f-105">In response to an [*Identify event*](vssgloss-i.md), each writer present on the system constructs its own Writer Metadata Document using [**IVssCreateWriterMetadata**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscreatewritermetadata).</span></span> <span data-ttu-id="5424f-106">*識別事件* 通常是由呼叫 [**>ivssbackupcomponents：： GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata)的要求者所產生。</span><span class="sxs-lookup"><span data-stu-id="5424f-106">An *Identify event* is typically generated by a requester calling [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).</span></span>

<span data-ttu-id="5424f-107">建立寫入器元資料檔案時，可以透過 [**IVssCreateWriterMetadata**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscreatewritermetadata) 介面或透過寫入器初始化 ([**CVssWriter：： Initialize**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-initialize)) ，寫入器必須明確指定下列各項：</span><span class="sxs-lookup"><span data-stu-id="5424f-107">When creating a Writer Metadata Document, either through the [**IVssCreateWriterMetadata**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscreatewritermetadata) interface or through writer initialization ([**CVssWriter::Initialize**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-initialize)), a writer must explicitly specify the following:</span></span>

-   [<span data-ttu-id="5424f-108">*Restore 方法*</span><span class="sxs-lookup"><span data-stu-id="5424f-108">*Restore method*</span></span>](vssgloss-r.md)
-   <span data-ttu-id="5424f-109">寫入器名稱</span><span class="sxs-lookup"><span data-stu-id="5424f-109">Writer name</span></span>
-   [<span data-ttu-id="5424f-110">*寫入器類別識別碼*</span><span class="sxs-lookup"><span data-stu-id="5424f-110">*Writer class ID*</span></span>](vssgloss-w.md)
-   <span data-ttu-id="5424f-111">數據使用量 (請參閱 [**VSS \_ 使用 \_ 類型**](/windows/desktop/api/VsWriter/ne-vswriter-vss_usage_type)) </span><span class="sxs-lookup"><span data-stu-id="5424f-111">Data usage (see [**VSS\_USAGE\_TYPE**](/windows/desktop/api/VsWriter/ne-vswriter-vss_usage_type))</span></span>
-   <span data-ttu-id="5424f-112">日期來源類型 (請參閱 [**VSS \_ 來源 \_ 類型**](/windows/desktop/api/VsWriter/ne-vswriter-vss_source_type)) </span><span class="sxs-lookup"><span data-stu-id="5424f-112">Date source type (see [**VSS\_SOURCE\_TYPE**](/windows/desktop/api/VsWriter/ne-vswriter-vss_source_type))</span></span>

<span data-ttu-id="5424f-113">此外，也可以指定下列各項：</span><span class="sxs-lookup"><span data-stu-id="5424f-113">In addition, it may also specify the following:</span></span>

-   <span data-ttu-id="5424f-114">元件 (不一定會包含檔案集) </span><span class="sxs-lookup"><span data-stu-id="5424f-114">Components (which may or may not contain file sets)</span></span>
-   <span data-ttu-id="5424f-115">新增替代對應</span><span class="sxs-lookup"><span data-stu-id="5424f-115">Add alternate mappings</span></span>
-   <span data-ttu-id="5424f-116">排除檔案清單</span><span class="sxs-lookup"><span data-stu-id="5424f-116">Exclude file lists</span></span>

<span data-ttu-id="5424f-117">在 [備份初始化期間的寫入器動作](overview-of-backup-initialization.md)中，可找到寫入器元資料檔案建立的總覽。</span><span class="sxs-lookup"><span data-stu-id="5424f-117">An overview of Writer Metadata Document creation is found in [Writer Actions during Backup Initialization](overview-of-backup-initialization.md).</span></span>

<span data-ttu-id="5424f-118">要求者通常會使用兩種方法之一來取得寫入器中繼資料的存取權：</span><span class="sxs-lookup"><span data-stu-id="5424f-118">Requesters typically make use of one of two methods to obtain access to writer metadata:</span></span>

-   <span data-ttu-id="5424f-119">在大部分的備份作業期間，要求者會使用 [**>ivssbackupcomponents：： GetWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadata) 來取得 [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) 介面的實例，以允許存取目前執行之寫入器的中繼資料。</span><span class="sxs-lookup"><span data-stu-id="5424f-119">During most backup operations, a requester uses [**IVssBackupComponents::GetWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadata) to obtain an instance of the [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) interface to allow access to the metadata of a currently executing writer.</span></span>
-   <span data-ttu-id="5424f-120">針對還原作業或使用匯入陰影複製的備份 (如需匯入陰影複製的詳細資訊，請參閱匯入可 [傳送的陰影複製磁片](importing-transportable-shadow-copied-volumes.md) 區) ，要求者會抓取包含中繼資料的 XML 檔，並使用 [**CreateVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssexaminewritermetadata) 取得 [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) 介面，以用來讀取還原中繼資料。</span><span class="sxs-lookup"><span data-stu-id="5424f-120">For restore operations, or backups using imported shadow copies (see [Importing Transportable Shadow Copied Volumes](importing-transportable-shadow-copied-volumes.md) for more information on importing shadow copies), a requester retrieves an XML document containing the metadata and uses [**CreateVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssexaminewritermetadata) to obtain an [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) interface, which it uses to read the restore metadata.</span></span>

<span data-ttu-id="5424f-121">寫入器元資料檔案可讓要求者執行備份，以瞭解目前在備份的探索階段期間執行的寫入器。</span><span class="sxs-lookup"><span data-stu-id="5424f-121">Writer Metadata Documents enable the requester performing a backup to learn about currently executing writers during the discovery phase of a backup.</span></span>

<span data-ttu-id="5424f-122">針對選擇要參與備份的寫入器，要求者會在備份的探索階段期間，將寫入器元資料檔案中的大部分資訊（但不是全部）匯入自己的備份元件檔中。</span><span class="sxs-lookup"><span data-stu-id="5424f-122">For those writers chosen to participate in a backup, a requester imports much, but not all, of the information in the Writer Metadata Document into its own Backup Components Document during the discovery phase of a backup.</span></span>

<span data-ttu-id="5424f-123">不過，只有寫入器元資料檔案，而不是備份元件檔包含檔案和路徑規格。</span><span class="sxs-lookup"><span data-stu-id="5424f-123">However, only Writer Metadata Documents and not the Backup Components Document contain the file and path specifications.</span></span>

<span data-ttu-id="5424f-124">如需有關如何執行備份作業之探索階段的詳細資訊，請參閱 [備份探索階段的總覽](overview-of-the-backup-discovery-phase.md)。</span><span class="sxs-lookup"><span data-stu-id="5424f-124">For more information on how the discovery phase of a backup operation is conducted, see [Overview of the Backup Discovery Phase](overview-of-the-backup-discovery-phase.md).</span></span>

<span data-ttu-id="5424f-125">此外，只有 [*明確包含*](vssgloss-e.md) 的元件會在備份作業期間，將其資訊儲存在備份元件檔中。</span><span class="sxs-lookup"><span data-stu-id="5424f-125">In addition, only [*explicitly included*](vssgloss-e.md) components have their information stored in the Backup Components Document during a backup operation.</span></span> <span data-ttu-id="5424f-126">在備份作業期間，不會在備份元件檔中包含 [*隱含包含*](vssgloss-i.md) 元件的相關資訊，而且必須使用明確包含的元件和可用的寫入器元資料檔案的相關資訊來插入。</span><span class="sxs-lookup"><span data-stu-id="5424f-126">Information on [*implicitly included*](vssgloss-i.md) components is not included in the Backup Components Document during a backup operation, and must be interpolated using information about the explicitly included components and the available Writer Metadata Documents.</span></span>

<span data-ttu-id="5424f-127">隱含包含的元件可能仍可 [*供還原*](vssgloss-s.md) ，而且可能需要在還原時明確包含在備份元件檔中。</span><span class="sxs-lookup"><span data-stu-id="5424f-127">Implicitly included components may still be [*selectable for restore*](vssgloss-s.md) and may need to be explicitly included in the Backup Components Document at restore time.</span></span> <span data-ttu-id="5424f-128">在這種情況下，如同在備份作業期間新增元件所需的 writer's 寫入器元資料檔案的存取權， (接著從寫入器中取出) ，要求者需要存取該寫入器的寫入器元資料檔案（在備份時儲存）的複本。</span><span class="sxs-lookup"><span data-stu-id="5424f-128">In this case, just as adding a component during a backup operation required access to the component's writer's Writer Metadata Document (then retrieved from the writer), a requester will require access to a copy of that writer's Writer Metadata Documents stored at backup time.</span></span>

<span data-ttu-id="5424f-129">因此，若要取得有關備份或還原之所有檔案和元件的所有資訊，唯一的方法就是將參與備份的每個寫入器的每個寫入器元資料檔案，與備份元件檔一起儲存。</span><span class="sxs-lookup"><span data-stu-id="5424f-129">Therefore, the only way to obtain all the information about all the files and components involved in a backup or restore is to have each Writer Metadata Document for each writer participating in a backup stored along with the Backup Components Document.</span></span> <span data-ttu-id="5424f-130"> (需詳細資訊，請參閱 [實際檔案還原的總覽](overview-of-actual-file-restoration.md)。 ) </span><span class="sxs-lookup"><span data-stu-id="5424f-130">(For more information, see [Overview of Actual File Restoration](overview-of-actual-file-restoration.md).)</span></span>

 

 



