---
description: 有些情況下，來自某個寫入器的資料相依于其他寫入器所管理的資料。 在這些情況下，您應該備份或還原來自兩個寫入器的資料。
ms.assetid: 0413c289-74b7-4e83-a227-00bfb264e56e
title: 不同寫入器所管理元件之間的相依性
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 91ba3be6a2c2f0a722c4c5f06ca95351e004e1cd
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "104320684"
---
# <a name="dependencies-between-components-managed-by-different-writers"></a><span data-ttu-id="745c1-104">不同寫入器所管理元件之間的相依性</span><span class="sxs-lookup"><span data-stu-id="745c1-104">Dependencies between Components Managed by Different Writers</span></span>

<span data-ttu-id="745c1-105">有些情況下，來自某個寫入器的資料相依于其他寫入器所管理的資料。</span><span class="sxs-lookup"><span data-stu-id="745c1-105">There are situations where data from one writer depends on data managed by another writer.</span></span> <span data-ttu-id="745c1-106">在這些情況下，您應該備份或還原來自兩個寫入器的資料。</span><span class="sxs-lookup"><span data-stu-id="745c1-106">In these cases, you should back up or restore data from both writers.</span></span>

<span data-ttu-id="745c1-107">VSS 會透過明確的寫入器元件相依性和 [**IVssWMDependency**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmdependency) 介面的概念來處理這個問題。</span><span class="sxs-lookup"><span data-stu-id="745c1-107">VSS handles this problem through the notion of an explicit writer-component dependency and the [**IVssWMDependency**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmdependency) interface.</span></span>

<span data-ttu-id="745c1-108">寫入器會在使用 [**IVssCreateWriterMetadata：： AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency) 方法建立寫入器元資料檔案時，新增一個或多個相依性。</span><span class="sxs-lookup"><span data-stu-id="745c1-108">A writer adds one or more dependencies while creating the Writer Metadata Document using the [**IVssCreateWriterMetadata::AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency) method.</span></span> <span data-ttu-id="745c1-109">寫入器會將其所) 管理之相依元件 (的名稱和邏輯路徑傳遞給方法，以及名稱和邏輯路徑，以及 [*寫入器類別識別碼*](vssgloss-w.md) (GUID，以識別其相依元件) 的類別。</span><span class="sxs-lookup"><span data-stu-id="745c1-109">The writer passes the method the name and logical path of the dependent component (which it manages), as well as the name and logical path and the [*writer class ID*](vssgloss-w.md) (the GUID identifying the class) of the component upon which it depends.</span></span>

<span data-ttu-id="745c1-110">一旦建立之後，此相依性會通知要求者在任何備份或還原作業期間，相依元件和其相依性的目標都必須參與。</span><span class="sxs-lookup"><span data-stu-id="745c1-110">Once established, this dependency informs the requester that during any backup or restore operation both the dependent component and the targets of its dependencies must participate.</span></span>

<span data-ttu-id="745c1-111">給定的元件可以有多個相依性，這會要求它及其所有相依的目標同時參與備份和還原。</span><span class="sxs-lookup"><span data-stu-id="745c1-111">A given component can have multiple dependencies, which requires that it and all its dependent targets participate in the backup and restore together.</span></span>

<span data-ttu-id="745c1-112">相依元件和（或）目標 (s) 其相依性可以 [*明確*](vssgloss-e.md) 或 [*隱含*](vssgloss-i.md) 地包含在備份或還原作業中。</span><span class="sxs-lookup"><span data-stu-id="745c1-112">The dependent component and/or the target(s) of its dependencies can be included either [*explicitly*](vssgloss-e.md) or [*implicitly*](vssgloss-i.md) in a backup or restore operations.</span></span>

<span data-ttu-id="745c1-113">明確的寫入器元件相依性機制不應用來建立相同寫入器上兩個元件之間的相依性。</span><span class="sxs-lookup"><span data-stu-id="745c1-113">The explicit writer component dependency mechanism should not be used to create a dependency between two components on the same writer.</span></span> <span data-ttu-id="745c1-114">選取規則可以更有效率地提供相同的功能，而不會有迴圈相依性的風險。</span><span class="sxs-lookup"><span data-stu-id="745c1-114">The selection rules can supply the same functionality more efficiently without risk of circular dependencies.</span></span>

<span data-ttu-id="745c1-115">例如，您可以使用 [**IVssCreateWriterMetadata：： AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency) 來定義元件 writerData (的相依性，其為元件 internetData (上的寫入器 MyWriter 的邏輯路徑 "" ) ，而且具有寫入器類別識別碼 X 之寫入器的邏輯路徑 "" ) 為 InternetConnector。 (雖然可能有多個具有相同類別識別碼的寫入器同時在系統上，但會避免混淆，因為邏輯路徑和元件名稱的組合在 VSS 下的系統上是唯一的。 ) </span><span class="sxs-lookup"><span data-stu-id="745c1-115">As an example, [**IVssCreateWriterMetadata::AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency) could be used to define the dependency of the component writerData (with logical path "") of the writer MyWriter on component internetData (with a logical path of "Connections") of a writer named InternetConnector with a writer Class ID X. (While it is possible for multiple writers with the same class ID to be on the system simultaneously, confusion will be avoided because the combination of logical path and component name is unique on the system under VSS.)</span></span>

<span data-ttu-id="745c1-116">寫入器會將多個相依性加入至指定的元件，只要呼叫 [**IVssCreateWriterMetadata：： AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency) ，就可以從不同的寫入器重複使用不同的元件。</span><span class="sxs-lookup"><span data-stu-id="745c1-116">A writer adds multiple dependencies to a given component simply by calling [**IVssCreateWriterMetadata::AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency) repeated with different components from different writers.</span></span> <span data-ttu-id="745c1-117">您可以藉由檢查 [**VSS \_ COMPONENTINFO**](/windows/desktop/api/VsBackup/ns-vsbackup-vss_componentinfo)結構的 **cDependencies** 成員，找到指定元件相依的其他元件數目。</span><span class="sxs-lookup"><span data-stu-id="745c1-117">The number of other components a given component depends on can be found by examining the **cDependencies** member of the [**VSS\_COMPONENTINFO**](/windows/desktop/api/VsBackup/ns-vsbackup-vss_componentinfo) structure.</span></span>

<span data-ttu-id="745c1-118">寫入器或要求者會使用 [**IVssWMComponent：： GetDependency**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdependency)來抓取 [**IVssWMDependency**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmdependency)介面的實例。</span><span class="sxs-lookup"><span data-stu-id="745c1-118">A writer or requester retrieves instances of the [**IVssWMDependency**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmdependency) interface with [**IVssWMComponent::GetDependency**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdependency).</span></span> <span data-ttu-id="745c1-119">**IVssWMDependency** 會傳回管理相依性目標群組件之寫入器的元件名稱、邏輯路徑和類別識別碼。</span><span class="sxs-lookup"><span data-stu-id="745c1-119">The **IVssWMDependency** returns the component name, logical path, and class ID of the writer managing the component that is the target of the dependency.</span></span>

<span data-ttu-id="745c1-120">相依性機制不規定相依元件與其相依性目標之間的任何特殊喜好設定順序。</span><span class="sxs-lookup"><span data-stu-id="745c1-120">The dependency mechanism does not prescribe any particular order of preference between the dependent component and the targets of its dependencies.</span></span> <span data-ttu-id="745c1-121">如上所述，所有的相依性都是指每當指定的元件是備份或還原時，它所相依的元件或元件也必須一併進行備份或還原。</span><span class="sxs-lookup"><span data-stu-id="745c1-121">As noted above, all a dependency indicates is that whenever a given component is either backed up or restored, the component or components it depends on must be backed up or restored as well.</span></span> <span data-ttu-id="745c1-122">確切的相依性實作為備份應用程式的判斷。</span><span class="sxs-lookup"><span data-stu-id="745c1-122">The exact implementation of dependency is at the discretion of the backup application.</span></span>

<span data-ttu-id="745c1-123">例如，在上述案例中，元件 writerData (邏輯路徑 "" ) 相依于元件 InternetConnector (邏輯路徑「連接」 ) 。</span><span class="sxs-lookup"><span data-stu-id="745c1-123">For example, in the case above, the component writerData (logical path "") depends on component InternetConnector (logical path "Connections").</span></span> <span data-ttu-id="745c1-124">要求者可以用下列其中一種方式來解讀：</span><span class="sxs-lookup"><span data-stu-id="745c1-124">A requester is free to interpret this in either of the following ways:</span></span>

-   <span data-ttu-id="745c1-125">如果選取了相依元件 writerData， (隱含或明確) 進行備份或還原，要求者必須以隱含或明確的方式選取 (，) 其相依性的目標，internetData</span><span class="sxs-lookup"><span data-stu-id="745c1-125">If the dependent component, writerData, is selected (implicitly or explicitly) for backup or restore, the requester must select (either implicitly or explicitly) the target of its dependency, internetData</span></span>
-   <span data-ttu-id="745c1-126">如果未選取要進行備份的相依性（internetData）目標，則不應選取相依元件 writerData。</span><span class="sxs-lookup"><span data-stu-id="745c1-126">If the target of its dependency, internetData, is not selected for backup, then the dependent component, writerData, should not be selected.</span></span>

<span data-ttu-id="745c1-127">不過，在開發相依性的支援時，要求者開發人員應該注意，沒有任何方法可讓寫入器判斷其中一個元件是否為相依性的目標。</span><span class="sxs-lookup"><span data-stu-id="745c1-127">However, when developing support for dependencies, requester developers should be aware that there is no way a writer can determine if one of its components is a target of a dependency.</span></span>

## <a name="declaring-remote-dependencies"></a><span data-ttu-id="745c1-128">宣告遠端相依性</span><span class="sxs-lookup"><span data-stu-id="745c1-128">Declaring Remote Dependencies</span></span>

<span data-ttu-id="745c1-129">分散式應用程式是一種應用程式，可以設定為一次使用一或多部電腦。</span><span class="sxs-lookup"><span data-stu-id="745c1-129">A distributed application is an application that can be configured to use one or more computers at a time.</span></span> <span data-ttu-id="745c1-130">應用程式通常會在一或多部應用程式伺服器電腦上執行，並與 (通訊，但不一定會在一或多部資料庫伺服器電腦) 上執行。</span><span class="sxs-lookup"><span data-stu-id="745c1-130">Typically the application runs on one or more application server computers and communicates with (but may or may not actually run on) one or more database server computers.</span></span> <span data-ttu-id="745c1-131">這項設定有時稱為多重系統部署。</span><span class="sxs-lookup"><span data-stu-id="745c1-131">This configuration is sometimes referred to as a multi-system deployment.</span></span> <span data-ttu-id="745c1-132">通常相同的應用程式也可以設定為在執行應用程式伺服器和資料庫伺服器的單一電腦上執行。</span><span class="sxs-lookup"><span data-stu-id="745c1-132">Often the same application can also be configured to run on a single computer that runs both an application server and a database server.</span></span> <span data-ttu-id="745c1-133">這種設定稱為單一系統部署。</span><span class="sxs-lookup"><span data-stu-id="745c1-133">Such a configuration is called a single-system deployment.</span></span> <span data-ttu-id="745c1-134">在這兩種設定中，應用程式伺服器和資料庫伺服器各自都有各自獨立的 VSS 寫入器。</span><span class="sxs-lookup"><span data-stu-id="745c1-134">In both configurations, the application server and database server each have their own independent VSS writers.</span></span>

<span data-ttu-id="745c1-135">在多重系統部署中，如果應用程式寫入器所管理的元件相依于由資料庫伺服器寫入器管理的遠端元件，這就稱為遠端相依性。</span><span class="sxs-lookup"><span data-stu-id="745c1-135">In a multi-system deployment, if a component managed by the application's writer depends on a remote component managed by the database server's writer, this is called a remote dependency.</span></span> <span data-ttu-id="745c1-136">相較之下， (單一系統部署，只有本機相依性。 ) </span><span class="sxs-lookup"><span data-stu-id="745c1-136">(A single-system deployment, in contrast, has only local dependencies.)</span></span>

<span data-ttu-id="745c1-137">作為多系統部署的範例，請考慮使用 SQL Server 資料庫伺服器作為資料存放區的應用程式伺服器。</span><span class="sxs-lookup"><span data-stu-id="745c1-137">As an example of a multi-system deployment, consider an application server that uses a SQL Server database server as a data store.</span></span> <span data-ttu-id="745c1-138">應用程式特定的資料（包括 web 元件、web 內容檔案和 IIS 中繼資料）位於一或多部電腦上，稱為前端網頁伺服器。</span><span class="sxs-lookup"><span data-stu-id="745c1-138">The application-specific data, which includes the web parts, web content files, and the IIS metabase, resides on one or more computers, called front-end web servers.</span></span> <span data-ttu-id="745c1-139">實際的 SQL 資料存放區（包括 Config 資料庫和多個內容資料庫）位於一或多部其他電腦（稱為後端資料庫伺服器）。</span><span class="sxs-lookup"><span data-stu-id="745c1-139">The actual SQL data store, which includes the Config database and multiple Content databases, resides on one or more other computers, called back-end database servers.</span></span> <span data-ttu-id="745c1-140">每一部前端網頁伺服器都會包含相同的應用程式專屬內容和設定。</span><span class="sxs-lookup"><span data-stu-id="745c1-140">Each of the front-end web servers contains the same application-specific content and configuration.</span></span> <span data-ttu-id="745c1-141">每個後端資料庫伺服器都可以裝載任何內容資料庫或設定資料庫。</span><span class="sxs-lookup"><span data-stu-id="745c1-141">Each of the back-end database servers can host any of the Content databases or the Config database.</span></span> <span data-ttu-id="745c1-142">應用程式軟體只會在前端網頁伺服器上執行，而不會在資料庫伺服器上執行。</span><span class="sxs-lookup"><span data-stu-id="745c1-142">The application software runs only on the front-end web servers, not on the database servers.</span></span> <span data-ttu-id="745c1-143">在此設定中，應用程式的 VSS 寫入器對 SQL 寫入器所管理的元件具有遠端相依性。</span><span class="sxs-lookup"><span data-stu-id="745c1-143">In this configuration, the application's VSS writer has remote dependencies on the components managed by the SQL writer.</span></span>

<span data-ttu-id="745c1-144">寫入器可以宣告遠端相依性，方法是呼叫 [**AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency)方法，並在前面加上 " \\ \\ *RemoteComputerName* \\ "，其中 *RemoteComputerName* 是遠端元件所在的電腦名稱稱，而是 *wszOnLogicalPath* 參數中的邏輯路徑。</span><span class="sxs-lookup"><span data-stu-id="745c1-144">A writer can declare a remote dependency by calling the [**AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency) method, prepending "\\\\*RemoteComputerName*\\", where *RemoteComputerName* is the name of the computer where the remote component resides, to the logical path in the *wszOnLogicalPath* parameter.</span></span> <span data-ttu-id="745c1-145">*RemoteComputerName* 的值可以是 IP 位址或 [**GetComputerNameEx**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getcomputernameexa)函數所傳回的電腦名稱稱。</span><span class="sxs-lookup"><span data-stu-id="745c1-145">The value of *RemoteComputerName* can be an IP address or a computer name returned by the [**GetComputerNameEx**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getcomputernameexa) function.</span></span>

<span data-ttu-id="745c1-146">**Windows Server 2003：** 在 Windows Server 2003 Service Pack 1 (SP1) 之前，寫入器無法宣告遠端相依性。</span><span class="sxs-lookup"><span data-stu-id="745c1-146">**Windows Server 2003:** A writer cannot declare remote dependencies until Windows Server 2003 with Service Pack 1 (SP1).</span></span>

<span data-ttu-id="745c1-147">為了識別相依性，要求者會呼叫 [**IVssWMDependency**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmdependency)介面的 [**GetWriterId**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmdependency-getwriterid)、 [**GetLogicalPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getlogicalpath)和 [**GetComponentName**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmdependency-getcomponentname)方法。</span><span class="sxs-lookup"><span data-stu-id="745c1-147">To identify a dependency, a requester calls the [**GetWriterId**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmdependency-getwriterid), [**GetLogicalPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getlogicalpath), and [**GetComponentName**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmdependency-getcomponentname) methods of the [**IVssWMDependency**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmdependency) interface.</span></span> <span data-ttu-id="745c1-148">要求者必須檢查 **GetComponentName** 在 *pbstrComponentName* 參數中傳回的元件名稱。</span><span class="sxs-lookup"><span data-stu-id="745c1-148">The requester must examine the component name that **GetComponentName** returns in the *pbstrComponentName* parameter.</span></span> <span data-ttu-id="745c1-149">如果元件名稱的開頭是 " \\ \\ "，則要求者必須假設它指定遠端相依性，而 "" 後面的第一個元件 \\ \\ 是在寫入器呼叫 [**AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency)時所指定的 *RemoteComputerName* 。</span><span class="sxs-lookup"><span data-stu-id="745c1-149">If the component name begins with "\\\\", the requester must assume that it specifies a remote dependency and that the first component following "\\\\" is the *RemoteComputerName* that was specified when the writer called [**AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency).</span></span> <span data-ttu-id="745c1-150">如果元件名稱的開頭不 \\ \\ 是 ""，則要求者應假設它指定本機相依性。</span><span class="sxs-lookup"><span data-stu-id="745c1-150">If the component name does not begin with "\\\\", the requester should assume that it specifies a local dependency.</span></span>

<span data-ttu-id="745c1-151">如果有遠端相依性，要求者在備份本機組件時，必須備份遠端元件。</span><span class="sxs-lookup"><span data-stu-id="745c1-151">If there is a remote dependency, the requester must back up the remote component when it backs up the local component.</span></span> <span data-ttu-id="745c1-152">若要備份遠端元件，要求者應該在遠端電腦上有代理程式，並在遠端電腦上起始備份。</span><span class="sxs-lookup"><span data-stu-id="745c1-152">To back up the remote component, the requester should have an agent on the remote computer and should initiate the backup on the remote computer.</span></span>

## <a name="structuring-remote-dependencies"></a><span data-ttu-id="745c1-153">結構化遠端相依性</span><span class="sxs-lookup"><span data-stu-id="745c1-153">Structuring Remote Dependencies</span></span>

<span data-ttu-id="745c1-154">請務必瞭解相依性並非本身的元件。</span><span class="sxs-lookup"><span data-stu-id="745c1-154">It is important to understand that a dependency is not a component in and of itself.</span></span> <span data-ttu-id="745c1-155">需要元件才能保存相依性。</span><span class="sxs-lookup"><span data-stu-id="745c1-155">A component is necessary to hold the dependency.</span></span>

<span data-ttu-id="745c1-156">下列範例示範兩種結構一組相依性的方式。</span><span class="sxs-lookup"><span data-stu-id="745c1-156">The following examples show two ways to structure a set of dependencies.</span></span>

``` syntax
Example 1:
    Writer 1
        Component A
            File A
            File B
            Dependency (SQL/MSDE Writer, Component X, "\")
            Dependency (SQL/MSDE Writer, Component Y, "\")

Example 2:
    Writer 2
        Component A
            File A
            File B
        Component B
            Dependency (SQL/MSDE Writer, Component X, "\")
            Dependency (SQL/MSDE Writer, Component Y, "\")
```

<span data-ttu-id="745c1-157">在範例1中，相依性是由元件 A 所持有。由於只能選取元件，而不是個別檔案，因此以這種方式來結構化元件 A 的相依性時，必須一律將整個元件（包括檔案和相依性）同時備份和還原。</span><span class="sxs-lookup"><span data-stu-id="745c1-157">In example 1, the dependencies are held by Component A. Because only components can be selected, not individual files, structuring Component A's dependencies this way would require that the entire component, both the files and the dependencies, must always be backed up and restored together.</span></span> <span data-ttu-id="745c1-158">它們無法個別備份或還原。</span><span class="sxs-lookup"><span data-stu-id="745c1-158">They cannot be backed up or restored individually.</span></span>

<span data-ttu-id="745c1-159">在範例2中，個別元件 (元件 A 和 B) 保存每個相依性。</span><span class="sxs-lookup"><span data-stu-id="745c1-159">In example 2, separate components (Components A and B) hold each of the dependencies.</span></span> <span data-ttu-id="745c1-160">在此情況下，您可以獨立選取這兩個元件，因此會獨立備份和還原。</span><span class="sxs-lookup"><span data-stu-id="745c1-160">In this case, the two components can be selected independently, and therefore backed up and restored independently.</span></span> <span data-ttu-id="745c1-161">以這種方式來結構化相依性，可讓分散式應用程式更有彈性地管理其遠端相依性。</span><span class="sxs-lookup"><span data-stu-id="745c1-161">Structuring the dependencies this way gives a distributed application much more flexibility in managing its remote dependencies.</span></span>

## <a name="supporting-remote-dependencies"></a><span data-ttu-id="745c1-162">支援遠端相依性</span><span class="sxs-lookup"><span data-stu-id="745c1-162">Supporting Remote Dependencies</span></span>

<span data-ttu-id="745c1-163">要求者可以提供遠端相依性的完整或部分支援。</span><span class="sxs-lookup"><span data-stu-id="745c1-163">A requester can provide full or partial support for remote dependencies.</span></span>

<span data-ttu-id="745c1-164">若要提供完整的支援，要求者應在備份和還原時間進行下列動作。</span><span class="sxs-lookup"><span data-stu-id="745c1-164">To provide full support, the requester should do the following at backup and restore time.</span></span>

<span data-ttu-id="745c1-165">在備份時，要求者必須在前端 (本機) 電腦上啟動備份、判斷存在的相依性，以及多工緩衝處理其他備份工作來捕捉後端資料庫。</span><span class="sxs-lookup"><span data-stu-id="745c1-165">At backup time, the requester must start the backup on the front-end (local) computer, determine the dependencies that exist, and spool additional backup jobs to capture the back-end databases.</span></span> <span data-ttu-id="745c1-166">要求者必須等到遠端電腦上的後端備份工作完成後，再呼叫 [**>ivssbackupcomponents：： SetBackupSucceeded**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded) 和 [**>ivssbackupcomponents：： BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) 方法。</span><span class="sxs-lookup"><span data-stu-id="745c1-166">The requester must wait until after the back-end backup jobs on the remote computer have completed before calling the [**IVssBackupComponents::SetBackupSucceeded**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded) and [**IVssBackupComponents::BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) methods.</span></span> <span data-ttu-id="745c1-167">如果要求者等到後端元件的備份完成，然後再呼叫 **BackupComplete**，這將會產生更容易復原的寫入器備份，以在備份期間執行其他增強功能（例如拓撲鎖定）。</span><span class="sxs-lookup"><span data-stu-id="745c1-167">If the requester waits until the backup of back-end components is complete before calling **BackupComplete**, this will produce a more easily recoverable backup for a writer that implements additional enhancements—such as topology locking, for example—during the backup.</span></span> <span data-ttu-id="745c1-168">下列程式概述要求者應執行的動作：</span><span class="sxs-lookup"><span data-stu-id="745c1-168">The following procedure outlines what the requester should do:</span></span>

1.  <span data-ttu-id="745c1-169">在本機電腦上，要求者會呼叫 [**>ivssbackupcomponents：： InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup)、 [**>ivssbackupcomponents：： GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata)、 [**>ivssbackupcomponents：:P Repareforbackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup)和 [**>ivssbackupcomponents：:D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) 方法。</span><span class="sxs-lookup"><span data-stu-id="745c1-169">On the local computer, the requester calls the [**IVssBackupComponents::InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup), [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), [**IVssBackupComponents::PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup), and [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) methods.</span></span>
2.  <span data-ttu-id="745c1-170">完成本機陰影複製，但在備份完成之前，要求者將要求傳送至遠端電腦上的代理程式，以將額外的備份工作多工緩衝。</span><span class="sxs-lookup"><span data-stu-id="745c1-170">After the local shadow copy is completed, but before the backup is completed, the requester spools additional backup jobs by sending a request to its agent on the remote computer.</span></span>
3.  <span data-ttu-id="745c1-171">在遠端電腦上，要求者的代理程式會藉由呼叫 [**InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup)、 [**GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata)、 [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup)、 [**DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset)、 [**SetBackupSucceeded**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded)和 [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete)，來執行多工緩衝處理的備份順序。</span><span class="sxs-lookup"><span data-stu-id="745c1-171">On the remote computer, the requester's agent performs the spooled backup sequence by calling [**InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup), [**GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup), [**DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset), [**SetBackupSucceeded**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded), and [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete).</span></span>
4.  <span data-ttu-id="745c1-172">當要求者的代理程式已完成遠端電腦上的多工緩衝處理工作時，要求者會藉由呼叫 [**SetBackupSucceeded**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded) 和 [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete)來完成備份順序。</span><span class="sxs-lookup"><span data-stu-id="745c1-172">When the requester's agent has completed the spooled jobs on the remote computer, the requester completes the backup sequence by calling [**SetBackupSucceeded**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded) and [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete).</span></span>

<span data-ttu-id="745c1-173">在還原時，要求者必須啟動牽涉到前端 (本機) 電腦的還原、選取要還原的元件及其相依性，然後藉由呼叫 **>ivssbackupcomponents：:P rerestore** 方法來傳送 [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore)事件。</span><span class="sxs-lookup"><span data-stu-id="745c1-173">At restore time, the requester must start the restore involving the front-end (local) computer, select the components and their dependencies to be restored, and then send the [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) event by calling the **IVssBackupComponents::PreRestore** method.</span></span> <span data-ttu-id="745c1-174">接著，要求者應該在遠端電腦上將後端還原工作多工緩衝處理，並在後端還原完成時呼叫 [**>ivssbackupcomponents：:P ostrestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) 方法。</span><span class="sxs-lookup"><span data-stu-id="745c1-174">The requester should then spool the back-end restore jobs on the remote computer and call the [**IVssBackupComponents::PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) method when the back-end restores are complete.</span></span> <span data-ttu-id="745c1-175">這項需求讓前端寫入器可以更充分掌控還原體驗和整體的系統管理員使用者體驗。</span><span class="sxs-lookup"><span data-stu-id="745c1-175">This requirement gives the front-end writer more control over the restore experience and a better administrator user experience overall.</span></span> <span data-ttu-id="745c1-176">由於每個系統上的備份都不會在相同的時間點發生，因此前端寫入器必須執行一些清除後端資料。</span><span class="sxs-lookup"><span data-stu-id="745c1-176">Because the backups across each of the systems do not occur at the same point in time, the front-end writer will need to perform some cleanup of the back-end data.</span></span> <span data-ttu-id="745c1-177">在先前「宣告遠端相依性」中所討論的範例應用程式中，寫入器應該在還原其中一個後端資料庫完成之後，起始網站重新對應或重新編制索引。</span><span class="sxs-lookup"><span data-stu-id="745c1-177">In the example application discussed in the preceding "Declaring Remote Dependencies", the writer should initiate a site remapping or reindexing after a restore of one of the back-end databases has completed.</span></span> <span data-ttu-id="745c1-178">若要這樣做，寫入器必須在前端伺服器上接收事件。</span><span class="sxs-lookup"><span data-stu-id="745c1-178">To do this, the writer must receive events on the front-end server.</span></span> <span data-ttu-id="745c1-179">下列程式概述要求者應執行的動作：</span><span class="sxs-lookup"><span data-stu-id="745c1-179">The following procedure outlines what the requester should do:</span></span>

1.  <span data-ttu-id="745c1-180">在本機電腦上，要求者會呼叫 [**>ivssbackupcomponents：： InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore)、 [**GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata)、 [**>ivssbackupcomponents：： SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) (或 [**IVssBackupComponentsEx：： SetSelectedForRestoreEx**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex-setselectedforrestoreex)) 和 [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore)。</span><span class="sxs-lookup"><span data-stu-id="745c1-180">On the local computer, the requester calls [**IVssBackupComponents::InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore), [**GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), [**IVssBackupComponents::SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) (or [**IVssBackupComponentsEx::SetSelectedForRestoreEx**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex-setselectedforrestoreex)), and [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore).</span></span>
2.  <span data-ttu-id="745c1-181">在 [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) 階段完成之後，但在 [**PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) 階段開始之前，要求者會將要求傳送至遠端電腦上的代理程式，以將額外的還原工作多工緩衝。</span><span class="sxs-lookup"><span data-stu-id="745c1-181">After the [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) phase is completed, but before the [**PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) phase begins, the requester spools additional restore jobs by sending a request to its agent on the remote computer.</span></span>
3.  <span data-ttu-id="745c1-182">在遠端電腦上，要求者的代理程式會藉由呼叫 [**InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore)、 [**GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata)、 [**SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore)、 [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore)、 [**SetFileRestoreStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setfilerestorestatus) (或 [**SetSelectedForRestoreEx**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex-setselectedforrestoreex)) 和 [**PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore)，來執行多工緩衝處理還原作業。</span><span class="sxs-lookup"><span data-stu-id="745c1-182">On the remote computer, the requester's agent performs the spooled restore jobs by calling [**InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore), [**GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), [**SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore), [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore), [**SetFileRestoreStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setfilerestorestatus) (or [**SetSelectedForRestoreEx**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex-setselectedforrestoreex)), and [**PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore).</span></span>
4.  <span data-ttu-id="745c1-183">當要求者的代理程式已完成遠端電腦上的多工緩衝處理工作時，要求者會藉由呼叫 [**>ivssbackupcomponents：： SetFileRestoreStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setfilerestorestatus) 和 [**PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore)來完成還原順序。</span><span class="sxs-lookup"><span data-stu-id="745c1-183">When the requester's agent has completed the spooled jobs on the remote computer, the requester completes the restore sequence by calling [**IVssBackupComponents::SetFileRestoreStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setfilerestorestatus) and [**PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore).</span></span>

<span data-ttu-id="745c1-184">為了提供遠端相依性的部分支援，要求者必須遵循遠端相依性，並將它們包含在備份中，但是前端和後端系統上的事件順序並不是必要項。</span><span class="sxs-lookup"><span data-stu-id="745c1-184">To provide partial support for remote dependencies, the requester must follow remote dependencies and include them as part of the backup, but the ordering of events on front-end and back-end systems as detailed in the previous two procedures would not be required.</span></span> <span data-ttu-id="745c1-185">對於僅執行部分支援的要求者，要求者應該參考寫入器應用程式的備份/還原檔，以瞭解可以支援的案例。</span><span class="sxs-lookup"><span data-stu-id="745c1-185">For a requester that implements only partial support, the requester should refer to the writer application's backup/restore documentation to understand what scenarios can be supported.</span></span>

 

 
