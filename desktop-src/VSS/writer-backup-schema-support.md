---
description: 若要完整地執行備份，必須參與系統的寫入器。
ms.assetid: ea504f8e-26d9-499e-b3e9-03515b480a75
title: 寫入器備份架構支援
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 593df12f552f206d5d0eedbf8d021b69ef955c6d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104191359"
---
# <a name="writer-backup-schema-support"></a><span data-ttu-id="c814b-103">寫入器備份架構支援</span><span class="sxs-lookup"><span data-stu-id="c814b-103">Writer Backup Schema Support</span></span>

<span data-ttu-id="c814b-104">若要完整地執行備份，必須參與系統的寫入器。</span><span class="sxs-lookup"><span data-stu-id="c814b-104">To fully implement a backup requires participation of the system's writers.</span></span> <span data-ttu-id="c814b-105">不同類型的支援備份稱為「架構」（schema），並由「 (」或「 [**VSS \_ 備份 \_ 架構**](/windows/desktop/api/Vss/ne-vss-vss_backup_schema) 列舉」成員的位 or) 表示。</span><span class="sxs-lookup"><span data-stu-id="c814b-105">Different types of supported backups are referred to as schemas and are indicated by a bitmask (or bitwise OR) of members of the [**VSS\_BACKUP\_SCHEMA**](/windows/desktop/api/Vss/ne-vss-vss_backup_schema) enumeration.</span></span> <span data-ttu-id="c814b-106">目前支援的有效架構包括下列各項：</span><span class="sxs-lookup"><span data-stu-id="c814b-106">The currently supported valid schemas include the following:</span></span>

-   <span data-ttu-id="c814b-107">預設架構： Full (VSS \_ BS \_ 未定義的) -表示寫入器支援備份，其中所有檔案都會備份，不論其上次備份日期為何。</span><span class="sxs-lookup"><span data-stu-id="c814b-107">Default Schema: Full (VSS\_BS\_UNDEFINED)—indicates that a writer supports a backup where all files will be backed up regardless of their last backup date.</span></span> <span data-ttu-id="c814b-108">要求者可以更新每個檔案的備份歷程記錄，而寫入器支援 VSS \_ BS 時間 \_ 戳的列舉值，它會將更新的時間戳記與要求者一起儲存。</span><span class="sxs-lookup"><span data-stu-id="c814b-108">The backup history of each file can be updated by the requester, and writers supporting the VSS\_BS\_TIMESTAMPED enumeration value, it will store an updated time stamp with the requester.</span></span> <span data-ttu-id="c814b-109">此備份配置可用來作為增量或差異備份的基礎。</span><span class="sxs-lookup"><span data-stu-id="c814b-109">This backup scheme can be used as the basis of an incremental or differential backup.</span></span>

    <span data-ttu-id="c814b-110">還原完整備份只需要單一備份映射。</span><span class="sxs-lookup"><span data-stu-id="c814b-110">Restoring a full backup requires only a single backup image.</span></span>

-   <span data-ttu-id="c814b-111">複本備份 (VSS \_ BS \_ 複製) （像是 vss \_ BS \_ 完整備份架構）指出寫入器支援備份，其中所有檔案都會備份，不論其上次備份日期為何。</span><span class="sxs-lookup"><span data-stu-id="c814b-111">Copy Backup (VSS\_BS\_COPY)—like the VSS\_BS\_FULL backup schema, indicates that a writer supports a backup where all files will be backed up regardless of their last backup date.</span></span> <span data-ttu-id="c814b-112">不過，「要求者」或「寫入器」不會更新每個檔案的備份歷程記錄，也不能使用這類備份作為增量或差異備份的基礎。</span><span class="sxs-lookup"><span data-stu-id="c814b-112">However, the backup history of each file will not be updated by either requester or writer, and this sort of backup cannot be used as the basis of an incremental or differential backup.</span></span>
-   <span data-ttu-id="c814b-113">記錄檔 (VSS \_ BS \_ 記錄) -只會備份寫入器的記錄檔。</span><span class="sxs-lookup"><span data-stu-id="c814b-113">Log File (VSS\_BS\_LOG)—only a writer's log files are to be backed up.</span></span> <span data-ttu-id="c814b-114">這需要寫入器至少使用 [**IVssCreateWriterMetadata：： AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles) 方法，將至少一個檔案新增至至少一個元件。</span><span class="sxs-lookup"><span data-stu-id="c814b-114">This requires a writer to have added at least one file to at least one component using the [**IVssCreateWriterMetadata::AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles) method.</span></span> <span data-ttu-id="c814b-115">這是 VSS 專用的備份類型。</span><span class="sxs-lookup"><span data-stu-id="c814b-115">This backup type is specific to VSS.</span></span>
-   <span data-ttu-id="c814b-116">自訂還原位置 (VSS \_ BS \_ 寫入器 \_ 支援 \_ 新 \_ 的目標) —表示在還原時，要求者會在還原時變更其檔案的寫入器支援。</span><span class="sxs-lookup"><span data-stu-id="c814b-116">Custom Restore Locations (VSS\_BS\_WRITER\_SUPPORTS\_NEW\_TARGET)—indicates writer support for a requester changing, at restore time, where its files are restored.</span></span> <span data-ttu-id="c814b-117">這表示已使用 [**>ivsscomponent：： GetNewTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtarget)) 將寫入器編碼為檢查這類重新配置 (，並具有使用重新放置檔案的容量。</span><span class="sxs-lookup"><span data-stu-id="c814b-117">This means that a writer has been coded to check for such relocation (using [**IVssComponent::GetNewTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtarget)), and has the capacity for working with relocated files.</span></span>
-   <span data-ttu-id="c814b-118">Restore with Move (VSS \_ BS \_ 寫入器 \_ 支援 \_ restore \_ with \_ move) -表示寫入器支援使用相同的類別 ID 執行多個寫入器實例，並支援要求者在還原時將元件移至不同的寫入器實例。</span><span class="sxs-lookup"><span data-stu-id="c814b-118">Restore with Move (VSS\_BS\_WRITER\_SUPPORTS\_RESTORE\_WITH\_MOVE)—indicates that the writer supports running multiple writer instances with the same class ID, and it supports a requester moving a component to a different writer instance at restore time.</span></span> <span data-ttu-id="c814b-119">寫入器實例是使用做為 *wszWriterInstanceName* 參數傳遞至 [**CVssWriter：： Initialize**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-initialize) 方法的持續性寫入器實例名稱來指定。</span><span class="sxs-lookup"><span data-stu-id="c814b-119">The writer instance is specified by using a persistent writer instance name that was passed as the *wszWriterInstanceName* parameter to the [**CVssWriter::Initialize**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-initialize) method.</span></span> <span data-ttu-id="c814b-120">要求者可以使用 [**IVssExamineWriterMetadataEx：： GetIdentityEx**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadataex-getidentityex) 取得寫入器實例名稱，並在還原期間使用 [**IVssBackupComponentsEx：： SetSelectedForRestoreEx**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex-setselectedforrestoreex)來移動元件。</span><span class="sxs-lookup"><span data-stu-id="c814b-120">A requester can obtain the writer instance name using [**IVssExamineWriterMetadataEx::GetIdentityEx**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadataex-getidentityex) and move components during restore using [**IVssBackupComponentsEx::SetSelectedForRestoreEx**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex-setselectedforrestoreex).</span></span>

    <span data-ttu-id="c814b-121">**Windows Server 2003 和 WINDOWS XP：** 在 Windows Server 2003 Service Pack 1 (SP1) 之前，不支援這個值。</span><span class="sxs-lookup"><span data-stu-id="c814b-121">**Windows Server 2003 and Windows XP:** This value is not supported until Windows Server 2003 with Service Pack 1 (SP1).</span></span>

-   <span data-ttu-id="c814b-122">增量 (VSS \_ BS 累加 \_ 式) -指出寫入器使用 VSS API 來協助要求者，以確保只有在上一次完整或增量備份之後變更或新增的檔案才會複製到儲存媒體。</span><span class="sxs-lookup"><span data-stu-id="c814b-122">Incremental (VSS\_BS\_INCREMENTAL)—indicates that the writer uses the VSS API to help the requester, ensuring that only files that have been changed or added since the last full or incremental backup are to be copied to a storage medium.</span></span>

    <span data-ttu-id="c814b-123">還原增量備份需要原始備份映射，以及自初始備份之後所做的所有增量備份映射。</span><span class="sxs-lookup"><span data-stu-id="c814b-123">Restoring an incremental backup requires the original backup image and all incremental backup images made since the initial backup.</span></span>

-   <span data-ttu-id="c814b-124">差異 (VSS \_ BS \_ 差異) -指出寫入器使用 vss API 來協助要求者確保只會將上次完整備份之後變更或新增的檔案複製到儲存媒體; 所有的中繼備份資訊都會被忽略。</span><span class="sxs-lookup"><span data-stu-id="c814b-124">Differential (VSS\_BS\_DIFFERENTIAL)—indicates that the writer uses the VSS API to help the requester ensure that only files that have been changed or added since the last full backup are to be copied to a storage medium; all intermediate backup information is ignored.</span></span>

    <span data-ttu-id="c814b-125">還原差異備份需要原始備份映射，以及自上次完整備份之後所做的最新差異備份映射。</span><span class="sxs-lookup"><span data-stu-id="c814b-125">Restoring a differential backup requires the original backup image and the most recent differential backup image made since the last full backup.</span></span>

-   <span data-ttu-id="c814b-126">增量/差異： (VSS BS 有時間戳記) 的時間戳記支援 \_ \_ -指出寫入器支援使用 VSS 時間戳記機制，在增量或差異作業中包含檔案。</span><span class="sxs-lookup"><span data-stu-id="c814b-126">Incremental/Differential: Time Stamping Support (VSS\_BS\_TIMESTAMPED)—indicates that a writer supports using the VSS time-stamp mechanism to include files in incremental or differential operations.</span></span> <span data-ttu-id="c814b-127">在備份時，寫入器必須使用 [**>ivsscomponent：： SetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp)方法儲存檔案 [*集的*](vssgloss-f.md)備份戳記，並在還原時使用 [**>ivsscomponent：： GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp)來取得它。</span><span class="sxs-lookup"><span data-stu-id="c814b-127">At backup, the writer must store a [*file set's*](vssgloss-f.md) backup stamp with the [**IVssComponent::SetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp) method, and at restore retrieve it with [**IVssComponent::GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp).</span></span>
-   <span data-ttu-id="c814b-128">累加/差異：上次修改的時間支援 (VSS \_ BS \_ 上次 \_ 修改) —表示在以差異檔案執行增量或差異備份時，寫入器可以獨立提供最後修改時間資訊。</span><span class="sxs-lookup"><span data-stu-id="c814b-128">Incremental/Differential: Time of Last Modification Support (VSS\_BS\_LAST\_MODIFY)—indicates that when implementing incremental or differential backups with differenced files, a writer can provide last modification time information independently.</span></span> <span data-ttu-id="c814b-129">您可以透過 [**>ivsscomponent：： AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) 方法，將這種資訊提供給要求者。</span><span class="sxs-lookup"><span data-stu-id="c814b-129">This information can be provided to a requester via the [**IVssComponent::AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) method.</span></span>
-   <span data-ttu-id="c814b-130">增量/差異： (VSS \_ BS 獨佔累加 \_ \_ \_ 差異) 的支援限制-指出差異或增量備份架構的寫入器支援，但僅限專用：例如，您不能遵循增量備份和差異備份。</span><span class="sxs-lookup"><span data-stu-id="c814b-130">Incremental/Differential: Support Limitation (VSS\_BS\_EXCLUSIVE\_INCREMENTAL\_DIFFERENTIAL)—indicates writer support of both differential or increment backup schemas, but only exclusively: for example, you cannot follow an incremental backup with a differential backup.</span></span>
-   <span data-ttu-id="c814b-131">獨立系統狀態 (VSS \_ BS \_ 獨立 \_ 系統 \_ 狀態) -指出寫入器支援備份屬於系統狀態的資料，但也可獨立于系統狀態時進行備份。</span><span class="sxs-lookup"><span data-stu-id="c814b-131">Independent System State (VSS\_BS\_INDEPENDENT\_SYSTEM\_STATE)—indicates that the writer supports backing up data that is part of the system state, but that can also be backed up independently of the system state.</span></span>

    <span data-ttu-id="c814b-132">**Windows Server 2003 和 WINDOWS XP：** 在 Windows Vista 之前，不支援這個值。</span><span class="sxs-lookup"><span data-stu-id="c814b-132">**Windows Server 2003 and Windows XP:** This value is not supported until Windows Vista.</span></span>

-   <span data-ttu-id="c814b-133">Roll-Forward Restore (VSS \_ BS \_ 向前復原 \_ Restore) -指出寫入器支援使用 [**IVssBackupComponentsEx2：： SetRollForward**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex2-setrollforward)設定向前復原還原點的要求者。</span><span class="sxs-lookup"><span data-stu-id="c814b-133">Roll-Forward Restore (VSS\_BS\_ROLLFORWARD\_RESTORE)—indicates that the writer supports a requester setting a roll-forward restore point using [**IVssBackupComponentsEx2::SetRollForward**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex2-setrollforward).</span></span>

    <span data-ttu-id="c814b-134">**Windows Server 2003 和 WINDOWS XP：** 在 Windows Vista 之前，不支援這個值。</span><span class="sxs-lookup"><span data-stu-id="c814b-134">**Windows Server 2003 and Windows XP:** This value is not supported until Windows Vista.</span></span>

-   <span data-ttu-id="c814b-135">還原重新命名 (VSS \_ BS \_ 還原 \_ 重新命名) -表示寫入器支援要求者設定使用 [**IVssBackupComponentsEx2：： SetRestoreName**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex2-setrestorename)的還原名稱。</span><span class="sxs-lookup"><span data-stu-id="c814b-135">Restore Rename (VSS\_BS\_RESTORE\_RENAME)—indicates that the writer supports a requester setting a restore name using [**IVssBackupComponentsEx2::SetRestoreName**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex2-setrestorename).</span></span>

    <span data-ttu-id="c814b-136">**Windows Server 2003 和 WINDOWS XP：** 在 Windows Vista 之前，不支援這個值。</span><span class="sxs-lookup"><span data-stu-id="c814b-136">**Windows Server 2003 and Windows XP:** This value is not supported until Windows Vista.</span></span>

-   <span data-ttu-id="c814b-137">授權還原 (VSS \_ BS \_ 授權 \_ 還原) -指出寫入器支援要求者使用 [**IVssBackupComponentsEx2：： SetAuthoritativeRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex2-setauthoritativerestore)設定授權還原。</span><span class="sxs-lookup"><span data-stu-id="c814b-137">Authoritative Restore (VSS\_BS\_AUTHORITATIVE\_RESTORE)—indicates that the writer supports a requester setting authoritative restore using [**IVssBackupComponentsEx2::SetAuthoritativeRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex2-setauthoritativerestore).</span></span>

<span data-ttu-id="c814b-138">寫入器會使用 [**IVssCreateWriterMetadata：： SetBackupSchema**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema) 方法來設定其架構，而要求者會藉由呼叫 [**IVssExamineWriterMetadata：： GetBackupSchema**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getbackupschema)來取得每個寫入器的架構。</span><span class="sxs-lookup"><span data-stu-id="c814b-138">Writers set their schemas using the [**IVssCreateWriterMetadata::SetBackupSchema**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema) method, and a requester obtains each writer's schema by calling [**IVssExamineWriterMetadata::GetBackupSchema**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getbackupschema).</span></span>

 

 



