---
description: 在下列任何情況下，可以在備份作業期間產生中止事件：
ms.assetid: c2e39cdd-0ff8-4030-9bec-9e003b4d9520
title: 中止 VSS 作業
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 35e4b82ba4227dfeb02e3da91c9bc1e77f10f492
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "107000133"
---
# <a name="aborting-vss-operations"></a><span data-ttu-id="1ded9-103">中止 VSS 作業</span><span class="sxs-lookup"><span data-stu-id="1ded9-103">Aborting VSS Operations</span></span>

<span data-ttu-id="1ded9-104">在下列任何情況下，可以在備份作業期間產生 [*中止*](vssgloss-a.md)事件：</span><span class="sxs-lookup"><span data-stu-id="1ded9-104">[*Abort*](vssgloss-a.md) events can be generated during a backup operation in any of the following cases:</span></span>

-   <span data-ttu-id="1ded9-105">要求者會藉由呼叫 [**>ivssbackupcomponents：： AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup)明確產生 [*中止事件*](vssgloss-a.md)。</span><span class="sxs-lookup"><span data-stu-id="1ded9-105">A requester explicitly generates an [*Abort event*](vssgloss-a.md) by calling [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup).</span></span>
-   <span data-ttu-id="1ded9-106">寫入器的 [*凍結*](vssgloss-f.md) 和 [*解除凍結*](vssgloss-t.md) 事件處理常式 ([**CVssWriter：： OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze) 和 [**CVssWriter：： OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw)) 傳回 **false**，或無法在 [**CVssWriter：： Initialize**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-initialize)中指定的時間範圍內完成。</span><span class="sxs-lookup"><span data-stu-id="1ded9-106">A writer's [*Freeze*](vssgloss-f.md) and [*Thaw*](vssgloss-t.md) event handlers ([**CVssWriter::OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze) and [**CVssWriter::OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw)) return **false**, or cannot complete in the time window specified in [**CVssWriter::Initialize**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-initialize).</span></span>
-   <span data-ttu-id="1ded9-107">在 [*PrepareForSnapshot*](vssgloss-p.md) 事件之後建立陰影複製時，提供者或 VSS 有任何失敗。</span><span class="sxs-lookup"><span data-stu-id="1ded9-107">There is any failure of the provider or VSS during the creation of a shadow copy following the [*PrepareForSnapshot*](vssgloss-p.md) event.</span></span>

<span data-ttu-id="1ded9-108">還原作業不支援中止。</span><span class="sxs-lookup"><span data-stu-id="1ded9-108">Aborts are not supported for restore operations.</span></span>

## <a name="requester-handling-and-creation-of-abort-events"></a><span data-ttu-id="1ded9-109">要求者處理和建立中止事件</span><span class="sxs-lookup"><span data-stu-id="1ded9-109">Requester Handling and Creation of Abort Events</span></span>

<span data-ttu-id="1ded9-110">[**>ivssbackupcomponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents)介面的實例只能用於一個備份，因此，如果在處理備份時發生錯誤，通常最好是釋放目前的實例，然後重新開始。</span><span class="sxs-lookup"><span data-stu-id="1ded9-110">An instance of the [**IVSSBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface can be used for only one backup, so if an error occurs in processing a backup it is generally best to release the current instance and start over.</span></span>

<span data-ttu-id="1ded9-111">要求者應該明確地表示它正在中止備份作業 (使用 [**>ivssbackupcomponents：： AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup)) 只有在進行備份的實際準備、涉及寫入器或建立陰影複製時才會發生。</span><span class="sxs-lookup"><span data-stu-id="1ded9-111">A requester should explicitly signal that it is aborting a backup operation (using [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup)) only after the actual preparation for a backup, involving writers, or the creation of a shadow copy has taken place.</span></span>

<span data-ttu-id="1ded9-112">實際上，這表示當要求者在產生 [*PrepareForBackup*](vssgloss-p.md) 事件之後，藉由呼叫 [**>ivssbackupcomponents：:P repareforbackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup)來停止備份作業時，它應該呼叫 [**>ivssbackupcomponents：： AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup) ，並等候其在釋放目前 [**>ivssbackupcomponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) 實例之前的傳回。</span><span class="sxs-lookup"><span data-stu-id="1ded9-112">Effectively, this means that any time a requester needs to stop a backup operation after generating a [*PrepareForBackup*](vssgloss-p.md) event by calling [**IVssBackupComponents::PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup), it should call [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup) and await its return prior to releasing the current [**IVSSBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) instance.</span></span>

<span data-ttu-id="1ded9-113">例如，如果寫入器拒絕備份作業，要求者應該使用 [**>ivssbackupcomponents：： AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup) 通知所有其他寫入器，備份作業將不會完成。</span><span class="sxs-lookup"><span data-stu-id="1ded9-113">For example, if a writer vetoed a backup operation, a requester should use [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup) to notify all other writers that the backup operation will not be completed.</span></span>

<span data-ttu-id="1ded9-114">在呼叫 [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup)之前，或呼叫 **PrepareForBackup** 失敗時，要求者可以釋放目前的 [**>ivssbackupcomponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) 介面實例，而不需要產生 Abort 事件。</span><span class="sxs-lookup"><span data-stu-id="1ded9-114">Prior to calling [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup), or if the call to **PrepareForBackup** fails, a requester can release the current instance of the [**IVSSBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface without needing to generate an Abort event.</span></span>

<span data-ttu-id="1ded9-115">例如，如果 [**>ivssbackupcomponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) 的目前實例只是用來藉由呼叫 [**>ivssbackupcomponents：： GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) 來取得資訊，並產生 [*識別*](vssgloss-i.md) 事件，則在傳回信息之後，就可以直接釋出 **>ivssbackupcomponents** 實例。</span><span class="sxs-lookup"><span data-stu-id="1ded9-115">For example, if the current instance of [**IVSSBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) is being used merely to obtain information by calling [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) and generating an [*Identify*](vssgloss-i.md) event, once information has been returned the instance of **IVSSBackupComponents** can simply be released.</span></span>

<span data-ttu-id="1ded9-116">要求者在呼叫 [**>ivssbackupcomponents：:D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset)時，會產生許多事件 ([*PrepareForSnapshot*](vssgloss-p.md)、[*凍結*](vssgloss-f.md)、[*解凍*](vssgloss-t.md)和 [*PostSnapshot*](vssgloss-p.md)) 。</span><span class="sxs-lookup"><span data-stu-id="1ded9-116">A requester generates a number of events ([*PrepareForSnapshot*](vssgloss-p.md), [*Freeze*](vssgloss-f.md), [*Thaw*](vssgloss-t.md), and [*PostSnapshot*](vssgloss-p.md)) when it calls [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span></span> <span data-ttu-id="1ded9-117">處理凍結和解除凍結事件時，寫入器可能會失敗，並可自行產生中止事件。</span><span class="sxs-lookup"><span data-stu-id="1ded9-117">While handling the Freeze and Thaw events, a writer may fail and can generate an Abort event on its own.</span></span> <span data-ttu-id="1ded9-118">無法處理 PrepareForSnapshot 和 PostSnapshot 事件時，不會產生中止事件。</span><span class="sxs-lookup"><span data-stu-id="1ded9-118">Failure to handle PrepareForSnapshot and PostSnapshot events does not generate an Abort event.</span></span>

<span data-ttu-id="1ded9-119">要求者必須知道在 [**>ivssbackupcomponents：:D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) 指出失敗時是否產生了 Abort 事件。</span><span class="sxs-lookup"><span data-stu-id="1ded9-119">It is not always possible for a requester to know if an Abort event was generated when [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) indicates failure.</span></span> <span data-ttu-id="1ded9-120">因此，需要終止備份作業的要求者，因為 **>ivssbackupcomponents：:D osnapshotset** 的狀態指出問題仍應呼叫 [**>ivssbackupcomponents：： AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup)。</span><span class="sxs-lookup"><span data-stu-id="1ded9-120">Therefore, a requester that needs to terminate a backup operation because the status of **IVssBackupComponents::DoSnapshotSet** indicates a problem should still call [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup).</span></span>

<span data-ttu-id="1ded9-121">如果要求者已呼叫 [**>ivssbackupcomponents：： AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup)，則在釋放 [**>ivssbackupcomponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents)的實例之前，不需要呼叫 [**>ivssbackupcomponents：： BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) 。</span><span class="sxs-lookup"><span data-stu-id="1ded9-121">If a requester has called [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup), it is not necessary to call [**IVssBackupComponents::BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) prior to releasing an instance of [**IVSSBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents).</span></span>

## <a name="writer-handling-and-creation-of-abort-events"></a><span data-ttu-id="1ded9-122">寫入器處理和建立中止事件</span><span class="sxs-lookup"><span data-stu-id="1ded9-122">Writer Handling and Creation of Abort Events</span></span>

<span data-ttu-id="1ded9-123">如先前所述，寫入器可以接收來自要求者的中止事件，或是提供者可以觸發一個本身。</span><span class="sxs-lookup"><span data-stu-id="1ded9-123">As noted previously, a writer can receive an Abort event from a requester, or the provider can trigger one itself.</span></span> <span data-ttu-id="1ded9-124">此外，寫入器可能會在特定情況下接收多個中止事件。</span><span class="sxs-lookup"><span data-stu-id="1ded9-124">Also, it is possible for a writer to receive multiple Abort events under certain circumstances.</span></span> <span data-ttu-id="1ded9-125">寫入器開發人員應該將 [**CVssWriter：： OnAbort**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onabort) 的任何執行程式碼撰寫成這一點。</span><span class="sxs-lookup"><span data-stu-id="1ded9-125">Writer developers should code any implementation of [**CVssWriter::OnAbort**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onabort) with this in mind.</span></span>

<span data-ttu-id="1ded9-126">在處理中止事件時，寫入器應該嘗試還原其所管理的任何處理程式，以做為其正常執行狀態，以及執行任何錯誤處理和記錄。</span><span class="sxs-lookup"><span data-stu-id="1ded9-126">In handling an Abort event, a writer should attempt to restore whatever process it managed to its normal running state, as well as perform any error handling and logging.</span></span>

<span data-ttu-id="1ded9-127">這可能表示， [**CVssWriter：： OnAbort**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onabort) 的執行可能必須執行許多（如果不是全部）與解凍事件處理常式相同的工作 ([**CVssWriter：： OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw)) 和 PostSnapshot 事件處理常式 ([**CVssWriter：： OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot)) ，而且可以從 **CVssWriter：： OnAbort** 中呼叫這些處理常式。</span><span class="sxs-lookup"><span data-stu-id="1ded9-127">This may mean that an implementation of [**CVssWriter::OnAbort**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onabort) might have to perform many, if not all, of the same tasks as the Thaw event handler ([**CVssWriter::OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw)) and the PostSnapshot event handler ([**CVssWriter::OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot)), and these handlers can be called from within **CVssWriter::OnAbort**.</span></span>

 

 



