---
description: 備份的這個階段會初始化寫入器和要求者、填入其內部資料結構、指定備份，以及透過 >ivssbackupcomponents：： GatherWriterMetadata 的必要呼叫來建立寫入器/要求者通訊。 如需詳細資訊，請參閱在 VSS 下處理備份的總覽。
ms.assetid: 1fc46062-c4a0-4aa2-ae05-3d7cded18584
title: 備份初始化的總覽
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 53fb97b43cf19ca60e3e4601899700e35bdad3aa
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "106975037"
---
# <a name="overview-of-backup-initialization"></a><span data-ttu-id="e2cf4-104">備份初始化的總覽</span><span class="sxs-lookup"><span data-stu-id="e2cf4-104">Overview of Backup Initialization</span></span>

<span data-ttu-id="e2cf4-105">備份的這個階段會初始化寫入器和要求者、填入其內部資料結構、指定備份，以及透過 [**>ivssbackupcomponents：： GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata)的必要呼叫來建立寫入器/要求者通訊。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-105">This stage of the backup initializes both the writer and the requester, filling in their internal data structures, specifying the backup and establishes writer/requester communication through the required call to [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).</span></span> <span data-ttu-id="e2cf4-106">如需詳細資訊，請參閱 [在 VSS 下處理備份的總覽](overview-of-processing-a-backup-under-vss.md)。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-106">For more information, see [Overview of Processing a Backup Under VSS](overview-of-processing-a-backup-under-vss.md).</span></span>

<span data-ttu-id="e2cf4-107">下表顯示備份初始化所需的動作和事件的順序。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-107">The following table shows the sequence of actions and events that are required for backup initialization.</span></span>



| <span data-ttu-id="e2cf4-108">要求者動作</span><span class="sxs-lookup"><span data-stu-id="e2cf4-108">Requester action</span></span>                                                                                                                                                                                                                                                                                                                            | <span data-ttu-id="e2cf4-109">事件</span><span class="sxs-lookup"><span data-stu-id="e2cf4-109">Event</span></span>                                                     | <span data-ttu-id="e2cf4-110">寫入器動作</span><span class="sxs-lookup"><span data-stu-id="e2cf4-110">Writer action</span></span>                                                                                                                                                                                                                                              |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="e2cf4-111">建立 [**>ivssbackupcomponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) 介面並將它初始化以管理備份 (請參閱 [**CreateVssBackupComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssbackupcomponents)、 [**>ivssbackupcomponents：： InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup)) 並選擇性地啟用或停用系統上的寫入器。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-111">Creates an [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface and initializes it to manage a backup (see [**CreateVssBackupComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssbackupcomponents), [**IVssBackupComponents::InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup)) and optionally enable or disable writers on the system.</span></span> | <span data-ttu-id="e2cf4-112">無</span><span class="sxs-lookup"><span data-stu-id="e2cf4-112">None</span></span>                                                      | <span data-ttu-id="e2cf4-113">無</span><span class="sxs-lookup"><span data-stu-id="e2cf4-113">None</span></span>                                                                                                                                                                                                                                                       |
| <span data-ttu-id="e2cf4-114">（選擇性）設定陰影複製作業的內容，並選擇性地查詢系統所支援之提供者和陰影複製的系統 (參閱 [**>ivssbackupcomponents：： SetCoNtext**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setcontext)， [**>ivssbackupcomponents：： query**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-query)) 。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-114">Optionally set the context for shadow copy operations and optionally query the system about the providers and shadow copies it supports (see [**IVssBackupComponents::SetContext**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setcontext), [**IVssBackupComponents::Query**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-query)).</span></span>                                               | <span data-ttu-id="e2cf4-115">無</span><span class="sxs-lookup"><span data-stu-id="e2cf4-115">None</span></span>                                                      | <span data-ttu-id="e2cf4-116">無</span><span class="sxs-lookup"><span data-stu-id="e2cf4-116">None</span></span>                                                                                                                                                                                                                                                       |
| <span data-ttu-id="e2cf4-117">要求者可以提供處理備份和還原作業的其他資訊 (請參閱 [**>ivssbackupcomponents：： SetBackupState**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate)) </span><span class="sxs-lookup"><span data-stu-id="e2cf4-117">The requester can provide additional information on handling backup and restore operations (see [**IVssBackupComponents::SetBackupState**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate))</span></span>                                                                                                                                                        | <span data-ttu-id="e2cf4-118">無</span><span class="sxs-lookup"><span data-stu-id="e2cf4-118">None</span></span>                                                      | <span data-ttu-id="e2cf4-119">無</span><span class="sxs-lookup"><span data-stu-id="e2cf4-119">None</span></span>                                                                                                                                                                                                                                                       |
| <span data-ttu-id="e2cf4-120">使用寫入器起始非同步連絡人 (請參閱 [**>ivssbackupcomponents：： GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata)) </span><span class="sxs-lookup"><span data-stu-id="e2cf4-120">Initiates asynchronous contact with writers (see [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata))</span></span>                                                                                                                                                                                           | [<span data-ttu-id="e2cf4-121">*識別*</span><span class="sxs-lookup"><span data-stu-id="e2cf4-121">*Identify*</span></span>](vssgloss-i.md) | <span data-ttu-id="e2cf4-122">建立寫入器元資料檔案 (請參閱 [使用寫入器元資料檔案](working-with-the-writer-metadata-document.md) [**CVssWriter：： OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify)， [**IVssCreateWriterMetadata**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscreatewritermetadata)) </span><span class="sxs-lookup"><span data-stu-id="e2cf4-122">Creates a Writer Metadata Document (see [Working with the Writer Metadata Document](working-with-the-writer-metadata-document.md), [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify), [**IVssCreateWriterMetadata**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscreatewritermetadata))</span></span> |



 

## <a name="requester-actions-during-backup-initialization"></a><span data-ttu-id="e2cf4-123">備份初始化期間的要求者動作</span><span class="sxs-lookup"><span data-stu-id="e2cf4-123">Requester Actions during Backup Initialization</span></span>

<span data-ttu-id="e2cf4-124">[**>ivssbackupcomponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents)物件只能用於一個備份。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-124">An [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) object can be used for only one backup.</span></span> <span data-ttu-id="e2cf4-125">因此，要求者必須繼續進行備份的結尾，包括釋放 **>ivssbackupcomponents** 介面。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-125">Therefore, a requester must proceed through to the end of the backup, including releasing the **IVssBackupComponents** interface.</span></span> <span data-ttu-id="e2cf4-126">如果備份必須提前終止，要求者必須呼叫 [**>ivssbackupcomponents：： AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup) ，然後釋放 **>ivssbackupcomponents** 物件 (如需詳細資訊，請參閱 [中止 VSS 作業](aborting-vss-operations.md)) 。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-126">If the backup needs to terminate prematurely, the requester needs to call [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup) and then release the **IVssBackupComponents** object (see [Aborting VSS Operations](aborting-vss-operations.md) for more information).</span></span> <span data-ttu-id="e2cf4-127">請勿嘗試繼續 **>ivssbackupcomponents** 介面。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-127">Do not attempt to resume the **IVssBackupComponents** interface.</span></span>

<span data-ttu-id="e2cf4-128">通常，要求者的備份元件檔會初始化為空白。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-128">Typically, a requester's Backup Components Document is initialized as empty.</span></span> <span data-ttu-id="e2cf4-129">當呼叫 [**>ivssbackupcomponents：： InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup) 時，可以載入預存的備份元件檔，通常支援可轉移陰影複製的磁片區。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-129">A stored Backup Components Document can be loaded when [**IVssBackupComponents::InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup) is called, typically in support of transportable shadow copied volumes.</span></span> <span data-ttu-id="e2cf4-130">在此情況下，寫入器要求者通訊將會與下面所述的內容稍有不同。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-130">In this case, the writer-requester communication will be somewhat different than what is described below.</span></span> <span data-ttu-id="e2cf4-131"> (如需詳細資訊，請參閱匯 [入可傳送的陰影複製磁片](importing-transportable-shadow-copied-volumes.md) 區。 ) </span><span class="sxs-lookup"><span data-stu-id="e2cf4-131">(See [Importing Transportable Shadow Copied Volumes](importing-transportable-shadow-copied-volumes.md) for more information.)</span></span>

<span data-ttu-id="e2cf4-132">若要將磁片區新增至陰影複製集，要求者必須先呼叫 [**>ivssbackupcomponents：： SetCoNtext**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setcontext)來設定陰影複製作業的內容。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-132">To add volumes to the shadow copy set, a requester must first set the context for the shadow copy operation by calling [**IVssBackupComponents::SetContext**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setcontext).</span></span> <span data-ttu-id="e2cf4-133">如果未呼叫這個方法，則會使用陰影複製的預設內容， \_ \_ 也就是 VSS CTX 備份。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-133">If this method is not called, the default context for shadow copies, VSS\_CTX\_BACKUP, is used.</span></span> <span data-ttu-id="e2cf4-134">如需設定陰影複製內容的相關資訊，請參閱 [陰影複製內容](shadow-copy-context-configurations.md)設定。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-134">For information about setting the shadow copy context, see [Shadow Copy Context Configurations](shadow-copy-context-configurations.md).</span></span>

<span data-ttu-id="e2cf4-135">若要在備份之前開始完成設定，要求者必須呼叫 [**>ivssbackupcomponents：： SetBackupState**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate)。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-135">To begin the completion of its setup prior to backup, a requester must call [**IVssBackupComponents::SetBackupState**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate).</span></span> <span data-ttu-id="e2cf4-136">藉由執行此動作，要求者會向寫入器指出：</span><span class="sxs-lookup"><span data-stu-id="e2cf4-136">By doing this, a requester indicates to the writers:</span></span>

-   <span data-ttu-id="e2cf4-137">以 [**VSS \_ 備份 \_ 類型**](/windows/desktop/api/Vss/ne-vss-vss_backup_type) 定義的備份 (類型) </span><span class="sxs-lookup"><span data-stu-id="e2cf4-137">The type of backup (as defined in [**VSS\_BACKUP\_TYPE**](/windows/desktop/api/Vss/ne-vss-vss_backup_type))</span></span>
-   <span data-ttu-id="e2cf4-138">備份是否包含可開機的系統狀態</span><span class="sxs-lookup"><span data-stu-id="e2cf4-138">Whether the backup includes a bootable system state</span></span>
-   <span data-ttu-id="e2cf4-139">要求者是否支援選取個別元件或備份整個磁片區。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-139">Whether the requester supports the selection of individual components or backs up entire volumes.</span></span>

<span data-ttu-id="e2cf4-140">所有參與備份和還原作業的要求者都必須一律呼叫 [**>ivssbackupcomponents：： GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata)。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-140">All requesters participating in backup and restore operations must always call [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).</span></span> <span data-ttu-id="e2cf4-141">這個方法會藉由產生 VSS [*識別*](vssgloss-i.md) 事件來起始寫入器要求者通訊，以回應寫入器建立其元資料檔案的回應。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-141">This method initiates writer-requester communication by generating a VSS [*Identify*](vssgloss-i.md) event, in response to which a writer creates its metadata document.</span></span>

<span data-ttu-id="e2cf4-142">在呼叫 [**>ivssbackupcomponents：： GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata)之前，要求者有機會明確地啟用或停用特定的寫入器和寫入器類別，方法是使用 [**>ivssbackupcomponents：： EnableWriterClasses**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-enablewriterclasses)、 [**>ivssbackupcomponents：:D Isablewriterinstances**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-disablewriterinstances)和 [**>ivssbackupcomponents：:D isablewriterclasses**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-disablewriterclasses) (預設會啟用) 的所有類別。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-142">Prior to calling [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), a requester has an opportunity to explicitly enable or disable certain specific writers and writer classes using [**IVssBackupComponents::EnableWriterClasses**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-enablewriterclasses), [**IVssBackupComponents::DisableWriterInstances**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-disablewriterinstances), and [**IVssBackupComponents::DisableWriterClasses**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-disablewriterclasses) (by default, all classes are enabled).</span></span> <span data-ttu-id="e2cf4-143">呼叫 **>ivssbackupcomponents：： GatherWriterMetadata** 之後，這些呼叫不會有任何作用。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-143">After **IVssBackupComponents::GatherWriterMetadata** is called, these calls have no effect.</span></span>

<span data-ttu-id="e2cf4-144">因為沒有任何方法可以在呼叫 [**>ivssbackupcomponents：： GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata)之前取得系統上的寫入器清單，所以要求者可以考慮建立然後刪除第二個 [**>ivssbackupcomponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) 實例來取得清單。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-144">Because there is no way to obtain a list of writers on the system prior to calling [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), requesters may consider creating and then deleting a second instance of [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) to obtain the list.</span></span>

<span data-ttu-id="e2cf4-145">[**>ivssbackupcomponents：： GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata)完成後，就不需要呼叫 [**>ivssbackupcomponents：： GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) 。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-145">It is not necessary to call [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) following the completion of [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).</span></span> <span data-ttu-id="e2cf4-146">無法處理呼叫所產生之 [*識別*](vssgloss-i.md) 事件的寫入器，將不會成為提供 [**>ivssbackupcomponents：： GetWriterMetadataCount**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadatacount) 和 [**>ivssbackupcomponents：： GetWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadata) 所找到之中繼資料的寫入器清單的一部分 (請參閱 [判斷寫入器狀態](determining-writer-status.md)) 。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-146">Writers that fail to process the [*Identify*](vssgloss-i.md) event generated by the calls will not be part of the list of writers providing metadata found by [**IVssBackupComponents::GetWriterMetadataCount**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadatacount) and [**IVssBackupComponents::GetWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadata) (see [Determining Writer Status](determining-writer-status.md)).</span></span>

## <a name="writer-actions-during-backup-initialization"></a><span data-ttu-id="e2cf4-147">備份初始化期間的寫入器動作</span><span class="sxs-lookup"><span data-stu-id="e2cf4-147">Writer Actions during Backup Initialization</span></span>

<span data-ttu-id="e2cf4-148">為了回應識別事件，VSS 會呼叫每個寫入器的虛擬處理常式方法，即 [**CVssWriter：： OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify)。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-148">In response to the Identify event, VSS calls each writer's virtual handler method, [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify).</span></span> <span data-ttu-id="e2cf4-149">寫入器會藉由覆寫 **CVssWriter：： OnIdentify** 的預設執行，並使用 [**IVssCreateWriterMetadata**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscreatewritermetadata) 介面，來建立其寫入器元資料檔案。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-149">A writer creates its Writer Metadata Document by overriding the default implementation of **CVssWriter::OnIdentify** and using the [**IVssCreateWriterMetadata**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscreatewritermetadata) interface.</span></span>

<span data-ttu-id="e2cf4-150">請注意，目前要求者以外的應用程式 (例如，系統應用程式) 可以產生寫入器必須處理的識別事件。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-150">Note that applications other than the current requester (for instance, system applications) can generate Identify events that must be handled by the writer.</span></span> <span data-ttu-id="e2cf4-151">此外，寫入器無法從 [**CVssWriter：： OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) 內判斷哪個應用程式已產生識別事件。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-151">In addition, there is no way for a writer to determine from within [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) which application has generated the Identify event.</span></span>

<span data-ttu-id="e2cf4-152">這是這樣的情況，假設寫入器可能會在處理備份作業時收到數個識別事件，寫入器絕對不應該在 [**CVssWriter：： OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) 處理常式中設定狀態資訊。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-152">This being the case, given that a writer may receive several Identify events while processing a backup operation, a writer should never set state information in the [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) handler.</span></span>

<span data-ttu-id="e2cf4-153">相反地， [**CVssWriter：： OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) 應該執行一致的演算法來建立寫入器的寫入器元資料檔案，特別是在寫入器建立檔之後，要求者和寫入器都不能修改它。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-153">Instead, [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) should perform a consistent algorithm to create the writer's Writer Metadata Document, particularly because after a writer creates the document, neither the requester nor the writer can modify it.</span></span> <span data-ttu-id="e2cf4-154">從這裡開始，它是唯讀檔案。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-154">From this point forward, it is a read-only document.</span></span>

<span data-ttu-id="e2cf4-155">這表示與寫入器相關聯的 [*元件*](vssgloss-c.md) 數目和類型、哪些檔案是每個元件的一部分，而從備份或還原作業明確排除檔案，則無法在寫入器從處理識別事件之後變更。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-155">This means that the number and type of [*components*](vssgloss-c.md) associated with a writer, which files are part of each component, and the explicit exclusion of files from backup or restore operations cannot be changed after a writer returns from processing the Identify event.</span></span>

<span data-ttu-id="e2cf4-156">所有參與 VSS 的寫入器都必須執行下列動作：</span><span class="sxs-lookup"><span data-stu-id="e2cf4-156">All writers participating with VSS are required to do the following:</span></span>

1.  <span data-ttu-id="e2cf4-157">使用 [**IVssCreateWriterMetadata：： SetRestoreMethod**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setrestoremethod)指出寫入器所管理之所有元件的還原方法。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-157">Indicate a restore method for all components managed by the writer using [**IVssCreateWriterMetadata::SetRestoreMethod**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setrestoremethod).</span></span>
2.  <span data-ttu-id="e2cf4-158">使用 [**IVssCreateWriterMetadata：： AddComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponent) 加入至少一個元件 (如需元件規格) 的詳細資訊，請參閱 [作者的元件定義](definition-of-components-by-writers.md) 。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-158">Add at least one component using [**IVssCreateWriterMetadata::AddComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponent) (see [Definition of Components by Writers](definition-of-components-by-writers.md) for more information on component specification).</span></span>

<span data-ttu-id="e2cf4-159">寫入器會使用 IVssCreateWriterMetadata：： AddFilesToFileGroup、IVssCreateWriterMetadata：： AddDatabaseFiles 或 [**IVssCreateWriterMetadata：： AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles)，藉由使用 [**：：**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup)、 [**：：**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles)或：：，將檔案 [*集*](vssgloss-f.md)（路徑、檔案規格和遞迴旗標的組合）加入至指定的元件，來指出要參與備份或還原作業的檔案， (參閱 [將檔案新增至元件](definition-of-components-by-writers.md)。 ) </span><span class="sxs-lookup"><span data-stu-id="e2cf4-159">A writer indicates the files to participate in a backup or restore operation by adding [*file sets*](vssgloss-f.md)—a combination of a path, file specification, and a recursion flag—to a given component using [**IVssCreateWriterMetadata::AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup), [**IVssCreateWriterMetadata::AddDatabaseFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), or [**IVssCreateWriterMetadata::AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles), depending on type (See [Adding Files to Components](definition-of-components-by-writers.md).)</span></span>

<span data-ttu-id="e2cf4-160">寫入器也可以有一或多個空白元件，也就是未新增任何檔案的元件。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-160">A writer may also have one or more empty components, components to which no files have been added.</span></span> <span data-ttu-id="e2cf4-161">這些都非常適合用來組織寫入器的元件。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-161">These are very useful in organizing the writer's components.</span></span> <span data-ttu-id="e2cf4-162"> (查看 [元件的邏輯路徑](logical-pathing-of-components.md)。 ) </span><span class="sxs-lookup"><span data-stu-id="e2cf4-162">(See [Logical Pathing of Components](logical-pathing-of-components.md).)</span></span>

<span data-ttu-id="e2cf4-163">寫入器會使用 [**IVssCreateWriterMetadata：： AddExcludeFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addexcludefiles) 明確防止檔案包含在備份中。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-163">A writer uses [**IVssCreateWriterMetadata::AddExcludeFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addexcludefiles) to explicitly prevent files from being included in the backup.</span></span> <span data-ttu-id="e2cf4-164">這個明確的排除功能很有用，因為萬用字元可以用來指定要包含的檔案 (請參閱 [排除檔案清單規格](writer-metadata-document-contents.md)) 。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-164">This explicit exclusion is useful because wildcard characters can be used to specify files for inclusion (see [Exclude File List Specification](writer-metadata-document-contents.md)).</span></span> <span data-ttu-id="e2cf4-165">請注意，[排除檔案] 清單優先于元件檔案清單。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-165">Note that the exclude file list takes precedence over component files lists.</span></span>

<span data-ttu-id="e2cf4-166">[**IVssCreateWriterMetadata：： AddAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addalternatelocationmapping) 是用來針對已新增至其中一個寫入器元件的指定檔案集建立 [*替代位置*](vssgloss-a.md) 對應。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-166">[**IVssCreateWriterMetadata::AddAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addalternatelocationmapping) is used to create [*alternate location mappings*](vssgloss-a.md) for specified file sets that have been added to one of the writer's components.</span></span> <span data-ttu-id="e2cf4-167">當您無法或不想要還原至檔案的原始位置時，會在檔案還原期間使用這些對應。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-167">These mappings are used during file restore when restoring to a file's original location is not possible or desirable.</span></span> <span data-ttu-id="e2cf4-168"> (參閱 [實際檔案還原](overview-of-actual-file-restoration.md) 和 [非預設備份和還原位置](non-default-backup-and-restore-locations.md)的總覽。 ) </span><span class="sxs-lookup"><span data-stu-id="e2cf4-168">(See [Overview of Actual File Restoration](overview-of-actual-file-restoration.md) and [Non-Default Backup and Restore Locations](non-default-backup-and-restore-locations.md).)</span></span>

<span data-ttu-id="e2cf4-169">因為備份檔案集是在寫入器元資料檔案中指定，所以稍後無法進行修改。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-169">Because the backup file set is specified in the Writer Metadata Document, it cannot later be modified.</span></span> <span data-ttu-id="e2cf4-170">因此，寫入器應該撰寫程式碼，讓檔案集的定義將包含備份中所需的所有檔案（依名稱或透過萬用字元）。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-170">Therefore, a writer should be coded so that the file set's definition will include all files needed in the backup, either by name or through wildcard characters.</span></span> <span data-ttu-id="e2cf4-171">當然，這可能包含一些可能會在識別事件之後建立的檔案。</span><span class="sxs-lookup"><span data-stu-id="e2cf4-171">Conceivably, this may include some files that might be created after the Identify event.</span></span>

 

 



