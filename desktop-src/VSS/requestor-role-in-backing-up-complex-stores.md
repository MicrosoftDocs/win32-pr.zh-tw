---
description: 瞭解增量和差異備份中的要求者角色，這需要要求者和寫入器之間的密切合作。
ms.assetid: 00391a49-8c81-4518-88a2-741ad5ee4ac3
title: 備份複雜存放區的要求者角色
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a84dfa1b0b1837bacc2488b6bd9e3ffdd51b92c0
ms.sourcegitcommit: d0eb44d0a95f5e5efbfec3d3e9c143f5cba25bc3
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/17/2021
ms.locfileid: "112262180"
---
# <a name="requester-role-in-backing-up-complex-stores"></a><span data-ttu-id="a2968-103">備份複雜存放區的要求者角色</span><span class="sxs-lookup"><span data-stu-id="a2968-103">Requester Role in Backing Up Complex Stores</span></span>

<span data-ttu-id="a2968-104">如同 VSS 下的所有重要作業， [*增量*](vssgloss-i.md) 和 [*差異*](vssgloss-d.md) 備份都需要在要求者和寫入器之間密切合作。</span><span class="sxs-lookup"><span data-stu-id="a2968-104">As with all important operations under VSS, [*incremental*](vssgloss-i.md) and [*differential*](vssgloss-d.md) backups require close cooperation between requesters and writers.</span></span>

## <a name="backup-type"></a><span data-ttu-id="a2968-105">備份類型</span><span class="sxs-lookup"><span data-stu-id="a2968-105">Backup Type</span></span>

<span data-ttu-id="a2968-106">基礎結構提供五種備份類型的特殊支援。</span><span class="sxs-lookup"><span data-stu-id="a2968-106">The infrastructure provides special support for five types of backup.</span></span> <span data-ttu-id="a2968-107">這些步驟的說明如下：</span><span class="sxs-lookup"><span data-stu-id="a2968-107">They are described as follows:</span></span>

-   <span data-ttu-id="a2968-108">Full (**VSS \_ BT \_ 完整**) 。</span><span class="sxs-lookup"><span data-stu-id="a2968-108">Full (**VSS\_BT\_FULL**).</span></span> <span data-ttu-id="a2968-109">檔案將會備份，不論其上次備份日期為何。</span><span class="sxs-lookup"><span data-stu-id="a2968-109">Files will be backed up regardless of their last backup date.</span></span> <span data-ttu-id="a2968-110">將會更新每個檔案的備份歷程記錄，而這種類型的備份可作為增量或差異備份的基礎使用。</span><span class="sxs-lookup"><span data-stu-id="a2968-110">The backup history of each file will be updated, and this type of backup can be used as the basis of an incremental or differential backup.</span></span> <span data-ttu-id="a2968-111">如果有記錄檔，這些檔案可能會因此備份而被截斷。</span><span class="sxs-lookup"><span data-stu-id="a2968-111">If there are log files, they may be truncated as a result of this backup.</span></span>

    <span data-ttu-id="a2968-112">還原完整備份只需要單一備份映射。</span><span class="sxs-lookup"><span data-stu-id="a2968-112">Restoring a full backup requires only a single backup image.</span></span>

-   <span data-ttu-id="a2968-113">差異 (**VSS \_ BT \_ 差異**) 。</span><span class="sxs-lookup"><span data-stu-id="a2968-113">Differential (**VSS\_BT\_DIFFERENTIAL**).</span></span> <span data-ttu-id="a2968-114">VSS API 是用來確保只有自上次完整備份後已變更或新增的檔案才會複製到儲存媒體;所有中繼備份資訊都會被忽略。</span><span class="sxs-lookup"><span data-stu-id="a2968-114">The VSS API is used to ensure that only files that have been changed or added since the last full backup are to be copied to a storage medium; all intermediate backup information is ignored.</span></span> <span data-ttu-id="a2968-115">這可能包括整個檔案，或檔案內的特定範圍。</span><span class="sxs-lookup"><span data-stu-id="a2968-115">This may include entire files, or specific ranges within files.</span></span> <span data-ttu-id="a2968-116">差異備份會與完整備份相關聯，而且通常在還原完整備份之前無法還原。</span><span class="sxs-lookup"><span data-stu-id="a2968-116">A differential backup is associated with a full backup, and generally cannot be restored until the full backup has been restored.</span></span> <span data-ttu-id="a2968-117">如果有記錄檔，則通常不會因為這項備份而被截斷。</span><span class="sxs-lookup"><span data-stu-id="a2968-117">If there are log files, they will usually not be truncated as a result of this backup.</span></span>

    <span data-ttu-id="a2968-118">還原差異備份需要原始備份映射，以及自上次完整備份之後所做的最新差異備份映射。</span><span class="sxs-lookup"><span data-stu-id="a2968-118">Restoring a differential backup requires the original backup image and the most recent differential backup image made since the last full backup.</span></span>

-   <span data-ttu-id="a2968-119">增量 (**VSS \_ BT \_ 增量**) 。</span><span class="sxs-lookup"><span data-stu-id="a2968-119">Incremental (**VSS\_BT\_INCREMENTAL**).</span></span> <span data-ttu-id="a2968-120">VSS API 是用來確保只有在上一次完整或增量備份之後變更或新增的檔案才會複製到儲存媒體中。</span><span class="sxs-lookup"><span data-stu-id="a2968-120">The VSS API is used to ensure that only files that have been changed or added since the last full or incremental backup are to be copied to a storage medium.</span></span> <span data-ttu-id="a2968-121">這可能包括整個檔案，或檔案內的特定範圍。</span><span class="sxs-lookup"><span data-stu-id="a2968-121">This may include entire files, or specific ranges within files.</span></span> <span data-ttu-id="a2968-122">有些寫入器不允許將增量備份與差異備份混合使用。</span><span class="sxs-lookup"><span data-stu-id="a2968-122">Some writers do not allow incremental backups to be mixed with differential backups.</span></span> <span data-ttu-id="a2968-123">如果有記錄檔，這些檔案可能會因此備份而被截斷。</span><span class="sxs-lookup"><span data-stu-id="a2968-123">If there are log files, they may be truncated as a result of this backup.</span></span>

    <span data-ttu-id="a2968-124">還原增量備份需要原始備份映射，以及自初始備份之後所做的所有增量備份映射。</span><span class="sxs-lookup"><span data-stu-id="a2968-124">Restoring an incremental backup requires the original backup image and all incremental backup images made since the initial backup.</span></span>

-   <span data-ttu-id="a2968-125">記錄備份 (**VSS \_ BT \_ 記錄**) 。</span><span class="sxs-lookup"><span data-stu-id="a2968-125">Log Backup (**VSS\_BT\_LOG**).</span></span> <span data-ttu-id="a2968-126">只有寫入器的記錄檔 (使用 [**IVssCreateWriterMetadata：： AddDataBaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles) 方法新增至元件的檔案，並由 [**IVssWMComponent：： GetDatabaseLogFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabaselogfile)) 的呼叫所取出。</span><span class="sxs-lookup"><span data-stu-id="a2968-126">Only a writer's log files (files added to a component with the [**IVssCreateWriterMetadata::AddDataBaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles) method, and retrieved by a call to [**IVssWMComponent::GetDatabaseLogFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabaselogfile)) will be backed up.</span></span> <span data-ttu-id="a2968-127">這是 VSS 專用的備份類型。</span><span class="sxs-lookup"><span data-stu-id="a2968-127">This backup type is specific to VSS.</span></span> <span data-ttu-id="a2968-128">記錄備份的執行頻率通常很高。</span><span class="sxs-lookup"><span data-stu-id="a2968-128">Log backups tend to be taken quite frequently.</span></span> <span data-ttu-id="a2968-129">一般來說，記錄檔會因為此備份而被截斷。</span><span class="sxs-lookup"><span data-stu-id="a2968-129">Typically, the log file will be truncated as a result of this backup.</span></span>
-   <span data-ttu-id="a2968-130"> (**VSS \_ BT \_ 複製**) 複本備份。</span><span class="sxs-lookup"><span data-stu-id="a2968-130">Copy Backup (**VSS\_BT\_COPY**).</span></span> <span data-ttu-id="a2968-131">就像 VSS \_ BT \_ 完整備份類型一樣，會備份檔案，不論其上次備份日期為何。</span><span class="sxs-lookup"><span data-stu-id="a2968-131">Like the VSS\_BT\_FULL backup type, files will be backed up regardless of their last backup date.</span></span> <span data-ttu-id="a2968-132">不過，每個檔案的備份歷程記錄將不會更新，而且這類備份無法當做增量或差異備份的基礎。</span><span class="sxs-lookup"><span data-stu-id="a2968-132">However, the backup history of each file will not be updated, and this sort of backup cannot be used as the basis of an incremental or differential backup.</span></span> <span data-ttu-id="a2968-133">由於複本備份的結果，記錄檔永遠不會被截斷。</span><span class="sxs-lookup"><span data-stu-id="a2968-133">Log files should never be truncated as a result of a copy backup.</span></span>

<dl> <dt>

<span data-ttu-id="a2968-134"><span id="Partial_File_Support"></span><span id="partial_file_support"></span><span id="PARTIAL_FILE_SUPPORT"></span>部分檔案支援</span><span class="sxs-lookup"><span data-stu-id="a2968-134"><span id="Partial_File_Support"></span><span id="partial_file_support"></span><span id="PARTIAL_FILE_SUPPORT"></span>Partial File Support</span></span>
</dt> <dd>

<span data-ttu-id="a2968-135">有些寫入器支援透過覆寫所管理之檔案的部分來還原檔。</span><span class="sxs-lookup"><span data-stu-id="a2968-135">Some writers support file restoration through the overwriting of parts of the files they manage.</span></span> <span data-ttu-id="a2968-136">要求者可以設計來利用這種方式，如果是，則會藉由設定 [**>ivssbackupcomponents：： SetBackupState**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate)中的資訊來指出這一點。</span><span class="sxs-lookup"><span data-stu-id="a2968-136">A requester may be designed to take advantage of this, and if so it indicates this by setting the information in [**IVssBackupComponents::SetBackupState**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate).</span></span>

</dd> </dl>

<span data-ttu-id="a2968-137">要求者會透過 [**>ivssbackupcomponents：： SetBackupState**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate)的 *backupType* 參數來指定要執行哪種類型的備份。</span><span class="sxs-lookup"><span data-stu-id="a2968-137">The requester specifies what type of backup is being performed through the *backupType* parameter of [**IVssBackupComponents::SetBackupState**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate).</span></span> <span data-ttu-id="a2968-138">不同的寫入器將支援不同類型的備份。</span><span class="sxs-lookup"><span data-stu-id="a2968-138">Different writers will support different types of backup.</span></span> <span data-ttu-id="a2968-139">在呼叫 [**>ivssbackupcomponents：： GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) 之後，要求者可以藉由呼叫 [**IVssExamineWriterMetadata：： GetBackupSchema**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getbackupschema)，判斷指定的寫入器支援哪些備份類型。</span><span class="sxs-lookup"><span data-stu-id="a2968-139">After [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) has been called, the requester can determine what types of backup a given writer supports by calling [**IVssExamineWriterMetadata::GetBackupSchema**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getbackupschema).</span></span> <span data-ttu-id="a2968-140">傳回的值是位元遮罩，表示支援不同的備份類型。</span><span class="sxs-lookup"><span data-stu-id="a2968-140">The returned value is a bit mask indicating support for different backup types.</span></span> <span data-ttu-id="a2968-141">**VSS \_BS \_ 差異** 表示支援差異備份、增量備份的 **vss \_ BS \_ 增量** 、記錄備份的 **vss \_ BS \_ 記錄** 檔，以及適用于複本備份的 **vss \_ BS \_ 複製** ; 所有寫入器都必須支援完整備份。</span><span class="sxs-lookup"><span data-stu-id="a2968-141">**VSS\_BS\_DIFFERENTIAL** indicates support for differential backups, **VSS\_BS\_INCREMENTAL** for incremental backups, **VSS\_BS\_LOG** for log backups, and **VSS\_BS\_COPY** for copy backups; all writers must support full backups.</span></span> <span data-ttu-id="a2968-142">如果寫入器不支援搭配差異備份來混合增量備份，則也會新增 **VSS \_ BS \_ 獨佔 \_ 增量 \_ 差異** 旗標。</span><span class="sxs-lookup"><span data-stu-id="a2968-142">If a writer does not support mixing incremental backups with differential backups, the **VSS\_BS\_EXCLUSIVE\_INCREMENTAL\_DIFFERENTIAL** flag will be added as well.</span></span> <span data-ttu-id="a2968-143">如果要求者正在執行增量或差異備份，而指定的寫入器不支援該備份類型，則應該在該寫入器上執行完整備份。</span><span class="sxs-lookup"><span data-stu-id="a2968-143">If the requester is performing an incremental or differential backup and a given writer does not support that backup type, a full backup should be performed on that writer.</span></span>

## <a name="backup-stamps"></a><span data-ttu-id="a2968-144">備份戳記</span><span class="sxs-lookup"><span data-stu-id="a2968-144">Backup Stamps</span></span>

<span data-ttu-id="a2968-145">增量和差異備份一律會系結至先前的備份。</span><span class="sxs-lookup"><span data-stu-id="a2968-145">Incremental and differential backups are always tied to a previous backup.</span></span> <span data-ttu-id="a2968-146">有兩種方式可以結合備份。</span><span class="sxs-lookup"><span data-stu-id="a2968-146">There are two ways to tie backups.</span></span> <span data-ttu-id="a2968-147">針對簡單的資料存放區，要求者可以追蹤備份之間的相互關聯。</span><span class="sxs-lookup"><span data-stu-id="a2968-147">For simple data stores, the requester can keep track of the correlation between backups.</span></span> <span data-ttu-id="a2968-148">不過，對於更複雜的資料存放區，寫入器必須以備份維護自己的時間戳記;這個時間戳記可能會追蹤記錄位置、檢查點資訊等等。</span><span class="sxs-lookup"><span data-stu-id="a2968-148">However, for more complex data stores, the writer will need to maintain its own timestamp with the backup; this timestamp may keep track of log position, checkpoint information, and so on.</span></span> <span data-ttu-id="a2968-149">要求者可以在 [**IVssExamineWriterMetadata：： GetBackupSchema**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getbackupschema)傳回的值中檢查 **VSS \_ BS 時間 \_ 戳** 位，以判斷指定的寫入器是否需要儲存自己的時間戳記。</span><span class="sxs-lookup"><span data-stu-id="a2968-149">The requester can determine whether a given writer needs to store its own timestamp by checking for the **VSS\_BS\_TIMESTAMPED** bit in the value returned by [**IVssExamineWriterMetadata::GetBackupSchema**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getbackupschema).</span></span>

<span data-ttu-id="a2968-150">將時間戳記儲存在備份中的寫入器會在處理 >ivssbackupcomponents 時新增時間戳記 [**：:P repareforbackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) 或處理 [**>ivssbackupcomponents：:D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset)時。</span><span class="sxs-lookup"><span data-stu-id="a2968-150">Writers that store a timestamp in a backup will add the timestamp either while processing [**IVssBackupComponents::PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) or while processing [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span></span> <span data-ttu-id="a2968-151">要求者可以藉由呼叫 [**>ivsscomponent：： GetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupstamp)來取得此時間戳記。</span><span class="sxs-lookup"><span data-stu-id="a2968-151">The requester can obtain this timestamp by calling [**IVssComponent::GetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupstamp).</span></span> <span data-ttu-id="a2968-152">執行增量或差異備份時，要求者必須將目前的備份系結至先前的備份。</span><span class="sxs-lookup"><span data-stu-id="a2968-152">When performing an incremental or differential backup, the requester needs to tie the current backup to some previous backup.</span></span> <span data-ttu-id="a2968-153">若要完成此動作，請從先前的特定元件備份取得時間戳記，並將其傳遞至 [**>ivssbackupcomponents：： SetPreviousBackupStamp**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setpreviousbackupstamp) 函式;這需要針對先前備份中所備份的每個元件進行。</span><span class="sxs-lookup"><span data-stu-id="a2968-153">This is done by obtaining the timestamp from the previous backup of a specific component and passing it into the [**IVssBackupComponents::SetPreviousBackupStamp**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setpreviousbackupstamp) function; this needs to be done for each component that was backed up in the previous backup.</span></span>

## <a name="backing-up-files"></a><span data-ttu-id="a2968-154">備份檔案</span><span class="sxs-lookup"><span data-stu-id="a2968-154">Backing Up Files</span></span>

### <a name="backing-up-files-reported-by-writer"></a><span data-ttu-id="a2968-155">備份寫入器所報告的檔</span><span class="sxs-lookup"><span data-stu-id="a2968-155">Backing Up Files Reported by Writer</span></span>

<span data-ttu-id="a2968-156">在 GatherWriterMetadata 階段期間，寫入器新增至其中繼資料的每個檔案規格都包含備份類型遮罩，以指定何時應備份檔案。</span><span class="sxs-lookup"><span data-stu-id="a2968-156">Every file specification that a writer adds to its metadata during the GatherWriterMetadata phase contains a backup type mask that specifies when the file should be backed up.</span></span> <span data-ttu-id="a2968-157">要求者會藉由呼叫 [**IVssWMFiledesc：： GetBackupTypeMask**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getbackuptypemask)來判斷此遮罩的意義。</span><span class="sxs-lookup"><span data-stu-id="a2968-157">The requester determines what this mask is by calling [**IVssWMFiledesc::GetBackupTypeMask**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getbackuptypemask).</span></span> <span data-ttu-id="a2968-158">此遮罩中的值可用來決定要備份檔案規格的備份類型。</span><span class="sxs-lookup"><span data-stu-id="a2968-158">The values in this mask are used to determine for which backup types the file specification needs to be backed up.</span></span> <span data-ttu-id="a2968-159">遮罩可以包含下列一或多個位值：</span><span class="sxs-lookup"><span data-stu-id="a2968-159">The mask can contain one or more of the following bit values:</span></span>

<dl> <dt>

<span data-ttu-id="a2968-160"><span id="VSS_FSBT_FULL_BACKUP_REQUIRED"></span><span id="vss_fsbt_full_backup_required"></span>**VSS \_ FSBT \_ \_ 需要完整備份 \_**</span><span class="sxs-lookup"><span data-stu-id="a2968-160"><span id="VSS_FSBT_FULL_BACKUP_REQUIRED"></span><span id="vss_fsbt_full_backup_required"></span>**VSS\_FSBT\_FULL\_BACKUP\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="a2968-161">完整備份的必要參數。</span><span class="sxs-lookup"><span data-stu-id="a2968-161">Required for full backups.</span></span>

</dd> <dt>

<span data-ttu-id="a2968-162"><span id="VSS_FSBT_DIFFERENTIAL_BACKUP_REQUIRED"></span><span id="vss_fsbt_differential_backup_required"></span>**\_需要 VSS FSBT \_ 差異 \_ 備份 \_**</span><span class="sxs-lookup"><span data-stu-id="a2968-162"><span id="VSS_FSBT_DIFFERENTIAL_BACKUP_REQUIRED"></span><span id="vss_fsbt_differential_backup_required"></span>**VSS\_FSBT\_DIFFERENTIAL\_BACKUP\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="a2968-163">差異備份的必要參數。</span><span class="sxs-lookup"><span data-stu-id="a2968-163">Required for differential backups.</span></span>

</dd> <dt>

<span data-ttu-id="a2968-164"><span id="VSS_FSBT_INCREMENTAL_BACKUP_REQUIRED"></span><span id="vss_fsbt_incremental_backup_required"></span>**\_需要 VSS FSBT \_ 增量 \_ 備份 \_**</span><span class="sxs-lookup"><span data-stu-id="a2968-164"><span id="VSS_FSBT_INCREMENTAL_BACKUP_REQUIRED"></span><span id="vss_fsbt_incremental_backup_required"></span>**VSS\_FSBT\_INCREMENTAL\_BACKUP\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="a2968-165">增量備份的必要參數。</span><span class="sxs-lookup"><span data-stu-id="a2968-165">Required for incremental backups.</span></span>

</dd> <dt>

<span data-ttu-id="a2968-166"><span id="VSS_FSBT_LOG_BACKUP_REQUIRED"></span><span id="vss_fsbt_log_backup_required"></span>**\_需要 VSS FSBT \_ 記錄 \_ 備份 \_**</span><span class="sxs-lookup"><span data-stu-id="a2968-166"><span id="VSS_FSBT_LOG_BACKUP_REQUIRED"></span><span id="vss_fsbt_log_backup_required"></span>**VSS\_FSBT\_LOG\_BACKUP\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="a2968-167">記錄備份的必要參數。</span><span class="sxs-lookup"><span data-stu-id="a2968-167">Required for log backups.</span></span>

</dd> <dt>

<span data-ttu-id="a2968-168"><span id="VSS_FSBT_ALL_BACKUP_REQUIRED"></span><span id="vss_fsbt_all_backup_required"></span>**VSS \_ FSBT \_ \_ 需要所有備份 \_**</span><span class="sxs-lookup"><span data-stu-id="a2968-168"><span id="VSS_FSBT_ALL_BACKUP_REQUIRED"></span><span id="vss_fsbt_all_backup_required"></span>**VSS\_FSBT\_ALL\_BACKUP\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="a2968-169">所有備份類型都需要：這是預設值。</span><span class="sxs-lookup"><span data-stu-id="a2968-169">Required for all backup types; this is the default.</span></span>

</dd> </dl>

<span data-ttu-id="a2968-170">此規格會覆寫元件的選擇性規格。</span><span class="sxs-lookup"><span data-stu-id="a2968-170">This specification overrides the component's selectivity specification.</span></span> <span data-ttu-id="a2968-171">例如，假設有一個元件的檔案已標示為 **需要 vss \_ FSBT \_ 記錄 \_ 備份 \_** ，但不 **需要 vss \_ FSBT \_ 完整 \_ 備份 \_**。</span><span class="sxs-lookup"><span data-stu-id="a2968-171">For example, consider a component whose files are all marked with **VSS\_FSBT\_LOG\_BACKUP\_REQUIRED** but not with **VSS\_FSBT\_FULL\_BACKUP\_REQUIRED**.</span></span> <span data-ttu-id="a2968-172">假設無法選取此元件進行備份 (*bSelectable* 在呼叫 [**IVssCreateWriterMetadata：： AddComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponent)) 時為 false。</span><span class="sxs-lookup"><span data-stu-id="a2968-172">Suppose this component is not selectable for backup (*bSelectable* was false when [**IVssCreateWriterMetadata::AddComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponent) was called).</span></span> <span data-ttu-id="a2968-173">在記錄備份的情況下，這表示此元件中的所有檔案都必須一律進行備份。</span><span class="sxs-lookup"><span data-stu-id="a2968-173">In the case of a log backup, this means that all the files in this component must always be backed up.</span></span> <span data-ttu-id="a2968-174">不過，在完整備份的情況下，即使元件的選擇性暗示應備份，也不需要備份任何檔案。</span><span class="sxs-lookup"><span data-stu-id="a2968-174">However, in the case of a full backup, none of the files need to be backed up, despite the fact that the component's selectivity implies it should be backed up.</span></span>

### <a name="backup-by-last-modify-time"></a><span data-ttu-id="a2968-175">上次修改時間的備份</span><span class="sxs-lookup"><span data-stu-id="a2968-175">Backup by Last Modify Time</span></span>

<span data-ttu-id="a2968-176">[**>Ivssbackupcomponents：： GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata)階段中指定的檔案規格資訊，不會提供要求者有關上次備份後已變更之資訊的資訊。</span><span class="sxs-lookup"><span data-stu-id="a2968-176">The file specification information specified in the [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) phase does not give the requester information about what has changed since the last backup.</span></span> <span data-ttu-id="a2968-177">寫入器用來指出變更要求者的其中一種方式，是使用差異的檔案機制。</span><span class="sxs-lookup"><span data-stu-id="a2968-177">One way for a writer to indicate changes to the requester is by using the differenced file mechanism.</span></span> <span data-ttu-id="a2968-178">寫入器可以指定元件中的特定檔案在經過一段時間之後已經過修改，因此應該備份這些檔案;寫入器可以在 [**>ivssbackupcomponents：:P repareforbackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) 或 [**>ivssbackupcomponents：:D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset)中指定這些檔案。</span><span class="sxs-lookup"><span data-stu-id="a2968-178">A writer can specify that certain files in a component should be backed up only if they have been modified since a certain time; the writer may specify these files either in [**IVssBackupComponents::PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) or in [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span></span> <span data-ttu-id="a2968-179">要求者可以藉由呼叫 [**>ivsscomponent：： GetDifferencedFilesCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdifferencedfilescount) 和 [**>ivsscomponent：： GetDifferencedFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdifferencedfile)來判斷這些檔案。</span><span class="sxs-lookup"><span data-stu-id="a2968-179">A requester can determine these files by calling [**IVssComponent::GetDifferencedFilesCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdifferencedfilescount) and [**IVssComponent::GetDifferencedFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdifferencedfile).</span></span> <span data-ttu-id="a2968-180">如果檔案規格符合 **>ivssbackupcomponents：： GatherWriterMetadata** (中的一個集合，而該集合目前根據備份類型遮罩來有效) 則差異檔案資訊會覆寫先前的資訊;也就是說，只有在指定時間之後修改過檔案規格的檔案時，才會備份這些檔案。</span><span class="sxs-lookup"><span data-stu-id="a2968-180">If the file specification matches one set in **IVssBackupComponents::GatherWriterMetadata** (that is currently valid based on the backup type mask) the differenced file information overrides the previous information; that is, the files matching that file specification are now backed up only if they have been modified since the specified time.</span></span> <span data-ttu-id="a2968-181">上次修改時間是使用 [**FILETIME**](/windows/win32/api/minwinbase/ns-minwinbase-filetime) 結構進行通訊。</span><span class="sxs-lookup"><span data-stu-id="a2968-181">The last-modify time is communicated using a [**FILETIME**](/windows/win32/api/minwinbase/ns-minwinbase-filetime) structure.</span></span> <span data-ttu-id="a2968-182">如果此結構的值為零，則表示最後一次修改的時間應該取決於要求者的上次備份時間記錄。</span><span class="sxs-lookup"><span data-stu-id="a2968-182">If the value of this structure is zero, this implies that the last-modify time should be determined based on the requester's record of the time of last backup.</span></span>

### <a name="partial-file-backup"></a><span data-ttu-id="a2968-183">部分檔案備份</span><span class="sxs-lookup"><span data-stu-id="a2968-183">Partial File Backup</span></span>

<span data-ttu-id="a2968-184">寫入器用來表示變更要求者的另一種方式是使用部分檔案機制。</span><span class="sxs-lookup"><span data-stu-id="a2968-184">Another way for a writer to indicate changes to the requester is by using the partial file mechanism.</span></span> <span data-ttu-id="a2968-185">寫入器可以在需要備份的元件檔案內指定位元組範圍;寫入器可以在 [**>ivssbackupcomponents：:P repareforbackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) 或 [**>ivssbackupcomponents：:D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset)中指定這些檔案範圍。</span><span class="sxs-lookup"><span data-stu-id="a2968-185">A writer can specify byte ranges within component files that need to be backed up; the writer can specify these file ranges either in [**IVssBackupComponents::PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) or in [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span></span> <span data-ttu-id="a2968-186">要求者可以藉由呼叫 [**>ivsscomponent：： GetPartialFileCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfilecount) 和 [**>ivsscomponent：： GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile)來判斷這些檔案。</span><span class="sxs-lookup"><span data-stu-id="a2968-186">A requester can determine these files by calling [**IVssComponent::GetPartialFileCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfilecount) and [**IVssComponent::GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile).</span></span> <span data-ttu-id="a2968-187">**>Ivsscomponent：： GetPartialFile** 會傳回指向檔案的路徑和檔案名，以及表示需要在檔案中備份的範圍字串。</span><span class="sxs-lookup"><span data-stu-id="a2968-187">**IVssComponent::GetPartialFile** will return a path and a file name pointing to the file, and a ranges string indicating what needs to be backed up in the file.</span></span> <span data-ttu-id="a2968-188">如同差異檔案，如果路徑和檔案名符合 [**>ivssbackupcomponents：： GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata)中的寫入器所設定的檔案規格，則部分檔案資訊會覆寫先前的設定。</span><span class="sxs-lookup"><span data-stu-id="a2968-188">As with differenced files, if the path and file name matches a file specification set by the writer in [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), the partial-file information overrides the previous setting.</span></span> <span data-ttu-id="a2968-189">範圍字串可以有兩種格式：可以直接指定範圍，也可以指定包含範圍資訊的檔案。</span><span class="sxs-lookup"><span data-stu-id="a2968-189">The ranges string can have two formats: it can either specify the ranges directly, or it can specify a file containing ranges information.</span></span> <span data-ttu-id="a2968-190">如果直接指定範圍，語法會是 offset1： array2d.length1，offset2： array3d.length2 格式的逗號分隔清單，其中每個位移和長度都是64位不帶正負號的整數。</span><span class="sxs-lookup"><span data-stu-id="a2968-190">If specifying ranges directly, the syntax is a comma-separated list of the form offset1:length1, offset2:length2, where each offset and length is a 64-bit unsigned integer.</span></span> <span data-ttu-id="a2968-191">如果指定範圍檔案，則範圍字串應設定為 File = *filename*，其中 *filename* 是範圍檔案的完整路徑。</span><span class="sxs-lookup"><span data-stu-id="a2968-191">If specifying a ranges file, the ranges string should be set to File= *filename*, where *filename* is the full path to the ranges file.</span></span> <span data-ttu-id="a2968-192">範圍檔案本身是一種二進位檔案，格式為64位不帶正負號整數的清單。</span><span class="sxs-lookup"><span data-stu-id="a2968-192">The ranges file itself is a binary file that is formatted as a list of 64-bit unsigned integers.</span></span> <span data-ttu-id="a2968-193">第一個整數表示檔案中表示的範圍數目。</span><span class="sxs-lookup"><span data-stu-id="a2968-193">The first integer indicates how many ranges are represented in the file.</span></span> <span data-ttu-id="a2968-194">每個後續的整數配對表示範圍的位移和長度。</span><span class="sxs-lookup"><span data-stu-id="a2968-194">Each subsequent pair of integers represents the offset and length of a range.</span></span> <span data-ttu-id="a2968-195">要求者也必須負責備份和還原此範圍檔案。</span><span class="sxs-lookup"><span data-stu-id="a2968-195">The requester must take care to back up and restore this ranges file as well.</span></span>

### <a name="file-specification-rules"></a><span data-ttu-id="a2968-196">檔案規格規則</span><span class="sxs-lookup"><span data-stu-id="a2968-196">File Specification Rules</span></span>

<span data-ttu-id="a2968-197">透過差異檔案與部分檔案機制新增的檔案規格，將會修改 [**>ivssbackupcomponents：： GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) 中設定的檔案規格，或新增新的檔案。</span><span class="sxs-lookup"><span data-stu-id="a2968-197">File specifications added through the differenced-file and the partial-file mechanisms will either modify file specifications set in [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) or add completely new files.</span></span> <span data-ttu-id="a2968-198">如果使用部分檔案機制來修改 **>ivssbackupcomponents：： GatherWriterMetadata** 中設定的檔案規格，則要求者可能會預期檔案規格與 **>ivssbackupcomponents：： GatherWriterMetadata** 元件中所設定的其中一個檔案規格完全相符。</span><span class="sxs-lookup"><span data-stu-id="a2968-198">If modifying files specifications set in **IVssBackupComponents::GatherWriterMetadata** using the partial-file mechanism, then a requester can expect the file specification to exactly match one of the file specifications set in the component in **IVssBackupComponents::GatherWriterMetadata**.</span></span> <span data-ttu-id="a2968-199">檔案規格不會部分重迭另一個檔案規格，而且將不會比對該寫入器元件中任何其他的檔案規格。</span><span class="sxs-lookup"><span data-stu-id="a2968-199">The file specification will not partially overlap another file specification, and it will not match any file specifications in any other of that writer's components.</span></span> <span data-ttu-id="a2968-200">不過，使用部分檔案機制新增的檔案規格，可能會部分重迭另一個檔案規格。</span><span class="sxs-lookup"><span data-stu-id="a2968-200">File specifications added using the partial-file mechanism can, however, partially overlap another file specification.</span></span> <span data-ttu-id="a2968-201">若為 true，則差異檔案或部分檔案規格會覆寫 **>ivssbackupcomponents：： GatherWriterMetadata** 中設定的規格。</span><span class="sxs-lookup"><span data-stu-id="a2968-201">When this is true, the differenced-file or partial-file specification overrides the specification set in **IVssBackupComponents::GatherWriterMetadata**.</span></span> <span data-ttu-id="a2968-202">一般檔案規格可以有 [**IVssWMFiledesc：：) GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) 所傳回的替代位置值 (，這表示在備份時取得檔案的替代位置。</span><span class="sxs-lookup"><span data-stu-id="a2968-202">General file specifications can have an alternate-location value (returned by [**IVssWMFiledesc::GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation)) that indicates an alternate place to obtain the file from at backup time.</span></span> <span data-ttu-id="a2968-203">如果透過差異檔案或部分檔案機制設定的檔案規格符合具有替代位置的現有檔案規格，則應該從這個替代位置挑選資料。</span><span class="sxs-lookup"><span data-stu-id="a2968-203">If the file specifications set through the differenced-file or partial file mechanisms match an existing files specification that has an alternate location, the data should be picked up from this alternate location.</span></span> <span data-ttu-id="a2968-204">如果透過差異檔案或部分檔案機制設定的檔案規格不符合任何現有的元件規格，則這些檔案範圍現在應該會新增至備份中。</span><span class="sxs-lookup"><span data-stu-id="a2968-204">If the file specifications set through the differenced-file or partial-file mechanisms do not match any existing specifications for the component, then these file ranges should now be added to the backup.</span></span> <span data-ttu-id="a2968-205">要求者可以預期只有已包含在陰影複製集中的磁片區上的檔案，才會使用這些機制的其中一種來新增。</span><span class="sxs-lookup"><span data-stu-id="a2968-205">The requester can expect that only files on volumes that have already been included in the shadow copy set will be added using one of these mechanisms.</span></span>

### <a name="backup-without-a-shadow-copy"></a><span data-ttu-id="a2968-206">不含陰影複製的備份</span><span class="sxs-lookup"><span data-stu-id="a2968-206">Backup without a Shadow Copy</span></span>

<span data-ttu-id="a2968-207">某些類型的檔案可能不需要從陰影複製磁片區備份。</span><span class="sxs-lookup"><span data-stu-id="a2968-207">Certain types of files may not need to be backed up off of a shadow copy volume.</span></span> <span data-ttu-id="a2968-208">例如，這通常會是資料庫記錄檔的值。</span><span class="sxs-lookup"><span data-stu-id="a2968-208">For example, this will often be true of database log files.</span></span> <span data-ttu-id="a2968-209">由於記錄檔會單純成長，而且寫入器可以使用部分檔案確切地指定要備份的檔案部分，因此通常可能會將記錄備份至原始磁片區。</span><span class="sxs-lookup"><span data-stu-id="a2968-209">Since log files grow monotonically, and a writer can specify exactly what portions of the file to back up using partial files, it will often be possible to backup the log off the original volume.</span></span> <span data-ttu-id="a2968-210">作為優化，寫入器可以使用備份類型遮罩來標示哪些檔案需要不同備份類型的陰影複製。</span><span class="sxs-lookup"><span data-stu-id="a2968-210">As an optimization, a writer can mark which files require shadow copies for different backup types using the backup-type mask.</span></span> <span data-ttu-id="a2968-211">從 [**IVssWMFiledesc：： GetBackupTypeMask**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getbackuptypemask) 傳回的值可以包含下列其中一個或多個位值：</span><span class="sxs-lookup"><span data-stu-id="a2968-211">The value returned from [**IVssWMFiledesc::GetBackupTypeMask**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getbackuptypemask) can contain one or more of the following bit values:</span></span>

<dl> <dt>

<span data-ttu-id="a2968-212"><span id="VSS_FSBT_FULL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_full_snapshot_required"></span>**VSS \_ FSBT \_ \_ 需要完整快照 \_ 集**</span><span class="sxs-lookup"><span data-stu-id="a2968-212"><span id="VSS_FSBT_FULL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_full_snapshot_required"></span>**VSS\_FSBT\_FULL\_SNAPSHOT\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="a2968-213">完整備份所需的陰影複製。</span><span class="sxs-lookup"><span data-stu-id="a2968-213">Shadow copy required for full backups.</span></span>

</dd> <dt>

<span data-ttu-id="a2968-214"><span id="VSS_FSBT_DIFFERENTIAL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_differential_snapshot_required"></span>**\_需要 VSS FSBT \_ 差異 \_ 快照 \_ 集**</span><span class="sxs-lookup"><span data-stu-id="a2968-214"><span id="VSS_FSBT_DIFFERENTIAL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_differential_snapshot_required"></span>**VSS\_FSBT\_DIFFERENTIAL\_SNAPSHOT\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="a2968-215">差異備份所需的陰影複製。</span><span class="sxs-lookup"><span data-stu-id="a2968-215">Shadow copy required for differential backups.</span></span>

</dd> <dt>

<span data-ttu-id="a2968-216"><span id="VSS_FSBT_INCREMENTAL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_incremental_snapshot_required"></span>**\_需要 VSS FSBT \_ 增量 \_ 快照 \_ 集**</span><span class="sxs-lookup"><span data-stu-id="a2968-216"><span id="VSS_FSBT_INCREMENTAL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_incremental_snapshot_required"></span>**VSS\_FSBT\_INCREMENTAL\_SNAPSHOT\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="a2968-217">增量備份所需的陰影複製。</span><span class="sxs-lookup"><span data-stu-id="a2968-217">Shadow copy required for incremental backups.</span></span>

</dd> <dt>

<span data-ttu-id="a2968-218"><span id="VSS_FSBT_LOG_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_log_snapshot_required"></span>**\_需要 VSS FSBT \_ 記錄 \_ 快照 \_ 集**</span><span class="sxs-lookup"><span data-stu-id="a2968-218"><span id="VSS_FSBT_LOG_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_log_snapshot_required"></span>**VSS\_FSBT\_LOG\_SNAPSHOT\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="a2968-219">記錄備份所需的陰影複製。</span><span class="sxs-lookup"><span data-stu-id="a2968-219">Shadow copy required for log backups.</span></span>

</dd> <dt>

<span data-ttu-id="a2968-220"><span id="VSS_FSBT_ALL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_all_snapshot_required"></span>**VSS \_ FSBT \_ 需要所有的 \_ 快照 \_ 集**</span><span class="sxs-lookup"><span data-stu-id="a2968-220"><span id="VSS_FSBT_ALL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_all_snapshot_required"></span>**VSS\_FSBT\_ALL\_SNAPSHOT\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="a2968-221">所有備份類型都需要陰影複製;這是預設值。</span><span class="sxs-lookup"><span data-stu-id="a2968-221">Shadow copy required for all backup types; this is the default.</span></span>

</dd> </dl>

<span data-ttu-id="a2968-222">如果特定磁片區只包含此備份不需要陰影複製的元件，則要求者可以略過為此磁片區建立陰影複製的步驟。</span><span class="sxs-lookup"><span data-stu-id="a2968-222">If a specific volume contains only components that do not require a shadow copy for this backup, the requester can skip the step of creating a shadow copy for this volume.</span></span> <span data-ttu-id="a2968-223">此磁片區上的所有資料都可以直接從原始磁片區複製到備份媒體中。</span><span class="sxs-lookup"><span data-stu-id="a2968-223">All the data on this volume can be copied to the backup media directly from the original volume.</span></span>

## <a name="restoring-files"></a><span data-ttu-id="a2968-224">還原檔案</span><span class="sxs-lookup"><span data-stu-id="a2968-224">Restoring Files</span></span>

### <a name="sequential-restores"></a><span data-ttu-id="a2968-225">順序還原</span><span class="sxs-lookup"><span data-stu-id="a2968-225">Sequential Restores</span></span>

<span data-ttu-id="a2968-226">在要求者完成執行還原作業之後，它會將 PostRestore 事件傳送給所有寫入器。</span><span class="sxs-lookup"><span data-stu-id="a2968-226">After the requester is done performing a restore operation, it sends the PostRestore event to all writers.</span></span> <span data-ttu-id="a2968-227">一般而言，寫入器會藉由執行復原或其他還原後作業來處理這個事件。</span><span class="sxs-lookup"><span data-stu-id="a2968-227">Generally, writers handle this event by performing recovery or other post-restore operations.</span></span> <span data-ttu-id="a2968-228">不過，還原增量備份通常是以一系列的還原作業（每個增量備份一個）來還原。</span><span class="sxs-lookup"><span data-stu-id="a2968-228">Restoration of incremental backups, however, usually happen as a sequence of restore operations, one per incremental backup.</span></span> <span data-ttu-id="a2968-229">要求者必須通知寫入器正在進行這類還原，以防止發生復原或其他不想要的作業，直到還原完成為止。</span><span class="sxs-lookup"><span data-stu-id="a2968-229">The requester needs to inform the writer that such a restoration is in progress in order to prevent recovery or other undesirable operations from happening until the restore is completely done.</span></span> <span data-ttu-id="a2968-230">這是藉由呼叫 [**>ivssbackupcomponents：： SetAdditionalRestores**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setadditionalrestores)來完成。</span><span class="sxs-lookup"><span data-stu-id="a2968-230">This is done by calling [**IVssBackupComponents::SetAdditionalRestores**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setadditionalrestores).</span></span> <span data-ttu-id="a2968-231">每個元件都會呼叫這個方法，並向寫入器指出該元件有更多還原。</span><span class="sxs-lookup"><span data-stu-id="a2968-231">This method is called per component, and indicates to the writer that more restores are coming for that component.</span></span> <span data-ttu-id="a2968-232">針對序列中的最後一個還原，必須將額外的還原旗標設為 false (預設值) ，表示這是該元件序列中的最後一個還原。</span><span class="sxs-lookup"><span data-stu-id="a2968-232">For the final restore in the sequence, the additional-restores flag should be set to false (its default value), which indicates that this is the last restore in the sequence for that component.</span></span>

### <a name="new-targets"></a><span data-ttu-id="a2968-233">新目標</span><span class="sxs-lookup"><span data-stu-id="a2968-233">New Targets</span></span>

<span data-ttu-id="a2968-234">如果寫入器支援，要求者可以將資料檔案還原到原始備份時間位置以外的位置。</span><span class="sxs-lookup"><span data-stu-id="a2968-234">If supported by the writer, the requester can restore data files to a location other than the original backup-time location.</span></span> <span data-ttu-id="a2968-235">要求者可以藉由呼叫 [**IVssExamineWriterMetadata：： GetBackupSchema**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getbackupschema)來檢查這項支援。</span><span class="sxs-lookup"><span data-stu-id="a2968-235">The requester can check for this support by calling [**IVssExamineWriterMetadata::GetBackupSchema**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getbackupschema).</span></span> <span data-ttu-id="a2968-236">如果寫入器支援此行為，則 **VSS \_ BS \_ 寫入器 \_ 支援 \_ \_** 將會設定新的目標位。</span><span class="sxs-lookup"><span data-stu-id="a2968-236">The **VSS\_BS\_WRITER\_SUPPORTS\_NEW\_TARGET** bit will be set if the writer supports this behavior.</span></span> <span data-ttu-id="a2968-237">要求者會針對每個重新放置的檔案規格呼叫 [**>ivssbackupcomponents：： AddNewTarget**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget) ，以通知寫入器新的位置。</span><span class="sxs-lookup"><span data-stu-id="a2968-237">The requester informs the writer of the new location by calling [**IVssBackupComponents::AddNewTarget**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget) for each relocated file specification.</span></span> <span data-ttu-id="a2968-238">要求者也可以決定將特定範圍的檔案還原至不同的位置。</span><span class="sxs-lookup"><span data-stu-id="a2968-238">The requester can also decide to restore a specific ranges file to a different location.</span></span> <span data-ttu-id="a2968-239">要求者藉由呼叫 [**>ivssbackupcomponents：： SetRangesFilePath**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrangesfilepath)來通知寫入這項變更。</span><span class="sxs-lookup"><span data-stu-id="a2968-239">The requester informs the writer of this change by calling [**IVssBackupComponents::SetRangesFilePath**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrangesfilepath).</span></span>

### <a name="directed-targets"></a><span data-ttu-id="a2968-240">導向的目標</span><span class="sxs-lookup"><span data-stu-id="a2968-240">Directed Targets</span></span>

<span data-ttu-id="a2968-241">針對複雜的還原案例，寫入器可能會想要將已備份檔案的範圍對應到相同或不同檔案的不同範圍。</span><span class="sxs-lookup"><span data-stu-id="a2968-241">For complicated restore scenarios, a writer may want to map ranges of a backed-up file onto different ranges of the same or a different file.</span></span> <span data-ttu-id="a2968-242">這可以藉由使用導向的目的機制來完成。</span><span class="sxs-lookup"><span data-stu-id="a2968-242">This can be done by using the directed target mechanism.</span></span> <span data-ttu-id="a2968-243">要求者可以藉由呼叫 [**>ivsscomponent：： GetRestoreTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoretarget) ，並檢查是否有 **\_ \_ 指向 VSS RT** 的傳回，在 [**>ivssbackupcomponents：:P rerestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore)階段之後判斷此機制用於元件。</span><span class="sxs-lookup"><span data-stu-id="a2968-243">The requester can determine after the [**IVssBackupComponents::PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) phase that this mechanism is being used for a component by calling [**IVssComponent::GetRestoreTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoretarget) and checking for a return of **VSS\_RT\_DIRECTED**.</span></span> <span data-ttu-id="a2968-244">要求者可以藉由呼叫 [**>ivsscomponent：： GetDirectedTargetCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtargetcount) 和 [**>ivsscomponent：： GetDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtarget)，來取得所有這些重新導向的還原。</span><span class="sxs-lookup"><span data-stu-id="a2968-244">The requester can than obtain all of these redirected restores by calling [**IVssComponent::GetDirectedTargetCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtargetcount) and [**IVssComponent::GetDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtarget).</span></span> <span data-ttu-id="a2968-245">**>Ivsscomponent：： GetDirectedTarget** 會傳回備份上原始程式檔的完整路徑，以及將還原至的目的地檔案的完整路徑。</span><span class="sxs-lookup"><span data-stu-id="a2968-245">**IVssComponent::GetDirectedTarget** will return a full path to a source file on the backup and a full path to a destination file that will be restored to.</span></span> <span data-ttu-id="a2968-246">它也會針對每個檔案傳回範圍清單。</span><span class="sxs-lookup"><span data-stu-id="a2968-246">It also returns a ranges list for each of these files.</span></span> <span data-ttu-id="a2968-247">接著，要求者會負責將來源檔案中指定的範圍還原到目的地檔案中的對應範圍。</span><span class="sxs-lookup"><span data-stu-id="a2968-247">The requester is then responsible for restoring the specified ranges in the source file to the mapped ranges in the destination file.</span></span> <span data-ttu-id="a2968-248">範圍字串的格式與 [**>ivsscomponent：： GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile)中的格式相同。</span><span class="sxs-lookup"><span data-stu-id="a2968-248">The format of the ranges string is the same as in [**IVssComponent::GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile).</span></span>

-   [<span data-ttu-id="a2968-249">VSS 增量和差異備份中的寫入器角色</span><span class="sxs-lookup"><span data-stu-id="a2968-249">Writer Role in VSS Incremental and Differential Backups</span></span>](writer-role-in-vss-incremental-and-differential-backups.md)
-   [<span data-ttu-id="a2968-250">VSS 增量和差異備份中的要求者角色</span><span class="sxs-lookup"><span data-stu-id="a2968-250">Requester Role in VSS Incremental and Differential Backups</span></span>](requestor-role-in-vss-incremental-and-differential-backups.md)

 

 
