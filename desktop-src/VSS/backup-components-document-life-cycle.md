---
description: 要求者對於備份元件檔的生命週期具有主要責任。
ms.assetid: 287b7b9a-ac04-4a74-83c1-2cdd4a571ac1
title: 備份元件檔生命週期
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a4bcb0263f46466d7be2bc19f3c8809167b2da08
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "106989992"
---
# <a name="backup-components-document-life-cycle"></a><span data-ttu-id="44a45-103">備份元件檔生命週期</span><span class="sxs-lookup"><span data-stu-id="44a45-103">Backup Components Document Life Cycle</span></span>

<span data-ttu-id="44a45-104">要求者對於備份元件檔的生命週期具有主要責任。</span><span class="sxs-lookup"><span data-stu-id="44a45-104">Requesters have primary responsibility for the life cycle of a Backup Components Document.</span></span>

<span data-ttu-id="44a45-105">這個控制項是由 [**CreateVssBackupComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssbackupcomponents)所傳回之 [**>ivssbackupcomponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents)介面物件的實例所執行。</span><span class="sxs-lookup"><span data-stu-id="44a45-105">This control is exercised by an instance of the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface object returned by [**CreateVssBackupComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssbackupcomponents).</span></span>

<span data-ttu-id="44a45-106">要求者必須藉由呼叫 [**>ivssbackupcomponents：： InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup) 或 [**>ivssbackupcomponents：： InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore)，初始化備份或還原之前的備份元件檔。</span><span class="sxs-lookup"><span data-stu-id="44a45-106">A requester must initialize a Backup Components Document prior to a backup or restore by calling [**IVssBackupComponents::InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup) or [**IVssBackupComponents::InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore).</span></span> <span data-ttu-id="44a45-107">要求者可以將檔初始化為空的，或者可以載入先前儲存的檔複本。</span><span class="sxs-lookup"><span data-stu-id="44a45-107">The requester can initialize the document as empty, or it can load a previously stored copy of the document.</span></span>

<span data-ttu-id="44a45-108">針對備份作業，備份元件檔通常會初始化為空白。</span><span class="sxs-lookup"><span data-stu-id="44a45-108">For backup operations, a Backup Components Document is typically initialized as empty.</span></span> <span data-ttu-id="44a45-109">在處理備份過程中，其資料將會填入系統作者的合作。</span><span class="sxs-lookup"><span data-stu-id="44a45-109">Its data will be filled in with cooperation from the system's writers in the course of processing the backup.</span></span>

<span data-ttu-id="44a45-110">針對還原作業，備份元件檔通常會從初始備份期間所產生的預存檔初始化。</span><span class="sxs-lookup"><span data-stu-id="44a45-110">For restore operations, a Backup Components Document is typically initialized from a stored document generated during the initial backup.</span></span> <span data-ttu-id="44a45-111">這可讓還原 (與儲存的寫入器元資料檔案的檢查) ，以判斷最初備份的資料以及應該如何還原。</span><span class="sxs-lookup"><span data-stu-id="44a45-111">This allows the restore (in conjunction with examination of stored Writer Metadata Documents) to determine what data was initially backed up and how it should be restored.</span></span>

<span data-ttu-id="44a45-112">備份可 [*轉移的陰影複製*](vssgloss-t.md) 是此規則的例外狀況。</span><span class="sxs-lookup"><span data-stu-id="44a45-112">Backing up [*transportable shadow copies*](vssgloss-t.md) is an exception to this rule.</span></span> <span data-ttu-id="44a45-113">在此情況下，陰影複製可能已從一個系統移出， (在其中建立的一個系統，以及初始備份元件檔) 至另一個系統，方法是重新指派共用存放裝置的邏輯單元。</span><span class="sxs-lookup"><span data-stu-id="44a45-113">In this case, a shadow copy could have been moved from one system (where it was created along with the initial Backup Components Document) to another by means of reassigning a shared storage device's logical unit.</span></span> <span data-ttu-id="44a45-114">在這些情況下進行備份時，要求者會載入儲存的備份狀態，並從初始系統離開的位置繼續進行。</span><span class="sxs-lookup"><span data-stu-id="44a45-114">To back up under these circumstances, a requester loads the stored backup state and proceeds from where the initial system left off.</span></span> <span data-ttu-id="44a45-115"> (需詳細資訊，請參閱匯 [入已傳送的陰影複製磁片](importing-transportable-shadow-copied-volumes.md)區。 ) </span><span class="sxs-lookup"><span data-stu-id="44a45-115">(For more information, see [Importing Transportable Shadow Copied Volumes](importing-transportable-shadow-copied-volumes.md).)</span></span>

<span data-ttu-id="44a45-116">在處理備份的過程中，要求者會決定要實際複製哪些元件，而這些元件被標示為可 [*選取以進行備份*](vssgloss-s.md)、元件的 [*邏輯路徑*](vssgloss-l.md)，以及自己的內部邏輯。</span><span class="sxs-lookup"><span data-stu-id="44a45-116">In the course of processing a backup, the requester decides which components to actually copy on the basis of which components are marked as [*selectable for backup*](vssgloss-s.md), the component's [*logical paths*](vssgloss-l.md), and its own internal logic.</span></span>

<span data-ttu-id="44a45-117">部分元件會 [*明確包含*](vssgloss-e.md) 在備份作業中;元件的相關資訊將會加入至 [備份元件] 檔。</span><span class="sxs-lookup"><span data-stu-id="44a45-117">Some of the components will be [*explicitly included*](vssgloss-e.md) in the backup operation; information about the component will be added to the Backup Components Document.</span></span> <span data-ttu-id="44a45-118">其他將會 [*隱含地包含*](vssgloss-i.md) 在備份中;新增的元件的相關資訊將不會加入至 [備份元件] 檔。</span><span class="sxs-lookup"><span data-stu-id="44a45-118">Others will be [*implicitly included*](vssgloss-i.md) in the backup; information about the added components will not be added to the Backup Components Document.</span></span>

<span data-ttu-id="44a45-119">所有寫入器的備份元件其都沒有可選取的上階，而是由要求者選擇的備份元件來明確新增。</span><span class="sxs-lookup"><span data-stu-id="44a45-119">All of a writer's nonselectable for backup components without a selectable ancestor in their logical path, and those selectable for backup components the requester chooses, will be added explicitly.</span></span>

<span data-ttu-id="44a45-120">如果備份元件的邏輯路徑中有可選取的上階（明確包含在備份中），則可以隱含地加入其和可選取的備份元件。</span><span class="sxs-lookup"><span data-stu-id="44a45-120">Both nonselectable and selectable for backup components can be added implicitly if they have a selectable ancestor in their logical path, which is explicitly included in the backup.</span></span> <span data-ttu-id="44a45-121">這些元件 ([*子*](vssgloss-s.md) 元件) 是由其可選取的上階所定義之 [*元件集*](vssgloss-s.md) 的成員。</span><span class="sxs-lookup"><span data-stu-id="44a45-121">These components ([*subcomponents*](vssgloss-s.md)) are members of [*component sets*](vssgloss-s.md) defined by their selectable ancestor.</span></span>

<span data-ttu-id="44a45-122">處理還原作業時，要求者會使用 [*selectability 來進行還原*](vssgloss-s.md) ，而不是使用 selectability 進行備份，以搭配邏輯路徑資訊及其本身的內部邏輯來決定要還原的檔案。</span><span class="sxs-lookup"><span data-stu-id="44a45-122">When handling restore operations, the requester uses [*selectability for restore*](vssgloss-s.md) instead of selectability for backup in conjunction with logical path information and its own internal logic to decide which files to restore.</span></span>

<span data-ttu-id="44a45-123">如果已隱含新增至備份的元件現在要明確新增至還原，要求者將會以該元件的資訊更新 [備份元件] 檔。</span><span class="sxs-lookup"><span data-stu-id="44a45-123">If a component that had been implicitly added to the backup is now to be explicitly added to the restore, the requester will update the Backup Components Document with that component's information.</span></span>

<span data-ttu-id="44a45-124">預存元件的相關資訊可透過 [**>ivsscomponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) 介面的實例提供給要求者和寫入器。</span><span class="sxs-lookup"><span data-stu-id="44a45-124">Information about the stored components is available both to requesters and writers through instances of the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface.</span></span>

<span data-ttu-id="44a45-125">它是透過 [**>ivsscomponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) 介面，讓寫入器可以查詢並 (到 [**PostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) 和 [**PostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore) 事件的結尾，) 修改備份元件檔中的資訊。</span><span class="sxs-lookup"><span data-stu-id="44a45-125">It is through [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interfaces that writers can query and (until the end of [**PostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) and [**PostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore) events) modify information in the Backup Components Document.</span></span>

<span data-ttu-id="44a45-126">當呼叫 [**CVssWriter：： OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup)、 [**CVssWriter：： OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore)、 [**CVssWriter：： OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot)、 [**CVssWriter：： OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete)或 [**CVssWriter：： OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore) 事件處理常式時，寫入器會接收 [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) 介面的實例。</span><span class="sxs-lookup"><span data-stu-id="44a45-126">When the [**CVssWriter::OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup), [**CVssWriter::OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore), [**CVssWriter::OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot), [**CVssWriter::OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete), or [**CVssWriter::OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore) event handler is called, a writer receives an instance of an [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) interface.</span></span>

<span data-ttu-id="44a45-127">請注意，在產生 [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) 事件時，備份元件檔會設為唯讀，因此 [**CVssWriter：： OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete) 無法使用 [**>ivsscomponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) 介面來修改它。</span><span class="sxs-lookup"><span data-stu-id="44a45-127">Note that upon generation of the [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) event, the Backup Components Document is made read-only, and therefore [**CVssWriter::OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete) cannot use the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface to modify it.</span></span>

<span data-ttu-id="44a45-128">從 [**IVSSWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) 介面，寫入器可以取出 [**>ivsscomponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) 介面的實例，讓它能夠存取所有明確加入至備份元件檔的元件，以及改變其狀態。</span><span class="sxs-lookup"><span data-stu-id="44a45-128">From the [**IVSSWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) interface, the writer can retrieve instances of the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface that will allow it to access all of its components explicitly added to the Backup Components Document and to alter their state.</span></span> <span data-ttu-id="44a45-129">如需詳細資訊，請參閱在 vss 中 [處理備份的總覽](overview-of-processing-a-backup-under-vss.md) 和 [在 Vss 下處理還原的總覽](overview-of-processing-a-restore-under-vss.md)。</span><span class="sxs-lookup"><span data-stu-id="44a45-129">For more information, see [Overview of Processing a Backup Under VSS](overview-of-processing-a-backup-under-vss.md) and [Overview of Processing a Restore Under VSS](overview-of-processing-a-restore-under-vss.md).</span></span>

<span data-ttu-id="44a45-130">[**>ivssbackupcomponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents)介面釋放時，會從記憶體中移除備份元件檔，而且必須使用 [**>ivssbackupcomponents：： SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml)來儲存，否則將會遺失其所有資訊。</span><span class="sxs-lookup"><span data-stu-id="44a45-130">Backup Components Documents are removed from memory when the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface is released, and must be stored using [**IVssBackupComponents::SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml), or all their information will be lost.</span></span>

<span data-ttu-id="44a45-131">此外，當 [**>ivssbackupcomponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) 檔已正確釋出時，會產生 [**BackupShutdown**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupshutdown) 事件並刪除 [*自動發行陰影複製*](vssgloss-a.md) 。</span><span class="sxs-lookup"><span data-stu-id="44a45-131">In addition, when an [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) document is properly released, a [**BackupShutdown**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupshutdown) event is generated and [*auto-release shadow copies*](vssgloss-a.md) are deleted.</span></span>

 

 



