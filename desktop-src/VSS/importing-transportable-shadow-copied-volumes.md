---
description: 有時候最好在一個系統上建立陰影複製，但在第二個系統上使用陰影複製。
ms.assetid: 4ec63917-03c0-434e-892e-3d9d4c47740e
title: 匯入可轉移的陰影複製磁片區
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3d259fbc047d088ee1f7064804a3ee98fe48da1b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104115164"
---
# <a name="importing-transportable-shadow-copied-volumes"></a><span data-ttu-id="25e56-103">匯入可轉移的陰影複製磁片區</span><span class="sxs-lookup"><span data-stu-id="25e56-103">Importing Transportable Shadow Copied Volumes</span></span>

<span data-ttu-id="25e56-104">有時候最好在一個系統上建立陰影複製，但在第二個系統上使用陰影複製。</span><span class="sxs-lookup"><span data-stu-id="25e56-104">It is sometimes desirable to create a shadow copy on one system, but use the shadow copy on a second system.</span></span>

<span data-ttu-id="25e56-105">假設要備份的資料通常是由指定的系統管理， (*systemOne* 在正常作業期間) ，而且這項資料實際上儲存在存放裝置陣列或設備上。</span><span class="sxs-lookup"><span data-stu-id="25e56-105">Consider the case where data to be backed up is normally managed by a given system (*systemOne*) during normal operations, and that this data is physically stored on a storage array or an appliance.</span></span>

<span data-ttu-id="25e56-106">為了儘量減少 *systemOne* (的任何中斷情況，因為備份作業可能會耗用大量資源) ，因此最好使用 *systemTwo* 備份來執行備份，該備份伺服器可存取與 *systemOne* 相同的存放裝置陣列。</span><span class="sxs-lookup"><span data-stu-id="25e56-106">To minimize any disruption to *systemOne* (because backup operations can be resource intensive), it is desirable to perform the backup using *systemTwo*, a backup server, which has access to the same storage array as *systemOne*.</span></span>

<span data-ttu-id="25e56-107">為了確保適當的陰影複製（與 *systemOne* 上的寫入器協同作業，並適當地保留狀態以進行進行中的工作），陰影複製應該由 *systemOne* 執行。</span><span class="sxs-lookup"><span data-stu-id="25e56-107">To ensure a proper shadow copy—cooperating with the writers on *systemOne* and preserving the state appropriately for ongoing tasks—the shadow copy should be performed by *systemOne*.</span></span>

<span data-ttu-id="25e56-108">因此， *systemOne* 必須建立可 [*轉移的陰影複製*](vssgloss-t.md)， *systemTwo* 接著會匯入。</span><span class="sxs-lookup"><span data-stu-id="25e56-108">Therefore, *systemOne* must create a [*transportable shadow copy*](vssgloss-t.md), which *systemTwo* will then import.</span></span>

<span data-ttu-id="25e56-109">**Windows server 2003、Standard Edition、Windows server 2003、Web Edition 和 WINDOWS XP：** 不支援可轉移的陰影複製集。</span><span class="sxs-lookup"><span data-stu-id="25e56-109">**Windows Server 2003, Standard Edition, Windows Server 2003, Web Edition and Windows XP:** Transportable shadow copy sets are not supported.</span></span> <span data-ttu-id="25e56-110">所有版本的 Windows Server 2003 Service Pack 1 (SP1) 支援可轉移的陰影複製集。</span><span class="sxs-lookup"><span data-stu-id="25e56-110">All editions of Windows Server 2003 with Service Pack 1 (SP1) support transportable shadow copy sets.</span></span>

<span data-ttu-id="25e56-111">匯入可轉移陰影複製的一般範例，可透過下列方式繼續進行：</span><span class="sxs-lookup"><span data-stu-id="25e56-111">A typical example of importing a transportable shadow copy can proceed in the following way:</span></span>

1.  <span data-ttu-id="25e56-112">一開始，存放裝置陣列所提供的邏輯單元 (LUN) 會掛接為 *systemOne* 上的磁片區 (例如 F： ) 。</span><span class="sxs-lookup"><span data-stu-id="25e56-112">Initially, the logical unit (LUN) that is provided by the storage array is mounted as a volume on *systemOne* (say, F:).</span></span>
2.  <span data-ttu-id="25e56-113">在 *systemOne* 上執行的要求者會具現化 [**>ivssbackupcomponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) 的實例，並繼續進行備份的準備。</span><span class="sxs-lookup"><span data-stu-id="25e56-113">A requester that is running on *systemOne* instantiates an instance of [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) and proceeds as if it were preparing for a backup.</span></span> <span data-ttu-id="25e56-114"> (參閱 [備份初始化的總覽](overview-of-backup-initialization.md)、 [備份探索階段的總覽](overview-of-the-backup-discovery-phase.md)，以及詳細資訊的備份 [前工作總覽](overview-of-pre-backup-tasks.md) 。 ) </span><span class="sxs-lookup"><span data-stu-id="25e56-114">(See [Overview of Backup Initialization](overview-of-backup-initialization.md), [Overview of the Backup Discovery Phase](overview-of-the-backup-discovery-phase.md), and [Overview of Pre-Backup Tasks](overview-of-pre-backup-tasks.md) for more information.)</span></span>
3.  <span data-ttu-id="25e56-115">*SystemOne* 上的要求者會修改通常用於本機備份作業的陰影複製內容 (**VSS \_ CTX \_ 應用程式 \_ 備份**) ，表示將會建立可轉移的陰影複製 (**VSS \_ VOLSNAP \_ ATTR 可 \_ 轉移**) 。</span><span class="sxs-lookup"><span data-stu-id="25e56-115">The requester on *systemOne* modifies the shadow copy context that is typically used for local backup operation (**VSS\_CTX\_APP\_BACKUP**) to indicate that a transportable shadow copy will be created (**VSS\_VOLSNAP\_ATTR\_TRANSPORTABLE**).</span></span> <span data-ttu-id="25e56-116">可轉移的屬性也可以加入至其他陰影複製內容。</span><span class="sxs-lookup"><span data-stu-id="25e56-116">The transportable attribute can be added to other shadow copy contexts as well.</span></span>
4.  <span data-ttu-id="25e56-117">透過 **vss \_ CTX \_ 應用程式 \_ 備份** \| **vss \_ VOLSNAP \_ ATTR 可 \_ 轉移** 的陰影複製內容， *systemOne* 的要求者會藉由呼叫 [**>ivssbackupcomponents：:D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset)來建立陰影複製。</span><span class="sxs-lookup"><span data-stu-id="25e56-117">With a shadow copy context of **VSS\_CTX\_APP\_BACKUP** \| **VSS\_VOLSNAP\_ATTR\_TRANSPORTABLE**, the requester that is on *systemOne* creates a shadow copy by calling [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span></span>
5.  <span data-ttu-id="25e56-118">*SystemOne* 會使用 [**>ivssbackupcomponents：： SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml) 來儲存備份元件檔和 [**IVssExamineWriterMetadata：： SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-saveasxml) 的目前狀態，以儲存每個寫入器的寫入器元資料檔案。</span><span class="sxs-lookup"><span data-stu-id="25e56-118">*SystemOne* uses [**IVssBackupComponents::SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml) to save the current state of the Backup Components Document and [**IVssExamineWriterMetadata::SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-saveasxml) to save each writer's Writer Metadata Documents.</span></span> <span data-ttu-id="25e56-119">接著，會將包含這些檔的 XML 字串提供給在 *systemTwo* 上執行的要求者。</span><span class="sxs-lookup"><span data-stu-id="25e56-119">The XML strings that contain these documents are then made available to a requester that is running on *systemTwo*.</span></span>

    <span data-ttu-id="25e56-120">要求者會將備份元件檔傳送至 *systemTwo*。</span><span class="sxs-lookup"><span data-stu-id="25e56-120">The requester transfers the Backup Components Document to *systemTwo*.</span></span>

    <span data-ttu-id="25e56-121">請注意，如果陰影複製的目的是要進行備份，則 *systemOne* 上的要求者在此時不會釋放其 [**>ivssbackupcomponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) 實例。</span><span class="sxs-lookup"><span data-stu-id="25e56-121">Note that the requester on *systemOne* does not release its instance of [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) at this point if the purpose of the shadow copy is for backup.</span></span> <span data-ttu-id="25e56-122">介面應該保持開啟，直到 *systemTwo* 成功完成其備份作業為止。</span><span class="sxs-lookup"><span data-stu-id="25e56-122">The interface should remain open until *systemTwo* successfully finishes its backup operations.</span></span> <span data-ttu-id="25e56-123">只有在要求者發出 [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) 事件時才應該發出，因為有些寫入器會截斷記錄，並在成功備份之後執行其他工作。</span><span class="sxs-lookup"><span data-stu-id="25e56-123">Only then should the requester issue a [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) event since some writers will truncate logs and do other work after a successful backup.</span></span> <span data-ttu-id="25e56-124">如果陰影複製的目標是資料採礦或其他用途，則可以在此步驟關閉介面。</span><span class="sxs-lookup"><span data-stu-id="25e56-124">If the goal of the shadow copy is data mining or other purposes, then the interface can be closed at this step.</span></span>

6.  <span data-ttu-id="25e56-125">然後， *systemTwo* 的要求者會呼叫 [**>ivssbackupcomponents：： ImportSnapshots**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-importsnapshots) ，以存取 *systemOne* 上要求者所建立的陰影複製。</span><span class="sxs-lookup"><span data-stu-id="25e56-125">The requester on *systemTwo* then calls [**IVssBackupComponents::ImportSnapshots**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-importsnapshots) to get access to the shadow copy that was created by the requester on *systemOne*.</span></span>
    > [!Note]  
    > <span data-ttu-id="25e56-126">要求者負責序列化「匯入陰影複製」作業。</span><span class="sxs-lookup"><span data-stu-id="25e56-126">The requester is responsible for serializing the import shadow copy operation.</span></span> <span data-ttu-id="25e56-127">此外，如果對 [**>ivssbackupcomponents：： ImportSnapshots**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-importsnapshots) 的呼叫失敗，VSS 將不會自行清除 lun。</span><span class="sxs-lookup"><span data-stu-id="25e56-127">Also, if the call to [**IVssBackupComponents::ImportSnapshots**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-importsnapshots) fails, the VSS won't clean up LUNs on it's own.</span></span> <span data-ttu-id="25e56-128">要求者必須起始 Lun 的清除。</span><span class="sxs-lookup"><span data-stu-id="25e56-128">The requester has to initiate the cleanup of LUNs.</span></span>

     

7.  <span data-ttu-id="25e56-129">*SystemTwo* 的要求者會繼續備份陰影複製的材質，就像是備份本身所建立的陰影複製一樣 (查看) [檔的實際備份](overview-of-actual-backup-of-files.md)。</span><span class="sxs-lookup"><span data-stu-id="25e56-129">The requester on *systemTwo* proceeds with the backup of the shadow copied material exactly as if it were backing up a shadow copy that it created by itself (see [Overview of Actual Backup Of Files](overview-of-actual-backup-of-files.md)).</span></span>

    <span data-ttu-id="25e56-130">*SystemTwo* 上的要求者會在匯入的陰影複製上，使用 [**>ivssbackupcomponents：： GetSnapshotProperties**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getsnapshotproperties)取得陰影複製的 [*裝置物件*](vssgloss-d.md)，並將其附加至從中繼資料取得的原始檔案路徑開頭，以存取要備份的檔案。</span><span class="sxs-lookup"><span data-stu-id="25e56-130">The requester on *systemTwo* obtains the shadow copy's [*device object*](vssgloss-d.md) using [**IVssBackupComponents::GetSnapshotProperties**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getsnapshotproperties) on the imported shadow copy and appends that to the beginning of the original file paths that were obtained from the metadata to access files to be backed up.</span></span>

8.  <span data-ttu-id="25e56-131">使用陰影複製之後， *systemTwo* 上的要求者必須刪除陰影複製。</span><span class="sxs-lookup"><span data-stu-id="25e56-131">After using the shadow copy, the requester on *systemTwo* must delete the shadow copy.</span></span> <span data-ttu-id="25e56-132">如同不可傳送的陰影複製，如果陰影複製內容表示自動發行陰影複製 (例如， **VSS \_ CTX \_ 備份**) ，然後在 *systemTwo* 上釋放 [**>ivssbackupcomponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) ，將會導致 VSS 服務刪除陰影複製。</span><span class="sxs-lookup"><span data-stu-id="25e56-132">As with non-transportable shadow copies, if the shadow copy context indicates auto-release shadow copies (for example, **VSS\_CTX\_BACKUP**), then releasing the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) on *systemTwo* will cause the VSS service to delete the shadow copy.</span></span> <span data-ttu-id="25e56-133">否則，如果內容指出持續的陰影複製 (例如 **VSS \_ CTX \_ 應用程式 \_ 復原**) ，則 *systemTwo* 上的要求者必須明確地刪除陰影複製。</span><span class="sxs-lookup"><span data-stu-id="25e56-133">Otherwise, if the context indicates a persistent shadow copy (for example, **VSS\_CTX\_APP\_ROLLBACK**), then the requester on *systemTwo* must explicitly delete the shadow copy.</span></span>

    <span data-ttu-id="25e56-134">然後， *systemTwo* 的要求者會對 *systemOne* 發出要求，告知要求者已完成可轉移陰影複製的備份。</span><span class="sxs-lookup"><span data-stu-id="25e56-134">Then the requester on *systemTwo* signals the requester on *systemOne* that it has finished with the backup of the transportable shadow copy.</span></span>

9.  <span data-ttu-id="25e56-135">在 *systemOne* 上的要求者收到通知，指出 *systemTwo* 的要求者已完成可轉移陰影複製的備份之後，它會透過呼叫 **>ivssbackupcomponents：： BackupComplete** 來產生 [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete)事件，以通知其系統上的寫入器。</span><span class="sxs-lookup"><span data-stu-id="25e56-135">After the requester on *systemOne* has received notification that the requester on *systemTwo* has finished the backup of the transportable shadow copy, it notifies the writers on its system by generating a [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) event with a call to **IVssBackupComponents::BackupComplete**.</span></span> <span data-ttu-id="25e56-136">此時， *systemOne* 上的要求者可以釋放 [**>ivssbackupcomponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents)的實例。</span><span class="sxs-lookup"><span data-stu-id="25e56-136">At this point, the requester on *systemOne* is free to release its instance of [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents).</span></span>

<span data-ttu-id="25e56-137">叢集中 **的可轉移陰影複製：** 只要原始磁片區裝載于叢集內，就必須從叢集外部匯入可轉移的陰影複製。</span><span class="sxs-lookup"><span data-stu-id="25e56-137">**Transportable shadow copies in a cluster:** Transportable shadow copies must be imported from outside the cluster as long as the original volume is mounted within the cluster.</span></span> <span data-ttu-id="25e56-138">如需在叢集中執行快速復原的相關資訊，請參閱 [使用可轉移陰影複製磁片](fast-recovery-using-transportable-shadow-copied-volumes.md)區的快速復原。</span><span class="sxs-lookup"><span data-stu-id="25e56-138">For information about implementing a fast recovery in a cluster, see [Fast Recovery Using Transportable Shadow Copied Volumes](fast-recovery-using-transportable-shadow-copied-volumes.md).</span></span>

 

 



