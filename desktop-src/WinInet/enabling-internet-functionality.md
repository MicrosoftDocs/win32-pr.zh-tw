---
title: 啟用網際網路功能
description: 使用 WinINet 函式之前，應用程式應該嘗試使用 InternetAttemptConnect 函式來建立與網際網路的連接。
ms.assetid: 80747c0d-5a09-4ffa-a0ca-b051b82acbf8
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: adb44fadaf0726b81618dde19105da7517673a00
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/20/2020
ms.locfileid: "104023959"
---
# <a name="enabling-internet-functionality"></a><span data-ttu-id="9d098-103">啟用網際網路功能</span><span class="sxs-lookup"><span data-stu-id="9d098-103">Enabling Internet Functionality</span></span>

<span data-ttu-id="9d098-104">使用 WinINet 函式之前，應用程式應該嘗試使用 [**InternetAttemptConnect**](/windows/desktop/api/Wininet/nf-wininet-internetattemptconnect) 函式來建立與網際網路的連接。</span><span class="sxs-lookup"><span data-stu-id="9d098-104">Before using the WinINet functions, the application should attempt to make a connection to the Internet by using the [**InternetAttemptConnect**](/windows/desktop/api/Wininet/nf-wininet-internetattemptconnect) function.</span></span> <span data-ttu-id="9d098-105">此函數會呼叫 [撥號] 對話方塊來起始網際網路連線，或檢查連接是否已存在。</span><span class="sxs-lookup"><span data-stu-id="9d098-105">This function calls the dial-up dialog box to initiate a connection to the Internet or check if a connection already exists.</span></span> <span data-ttu-id="9d098-106">如果此函式失敗，應用程式可進入離線模式，讓它能夠存取在先前連線到網際網路時所快取的資訊。</span><span class="sxs-lookup"><span data-stu-id="9d098-106">If this function fails, the application can enter offline mode, which allows it to access information that was cached during previous connections to the Internet.</span></span>

<span data-ttu-id="9d098-107">使用 [**InternetCheckConnection**](/windows/desktop/api/Wininet/nf-wininet-internetcheckconnectiona) 函式來檢查網際網路的連線。</span><span class="sxs-lookup"><span data-stu-id="9d098-107">Use the [**InternetCheckConnection**](/windows/desktop/api/Wininet/nf-wininet-internetcheckconnectiona) function to check the connection to the Internet.</span></span> <span data-ttu-id="9d098-108">它會嘗試 ping 傳遞給函式之 URL 所指定的伺服器。</span><span class="sxs-lookup"><span data-stu-id="9d098-108">It attempts to ping the server designated by the URL that is passed to the function.</span></span> <span data-ttu-id="9d098-109">如果 \_ 已設定旗標 ICC 強制連線旗標， \_ \_ 且 URL 為 **Null**，則此函式會檢查伺服器資料庫中是否有最近伺服器的專案。</span><span class="sxs-lookup"><span data-stu-id="9d098-109">If the FLAG\_ICC\_FORCE\_CONNECTION flag is set and the URL is **NULL**, the function checks to see if there is an entry in the server database for the nearest server.</span></span> <span data-ttu-id="9d098-110">如果有，則函式會偵測該伺服器。</span><span class="sxs-lookup"><span data-stu-id="9d098-110">If one exists, the function pings that server.</span></span>

<span data-ttu-id="9d098-111">接下來，使用 [**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena) 函式來建立用戶端應用程式所使用之網際網路連接的特性。</span><span class="sxs-lookup"><span data-stu-id="9d098-111">Next, use the [**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena) function to establish the characteristics of the Internet connection the client application is using.</span></span> <span data-ttu-id="9d098-112">[**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena)會建立用來建立 [HTTP](http-sessions.md)[ftp](ftp-sessions.md)會話的根 [**HINTERNET**](appendix-a-hinternet-handles.md)控制碼。</span><span class="sxs-lookup"><span data-stu-id="9d098-112">[**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena) creates the root [**HINTERNET**](appendix-a-hinternet-handles.md) handle that is used to establish [http](http-sessions.md)[ftp](ftp-sessions.md) sessions.</span></span> <span data-ttu-id="9d098-113">[**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena) 不會測試網際網路的連線，以確認傳遞給函式的特性是否正確。</span><span class="sxs-lookup"><span data-stu-id="9d098-113">[**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena) does not test the connection to the Internet to verify that the characteristics passed to the function are correct.</span></span>

<span data-ttu-id="9d098-114">使用 [**InternetConnect**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta) 函式來建立特定的會話。</span><span class="sxs-lookup"><span data-stu-id="9d098-114">Use the [**InternetConnect**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta) function to create a specific session.</span></span> <span data-ttu-id="9d098-115">[**InternetConnect**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta) 會使用傳遞給它的引數，初始化指定之網站的會話，並建立屬於根控制碼之分支的 [**HINTERNET**](appendix-a-hinternet-handles.md) 控制碼。</span><span class="sxs-lookup"><span data-stu-id="9d098-115">[**InternetConnect**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta) initializes a session for the specified site using the arguments passed to it and creates an [**HINTERNET**](appendix-a-hinternet-handles.md) handle that is a branch off the root handle.</span></span> <span data-ttu-id="9d098-116">[**InternetConnect**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta) 不會嘗試存取或建立與指定網站的連接，但 FTP 會話的情況除外。</span><span class="sxs-lookup"><span data-stu-id="9d098-116">[**InternetConnect**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta) does not attempt to access or establish a connection to the specified site, except in the case of an FTP session.</span></span> <span data-ttu-id="9d098-117">[**FtpFindFirstFile**](/windows/desktop/api/Wininet/nf-wininet-ftpfindfirstfilea)、 [**FtpOpenFile**](/windows/desktop/api/Wininet/nf-wininet-ftpopenfilea)和 [**HttpOpenRequest**](/windows/desktop/api/Wininet/nf-wininet-httpopenrequesta) 函式會使用 [**InternetConnect**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta) 所建立的控制碼來建立與指定網站的連接。</span><span class="sxs-lookup"><span data-stu-id="9d098-117">[**FtpFindFirstFile**](/windows/desktop/api/Wininet/nf-wininet-ftpfindfirstfilea), [**FtpOpenFile**](/windows/desktop/api/Wininet/nf-wininet-ftpopenfilea), and [**HttpOpenRequest**](/windows/desktop/api/Wininet/nf-wininet-httpopenrequesta) functions use the handle created by [**InternetConnect**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta) to establish a connection to the specified site.</span></span>

## <a name="using-internetopen"></a><span data-ttu-id="9d098-118">使用 InternetOpen</span><span class="sxs-lookup"><span data-stu-id="9d098-118">Using InternetOpen</span></span>

<span data-ttu-id="9d098-119">若要啟用與網際網路的連線，必須使用 [**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena)建立根 [**HINTERNET**](appendix-a-hinternet-handles.md)控制碼。</span><span class="sxs-lookup"><span data-stu-id="9d098-119">To enable a connection to the Internet, a root [**HINTERNET**](appendix-a-hinternet-handles.md) handle must be created by using [**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena).</span></span> <span data-ttu-id="9d098-120">使用者代理程式的相關資訊 (呼叫網際網路功能的應用程式) 、網際網路的存取類型、proxy 名稱、主機和略過 proxy 的位址，以及將行為傳遞給 [**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena)。</span><span class="sxs-lookup"><span data-stu-id="9d098-120">Information about the user agent (the application calling the Internet functions), the type of access to the Internet, the proxy names, the hosts and addresses that bypass the proxy, and the behavior are passed to [**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena).</span></span>

### <a name="setting-the-user-agent"></a><span data-ttu-id="9d098-121">設定使用者代理程式</span><span class="sxs-lookup"><span data-stu-id="9d098-121">Setting the User Agent</span></span>

<span data-ttu-id="9d098-122">呼叫應用程式應該提供一個字串，其中包含存取網際網路的應用程式或實體的名稱，以存取 [**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena)的 *lpszAgent* 參數。</span><span class="sxs-lookup"><span data-stu-id="9d098-122">The calling application should give a string that contains the name of the application or entity accessing the Internet to the *lpszAgent* parameter of [**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena).</span></span> <span data-ttu-id="9d098-123">這個字串是用來做為 HTTP 通訊協定中的使用者代理程式。</span><span class="sxs-lookup"><span data-stu-id="9d098-123">This string is used as the user agent in the HTTP protocol.</span></span> <span data-ttu-id="9d098-124">例如，Microsoft Internet Explorer 使用「Microsoft Internet Explorer」。</span><span class="sxs-lookup"><span data-stu-id="9d098-124">For example, Microsoft Internet Explorer uses "Microsoft Internet Explorer".</span></span>

### <a name="setting-access-types"></a><span data-ttu-id="9d098-125">設定存取類型</span><span class="sxs-lookup"><span data-stu-id="9d098-125">Setting Access Types</span></span>

<span data-ttu-id="9d098-126">[**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena) 支援三種存取類型：</span><span class="sxs-lookup"><span data-stu-id="9d098-126">[**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena) supports three access types:</span></span>

-   <span data-ttu-id="9d098-127">如果執行 \_ \_ \_ 應用程式的系統使用直接連線至網際網路，請使用網際網路開放式型別直接存取。</span><span class="sxs-lookup"><span data-stu-id="9d098-127">Use INTERNET\_OPEN\_TYPE\_DIRECT if the system on which the application is running uses a direct connection to the Internet.</span></span> <span data-ttu-id="9d098-128">不會使用 [**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena)的 *lpszProxyName* 和 *lpszProxyBypass* 參數，而且應該設定為 **Null**。</span><span class="sxs-lookup"><span data-stu-id="9d098-128">The *lpszProxyName* and *lpszProxyBypass* parameters of [**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena) are not used and should be set to **NULL**.</span></span>
-   <span data-ttu-id="9d098-129">如果執行 \_ \_ \_ 應用程式的系統使用一或多個 PROXY 伺服器來存取網際網路，請使用 internet OPEN TYPE PROXY。</span><span class="sxs-lookup"><span data-stu-id="9d098-129">Use INTERNET\_OPEN\_TYPE\_PROXY if the system on which the application is running uses one or more proxy servers to access the Internet.</span></span> <span data-ttu-id="9d098-130">[**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena) 會使用 *lpszProxyName* 所指示的 proxy 伺服器，並針對 *lpszProxyBypass* 指定的任何主機名稱或 IP 位址略過 proxy。</span><span class="sxs-lookup"><span data-stu-id="9d098-130">[**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena) uses the proxy servers indicated by *lpszProxyName* and bypasses the proxy for any host names or IP addresses specified by *lpszProxyBypass*.</span></span>
-   <span data-ttu-id="9d098-131">使用 INTERNET \_ OPEN \_ TYPE \_ PRECONFIG 來指示您的應用程式從登錄中取得設定。</span><span class="sxs-lookup"><span data-stu-id="9d098-131">Use INTERNET\_OPEN\_TYPE\_PRECONFIG to instruct your application to retrieve the configuration from the registry.</span></span> <span data-ttu-id="9d098-132">這通常是最好的選擇，因為大部分的應用程式（包括網頁瀏覽器）都會使用此選項。</span><span class="sxs-lookup"><span data-stu-id="9d098-132">This is typically the best choice, as most applications including web browsers use this option.</span></span>

<span data-ttu-id="9d098-133">INTERNET \_ OPEN \_ TYPE \_ PRECONFIG 會查看登錄值 **ProxyEnable**、 **ProxyServer** 和 **ProxyOverride**。</span><span class="sxs-lookup"><span data-stu-id="9d098-133">INTERNET\_OPEN\_TYPE\_PRECONFIG looks at the registry values **ProxyEnable**, **ProxyServer**, and **ProxyOverride**.</span></span> <span data-ttu-id="9d098-134">這些值位於 [HKEY 目前的 \_ \_ 使用者 \\ 軟體 \\ Microsoft \\ Windows \\ CurrentVersion \\ 網際網路設定] 下。</span><span class="sxs-lookup"><span data-stu-id="9d098-134">These values are located under "HKEY\_CURRENT\_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings".</span></span>

<span data-ttu-id="9d098-135">如果 **ProxyEnable** 為零，則應用程式會使用網際網路 \_ 開放式 \_ 型別直接存取 \_ 。</span><span class="sxs-lookup"><span data-stu-id="9d098-135">If **ProxyEnable** is zero, the application uses INTERNET\_OPEN\_TYPE\_DIRECT.</span></span> <span data-ttu-id="9d098-136">否則，應用程式會使用網際網路 \_ 開放式 \_ 型別 \_ PROXY，並使用 **ProxyServer** 和 **ProxyOverride** 資訊。</span><span class="sxs-lookup"><span data-stu-id="9d098-136">Otherwise, the application uses INTERNET\_OPEN\_TYPE\_PROXY and uses the **ProxyServer** and **ProxyOverride** information.</span></span>

<span data-ttu-id="9d098-137">只有在安裝 Internet Explorer 時，WinINet 函式才會提供 SOCKS 類型 proxy 的支援。</span><span class="sxs-lookup"><span data-stu-id="9d098-137">The WinINet functions provide support for SOCKS type proxies only if Internet Explorer is installed.</span></span> <span data-ttu-id="9d098-138">Internet Explorer 安裝包含支援 SOCKS proxy 所需的 Wsock32n.dll 檔案。</span><span class="sxs-lookup"><span data-stu-id="9d098-138">The installation of Internet Explorer includes the Wsock32n.dll file, which is needed to support SOCKS proxies.</span></span> <span data-ttu-id="9d098-139">Wsock32n.dll 無法轉散發套件。</span><span class="sxs-lookup"><span data-stu-id="9d098-139">Wsock32n.dll is not redistributable.</span></span>

### <a name="listing-proxy-servers"></a><span data-ttu-id="9d098-140">列出 Proxy 伺服器</span><span class="sxs-lookup"><span data-stu-id="9d098-140">Listing Proxy Servers</span></span>

<span data-ttu-id="9d098-141">WinINet 辨識兩種類型的 proxy： CERN 類型 proxy (僅限 HTTP) 和 TIS FTP proxy (FTP) 。</span><span class="sxs-lookup"><span data-stu-id="9d098-141">WinINet recognizes two types of proxies: CERN type proxies (HTTP only) and TIS FTP proxies (FTP only).</span></span> <span data-ttu-id="9d098-142">如果 Internet Explorer 已安裝，WinINet 也支援 SOCKS 類型 proxy。</span><span class="sxs-lookup"><span data-stu-id="9d098-142">If Internet Explorer is installed, WinINet also support SOCKS type proxies.</span></span> <span data-ttu-id="9d098-143">根據預設， [**InternetConnect**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta)會假設指定的 PROXY 是 CERN proxy。</span><span class="sxs-lookup"><span data-stu-id="9d098-143">[**InternetConnect**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta) assumes, by default, that the specified proxy is a CERN proxy.</span></span> <span data-ttu-id="9d098-144">如果存取類型設定為 INTERNET \_ open \_ type \_ DIRECT 或 internet \_ open \_ type \_ PRECONFIG，則 [**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena)的 *lpszProxyName* 參數應該設定為 **Null**。</span><span class="sxs-lookup"><span data-stu-id="9d098-144">If the access type is set to INTERNET\_OPEN\_TYPE\_DIRECT or INTERNET\_OPEN\_TYPE\_PRECONFIG, the *lpszProxyName* parameter of [**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena) should be set to **NULL**.</span></span> <span data-ttu-id="9d098-145">否則，傳遞給 *lpszProxyName* 的值必須包含以空格分隔之字串的 proxy。</span><span class="sxs-lookup"><span data-stu-id="9d098-145">Otherwise, the value passed to *lpszProxyName* must contain the proxies in a space-delimited string.</span></span> <span data-ttu-id="9d098-146">Proxy 清單可以包含用來存取 proxy 的埠號碼。</span><span class="sxs-lookup"><span data-stu-id="9d098-146">The proxy listings can contain the port number that is used to access the proxy.</span></span>

<span data-ttu-id="9d098-147">若要列出特定通訊協定的 proxy，字串必須採用 "" <protocol> <protocol> ：//<proxy \_ name> "" 格式。</span><span class="sxs-lookup"><span data-stu-id="9d098-147">To list a proxy for a specific protocol, the string must follow the format ""<protocol><protocol>://<proxy\_name>"".</span></span> <span data-ttu-id="9d098-148">有效的通訊協定為 HTTP、HTTPS 和 FTP。</span><span class="sxs-lookup"><span data-stu-id="9d098-148">The valid protocols are HTTP, HTTPS and FTP.</span></span> <span data-ttu-id="9d098-149">例如，若要列出 FTP proxy，有效的字串會是 "" ftp = FTP：//ftp \_ proxy \_ name： 21 ""，其中 ftp \_ PROXY \_ 名稱是 ftp proxy 的名稱，而21是必須用來存取 proxy 的埠號碼。</span><span class="sxs-lookup"><span data-stu-id="9d098-149">For example, to list an FTP proxy, a valid string would be ""ftp=ftp://ftp\_proxy\_name:21"", where ftp\_proxy\_name is the name of the FTP proxy and 21 is the port number that must be used to access the proxy.</span></span> <span data-ttu-id="9d098-150">如果 proxy 使用該通訊協定的預設通訊埠號碼，則可以省略埠號碼。</span><span class="sxs-lookup"><span data-stu-id="9d098-150">If the proxy uses the default port number for that protocol, the port number can be omitted.</span></span> <span data-ttu-id="9d098-151">如果 proxy 名稱本身列出，則會使用它做為未指定特定 proxy 之任何通訊協定的預設 proxy。</span><span class="sxs-lookup"><span data-stu-id="9d098-151">If a proxy name is listed by itself, it is used as the default proxy for any protocols that do not have a specific proxy specified.</span></span> <span data-ttu-id="9d098-152">例如，"" HTTP = https://http\_proxy other "" 會 \_ 對任何 HTTP 作業使用 HTTP proxy，其他所有通訊協定則會使用其他通訊協定。</span><span class="sxs-lookup"><span data-stu-id="9d098-152">For example, ""http=https://http\_proxy other"" would use http\_proxy for any HTTP operations, while all other protocols would use other.</span></span>

<span data-ttu-id="9d098-153">根據預設，此函式會假設 *lpszProxyName* 所指定的 PROXY 是 CERN proxy。</span><span class="sxs-lookup"><span data-stu-id="9d098-153">By default, the function assumes that the proxy specified by *lpszProxyName* is a CERN proxy.</span></span> <span data-ttu-id="9d098-154">應用程式可以指定一個以上的 proxy，包括不同通訊協定的不同 proxy。</span><span class="sxs-lookup"><span data-stu-id="9d098-154">An application can specify more than one proxy, including different proxies for the different protocols.</span></span> <span data-ttu-id="9d098-155">例如，如果您指定 "" ftp = ftp：//ftp-gw HTTP = https://jericho:99 proxy ""，ftp 要求會透過 ftp-gw proxy （接聽埠21）發出，而 HTTP 要求則是透過名為 jericho 的 CERN proxy 來接聽，而此 proxy 會接聽埠99。</span><span class="sxs-lookup"><span data-stu-id="9d098-155">For example, if you specify ""ftp=ftp://ftp-gw HTTP=https://jericho:99 proxy"", FTP requests are made through the ftp-gw proxy, which listens at port 21, and HTTP requests are made through a CERN proxy called jericho, which listens at port 99.</span></span> <span data-ttu-id="9d098-156">否則，HTTP 要求會透過名為 proxy 的 CERN proxy 來進行，它會接聽埠80。</span><span class="sxs-lookup"><span data-stu-id="9d098-156">Otherwise, HTTP requests would be made through the CERN proxy called proxy, which listens at port 80.</span></span> <span data-ttu-id="9d098-157">請注意，如果應用程式只使用 FTP，就不需要指定 "" ftp = FTP：//ftp-gw： 21 "」。</span><span class="sxs-lookup"><span data-stu-id="9d098-157">Note that if the application is only using FTP, for example, it would not need to specify ""ftp=ftp://ftp-gw:21"".</span></span> <span data-ttu-id="9d098-158">它可以只指定 "" ftp-gw ""。</span><span class="sxs-lookup"><span data-stu-id="9d098-158">It could specify just ""ftp-gw"".</span></span> <span data-ttu-id="9d098-159">只有當應用程式針對 [**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena)所傳回的每個控制碼使用一個以上的通訊協定時，才需要指定通訊協定名稱。</span><span class="sxs-lookup"><span data-stu-id="9d098-159">An application is only required to specify the protocol names if it is using more than one protocol per handle returned by [**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena).</span></span>

### <a name="listing-the-proxy-bypass"></a><span data-ttu-id="9d098-160">列出 Proxy 略過</span><span class="sxs-lookup"><span data-stu-id="9d098-160">Listing the Proxy Bypass</span></span>

<span data-ttu-id="9d098-161">不應傳送至 proxy 的主機名稱或 IP 位址可以列在 proxy 略過清單中。</span><span class="sxs-lookup"><span data-stu-id="9d098-161">Host names or IP addresses that should not be sent to the proxy can be listed in the proxy bypass list.</span></span> <span data-ttu-id="9d098-162">這份清單可以包含萬用字元 " \* "，這會導致應用程式針對符合指定模式的位址略過 proxy 伺服器。</span><span class="sxs-lookup"><span data-stu-id="9d098-162">This list can contain wildcards, "\*", which cause the application to bypass the proxy server for addresses that fit the specified pattern.</span></span> <span data-ttu-id="9d098-163">若要列出多個位址和主機名稱，請在 proxy 略過字串中以分號分隔它們。</span><span class="sxs-lookup"><span data-stu-id="9d098-163">To list multiple addresses and host names, separate them with semicolons in the proxy bypass string.</span></span> <span data-ttu-id="9d098-164">如果指定 " <local> " 宏，函式會略過不包含句號的任何主機名稱的 proxy。</span><span class="sxs-lookup"><span data-stu-id="9d098-164">If the "<local>" macro is specified, the function bypasses the proxy for any host name that does not contain a period.</span></span>

<span data-ttu-id="9d098-165">根據預設，WinINet 將會略過使用主機名稱 "localhost"、"回送"、"127.0.0.1" 或 " \[ ：： 1" 之要求的 proxy \] 。</span><span class="sxs-lookup"><span data-stu-id="9d098-165">By default, WinINet will bypass the proxy for requests that use the host names "localhost", "loopback", "127.0.0.1", or "\[::1\]".</span></span> <span data-ttu-id="9d098-166">這種行為存在的原因是，遠端 proxy 伺服器通常不會正確地解析這些位址。</span><span class="sxs-lookup"><span data-stu-id="9d098-166">This behavior exists because a remote proxy server typically will not resolve these addresses properly.</span></span>

<span data-ttu-id="9d098-167">**Internet Explorer 9：** 您可以使用「< 回送>」宏，從 proxy 略過清單中移除本機電腦。</span><span class="sxs-lookup"><span data-stu-id="9d098-167">**Internet Explorer 9:** You can remove the local computer from the proxy bypass list using the "<-loopback>" macro.</span></span>

<span data-ttu-id="9d098-168">下列範例顯示使用不同的 proxy 略過字串來 [**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena) 的範例呼叫。</span><span class="sxs-lookup"><span data-stu-id="9d098-168">The following example shows sample calls to [**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena) using different proxy bypass strings.</span></span> <span data-ttu-id="9d098-169">每個呼叫上方的批註會描述略過字串對於從其所建立之 [**HINTERNET**](appendix-a-hinternet-handles.md) 控制碼存取的主機名稱有何影響。</span><span class="sxs-lookup"><span data-stu-id="9d098-169">The comments above each call describe what effect the bypass string has on the host names that are accessed from the [**HINTERNET**](appendix-a-hinternet-handles.md) handle it creates.</span></span>


```C++
HINTERNET hInternetRoot;

/* bypass the proxy for any host name that does not 
    contain a period */
hInternetRoot = InternetOpen(TEXT("WinInet Example"), 
    INTERNET_OPEN_TYPE_PROXY,TEXT("proxy"),TEXT("<local>"), 0);

/* bypass the proxy for any host name that starts with the 
    letters "ms" */
hInternetRoot = InternetOpen(TEXT("WinInet Example"), 
    INTERNET_OPEN_TYPE_PROXY,TEXT("proxy"),TEXT("ms*"), 0);

/* bypass the proxy for any host name that contains "int", 
    such as "internet" and "painter" */
hInternetRoot = InternetOpen(TEXT("WinInet Example"), 
    INTERNET_OPEN_TYPE_PROXY,TEXT("proxy"),TEXT("*int*"), 0);

/* bypass the proxy for the host name "example" and any 
    host name that contains "test" */
hInternetRoot = InternetOpen(TEXT("WinInet Example"), 
    INTERNET_OPEN_TYPE_PROXY,TEXT("proxy"),TEXT("example *test*"), 0);

/* Disable the loopback proxy bypass for localhost */
hInternetRoot = InternetOpen(TEXT("WinInet Example"), 
    INTERNET_OPEN_TYPE_PROXY,TEXT("127.0.0.1:8888"),TEXT("<-loopback>"), 0);
```



## <a name="using-internetconnect"></a><span data-ttu-id="9d098-170">使用 InternetConnect</span><span class="sxs-lookup"><span data-stu-id="9d098-170">Using InternetConnect</span></span>

<span data-ttu-id="9d098-171">若要開始會話， [**InternetConnect**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta) 函式必須從 [**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena) 函數所傳回的根控制碼建立控制碼。</span><span class="sxs-lookup"><span data-stu-id="9d098-171">To begin a session, the [**InternetConnect**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta) function must create a handle off the root handle returned by the [**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena) function.</span></span> <span data-ttu-id="9d098-172">[**InternetConnect**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta) 會設定伺服器位址、埠號碼、使用者名稱、密碼和服務類型。</span><span class="sxs-lookup"><span data-stu-id="9d098-172">[**InternetConnect**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta) sets the server address, port number, user name, password, and type of service.</span></span>

<span data-ttu-id="9d098-173">[**InternetConnect**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta)會使用 [**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena)所建立的根 [**HINTERNET**](appendix-a-hinternet-handles.md)控制碼來建立會話控制碼。</span><span class="sxs-lookup"><span data-stu-id="9d098-173">[**InternetConnect**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta) uses the root [**HINTERNET**](appendix-a-hinternet-handles.md) handle created by [**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena) to establish a session handle.</span></span> <span data-ttu-id="9d098-174">如果在呼叫 [**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena)時設定了 [INTERNET \_ 旗標 \_ ASYNC](api-flags.md)旗標，則對 [**InternetConnect**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta)的呼叫應該包含非零的內容值。</span><span class="sxs-lookup"><span data-stu-id="9d098-174">If the [INTERNET\_FLAG\_ASYNC](api-flags.md) flag was set in the call to [**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena), the call to [**InternetConnect**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta) should include a nonzero context value.</span></span>

<span data-ttu-id="9d098-175">伺服器名稱可包含主機名稱 (例如，"www.servername.com" ) 或網站的 IP 號碼（以 ASCII 點分隔的十進位格式） (例如 "10.0.1.45" ) 。</span><span class="sxs-lookup"><span data-stu-id="9d098-175">The server name can contain either the host name (for example, "www.servername.com") or IP number of the site in ASCII dotted-decimal format (for example, "10.0.1.45").</span></span>

<span data-ttu-id="9d098-176">伺服器埠是傳輸控制通訊協定/網際網路通訊協定 (TCP/IP) 埠號碼，以連接到伺服器。</span><span class="sxs-lookup"><span data-stu-id="9d098-176">The server port is the Transmission Control Protocol/Internet Protocol (TCP/IP) port number to connect to on the server.</span></span> <span data-ttu-id="9d098-177">[](/windows/desktop/api/Wininet/nf-wininet-internetconnecta)如果使用網際網路通訊 \_ \_ 埠號碼值無效，InternetConnect 會針對選取的服務類型使用預設埠 \_ 。</span><span class="sxs-lookup"><span data-stu-id="9d098-177">[**InternetConnect**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta) uses the default port for the selected service type if the INTERNET\_INVALID\_PORT\_NUMBER value is used.</span></span> <span data-ttu-id="9d098-178">下表包含 WinINet 的伺服器埠預設值。</span><span class="sxs-lookup"><span data-stu-id="9d098-178">The following tables contain the server port defaults for WinINet.</span></span>



<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th><span data-ttu-id="9d098-179">值</span><span class="sxs-lookup"><span data-stu-id="9d098-179">Value</span></span></th>
<th><span data-ttu-id="9d098-180">意義</span><span class="sxs-lookup"><span data-stu-id="9d098-180">Meaning</span></span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span data-ttu-id="9d098-181">INTERNET_DEFAULT_FTP_PORT</span><span class="sxs-lookup"><span data-stu-id="9d098-181">INTERNET_DEFAULT_FTP_PORT</span></span></td>
<td><span data-ttu-id="9d098-182">使用 ftp 伺服器的預設埠 (埠 21) 。</span><span class="sxs-lookup"><span data-stu-id="9d098-182">Use the default port for ftp servers (port 21).</span></span></td>
</tr>
<tr class="even">
<td><span data-ttu-id="9d098-183">INTERNET_DEFAULT_GOPHER_PORT</span><span class="sxs-lookup"><span data-stu-id="9d098-183">INTERNET_DEFAULT_GOPHER_PORT</span></span></td>
<td><span data-ttu-id="9d098-184">使用 (埠 70) 的 Gopher 伺服器的預設埠。</span><span class="sxs-lookup"><span data-stu-id="9d098-184">Use the default port for gopher servers (port 70).</span></span>
<blockquote>
[!Note]<br />
<span data-ttu-id="9d098-185">僅限 windows XP 及 Windows Server 2003 R2 及更早版本。</span><span class="sxs-lookup"><span data-stu-id="9d098-185">Windows XP and Windows Server 2003 R2 and earlier only.</span></span>
</blockquote>
<br/></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="9d098-186">INTERNET_DEFAULT_HTTP_PORT</span><span class="sxs-lookup"><span data-stu-id="9d098-186">INTERNET_DEFAULT_HTTP_PORT</span></span></td>
<td><span data-ttu-id="9d098-187">使用 HTTP 伺服器的預設埠 (埠 80) 。</span><span class="sxs-lookup"><span data-stu-id="9d098-187">Use the default port for http servers (port 80).</span></span></td>
</tr>
<tr class="even">
<td><span data-ttu-id="9d098-188">INTERNET_DEFAULT_HTTPS_PORT</span><span class="sxs-lookup"><span data-stu-id="9d098-188">INTERNET_DEFAULT_HTTPS_PORT</span></span></td>
<td><span data-ttu-id="9d098-189">使用 HTTPs 伺服器的預設埠 (埠 443) 。</span><span class="sxs-lookup"><span data-stu-id="9d098-189">Use the default port for https servers (port 443).</span></span></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="9d098-190">INTERNET_DEFAULT_SOCKS_PORT</span><span class="sxs-lookup"><span data-stu-id="9d098-190">INTERNET_DEFAULT_SOCKS_PORT</span></span></td>
<td><span data-ttu-id="9d098-191">使用 (埠 1080) 的 SOCKS 防火牆伺服器的預設埠。</span><span class="sxs-lookup"><span data-stu-id="9d098-191">Use the default port for SOCKS firewall servers (port 1080).</span></span></td>
</tr>
</tbody>
</table>



 

### <a name="defining-the-user-name-and-password"></a><span data-ttu-id="9d098-192">定義使用者名稱和密碼</span><span class="sxs-lookup"><span data-stu-id="9d098-192">Defining the User Name and Password</span></span>

<span data-ttu-id="9d098-193">*LpszUsername* 的值是以 **null** 終止之字串的位址，其中包含要登入之使用者的名稱。</span><span class="sxs-lookup"><span data-stu-id="9d098-193">The value of *lpszUsername* is the address of a **null**-terminated string that contains the name of the user who is logging on.</span></span> <span data-ttu-id="9d098-194">如果這個參數是 **Null**，則函式會使用適當的預設值，但 HTTP 除外。</span><span class="sxs-lookup"><span data-stu-id="9d098-194">If this parameter is **NULL**, the function uses an appropriate default, except for HTTP.</span></span> <span data-ttu-id="9d098-195">HTTP 中的 **Null** 參數會導致伺服器傳回錯誤。</span><span class="sxs-lookup"><span data-stu-id="9d098-195">A **NULL** parameter in HTTP causes the server to return an error.</span></span> <span data-ttu-id="9d098-196">若是 FTP 通訊協定，預設值為 anonymous。</span><span class="sxs-lookup"><span data-stu-id="9d098-196">For the FTP protocol, the default is anonymous.</span></span>

<span data-ttu-id="9d098-197">*LpszPassword* 的值是以 **null** 終止之字串的位址，其中包含登入密碼。</span><span class="sxs-lookup"><span data-stu-id="9d098-197">The value of *lpszPassword* is the address of a **null**-terminated string that contains the log-on password.</span></span> <span data-ttu-id="9d098-198">如果 *lpszUsername* 和 *LpszPassword* 都是 **Null**，則函式會使用預設的匿名密碼。</span><span class="sxs-lookup"><span data-stu-id="9d098-198">If both *lpszUsername* and *lpszPassword* are **NULL**, the function uses the default anonymous password.</span></span> <span data-ttu-id="9d098-199">在 FTP 的案例中，預設的匿名密碼是使用者的電子郵件名稱。</span><span class="sxs-lookup"><span data-stu-id="9d098-199">In the case of FTP, the default anonymous password is the user's email name.</span></span> <span data-ttu-id="9d098-200">如果 *lpszUsername* 不是 **Null** ，而且 *lpszPassword* 為 **null**，則函式會使用空白密碼。</span><span class="sxs-lookup"><span data-stu-id="9d098-200">If *lpszUsername* is not **NULL** and *lpszPassword* is **NULL**, the function uses a blank password.</span></span> <span data-ttu-id="9d098-201">*LpszUsername* 和 *lpszPassword* 有四個可能的設定，這些設定會產生下表所示的行為。</span><span class="sxs-lookup"><span data-stu-id="9d098-201">There are four possible settings of *lpszUsername* and *lpszPassword*, which produce the behaviors shown in the following table.</span></span>



| <span data-ttu-id="9d098-202">*lpszUsername*</span><span class="sxs-lookup"><span data-stu-id="9d098-202">*lpszUsername*</span></span>      | <span data-ttu-id="9d098-203">*lpszPassword*</span><span class="sxs-lookup"><span data-stu-id="9d098-203">*lpszPassword*</span></span>      | <span data-ttu-id="9d098-204">傳送至 FTP 伺服器的使用者名稱</span><span class="sxs-lookup"><span data-stu-id="9d098-204">User name sent to FTP server</span></span> | <span data-ttu-id="9d098-205">傳送至 FTP 伺服器的密碼</span><span class="sxs-lookup"><span data-stu-id="9d098-205">Password sent to FTP server</span></span> |
|---------------------|---------------------|------------------------------|-----------------------------|
| <span data-ttu-id="9d098-206">**NULL**</span><span class="sxs-lookup"><span data-stu-id="9d098-206">**NULL**</span></span>            | <span data-ttu-id="9d098-207">**NULL**</span><span class="sxs-lookup"><span data-stu-id="9d098-207">**NULL**</span></span>            | <span data-ttu-id="9d098-208">匿名</span><span class="sxs-lookup"><span data-stu-id="9d098-208">"anonymous"</span></span>                  | <span data-ttu-id="9d098-209">使用者的電子郵件名稱</span><span class="sxs-lookup"><span data-stu-id="9d098-209">User's email name</span></span>           |
| <span data-ttu-id="9d098-210">非 **Null** 字串</span><span class="sxs-lookup"><span data-stu-id="9d098-210">Non-**NULL** string</span></span> | <span data-ttu-id="9d098-211">**NULL**</span><span class="sxs-lookup"><span data-stu-id="9d098-211">**NULL**</span></span>            | <span data-ttu-id="9d098-212">*lpszUsername*</span><span class="sxs-lookup"><span data-stu-id="9d098-212">*lpszUsername*</span></span>               | <span data-ttu-id="9d098-213">""</span><span class="sxs-lookup"><span data-stu-id="9d098-213">""</span></span>                          |
| <span data-ttu-id="9d098-214">**NULL**</span><span class="sxs-lookup"><span data-stu-id="9d098-214">**NULL**</span></span>            | <span data-ttu-id="9d098-215">非 **Null** 字串</span><span class="sxs-lookup"><span data-stu-id="9d098-215">Non-**NULL** string</span></span> | <span data-ttu-id="9d098-216">ERROR</span><span class="sxs-lookup"><span data-stu-id="9d098-216">ERROR</span></span>                        | <span data-ttu-id="9d098-217">ERROR</span><span class="sxs-lookup"><span data-stu-id="9d098-217">ERROR</span></span>                       |
| <span data-ttu-id="9d098-218">非 **Null** 字串</span><span class="sxs-lookup"><span data-stu-id="9d098-218">Non-**NULL** string</span></span> | <span data-ttu-id="9d098-219">非 **Null** 字串</span><span class="sxs-lookup"><span data-stu-id="9d098-219">Non-**NULL** string</span></span> | <span data-ttu-id="9d098-220">*lpszUsername*</span><span class="sxs-lookup"><span data-stu-id="9d098-220">*lpszUsername*</span></span>               | <span data-ttu-id="9d098-221">*lpszPassword*</span><span class="sxs-lookup"><span data-stu-id="9d098-221">*lpszPassword*</span></span>              |



 

<span data-ttu-id="9d098-222">您可以使用 [**InternetSetOption**](/windows/desktop/api/Wininet/nf-wininet-internetsetoptiona) 和 [**InternetErrorDlg**](/windows/desktop/api/Wininet/nf-wininet-interneterrordlg) 函數來變更這項資訊。</span><span class="sxs-lookup"><span data-stu-id="9d098-222">This information can be changed by using the [**InternetSetOption**](/windows/desktop/api/Wininet/nf-wininet-internetsetoptiona) and [**InternetErrorDlg**](/windows/desktop/api/Wininet/nf-wininet-interneterrordlg) functions.</span></span> <span data-ttu-id="9d098-223">[**InternetSetOption**](/windows/desktop/api/Wininet/nf-wininet-internetsetoptiona) 會變更使用者名稱和密碼值，而 [**InternetErrorDlg**](/windows/desktop/api/Wininet/nf-wininet-interneterrordlg) 會顯示要求適當使用者名稱和密碼的對話方塊。</span><span class="sxs-lookup"><span data-stu-id="9d098-223">[**InternetSetOption**](/windows/desktop/api/Wininet/nf-wininet-internetsetoptiona) changes the user name and password values, while [**InternetErrorDlg**](/windows/desktop/api/Wininet/nf-wininet-interneterrordlg) displays a dialog box that requests the proper user name and password.</span></span>

### <a name="defining-the-session"></a><span data-ttu-id="9d098-224">定義會話</span><span class="sxs-lookup"><span data-stu-id="9d098-224">Defining the Session</span></span>

<span data-ttu-id="9d098-225">若要定義正在建立的會話，請設定 [**InternetConnect**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta)的服務類型、旗標和內容值。</span><span class="sxs-lookup"><span data-stu-id="9d098-225">To define the session that is being established, set the service type, flags, and context value for [**InternetConnect**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta).</span></span>

<span data-ttu-id="9d098-226">有兩種服務類型可供 [**InternetConnect**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta)：網際網路 \_ 服務 \_ FTP 和網際網路 \_ 服務 \_ HTTP。</span><span class="sxs-lookup"><span data-stu-id="9d098-226">There are two service types available to [**InternetConnect**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta): INTERNET\_SERVICE\_FTP and INTERNET\_SERVICE\_HTTP.</span></span> <span data-ttu-id="9d098-227">\_ \_ HTTP 和 HTTPS 會話都使用網際網路服務 HTTP。</span><span class="sxs-lookup"><span data-stu-id="9d098-227">INTERNET\_SERVICE\_HTTP is used for both HTTP and HTTPS sessions.</span></span>

<span data-ttu-id="9d098-228">[網際網路 \_旗標 \_ 被動](api-flags.md) 是 WinINet 函式所使用的唯一服務特定旗標。</span><span class="sxs-lookup"><span data-stu-id="9d098-228">[INTERNET\_FLAG\_PASSIVE](api-flags.md) is the only service-specific flag used by the WinINet functions.</span></span> <span data-ttu-id="9d098-229">此旗標可在服務類型為網際網路 \_ 服務 FTP 以 \_ 使用被動 FTP 語義時設定。</span><span class="sxs-lookup"><span data-stu-id="9d098-229">This flag can be set when the service type is INTERNET\_SERVICE\_FTP in order to use passive FTP semantics.</span></span>

<span data-ttu-id="9d098-230">對於所有同步作業而言， *dwCoNtext* 的值應該設定為零。</span><span class="sxs-lookup"><span data-stu-id="9d098-230">For all synchronous operations, the value of *dwContext* should be set to zero.</span></span> <span data-ttu-id="9d098-231">如果在呼叫 [**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena)的呼叫中設定 [網際網路 \_ 旗標 \_ ASYNC](api-flags.md)旗標來建立異步操作，則應該為 *dwCoNtext* 提供非零值。</span><span class="sxs-lookup"><span data-stu-id="9d098-231">If asynchronous operations were established by setting the [INTERNET\_FLAG\_ASYNC](api-flags.md) flag in the call to [**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena), a nonzero value should be supplied for *dwContext*.</span></span> <span data-ttu-id="9d098-232">如需非同步作業的詳細資訊，請參閱 [設定非同步作業](common-functions.md)。</span><span class="sxs-lookup"><span data-stu-id="9d098-232">For more information on asynchronous operations, see [Setting Up Asynchronous Operations](common-functions.md).</span></span>

<span data-ttu-id="9d098-233">針對 FTP 會話， [**InternetConnect**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta) 會嘗試建立與網際網路上伺服器的連線。</span><span class="sxs-lookup"><span data-stu-id="9d098-233">For FTP sessions, [**InternetConnect**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta) tries to establish a connection to the server on the Internet.</span></span> <span data-ttu-id="9d098-234">針對 HTTP 會話， [**InternetConnect**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta) 會在另一個函數嘗試從伺服器取得資訊之前，不會建立連接。</span><span class="sxs-lookup"><span data-stu-id="9d098-234">For HTTP sessions, [**InternetConnect**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta) does not establish a connection until another function attempts to get information from the server.</span></span>

> [!Note]  
> <span data-ttu-id="9d098-235">WinINet 不支援伺服器實施。</span><span class="sxs-lookup"><span data-stu-id="9d098-235">WinINet does not support server implementations.</span></span> <span data-ttu-id="9d098-236">此外，它不應該從服務使用。</span><span class="sxs-lookup"><span data-stu-id="9d098-236">In addition, it should not be used from a service.</span></span> <span data-ttu-id="9d098-237">針對伺服器執行或服務，請使用 [Microsoft WINDOWS HTTP services (WinHTTP) ](/windows/desktop/WinHttp/winhttp-start-page)。</span><span class="sxs-lookup"><span data-stu-id="9d098-237">For server implementations or services use [Microsoft Windows HTTP Services (WinHTTP)](/windows/desktop/WinHttp/winhttp-start-page).</span></span>

 

 

