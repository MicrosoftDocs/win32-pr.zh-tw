---
title: 內容編碼
description: 從 Windows Server 2008 和 Windows Vista 開始，應用程式可以導向 WinINet 來執行 gzip 和 deflate 內容編碼配置的內容解碼。
ms.assetid: 136f22a6-e5ca-41c5-8651-6e132655d268
keywords:
- 內容編碼
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 09b089ae2aa4cbacdfc9b6ebefe5cbdfc1bfc10e
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/20/2020
ms.locfileid: "104023960"
---
# <a name="content-encoding"></a><span data-ttu-id="18632-104">內容編碼</span><span class="sxs-lookup"><span data-stu-id="18632-104">Content Encoding</span></span>

<span data-ttu-id="18632-105">如同 HTTP 通訊協定中所指定 (RFC 2616) 應用程式可以要求伺服器以編碼格式傳回 HTTP 回應。</span><span class="sxs-lookup"><span data-stu-id="18632-105">As specified in the HTTP protocol (RFC 2616) applications can request that the server return HTTP responses in encoded format.</span></span> <span data-ttu-id="18632-106">在 Windows Server 2008 和 Windows Vista 之前，會將內容編碼的要求傳送至應用程式，以在其層級進行處理。</span><span class="sxs-lookup"><span data-stu-id="18632-106">Prior to Windows Server 2008 and Windows Vista, requests with content encoding were sent to the application for processing at their level.</span></span> <span data-ttu-id="18632-107">從 Windows Server 2008 和 Windows Vista 開始，應用程式可以導向 WinINet 來執行 gzip 和 deflate 內容編碼配置的內容解碼。</span><span class="sxs-lookup"><span data-stu-id="18632-107">Starting in Windows Server 2008 and Windows Vista, the application can direct WinINet to perform content decoding for the gzip and deflate content encoding schemes.</span></span>

<span data-ttu-id="18632-108">若要啟用內容解碼，應用程式會設定解碼選項，要求 WinINet 代表他們執行解碼。</span><span class="sxs-lookup"><span data-stu-id="18632-108">To enable content decoding, the application sets the decoding option requesting that WinINet perform decoding on their behalf.</span></span> <span data-ttu-id="18632-109">不過，啟用解碼並不保證 WinINet 會執行內容解碼，而應用程式應該準備好處理解碼。</span><span class="sxs-lookup"><span data-stu-id="18632-109">However, enabling decoding does not guarantee that WinINet will perform content decoding, and the application should be prepared to handle decoding.</span></span> <span data-ttu-id="18632-110">當成功執行內容解碼時，WinINet 會從回應中去除內容編碼標頭。</span><span class="sxs-lookup"><span data-stu-id="18632-110">WinINet strips the content-encoding header from the response when content decoding is successfully performed.</span></span> <span data-ttu-id="18632-111">當回應中出現內容編碼標頭時，無論是否啟用或停用解碼選項，應用程式都應該處理內容解碼。</span><span class="sxs-lookup"><span data-stu-id="18632-111">Applications are expected to handle content decoding regardless of whether the decoding option is enabled or disabled when the content-encoding header is present in the response.</span></span>

<span data-ttu-id="18632-112">啟用解碼時，應用程式必須在要求的 Accept-Encoding 標頭中指定支援的編碼清單。</span><span class="sxs-lookup"><span data-stu-id="18632-112">When decoding is enabled, the application must specify the list of supported encodings in the Accept-Encoding header of the request.</span></span> <span data-ttu-id="18632-113">不過，Accept-Encoding 標頭不會商都必須伺服器來傳送編碼的回應。</span><span class="sxs-lookup"><span data-stu-id="18632-113">The Accept-Encoding header, however, does not obligate the server to send an encoded response.</span></span> <span data-ttu-id="18632-114">WinINet 會將不符合可接受之編碼清單的回應傳送回應用程式。</span><span class="sxs-lookup"><span data-stu-id="18632-114">WinINet will send responses that do not match the list of acceptable encodings back to the application.</span></span>

<span data-ttu-id="18632-115">下列清單描述當啟用選項時，WinINet 將執行內容解碼的條件：</span><span class="sxs-lookup"><span data-stu-id="18632-115">The following list describes the conditions under which WinINet will perform content decoding when the option is enabled:</span></span>

-   <span data-ttu-id="18632-116">要求中必須有 Accept-Encoding 標頭，而且必須指定 gzip、deflate 或 gzip 和 deflate 編碼配置。</span><span class="sxs-lookup"><span data-stu-id="18632-116">The Accept-Encoding header must be present in the request, and it must specify the gzip, deflate, or both gzip and deflate encoding schemes.</span></span>
-   <span data-ttu-id="18632-117">在內容編碼標頭中指定的編碼配置必須符合 Accept-Encoding 標頭中指定的其中一個編碼配置。</span><span class="sxs-lookup"><span data-stu-id="18632-117">The encoding scheme specified in the Content-Encoding header must match one of the encoding schemes specified in the Accept-Encoding header.</span></span>
-   <span data-ttu-id="18632-118">回應中的內容編碼標頭只會指定一種編碼配置。</span><span class="sxs-lookup"><span data-stu-id="18632-118">The Content-Encoding header in the response specifies only one encoding scheme.</span></span>
-   <span data-ttu-id="18632-119">回應必須只包含一個內容編碼標頭。</span><span class="sxs-lookup"><span data-stu-id="18632-119">The response must contain only one Content- Encoding header.</span></span> <span data-ttu-id="18632-120">WinINet 只會將以一種編碼配置編碼的內容解碼。</span><span class="sxs-lookup"><span data-stu-id="18632-120">WinINet decodes content that is encoded with only one encoding scheme.</span></span>
-   <span data-ttu-id="18632-121">Cache-Control 標頭不能包含無轉換指示詞。</span><span class="sxs-lookup"><span data-stu-id="18632-121">The Cache-Control header must not contain the no-transform directive.</span></span>
-   <span data-ttu-id="18632-122">內容約制標頭不能出現在回應中。</span><span class="sxs-lookup"><span data-stu-id="18632-122">The Content-Range header must not be present in the response.</span></span>

## <a name="setting-the-decompression-option"></a><span data-ttu-id="18632-123">設定解壓縮選項</span><span class="sxs-lookup"><span data-stu-id="18632-123">Setting the Decompression Option</span></span>

<span data-ttu-id="18632-124">您可以在會話控制碼、要求控制碼或連接控制碼上設定解碼選項。</span><span class="sxs-lookup"><span data-stu-id="18632-124">The decoding option can be set on the session handle, the request handle or the connection handle.</span></span> <span data-ttu-id="18632-125">設定解碼選項的控制碼，會定義解碼選項的範圍。</span><span class="sxs-lookup"><span data-stu-id="18632-125">The handle on which the decoding option is set, defines the scope of the decoding option.</span></span> <span data-ttu-id="18632-126">例如，在會話上設定解碼將可解碼在該控制碼下建立的所有連接和要求。</span><span class="sxs-lookup"><span data-stu-id="18632-126">For example, setting decoding on the session will enable decoding an all connections and requests created under that handle.</span></span>

<span data-ttu-id="18632-127">若要設定解碼選項，應用程式會使用從 [**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena)、 [**InternetConnect**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta)或 [**HttpOpenRequest**](/windows/desktop/api/Wininet/nf-wininet-httpopenrequesta)傳回的控制碼來呼叫 [**InternetSetOption**](/windows/desktop/api/Wininet/nf-wininet-internetsetoptiona) 。</span><span class="sxs-lookup"><span data-stu-id="18632-127">To set the decoding option, the application calls [**InternetSetOption**](/windows/desktop/api/Wininet/nf-wininet-internetsetoptiona) with the handle returned from [**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena), [**InternetConnect**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta), or [**HttpOpenRequest**](/windows/desktop/api/Wininet/nf-wininet-httpopenrequesta).</span></span> <span data-ttu-id="18632-128">[ **網際網路 \_ 選項 \_ HTTP \_ 解碼** ] 選項是在 *DwOption* 參數中指定，而 *lpBuffer* 參數則指向設定為 true 的布林值變數。</span><span class="sxs-lookup"><span data-stu-id="18632-128">The **INTERNET\_OPTION\_HTTP\_DECODING** option is specified in the *dwOption* parameter, and the *lpBuffer* parameter points to a boolean variable set to true.</span></span> <span data-ttu-id="18632-129">若要停用解碼，應用程式會使用 **網際網路 \_ 選項 \_ HTTP \_ 解碼** 選項來呼叫 **InternetSetOption** ，並將布林值變數設定為 false。</span><span class="sxs-lookup"><span data-stu-id="18632-129">To disable decoding, the application calls **InternetSetOption** with the **INTERNET\_OPTION\_HTTP\_DECODING** option and the boolean variable set to false.</span></span>

<span data-ttu-id="18632-130">當設定解碼選項時，WinINet 會在應用程式呼叫 [**InternetReadFile**](/windows/desktop/api/Wininet/nf-wininet-internetreadfile)時，對要求執行解碼。</span><span class="sxs-lookup"><span data-stu-id="18632-130">When the decoding option is set, WinINet performs decoding on the request when the application calls [**InternetReadFile**](/windows/desktop/api/Wininet/nf-wininet-internetreadfile).</span></span> <span data-ttu-id="18632-131">如果 WinINet 在執行內容解碼時發生錯誤，對 **InternetReadFile** 的呼叫會失敗，並出現 **錯誤 \_ 網際網路 \_ 解碼 \_ 失敗**。</span><span class="sxs-lookup"><span data-stu-id="18632-131">If WinINet encounters an error while performing content decoding, the call to **InternetReadFile** fails with an **ERROR\_INTERNET\_DECODING\_FAILED**.</span></span> <span data-ttu-id="18632-132">解碼失敗時，應用程式有兩個選項：可以移除 Accept-Encoding 標頭並重新傳送要求，也可以將要求上的 **網際網路 \_ 選項 \_ HTTP \_ 解碼** 選項設定為 false，然後再重新傳送要求。</span><span class="sxs-lookup"><span data-stu-id="18632-132">When decoding fails, the application has two options: it can remove the Accept-Encoding header and resend the request, or it can set the **INTERNET\_OPTION\_HTTP\_DECODING** option on the request to false and then resend the request.</span></span> <span data-ttu-id="18632-133">如果解碼選項設定為 false，則應用程式必須檢查內容編碼標頭，並在應用層級執行任何解碼。</span><span class="sxs-lookup"><span data-stu-id="18632-133">If the decoding option is set to false, the application must check the Content-Encoding header and perform any decoding at the application level.</span></span>

> [!Note]  
> <span data-ttu-id="18632-134">WinINet 不支援伺服器實施。</span><span class="sxs-lookup"><span data-stu-id="18632-134">WinINet does not support server implementations.</span></span> <span data-ttu-id="18632-135">此外，它不應該從服務使用。</span><span class="sxs-lookup"><span data-stu-id="18632-135">In addition, it should not be used from a service.</span></span> <span data-ttu-id="18632-136">針對伺服器執行或服務，請使用 [Microsoft WINDOWS HTTP services (WinHTTP) ](/windows/desktop/WinHttp/winhttp-start-page)。</span><span class="sxs-lookup"><span data-stu-id="18632-136">For server implementations or services use [Microsoft Windows HTTP Services (WinHTTP)](/windows/desktop/WinHttp/winhttp-start-page).</span></span>

 

 

 