---
title: 執行 EAPHost 的 LEAP 機制
description: 描述 EAPHost 機制，可讓協力廠商撰寫適用于 Windows 的輕量可延伸驗證通訊協定 (LEAP) 模組。
ms.assetid: d17a99cb-4a43-4719-984e-b742c9518f52
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: dc50cda8d32cc26dd81af5733345deebb579c792
ms.sourcegitcommit: 773fa6257ead6c74154ad3cf46d21e49adc900aa
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/09/2020
ms.locfileid: "104093467"
---
# <a name="implementing-the-eaphost-leap-mechanism"></a><span data-ttu-id="82040-103">執行 EAPHost 的 LEAP 機制</span><span class="sxs-lookup"><span data-stu-id="82040-103">Implementing the EAPHost LEAP Mechanism</span></span>

<span data-ttu-id="82040-104">本主題說明的 EAPHost 機制可讓協力廠商撰寫適用于 Windows 的輕量) 模組 (的輕量可延伸驗證通訊協定。</span><span class="sxs-lookup"><span data-stu-id="82040-104">This topic describes the EAPHost mechanism that allows third parties to write Lightweight Extensible Authentication Protocol (LEAP) modules for Windows.</span></span> <span data-ttu-id="82040-105">LEAP 是根據 [RFC 3748](https://go.microsoft.com/fwlink/p/?linkid=84016)而由 Cisco 建立的傳統驗證方法。</span><span class="sxs-lookup"><span data-stu-id="82040-105">LEAP is a legacy authentication method, created by Cisco, as per [RFC 3748](https://go.microsoft.com/fwlink/p/?linkid=84016).</span></span> <span data-ttu-id="82040-106">如需有關 LEAP 的詳細資訊，請參閱 [CISCO 閏 Q&A](https://go.microsoft.com/fwlink/p/?linkid=84018)。</span><span class="sxs-lookup"><span data-stu-id="82040-106">For more information about LEAP, see [Cisco LEAP Q&A](https://go.microsoft.com/fwlink/p/?linkid=84018).</span></span>

## <a name="eaphost-authentication-process"></a><span data-ttu-id="82040-107">EAPHost Authentication 進程</span><span class="sxs-lookup"><span data-stu-id="82040-107">EAPHost Authentication Process</span></span>

<span data-ttu-id="82040-108">一般 EAPHost 驗證程式會如下所示：</span><span class="sxs-lookup"><span data-stu-id="82040-108">The regular EAPHost authentication process occurs as follows:</span></span>

-   <span data-ttu-id="82040-109">驗證器傳送要求以驗證對等。</span><span class="sxs-lookup"><span data-stu-id="82040-109">The authenticator sends a Request to authenticate the peer.</span></span> <span data-ttu-id="82040-110">例如，應用程式會使用 EAPHost 設定和使用者資料來呼叫 [**EapHostPeerBeginSession**](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeerbeginsession) 。</span><span class="sxs-lookup"><span data-stu-id="82040-110">For example, the application calls [**EapHostPeerBeginSession**](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeerbeginsession) with EAPHost configuration and user data.</span></span>
-   <span data-ttu-id="82040-111">對等會在回復中傳送回應封包至有效的要求。</span><span class="sxs-lookup"><span data-stu-id="82040-111">The peer sends a Response packet in reply to a valid Request.</span></span> <span data-ttu-id="82040-112">例如，成功的呼叫會傳回 **EAP \_ 會話 \_ 句** 柄會話控制碼。</span><span class="sxs-lookup"><span data-stu-id="82040-112">For example, a successful call returns an **EAP\_SESSION\_HANDLE** session handle.</span></span>
-   <span data-ttu-id="82040-113">驗證器會傳送額外的要求封包，且對等會以回應來回複。</span><span class="sxs-lookup"><span data-stu-id="82040-113">The authenticator sends an additional Request packet, and the peer replies with a Response.</span></span> <span data-ttu-id="82040-114">例如，應用程式會呼叫 [**EapHostPeerGetSendPacket**](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeergetsendpacket) ，以取得 EAPHost 在整個會話中收到的 EAP 封包。</span><span class="sxs-lookup"><span data-stu-id="82040-114">For example, the application calls [**EapHostPeerGetSendPacket**](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeergetsendpacket) to obtain EAP packets received by EAPHost throughout the session.</span></span> <span data-ttu-id="82040-115">每個封包都會透過呼叫 [**EapHostPeerProcessReceivedPacket**](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeerprocessreceivedpacket)來處理。</span><span class="sxs-lookup"><span data-stu-id="82040-115">Each packet is processed by a call to [**EapHostPeerProcessReceivedPacket**](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeerprocessreceivedpacket).</span></span>
-   <span data-ttu-id="82040-116">[**EapHostPeerProcessReceivedPacket**](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeerprocessreceivedpacket) 一律會傳回動作碼。</span><span class="sxs-lookup"><span data-stu-id="82040-116">[**EapHostPeerProcessReceivedPacket**](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeerprocessreceivedpacket) will always return an action code.</span></span> <span data-ttu-id="82040-117">然後要求者必須呼叫對應至動作程式碼的函式。</span><span class="sxs-lookup"><span data-stu-id="82040-117">The supplicant must then call the function corresponding to the action code.</span></span>
-   <span data-ttu-id="82040-118">要求和回應的順序會持續一段時間。</span><span class="sxs-lookup"><span data-stu-id="82040-118">The sequence of Requests and Responses continues as long as needed.</span></span> <span data-ttu-id="82040-119">例如，應用程式可以呼叫 [**EapHostPeerGetResponseAttributes**](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeergetresponseattributes) 來要求可用的 EAP 屬性，而對等會以 [**EapHostPeerSetResponseAttributes**](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeersetresponseattributes) 回應以傳回它們。</span><span class="sxs-lookup"><span data-stu-id="82040-119">For example, the application can call [**EapHostPeerGetResponseAttributes**](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeergetresponseattributes) to request available EAP attributes, and the peer responds with [**EapHostPeerSetResponseAttributes**](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeersetresponseattributes) to return them.</span></span>
-   <span data-ttu-id="82040-120">在初始要求之後，就無法傳送新的要求，直到收到有效的回應為止。</span><span class="sxs-lookup"><span data-stu-id="82040-120">After an initial Request, a new Request cannot be sent until a valid Response is received.</span></span>
-   <span data-ttu-id="82040-121">交談會繼續進行，直到驗證器無法驗證對等，在此情況下，驗證器的執行必須傳送 EAP 失敗。</span><span class="sxs-lookup"><span data-stu-id="82040-121">The conversation continues until the authenticator cannot authenticate the peer, in which case the authenticator implementation must transmit an EAP Failure.</span></span> <span data-ttu-id="82040-122">例如，一或多個要求的無法接受回應會導致驗證器傳輸程式碼 4 EAP 失敗。</span><span class="sxs-lookup"><span data-stu-id="82040-122">For example, unacceptable Responses to one or more Requests would cause the authenticator to transmit a Code 4 EAP Failure.</span></span>
-   <span data-ttu-id="82040-123">或者，驗證交談可以繼續進行，直到驗證器判斷已成功驗證，在此情況下，驗證器必須將 EAP 成功 (程式碼 3) 。</span><span class="sxs-lookup"><span data-stu-id="82040-123">Alternatively, the authentication conversation can continue until the authenticator determines that successful authentication has occurred, in which case the authenticator must transmit an EAP Success (Code 3).</span></span>
-   <span data-ttu-id="82040-124">無論結果是指出成功或失敗，應用程式都會呼叫 [**EapHostPeerEndSession**](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeerendsession) 來終止會話。</span><span class="sxs-lookup"><span data-stu-id="82040-124">Whether the result indicates success or failure, the application calls [**EapHostPeerEndSession**](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeerendsession) to terminate the session.</span></span> <span data-ttu-id="82040-125">在失敗的情況下，您可以使用 EAPHost 開啟另一個會話，並提供相同或新的身分識別，來嘗試重新驗證。</span><span class="sxs-lookup"><span data-stu-id="82040-125">In the case of failure, re-authentication can be attempted by opening another session with EAPHost and providing either the same or a new identity.</span></span>

### <a name="leap-authentication-process"></a><span data-ttu-id="82040-126">LEAP 驗證流程</span><span class="sxs-lookup"><span data-stu-id="82040-126">LEAP Authentication Process</span></span>

<span data-ttu-id="82040-127">LEAP 驗證程式與一般 EAPhost authentication 程式不同，如下所示：</span><span class="sxs-lookup"><span data-stu-id="82040-127">The LEAP authentication process differs from the regular EAPhost authentication process as follows:</span></span>

-   <span data-ttu-id="82040-128">EAP 驗證是由伺服器 (驗證器) 所起始。</span><span class="sxs-lookup"><span data-stu-id="82040-128">EAP authentication is initiated by the server (authenticator).</span></span> <span data-ttu-id="82040-129">相反地，相反地，用戶端 (對等) 起始。</span><span class="sxs-lookup"><span data-stu-id="82040-129">LEAP, in contrast, is initiated by the client (peer).</span></span>
    -   <span data-ttu-id="82040-130">因此，在寫入 LEAP 模組時，您必須一律確定來自對等方法的挑戰要求封包，以及來自 EAP 伺服器的 EAP 回應，一律必須有與來自伺服器之 EAP 成功封包的相同封包識別碼。</span><span class="sxs-lookup"><span data-stu-id="82040-130">Therefore, when writing a LEAP module you must always ensure that the Challenge Request packet from the peer method and the EAP Response from the EAP server must always have the same packet ID as that of the EAP Success packet from the server.</span></span>

    <!-- -->

    -   <span data-ttu-id="82040-131">相反地，EAPHost 要求和回應和成功封包通常都有不同的識別碼。</span><span class="sxs-lookup"><span data-stu-id="82040-131">In contrast, EAPHost Request and Response and Success packets typically all have different IDs.</span></span>
        > [!Note]  
        > <span data-ttu-id="82040-132">每個 EAP 要求都有一個類型欄位，以指出所要求的內容。</span><span class="sxs-lookup"><span data-stu-id="82040-132">Every EAP Request has a Type field to indicate what is being requested.</span></span> <span data-ttu-id="82040-133">和要求封包一樣，每個 EAP 回應封包都包含類型欄位，該欄位會對應至要求的類型欄位。</span><span class="sxs-lookup"><span data-stu-id="82040-133">As with the Request packet, every EAP Response packet contains a Type field, which corresponds to the Type field of the Request.</span></span> <span data-ttu-id="82040-134">範例包括身分識別要求和挑戰要求封包。</span><span class="sxs-lookup"><span data-stu-id="82040-134">Examples include Identity Request and Challenge Request packets.</span></span>

         

-   <span data-ttu-id="82040-135">在 EAPHost 失敗的情況下，您可以使用 EAPHost 開啟另一個會話，並提供相同的身分識別或新的身分識別，來嘗試重新驗證。</span><span class="sxs-lookup"><span data-stu-id="82040-135">In the case of failure with EAPHost, re-authentication can be attempted by opening another session with EAPHost and providing either the same identity or a new identity.</span></span>

### <a name="leap-authenticator-method-implementation"></a><span data-ttu-id="82040-136">LEAP 驗證器方法的執行</span><span class="sxs-lookup"><span data-stu-id="82040-136">LEAP Authenticator Method Implementation</span></span>

<span data-ttu-id="82040-137">開發 LEAP 驗證器方法時，請確定下列事項：</span><span class="sxs-lookup"><span data-stu-id="82040-137">When developing a LEAP authenticator method, please ensure the following:</span></span>

-   <span data-ttu-id="82040-138">在驗證的第一階段之後，LEAP 驗證器方法必須傳回 [**EAP \_ 方法 \_ 驗證器 \_ 回應 \_ 傳送**](/windows/desktop/api/EapAuthenticatorActionDefine/ne-eapauthenticatoractiondefine-eap_method_authenticator_response_action) 動作碼 (對等驗證) 成功。</span><span class="sxs-lookup"><span data-stu-id="82040-138">LEAP authenticator methods must return the [**EAP\_METHOD\_AUTHENTICATOR\_RESPONSE\_SEND**](/windows/desktop/api/EapAuthenticatorActionDefine/ne-eapauthenticatoractiondefine-eap_method_authenticator_response_action) action code after the 1st phase of authentication (peer authentication) is successful.</span></span> <span data-ttu-id="82040-139">然後當呼叫 [**EapMethodAuthenticatorSendPacket**](/previous-versions/windows/desktop/api/eapmethodauthenticatorapis/nf-eapmethodauthenticatorapis-eapmethodauthenticatorsendpacket)時，它應該會傳回具有 EAP 代碼 [**EapCodeSuccess**](/windows/win32/api/eapmethodtypes/ne-eapmethodtypes-eapcode)的有效 [**EapPacket**](/windows/win32/api/eapmethodtypes/ns-eapmethodtypes-eappacket) 。</span><span class="sxs-lookup"><span data-stu-id="82040-139">Then when [**EapMethodAuthenticatorSendPacket**](/previous-versions/windows/desktop/api/eapmethodauthenticatorapis/nf-eapmethodauthenticatorapis-eapmethodauthenticatorsendpacket) is called, it should return a valid [**EapPacket**](/windows/win32/api/eapmethodtypes/ns-eapmethodtypes-eappacket) with an EAP code of [**EapCodeSuccess**](/windows/win32/api/eapmethodtypes/ne-eapmethodtypes-eapcode).</span></span>
-   <span data-ttu-id="82040-140">如果對等驗證的第一個階段失敗，則 LEAP 驗證器方法應該會傳回 [**EAP \_ 方法 \_ 驗證器 \_ 回應 \_ 結果**](/windows/desktop/api/EapAuthenticatorActionDefine/ne-eapauthenticatoractiondefine-eap_method_authenticator_response_action) 動作程式碼。</span><span class="sxs-lookup"><span data-stu-id="82040-140">LEAP authenticator methods should return the [**EAP\_METHOD\_AUTHENTICATOR\_RESPONSE\_RESULT**](/windows/desktop/api/EapAuthenticatorActionDefine/ne-eapauthenticatoractiondefine-eap_method_authenticator_response_action) action code if the 1st phase of peer authentication is unsuccessful.</span></span>
-   <span data-ttu-id="82040-141">當呼叫 [**EapMethodAuthenticatorSendPacket**](/previous-versions/windows/desktop/api/eapmethodauthenticatorapis/nf-eapmethodauthenticatorapis-eapmethodauthenticatorsendpacket)時，LEAP 驗證器方法必須傳回最後一個驗證回應封包，以及 [**EAP \_ 方法 \_ 驗證程式 \_ 回應 \_ 結果**](/windows/desktop/api/EapAuthenticatorActionDefine/ne-eapauthenticatoractiondefine-eap_method_authenticator_response_action)的動作代碼。</span><span class="sxs-lookup"><span data-stu-id="82040-141">LEAP authenticator methods must return the final authentication response packet with the [**EAP\_METHOD\_AUTHENTICATOR\_RESPONSE\_RESULT**](/windows/desktop/api/EapAuthenticatorActionDefine/ne-eapauthenticatoractiondefine-eap_method_authenticator_response_action) action code when [**EapMethodAuthenticatorSendPacket**](/previous-versions/windows/desktop/api/eapmethodauthenticatorapis/nf-eapmethodauthenticatorapis-eapmethodauthenticatorsendpacket) is called.</span></span> <span data-ttu-id="82040-142">然後，在後續呼叫 [**EapMethodAuthenticatorGetResult**](/previous-versions/windows/desktop/api/eapmethodauthenticatorapis/nf-eapmethodauthenticatorapis-eapmethodauthenticatorgetresult) 時，必須傳回 **EAP \_ 會話 \_ 控制碼** ，以識別已驗證的會話。</span><span class="sxs-lookup"><span data-stu-id="82040-142">Then in subsequent calls to [**EapMethodAuthenticatorGetResult**](/previous-versions/windows/desktop/api/eapmethodauthenticatorapis/nf-eapmethodauthenticatorapis-eapmethodauthenticatorgetresult) the **EAP\_SESSION\_HANDLE** must be returned to identify the authenticated session.</span></span>
-   

### <a name="leap-peer-method-implementation"></a><span data-ttu-id="82040-143">LEAP 對等方法的執行</span><span class="sxs-lookup"><span data-stu-id="82040-143">LEAP Peer Method Implementation</span></span>

<span data-ttu-id="82040-144">開發 LEAP 對等方法時，請確定下列各項</span><span class="sxs-lookup"><span data-stu-id="82040-144">When developing a LEAP peer method, please ensure the following</span></span>

-   <span data-ttu-id="82040-145">在驗證的第一個階段 (對等驗證) 成功之後，LEAP 對等方法應該會傳回 [**EapPeerMethodResponseActionSend**](/windows/win32/api/eapauthenticatoractiondefine/ne-eapauthenticatoractiondefine-eappeermethodresponseaction) 動作程式碼。</span><span class="sxs-lookup"><span data-stu-id="82040-145">LEAP peer methods should return the [**EapPeerMethodResponseActionSend**](/windows/win32/api/eapauthenticatoractiondefine/ne-eapauthenticatoractiondefine-eappeermethodresponseaction) action code after the 1st phase of authentication (peer authentication) is successful.</span></span>
-   <span data-ttu-id="82040-146">在驗證的第二個階段成功之後，LEAP 對等方法應該會傳回 [**EapPeerMethodResponseActionResult**](/windows/win32/api/eapauthenticatoractiondefine/ne-eapauthenticatoractiondefine-eappeermethodresponseaction) 動作程式碼。</span><span class="sxs-lookup"><span data-stu-id="82040-146">LEAP peer methods should return the [**EapPeerMethodResponseActionResult**](/windows/win32/api/eapauthenticatoractiondefine/ne-eapauthenticatoractiondefine-eappeermethodresponseaction) action code after the 2nd phase of authentication is successful.</span></span>

## <a name="related-topics"></a><span data-ttu-id="82040-147">相關主題</span><span class="sxs-lookup"><span data-stu-id="82040-147">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="82040-148">EAPHost 呼叫順序</span><span class="sxs-lookup"><span data-stu-id="82040-148">EAPHost Call Sequence</span></span>](about-eaphost-call-sequences.md)
</dt> <dt>

[<span data-ttu-id="82040-149">使用 EAPHost</span><span class="sxs-lookup"><span data-stu-id="82040-149">Using EAPHost</span></span>](using-eap-host.md)
</dt> </dl>

 

 




