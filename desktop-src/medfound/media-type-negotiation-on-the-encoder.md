---
description: 編碼器上的媒體類型協商
ms.assetid: c8ae543e-68f7-4c74-9cb7-2a200bd51820
title: 編碼器上的媒體類型協商
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c7845e9d50c5d418198dc0e08313e2e9329ffab8
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/03/2021
ms.locfileid: "103945706"
---
# <a name="media-type-negotiation-on-the-encoder"></a><span data-ttu-id="87b0a-103">編碼器上的媒體類型協商</span><span class="sxs-lookup"><span data-stu-id="87b0a-103">Media Type Negotiation on the Encoder</span></span>

<span data-ttu-id="87b0a-104">在 Microsoft 媒體基礎中，會使用一個輸入和一個輸出，將編碼器實作為 [媒體基礎轉換](media-foundation-transforms.md) (MFTs) 。</span><span class="sxs-lookup"><span data-stu-id="87b0a-104">In Microsoft Media Foundation, encoders are implemented as [Media Foundation transforms](media-foundation-transforms.md) (MFTs) with one input and one output.</span></span> <span data-ttu-id="87b0a-105">在編碼會話之前，編碼器必須知道它將收到的資料流程特性（作為輸入），以及它將產生的資料流程格式（作為輸出）。</span><span class="sxs-lookup"><span data-stu-id="87b0a-105">Before an encoding session, an encoder needs to know the characteristics of the stream it will receive as input and the format of the stream it will produce as output.</span></span> <span data-ttu-id="87b0a-106">您必須先設定輸入和輸出媒體類型和相關特性，才能透過編碼器傳遞資料。</span><span class="sxs-lookup"><span data-stu-id="87b0a-106">You must set the input and output media types and related characteristics before you pass data through the encoder.</span></span> <span data-ttu-id="87b0a-107">您必須提供輸入和輸出格式，方法是指定適當的 [媒體類型 guid](media-type-guids.md) ，並在輸出媒體類型上設定相關的 [媒體類型屬性](media-type-attributes.md) ，以設定輸出資料流程的特性。</span><span class="sxs-lookup"><span data-stu-id="87b0a-107">You must supply the input and output formats by specifying the appropriate [Media Type GUIDs](media-type-guids.md) and set the characteristics of the output stream by setting the relevant [Media Type Attributes](media-type-attributes.md) on the output media type.</span></span> <span data-ttu-id="87b0a-108">新具現化的編碼器沒有任何已設定的媒體類型。</span><span class="sxs-lookup"><span data-stu-id="87b0a-108">A newly instantiated encoder does not have any set media types.</span></span>

<span data-ttu-id="87b0a-109">輸入媒體類型是未壓縮的格式，例如 PCM 音訊或 RGB 影片。</span><span class="sxs-lookup"><span data-stu-id="87b0a-109">The input media type is an uncompressed format, such as PCM audio or RGB video.</span></span> <span data-ttu-id="87b0a-110">編碼器所使用的格式類型會限制為 **VIDEOINFOHEADER** 和 **WAVEFORMATEX** 結構所描述的格式類型。</span><span class="sxs-lookup"><span data-stu-id="87b0a-110">The format types that are used by the encoder are limited to those described by the **VIDEOINFOHEADER** and **WAVEFORMATEX** structures.</span></span> <span data-ttu-id="87b0a-111">如需這些結構的詳細資訊，請參閱 Windows SDK 檔。媒體基礎提供 helper 函式，以從格式結構建立媒體類型。</span><span class="sxs-lookup"><span data-stu-id="87b0a-111">For more information about these structures, see the Windows SDK documentation.Media foundation provides helper functions to create media types from format structures.</span></span> <span data-ttu-id="87b0a-112">例如， [**MFInitMediaTypeFromVideoInfoHeader**](/windows/desktop/api/mfapi/nf-mfapi-mfinitmediatypefromvideoinfoheader) 函式會從 **VIDEOINFOHEADER** 結構初始化影片類型，而 [**MFInitMediaTypeFromWaveFormatEx**](/windows/desktop/api/mfapi/nf-mfapi-mfinitmediatypefromwaveformatex) 函式會從 **WAVEFORMATEX** 或 **WAVEFORMATEXTENSIBLE** 結構初始化影片類型。</span><span class="sxs-lookup"><span data-stu-id="87b0a-112">For example, the [**MFInitMediaTypeFromVideoInfoHeader**](/windows/desktop/api/mfapi/nf-mfapi-mfinitmediatypefromvideoinfoheader) function initializes a video type from a **VIDEOINFOHEADER** structure, and the [**MFInitMediaTypeFromWaveFormatEx**](/windows/desktop/api/mfapi/nf-mfapi-mfinitmediatypefromwaveformatex) function initializes a video type from a **WAVEFORMATEX** or **WAVEFORMATEXTENSIBLE** structure.</span></span> <span data-ttu-id="87b0a-113">如需詳細資訊，請參閱 [媒體類型轉換](media-type-conversions.md)。</span><span class="sxs-lookup"><span data-stu-id="87b0a-113">For more information, see [Media Type Conversions](media-type-conversions.md).</span></span> <span data-ttu-id="87b0a-114">您必須藉由呼叫 [**IMFTransform：： SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype)，在編碼器上設定輸入媒體類型。</span><span class="sxs-lookup"><span data-stu-id="87b0a-114">You must set the input media type on the encoder by calling [**IMFTransform::SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype).</span></span>

<span data-ttu-id="87b0a-115">輸出媒體類型是最終來來源資料流或檔案中使用的壓縮格式。</span><span class="sxs-lookup"><span data-stu-id="87b0a-115">The output media type is the compression format used in the final source stream or file.</span></span> <span data-ttu-id="87b0a-116">只有在設定輸入媒體類型之後，才可以設定可用的輸出媒體類型。</span><span class="sxs-lookup"><span data-stu-id="87b0a-116">You can set the available output media type only after setting the input media type.</span></span> <span data-ttu-id="87b0a-117">您可以在迴圈中呼叫 [**IMFTransform：： GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) ，以抓取支援的輸出類型，直到編碼器傳回 **MF \_ E \_ NO 以上的 \_ \_ 類型**。</span><span class="sxs-lookup"><span data-stu-id="87b0a-117">You can retrieve the supported output types by calling [**IMFTransform::GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) in a loop until the encoder returns **MF\_E\_NO\_MORE\_TYPES**.</span></span> <span data-ttu-id="87b0a-118">使用每個反復專案遞增型別索引。</span><span class="sxs-lookup"><span data-stu-id="87b0a-118">Increment the type index with each iteration.</span></span> <span data-ttu-id="87b0a-119">當您找到適當的媒體類型時，請呼叫 [**IMFTransform：： SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype)來設定輸出媒體類型。</span><span class="sxs-lookup"><span data-stu-id="87b0a-119">When you find an appropriate media type, set the output media type by calling [**IMFTransform::SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype).</span></span>

<span data-ttu-id="87b0a-120">選擇輸出媒體類型的決定因素取決於編碼類型和編碼需求。</span><span class="sxs-lookup"><span data-stu-id="87b0a-120">The deciding factor in choosing the output media type depends on the type of encoding and your encoding requirements.</span></span> <span data-ttu-id="87b0a-121">例如，針對以 CBR 編碼的音訊串流，您想要尋找符合輸入的媒體類型，並具有比目標值更接近的位元速率。</span><span class="sxs-lookup"><span data-stu-id="87b0a-121">For example, for audio streams that are CBR-encoded, you want to find a media type that matches your input and has a bit rate that is as close as possible to a target value.</span></span>

<span data-ttu-id="87b0a-122">如果您想要使用 CBR 以外的編碼模式，您必須設定模式，然後列舉該模式的輸出類型，因為編碼器會根據設定的模式變更支援的輸出類型。</span><span class="sxs-lookup"><span data-stu-id="87b0a-122">If you want to use an encoding mode other than CBR, you must set the mode and then enumerate the output types for that mode, because the encoder changes the supported output types depending upon the mode set.</span></span> <span data-ttu-id="87b0a-123">控制編碼模式的屬性為 [**MFPKEY \_ VBRENABLED**](mfpkey-vbrenabledproperty.md) 和 [**MFPKEY \_ PASSESUSED**](mfpkey-passesusedproperty.md)。</span><span class="sxs-lookup"><span data-stu-id="87b0a-123">The properties that control the encoding mode are [**MFPKEY\_VBRENABLED**](mfpkey-vbrenabledproperty.md) and [**MFPKEY\_PASSESUSED**](mfpkey-passesusedproperty.md).</span></span> <span data-ttu-id="87b0a-124">例如，如果您要列舉的是 VBR 品質編碼的輸出類型，則媒體類型會取決於您決定要使用的品質值。</span><span class="sxs-lookup"><span data-stu-id="87b0a-124">For example, if you are enumerating output types for VBR-quality encoding, the media type depends on the quality value you decide to use.</span></span> <span data-ttu-id="87b0a-125">如需有關設定這些屬性的詳細資訊，請參閱 [編碼屬性](configuring-the-encoder.md)。</span><span class="sxs-lookup"><span data-stu-id="87b0a-125">For information about setting these properties, see [Encoding Properties](configuring-the-encoder.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="87b0a-126">相關主題</span><span class="sxs-lookup"><span data-stu-id="87b0a-126">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="87b0a-127">具現化編碼器 MFT</span><span class="sxs-lookup"><span data-stu-id="87b0a-127">Instantiating an Encoder MFT</span></span>](instantiating-the-encoder-mft.md)
</dt> <dt>

[<span data-ttu-id="87b0a-128">Windows Media 編碼器</span><span class="sxs-lookup"><span data-stu-id="87b0a-128">Windows Media Encoders</span></span>](windows-media-encoders.md)
</dt> </dl>

 

 



