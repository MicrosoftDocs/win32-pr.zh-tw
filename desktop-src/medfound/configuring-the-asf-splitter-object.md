---
description: 設定 ASF 分隔器物件
ms.assetid: 8e2ba659-e1f6-42be-afd6-21fc841dc8d3
title: 設定 ASF 分隔器物件
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 14f27885e602dd52012808d330d997f9b7a7e983
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104111841"
---
# <a name="configuring-the-asf-splitter-object"></a><span data-ttu-id="bc345-103">設定 ASF 分隔器物件</span><span class="sxs-lookup"><span data-stu-id="bc345-103">Configuring the ASF Splitter Object</span></span>

<span data-ttu-id="bc345-104">ASF *分隔器* 物件是 WMContainer 層物件，可剖析 Advanced Systems 格式的 Asf 資料物件 (asf) 檔。</span><span class="sxs-lookup"><span data-stu-id="bc345-104">The ASF *splitter* object is a WMContainer layer object that parses the ASF Data Object of an Advanced Systems Format (ASF) file.</span></span> <span data-ttu-id="bc345-105">建立並初始化分隔器來剖析媒體檔案的 ASF 資料物件之後，必須設定分隔器，以產生特定資料流程的範例。</span><span class="sxs-lookup"><span data-stu-id="bc345-105">After the splitter is created and initialized to parse the ASF Data Object of a media file, the splitter must be configured to generate samples for specific streams.</span></span> <span data-ttu-id="bc345-106">呼叫 [**IMFASFSplitter：： SelectStreams**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-selectstreams) 來選取所需的資料流程。</span><span class="sxs-lookup"><span data-stu-id="bc345-106">Call [**IMFASFSplitter::SelectStreams**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-selectstreams) to select the required streams.</span></span>

<span data-ttu-id="bc345-107">或者，應用程式也可以將它設定為以反向順序產生範例，或產生受保護內容的範例。</span><span class="sxs-lookup"><span data-stu-id="bc345-107">Optionally, an application can also configure it to generate samples in reverse order or generate samples for protected content.</span></span> <span data-ttu-id="bc345-108">若要設定這些選項，請呼叫 [**IMFASFSplitter：： SetFlags**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-setflags) ，並傳遞所支援旗標所需的位組合。</span><span class="sxs-lookup"><span data-stu-id="bc345-108">To set these options, call [**IMFASFSplitter::SetFlags**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-setflags) and pass the required bitwise combination of the supported flags.</span></span> <span data-ttu-id="bc345-109">在呼叫這個方法之前，用戶端必須成功完成 [**IMFASFSplitter：： Initialize**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-initialize) 呼叫;否則， **SetFlags** 會失敗，並出現 **MF \_ E \_ 未 \_ 初始化** 的錯誤碼。</span><span class="sxs-lookup"><span data-stu-id="bc345-109">Before calling this method, the client must complete the [**IMFASFSplitter::Initialize**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-initialize) call successfully; otherwise, **SetFlags** fails with **MF\_E\_NOT\_INITIALIZED** error code.</span></span> <span data-ttu-id="bc345-110">如需初始化分隔器的詳細資訊，請參閱 [建立 ASF 分隔器物件](creating-the-asf-splitter-object.md)。</span><span class="sxs-lookup"><span data-stu-id="bc345-110">For information about initializing the splitter, see [Creating the ASF Splitter Object](creating-the-asf-splitter-object.md).</span></span>

<span data-ttu-id="bc345-111">若要檢查此旗標目前是否已在分隔器上設定，請呼叫 [**IMFASFSplitter：： GetFlags**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-getflags)。</span><span class="sxs-lookup"><span data-stu-id="bc345-111">To check whether this flag is currently set on the splitter, call [**IMFASFSplitter::GetFlags**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-getflags).</span></span>

## <a name="selecting-streams-for-parsing"></a><span data-ttu-id="bc345-112">選取要剖析的資料流程</span><span class="sxs-lookup"><span data-stu-id="bc345-112">Selecting Streams for Parsing</span></span>

<span data-ttu-id="bc345-113">在初始化過程中，透過 [**IMFASFSplitter：： Initialize**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-initialize) 呼叫，分割器會偵測 ASF 檔案中的資料流程數目和資料流程識別碼。</span><span class="sxs-lookup"><span data-stu-id="bc345-113">During the initialization process through [**IMFASFSplitter::Initialize**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-initialize) call, the splitter detects the number of streams and the stream identifiers in the ASF file.</span></span> <span data-ttu-id="bc345-114">依預設，分隔器不會選取任何資料流程。</span><span class="sxs-lookup"><span data-stu-id="bc345-114">By default, no streams are selected by the splitter.</span></span> <span data-ttu-id="bc345-115">應用程式必須藉由呼叫 [**IMFASFSplitter：： SelectStreams**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-selectstreams)來選取資料流程。</span><span class="sxs-lookup"><span data-stu-id="bc345-115">The application must select the streams by calling [**IMFASFSplitter::SelectStreams**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-selectstreams).</span></span> <span data-ttu-id="bc345-116">這個方法會接受資料流程編號的陣列。</span><span class="sxs-lookup"><span data-stu-id="bc345-116">This method takes an array of stream numbers.</span></span> <span data-ttu-id="bc345-117">若要取得資料流程的資料流程號碼，請在 ASF 設定檔上呼叫 [**IMFASFProfile：： GetStream**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfprofile-getstream) ，或在資料流程描述項上呼叫 [**IMFStreamDescriptor：： GetStreamIdentifier**](/windows/desktop/api/mfidl/nf-mfidl-imfstreamdescriptor-getstreamidentifier) 。</span><span class="sxs-lookup"><span data-stu-id="bc345-117">To get the stream number for a stream, call [**IMFASFProfile::GetStream**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfprofile-getstream) on the ASF profile or call [**IMFStreamDescriptor::GetStreamIdentifier**](/windows/desktop/api/mfidl/nf-mfidl-imfstreamdescriptor-getstreamidentifier) on the stream descriptor.</span></span> <span data-ttu-id="bc345-118"> (您可以從 ContentInfo 物件取得 ASF 設定檔和串流描述項。 ) 如果用戶端傳遞的資料流程號碼無法由分隔器辨識，則會因為 **MF \_ E \_ INVALIDSTREAMNUMBER** 錯誤而失敗。</span><span class="sxs-lookup"><span data-stu-id="bc345-118">(You can obtain both the ASF profile and the stream descriptor from the ContentInfo object.) If the client passes a stream number that is not recognized by the splitter, it fails with a **MF\_E\_INVALIDSTREAMNUMBER** error.</span></span>

<span data-ttu-id="bc345-119">呼叫 [**SelectStreams**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-selectstreams) 會清除先前的選取專案。</span><span class="sxs-lookup"><span data-stu-id="bc345-119">Calling [**SelectStreams**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-selectstreams) clears the previous selections.</span></span> <span data-ttu-id="bc345-120">未選取任何未在陣列中指定的資料流程。</span><span class="sxs-lookup"><span data-stu-id="bc345-120">Any stream that is not specified in the array is not selected.</span></span> <span data-ttu-id="bc345-121">若要取得目前選取的資料流程清單，請呼叫 [**IMFASFSplitter：： GetSelectedStreams**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-getselectedstreams)。</span><span class="sxs-lookup"><span data-stu-id="bc345-121">To get a list of streams that are currently selected, call [**IMFASFSplitter::GetSelectedStreams**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-getselectedstreams).</span></span> <span data-ttu-id="bc345-122">這個方法會採用陣列的指標，此方法會以資料流程號碼填滿。</span><span class="sxs-lookup"><span data-stu-id="bc345-122">This method takes a pointer to an array, which the method fills with the stream numbers.</span></span> <span data-ttu-id="bc345-123">如果陣列大小小於所選資料流程的數目，則方法會因 **MF \_ E \_ BUFFERTOOSMALL** 錯誤而失敗。</span><span class="sxs-lookup"><span data-stu-id="bc345-123">If the array size is less than the number of selected streams, the method fails with the **MF\_E\_BUFFERTOOSMALL** error.</span></span> <span data-ttu-id="bc345-124">在此情況下，方法會傳回 *pwNumStreams* 參數中選取的資料流程數目。</span><span class="sxs-lookup"><span data-stu-id="bc345-124">In this case, the method returns the number of selected streams in the *pwNumStreams* parameter.</span></span> <span data-ttu-id="bc345-125">然後，您可以使用此數位來配置正確大小的陣列，並再次呼叫方法。</span><span class="sxs-lookup"><span data-stu-id="bc345-125">You can then use this number to allocate an array of the correct size and call the method again.</span></span>

<span data-ttu-id="bc345-126">如需範例程式碼，請參閱 [教學課程：讀取 ASF](tutorial--reading-an-asf-file.md)檔案中的「選取要剖析的資料流程」。</span><span class="sxs-lookup"><span data-stu-id="bc345-126">For example code, see "Select a Stream for Parsing" in [Tutorial: Reading an ASF File](tutorial--reading-an-asf-file.md).</span></span>

## <a name="reverse-playback-setting"></a><span data-ttu-id="bc345-127">反向播放設定</span><span class="sxs-lookup"><span data-stu-id="bc345-127">Reverse Playback Setting</span></span>

<span data-ttu-id="bc345-128">在分隔器的初始化程式中，它會判斷 ASF 內容是否支援反向播放。</span><span class="sxs-lookup"><span data-stu-id="bc345-128">During the initialization process of the splitter, it determines if the ASF content supports reverse playback.</span></span> <span data-ttu-id="bc345-129">如果有的話，就可以設定 **MFASF \_ 分隔器 \_ 反向** 旗標，將分隔器設定為以反向順序產生樣本。</span><span class="sxs-lookup"><span data-stu-id="bc345-129">If it does, the splitter can be configured to generate samples in reverse order by setting the **MFASF\_SPLITTER\_REVERSE** flag.</span></span> <span data-ttu-id="bc345-130">如果內容不支援反向播放， [**IMFASFSplitter：： SetFlags**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-setflags) 會傳回 **MF \_ E \_ INVALIDREQUEST**，但是會在分隔器上設定旗標。</span><span class="sxs-lookup"><span data-stu-id="bc345-130">If the content does not support reverse playback, the [**IMFASFSplitter::SetFlags**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-setflags) returns **MF\_E\_INVALIDREQUEST**, but the flag is set on the splitter.</span></span>

<span data-ttu-id="bc345-131">如果分隔器已設定為以反向方向進行剖析，則分隔器一律會在包含 ASF 資料物件之緩衝區的結尾處開始剖析。</span><span class="sxs-lookup"><span data-stu-id="bc345-131">If the splitter is configured to parse in the reverse direction, then the splitter always starts parsing at the end of the buffer that contains the ASF Data Object.</span></span> <span data-ttu-id="bc345-132">因此，若要對資料位移進行反向剖析，以及要剖析的資料長度必須適當地設定。</span><span class="sxs-lookup"><span data-stu-id="bc345-132">Therefore, for reverse parsing the data offset and the length of the data to parse must be set appropriately.</span></span> <span data-ttu-id="bc345-133">如需設定正確值的詳細資訊，請參閱 [從現有的 ASF 資料物件產生資料流程範例](generating-stream-samples-from-an-existing-asf-data-object.md)。</span><span class="sxs-lookup"><span data-stu-id="bc345-133">For information about setting the correct values, see [Generating Stream Samples from an Existing ASF Data Object](generating-stream-samples-from-an-existing-asf-data-object.md).</span></span>

## <a name="protected-content-setting"></a><span data-ttu-id="bc345-134">受保護的內容設定</span><span class="sxs-lookup"><span data-stu-id="bc345-134">Protected Content Setting</span></span>

<span data-ttu-id="bc345-135">您可以設定 **MFASF \_ 分隔器 \_ WMDRM** 至 [**IMFASFSplitter：： SetFlags**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-setflags)，將分隔器設定為使用封包層級的加密內容。</span><span class="sxs-lookup"><span data-stu-id="bc345-135">The splitter can be configured to work with packet-level encryption content by setting the **MFASF\_SPLITTER\_WMDRM** through [**IMFASFSplitter::SetFlags**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-setflags).</span></span> <span data-ttu-id="bc345-136">這會指示分隔器提供 Windows Media 數位 Rights Management (DRM) 所保護之內容的範例。</span><span class="sxs-lookup"><span data-stu-id="bc345-136">This instructs the splitter to deliver samples for content that is protected by Windows Media Digital Rights Management (DRM).</span></span> <span data-ttu-id="bc345-137">當設定這個旗標時，分隔器所產生的範例會包含解密媒體資料和重建框架所需的資訊，例如 [**MFSampleExtension \_ PacketCrossOffsets**](mfsampleextension-packetcrossoffsets-attribute.md) 屬性。</span><span class="sxs-lookup"><span data-stu-id="bc345-137">When this flag is set, the samples generated by the splitter contain information required to decrypt media data and reconstruct the frames, such as the [**MFSampleExtension\_PacketCrossOffsets**](mfsampleextension-packetcrossoffsets-attribute.md) attribute.</span></span> <span data-ttu-id="bc345-138">這個屬性是包含 **DWORD** s 陣列的 blob。</span><span class="sxs-lookup"><span data-stu-id="bc345-138">This attribute is a blob that contains an array of **DWORD** s.</span></span> <span data-ttu-id="bc345-139">每個 **DWORD** 都會針對框架提供相對於框架開頭的承載界限。</span><span class="sxs-lookup"><span data-stu-id="bc345-139">Each **DWORD** provides you the payload boundaries for the frame relative to the beginning of the frame.</span></span> <span data-ttu-id="bc345-140">如果這個屬性不存在，則框架會包含在單一承載中。</span><span class="sxs-lookup"><span data-stu-id="bc345-140">If this attribute is not present, the frame is contained in a single payload.</span></span> <span data-ttu-id="bc345-141">一般而言，分隔器所產生的範例包含多個媒體緩衝區，應用程式可以呼叫 [**IMFSample：： ConvertToContiguousBuffer**](/windows/desktop/api/mfobjects/nf-mfobjects-imfsample-converttocontiguousbuffer)，將所有緩衝區複製到一個連續的緩衝區。</span><span class="sxs-lookup"><span data-stu-id="bc345-141">Typically, the samples generated by the splitter contain multiple media buffers, the application can copy all the buffers into one contiguous buffer by calling [**IMFSample::ConvertToContiguousBuffer**](/windows/desktop/api/mfobjects/nf-mfobjects-imfsample-converttocontiguousbuffer).</span></span> <span data-ttu-id="bc345-142">產生的緩衝區包含框架，而屬性值則包含這個緩衝區的位移。</span><span class="sxs-lookup"><span data-stu-id="bc345-142">The resulting buffer contains the frame and the attribute value contains offsets into this buffer.</span></span>

## <a name="related-topics"></a><span data-ttu-id="bc345-143">相關主題</span><span class="sxs-lookup"><span data-stu-id="bc345-143">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="bc345-144">ASF 分隔器</span><span class="sxs-lookup"><span data-stu-id="bc345-144">ASF Splitter</span></span>](asf-splitter.md)
</dt> </dl>

 

 



