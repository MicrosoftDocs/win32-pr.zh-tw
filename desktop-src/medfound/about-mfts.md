---
description: 關於 MFTs
ms.assetid: ca9cef70-b897-4fd5-9a13-8bf1c2b84b00
title: 關於 MFTs
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 09adce4bc93c110cf98e4fd8ed427ffcd009c3c1
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "103848109"
---
# <a name="about-mfts"></a><span data-ttu-id="88293-103">關於 MFTs</span><span class="sxs-lookup"><span data-stu-id="88293-103">About MFTs</span></span>

<span data-ttu-id="88293-104">媒體基礎轉換 (MFTs) 提供用來處理媒體資料的一般模型。</span><span class="sxs-lookup"><span data-stu-id="88293-104">Media Foundation transforms (MFTs) provide a generic model for processing media data.</span></span> <span data-ttu-id="88293-105">MFTs 可用於 (Dsp) 的解碼器、編碼器和數位訊號處理器。</span><span class="sxs-lookup"><span data-stu-id="88293-105">MFTs are used for decoders, encoders, and digital signal processors (DSPs).</span></span> <span data-ttu-id="88293-106">簡而言之，位於媒體來源和媒體接收器之間媒體管線中的任何事物，都是一個 MFT。</span><span class="sxs-lookup"><span data-stu-id="88293-106">In short, anything that sits in the media pipeline between the media source and the media sink is an MFT.</span></span>

<span data-ttu-id="88293-107">針對大部分的應用程式，媒體基礎架構的較高層級會隱藏 MFT 資料處理的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="88293-107">For most applications, the details of MFT data processing are hidden by higher layers of the Media Foundation architecture.</span></span> <span data-ttu-id="88293-108">許多媒體基礎的應用程式永遠不會直接呼叫 MFT。</span><span class="sxs-lookup"><span data-stu-id="88293-108">Many Media Foundation applications will never make a direct call to an MFT.</span></span> <span data-ttu-id="88293-109">不過，您當然可以直接在您的應用程式中裝載 MFT。</span><span class="sxs-lookup"><span data-stu-id="88293-109">However, it is certainly possible to host an MFT directly in your application.</span></span>

<span data-ttu-id="88293-110">MFTs 是第一次使用 DirectX 媒體物件引進的轉換模型演進 (DMOs) 。</span><span class="sxs-lookup"><span data-stu-id="88293-110">MFTs are an evolution of the transform model first introduced with DirectX Media Objects (DMOs).</span></span> <span data-ttu-id="88293-111">事實上，建立支援這兩種模型的轉換相當簡單。</span><span class="sxs-lookup"><span data-stu-id="88293-111">In fact, it is relatively easy to create a transform that supports both models.</span></span> <span data-ttu-id="88293-112">相較于 DMOs，MFTs 的必要行為更清楚地指定，可讓您更輕鬆地撰寫正確的執行。</span><span class="sxs-lookup"><span data-stu-id="88293-112">Compared with DMOs, the required behaviors of MFTs are more clearly specified, which makes it easier to write a correct implementation.</span></span> <span data-ttu-id="88293-113">此外，MFTs 還可支援硬體加速的影片處理。</span><span class="sxs-lookup"><span data-stu-id="88293-113">In addition, MFTs can support hardware-accelerated video processing.</span></span>

<span data-ttu-id="88293-114">本主題簡要說明了 MFT 處理模型，並著重于整體設計，而不是特定的方法呼叫。</span><span class="sxs-lookup"><span data-stu-id="88293-114">This topic gives a brief overview of the MFT processing model, focusing on the overall design rather than specific method calls.</span></span> <span data-ttu-id="88293-115">如需更詳細的逐步說明，請參閱 [基本的 MFT 處理模型](basic-mft-processing-model.md)。</span><span class="sxs-lookup"><span data-stu-id="88293-115">For a more detailed, step-by-step description, see [Basic MFT Processing Model](basic-mft-processing-model.md).</span></span>

## <a name="streams"></a><span data-ttu-id="88293-116">串流</span><span class="sxs-lookup"><span data-stu-id="88293-116">Streams</span></span>

<span data-ttu-id="88293-117">MFT 具有輸入資料流程和輸出資料流程。</span><span class="sxs-lookup"><span data-stu-id="88293-117">An MFT has input streams and output streams.</span></span> <span data-ttu-id="88293-118">輸入資料流程會接收資料，而且輸出資料流程會產生資料。</span><span class="sxs-lookup"><span data-stu-id="88293-118">Input streams receive data, and output streams produce data.</span></span> <span data-ttu-id="88293-119">例如，一個資料流程有一個輸入資料流程，它會接收編碼的資料，另一個輸出資料流程會產生已解碼的資料。</span><span class="sxs-lookup"><span data-stu-id="88293-119">For example, a decoder has one input stream, which receives the encoded data, and one output stream, which produces the decoded data.</span></span>

<span data-ttu-id="88293-120">在 MFT 上的資料流程不會以相異的 COM 物件表示。</span><span class="sxs-lookup"><span data-stu-id="88293-120">The streams on an MFT are not represented as distinct COM objects.</span></span> <span data-ttu-id="88293-121">相反地，每個資料流程都有指定的資料流程識別碼，而 [**IMFTransform**](/windows/desktop/api/mftransform/nn-mftransform-imftransform) 介面中的方法會將串流識別碼作為輸入參數。</span><span class="sxs-lookup"><span data-stu-id="88293-121">Instead, each stream has a designated stream identifier, and the methods in the [**IMFTransform**](/windows/desktop/api/mftransform/nn-mftransform-imftransform) interface take stream identifiers as input parameters.</span></span>

<span data-ttu-id="88293-122">某些 MFTs 具有固定的資料流程數目。</span><span class="sxs-lookup"><span data-stu-id="88293-122">Some MFTs have a fixed number of streams.</span></span> <span data-ttu-id="88293-123">例如，解碼器和編碼器通常只會有一個輸入和一個輸出。</span><span class="sxs-lookup"><span data-stu-id="88293-123">For example, decoders and encoders normally have exactly one input and one output.</span></span> <span data-ttu-id="88293-124">其他 MFTs 有動態的資料流程數目。</span><span class="sxs-lookup"><span data-stu-id="88293-124">Other MFTs have a dynamic number of streams.</span></span> <span data-ttu-id="88293-125">如果 MFT 支援動態資料流，用戶端可以新增輸入資料流程。</span><span class="sxs-lookup"><span data-stu-id="88293-125">If an MFT supports dynamic streams, the client can add new input streams.</span></span> <span data-ttu-id="88293-126">用戶端無法新增輸出資料流程，但 MFT 可能會在處理期間新增或移除輸出資料流程。</span><span class="sxs-lookup"><span data-stu-id="88293-126">The client cannot add output streams, but the MFT might add or remove output streams during processing.</span></span> <span data-ttu-id="88293-127">例如，multiplexers 通常可讓用戶端新增輸入資料流程，並有多個多工資料流程的輸出。</span><span class="sxs-lookup"><span data-stu-id="88293-127">For example, multiplexers typically allow the client to add input streams and have one output for the multiplexed stream.</span></span> <span data-ttu-id="88293-128">根據輸入資料流程的內容而定，Demultiplexers 是反向的，具有一個輸入，但是輸出資料流程的動態數目。</span><span class="sxs-lookup"><span data-stu-id="88293-128">Demultiplexers are the reverse, with one input but a dynamic number of output streams, depending on the contents of the input stream.</span></span> <span data-ttu-id="88293-129">下圖顯示多工器與信號信號之間的差異。</span><span class="sxs-lookup"><span data-stu-id="88293-129">The following illustration shows the difference between multiplexer and demultiplexer.</span></span>

![此圖顯示編碼器/解碼器 (1 個輸入、1個輸出) 、多工器 (2 個輸入、1個輸出) ，以及一個信號 (1 個輸入、2個輸出) ](images/f2b95bd5-f862-4d66-9d75-550a90f6cc97.gif)

## <a name="media-types"></a><span data-ttu-id="88293-131">媒體類型</span><span class="sxs-lookup"><span data-stu-id="88293-131">Media Types</span></span>

<span data-ttu-id="88293-132">第一次建立 MFT 時，沒有任何資料流程具有已建立的格式。</span><span class="sxs-lookup"><span data-stu-id="88293-132">When an MFT is first created, none of the streams has an established format.</span></span> <span data-ttu-id="88293-133">在 MFT 可以處理資料之前，用戶端必須設定資料流程的格式。</span><span class="sxs-lookup"><span data-stu-id="88293-133">Before the MFT can process data, the client must set the formats for the streams.</span></span> <span data-ttu-id="88293-134">例如，使用解碼器時，輸入格式為原始原始程式檔中使用的壓縮格式，而輸出格式為未壓縮的格式，例如 PCM 音訊或 RGB 影片。</span><span class="sxs-lookup"><span data-stu-id="88293-134">For example, with a decoder, the input format is the compression format used in the original source file, and the output format is an uncompressed format, such as PCM audio or RGB video.</span></span> <span data-ttu-id="88293-135">串流格式會使用 [媒體類型](media-types.md)來描述。</span><span class="sxs-lookup"><span data-stu-id="88293-135">The stream formats are described using [Media Types](media-types.md).</span></span>

<span data-ttu-id="88293-136">根據 MFT 的內部狀態，它可能會提供每個串流可能的媒體類型清單。</span><span class="sxs-lookup"><span data-stu-id="88293-136">Depending on the internal state of the MFT, it might provide a list of possible media types for each stream.</span></span> <span data-ttu-id="88293-137">當您設定媒體類型時，可以使用此清單做為提示。</span><span class="sxs-lookup"><span data-stu-id="88293-137">You can use this list as a hint when you set the media types.</span></span> <span data-ttu-id="88293-138">設定某個資料流程的媒體類型可以變更另一個資料流程可能類型的清單。</span><span class="sxs-lookup"><span data-stu-id="88293-138">Setting the media type on one stream can change the list of possible types for a another stream.</span></span> <span data-ttu-id="88293-139">例如，在用戶端設定輸入類型之前，解碼器通常無法提供任何輸出類型。</span><span class="sxs-lookup"><span data-stu-id="88293-139">For example, a decoder typically cannot provide any output types until the client sets the input type.</span></span> <span data-ttu-id="88293-140">輸入型別包含的資訊，是因為解碼器需要傳回可能的輸出類型清單。</span><span class="sxs-lookup"><span data-stu-id="88293-140">The input type contains the information that the decoder needs to return a list of possible output types.</span></span>

<span data-ttu-id="88293-141">若要設定資料流程上的媒體類型，請呼叫 [**IMFTransform：： SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) 或 [**IMFTransform：： SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype)。</span><span class="sxs-lookup"><span data-stu-id="88293-141">To set the media type on a stream, call [**IMFTransform::SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) or [**IMFTransform::SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype).</span></span> <span data-ttu-id="88293-142">若要取得資料流程可能媒體類型的清單，請呼叫 [**IMFTransform：： GetInputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) 或 [**IMFTransform：： GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype)。</span><span class="sxs-lookup"><span data-stu-id="88293-142">To get the list of possible media types for a stream, call [**IMFTransform::GetInputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) or [**IMFTransform::GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype).</span></span>

## <a name="processing-data"></a><span data-ttu-id="88293-143">處理資料</span><span class="sxs-lookup"><span data-stu-id="88293-143">Processing Data</span></span>

<span data-ttu-id="88293-144">在用戶端設定資料流程的媒體類型之後，即已準備好處理資料。</span><span class="sxs-lookup"><span data-stu-id="88293-144">After the client sets the media types on the streams, the MFT is ready to process data.</span></span> <span data-ttu-id="88293-145">為了進行這項操作，用戶端會在提供輸入資料到 MFT 之間進行替代，並從 MFT 取得輸出資料：</span><span class="sxs-lookup"><span data-stu-id="88293-145">To make this happen, the client alternates between providing input data to the MFT and getting output data from the MFT:</span></span>

-   <span data-ttu-id="88293-146">若要將輸入資料提供給 MFT，請呼叫 [**IMFTransform：:P rocessinput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput)。</span><span class="sxs-lookup"><span data-stu-id="88293-146">To give input data to the MFT, call [**IMFTransform::ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span></span>
-   <span data-ttu-id="88293-147">若要從 MFT 提取輸出資料，請呼叫 [**IMFTransform：:P rocessoutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput)。</span><span class="sxs-lookup"><span data-stu-id="88293-147">To pull output data from the MFT, call [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span>

<span data-ttu-id="88293-148">[**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput)方法會使用用戶端所配置之媒體範例的指標。</span><span class="sxs-lookup"><span data-stu-id="88293-148">The [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) method takes a pointer to a media sample allocated by the client.</span></span> <span data-ttu-id="88293-149">媒體範例包含一或多個緩衝區，而且每個緩衝區都包含要處理之 MFT 的輸入資料。</span><span class="sxs-lookup"><span data-stu-id="88293-149">The media sample contains one or more buffers, and each buffer contains input data for the MFT to process.</span></span>

<span data-ttu-id="88293-150">[**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput)方法支援兩種不同的配置模型： MFT 配置輸出緩衝區或用戶端配置輸出緩衝區。</span><span class="sxs-lookup"><span data-stu-id="88293-150">The [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) method supports two different allocation models: Either the MFT allocates the output buffers, or the client allocates the output buffers.</span></span> <span data-ttu-id="88293-151">部分 MFTs 支援這兩種配置模型，但不需要同時支援這兩種配置模型。</span><span class="sxs-lookup"><span data-stu-id="88293-151">Some MFTs support both allocation models, but it is not required for an MFT to support both.</span></span> <span data-ttu-id="88293-152">例如，某個 MFT 可能需要用戶端配置輸出緩衝區。</span><span class="sxs-lookup"><span data-stu-id="88293-152">For example, an MFT might require the client to allocate the output buffers.</span></span> <span data-ttu-id="88293-153">[**IMFTransform：： GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo)方法會傳回輸出資料流程的相關資訊，包括由 MFT 支援的配置模型。</span><span class="sxs-lookup"><span data-stu-id="88293-153">The [**IMFTransform::GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) method returns information about an output stream, including which allocation model the MFT supports.</span></span>

<span data-ttu-id="88293-154">MFTs 的設計目的是盡可能緩衝最少的資料，以便將管線中的延遲降至最低。</span><span class="sxs-lookup"><span data-stu-id="88293-154">MFTs are designed to buffer as little data as possible, in order to minimize latency in the pipeline.</span></span> <span data-ttu-id="88293-155">因此，在任何指定的時間，MFT 都可以發出下列其中一個條件：</span><span class="sxs-lookup"><span data-stu-id="88293-155">Therefore, at any given time, the MFT can signal one of the following conditions:</span></span>

-   <span data-ttu-id="88293-156">此 MFT 需要更多輸入資料。</span><span class="sxs-lookup"><span data-stu-id="88293-156">The MFT requires more input data.</span></span> <span data-ttu-id="88293-157">在此狀態下，除非用戶端至少呼叫 [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) 一次，否則 MFT 無法產生輸出。</span><span class="sxs-lookup"><span data-stu-id="88293-157">In this state, the MFT cannot produce output until the client calls [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) at least once.</span></span>
-   <span data-ttu-id="88293-158">除非用戶端至少呼叫 [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) 一次，否則 MFT 不會接受任何其他輸入。</span><span class="sxs-lookup"><span data-stu-id="88293-158">The MFT will not accept any more input until the client calls [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) at least once.</span></span>

<span data-ttu-id="88293-159">例如，假設您使用的是影片解碼來解碼包含混合的主要畫面格和差異框架的影片串流。</span><span class="sxs-lookup"><span data-stu-id="88293-159">For example, suppose that you are using a video decoder to decode a video stream that contains a mix of key frames and delta frames.</span></span> <span data-ttu-id="88293-160">一開始，此 MFT 需要一些輸入，才能解碼任何框架。</span><span class="sxs-lookup"><span data-stu-id="88293-160">Initially, the MFT requires some input before it can decode any frames.</span></span> <span data-ttu-id="88293-161">用戶端會呼叫 [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) 來傳遞第一個畫面格。</span><span class="sxs-lookup"><span data-stu-id="88293-161">The client calls [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) to deliver the first frame.</span></span> <span data-ttu-id="88293-162">假設第一個框架是 delta 框架 (在下圖中顯示為預測框架) 的 ' P '。</span><span class="sxs-lookup"><span data-stu-id="88293-162">Suppose that the first frame is a delta frame (shown in the following diagram as 'P' for predicted frame).</span></span> <span data-ttu-id="88293-163">此解碼器會保存在此框架上，但在取得下一個主要畫面格之前，它無法產生任何輸出。</span><span class="sxs-lookup"><span data-stu-id="88293-163">The decoder holds onto this frame, but it cannot produce any output until it gets the next key frame.</span></span>

![此圖顯示需要輸入的 mft，指向預測的框架](images/f5a88ac6-24da-40e5-b356-649aa6f811c3.gif)

<span data-ttu-id="88293-165">用戶端會繼續呼叫 [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) ，最後會到達下圖中顯示的下一個主要畫面格 (下圖中顯示為程式碼內框架) 的 ' I '。</span><span class="sxs-lookup"><span data-stu-id="88293-165">The client continues to call [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) and eventually reaches the next key frame (shown in the next diagram as 'I' for intra-coded frame).</span></span> <span data-ttu-id="88293-166">現在，此解碼器有足夠的畫面格開始解碼。</span><span class="sxs-lookup"><span data-stu-id="88293-166">Now the decoder has enough frames to start decoding.</span></span> <span data-ttu-id="88293-167">此時它會停止接受輸入，而且用戶端必須呼叫 [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) 來取得已解碼的畫面格。</span><span class="sxs-lookup"><span data-stu-id="88293-167">At this point it stops accepting input, and the client must call [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) to get the decoded frames.</span></span>

![此圖顯示不接受輸入的 mft，指向一個程式碼內框架和三個預測的框架](images/ae014a1a-9d03-4cfa-a04d-4a63bdc83f73.gif)

<span data-ttu-id="88293-169">用戶端最簡單的方法就是直接呼叫 [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) 和 [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput)。</span><span class="sxs-lookup"><span data-stu-id="88293-169">The simplest approach for the client is simply to alternate calls to [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) and [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span> <span data-ttu-id="88293-170">「 [基本 MFT 處理模型](basic-mft-processing-model.md)」主題會說明更複雜的演算法。</span><span class="sxs-lookup"><span data-stu-id="88293-170">A more sophisticated algorithm is described in the topic [Basic MFT Processing Model](basic-mft-processing-model.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="88293-171">相關主題</span><span class="sxs-lookup"><span data-stu-id="88293-171">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="88293-172">媒體基礎轉換</span><span class="sxs-lookup"><span data-stu-id="88293-172">Media Foundation Transforms</span></span>](media-foundation-transforms.md)
</dt> </dl>

 

 



