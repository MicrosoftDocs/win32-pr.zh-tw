---
description: 簡報時鐘
ms.assetid: cb8bb62a-ef80-4de0-9a44-3bb77edc9dd5
title: 簡報時鐘
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5f61ad02537a2591c681db78721376651f7854ec
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104114373"
---
# <a name="presentation-clock"></a><span data-ttu-id="731a7-103">簡報時鐘</span><span class="sxs-lookup"><span data-stu-id="731a7-103">Presentation Clock</span></span>

<span data-ttu-id="731a7-104">*簡報時鐘* 是一個物件，它會產生簡報的時鐘時間。</span><span class="sxs-lookup"><span data-stu-id="731a7-104">The *presentation clock* is an object that generates the clock time for a presentation.</span></span> <span data-ttu-id="731a7-105">標記法所報告的時間稱為 *呈現時間*。</span><span class="sxs-lookup"><span data-stu-id="731a7-105">The time reported by the presentation clock is called the *presentation time*.</span></span> <span data-ttu-id="731a7-106">簡報中的所有資料流程都會與展示時間同步處理。</span><span class="sxs-lookup"><span data-stu-id="731a7-106">All streams in a presentation are synchronized to the presentation time.</span></span> <span data-ttu-id="731a7-107">簡報時鐘會公開下列介面。</span><span class="sxs-lookup"><span data-stu-id="731a7-107">The presentation clock exposes the following interfaces.</span></span>



| <span data-ttu-id="731a7-108">介面</span><span class="sxs-lookup"><span data-stu-id="731a7-108">Interface</span></span>                                            | <span data-ttu-id="731a7-109">描述</span><span class="sxs-lookup"><span data-stu-id="731a7-109">Description</span></span>                                         |
|------------------------------------------------------|-----------------------------------------------------|
| [<span data-ttu-id="731a7-110">**IMFPresentationClock**</span><span class="sxs-lookup"><span data-stu-id="731a7-110">**IMFPresentationClock**</span></span>](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationclock) | <span data-ttu-id="731a7-111">使用呈現時鐘的主要介面。</span><span class="sxs-lookup"><span data-stu-id="731a7-111">Primary interface for using the presentation clock.</span></span> |
| [<span data-ttu-id="731a7-112">**IMFRateControl**</span><span class="sxs-lookup"><span data-stu-id="731a7-112">**IMFRateControl**</span></span>](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol)             | <span data-ttu-id="731a7-113">控制時脈速率。</span><span class="sxs-lookup"><span data-stu-id="731a7-113">Controls the clock rate.</span></span>                            |
| [<span data-ttu-id="731a7-114">**IMFTimer**</span><span class="sxs-lookup"><span data-stu-id="731a7-114">**IMFTimer**</span></span>](/windows/desktop/api/mfidl/nn-mfidl-imftimer)                         | <span data-ttu-id="731a7-115">提供計時器回呼。</span><span class="sxs-lookup"><span data-stu-id="731a7-115">Provides a timer callback.</span></span>                          |
| [<span data-ttu-id="731a7-116">**IMFShutdown**</span><span class="sxs-lookup"><span data-stu-id="731a7-116">**IMFShutdown**</span></span>](/windows/desktop/api/mfidl/nn-mfidl-imfshutdown)                   | <span data-ttu-id="731a7-117">關閉呈現時鐘。</span><span class="sxs-lookup"><span data-stu-id="731a7-117">Shuts down the presentation clock.</span></span>                  |



 

<span data-ttu-id="731a7-118">媒體接收器會使用呈現時間來排程轉譯樣本的時機。</span><span class="sxs-lookup"><span data-stu-id="731a7-118">Media sinks use the presentation time to schedule when to render samples.</span></span> <span data-ttu-id="731a7-119">每當媒體接收器收到新的範例時，它會從範例取得時間戳記，並在指定的時間轉譯樣本，或盡可能接近該時間。</span><span class="sxs-lookup"><span data-stu-id="731a7-119">Whenever a media sink receives a new sample, it gets the time stamp from the sample and renders the sample at the indicated time, or as close to that time as possible.</span></span> <span data-ttu-id="731a7-120">由於拓撲中的所有媒體接收器都會共用相同的呈現時鐘，因此會同步處理多個串流 (例如音訊和影片) 。</span><span class="sxs-lookup"><span data-stu-id="731a7-120">Because all of the media sinks in a topology share the same presentation clock, multiple streams (such as audio and video) are synchronized.</span></span> <span data-ttu-id="731a7-121">媒體來源和轉換不會使用簡報時鐘，因為它們不會排定何時提供範例。</span><span class="sxs-lookup"><span data-stu-id="731a7-121">Media sources and transforms do not use the presentation clock, because they do not schedule when to deliver samples.</span></span> <span data-ttu-id="731a7-122">相反地，當管線要求新的範例時，它們會產生範例。</span><span class="sxs-lookup"><span data-stu-id="731a7-122">Instead, they produce samples whenever the pipeline requests a new sample.</span></span>

<span data-ttu-id="731a7-123">如果您使用媒體會話來播放，媒體會話會處理建立簡報時鐘、選取時間來源，以及通知媒體接收器的所有詳細資料。</span><span class="sxs-lookup"><span data-stu-id="731a7-123">If you are using the Media Session for playback, the Media Session handles all of the details of creating the presentation clock, selecting a time source, and notifying the media sinks.</span></span> <span data-ttu-id="731a7-124">您的應用程式可能會使用簡報時鐘來取得播放期間目前的呈現時間，否則不會對簡報時鐘呼叫任何方法。</span><span class="sxs-lookup"><span data-stu-id="731a7-124">Your application might use the presentation clock to get the current presentation time during playback, but otherwise will not call any methods on the presentation clock.</span></span>

## <a name="clock-time-and-clock-states"></a><span data-ttu-id="731a7-125">時鐘時間和時鐘狀態</span><span class="sxs-lookup"><span data-stu-id="731a7-125">Clock Time and Clock States</span></span>

<span data-ttu-id="731a7-126">若要從呈現時鐘取得最新的時鐘時間，請呼叫 [**IMFPresentationClock：： GetTime**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-gettime)。</span><span class="sxs-lookup"><span data-stu-id="731a7-126">To get the latest clock time from the presentation clock, call [**IMFPresentationClock::GetTime**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-gettime).</span></span> <span data-ttu-id="731a7-127">時鐘時間一律為 100-毫微秒的單位，因此一秒為 10000000 (10 ^ 7) 刻度。</span><span class="sxs-lookup"><span data-stu-id="731a7-127">Clock times are always in 100-nanosecond units, so one second is 10,000,000 (10^7) ticks.</span></span> <span data-ttu-id="731a7-128">這會對應至 10 MHz 的頻率。</span><span class="sxs-lookup"><span data-stu-id="731a7-128">This corresponds to a frequency of 10 MHz.</span></span>

<span data-ttu-id="731a7-129">簡報時鐘有三種狀態： [執行中]、[已暫停] 和 [已停止]。</span><span class="sxs-lookup"><span data-stu-id="731a7-129">The presentation clock has three states: Running, paused, and stopped.</span></span>

-   <span data-ttu-id="731a7-130">若要執行時鐘，請呼叫 [**IMFPresentationClock：： Start**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-start)。</span><span class="sxs-lookup"><span data-stu-id="731a7-130">To run the clock, call [**IMFPresentationClock::Start**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-start).</span></span> <span data-ttu-id="731a7-131">**Start** 方法會指定時鐘的開始時間。</span><span class="sxs-lookup"><span data-stu-id="731a7-131">The **Start** method specifies the clock's starting time.</span></span> <span data-ttu-id="731a7-132">當時鐘正在執行時，時鐘時間會以目前的時脈速率從開始時間遞增。</span><span class="sxs-lookup"><span data-stu-id="731a7-132">While the clock is running, the clock time increments from the starting time, at the current clock rate.</span></span>
-   <span data-ttu-id="731a7-133">若要暫停時鐘，請呼叫 [**IMFPresentationClock：:P ause**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-pause)。</span><span class="sxs-lookup"><span data-stu-id="731a7-133">To pause the clock, call [**IMFPresentationClock::Pause**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-pause).</span></span> <span data-ttu-id="731a7-134">當時鐘暫停時，不會前進時鐘時間，而 [**GetTime**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-gettime) 會傳回時鐘暫停的時間。</span><span class="sxs-lookup"><span data-stu-id="731a7-134">While the clock is paused, the clock time does not advance, and [**GetTime**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-gettime) returns the time at which the clock was paused.</span></span>
-   <span data-ttu-id="731a7-135">若要停止時鐘，請呼叫 [**IMFPresentationClock：： stop**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-stop)。</span><span class="sxs-lookup"><span data-stu-id="731a7-135">To stop the clock, call [**IMFPresentationClock::Stop**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-stop).</span></span> <span data-ttu-id="731a7-136">當時鐘停止時，時鐘時間不會前進， [**GetTime**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-gettime) 會傳回零。</span><span class="sxs-lookup"><span data-stu-id="731a7-136">When the clock is stopped, the clock time does not advance, and [**GetTime**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-gettime) returns zero.</span></span>

<span data-ttu-id="731a7-137">根據預設，時鐘會以1.0 的速率前進，這表示每100納秒1次滴答。</span><span class="sxs-lookup"><span data-stu-id="731a7-137">By default, the clock advances at a rate of 1.0, meaning 1 tick per 100 nanoseconds.</span></span> <span data-ttu-id="731a7-138">若要變更時鐘前進的速率，請查詢 [**IMFRateControl**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol) 介面的呈現時鐘，然後呼叫 [**IMFRateControl：： SetRate**](/windows/desktop/api/mfidl/nf-mfidl-imfratecontrol-setrate)。</span><span class="sxs-lookup"><span data-stu-id="731a7-138">To change the rate at which the clock advances, query the presentation clock for the [**IMFRateControl**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol) interface and call [**IMFRateControl::SetRate**](/windows/desktop/api/mfidl/nf-mfidl-imfratecontrol-setrate).</span></span>

<span data-ttu-id="731a7-139">物件可以接收狀態變更的通知， (包括呈現時鐘) 的速率變更。</span><span class="sxs-lookup"><span data-stu-id="731a7-139">Objects can receive notifications of state changes (including rate changes) from the presentation clock.</span></span> <span data-ttu-id="731a7-140">若要接收通知，請執行 [**IMFClockStateSink**](/windows/desktop/api/mfidl/nn-mfidl-imfclockstatesink) 介面，並在簡報時鐘上呼叫 [**IMFPresentationClock：： AddClockStateSink**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-addclockstatesink) 。</span><span class="sxs-lookup"><span data-stu-id="731a7-140">To receive notifications, implement the [**IMFClockStateSink**](/windows/desktop/api/mfidl/nn-mfidl-imfclockstatesink) interface and call [**IMFPresentationClock::AddClockStateSink**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-addclockstatesink) on the presentation clock.</span></span> <span data-ttu-id="731a7-141">在關機之前，請呼叫 [**IMFPresentationClock：： RemoveClockStateSink**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-removeclockstatesink) 來取消註冊物件。</span><span class="sxs-lookup"><span data-stu-id="731a7-141">Before shutting down, call [**IMFPresentationClock::RemoveClockStateSink**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-removeclockstatesink) to unregister the object.</span></span> <span data-ttu-id="731a7-142">媒體接收器會使用此機制來接收來自時鐘的通知。</span><span class="sxs-lookup"><span data-stu-id="731a7-142">Media sinks use this mechanism to receive notifications from the clock.</span></span>

## <a name="presentation-times"></a><span data-ttu-id="731a7-143">展示時間</span><span class="sxs-lookup"><span data-stu-id="731a7-143">Presentation Times</span></span>

<span data-ttu-id="731a7-144">媒體接收器會嘗試排程每個範例，以便在正確的時間轉譯範例，或盡可能接近正確的時間。</span><span class="sxs-lookup"><span data-stu-id="731a7-144">A media sink tries to schedule each sample so that the sample is rendered at the correct time, or as close to the correct time as possible.</span></span> <span data-ttu-id="731a7-145">下列定義適用：</span><span class="sxs-lookup"><span data-stu-id="731a7-145">The following definitions apply:</span></span>

-   <span data-ttu-id="731a7-146">*簡報時間。*</span><span class="sxs-lookup"><span data-stu-id="731a7-146">*Presentation time.*</span></span> <span data-ttu-id="731a7-147">應呈現樣本的時間。</span><span class="sxs-lookup"><span data-stu-id="731a7-147">The time when a sample should be rendered.</span></span> <span data-ttu-id="731a7-148">時間是以100毫微秒為單位來提供。</span><span class="sxs-lookup"><span data-stu-id="731a7-148">Time is given in units of 100 nanoseconds.</span></span>
-   <span data-ttu-id="731a7-149">*媒體時間。*</span><span class="sxs-lookup"><span data-stu-id="731a7-149">*Media time.*</span></span> <span data-ttu-id="731a7-150">相對於開始內容的時間。</span><span class="sxs-lookup"><span data-stu-id="731a7-150">Time relative to the start of the content.</span></span> <span data-ttu-id="731a7-151">例如，如果影片檔案的長度為10秒，則整個檔案的點半形會有5秒的媒體時間。</span><span class="sxs-lookup"><span data-stu-id="731a7-151">For example, if a video file is 10 seconds long, the point half way through the file has a media time of 5 seconds.</span></span>
-   <span data-ttu-id="731a7-152">*時間戳記。*</span><span class="sxs-lookup"><span data-stu-id="731a7-152">*Time stamp.*</span></span> <span data-ttu-id="731a7-153">媒體範例上標記的時間。</span><span class="sxs-lookup"><span data-stu-id="731a7-153">The time marked on a media sample.</span></span> <span data-ttu-id="731a7-154">若要取得時間戳記，請呼叫 [**IMFSample：： GetSampleTime**](/windows/desktop/api/mfobjects/nf-mfobjects-imfsample-getsampletime)。</span><span class="sxs-lookup"><span data-stu-id="731a7-154">To get the time stamp, call [**IMFSample::GetSampleTime**](/windows/desktop/api/mfobjects/nf-mfobjects-imfsample-getsampletime).</span></span> <span data-ttu-id="731a7-155">當媒體來源產生範例時，它會設定等於媒體時間的時間戳記。</span><span class="sxs-lookup"><span data-stu-id="731a7-155">When a media source produces a sample, it sets the time stamp equal to the media time.</span></span> <span data-ttu-id="731a7-156">媒體會話會將時間戳記轉譯為呈現時間。</span><span class="sxs-lookup"><span data-stu-id="731a7-156">The Media Session translates the time stamp into presentation time.</span></span>

<span data-ttu-id="731a7-157">依預設，媒體時間和表示時間都相同; 例如，如果影片框架在原始程式檔中出現5秒，則媒體時間和呈現時間都是5秒。</span><span class="sxs-lookup"><span data-stu-id="731a7-157">By default, media time and presentation time are the same, For example, if a video frame appears 5 seconds into the source file, the media time and the presentation time are both 5 seconds.</span></span> <span data-ttu-id="731a7-158">如果您使用 [Sequencer 來源](sequencer-source.md)，計時模型會稍微複雜一點，以在區段之間啟用平滑轉換。</span><span class="sxs-lookup"><span data-stu-id="731a7-158">If you are using the [Sequencer Source](sequencer-source.md), the timing model is somewhat more complicated, to enable smooth transitions between segments.</span></span> <span data-ttu-id="731a7-159">如需有關 sequencer 來源時間模型的詳細資訊，請參閱 [順序呈現時間](sequence-presentation-times.md)。</span><span class="sxs-lookup"><span data-stu-id="731a7-159">For more information about the sequencer source's timing model, see [Sequence Presentation Times](sequence-presentation-times.md).</span></span>

<span data-ttu-id="731a7-160">媒體來源一律會設定等於媒體時間的時間戳記。</span><span class="sxs-lookup"><span data-stu-id="731a7-160">The media source always sets the time stamp equal to the media time.</span></span> <span data-ttu-id="731a7-161">如果簡報時間與媒體時間不一致，則媒體會話會轉換媒體範例上的時間戳記。</span><span class="sxs-lookup"><span data-stu-id="731a7-161">If presentation time is not aligned with media time, the Media Session converts the time stamps on the media samples.</span></span> <span data-ttu-id="731a7-162">接收到範例時，範例的時間戳記已轉換為展示時間。</span><span class="sxs-lookup"><span data-stu-id="731a7-162">By the time the sink receives a sample, the sample's time stamp has been converted to presentation time.</span></span> <span data-ttu-id="731a7-163">接收會根據簡報時鐘的目前時間來排定範例。</span><span class="sxs-lookup"><span data-stu-id="731a7-163">The sink schedules the sample against the presentation clock's current time.</span></span> <span data-ttu-id="731a7-164"> (Rateless 接收是例外狀況，因為它們會忽略呈現時鐘。 ) </span><span class="sxs-lookup"><span data-stu-id="731a7-164">(Rateless sinks are an exception, because they ignore the presentation clock.)</span></span>

<span data-ttu-id="731a7-165">如果應用程式搜尋到新位置，媒體會話就會在指定的搜尋時間重新開機表示時鐘。</span><span class="sxs-lookup"><span data-stu-id="731a7-165">If the application seeks to a new position, the Media Session restarts the presentation clock at the specified seek time.</span></span> <span data-ttu-id="731a7-166">例如，如果應用程式搜尋檔案中的5秒位置，媒體會話就會在5秒內啟動時鐘。</span><span class="sxs-lookup"><span data-stu-id="731a7-166">For example, if the application seeks to the 5-second position in the file, the Media Session starts the clock at 5 seconds.</span></span> <span data-ttu-id="731a7-167">如果搜尋時間不是落在主要畫面格界限上，媒體來源可能會以稍早的時間戳記來傳遞範例。</span><span class="sxs-lookup"><span data-stu-id="731a7-167">The media source might deliver samples with a slightly earlier time stamp if the seek time does not fall on a key-frame boundary.</span></span> <span data-ttu-id="731a7-168">這是必要的，如此一來，這些解碼器才能將所有框架解碼。</span><span class="sxs-lookup"><span data-stu-id="731a7-168">This is required so that the decoders can decode all of the frames.</span></span> <span data-ttu-id="731a7-169">媒體會話會在達到媒體接收器之前卸載或修剪範例，以便符合要求的搜尋時間。</span><span class="sxs-lookup"><span data-stu-id="731a7-169">The Media Session drops or trims samples before they reach the media sinks, in order to match the requested seek time.</span></span> <span data-ttu-id="731a7-170">例如，如果搜尋時間為5秒，則第一個音訊樣本可能會在4.5 秒內啟動。</span><span class="sxs-lookup"><span data-stu-id="731a7-170">For example, if the seek time is 5 seconds, the first audio sample might start at 4.5 seconds.</span></span> <span data-ttu-id="731a7-171">媒體會話將會從第一個解碼的音訊範例修剪前0.5 秒。</span><span class="sxs-lookup"><span data-stu-id="731a7-171">The Media Session will trim the first 0.5 seconds from the first decoded audio sample.</span></span>

## <a name="creating-the-presentation-clock"></a><span data-ttu-id="731a7-172">建立簡報時鐘</span><span class="sxs-lookup"><span data-stu-id="731a7-172">Creating the Presentation Clock</span></span>

<span data-ttu-id="731a7-173">若要建立簡報時鐘，請呼叫 [**MFCreatePresentationClock**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepresentationclock)。</span><span class="sxs-lookup"><span data-stu-id="731a7-173">To create the presentation clock, call [**MFCreatePresentationClock**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepresentationclock).</span></span> <span data-ttu-id="731a7-174">若要關閉時鐘，請查詢 [**IMFShutdown**](/windows/desktop/api/mfidl/nn-mfidl-imfshutdown) 介面，然後呼叫 [**IMFShutdown：： Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfshutdown-shutdown)。</span><span class="sxs-lookup"><span data-stu-id="731a7-174">To shut down the clock, query for the [**IMFShutdown**](/windows/desktop/api/mfidl/nn-mfidl-imfshutdown) interface and call [**IMFShutdown::Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfshutdown-shutdown).</span></span> <span data-ttu-id="731a7-175">**MFCreatePresentationClock** 的呼叫端負責呼叫 **Shutdown**;在大部分的情況下，這是媒體會話，而不是應用程式。</span><span class="sxs-lookup"><span data-stu-id="731a7-175">The caller of **MFCreatePresentationClock** is responsible for calling **Shutdown**; in most cases, this is the Media Session rather than the application.</span></span>

## <a name="presentation-time-sources"></a><span data-ttu-id="731a7-176">展示時間來源</span><span class="sxs-lookup"><span data-stu-id="731a7-176">Presentation Time Sources</span></span>

<span data-ttu-id="731a7-177">無論其名稱為何，簡報時鐘其實不會實際執行時鐘。</span><span class="sxs-lookup"><span data-stu-id="731a7-177">Despite its name, the presentation clock does not actually implement a clock.</span></span> <span data-ttu-id="731a7-178">相反地，它會從另一個物件（稱為 *展示時間來源*）取得時鐘時間。</span><span class="sxs-lookup"><span data-stu-id="731a7-178">Instead, it gets the clock times from another object, called a *presentation time source*.</span></span> <span data-ttu-id="731a7-179">時間來源可以是任何會產生正確時鐘刻度的物件，並公開 [**IMFPresentationTimeSource**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource) 介面。</span><span class="sxs-lookup"><span data-stu-id="731a7-179">The time source can be any object that generates accurate clock ticks and exposes the [**IMFPresentationTimeSource**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource) interface.</span></span> <span data-ttu-id="731a7-180">下圖顯示這項程序。</span><span class="sxs-lookup"><span data-stu-id="731a7-180">The following illustration shows this process.</span></span>

![顯示呈現時鐘與展示時間來源之間關聯性的圖表](images/dedc255c-eb6d-49fc-8892-7b6076ed4488.gif)

<span data-ttu-id="731a7-182">首次建立簡報時鐘時，不會有時間來源。</span><span class="sxs-lookup"><span data-stu-id="731a7-182">When the presentation clock is first created, it does not have a time source.</span></span> <span data-ttu-id="731a7-183">若要設定時間來源，請呼叫 [**IMFPresentationClock：： SetTimeSource**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-settimesource) ，並提供時間來源 [**IMFPresentationTimeSource**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource) 介面的指標。</span><span class="sxs-lookup"><span data-stu-id="731a7-183">To set the time source, call [**IMFPresentationClock::SetTimeSource**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-settimesource) with a pointer to the time source's [**IMFPresentationTimeSource**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource) interface.</span></span> <span data-ttu-id="731a7-184">時間來源支援與呈現時鐘相同的狀態 (執行中、已暫停和停止) ，而且必須執行 [**IMFClockStateSink**](/windows/desktop/api/mfidl/nn-mfidl-imfclockstatesink) 介面。</span><span class="sxs-lookup"><span data-stu-id="731a7-184">A time source supports the same states as the presentation clock (running, paused, and stop), and must implement the [**IMFClockStateSink**](/windows/desktop/api/mfidl/nn-mfidl-imfclockstatesink) interface.</span></span> <span data-ttu-id="731a7-185">簡報時鐘使用此介面來通知時間來源何時變更狀態。</span><span class="sxs-lookup"><span data-stu-id="731a7-185">The presentation clock uses this interface to notify the time source when to change state.</span></span> <span data-ttu-id="731a7-186">如此一來，時間來源就會提供時鐘刻度，但標記法會起始時鐘的狀態變更。</span><span class="sxs-lookup"><span data-stu-id="731a7-186">In this way, the time source provides the clock ticks, but the presentation clock initiates state changes in the clock.</span></span>

<span data-ttu-id="731a7-187">有些媒體接收器可以存取精確的時鐘，因此會公開 [**IMFPresentationTimeSource**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource) 介面。</span><span class="sxs-lookup"><span data-stu-id="731a7-187">Some media sinks have access to an accurate clock, and therefore expose the [**IMFPresentationTimeSource**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource) interface.</span></span> <span data-ttu-id="731a7-188">尤其是，音訊轉譯器可以使用音效卡的頻率作為時鐘。</span><span class="sxs-lookup"><span data-stu-id="731a7-188">In particular, the audio renderer can use the frequency of the sound card as a clock.</span></span> <span data-ttu-id="731a7-189">在音訊播放中，音訊轉譯器可作為時間來源，讓影片同步到音訊播放速率。</span><span class="sxs-lookup"><span data-stu-id="731a7-189">In audio playback, it is useful for the audio renderer to act as the time source, so that video is synchronized to the audio playback rate.</span></span> <span data-ttu-id="731a7-190">這通常會比嘗試將音訊與外部時鐘比對，產生更好的結果。</span><span class="sxs-lookup"><span data-stu-id="731a7-190">This generally produces better results than attempting to match the audio to an external clock.</span></span>

<span data-ttu-id="731a7-191">媒體基礎也會根據系統時鐘提供展示時間來源。</span><span class="sxs-lookup"><span data-stu-id="731a7-191">Media Foundation also provides a presentation time source based on the system clock.</span></span> <span data-ttu-id="731a7-192">若要建立這個物件，請呼叫 [**MFCreateSystemTimeSource**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatesystemtimesource)。</span><span class="sxs-lookup"><span data-stu-id="731a7-192">To create this object, call [**MFCreateSystemTimeSource**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatesystemtimesource).</span></span> <span data-ttu-id="731a7-193">當沒有任何媒體接收提供時間來源時，可以使用系統時間來源。</span><span class="sxs-lookup"><span data-stu-id="731a7-193">The system time source can be used when no media sinks provide a time source.</span></span>

<span data-ttu-id="731a7-194">一般情況下，媒體接收器必須使用提供給它的簡報時鐘，無論呈現時鐘使用的時間來源為何。</span><span class="sxs-lookup"><span data-stu-id="731a7-194">In general, a media sink must use the presentation clock provided to it, regardless of which time source the presentation clock uses.</span></span> <span data-ttu-id="731a7-195">即使在媒體接收器執行 [**IMFPresentationTimeSource**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource)時，也適用此規則。</span><span class="sxs-lookup"><span data-stu-id="731a7-195">This rule applies even when a media sink implements [**IMFPresentationTimeSource**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource).</span></span> <span data-ttu-id="731a7-196">如果簡報時鐘使用其他時間來源，則媒體接收器必須在該時間來源之後，而不是它自己的內部時鐘。</span><span class="sxs-lookup"><span data-stu-id="731a7-196">If the presentation clock uses some other time source, the media sink must follow that time source, not its own internal clock.</span></span>

<span data-ttu-id="731a7-197">在兩種情況下，媒體接收器不會遵循簡報時鐘：</span><span class="sxs-lookup"><span data-stu-id="731a7-197">There are two situations when a media sink will not follow the presentation clock:</span></span>

-   <span data-ttu-id="731a7-198">有些媒體接收器 *rateless*。</span><span class="sxs-lookup"><span data-stu-id="731a7-198">Some media sinks are *rateless*.</span></span> <span data-ttu-id="731a7-199">如果媒體接收器 rateless，它會儘快取用樣本，而不會根據簡報時鐘進行排程。</span><span class="sxs-lookup"><span data-stu-id="731a7-199">If a media sink is rateless, it consumes samples as quickly as possible, without scheduling them according to the presentation clock.</span></span> <span data-ttu-id="731a7-200">一般而言，rateless 接收會將資料寫入檔案，因此最好儘快完成此作業。</span><span class="sxs-lookup"><span data-stu-id="731a7-200">Typically, rateless sinks write data to a file, so it is desirable to complete the operation as quickly as possible.</span></span> <span data-ttu-id="731a7-201">Rateless 接收會傳回 \_ [**IMFMediaSink：： GetCharacteristics**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasink-getcharacteristics) 方法中的 MEDIASINK rateless 旗標。</span><span class="sxs-lookup"><span data-stu-id="731a7-201">A rateless sink returns the MEDIASINK\_RATELESS flag in its [**IMFMediaSink::GetCharacteristics**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasink-getcharacteristics) method.</span></span> <span data-ttu-id="731a7-202">當拓撲中的所有接收器都 rateless 時，媒體會話會儘快將資料推送至管線。</span><span class="sxs-lookup"><span data-stu-id="731a7-202">When all the sinks in a topology are rateless, the Media Session pushes data through the pipeline as quickly as possible.</span></span>

-   <span data-ttu-id="731a7-203">有些媒體接收無法比對費率與本身的時間來源。</span><span class="sxs-lookup"><span data-stu-id="731a7-203">Some media sinks cannot match rates with a time source other than themselves.</span></span> <span data-ttu-id="731a7-204">如果是，則接收會傳回 MEDIASINK，而 \_ \_ \_ 其 [**GetCharacteristics**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasink-getcharacteristics) 方法中的時鐘旗標不能相符。</span><span class="sxs-lookup"><span data-stu-id="731a7-204">If so, the sink returns the MEDIASINK\_CANNOT\_MATCH\_CLOCK flag in its [**GetCharacteristics**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasink-getcharacteristics) method.</span></span> <span data-ttu-id="731a7-205">管線仍可以使用另一個時間來源，但結果將會小於最佳。</span><span class="sxs-lookup"><span data-stu-id="731a7-205">The pipeline can still use another time source, but the results will be less than optimal.</span></span> <span data-ttu-id="731a7-206">接收可能會落後並在播放期間造成問題。</span><span class="sxs-lookup"><span data-stu-id="731a7-206">The sink will likely fall behind and cause glitches during playback.</span></span>

## <a name="related-topics"></a><span data-ttu-id="731a7-207">相關主題</span><span class="sxs-lookup"><span data-stu-id="731a7-207">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="731a7-208">媒體基礎平臺 Api</span><span class="sxs-lookup"><span data-stu-id="731a7-208">Media Foundation Platform APIs</span></span>](media-foundation-platform-apis.md)
</dt> </dl>

 

 



