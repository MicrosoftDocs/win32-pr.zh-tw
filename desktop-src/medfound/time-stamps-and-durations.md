---
description: 本主題說明媒體基礎轉換應該如何處理時間戳記。
ms.assetid: 4ab576ce-becd-4736-921e-e463c0dff841
title: 時間戳記和持續時間
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2323c11fa0e3ec2b2b2d5ba1cefe4f5d5fa80c5b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104114349"
---
# <a name="time-stamps-and-durations"></a><span data-ttu-id="7f7d8-103">時間戳記和持續時間</span><span class="sxs-lookup"><span data-stu-id="7f7d8-103">Time Stamps and Durations</span></span>

<span data-ttu-id="7f7d8-104">本主題說明 [媒體基礎轉換](media-foundation-transforms.md) 應該如何處理時間戳記。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-104">This topic describes how [Media Foundation Transforms](media-foundation-transforms.md) should handle time stamps.</span></span>

<span data-ttu-id="7f7d8-105">在所有輸出範例中，MFT 都必須盡可能設定正確的時間戳記和持續時間。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-105">An MFT must set as accurate a time stamp and duration as possible on all output samples.</span></span> <span data-ttu-id="7f7d8-106">針對採用一個輸入緩衝區，並將其完全處理到輸出緩衝區的簡單 MFT，此 MFT 應直接將時間戳記和持續時間從輸入範例複製到輸出範例。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-106">For a simple MFT that takes one input buffer and completely processes it into an output buffer, the MFT should just copy the time stamp and duration directly from the input sample to the output sample.</span></span> <span data-ttu-id="7f7d8-107">不過，許多轉換比這個更複雜，而且可能需要更複雜的輸出時間計算。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-107">However, many transforms are more complex than this and may require more complex calculations of output time.</span></span> <span data-ttu-id="7f7d8-108">所有 MFTs 都應該觀察下列基本規則：</span><span class="sxs-lookup"><span data-stu-id="7f7d8-108">All MFTs should observe the following basic rules:</span></span>

-   <span data-ttu-id="7f7d8-109">如果輸入範例上提供正確的時間戳記或持續時間，或可以計算，則 MFT 應該嘗試在所有未壓縮的影片或音訊輸出範例上加上時間戳記和持續時間。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-109">An MFT should try to put a time stamp and duration on all uncompressed video or audio output samples if an accurate time stamp or duration is given on the input samples or can be calculated.</span></span> <span data-ttu-id="7f7d8-110">某些輸出時間戳記（尤其是針對解碼器）可能需要插補。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-110">Interpolation may be required for some output time stamps, especially for decoders.</span></span>
-   <span data-ttu-id="7f7d8-111">輸入範例的時間戳記和持續時間應該盡可能地保留在輸出範例上。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-111">The time stamps and durations of the input samples should be preserved on the output samples as much as possible.</span></span>
-   <span data-ttu-id="7f7d8-112">輸出時間戳記或持續時間可能不符合輸入，因為 MFT 會將資料保存，或將輸出分成與輸入不同的大小部分。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-112">The output time stamps or durations might not match the input because the MFT is holding back data or breaking the output into different-sized pieces than the input.</span></span> <span data-ttu-id="7f7d8-113">在此情況下，MFT 應從最早的輸入範例計算輸出時間戳記，其中包含用來建立輸出範例的資料。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-113">In that case, the MFT should calculate the output time stamp from the earliest input sample that contains data used to create the output sample.</span></span> <span data-ttu-id="7f7d8-114">若要計算輸出時間戳記，請將適當輸入範例的輸入時間戳記新增至已從該範例轉換的資料持續時間。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-114">To calculate the output time stamp, add the input time stamp of the appropriate input sample to the duration of data that has already been transformed from that sample.</span></span> <span data-ttu-id="7f7d8-115">本節結尾的第二個範例說明此概念。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-115">The second example at the end of this section illustrates this idea.</span></span>
-   <span data-ttu-id="7f7d8-116">如果輸入範例有持續時間，則應該保留該持續時間。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-116">If the input samples have duration, that duration should be preserved.</span></span> <span data-ttu-id="7f7d8-117">如果輸入範例沒有持續時間，則在可能的情況下，從輸出緩衝區的大小或媒體類型提供的資料速率來計算持續時間。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-117">If an input sample does not have duration, the MFT should calculate a duration if possible from the size of the output buffer or the data rate given by the media type.</span></span>
-   <span data-ttu-id="7f7d8-118">計算的持續時間應該截斷 (進位) ，而不會四捨五入到最接近的遞增量。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-118">Calculated durations should be truncated (rounded down), not rounded to the nearest increment.</span></span> <span data-ttu-id="7f7d8-119">管線有足夠的空間來處理稍微不准確的持續時間，但更容易讓管線處理的持續時間比1% 長很長的持續時間。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-119">The pipeline has enough slack to handle durations that are slightly inaccurate, but it is easier for the pipeline to handle a duration that is 1% too short than a duration that is 1% too long.</span></span> <span data-ttu-id="7f7d8-120">話雖如此，就沒有理由刻意縮短持續時間，而不是依四捨五入。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-120">That said, there is no reason to deliberately shorten the durations, other than by rounding.</span></span>

### <a name="decoders"></a><span data-ttu-id="7f7d8-121">解碼器</span><span class="sxs-lookup"><span data-stu-id="7f7d8-121">Decoders</span></span>

<span data-ttu-id="7f7d8-122">解碼器會將壓縮的封包轉換成未壓縮的資料。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-122">A decoder converts compressed packets into uncompressed data.</span></span> <span data-ttu-id="7f7d8-123">因為輸出是未壓縮的，所以相較于取得時間戳記和持續時間，則會有特殊的義務。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-123">Because the output is uncompressed, decoders have a special obligation to get the time stamps and durations correct.</span></span> <span data-ttu-id="7f7d8-124">某些壓縮格式（最明顯的是 MPEG-2）在所有輸入封包上都沒有時間戳記，而且在任何封包上通常都沒有時間戳記。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-124">Some compressed formats, most notably MPEG-2, do not have time stamps on all input packets and often have no duration on any packet.</span></span> <span data-ttu-id="7f7d8-125">針對這些格式，此解碼器會負責在每個輸出範例上放置有效的時間戳記和持續時間，方法是在上次加上時間戳記的輸入範例之後，加總所有輸出的隱含持續時間。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-125">For these formats, the decoder is responsible for putting a valid time stamp and duration on every output sample, by summing the implied durations of all the output since the last time-stamped input sample.</span></span>

<span data-ttu-id="7f7d8-126">針對影片，如果持續時間無法以壓縮格式提供，則此解碼器應該將持續時間計算為畫面播放速率的反向，轉換成 100-毫微秒的單位並向下四捨五入。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-126">For video, if the duration is not available in the compressed format, the decoder should calculate the duration as the inverse of the frame rate, converted to 100-nanosecond units and rounded down.</span></span>

<span data-ttu-id="7f7d8-127">若是音訊，如果持續時間無法以壓縮格式提供，則此解碼器應該將持續時間計算為音訊取樣率的反向乘以輸出緩衝區中的樣本數，並轉換為 100-毫微秒單位並向下舍入。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-127">For audio, if the duration is not available in the compressed format, the decoder should calculate the duration as the inverse of the audio sample rate multiplied by the number of samples in the output buffer, converted to 100-nanosecond units and rounded down.</span></span>

<span data-ttu-id="7f7d8-128">轉換不應該在沒有時間戳記的情況下輸出範例的時間，是指 MFT 從未收到輸入範例的時間戳記，或是沒有任何方法可從先前的輸入時間戳記計算出正確的輸出時間戳記。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-128">The only time a transform should output a sample without a time stamp is if the MFT has never received a time stamp on an input sample, or if there is no way to calculate an accurate output time stamp from the previous input time stamp.</span></span>

### <a name="audio-decoders"></a><span data-ttu-id="7f7d8-129">音訊解碼器</span><span class="sxs-lookup"><span data-stu-id="7f7d8-129">Audio Decoders</span></span>

<span data-ttu-id="7f7d8-130">針對音訊解碼器，每個輸出範例的持續時間是從音訊取樣率和輸出緩衝區中每個通道的 PCM 樣本數計算而得。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-130">For audio decoders, the duration of each output sample is calculated from the audio sampling rate and the number of PCM samples per channel in the output buffer.</span></span>

<span data-ttu-id="7f7d8-131">計算輸出時間戳記的正確方式取決於輸入範例是否包含時間戳記。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-131">The correct way to calculate output time stamps depends on whether the input samples contain time stamps.</span></span>

<span data-ttu-id="7f7d8-132">如果輸入範例包含時間戳記，則此解碼器會計算輸入時間戳記的輸出時間戳記，如下所示：</span><span class="sxs-lookup"><span data-stu-id="7f7d8-132">If the input samples contain time stamps, the decoder calculates the output time stamps from the input time stamps, as follows:</span></span>

-   <span data-ttu-id="7f7d8-133">如果每個輸入緩衝區都包含一或多個完整的壓縮框架（沒有部分框架），則輸出時間戳記會等於輸入時間戳記，減去較已知的解碼器延遲。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-133">If each input buffer contains a one or more complete compressed frames, with no partial frames, the output time stamp equals the input time stamp, minus the known latency of the decoder.</span></span> <span data-ttu-id="7f7d8-134">例如，[杜比性數位 (AC-3]) 解碼器的延遲為 256 PCM 樣本。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-134">For example, a Dolby Digital (AC-3) decoder has a latency of 256 PCM samples.</span></span> <span data-ttu-id="7f7d8-135">例如，在 48-kHz 的取樣率，延遲是5.33 毫秒 (毫秒) 。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-135">For example, at 48-kHz sampling rate, the latency is 5.33 milliseconds (msec).</span></span> <span data-ttu-id="7f7d8-136">因此，如果輸入時間戳記是1000毫秒，則輸出時間戳記是1000– 5.33 = 994.66 毫秒。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-136">Therefore, if the input time stamp is 1000 msec, the output time stamp is 1000 – 5.33 = 994.66 msec.</span></span> <span data-ttu-id="7f7d8-137">如果輸入緩衝區包含一個以上的整個壓縮框架，則此解碼器會為輸入範例中的每個框架產生一個輸出範例。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-137">If the input buffer includes more than one whole compressed frame, the decoder will produce one output sample for every frame in the input sample.</span></span> <span data-ttu-id="7f7d8-138">所有輸出範例都會正確地加上時間戳記，因此沒有間距。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-138">All output samples will be time stamped correctly such that there are no gaps.</span></span>
-   <span data-ttu-id="7f7d8-139">根據傳輸格式，輸入緩衝區可能包含部分框架。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-139">Depending on the transport format, an input buffer might contain partial frames.</span></span> <span data-ttu-id="7f7d8-140">例如，緩衝區可能包含先前輸入緩衝區的部分框架，後面接著一或多個完整的框架，後面接著下一個框架的開頭。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-140">For example, a buffer might contain part of a frame from the previous input buffer, followed by one or more complete frames, followed by the start of the next frame.</span></span> <span data-ttu-id="7f7d8-141">在此情況下，通常會正確地假設輸入時間戳記對應于緩衝區內開始的第一個畫面格。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-141">In this case, it is generally correct to assume that the input time stamp corresponds to the first frame that starts within the buffer.</span></span> <span data-ttu-id="7f7d8-142"> (也就是，在前一個緩衝區中啟動的部分框架不會包含在目前緩衝區的時間戳記中。 ) 據此計算輸出時間戳記。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-142">(That is, a partial frame that started in the previous buffer is not included in the time stamp for the current buffer.) Calculate the output time stamp accordingly.</span></span>

<span data-ttu-id="7f7d8-143">如果輸入範例不包含任何時間戳記：</span><span class="sxs-lookup"><span data-stu-id="7f7d8-143">If the input samples do not contain any time stamps:</span></span>

-   <span data-ttu-id="7f7d8-144">此解碼器應該產生自己的時間戳記，將第一個輸出時間戳記設定為零。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-144">The decoder should generate its own time stamps, setting the first output time stamp to zero.</span></span>
-   <span data-ttu-id="7f7d8-145">範例持續時間是根據緩衝區中的輸出樣本數目和取樣率來計算。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-145">The sample duration is calculated from the number of output samples in the buffer and the sample rate.</span></span>
-   <span data-ttu-id="7f7d8-146">後續的時間戳記是從先前的時間戳記和持續時間計算：目前的時間戳記 + 目前的持續時間 = 下一個時間戳記。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-146">Subsequent time stamps are calculated from the previous time stamp and duration: Current time stamp + current duration = next time stamp.</span></span> <span data-ttu-id="7f7d8-147">輸出時間戳記中應該沒有間距。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-147">There should be no gaps in the output time stamps.</span></span>

<span data-ttu-id="7f7d8-148">如果輸入資料流程一開始包含時間戳記，但因為某些原因切換為沒有時間戳記，則該解碼器應該會繼續產生自己的輸出時間戳記，因此它們是連續的，而且沒有間距。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-148">If the input stream initially contains time stamps, but for some reason switches to no time stamps, the decoder should continue to generate its own output time stamps, such that they are continuous and there is no gap.</span></span>

<span data-ttu-id="7f7d8-149">如果輸入資料流程包含時間戳記，但時間有間隙，則此解碼器只會傳播這些間距。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-149">If the input stream contains time stamps, but there are gaps in the times, the decoder will simply propagate these gaps.</span></span> <span data-ttu-id="7f7d8-150">換句話說，解碼器不應該嘗試修正輸入資料流程中不一致的時間戳記。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-150">In other words, the decoder should not attempt to fix inconsistent time stamps in the input stream.</span></span>

### <a name="mixers"></a><span data-ttu-id="7f7d8-151">攪拌機</span><span class="sxs-lookup"><span data-stu-id="7f7d8-151">Mixers</span></span>

> [!Note]  
> <span data-ttu-id="7f7d8-152">在 Windows Vista 中，媒體基礎管線不支援具有多個輸入的 MFTs。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-152">In Windows Vista, the Media Foundation pipeline does not support MFTs with more than one input.</span></span> <span data-ttu-id="7f7d8-153">Windows 7 支援多重輸入 MFTs。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-153">Multiple-input MFTs are supported in Windows 7.</span></span>

 

<span data-ttu-id="7f7d8-154">混音器會接受多個輸入，並將其混合成一個輸出。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-154">A mixer takes multiple inputs and mixes them into one output.</span></span> <span data-ttu-id="7f7d8-155">如果輸入資料流程未完全經過速率鎖定，或彼此之間稍微位移，則在輸出上設定的時間可能會很明確。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-155">If the input streams are not completely rate-locked, or are slightly offset in time from each other, there can be ambiguity about which time to set on the output.</span></span> <span data-ttu-id="7f7d8-156">以下是一些指導方針，視媒體類型而定：</span><span class="sxs-lookup"><span data-stu-id="7f7d8-156">Here are some guidelines, depending on the media type:</span></span>

-   <span data-ttu-id="7f7d8-157">音訊。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-157">Audio.</span></span> <span data-ttu-id="7f7d8-158">在啟動或立即清空或排清之後，音訊混音器應該等候產生輸出範例，直到它收到所有必要輸入資料流程的輸入範例為止。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-158">At startup or immediately after a drain or flush, an audio mixer should wait to produce output samples until it has received an input sample on all required input streams.</span></span> <span data-ttu-id="7f7d8-159">屆時，它應該選擇初始範例最早的時間戳記，做為輸出時間戳記的基準。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-159">At that point, it should choose the earliest time stamp of the initial samples to use as a baseline for the output time stamps.</span></span> <span data-ttu-id="7f7d8-160">其他資料流程應以無回應填補，以產生任何時間差異。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-160">The other streams should be padded with silence to make up any time discrepancy.</span></span> <span data-ttu-id="7f7d8-161">如果在選擇性輸入資料流程上收到範例，則也應該將它納入計算的考慮。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-161">If a sample is received on an optional input stream, it should also be factored into the calculation.</span></span> <span data-ttu-id="7f7d8-162">從該時間點開始，MFT 應致力於產生連續且不中斷的輸出時間戳記鏈。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-162">From that point on, the MFT should strive to produce a continuous and unbroken chain of output time stamps.</span></span> <span data-ttu-id="7f7d8-163">一般而言，此 MFT 不應該嘗試將一個相對於另一個資料流程的資料流程離開。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-163">In general, the MFT should not try to account for one stream drifting relative to another.</span></span> <span data-ttu-id="7f7d8-164">相反地，它應該會計算基準時間戳記的輸出時間戳記、輸出速率，以及緩衝區大小。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-164">Instead, it should calculate the output time stamps from the baseline time stamp, the output rate, and the buffer sizes.</span></span> <span data-ttu-id="7f7d8-165">發生另一個清空或清除時，MFT 應該重設其基準時間戳記。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-165">When another drain or flush occurs, the MFT should reset its baseline time stamps.</span></span>

-   <span data-ttu-id="7f7d8-166">影片。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-166">Video.</span></span> <span data-ttu-id="7f7d8-167">在啟動或立即清空或排清之後，視頻混音器應該等候產生輸出範例，直到它收到所有必要輸入資料流程的輸入範例為止。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-167">At startup or immediately after a drain or flush, a video mixer should wait to produce output samples until it has received an input sample on all required input streams.</span></span> <span data-ttu-id="7f7d8-168">屆時，它應該選擇初始範例最早的時間戳記，做為輸出時間戳記的基準。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-168">At that point, it should choose the earliest time stamp of the initial samples to use as a baseline for the output time stamps.</span></span> <span data-ttu-id="7f7d8-169">一般情況下，它應該致力於保留連續和一般的輸出時間戳記和固定的持續時間，即使輸入不是一般的，還是需要重複輸入框架。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-169">In general, it should strive to keep continuous and regular output time stamps and fixed durations, even if the input is not as regular, if necessary by repeating input frames.</span></span>

### <a name="encoders"></a><span data-ttu-id="7f7d8-170">編碼器</span><span class="sxs-lookup"><span data-stu-id="7f7d8-170">Encoders</span></span>

<span data-ttu-id="7f7d8-171">編碼器會將未壓縮的音訊或影片轉換成壓縮的封包。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-171">An encoder converts uncompressed audio or video into compressed packets.</span></span> <span data-ttu-id="7f7d8-172">編碼器應遵循下列指導方針：</span><span class="sxs-lookup"><span data-stu-id="7f7d8-172">An encoder should follow these guidelines:</span></span>

-   <span data-ttu-id="7f7d8-173">編碼器應遵循輸出格式的慣例。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-173">The encoder should follow the conventions of the output format.</span></span> <span data-ttu-id="7f7d8-174">如果格式通常不是每個樣本的時間戳記（如 MPEG-2 所示），則並非每個輸出範例都需要有時間戳記和持續時間。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-174">If the format does not typically time stamp every sample, as in MPEG-2, not every output sample needs to have a time stamp and a duration.</span></span>

-   <span data-ttu-id="7f7d8-175">如果格式具有時間戳記的欄位，則應該保留輸出格式的輸入時間戳記，除非其他來源（例如應用程式本身）有更好的時間資訊。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-175">The input time stamps should be preserved in the output format, if the format has fields for time stamps, unless better time information is a available from another source, such as the application itself.</span></span>

### <a name="multiplexers"></a><span data-ttu-id="7f7d8-176">Multiplexers</span><span class="sxs-lookup"><span data-stu-id="7f7d8-176">Multiplexers</span></span>

> [!Note]  
> <span data-ttu-id="7f7d8-177">在 Windows Vista 中，媒體基礎管線不支援具有多個輸入的 MFTs。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-177">In Windows Vista, the Media Foundation pipeline does not support MFTs with more than one input.</span></span> <span data-ttu-id="7f7d8-178">Windows 7 支援多重輸入 MFTs。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-178">Multiple-input MFTs are supported in Windows 7.</span></span>

 

<span data-ttu-id="7f7d8-179">多工器會將兩個不同的音訊或影片串流合併成一個交錯格式，例如 AVI 或 MPEG-2 傳輸串流。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-179">A multiplexer combines two different audio or video streams into one interleaved format, such as AVI or MPEG-2 Transport Stream.</span></span> <span data-ttu-id="7f7d8-180">多工器應遵循下列指導方針：</span><span class="sxs-lookup"><span data-stu-id="7f7d8-180">A multiplexer should follow these guidelines:</span></span>

-   <span data-ttu-id="7f7d8-181">多工器應遵循輸出格式的慣例。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-181">The multiplexer should follow the conventions of the output format.</span></span> <span data-ttu-id="7f7d8-182">如果格式通常不是每個樣本的時間戳記（如 MPEG-2 所示），則並非每個輸出範例都需要有時間戳記和持續時間。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-182">If the format does not typically time stamp every sample, as in MPEG-2, not every output sample needs to have a time stamp and a duration.</span></span>

-   <span data-ttu-id="7f7d8-183">時間戳記應該反映放置在任何框架上的最早時間（從該封包開始），或第一個音訊樣本的時間（從該封包解碼）。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-183">The time stamp should reflect the earliest time that would be placed on any frame that begins in that packet, or the time of the first audio sample that would be decoded from that packet.</span></span> <span data-ttu-id="7f7d8-184">如果與輸出格式的慣例衝突，請忽略此指導方針。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-184">Ignore this guideline if it conflicts with the conventions of the output format.</span></span>

### <a name="demultiplexers"></a><span data-ttu-id="7f7d8-185">Demultiplexers</span><span class="sxs-lookup"><span data-stu-id="7f7d8-185">Demultiplexers</span></span>

<span data-ttu-id="7f7d8-186">信號信號會將交錯格式（例如 AVI 或 MPEG-2 傳輸資料流程）分割成基礎音訊和影片串流。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-186">A demultiplexer splits an interleaved format, such as AVI or MPEG-2 Transport Stream, into the underlying audio and video streams.</span></span>

<span data-ttu-id="7f7d8-187">如果格式包含特定的時間戳記資訊，可用來根據輸入時間戳記計算正確的輸出時間戳記，則應該使用該資訊。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-187">If the format contains specific time stamp information that can be used to calculate accurate output time stamps based on the input time stamps, that information should be used.</span></span> <span data-ttu-id="7f7d8-188">但是，如果格式所包含的時間與輸入時間戳記無關，而且無法計算輸入時間戳記的精確位移，則應該忽略格式的自訂時間。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-188">However, if the format contains times in a completely different base that bear no relation to the input time stamps, and an accurate offset to the input time stamp cannot be calculated, the format's own times should be ignored.</span></span>

<span data-ttu-id="7f7d8-189">如果格式沒有可使用的時間戳記資訊，則信號信號應遵循下列規則：</span><span class="sxs-lookup"><span data-stu-id="7f7d8-189">If the format does not have usable time stamp information, the demultiplexer should follow these rules:</span></span>

-   <span data-ttu-id="7f7d8-190">未壓縮的輸出資料流程應該盡可能具有有效的時間戳記和持續時間（從最接近的先前輸入時間戳記計算）。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-190">Uncompressed output streams should have valid time stamps and durations if possible, calculated from the closest previous input time stamp.</span></span>

-   <span data-ttu-id="7f7d8-191">壓縮的輸出資料流程應該只會在第一個輸出範例上，使用時間戳從輸入範例衍生的時間戳記。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-191">Compressed output streams should have time stamps on only the first output sample derived from an input sample with a time stamp.</span></span> <span data-ttu-id="7f7d8-192">如果輸入範例沒有時間戳記，則衍生自該輸入範例的輸出樣本應該有時間戳記。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-192">If the input sample does not have a time stamp, no output samples derived from that input sample should have a time stamp.</span></span> <span data-ttu-id="7f7d8-193">如果輸入範例分成多個輸出範例，則只有第一個輸出範例應該有時間戳記，而其餘的則不應有時間戳記。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-193">If the input sample is broken into multiple output samples, only the first output sample should have a time stamp, and the rest should have no time stamps.</span></span>

### <a name="examples"></a><span data-ttu-id="7f7d8-194">範例</span><span class="sxs-lookup"><span data-stu-id="7f7d8-194">Examples</span></span>

<span data-ttu-id="7f7d8-195">範例 1.</span><span class="sxs-lookup"><span data-stu-id="7f7d8-195">Example 1.</span></span> <span data-ttu-id="7f7d8-196">假設影片效果一律採用未壓縮的輸入框架、套用效果，並將其複製到輸出。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-196">Suppose that a video effect always takes an uncompressed input frame, applies the effect, and copies it to the output.</span></span> <span data-ttu-id="7f7d8-197">它永遠不會保留任何框架或緩衝任何輸入。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-197">It never holds back any frames or buffers any input.</span></span> <span data-ttu-id="7f7d8-198">此 MFT 只會將時間戳記和持續時間從輸入範例複製到輸出範例（如果有的話），而且完全沒有時間計算。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-198">This MFT simply copies the time stamp and duration from the input sample to the output sample, if they are available, and does no time calculations at all.</span></span>

<span data-ttu-id="7f7d8-199">範例 2.</span><span class="sxs-lookup"><span data-stu-id="7f7d8-199">Example 2.</span></span> <span data-ttu-id="7f7d8-200">假設音訊效果會將每個輸入緩衝區的10毫秒 (ms) 全部轉換，以節省額外10毫秒來與下一個緩衝區合併。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-200">Suppose that an audio effect transforms all but 10 milliseconds (ms) of each input buffer, saving the extra 10 ms to combine with the next buffer.</span></span> <span data-ttu-id="7f7d8-201">它會取得樣本的資料流程，這些樣本的持續時間為50毫秒。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-201">It gets a stream of samples that all have a duration of 50 ms.</span></span> <span data-ttu-id="7f7d8-202">輸入時間如下表所示。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-202">The input times are shown in the following table.</span></span>



| <span data-ttu-id="7f7d8-203">範例</span><span class="sxs-lookup"><span data-stu-id="7f7d8-203">Sample</span></span> | <span data-ttu-id="7f7d8-204">輸入時間</span><span class="sxs-lookup"><span data-stu-id="7f7d8-204">Input time</span></span> | <span data-ttu-id="7f7d8-205">輸入持續時間</span><span class="sxs-lookup"><span data-stu-id="7f7d8-205">Input duration</span></span> | <span data-ttu-id="7f7d8-206">輸出時間</span><span class="sxs-lookup"><span data-stu-id="7f7d8-206">Output time</span></span> | <span data-ttu-id="7f7d8-207">輸出持續時間</span><span class="sxs-lookup"><span data-stu-id="7f7d8-207">Output duration</span></span> |
|--------|------------|----------------|-------------|-----------------|
| <span data-ttu-id="7f7d8-208">1</span><span class="sxs-lookup"><span data-stu-id="7f7d8-208">1</span></span>      | <span data-ttu-id="7f7d8-209">20</span><span class="sxs-lookup"><span data-stu-id="7f7d8-209">20</span></span>         | <span data-ttu-id="7f7d8-210">50</span><span class="sxs-lookup"><span data-stu-id="7f7d8-210">50</span></span>             | <span data-ttu-id="7f7d8-211">20</span><span class="sxs-lookup"><span data-stu-id="7f7d8-211">20</span></span>          | <span data-ttu-id="7f7d8-212">40</span><span class="sxs-lookup"><span data-stu-id="7f7d8-212">40</span></span>              |
| <span data-ttu-id="7f7d8-213">2</span><span class="sxs-lookup"><span data-stu-id="7f7d8-213">2</span></span>      | <span data-ttu-id="7f7d8-214">70</span><span class="sxs-lookup"><span data-stu-id="7f7d8-214">70</span></span>         | <span data-ttu-id="7f7d8-215">50</span><span class="sxs-lookup"><span data-stu-id="7f7d8-215">50</span></span>             | <span data-ttu-id="7f7d8-216">60</span><span class="sxs-lookup"><span data-stu-id="7f7d8-216">60</span></span>          | <span data-ttu-id="7f7d8-217">50</span><span class="sxs-lookup"><span data-stu-id="7f7d8-217">50</span></span>              |
| <span data-ttu-id="7f7d8-218">3</span><span class="sxs-lookup"><span data-stu-id="7f7d8-218">3</span></span>      | <span data-ttu-id="7f7d8-219">121</span><span class="sxs-lookup"><span data-stu-id="7f7d8-219">121</span></span>        | <span data-ttu-id="7f7d8-220">50</span><span class="sxs-lookup"><span data-stu-id="7f7d8-220">50</span></span>             | <span data-ttu-id="7f7d8-221">110</span><span class="sxs-lookup"><span data-stu-id="7f7d8-221">110</span></span>         | <span data-ttu-id="7f7d8-222">50</span><span class="sxs-lookup"><span data-stu-id="7f7d8-222">50</span></span>              |
| <span data-ttu-id="7f7d8-223">4</span><span class="sxs-lookup"><span data-stu-id="7f7d8-223">4</span></span>      | <span data-ttu-id="7f7d8-224">171</span><span class="sxs-lookup"><span data-stu-id="7f7d8-224">171</span></span>        | <span data-ttu-id="7f7d8-225">50</span><span class="sxs-lookup"><span data-stu-id="7f7d8-225">50</span></span>             | <span data-ttu-id="7f7d8-226">161</span><span class="sxs-lookup"><span data-stu-id="7f7d8-226">161</span></span>         | <span data-ttu-id="7f7d8-227">50</span><span class="sxs-lookup"><span data-stu-id="7f7d8-227">50</span></span>              |



 

<span data-ttu-id="7f7d8-228">請注意樣本2的實際持續時間與根據下一個時間戳記 (121 的隱含持續時間之間的1毫秒差異？</span><span class="sxs-lookup"><span data-stu-id="7f7d8-228">Note the 1-ms discrepancy between the actual duration of sample 2 and the implied duration based on the next time stamp (121 ?</span></span> <span data-ttu-id="7f7d8-229">70 = 51) 。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-229">70 = 51).</span></span>

<span data-ttu-id="7f7d8-230">因為 MFT 會保存10毫秒，所以會輸出輸入範例1的前40毫秒作為輸出範例1，時間戳記為20毫秒且持續時間為40毫秒。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-230">Because the MFT holds back 10 ms, it outputs the first 40 ms of input sample 1 as output sample 1, with a time stamp of 20 ms and a duration of 40 ms.</span></span>

<span data-ttu-id="7f7d8-231">輸出範例2結合了先前保留的10毫秒與輸入範例2的40毫秒。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-231">Output sample 2 combines the 10 ms previously held back with 40 ms of input sample 2.</span></span> <span data-ttu-id="7f7d8-232">此範例的時間戳記為60毫秒 (上一個輸入範例的時間戳記20毫秒，加上該範例中已處理的資料持續時間，40毫秒) 。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-232">This sample is given a time stamp of 60 ms (the time stamp of the previous input sample, 20ms, plus the duration of the data already processed from that sample, 40ms).</span></span> <span data-ttu-id="7f7d8-233">它會獲得50毫秒的持續時間。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-233">It is given a duration of 50ms.</span></span>

<span data-ttu-id="7f7d8-234">同樣地，下一個範例的時間戳記為 110ms (70ms + 40 毫秒) ，持續時間為50毫秒。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-234">Similarly, the next sample has a time stamp of 110ms (70ms + 40ms) with a duration of 50 ms.</span></span>

<span data-ttu-id="7f7d8-235">下一個計算更有趣。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-235">The next calculation is more interesting.</span></span> <span data-ttu-id="7f7d8-236">先前輸出時間與持續時間的隱含時間戳記會是160毫秒 (時間戳記 110 ms + 持續時間 50 ms) 。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-236">The implied time stamp from the previous output time and duration would be 160 ms (time stamp 110 ms + duration 50 ms).</span></span> <span data-ttu-id="7f7d8-237">不過，輸出時間戳記應從最早輸入範例的輸入時間戳記計算，該時間戳記會與輸出取樣的時間重迭，加上已從該範例處理的任何資料長度。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-237">However, the output time stamp is supposed to be calculated from the input time stamp of the earliest input sample that overlaps the output sample in time, plus the length of any data already processed from that sample.</span></span> <span data-ttu-id="7f7d8-238">最接近的重迭輸入範例是範例 4 (時間戳記 = 171) ，但這不是最早的。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-238">The closest overlapping input sample is the sample 4 (time stamp = 171), but this is not the earliest one.</span></span> <span data-ttu-id="7f7d8-239">最早的重迭樣本為範例 3 (時間戳記 = 121) 。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-239">The earliest overlapping sample is sample 3 (time stamp = 121).</span></span> <span data-ttu-id="7f7d8-240">新增已從該範例處理的40毫秒，結果為161。</span><span class="sxs-lookup"><span data-stu-id="7f7d8-240">Adding the 40ms that has already been processed from that sample, the result is 161.</span></span>

## <a name="related-topics"></a><span data-ttu-id="7f7d8-241">相關主題</span><span class="sxs-lookup"><span data-stu-id="7f7d8-241">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="7f7d8-242">撰寫自訂的 MFT</span><span class="sxs-lookup"><span data-stu-id="7f7d8-242">Writing a Custom MFT</span></span>](writing-a-custom-mft.md)
</dt> </dl>

 

 



