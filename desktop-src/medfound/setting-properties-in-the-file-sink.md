---
description: 瞭解如何設定 ASF 檔案接收中的屬性，應用程式可用來將 ASF 媒體資料封存至檔案。
ms.assetid: a47caabd-23e3-4d22-b4b6-5fdb79d62ca1
title: 設定 File 接收中的屬性
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 64b6b000ed04c7858251f7388d3edc6a40e0b213
ms.sourcegitcommit: 5d4e99f4c8f42f5f543e52cb9beb9fb13ec56c5f
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/19/2021
ms.locfileid: "112407511"
---
# <a name="setting-properties-in-the-file-sink"></a><span data-ttu-id="47a2f-103">設定 File 接收中的屬性</span><span class="sxs-lookup"><span data-stu-id="47a2f-103">Setting Properties in the File Sink</span></span>

<span data-ttu-id="47a2f-104">ASF 檔案接收是媒體基礎所提供的 [**IMFMediaSink**](/windows/desktop/api/mfidl/nn-mfidl-imfmediasink) ，可讓應用程式用來將 ASF 媒體資料封存至檔案。</span><span class="sxs-lookup"><span data-stu-id="47a2f-104">The ASF file sink is an implementation of [**IMFMediaSink**](/windows/desktop/api/mfidl/nn-mfidl-imfmediasink) provided by Media Foundation that an application can use to archive ASF media data to a file.</span></span> <span data-ttu-id="47a2f-105">如需 ASF 媒體接收器的物件模型和一般使用方式的相關資訊，請參閱 [Asf 媒體接收器](asf-media-sinks.md)。</span><span class="sxs-lookup"><span data-stu-id="47a2f-105">For information about ASF Media Sinks' object model and general usage, see [ASF Media Sinks](asf-media-sinks.md).</span></span>

<span data-ttu-id="47a2f-106">[建立 ASF 檔案接收](creating-the-asf-file-sink.md)之後，必須使用輸出檔中的資料流程相關資訊進行設定。</span><span class="sxs-lookup"><span data-stu-id="47a2f-106">After [Creating the ASF file sink](creating-the-asf-file-sink.md), it must be configured with information about the streams in the output file.</span></span> <span data-ttu-id="47a2f-107">[將資料流程資訊新增至 ASF 檔案接收](adding-stream-information-to-the-asf-file-sink.md)時，會說明此程式。</span><span class="sxs-lookup"><span data-stu-id="47a2f-107">This procedure is described in [Adding Stream Information to the ASF File Sink](adding-stream-information-to-the-asf-file-sink.md).</span></span> <span data-ttu-id="47a2f-108">您可以根據編碼類型，在檔案接收上設定其他屬性。有漏洞 bucket;一般檔案屬性。</span><span class="sxs-lookup"><span data-stu-id="47a2f-108">You can set additional properties on the file sink depending on the type of encoding; leaky buckets; general file properties.</span></span> <span data-ttu-id="47a2f-109">這些設定不會寫入最終的 ASF 標頭物件中。</span><span class="sxs-lookup"><span data-stu-id="47a2f-109">These settings are not written in the final ASF Header Object.</span></span> <span data-ttu-id="47a2f-110">本主題說明在檔案接收的屬性存放區中新增這些屬性的程式。</span><span class="sxs-lookup"><span data-stu-id="47a2f-110">This topic describes process of adding these properties in the file sink's property store.</span></span>

<span data-ttu-id="47a2f-111">ContentInfo 物件會維護檔案接收的通用檔案屬性和個別資料流程屬性。</span><span class="sxs-lookup"><span data-stu-id="47a2f-111">The ContentInfo object maintains the global file properties and individual stream properties for the file sink.</span></span> <span data-ttu-id="47a2f-112">如需取得檔案接收之 ASF ContentInfo 物件參考的詳細資訊，請參閱 [建立 asf 檔案接收](creating-the-asf-file-sink.md)。</span><span class="sxs-lookup"><span data-stu-id="47a2f-112">For information about getting a reference to the file sink's ASF ContentInfo object, see [Creating the ASF File Sink](creating-the-asf-file-sink.md).</span></span>

<span data-ttu-id="47a2f-113">若要取得檔案接收之屬性存放區的參考 ([**IPropertyStore**](/windows/win32/api/propsys/nn-propsys-ipropertystore)) ，請在檔案接收的 ContentInfo 物件參考上呼叫 [**IMFASFContentInfo：： GetEncodingConfigurationPropertyStore**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfcontentinfo-getencodingconfigurationpropertystore) 。</span><span class="sxs-lookup"><span data-stu-id="47a2f-113">To get a reference to the file sink's property store ([**IPropertyStore**](/windows/win32/api/propsys/nn-propsys-ipropertystore)), call [**IMFASFContentInfo::GetEncodingConfigurationPropertyStore**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfcontentinfo-getencodingconfigurationpropertystore) on the file sink's ContentInfo object's reference.</span></span>

## <a name="stream-encoding-properties"></a><span data-ttu-id="47a2f-114">資料流程編碼屬性</span><span class="sxs-lookup"><span data-stu-id="47a2f-114">Stream Encoding Properties</span></span>

<span data-ttu-id="47a2f-115">為了適當地編碼內容，檔案需要知道某些編碼資訊，例如編碼類型和相關的編碼參數。</span><span class="sxs-lookup"><span data-stu-id="47a2f-115">To encode content properly the file needs to know certain encoding information such as type of encoding and the related encoding parameters.</span></span> <span data-ttu-id="47a2f-116">這些值會在檔案接收上設定為屬性值，在 ASF ContentInfo 物件所維護的內容存放區中。</span><span class="sxs-lookup"><span data-stu-id="47a2f-116">These values are set on the file sink as property values in a property store that is maintained by the ASF ContentInfo object.</span></span> <span data-ttu-id="47a2f-117">如果您要在具現化相關的編碼器之前設定 file 接收器，您可以使用 ContentInfo 物件搭配所有填入的屬性來建立 Windows Media 編碼器。</span><span class="sxs-lookup"><span data-stu-id="47a2f-117">If you are configuring the file sink before instantiating the relevant encoders, you can use the ContentInfo object with all the populated properties to create the Windows Media encoders.</span></span> <span data-ttu-id="47a2f-118">在此情況下，會在具現化的編碼器上自動設定這些屬性。</span><span class="sxs-lookup"><span data-stu-id="47a2f-118">In this case, the properties are automatically set on the instantiated encoders.</span></span> <span data-ttu-id="47a2f-119">相反地，如果您要在接收之前建立編碼器，請確定您在編碼器上設定的屬性會複製到檔案接收的屬性存放區。</span><span class="sxs-lookup"><span data-stu-id="47a2f-119">Conversely, if you are creating the encoders before the sink, make sure that the properties that you set on the encoders are copied into the file sink's property store.</span></span>

<span data-ttu-id="47a2f-120">若要設定編碼屬性，您需要存取 file 接收器的資料流程層級屬性存放區。</span><span class="sxs-lookup"><span data-stu-id="47a2f-120">To set encoding properties, you need access to the file sink's stream-level property store.</span></span> <span data-ttu-id="47a2f-121">在 [**IMFASFContentInfo：： GetEncodingConfigurationPropertyStore**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfcontentinfo-getencodingconfigurationpropertystore)方法的 *wStreamNumber* 參數中傳遞資料流程號碼。</span><span class="sxs-lookup"><span data-stu-id="47a2f-121">Pass the stream number in the *wStreamNumber* parameter of the [**IMFASFContentInfo::GetEncodingConfigurationPropertyStore**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfcontentinfo-getencodingconfigurationpropertystore) method.</span></span> <span data-ttu-id="47a2f-122">資料流程號碼必須符合在設定檔中設定每個資料流程時所設定的值。</span><span class="sxs-lookup"><span data-stu-id="47a2f-122">The stream numbers must match the values set while configuring each stream in the profile.</span></span> <span data-ttu-id="47a2f-123">藉由呼叫 [**IPropertyStore：： SetValue**](/windows/win32/api/propsys/nn-propsys-ipropertystore)來設定屬性值。</span><span class="sxs-lookup"><span data-stu-id="47a2f-123">Property values are set by calling [**IPropertyStore::SetValue**](/windows/win32/api/propsys/nn-propsys-ipropertystore).</span></span> <span data-ttu-id="47a2f-124">下表描述支援的屬性。</span><span class="sxs-lookup"><span data-stu-id="47a2f-124">The following table describes the supported properties.</span></span>

<span data-ttu-id="47a2f-125">屬性取決於編碼類型。</span><span class="sxs-lookup"><span data-stu-id="47a2f-125">The properties depend on the type of encoding.</span></span> <span data-ttu-id="47a2f-126">如需屬性和您必須設定之個別值的相關資訊，請參閱 [編碼屬性](configuring-the-encoder.md)。</span><span class="sxs-lookup"><span data-stu-id="47a2f-126">For information about the properties and the respective values that you must set, see [Encoding Properties](configuring-the-encoder.md).</span></span>

## <a name="leaky-bucket-property"></a><span data-ttu-id="47a2f-127">有漏洞 Bucket 屬性</span><span class="sxs-lookup"><span data-stu-id="47a2f-127">Leaky Bucket Property</span></span>

<span data-ttu-id="47a2f-128">有漏洞 bucket 參數會決定資料流程的編碼器所使用的實際緩衝區視窗。</span><span class="sxs-lookup"><span data-stu-id="47a2f-128">Leaky bucket parameters determine the actual buffer window used by the encoder for the stream.</span></span> <span data-ttu-id="47a2f-129">File sink 的 [**MFPKEY \_ ASFSTREAMSINK \_ 更正 \_ LEAKYBUCKET**](mfpkey-asfstreamsink-corrected-leakybucket-property.md) 屬性包含有漏洞值區參數、位元速率、緩衝區視窗和初始緩衝區飽和。這個屬性是在檔案接收的資料流程層級屬性存放區中設定，而且必須在建立和設定編碼器之後設定。</span><span class="sxs-lookup"><span data-stu-id="47a2f-129">The file sink's [**MFPKEY\_ASFSTREAMSINK\_CORRECTED\_LEAKYBUCKET**](mfpkey-asfstreamsink-corrected-leakybucket-property.md) property contains the leaky bucket parameters, bit rate, buffer window, and initial buffer fullness.This property is set in the stream-level property property store for the file sink and must be set after encoders have been created and configured.</span></span> <span data-ttu-id="47a2f-130">這個值是在中設定。</span><span class="sxs-lookup"><span data-stu-id="47a2f-130">This value is set in the .</span></span> <span data-ttu-id="47a2f-131">在媒體類型協商期間，編碼器會決定要使用的緩衝區視窗和位元速率。</span><span class="sxs-lookup"><span data-stu-id="47a2f-131">During the media type negotiation, the encoder decides the buffer window and the bit rate to use.</span></span> <span data-ttu-id="47a2f-132">您可以使用 **IWMCodecLeakyBucket** 介面（定義于 wmcodecifaces 中）來取得這些值，而且必須連結至 wmcodecdspuuid 以呼叫其方法。</span><span class="sxs-lookup"><span data-stu-id="47a2f-132">You can get these values by using the **IWMCodecLeakyBucket** interface, which is defined in wmcodecifaces.h and you must link to wmcodecdspuuid.lib to call its methods.</span></span>

<span data-ttu-id="47a2f-133">您可以針對 ASF 檔案接收中的每個資料流程，設定這個屬性的已抓取值。</span><span class="sxs-lookup"><span data-stu-id="47a2f-133">The retrieved values can be set for this property for each stream in the ASF file sink.</span></span>

## <a name="global-file-sink-properties"></a><span data-ttu-id="47a2f-134">通用檔案接收屬性</span><span class="sxs-lookup"><span data-stu-id="47a2f-134">Global File Sink Properties</span></span>

<span data-ttu-id="47a2f-135">若要取得 file 接收器的全域屬性存放區，請在 [**IMFASFContentInfo：： GetEncodingConfigurationPropertyStore**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfcontentinfo-getencodingconfigurationpropertystore)方法的 *wStreamNumber* 參數中傳遞0。</span><span class="sxs-lookup"><span data-stu-id="47a2f-135">To get the file sink's global property store, pass 0 in the *wStreamNumber* parameter of the [**IMFASFContentInfo::GetEncodingConfigurationPropertyStore**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfcontentinfo-getencodingconfigurationpropertystore) method.</span></span> <span data-ttu-id="47a2f-136">藉由呼叫 [**IPropertyStore：： SetValue**](/windows/win32/api/propsys/nn-propsys-ipropertystore)來設定屬性值。</span><span class="sxs-lookup"><span data-stu-id="47a2f-136">Property values are set by calling [**IPropertyStore::SetValue**](/windows/win32/api/propsys/nn-propsys-ipropertystore).</span></span> <span data-ttu-id="47a2f-137">下表描述支援的屬性。</span><span class="sxs-lookup"><span data-stu-id="47a2f-137">The following table describes the supported properties.</span></span>

| <span data-ttu-id="47a2f-138">檔案層級屬性</span><span class="sxs-lookup"><span data-stu-id="47a2f-138">File-level Properties</span></span>                                                                                | <span data-ttu-id="47a2f-139">描述</span><span class="sxs-lookup"><span data-stu-id="47a2f-139">Description</span></span>                                                                                                                                                                                                                                                                                           |
|------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="47a2f-140">**MFPKEY \_ ASFMEDIASINK \_ BASE \_ SENDTIME**</span><span class="sxs-lookup"><span data-stu-id="47a2f-140">**MFPKEY\_ASFMEDIASINK\_BASE\_SENDTIME**</span></span>](mfpkey-asfmediasink-base-sendtime-property.md)           | <span data-ttu-id="47a2f-141">傳送時間會指出何時會釋放有漏洞 bucket 內的承載。</span><span class="sxs-lookup"><span data-stu-id="47a2f-141">The send time indicates when the payload inside the leaky bucket will be released.</span></span> <span data-ttu-id="47a2f-142">這個屬性值表示第一個傳送時間。</span><span class="sxs-lookup"><span data-stu-id="47a2f-142">This property value indicates the first send time.</span></span> <span data-ttu-id="47a2f-143">多工器會使用此值來計算所產生封包的後續傳送時間，並確保資料會透過有漏洞值區穩定流動。</span><span class="sxs-lookup"><span data-stu-id="47a2f-143">The multiplexer uses this value to calculate the subsequent send times for the generated packets and ensures that data flows steadily through the leaky bucket.</span></span> |
| [<span data-ttu-id="47a2f-144">**MFPKEY \_ ASFMEDIASINK \_ AUTOADJUST \_ 位元速率**</span><span class="sxs-lookup"><span data-stu-id="47a2f-144">**MFPKEY\_ASFMEDIASINK\_AUTOADJUST\_BITRATE**</span></span>](mfpkey-asfmediasink-autoadjust-bitrate-property.md) | <span data-ttu-id="47a2f-145">這個 BOOL 值會指出多工器是否需要自動調整位元速率，以確保資料不會溢位有漏洞值區。</span><span class="sxs-lookup"><span data-stu-id="47a2f-145">This BOOL value indicates whether the multiplexer needs to adjust the bit rate automatically to ensure that data does not overflow the leaky bucket.</span></span>                                                                                                                                                  |
| [<span data-ttu-id="47a2f-146">**MFPKEY \_ ASFMEDIASINK \_ DRMACTION**</span><span class="sxs-lookup"><span data-stu-id="47a2f-146">**MFPKEY\_ASFMEDIASINK\_DRMACTION**</span></span>](mfpkey-asfmediasink-drmaction-property.md)                    | <span data-ttu-id="47a2f-147">這表示檔案產生的 ASF 媒體接收 DRM 動作。</span><span class="sxs-lookup"><span data-stu-id="47a2f-147">This indicates the ASF media sink DRM action for file generation.</span></span> <span data-ttu-id="47a2f-148">在此版本中，只支援 DRM 轉碼。</span><span class="sxs-lookup"><span data-stu-id="47a2f-148">In this release, only DRM transcode is supported.</span></span>                                                                                                                                                                                   |



 

## <a name="related-topics"></a><span data-ttu-id="47a2f-149">相關主題</span><span class="sxs-lookup"><span data-stu-id="47a2f-149">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="47a2f-150">ASF 媒體接收</span><span class="sxs-lookup"><span data-stu-id="47a2f-150">ASF Media Sinks</span></span>](asf-media-sinks.md)
</dt> <dt>

[<span data-ttu-id="47a2f-151">管線層 ASF 元件</span><span class="sxs-lookup"><span data-stu-id="47a2f-151">Pipeline Layer ASF Components</span></span>](pipeline-layer-asf-components.md)
</dt> <dt>

[<span data-ttu-id="47a2f-152">媒體基礎中的 ASF 支援</span><span class="sxs-lookup"><span data-stu-id="47a2f-152">ASF Support in Media Foundation</span></span>](asf-support-in-media-foundation.md)
</dt> </dl>

 

 
