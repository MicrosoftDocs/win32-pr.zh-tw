---
description: 本主題說明 Microsoft 媒體基礎平臺中工作佇列和執行緒 Windows 8 的改善。
ms.assetid: 9E2A1D94-BF82-488E-8297-D524683ABE17
title: 工作佇列和執行緒改進
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 07b307cb00316696e075e9e9cc2a138e98e149be
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/03/2021
ms.locfileid: "104027682"
---
# <a name="work-queue-and-threading-improvements"></a><span data-ttu-id="b435e-103">工作佇列和執行緒改進</span><span class="sxs-lookup"><span data-stu-id="b435e-103">Work Queue and Threading Improvements</span></span>

<span data-ttu-id="b435e-104">本主題說明 Microsoft 媒體基礎平臺中工作佇列和執行緒 Windows 8 的改善。</span><span class="sxs-lookup"><span data-stu-id="b435e-104">This topic describes improvements in Windows 8 for work queues and threading in the Microsoft Media Foundation platform.</span></span>

-   [<span data-ttu-id="b435e-105">Windows 7 行為</span><span class="sxs-lookup"><span data-stu-id="b435e-105">Windows 7 Behavior</span></span>](#windows-7-behavior)
    -   [<span data-ttu-id="b435e-106">工作佇列</span><span class="sxs-lookup"><span data-stu-id="b435e-106">Work Queues</span></span>](#work-queues)
    -   [<span data-ttu-id="b435e-107">MMCSS 支援</span><span class="sxs-lookup"><span data-stu-id="b435e-107">MMCSS Support</span></span>](#mmcss-support)
    -   [<span data-ttu-id="b435e-108">IMFRealTimeClient</span><span class="sxs-lookup"><span data-stu-id="b435e-108">IMFRealTimeClient</span></span>](#imfrealtimeclientex)
-   [<span data-ttu-id="b435e-109">Windows 8 改進</span><span class="sxs-lookup"><span data-stu-id="b435e-109">Windows 8 Improvements</span></span>](#windows-8-improvements)
    -   [<span data-ttu-id="b435e-110">多執行緒工作佇列</span><span class="sxs-lookup"><span data-stu-id="b435e-110">Multithreaded Work Queues</span></span>](#multithreaded-work-queues)
    -   [<span data-ttu-id="b435e-111">共用工作工作佇列</span><span class="sxs-lookup"><span data-stu-id="b435e-111">Shared Task Work Queues</span></span>](#shared-task-work-queues)
    -   [<span data-ttu-id="b435e-112">等候佇列</span><span class="sxs-lookup"><span data-stu-id="b435e-112">Wait Queue</span></span>](#wait-queue)
    -   [<span data-ttu-id="b435e-113">MMCSS 支援的增強功能</span><span class="sxs-lookup"><span data-stu-id="b435e-113">Enhancements to MMCSS Support</span></span>](#enhancements-to-mmcss-support)
    -   [<span data-ttu-id="b435e-114">IMFRealTimeClientEx</span><span class="sxs-lookup"><span data-stu-id="b435e-114">IMFRealTimeClientEx</span></span>](#imfrealtimeclientex)
    -   [<span data-ttu-id="b435e-115">拓撲分支</span><span class="sxs-lookup"><span data-stu-id="b435e-115">Topology Branches</span></span>](#topology-branches)
-   [<span data-ttu-id="b435e-116">建議</span><span class="sxs-lookup"><span data-stu-id="b435e-116">Recommendations</span></span>](#recommendations)
-   [<span data-ttu-id="b435e-117">總結</span><span class="sxs-lookup"><span data-stu-id="b435e-117">Summary</span></span>](#summary)
-   [<span data-ttu-id="b435e-118">相關主題</span><span class="sxs-lookup"><span data-stu-id="b435e-118">Related topics</span></span>](#related-topics)

## <a name="windows-7-behavior"></a><span data-ttu-id="b435e-119">Windows 7 行為</span><span class="sxs-lookup"><span data-stu-id="b435e-119">Windows 7 Behavior</span></span>

<span data-ttu-id="b435e-120">本節摘要說明 Windows 7 中媒體基礎工作佇列的行為。</span><span class="sxs-lookup"><span data-stu-id="b435e-120">This section summarizes the behavior of Media Foundation work queues in Windows 7.</span></span>

### <a name="work-queues"></a><span data-ttu-id="b435e-121">工作佇列</span><span class="sxs-lookup"><span data-stu-id="b435e-121">Work Queues</span></span>

<span data-ttu-id="b435e-122">媒體基礎平臺會建立數個標準的工作佇列。</span><span class="sxs-lookup"><span data-stu-id="b435e-122">The Media Foundation platform creates several standard work queues.</span></span> <span data-ttu-id="b435e-123">只有兩個記錄為一般應用程式用途：</span><span class="sxs-lookup"><span data-stu-id="b435e-123">Only two are documented as being for general application use:</span></span>

-   <span data-ttu-id="b435e-124">**MFASYNC \_ 回呼 \_ 佇列 \_ 標準**</span><span class="sxs-lookup"><span data-stu-id="b435e-124">**MFASYNC\_CALLBACK\_QUEUE\_STANDARD**</span></span>
-   <span data-ttu-id="b435e-125">**MFASYNC \_ 回呼 \_ 佇列 \_ LONG \_ 函數**</span><span class="sxs-lookup"><span data-stu-id="b435e-125">**MFASYNC\_CALLBACK\_QUEUE\_LONG\_FUNCTION**</span></span>

<span data-ttu-id="b435e-126">應用程式或元件可以藉由呼叫 [**MFAllocateWorkQueue**](/windows/desktop/api/mfapi/nf-mfapi-mfallocateworkqueue) 或 [**MFAllocateWorkQueueEx**](/windows/desktop/api/mfapi/nf-mfapi-mfallocateworkqueueex)來配置新的工作佇列。</span><span class="sxs-lookup"><span data-stu-id="b435e-126">An application or component can allocate new work queues by calling [**MFAllocateWorkQueue**](/windows/desktop/api/mfapi/nf-mfapi-mfallocateworkqueue) or [**MFAllocateWorkQueueEx**](/windows/desktop/api/mfapi/nf-mfapi-mfallocateworkqueueex).</span></span> <span data-ttu-id="b435e-127">**MFAllocateWorkQueueEx** 函式會定義兩種類型的工作佇列：</span><span class="sxs-lookup"><span data-stu-id="b435e-127">The **MFAllocateWorkQueueEx** function defines two types of work queue:</span></span>

-   <span data-ttu-id="b435e-128">**MF \_標準 \_ WORKQUEUE** 會建立工作佇列，而不使用訊息迴圈。</span><span class="sxs-lookup"><span data-stu-id="b435e-128">**MF\_STANDARD\_WORKQUEUE** creates a work queue without a message loop.</span></span>
-   <span data-ttu-id="b435e-129">**MF \_視窗 \_ WORKQUEUE** 會使用訊息迴圈來建立工作佇列。</span><span class="sxs-lookup"><span data-stu-id="b435e-129">**MF\_WINDOW\_WORKQUEUE** creates a work queue with a message loop.</span></span>

<span data-ttu-id="b435e-130">若要將工作專案排入佇列，請呼叫 [**MFPutWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitem) 或 [**MFPutWorkItemEx**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitemex)。</span><span class="sxs-lookup"><span data-stu-id="b435e-130">To queue a work item, call [**MFPutWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitem) or [**MFPutWorkItemEx**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitemex).</span></span> <span data-ttu-id="b435e-131">平臺會藉由叫用呼叫端提供的 [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback)執行來執行工作專案。</span><span class="sxs-lookup"><span data-stu-id="b435e-131">The platform executes the work item by invoking the caller-provided implementation of [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback).</span></span> <span data-ttu-id="b435e-132">在 Windows 7 及更早版本中，平臺會為每個工作佇列建立一個執行緒。</span><span class="sxs-lookup"><span data-stu-id="b435e-132">In Windows 7 and earlier, the platform creates one thread per work queue.</span></span>

### <a name="mmcss-support"></a><span data-ttu-id="b435e-133">MMCSS 支援</span><span class="sxs-lookup"><span data-stu-id="b435e-133">MMCSS Support</span></span>

<span data-ttu-id="b435e-134">[多媒體類別](../procthread/multimedia-class-scheduler-service.md)排程器服務 (MMCSS) 管理執行緒優先順序，讓多媒體應用程式取得 cpu 時間的一般配量，而不會拒絕 cpu 資源給較低優先順序的應用程式。</span><span class="sxs-lookup"><span data-stu-id="b435e-134">The [Multimedia Class Scheduler Service](../procthread/multimedia-class-scheduler-service.md) (MMCSS) manages thread priorities so that multimedia applications get regular slices of CPU time, without denying CPU resources to lower-priority applications.</span></span> <span data-ttu-id="b435e-135">MMCSS 會定義一組具有不同 CPU 使用率配置 *檔的工作* 。</span><span class="sxs-lookup"><span data-stu-id="b435e-135">MMCSS defines a set of *tasks* that have different CPU utilization profiles.</span></span> <span data-ttu-id="b435e-136">當執行緒加入 MMCSS 工作時，MMCSS 會根據數個因素來設定執行緒的優先順序：</span><span class="sxs-lookup"><span data-stu-id="b435e-136">When a thread joins an MMCSS task, MMCSS sets the priority of the thread based on several factors:</span></span>

-   <span data-ttu-id="b435e-137">工作的基本優先權，設定于登錄中。</span><span class="sxs-lookup"><span data-stu-id="b435e-137">The base priority of the task, which is set in the registry.</span></span>
-   <span data-ttu-id="b435e-138">相對執行緒優先順序，會呼叫 [**AvSetMmThreadPriority**](/windows/win32/api/avrt/nf-avrt-avsetmmthreadpriority)在執行時間設定。</span><span class="sxs-lookup"><span data-stu-id="b435e-138">The relative thread priority, which is set at run time by calling [**AvSetMmThreadPriority**](/windows/win32/api/avrt/nf-avrt-avsetmmthreadpriority).</span></span>
-   <span data-ttu-id="b435e-139">各種執行時間特性（例如應用程式是否在前景），以及每個 MMCSS 類別中的執行緒所耗用的 CPU 時間量。</span><span class="sxs-lookup"><span data-stu-id="b435e-139">Various run-time characteristics, such as whether the application is in the foreground, and how much CPU time is being consumed by the threads in each MMCSS class.</span></span>

<span data-ttu-id="b435e-140">應用程式可以藉由呼叫 [**MFBeginRegisterWorkQueueWithMMCSS**](/windows/desktop/api/mfapi/nf-mfapi-mfbeginregisterworkqueuewithmmcss)，向 MMCSS 註冊工作佇列。</span><span class="sxs-lookup"><span data-stu-id="b435e-140">An application can register a work queue with MMCSS by calling [**MFBeginRegisterWorkQueueWithMMCSS**](/windows/desktop/api/mfapi/nf-mfapi-mfbeginregisterworkqueuewithmmcss).</span></span> <span data-ttu-id="b435e-141">此函式會使用工作佇列識別碼、MMCSS 類別 (工作名稱) ，以及 MMCSS 工作識別碼。</span><span class="sxs-lookup"><span data-stu-id="b435e-141">This function takes a work queue ID, an MMCSS class (task name), and the MMCSS task identifier.</span></span> <span data-ttu-id="b435e-142">就內部而言，它會使用工作名稱和工作識別碼來呼叫 [**AvSetMmThreadCharacteristics**](/windows/win32/api/avrt/nf-avrt-avsetmmthreadcharacteristicsa) 。</span><span class="sxs-lookup"><span data-stu-id="b435e-142">Internally, it calls [**AvSetMmThreadCharacteristics**](/windows/win32/api/avrt/nf-avrt-avsetmmthreadcharacteristicsa) with the task name and task ID.</span></span> <span data-ttu-id="b435e-143">使用 MMCSS 註冊工作佇列之後，您可以藉由呼叫 [**MFGetWorkQueueMMCSSClass**](/windows/desktop/api/mfapi/nf-mfapi-mfgetworkqueuemmcssclass) 和 [**MFGetWorkQueueMMCSSTaskId**](/windows/desktop/api/mfapi/nf-mfapi-mfgetworkqueuemmcsstaskid)來取得類別和工作識別碼。</span><span class="sxs-lookup"><span data-stu-id="b435e-143">After a work queue is registered with MMCSS, you can get the class and task ID by calling [**MFGetWorkQueueMMCSSClass**](/windows/desktop/api/mfapi/nf-mfapi-mfgetworkqueuemmcssclass) and [**MFGetWorkQueueMMCSSTaskId**](/windows/desktop/api/mfapi/nf-mfapi-mfgetworkqueuemmcsstaskid).</span></span>

<span data-ttu-id="b435e-144">[媒體會話](media-session.md)透過 [**IMFWorkQueueServices**](/windows/desktop/api/mfidl/nn-mfidl-imfworkqueueservices)介面，提供對這些 api 較高層級的存取。</span><span class="sxs-lookup"><span data-stu-id="b435e-144">The [Media Session](media-session.md) provides somewhat higher-level access to these APIs, through the [**IMFWorkQueueServices**](/windows/desktop/api/mfidl/nn-mfidl-imfworkqueueservices) interface.</span></span> <span data-ttu-id="b435e-145">此介面提供兩種主要方法：</span><span class="sxs-lookup"><span data-stu-id="b435e-145">This interface provides two primary methods:</span></span>

| <span data-ttu-id="b435e-146">方法</span><span class="sxs-lookup"><span data-stu-id="b435e-146">Method</span></span>                                                                                                            | <span data-ttu-id="b435e-147">描述</span><span class="sxs-lookup"><span data-stu-id="b435e-147">Description</span></span>                                                                                                                                                                                                                                                                                   |
|-------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="b435e-148">**BeginRegisterPlatformWorkQueueWithMMCSS**</span><span class="sxs-lookup"><span data-stu-id="b435e-148">**BeginRegisterPlatformWorkQueueWithMMCSS**</span></span>](/windows/desktop/api/mfidl/nf-mfidl-imfworkqueueservices-beginregisterplatformworkqueuewithmmcss)   | <span data-ttu-id="b435e-149">使用 MMCSS 工作註冊工作佇列。</span><span class="sxs-lookup"><span data-stu-id="b435e-149">Registers a work queue with an MMCSS task.</span></span> <span data-ttu-id="b435e-150">這個方法基本上是 [**MFBeginRegisterWorkQueueWithMMCSS**](/windows/desktop/api/mfapi/nf-mfapi-mfbeginregisterworkqueuewithmmcss)上的精簡型包裝函式，但是您可以傳遞 **MFASYNC \_ 回呼 \_ 佇列 \_** 的值，以一次註冊所有平臺工作佇列。</span><span class="sxs-lookup"><span data-stu-id="b435e-150">This method is essentially a thin wrapper around [**MFBeginRegisterWorkQueueWithMMCSS**](/windows/desktop/api/mfapi/nf-mfapi-mfbeginregisterworkqueuewithmmcss), but you can pass the value **MFASYNC\_CALLBACK\_QUEUE\_ALL** to register all of the platform work queues at once.</span></span> |
| [<span data-ttu-id="b435e-151">**BeginRegisterTopologyWorkQueuesWithMMCSS**</span><span class="sxs-lookup"><span data-stu-id="b435e-151">**BeginRegisterTopologyWorkQueuesWithMMCSS**</span></span>](/windows/desktop/api/mfidl/nf-mfidl-imfworkqueueservices-beginregistertopologyworkqueueswithmmcss) | <span data-ttu-id="b435e-152">使用工作佇列註冊拓撲的分支。</span><span class="sxs-lookup"><span data-stu-id="b435e-152">Registers a branch of the topology with a work queue.</span></span>                                                                                                                                                                                                                                         |



 

<span data-ttu-id="b435e-153">若要註冊拓撲分支，請執行下列動作。</span><span class="sxs-lookup"><span data-stu-id="b435e-153">To register a topology branch, do the following.</span></span>

1.  <span data-ttu-id="b435e-154">在分支的來源節點上設定 [ [MF \_ TOPONODE \_ WORKQUEUE \_ 識別碼](mf-toponode-workqueue-id-attribute.md) ] 屬性。</span><span class="sxs-lookup"><span data-stu-id="b435e-154">Set the [MF\_TOPONODE\_WORKQUEUE\_ID](mf-toponode-workqueue-id-attribute.md) attribute on the source node for the branch.</span></span> <span data-ttu-id="b435e-155">使用任何應用程式定義的值。</span><span class="sxs-lookup"><span data-stu-id="b435e-155">Use any application-defined value.</span></span>
2.  <span data-ttu-id="b435e-156">（選擇性）設定 **MF \_ TOPONODE \_ WORKQUEUE \_ MMCSS \_ 類別** ，以將工作佇列加入 MMCSS 工作。</span><span class="sxs-lookup"><span data-stu-id="b435e-156">Optionally, set the **MF\_TOPONODE\_WORKQUEUE\_MMCSS\_CLASS** to join the work queue to an MMCSS task.</span></span>
3.  <span data-ttu-id="b435e-157">針對已解析的拓撲呼叫 [**BeginRegisterTopologyWorkQueuesWithMMCSS**](/windows/desktop/api/mfidl/nf-mfidl-imfworkqueueservices-beginregistertopologyworkqueueswithmmcss) 。</span><span class="sxs-lookup"><span data-stu-id="b435e-157">Call [**BeginRegisterTopologyWorkQueuesWithMMCSS**](/windows/desktop/api/mfidl/nf-mfidl-imfworkqueueservices-beginregistertopologyworkqueueswithmmcss) on the resolved topology.</span></span>

<span data-ttu-id="b435e-158">媒體會話會為每個唯一值的 [MF \_ TOPONODE \_ WORKQUEUE \_ 識別碼](mf-toponode-workqueue-id-attribute.md)配置新的工作佇列。</span><span class="sxs-lookup"><span data-stu-id="b435e-158">The Media Session allocates a new work queue for each unique value of [MF\_TOPONODE\_WORKQUEUE\_ID](mf-toponode-workqueue-id-attribute.md).</span></span> <span data-ttu-id="b435e-159">針對每個拓撲分支，會在指派給分支的工作佇列上執行非同步管線作業。</span><span class="sxs-lookup"><span data-stu-id="b435e-159">For each topology branch, asynchronous pipeline operations are performed on the work queue that is assigned to the branch.</span></span>

### <a name="imfrealtimeclient"></a><span data-ttu-id="b435e-160">IMFRealTimeClient</span><span class="sxs-lookup"><span data-stu-id="b435e-160">IMFRealTimeClient</span></span>

<span data-ttu-id="b435e-161">[**IMFRealTimeClient**](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclient)介面適用于建立自己的執行緒或使用工作佇列進行非同步作業的管線元件。</span><span class="sxs-lookup"><span data-stu-id="b435e-161">The [**IMFRealTimeClient**](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclient) interface is intended for pipeline components that either create their own threads or use work queues for asynchronous operations.</span></span> <span data-ttu-id="b435e-162">媒體會話會使用此介面來通知管線元件的正確行為，如下所示：</span><span class="sxs-lookup"><span data-stu-id="b435e-162">The Media Session uses this interface to notify the pipeline component of the correct behavior, as follows:</span></span>

-   <span data-ttu-id="b435e-163">如果管線元件建立背景工作執行緒， [**IMFRealTimeClient：： RegisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-registerthreads) 方法會通知元件要加入的 MMCSS 類別。</span><span class="sxs-lookup"><span data-stu-id="b435e-163">If the pipeline component creates a worker thread, the [**IMFRealTimeClient::RegisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-registerthreads) method notifies the component which MMCSS class to join.</span></span>
-   <span data-ttu-id="b435e-164">如果管線元件使用工作佇列， [**IMFRealTimeClient：： SetWorkQueue**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-setworkqueue) 方法會告知元件要使用的工作佇列。</span><span class="sxs-lookup"><span data-stu-id="b435e-164">If the pipeline component uses a work queue, the [**IMFRealTimeClient::SetWorkQueue**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-setworkqueue) method tells the component which work queue to use.</span></span>

<span data-ttu-id="b435e-165">通常，管線元件會使用執行緒或工作佇列來執行非同步工作，但不能同時使用這兩種方法。</span><span class="sxs-lookup"><span data-stu-id="b435e-165">Typically, a pipeline component uses either a thread or a work queue to perform asynchronous tasks, but not both.</span></span>

## <a name="windows-8-improvements"></a><span data-ttu-id="b435e-166">Windows 8 改進</span><span class="sxs-lookup"><span data-stu-id="b435e-166">Windows 8 Improvements</span></span>

### <a name="multithreaded-work-queues"></a><span data-ttu-id="b435e-167">多執行緒工作佇列</span><span class="sxs-lookup"><span data-stu-id="b435e-167">Multithreaded Work Queues</span></span>

<span data-ttu-id="b435e-168">在 Windows 8 中，媒體基礎支援稱為 *多執行緒佇列* 的新工作佇列類型。</span><span class="sxs-lookup"><span data-stu-id="b435e-168">In Windows 8, Media Foundation supports a new type of work queue called the *multithreaded queue*.</span></span> <span data-ttu-id="b435e-169">多執行緒佇列使用系統執行緒集區來分派工作專案。</span><span class="sxs-lookup"><span data-stu-id="b435e-169">A multithreaded queue uses a system thread pool to dispatch work items.</span></span> <span data-ttu-id="b435e-170">多執行緒佇列的縮放比例優於先前的單一執行緒佇列。</span><span class="sxs-lookup"><span data-stu-id="b435e-170">The multithreaded queue scales better than the previous single-threaded queues.</span></span> <span data-ttu-id="b435e-171">例如，</span><span class="sxs-lookup"><span data-stu-id="b435e-171">For example,</span></span>

-   <span data-ttu-id="b435e-172">有幾個元件可以共用多執行緒佇列，而不會彼此封鎖，而需要建立較少的執行緒。</span><span class="sxs-lookup"><span data-stu-id="b435e-172">Several components can share a multithreaded queue without blocking one another, requiring the creation of fewer threads.</span></span>

-   <span data-ttu-id="b435e-173">工作專案已優化，以避免在已設定事件時進行內容切換。</span><span class="sxs-lookup"><span data-stu-id="b435e-173">Work items are optimized to avoid context switches if an event is already set.</span></span> <span data-ttu-id="b435e-174">這比建立您自己的執行緒來等候事件更有效率。</span><span class="sxs-lookup"><span data-stu-id="b435e-174">This is more efficient than creating your own threads to wait on events.</span></span>

<span data-ttu-id="b435e-175">使用 [**IMFRealTimeClientEx**](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclientex)時，應用程式應該避免啟動執行緒，而應該改為使用工作佇列。</span><span class="sxs-lookup"><span data-stu-id="b435e-175">When using [**IMFRealTimeClientEx**](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclientex), applications should avoid spinning up threads and instead should use the work queues.</span></span> <span data-ttu-id="b435e-176">為了達成此目的，應用程式應該執行 [**SetWorkQueueEx**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-setworkqueueex) ，而不是使用 [**RegisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-registerthreadsex) 和 [**UnregisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-unregisterthreads)。</span><span class="sxs-lookup"><span data-stu-id="b435e-176">To accomplish this, applications should implement [**SetWorkQueueEx**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-setworkqueueex) and not use [**RegisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-registerthreadsex) and [**UnregisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-unregisterthreads).</span></span>

<span data-ttu-id="b435e-177">當媒體基礎的平臺初始化時，它會建立具有識別碼 **MFASYNC \_ 回呼 \_ 佇列 \_ 多** 執行緒的多執行緒佇列。</span><span class="sxs-lookup"><span data-stu-id="b435e-177">When the Media Foundation platform is initialized, it creates a multithreaded queue with the identifier **MFASYNC\_CALLBACK\_QUEUE\_MULTITHREADED**.</span></span>

<span data-ttu-id="b435e-178">多執行緒佇列不會將工作專案序列化。</span><span class="sxs-lookup"><span data-stu-id="b435e-178">A multithreaded queue does not serialize work items.</span></span> <span data-ttu-id="b435e-179">只要執行緒集區中的執行緒變成可用，就會分派佇列中的下一個工作專案。</span><span class="sxs-lookup"><span data-stu-id="b435e-179">Whenever a thread from the thread pool becomes available, the next work item on the queue is dispatched.</span></span> <span data-ttu-id="b435e-180">呼叫端必須確定已正確序列化工作。</span><span class="sxs-lookup"><span data-stu-id="b435e-180">The caller must ensure that work is serialized correctly.</span></span> <span data-ttu-id="b435e-181">為了簡化此作業，媒體基礎定義了 *序列工作佇列*。</span><span class="sxs-lookup"><span data-stu-id="b435e-181">To make this easier, Media Foundation defines a *serial work queue*.</span></span> <span data-ttu-id="b435e-182">序列佇列會包裝另一個工作佇列，但保證完全序列化執行。</span><span class="sxs-lookup"><span data-stu-id="b435e-182">A serial queue wraps another work queue but guarantees fully serialized execution.</span></span> <span data-ttu-id="b435e-183">在前一個專案完成之前，不會分派佇列中的下一個專案。</span><span class="sxs-lookup"><span data-stu-id="b435e-183">The next item on the queue is not dispatched until the previous item completes.</span></span>

<span data-ttu-id="b435e-184">下列程式碼會透過平臺多執行緒佇列建立序列化程式佇列。</span><span class="sxs-lookup"><span data-stu-id="b435e-184">The following code creates a serializer queue over the platform multithreaded queue.</span></span>


```C++
DWORD workQueueID;
hr = MFAllocateSerialWorkQueue(MFASYNC_CALLBACK_QUEUE_MULTITHREADED, &workQueueID); 
```



<span data-ttu-id="b435e-185">一個以上的序列佇列可以包裝相同的多執行緒佇列。</span><span class="sxs-lookup"><span data-stu-id="b435e-185">More than one serial queue can wrap the same multithreaded queue.</span></span> <span data-ttu-id="b435e-186">然後，序列佇列會共用相同的執行緒集區，並在每個佇列內強制執行序列化執行。</span><span class="sxs-lookup"><span data-stu-id="b435e-186">The serial queues then share the same thread pool, and serialized execution is enforced within each queue.</span></span>

<span data-ttu-id="b435e-187">在 Windows 8 之前存在的標準工作佇列，現在會實作為包裝平臺多執行緒佇列的序列工作佇列。</span><span class="sxs-lookup"><span data-stu-id="b435e-187">The standard work queues that existed prior to Windows 8 are now implemented as serial work queues that wrap the platform multithreaded queue.</span></span> <span data-ttu-id="b435e-188">這種變更可保留回溯相容性。</span><span class="sxs-lookup"><span data-stu-id="b435e-188">This change preserves backward compatibility.</span></span>

### <a name="shared-task-work-queues"></a><span data-ttu-id="b435e-189">共用工作工作佇列</span><span class="sxs-lookup"><span data-stu-id="b435e-189">Shared Task Work Queues</span></span>

<span data-ttu-id="b435e-190">若要正確使用核心排程器，您所使用的每個 MMCSS 工作應該會有一個多執行緒的工作佇列。</span><span class="sxs-lookup"><span data-stu-id="b435e-190">To work correctly with the kernel scheduler, there should be one multithreaded work queue for each MMCSS task that you use.</span></span> <span data-ttu-id="b435e-191">媒體基礎平臺會視需要配置這些設定，每個進程最多可為每個 MMCSS 工作一個。</span><span class="sxs-lookup"><span data-stu-id="b435e-191">The Media Foundation platform allocates these as needed, up to one per MMCSS task, per process.</span></span> <span data-ttu-id="b435e-192">若要取得特定 MMCSS 工作的共用工作佇列，請呼叫 [**MFLockSharedWorkQueue**](/windows/desktop/api/mfapi/nf-mfapi-mflocksharedworkqueue) 並指定工作名稱。</span><span class="sxs-lookup"><span data-stu-id="b435e-192">To get the shared work queue for a particular MMCSS task, call [**MFLockSharedWorkQueue**](/windows/desktop/api/mfapi/nf-mfapi-mflocksharedworkqueue) and specify the task name.</span></span> <span data-ttu-id="b435e-193">函數會查閱資料表中的工作名稱。</span><span class="sxs-lookup"><span data-stu-id="b435e-193">The function looks up the task name in a table.</span></span> <span data-ttu-id="b435e-194">如果工作佇列尚未存在於此工作中，此函式會配置新的 MT 工作佇列，並立即將其加入 MMCSS 工作。</span><span class="sxs-lookup"><span data-stu-id="b435e-194">If a work queue does not already exist for this task, the function allocates a new MT work queue and immediately joins it to the MMCSS task.</span></span> <span data-ttu-id="b435e-195">如果工作佇列已經存在於該工作中，此函式會傳回現有工作佇列的識別碼。</span><span class="sxs-lookup"><span data-stu-id="b435e-195">If a work queue already exists for that task, the function returns the identifier of the existing work queue.</span></span>

### <a name="wait-queue"></a><span data-ttu-id="b435e-196">等候佇列</span><span class="sxs-lookup"><span data-stu-id="b435e-196">Wait Queue</span></span>

<span data-ttu-id="b435e-197">*等候佇列* 是一種特殊的平臺工作佇列，可等候事件收到信號。</span><span class="sxs-lookup"><span data-stu-id="b435e-197">The *wait queue* is a special platform work queue that waits on events to be signaled.</span></span> <span data-ttu-id="b435e-198">如果元件需要等候事件收到信號，則可以使用等候佇列，而不是建立背景工作執行緒來等候事件。</span><span class="sxs-lookup"><span data-stu-id="b435e-198">If a component needs to wait for an event to be signaled, it can use the wait queue instead of creating a worker thread to wait on the event.</span></span>

<span data-ttu-id="b435e-199">若要使用等候佇列，請呼叫 [**MFPutWaitingWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfputwaitingworkitem)。</span><span class="sxs-lookup"><span data-stu-id="b435e-199">To use the wait queue, call [**MFPutWaitingWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfputwaitingworkitem).</span></span> <span data-ttu-id="b435e-200">這些參數包括事件控制碼和 [**IMFAsyncResult**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasyncresult) 指標。</span><span class="sxs-lookup"><span data-stu-id="b435e-200">The parameters include the event handle and an [**IMFAsyncResult**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasyncresult) pointer.</span></span> <span data-ttu-id="b435e-201">當事件收到信號時，等候佇列就會叫用您的回呼。</span><span class="sxs-lookup"><span data-stu-id="b435e-201">When the event is signaled, the wait queue invokes your callback.</span></span> <span data-ttu-id="b435e-202">有單一的平臺等候佇列;應用程式無法建立自己的等候佇列。</span><span class="sxs-lookup"><span data-stu-id="b435e-202">There is a single platform wait queue; applications cannot create their own wait queues.</span></span>

### <a name="enhancements-to-mmcss-support"></a><span data-ttu-id="b435e-203">MMCSS 支援的增強功能</span><span class="sxs-lookup"><span data-stu-id="b435e-203">Enhancements to MMCSS Support</span></span>

<span data-ttu-id="b435e-204">下列新的媒體基礎平臺函數與 MMCSS 相關。</span><span class="sxs-lookup"><span data-stu-id="b435e-204">The following new Media Foundation platform functions relate to MMCSS.</span></span>



| <span data-ttu-id="b435e-205">函式</span><span class="sxs-lookup"><span data-stu-id="b435e-205">Function</span></span>                                                                           | <span data-ttu-id="b435e-206">描述</span><span class="sxs-lookup"><span data-stu-id="b435e-206">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                           |
|------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="b435e-207">**MFBeginRegisterWorkQueueWithMMCSSEx**</span><span class="sxs-lookup"><span data-stu-id="b435e-207">**MFBeginRegisterWorkQueueWithMMCSSEx**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfbeginregisterworkqueuewithmmcssex) | <span data-ttu-id="b435e-208">使用 MMCSS 註冊工作佇列。</span><span class="sxs-lookup"><span data-stu-id="b435e-208">Registers a work queue with MMCSS.</span></span> <span data-ttu-id="b435e-209">此函式包含指定相對執行緒優先順序的參數。</span><span class="sxs-lookup"><span data-stu-id="b435e-209">This function includes a parameter to specify relative thread priority.</span></span> <span data-ttu-id="b435e-210">就內部而言，此值會轉譯成 [**AvSetMmThreadPriority**](/windows/win32/api/avrt/nf-avrt-avsetmmthreadpriority)的呼叫。</span><span class="sxs-lookup"><span data-stu-id="b435e-210">Internally, this value is translated into a call to [**AvSetMmThreadPriority**](/windows/win32/api/avrt/nf-avrt-avsetmmthreadpriority).</span></span>                                                                                                                                                                               |
| [<span data-ttu-id="b435e-211">**MFGetWorkQueueMMCSSPriority**</span><span class="sxs-lookup"><span data-stu-id="b435e-211">**MFGetWorkQueueMMCSSPriority**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfgetworkqueuemmcsspriority)                 | <span data-ttu-id="b435e-212">查詢工作佇列的優先順序。</span><span class="sxs-lookup"><span data-stu-id="b435e-212">Queries the priority of a work queue.</span></span>                                                                                                                                                                                                                                                                                                                                                                 |
| [<span data-ttu-id="b435e-213">**MFRegisterPlatformWithMMCSS**</span><span class="sxs-lookup"><span data-stu-id="b435e-213">**MFRegisterPlatformWithMMCSS**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfregisterplatformwithmmcss)                 | <span data-ttu-id="b435e-214">使用 MMCSS 工作註冊所有平臺的工作佇列。</span><span class="sxs-lookup"><span data-stu-id="b435e-214">Registers all of the platform work queues with an MMCSS task.</span></span> <span data-ttu-id="b435e-215">此函式類似于 [**IMFWorkQueueServices：： BeginRegisterPlatformWorkQueueWithMMCSS**](/windows/desktop/api/mfidl/nf-mfidl-imfworkqueueservices-beginregisterplatformworkqueuewithmmcss) 方法，但可以在不建立媒體會話實例的情況下使用。</span><span class="sxs-lookup"><span data-stu-id="b435e-215">This function is similar to the [**IMFWorkQueueServices::BeginRegisterPlatformWorkQueueWithMMCSS**](/windows/desktop/api/mfidl/nf-mfidl-imfworkqueueservices-beginregisterplatformworkqueuewithmmcss) method, but it can be used without creating an instance of the Media Session.</span></span> <span data-ttu-id="b435e-216">此外，函式還包含參數來指定基底線程優先權。</span><span class="sxs-lookup"><span data-stu-id="b435e-216">In addition, the function includes a parameter to specify the base thread priority.</span></span> |



 

<span data-ttu-id="b435e-217">使用媒體會話的應用程式應該將「適用于音訊轉譯」分支的 [MF \_ TOPONODE \_ WORKQUEUE \_ MMCSS \_ 類別](mf-toponode-workqueue-mmcss-class-attribute.md) 屬性設定為「音訊」。</span><span class="sxs-lookup"><span data-stu-id="b435e-217">Applications that use the Media Session should set the [MF\_TOPONODE\_WORKQUEUE\_MMCSS\_CLASS](mf-toponode-workqueue-mmcss-class-attribute.md) attribute to "Audio" for the audio rendering branch.</span></span> <span data-ttu-id="b435e-218">將影片轉譯分支的屬性設定為「播放」。</span><span class="sxs-lookup"><span data-stu-id="b435e-218">Set the attribute to "Playback" for the video rendering branch.</span></span>

### <a name="imfrealtimeclientex"></a><span data-ttu-id="b435e-219">IMFRealTimeClientEx</span><span class="sxs-lookup"><span data-stu-id="b435e-219">IMFRealTimeClientEx</span></span>

<span data-ttu-id="b435e-220">[**IMFRealTimeClientEx**](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclientex)介面，用來取代執行非同步作業之管線元件的 IMFRealTimeClient。</span><span class="sxs-lookup"><span data-stu-id="b435e-220">The [**IMFRealTimeClientEx**](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclientex) interface to replaces IMFRealTimeClient, for pipeline components that perform asynchronous operations.</span></span>



| <span data-ttu-id="b435e-221">方法</span><span class="sxs-lookup"><span data-stu-id="b435e-221">Method</span></span>                                                             | <span data-ttu-id="b435e-222">描述</span><span class="sxs-lookup"><span data-stu-id="b435e-222">Description</span></span>                                                                                                                                                                                                                    |
|--------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="b435e-223">**RegisterThreadsEx**</span><span class="sxs-lookup"><span data-stu-id="b435e-223">**RegisterThreadsEx**</span></span>](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-registerthreadsex) | <span data-ttu-id="b435e-224">通知元件向 MMCSS 註冊其執行緒。</span><span class="sxs-lookup"><span data-stu-id="b435e-224">Notifies the component to register its threads with MMCSS.</span></span> <span data-ttu-id="b435e-225">這個方法相當於 [**IMFRealTimeClient：： RegisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-registerthreads)，但它會加入基底線程優先順序的參數。</span><span class="sxs-lookup"><span data-stu-id="b435e-225">This method is equivalent to [**IMFRealTimeClient::RegisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-registerthreads), but it adds a parameter for the base thread priority.</span></span> |
| [<span data-ttu-id="b435e-226">**SetWorkQueueEx**</span><span class="sxs-lookup"><span data-stu-id="b435e-226">**SetWorkQueueEx**</span></span>](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-setworkqueueex)       | <span data-ttu-id="b435e-227">通知元件使用特定的工作佇列。</span><span class="sxs-lookup"><span data-stu-id="b435e-227">Notifies the component to use a specific work queue.</span></span> <span data-ttu-id="b435e-228">這個方法相當於 [**IMFReadTimeClient：： SetWorkQueue**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-setworkqueue)，但它會加入工作專案優先順序的參數。</span><span class="sxs-lookup"><span data-stu-id="b435e-228">This method is equivalent to [**IMFReadTimeClient::SetWorkQueue**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-setworkqueue), but it adds a parameter for the work item priority.</span></span>               |
| [<span data-ttu-id="b435e-229">**UnregisterThreads**</span><span class="sxs-lookup"><span data-stu-id="b435e-229">**UnregisterThreads**</span></span>](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-unregisterthreads) | <span data-ttu-id="b435e-230">通知元件從 MMCSS 取消註冊其執行緒。</span><span class="sxs-lookup"><span data-stu-id="b435e-230">Notifies the component to unregister its threads from MMCSS.</span></span> <span data-ttu-id="b435e-231">這個方法與 [**IMFRealTimeClient：： UnregisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-unregisterthreads) 方法相同。</span><span class="sxs-lookup"><span data-stu-id="b435e-231">This method is identical to the [**IMFRealTimeClient::UnregisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-unregisterthreads) method.</span></span>                                       |



 

<span data-ttu-id="b435e-232">管線元件應該使用工作佇列，且不應該建立背景工作執行緒，原因如下：</span><span class="sxs-lookup"><span data-stu-id="b435e-232">Pipeline components should use work queues, and should not create worker threads, for the following reasons:</span></span>

-   <span data-ttu-id="b435e-233">工作佇列的擴充更好，因為它們使用 OS 執行緒集區。</span><span class="sxs-lookup"><span data-stu-id="b435e-233">Work queues scale better, because they use the OS thread pools.</span></span>
-   <span data-ttu-id="b435e-234">平臺會處理使用 MMCSS 註冊工作佇列的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="b435e-234">The platform handles the details of registering work queues with MMCSS.</span></span>
-   <span data-ttu-id="b435e-235">工作者執行緒很容易就會造成難以進行調試的鎖死。</span><span class="sxs-lookup"><span data-stu-id="b435e-235">A worker thread can easily cause a deadlock that is hard to debug.</span></span>

<span data-ttu-id="b435e-236">此外，如果您需要將非同步作業序列化，請考慮使用序列化程式工作佇列。</span><span class="sxs-lookup"><span data-stu-id="b435e-236">Also, consider using the serializer work queue if you need to serialize your asynchronous operations.</span></span>

### <a name="topology-branches"></a><span data-ttu-id="b435e-237">拓撲分支</span><span class="sxs-lookup"><span data-stu-id="b435e-237">Topology Branches</span></span>

<span data-ttu-id="b435e-238">如果 [MF \_ TOPONODE \_ WORKQUEUE \_ MMCSS \_ 類別](mf-toponode-workqueue-mmcss-class-attribute.md) 屬性使用 MMCSS 註冊拓撲分支，WINDOWS 8 媒體會話使用共用的 MT 工作佇列。</span><span class="sxs-lookup"><span data-stu-id="b435e-238">If the [MF\_TOPONODE\_WORKQUEUE\_MMCSS\_CLASS](mf-toponode-workqueue-mmcss-class-attribute.md) attribute registers a topology branch with MMCSS, in Windows 8 the Media Session uses the shared MT work queues.</span></span> <span data-ttu-id="b435e-239">在舊版的 Windows 中，媒體會話已配置新的工作佇列。</span><span class="sxs-lookup"><span data-stu-id="b435e-239">In earlier versions of Windows, the Media Session allocated a new work queue.</span></span>

<span data-ttu-id="b435e-240">針對使用 MMCSS 註冊拓撲分支，定義了兩個新的屬性。</span><span class="sxs-lookup"><span data-stu-id="b435e-240">Two new attributes are defined for registering a topology branch with MMCSS.</span></span>



| <span data-ttu-id="b435e-241">屬性</span><span class="sxs-lookup"><span data-stu-id="b435e-241">Attribute</span></span>                                                                            | <span data-ttu-id="b435e-242">描述</span><span class="sxs-lookup"><span data-stu-id="b435e-242">Description</span></span>                         |
|--------------------------------------------------------------------------------------|-------------------------------------|
| [<span data-ttu-id="b435e-243">MF \_ TOPONODE \_ WORKQUEUE \_ MMCSS \_ PRIORITY</span><span class="sxs-lookup"><span data-stu-id="b435e-243">MF\_TOPONODE\_WORKQUEUE\_MMCSS\_PRIORITY</span></span>](mf-toponode-workqueue-mmcss-priority.md) | <span data-ttu-id="b435e-244">指定基底線程優先權。</span><span class="sxs-lookup"><span data-stu-id="b435e-244">Specifies the base thread priority.</span></span> |
| [<span data-ttu-id="b435e-245">MF \_ TOPONODE \_ WORKQUEUE \_ 專案 \_ 優先順序</span><span class="sxs-lookup"><span data-stu-id="b435e-245">MF\_TOPONODE\_WORKQUEUE\_ITEM\_PRIORITY</span></span>](mf-toponode-workqueue-item-priority.md)   | <span data-ttu-id="b435e-246">指定工作專案優先權。</span><span class="sxs-lookup"><span data-stu-id="b435e-246">Specifies the work item priority.</span></span>   |



 

## <a name="recommendations"></a><span data-ttu-id="b435e-247">建議</span><span class="sxs-lookup"><span data-stu-id="b435e-247">Recommendations</span></span>

-   <span data-ttu-id="b435e-248">使用媒體會話的應用程式應將 [ \_ TOPONODE \_ WORKQUEUE \_ MMCSS \_ 類別](mf-toponode-workqueue-mmcss-class-attribute.md) 設定為音訊轉譯分支的 "音訊"，以及影片轉譯分支的「播放」。</span><span class="sxs-lookup"><span data-stu-id="b435e-248">Applications that use the Media Session should set [MF\_TOPONODE\_WORKQUEUE\_MMCSS\_CLASS](mf-toponode-workqueue-mmcss-class-attribute.md) to "Audio" for the audio rendering branch and "Playback" for the video rendering branch.</span></span>
-   <span data-ttu-id="b435e-249">使用媒體會話的應用程式應該在拓撲上呼叫 [**IMFWorkQueueServices：： BeginRegisterTopologyWorkQueuesWithMMCSS**](/windows/desktop/api/mfidl/nf-mfidl-imfworkqueueservices-beginregistertopologyworkqueueswithmmcss) 。</span><span class="sxs-lookup"><span data-stu-id="b435e-249">Applications that use the Media Session should call [**IMFWorkQueueServices::BeginRegisterTopologyWorkQueuesWithMMCSS**](/windows/desktop/api/mfidl/nf-mfidl-imfworkqueueservices-beginregistertopologyworkqueueswithmmcss) on the topology.</span></span>
-   <span data-ttu-id="b435e-250">針對管線元件，建議使用工作佇列，而不是背景工作執行緒。</span><span class="sxs-lookup"><span data-stu-id="b435e-250">For pipeline components, work queues are recommended instead of worker threads.</span></span> <span data-ttu-id="b435e-251">如果元件使用工作佇列或背景工作執行緒，請執行 [**IMFRealTimeClientEx**](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclientex)。</span><span class="sxs-lookup"><span data-stu-id="b435e-251">If the component uses either work queues or worker threads, implement [**IMFRealTimeClientEx**](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclientex).</span></span>
-   <span data-ttu-id="b435e-252">請勿建立私用工作佇列，因為這樣會失去平臺工作佇列的目的。</span><span class="sxs-lookup"><span data-stu-id="b435e-252">Do not create private work queues, as this defeats the purpose of the platform work queues.</span></span> <span data-ttu-id="b435e-253">請使用平臺多執行緒佇列或包裝平臺多執行緒佇列的序列佇列。</span><span class="sxs-lookup"><span data-stu-id="b435e-253">Use either the platform multithreaded queue or a serial queue that wraps the platform multithreaded queue.</span></span>
-   <span data-ttu-id="b435e-254">如果您需要序列化非同步作業，請使用序列佇列。</span><span class="sxs-lookup"><span data-stu-id="b435e-254">If you need to serialize asynchronous operations, use a serial queue.</span></span>

## <a name="summary"></a><span data-ttu-id="b435e-255">總結</span><span class="sxs-lookup"><span data-stu-id="b435e-255">Summary</span></span>

<span data-ttu-id="b435e-256">下列媒體基礎與執行緒和工作佇列相關的平臺 Api 是 Windows 8 的新。</span><span class="sxs-lookup"><span data-stu-id="b435e-256">The following Media Foundation platform APIs that relate to threads and work queues are new for Windows 8.</span></span>

-   [<span data-ttu-id="b435e-257">MF \_ TOPONODE \_ WORKQUEUE \_ 專案 \_ 優先順序</span><span class="sxs-lookup"><span data-stu-id="b435e-257">MF\_TOPONODE\_WORKQUEUE\_ITEM\_PRIORITY</span></span>](mf-toponode-workqueue-item-priority.md)
-   [<span data-ttu-id="b435e-258">MF \_ TOPONODE \_ WORKQUEUE \_ MMCSS \_ PRIORITY</span><span class="sxs-lookup"><span data-stu-id="b435e-258">MF\_TOPONODE\_WORKQUEUE\_MMCSS\_PRIORITY</span></span>](mf-toponode-workqueue-mmcss-priority.md)
-   [<span data-ttu-id="b435e-259">**MFAllocateSerialWorkQueue**</span><span class="sxs-lookup"><span data-stu-id="b435e-259">**MFAllocateSerialWorkQueue**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfallocateserialworkqueue)
-   [<span data-ttu-id="b435e-260">**MFBeginRegisterWorkQueueWithMMCSSEx**</span><span class="sxs-lookup"><span data-stu-id="b435e-260">**MFBeginRegisterWorkQueueWithMMCSSEx**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfbeginregisterworkqueuewithmmcssex)
-   [<span data-ttu-id="b435e-261">**MFGetWorkQueueMMCSSPriority**</span><span class="sxs-lookup"><span data-stu-id="b435e-261">**MFGetWorkQueueMMCSSPriority**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfgetworkqueuemmcsspriority)
-   [<span data-ttu-id="b435e-262">**MFPutWaitingWorkItem**</span><span class="sxs-lookup"><span data-stu-id="b435e-262">**MFPutWaitingWorkItem**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfputwaitingworkitem)
-   [<span data-ttu-id="b435e-263">**MFPutWorkItem2**</span><span class="sxs-lookup"><span data-stu-id="b435e-263">**MFPutWorkItem2**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitem2)
-   [<span data-ttu-id="b435e-264">**MFPutWorkItemEx2**</span><span class="sxs-lookup"><span data-stu-id="b435e-264">**MFPutWorkItemEx2**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitemex2)
-   [<span data-ttu-id="b435e-265">**MFRegisterPlatformWithMMCSS**</span><span class="sxs-lookup"><span data-stu-id="b435e-265">**MFRegisterPlatformWithMMCSS**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfregisterplatformwithmmcss)
-   [<span data-ttu-id="b435e-266">**MFUnregisterPlatformFromMMCSS**</span><span class="sxs-lookup"><span data-stu-id="b435e-266">**MFUnregisterPlatformFromMMCSS**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfunregisterplatformfrommmcss)
-   [<span data-ttu-id="b435e-267">**MFLockSharedWorkQueue**</span><span class="sxs-lookup"><span data-stu-id="b435e-267">**MFLockSharedWorkQueue**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mflocksharedworkqueue)
-   [<span data-ttu-id="b435e-268">**IMFRealTimeClientEx**</span><span class="sxs-lookup"><span data-stu-id="b435e-268">**IMFRealTimeClientEx**</span></span>](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclientex)

## <a name="related-topics"></a><span data-ttu-id="b435e-269">相關主題</span><span class="sxs-lookup"><span data-stu-id="b435e-269">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="b435e-270">工作佇列</span><span class="sxs-lookup"><span data-stu-id="b435e-270">Work Queues</span></span>](work-queues.md)
</dt> </dl>

 

 
