---
description: 本主題說明如何在 Microsoft 媒體基礎中執行自訂媒體來源。
ms.assetid: 82db6f32-ad94-4563-b8bd-8a5072c5b221
title: 撰寫自訂媒體來源
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8769fa16d4dcbfd3438b66f9a9e78c34274735a5
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/03/2021
ms.locfileid: "106997316"
---
# <a name="writing-a-custom-media-source"></a><span data-ttu-id="d2d8a-103">撰寫自訂媒體來源</span><span class="sxs-lookup"><span data-stu-id="d2d8a-103">Writing a Custom Media Source</span></span>

<span data-ttu-id="d2d8a-104">本主題說明如何在 Microsoft 媒體基礎中執行自訂媒體來源。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-104">This topic describes how to implement a custom media source in Microsoft Media Foundation.</span></span> <span data-ttu-id="d2d8a-105">它包含下列區段：</span><span class="sxs-lookup"><span data-stu-id="d2d8a-105">It contains the following sections:</span></span>

-   [<span data-ttu-id="d2d8a-106">建立簡報描述項</span><span class="sxs-lookup"><span data-stu-id="d2d8a-106">Creating the Presentation Descriptor</span></span>](#creating-the-presentation-descriptor)
-   [<span data-ttu-id="d2d8a-107">啟動媒體來源</span><span class="sxs-lookup"><span data-stu-id="d2d8a-107">Starting the Media Source</span></span>](#starting-the-media-source)
    -   [<span data-ttu-id="d2d8a-108">尋求</span><span class="sxs-lookup"><span data-stu-id="d2d8a-108">Seeking</span></span>](#seeking)
-   [<span data-ttu-id="d2d8a-109">暫停媒體來源</span><span class="sxs-lookup"><span data-stu-id="d2d8a-109">Pausing the Media Source</span></span>](#pausing-the-media-source)
-   [<span data-ttu-id="d2d8a-110">產生來源資料</span><span class="sxs-lookup"><span data-stu-id="d2d8a-110">Generating Source Data</span></span>](#generating-source-data)
    -   [<span data-ttu-id="d2d8a-111">範例要求</span><span class="sxs-lookup"><span data-stu-id="d2d8a-111">Sample Requests</span></span>](#sample-requests)
    -   [<span data-ttu-id="d2d8a-112">配置範例</span><span class="sxs-lookup"><span data-stu-id="d2d8a-112">Allocating Samples</span></span>](#allocating-samples)
    -   [<span data-ttu-id="d2d8a-113">資料流程中的間距</span><span class="sxs-lookup"><span data-stu-id="d2d8a-113">Gaps in the Stream</span></span>](#gaps-in-the-stream)
-   [<span data-ttu-id="d2d8a-114">關閉媒體來源</span><span class="sxs-lookup"><span data-stu-id="d2d8a-114">Shutting Down the Media Source</span></span>](#shutting-down-the-media-source)
-   [<span data-ttu-id="d2d8a-115">即時來源</span><span class="sxs-lookup"><span data-stu-id="d2d8a-115">Live Sources</span></span>](#live-sources)
-   [<span data-ttu-id="d2d8a-116">相關主題</span><span class="sxs-lookup"><span data-stu-id="d2d8a-116">Related topics</span></span>](#related-topics)

## <a name="creating-the-presentation-descriptor"></a><span data-ttu-id="d2d8a-117">建立簡報描述項</span><span class="sxs-lookup"><span data-stu-id="d2d8a-117">Creating the Presentation Descriptor</span></span>

<span data-ttu-id="d2d8a-118">[**IMFMediaSource：： CreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-createpresentationdescriptor)方法會傳回來源展示描述項的複本。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-118">The [**IMFMediaSource::CreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-createpresentationdescriptor) method returns a copy of the source's presentation descriptor.</span></span> <span data-ttu-id="d2d8a-119">若要建立展示描述項，您必須知道來源內容中的資料流程數目，以及每個資料流程的可能格式。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-119">To create the presentation descriptor, you must know the number of streams in the source content, and the possible formats of each stream.</span></span> <span data-ttu-id="d2d8a-120">針對每個資料流程，建立資料流程描述項，如下所示：</span><span class="sxs-lookup"><span data-stu-id="d2d8a-120">For each stream, create a stream descriptor as follows:</span></span>

1.  <span data-ttu-id="d2d8a-121">建立媒體類型的陣列。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-121">Create an array of media types.</span></span> <span data-ttu-id="d2d8a-122">陣列中的每個媒體類型都代表資料流程可能的格式。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-122">Each media type in the array represents a possible format for the stream.</span></span> <span data-ttu-id="d2d8a-123">如需有關建立媒體類型的詳細資訊，請參閱 [媒體類型](media-types.md)。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-123">For more information about creating media types, see [Media Types](media-types.md).</span></span>
2.  <span data-ttu-id="d2d8a-124">呼叫 [**MFCreateStreamDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatestreamdescriptor) 來建立資料流程描述項。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-124">Call [**MFCreateStreamDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatestreamdescriptor) to create the stream descriptor.</span></span> <span data-ttu-id="d2d8a-125">傳入媒體類型的陣列。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-125">Pass in the array of media types.</span></span> <span data-ttu-id="d2d8a-126">函數會傳回 [**IMFStreamDescriptor**](/windows/desktop/api/mfidl/nn-mfidl-imfstreamdescriptor) 指標。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-126">The function returns an [**IMFStreamDescriptor**](/windows/desktop/api/mfidl/nn-mfidl-imfstreamdescriptor) pointer.</span></span>
3.  <span data-ttu-id="d2d8a-127">呼叫 [**IMFStreamDescriptor：： GetMediaTypeHandler**](/windows/desktop/api/mfidl/nf-mfidl-imfstreamdescriptor-getmediatypehandler) 來取得資料流程描述項的媒體類型處理常式。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-127">Call [**IMFStreamDescriptor::GetMediaTypeHandler**](/windows/desktop/api/mfidl/nf-mfidl-imfstreamdescriptor-getmediatypehandler) to get the stream descriptor's media type handler.</span></span>
4.  <span data-ttu-id="d2d8a-128">呼叫 [**IMFMediaTypeHandler：： SetCurrentMediaType**](/windows/desktop/api/mfidl/nf-mfidl-imfmediatypehandler-setcurrentmediatype) 來設定預設資料流程格式。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-128">Call [**IMFMediaTypeHandler::SetCurrentMediaType**](/windows/desktop/api/mfidl/nf-mfidl-imfmediatypehandler-setcurrentmediatype) to set the default stream format.</span></span> <span data-ttu-id="d2d8a-129">使用您在步驟1中建立的其中一種媒體類型。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-129">Use one of the media types that you created in step 1.</span></span> <span data-ttu-id="d2d8a-130">一般而言，您應該使用具有最高品質的格式。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-130">Generally, you should use the format with the highest quality.</span></span>
5.  <span data-ttu-id="d2d8a-131">（選擇性）在資料流程描述項上設定屬性。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-131">Optionally, set attributes on the stream descriptor.</span></span> <span data-ttu-id="d2d8a-132">如需適用于資料流程描述項的屬性清單，請參閱 [資料流程描述項屬性](stream-descriptor-attributes.md)。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-132">For a list of attributes that apply to stream descriptors, see [Stream Descriptor Attributes](stream-descriptor-attributes.md).</span></span>

<span data-ttu-id="d2d8a-133">現在建立簡報描述項：</span><span class="sxs-lookup"><span data-stu-id="d2d8a-133">Now create the presentation descriptor:</span></span>

1.  <span data-ttu-id="d2d8a-134">呼叫 [**MFCreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepresentationdescriptor) 並傳入資料流程描述項的陣列。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-134">Call [**MFCreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepresentationdescriptor) and pass in the array of stream descriptors.</span></span> <span data-ttu-id="d2d8a-135">函數會傳回 [**IMFPresentationDescriptor**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationdescriptor) 指標。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-135">The function returns an [**IMFPresentationDescriptor**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationdescriptor) pointer.</span></span>
2.  <span data-ttu-id="d2d8a-136">藉由呼叫 [**IMFPresentationDescriptor：： SelectStream**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationdescriptor-selectstream) 來選取一或多個資料流程，以選擇預設資料流程選取範圍。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-136">Choose the default stream selection by calling [**IMFPresentationDescriptor::SelectStream**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationdescriptor-selectstream) to select one or more streams.</span></span> <span data-ttu-id="d2d8a-137">預設設定中必須至少選取一個資料流程。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-137">At least one stream must be selected in the default configuration.</span></span>
3.  <span data-ttu-id="d2d8a-138">（選擇性）在表示描述項上設定屬性。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-138">Optionally, set attributes on the presentation descriptor.</span></span> <span data-ttu-id="d2d8a-139">如需適用于資料流程描述項的屬性清單，請參閱 [展示描述項屬性](presentation-descriptor-attributes.md)。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-139">For a list of attributes that apply to stream descriptors, see [Presentation Descriptor Attributes](presentation-descriptor-attributes.md).</span></span>

<span data-ttu-id="d2d8a-140">您應該在啟動時或來源已剖析足夠的來源資料來判斷內容之後，建立簡報描述項一次。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-140">You should create the presentation descriptor once, either at startup or after the source has parsed enough of the source data to determine the contents.</span></span> <span data-ttu-id="d2d8a-141">[**CreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-createpresentationdescriptor)方法應該會傳回展示描述項的複本。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-141">The [**CreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-createpresentationdescriptor) method should return a copy of presentation descriptor.</span></span> <span data-ttu-id="d2d8a-142">若要建立複本，請呼叫 [**IMFPresentationDescriptor：： Clone**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationdescriptor-clone)。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-142">To create the copy, call [**IMFPresentationDescriptor::Clone**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationdescriptor-clone).</span></span> <span data-ttu-id="d2d8a-143">傳回復制可防止用戶端修改原始簡報描述項的狀態，例如屬性或資料流程選取專案。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-143">Returning a copy prevents the client from modifying the state of the original presentation descriptor, such as the attributes or the stream selection.</span></span> <span data-ttu-id="d2d8a-144">不過，請注意， **Clone** 會建立淺層複製，因此用戶端可能會修改基礎資料流程描述項。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-144">However, be aware that **Clone** creates a shallow copy, so the client can potentially modify the underlying stream descriptors.</span></span>

## <a name="starting-the-media-source"></a><span data-ttu-id="d2d8a-145">啟動媒體來源</span><span class="sxs-lookup"><span data-stu-id="d2d8a-145">Starting the Media Source</span></span>

<span data-ttu-id="d2d8a-146">[**IMFMediaSource：： Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start)方法會啟動媒體來源，或搜尋至新的位置。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-146">The [**IMFMediaSource::Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method starts the media source or seeks to a new position.</span></span> <span data-ttu-id="d2d8a-147">當先前狀態為 [已暫停] 或 [執行中]，並指定新的開始時間時， **開始** 的呼叫會導致 *搜尋* 。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-147">A call to **Start** causes a *seek* when the previous state was either paused or running, and a new start time is specified.</span></span> <span data-ttu-id="d2d8a-148">否則， **start** 方法會 *啟動*。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-148">Otherwise, the **Start** method causes a *start*.</span></span> <span data-ttu-id="d2d8a-149">當 **啟動** 作業完成時，傳送下列事件。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-149">When the **Start** operation completes, send the following events.</span></span>

1.  <span data-ttu-id="d2d8a-150">針對每個新的資料流程傳送 [MENewStream](menewstream.md) 事件，也就是先前已取消選取且現在已選取的每個資料流程。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-150">Send an [MENewStream](menewstream.md) event for each new stream—that is, each stream that was previously deselected and is now selected.</span></span> <span data-ttu-id="d2d8a-151">事件資料是資料流程的指標。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-151">The event data is a pointer to the stream.</span></span>
2.  <span data-ttu-id="d2d8a-152">針對每個先前選取且仍選取的資料流程傳送 [MEUpdatedStream](meupdatedstream.md) 事件。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-152">Send an [MEUpdatedStream](meupdatedstream.md) event for each stream that was previously selected and is still selected.</span></span> <span data-ttu-id="d2d8a-153">事件資料是資料流程的指標。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-153">The event data is a pointer to the stream.</span></span> <span data-ttu-id="d2d8a-154"> (不會傳送已取消選取之資料流程的事件。 ) </span><span class="sxs-lookup"><span data-stu-id="d2d8a-154">(Do not send an event for deselected streams.)</span></span>
3.  <span data-ttu-id="d2d8a-155">如果來源正在搜尋，請傳送 [MESourceSeeked](mesourceseeked.md) 事件。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-155">If the source is seeking, send an [MESourceSeeked](mesourceseeked.md) event.</span></span> <span data-ttu-id="d2d8a-156">否則，請傳送 [MESourceStarted](mesourcestarted.md) 事件。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-156">Otherwise, send an [MESourceStarted](mesourcestarted.md) event.</span></span> <span data-ttu-id="d2d8a-157">事件資料是 [**開始**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) 方法中所指定的開始時間。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-157">The event data is the start time that was specified in the [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method.</span></span> <span data-ttu-id="d2d8a-158">針對 MESourceStarted 事件，如果開始時間是 VT \_ 空白，請在事件上設定 [**MF \_ 事件 \_ 來源 \_ 實際 \_ 開始**](mf-event-source-actual-start-attribute.md) 屬性。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-158">For the MESourceStarted event, if the start time is VT\_EMPTY, set the [**MF\_EVENT\_SOURCE\_ACTUAL\_START**](mf-event-source-actual-start-attribute.md) attribute on the event.</span></span> <span data-ttu-id="d2d8a-159">屬性值是實際的開始時間。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-159">The attribute value is the actual start time.</span></span>
4.  <span data-ttu-id="d2d8a-160">針對每個資料流程，如果來源正在搜尋，請傳送 [MEStreamSeeked](mestreamseeked.md) 事件。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-160">For each stream, if the source is seeking, send an [MEStreamSeeked](mestreamseeked.md) event.</span></span> <span data-ttu-id="d2d8a-161">否則，請傳送 [MEStreamStarted](mestreamstarted.md) 事件。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-161">Otherwise, send an [MEStreamStarted](mestreamstarted.md) event.</span></span> <span data-ttu-id="d2d8a-162">事件資料是開始時間。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-162">The event data is the start time.</span></span> <span data-ttu-id="d2d8a-163"> (媒體來源可以呼叫資料流程的 [**IMFMediaEventGenerator：： QueueEvent**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventgenerator-queueevent) 方法，將資料流程上的事件排入佇列。 ) </span><span class="sxs-lookup"><span data-stu-id="d2d8a-163">(The media source can queue an event on the stream by calling the stream's [**IMFMediaEventGenerator::QueueEvent**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventgenerator-queueevent) method.)</span></span>

<span data-ttu-id="d2d8a-164">取消選取資料流程時，會關閉資料流程。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-164">When a stream is deselected, shut down the stream.</span></span> <span data-ttu-id="d2d8a-165">資料流程不應該在該時間點將其他事件排在佇列中。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-165">The stream should not queue any more events at that point.</span></span>

<span data-ttu-id="d2d8a-166">[**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start)方法的時間格式是在 *pguidTimeFormat* 參數中提供。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-166">The time format for the [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method is given in the *pguidTimeFormat* parameter.</span></span> <span data-ttu-id="d2d8a-167">標準時間格式（以 **GUID \_ Null** 表示）是 100-毫微秒單位。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-167">The standard time format, indicated by **GUID\_NULL**, is 100-nanosecond units.</span></span> <span data-ttu-id="d2d8a-168">媒體來源必須支援此時間格式。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-168">A media source must support this time format.</span></span>

### <a name="seeking"></a><span data-ttu-id="d2d8a-169">尋求</span><span class="sxs-lookup"><span data-stu-id="d2d8a-169">Seeking</span></span>

<span data-ttu-id="d2d8a-170">搜尋時，要求的開始位置可能不會落在確切的取樣界限上。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-170">When seeking, the requested start position might not fall on an exact sample boundary.</span></span> <span data-ttu-id="d2d8a-171">此外，針對壓縮的內容，開始位置可能會落在主要畫面格之間。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-171">Also, for compressed content, the start position might fall between key frames.</span></span> <span data-ttu-id="d2d8a-172">資料流程應從所需的最早點傳遞範例，以在要求的開始位置產生未壓縮的範例。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-172">A stream should deliver samples from the earliest point needed to produce an uncompressed sample at the requested start position.</span></span> <span data-ttu-id="d2d8a-173">針對影片，這表示從上一個主要畫面格開始。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-173">For video, that means starting from the previous key frame.</span></span> <span data-ttu-id="d2d8a-174">管線負責從解碼器卸載額外的畫面格，以便在要求的時間開始播放。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-174">The pipeline is responsible for dropping the extra frames from the decoder, so that playback starts at the requested time.</span></span>

<span data-ttu-id="d2d8a-175">來源事件中指定的開始時間 ([MESourceStarted](mesourcestarted.md)、 [MESourceSeeked](mesourceseeked.md)、 [MEStreamStarted](mestreamstarted.md)和 [MEStreamSeeked](mestreamseeked.md)) 是要求的開始時間 ([**開始**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) 方法) 指定的值，而不論實際的開始位置。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-175">The starting time given in the source events ([MESourceStarted](mesourcestarted.md), [MESourceSeeked](mesourceseeked.md), [MEStreamStarted](mestreamstarted.md), and [MEStreamSeeked](mestreamseeked.md)) is the requested starting time (the value given in the [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method), regardless of the actual start position.</span></span>

<span data-ttu-id="d2d8a-176">例如，假設影片串流的前幾個畫面有下列特性：</span><span class="sxs-lookup"><span data-stu-id="d2d8a-176">For example, suppose the first few frames of a video stream have the following characteristics:</span></span>



| <span data-ttu-id="d2d8a-177">範例</span><span class="sxs-lookup"><span data-stu-id="d2d8a-177">Sample</span></span>     | <span data-ttu-id="d2d8a-178">1</span><span class="sxs-lookup"><span data-stu-id="d2d8a-178">1</span></span>       | <span data-ttu-id="d2d8a-179">2</span><span class="sxs-lookup"><span data-stu-id="d2d8a-179">2</span></span>       | <span data-ttu-id="d2d8a-180">3</span><span class="sxs-lookup"><span data-stu-id="d2d8a-180">3</span></span>        | <span data-ttu-id="d2d8a-181">4</span><span class="sxs-lookup"><span data-stu-id="d2d8a-181">4</span></span>        |
|------------|---------|---------|----------|----------|
| <span data-ttu-id="d2d8a-182">Time</span><span class="sxs-lookup"><span data-stu-id="d2d8a-182">Time</span></span>       | <span data-ttu-id="d2d8a-183">33毫秒</span><span class="sxs-lookup"><span data-stu-id="d2d8a-183">33 msec</span></span> | <span data-ttu-id="d2d8a-184">66毫秒</span><span class="sxs-lookup"><span data-stu-id="d2d8a-184">66 msec</span></span> | <span data-ttu-id="d2d8a-185">100毫秒</span><span class="sxs-lookup"><span data-stu-id="d2d8a-185">100 msec</span></span> | <span data-ttu-id="d2d8a-186">133毫秒</span><span class="sxs-lookup"><span data-stu-id="d2d8a-186">133 msec</span></span> |
| <span data-ttu-id="d2d8a-187">主要畫面格？</span><span class="sxs-lookup"><span data-stu-id="d2d8a-187">Key frame?</span></span> | <span data-ttu-id="d2d8a-188">是</span><span class="sxs-lookup"><span data-stu-id="d2d8a-188">Yes</span></span>     | <span data-ttu-id="d2d8a-189">否</span><span class="sxs-lookup"><span data-stu-id="d2d8a-189">No</span></span>      | <span data-ttu-id="d2d8a-190">否</span><span class="sxs-lookup"><span data-stu-id="d2d8a-190">No</span></span>       | <span data-ttu-id="d2d8a-191">是</span><span class="sxs-lookup"><span data-stu-id="d2d8a-191">Yes</span></span>      |



 

<span data-ttu-id="d2d8a-192">如果呼叫 [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) 方法時的值為100毫秒，則來源需要輸出從畫面格1開始的影片（這段時間之前的第一個主要畫面格）。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-192">If the [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method is called with a value of 100 milliseconds, the source needs to output video starting from frame 1, the first key frame prior to this time.</span></span> <span data-ttu-id="d2d8a-193">啟動事件仍會指出事件資料中的100毫秒。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-193">The start event will still indicate 100 milliseconds in the event data.</span></span>

## <a name="pausing-the-media-source"></a><span data-ttu-id="d2d8a-194">暫停媒體來源</span><span class="sxs-lookup"><span data-stu-id="d2d8a-194">Pausing the Media Source</span></span>

<span data-ttu-id="d2d8a-195">[**IMFMediaSource：:P ause**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-pause)方法會暫停媒體來源。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-195">The [**IMFMediaSource::Pause**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-pause) method pauses the media source.</span></span>

<span data-ttu-id="d2d8a-196">當來源暫停時，資料流程可以建立新的範例，並將它們儲存在佇列中，但資料流程不會傳遞範例。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-196">While the source is paused, a stream can create new samples and store them on a queue, but the stream does not deliver the samples.</span></span> <span data-ttu-id="d2d8a-197">以下是此規則的一些例外狀況：</span><span class="sxs-lookup"><span data-stu-id="d2d8a-197">Here are some exceptions to this rule:</span></span>

-   <span data-ttu-id="d2d8a-198">即時來源應該會在暫停時捨棄資料。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-198">Live sources should drop data while paused.</span></span>
-   <span data-ttu-id="d2d8a-199">如果來源從網路取得資料，它可能會暫停伺服器。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-199">If the source gets data from a network, it might pause the server.</span></span>

<span data-ttu-id="d2d8a-200">如果用戶端在來源暫停時呼叫 [**IMFMediaStream：： RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) ，要求也會排入佇列，直到再次啟動來源為止。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-200">If the client calls [**IMFMediaStream::RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) while the source is paused, the request is also queued until the source is started again.</span></span> <span data-ttu-id="d2d8a-201">不應卸載要求。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-201">Requests should not be dropped.</span></span>

<span data-ttu-id="d2d8a-202">只有啟動狀態才允許暫停。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-202">Pausing is allowed only from the started state.</span></span> <span data-ttu-id="d2d8a-203">否則， [**暫停**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-pause) 應該會傳回 **MF \_ E 不正確 \_ \_ 狀態 \_ 轉換**。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-203">Otherwise, [**Pause**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-pause) should return **MF\_E\_INVALID\_STATE\_TRANSITION**.</span></span>

## <a name="generating-source-data"></a><span data-ttu-id="d2d8a-204">產生來源資料</span><span class="sxs-lookup"><span data-stu-id="d2d8a-204">Generating Source Data</span></span>

<span data-ttu-id="d2d8a-205">媒體基礎使用 *提取模型*，這表示資料流程會產生並傳遞範例以回應管線的要求。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-205">Media Foundation uses a *pull model*, meaning that streams generate and deliver samples in response to requests from the pipeline.</span></span> <span data-ttu-id="d2d8a-206">當媒體來源正在執行且已選取資料流程時，資料流程可以傳遞範例。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-206">A stream can deliver samples when the media source is running and the stream is selected.</span></span> <span data-ttu-id="d2d8a-207">只有當用戶端要求新的範例時，資料流程才會傳遞資料。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-207">A stream delivers data only when the client requests a new sample.</span></span>

### <a name="sample-requests"></a><span data-ttu-id="d2d8a-208">範例要求</span><span class="sxs-lookup"><span data-stu-id="d2d8a-208">Sample Requests</span></span>

<span data-ttu-id="d2d8a-209">用戶端會藉由呼叫 [**IMFMediaStream：： RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample)來要求新的範例。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-209">The client requests a new sample by calling [**IMFMediaStream::RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span></span> <span data-ttu-id="d2d8a-210">作業的順序如下：</span><span class="sxs-lookup"><span data-stu-id="d2d8a-210">Here is the sequence of operations:</span></span>

1.  <span data-ttu-id="d2d8a-211">用戶端會呼叫 [**IMFMediaStream：： RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample)。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-211">The client calls [**IMFMediaStream::RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span></span> <span data-ttu-id="d2d8a-212">引數是用戶端用來追蹤要求之選擇性 *token* 物件的指標。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-212">The argument is a pointer to an optional *token* object that the client uses to track the request.</span></span> <span data-ttu-id="d2d8a-213">用戶端會執行權杖。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-213">The client implements the token.</span></span> <span data-ttu-id="d2d8a-214">標記必須公開 **IUnknown** 介面。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-214">Tokens must expose the **IUnknown** interface.</span></span> <span data-ttu-id="d2d8a-215">用戶端也可以傳入 Null 指標，而不是權杖。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-215">The client can also pass in a NULL pointer instead of a token.</span></span>
2.  <span data-ttu-id="d2d8a-216">如果用戶端提供權杖，則媒體資料流程會在權杖上呼叫 **AddRef** ，並將權杖放在先進先出佇列中。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-216">If the client provided a token, the media stream calls **AddRef** on the token and places the token in a first-in, first-out queue.</span></span> <span data-ttu-id="d2d8a-217">方法會傳回，其餘的步驟則會以非同步方式發生。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-217">The method returns, and the remaining steps occur asynchronously.</span></span>

3.  <span data-ttu-id="d2d8a-218">當有更多資料可用時，媒體資料流程會建立新的範例。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-218">When more data is available, the media stream creates a new sample.</span></span> <span data-ttu-id="d2d8a-219"> (此步驟會在下一節中詳細說明。 ) </span><span class="sxs-lookup"><span data-stu-id="d2d8a-219">(This step is described in more detail in the next section.)</span></span>
4.  <span data-ttu-id="d2d8a-220">媒體資料流程會從佇列提取第一個 token。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-220">The media stream pulls the first token from the queue.</span></span>
5.  <span data-ttu-id="d2d8a-221">如果 token 不是 **Null**，則媒體資料流程會在媒體範例上設定 [**MFSampleExtension \_ token**](mfsampleextension-token-attribute.md) 屬性。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-221">If the token is not **NULL**, the media stream sets the [**MFSampleExtension\_Token**](mfsampleextension-token-attribute.md) attribute on the media sample.</span></span> <span data-ttu-id="d2d8a-222">屬性的值是 token 的指標。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-222">The value of the attribute is a pointer to the token.</span></span>
6.  <span data-ttu-id="d2d8a-223">媒體資料流程會傳送 [MEMediaSample](memediasample.md) 事件。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-223">The media stream sends an [MEMediaSample](memediasample.md) event.</span></span> <span data-ttu-id="d2d8a-224">事件資料是範例 [**IMFSample**](/windows/desktop/api/mfobjects/nn-mfobjects-imfsample) 介面的指標。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-224">The event data is a pointer to the sample's [**IMFSample**](/windows/desktop/api/mfobjects/nn-mfobjects-imfsample) interface.</span></span>
7.  <span data-ttu-id="d2d8a-225">如果用戶端提供權杖，則媒體資料流程會在 token 物件上呼叫 **Release** 。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-225">If the client provided a token, the media stream calls **Release** on the token object.</span></span>

<span data-ttu-id="d2d8a-226">如果媒體資料流程無法完成用戶端的 [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) 要求，就會從佇列提取權杖，並在權杖上呼叫 **Release** ，但不會傳送 [MEMediaSample](memediasample.md) 事件。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-226">If the media stream cannot fulfill the client's [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) request, it pulls the token from the queue and calls **Release** on the token, but does not send an [MEMediaSample](memediasample.md) event.</span></span>

<span data-ttu-id="d2d8a-227">用戶端可以使用權杖來追蹤要求的狀態。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-227">The client can use the token to track the status of the request.</span></span> <span data-ttu-id="d2d8a-228">當用戶端收到 [MEMediaSample](memediasample.md) 事件時，它可以從範例取得權杖，並將它與原始要求比對。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-228">When the client receives the [MEMediaSample](memediasample.md) event, it can get the token from the sample and match it against the original request.</span></span> <span data-ttu-id="d2d8a-229">用戶端也可以使用權杖來偵測媒體來源是否已卸載要求。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-229">The client can also use the token to detect if the media source dropped the request.</span></span> <span data-ttu-id="d2d8a-230">如果權杖的參考計數為零，而媒體資料流程未傳送 MEMediaSample 事件，則表示要求已被捨棄。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-230">If the token's reference count falls to zero and the media stream does not send an MEMediaSample event, it means that the request was dropped.</span></span>

<span data-ttu-id="d2d8a-231">此處所列的步驟假設 [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) 方法會實作為非同步作業。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-231">The steps listed here assume that [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) method is implemented as an asynchronous operation.</span></span> <span data-ttu-id="d2d8a-232">如果方法是同步的，您就不需要將要求權杖放在佇列上。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-232">If the method is synchronous, you do not need to put the request token on a queue.</span></span> <span data-ttu-id="d2d8a-233">但是，如果產生資料需要相當長的時間，建議使用非同步方法，例如，如果來源從位元組資料流程讀取資料。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-233">However, if generating data takes any significant amount of time, an asynchronous approach is recommended—for example, if the source reads data from a byte stream.</span></span>

<span data-ttu-id="d2d8a-234">資料流程負責緩衝處理 [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample)呼叫之間累積的任何資料。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-234">The stream is responsible for buffering any data that accumulates between calls to [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span></span>

<span data-ttu-id="d2d8a-235">當媒體資料流程到達資料流程的結尾時，它會在最後一個範例之後傳送 [MEEndOfStream](meendofstream.md) 事件。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-235">When the media stream reaches the end of the stream, it sends an [MEEndOfStream](meendofstream.md) event after the last sample.</span></span> <span data-ttu-id="d2d8a-236">在每個資料流程結束後，媒體來源會傳送 [MEEndOfPresentation](meendofpresentation.md) 事件。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-236">After every stream has ended, the media source sends an [MEEndOfPresentation](meendofpresentation.md) event.</span></span> <span data-ttu-id="d2d8a-237">當媒體資料流程傳送 MEEndOfStream 事件之後， [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) 方法會傳回 **MF \_ E \_ 結束 \_ 的 \_ 資料流程** ，直到重新開機來源為止。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-237">After a media stream sends the MEEndOfStream event, the [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) method returns **MF\_E\_END\_OF\_STREAM** until the source is restarted.</span></span>

### <a name="allocating-samples"></a><span data-ttu-id="d2d8a-238">配置範例</span><span class="sxs-lookup"><span data-stu-id="d2d8a-238">Allocating Samples</span></span>

<span data-ttu-id="d2d8a-239">當資料流程準備好填滿暫止的範例要求時，它會建立新的範例，並將一或多個媒體緩衝區新增至範例。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-239">When the stream is ready to fill a pending sample request, it creates a new sample and adds one or more media buffers to the sample.</span></span> <span data-ttu-id="d2d8a-240">如需有關建立媒體緩衝區的詳細資訊，請參閱 [媒體緩衝區](media-buffers.md)。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-240">For more information about creating media buffers, see [Media Buffers](media-buffers.md).</span></span>

<span data-ttu-id="d2d8a-241">如果已知，資料流程必須設定時間戳記和持續時間。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-241">The stream must set the time stamp and the duration, if known.</span></span> <span data-ttu-id="d2d8a-242">時間戳記相對於來源。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-242">The time stamp is relative to the source.</span></span> <span data-ttu-id="d2d8a-243">在大部分情況下，內容的開頭會對應到時間戳記0。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-243">In most cases, the start of the content corresponds to a time stamp of zero.</span></span> <span data-ttu-id="d2d8a-244">例如，如果來源從媒體檔案讀取，則檔案的開頭會有時間戳記為零。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-244">For example, if the source reads from a media file, the start of the file would have a time stamp of zero.</span></span>

<span data-ttu-id="d2d8a-245">範例上的時間戳記不一定等於呈現時間。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-245">The time stamp on the sample does not necessarily equal the presentation time.</span></span> <span data-ttu-id="d2d8a-246">媒體會話會從來源時間轉譯為呈現時間。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-246">The Media Session translates from source time to presentation time.</span></span> <span data-ttu-id="d2d8a-247">針對壓縮的資料，資料流程應該在開始時間之前從最接近的主要畫面格產生資料。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-247">For compressed data, the stream should generate data starting from the nearest key frame before the start time.</span></span> <span data-ttu-id="d2d8a-248">這可讓解碼器傳遞在要求的開始時間出現的畫面格。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-248">This enables the decoder to deliver the frame that appears at the requested start time.</span></span> <span data-ttu-id="d2d8a-249">否則，必須等到下列主要 ) 畫面格之後，才 (。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-249">(Otherwise, the decoder would need to wait until the following key frame.)</span></span>

<span data-ttu-id="d2d8a-250">如果播放速率比1.0 更快或更慢，則管線會調整呈現時鐘的速率。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-250">If the playback rate is faster or slower than 1.0, the pipeline adjusts the rate of the presentation clock.</span></span> <span data-ttu-id="d2d8a-251">來源不會調整範例上的時間戳記。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-251">The source does not adjust the time stamps on samples.</span></span>

<span data-ttu-id="d2d8a-252">來源可以設定屬性，以設定此範例的其他資訊。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-252">The source can set additional information on the sample by setting attributes.</span></span> <span data-ttu-id="d2d8a-253">如需範例屬性的清單，請參閱 [範例屬性](sample-attributes.md)。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-253">For a list of sample attributes, see [Sample Attributes](sample-attributes.md).</span></span>

### <a name="gaps-in-the-stream"></a><span data-ttu-id="d2d8a-254">資料流程中的間距</span><span class="sxs-lookup"><span data-stu-id="d2d8a-254">Gaps in the Stream</span></span>

<span data-ttu-id="d2d8a-255">如果資料流程包含明顯長度的間隙，建議資料流程傳送 [MEStreamTick](mestreamtick.md) 事件。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-255">If a stream contains a gap of significant length, it is recommended that the stream send an [MEStreamTick](mestreamtick.md) event.</span></span> <span data-ttu-id="d2d8a-256">此事件會通知用戶端缺少範例。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-256">This event notifies the client that a sample is missing.</span></span> <span data-ttu-id="d2d8a-257">事件資料是遺失範例的時間戳記，以 100-毫微秒單位 (**VT \_ I8**) 。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-257">The event data is the time stamp of the missing sample, in 100-nanosecond units (**VT\_I8**).</span></span> <span data-ttu-id="d2d8a-258">此事件可以儲存下游元件，使其無法等候不會抵達的範例。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-258">This event can save downstream components from waiting for samples that will not arrive.</span></span> <span data-ttu-id="d2d8a-259">資料流程可以視需要傳送任意數量的 MEStreamTick 事件，以跨越資料流程中的間距。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-259">The stream can send as many MEStreamTick events as needed to span the gap in the stream.</span></span>

## <a name="shutting-down-the-media-source"></a><span data-ttu-id="d2d8a-260">關閉媒體來源</span><span class="sxs-lookup"><span data-stu-id="d2d8a-260">Shutting Down the Media Source</span></span>

<span data-ttu-id="d2d8a-261">當用戶端使用媒體來源完成時，它會呼叫 [**IMFMediaSource：： Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-shutdown)。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-261">When the client is done using the media source, it calls [**IMFMediaSource::Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-shutdown).</span></span> <span data-ttu-id="d2d8a-262">在這個方法內，媒體來源應該會中斷任何迴圈的參考計數。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-262">Inside this method, the media source should break any circular reference counts.</span></span> <span data-ttu-id="d2d8a-263">一般而言，媒體來源和媒體串流之間會有迴圈參考。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-263">Typically, there will be circular references between the media source and the media streams.</span></span>

<span data-ttu-id="d2d8a-264">如果您使用事件佇列來執行 [**IMFMediaEventGenerator**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator)，請在事件佇列上呼叫 [**IMFMediaEventQueue：： Shutdown**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventqueue-shutdown) 。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-264">If you are using the event queue to implement [**IMFMediaEventGenerator**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator), call [**IMFMediaEventQueue::Shutdown**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventqueue-shutdown) on the event queue.</span></span> <span data-ttu-id="d2d8a-265">這個方法會關閉事件佇列，並對目前正在等候事件的任何呼叫端發出信號。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-265">This method shuts down the event queue and signals any caller that is currently waiting for an event.</span></span>

<span data-ttu-id="d2d8a-266">關機之後，來源上的所有方法都會傳回 **MF \_ E \_ 關機**，但 **IUnknown** 方法除外。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-266">After shutdown, all methods on the source return **MF\_E\_SHUTDOWN**, with the exception of **IUnknown** methods.</span></span>

## <a name="live-sources"></a><span data-ttu-id="d2d8a-267">即時來源</span><span class="sxs-lookup"><span data-stu-id="d2d8a-267">Live Sources</span></span>

<span data-ttu-id="d2d8a-268">從 Windows 7 開始，媒體基礎會自動支援音訊和影片捕獲裝置。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-268">Starting in Windows 7, Media Foundation automatically supports audio and video capture devices.</span></span> <span data-ttu-id="d2d8a-269">若為影片，裝置必須在影片捕獲類別中提供內核串流 (KS) 迷你驅動程式。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-269">For video, the device must provide a kernel streaming (KS) minidriver in the video capture category.</span></span> <span data-ttu-id="d2d8a-270">媒體基礎使用 PnP 路徑來列舉裝置。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-270">Media Foundation uses the PnP path to enumerate the device.</span></span> <span data-ttu-id="d2d8a-271">若是音訊，媒體基礎會使用 Windows 多媒體裝置 (MMDevice) API 來列舉音訊端點裝置。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-271">For audio, Media Foundation uses the Windows Multimedia Device (MMDevice) API to enumerate audio endpoint devices.</span></span> <span data-ttu-id="d2d8a-272">如果裝置符合這些條件，就不需要執行自訂媒體來源。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-272">If the device meets these criteria, there is no need to implement a custom media source.</span></span>

<span data-ttu-id="d2d8a-273">不過，您可能會想要為某些其他類型的裝置或其他即時資料源，執行自訂媒體來源。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-273">However, you might want to implement a custom media source for some other type of device or other live data source.</span></span> <span data-ttu-id="d2d8a-274">即時來源與其他媒體來源之間只有幾個差異：</span><span class="sxs-lookup"><span data-stu-id="d2d8a-274">There are only a few differences between a live source and other media sources:</span></span>

-   <span data-ttu-id="d2d8a-275">在 [**IMFMediaSource：： GetCharacteristics**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-getcharacteristics) 方法中，傳回 **MFMEDIASOURCE \_ 為 \_ 即時** 旗標。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-275">In the [**IMFMediaSource::GetCharacteristics**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-getcharacteristics) method, return the **MFMEDIASOURCE\_IS\_LIVE** flag.</span></span>
-   <span data-ttu-id="d2d8a-276">第一個範例的時間戳記應為零。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-276">The first sample should have a time stamp of zero.</span></span>
-   <span data-ttu-id="d2d8a-277">事件和串流狀態的處理方式與媒體來源相同，但暫停狀態除外。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-277">Events and streaming states are handled the same as media sources, with the exception of the paused state.</span></span>
-   <span data-ttu-id="d2d8a-278">暫停時，請勿將範例排在佇列中。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-278">While paused, do not queue samples.</span></span> <span data-ttu-id="d2d8a-279">卸載任何在暫停時產生的資料。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-279">Drop any data that is generated while paused.</span></span>
-   <span data-ttu-id="d2d8a-280">即時來源通常不支援搜尋、反向播放或速率控制。</span><span class="sxs-lookup"><span data-stu-id="d2d8a-280">Live sources typically do not support seeking, reverse play, or rate control.</span></span>

## <a name="related-topics"></a><span data-ttu-id="d2d8a-281">相關主題</span><span class="sxs-lookup"><span data-stu-id="d2d8a-281">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="d2d8a-282">媒體來源</span><span class="sxs-lookup"><span data-stu-id="d2d8a-282">Media Sources</span></span>](media-sources.md)
</dt> <dt>

[<span data-ttu-id="d2d8a-283">教學課程：撰寫自訂媒體來源</span><span class="sxs-lookup"><span data-stu-id="d2d8a-283">Tutorial: Writing a Custom Media Source</span></span>](tutorial--writing-a-custom-media-source.md)
</dt> </dl>

 

 



