---
description: 直接操作 Api 可讓您建立絕佳的平移、縮放和拖曳使用者體驗。 若要這樣做，它會在區域或物件上處理觸控輸入、產生輸出轉換，然後將轉換套用至 UI 元素。
ms.assetid: 26358bc5-71e9-40f0-9243-9bddd961a0e5
title: 直接操作
ms.topic: article
ms.date: 02/03/2020
ms.openlocfilehash: 6db2a50893914dfb25050768f88cb289a1ecf3ea
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/06/2021
ms.locfileid: "104109045"
---
# <a name="direct-manipulation"></a><span data-ttu-id="ce871-104">直接操作</span><span class="sxs-lookup"><span data-stu-id="ce871-104">Direct Manipulation</span></span>

<span data-ttu-id="ce871-105">直接操作 Api 可讓您建立絕佳的平移、縮放和拖曳使用者體驗。</span><span class="sxs-lookup"><span data-stu-id="ce871-105">The Direct Manipulation APIs let you create great pan, zoom, and drag user experiences.</span></span> <span data-ttu-id="ce871-106">若要這樣做，它會在區域或物件上處理觸控輸入、產生輸出轉換，然後將轉換套用至 UI 元素。</span><span class="sxs-lookup"><span data-stu-id="ce871-106">To do this, it processes touch input on a region or object, generates output transforms, and applies the transforms to UI elements.</span></span> <span data-ttu-id="ce871-107">您可以使用直接操作，透過執行緒輸入處理、選擇性的非執行緒輸入點擊測試，以及輸入/輸出預測，來將回應優化並降低延遲。</span><span class="sxs-lookup"><span data-stu-id="ce871-107">You can use Direct Manipulation to optimize responsiveness and reduce latency through off-thread input processing, optional off-thread input hit testing, and input/output prediction.</span></span>

<span data-ttu-id="ce871-108">任何使用直接操作來處理觸控互動的應用程式，都會顯示符合 [一般使用者互動方針](/windows/uwp/design/input/)的流暢 Windows 8 動畫與互動意見反應行為。</span><span class="sxs-lookup"><span data-stu-id="ce871-108">Any application that uses Direct Manipulation to process touch interactions displays the fluid Windows 8 animations and interaction feedback behaviors that conform to the [Guidelines for common user interactions](/windows/uwp/design/input/).</span></span>

## <a name="developer-audience"></a><span data-ttu-id="ce871-109">開發人員讀者</span><span class="sxs-lookup"><span data-stu-id="ce871-109">Developer Audience</span></span>

<span data-ttu-id="ce871-110">直接操作 API 適用于熟悉 C/c + + 的有經驗的開發人員，對於 [元件物件模型 (的 COM) ](../com/component-object-model--com--portal.md)有充分的瞭解，而且熟悉 Windows 程式設計概念。</span><span class="sxs-lookup"><span data-stu-id="ce871-110">The Direct Manipulation API is for experienced developers who know C/C++, have a solid understanding of the [Component Object Model (COM)](../com/component-object-model--com--portal.md), and are familiar with Windows programming concepts.</span></span>

## <a name="run-time-requirements"></a><span data-ttu-id="ce871-111">執行階段需求求</span><span class="sxs-lookup"><span data-stu-id="ce871-111">Run-time requirements</span></span>

<span data-ttu-id="ce871-112">直接操作是在 Windows 8 引進。</span><span class="sxs-lookup"><span data-stu-id="ce871-112">Direct Manipulation was introduced in Windows 8.</span></span> <span data-ttu-id="ce871-113">它包含在32位和64位版本中。</span><span class="sxs-lookup"><span data-stu-id="ce871-113">It is included in both 32-bit and 64-bit versions.</span></span>

## <a name="why-use-directmanipulation"></a><span data-ttu-id="ce871-114">為何要使用 DirectManipulation</span><span class="sxs-lookup"><span data-stu-id="ce871-114">Why use DirectManipulation</span></span>

### <a name="handles-interactions-in-a-straightforward-and-consistent-manner"></a><span data-ttu-id="ce871-115">以簡單且一致的方式處理互動</span><span class="sxs-lookup"><span data-stu-id="ce871-115">Handles interactions in a straightforward and consistent manner</span></span>

<span data-ttu-id="ce871-116">直接操作的運作方式是預先宣告區域或物件的行為和互動。</span><span class="sxs-lookup"><span data-stu-id="ce871-116">Direct Manipulation works by pre-declaring the behaviors and interactions for a region or object.</span></span> <span data-ttu-id="ce871-117">例如，網頁通常會設定為平移和縮放。</span><span class="sxs-lookup"><span data-stu-id="ce871-117">For example, a web page is often configured for pan and zoom.</span></span> <span data-ttu-id="ce871-118">在執行時間，輸入會透過簡單的 API 呼叫，與此區域/物件產生關聯。</span><span class="sxs-lookup"><span data-stu-id="ce871-118">At runtime, input is then associated with this region/object through a simple API call.</span></span> <span data-ttu-id="ce871-119">從這個點開始，向前操作會執行所有處理輸入、套用條件約束和特性，以及產生輸出轉換的繁重工作。</span><span class="sxs-lookup"><span data-stu-id="ce871-119">From this point forward Direct Manipulation does all the heavy lifting of processing the input, applying constraints and personality, and generating the output transforms.</span></span>

### <a name="build-responsive-touch-applications"></a><span data-ttu-id="ce871-120">打造回應式觸控應用程式</span><span class="sxs-lookup"><span data-stu-id="ce871-120">Build responsive touch applications</span></span>

<span data-ttu-id="ce871-121">為了將回應優化並將延遲降到最低，直接操作處理會在與 UI 執行緒不同的獨立執行緒上進行。</span><span class="sxs-lookup"><span data-stu-id="ce871-121">To optimize responsiveness and minimize latency, Direct Manipulation processing occurs on a separate, independent thread from the UI thread.</span></span> <span data-ttu-id="ce871-122">因此，輸出轉換可以平行執行至 UI 執行緒上的活動。</span><span class="sxs-lookup"><span data-stu-id="ce871-122">As a result, output transforms can run in parallel to activity on the UI thread.</span></span> <span data-ttu-id="ce871-123">UI 執行緒活動可能包含應用程式邏輯、轉譯、配置，以及在處理器上使用迴圈的任何其他作業。</span><span class="sxs-lookup"><span data-stu-id="ce871-123">The UI thread activity may include application logic, rendering, layout, and anything else that consumes cycles on the processor.</span></span>

### <a name="implementation-flexibility"></a><span data-ttu-id="ce871-124">實作為彈性</span><span class="sxs-lookup"><span data-stu-id="ce871-124">Implementation flexibility</span></span>

<span data-ttu-id="ce871-125">直接操作包含的介面可提供輸入處理、互動辨識、意見反應通知和 UI 更新的完整支援。</span><span class="sxs-lookup"><span data-stu-id="ce871-125">The interfaces included with Direct Manipulation provide comprehensive support for input handling, interaction recognition, feedback notifications, and UI updates.</span></span> <span data-ttu-id="ce871-126">這些介面也會納入系統服務（例如 [DirectComposition](../directcomp/directcomposition-portal.md)）。</span><span class="sxs-lookup"><span data-stu-id="ce871-126">The interfaces also incorporate system services such as [DirectComposition](../directcomp/directcomposition-portal.md).</span></span>

## <a name="basic-concepts"></a><span data-ttu-id="ce871-127">基本概念</span><span class="sxs-lookup"><span data-stu-id="ce871-127">Basic concepts</span></span>

<span data-ttu-id="ce871-128">最基本的直接操作實行包含一個 *區*、 *內容* 和 *互動*。</span><span class="sxs-lookup"><span data-stu-id="ce871-128">The most basic Direct Manipulation implementation consists of a *viewport*, *content*, and *interactions*.</span></span> <span data-ttu-id="ce871-129">此 *區* 是能夠接收和處理使用者互動輸入的區域。</span><span class="sxs-lookup"><span data-stu-id="ce871-129">The *viewport* is a region that is able to receive and process input from user interactions.</span></span> <span data-ttu-id="ce871-130">它也是使用者可以看見的內容區域。</span><span class="sxs-lookup"><span data-stu-id="ce871-130">It is also the region of the content that is visible to the end-user.</span></span> <span data-ttu-id="ce871-131">*內容* 是使用者可以看到的實際物件，也是移動或調整以回應使用者互動的物件。</span><span class="sxs-lookup"><span data-stu-id="ce871-131">The *content* is the actual object that end-users can see and is what moves or scales in response to a user interaction.</span></span> <span data-ttu-id="ce871-132">主要使用者 *互動* (也稱為 *操作* ，) 直接操作所支援的移動和縮放。</span><span class="sxs-lookup"><span data-stu-id="ce871-132">The primary user *interactions* (also known as *manipulations*) supported by Direct Manipulation are panning and zooming.</span></span> <span data-ttu-id="ce871-133">這些互動會分別將轉譯或調整轉換套用至各區中的內容。</span><span class="sxs-lookup"><span data-stu-id="ce871-133">These interactions apply a translate or scale transform to the content within the viewport, respectively.</span></span> <span data-ttu-id="ce871-134">您可以在單一視窗中設定多個可 (多個不同) 的範圍，以建立豐富的 UI 體驗。</span><span class="sxs-lookup"><span data-stu-id="ce871-134">Multiple viewports (each with their own content) can be configured in a single window to create a rich UI experience.</span></span>

<span data-ttu-id="ce871-135">下圖顯示移動前和之後的基本直接操作實行。</span><span class="sxs-lookup"><span data-stu-id="ce871-135">This figure shows a basic Direct Manipulation implementation before and after panning.</span></span>

![移動前和之後的基本直接操作實行。](images/dm-art-1.png)

<span data-ttu-id="ce871-137">在直接操作的初始化期間，會具現化 **DCompDirectManipulationCompositor** 物件，並且與直接操作相關聯。</span><span class="sxs-lookup"><span data-stu-id="ce871-137">During initialization of Direct Manipulation a **DCompDirectManipulationCompositor** object is instantiated and is associated with Direct Manipulation.</span></span> <span data-ttu-id="ce871-138">此物件是 [DirectComposition](../directcomp/directcomposition-portal.md)的包裝函式，也就是系統組合器。</span><span class="sxs-lookup"><span data-stu-id="ce871-138">This object is a wrapper around [DirectComposition](../directcomp/directcomposition-portal.md), which is the system compositor.</span></span> <span data-ttu-id="ce871-139">物件負責套用輸出轉換和驅動視覺效果更新。</span><span class="sxs-lookup"><span data-stu-id="ce871-139">The object is responsible for applying the output transforms and driving visual updates.</span></span>

<span data-ttu-id="ce871-140">連絡人代表在 [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md)訊息中提供的 **pointerId** 所識別的觸控點。</span><span class="sxs-lookup"><span data-stu-id="ce871-140">A contact represents a touch point identified by the **pointerId** provided in the [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) message.</span></span> <span data-ttu-id="ce871-141">當收到 **WM \_ POINTERDOWN** 訊息時，應用程式會呼叫 [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact)。</span><span class="sxs-lookup"><span data-stu-id="ce871-141">When a **WM\_POINTERDOWN** message is received, the application calls [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact).</span></span> <span data-ttu-id="ce871-142">應用程式會通知直接 Manipulationabout 應該處理的連絡人，以及應該對這些連絡人進行回應的 () 的區。</span><span class="sxs-lookup"><span data-stu-id="ce871-142">The application notifies Direct Manipulationabout the contacts that should be handled and the viewport(s) that should react to those contacts.</span></span> <span data-ttu-id="ce871-143">鍵盤和滑鼠輸入具有特殊的 **pointerId** 值，因此可以透過直接操作來適當地處理。</span><span class="sxs-lookup"><span data-stu-id="ce871-143">Keyboard and mouse input have special **pointerId** values so they can be handled appropriately by Direct Manipulation.</span></span>

<span data-ttu-id="ce871-144">在上述的基本案例中，當呼叫 [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) 時，會發生幾件事：</span><span class="sxs-lookup"><span data-stu-id="ce871-144">In our basic case above, when [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) is called a few things happen:</span></span>

- <span data-ttu-id="ce871-145">當使用者執行平移時，會將 [WM/_POINTERCAPTURECHANGED](../inputmsg/wm-pointercapturechanged.md) 訊息傳送至應用程式，以通知連絡人已被直接操作取用。</span><span class="sxs-lookup"><span data-stu-id="ce871-145">When the user performs a pan, a [WM/_POINTERCAPTURECHANGED](../inputmsg/wm-pointercapturechanged.md) message is sent to the application to notify that the contact has been consumed by Direct Manipulation.</span></span>
- <span data-ttu-id="ce871-146">當使用者移動移動時，此區會引發 [DirectComposition](../directcomp/directcomposition-portal.md) 包裝函式所使用的更新事件，以驅動視覺效果更新至螢幕。</span><span class="sxs-lookup"><span data-stu-id="ce871-146">When the user moves the moves, the viewport fires update events which are used by the [DirectComposition](../directcomp/directcomposition-portal.md) wrapper to drive visual updates to the screen.</span></span> <span data-ttu-id="ce871-147">若要在使用者移動區中移動，內容會顯示在連絡人下順暢地移動。</span><span class="sxs-lookup"><span data-stu-id="ce871-147">To a user panning in a viewport, the content will appear to move smoothly under the contact.</span></span>
- <span data-ttu-id="ce871-148">當使用者將連絡人貼上時，使用者會看到內容在轉換成慣性動畫時繼續移動，並逐漸減速到到達最後的放置位置為止。</span><span class="sxs-lookup"><span data-stu-id="ce871-148">When the user lifts the contact, the user sees the content continue to move as it transitions into an inertia animation, gradually decelerating until it reaches its final resting place.</span></span>

## <a name="processing-keyboard-and-mouse-input"></a><span data-ttu-id="ce871-149">處理鍵盤和滑鼠輸入</span><span class="sxs-lookup"><span data-stu-id="ce871-149">Processing keyboard and mouse input</span></span>

<span data-ttu-id="ce871-150">直接操作可讓您透過 [**ProcessInput**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationmanager-processinput) API，從應用程式 UI 執行緒手動轉送鍵盤和滑鼠訊息，讓直接操作能夠適當地處理。</span><span class="sxs-lookup"><span data-stu-id="ce871-150">Direct Manipulation allows keyboard and mouse messages to be forwarded manually from the application UI thread via the [**ProcessInput**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationmanager-processinput) API such that they can be handled appropriately by Direct Manipulation.</span></span>

## <a name="directmanipulation-and-the-hwnd"></a><span data-ttu-id="ce871-151">DirectManipulation 和 HWND</span><span class="sxs-lookup"><span data-stu-id="ce871-151">DirectManipulation and the HWND</span></span>

<span data-ttu-id="ce871-152">直接操作與 Win32 HWND 相關聯，以便接收和處理該視窗的指標輸入訊息。</span><span class="sxs-lookup"><span data-stu-id="ce871-152">Direct Manipulation is associated with a Win32 HWND in order to receive and process pointer input messages for that window.</span></span> <span data-ttu-id="ce871-153">當直接操作計算輸出值時，它會對直接操作元件物件模型進行非同步回呼， [ (COM) ](../com/component-object-model--com--portal.md) 在應用程式中執行的物件。</span><span class="sxs-lookup"><span data-stu-id="ce871-153">As Direct Manipulation computes output values, it makes asynchronous callbacks to the Direct Manipulation [Component Object Model (COM)](../com/component-object-model--com--portal.md) objects that are implemented in the application.</span></span> <span data-ttu-id="ce871-154">這些回呼會通知應用程式有關已套用至物件的轉換。</span><span class="sxs-lookup"><span data-stu-id="ce871-154">These callbacks inform the application about the transform that was applied to the objects.</span></span> <span data-ttu-id="ce871-155">藉由呼叫 [**Activate**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationmanager-activate)，在指定的 HWND 上啟用直接操作。</span><span class="sxs-lookup"><span data-stu-id="ce871-155">Direct Manipulation is activated on the specified HWND by calling [**Activate**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationmanager-activate).</span></span>

## <a name="supporting-documentation"></a><span data-ttu-id="ce871-156">支援檔</span><span class="sxs-lookup"><span data-stu-id="ce871-156">Supporting documentation</span></span>

- [<span data-ttu-id="ce871-157">區和內容</span><span class="sxs-lookup"><span data-stu-id="ce871-157">Viewports and content</span></span>](directmanipulation-viewports-and-content.md)
- [<span data-ttu-id="ce871-158">在 DirectManipulation 中使用多個區</span><span class="sxs-lookup"><span data-stu-id="ce871-158">Using multiple viewports in DirectManipulation</span></span>](directmanipulation-multiple-vieports.md)
- [<span data-ttu-id="ce871-159">使用 DirectManipulation 處理輸入</span><span class="sxs-lookup"><span data-stu-id="ce871-159">Processing input with DirectManipulation</span></span>](directmanipulation-processing-input-with-directmanipulation.md)
- [<span data-ttu-id="ce871-160">撰寫引擎</span><span class="sxs-lookup"><span data-stu-id="ce871-160">Composition engine</span></span>](directmanipulation-composition-engine.md)
- [<span data-ttu-id="ce871-161">直接操作參考</span><span class="sxs-lookup"><span data-stu-id="ce871-161">Direct Manipulation Reference</span></span>](direct-manipulation-reference.md)

- [<span data-ttu-id="ce871-162">組建2013： WCL-022：使用觸控、滑鼠和畫筆讓您的桌面應用程式發揮絕佳</span><span class="sxs-lookup"><span data-stu-id="ce871-162">BUILD 2013: WCL-022: Make your desktop app great with touch, mouse, and pen</span></span>](https://channel9.msdn.com/Events/Build/2013/4-022)
- [<span data-ttu-id="ce871-163">使用直接操作範例處理觸控輸入</span><span class="sxs-lookup"><span data-stu-id="ce871-163">Process touch input with Direct Manipulation sample</span></span>](https://github.com/microsoft/Windows-classic-samples/tree/1d363ff4bd17d8e20415b92e2ee989d615cc0d91/Samples/TouchInputDirectManipulation)
