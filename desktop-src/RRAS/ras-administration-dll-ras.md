---
title: RAS 系統管理 DLL
description: 當使用者嘗試連線或中斷連線時，DLL 會匯出 RAS 伺服器所呼叫的函式。
ms.assetid: 014ab85d-8924-4c7a-89ed-f83e75318ca6
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f0908032e0916f0937e964408b1551d3f1515dea
ms.sourcegitcommit: cba7f424a292fd7f3a8518947b9466439b455419
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/23/2019
ms.locfileid: "104313779"
---
# <a name="ras-administration-dll"></a><span data-ttu-id="a0582-103">RAS 系統管理 DLL</span><span class="sxs-lookup"><span data-stu-id="a0582-103">RAS administration DLL</span></span>

<span data-ttu-id="a0582-104">當使用者嘗試連線或中斷連線時，DLL 會匯出 RAS 伺服器所呼叫的函式。</span><span class="sxs-lookup"><span data-stu-id="a0582-104">The DLL exports functions that the RAS server calls whenever a user tries to connect or disconnect.</span></span> <span data-ttu-id="a0582-105">您可以使用 DLL 來執行下列系統管理功能：</span><span class="sxs-lookup"><span data-stu-id="a0582-105">You can use the DLL to perform the following administrative functions:</span></span>

-   <span data-ttu-id="a0582-106">決定是否允許使用者連接到伺服器。</span><span class="sxs-lookup"><span data-stu-id="a0582-106">Decide whether to allow a user to connect to the server.</span></span> <span data-ttu-id="a0582-107">除了標準的 RAS 使用者驗證之外，這也可以提供安全性檢查。</span><span class="sxs-lookup"><span data-stu-id="a0582-107">This can provide a security check in addition to the standard RAS user authentication.</span></span>
-   <span data-ttu-id="a0582-108">記錄每個使用者連接的時間，並中斷與伺服器的連線。</span><span class="sxs-lookup"><span data-stu-id="a0582-108">Record the time that each user connects to and disconnects from the server.</span></span> <span data-ttu-id="a0582-109">這可能適用于計費或審核用途。</span><span class="sxs-lookup"><span data-stu-id="a0582-109">This can be useful for billing or auditing purposes.</span></span>
-   <span data-ttu-id="a0582-110">將 IP 位址指派給每個使用者。</span><span class="sxs-lookup"><span data-stu-id="a0582-110">Assign an IP address to each user.</span></span> <span data-ttu-id="a0582-111">這對於將使用者的連接對應至特定電腦的安全性目的很有用。</span><span class="sxs-lookup"><span data-stu-id="a0582-111">This can be useful for security purposes to map a user's connection to a specific computer.</span></span>

<span data-ttu-id="a0582-112">開發 RAS 伺服器管理 DLL 時，請執行下列功能。</span><span class="sxs-lookup"><span data-stu-id="a0582-112">Implement the following functions when developing a RAS server administration DLL.</span></span>

-   [<span data-ttu-id="a0582-113">**RasAdminAcceptNewConnection**</span><span class="sxs-lookup"><span data-stu-id="a0582-113">**RasAdminAcceptNewConnection**</span></span>](rasadminacceptnewconnection.md)
-   [<span data-ttu-id="a0582-114">**RasAdminConnectionHangupNotification**</span><span class="sxs-lookup"><span data-stu-id="a0582-114">**RasAdminConnectionHangupNotification**</span></span>](rasadminconnectionhangupnotification.md)
-   [<span data-ttu-id="a0582-115">**RasAdminGetIpAddressForUser**</span><span class="sxs-lookup"><span data-stu-id="a0582-115">**RasAdminGetIpAddressForUser**</span></span>](rasadmingetipaddressforuser.md)
-   [<span data-ttu-id="a0582-116">**RasAdminReleaseIpAddress**</span><span class="sxs-lookup"><span data-stu-id="a0582-116">**RasAdminReleaseIpAddress**</span></span>](rasadminreleaseipaddress.md)

<span data-ttu-id="a0582-117">RAS 系統管理 DLL 必須執行和匯出上述所有功能。</span><span class="sxs-lookup"><span data-stu-id="a0582-117">A RAS administration DLL must implement and export all of the above functions.</span></span> <span data-ttu-id="a0582-118">如果未執行任何功能，遠端存取服務將無法啟動。</span><span class="sxs-lookup"><span data-stu-id="a0582-118">If any of the functions are not implemented, the remote access service will fail to start.</span></span>

<span data-ttu-id="a0582-119">[**RasAdminAcceptNewConnection**](rasadminacceptnewconnection.md)和 [**RasAdminConnectionHangupNotification**](rasadminconnectionhangupnotification.md)函式可讓 DLL 審核伺服器的使用者連接。</span><span class="sxs-lookup"><span data-stu-id="a0582-119">The [**RasAdminAcceptNewConnection**](rasadminacceptnewconnection.md) and [**RasAdminConnectionHangupNotification**](rasadminconnectionhangupnotification.md) functions enable the DLL to audit user connections to the server.</span></span> <span data-ttu-id="a0582-120">當使用者嘗試連接時，Windows NT/Windows 2000 RAS 伺服器會呼叫 **RasAdminAcceptNewConnection** 函式。</span><span class="sxs-lookup"><span data-stu-id="a0582-120">A Windows NT/Windows 2000 RAS server calls the **RasAdminAcceptNewConnection** function whenever a user tries to connect.</span></span> <span data-ttu-id="a0582-121">函數可以防止使用者連接。</span><span class="sxs-lookup"><span data-stu-id="a0582-121">The function can prevent the user from connecting.</span></span> <span data-ttu-id="a0582-122">您也可以使用函式來產生記錄檔中的專案，以供計費或進行審核。</span><span class="sxs-lookup"><span data-stu-id="a0582-122">You can also use the function to generate an entry in a log for billing or auditing.</span></span> <span data-ttu-id="a0582-123">當使用者中斷連線時，RAS 伺服器會呼叫 **RasAdminConnectionHangupNotification** 函式，以記錄使用者中斷連線的時間。</span><span class="sxs-lookup"><span data-stu-id="a0582-123">When the user disconnects, the RAS server calls the **RasAdminConnectionHangupNotification** function, which can log the time at which the user disconnected.</span></span>

<span data-ttu-id="a0582-124">在 RAS 伺服器驗證呼叫端之後，它會呼叫 [**RasAdminGetIpAddressForUser**](rasadmingetipaddressforuser.md) 函數來取得遠端用戶端的 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="a0582-124">After the RAS server has authenticated a caller, it calls the [**RasAdminGetIpAddressForUser**](rasadmingetipaddressforuser.md) function to get an IP address for the remote client.</span></span> <span data-ttu-id="a0582-125">DLL 可以使用此函式來提供替代配置，以將 IP 位址對應至撥入使用者。</span><span class="sxs-lookup"><span data-stu-id="a0582-125">The DLL can use this function to provide an alternate scheme for mapping an IP address to a dial-in user.</span></span> <span data-ttu-id="a0582-126">如果未執行 **RasAdminGetIpAddressForUser** ，RAS 伺服器會將遠端使用者連線到從 ip 位址的靜態集區中選取的 ip 位址，或由動態主機設定通訊協定 (DHCP) server 所選取的 ip 位址。</span><span class="sxs-lookup"><span data-stu-id="a0582-126">If **RasAdminGetIpAddressForUser** is not implemented, a RAS server connects a remote user to an IP address selected from a static pool of IP addresses, or one selected by a Dynamic Host Configuration Protocol (DHCP) server.</span></span> <span data-ttu-id="a0582-127">**RasAdminGetIpAddressForUser** 函式可讓 DLL 覆寫此預設 ip 位址，並為每個使用者指定特定的 ip 位址。</span><span class="sxs-lookup"><span data-stu-id="a0582-127">The **RasAdminGetIpAddressForUser** function allows the DLL to override this default IP address and specify a particular IP address for each user.</span></span> <span data-ttu-id="a0582-128">**RasAdminGetIpAddressForUser** 函式可以設定旗標，讓 RAS 在使用者中斷連線時呼叫 [**RasAdminReleaseIpAddress**](rasadminreleaseipaddress.md)功能。</span><span class="sxs-lookup"><span data-stu-id="a0582-128">The **RasAdminGetIpAddressForUser** function can set a flag that causes RAS to call the [**RasAdminReleaseIpAddress**](rasadminreleaseipaddress.md) function when the user disconnects.</span></span> <span data-ttu-id="a0582-129">DLL 可以使用 [**RasAdminReleaseIpAddress**](rasadminreleaseipaddress.md) 來更新其使用者與 IP 位址對應。</span><span class="sxs-lookup"><span data-stu-id="a0582-129">The DLL can use [**RasAdminReleaseIpAddress**](rasadminreleaseipaddress.md) to update its user-to-IP-address map.</span></span>

<span data-ttu-id="a0582-130">RAS 會將呼叫序列化至管理 DLL。</span><span class="sxs-lookup"><span data-stu-id="a0582-130">RAS serializes calls into the administration DLL.</span></span> <span data-ttu-id="a0582-131">針對不同的 RAS 用戶端呼叫該函式時，永遠不會針對指定的 RAS 用戶端呼叫其中一個 DLL 的函式，在 RAS 呼叫其他用戶端的函式之前，一定會完成初始呼叫。</span><span class="sxs-lookup"><span data-stu-id="a0582-131">A call into one of the DLL's functions for a given RAS client will never be preempted by a call to that function for a different RAS client; the initial call is guaranteed to be complete before RAS calls the function for the other client.</span></span> <span data-ttu-id="a0582-132">此外，序列化會延伸至特定的函數群組。</span><span class="sxs-lookup"><span data-stu-id="a0582-132">Furthermore, serialization extends to certain groups of functions.</span></span> <span data-ttu-id="a0582-133">IP 位址函數會序列化為群組;對 [**RasAdminGetIpAddressForUser**](rasadmingetipaddressforuser.md) 或 [**RasAdminReleaseIpAddress**](rasadminreleaseipaddress.md) 的呼叫會封鎖呼叫，直到初始呼叫完成為止。</span><span class="sxs-lookup"><span data-stu-id="a0582-133">The IP address functions are serialized as a group; a call into either [**RasAdminGetIpAddressForUser**](rasadmingetipaddressforuser.md) or [**RasAdminReleaseIpAddress**](rasadminreleaseipaddress.md) will block calls into both until the initial call is complete.</span></span> <span data-ttu-id="a0582-134">[**RasAdminAcceptNewConnection**](rasadminacceptnewconnection.md) 和 [**RasAdminConnectionHangupNotification**](rasadminconnectionhangupnotification.md) 也會序列化為群組。</span><span class="sxs-lookup"><span data-stu-id="a0582-134">[**RasAdminAcceptNewConnection**](rasadminacceptnewconnection.md) and [**RasAdminConnectionHangupNotification**](rasadminconnectionhangupnotification.md) are also serialized as a group.</span></span>

<span data-ttu-id="a0582-135">RAS 會執行在一個進程中指派 IP 位址的函式，並在另一個進程中執行連接和中斷連接通知的函式。</span><span class="sxs-lookup"><span data-stu-id="a0582-135">RAS executes the functions for assigning IP addresses in one process and executes the functions for connection and disconnection notifications in another process.</span></span> <span data-ttu-id="a0582-136">因此，DLL 不應該相依于兩組函數之間的共用資料。</span><span class="sxs-lookup"><span data-stu-id="a0582-136">Consequently, the DLL should not depend on shared data between the two sets of functions.</span></span>

<span data-ttu-id="a0582-137">如果嘗試載入 RAS 管理 DLL 或呼叫其中一個 DLL 的函式時，RAS 伺服器會在系統事件記錄檔中記錄錯誤。</span><span class="sxs-lookup"><span data-stu-id="a0582-137">The RAS server logs an error in the system event log if an error occurs when it tries to load a RAS administration DLL or when calling one of the DLL's functions.</span></span> <span data-ttu-id="a0582-138">例如，如果 DLL 為匯出的函式指定了錯誤的名稱，或者如果它未在 .def 檔中包含函式名稱，就會發生這種情況。</span><span class="sxs-lookup"><span data-stu-id="a0582-138">This can happen, for example, if the DLL specified the wrong name for an exported function, or if it did not include the function name in the .def file.</span></span> <span data-ttu-id="a0582-139">事件記錄檔中的專案會指出失敗的原因。</span><span class="sxs-lookup"><span data-stu-id="a0582-139">The entry in the event log indicates the reason for the failure.</span></span>

<span data-ttu-id="a0582-140">**Windows 2000 伺服器和更新版本：** 執行此函式介面的 RAS 管理 Dll 無法再運作。</span><span class="sxs-lookup"><span data-stu-id="a0582-140">**Windows 2000 Server and later:** RAS administration DLLs that implement this function interface no longer work.</span></span> <span data-ttu-id="a0582-141">相反地，請使用較新版本的 Windows 所提供的 MprAdmin 函式介面。</span><span class="sxs-lookup"><span data-stu-id="a0582-141">Instead, use the MprAdmin function interface provided with the more recent versions of Windows.</span></span> <span data-ttu-id="a0582-142">如需詳細資訊，請參閱路由和 RAS 檔中的 [RAS 管理參考](remote-access-service-administration-reference.md) 。</span><span class="sxs-lookup"><span data-stu-id="a0582-142">For more information, see the [RAS Administration Reference](remote-access-service-administration-reference.md) in the Routing and RAS documentation.</span></span>

 

 




