---
title: RAS 安全性 DLL 驗證交易
description: Windows NT/Windows 2000 RAS 伺服器會呼叫安全性 DLL 的 RasSecurityDialogBegin 函式，以開始驗證遠端使用者。
ms.assetid: e6549812-d906-4163-b9c8-86f8f1cb1ad3
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 109f6ad5cd3d7b76e30db099a478ffaf562feb32
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/20/2020
ms.locfileid: "104508084"
---
# <a name="ras-security-dll-authentication-transaction"></a><span data-ttu-id="1e87b-103">RAS 安全性 DLL 驗證交易</span><span class="sxs-lookup"><span data-stu-id="1e87b-103">RAS Security DLL Authentication Transaction</span></span>

<span data-ttu-id="1e87b-104">Windows NT/Windows 2000 RAS 伺服器會呼叫安全性 DLL 的 [**RasSecurityDialogBegin**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialogbegin) 函式，以開始驗證遠端使用者。</span><span class="sxs-lookup"><span data-stu-id="1e87b-104">Windows NT/Windows 2000 RAS server calls the security DLL's [**RasSecurityDialogBegin**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialogbegin) function to begin an authentication of a remote user.</span></span> <span data-ttu-id="1e87b-105">RAS 伺服器被封鎖，而且在 **RasSecurityDialogBegin** 傳回之前無法接受任何其他呼叫。</span><span class="sxs-lookup"><span data-stu-id="1e87b-105">The RAS server is blocked and cannot accept any other calls until **RasSecurityDialogBegin** returns.</span></span> <span data-ttu-id="1e87b-106">基於這個理由， **RasSecurityDialogBegin** 應該複製輸入參數、建立執行緒以執行驗證，並儘快傳回。</span><span class="sxs-lookup"><span data-stu-id="1e87b-106">For this reason, **RasSecurityDialogBegin** should copy the input parameters, create a thread to perform the authentication, and return as quickly as possible.</span></span>

<span data-ttu-id="1e87b-107">安全性 DLL 所建立的執行緒會使用 [**RasSecurityDialogSend**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialogsend) 和 [**RasSecurityDialogReceive**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialogreceive) 函數來與遠端電腦通訊。</span><span class="sxs-lookup"><span data-stu-id="1e87b-107">The thread created by the security DLL uses the [**RasSecurityDialogSend**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialogsend) and [**RasSecurityDialogReceive**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialogreceive) functions to communicate with the remote computer.</span></span> <span data-ttu-id="1e87b-108">這些函數無法從任何程式庫進行靜態匯入。</span><span class="sxs-lookup"><span data-stu-id="1e87b-108">These functions are not available for static import from any library.</span></span> <span data-ttu-id="1e87b-109">相反地，安全性 DLL 必須使用 [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) 和 [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress) 函式，以動態方式連結至 RASMAN.DLL 中的這些函數。</span><span class="sxs-lookup"><span data-stu-id="1e87b-109">Instead, the security DLL must use the [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) and [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress) functions to dynamically link to these functions in RASMAN.DLL.</span></span>

<span data-ttu-id="1e87b-110">在驗證交易期間，遠端電腦上的 RAS 連接管理員會顯示終端機視窗。</span><span class="sxs-lookup"><span data-stu-id="1e87b-110">During an authentication transaction, the RAS connection manager on the remote computer displays a terminal window.</span></span> <span data-ttu-id="1e87b-111">安全性 DLL 的執行緒會呼叫 [**RasSecurityDialogSend**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialogsend) ，以傳送要在終端機視窗中顯示的訊息。</span><span class="sxs-lookup"><span data-stu-id="1e87b-111">The thread of the security DLL calls [**RasSecurityDialogSend**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialogsend) to send a message to display in the terminal window.</span></span> <span data-ttu-id="1e87b-112">執行緒接著會呼叫 [**RasSecurityDialogReceive**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialogreceive) ，以接收遠端使用者在終端機視窗中輸入的輸入。</span><span class="sxs-lookup"><span data-stu-id="1e87b-112">The thread then calls [**RasSecurityDialogReceive**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialogreceive) to receive the input that the remote user types in the terminal window.</span></span> <span data-ttu-id="1e87b-113">執行緒可以進行任何數目的 **RasSecurityDialogSend** 呼叫，每次呼叫後接著 **RasSecurityDialogReceive** 呼叫。</span><span class="sxs-lookup"><span data-stu-id="1e87b-113">The thread can make any number of **RasSecurityDialogSend** calls, with each call followed by a **RasSecurityDialogReceive** call.</span></span> <span data-ttu-id="1e87b-114">每次呼叫 **RasSecurityDialogReceive** 之後，執行緒必須呼叫其中一個等候函式（例如 [**WaitForSingleObject**](/windows/win32/api/synchapi/nf-synchapi-waitforsingleobject)），以等候非同步傳送和接收作業完成。</span><span class="sxs-lookup"><span data-stu-id="1e87b-114">After each call to **RasSecurityDialogReceive**, the thread must call one of the wait functions, such as [**WaitForSingleObject**](/windows/win32/api/synchapi/nf-synchapi-waitforsingleobject), to wait for the asynchronous send and receive operations to be completed.</span></span> <span data-ttu-id="1e87b-115">當接收作業完成或經過選擇性的逾時間隔時，RAS 伺服器會通知事件物件。</span><span class="sxs-lookup"><span data-stu-id="1e87b-115">The RAS server signals an event object when the receive operation has been completed or when an optional time-out interval has elapsed.</span></span>

<span data-ttu-id="1e87b-116">當執行緒完成遠端使用者的驗證時，它會呼叫 [**RasSecurityDialogComplete**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialogcomplete) 函數。</span><span class="sxs-lookup"><span data-stu-id="1e87b-116">When the thread has finished authenticating the remote user, it calls the [**RasSecurityDialogComplete**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialogcomplete) function.</span></span> <span data-ttu-id="1e87b-117">此呼叫會將包含驗證交易結果的 [**安全性 \_ 訊息**](/windows/desktop/api/Rasshost/ns-rasshost-security_message) 結構傳遞到 RAS 伺服器。</span><span class="sxs-lookup"><span data-stu-id="1e87b-117">This call passes a [**SECURITY\_MESSAGE**](/windows/desktop/api/Rasshost/ns-rasshost-security_message) structure containing the results of the authentication transaction to the RAS server.</span></span> <span data-ttu-id="1e87b-118">然後 RAS 伺服器會執行清除順序，其中包含對 DLL [**RasSecurityDialogEnd**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialogend) 函式的呼叫。</span><span class="sxs-lookup"><span data-stu-id="1e87b-118">The RAS server then performs a cleanup sequence that includes a call to the DLL's [**RasSecurityDialogEnd**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialogend) function.</span></span> <span data-ttu-id="1e87b-119">這讓安全性 DLL 有機會執行任何必要的清除。</span><span class="sxs-lookup"><span data-stu-id="1e87b-119">This gives the security DLL an opportunity to perform any necessary cleanup.</span></span>

<span data-ttu-id="1e87b-120">安全性 DLL 可以呼叫 [**RasSecurityDialogGetInfo**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialoggetinfo) 函數，以抓取與驗證交易相關聯之埠的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="1e87b-120">The security DLL can call the [**RasSecurityDialogGetInfo**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialoggetinfo) function to retrieve information about the port associated with an authentication transaction.</span></span> <span data-ttu-id="1e87b-121">**RasSecurityDialogGetInfo** 會填入 [**RAS \_ 安全性 \_ 資訊**](/windows/desktop/api/Rasshost/ns-rasshost-ras_security_info) 結構，指出埠的最後一個 [**RasSecurityDialogReceive**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialogreceive) 呼叫的狀態。</span><span class="sxs-lookup"><span data-stu-id="1e87b-121">**RasSecurityDialogGetInfo** fills in a [**RAS\_SECURITY\_INFO**](/windows/desktop/api/Rasshost/ns-rasshost-ras_security_info) structure that indicates the state of the last [**RasSecurityDialogReceive**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialogreceive) call for the port.</span></span>

 

 