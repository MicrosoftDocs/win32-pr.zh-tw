---
description: Windows Update 代理程式 (WUA) 在連線到 Windows Server Update Services (WSUS) 伺服器或 Windows Update 時，自動自行更新。
ms.assetid: 829112ab-b240-4cc4-8053-18b484934886
title: 正在更新 Windows Update 代理程式
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b00fe439b1bea377e2699f6fe5714b208ac5d951
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "106970444"
---
# <a name="updating-windows-update-agent"></a><span data-ttu-id="5da93-103">正在更新 Windows Update 代理程式</span><span class="sxs-lookup"><span data-stu-id="5da93-103">Updating Windows Update Agent</span></span>

<span data-ttu-id="5da93-104">根據裝置上執行的 Windows 版本而定，Windows Update 代理程式 (WUA) 會透過各種方式自行更新。</span><span class="sxs-lookup"><span data-stu-id="5da93-104">Windows Update Agent (WUA) updates itself through various means, depending on the version of Windows running on the device.</span></span> <span data-ttu-id="5da93-105">舊版 WUA 可能無法連線到目前的更新服務，可能無法與所有更新相容，而且可能不支援所有記載的 Api。</span><span class="sxs-lookup"><span data-stu-id="5da93-105">Old versions of WUA may not be able to connect to current update services, may not be compatible with all updates, and may not support all documented APIs.</span></span> <span data-ttu-id="5da93-106">以下說明如何確保 WUA 已完全更新且相容。</span><span class="sxs-lookup"><span data-stu-id="5da93-106">Here is how to insure that WUA is fully updated and compatible.</span></span>

<span data-ttu-id="5da93-107">**從 Windows 7 和 Windows Server 2008 R2 開始的 Windows 版本**</span><span class="sxs-lookup"><span data-stu-id="5da93-107">**On versions of Windows beginning with Windows 7 and Windows Server 2008 R2**</span></span>

<span data-ttu-id="5da93-108">Windows Update Agent (WUA) 更新會包含在透過 Windows Update 或 Windows Server Update Services (WSUS) 發佈的 Windows 定期更新中。</span><span class="sxs-lookup"><span data-stu-id="5da93-108">Windows Update Agent (WUA) updates are included in the regular periodic updates to Windows distributed through Windows Update or to Windows Server Update Services (WSUS).</span></span> <span data-ttu-id="5da93-109">在這些 Windows 版本上，您不需要採取任何特殊步驟來更新 WUA。</span><span class="sxs-lookup"><span data-stu-id="5da93-109">You do not need to take any special steps to update WUA on these Windows versions.</span></span>

<span data-ttu-id="5da93-110">**在 Windows 7 和 Windows Server 2008 R2 之前的 Windows 版本**</span><span class="sxs-lookup"><span data-stu-id="5da93-110">**On versions of Windows prior to Windows 7 and Windows Server 2008 R2**</span></span>

<span data-ttu-id="5da93-111">當自動更新連接到 Windows Update 或 WSUS 時，WUA 會自動自行更新。</span><span class="sxs-lookup"><span data-stu-id="5da93-111">WUA automatically updates itself when Automatic Updates connects to Windows Update or to WSUS.</span></span>

<span data-ttu-id="5da93-112">如果自動更新尚未成功執行，則執行這些 Windows 版本的裝置可能會執行不支援所有記載之 Api 的舊版 WUA。</span><span class="sxs-lookup"><span data-stu-id="5da93-112">If Automatic Updates has not yet successfully run, it is possible that a device running these Windows versions will be running an older version of WUA that does not support all the documented APIs.</span></span> <span data-ttu-id="5da93-113">如果您在使用 WUA API 來執行掃描、下載或安裝時收到 WU_E_SELFUPDATE_REQUIRED 結果，此錯誤表示安裝的 WUA 版本太舊，無法連接到目前的 Windows Update 服務。</span><span class="sxs-lookup"><span data-stu-id="5da93-113">If you receive a WU_E_SELFUPDATE_REQUIRED result when you use the WUA API to perform a scan, download, or install, this error tells you that the installed version of WUA is too old to connect to current Windows Update services.</span></span> <span data-ttu-id="5da93-114">您無法使用標準 WUA Api 來更新這些作業系統上的 WUA。</span><span class="sxs-lookup"><span data-stu-id="5da93-114">You cannot use the normal WUA APIs to update WUA on these operating systems.</span></span> 

<span data-ttu-id="5da93-115">使用者可以藉由開啟 Windows Update 控制台、選取 [檢查更新]，然後接受顯示的自動更新，來手動將 WUA 更新為最新版本。</span><span class="sxs-lookup"><span data-stu-id="5da93-115">A user can manually update WUA to a current version by opening the Windows Update control panel, selecting Check for Updates, then accepting the self-update that appears.</span></span> <span data-ttu-id="5da93-116">或者，您可以用程式設計的方式更新 WUA。</span><span class="sxs-lookup"><span data-stu-id="5da93-116">Alternately, you can update WUA programmatically.</span></span>

<span data-ttu-id="5da93-117">**以程式設計方式在 Windows 7 和 Windows Server 2008 R2 之前的 Windows 版本上更新 WUA**</span><span class="sxs-lookup"><span data-stu-id="5da93-117">**To programmatically update WUA on versions of Windows prior to Windows 7 and Windows Server 2008 R2**</span></span>

1.  <span data-ttu-id="5da93-118">使用 [WinHTTP](../winhttp/winhttp-start-page.md) api 下載 [Wuredist.cab](https://update.microsoft.com/redist/wuredist.cab)。</span><span class="sxs-lookup"><span data-stu-id="5da93-118">Use the [WinHTTP](../winhttp/winhttp-start-page.md) APIs to download [Wuredist.cab](https://update.microsoft.com/redist/wuredist.cab).</span></span>
2.  <span data-ttu-id="5da93-119">使用 [密碼編譯功能](../seccrypto/cryptography-functions.md) 來確認下載的 [Wuredist.cab](https://update.microsoft.com/redist/wuredist.cab) 複本是否有 Microsoft 的數位簽章。</span><span class="sxs-lookup"><span data-stu-id="5da93-119">Use the [Cryptography Functions](../seccrypto/cryptography-functions.md) to verify that the downloaded copy of [Wuredist.cab](https://update.microsoft.com/redist/wuredist.cab) has a digital signature from Microsoft.</span></span> <span data-ttu-id="5da93-120">如果您無法驗證數位簽章，請停止。</span><span class="sxs-lookup"><span data-stu-id="5da93-120">If you can't verify the digital signature, stop.</span></span>
3.  <span data-ttu-id="5da93-121">使用檔案 [解壓縮介面](../devnotes/cabinet-api-functions.md) api 從 [Wuredist.cab](https://update.microsoft.com/redist/wuredist.cab)解壓縮 XML 檔案。</span><span class="sxs-lookup"><span data-stu-id="5da93-121">Use the [File Decompression Interface](../devnotes/cabinet-api-functions.md) APIs to extract the XML file from [Wuredist.cab](https://update.microsoft.com/redist/wuredist.cab).</span></span>
4.  <span data-ttu-id="5da93-122">使用 Microsoft XML Core Services ([MSXML](/previous-versions/windows/desktop/ms763742(v=vs.85))) api 來載入 XML 檔案，並找出電腦架構的 WURedist/StandaloneRedist/架構節點。</span><span class="sxs-lookup"><span data-stu-id="5da93-122">Use the Microsoft XML Core Services ([MSXML](/previous-versions/windows/desktop/ms763742(v=vs.85))) APIs to load the XML file and locate the WURedist/StandaloneRedist/architecture node for the computer's architecture.</span></span> <span data-ttu-id="5da93-123">例如，針對 x86，找出 [WURedist/StandaloneRedist]/[架構] 節點，並使用 [x86] 的 [ **名稱** ] 屬性。</span><span class="sxs-lookup"><span data-stu-id="5da93-123">For example, for x86, locate the WURedist/StandaloneRedist/architecture node with the **name** attribute of x86.</span></span>
5.  <span data-ttu-id="5da93-124">呼叫 [**IWindowsUpdateAgentInfo：： GetInfo**](/windows/desktop/api/Wuapi/nf-wuapi-iwindowsupdateagentinfo-getinfo) 來判斷 WUA 的目前版本。</span><span class="sxs-lookup"><span data-stu-id="5da93-124">Call [**IWindowsUpdateAgentInfo::GetInfo**](/windows/desktop/api/Wuapi/nf-wuapi-iwindowsupdateagentinfo-getinfo) to determine the current version of WUA.</span></span> <span data-ttu-id="5da93-125">如果 **IWindowsUpdateAgentInfo：： GetInfo** 傳回的版本號碼至少與您所在之架構節點中的 **clientVersion** 屬性高，請停止。</span><span class="sxs-lookup"><span data-stu-id="5da93-125">If **IWindowsUpdateAgentInfo::GetInfo** returns a version number that is at least as high as the **clientVersion** attribute in the architecture node you located, stop.</span></span>
6.  <span data-ttu-id="5da93-126">使用 [MSXML](/previous-versions/windows/desktop/ms763742(v=vs.85)) api 從您找到的 [架構] 節點讀取 **downloadUrl** 屬性。</span><span class="sxs-lookup"><span data-stu-id="5da93-126">Use the [MSXML](/previous-versions/windows/desktop/ms763742(v=vs.85)) APIs to read the **downloadUrl** attribute from the architecture node that you located.</span></span> <span data-ttu-id="5da93-127">**downloadUrl** 可為您提供適用于電腦架構之 WUA 安裝程式的下載 URL。</span><span class="sxs-lookup"><span data-stu-id="5da93-127">**downloadUrl** gives you the download URL for the appropriate WUA installer for the computer's architecture.</span></span>
7.  <span data-ttu-id="5da93-128">使用 [WinHTTP](../winhttp/winhttp-start-page.md) api 下載適當的安裝程式。</span><span class="sxs-lookup"><span data-stu-id="5da93-128">Use the [WinHTTP](../winhttp/winhttp-start-page.md) APIs to download the appropriate installer.</span></span>
8.  <span data-ttu-id="5da93-129">使用 [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) 函數或類似的 API 來執行下載的安裝程式。</span><span class="sxs-lookup"><span data-stu-id="5da93-129">Use the [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) function or a similar API to execute the downloaded installer.</span></span>

 

 
