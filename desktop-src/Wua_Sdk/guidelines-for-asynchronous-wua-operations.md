---
description: 本主題指出當您執行非同步 Windows Update Agent (WUA) 作業時，所遵循的指導方針。
ms.assetid: 1fb16904-732d-4341-8267-ab8896fc0f7c
title: 非同步 WUA 作業的指導方針
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c1a4b2198a235d9a03e3730e5d6dce2cd54c0e1f
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "106993046"
---
# <a name="guidelines-for-asynchronous-wua-operations"></a><span data-ttu-id="f6111-103">非同步 WUA 作業的指導方針</span><span class="sxs-lookup"><span data-stu-id="f6111-103">Guidelines for Asynchronous WUA Operations</span></span>

<span data-ttu-id="f6111-104">本主題指出當您執行非同步 Windows Update Agent (WUA) 作業時，所遵循的指導方針。</span><span class="sxs-lookup"><span data-stu-id="f6111-104">This topic identifies guidelines for you to the follow when you perform asynchronous Windows Update Agent (WUA) operations.</span></span>

-   <span data-ttu-id="f6111-105">非同步 WUA 作業不保證任何特定的完成速度。</span><span class="sxs-lookup"><span data-stu-id="f6111-105">The asynchronous WUA operations do not guarantee any particular completion speed.</span></span> <span data-ttu-id="f6111-106">非同步 WUA 作業的完成時間可能會因電腦硬體、作業系統版本和網路設定而有很大的差異。</span><span class="sxs-lookup"><span data-stu-id="f6111-106">The completion time for an asynchronous WUA operation can vary widely depending on computer hardware, version of the operating system, and network configuration.</span></span> <span data-ttu-id="f6111-107">如同其他具有網路相依性且不包含超時參數或記載的超時時間的 Windows Api，如果您需要保證的回應時間，建議您考慮執行您自己的超時機制。</span><span class="sxs-lookup"><span data-stu-id="f6111-107">As with other Windows APIs that have network dependencies and that do not contain a time-out parameter or a documented time-out duration, we recommend that you consider implementing your own time-out mechanisms if you need guaranteed response times.</span></span> <span data-ttu-id="f6111-108">例如，您可以建立呼叫非同步 WUA 方法的背景工作執行緒，並且在非同步 WUA 作業完成時設定事件或其他同步處理物件;主執行緒接著可以使用 [**WaitForSingleObject**](/windows/desktop/api/synchapi/nf-synchapi-waitforsingleobject) 或 [**WaitForMultipleObjects**](/windows/desktop/api/synchapi/nf-synchapi-waitformultipleobjects) 函式，讓您指定超時值。</span><span class="sxs-lookup"><span data-stu-id="f6111-108">For example, you can create a worker thread that calls an asynchronous WUA method and that sets an event or other synchronization object when the asynchronous WUA operation completes; the main thread can then use the [**WaitForSingleObject**](/windows/desktop/api/synchapi/nf-synchapi-waitforsingleobject) or [**WaitForMultipleObjects**](/windows/desktop/api/synchapi/nf-synchapi-waitformultipleobjects) function, which allows you to specify a time-out value.</span></span>
-   <span data-ttu-id="f6111-109">當您結束搜尋、下載、安裝或卸載更新時，您可以從任何執行緒使用 [**IUpdateSearcher：： EndSearch**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatesearcher-endsearch)、 [**IUpdateDowloader：： EndDownload**](/windows/desktop/api/Wuapi/nn-wuapi-iupdatedownloader)、 [**IUpdateInstaller：： EndInstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-endinstall) 和 [**IUpdateInstaller：： EndUninstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-enduninstall) 。</span><span class="sxs-lookup"><span data-stu-id="f6111-109">When you end a search, download, installation, or uninstallation of updates, you can use [**IUpdateSearcher::EndSearch**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatesearcher-endsearch), [**IUpdateDowloader::EndDownload**](/windows/desktop/api/Wuapi/nn-wuapi-iupdatedownloader), [**IUpdateInstaller::EndInstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-endinstall) and [**IUpdateInstaller::EndUninstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-enduninstall) from any thread.</span></span>
-   <span data-ttu-id="f6111-110">當您使用 [**IUpdateSearcher：： BeginSearch**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatesearcher-beginsearch)、 [**IUpdateDownloader：： BeginDownload**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatedownloader-begindownload)、 [**IUpdateInstaller：： BeginInstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-begininstall)和 [**IUpdateInstaller：： BeginUninstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-beginuninstall)來開始搜尋、下載、安裝或卸載更新時，請確定您在發行對 WUA API 物件的參考時，仍可維護足夠的存取權許可權。</span><span class="sxs-lookup"><span data-stu-id="f6111-110">When you start a search, download, installation, or uninstallation of updates by using [**IUpdateSearcher::BeginSearch**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatesearcher-beginsearch), [**IUpdateDownloader::BeginDownload**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatedownloader-begindownload), [**IUpdateInstaller::BeginInstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-begininstall), and [**IUpdateInstaller::BeginUninstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-beginuninstall), ensure that you maintain sufficient access permisssions when you release references to WUA API objects.</span></span>
    -   <span data-ttu-id="f6111-111">在您終結之前，請確定非同步作業中使用的任何回呼物件都未參考。</span><span class="sxs-lookup"><span data-stu-id="f6111-111">Make sure any callback objects that are used in the asynchronous operation are unreferenced before you destroy them.</span></span> <span data-ttu-id="f6111-112">在您終結回呼物件的參考計數之前，請先將其回復至初始值。</span><span class="sxs-lookup"><span data-stu-id="f6111-112">Wait for the reference count of a callback object to return to the initial value before you destroy it.</span></span>
    -   <span data-ttu-id="f6111-113">從對應的 **Begin** 方法所傳回之工作物件的參考，應該由與回呼物件不同的物件來控制。</span><span class="sxs-lookup"><span data-stu-id="f6111-113">The reference to the job object that is returned from the corresponding **Begin** method should be controlled by an object that differs from the callback objects.</span></span> <span data-ttu-id="f6111-114">使用與回呼物件不同的物件，以避免迴圈參考。</span><span class="sxs-lookup"><span data-stu-id="f6111-114">Use an object that differs from the callback objects to avoid circular references.</span></span>
    -   <span data-ttu-id="f6111-115">如果您嘗試使用回呼物件來控制工作物件的參考，您必須在回呼函式之外呼叫 [**IDownloadJob：：清除**](/windows/desktop/api/Wuapi/nf-wuapi-idownloadjob-cleanup)、 [**IInstallationJob：：清除**](/windows/desktop/api/Wuapi/nf-wuapi-iinstallationjob-cleanup)或 [**ISearchJob：：清除**](/windows/desktop/api/Wuapi/nf-wuapi-isearchjob-cleanup) 方法，以便中斷工作物件與回呼物件的連接。</span><span class="sxs-lookup"><span data-stu-id="f6111-115">If you attempt to control the reference to the job object by using a callback object, you must call the [**IDownloadJob::CleanUp**](/windows/desktop/api/Wuapi/nf-wuapi-idownloadjob-cleanup), [**IInstallationJob::CleanUp**](/windows/desktop/api/Wuapi/nf-wuapi-iinstallationjob-cleanup), or [**ISearchJob::CleanUp**](/windows/desktop/api/Wuapi/nf-wuapi-isearchjob-cleanup) method outside the callback function to disconnect the job object from the callback object.</span></span> <span data-ttu-id="f6111-116">您必須先完成此動作，才能釋放 **Begin** 方法所傳回之工作物件的參考。</span><span class="sxs-lookup"><span data-stu-id="f6111-116">You must do this before you release the reference to the job object that is returned by the **Begin** method.</span></span>
-   <span data-ttu-id="f6111-117">請確定非同步 WUA 作業已完成。</span><span class="sxs-lookup"><span data-stu-id="f6111-117">Make sure that asynchronous WUA operations are complete.</span></span> <span data-ttu-id="f6111-118">當任何函式之外的所有命令都已完成時，Windows Script Host 可以終止腳本，即使 WUA API 仍具有回呼物件的參考。</span><span class="sxs-lookup"><span data-stu-id="f6111-118">Windows Script Host can terminate a script when all the commands outside of any function are complete, even if the WUA API still has references to the callback object.</span></span>
    -   <span data-ttu-id="f6111-119">使用其中一種 **清除** 方法，或讓回呼函式在完成時設定共用的全域變數。</span><span class="sxs-lookup"><span data-stu-id="f6111-119">Use one of the **CleanUp** methods or have the callback function set a shared global variable upon completion.</span></span>
    -   <span data-ttu-id="f6111-120">絕對不要在其回呼函式的工作物件上呼叫 [**IDownloadJob：：清除**](/windows/desktop/api/Wuapi/nf-wuapi-idownloadjob-cleanup)、 [**IInstallationJob：：清理**](/windows/desktop/api/Wuapi/nf-wuapi-iinstallationjob-cleanup)或 [**ISearchJob：：清除**](/windows/desktop/api/Wuapi/nf-wuapi-isearchjob-cleanup) 。</span><span class="sxs-lookup"><span data-stu-id="f6111-120">Never call [**IDownloadJob::CleanUp**](/windows/desktop/api/Wuapi/nf-wuapi-idownloadjob-cleanup), [**IInstallationJob::CleanUp**](/windows/desktop/api/Wuapi/nf-wuapi-iinstallationjob-cleanup), or [**ISearchJob::CleanUp**](/windows/desktop/api/Wuapi/nf-wuapi-isearchjob-cleanup) on a job object in its callback function.</span></span>
    -   <span data-ttu-id="f6111-121">若要確保在 Windows Internet Explorer 上執行的腳本中有正確的清除順序，請在處理 onbeforeunload 時，對所有工作物件呼叫 **清除** 方法。</span><span class="sxs-lookup"><span data-stu-id="f6111-121">To ensure the correct clean-up sequence in a script that is running on Windows Internet Explorer, call the **CleanUp** method on all the job objects when processing window.onbeforeunload.</span></span>
-   <span data-ttu-id="f6111-122">請勿將使用者自訂資料類型用於非同步 WUA 作業 (UDT) 。</span><span class="sxs-lookup"><span data-stu-id="f6111-122">Do not use user-defined data types (UDT) for asynchronous WUA operations.</span></span> <span data-ttu-id="f6111-123">[**IUpdateSearcher：： BeginSearch**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatesearcher-beginsearch)、 [**IUpdateDownloader：： BeginDownload**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatedownloader-begindownload)、 [**IUpdateInstaller：： BeginInstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-begininstall)或 [**IUpdateInstaller：： BeginUninstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-beginuninstall)不支援此類型。</span><span class="sxs-lookup"><span data-stu-id="f6111-123">The type is not supported by [**IUpdateSearcher::BeginSearch**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatesearcher-beginsearch), [**IUpdateDownloader::BeginDownload**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatedownloader-begindownload), [**IUpdateInstaller::BeginInstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-begininstall), or [**IUpdateInstaller::BeginUninstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-beginuninstall).</span></span>

 

 
