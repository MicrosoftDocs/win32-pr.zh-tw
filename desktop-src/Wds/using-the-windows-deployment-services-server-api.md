---
title: 使用 Windows 部署服務伺服器 API
description: 在無法使用標準 Windows 部署服務 (WDS) 解決方案的環境中，WDS 伺服器會公開可讓開發人員撰寫外掛程式（稱為提供者）的 API，以處理 (PXE) 要求的啟動載入器執行環境。
ms.assetid: 5e25654a-33c6-4c0f-acc3-e938d1f4a4e7
keywords:
- 使用伺服器 API Windows 部署服務 Windows 部署服務
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d3634dffa73eddc9b5db92be6bc807cccbc5248f
ms.sourcegitcommit: c2a1c4314550ea9bd202d28adfcc7bfe6180932f
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/11/2020
ms.locfileid: "103681597"
---
# <a name="using-the-windows-deployment-services-server-api"></a><span data-ttu-id="eaf54-104">使用 Windows 部署服務伺服器 API</span><span class="sxs-lookup"><span data-stu-id="eaf54-104">Using the Windows Deployment Services Server API</span></span>

<span data-ttu-id="eaf54-105">在無法使用標準 Windows 部署服務 (WDS) 解決方案的環境中，WDS 伺服器會公開可讓開發人員撰寫外掛程式（稱為提供者）的 API，以處理 (PXE) 要求的啟動載入器執行環境。</span><span class="sxs-lookup"><span data-stu-id="eaf54-105">In environments where the standard Windows Deployment Services (WDS) solution cannot be used, the WDS server exposes an API that enables developers to write plug-ins, referred to as providers, to handle preboot execution environment (PXE) requests.</span></span> <span data-ttu-id="eaf54-106">撰寫適用于 WDS 的 PXE 提供者時，開發人員應該遵循下列指導方針。</span><span class="sxs-lookup"><span data-stu-id="eaf54-106">Developers should adhere to the following guidelines when writing PXE providers for WDS.</span></span>

## <a name="install-the-wds-role-on-the-server"></a><span data-ttu-id="eaf54-107">在伺服器上安裝 WDS 角色</span><span class="sxs-lookup"><span data-stu-id="eaf54-107">Install the WDS Role on the Server</span></span>

-   <span data-ttu-id="eaf54-108">Windows 部署服務 (WDS) 是 (RIS) 的遠端安裝服務修訂版本，您將需要 WDS 伺服器角色才能執行 WDS PXE 伺服器和提供者。</span><span class="sxs-lookup"><span data-stu-id="eaf54-108">Windows Deployment Services (WDS) is the revised version of Remote Installation Services (RIS), you will need the WDS server role to implement the WDS PXE server and providers.</span></span>
-   <span data-ttu-id="eaf54-109">WDS 會以 Windows Server 2008 和 Windows Server 2003 Service Pack 2 (SP2) 的標準元件取代 RIS。</span><span class="sxs-lookup"><span data-stu-id="eaf54-109">WDS replaces RIS as the standard component starting with Windows Server 2008 and Windows Server 2003 with Service Pack 2 (SP2).</span></span>
-   <span data-ttu-id="eaf54-110">您必須將 RIS 伺服器更新至 Windows Server 2003 Service Pack 1 (SP1) 上的 WDS。</span><span class="sxs-lookup"><span data-stu-id="eaf54-110">You must update the RIS server to WDS on Windows Server 2003 with Service Pack 1 (SP1).</span></span> <span data-ttu-id="eaf54-111">您可以使用 [Windows 自動化安裝套件 (WAIK) ](https://www.microsoft.com/download/details.aspx?id=10333)來安裝 WDS 伺服器角色。</span><span class="sxs-lookup"><span data-stu-id="eaf54-111">You can install the WDS server role with the [Windows Automated Installation Kit (WAIK)](https://www.microsoft.com/download/details.aspx?id=10333).</span></span>

## <a name="register-providers"></a><span data-ttu-id="eaf54-112">註冊提供者</span><span class="sxs-lookup"><span data-stu-id="eaf54-112">Register Providers</span></span>

-   <span data-ttu-id="eaf54-113">在安裝期間，將提供者動態連結程式庫 (DLL) 註冊，然後將提供者插入已註冊之提供者的已排序清單中。</span><span class="sxs-lookup"><span data-stu-id="eaf54-113">Register the provider dynamic-link library (DLL) during its installation and insert the provider into the ordered list of registered providers.</span></span>
    > [!Note]  
    > <span data-ttu-id="eaf54-114">當您安裝新的或修改的提供者時，您必須重新開機 WDS PXE 服務，變更才會生效。</span><span class="sxs-lookup"><span data-stu-id="eaf54-114">When you install a new or modified provider, you will need to restart WDS PXE service for the changes to take effect.</span></span>

     

-   <span data-ttu-id="eaf54-115">使用 [**PxeProviderRegister**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeproviderregister) 函式來註冊提供者，並將其新增至清單。</span><span class="sxs-lookup"><span data-stu-id="eaf54-115">Use the [**PxeProviderRegister**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeproviderregister) function to register the provider and add it to the list.</span></span> <span data-ttu-id="eaf54-116">使用 [**PxeProviderUnRegister**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeproviderunregister) 函式取消註冊已註冊的提供者，並將它從清單中移除。</span><span class="sxs-lookup"><span data-stu-id="eaf54-116">Use the [**PxeProviderUnRegister**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeproviderunregister) function to unregister a registered provider and remove it from the list.</span></span>
-   <span data-ttu-id="eaf54-117">在排序的清單中指定提供者的順序。</span><span class="sxs-lookup"><span data-stu-id="eaf54-117">Specify the sequence of the provider in the ordered list.</span></span> <span data-ttu-id="eaf54-118">無法保證清單中的提供者索引，因為稍後可能會先註冊另一個提供者。</span><span class="sxs-lookup"><span data-stu-id="eaf54-118">The index of a provider in the list cannot be guaranteed because another provider may later be registered before it.</span></span> <span data-ttu-id="eaf54-119">若要將提供者插入到另一個已註冊的提供者之前或之後的清單中，請先使用 [**PxeProviderQueryIndex**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeproviderqueryindex) 函式取得已註冊之提供者的索引，然後在指定較大或較小的索引值時註冊新的提供者。</span><span class="sxs-lookup"><span data-stu-id="eaf54-119">To insert the provider in the list before or after another registered provider, first use the [**PxeProviderQueryIndex**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeproviderqueryindex) function to get the index of the registered provider and then register the new provider while specifying a larger or smaller index value.</span></span>
-   <span data-ttu-id="eaf54-120">安裝程式可以將提供者設定資訊儲存在註冊提供者時所傳回的登錄機碼下。</span><span class="sxs-lookup"><span data-stu-id="eaf54-120">The installation can store provider configuration information under the registry key returned when the provider is registered.</span></span> <span data-ttu-id="eaf54-121">登錄機碼的位址是由 [**PxeProviderRegister**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeproviderregister)的 *phProviderKey* 所接收。</span><span class="sxs-lookup"><span data-stu-id="eaf54-121">The address of the registry key is received by the *phProviderKey* of [**PxeProviderRegister**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeproviderregister).</span></span> <span data-ttu-id="eaf54-122">提供者會收到此相同索引鍵的控制碼，作為其 [*PxeProviderInitialize*](pxeproviderinitialize.md)回呼的 *hProviderKey* 參數。</span><span class="sxs-lookup"><span data-stu-id="eaf54-122">The provider receives a handle to this same key as the *hProviderKey* parameter to its [*PxeProviderInitialize*](pxeproviderinitialize.md) callback.</span></span> <span data-ttu-id="eaf54-123">提供者應儲存此金鑰的位址。</span><span class="sxs-lookup"><span data-stu-id="eaf54-123">The provider should store the address of this key.</span></span>
-   <span data-ttu-id="eaf54-124">一律將提供者動態連結程式庫 (DLL) 安裝在伺服器的 [Program Files] 資料夾中。</span><span class="sxs-lookup"><span data-stu-id="eaf54-124">Always install the provider dynamic-link library (DLL) in the server's Program Files folder.</span></span>

## <a name="initialize"></a><span data-ttu-id="eaf54-125">初始化</span><span class="sxs-lookup"><span data-stu-id="eaf54-125">Initialize</span></span>

-   <span data-ttu-id="eaf54-126">包含在提供者中匯出 [*PxeProviderInitialize*](pxeproviderinitialize.md) 回呼函式的 DLL。</span><span class="sxs-lookup"><span data-stu-id="eaf54-126">Include a DLL that exports the [*PxeProviderInitialize*](pxeproviderinitialize.md) callback function in the provider.</span></span> <span data-ttu-id="eaf54-127">每個提供者都需要 *PxeProviderInitialize* 回呼。</span><span class="sxs-lookup"><span data-stu-id="eaf54-127">Every provider requires a *PxeProviderInitialize* callback.</span></span> <span data-ttu-id="eaf54-128">當 WDS 載入提供者時，它會呼叫提供者的 *PxeProviderInitialize* 函式，並將控制碼傳遞至在提供者註冊期間用來儲存設定資訊的相同金鑰。</span><span class="sxs-lookup"><span data-stu-id="eaf54-128">When WDS loads a provider, it calls the provider's *PxeProviderInitialize* function and passes a handle to the same key that is used to store configuration information during provider registration.</span></span>
-   <span data-ttu-id="eaf54-129">當 [*PxeProviderInitialize*](pxeproviderinitialize.md) 回呼傳回且成功時，提供者應該完全初始化並準備好處理要求。</span><span class="sxs-lookup"><span data-stu-id="eaf54-129">When the [*PxeProviderInitialize*](pxeproviderinitialize.md) callback returns and is successful, the provider should be fully initialized and ready to process requests.</span></span>
-   <span data-ttu-id="eaf54-130">在處理 [*PxeProviderInitialize*](pxeproviderinitialize.md) 函式期間，在提供者中註冊每個回呼。</span><span class="sxs-lookup"><span data-stu-id="eaf54-130">Register every callback in the provider during the processing of the [*PxeProviderInitialize*](pxeproviderinitialize.md) function.</span></span> <span data-ttu-id="eaf54-131">回呼應該向 [**PxeRegisterCallback**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeregistercallback) 函式註冊。</span><span class="sxs-lookup"><span data-stu-id="eaf54-131">Callbacks should be registered with the [**PxeRegisterCallback**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeregistercallback) function.</span></span>
-   <span data-ttu-id="eaf54-132">在處理其 [*PxeProviderInitialize*](pxeproviderinitialize.md) 函式時，初始化所有提供者的內部資源。</span><span class="sxs-lookup"><span data-stu-id="eaf54-132">Initialize all the provider's internal resources within the processing of its [*PxeProviderInitialize*](pxeproviderinitialize.md) function.</span></span>

## <a name="shutdown"></a><span data-ttu-id="eaf54-133">關機</span><span class="sxs-lookup"><span data-stu-id="eaf54-133">Shutdown</span></span>

-   <span data-ttu-id="eaf54-134">執行 [*PxeProviderShutdown*](pxeprovidershutdown.md) 回呼。</span><span class="sxs-lookup"><span data-stu-id="eaf54-134">Implement the [*PxeProviderShutdown*](pxeprovidershutdown.md) callback.</span></span> <span data-ttu-id="eaf54-135">每個提供者都必須有 *PxeProviderShutdown* 回呼。</span><span class="sxs-lookup"><span data-stu-id="eaf54-135">Every provider is required to have a *PxeProviderShutdown* callback.</span></span>
-   <span data-ttu-id="eaf54-136">[*PxeProviderShutdown*](pxeprovidershutdown.md)回呼函式應完全關閉提供者，並釋放其所有資源。</span><span class="sxs-lookup"><span data-stu-id="eaf54-136">The [*PxeProviderShutdown*](pxeprovidershutdown.md) callback function should fully shut down the provider and release all its resources.</span></span>
-   <span data-ttu-id="eaf54-137">在 [*PxeProviderShutdown*](pxeprovidershutdown.md)回呼傳回之後，傳遞給 [*PxeProviderInitialize*](pxeproviderinitialize.md)函式的 *hProvider* 控制碼將不再有效，且不應該用來呼叫 WDS。</span><span class="sxs-lookup"><span data-stu-id="eaf54-137">After the [*PxeProviderShutdown*](pxeprovidershutdown.md) callback returns, the *hProvider* handle passed to the [*PxeProviderInitialize*](pxeproviderinitialize.md) function is no longer valid and should not be used to call WDS.</span></span>
-   <span data-ttu-id="eaf54-138">在處理 [*PxeProviderInitialize*](pxeproviderinitialize.md)回呼期間，透過 **PXE \_ 回呼 \_ 關機** 來呼叫 [**PxeRegisterCallback**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeregistercallback)函式，以註冊 [*PxeProviderShutdown*](pxeprovidershutdown.md)回呼。</span><span class="sxs-lookup"><span data-stu-id="eaf54-138">Register the [*PxeProviderShutdown*](pxeprovidershutdown.md) callback by calling the [**PxeRegisterCallback**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeregistercallback) function with **PXE\_CALLBACK\_SHUTDOWN** during the processing of the [*PxeProviderInitialize*](pxeproviderinitialize.md) callback.</span></span> <span data-ttu-id="eaf54-139">如果 *PxeProviderInitialize* 函數失敗，請勿呼叫 *PxeProviderShutdown* 回呼。</span><span class="sxs-lookup"><span data-stu-id="eaf54-139">Do not call the *PxeProviderShutdown* callback if the *PxeProviderInitialize* function fails.</span></span>

## <a name="handle-request-packet"></a><span data-ttu-id="eaf54-140">處理要求封包</span><span class="sxs-lookup"><span data-stu-id="eaf54-140">Handle Request Packet</span></span>

<span data-ttu-id="eaf54-141">為提供者執行 [*PxeProviderRecvRequest*](pxeproviderrecvrequest.md) 回呼。</span><span class="sxs-lookup"><span data-stu-id="eaf54-141">Implement the [*PxeProviderRecvRequest*](pxeproviderrecvrequest.md) callback for the provider.</span></span> <span data-ttu-id="eaf54-142">每個提供者都必須有 *PxeProviderRecvRequest* 回呼。</span><span class="sxs-lookup"><span data-stu-id="eaf54-142">Every provider is required to have a *PxeProviderRecvRequest* callback.</span></span> <span data-ttu-id="eaf54-143">當 WDS 收到要求時，它會呼叫已註冊之提供者清單中第一個提供者的 *PxeProviderRecvRequest* 回呼。</span><span class="sxs-lookup"><span data-stu-id="eaf54-143">When WDS receives a request, it calls the *PxeProviderRecvRequest* callback for the first provider in the registered provider list.</span></span>

-   <span data-ttu-id="eaf54-144">如果提供者會以同步方式處理此要求， [*PxeProviderRecvRequest*](pxeproviderrecvrequest.md) 函數應該會傳回「 **錯誤 \_ 成功**」的值。</span><span class="sxs-lookup"><span data-stu-id="eaf54-144">If the provider will process this request synchronously, the [*PxeProviderRecvRequest*](pxeproviderrecvrequest.md) function should return a value of **ERROR\_SUCCESS**.</span></span> <span data-ttu-id="eaf54-145">只有在提供者將以非同步方式處理此要求時， *PxeProviderRecvRequest* 回呼應該會傳回 **錯誤 \_ IO \_ 暫** 止，並在處理要求時呼叫 [**PxeAsyncRecvDone**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeasyncrecvdone) 函數。</span><span class="sxs-lookup"><span data-stu-id="eaf54-145">If and only if the provider will process this request asynchronously, the *PxeProviderRecvRequest* callback should return **ERROR\_IO\_PENDING** and call the [**PxeAsyncRecvDone**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeasyncrecvdone) function when the request has been processed.</span></span>
-   <span data-ttu-id="eaf54-146">[*PxeProviderRecvRequest*](pxeproviderrecvrequest.md)回呼和 [**PxeAsyncRecvDone**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeasyncrecvdone)函式會傳回 **PXE \_ 開機 \_ 動作** 列舉的位址，以描述提供者處理要求所採取的動作。</span><span class="sxs-lookup"><span data-stu-id="eaf54-146">The [*PxeProviderRecvRequest*](pxeproviderrecvrequest.md) callback and the [**PxeAsyncRecvDone**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeasyncrecvdone) function returns the address of a **PXE\_BOOT\_ACTION** enum that describes the action taken by the provider to handle the request.</span></span>

    <span data-ttu-id="eaf54-147">提供者有四種方式可處理要求：</span><span class="sxs-lookup"><span data-stu-id="eaf54-147">There are four ways for a provider to handle a request:</span></span>

    -   <span data-ttu-id="eaf54-148">提供者會使用包含網路開機程式路徑的標準 DHCP 回應封包來回複用戶端。</span><span class="sxs-lookup"><span data-stu-id="eaf54-148">The provider replies to the client with a standard DHCP response packet that contains a path to the Network Boot Program.</span></span> <span data-ttu-id="eaf54-149">傳回列舉的 **PXE \_ BA \_ NBP** 值表示提供者已成功處理要求封包，並藉由呼叫 [**PxePacketAllocate**](/windows/win32/api/WdsPxe/nf-wdspxe-pxepacketallocate) 和 [**PxeSendReply**](/windows/win32/api/WdsPxe/nf-wdspxe-pxesendreply) 函式來傳送回應封包來完成要求。</span><span class="sxs-lookup"><span data-stu-id="eaf54-149">Returning the **PXE\_BA\_NBP** value for the enum means that the provider has successfully processed the request packet and completed the request by sending a response packet by calling the [**PxePacketAllocate**](/windows/win32/api/WdsPxe/nf-wdspxe-pxepacketallocate) and [**PxeSendReply**](/windows/win32/api/WdsPxe/nf-wdspxe-pxesendreply) functions.</span></span>
    -   <span data-ttu-id="eaf54-150">提供者會使用不符合 DHCP 的自訂回應封包來回複用戶端。</span><span class="sxs-lookup"><span data-stu-id="eaf54-150">The provider replies to the client with a custom response packet that does not conform to DHCP.</span></span> <span data-ttu-id="eaf54-151">傳回列舉的 **PXE \_ BA \_ 自訂** 值表示提供者已成功處理要求封包，並藉由呼叫 [**PxePacketAllocate**](/windows/win32/api/WdsPxe/nf-wdspxe-pxepacketallocate) 和 [**PxeSendReply**](/windows/win32/api/WdsPxe/nf-wdspxe-pxesendreply) 函式來傳送自訂回應封包來完成要求。</span><span class="sxs-lookup"><span data-stu-id="eaf54-151">Returning the **PXE\_BA\_CUSTOM** value for the enum means that the provider has successfully processed the request packet and completed the request by sending a custom response packet by calling the [**PxePacketAllocate**](/windows/win32/api/WdsPxe/nf-wdspxe-pxepacketallocate) and [**PxeSendReply**](/windows/win32/api/WdsPxe/nf-wdspxe-pxesendreply) functions.</span></span>
    -   <span data-ttu-id="eaf54-152">提供者會決定應忽略的要求。</span><span class="sxs-lookup"><span data-stu-id="eaf54-152">The provider determines the request should be ignored.</span></span> <span data-ttu-id="eaf54-153">傳回 **PXE 的 \_ [ \_ 略** 過列舉值] 表示提供者已釋放與要求相關聯的所有資源，且要求未傳遞給已註冊之提供者清單中的下一個提供者。</span><span class="sxs-lookup"><span data-stu-id="eaf54-153">Returning the **PXE\_BA\_IGNORE** value for the enum means the provider has released all resources associated with the request and the request is not passed to the next provider in the list of registered providers.</span></span> <span data-ttu-id="eaf54-154">如果提供者偵測到要求封包無效，則可以使用此選項。</span><span class="sxs-lookup"><span data-stu-id="eaf54-154">Providers may use this option if they detect that a request packet is invalid.</span></span>
    -   <span data-ttu-id="eaf54-155">提供者會拒絕為要求提供服務。</span><span class="sxs-lookup"><span data-stu-id="eaf54-155">The provider declines to service the request.</span></span> <span data-ttu-id="eaf54-156">傳回列舉的 **PXE \_ BA \_ 拒絕** 值，會指示系統將要求傳遞給已註冊之提供者清單中的下一個提供者。</span><span class="sxs-lookup"><span data-stu-id="eaf54-156">Returning the **PXE\_BA\_REJECT** value for the enum instructs the system to pass the request to the next provider in the list of registered providers.</span></span> <span data-ttu-id="eaf54-157">如果這是清單中的最後一個提供者，則會釋放與要求相關聯的所有資源，並忽略要求。</span><span class="sxs-lookup"><span data-stu-id="eaf54-157">If this were the last provider in the list, this releases all resources associated with the request and the request is ignored.</span></span>
    -   <span data-ttu-id="eaf54-158">在處理 [*PxeProviderInitialize*](pxeproviderinitialize.md)回呼期間，透過 **PXE \_ 回呼 \_ 接收 \_ 要求** 來呼叫 [**PxeRegisterCallback**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeregistercallback)函式，以註冊 [*PxeProviderRecvRequest*](pxeproviderrecvrequest.md)回呼。</span><span class="sxs-lookup"><span data-stu-id="eaf54-158">Register the [*PxeProviderRecvRequest*](pxeproviderrecvrequest.md) callback by calling the [**PxeRegisterCallback**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeregistercallback) function with **PXE\_CALLBACK\_RECV\_REQUEST** during the processing of the [*PxeProviderInitialize*](pxeproviderinitialize.md) callback.</span></span>

## <a name="generate-response-packet"></a><span data-ttu-id="eaf54-159">產生回應封包</span><span class="sxs-lookup"><span data-stu-id="eaf54-159">Generate Response Packet</span></span>

-   <span data-ttu-id="eaf54-160">使用 API 來寫入提供者來處理 DHCP 要求並產生回應封包。</span><span class="sxs-lookup"><span data-stu-id="eaf54-160">Use the API to write providers to handle DHCP request and generate response packets.</span></span>
-   <span data-ttu-id="eaf54-161">[**PxeProviderSetAttribute**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeprovidersetattribute)函數會指定提供者用來篩選封包的屬性。</span><span class="sxs-lookup"><span data-stu-id="eaf54-161">The [**PxeProviderSetAttribute**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeprovidersetattribute) function specifies the attributes used by the provider to filter packets.</span></span> <span data-ttu-id="eaf54-162">您可以指定提供者的屬性，讓提供者查看所有封包，提供者只會看到 DHCP 封包，或提供者只看到指定 DHCP 廠商類別識別碼選項的 DHCP 封包 (60) 為 "PXEClient"。</span><span class="sxs-lookup"><span data-stu-id="eaf54-162">The attributes of the provider can be specified so that the provider see all packets, the provider sees only DHCP packets, or the provider sees only DHCP packets that specify the DHCP Vendor Class Identifier option (60) as "PXEClient".</span></span>
-   <span data-ttu-id="eaf54-163">[**PxeDhcpIsValid**](/windows/win32/api/WdsPxe/nf-wdspxe-pxedhcpisvalid)函數會檢查封包是否為有效的 DHCP 封包。</span><span class="sxs-lookup"><span data-stu-id="eaf54-163">The [**PxeDhcpIsValid**](/windows/win32/api/WdsPxe/nf-wdspxe-pxedhcpisvalid) function checks that a packet is a valid DHCP packet.</span></span> <span data-ttu-id="eaf54-164">當使用 [**PxeProviderSetAttribute**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeprovidersetattribute)函式設定的篩選器設定為接收所有封包，以判斷指定的封包是否為有效的 dhcp 封包時，提供者可以使用 **PxeDhcpIsValid** 函數來檢查來自用戶端的封包是否為 DHCP 封包。</span><span class="sxs-lookup"><span data-stu-id="eaf54-164">Providers can use the **PxeDhcpIsValid** function to check whether a packet from the client is a DHCP packet when the filter set with the [**PxeProviderSetAttribute**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeprovidersetattribute) function is set to receive all packets to determine if a specified packet is a valid DHCP packet.</span></span>
-   <span data-ttu-id="eaf54-165">[**PxeDhcpInitialize**](/windows/win32/api/WdsPxe/nf-wdspxe-pxedhcpinitialize)函式會根據從用戶端收到的封包中的資訊，將回應封包初始化為 DHCP 回復封包。</span><span class="sxs-lookup"><span data-stu-id="eaf54-165">The [**PxeDhcpInitialize**](/windows/win32/api/WdsPxe/nf-wdspxe-pxedhcpinitialize) function initializes a response packet as a DHCP reply packet that is based on the information in a packet received from the client.</span></span> <span data-ttu-id="eaf54-166">[*PxeProviderInitialize*](pxeproviderinitialize.md)函式會接受從 [*PxeProviderRecvRequest*](pxeproviderrecvrequest.md)回呼中的用戶端接收之有效 DHCP 封包的位址。</span><span class="sxs-lookup"><span data-stu-id="eaf54-166">The [*PxeProviderInitialize*](pxeproviderinitialize.md) function takes the address of a valid DHCP packet received from the client in the [*PxeProviderRecvRequest*](pxeproviderrecvrequest.md) callback.</span></span> <span data-ttu-id="eaf54-167">**PxeDhcpInitialize** 函式會採用以 [**PxePacketAllocate**](/windows/win32/api/WdsPxe/nf-wdspxe-pxepacketallocate)函式所配置的回復封包指標。</span><span class="sxs-lookup"><span data-stu-id="eaf54-167">The **PxeDhcpInitialize** function takes a pointer to a reply packet allocated with the [**PxePacketAllocate**](/windows/win32/api/WdsPxe/nf-wdspxe-pxepacketallocate) function.</span></span>
-   <span data-ttu-id="eaf54-168">[**PxeDhcpGetOptionValue**](/windows/win32/api/WdsPxe/nf-wdspxe-pxedhcpgetoptionvalue)函式會從 DHCP 封包捕獲選項值。</span><span class="sxs-lookup"><span data-stu-id="eaf54-168">The [**PxeDhcpGetOptionValue**](/windows/win32/api/WdsPxe/nf-wdspxe-pxedhcpgetoptionvalue) function retrieves an option value from a DHCP packet.</span></span> <span data-ttu-id="eaf54-169">[**PxeDhcpGetVendorOptionValue**](/windows/win32/api/WdsPxe/nf-wdspxe-pxedhcpgetvendoroptionvalue)函式會從 DHCP 封包 (43) 中，抓取廠商專屬資訊欄位的選項值。</span><span class="sxs-lookup"><span data-stu-id="eaf54-169">The [**PxeDhcpGetVendorOptionValue**](/windows/win32/api/WdsPxe/nf-wdspxe-pxedhcpgetvendoroptionvalue) function retrieves an option value from the Vendor Specific Information field (43) of a DHCP packet.</span></span>
-   <span data-ttu-id="eaf54-170">然後，提供者可以使用資訊來填入回復封包，並使用 [**PxeSendReply**](/windows/win32/api/WdsPxe/nf-wdspxe-pxesendreply) 函式將回復封包傳送給用戶端。</span><span class="sxs-lookup"><span data-stu-id="eaf54-170">The provider can then populate the reply packet with information and use the [**PxeSendReply**](/windows/win32/api/WdsPxe/nf-wdspxe-pxesendreply) function to send the reply packet to the client.</span></span> <span data-ttu-id="eaf54-171">[**PxeDhcpAppendOption**](/windows/win32/api/WdsPxe/nf-wdspxe-pxedhcpappendoption)函數會將 DHCP 選項附加至回復封包。</span><span class="sxs-lookup"><span data-stu-id="eaf54-171">The [**PxeDhcpAppendOption**](/windows/win32/api/WdsPxe/nf-wdspxe-pxedhcpappendoption) function appends a DHCP option to the reply packet.</span></span>
-   <span data-ttu-id="eaf54-172">藉由傳送封包來回複用戶端要求的提供者，必須使用 [**PxePacketAllocate**](/windows/win32/api/WdsPxe/nf-wdspxe-pxepacketallocate) 函數來配置回應封包。</span><span class="sxs-lookup"><span data-stu-id="eaf54-172">A provider that replies to client requests by sending a packet must allocate the response packet using the [**PxePacketAllocate**](/windows/win32/api/WdsPxe/nf-wdspxe-pxepacketallocate) function.</span></span> <span data-ttu-id="eaf54-173">然後，提供者可以使用資訊來填入回復封包，並使用 [**PxeSendReply**](/windows/win32/api/WdsPxe/nf-wdspxe-pxesendreply) 函式將回復封包傳送給用戶端。</span><span class="sxs-lookup"><span data-stu-id="eaf54-173">The provider can then populate the reply packet with information and use the [**PxeSendReply**](/windows/win32/api/WdsPxe/nf-wdspxe-pxesendreply) function to send the reply packet to the client.</span></span>
-   <span data-ttu-id="eaf54-174">當不再需要配置的記憶體時，提供者應該使用 [**PxePacketFree**](/windows/win32/api/WdsPxe/nf-wdspxe-pxepacketfree) 函式來釋放它。</span><span class="sxs-lookup"><span data-stu-id="eaf54-174">When the allocated memory is no longer needed, the provider should release it using the [**PxePacketFree**](/windows/win32/api/WdsPxe/nf-wdspxe-pxepacketfree) function.</span></span>

## <a name="enumerate-registered-providers"></a><span data-ttu-id="eaf54-175">列舉已註冊的提供者</span><span class="sxs-lookup"><span data-stu-id="eaf54-175">Enumerate Registered Providers</span></span>

-   <span data-ttu-id="eaf54-176">使用 API 來撰寫提供者，以列舉和檢查清單中其他已註冊的提供者。</span><span class="sxs-lookup"><span data-stu-id="eaf54-176">Use the API to write providers that enumerate and check other registered providers in the list.</span></span>
-   <span data-ttu-id="eaf54-177">[**PxeGetServerInfo**](/windows/win32/api/WdsPxe/nf-wdspxe-pxegetserverinfo)函數會傳回 PXE 伺服器的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="eaf54-177">The [**PxeGetServerInfo**](/windows/win32/api/WdsPxe/nf-wdspxe-pxegetserverinfo) function returns information about the PXE server.</span></span> <span data-ttu-id="eaf54-178">**PxeGetServerInfo** 函式會傳回 **布林** 值，指出是否已啟用伺服器的追蹤。</span><span class="sxs-lookup"><span data-stu-id="eaf54-178">The **PxeGetServerInfo** function returns a **BOOL** that indicates whether tracing is enabled for the server.</span></span> <span data-ttu-id="eaf54-179">**TRUE** 表示已啟用追蹤。</span><span class="sxs-lookup"><span data-stu-id="eaf54-179">**TRUE** indicates that tracing is enabled.</span></span>
-   <span data-ttu-id="eaf54-180">[**PxeProviderEnumFirst**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeproviderenumfirst)函式會在已註冊的提供者清單中啟動 enumerationof 提供者。</span><span class="sxs-lookup"><span data-stu-id="eaf54-180">The [**PxeProviderEnumFirst**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeproviderenumfirst) function starts an enumerationof providers in the registered provider list.</span></span> <span data-ttu-id="eaf54-181">**PxeProviderEnumFirst** 函式會啟動列舉，並傳回呼叫 [**PxeProviderEnumNext**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeproviderenumnext)函數時應使用的控制碼位址。</span><span class="sxs-lookup"><span data-stu-id="eaf54-181">The **PxeProviderEnumFirst** function starts the enumeration and returns the address of the handle that should be used when calling the [**PxeProviderEnumNext**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeproviderenumnext) function.</span></span> <span data-ttu-id="eaf54-182">**PxeProviderEnumNext** 函式會傳回 [**PXE \_ 提供**](/windows/win32/api/wdspxe/ns-wdspxe-pxe_provider)者結構，其中包含提供者的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="eaf54-182">The **PxeProviderEnumNext** function returns a [**PXE\_PROVIDER**](/windows/win32/api/wdspxe/ns-wdspxe-pxe_provider) structure containing the information about the provider.</span></span> <span data-ttu-id="eaf54-183">[**PxeProviderFreeInfo**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeproviderfreeinfo)函式會釋放由 **PxeProviderEnumNext** 函數配置給 **PXE \_ 提供者** 結構的記憶體。</span><span class="sxs-lookup"><span data-stu-id="eaf54-183">The [**PxeProviderFreeInfo**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeproviderfreeinfo) function frees the memory that has been allocated for the **PXE\_PROVIDER** structure by the **PxeProviderEnumNext** function.</span></span> <span data-ttu-id="eaf54-184">[**PxeProviderEnumClose**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeproviderenumclose)函式會關閉已註冊之提供者清單中的提供者列舉。</span><span class="sxs-lookup"><span data-stu-id="eaf54-184">The [**PxeProviderEnumClose**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeproviderenumclose) function closes the enumeration of providers in the registered providers list.</span></span>

## <a name="handle-service-control-codes"></a><span data-ttu-id="eaf54-185">處理服務控制碼</span><span class="sxs-lookup"><span data-stu-id="eaf54-185">Handle Service Control Codes</span></span>

-   <span data-ttu-id="eaf54-186">當收到服務控制訊息時，WDS 會呼叫 [*PxeProviderServiceControl*](pxeproviderservicecontrol.md) 回呼。</span><span class="sxs-lookup"><span data-stu-id="eaf54-186">When a service control message is received, WDS calls the [*PxeProviderServiceControl*](pxeproviderservicecontrol.md) callback.</span></span>
-   <span data-ttu-id="eaf54-187">提供者可以定義 [*PxeProviderServiceControl*](pxeproviderservicecontrol.md) 回呼函式來處理服務控制訊息。</span><span class="sxs-lookup"><span data-stu-id="eaf54-187">The provider can define a [*PxeProviderServiceControl*](pxeproviderservicecontrol.md) callback function to handle service control messages.</span></span>
-   <span data-ttu-id="eaf54-188">在處理 [*PxeProviderInitialize*](pxeproviderinitialize.md)回呼期間，透過 **PXE \_ 回呼 \_ 服務 \_ 控制** 呼叫 [**PxeRegisterCallback**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeregistercallback)函式，以註冊 [*PxeProviderServiceControl*](pxeproviderservicecontrol.md)回呼。</span><span class="sxs-lookup"><span data-stu-id="eaf54-188">Register the [*PxeProviderServiceControl*](pxeproviderservicecontrol.md) callback by calling the [**PxeRegisterCallback**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeregistercallback) function with **PXE\_CALLBACK\_SERVICE\_CONTROL** during the processing of the [*PxeProviderInitialize*](pxeproviderinitialize.md) callback.</span></span>

## <a name="add-trace-entries-to-pxe-log"></a><span data-ttu-id="eaf54-189">將追蹤專案新增至 PXE 記錄檔</span><span class="sxs-lookup"><span data-stu-id="eaf54-189">Add Trace Entries to PXE Log</span></span>

-   <span data-ttu-id="eaf54-190">[**PxeTrace**](/windows/win32/api/WdsPxe/nf-wdspxe-pxetrace)函式會將追蹤專案加入至 PXE 記錄檔。</span><span class="sxs-lookup"><span data-stu-id="eaf54-190">The [**PxeTrace**](/windows/win32/api/WdsPxe/nf-wdspxe-pxetrace) function adds a trace entry to the PXE log.</span></span> <span data-ttu-id="eaf54-191">WDSPXE 會提供追蹤來協助系統管理員進行疑難排解。</span><span class="sxs-lookup"><span data-stu-id="eaf54-191">WDSPXE provides tracing to help administrators in troubleshooting.</span></span> <span data-ttu-id="eaf54-192">提供者可以記錄不同嚴重性層級的追蹤專案。</span><span class="sxs-lookup"><span data-stu-id="eaf54-192">Providers can log trace entries of different severity levels.</span></span> <span data-ttu-id="eaf54-193">系統管理員可以將 WDSPXE 設定為只記錄特定嚴重性層級的專案。</span><span class="sxs-lookup"><span data-stu-id="eaf54-193">The administrators can configure WDSPXE to only log entries for certain severity levels.</span></span>

## <a name="related-topics"></a><span data-ttu-id="eaf54-194">相關主題</span><span class="sxs-lookup"><span data-stu-id="eaf54-194">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="eaf54-195">關於 Windows 部署服務 API</span><span class="sxs-lookup"><span data-stu-id="eaf54-195">About the Windows Deployment Services API</span></span>](about-the-windows-deployment-services-api.md)
</dt> <dt>

[<span data-ttu-id="eaf54-196">使用 Windows 部署服務用戶端 API</span><span class="sxs-lookup"><span data-stu-id="eaf54-196">Using the Windows Deployment Services Client API</span></span>](using-the-windows-deployment-services-client-api.md)
</dt> </dl>

 

 




