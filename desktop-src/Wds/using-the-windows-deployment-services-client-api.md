---
title: 使用 Windows 部署服務用戶端 API
description: 在標準 Windows 部署服務 (WDS) 解決方案無法用來安裝 Windows 的環境中，WDS 用戶端的 API 可讓開發人員撰寫自訂部署應用程式。
ms.assetid: abe2a7c7-989a-456e-80df-90d5b816db38
keywords:
- 使用用戶端 API Windows 部署服務 Windows 部署服務
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 872422a5c84bf1d8ea7c3688b122ba2389c1e968
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/20/2020
ms.locfileid: "104023621"
---
# <a name="using-the-windows-deployment-services-client-api"></a><span data-ttu-id="3fe21-104">使用 Windows 部署服務用戶端 API</span><span class="sxs-lookup"><span data-stu-id="3fe21-104">Using the Windows Deployment Services Client API</span></span>

<span data-ttu-id="3fe21-105">在標準 Windows 部署服務 (WDS) 解決方案無法用來安裝 Windows 的環境中，WDS 用戶端的 API 可讓開發人員撰寫自訂部署應用程式。</span><span class="sxs-lookup"><span data-stu-id="3fe21-105">In environments where a standard Windows Deployment Services (WDS) solution cannot be used to install Windows, the API of the WDS client enables developers to write custom deployment applications.</span></span> <span data-ttu-id="3fe21-106">應用程式可以使用此 API 與 WDS 伺服器通訊，以取得可從伺服器取得之系統映射的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="3fe21-106">Applications can use this API to communicate with the WDS server to get information about system images available from the server.</span></span> <span data-ttu-id="3fe21-107">自訂 WDS 用戶端應用程式應遵循下列指導方針。</span><span class="sxs-lookup"><span data-stu-id="3fe21-107">Custom WDS client applications should adhere to the following guidelines.</span></span>

## <a name="install-the-wds-role-on-the-server"></a><span data-ttu-id="3fe21-108">在伺服器上安裝 WDS 角色</span><span class="sxs-lookup"><span data-stu-id="3fe21-108">Install the WDS Role on the Server</span></span>

-   <span data-ttu-id="3fe21-109">Windows 部署服務 (WDS) 是 (RIS) 的遠端安裝服務修訂版本，您將需要伺服器上的 WDS 伺服器角色才能執行自訂 WDS 用戶端解決方案。</span><span class="sxs-lookup"><span data-stu-id="3fe21-109">Windows Deployment Services (WDS) is the revised version of Remote Installation Services (RIS), you will need the WDS server role on the server to implement custom WDS client solutions.</span></span>
-   <span data-ttu-id="3fe21-110">WDS 會以 Windows Server 2008 和 Windows Server 2003 Service Pack 2 (SP2) 的標準元件取代 RIS。</span><span class="sxs-lookup"><span data-stu-id="3fe21-110">WDS replaces RIS as the standard component starting with Windows Server 2008 and Windows Server 2003 with Service Pack 2 (SP2).</span></span>
-   <span data-ttu-id="3fe21-111">您必須將 RIS 伺服器更新至 Windows Server 2003 Service Pack 1 (SP1) 上的 WDS。</span><span class="sxs-lookup"><span data-stu-id="3fe21-111">You must update the RIS server to WDS on Windows Server 2003 with Service Pack 1 (SP1).</span></span> <span data-ttu-id="3fe21-112">您可以使用 [Windows 自動化安裝套件 (WAIK) ](https://www.microsoft.com/download/details.aspx?id=10333)來安裝 WDS 伺服器角色。</span><span class="sxs-lookup"><span data-stu-id="3fe21-112">You can install the WDS server role with the [Windows Automated Installation Kit (WAIK)](https://www.microsoft.com/download/details.aspx?id=10333).</span></span>

## <a name="start-windows-pe-20"></a><span data-ttu-id="3fe21-113">啟動 Windows PE 2。0</span><span class="sxs-lookup"><span data-stu-id="3fe21-113">Start Windows PE 2.0</span></span>

<span data-ttu-id="3fe21-114">必須啟動 Windows PE 2.0 （如果尚未啟動）。</span><span class="sxs-lookup"><span data-stu-id="3fe21-114">Windows PE 2.0 must be started, if not already started.</span></span> <span data-ttu-id="3fe21-115">WDS 用戶端和支援的 Dll 只有在安裝程式的 Microsoft Windows 預先安裝環境 (Windows PE 2.0) 階段時，才會由 setup.exe 載入。</span><span class="sxs-lookup"><span data-stu-id="3fe21-115">The WDS client and supporting DLLs are only loaded by setup.exe when it is in the Microsoft Windows Preinstallation Environment (Windows PE 2.0) phase of setup processing.</span></span>

-   <span data-ttu-id="3fe21-116">當新的電腦連線到網路時，內建的開機前執行環境 (PXE) 技術可以用來下載網路開機程式。</span><span class="sxs-lookup"><span data-stu-id="3fe21-116">When a new computer is connected to the network, the built-in preboot execution environment (PXE) technology can be used to download the Network Boot Program.</span></span> <span data-ttu-id="3fe21-117">如需有關 PXE 啟動電腦以安裝 Windows 的詳細資訊，請參閱 [Windows 部署服務更新逐步指南](/previous-versions/windows/it-pro/windows-vista/cc766320(v=ws.10))。</span><span class="sxs-lookup"><span data-stu-id="3fe21-117">For more information about PXE-booting a computer to install Windows, see [The Windows Deployment Services Update Step-by-Step Guide](/previous-versions/windows/it-pro/windows-vista/cc766320(v=ws.10)).</span></span>
-   <span data-ttu-id="3fe21-118">Windows PE 2.0 的 RAMDISK 可開機映射可以儲存在中。WIM 格式，並在網路開機過程中下載。</span><span class="sxs-lookup"><span data-stu-id="3fe21-118">A RAMDISK bootable image of Windows PE 2.0 can be stored in the .WIM format and downloaded as part of the network boot process.</span></span> <span data-ttu-id="3fe21-119">然後您就可以直接從該媒體載入和執行 Windows PE。</span><span class="sxs-lookup"><span data-stu-id="3fe21-119">Windows PE can then be loaded and run directly from that media.</span></span>

## <a name="open-a-session-with-the-wds-server"></a><span data-ttu-id="3fe21-120">開啟與 WDS 伺服器的會話</span><span class="sxs-lookup"><span data-stu-id="3fe21-120">Open a session with the WDS server</span></span>

<span data-ttu-id="3fe21-121">WDS 用戶端必須開啟與 WDS 伺服器的會話。</span><span class="sxs-lookup"><span data-stu-id="3fe21-121">The WDS client must open a session with a WDS server.</span></span>

-   <span data-ttu-id="3fe21-122">使用 [**WdsCliCreateSession**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclicreatesession) 函式來開啟與 WDS 伺服器的會話。</span><span class="sxs-lookup"><span data-stu-id="3fe21-122">Use the [**WdsCliCreateSession**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclicreatesession) function to open a session with a WDS server.</span></span> <span data-ttu-id="3fe21-123">此函式會接受伺服器的名稱或 IP 位址，並接收 WDS 用戶端會話的控制碼位址。</span><span class="sxs-lookup"><span data-stu-id="3fe21-123">This function takes the name or IP address of the server and receives the address of the handle for the WDS client session.</span></span>
-   <span data-ttu-id="3fe21-124">如果使用伺服器開啟會話將需要驗證 WDS 用戶端，應用程式應該在呼叫 [**WdsCliCreateSession**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclicreatesession)函式時，提供包含用戶端認證的 [**WDS \_ CLI \_**](/windows/win32/api/wdsclientapi/ns-wdsclientapi-wds_cli_cred)認證結構的位址。</span><span class="sxs-lookup"><span data-stu-id="3fe21-124">If opening the session with the server will require authenticating the WDS client, the application should provide the address of a [**WDS\_CLI\_CRED**](/windows/win32/api/wdsclientapi/ns-wdsclientapi-wds_cli_cred) structure containing the client credentials when calling the [**WdsCliCreateSession**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclicreatesession) function.</span></span> <span data-ttu-id="3fe21-125">應用程式可以使用 [**WdsCliAuthorizeSession**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscliauthorizesession) 函式，將匿名會話轉換成經過驗證的會話。</span><span class="sxs-lookup"><span data-stu-id="3fe21-125">The application can use the [**WdsCliAuthorizeSession**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscliauthorizesession) function to convert an anonymous session into an authenticated session.</span></span>
-   <span data-ttu-id="3fe21-126">當不再需要使用 [**WdsCliCreateSession**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclicreatesession) 函式開啟的會話時，應用程式應該使用 [**WdsCliClose**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscliclose) 函數來關閉會話所持有的控制碼和釋放資源。</span><span class="sxs-lookup"><span data-stu-id="3fe21-126">When the session opened with the [**WdsCliCreateSession**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclicreatesession) function is no longer needed, the application should use the [**WdsCliClose**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscliclose) function to close the handle and release resources held by the session.</span></span>

## <a name="enumerate-system-images-on-the-wds-server"></a><span data-ttu-id="3fe21-127">列舉 WDS 伺服器上的系統映射</span><span class="sxs-lookup"><span data-stu-id="3fe21-127">Enumerate system images on the WDS server</span></span>

<span data-ttu-id="3fe21-128">WDS 用戶端可以使用 API 來列舉 WDS 伺服器上的系統映射。</span><span class="sxs-lookup"><span data-stu-id="3fe21-128">The WDS client can use the API to enumerate the system images on the WDS server.</span></span>

-   <span data-ttu-id="3fe21-129">您可以使用 [**WdsCliFindFirstImage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindfirstimage) 函式來取得第一個映射的控制碼，以及初始化 WDS 伺服器上的映射列舉。</span><span class="sxs-lookup"><span data-stu-id="3fe21-129">Use the [**WdsCliFindFirstImage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindfirstimage) function to obtain a handle to the first image and to initialize the enumeration of images on the WDS server.</span></span>
-   <span data-ttu-id="3fe21-130">使用 [**WdsCliFindNextImage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindnextimage) 函式來遞增 [**WdsCliFindFirstImage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindfirstimage) 函數所啟動的列舉。</span><span class="sxs-lookup"><span data-stu-id="3fe21-130">Use the [**WdsCliFindNextImage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindnextimage) function to increment the enumeration started by the [**WdsCliFindFirstImage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindfirstimage) function.</span></span> <span data-ttu-id="3fe21-131">**WdsCliFindNextImage** 函式會取得下一個影像的控制碼。</span><span class="sxs-lookup"><span data-stu-id="3fe21-131">The **WdsCliFindNextImage** function gets the handle for the next image.</span></span>
-   <span data-ttu-id="3fe21-132">您可以使用 [**WdsCliGetImageIndex**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimageindex) 函式來取得目前影像的影像索引。</span><span class="sxs-lookup"><span data-stu-id="3fe21-132">Use the [**WdsCliGetImageIndex**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimageindex) function to obtain the image index for the current image.</span></span> <span data-ttu-id="3fe21-133">只有在再次使用 [**WdsCliFindNextImage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindnextimage) 或 [**WdsCliClose**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscliclose) 函式之前，此值才有效。</span><span class="sxs-lookup"><span data-stu-id="3fe21-133">This value is valid only until the [**WdsCliFindNextImage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindnextimage) or [**WdsCliClose**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscliclose) functions are used again.</span></span>
-   <span data-ttu-id="3fe21-134">您可以使用 [**WdsCliGetEnumerationFlags**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetenumerationflags) 函數來取得有關影像篩選的資訊旗標。</span><span class="sxs-lookup"><span data-stu-id="3fe21-134">Use the [**WdsCliGetEnumerationFlags**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetenumerationflags) function to get informational flags about image filtering.</span></span>

## <a name="get-information-about-images"></a><span data-ttu-id="3fe21-135">取得映射的相關資訊</span><span class="sxs-lookup"><span data-stu-id="3fe21-135">Get information about images</span></span>

<span data-ttu-id="3fe21-136">WDS 用戶端可以使用 API 來取得 WDS 伺服器上映射的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="3fe21-136">The WDS client can use the API to get information about the images on a WDS server.</span></span> <span data-ttu-id="3fe21-137">下列函式會取得目前影像的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="3fe21-137">The following functions get information about the current image.</span></span> <span data-ttu-id="3fe21-138">由於 [**WdsCliFindFirstImage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindfirstimage) 和 [**WdsCliFindNextImage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindnextimage) 函式會變更目前的影像控制碼值，因此應用程式應該儲存它所取得的任何資訊，而且未來將需要這些資訊，才能再次呼叫 **WdsCliFindFirstImage** 或 **WdsCliFindNextImage** 函數。</span><span class="sxs-lookup"><span data-stu-id="3fe21-138">Because the [**WdsCliFindFirstImage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindfirstimage) and [**WdsCliFindNextImage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindnextimage) functions change the current image handle value, the application should store any information it gets and will need in the future before calling the **WdsCliFindFirstImage** or **WdsCliFindNextImage** functions again.</span></span>

-   <span data-ttu-id="3fe21-139">使用 [**WdsCliGetImageArchitecture**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagearchitecture) 函式取得目前映射的處理器架構。</span><span class="sxs-lookup"><span data-stu-id="3fe21-139">Use the [**WdsCliGetImageArchitecture**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagearchitecture) function to get the processor architecture of the current image.</span></span>
-   <span data-ttu-id="3fe21-140">您可以使用 [**WdsCliGetImagePath**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagepath) 函式來取得包含目前影像之影像檔案的相對路徑。</span><span class="sxs-lookup"><span data-stu-id="3fe21-140">Use the [**WdsCliGetImagePath**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagepath) function to get the relative path to the image file that contains the current image.</span></span>
-   <span data-ttu-id="3fe21-141">使用 [**WdsCliGetImageSize**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagesize) 函式來取得影像大小。</span><span class="sxs-lookup"><span data-stu-id="3fe21-141">Use the [**WdsCliGetImageSize**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagesize) function to get the image size.</span></span>
-   <span data-ttu-id="3fe21-142">使用 [**WdsCliGetImageVersion**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimageversion) 函式來取得映射版本。</span><span class="sxs-lookup"><span data-stu-id="3fe21-142">Use the [**WdsCliGetImageVersion**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimageversion) function to get the image version.</span></span>
-   <span data-ttu-id="3fe21-143">使用 [**WdsCliGetImageLanguage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagelanguage) 函式取得目前影像的預設語言。</span><span class="sxs-lookup"><span data-stu-id="3fe21-143">Use the [**WdsCliGetImageLanguage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagelanguage) function to get the default language of the current image.</span></span>
-   <span data-ttu-id="3fe21-144">您可以使用 [**WdsCliGetImageLanguages**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagelanguages) 函式來取得目前影像所支援的語言陣列。</span><span class="sxs-lookup"><span data-stu-id="3fe21-144">Use the [**WdsCliGetImageLanguages**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagelanguages) function to get an array of languages supported by the current image.</span></span>
-   <span data-ttu-id="3fe21-145">使用 [**WdsCliGetImageLastModifiedTime**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagelastmodifiedtime) 會傳回目前影像的上次修改時間。</span><span class="sxs-lookup"><span data-stu-id="3fe21-145">Use the [**WdsCliGetImageLastModifiedTime**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagelastmodifiedtime) returns the last-modified time for the current image.</span></span>
-   <span data-ttu-id="3fe21-146">使用 [**WdsCliGetImageName**](/windows/win32/api/WdsClientApi/nf-wdsclientapi-wdscligetimagename) 函式來取得目前映射的名稱。</span><span class="sxs-lookup"><span data-stu-id="3fe21-146">Use the [**WdsCliGetImageName**](/windows/win32/api/WdsClientApi/nf-wdsclientapi-wdscligetimagename) function to get the name of the current image.</span></span>
-   <span data-ttu-id="3fe21-147">使用 [**WdsCliGetImageDescription**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagedescription) 函式取得目前影像的描述。</span><span class="sxs-lookup"><span data-stu-id="3fe21-147">Use the [**WdsCliGetImageDescription**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagedescription) function to get the description of the current image.</span></span>
-   <span data-ttu-id="3fe21-148">使用 [**WdsCliGetImageGroup**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagegroup) 函式來取得目前映射的映射組名。</span><span class="sxs-lookup"><span data-stu-id="3fe21-148">Use the [**WdsCliGetImageGroup**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagegroup) function to get the image group name for the current image.</span></span>
-   <span data-ttu-id="3fe21-149">使用 [**WdsCliGetImageHalName**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagehalname) 函式來取得目前映射 (HAL) 名稱的硬體抽象層。</span><span class="sxs-lookup"><span data-stu-id="3fe21-149">Use the [**WdsCliGetImageHalName**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagehalname) function to get the Hardware Abstraction Layer (HAL) name for the current image.</span></span>

## <a name="log-wds-client-events"></a><span data-ttu-id="3fe21-150">記錄 WDS 用戶端事件</span><span class="sxs-lookup"><span data-stu-id="3fe21-150">Log WDS Client Events</span></span>

<span data-ttu-id="3fe21-151">WDS 用戶端程式庫的記錄功能可讓您從用戶端將安裝進度事件傳送至 WDS 伺服器。</span><span class="sxs-lookup"><span data-stu-id="3fe21-151">The logging functionality of the WDS client library enables installation progress events to be sent from the client to the WDS server.</span></span>

-   <span data-ttu-id="3fe21-152">使用 [**WdsCliInitializeLog**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscliinitializelog) 函式來初始化 WDS 用戶端會話的記錄檔。</span><span class="sxs-lookup"><span data-stu-id="3fe21-152">Use the [**WdsCliInitializeLog**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscliinitializelog) function to initialize the log for the WDS client session.</span></span>
-   <span data-ttu-id="3fe21-153">使用 [**WdsCliLog**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclilog) 函式將事件訊息寫入至 WDS 伺服器記錄檔。</span><span class="sxs-lookup"><span data-stu-id="3fe21-153">Use the [**WdsCliLog**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclilog) function to write event messages to the WDS server log.</span></span>
-   <span data-ttu-id="3fe21-154">在 Windows Server 2008 上，WDS 伺服器會將用戶端事件寫入應用程式特定事件記錄檔，該記錄檔可透過 eventvwr.exe 以及偵錯工具追蹤記錄檔來查看。</span><span class="sxs-lookup"><span data-stu-id="3fe21-154">On Windows Server 2008, the WDS server writes client events to an application specific event log that is viewable through eventvwr.exe as well as the debug trace log.</span></span> <span data-ttu-id="3fe21-155">在啟用調試記錄的 Windows Server 2003 上，WDS 伺服器會將用戶端事件寫入至% windir% \\ 追蹤 wdsserver 記錄檔 \\ 。</span><span class="sxs-lookup"><span data-stu-id="3fe21-155">On Windows Server 2003 with debug logging enabled, the WDS server will write client events to the log file located at %windir%\\tracing\\wdsserver.log.</span></span> <span data-ttu-id="3fe21-156">您必須在伺服器上啟用 WDS 用戶端記錄，才能捕獲這些事件。</span><span class="sxs-lookup"><span data-stu-id="3fe21-156">WDS Client logging must be enabled on the server to capture these events.</span></span>

## <a name="related-topics"></a><span data-ttu-id="3fe21-157">相關主題</span><span class="sxs-lookup"><span data-stu-id="3fe21-157">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="3fe21-158">關於 Windows 部署服務 API</span><span class="sxs-lookup"><span data-stu-id="3fe21-158">About the Windows Deployment Services API</span></span>](about-the-windows-deployment-services-api.md)
</dt> <dt>

[<span data-ttu-id="3fe21-159">使用 Windows 部署服務伺服器 API</span><span class="sxs-lookup"><span data-stu-id="3fe21-159">Using the Windows Deployment Services Server API</span></span>](using-the-windows-deployment-services-server-api.md)
</dt> </dl>

 

 