---
title: 適用于遊戲開發人員的 Windows Installer
description: 本文概述 Windows Installer，特別是以遊戲開發人員為目標。 如需本文所述之功能和 Api 的詳細檔，請參閱 Windows Platform SDK。
ms.assetid: 07401792-b34b-71c9-18f8-a11c916c7d81
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0e44227b633f7f9491b8a69bc06aa7945941a154
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/20/2020
ms.locfileid: "104375820"
---
# <a name="windows-installer-for-game-developers"></a><span data-ttu-id="0487f-104">適用于遊戲開發人員的 Windows Installer</span><span class="sxs-lookup"><span data-stu-id="0487f-104">Windows Installer for Game Developers</span></span>

<span data-ttu-id="0487f-105">示範如何使用 Windows Installer 在終端使用者電腦上安裝遊戲。</span><span class="sxs-lookup"><span data-stu-id="0487f-105">Shows how Windows Installer can be used to install games on end-user machines.</span></span> <span data-ttu-id="0487f-106">Windows Installer 提供自訂使用者介面的完整支援，以及修補程式。</span><span class="sxs-lookup"><span data-stu-id="0487f-106">Windows Installer offers full support for a customized user interface, as well as for patching.</span></span>

<span data-ttu-id="0487f-107">Microsoft Windows Installer 是在以 Windows 為基礎的電腦上安裝軟體的慣用 API。</span><span class="sxs-lookup"><span data-stu-id="0487f-107">Microsoft Windows Installer is the preferred API for installing software on Windows-based computers.</span></span> <span data-ttu-id="0487f-108">雖然 Windows Installer 的許多功能都是為了支援在公司環境中部署商務應用程式而設計，Windows Installer 也完全適用于在終端使用者電腦上安裝遊戲。</span><span class="sxs-lookup"><span data-stu-id="0487f-108">While many of the features of Windows Installer are designed to support deployment of business applications in a corporate environment, Windows Installer is also completely suitable for installing games on end-user machines.</span></span> <span data-ttu-id="0487f-109">使用 Windows Installer 進行遊戲安裝的主要優點如下：</span><span class="sxs-lookup"><span data-stu-id="0487f-109">The primary advantages of using Windows Installer for game installation are:</span></span>

-   <span data-ttu-id="0487f-110">可靠卸載</span><span class="sxs-lookup"><span data-stu-id="0487f-110">Reliable uninstall</span></span>
-   <span data-ttu-id="0487f-111">視需要安裝內容的能力</span><span class="sxs-lookup"><span data-stu-id="0487f-111">Ability to install content on demand</span></span>
-   <span data-ttu-id="0487f-112">支援完全自訂的使用者介面</span><span class="sxs-lookup"><span data-stu-id="0487f-112">Support for completely custom user interface</span></span>
-   <span data-ttu-id="0487f-113">有效率的修補</span><span class="sxs-lookup"><span data-stu-id="0487f-113">Efficient patching</span></span>

<span data-ttu-id="0487f-114">本文概述 Windows Installer，特別是以遊戲開發人員為目標。</span><span class="sxs-lookup"><span data-stu-id="0487f-114">This article gives an overview of Windows Installer, specifically targeted to game developers.</span></span> <span data-ttu-id="0487f-115">如需本文所述之功能和 Api 的詳細檔，請參閱 Windows Platform SDK。</span><span class="sxs-lookup"><span data-stu-id="0487f-115">For detailed documentation on the features and APIs mentioned in this article, please refer to the Windows Platform SDK.</span></span>

-   [<span data-ttu-id="0487f-116">概觀</span><span class="sxs-lookup"><span data-stu-id="0487f-116">Overview</span></span>](#overview)
-   [<span data-ttu-id="0487f-117">重要 Windows Installer 概念</span><span class="sxs-lookup"><span data-stu-id="0487f-117">Key Windows Installer Concepts</span></span>](#key-windows-installer-concepts)
    -   [<span data-ttu-id="0487f-118">Components</span><span class="sxs-lookup"><span data-stu-id="0487f-118">Components</span></span>](#components)
    -   [<span data-ttu-id="0487f-119">功能</span><span class="sxs-lookup"><span data-stu-id="0487f-119">Features</span></span>](#features)
-   [<span data-ttu-id="0487f-120">安裝狀態</span><span class="sxs-lookup"><span data-stu-id="0487f-120">Install States</span></span>](#install-states)
-   [<span data-ttu-id="0487f-121">隨選安裝</span><span class="sxs-lookup"><span data-stu-id="0487f-121">Install on Demand</span></span>](#install-on-demand)
-   [<span data-ttu-id="0487f-122">自訂使用者介面</span><span class="sxs-lookup"><span data-stu-id="0487f-122">Custom User Interface</span></span>](#custom-user-interface)
-   [<span data-ttu-id="0487f-123">修補</span><span class="sxs-lookup"><span data-stu-id="0487f-123">Patching</span></span>](#patching)
-   [<span data-ttu-id="0487f-124">其他資源</span><span class="sxs-lookup"><span data-stu-id="0487f-124">Other Resources</span></span>](#other-resources)

## <a name="overview"></a><span data-ttu-id="0487f-125">概觀</span><span class="sxs-lookup"><span data-stu-id="0487f-125">Overview</span></span>

<span data-ttu-id="0487f-126">所有以 Windows Installer 為基礎的安裝程式都會使用稱為 MSI 檔案的安裝資料庫檔案來描述應用程式的安裝方式。</span><span class="sxs-lookup"><span data-stu-id="0487f-126">All Windows Installer-based setups use an installation database file called an MSI file to describe how the application is to be installed.</span></span> <span data-ttu-id="0487f-127">MSI 檔案包含要安裝哪些檔案、登錄機碼、桌面快捷方式、檔案關聯和其他應用程式元素的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="0487f-127">The MSI file contains information on what files, registry keys, desktop shortcuts, file associations, and other application elements are to be installed.</span></span> <span data-ttu-id="0487f-128">實際要安裝的檔案可在 MSI 檔案本身內壓縮、配套並壓縮成個別的「封包檔」，或是儲存在安裝媒體上的其他位置，作為個別的未壓縮檔案。</span><span class="sxs-lookup"><span data-stu-id="0487f-128">The actual files to be installed can be compressed within the MSI file itself, bundled and compressed into separate "cabinet files", or stored elsewhere on the installation media as individual uncompressed files.</span></span> <span data-ttu-id="0487f-129">MSI 檔案也可以參考外部執行的自訂動作，以允許 MSI 檔案原本不允許的動作。</span><span class="sxs-lookup"><span data-stu-id="0487f-129">The MSI file can also reference externally implemented custom actions, in order to allow for actions for which the MSI file does not natively allow.</span></span>

<span data-ttu-id="0487f-130">MSI 檔案可以選擇性地包含使用者介面，以引導使用者完成安裝程式。</span><span class="sxs-lookup"><span data-stu-id="0487f-130">An MSI file can optionally contain a user interface to guide the user through the installation process.</span></span> <span data-ttu-id="0487f-131">此 UI 適用于大部分的應用程式。</span><span class="sxs-lookup"><span data-stu-id="0487f-131">This UI is adequate for most applications.</span></span> <span data-ttu-id="0487f-132">不過，它具有一般 Windows 應用程式的外觀和風格，而許多遊戲開發人員偏好讓其安裝應用程式保有遊戲本身的外觀和操作，以提供更一致的終端使用者體驗。</span><span class="sxs-lookup"><span data-stu-id="0487f-132">However, it has the look and feel of a regular Windows application, and many game developers prefer to have their setup application maintain the look and feel of the game itself, in order to provide a more consistent end-user experience.</span></span> <span data-ttu-id="0487f-133">為了支援這個完全自訂的 UI 案例，安裝應用程式可以關閉 Windows Installer 的內建 UI，並處理整個使用者介面本身。</span><span class="sxs-lookup"><span data-stu-id="0487f-133">To support this fully custom UI scenario, a setup application can turn off Windows Installer's built-in UI, and handle the entire user interface itself.</span></span> <span data-ttu-id="0487f-134">Windows Installer API 會公開回呼機制，讓自訂的安裝程式 UI 可以收到安裝進度的通知，以及重要事件，例如磁片變更要求。</span><span class="sxs-lookup"><span data-stu-id="0487f-134">The Windows Installer API exposes a callback mechanism to allow a custom setup UI to be notified of the progress of the installation, as well as important events such as disk change requests.</span></span>

<span data-ttu-id="0487f-135">Windows Installer 不是建立設置的端對端解決方案。</span><span class="sxs-lookup"><span data-stu-id="0487f-135">Windows Installer is not an end-to-end solution for creating setups.</span></span> <span data-ttu-id="0487f-136">它是一種 API，可供安裝程式用來實際安裝檔案、登錄機碼、桌面快捷方式，以及應用程式的其他元素。</span><span class="sxs-lookup"><span data-stu-id="0487f-136">It is only an API that can be used by a setup program to do the actual installation of files, registry keys, desktop shortcuts, and other elements of the application.</span></span> <span data-ttu-id="0487f-137">所有主要商用設定工具的最新版本 (例如，InstallShield、取向、Microsoft Visual Studio) 支援 Windows Installer。</span><span class="sxs-lookup"><span data-stu-id="0487f-137">Recent versions of all of the major commercial setup tools (for example, InstallShield, WISE, and Microsoft Visual Studio) support Windows Installer.</span></span> <span data-ttu-id="0487f-138">這些工具提供便利的使用者介面來建立遊戲的設定，但它們依賴 Windows Installer API 來進行大部分的實際安裝。</span><span class="sxs-lookup"><span data-stu-id="0487f-138">These tools provide convenient user interfaces for creating the setup for a game, but they rely on the Windows Installer API to do much of the actual installation.</span></span> <span data-ttu-id="0487f-139">這些工具也可以用來建立包含安裝套件的 MSI 資料庫，然後從自訂撰寫的安裝程式 UI 來安裝它。</span><span class="sxs-lookup"><span data-stu-id="0487f-139">These tools can also be used just to build an MSI database containing the setup package, which can then be installed from a custom-written setup UI.</span></span> <span data-ttu-id="0487f-140">作為協力廠商工具的替代方案，Windows Installer API 提供以程式設計方式建立和操作 MSI 資料庫所需的所有功能，而 Windows Platform SDK 則包含稱為 Orca 的裸機資料庫編輯工具。</span><span class="sxs-lookup"><span data-stu-id="0487f-140">As an alternative to third-party tools, the Windows Installer API provides all of the functions necessary for creating and manipulating an MSI database programmatically, and the Windows Platform SDK includes a bare-bones MSI database-editing tool called Orca.</span></span>

## <a name="key-windows-installer-concepts"></a><span data-ttu-id="0487f-141">重要 Windows Installer 概念</span><span class="sxs-lookup"><span data-stu-id="0487f-141">Key Windows Installer Concepts</span></span>

<span data-ttu-id="0487f-142">以下是 Windows Installer 的元件和功能。</span><span class="sxs-lookup"><span data-stu-id="0487f-142">Here are the Windows Installer components and features.</span></span>

### <a name="components"></a><span data-ttu-id="0487f-143">單元</span><span class="sxs-lookup"><span data-stu-id="0487f-143">Components</span></span>

<span data-ttu-id="0487f-144">應用程式是由一個或多個元件所組成，由 GUID 元件識別碼來識別。</span><span class="sxs-lookup"><span data-stu-id="0487f-144">An application is made up of one or more components, identified by a GUID component ID.</span></span> <span data-ttu-id="0487f-145">元件是不可部分完成的單位;完整安裝或完全沒有安裝。</span><span class="sxs-lookup"><span data-stu-id="0487f-145">A component is an atomic unit; it is either entirely installed or not installed at all.</span></span> <span data-ttu-id="0487f-146">元件可以包含單一檔案、多個檔案、登錄機碼、桌面快捷方式或某些組合。</span><span class="sxs-lookup"><span data-stu-id="0487f-146">A component can consist of a single file, multiple files, registry keys, desktop shortcuts, or some combination thereof.</span></span> <span data-ttu-id="0487f-147">資源 (檔案等) 元件內的元件對該元件而言必須是唯一的，而且兩個元件都不能包含相同的資源。</span><span class="sxs-lookup"><span data-stu-id="0487f-147">The resources (files, and so on) within a component must be unique to that component-no two components can contain the same resource.</span></span> <span data-ttu-id="0487f-148">絕對不會明確安裝元件;它只會安裝為功能的一部分 (請參閱下列) 。</span><span class="sxs-lookup"><span data-stu-id="0487f-148">A component is never installed explicitly; it is only installed as part of a feature (see following).</span></span>

### <a name="features"></a><span data-ttu-id="0487f-149">功能</span><span class="sxs-lookup"><span data-stu-id="0487f-149">Features</span></span>

<span data-ttu-id="0487f-150">功能是一組元件，由 GUID 功能識別碼識別。</span><span class="sxs-lookup"><span data-stu-id="0487f-150">A feature is a group of components, identified by a GUID feature ID.</span></span> <span data-ttu-id="0487f-151">與元件不同的是，多個功能可能包含相同的元件。</span><span class="sxs-lookup"><span data-stu-id="0487f-151">Unlike components, multiple features may contain the same component.</span></span> <span data-ttu-id="0487f-152">如果已安裝這些功能的任何一項，則會安裝多個功能之間共用的元件，而且只有在已卸載參考元件的所有功能時，才會移除該元件。</span><span class="sxs-lookup"><span data-stu-id="0487f-152">A component shared between multiple features will be installed if any of those features is installed, and removed only when all features that reference the component have been uninstalled.</span></span> <span data-ttu-id="0487f-153">安裝功能可以在產品安裝過程中自動完成，也可以使用 [**MsiConfigureFeature**](/windows/desktop/api/msi/nf-msi-msiconfigurefeaturea) API 手動完成。</span><span class="sxs-lookup"><span data-stu-id="0487f-153">Installation of a feature can be done automatically as part of the installation of a product, or it can be done manually using the [**MsiConfigureFeature**](/windows/desktop/api/msi/nf-msi-msiconfigurefeaturea) API.</span></span>

<span data-ttu-id="0487f-154">雖然有些遊戲有多個可獨立安裝的「功能」，但功能的 Windows Installer 概念仍很有用。</span><span class="sxs-lookup"><span data-stu-id="0487f-154">Although few games have multiple "features" that can be installed independently, the Windows Installer concept of a feature is still useful.</span></span> <span data-ttu-id="0487f-155">由於 Windows Installer 功能不只是一組可一起安裝的元件，因此遊戲可以使用功能將遊戲特定階段所需的所有內容分組在一起。</span><span class="sxs-lookup"><span data-stu-id="0487f-155">Since a Windows Installer feature is nothing more than a collection of components that can be installed together, games can use features to group together all of the content needed for a particular stage of the game.</span></span> <span data-ttu-id="0487f-156">例如，層級導向的遊戲可以定義每個層級的一個功能，其中包含該層級所需的所有內容。</span><span class="sxs-lookup"><span data-stu-id="0487f-156">For example, a level-oriented game could define one feature per level, consisting of all of the content required for that level.</span></span> <span data-ttu-id="0487f-157">這可讓遊戲一次從遊戲本身安裝內容一層，而不是在初始安裝期間安裝所有層級的所有內容。</span><span class="sxs-lookup"><span data-stu-id="0487f-157">This would allow the game to install the content one level at a time from within the game itself, rather than installing all of the content for all of the levels during the initial installation.</span></span>

## <a name="install-states"></a><span data-ttu-id="0487f-158">安裝狀態</span><span class="sxs-lookup"><span data-stu-id="0487f-158">Install States</span></span>

<span data-ttu-id="0487f-159">每個元件或功能都有相關聯的安裝狀態，可判斷元件或功能是否可用，如果是，則會安裝元件或功能的檔案。</span><span class="sxs-lookup"><span data-stu-id="0487f-159">Each component or feature has an associated install state, which determines whether the component or feature is available, and if so, where the files for the component or feature are installed.</span></span> <span data-ttu-id="0487f-160">功能的可能安裝狀態為：</span><span class="sxs-lookup"><span data-stu-id="0487f-160">The possible install states for a feature are:</span></span>

<dl> <dt>

<span data-ttu-id="0487f-161"><span id="Absent"></span><span id="absent"></span><span id="ABSENT"></span>缺席</span><span class="sxs-lookup"><span data-stu-id="0487f-161"><span id="Absent"></span><span id="absent"></span><span id="ABSENT"></span>Absent</span></span>
</dt> <dd>

<span data-ttu-id="0487f-162">這項功能未安裝，因此無法存取。</span><span class="sxs-lookup"><span data-stu-id="0487f-162">The feature is not installed and is therefore inaccessible.</span></span>

</dd> <dt>

<span data-ttu-id="0487f-163"><span id="Local"></span><span id="local"></span><span id="LOCAL"></span>當地</span><span class="sxs-lookup"><span data-stu-id="0487f-163"><span id="Local"></span><span id="local"></span><span id="LOCAL"></span>Local</span></span>
</dt> <dd>

<span data-ttu-id="0487f-164">這項功能可供使用，而且會安裝成從本機硬碟執行。</span><span class="sxs-lookup"><span data-stu-id="0487f-164">The feature is available and is installed to run from the local hard drive.</span></span>

</dd> <dt>

<span data-ttu-id="0487f-165"><span id="Source"></span><span id="source"></span><span id="SOURCE"></span>源</span><span class="sxs-lookup"><span data-stu-id="0487f-165"><span id="Source"></span><span id="source"></span><span id="SOURCE"></span>Source</span></span>
</dt> <dd>

<span data-ttu-id="0487f-166">此功能可供使用，而且會安裝成從原始來源媒體執行， (通常是 CD 或 DVD) 。</span><span class="sxs-lookup"><span data-stu-id="0487f-166">The feature is available and is installed to run from the original source media (usually a CD or DVD).</span></span>

</dd> <dt>

<span data-ttu-id="0487f-167"><span id="Advertised"></span><span id="advertised"></span><span id="ADVERTISED"></span>廣告</span><span class="sxs-lookup"><span data-stu-id="0487f-167"><span id="Advertised"></span><span id="advertised"></span><span id="ADVERTISED"></span>Advertised</span></span>
</dt> <dd>

<span data-ttu-id="0487f-168">尚未安裝此功能，但可使用 [**MsiConfigureFeature**](/windows/desktop/api/msi/nf-msi-msiconfigurefeaturea) API 隨選安裝。</span><span class="sxs-lookup"><span data-stu-id="0487f-168">The feature is not installed, but can be installed on demand using the [**MsiConfigureFeature**](/windows/desktop/api/msi/nf-msi-msiconfigurefeaturea) API.</span></span> <span data-ttu-id="0487f-169">實際安裝功能時，可以將它安裝到本機或來源的狀態。</span><span class="sxs-lookup"><span data-stu-id="0487f-169">When the feature is actually installed, it can be installed either to the Local or Source state.</span></span>

</dd> </dl>

<span data-ttu-id="0487f-170">元件可以有上述任何一個狀態，但「已公告」除外。</span><span class="sxs-lookup"><span data-stu-id="0487f-170">A component can have any of the above states except for "Advertised."</span></span> <span data-ttu-id="0487f-171">如果元件是已公告功能的一部分，則在安裝此功能之前，元件會顯示為「未存在」。</span><span class="sxs-lookup"><span data-stu-id="0487f-171">If a component is part of an advertised feature, the component will appear as "Absent" until the feature is installed.</span></span>

## <a name="install-on-demand"></a><span data-ttu-id="0487f-172">隨選安裝</span><span class="sxs-lookup"><span data-stu-id="0487f-172">Install on Demand</span></span>

<span data-ttu-id="0487f-173">Windows Installer 可讓應用程式將功能標示為已公告，這表示功能尚未安裝，但在需要時可在執行時間安裝。</span><span class="sxs-lookup"><span data-stu-id="0487f-173">Windows Installer allows an application to mark features as Advertised, meaning that the feature is not yet installed, but is available to install at runtime if it is needed.</span></span> <span data-ttu-id="0487f-174">在執行時間安裝功能稱為「隨選安裝」。</span><span class="sxs-lookup"><span data-stu-id="0487f-174">Installing features at runtime is known as "Install on Demand."</span></span> <span data-ttu-id="0487f-175">遊戲可以使用隨選安裝來大幅縮短初始遊戲設定所需的時間，方法是延後安裝遊戲內容，直到執行時間需要為止。</span><span class="sxs-lookup"><span data-stu-id="0487f-175">Games can use Install on Demand to drastically reduce the time required for the initial game setup by deferring the installation of game content until it is needed at runtime.</span></span> <span data-ttu-id="0487f-176">在執行時間安裝內容所需的延遲，通常可以透過在背景執行緒中執行隨選安裝來部分或完全隱藏，而使用者則會被視為該遊戲。</span><span class="sxs-lookup"><span data-stu-id="0487f-176">The delay required to install the content at runtime can often be partially or completely hidden by doing the on-demand installation in a background thread, while the user is otherwise occupied with the game.</span></span>

## <a name="custom-user-interface"></a><span data-ttu-id="0487f-177">自訂使用者介面</span><span class="sxs-lookup"><span data-stu-id="0487f-177">Custom User Interface</span></span>

<span data-ttu-id="0487f-178">雖然 Windows Installer 提供可引導使用者完成應用程式安裝的預設使用者介面，但這個介面看起來就像是標準 Windows 應用程式。</span><span class="sxs-lookup"><span data-stu-id="0487f-178">Although Windows Installer provides a default user interface that guides the user through the installation of the application, this interface looks like that of a standard Windows application.</span></span> <span data-ttu-id="0487f-179">許多遊戲開發人員偏好其安裝 UI 與遊戲本身具有相同的外觀和操作，讓使用者可以感受遊戲的 ambiance。</span><span class="sxs-lookup"><span data-stu-id="0487f-179">Many game developers prefer that their installation UI have the same look and feel as the game itself, to provide the user with a taste of the game's ambiance.</span></span> <span data-ttu-id="0487f-180">為了支援此功能，Windows Installer 可完全停用其內建使用者介面，讓開發人員能夠提供完全自訂的 UI。</span><span class="sxs-lookup"><span data-stu-id="0487f-180">To support this, Windows Installer allows its built-in user interface to be completely disabled, allowing the developer to provide a completely custom UI.</span></span>

<span data-ttu-id="0487f-181">自訂安裝程式會先使用 [**MsiSetInternalUI**](/windows/desktop/api/msi/nf-msi-msisetinternalui) API 來停用 Windows Installer 的內建使用者介面，以將 UI 層級設定為 [無 INSTALLUILEVEL] \_ 。</span><span class="sxs-lookup"><span data-stu-id="0487f-181">The custom setup program first disables Windows Installer's built-in user interface using the [**MsiSetInternalUI**](/windows/desktop/api/msi/nf-msi-msisetinternalui) API to set the UI level to INSTALLUILEVEL\_NONE.</span></span> <span data-ttu-id="0487f-182">然後，它會呼叫 [**MsiSetExternalUI**](/windows/desktop/api/msi/nf-msi-msisetexternaluia) API，以指定要在安裝過程中呼叫的回呼函式，以便在安裝期間通知安裝程式的重要事件。</span><span class="sxs-lookup"><span data-stu-id="0487f-182">It then calls the [**MsiSetExternalUI**](/windows/desktop/api/msi/nf-msi-msisetexternaluia) API to specify a callback function that will be called during the installation process to notify the setup program of key events during the installation.</span></span>

<span data-ttu-id="0487f-183">然後藉由呼叫 [**MsiInstallProduct**](/windows/desktop/api/msi/nf-msi-msiinstallproducta) API 來啟動實際的安裝程式。</span><span class="sxs-lookup"><span data-stu-id="0487f-183">The actual installation process is then started by calling the [**MsiInstallProduct**](/windows/desktop/api/msi/nf-msi-msiinstallproducta) API.</span></span> <span data-ttu-id="0487f-184">此 API 接受參數字串，以允許呼叫者指定命名屬性的值。</span><span class="sxs-lookup"><span data-stu-id="0487f-184">This API accepts a parameter string that allows the caller to specify values for named properties.</span></span> <span data-ttu-id="0487f-185">這些屬性可以在安裝資料庫本身內使用，以自訂應用程式的安裝方式。</span><span class="sxs-lookup"><span data-stu-id="0487f-185">These properties can be used within the installation database itself to customize how the application is to be installed.</span></span> <span data-ttu-id="0487f-186">這些屬性可以用來指定：</span><span class="sxs-lookup"><span data-stu-id="0487f-186">These properties can be used to specify:</span></span>

-   <span data-ttu-id="0487f-187">要在其中安裝應用程式的目錄</span><span class="sxs-lookup"><span data-stu-id="0487f-187">The directory to which the application is to be installed</span></span>
-   <span data-ttu-id="0487f-188">要在本機安裝哪些功能，以及要從 CD/DVD 安裝哪些功能 (例如，讓您可以在最基本安裝和完整安裝之間進行選擇) </span><span class="sxs-lookup"><span data-stu-id="0487f-188">Which features are to be installed locally and which are to be installed to run from the CD/DVD (for example, to enable choosing between a minimal install and a full install)</span></span>
-   <span data-ttu-id="0487f-189">是否應該為電腦的所有使用者安裝應用程式，或僅針對目前的使用者安裝應用程式</span><span class="sxs-lookup"><span data-stu-id="0487f-189">Whether the application should be installed for all users of the machine, or for only the current user</span></span>

<span data-ttu-id="0487f-190">在安裝過程中，安裝程式會使用傳送至回呼函式的通知訊息，以判斷何時更新其進度指標 UI、何時提示使用者插入下一張 CD，或何時通知使用者安裝程式發生錯誤。</span><span class="sxs-lookup"><span data-stu-id="0487f-190">During the course of the installation, the setup program uses the notification messages sent to its callback function to determine when to update its progress indicator UI, when to prompt the user to insert the next CD, or when to notify the user about an error in the installation process.</span></span>

## <a name="patching"></a><span data-ttu-id="0487f-191">修補</span><span class="sxs-lookup"><span data-stu-id="0487f-191">Patching</span></span>

<span data-ttu-id="0487f-192">Windows Installer 允許套用修補檔案來修補已安裝的應用程式。</span><span class="sxs-lookup"><span data-stu-id="0487f-192">Windows Installer allows installed applications to be patched by applying a patch file.</span></span> <span data-ttu-id="0487f-193">修補檔案包含修補程式所要加入的新檔案、由修補程式修改的檔案，以及對安裝資料庫所做的變更清單。</span><span class="sxs-lookup"><span data-stu-id="0487f-193">A patch file contains the new files to be added by the patch, the files that are modified by the patch, and a list of changes to make to the installation database.</span></span> <span data-ttu-id="0487f-194">為了節省空間，而不是儲存修補程式所變更之檔案的完整內容，修補檔案實際上只包含檔案原始版本與新版本檔案之間的差異。</span><span class="sxs-lookup"><span data-stu-id="0487f-194">To conserve space, instead of storing the complete contents of a file changed by the patch, the patch file actually contains only the differences between the original version of the file and the new version of the file.</span></span>

<span data-ttu-id="0487f-195">若要建立修補程式，您需要應用程式的每個版本的安裝映射，您希望修補程式從中升級，以及應用程式新升級版本的安裝映射。</span><span class="sxs-lookup"><span data-stu-id="0487f-195">In order to create a patch, you need the setup image for each of the versions of the application that you wish the patch to upgrade from, as well as the setup image for the new, upgraded version of the application.</span></span> <span data-ttu-id="0487f-196">安裝映射是由 MSI 資料庫和應用程式的所有實際資料檔案所組成。</span><span class="sxs-lookup"><span data-stu-id="0487f-196">A setup image consists of the MSI database and all of the actual data files for the application.</span></span> <span data-ttu-id="0487f-197">若要為新的應用程式版本建立安裝映射，最好的方法是從繼承應用程式複製安裝映射，然後進行任何必要的變更，以將該複本更新為修補過的版本。</span><span class="sxs-lookup"><span data-stu-id="0487f-197">The best way to create a setup image for a new version of the application is to copy the setup image from the previous version of the application, and then make any changes necessary to update that copy to the patched version.</span></span>

<span data-ttu-id="0487f-198">當您擁有所有必要的安裝映射之後，就可以使用 Msimsp.exe 建立修補程式，這是 Platform SDK 中所提供的修補程式建立工具。</span><span class="sxs-lookup"><span data-stu-id="0487f-198">Once you have all of the necessary setup images, you can create the patches using Msimsp.exe, which is a patch creation tool available as part of the Platform SDK.</span></span> <span data-ttu-id="0487f-199">此工具會詢問每個設定影像的位置，然後判斷如何有效率地表示後續版本之間的差異。</span><span class="sxs-lookup"><span data-stu-id="0487f-199">The tool will ask for the locations of each of the setup images, and then determine how to efficiently represent the differences between the successive versions.</span></span> <span data-ttu-id="0487f-200">此工具的輸出是延伸 MSP)  (所識別的最終修補檔。</span><span class="sxs-lookup"><span data-stu-id="0487f-200">The output of the tool is the final patch file (identified by the extension MSP).</span></span> <span data-ttu-id="0487f-201">為了以程式設計的方式安裝修補程式，請呼叫 [**MsiApplyPatch**](/windows/desktop/api/msi/nf-msi-msiapplypatcha) API。</span><span class="sxs-lookup"><span data-stu-id="0487f-201">In order to install the patch programmatically, call the [**MsiApplyPatch**](/windows/desktop/api/msi/nf-msi-msiapplypatcha) API.</span></span> <span data-ttu-id="0487f-202">使用者也可以在 [Explorer] 中按兩下 MSP 檔案，以手動方式安裝修補程式。</span><span class="sxs-lookup"><span data-stu-id="0487f-202">The user can also install the patch manually by double-clicking on the MSP file in Explorer.</span></span>

## <a name="other-resources"></a><span data-ttu-id="0487f-203">其他資源</span><span class="sxs-lookup"><span data-stu-id="0487f-203">Other Resources</span></span>

-   <span data-ttu-id="0487f-204">如需 Windows Installer API 的詳細資訊，請參閱 [Windows Installer](/windows/desktop/Msi/windows-installer-portal)。</span><span class="sxs-lookup"><span data-stu-id="0487f-204">For detailed info on the Windows Installer API, see [Windows Installer](/windows/desktop/Msi/windows-installer-portal).</span></span>
-   <span data-ttu-id="0487f-205">如需遊戲安裝的最佳作法資訊，請參閱 [遊戲的安裝與維護](/windows/desktop/DxTechArts/installation-and-maintenance-of-games)。</span><span class="sxs-lookup"><span data-stu-id="0487f-205">For info on best practices for game installation, see [Installation and Maintenance of Games](/windows/desktop/DxTechArts/installation-and-maintenance-of-games).</span></span>

 

 