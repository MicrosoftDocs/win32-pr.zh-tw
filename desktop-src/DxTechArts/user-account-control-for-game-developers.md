---
title: 遊戲開發人員的使用者帳戶控制
description: 本文描述的指導方針和最佳作法，可讓遊戲開發人員有效地使用 Windows Vista 所引進 (UAC) 安全性功能的使用者帳戶控制。
ms.assetid: dbac1c07-73dd-f2bc-3c5c-d6160368a88f
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 57d5533a3fbdd349cc25dfde501a234bbd7b05b1
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/20/2020
ms.locfileid: "104375932"
---
# <a name="user-account-control-for-game-developers"></a><span data-ttu-id="b2b26-103">遊戲開發人員的使用者帳戶控制</span><span class="sxs-lookup"><span data-stu-id="b2b26-103">User Account Control for Game Developers</span></span>

<span data-ttu-id="b2b26-104">本文描述的指導方針和最佳作法，可讓遊戲開發人員有效地使用 Windows Vista 所引進 (UAC) 安全性功能的使用者帳戶控制。</span><span class="sxs-lookup"><span data-stu-id="b2b26-104">This article describes the guidelines and best practices for game developers to work effectively with the User Account Control (UAC) security feature introduced in Windows Vista.</span></span>

-   [<span data-ttu-id="b2b26-105">使用者帳戶控制的總覽</span><span class="sxs-lookup"><span data-stu-id="b2b26-105">Overview of User Account Control</span></span>](#overview-of-user-account-control)
-   [<span data-ttu-id="b2b26-106">Windows Vista 中的使用者帳戶</span><span class="sxs-lookup"><span data-stu-id="b2b26-106">User Accounts in Windows Vista</span></span>](#user-accounts-in-windows-vista)
-   [<span data-ttu-id="b2b26-107">以標準使用者的方式存取檔案</span><span class="sxs-lookup"><span data-stu-id="b2b26-107">File Access as a Standard User</span></span>](#file-access-as-a-standard-user)
-   [<span data-ttu-id="b2b26-108">以標準使用者的形式登錄存取</span><span class="sxs-lookup"><span data-stu-id="b2b26-108">Registry Access as a Standard User</span></span>](#registry-access-as-a-standard-user)
-   [<span data-ttu-id="b2b26-109">權限提高</span><span class="sxs-lookup"><span data-stu-id="b2b26-109">Privilege Elevation</span></span>](#privilege-elevation)
-   [<span data-ttu-id="b2b26-110">CreateProcess () 的 UAC 含意 </span><span class="sxs-lookup"><span data-stu-id="b2b26-110">UAC Implications with CreateProcess()</span></span>](#uac-implications-with-createprocess)
-   [<span data-ttu-id="b2b26-111">在應用程式資訊清單中設定執行層級</span><span class="sxs-lookup"><span data-stu-id="b2b26-111">Setting the Execution Level in the Application Manifest</span></span>](#setting-the-execution-level-in-the-application-manifest)
-   [<span data-ttu-id="b2b26-112">在 Visual Studio 中內嵌資訊清單</span><span class="sxs-lookup"><span data-stu-id="b2b26-112">Embedding a Manifest in Visual Studio</span></span>](#embedding-a-manifest-in-visual-studio)
-   [<span data-ttu-id="b2b26-113">UAC 與舊版遊戲的相容性</span><span class="sxs-lookup"><span data-stu-id="b2b26-113">UAC Compatibility with Older Games</span></span>](#uac-compatibility-with-older-games)
-   [<span data-ttu-id="b2b26-114">舊版案例和資訊清單</span><span class="sxs-lookup"><span data-stu-id="b2b26-114">Legacy Scenarios and Manifests</span></span>](#legacy-scenarios-and-manifests)
-   [<span data-ttu-id="b2b26-115">結論</span><span class="sxs-lookup"><span data-stu-id="b2b26-115">Conclusion</span></span>](#conclusion)
-   [<span data-ttu-id="b2b26-116">深入閱讀</span><span class="sxs-lookup"><span data-stu-id="b2b26-116">Further Reading</span></span>](#further-reading)

## <a name="overview-of-user-account-control"></a><span data-ttu-id="b2b26-117">使用者帳戶控制的總覽</span><span class="sxs-lookup"><span data-stu-id="b2b26-117">Overview of User Account Control</span></span>

<span data-ttu-id="b2b26-118">在 Windows Vista 中引進的 (UAC) 的使用者帳戶控制是一項安全性功能，其設計目的是協助防止惡意攻擊者使用廣泛使用的應用程式中發現的弱點或 bug，來改變作業系統或其他已安裝的程式。</span><span class="sxs-lookup"><span data-stu-id="b2b26-118">User Account Control (UAC), introduced in Windows Vista, is a security feature that is designed to help prevent malicious attackers from using weaknesses or bugs found in widely-used applications to alter the operating system or other installed programs.</span></span> <span data-ttu-id="b2b26-119">只要以標準使用者的身分執行大部分的程式和程式， (也稱為受限使用者、受限的使用者或 Least-Privileged 使用者) ，即使目前使用者的帳戶具有系統管理認證，也可以達成這個目的。</span><span class="sxs-lookup"><span data-stu-id="b2b26-119">This is accomplished by running the vast majority of programs and processes as a Standard User (also known as a Limited User, Restricted User, or Least-Privileged User) even if the current user's account has administrative credentials.</span></span> <span data-ttu-id="b2b26-120">具有標準使用者權限的進程具有許多固有的限制，可防止它進行全系統的變更。</span><span class="sxs-lookup"><span data-stu-id="b2b26-120">A process with standard user privileges has many inherent restrictions that prevent it from making system-wide changes.</span></span>

<span data-ttu-id="b2b26-121">UAC 也負責處理權限提高，方法是使用在執行特定進程（指定為需要系統管理許可權）時所起始的對話型驗證配置。</span><span class="sxs-lookup"><span data-stu-id="b2b26-121">UAC is also responsible for privilege elevation of a process by use of a dialog-based, authentication scheme initiated upon execution of certain processes that are designated as requiring administrative privileges.</span></span> <span data-ttu-id="b2b26-122">權限提高可讓系統管理員以安全的許可權層級執行大部分的應用程式 (與任何其他標準使用者) 相同，但也允許需要系統管理許可權的進程和作業。</span><span class="sxs-lookup"><span data-stu-id="b2b26-122">Privilege elevation allows administrators to run the majority of their applications at a safe privilege level (the same as any other standard user), but also allow processes and operations that require administrative privileges.</span></span> <span data-ttu-id="b2b26-123">UAC 支援過度的驗證，讓系統管理員可以在標準使用者目前登入系統時，將較高的許可權授與程式。</span><span class="sxs-lookup"><span data-stu-id="b2b26-123">UAC supports over-the-shoulder authentication so that an administrator can grant elevated privileges to a program while a standard user is currently logged onto the system.</span></span>

<span data-ttu-id="b2b26-124">UAC 功能預設為啟用。</span><span class="sxs-lookup"><span data-stu-id="b2b26-124">The UAC feature is enabled by default.</span></span> <span data-ttu-id="b2b26-125">雖然系統管理員可以停用 UAC 全系統，但是這樣做會有一些負面的後果。</span><span class="sxs-lookup"><span data-stu-id="b2b26-125">While it is possible for an administrator to disable UAC system-wide, doing so has a number of negative ramifications.</span></span> <span data-ttu-id="b2b26-126">首先，這會削弱所有系統管理帳戶的安全性，因為所有程式都是以系統管理認證執行，即使大部分的應用程式實際上並不需要它們。</span><span class="sxs-lookup"><span data-stu-id="b2b26-126">First, this weakens the security of all administrative accounts, as all processes would be run with administrative credentials, even when most applications do not actually require them.</span></span> <span data-ttu-id="b2b26-127">停用 UAC 之後，在安全性中公開可攻擊弱點的標準使用者應用程式，可能會被用來竊取私人資訊、安裝 rootkit 或間諜軟體、損毀系統完整性，或在其他系統上裝載廢止的攻擊。</span><span class="sxs-lookup"><span data-stu-id="b2b26-127">With UAC disabled, a standard user application that exposes an exploitable vulnerability in security can potentially be used to steal private information, install rootkits or spyware, destroy the system integrity, or host zombie attacks on other systems.</span></span> <span data-ttu-id="b2b26-128">在啟用 UAC 的情況下，以標準使用者的形式執行大部分的軟體，可大幅限制這類 bug 可能造成的損害。</span><span class="sxs-lookup"><span data-stu-id="b2b26-128">Whereas with UAC enabled, running the majority of software as a standard user greatly limits the potential damage from such a bug.</span></span> <span data-ttu-id="b2b26-129">其次，關閉 UAC 會停用應用程式相容性的許多因應措施，讓真正的標準使用者能夠成功地執行廣泛的應用程式。</span><span class="sxs-lookup"><span data-stu-id="b2b26-129">Secondly, turning off UAC disables many of the workarounds for application compatibility that allow true standard users to successfully run a broad range of applications.</span></span> <span data-ttu-id="b2b26-130">永遠不應建議停用 UAC 作為相容性因應措施。</span><span class="sxs-lookup"><span data-stu-id="b2b26-130">Disabling UAC should never be recommended as a compatibility workaround.</span></span>

<span data-ttu-id="b2b26-131">請務必注意，應用程式應該盡可能只使用標準使用者權限。</span><span class="sxs-lookup"><span data-stu-id="b2b26-131">It is important to note that applications should strive to only use standard user rights if at all possible.</span></span> <span data-ttu-id="b2b26-132">雖然系統管理員可以輕鬆地提升進程的許可權，但在每次執行需要系統管理認證的應用程式時，提高許可權仍需要使用者互動和通知。</span><span class="sxs-lookup"><span data-stu-id="b2b26-132">While administrators can easily elevate the privileges of a process, the elevation still requires user interaction and acknowledgement every time that an application is run that requires administrative credentials.</span></span> <span data-ttu-id="b2b26-133">這項提高許可權也必須在程式啟動時完成，因此即使是單一作業，也需要系統管理認證，才能讓系統在應用程式的整個執行時間暴露在更高的風險。</span><span class="sxs-lookup"><span data-stu-id="b2b26-133">This elevation must also be done at the time that the program starts, so requiring administrative credentials   even for a single operation   requires exposing the system to greater risk for the entire running time of the application.</span></span> <span data-ttu-id="b2b26-134">標準使用者若沒有提高其許可權的能力，在家庭和企業設定中也很常見。</span><span class="sxs-lookup"><span data-stu-id="b2b26-134">Standard users without any ability to elevate their privileges are also common in family and business settings.</span></span> <span data-ttu-id="b2b26-135">「以系統管理員身分執行」不是很好的相容性因應措施，會使使用者和系統暴露于更高的安全性風險，並且在許多情況下為使用者帶來挫折。</span><span class="sxs-lookup"><span data-stu-id="b2b26-135">"Run As Administrator" is not a good workaround for compatibility, exposes the user and the system to greater security risk, and creates frustration for users in many situations.</span></span>

> [!Note]  
> <span data-ttu-id="b2b26-136">Windows Vista 中引進的「使用者帳戶控制」功能也會出現在 Windows 7 中。</span><span class="sxs-lookup"><span data-stu-id="b2b26-136">The User Account Control feature introduced in Windows Vista is also present in Windows 7.</span></span> <span data-ttu-id="b2b26-137">雖然使用各種系統功能的使用者經驗已透過使用者帳戶控制獲得改良，但對應用程式的影響基本上是相同的。</span><span class="sxs-lookup"><span data-stu-id="b2b26-137">While the user experience working with the various system features has been improved with respect to User Account Control, the impact on applications is basically the same.</span></span> <span data-ttu-id="b2b26-138">本文中的所有 Windows Vista 建議也適用于 Windows 7。</span><span class="sxs-lookup"><span data-stu-id="b2b26-138">All of the Windows Vista recommendations in this article apply to Windows 7 as well.</span></span> <span data-ttu-id="b2b26-139">如需 Windows 7 的 UAC UI 變更的詳細資訊，請參閱 [消費者介面-使用者帳戶控制對話方塊更新](../win7appqual/user-interface---user-account-control-dialog-updates.md)。</span><span class="sxs-lookup"><span data-stu-id="b2b26-139">For details on the UAC UI changes for Windows 7, see [User Interface - User Account Control Dialog Updates](../win7appqual/user-interface---user-account-control-dialog-updates.md).</span></span>

 

## <a name="user-accounts-in-windows-vista"></a><span data-ttu-id="b2b26-140">Windows Vista 中的使用者帳戶</span><span class="sxs-lookup"><span data-stu-id="b2b26-140">User Accounts in Windows Vista</span></span>

<span data-ttu-id="b2b26-141">Windows Vista 會將每位使用者分類成兩種使用者帳戶類型：系統管理員和標準使用者。</span><span class="sxs-lookup"><span data-stu-id="b2b26-141">Windows Vista categorizes every user into two user account types: administrators and standard users.</span></span>

<span data-ttu-id="b2b26-142">標準使用者帳戶類似于 Windows XP 中的受限使用者帳戶。</span><span class="sxs-lookup"><span data-stu-id="b2b26-142">A standard user account is similar to a limited-user account in Windows XP.</span></span> <span data-ttu-id="b2b26-143">如同在 Windows XP 中，標準使用者無法寫入 [Program Files] 資料夾，無法寫入登錄的 HKEY \_ 本機 \_ 電腦部分，也無法執行修改系統的工作，例如安裝核心模式驅動程式或存取系統層級進程空間。</span><span class="sxs-lookup"><span data-stu-id="b2b26-143">Like in Windows XP, a standard user cannot write to the Program Files folder, cannot write to the HKEY\_LOCAL\_MACHINE portion of the registry, and cannot perform tasks that alter the system, such as installing a kernel-mode driver or accessing system-level process spaces.</span></span>

<span data-ttu-id="b2b26-144">自 Windows XP 發行之後，系統管理員帳戶已大幅變更。</span><span class="sxs-lookup"><span data-stu-id="b2b26-144">The Administrator account has significantly changed since Windows XP was released.</span></span> <span data-ttu-id="b2b26-145">之前，由 Administrators 群組成員啟動的所有進程都具有系統管理許可權。</span><span class="sxs-lookup"><span data-stu-id="b2b26-145">Previously, all processes launched by a member of the Administrators group were given administrative privileges.</span></span> <span data-ttu-id="b2b26-146">在啟用 UAC 的情況下，所有進程都會以標準使用者權限執行，除非系統管理員特別提高許可權。</span><span class="sxs-lookup"><span data-stu-id="b2b26-146">With UAC enabled, all processes execute with standard user privileges, unless specifically elevated by an administrator.</span></span> <span data-ttu-id="b2b26-147">這項差異讓系統管理員群組中的帳戶更安全，方法是降低大部分程式中可能發生的錯誤所造成的安全性風險。</span><span class="sxs-lookup"><span data-stu-id="b2b26-147">This difference makes accounts in the Administrators group more secure by reducing the security risk posed by potential bugs in most programs.</span></span>

<span data-ttu-id="b2b26-148">在以標準使用者進程的形式執行時，所有應用程式（尤其是遊戲）都必須以有效率且負責任的方式運作。</span><span class="sxs-lookup"><span data-stu-id="b2b26-148">It is important that all applications, especially games, operate effectively and responsibly when run as a standard user process.</span></span> <span data-ttu-id="b2b26-149">所有需要系統管理許可權的作業都應在安裝時完成，或是由明確要求系統管理認證的輔助程式進行。</span><span class="sxs-lookup"><span data-stu-id="b2b26-149">All operations that require administrative privileges should be done either at installation time or by auxiliary programs that explicitly request administrative credentials.</span></span> <span data-ttu-id="b2b26-150">雖然許可權提升對於系統管理員群組的成員而言相當簡單，但標準使用者必須延遲給具有系統管理認證的使用者，才能實際輸入其密碼以提升許可權。</span><span class="sxs-lookup"><span data-stu-id="b2b26-150">While privilege elevation is fairly trivial for a member of the Administrators group, standard users must defer to someone with administrative credentials to physically enter their password to elevate privileges.</span></span> <span data-ttu-id="b2b26-151">由於受家長監護保護的帳戶必須是標準使用者，因此對於使用 Windows Vista 的玩家來說，這是很常見的情況。</span><span class="sxs-lookup"><span data-stu-id="b2b26-151">Since accounts protected by parental controls must be standard users, this will be a very common situation for gamers who are using Windows Vista.</span></span>

<span data-ttu-id="b2b26-152">如果您的遊戲已經在 Windows XP 上使用有限的使用者帳戶，則在 Windows Vista 上的「移至使用者帳戶控制」應該相當簡單。</span><span class="sxs-lookup"><span data-stu-id="b2b26-152">If your game is already working on Windows XP with limited-user accounts, then the move to User Account Control on Windows Vista should be very easy.</span></span> <span data-ttu-id="b2b26-153">大部分的這類應用程式都可以正常運作，但強烈建議新增應用程式資訊清單。</span><span class="sxs-lookup"><span data-stu-id="b2b26-153">The majority of such applications will work as-is, although adding an application manifest is highly recommended.</span></span> <span data-ttu-id="b2b26-154">在 [應用程式資訊清單中設定執行層級](#setting-the-execution-level-in-the-application-manifest)的本主題稍後會描述 (資訊清單。 ) </span><span class="sxs-lookup"><span data-stu-id="b2b26-154">(Manifests are described later in this topic in [Setting the Execution Level in the Application Manifest](#setting-the-execution-level-in-the-application-manifest).)</span></span>

## <a name="file-access-as-a-standard-user"></a><span data-ttu-id="b2b26-155">以標準使用者的方式存取檔案</span><span class="sxs-lookup"><span data-stu-id="b2b26-155">File Access as a Standard User</span></span>

<span data-ttu-id="b2b26-156">最受標準使用者限制影響的遊戲層面是檔案系統組織和協助工具。</span><span class="sxs-lookup"><span data-stu-id="b2b26-156">The aspect of your game most affected by standard user restrictions is file system organization and accessibility.</span></span> <span data-ttu-id="b2b26-157">您永遠不應該假設您的遊戲可將檔案寫入您的遊戲安裝所在的資料夾。</span><span class="sxs-lookup"><span data-stu-id="b2b26-157">You should never assume that your game can write files to the folder where your game is installed.</span></span> <span data-ttu-id="b2b26-158">比方說，在 Windows Vista 中，使用者必須先提升作業系統的許可權，應用程式才能寫入 Program Files 資料夾。</span><span class="sxs-lookup"><span data-stu-id="b2b26-158">In Windows Vista for instance, a user s privileges must be elevated by the operating system before an application can write to the Program Files folder.</span></span> <span data-ttu-id="b2b26-159">若要避免這種情況，您應該依照範圍和協助工具將遊戲的資料檔案分類，並使用 [**SHGetFolderPath**](/windows/win32/api/shlobj_core/nf-shlobj_core-shgetfolderpatha) 函式，以及 Windows shell 提供的 CSIDL 常數來產生適當的檔案路徑。</span><span class="sxs-lookup"><span data-stu-id="b2b26-159">To avoid this, you should categorize your game s data files by scope and accessibility, and use the [**SHGetFolderPath**](/windows/win32/api/shlobj_core/nf-shlobj_core-shgetfolderpatha) function, along with the CSIDL constants provided by the Windows shell, to generate the appropriate file paths.</span></span> <span data-ttu-id="b2b26-160">CSIDL 常數對應至檔案系統中作業系統所使用的已知資料夾，並升級以分割全域和使用者特定的檔案。</span><span class="sxs-lookup"><span data-stu-id="b2b26-160">The CSIDL constants correspond to known folders in the file system that the operating system uses and promotes to partition global and user-specific files.</span></span>

<span data-ttu-id="b2b26-161">如果應用程式沒有系統管理許可權，嘗試在未授與寫入權限給進程的資料夾下建立或寫入檔案或目錄，將會在 Windows Vista 下失敗。</span><span class="sxs-lookup"><span data-stu-id="b2b26-161">Attempting to create or write a file or directory under a folder which does not grant write permission to the process will fail under Windows Vista if the application does not have administrative privileges.</span></span> <span data-ttu-id="b2b26-162">如果您的32位遊戲可執行檔是在舊版模式中執行，因為它並未宣告要求的執行層級，其寫入作業將會成功，但會受限於虛擬化，如本文稍後的「與舊版遊戲的 UAC 相容性」一節中所述。</span><span class="sxs-lookup"><span data-stu-id="b2b26-162">If your 32-bit game executable is running in legacy mode, because it did not declare a requested execution level, its write operations will succeed, but they will be subjected to virtualization as described in the section "UAC Compatibility with Older Games" later in this article.</span></span>

<span data-ttu-id="b2b26-163">**[表 1]。已知的資料夾**</span><span class="sxs-lookup"><span data-stu-id="b2b26-163">**Table 1. Known Folders**</span></span>



| <span data-ttu-id="b2b26-164">CSIDL 名稱</span><span class="sxs-lookup"><span data-stu-id="b2b26-164">CSIDL Name</span></span>             | <span data-ttu-id="b2b26-165"> (Windows Vista) 的一般路徑</span><span class="sxs-lookup"><span data-stu-id="b2b26-165">Typical Path (Windows Vista)</span></span>                                                   | <span data-ttu-id="b2b26-166">標準使用者權限</span><span class="sxs-lookup"><span data-stu-id="b2b26-166">Standard User Rights</span></span> | <span data-ttu-id="b2b26-167">系統管理員權限</span><span class="sxs-lookup"><span data-stu-id="b2b26-167">Administrator Rights</span></span> | <span data-ttu-id="b2b26-168">存取範圍</span><span class="sxs-lookup"><span data-stu-id="b2b26-168">Access Scope</span></span> | <span data-ttu-id="b2b26-169">描述</span><span class="sxs-lookup"><span data-stu-id="b2b26-169">Description</span></span>                                                                                                                      | <span data-ttu-id="b2b26-170">範例</span><span class="sxs-lookup"><span data-stu-id="b2b26-170">Examples</span></span>                                                          |
|------------------------|--------------------------------------------------------------------------------|----------------------|----------------------|--------------|----------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------|
| <span data-ttu-id="b2b26-171">CSIDL \_ 個人</span><span class="sxs-lookup"><span data-stu-id="b2b26-171">CSIDL\_PERSONAL</span></span>        | <span data-ttu-id="b2b26-172">C： \\ 使用者 \\ 使用者名稱 \\ 檔</span><span class="sxs-lookup"><span data-stu-id="b2b26-172">C:\\Users\\user name\\Documents</span></span>                                                | <span data-ttu-id="b2b26-173">讀取/寫入</span><span class="sxs-lookup"><span data-stu-id="b2b26-173">Read/Write</span></span>           | <span data-ttu-id="b2b26-174">讀取/寫入</span><span class="sxs-lookup"><span data-stu-id="b2b26-174">Read/Write</span></span>           | <span data-ttu-id="b2b26-175">Per-User</span><span class="sxs-lookup"><span data-stu-id="b2b26-175">Per-User</span></span>     | <span data-ttu-id="b2b26-176">讀取和修改的使用者特定遊戲檔案，可在遊戲內容之外操作。</span><span class="sxs-lookup"><span data-stu-id="b2b26-176">User-specific game files that are read and modified and can be manipulated outside of the game context.</span></span>                          | <span data-ttu-id="b2b26-177">螢幕擷取畫面。</span><span class="sxs-lookup"><span data-stu-id="b2b26-177">Screen shots.</span></span> <span data-ttu-id="b2b26-178">以副檔名關聯儲存遊戲檔案。</span><span class="sxs-lookup"><span data-stu-id="b2b26-178">Saved game files with a file extension association.</span></span> |
| <span data-ttu-id="b2b26-179">CSIDL \_ 本機 \_ APPDATA</span><span class="sxs-lookup"><span data-stu-id="b2b26-179">CSIDL\_LOCAL\_APPDATA</span></span>  | <span data-ttu-id="b2b26-180">C： \\ Users \\ 使用者名稱 \\ AppData \\ Local</span><span class="sxs-lookup"><span data-stu-id="b2b26-180">C:\\Users\\user name\\AppData\\Local</span></span>                                           | <span data-ttu-id="b2b26-181">讀取/寫入</span><span class="sxs-lookup"><span data-stu-id="b2b26-181">Read/Write</span></span>           | <span data-ttu-id="b2b26-182">讀取/寫入</span><span class="sxs-lookup"><span data-stu-id="b2b26-182">Read/Write</span></span>           | <span data-ttu-id="b2b26-183">Per-User</span><span class="sxs-lookup"><span data-stu-id="b2b26-183">Per-User</span></span>     | <span data-ttu-id="b2b26-184">使用者專屬的遊戲檔案，這些檔案只會在遊戲內容中讀取和修改，且僅供使用。</span><span class="sxs-lookup"><span data-stu-id="b2b26-184">User-specific game files that are read and modified and are of use only within the game context.</span></span>                                 | <span data-ttu-id="b2b26-185">遊戲快取檔案。</span><span class="sxs-lookup"><span data-stu-id="b2b26-185">Game cache files.</span></span> <span data-ttu-id="b2b26-186">播放機設定。</span><span class="sxs-lookup"><span data-stu-id="b2b26-186">Player configurations.</span></span>                          |
| <span data-ttu-id="b2b26-187">CSIDL \_ 一般 \_ APPDATA</span><span class="sxs-lookup"><span data-stu-id="b2b26-187">CSIDL\_COMMON\_APPDATA</span></span> | <span data-ttu-id="b2b26-188">C： \\ ProgramData</span><span class="sxs-lookup"><span data-stu-id="b2b26-188">C:\\ProgramData</span></span>                                                                | <span data-ttu-id="b2b26-189">如果擁有者，則為讀取/寫入</span><span class="sxs-lookup"><span data-stu-id="b2b26-189">Read/Write if owner</span></span>  | <span data-ttu-id="b2b26-190">讀取/寫入</span><span class="sxs-lookup"><span data-stu-id="b2b26-190">Read/Write</span></span>           | <span data-ttu-id="b2b26-191">所有使用者</span><span class="sxs-lookup"><span data-stu-id="b2b26-191">All Users</span></span>    | <span data-ttu-id="b2b26-192">可由使用者建立，並由所有使用者讀取的遊戲檔案。</span><span class="sxs-lookup"><span data-stu-id="b2b26-192">Game files that can be created by a user and read by all users.</span></span> <span data-ttu-id="b2b26-193">只有 (擁有者) 的檔案建立者才會授與寫入權限。</span><span class="sxs-lookup"><span data-stu-id="b2b26-193">Write access is granted only to the creator of the file (owner).</span></span> | <span data-ttu-id="b2b26-194">使用者設定檔</span><span class="sxs-lookup"><span data-stu-id="b2b26-194">User Profiles</span></span>                                                     |
| <span data-ttu-id="b2b26-195">CSIDL \_ PROGRAM \_ FILES</span><span class="sxs-lookup"><span data-stu-id="b2b26-195">CSIDL\_PROGRAM\_FILES</span></span>  | <span data-ttu-id="b2b26-196">C： \\ Program Files</span><span class="sxs-lookup"><span data-stu-id="b2b26-196">C:\\Program Files</span></span><br/> <span data-ttu-id="b2b26-197">或</span><span class="sxs-lookup"><span data-stu-id="b2b26-197">or</span></span><br/> <span data-ttu-id="b2b26-198">C： \\ Program Files (x86) </span><span class="sxs-lookup"><span data-stu-id="b2b26-198">C:\\Program Files (x86)</span></span> <br/> | <span data-ttu-id="b2b26-199">唯讀</span><span class="sxs-lookup"><span data-stu-id="b2b26-199">Read only</span></span>            | <span data-ttu-id="b2b26-200">讀取/寫入</span><span class="sxs-lookup"><span data-stu-id="b2b26-200">Read/Write</span></span>           | <span data-ttu-id="b2b26-201">所有使用者</span><span class="sxs-lookup"><span data-stu-id="b2b26-201">All Users</span></span>    | <span data-ttu-id="b2b26-202">由所有使用者讀取的遊戲安裝程式所撰寫的靜態遊戲檔案。</span><span class="sxs-lookup"><span data-stu-id="b2b26-202">Static game files written by the game s installer that are read by all users.</span></span>                                                    | <span data-ttu-id="b2b26-203">遊戲資產，例如材質和網格。</span><span class="sxs-lookup"><span data-stu-id="b2b26-203">Game assets, such as materials and meshes.</span></span>                        |



 

<span data-ttu-id="b2b26-204">您的遊戲通常會安裝在 CSIDL \_ PROGRAM FILES 常數所代表之資料夾下的資料夾中 \_ 。</span><span class="sxs-lookup"><span data-stu-id="b2b26-204">Your game will typically be installed in a folder under the folder represented by the CSIDL\_PROGRAM\_FILES constant.</span></span> <span data-ttu-id="b2b26-205">不過，並不是永遠如此。</span><span class="sxs-lookup"><span data-stu-id="b2b26-205">However, this is not always the case.</span></span> <span data-ttu-id="b2b26-206">當您將路徑字串產生到安裝資料夾下的檔案或目錄時，您應該改為使用可執行檔的相對路徑。</span><span class="sxs-lookup"><span data-stu-id="b2b26-206">You should instead use a relative path from your executable file when generating path strings to files or directories located under your installation folder.</span></span>

<span data-ttu-id="b2b26-207">您也應該避免對已知資料夾路徑進行硬式編碼的假設。</span><span class="sxs-lookup"><span data-stu-id="b2b26-207">You should also refrain from hard-coded assumptions about the known folder paths.</span></span> <span data-ttu-id="b2b26-208">例如，在 Windows XP Professional 64 位 Edition 和 Windows Vista x64 上，程式檔路徑是 C： \\ Program files (x86) 用於32位程式，而 c： \\ program files 則適用于64位程式。</span><span class="sxs-lookup"><span data-stu-id="b2b26-208">For example, on Windows XP Professional 64-bit Edition and Windows Vista x64, the program files path is C:\\Program Files (x86) for 32-bit programs and C:\\Program Files for 64-bit programs.</span></span> <span data-ttu-id="b2b26-209">這些已知路徑從 Windows XP 變更，使用者可以重新設定許多這些資料夾的位置，甚至在不同的磁片磁碟機上找到它們。</span><span class="sxs-lookup"><span data-stu-id="b2b26-209">These known paths are changed from Windows XP, and users can reconfigure the location of many of these folders and even locate them on different drives.</span></span> <span data-ttu-id="b2b26-210">因此，請一律使用 CSIDL 常數來避免混淆和潛在問題。</span><span class="sxs-lookup"><span data-stu-id="b2b26-210">So, always use the CSIDL constants to avoid confusion and potential problems.</span></span> <span data-ttu-id="b2b26-211">Windows 安裝程式瞭解這些已知的資料夾位置，並且會在從 Windows XP 升級作業系統時移動資料;相反地，使用非標準位置或硬式編碼路徑，在作業系統升級之後可能會失敗。</span><span class="sxs-lookup"><span data-stu-id="b2b26-211">Windows Setup understands these known folder locations and will move the data when upgrading the operating system from Windows XP; in contrast, use of non-standard locations or hard-coded paths may well fail after an OS upgrade.</span></span>

<span data-ttu-id="b2b26-212">請注意，CSIDL \_ PERSONAL AND CSIDL \_ LOCAL APPDATA 所指定之使用者特定資料夾之間的微妙可用性差異應提供給您 \_ 。</span><span class="sxs-lookup"><span data-stu-id="b2b26-212">Attention should be given to the subtle usability differences between the user-specific folders specified by CSIDL\_PERSONAL and CSIDL\_LOCAL\_APPDATA.</span></span> <span data-ttu-id="b2b26-213">\_如果需要使用者與檔案互動，例如按兩下以在工具或應用程式中開啟檔案，並針對其他檔案使用 CSIDL 本機 APPDATA，則選取要用於寫入檔案的 CSIDL 常數的建議做法是使用 CSIDL PERSONAL \_ \_ 。</span><span class="sxs-lookup"><span data-stu-id="b2b26-213">The recommended practice for selecting the CSIDL constant to use for writing a file is to use CSIDL\_PERSONAL if the user is expected to interact with the file, such as double-clicking on it to open it in a tool or application, and to use CSIDL\_LOCAL\_APPDATA for other files.</span></span> <span data-ttu-id="b2b26-214">您的應用程式可以利用這兩個資料夾來儲存和組織使用者專屬的資料檔案，因為它們的存取範圍或許可權等級沒有任何差異。</span><span class="sxs-lookup"><span data-stu-id="b2b26-214">Both folders can be leveraged by your application to store and organize user-specific data files, as there is no difference in their access scope or privilege level.</span></span> <span data-ttu-id="b2b26-215">請小心建立唯一可與其他應用程式不衝突的路徑名稱，但要將完整路徑中的字元數減少到最大路徑的值 \_ 260。</span><span class="sxs-lookup"><span data-stu-id="b2b26-215">Care should be taken to create path names that are unique enough to not collide with other applications, but short enough to keep the number of characters in the full path fewer than the value of MAX\_PATH, 260.</span></span>

<span data-ttu-id="b2b26-216">下列程式碼提供如何將檔案寫入已知資料夾的範例：</span><span class="sxs-lookup"><span data-stu-id="b2b26-216">The following code provides an example of how to write a file to a known folder:</span></span>

``` syntax
#include <windows.h>
#include <shlobj.h>
#include <shlwapi.h>
        ...
        ...
        ...
        TCHAR strPath[MAX_PATH];
        if( SUCCEEDED(
        SHGetFolderPath( NULL, CSIDL_PERSONAL, NULL, SHGFP_TYPE_CURRENT, strPath ) ) )
        {
        PathAppend( strPath, TEXT( "Company Name\\Title" ) );

        if( !PathFileExists( strPath ) )
        {
        if( ERROR_SUCCESS != SHCreateDirectoryEx( NULL, strPath, NULL ) )
        return E_FAIL;
        }

        PathAppend( strPath, TEXT( "gamefile.txt" ) );

        // strPath is now something like:
        // C:\Users\<current user>\Documents\Company Name\Title\gamefile.txt
        // Open the file for writing
        HANDLE hFile = CreateFile(strPath, GENERIC_WRITE, NULL, NULL, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, NULL);

        if( INVALID_HANDLE_VALUE != hFile )
        {
        // TODO: Write to file
        CloseHandle(hFile);
        }
        }
```

## <a name="registry-access-as-a-standard-user"></a><span data-ttu-id="b2b26-217">以標準使用者的形式登錄存取</span><span class="sxs-lookup"><span data-stu-id="b2b26-217">Registry Access as a Standard User</span></span>

<span data-ttu-id="b2b26-218">標準使用者的登錄存取權會受到與檔案系統類似的方式。</span><span class="sxs-lookup"><span data-stu-id="b2b26-218">Registry access by a standard user is restricted in a similar fashion as the file system.</span></span> <span data-ttu-id="b2b26-219">允許標準使用者讀取登錄中所有金鑰的許可權;但是，寫入權限只會授與給 HKEY 的 \_ 目前 \_ 使用者 (HKCU) 子樹，而此子樹會在內部對應到使用者特定的子機碼 HKEY \_ 使用者 \\ 的安全識別碼 (SID) 的使用者。</span><span class="sxs-lookup"><span data-stu-id="b2b26-219">A standard user is permitted read access to all keys in the registry; however, write access is only granted to the HKEY\_CURRENT\_USER (HKCU) subtree, which is mapped internally to the user-specific subkey HKEY\_USERS\\Security ID (SID) of current user.</span></span> <span data-ttu-id="b2b26-220">需要寫入至 HKEY 目前使用者以外之任何登錄位置的應用 \_ 程式 \_ 需要系統管理許可權。</span><span class="sxs-lookup"><span data-stu-id="b2b26-220">An application that needs to write to any registry location other than HKEY\_CURRENT\_USER requires administrative privileges.</span></span>

<span data-ttu-id="b2b26-221">如果32位應用程式未在其資訊清單中包含要求的執行層級，則所有對 HKEY \_ 本機 \_ 電腦 \\ 軟體的寫入都會進行虛擬化，而寫入至 HKEY 目前使用者以外的其他位置 \_ 將會 \_ 失敗。</span><span class="sxs-lookup"><span data-stu-id="b2b26-221">If the 32-bit application does not contain a requested execution level in its manifest, then all writes to HKEY\_LOCAL\_MACHINE\\Software will be virtualized, while writes to other locations outside of HKEY\_CURRENT\_USER will fail.</span></span>

<span data-ttu-id="b2b26-222">不建議將持續性資料儲存在登錄中，例如使用者的設定。</span><span class="sxs-lookup"><span data-stu-id="b2b26-222">Storing persistent data in the registry, like a user's configuration, is not recommended.</span></span> <span data-ttu-id="b2b26-223">從遊戲儲存持續性資料的慣用方法，是藉由呼叫 [**SHGetFolderPath**](/windows/win32/api/shlobj_core/nf-shlobj_core-shgetfolderpatha) 並取得 CSIDL 常數的值（如前一節所述），將資料寫入檔案系統。</span><span class="sxs-lookup"><span data-stu-id="b2b26-223">The preferred method of storing persistent data from your game is to write the data to the file system by calling [**SHGetFolderPath**](/windows/win32/api/shlobj_core/nf-shlobj_core-shgetfolderpatha) and to get the value of a CSIDL constant, described in the previous section.</span></span>

## <a name="privilege-elevation"></a><span data-ttu-id="b2b26-224">權限提高</span><span class="sxs-lookup"><span data-stu-id="b2b26-224">Privilege Elevation</span></span>

<span data-ttu-id="b2b26-225">在 Windows Vista 中，任何需要系統管理許可權的應用程式都必須在其資訊清單中宣告系統管理執行層級的要求 (下一節 [設定應用程式資訊清單中的執行層級](#setting-the-execution-level-in-the-application-manifest)) 。</span><span class="sxs-lookup"><span data-stu-id="b2b26-225">In Windows Vista, any application that requires administrative privileges must declare a request for an administrative execution level in its manifest (described in the next section, [Setting the Execution Level in the Application Manifest](#setting-the-execution-level-in-the-application-manifest)).</span></span>

<span data-ttu-id="b2b26-226">如果是「提高許可權」，則是由 UAC 驅動的程式，可將進程升階為系統管理進程。</span><span class="sxs-lookup"><span data-stu-id="b2b26-226">Elevation, as it is known, is the procedure driven by UAC to promote a process to an administrative process.</span></span> <span data-ttu-id="b2b26-227">進程的許可權只能在建立時提高許可權。</span><span class="sxs-lookup"><span data-stu-id="b2b26-227">The privileges of a process can only be elevated at creation time.</span></span> <span data-ttu-id="b2b26-228">一旦建立之後，進程將永遠不會升級為較高的許可權層級。</span><span class="sxs-lookup"><span data-stu-id="b2b26-228">Once created, a process will never be promoted to a higher privilege level.</span></span> <span data-ttu-id="b2b26-229">基於這個理由。</span><span class="sxs-lookup"><span data-stu-id="b2b26-229">For this reason.</span></span> <span data-ttu-id="b2b26-230">需要系統管理認證的作業應該隔離到個別的安裝程式和其他輔助程式。</span><span class="sxs-lookup"><span data-stu-id="b2b26-230">operations that require administrative credentials should be isolated to separate installers and other auxiliary programs.</span></span>

<span data-ttu-id="b2b26-231">當程式執行時，UAC 會在資訊清單中檢查要求的執行層級，如果需要較高的許可權，則會以兩個標準對話方塊的其中一個來提示目前的使用者：一個是標準使用者，另一個則是系統管理員。</span><span class="sxs-lookup"><span data-stu-id="b2b26-231">Upon execution of a program, UAC inspects the requested execution level in the manifest, and if elevated privileges are required, prompts the current user with one of two standard dialog boxes: one for a standard user and one for an administrator.</span></span>

<span data-ttu-id="b2b26-232">如果目前的使用者是標準使用者，UAC 會提示使用者提供系統管理員的認證，然後才允許程式執行。</span><span class="sxs-lookup"><span data-stu-id="b2b26-232">If the current user is a standard user, UAC prompts the user for the credentials of an administrator before allowing the program to run.</span></span>

<span data-ttu-id="b2b26-233">**圖1。提示標準使用者輸入系統管理帳戶的認證**</span><span class="sxs-lookup"><span data-stu-id="b2b26-233">**Figure 1. Prompt for a Standard User to enter credentials for an administrative account**</span></span>

![提示標準使用者輸入系統管理帳戶的認證](images/uac-prompt-elevation.jpg)

<span data-ttu-id="b2b26-235">如果目前的使用者是系統管理員，UAC 會提示使用者提供許可權，然後才允許程式執行。</span><span class="sxs-lookup"><span data-stu-id="b2b26-235">If the current user is an administrator, UAC prompts the user for permission before allowing the program to run.</span></span>

<span data-ttu-id="b2b26-236">**[圖 2]提示系統管理員授權電腦的變更**</span><span class="sxs-lookup"><span data-stu-id="b2b26-236">**Figure 2. Prompt for an Administrator to authorize changes to the computer**</span></span>

![提示系統管理員授權電腦的變更](images/uac-prompt-authorization.jpg)

<span data-ttu-id="b2b26-238">只有當標準使用者提供適當的系統管理認證或系統管理使用者提供通知時，應用程式才會被授與系統管理許可權;任何其他會導致應用程式終止。</span><span class="sxs-lookup"><span data-stu-id="b2b26-238">The application will only be granted administrative privileges if a standard user provides the proper administrative credentials or an administrative user provides acknowledgement; anything else will cause the application to terminate.</span></span>

<span data-ttu-id="b2b26-239">請務必注意，具有較高許可權的進程會以系統管理使用者身分，在 UAC 提示字元中輸入認證，而不是以目前登入的標準使用者身分執行。</span><span class="sxs-lookup"><span data-stu-id="b2b26-239">It is important to note that a process with elevated privileges runs as the administrative user who entered credentials in the UAC prompt rather than as the standard user who is currently logged in.</span></span> <span data-ttu-id="b2b26-240">這類似于 Windows XP 中的 **RunAs** ，提高許可權的進程會在存取每位使用者的資料時取得系統管理員的資料夾和登錄機碼，而且提高許可權的進程所啟動的所有程式也會同時繼承系統管理許可權和使用者帳戶的位置。</span><span class="sxs-lookup"><span data-stu-id="b2b26-240">This is similar to **RunAs** in Windows XP   the elevated process gets the administrator's folder and registry keys when accessing per-user data, and all programs that the elevated process launches also inherit both the administrative rights and user account locations.</span></span> <span data-ttu-id="b2b26-241">系統管理員若系統管理員收到通知 (**繼續** 或 **取消**) ，這些位置將符合目前使用者的位置。</span><span class="sxs-lookup"><span data-stu-id="b2b26-241">For administrators who are prompted for acknowledgement (**Continue** or **Cancel**), these locations will match the currently user's locations.</span></span> <span data-ttu-id="b2b26-242">不過，一般情況下，需要提高許可權的進程不應對每個使用者資料執行操作。</span><span class="sxs-lookup"><span data-stu-id="b2b26-242">In general, however, processes that require elevation should not operate on per-user data.</span></span> <span data-ttu-id="b2b26-243">請注意，這可能會大幅影響安裝程式的運作方式！</span><span class="sxs-lookup"><span data-stu-id="b2b26-243">Note that this can substantially affect how your installer must operate!</span></span> <span data-ttu-id="b2b26-244">如果安裝程式是以系統管理員身分執行，會寫入 HKCU 或使用者的設定檔，可能會很可能寫入錯誤的位置。</span><span class="sxs-lookup"><span data-stu-id="b2b26-244">If the installer, running as an administrator, writes to HKCU or to a user's profile, it may very well be writing to the wrong location.</span></span> <span data-ttu-id="b2b26-245">在第一次執行遊戲時，請考慮建立這些每個使用者的值。</span><span class="sxs-lookup"><span data-stu-id="b2b26-245">Consider creating these per-user values upon the first run of the game.</span></span>

## <a name="uac-implications-with-createprocess"></a><span data-ttu-id="b2b26-246">CreateProcess () 的 UAC 含意</span><span class="sxs-lookup"><span data-stu-id="b2b26-246">UAC Implications with CreateProcess()</span></span>

<span data-ttu-id="b2b26-247">UAC 提高許可權機制不會從 Win32 [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) () 函式的呼叫中叫用，以啟動可執行檔，其設定為需要比目前進程更高的執行層級。</span><span class="sxs-lookup"><span data-stu-id="b2b26-247">The UAC elevation mechanism will not be invoked from a call to the Win32 [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa)() function to start an executable which is configured to require a higher execution level than the current process.</span></span> <span data-ttu-id="b2b26-248">因此，對 **CreateProcess** () 的呼叫將會失敗，並出現 [**GetLastError**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror) () 傳回 \_ 所需的錯誤提高許可權 \_ 。</span><span class="sxs-lookup"><span data-stu-id="b2b26-248">As a result, the call to **CreateProcess**() will fail with [**GetLastError**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror)() returning ERROR\_ELEVATION\_REQUIRED.</span></span> <span data-ttu-id="b2b26-249">**CreateProcess** () 只有在被呼叫端的執行層級等於或小於呼叫端的執行層級時，才會成功。</span><span class="sxs-lookup"><span data-stu-id="b2b26-249">**CreateProcess**() will only succeed when the execution level of the callee is equal-to or less-than that of the caller.</span></span> <span data-ttu-id="b2b26-250">必須產生提高許可權的進程必須使用 [**ShellExecute**](/windows/win32/api/shellapi/nf-shellapi-shellexecutea) () 函式來完成，這會導致 UAC 提高許可權機制透過 shell 來觸發。</span><span class="sxs-lookup"><span data-stu-id="b2b26-250">A non-elevated process that must spawn elevated processes should do so using the [**ShellExecute**](/windows/win32/api/shellapi/nf-shellapi-shellexecutea)() function, which will cause the UAC elevation mechanism to be triggered by means of the shell.</span></span>

## <a name="setting-the-execution-level-in-the-application-manifest"></a><span data-ttu-id="b2b26-251">在應用程式資訊清單中設定執行層級</span><span class="sxs-lookup"><span data-stu-id="b2b26-251">Setting the Execution Level in the Application Manifest</span></span>

<span data-ttu-id="b2b26-252">您可以藉由將擴充功能新增至應用程式資訊清單，宣告您的遊戲要求的執行層級。</span><span class="sxs-lookup"><span data-stu-id="b2b26-252">You declare the requested execution level of your game by adding an extension to the application s manifest.</span></span> <span data-ttu-id="b2b26-253">下列 XML 程式碼顯示為應用程式設定執行層級所需的最基本設定：</span><span class="sxs-lookup"><span data-stu-id="b2b26-253">The following XML code shows the minimal configuration required to set the execution level for an application:</span></span>

``` syntax
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<assembly xmlns="urn:schemas-microsoft-com:asm.v1" manifestVersion="1.0">
    <ms_asmv2:trustInfo xmlns:ms_asmv2="urn:schemas-microsoft-com:asm.v2">
        <ms_asmv2:security>
            <ms_asmv2:requestedPrivileges>
                <ms_asmv2:requestedExecutionLevel level="asInvoker" uiAccess="false" />
            </ms_asmv2:requestedPrivileges>
        </ms_asmv2:security>
    </ms_asmv2:trustInfo>
</assembly>
```

<span data-ttu-id="b2b26-254">在上述程式碼中，作業系統會收到通知，表示遊戲只需要下列標記的標準使用者許可權：</span><span class="sxs-lookup"><span data-stu-id="b2b26-254">In the preceding code, the operating system is informed that the game only requires standard user privileges by the following tag:</span></span>

``` syntax
<ms_asmv2:requestedExecutionLevel level="asInvoker" uiAccess="false" />
```

<span data-ttu-id="b2b26-255">藉由明確地將並無 requestedexecutionlevel 設定為 "asInvoker"，此範例會判斷提示作業系統，讓遊戲在沒有系統管理許可權的情況下正常運作。</span><span class="sxs-lookup"><span data-stu-id="b2b26-255">By explicitly setting requestedExecutionLevel to "asInvoker", this example asserts to the operating system that the game will behave properly without administrative privileges.</span></span> <span data-ttu-id="b2b26-256">因此，UAC 會停用虛擬化，並使用與啟動程式相同的許可權來執行遊戲，這通常是標準的使用者權限，因為 Windows 檔案總管會以標準使用者的身份執行。</span><span class="sxs-lookup"><span data-stu-id="b2b26-256">As a result, UAC disables virtualization and runs the game with the same privileges as the invoker   which is typically standard user privileges, since Windows Explorer runs as standard user.</span></span>

<span data-ttu-id="b2b26-257">您可以藉由將 "asInvoker" 取代為 "requireAdministrator" 來建立下列標記，以通知遊戲需要提高系統管理許可權的許可權：</span><span class="sxs-lookup"><span data-stu-id="b2b26-257">The operating system can be informed a game requires elevation to administrative privileges by replacing "asInvoker" with "requireAdministrator", to create the following tag:</span></span>

``` syntax
<ms_asmv2:requestedExecutionLevel level="requireAdministrator" uiAccess="false" />
```

<span data-ttu-id="b2b26-258">使用此設定時，作業系統會在每次執行遊戲時，使用其中一個標準 UAC 提高許可權對話方塊來提示目前的使用者。</span><span class="sxs-lookup"><span data-stu-id="b2b26-258">With this configuration, the operating system prompts the current user with one of the standard UAC elevation dialogs every time that the game is executed.</span></span> <span data-ttu-id="b2b26-259">強烈建議您不要讓任何遊戲都需要系統管理員許可權來執行，因為此對話方塊不僅會迅速變得很討厭，也會讓遊戲與家長監護不相容。</span><span class="sxs-lookup"><span data-stu-id="b2b26-259">It is highly recommended that no game require administrator privileges to run, because not only will this dialog quickly become annoying, but it also makes the game incompatible with parental controls.</span></span> <span data-ttu-id="b2b26-260">將這項需求新增至任何可執行檔之前，請先仔細考慮。</span><span class="sxs-lookup"><span data-stu-id="b2b26-260">Think very carefully before adding this requirement to any executable.</span></span>

<span data-ttu-id="b2b26-261">常見的誤解是，將會將並無 requestedexecutionlevel 設定為 "requireAdministrator" 的資訊清單，會略過提高許可權提示的需求。</span><span class="sxs-lookup"><span data-stu-id="b2b26-261">A common misconception is that adding a manifest that sets requestedExecutionLevel to "requireAdministrator" bypasses the need for an elevation prompt.</span></span> <span data-ttu-id="b2b26-262">不正確。</span><span class="sxs-lookup"><span data-stu-id="b2b26-262">This is not true.</span></span> <span data-ttu-id="b2b26-263">它只會防止作業系統猜測您的設定或更新應用程式是否需要系統管理許可權。</span><span class="sxs-lookup"><span data-stu-id="b2b26-263">It simply prevents the operating system from guessing whether your setup or update application needs administrative privileges.</span></span> <span data-ttu-id="b2b26-264">系統仍然會提示使用者授權提高許可權。</span><span class="sxs-lookup"><span data-stu-id="b2b26-264">The user is still prompted to authorize elevation.</span></span>

<span data-ttu-id="b2b26-265">Windows 會先檢查標記為提高許可權之任何應用程式的簽章，再顯示 UAC 提示。</span><span class="sxs-lookup"><span data-stu-id="b2b26-265">Windows checks the signature of any application that is marked for elevation before it displays the UAC prompt.</span></span> <span data-ttu-id="b2b26-266">標示為提高許可權的大型可執行檔需要較小的可執行檔檢查，而且比標記為 "asInvoker" 的可執行檔長。</span><span class="sxs-lookup"><span data-stu-id="b2b26-266">A large executable that is marked for elevation takes longer to check than a small executable and longer than an executable that is marked as "asInvoker".</span></span> <span data-ttu-id="b2b26-267">自動解壓縮的設定可執行檔應該標示為 "asInvoker"，而任何需要標示為 "requireAdministrator" 的部分，都應該放在另一個協助程式可執行檔中。</span><span class="sxs-lookup"><span data-stu-id="b2b26-267">Setup executables that are self-extracting should, therefore, be marked as "asInvoker", and any portion that needs to be marked as "requireAdministrator" should be placed in a separate helper executable.</span></span>

<span data-ttu-id="b2b26-268">在上述範例中所示的 uiAccess 屬性，對於遊戲來說應該一律為 FALSE。</span><span class="sxs-lookup"><span data-stu-id="b2b26-268">The uiAccess attribute, shown in the preceding examples, should always be FALSE for games.</span></span> <span data-ttu-id="b2b26-269">這個屬性會指定使用者介面自動化用戶端是否可存取受保護的系統 UI，如果設定為 TRUE，則會有特殊的安全性含意。</span><span class="sxs-lookup"><span data-stu-id="b2b26-269">This attribute specifies whether UI automation clients have access to the protected system UI, and it has special security implications if set to TRUE.</span></span>

## <a name="embedding-a-manifest-in-visual-studio"></a><span data-ttu-id="b2b26-270">在 Visual Studio 中內嵌資訊清單</span><span class="sxs-lookup"><span data-stu-id="b2b26-270">Embedding a Manifest in Visual Studio</span></span>

<span data-ttu-id="b2b26-271">從 VS2005 開始，先將資訊清單支援新增至 Visual Studio。</span><span class="sxs-lookup"><span data-stu-id="b2b26-271">Manifest support was first added to Visual Studio beginning in VS2005.</span></span> <span data-ttu-id="b2b26-272">根據預設，內建于 Visual Studio 2005 (或更新版本) 的可執行檔，會在建立過程中內嵌自動產生的資訊清單。</span><span class="sxs-lookup"><span data-stu-id="b2b26-272">By default, an executable built in Visual Studio 2005 (or newer) will have an auto-generated manifest embedded in it as part of the build process.</span></span> <span data-ttu-id="b2b26-273">自動產生之資訊清單的內容取決於您在 [專案屬性] 對話方塊中指定的特定專案設定。</span><span class="sxs-lookup"><span data-stu-id="b2b26-273">The contents of the auto-generated manifest are dependent on certain project configurations that you specify in the project properties dialog.</span></span>

<span data-ttu-id="b2b26-274">Visual Studio 2005 自動產生的資訊清單不會包含區塊，因為沒有 <trustInfo> 任何方法可以在專案屬性中設定 UAC 執行層級。</span><span class="sxs-lookup"><span data-stu-id="b2b26-274">The manifest that is auto-generated by Visual Studio 2005 will not contain a <trustInfo> block as there is no way to configure the UAC execution level in the project properties.</span></span> <span data-ttu-id="b2b26-275">新增這項資訊的慣用方法是讓 VS2005 合併使用者定義的資訊清單，其中包含 <trustInfo> 具有自動產生之資訊清單的區塊。</span><span class="sxs-lookup"><span data-stu-id="b2b26-275">The preferred way to add this information is to let VS2005 merge a user-defined manifest containing the <trustInfo> block with the auto-generated manifest.</span></span> <span data-ttu-id="b2b26-276">只要將 \* 資訊清單檔加入至包含上一節所列之 XML 的方案，就可以做到這一點。</span><span class="sxs-lookup"><span data-stu-id="b2b26-276">This is as simple as adding a \*.manifest file to your solution that contains the XML listed in the previous section.</span></span> <span data-ttu-id="b2b26-277">當 Visual Studio 在您的方案中遇到資訊清單檔時，它會自動叫用資訊清單工具 (mt.exe) 將資訊清單檔與自動產生的檔案合併。</span><span class="sxs-lookup"><span data-stu-id="b2b26-277">When Visual Studio encounters a .manifest file in your solution, it will automatically invoke the Manifest Tool (mt.exe) to merge the .manifest files with the auto-generated one.</span></span>

> [!Note]  
> <span data-ttu-id="b2b26-278">資訊清單工具 (mt.exe) 2005 Visual Studio 提供的錯誤，會導致合併和內嵌的資訊清單，當可執行檔在 SP3 之前的 Windows XP 上執行時，可能會造成問題。</span><span class="sxs-lookup"><span data-stu-id="b2b26-278">There is a bug in the Manifest Tool (mt.exe) provided by Visual Studio 2005 that results in a merged and embedded manifest which can cause problems when the executable is run on Windows XP prior to SP3.</span></span> <span data-ttu-id="b2b26-279">Bug 是工具在區塊宣告時如何重新定義預設命名空間的結果 <trustInfo> 。</span><span class="sxs-lookup"><span data-stu-id="b2b26-279">The bug is a result of how the tool redefines the default namespace upon declaration of the <trustInfo> block.</span></span> <span data-ttu-id="b2b26-280">幸運的是，只要明確地在區塊中宣告不同的命名空間 <trustInfo> ，並將子節點的範圍設定為新的命名空間，就可以輕鬆地完全略過此問題。</span><span class="sxs-lookup"><span data-stu-id="b2b26-280">Fortunately, it is easy to bypass the issue entirely by explicitly declaring a different namespace in the <trustInfo> block and by scoping the child nodes to the new namespace.</span></span> <span data-ttu-id="b2b26-281">上一節所提供的 XML 會示範此修正。</span><span class="sxs-lookup"><span data-stu-id="b2b26-281">The XML provided in the previous section demonstrates this fix.</span></span>

 

<span data-ttu-id="b2b26-282">使用 Visual Studio 2005 中包含的 mt.exe 工具有一點要注意的是，它會在處理區塊時產生警告， <trustInfo> 因為工具不包含更新的架構來驗證 XML。</span><span class="sxs-lookup"><span data-stu-id="b2b26-282">A caveat in using the mt.exe tool included in Visual Studio 2005 is that it will generate a warning when processing the <trustInfo> block as the tool does not contain an updated schema to validate the XML against.</span></span> <span data-ttu-id="b2b26-283">若要修正此警告，建議您取代 Visual Studio 2005 安裝目錄下的所有 mt.exe 檔案 () 有多個實例與最新 mt.exe 中提供的 Windows SDK。</span><span class="sxs-lookup"><span data-stu-id="b2b26-283">To remedy this warning, it is recommended that you replace all mt.exe files under the Visual Studio 2005 install directory (there are multiple instances) with the mt.exe provided in the latest Windows SDK.</span></span>

<span data-ttu-id="b2b26-284">從 Visual Studio 2008 開始，您現在可以在 [專案屬性] 對話方塊中指定應用程式的執行層級 ([圖 3]) ，或使用/MANIFESTUAC 連結器旗標。</span><span class="sxs-lookup"><span data-stu-id="b2b26-284">Beginning in Visual Studio 2008, you can now specify an application's execution level from within the project properties dialog (Figure 3), or by using the /MANIFESTUAC linker flag.</span></span> <span data-ttu-id="b2b26-285">設定這些選項會導致 Visual Studio 2008 自動產生，並將具有適當區塊的資訊清單內嵌 <trustInfo> 至可執行檔。</span><span class="sxs-lookup"><span data-stu-id="b2b26-285">Setting these options will cause Visual Studio 2008 to auto-generate and embed a manifest with the appropriate <trustInfo> block into the executable.</span></span>

<span data-ttu-id="b2b26-286">**圖3。在 Visual Studio 2008 中設定執行層級**</span><span class="sxs-lookup"><span data-stu-id="b2b26-286">**Figure 3. Setting the execution level in Visual Studio 2008**</span></span>

![在 visual studio 2008 中設定執行層級](images/setting-execution-level-in-vs2008.jpg)

<span data-ttu-id="b2b26-288">在不含資訊清單支援的舊版 Visual Studio 中內嵌資訊清單仍有可能，但開發人員需要更多工作。</span><span class="sxs-lookup"><span data-stu-id="b2b26-288">Embedding a manifest in older versions of Visual Studio without manifest support is still possible, but does require more work from the developer.</span></span> <span data-ttu-id="b2b26-289">如需如何進行這項操作的範例，請檢查2008年3月版本之前的 DirectX SDK 中任何範例所包含的 Visual Studio 2003 專案。</span><span class="sxs-lookup"><span data-stu-id="b2b26-289">For an example on how to do this, please examine the Visual Studio 2003 project included in any sample in the DirectX SDK prior to the March 2008 release.</span></span>

## <a name="uac-compatibility-with-older-games"></a><span data-ttu-id="b2b26-290">UAC 與舊版遊戲的相容性</span><span class="sxs-lookup"><span data-stu-id="b2b26-290">UAC Compatibility with Older Games</span></span>

<span data-ttu-id="b2b26-291">如果您的遊戲似乎儲存並成功將檔案載入至 Program Files 目錄，但沒有任何檔的辨識項，則在其資訊清單中不含要求的執行層級的任何32位應用程式都會被視為繼承應用程式。</span><span class="sxs-lookup"><span data-stu-id="b2b26-291">If your game appears to be saving and loading a file successfully to the Program Files directory, yet no evidence of the file iOn Windows Vista, any 32-bit application that does not contain a requested execution level in its manifest is considered a legacy application.</span></span> <span data-ttu-id="b2b26-292">在 Windows Vista 之前，大部分的應用程式通常是由具有系統管理許可權的使用者執行。</span><span class="sxs-lookup"><span data-stu-id="b2b26-292">Prior to Windows Vista, most applications were typically run by users with administrative privileges.</span></span> <span data-ttu-id="b2b26-293">因此，這些應用程式可以自由地讀取和寫入系統檔案與登錄機碼，而且許多開發人員都不會進行所需的變更，以便在 Windows XP 上的受限使用者帳戶上正常運作。</span><span class="sxs-lookup"><span data-stu-id="b2b26-293">As a result, these applications could freely read and write system files and registry keys, and many developers did not make the changes needed to work properly on Limited User Accounts on Windows XP.</span></span> <span data-ttu-id="b2b26-294">不過，在 Windows Vista 中，這些相同的應用程式現在會因為新的安全性模型中的存取權限不足而失敗，這會強制執行繼承應用程式的標準使用者執行。</span><span class="sxs-lookup"><span data-stu-id="b2b26-294">However on Windows Vista, these same applications would now fail due to insufficient access privileges under the new security model, which enforces standard user execution for legacy applications.</span></span> <span data-ttu-id="b2b26-295">為了減輕這個問題的影響，Windows Vista 也加入了虛擬化。</span><span class="sxs-lookup"><span data-stu-id="b2b26-295">To mitigate the impact of this, virtualization was also added to Windows Vista.</span></span> <span data-ttu-id="b2b26-296">虛擬化可讓數以千計的繼承應用程式在 Windows Vista 上正常運作，而不需要讓這些應用程式擁有較高的許可權，就能在幾次的次要作業中順利完成。</span><span class="sxs-lookup"><span data-stu-id="b2b26-296">Virtualization will keep thousands of legacy applications working well on Windows Vista without requiring those applications to have elevated privileges at all times simply to succeed at a few minor operations.</span></span> <span data-ttu-id="b2b26-297">發現，您的遊戲很可能是在舊版模式下執行，而且受限於虛擬化。</span><span class="sxs-lookup"><span data-stu-id="b2b26-297">s found, chances are your game is running in legacy mode and was subjected to virtualization.</span></span>

<span data-ttu-id="b2b26-298">虛擬化會將區分系統的寫入 (以及後續的檔案或登錄作業，) 到目前使用者設定檔內的每個使用者位置，藉此影響檔案系統和登錄。</span><span class="sxs-lookup"><span data-stu-id="b2b26-298">Virtualization affects the file system and registry by redirecting system-sensitive writes (and subsequent file or registry operations) to a per-user location within the current user's profile.</span></span> <span data-ttu-id="b2b26-299">例如，如果應用程式嘗試寫入至下列檔案：</span><span class="sxs-lookup"><span data-stu-id="b2b26-299">For example, if an application attempts to write to the following file:</span></span>

<dl> <span data-ttu-id="b2b26-300">C： \\ Program Files \\ 公司名稱 \\ 標題 \\config.ini</span><span class="sxs-lookup"><span data-stu-id="b2b26-300">C:\\Program Files\\Company Name\\Title\\config.ini</span></span>  
</dl>

<span data-ttu-id="b2b26-301">寫入會自動重新導向至：</span><span class="sxs-lookup"><span data-stu-id="b2b26-301">the write is automatically redirected to:</span></span>

<dl> <span data-ttu-id="b2b26-302">C： \\ Users \\ 使用者名稱 \\ AppData \\ Local \\ VirtualStore \\ Program Files \\ Company name \\ Title \\config.ini</span><span class="sxs-lookup"><span data-stu-id="b2b26-302">C:\\Users\\user name\\AppData\\Local\\VirtualStore\\Program Files\\Company Name\\Title\\config.ini</span></span>  
</dl>

<span data-ttu-id="b2b26-303">同樣地，如果應用程式嘗試寫入登錄值（如下所示）：</span><span class="sxs-lookup"><span data-stu-id="b2b26-303">Likewise, if an application attempts to write a registry value like the following:</span></span>

<dl> <span data-ttu-id="b2b26-304">HKEY \_ 本機 \_ 電腦 \\ 軟體 \\ 公司名稱 \\ 標題</span><span class="sxs-lookup"><span data-stu-id="b2b26-304">HKEY\_LOCAL\_MACHINE\\Software\\Company Name\\Title</span></span>  
</dl>

<span data-ttu-id="b2b26-305">它會改為重新導向至：</span><span class="sxs-lookup"><span data-stu-id="b2b26-305">it will be redirected instead to:</span></span>

<dl> <span data-ttu-id="b2b26-306">HKEY \_ 目前的 \_ 使用者 \\ 軟體 \\ 類別 \\ VirtualStore \\ 電腦 \\ 軟體 \\ 公司名稱 \\ 標題</span><span class="sxs-lookup"><span data-stu-id="b2b26-306">HKEY\_CURRENT\_USER\\Software\\Classes\\VirtualStore\\MACHINE\\Software\\Company Name\\Title</span></span>  
</dl>

<span data-ttu-id="b2b26-307">受虛擬化影響的檔案和登錄機碼，只會透過以目前使用者的形式執行之虛擬化應用程式的檔案和登錄操作來存取。</span><span class="sxs-lookup"><span data-stu-id="b2b26-307">Files and registry keys affected by virtualization are only be accessed by file and registry operations from virtualized applications that are running as the current user.</span></span>

<span data-ttu-id="b2b26-308">不過，虛擬化有許多限制。</span><span class="sxs-lookup"><span data-stu-id="b2b26-308">However, there are many restrictions to virtualization.</span></span> <span data-ttu-id="b2b26-309">其中一種情況是，64位應用程式永遠不會在舊版模式中執行，以便在32位應用程式中受到虛擬化的相容性作業，在64位中將會失敗。</span><span class="sxs-lookup"><span data-stu-id="b2b26-309">One is that 64-bit applications are never run in legacy mode for compatibility   operations subjected to virtualization in 32-bit applications will just fail in 64-bit.</span></span> <span data-ttu-id="b2b26-310">此外，如果以標準使用者身分執行的繼承應用程式嘗試將任何類型的可執行檔寫入至需要系統管理認證的位置，則不會進行虛擬化，而且寫入將會失敗。</span><span class="sxs-lookup"><span data-stu-id="b2b26-310">Also if a legacy application running as a standard user tries to write any type of executable file to a location that requires administrative credentials, then virtualization will not occur and the write will fail.</span></span>

<span data-ttu-id="b2b26-311">**[圖 4]虛擬化流程**</span><span class="sxs-lookup"><span data-stu-id="b2b26-311">**Figure 4. Virtualization Process**</span></span>

![虛擬化流程](images/uac-virtualization-process.jpg)

<span data-ttu-id="b2b26-313">當繼承應用程式在檔案系統或登錄中的系統相關位置上嘗試進行讀取作業時，會先搜尋虛擬位置。</span><span class="sxs-lookup"><span data-stu-id="b2b26-313">When a legacy application attempts a read operation on system-sensitive locations in the file system or registry, the virtual locations are searched first.</span></span> <span data-ttu-id="b2b26-314">如果找不到檔案或登錄機碼，則作業系統會存取預設的系統位置。</span><span class="sxs-lookup"><span data-stu-id="b2b26-314">If the file or registry key is not found, then the operating system accesses the default system locations.</span></span>

<span data-ttu-id="b2b26-315">虛擬化將從後續版本的 Windows 中移除，因此重要的是不要依賴這項功能。</span><span class="sxs-lookup"><span data-stu-id="b2b26-315">Virtualization will be removed from subsequent versions of Windows so it important not to rely on this feature.</span></span> <span data-ttu-id="b2b26-316">相反地，您應該明確設定標準使用者或系統管理許可權的應用程式資訊清單，因為這樣會停用虛擬化。</span><span class="sxs-lookup"><span data-stu-id="b2b26-316">Instead, you should explicitly configure your application manifest for either standard user or administrative privileges, as this will disable virtualization.</span></span> <span data-ttu-id="b2b26-317">虛擬化對終端使用者也而言並不明顯，所以即使虛擬化可能會允許您的應用程式執行，它也可以產生支援呼叫，並使這些客戶難以進行疑難排解。</span><span class="sxs-lookup"><span data-stu-id="b2b26-317">Virtualization is also not obvious to end users, so even though virtualization may allow your application to run, it can generate support calls and make it difficult to trouble-shoot for these customers.</span></span>

<span data-ttu-id="b2b26-318">請注意，如果停用 UAC，則也會停用虛擬化。</span><span class="sxs-lookup"><span data-stu-id="b2b26-318">Note that if UAC is disabled, then virtualization is also disabled.</span></span> <span data-ttu-id="b2b26-319">如果停用虛擬化，標準使用者帳戶的行為就像是 Windows XP 中的有限使用者帳戶，而繼承應用程式可能無法正確地針對其他因虛擬化而成功的標準使用者。</span><span class="sxs-lookup"><span data-stu-id="b2b26-319">If virtualization is disabled, standard user accounts behave exactly like limited user accounts in Windows XP, and legacy applications may not function correctly for standard users that would otherwise have succeeded due to virtualization.</span></span>

## <a name="legacy-scenarios-and-manifests"></a><span data-ttu-id="b2b26-320">舊版案例和資訊清單</span><span class="sxs-lookup"><span data-stu-id="b2b26-320">Legacy Scenarios and Manifests</span></span>

<span data-ttu-id="b2b26-321">在大部分的使用案例中，只要使用正確的 UAC 資訊清單元素來標記 .exe，並確保應用程式能正常運作，因為標準使用者就足以滿足絕佳的 UAC 相容性。</span><span class="sxs-lookup"><span data-stu-id="b2b26-321">For the majority of usage scenarios, simply marking the .exe with the correct UAC manifest elements and ensuring the application works correctly as a Standard User is sufficient for excellent UAC compatibility.</span></span> <span data-ttu-id="b2b26-322">大部分的玩家都是執行 Windows Vista 或 Windows 7，而且已啟用使用者帳戶控制。</span><span class="sxs-lookup"><span data-stu-id="b2b26-322">Most gamers are running Windows Vista or Windows 7 with User Account Control enabled.</span></span> <span data-ttu-id="b2b26-323">針對 windows XP 和 Windows Vista 上的使用者，以及已停用「使用者帳戶控制」功能的最為理想，它們通常會使用系統管理員帳戶來執行。</span><span class="sxs-lookup"><span data-stu-id="b2b26-323">For Windows XP and users on Windows Vista or Windows7 with the User Account Control feature disabled, they typically run using administrator accounts.</span></span> <span data-ttu-id="b2b26-324">雖然這是較不安全的作業模式，但一般不會遇到任何額外的相容性問題，不過如前文所述，停用 UAC 也會停用虛擬化。</span><span class="sxs-lookup"><span data-stu-id="b2b26-324">While this is a less secure mode of operation, it will generally not run into any additional compatibility issues although as noted above, disabling UAC disables virtualization as well.</span></span>

<span data-ttu-id="b2b26-325">當程式在 UAC 資訊清單中標示為「requireAdministrator」時，有一個特殊案例值得注意。</span><span class="sxs-lookup"><span data-stu-id="b2b26-325">There is a special case worth noting when the program is marked as "requireAdministrator" in the UAC manifest.</span></span> <span data-ttu-id="b2b26-326">在 Windows XP 上以及停用使用者帳戶控制的 windows Vista 或 Windows 7 上，系統會忽略 UAC 資訊清單元素。</span><span class="sxs-lookup"><span data-stu-id="b2b26-326">On Windows XP and on Windows Vista or Windows 7 with User Account Control disabled, the UAC manifest elements are ignored by the system.</span></span> <span data-ttu-id="b2b26-327">在此情況下，具有系統管理員帳戶的使用者一律會以完整系統管理員許可權執行所有程式，因此這些程式會如預期般運作。</span><span class="sxs-lookup"><span data-stu-id="b2b26-327">In this situation, users with administrator accounts will always run all programs with full administrator rights, and thus these programs will function as expected.</span></span> <span data-ttu-id="b2b26-328">不過，在 Windows Vista 或 Windows 7 上執行的 windows XP 受限使用者與標準使用者，一律會以限制的許可權執行這些程式，而且所有的系統管理員層級作業都會失敗。</span><span class="sxs-lookup"><span data-stu-id="b2b26-328">Windows XP Restricted Users and Standard Users running on Windows Vista or Windows 7, however, will always run these programs with restricted rights and all administrator-level operations will fail.</span></span> <span data-ttu-id="b2b26-329">因此，建議將程式標示為「requiretAdministrator」，並 [**在啟動時將**](/windows/win32/api/shlobj_core/nf-shlobj_core-isuseranadmin) 其標示為「」，並在傳回 FALSE 時顯示嚴重的錯誤訊息。</span><span class="sxs-lookup"><span data-stu-id="b2b26-329">It is therefore recommended that programs marked as "requiretAdministrator" call [**IsUserAnAdmin**](/windows/win32/api/shlobj_core/nf-shlobj_core-isuseranadmin) on startup, and display a fatal error message if it returns FALSE.</span></span> <span data-ttu-id="b2b26-330">在上述的大部分案例中，這一律會成功，但是在這種罕見的情況下，可提供更好的使用者體驗和明確的錯誤訊息。</span><span class="sxs-lookup"><span data-stu-id="b2b26-330">For the majority scenario above, this will always succeed, but provides a better user experience and a clear error message for this rare situation.</span></span>

## <a name="conclusion"></a><span data-ttu-id="b2b26-331">結論</span><span class="sxs-lookup"><span data-stu-id="b2b26-331">Conclusion</span></span>

<span data-ttu-id="b2b26-332">以 Windows 多使用者環境為目標的遊戲開發人員，您必須設計您的遊戲以有效率且負責任地操作。</span><span class="sxs-lookup"><span data-stu-id="b2b26-332">As a game developer targeting the Windows multi-user environment, it is imperative that you design your game to operate effectively and responsibly.</span></span> <span data-ttu-id="b2b26-333">您遊戲的主要可執行檔不應該相依于系統管理許可權。</span><span class="sxs-lookup"><span data-stu-id="b2b26-333">Your game's main executable file should not be dependent on administrative privileges.</span></span> <span data-ttu-id="b2b26-334">這不僅可防止每次執行遊戲時提示提高許可權，也會對整體使用者體驗造成負面影響，但也可讓您的遊戲利用其他需要以標準使用者權限執行的功能，例如家長監護。</span><span class="sxs-lookup"><span data-stu-id="b2b26-334">This not only prevents the appearance of prompts for elevation every time that your game is run   which can negatively impact the overall user experience   but it also enables your game to take advantage of other features that require execution with standard user privileges, such as Parental Controls.</span></span>

<span data-ttu-id="b2b26-335">如果應用程式是設計成以標準使用者的認證來運作，但舊版 Windows 下的使用者)  (或受限使用者的認證，則這些應用程式將不會受限於未提高許可權的情況下執行的 UAC。</span><span class="sxs-lookup"><span data-stu-id="b2b26-335">Applications that are properly designed to operate as with the credentials of a standard user (or limited user) under previous versions of Windows will not be impacted by UAC   they will run without elevation.</span></span> <span data-ttu-id="b2b26-336">不過，它們應該包含資訊清單，並將其要求的執行層級設定為 "asInvoker"，以符合 Vista 的應用程式標準。</span><span class="sxs-lookup"><span data-stu-id="b2b26-336">However, they should include a manifest with their requested execution level set to "asInvoker" to conform to application standards for Vista.</span></span>

## <a name="further-reading"></a><span data-ttu-id="b2b26-337">深入閱讀</span><span class="sxs-lookup"><span data-stu-id="b2b26-337">Further Reading</span></span>

<span data-ttu-id="b2b26-338">如需針對符合使用者帳戶控制規範的 Windows Vista 設計應用程式的協助，請下載下列白皮書： [適用于使用者帳戶控制相容性的 Windows Vista 應用程式開發需求](/previous-versions/dotnet/articles/bb530410(v=msdn.10))。</span><span class="sxs-lookup"><span data-stu-id="b2b26-338">For assistance with designing applications for Windows Vista that are compliant with User Account Control, download the following white paper: [Windows Vista Application Development Requirements for User Account Control Compatibility](/previous-versions/dotnet/articles/bb530410(v=msdn.10)).</span></span>

<span data-ttu-id="b2b26-339">這份白皮書提供有關設計流程的詳細步驟，以及程式碼範例、需求和最佳作法。</span><span class="sxs-lookup"><span data-stu-id="b2b26-339">This white paper provides detailed steps about the design process, along with code samples, requirements, and best practices.</span></span> <span data-ttu-id="b2b26-340">這份檔也詳細說明 Windows Vista 中使用者體驗的技術更新和變更。</span><span class="sxs-lookup"><span data-stu-id="b2b26-340">This paper also details the technical updates and changes to the user experience in Windows Vista.</span></span>

<span data-ttu-id="b2b26-341">如需有關使用者帳戶控制的詳細資訊，請造訪 Windows Vista： [Microsoft TechNet](https://www.microsoft.com/technet/)上的[使用者帳戶控制](https://www.microsoft.com/technet/windowsvista/security/uac.mspx)。</span><span class="sxs-lookup"><span data-stu-id="b2b26-341">For more information about User Account Control, visit [Windows Vista: User Account Control](https://www.microsoft.com/technet/windowsvista/security/uac.mspx) on [Microsoft TechNet](https://www.microsoft.com/technet/).</span></span>

<span data-ttu-id="b2b26-342">另一項實用的資源是 [教授您的應用程式在 Windows Vista 使用者帳戶控制](/archive/msdn-magazine/2007/january/teach-your-apps-to-work-with-windows-vista-user-account-control)（從2007年1月起的 [MSDN 雜誌](/archive/msdn-magazine/msdn-magazine-issues)）上順利播放的文章。</span><span class="sxs-lookup"><span data-stu-id="b2b26-342">Another useful resource is the article [Teach Your Apps To Play Nicely with Windows Vista User Account Control](/archive/msdn-magazine/2007/january/teach-your-apps-to-work-with-windows-vista-user-account-control), from [MSDN Magazine](/archive/msdn-magazine/msdn-magazine-issues), January 2007.</span></span> <span data-ttu-id="b2b26-343">本文討論應用程式相容性的一般問題，以及在 Windows Vista 上使用 Windows Installer 套件的優點和問題。</span><span class="sxs-lookup"><span data-stu-id="b2b26-343">This article discusses general issues of application compatibility, as well as the advantages and issues of using Windows Installer packages on Windows Vista.</span></span>

<span data-ttu-id="b2b26-344">如需有關錯誤的詳細資訊以及 mt.exe 的修正程式，Visual Studio 2005 用來自動將資訊清單合併並內嵌到可執行檔的工具，請參閱[MSDN](/archive/blogs/)上 Chris Jackson 的 blog[中的探索資訊清單第2部分： Windows Vista 中的預設命名空間和 UAC 指令](https://techcommunity.microsoft.com/t5/Windows-Blog-Archive/bg-p/Windows-Blog-Archive/2006/09/08/exploring-manifests-part-2-default-namespaces-and-uac-manifests-in-windows-vista/)清單。</span><span class="sxs-lookup"><span data-stu-id="b2b26-344">For more information about the bug and the fix for mt.exe, the tool used by Visual Studio 2005 to automatically merge and embed a manifest into an executable, see [Exploring Manifests Part 2: Default Namespaces and UAC Manifests in Windows Vista](https://techcommunity.microsoft.com/t5/Windows-Blog-Archive/bg-p/Windows-Blog-Archive/2006/09/08/exploring-manifests-part-2-default-namespaces-and-uac-manifests-in-windows-vista/) on Chris Jackson's blog on [MSDN](/archive/blogs/).</span></span>

 

