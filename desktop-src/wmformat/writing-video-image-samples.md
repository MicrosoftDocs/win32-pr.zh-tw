---
title: 撰寫影片影像範例
description: 撰寫影片影像範例
ms.assetid: 1d375186-230a-4a18-a995-b331c72a76e7
keywords:
- Advanced Systems Format (ASF) 、撰寫影片影像範例
- ASF (Advanced Systems 格式) 、撰寫影片影像範例
- 影片影像，撰寫範例
- 串流，撰寫影片影像範例
- 編解碼器，撰寫影片影像範例
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0fbac644d7938477ba3d2e8b21ebb6e631a47708
ms.sourcegitcommit: 48d1c892045445bcbd0f22bafa2fd3861ffaa6e7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 02/19/2020
ms.locfileid: "104314250"
---
# <a name="writing-video-image-samples"></a><span data-ttu-id="01a13-108">撰寫影片影像範例</span><span class="sxs-lookup"><span data-stu-id="01a13-108">Writing Video Image Samples</span></span>

<span data-ttu-id="01a13-109">影片影像串流是包含一系列靜止影像的影片。</span><span class="sxs-lookup"><span data-stu-id="01a13-109">A Video Image stream is a video that contains a series of still images.</span></span> <span data-ttu-id="01a13-110">影像可以在框架內移動，且每個影像都可以 blend 至下一個影像。</span><span class="sxs-lookup"><span data-stu-id="01a13-110">The images can move within the frame, and each image can blend into the next.</span></span> <span data-ttu-id="01a13-111">影片影像資料流程會使用 Windows Media 視訊9映射 v2 編解碼器進行編碼。</span><span class="sxs-lookup"><span data-stu-id="01a13-111">Video Image streams are encoded using the Windows Media Video 9 Image v2 codec.</span></span> <span data-ttu-id="01a13-112">輸出影片類似于 Windows Media 視訊9編解碼器所建立的影片。</span><span class="sxs-lookup"><span data-stu-id="01a13-112">The output video is similar to that created by the Windows Media Video 9 codec.</span></span>

<span data-ttu-id="01a13-113">若要建立包含影片影像資料流程的設定檔，請依照 [從編解碼器取得串流設定資訊](getting-stream-configuration-information-from-codecs.md)中所述的方式列舉影片編解碼器開始。</span><span class="sxs-lookup"><span data-stu-id="01a13-113">To create a profile that contains a Video Image stream, start by enumerating the video codecs as described in [Getting Stream Configuration Information from Codecs](getting-stream-configuration-information-from-codecs.md).</span></span> <span data-ttu-id="01a13-114">搜尋支援 WMMEDIASUBTYPE \_ WVP2 子類型的編解碼器。</span><span class="sxs-lookup"><span data-stu-id="01a13-114">Search for the codec that supports the WMMEDIASUBTYPE\_WVP2 subtype.</span></span>

<span data-ttu-id="01a13-115">在寫入器物件上設定設定檔之後，請呼叫 [**IWMWriter：： GetInputProps**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmwriter-getinputprops) 來取得影片影像輸入資料流程的媒體屬性。</span><span class="sxs-lookup"><span data-stu-id="01a13-115">After you set the profile on the writer object, call [**IWMWriter::GetInputProps**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmwriter-getinputprops) to get the media properties for the Video Image input stream.</span></span> <span data-ttu-id="01a13-116">藉由呼叫 [**IWMMediaProps：： GetMediaType**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmmediaprops-getmediatype)，從 media properties 物件取得媒體類型，並將子類型變更為 WMMEDIASUBTYPE \_ VIDEOIMAGE。</span><span class="sxs-lookup"><span data-stu-id="01a13-116">Get the media type from the media properties object, by calling [**IWMMediaProps::GetMediaType**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmmediaprops-getmediatype), and change the subtype to WMMEDIASUBTYPE\_VIDEOIMAGE.</span></span> <span data-ttu-id="01a13-117">您應該將影片的寬度和高度設定為包含您將新增至資料流程之影像所需的最大維度。</span><span class="sxs-lookup"><span data-stu-id="01a13-117">You should set the video width and height to the maximum dimensions needed to encompass the images you will add to the stream.</span></span> <span data-ttu-id="01a13-118">然後以修改過的輸入類型呼叫 [**IWMMediaProps：： SetMediaType**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmmediaprops-setmediatype) 。</span><span class="sxs-lookup"><span data-stu-id="01a13-118">Then call [**IWMMediaProps::SetMediaType**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmmediaprops-setmediatype) with the modified input type.</span></span> <span data-ttu-id="01a13-119">現在您已準備好開始將範例傳送至寫入器物件。</span><span class="sxs-lookup"><span data-stu-id="01a13-119">Now you are ready to begin sending samples to the writer object.</span></span>

<span data-ttu-id="01a13-120">每個範例的開頭都必須是 **WMT \_ VIDEOIMAGE \_ sample2.xml** 結構。</span><span class="sxs-lookup"><span data-stu-id="01a13-120">Each sample must begin with a **WMT\_VIDEOIMAGE\_SAMPLE2** structure.</span></span> <span data-ttu-id="01a13-121">此外，範例可能包含點陣圖影像。</span><span class="sxs-lookup"><span data-stu-id="01a13-121">Additionally, samples may contain bitmap images.</span></span> <span data-ttu-id="01a13-122">影像只會附加至它所顯示的第一個框架的範例。</span><span class="sxs-lookup"><span data-stu-id="01a13-122">An image is only attached to a sample for the first frame in which it appears.</span></span> <span data-ttu-id="01a13-123">使用該映射的所有其他畫面都只需要結構中的資訊。</span><span class="sxs-lookup"><span data-stu-id="01a13-123">All additional frames using that image need only information in the structure.</span></span> <span data-ttu-id="01a13-124">輸入點陣圖必須格式化為 RGB，每圖元24位。</span><span class="sxs-lookup"><span data-stu-id="01a13-124">Input bitmaps must be formatted as RGB, 24 bits per pixel.</span></span>

<span data-ttu-id="01a13-125">點陣圖檔案會儲存影像資料，讓影像中每個資料列的資料都採用數個可整除的位元組。</span><span class="sxs-lookup"><span data-stu-id="01a13-125">Bitmap files store the image data so that the data for each row of the image takes a number of bytes divisible by four.</span></span> <span data-ttu-id="01a13-126"> (這稱為點陣圖的 stride。 ) 這會將每個資料列的開頭強制為 **DWORD** 界限，讓複製更有效率。</span><span class="sxs-lookup"><span data-stu-id="01a13-126">(This is called the stride of the bitmap.) This forces the beginning of every row of video to a **DWORD** boundary, which makes copying more efficient.</span></span> <span data-ttu-id="01a13-127">如果影像資料列未平均整除四個，則會將資料列填補為四個位元組的下一個最高倍數。</span><span class="sxs-lookup"><span data-stu-id="01a13-127">If the image rows are not evenly divisible by four, the row is padded to the next highest multiple of four bytes.</span></span> <span data-ttu-id="01a13-128">當您附加影像資料時，您必須移除存在於每個資料列之資料結尾的任何填補。</span><span class="sxs-lookup"><span data-stu-id="01a13-128">When you attach image data, you must remove any padding that exists at the end of the data for each row.</span></span>

<span data-ttu-id="01a13-129">Windows Media 視訊9映射 v2 編解碼器會在記憶體中一次維護最多兩個映射。</span><span class="sxs-lookup"><span data-stu-id="01a13-129">The Windows Media Video 9 Image v2 codec maintains up to two images in memory at a time.</span></span> <span data-ttu-id="01a13-130">這些影像稱為先前的映射和目前的映射。</span><span class="sxs-lookup"><span data-stu-id="01a13-130">These images are called the previous image and the current image.</span></span> <span data-ttu-id="01a13-131">每個影像都有一組 **WMT \_ VIDEOIMAGE \_ sample2.xml** 結構中的成員，它會指示影像在框架中的呈現方式。</span><span class="sxs-lookup"><span data-stu-id="01a13-131">Each image has a set of members in the **WMT\_VIDEOIMAGE\_SAMPLE2** structure, which dictate how the image is presented in the frame.</span></span> <span data-ttu-id="01a13-132">您可以藉由將 **WMT \_ VIDEOIMAGE \_ sample2.xml** 的 DWCONTROLFLAGS 成員設定為 WMT \_ VIDEOIMAGE \_ 範例 \_ 輸入框架來加入影像 \_ 。</span><span class="sxs-lookup"><span data-stu-id="01a13-132">You can add an image by setting the dwControlFlags member of **WMT\_VIDEOIMAGE\_SAMPLE2** to WMT\_VIDEOIMAGE\_SAMPLE\_INPUT\_FRAME.</span></span> <span data-ttu-id="01a13-133">當您將輸入框架傳遞給編解碼器時，該映射會成為目前的映射。</span><span class="sxs-lookup"><span data-stu-id="01a13-133">When you pass an input frame to the codec, that image becomes the current image.</span></span> <span data-ttu-id="01a13-134">在先前的範例中，目前影像的影像通常會成為先前的影像，而先前範例中先前影像的影像則會被捨棄。</span><span class="sxs-lookup"><span data-stu-id="01a13-134">The image that was the current image in the previous sample usually becomes the previous image, and the image that was the previous image in the previous sample is discarded.</span></span> <span data-ttu-id="01a13-135">您可以將 **bKeepPrevImage** 成員設為 **TRUE**，以設定編解碼器保留舊的先前映射。</span><span class="sxs-lookup"><span data-stu-id="01a13-135">You can configure the codec to retain the old previous image by setting the **bKeepPrevImage** member to **TRUE**.</span></span> <span data-ttu-id="01a13-136">在此情況下，會捨棄先前範例中目前映射的影像。</span><span class="sxs-lookup"><span data-stu-id="01a13-136">In that case, the image that was the current image in the previous sample is discarded.</span></span>

<span data-ttu-id="01a13-137">影片影像框架的基本組合取決於每個影像的兩個因素：感興趣的區域和 blend 係數。</span><span class="sxs-lookup"><span data-stu-id="01a13-137">The basic composition of a Video Image frame is determined by two factors for each image: region of interest and blend coefficient.</span></span> <span data-ttu-id="01a13-138">影像的相關區域是由原始點、寬度和高度所定義。</span><span class="sxs-lookup"><span data-stu-id="01a13-138">The region of interest for an image is defined by an origin point, width, and height.</span></span> <span data-ttu-id="01a13-139">相關區域所描述的影像部分會填滿輸出框架。</span><span class="sxs-lookup"><span data-stu-id="01a13-139">The part of an image described by the region of interest fills the output frame.</span></span> <span data-ttu-id="01a13-140">如果感興趣區域的大小與輸出框架不同，則編解碼器會調整其大小。</span><span class="sxs-lookup"><span data-stu-id="01a13-140">If the region of interest is a different size than the output frame, the codec resizes it.</span></span> <span data-ttu-id="01a13-141">影像的 blend 係數決定兩個影像的混合。</span><span class="sxs-lookup"><span data-stu-id="01a13-141">The blend coefficient of the image determines the blending of the two images.</span></span> <span data-ttu-id="01a13-142">目前和先前影像的 blend 係數必須總計為1.0。</span><span class="sxs-lookup"><span data-stu-id="01a13-142">The blend coefficients for the current and previous images must total 1.0.</span></span> <span data-ttu-id="01a13-143">例如，如果 **fCurrBlendCoef** 設定為0.5，而 **fPrevBlendCoef** 設定為0.5，則輸出框架是由兩個影像中所需區域的相等 blend 所組成。</span><span class="sxs-lookup"><span data-stu-id="01a13-143">For example, if **fCurrBlendCoef** is set to 0.5 and **fPrevBlendCoef** is set to 0.5, then the output frame is composed of an equal blend of the regions of interest from both images.</span></span>

<span data-ttu-id="01a13-144">藉由操作影像的感興趣區域，您可以建立平移和縮放效果。</span><span class="sxs-lookup"><span data-stu-id="01a13-144">By manipulating the region of interest for an image, you can create pan and zoom effects.</span></span> <span data-ttu-id="01a13-145">Blend 係數可讓您跨淡化 (在影像之間) 溶解。</span><span class="sxs-lookup"><span data-stu-id="01a13-145">The blend coefficients enable you to cross-fade (dissolve) between images.</span></span> <span data-ttu-id="01a13-146">除了這些效果之外，您還可以使用其中一個預先定義的轉換來建立更複雜的框架。</span><span class="sxs-lookup"><span data-stu-id="01a13-146">In addition to these effects, you can use one of the predefined transitions to create more complex frames.</span></span> <span data-ttu-id="01a13-147">本檔的「 [影片影像轉換](video-image-transitions.md) 」一節會說明可用的轉換。</span><span class="sxs-lookup"><span data-stu-id="01a13-147">The available transitions are described in the [Video Image Transitions](video-image-transitions.md) section of this documentation.</span></span> <span data-ttu-id="01a13-148">使用轉換時，您必須設定每個畫面格。</span><span class="sxs-lookup"><span data-stu-id="01a13-148">When using a transition, you must configure each frame.</span></span> <span data-ttu-id="01a13-149">最簡單的方法是建立一個函式，以累加方式變更 **WMT \_ VIDEOIMAGE \_ sample2.xml** 結構的成員，以取得完整效果。</span><span class="sxs-lookup"><span data-stu-id="01a13-149">The easiest way to do this is to create a function that incrementally changes members of the **WMT\_VIDEOIMAGE\_SAMPLE2** structure for a complete effect.</span></span>

<span data-ttu-id="01a13-150">如需針對 deformations 設定之值的詳細資訊，請參閱 [**WMT \_ VIDEOIMAGE \_ sample2.xml**](/previous-versions/windows/desktop/api/Wmsdkidl/ns-wmsdkidl-wmt_videoimage_sample2)。</span><span class="sxs-lookup"><span data-stu-id="01a13-150">For more information about the values to set for deformations, see [**WMT\_VIDEOIMAGE\_SAMPLE2**](/previous-versions/windows/desktop/api/Wmsdkidl/ns-wmsdkidl-wmt_videoimage_sample2).</span></span>

<span data-ttu-id="01a13-151">**注意** 如果您想要將音訊包含在具有影片影像資料流程的檔案中，您必須使用未壓縮的音訊輸入。</span><span class="sxs-lookup"><span data-stu-id="01a13-151">**Note** If you want to include audio in a file with a Video Image stream, you must use uncompressed audio input.</span></span> <span data-ttu-id="01a13-152">若要將影片影像串流與現有的壓縮音訊串流合併，您必須將音訊解壓縮，並以未壓縮的形式傳遞範例。</span><span class="sxs-lookup"><span data-stu-id="01a13-152">To combine a Video Image stream with an existing compressed audio stream, you must decompress the audio and pass the samples in uncompressed.</span></span> <span data-ttu-id="01a13-153">如果您在撰寫影片影像串流時，將壓縮的範例傳遞給寫入器，將會發生錯誤，導致樣本從影片中卸載。</span><span class="sxs-lookup"><span data-stu-id="01a13-153">If you pass compressed samples to the writer when writing a Video Image stream, an error will occur, resulting in samples being dropped from the video.</span></span>

<span data-ttu-id="01a13-154">此外，沒有音訊串流的壓縮影片影像檔案可以在單一 ASF 封包中包含數個非常小、高度壓縮的影片畫面格，這可能會導致舊版 Windows Media Player 的播放體驗不佳。</span><span class="sxs-lookup"><span data-stu-id="01a13-154">Also, compressed Video Image files with no audio streams can contain several very small, highly compressed video frames in a single ASF packet, which can result in a poor playback experience on previous versions of Windows Media Player.</span></span> <span data-ttu-id="01a13-155">若要避免這個問題，最好的解決方法是將無訊息音訊串流插入檔案中，但這也會增加檔案大小。</span><span class="sxs-lookup"><span data-stu-id="01a13-155">To avoid this problem, the best solution is to insert a silent audio stream into the file, although this will also increase the file size.</span></span>

## <a name="related-topics"></a><span data-ttu-id="01a13-156">相關主題</span><span class="sxs-lookup"><span data-stu-id="01a13-156">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="01a13-157">**視訊影像**</span><span class="sxs-lookup"><span data-stu-id="01a13-157">**Video Image**</span></span>](video-image.md)
</dt> <dt>

[<span data-ttu-id="01a13-158">**寫入 ASF 檔案**</span><span class="sxs-lookup"><span data-stu-id="01a13-158">**Writing ASF Files**</span></span>](writing-asf-files.md)
</dt> </dl>

 

 




