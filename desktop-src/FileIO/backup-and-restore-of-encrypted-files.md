---
description: 原始加密函式會啟用加密檔案的備份。
ms.assetid: 00f9b00e-305d-4554-8b43-7061228c92c3
title: 備份與還原加密的檔案
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4fbc5d1babbbbb92cef9e78f9a0dade702fd63d2
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104026383"
---
# <a name="backup-and-restore-of-encrypted-files"></a><span data-ttu-id="f8a19-103">備份與還原加密的檔案</span><span class="sxs-lookup"><span data-stu-id="f8a19-103">Backup and Restore of Encrypted Files</span></span>

<span data-ttu-id="f8a19-104">加密檔案系統 (EFS) 篩選開啟加密檔案的方式，讓開啟檔案的應用程式取得未加密資訊的存取權，當然它具有適當的認證可存取檔案，並取得解密檔案所需的金鑰。</span><span class="sxs-lookup"><span data-stu-id="f8a19-104">The Encrypting File System (EFS) filters the opening of an encrypted file in such a way that the application that opened the file gets access to the unencrypted information, provided of course it has the proper credentials to access the file and get the key necessary to decrypt the file.</span></span> <span data-ttu-id="f8a19-105">後續的讀取作業將會產生未加密的文字。</span><span class="sxs-lookup"><span data-stu-id="f8a19-105">Subsequent read operations on this file will yield unencrypted text.</span></span> <span data-ttu-id="f8a19-106">這對加密檔案的一般存取非常有其期望，並讓檔案的加密和解密保持透明。</span><span class="sxs-lookup"><span data-stu-id="f8a19-106">This is very desirable for typical access to encrypted files, and keeps the encryption and decryption of the files transparent.</span></span> <span data-ttu-id="f8a19-107">但是，它會妨礙加密檔案的備份，因為如果嘗試使用標準檔案 i/o 呼叫（例如 [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea)、 [**ReadFile**](/windows/desktop/api/FileAPI/nf-fileapi-readfile)和 [**WriteFile**](/windows/desktop/api/FileAPI/nf-fileapi-writefile)）進行備份，則備份的檔案將會是純文字版本。</span><span class="sxs-lookup"><span data-stu-id="f8a19-107">However, it hinders backup of encrypted files, because if backup is attempted with the standard file I/O calls like [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea), [**ReadFile**](/windows/desktop/api/FileAPI/nf-fileapi-readfile), and [**WriteFile**](/windows/desktop/api/FileAPI/nf-fileapi-writefile), the files backed up will be the plain text version.</span></span>

<span data-ttu-id="f8a19-108">提供未經處理的加密功能來解決此問題。</span><span class="sxs-lookup"><span data-stu-id="f8a19-108">The raw encryption functions are provided to solve this problem.</span></span> <span data-ttu-id="f8a19-109">備份應用程式是適用于這些功能的主要使用者。</span><span class="sxs-lookup"><span data-stu-id="f8a19-109">Backup applications are a primary intended user for these functions.</span></span> <span data-ttu-id="f8a19-110">原始加密函式與其他檔案系統函式不同之處在于，開啟、讀取和寫入函式允許存取原始加密的資料流程，也允許讀取/寫入 $EFS 資料流程。</span><span class="sxs-lookup"><span data-stu-id="f8a19-110">Raw encryption functions differ from other file system functions in that open, read, and write functions allow access to the raw encrypted data streams and also allow reading/writing of the $EFS stream.</span></span> <span data-ttu-id="f8a19-111">因此，原始加密函式的呼叫端不需要存取解密檔案的密碼編譯金鑰。</span><span class="sxs-lookup"><span data-stu-id="f8a19-111">Therefore, the caller of the raw encryption functions does not need access to the cryptographic keys that decrypt the file.</span></span> <span data-ttu-id="f8a19-112">下列原始加密 Api 可用於備份和還原應用程式：</span><span class="sxs-lookup"><span data-stu-id="f8a19-112">The following raw encryption APIs are available for use with backup and restore applications:</span></span> 

| <span data-ttu-id="f8a19-113">原始加密 API</span><span class="sxs-lookup"><span data-stu-id="f8a19-113">Raw Encryption API</span></span>                                     | <span data-ttu-id="f8a19-114">Description</span><span class="sxs-lookup"><span data-stu-id="f8a19-114">Description</span></span>                                                                                                                                                                                                                                                                   |
|--------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="f8a19-115">**OpenEncryptedFileRaw**</span><span class="sxs-lookup"><span data-stu-id="f8a19-115">**OpenEncryptedFileRaw**</span></span>](/windows/desktop/api/WinBase/nf-winbase-openencryptedfilerawa)   | <span data-ttu-id="f8a19-116">開啟加密的檔案，並存取加密格式的資料。</span><span class="sxs-lookup"><span data-stu-id="f8a19-116">Open an encrypted file with access to data in encrypted format.</span></span> <span data-ttu-id="f8a19-117">如果呼叫端無法存取檔案的金鑰，則呼叫端需要 [SeBackupPrivilege](/windows/desktop/SecAuthZ/authorization-constants) 來匯出加密的檔案或 SeRestorePrivilege，以匯入加密的檔案。</span><span class="sxs-lookup"><span data-stu-id="f8a19-117">If the caller does not have access to the key for the file, the caller needs [SeBackupPrivilege](/windows/desktop/SecAuthZ/authorization-constants) to export encrypted files or SeRestorePrivilege to import encrypted files.</span></span> |
| [<span data-ttu-id="f8a19-118">**CloseEncryptedFileRaw**</span><span class="sxs-lookup"><span data-stu-id="f8a19-118">**CloseEncryptedFileRaw**</span></span>](/windows/desktop/api/WinBase/nf-winbase-closeencryptedfileraw) | <span data-ttu-id="f8a19-119">關閉以 OpenEncryptedFileRaw 開啟的加密[ 檔案](/windows/desktop/api/WinBase/nf-winbase-openencryptedfilerawa)</span><span class="sxs-lookup"><span data-stu-id="f8a19-119">Close an encrypted file opened with [**OpenEncryptedFileRaw**](/windows/desktop/api/WinBase/nf-winbase-openencryptedfilerawa)</span></span>                                                                                                                                                                                      |
| [<span data-ttu-id="f8a19-120">**ReadEncryptedFileRaw**</span><span class="sxs-lookup"><span data-stu-id="f8a19-120">**ReadEncryptedFileRaw**</span></span>](/windows/desktop/api/WinBase/nf-winbase-readencryptedfileraw)   | <span data-ttu-id="f8a19-121">讀取加密的檔案，以加密格式保留其資料</span><span class="sxs-lookup"><span data-stu-id="f8a19-121">Read an encrypted file leaving its data in encrypted format</span></span>                                                                                                                                                                                                                   |
| [<span data-ttu-id="f8a19-122">**WriteEncryptedFileRaw**</span><span class="sxs-lookup"><span data-stu-id="f8a19-122">**WriteEncryptedFileRaw**</span></span>](/windows/desktop/api/WinBase/nf-winbase-writeencryptedfileraw) | <span data-ttu-id="f8a19-123">撰寫加密的檔案，以加密格式保留其資料</span><span class="sxs-lookup"><span data-stu-id="f8a19-123">Write an encrypted file leaving its data in encrypted format</span></span>                                                                                                                                                                                                                  |
| [<span data-ttu-id="f8a19-124">**ImportCallback**</span><span class="sxs-lookup"><span data-stu-id="f8a19-124">**ImportCallback**</span></span>](/windows/desktop/api/WinBase/nc-winbase-pfe_import_func)               | <span data-ttu-id="f8a19-125">應用程式定義的回呼，可與 [ **WriteEncryptedFileRaw** 搭配使用](/windows/desktop/api/WinBase/nf-winbase-writeencryptedfileraw)</span><span class="sxs-lookup"><span data-stu-id="f8a19-125">Application-defined callback for use with [**WriteEncryptedFileRaw**](/windows/desktop/api/WinBase/nf-winbase-writeencryptedfileraw)</span></span>                                                                                                                                                                              |
| [<span data-ttu-id="f8a19-126">**ExportCallback**</span><span class="sxs-lookup"><span data-stu-id="f8a19-126">**ExportCallback**</span></span>](/windows/desktop/api/WinBase/nc-winbase-pfe_export_func)               | <span data-ttu-id="f8a19-127">應用程式定義的回呼，可與 [ **ReadEncryptedFileRaw** 搭配使用](/windows/desktop/api/WinBase/nf-winbase-readencryptedfileraw)</span><span class="sxs-lookup"><span data-stu-id="f8a19-127">Application-defined callback for use with [**ReadEncryptedFileRaw**](/windows/desktop/api/WinBase/nf-winbase-readencryptedfileraw)</span></span>                                                                                                                                                                                |



 

 

 
