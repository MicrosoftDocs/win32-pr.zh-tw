---
description: 本主題討論在一般使用案例中使用交易式 NTFS API (TxF) 的替代方案。
ms.assetid: 9ee26e7e-990e-4cd3-8180-f0fcaac2b752
title: 使用交易式 NTFS 的替代方案
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cc69974f27abfba0323ea4d3f16a720e5e99e69d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "107000265"
---
# <a name="alternatives-to-using-transactional-ntfs"></a><span data-ttu-id="3a67a-103">使用交易式 NTFS 的替代方案</span><span class="sxs-lookup"><span data-stu-id="3a67a-103">Alternatives to using Transactional NTFS</span></span>

-   [<span data-ttu-id="3a67a-104">摘要</span><span class="sxs-lookup"><span data-stu-id="3a67a-104">Abstract</span></span>](#abstract)
-   [<span data-ttu-id="3a67a-105">簡介</span><span class="sxs-lookup"><span data-stu-id="3a67a-105">Introduction</span></span>](#introduction)
-   [<span data-ttu-id="3a67a-106">依案例的 TxF 替代方案</span><span class="sxs-lookup"><span data-stu-id="3a67a-106">Alternatives to TxF by Scenario</span></span>](#alternatives-to-txf-by-scenario)
-   [<span data-ttu-id="3a67a-107">使用「檔相似」資料更新單一檔案的應用程式</span><span class="sxs-lookup"><span data-stu-id="3a67a-107">Applications updating a single file with "document-like" data</span></span>](#applications-updating-a-single-file-with-document-like-data)
-   [<span data-ttu-id="3a67a-108">對多個檔案和/或登錄 hive 執行更新的應用程式</span><span class="sxs-lookup"><span data-stu-id="3a67a-108">Applications performing updates to multiple files and/or to the registry hive</span></span>](#applications-performing-updates-to-multiple-files-andor-to-the-registry-hive)
-   [<span data-ttu-id="3a67a-109">管理一組結構化資料的應用程式</span><span class="sxs-lookup"><span data-stu-id="3a67a-109">Applications managing a set of structured data</span></span>](#applications-managing-a-set-of-structured-data)
-   [<span data-ttu-id="3a67a-110">交易的應用程式牽涉到本機 NTFS 磁片區上的檔案和外部 SQL 資料庫中的資料表</span><span class="sxs-lookup"><span data-stu-id="3a67a-110">Applications with Transactions involving files on a local NTFS volume and Tables in an external SQL database</span></span>](#applications-with-transactions-involving-files-on-a-local-ntfs-volume-and-tables-in-an-external-sql-database)
-   [<span data-ttu-id="3a67a-111">關閉 & 建議的動作</span><span class="sxs-lookup"><span data-stu-id="3a67a-111">Closing & Recommended Action</span></span>](/windows)

## <a name="abstract"></a><span data-ttu-id="3a67a-112">摘要</span><span class="sxs-lookup"><span data-stu-id="3a67a-112">Abstract</span></span>

<span data-ttu-id="3a67a-113">Microsoft 強烈建議開發人員調查使用討論的替代方案 (或在某些情況下，調查其他替代) ，而不是採用可能無法在未來版本的 Windows 中使用的 API 平臺。</span><span class="sxs-lookup"><span data-stu-id="3a67a-113">Microsoft strongly recommends developers investigate utilizing the discussed alternatives (or in some cases, investigate other alternatives) rather than adopting an API platform which may not be available in future versions of Windows.</span></span>

## <a name="introduction"></a><span data-ttu-id="3a67a-114">簡介</span><span class="sxs-lookup"><span data-stu-id="3a67a-114">Introduction</span></span>

<span data-ttu-id="3a67a-115">TxF 是以 Windows Vista 引進，做為將不可部分完成的檔案交易引入 Windows 的方法。</span><span class="sxs-lookup"><span data-stu-id="3a67a-115">TxF was introduced with Windows Vista as a means to introduce atomic file transactions to Windows.</span></span> <span data-ttu-id="3a67a-116">這項功能可讓 Windows 開發人員針對交易中的檔案作業，具有交易式不可部分完成的交易，其中包含單一檔案、包含多個檔案的交易，以及橫跨多個來源的交易（例如透過 TxR) 的登錄 (，以及 SQL) 等資料庫 (。</span><span class="sxs-lookup"><span data-stu-id="3a67a-116">It allows for Windows developers to have transactional atomicity for file operations in transactions with a single file, in transactions involving multiple files, and in transactions spanning multiple sources – such as the Registry (through TxR), and databases (such as SQL).</span></span> <span data-ttu-id="3a67a-117">雖然 TxF 是一組強大的 Api，但在此 API 平臺中，開發人員對開發人員而言有很大的興趣，因為 Windows Vista 主要是因為它的複雜性和各種細微的差異，而開發人員必須將其視為應用程式開發的一部分。</span><span class="sxs-lookup"><span data-stu-id="3a67a-117">While TxF is a powerful set of APIs, there has been extremely limited developer interest in this API platform since Windows Vista primarily due to its complexity and various nuances which developers need to consider as part of application development.</span></span> <span data-ttu-id="3a67a-118">如此一來，Microsoft 會考慮在未來的 Windows 版本中淘汰 TxF Api，以專注于其他功能和 Api 的開發和維護工作，這些功能和 Api 對於較大的多數客戶都有更大的價值。</span><span class="sxs-lookup"><span data-stu-id="3a67a-118">As a result, Microsoft is considering deprecating TxF APIs in a future version of Windows to focus development and maintenance efforts on other features and APIs which have more value to a larger majority of customers.</span></span> <span data-ttu-id="3a67a-119">下一節將說明可讓您以 TxF 針對數種應用程式案例類型達成類似結果的範例替代方法。</span><span class="sxs-lookup"><span data-stu-id="3a67a-119">The next section describes sample alternative methods to achieve similar results as TxF would for several types of application scenarios.</span></span>

## <a name="alternatives-to-txf-by-scenario"></a><span data-ttu-id="3a67a-120">依案例的 TxF 替代方案</span><span class="sxs-lookup"><span data-stu-id="3a67a-120">Alternatives to TxF by Scenario</span></span>

<span data-ttu-id="3a67a-121">有了上述限制，開發人員應該調查 TxF 的替代方案，以涵蓋 TxF 不符合的應用程式案例。</span><span class="sxs-lookup"><span data-stu-id="3a67a-121">With the limitations described above, developers should investigate alternatives to TxF to cover application scenarios which are not met by TxF.</span></span> <span data-ttu-id="3a67a-122">此處所討論的一些建議，是為了讓開發人員可以考慮使用 TxF 的一般 TxF。</span><span class="sxs-lookup"><span data-stu-id="3a67a-122">Discussed here are some suggested alternatives to common uses of TxF for developers to consider.</span></span> <span data-ttu-id="3a67a-123">請注意，這份清單並不完整，也不會完成。</span><span class="sxs-lookup"><span data-stu-id="3a67a-123">Note that this list is neither exhaustive nor complete.</span></span>

## <a name="applications-updating-a-single-file-with-document-like-data"></a><span data-ttu-id="3a67a-124">使用「檔相似」資料更新單一檔案的應用程式</span><span class="sxs-lookup"><span data-stu-id="3a67a-124">Applications updating a single file with "document-like" data</span></span>

<span data-ttu-id="3a67a-125">許多應用程式會處理「類似檔」的資料，通常會將整份檔載入記憶體中、操作它，然後寫回以儲存變更。</span><span class="sxs-lookup"><span data-stu-id="3a67a-125">Many applications which deal with "document-like" data tend to load the entire document into memory, operate on it, and then write it back out to save the changes.</span></span> <span data-ttu-id="3a67a-126">此處所需要的不可部分完成性，是完全套用或未套用的變更，因為不一致的狀態會導致檔案損毀。</span><span class="sxs-lookup"><span data-stu-id="3a67a-126">The needed atomicity here is that the changes either are completely applied or not applied at all, as an inconsistent state would render the file corrupt.</span></span> <span data-ttu-id="3a67a-127">常見的方法是將檔寫入至新的檔案，然後以新的檔案取代原始檔案。</span><span class="sxs-lookup"><span data-stu-id="3a67a-127">A common approach is to write the document to a new file, then replace the original file with the new one.</span></span> <span data-ttu-id="3a67a-128">其中一個方法是使用 [**ReplaceFile**](/windows/desktop/api/WinBase/nf-winbase-replacefilea) API。</span><span class="sxs-lookup"><span data-stu-id="3a67a-128">One method to do this is with the [**ReplaceFile**](/windows/desktop/api/WinBase/nf-winbase-replacefilea) API.</span></span>

## <a name="applications-performing-updates-to-multiple-files-andor-to-the-registry-hive"></a><span data-ttu-id="3a67a-129">對多個檔案和/或登錄 hive 執行更新的應用程式</span><span class="sxs-lookup"><span data-stu-id="3a67a-129">Applications performing updates to multiple files and/or to the registry hive</span></span>

<span data-ttu-id="3a67a-130">有許多應用程式都需要以不可部分完成的方式，對一組檔案和登錄進行更新。</span><span class="sxs-lookup"><span data-stu-id="3a67a-130">There are many applications which need to atomically perform an update to a set of files and to the registry.</span></span> <span data-ttu-id="3a67a-131">此案例最常透過安裝程式應用程式來達成，例如 Windows Installer。</span><span class="sxs-lookup"><span data-stu-id="3a67a-131">This scenario is most commonly achieved through an installer application, such as Windows Installer.</span></span> <span data-ttu-id="3a67a-132">如需 Windows Installer 的詳細資訊，請參閱 [Windows Installer](/windows/desktop/Msi/windows-installer-portal)。</span><span class="sxs-lookup"><span data-stu-id="3a67a-132">For more information on Windows Installer, please refer to [Windows Installer](/windows/desktop/Msi/windows-installer-portal).</span></span>

## <a name="applications-managing-a-set-of-structured-data"></a><span data-ttu-id="3a67a-133">管理一組結構化資料的應用程式</span><span class="sxs-lookup"><span data-stu-id="3a67a-133">Applications managing a set of structured data</span></span>

<span data-ttu-id="3a67a-134">許多應用程式會管理一組不同類型的專屬資料結構，作為儲存資料的方式。</span><span class="sxs-lookup"><span data-stu-id="3a67a-134">Many applications manage some set of proprietary data structures of varying types as a means to store data.</span></span> <span data-ttu-id="3a67a-135">如果在更新作業期間發生失敗，則這些應用程式的重大挑戰就是維護內部指標/參考完整性的流程。</span><span class="sxs-lookup"><span data-stu-id="3a67a-135">A significant challenge for these applications is the process of maintaining the integrity of internal pointers/references if a failure occurs during an update operation.</span></span> <span data-ttu-id="3a67a-136">為此建立機制的確是「困難的問題」，因此大部分的應用程式都會依賴真正的資料庫伺服器來管理其資料集。</span><span class="sxs-lookup"><span data-stu-id="3a67a-136">Creating the mechanism for this is indeed a "hard problem", and therefore most applications will rely on a true database server to manage their dataset.</span></span>

<span data-ttu-id="3a67a-137">有兩個協助管理結構化資料的建議如下：</span><span class="sxs-lookup"><span data-stu-id="3a67a-137">Two suggestions to help manage structured data are:</span></span>

-   <span data-ttu-id="3a67a-138">Microsoft 在 Windows 中提供可延伸的儲存引擎 (ESE) 收件匣，讓應用程式能夠執行交易資料更新和抓取作業。</span><span class="sxs-lookup"><span data-stu-id="3a67a-138">Microsoft provides the Extensible Storage Engine (ESE) inbox in Windows to enable applications to perform transacted data update and retrieval operations.</span></span> <span data-ttu-id="3a67a-139">如需有關可延伸儲存引擎 (ESE) 的詳細資訊，請參閱 <https://msdn.microsoft.com/library/gg269259.aspx> 。</span><span class="sxs-lookup"><span data-stu-id="3a67a-139">For more information on the Extensible Storage Engine (ESE), please see <https://msdn.microsoft.com/library/gg269259.aspx>.</span></span>
-   <span data-ttu-id="3a67a-140">對於需要更強大、穩定且可擴充之資料庫提供者的應用程式，建議客戶考慮使用 Microsoft SQL Server 提供的 Filestream 功能。</span><span class="sxs-lookup"><span data-stu-id="3a67a-140">For applications that require a more powerful, robust, and scalable database provider, it is recommended that customers consider using the Filestream feature available with Microsoft SQL Server.</span></span> <span data-ttu-id="3a67a-141">如需有關 SQL Filestream 的詳細資訊，請參閱 <https://technet.microsoft.com/library/bb933993.aspx> 。</span><span class="sxs-lookup"><span data-stu-id="3a67a-141">For more information on SQL Filestreams, please see <https://technet.microsoft.com/library/bb933993.aspx>.</span></span>

## <a name="applications-with-transactions-involving-files-on-a-local-ntfs-volume-and-tables-in-an-external-sql-database"></a><span data-ttu-id="3a67a-142">交易的應用程式牽涉到本機 NTFS 磁片區上的檔案和外部 SQL 資料庫中的資料表</span><span class="sxs-lookup"><span data-stu-id="3a67a-142">Applications with Transactions involving files on a local NTFS volume and Tables in an external SQL database</span></span>

<span data-ttu-id="3a67a-143">有大型資料集需要的應用程式類別，或需要在涉及外部資料庫和本機儲存體的作業中具有交易不可部分完成性。</span><span class="sxs-lookup"><span data-stu-id="3a67a-143">There are classes of applications which either have large dataset needs, or need to have transactional atomicity in an operation involving an external database and local storage.</span></span> <span data-ttu-id="3a67a-144">在此案例中，強烈建議開發人員考慮使用 SQL Filestream 來執行交易式檔案作業。</span><span class="sxs-lookup"><span data-stu-id="3a67a-144">For this scenario, it is highly recommended that developers consider using SQL Filestreams to perform transactional file operations.</span></span> <span data-ttu-id="3a67a-145">如需有關 SQL Filestream 的詳細資訊，請參閱 <https://technet.microsoft.com/library/bb933993.aspx> 。</span><span class="sxs-lookup"><span data-stu-id="3a67a-145">For more information on SQL Filestreams, please see <https://technet.microsoft.com/library/bb933993.aspx>.</span></span>

## <a name="closing--recommended-action"></a><span data-ttu-id="3a67a-146">關閉 & 建議的動作</span><span class="sxs-lookup"><span data-stu-id="3a67a-146">Closing & Recommended Action</span></span>

<span data-ttu-id="3a67a-147">TxF 是一組複雜且差別細微的 Api，不常用於協力廠商應用程式。</span><span class="sxs-lookup"><span data-stu-id="3a67a-147">TxF is a complex and nuanced set of APIs which are not commonly used by 3rd party applications.</span></span> <span data-ttu-id="3a67a-148">由於這些 Api 在未來的 Windows 版本中可能無法使用，而且有更簡單的替代方法可達成許多針對 TxF 開發的案例，因此 Microsoft 強烈建議開發人員調查這些替代方法，而不是在其應用程式中建立 TxF 的相依性。</span><span class="sxs-lookup"><span data-stu-id="3a67a-148">With the possibility that these APIs may not be available in future versions of Windows, and the fact that there are simpler alternative means to achieve many of the scenarios which TxF was developed for, Microsoft strongly recommends developers to investigate those alternative means instead of creating a dependency on TxF in their applications.</span></span>

 

 
