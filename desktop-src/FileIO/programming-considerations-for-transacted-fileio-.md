---
description: 描述交易式 NTFS 的各種程式設計考慮。
ms.assetid: a1ef1ce1-42f6-4627-ab64-e7f41fa23e94
title: 交易式 NTFS 的程式設計考慮
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e79dc7eba4de1258c294d3e41f8042f3cb01dc87
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "106979963"
---
# <a name="programming-considerations-for-transactional-ntfs"></a><span data-ttu-id="c5373-103">交易式 NTFS 的程式設計考慮</span><span class="sxs-lookup"><span data-stu-id="c5373-103">Programming Considerations for Transactional NTFS</span></span>

<span data-ttu-id="c5373-104">如需交易式 NTFS 的各種程式設計考慮的說明，請參閱下列各節：</span><span class="sxs-lookup"><span data-stu-id="c5373-104">For a description of various programming considerations for Transactional NTFS, see the following sections:</span></span>

-   [<span data-ttu-id="c5373-105">哪些檔案變更為交易</span><span class="sxs-lookup"><span data-stu-id="c5373-105">Which File Changes Are Transacted</span></span>](#which-file-changes-are-transacted)
-   [<span data-ttu-id="c5373-106">壓縮</span><span class="sxs-lookup"><span data-stu-id="c5373-106">Compression</span></span>](#compression)
-   [<span data-ttu-id="c5373-107">建立檔案或目錄</span><span class="sxs-lookup"><span data-stu-id="c5373-107">Creating a File or Directory</span></span>](#creating-a-file-or-directory)
-   [<span data-ttu-id="c5373-108">刪除檔案</span><span class="sxs-lookup"><span data-stu-id="c5373-108">Deleting a File</span></span>](#deleting-a-file)
-   [<span data-ttu-id="c5373-109">刪除目錄</span><span class="sxs-lookup"><span data-stu-id="c5373-109">Deleting a Directory</span></span>](#deleting-a-directory)
-   [<span data-ttu-id="c5373-110">目錄鎖定問題</span><span class="sxs-lookup"><span data-stu-id="c5373-110">Directory Locking Issues</span></span>](#directory-locking-issues)
-   [<span data-ttu-id="c5373-111">目錄列舉</span><span class="sxs-lookup"><span data-stu-id="c5373-111">Directory Enumeration</span></span>](#directory-enumeration)
-   [<span data-ttu-id="c5373-112">記憶體對應檔案</span><span class="sxs-lookup"><span data-stu-id="c5373-112">Memory-Mapped Files</span></span>](#memory-mapped-files)
-   [<span data-ttu-id="c5373-113">具名資料流</span><span class="sxs-lookup"><span data-stu-id="c5373-113">Named Streams</span></span>](#named-streams)
-   [<span data-ttu-id="c5373-114">重新命名檔案或目錄</span><span class="sxs-lookup"><span data-stu-id="c5373-114">Renaming a File or Directory</span></span>](#renaming-a-file-or-directory)
-   [<span data-ttu-id="c5373-115">重新剖析點</span><span class="sxs-lookup"><span data-stu-id="c5373-115">Reparse Points</span></span>](#reparse-points)
-   [<span data-ttu-id="c5373-116">錯誤碼</span><span class="sxs-lookup"><span data-stu-id="c5373-116">Error Codes</span></span>](#error-codes)
-   [<span data-ttu-id="c5373-117">加密檔案系統</span><span class="sxs-lookup"><span data-stu-id="c5373-117">Encrypted File System</span></span>](#encrypted-file-system)
-   [<span data-ttu-id="c5373-118">檔案 i/o 函數和交易式 NTFS</span><span class="sxs-lookup"><span data-stu-id="c5373-118">File I/O Functions and Transactional NTFS</span></span>](#file-io-functions-and-transactional-ntfs)
    -   [<span data-ttu-id="c5373-119">交易函數</span><span class="sxs-lookup"><span data-stu-id="c5373-119">Transacted Functions</span></span>](#transacted-functions)
    -   [<span data-ttu-id="c5373-120">由 TxF 變更的檔案 i/o 函數</span><span class="sxs-lookup"><span data-stu-id="c5373-120">File I/O Functions Changed By TxF</span></span>](#file-io-functions-changed-by-txf)

## <a name="which-file-changes-are-transacted"></a><span data-ttu-id="c5373-121">哪些檔案變更為交易</span><span class="sxs-lookup"><span data-stu-id="c5373-121">Which File Changes Are Transacted</span></span>

<span data-ttu-id="c5373-122">大部分的檔案變更（例如檔案內容、資料流程、重新分析點、屬性和檔案系統命名空間的變更）都會進行交易。</span><span class="sxs-lookup"><span data-stu-id="c5373-122">Most file changes, such as changes to file contents, streams, reparse points, attributes, and the file system namespace, are transacted.</span></span> <span data-ttu-id="c5373-123">當交易式檔案控制代碼上進行其中一項變更時，變更會與其他交易隔離，而且如果回復交易，變更就會復原。</span><span class="sxs-lookup"><span data-stu-id="c5373-123">When one of these changes is made on a transacted file handle, the change is isolated from other transactions, and the change is undone if the transaction is rolled back.</span></span>

<span data-ttu-id="c5373-124">不會影響檔案內容、中繼資料或檔案系統命名空間的變更，例如壓縮或磁碟重組的變更，並不會進行交易。</span><span class="sxs-lookup"><span data-stu-id="c5373-124">Changes that do not affect file contents, metadata, or the file system namespace, such as changes to compression or defragmentation, are not transacted.</span></span> <span data-ttu-id="c5373-125">這些變更不會與其他交易隔離，而且如果回復交易，這些變更就不會復原。</span><span class="sxs-lookup"><span data-stu-id="c5373-125">These changes are not isolated from other transactions, and they are not undone if the transaction is rolled back.</span></span>

## <a name="compression"></a><span data-ttu-id="c5373-126">壓縮</span><span class="sxs-lookup"><span data-stu-id="c5373-126">Compression</span></span>

<span data-ttu-id="c5373-127">無法變更在交易中開啟之檔案的壓縮狀態。</span><span class="sxs-lookup"><span data-stu-id="c5373-127">The compression state of a file opened in a transaction cannot be changed.</span></span>

## <a name="creating-a-file-or-directory"></a><span data-ttu-id="c5373-128">建立檔案或目錄</span><span class="sxs-lookup"><span data-stu-id="c5373-128">Creating a File or Directory</span></span>

<span data-ttu-id="c5373-129">在交易中建立的檔案或目錄，在目前交易以外的任何地方都看不到。</span><span class="sxs-lookup"><span data-stu-id="c5373-129">A file or directory that is created in a transaction is not visible to anything outside the current transaction.</span></span> <span data-ttu-id="c5373-130">在此交易之外，任何嘗試建立具有相同名稱的檔案都會失敗並出現錯誤 **\_ 交易 \_ 衝突**，並有效地保留交易認可或回復時的檔案名。</span><span class="sxs-lookup"><span data-stu-id="c5373-130">Outside this transaction, any attempt to create a file with the same name fails with the error **ERROR\_TRANSACTIONAL\_CONFLICT**, effectively reserving the file name for when the transaction commits or is rolled back.</span></span>

## <a name="deleting-a-file"></a><span data-ttu-id="c5373-131">刪除檔案</span><span class="sxs-lookup"><span data-stu-id="c5373-131">Deleting a File</span></span>

<span data-ttu-id="c5373-132">藉由呼叫 [**DeleteFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-deletefiletransacteda) 函式所刪除的檔案或目錄，將會對所有外部讀取器保持可見。</span><span class="sxs-lookup"><span data-stu-id="c5373-132">A file or directory that is deleted by calling the [**DeleteFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-deletefiletransacteda) function remains visible to all outside readers.</span></span>

> [!Note]  
> <span data-ttu-id="c5373-133">在交易結束之前，必須先關閉檔案的所有交易控制碼。</span><span class="sxs-lookup"><span data-stu-id="c5373-133">All transacted handles to the file must be closed before the end of the transaction.</span></span> <span data-ttu-id="c5373-134">如果控制碼未正確關閉，就不會進行刪除。</span><span class="sxs-lookup"><span data-stu-id="c5373-134">If the handles are not properly closed, the delete does not occur.</span></span> <span data-ttu-id="c5373-135">必須先關閉檔案的所有開啟的控制碼，才能執行刪除作業的認可，以將其視為交易的一部分。</span><span class="sxs-lookup"><span data-stu-id="c5373-135">All open handles to the file must be closed before performing the commit for the delete operation to be considered part of the transaction.</span></span> <span data-ttu-id="c5373-136">這是因為系統不會實際刪除檔案，直到其最後一個控制碼關閉為止，即使作業不是交易式，也是 Windows 檔案 i/o 子系統的一部分。</span><span class="sxs-lookup"><span data-stu-id="c5373-136">This is because the system does not actually delete a file until the last handle to it is closed, even when the operation is not transacted, as part of the Windows file I/O subsystem.</span></span>

 

## <a name="deleting-a-directory"></a><span data-ttu-id="c5373-137">刪除目錄</span><span class="sxs-lookup"><span data-stu-id="c5373-137">Deleting a Directory</span></span>

<span data-ttu-id="c5373-138">藉由呼叫 [**RemoveDirectoryTransacted**](/windows/desktop/api/WinBase/nf-winbase-removedirectorytransacteda) 函式來刪除的目錄，將會對所有外部讀取器保持可見。</span><span class="sxs-lookup"><span data-stu-id="c5373-138">A directory that is deleted by calling the [**RemoveDirectoryTransacted**](/windows/desktop/api/WinBase/nf-winbase-removedirectorytransacteda) function remains visible to all outside readers.</span></span>

> [!Note]  
> <span data-ttu-id="c5373-139">針對交易目錄作業的開啟控制碼，在檔案上的開啟控制碼也有相同的條件約束。</span><span class="sxs-lookup"><span data-stu-id="c5373-139">The same constraints exist for open handles on transacted directory operations as on files.</span></span> <span data-ttu-id="c5373-140">如需詳細資訊，請參閱 [刪除](#deleting-a-file)檔案。</span><span class="sxs-lookup"><span data-stu-id="c5373-140">For more information, see [Deleting a File](#deleting-a-file).</span></span>

 

## <a name="directory-locking-issues"></a><span data-ttu-id="c5373-141">目錄鎖定問題</span><span class="sxs-lookup"><span data-stu-id="c5373-141">Directory Locking Issues</span></span>

<span data-ttu-id="c5373-142">如果在交易中修改檔案，則在交易結束之前，會將檔案路徑的所有目錄元件稱為「已釘選」以進行 *重新命名* 。</span><span class="sxs-lookup"><span data-stu-id="c5373-142">If a file is modified in a transaction, all directory components of the path to the file are referred to as *pinned against rename* until the transaction ends.</span></span> <span data-ttu-id="c5373-143">也就是說，系統會在認可或回復交易之前，防止您將其重新命名。</span><span class="sxs-lookup"><span data-stu-id="c5373-143">That is, the system prevents you from renaming them until the transaction is committed or rolled back.</span></span> <span data-ttu-id="c5373-144">嘗試重新命名在進行中的交易中已修改之檔案的上階目錄，將會因為錯誤而無法 **\_ \_ 中斷 \_ 交易 \_** 相依性的錯誤而失敗。</span><span class="sxs-lookup"><span data-stu-id="c5373-144">An attempt to rename a directory that is an ancestor to a file that has been modified in an ongoing transaction will fail with the error **ERROR\_CANT\_BREAK\_TRANSACTIONAL\_DEPENDENCY**.</span></span>

## <a name="directory-enumeration"></a><span data-ttu-id="c5373-145">目錄列舉</span><span class="sxs-lookup"><span data-stu-id="c5373-145">Directory Enumeration</span></span>

<span data-ttu-id="c5373-146">由於使用列舉的 Api （例如 [**FindFirstFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-findfirstfiletransacteda) 和 [**FindNextFile**](/windows/desktop/api/FileAPI/nf-fileapi-findnextfilea) 函式），在列舉進行中時，可以變更目錄的內容。</span><span class="sxs-lookup"><span data-stu-id="c5373-146">The contents of a directory can be changed while an enumeration is in progress as a result of using APIs that enumerate, for example the [**FindFirstFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-findfirstfiletransacteda) and [**FindNextFile**](/windows/desktop/api/FileAPI/nf-fileapi-findnextfilea) functions.</span></span>

<span data-ttu-id="c5373-147">對交易以外的目錄進行的變更不會與交易隔離，而且會立即顯示在交易內。</span><span class="sxs-lookup"><span data-stu-id="c5373-147">Changes to a directory outside a transaction are not isolated from the transaction and are immediately visible within the transaction.</span></span> <span data-ttu-id="c5373-148">例如，如果非交易寫入器將檔案新增至目錄，則新檔案會立即顯示在交易內，因此呼叫 [**FindFirstFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-findfirstfiletransacteda) 或 [**FindNextFile**](/windows/desktop/api/FileAPI/nf-fileapi-findnextfilea) 函式會傳回新的檔案。</span><span class="sxs-lookup"><span data-stu-id="c5373-148">For example, if a non-transacted writer adds a file to a directory, the new file is immediately visible inside the transaction such that calling the [**FindFirstFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-findfirstfiletransacteda) or [**FindNextFile**](/windows/desktop/api/FileAPI/nf-fileapi-findnextfilea) function will return the new file.</span></span>

<span data-ttu-id="c5373-149">在交易內對目錄所做的變更會被隔離，直到交易認可為止。</span><span class="sxs-lookup"><span data-stu-id="c5373-149">Changes made to a directory inside a transaction are isolated until the transaction commits.</span></span> <span data-ttu-id="c5373-150">例如，在目錄中建立做為交易一部分的檔案。</span><span class="sxs-lookup"><span data-stu-id="c5373-150">For example, a file created in the directory as part of the transaction.</span></span> <span data-ttu-id="c5373-151">呼叫 [**FindFirstFile**](/windows/desktop/api/FileAPI/nf-fileapi-findfirstfilea) 或 [**FindNextFile**](/windows/desktop/api/FileAPI/nf-fileapi-findnextfilea) 函數的非交易讀取器在交易認可之前，將不會看到新建立的檔案。</span><span class="sxs-lookup"><span data-stu-id="c5373-151">A non-transacted reader calling the [**FindFirstFile**](/windows/desktop/api/FileAPI/nf-fileapi-findfirstfilea) or [**FindNextFile**](/windows/desktop/api/FileAPI/nf-fileapi-findnextfilea) function will not see the newly created file until the transaction commits.</span></span>

## <a name="memory-mapped-files"></a><span data-ttu-id="c5373-152">記憶體對應檔案</span><span class="sxs-lookup"><span data-stu-id="c5373-152">Memory-Mapped Files</span></span>

<span data-ttu-id="c5373-153">用戶端必須呼叫 [**FlushViewOfFile**](/windows/desktop/api/memoryapi/nf-memoryapi-flushviewoffile) 函式，關閉檔案對應物件，並在記憶體對應檔案上認可相關聯的交易之前，關閉檔案控制代碼。</span><span class="sxs-lookup"><span data-stu-id="c5373-153">The client must call the [**FlushViewOfFile**](/windows/desktop/api/memoryapi/nf-memoryapi-flushviewoffile) function, close the file-mapping object, and close the file handle before committing the associated transaction on a memory-mapped file.</span></span>

## <a name="named-streams"></a><span data-ttu-id="c5373-154">具名資料流</span><span class="sxs-lookup"><span data-stu-id="c5373-154">Named Streams</span></span>

<span data-ttu-id="c5373-155">命名資料流程是完整的交易式，但鎖定是在檔案層級執行，而非資料流程層級。</span><span class="sxs-lookup"><span data-stu-id="c5373-155">Named streams are fully transactional, but locking is done at the file level, not the stream level.</span></span> <span data-ttu-id="c5373-156">從交易外部的寫入器嘗試修改鎖定檔案內的任何資料流程時，會收到錯誤的錯誤 **\_ 共用 \_ 違規**。</span><span class="sxs-lookup"><span data-stu-id="c5373-156">Writers from outside a transaction that attempt to modify any stream within a locked file receive the error **ERROR\_SHARING\_VIOLATION**.</span></span>

<span data-ttu-id="c5373-157">您無法在交易中重新命名次要資料流程。</span><span class="sxs-lookup"><span data-stu-id="c5373-157">You cannot rename a secondary stream in a transaction.</span></span>

## <a name="renaming-a-file-or-directory"></a><span data-ttu-id="c5373-158">重新命名檔案或目錄</span><span class="sxs-lookup"><span data-stu-id="c5373-158">Renaming a File or Directory</span></span>

<span data-ttu-id="c5373-159">若要將檔案重新命名為交易作業，請呼叫 [**MoveFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-movefiletransacteda) 以移動檔案。</span><span class="sxs-lookup"><span data-stu-id="c5373-159">To rename a file as a transacted operation, call [**MoveFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-movefiletransacteda) to move the file.</span></span>

## <a name="reparse-points"></a><span data-ttu-id="c5373-160">重新剖析點</span><span class="sxs-lookup"><span data-stu-id="c5373-160">Reparse Points</span></span>

<span data-ttu-id="c5373-161">重新分析點的變更是交易式的，這表示如果新的重新分析點指派給交易中的檔案，其他交易就看不到它。</span><span class="sxs-lookup"><span data-stu-id="c5373-161">Changes to reparse points are transacted, which means that if a new reparse point gets assigned to a file in a transaction, it is not visible to the other transactions.</span></span> <span data-ttu-id="c5373-162">同樣地，在認可之前，不會顯示現有重新分析點的變更或移除。</span><span class="sxs-lookup"><span data-stu-id="c5373-162">Similarly, changes or removal of an existing reparse point are not visible until commit.</span></span>

## <a name="error-codes"></a><span data-ttu-id="c5373-163">錯誤碼</span><span class="sxs-lookup"><span data-stu-id="c5373-163">Error Codes</span></span>

<span data-ttu-id="c5373-164">核心交易管理員 (KTM) 使用範圍從6700到6799的系統錯誤碼。</span><span class="sxs-lookup"><span data-stu-id="c5373-164">The Kernel Transaction Manager (KTM) uses the system error codes in the range from 6700 through 6799.</span></span> <span data-ttu-id="c5373-165">交易式 NTFS (TxF) 使用範圍從6800到6899的 Windows 錯誤碼。</span><span class="sxs-lookup"><span data-stu-id="c5373-165">Transactional NTFS (TxF) uses Windows error codes in the range from 6800 through 6899.</span></span> <span data-ttu-id="c5373-166">如需詳細資訊，請參閱 Winerror.h 和系統錯誤碼 (6000-8199) 。</span><span class="sxs-lookup"><span data-stu-id="c5373-166">For more information, see WinError.h and System Error Codes (6000-8199).</span></span>

## <a name="encrypted-file-system"></a><span data-ttu-id="c5373-167">加密檔案系統</span><span class="sxs-lookup"><span data-stu-id="c5373-167">Encrypted File System</span></span>

<span data-ttu-id="c5373-168">TxF 不支援 EFS 檔案的作業。</span><span class="sxs-lookup"><span data-stu-id="c5373-168">TxF does not support operations on EFS files.</span></span> <span data-ttu-id="c5373-169">您無法為交易開啟 EFS 加密檔案。</span><span class="sxs-lookup"><span data-stu-id="c5373-169">You cannot open an EFS-encrypted file for transactions.</span></span> <span data-ttu-id="c5373-170">在 EFS 檔案上呼叫 [**CreateFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-createfiletransacteda) 函式將會失敗，並 **產生 \_ \_ \_ \_ \_ 交易中不允許** 的錯誤（efs）錯誤。</span><span class="sxs-lookup"><span data-stu-id="c5373-170">Calling the [**CreateFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-createfiletransacteda) function on an EFS file will fail with the error **ERROR\_EFS\_NOT\_ALLOWED\_IN\_TRANSACTION**.</span></span> <span data-ttu-id="c5373-171">同樣地，在交易中呼叫檔案的 [**EncryptFile**](/windows/desktop/api/WinBase/nf-winbase-encryptfilea) 函式將會失敗，並 **出現 \_ \_ \_ \_ \_ 交易中不允許** 的錯誤「EFS」錯誤。</span><span class="sxs-lookup"><span data-stu-id="c5373-171">Similarly, calling the [**EncryptFile**](/windows/desktop/api/WinBase/nf-winbase-encryptfilea) function on a file in a transaction will fail with the error **ERROR\_EFS\_NOT\_ALLOWED\_IN\_TRANSACTION**.</span></span>

## <a name="file-io-functions-and-transactional-ntfs"></a><span data-ttu-id="c5373-172">檔案 i/o 函數和交易式 NTFS</span><span class="sxs-lookup"><span data-stu-id="c5373-172">File I/O Functions and Transactional NTFS</span></span>

<span data-ttu-id="c5373-173">TxF 提供採用檔案名的新交易函數，並變更採用檔案控制代碼之現有檔案 i/o API 函式的行為。</span><span class="sxs-lookup"><span data-stu-id="c5373-173">TxF provides new transacted functions that take a file name, and changes the behavior of existing file I/O API functions that take a file handle.</span></span>

### <a name="transacted-functions"></a><span data-ttu-id="c5373-174">交易函數</span><span class="sxs-lookup"><span data-stu-id="c5373-174">Transacted Functions</span></span>

<span data-ttu-id="c5373-175">如果您未呼叫下列其中一個交易函式來取代其非交易版本，則不會交易作業：</span><span class="sxs-lookup"><span data-stu-id="c5373-175">If you do not call one of the following transacted functions in place of its non-transacted version, the operation will not be transacted:</span></span>

-   [<span data-ttu-id="c5373-176">**CopyFileTransacted**</span><span class="sxs-lookup"><span data-stu-id="c5373-176">**CopyFileTransacted**</span></span>](/windows/desktop/api/WinBase/nf-winbase-copyfiletransacteda)
-   [<span data-ttu-id="c5373-177">**CreateDirectoryTransacted**</span><span class="sxs-lookup"><span data-stu-id="c5373-177">**CreateDirectoryTransacted**</span></span>](/windows/desktop/api/WinBase/nf-winbase-createdirectorytransacteda)
-   [<span data-ttu-id="c5373-178">**CreateFileTransacted**</span><span class="sxs-lookup"><span data-stu-id="c5373-178">**CreateFileTransacted**</span></span>](/windows/desktop/api/WinBase/nf-winbase-createfiletransacteda)
-   [<span data-ttu-id="c5373-179">**CreateHardLinkTransacted**</span><span class="sxs-lookup"><span data-stu-id="c5373-179">**CreateHardLinkTransacted**</span></span>](/windows/desktop/api/WinBase/nf-winbase-createhardlinktransacteda)
-   [<span data-ttu-id="c5373-180">**CreateSymbolicLinkTransacted**</span><span class="sxs-lookup"><span data-stu-id="c5373-180">**CreateSymbolicLinkTransacted**</span></span>](/windows/desktop/api/WinBase/nf-winbase-createsymboliclinktransacteda)
-   [<span data-ttu-id="c5373-181">**DeleteFileTransacted**</span><span class="sxs-lookup"><span data-stu-id="c5373-181">**DeleteFileTransacted**</span></span>](/windows/desktop/api/WinBase/nf-winbase-deletefiletransacteda)
-   [<span data-ttu-id="c5373-182">**FindFirstFileNameTransactedW**</span><span class="sxs-lookup"><span data-stu-id="c5373-182">**FindFirstFileNameTransactedW**</span></span>](/windows/desktop/api/WinBase/nf-winbase-findfirstfilenametransactedw)
-   [<span data-ttu-id="c5373-183">**FindFirstFileTransacted**</span><span class="sxs-lookup"><span data-stu-id="c5373-183">**FindFirstFileTransacted**</span></span>](/windows/desktop/api/WinBase/nf-winbase-findfirstfiletransacteda)
-   [<span data-ttu-id="c5373-184">**FindFirstStreamTransactedW**</span><span class="sxs-lookup"><span data-stu-id="c5373-184">**FindFirstStreamTransactedW**</span></span>](/windows/desktop/api/WinBase/nf-winbase-findfirststreamtransactedw)
-   [<span data-ttu-id="c5373-185">**GetCompressedFileSizeTransacted**</span><span class="sxs-lookup"><span data-stu-id="c5373-185">**GetCompressedFileSizeTransacted**</span></span>](/windows/desktop/api/WinBase/nf-winbase-getcompressedfilesizetransacteda)
-   [<span data-ttu-id="c5373-186">**GetFileAttributesTransacted**</span><span class="sxs-lookup"><span data-stu-id="c5373-186">**GetFileAttributesTransacted**</span></span>](/windows/desktop/api/WinBase/nf-winbase-getfileattributestransacteda)
-   [<span data-ttu-id="c5373-187">**GetFullPathNameTransacted**</span><span class="sxs-lookup"><span data-stu-id="c5373-187">**GetFullPathNameTransacted**</span></span>](/windows/desktop/api/WinBase/nf-winbase-getfullpathnametransacteda)
-   [<span data-ttu-id="c5373-188">**GetLongPathNameTransacted**</span><span class="sxs-lookup"><span data-stu-id="c5373-188">**GetLongPathNameTransacted**</span></span>](/windows/desktop/api/WinBase/nf-winbase-getlongpathnametransacteda)
-   [<span data-ttu-id="c5373-189">**MoveFileTransacted**</span><span class="sxs-lookup"><span data-stu-id="c5373-189">**MoveFileTransacted**</span></span>](/windows/desktop/api/WinBase/nf-winbase-movefiletransacteda)
-   [<span data-ttu-id="c5373-190">**RemoveDirectoryTransacted**</span><span class="sxs-lookup"><span data-stu-id="c5373-190">**RemoveDirectoryTransacted**</span></span>](/windows/desktop/api/WinBase/nf-winbase-removedirectorytransacteda)
-   [<span data-ttu-id="c5373-191">**SetFileAttributesTransacted**</span><span class="sxs-lookup"><span data-stu-id="c5373-191">**SetFileAttributesTransacted**</span></span>](/windows/desktop/api/WinBase/nf-winbase-setfileattributestransacteda)

<span data-ttu-id="c5373-192">例如， [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) 函數現在具有交易版本： [**CreateFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-createfiletransacteda)。</span><span class="sxs-lookup"><span data-stu-id="c5373-192">For example, the [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) function now has a transacted version: [**CreateFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-createfiletransacteda).</span></span>

### <a name="file-io-functions-changed-by-txf"></a><span data-ttu-id="c5373-193">由 TxF 變更的檔案 i/o 函數</span><span class="sxs-lookup"><span data-stu-id="c5373-193">File I/O Functions Changed By TxF</span></span>

<span data-ttu-id="c5373-194">下表列出其行為受交易式 NTFS 影響的函式。</span><span class="sxs-lookup"><span data-stu-id="c5373-194">The following table lists the functions whose behavior is affected by Transactional NTFS.</span></span> <span data-ttu-id="c5373-195">例如， [**ReadFile**](/windows/desktop/api/FileAPI/nf-fileapi-readfile)函式的行為會根據 [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea)函式或 [**CreateFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-createfiletransacteda)函數所建立的 *hFile* 參數而有所不同。</span><span class="sxs-lookup"><span data-stu-id="c5373-195">For example, the behavior of the [**ReadFile**](/windows/desktop/api/FileAPI/nf-fileapi-readfile) function will vary depending on whether the *hFile* parameter was created by the [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) function or the [**CreateFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-createfiletransacteda) function.</span></span>



| <span data-ttu-id="c5373-196">函式</span><span class="sxs-lookup"><span data-stu-id="c5373-196">Function</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                             | <span data-ttu-id="c5373-197">描述</span><span class="sxs-lookup"><span data-stu-id="c5373-197">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="c5373-198"><span id="CloseHandle"></span><span id="closehandle"></span><span id="CLOSEHANDLE"></span>[**CloseHandle**](/windows/desktop/api/handleapi/nf-handleapi-closehandle)</span><span class="sxs-lookup"><span data-stu-id="c5373-198"><span id="CloseHandle"></span><span id="closehandle"></span><span id="CLOSEHANDLE"></span>[**CloseHandle**](/windows/desktop/api/handleapi/nf-handleapi-closehandle)</span></span><br/>                                                                                                                                                                                                                                                                                                             | <span data-ttu-id="c5373-199">在認可交易之前，應用程式應該關閉所有系結至交易的控制碼。</span><span class="sxs-lookup"><span data-stu-id="c5373-199">Applications should close all handles bound to a transaction before the transaction is committed.</span></span> <span data-ttu-id="c5373-200">在認可交易之前，應用程式必須關閉以檔案 **\_ 旗標 \_ 刪除 \_ \_** 開啟的交易控制碼，以便進行刪除作業。</span><span class="sxs-lookup"><span data-stu-id="c5373-200">An application must close a transacted handle opened with **FILE\_FLAG\_DELETE\_ON\_CLOSE** before committing the transaction in order for the delete operation to occur.</span></span><br/>                                                                                                                                     |
| <span data-ttu-id="c5373-201"><span id="CreateFileMapping"></span><span id="createfilemapping"></span><span id="CREATEFILEMAPPING"></span>[**CreateFileMapping**](/windows/desktop/api/winbase/nf-winbase-createfilemappinga)</span><span class="sxs-lookup"><span data-stu-id="c5373-201"><span id="CreateFileMapping"></span><span id="createfilemapping"></span><span id="CREATEFILEMAPPING"></span>[**CreateFileMapping**](/windows/desktop/api/winbase/nf-winbase-createfilemappinga)</span></span><br/>                                                                                                                                                                                                                                                                                 | <span data-ttu-id="c5373-202">如果有與 *hFile* 相關聯的交易，則此函式所建立的檔案對應物件將會與相同的交易相關聯。</span><span class="sxs-lookup"><span data-stu-id="c5373-202">If there is a transaction associated with *hFile*, then the file-mapping object that this function creates will be associated with the same transaction.</span></span> <span data-ttu-id="c5373-203">透過此檔案對應物件的視圖所進行的修改會進行交易。</span><span class="sxs-lookup"><span data-stu-id="c5373-203">Modifications made through views of this file-mapping object are transacted.</span></span> <span data-ttu-id="c5373-204">應用程式必須呼叫 [**FlushViewOfFile**](/windows/desktop/api/memoryapi/nf-memoryapi-flushviewoffile)、取消所有視圖的對應，並在認可交易變更之前關閉檔案對應物件的所有控制碼。</span><span class="sxs-lookup"><span data-stu-id="c5373-204">Applications must call [**FlushViewOfFile**](/windows/desktop/api/memoryapi/nf-memoryapi-flushviewoffile), unmap all views, and close all handles to the file-mapping object before committing transacted changes.</span></span><br/> |
| <span data-ttu-id="c5373-205"><span id="FindNextFile"></span><span id="findnextfile"></span><span id="FINDNEXTFILE"></span>[**FindNextFile**](/windows/desktop/api/FileAPI/nf-fileapi-findnextfilea)</span><span class="sxs-lookup"><span data-stu-id="c5373-205"><span id="FindNextFile"></span><span id="findnextfile"></span><span id="FINDNEXTFILE"></span>[**FindNextFile**](/windows/desktop/api/FileAPI/nf-fileapi-findnextfilea)</span></span><br/>                                                                                                                                                                                                                                                                                                         | <span data-ttu-id="c5373-206">如果有交易系結至檔案列舉控制碼，則傳回的檔案會受到交易隔離規則的約束。</span><span class="sxs-lookup"><span data-stu-id="c5373-206">If there is a transaction bound to the file enumeration handle, then the files that are returned are subject to transaction isolation rules.</span></span><br/>                                                                                                                                                                                                                                                                    |
| <span data-ttu-id="c5373-207"><span id="FSCTL_SET_COMPRESSION"></span><span id="fsctl_set_compression"></span>[**FSCTL \_ 設定 \_ 壓縮**](/windows/win32/api/winioctl/ni-winioctl-fsctl_set_compression)</span><span class="sxs-lookup"><span data-stu-id="c5373-207"><span id="FSCTL_SET_COMPRESSION"></span><span id="fsctl_set_compression"></span>[**FSCTL\_SET\_COMPRESSION**](/windows/win32/api/winioctl/ni-winioctl-fsctl_set_compression)</span></span><br/>                                                                                                                                                                                                                                                                                                  | <span data-ttu-id="c5373-208">您無法變更 [**CreateFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-createfiletransacteda)開啟之檔案的壓縮狀態。</span><span class="sxs-lookup"><span data-stu-id="c5373-208">You cannot change the compression state of a file opened by [**CreateFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-createfiletransacteda).</span></span><br/>                                                                                                                                                                                                                                                                                               |
| <span data-ttu-id="c5373-209"><span id="GetFileInformationByHandle__________and__________GetFileInformationByHandleEx"></span><span id="getfileinformationbyhandle__________and__________getfileinformationbyhandleex"></span><span id="GETFILEINFORMATIONBYHANDLE__________AND__________GETFILEINFORMATIONBYHANDLEEX"></span>[**GetFileInformationByHandle**](/windows/desktop/api/FileAPI/nf-fileapi-getfileinformationbyhandle)和 [ **GetFileInformationByHandleEx**](/windows/desktop/api/WinBase/nf-winbase-getfileinformationbyhandleex)</span><span class="sxs-lookup"><span data-stu-id="c5373-209"><span id="GetFileInformationByHandle__________and__________GetFileInformationByHandleEx"></span><span id="getfileinformationbyhandle__________and__________getfileinformationbyhandleex"></span><span id="GETFILEINFORMATIONBYHANDLE__________AND__________GETFILEINFORMATIONBYHANDLEEX"></span>[**GetFileInformationByHandle**](/windows/desktop/api/FileAPI/nf-fileapi-getfileinformationbyhandle) and [**GetFileInformationByHandleEx**](/windows/desktop/api/WinBase/nf-winbase-getfileinformationbyhandleex)</span></span><br/> | <span data-ttu-id="c5373-210">如果有交易系結至檔案控制代碼，則函式會傳回隔離檔案視圖的資訊。</span><span class="sxs-lookup"><span data-stu-id="c5373-210">If there is a transaction bound to the file handle, then the function returns information for the isolated file view.</span></span><br/>                                                                                                                                                                                                                                                                                           |
| <span data-ttu-id="c5373-211"><span id="GetFileSize_and__________GetFileSizeEx"></span><span id="getfilesize_and__________getfilesizeex"></span><span id="GETFILESIZE_AND__________GETFILESIZEEX"></span>[**GetFileSize**](/windows/desktop/api/FileAPI/nf-fileapi-getfilesize)和 [ **GetFileSizeEx**](/windows/desktop/api/FileAPI/nf-fileapi-getfilesizeex)</span><span class="sxs-lookup"><span data-stu-id="c5373-211"><span id="GetFileSize_and__________GetFileSizeEx"></span><span id="getfilesize_and__________getfilesizeex"></span><span id="GETFILESIZE_AND__________GETFILESIZEEX"></span>[**GetFileSize**](/windows/desktop/api/FileAPI/nf-fileapi-getfilesize) and [**GetFileSizeEx**](/windows/desktop/api/FileAPI/nf-fileapi-getfilesizeex)</span></span><br/>                                                                                                                                                                                  | <span data-ttu-id="c5373-212">如果有交易系結至檔案控制代碼，則函式會傳回隔離檔案視圖的資訊。</span><span class="sxs-lookup"><span data-stu-id="c5373-212">If there is a transaction bound to the file handle, then the function returns information for the isolated file view.</span></span><br/>                                                                                                                                                                                                                                                                                           |
| <span data-ttu-id="c5373-213"><span id="GetVolumeInformation"></span><span id="getvolumeinformation"></span><span id="GETVOLUMEINFORMATION"></span>[**GetVolumeInformation**](/windows/desktop/api/FileAPI/nf-fileapi-getvolumeinformationa)</span><span class="sxs-lookup"><span data-stu-id="c5373-213"><span id="GetVolumeInformation"></span><span id="getvolumeinformation"></span><span id="GETVOLUMEINFORMATION"></span>[**GetVolumeInformation**](/windows/desktop/api/FileAPI/nf-fileapi-getvolumeinformationa)</span></span><br/>                                                                                                                                                                                                                                                                 | <span data-ttu-id="c5373-214">如果磁片區支援檔案系統交易，則函式會傳回檔案以支援 *lpFileSystemFlags* 中的 **\_ \_ 交易**。</span><span class="sxs-lookup"><span data-stu-id="c5373-214">If the volume supports file system transactions, the function returns **FILE\_SUPPORTS\_TRANSACTIONS** in *lpFileSystemFlags*.</span></span><br/>                                                                                                                                                                                                                                                                                  |
| <span data-ttu-id="c5373-215"><span id="MapViewOfFile_and__________MapViewOfFileEx"></span><span id="mapviewoffile_and__________mapviewoffileex"></span><span id="MAPVIEWOFFILE_AND__________MAPVIEWOFFILEEX"></span>[**MapViewOfFile**](/windows/desktop/api/memoryapi/nf-memoryapi-mapviewoffile)和 [ **MapViewOfFileEx**](/windows/desktop/api/memoryapi/nf-memoryapi-mapviewoffileex)</span><span class="sxs-lookup"><span data-stu-id="c5373-215"><span id="MapViewOfFile_and__________MapViewOfFileEx"></span><span id="mapviewoffile_and__________mapviewoffileex"></span><span id="MAPVIEWOFFILE_AND__________MAPVIEWOFFILEEX"></span>[**MapViewOfFile**](/windows/desktop/api/memoryapi/nf-memoryapi-mapviewoffile) and [**MapViewOfFileEx**](/windows/desktop/api/memoryapi/nf-memoryapi-mapviewoffileex)</span></span><br/>                                                                                                                                                                | <span data-ttu-id="c5373-216">如果有一個交易與用來建立所對應之檔案對應物件的檔案控制代碼相關聯，則相關聯的視圖會是交易式的。</span><span class="sxs-lookup"><span data-stu-id="c5373-216">If there is a transaction associated with the file handle used to create the file-mapping object that is being mapped, then the associated view is transacted.</span></span> <span data-ttu-id="c5373-217">如果使用 view 來對檔案進行交易變更，則使用者必須呼叫 [**FlushViewOfFile**](/windows/desktop/api/memoryapi/nf-memoryapi-flushviewoffile)、關閉檔案對應物件，並在認可相關聯的交易之前關閉檔案控制代碼。</span><span class="sxs-lookup"><span data-stu-id="c5373-217">If the view is used to make transacted changes to a file, then the user must call [**FlushViewOfFile**](/windows/desktop/api/memoryapi/nf-memoryapi-flushviewoffile), close the file-mapping object, and close the file handle before committing the associated transaction.</span></span><br/>              |
| <span data-ttu-id="c5373-218"><span id="ReadDirectoryChangesW"></span><span id="readdirectorychangesw"></span><span id="READDIRECTORYCHANGESW"></span>[**ReadDirectoryChangesW**](/windows/desktop/api/WinBase/nf-winbase-readdirectorychangesw)</span><span class="sxs-lookup"><span data-stu-id="c5373-218"><span id="ReadDirectoryChangesW"></span><span id="readdirectorychangesw"></span><span id="READDIRECTORYCHANGESW"></span>[**ReadDirectoryChangesW**](/windows/desktop/api/WinBase/nf-winbase-readdirectorychangesw)</span></span><br/>                                                                                                                                                                                                                                                            | <span data-ttu-id="c5373-219">如果有交易系結至目錄控制碼，則通知會反映目錄的隔離模式。</span><span class="sxs-lookup"><span data-stu-id="c5373-219">If there is a transaction bound to the directory handle, then the notifications reflect the isolated view of the directory.</span></span> <span data-ttu-id="c5373-220">對目錄的交易視圖以外的檔案進行變更時，不會包含在通知中。</span><span class="sxs-lookup"><span data-stu-id="c5373-220">Changes to files outside the transacted view of the directory are not included in the notifications.</span></span><br/>                                                                                                                                                                                |
| <span data-ttu-id="c5373-221"><span id="ReadFile___________ReadFileEx__and__________ReadFileScatter"></span><span id="readfile___________readfileex__and__________readfilescatter"></span><span id="READFILE___________READFILEEX__AND__________READFILESCATTER"></span>[**ReadFile**](/windows/desktop/api/FileAPI/nf-fileapi-readfile)、 [**ReadFileEx**](/windows/desktop/api/FileAPI/nf-fileapi-readfileex)和 [**ReadFileScatter**](/windows/desktop/api/FileAPI/nf-fileapi-readfilescatter)</span><span class="sxs-lookup"><span data-stu-id="c5373-221"><span id="ReadFile___________ReadFileEx__and__________ReadFileScatter"></span><span id="readfile___________readfileex__and__________readfilescatter"></span><span id="READFILE___________READFILEEX__AND__________READFILESCATTER"></span>[**ReadFile**](/windows/desktop/api/FileAPI/nf-fileapi-readfile), [**ReadFileEx**](/windows/desktop/api/FileAPI/nf-fileapi-readfileex), and [**ReadFileScatter**](/windows/desktop/api/FileAPI/nf-fileapi-readfilescatter)</span></span><br/>                                                                                  | <span data-ttu-id="c5373-222">如果有交易系結至檔案控制代碼，則函式會從檔案的交易視圖傳回資料。</span><span class="sxs-lookup"><span data-stu-id="c5373-222">If there is a transaction bound to the file handle, then the function returns data from the transacted view of the file.</span></span> <span data-ttu-id="c5373-223">交易讀取控制碼保證會在控制碼期間顯示相同的檔案視圖。</span><span class="sxs-lookup"><span data-stu-id="c5373-223">A transacted read handle is guaranteed to show the same view of a file for the duration of the handle.</span></span><br/>                                                                                                                                                                                 |
| <span data-ttu-id="c5373-224"><span id="SetEndOfFile"></span><span id="setendoffile"></span><span id="SETENDOFFILE"></span>[**SetEndOfFile**](/windows/desktop/api/FileAPI/nf-fileapi-setendoffile)</span><span class="sxs-lookup"><span data-stu-id="c5373-224"><span id="SetEndOfFile"></span><span id="setendoffile"></span><span id="SETENDOFFILE"></span>[**SetEndOfFile**](/windows/desktop/api/FileAPI/nf-fileapi-setendoffile)</span></span><br/>                                                                                                                                                                                                                                                                                                         | <span data-ttu-id="c5373-225">如果有交易系結至控制碼，則檔案結尾位置的變更就會經過交易。</span><span class="sxs-lookup"><span data-stu-id="c5373-225">If there is a transaction bound to the handle, then the change in the end-of-file position is transacted.</span></span><br/>                                                                                                                                                                                                                                                                                                       |
| <span data-ttu-id="c5373-226"><span id="SetFileInformationByHandle"></span><span id="setfileinformationbyhandle"></span><span id="SETFILEINFORMATIONBYHANDLE"></span>[**SetFileInformationByHandle**](/windows/desktop/api/FileAPI/nf-fileapi-setfileinformationbyhandle)</span><span class="sxs-lookup"><span data-stu-id="c5373-226"><span id="SetFileInformationByHandle"></span><span id="setfileinformationbyhandle"></span><span id="SETFILEINFORMATIONBYHANDLE"></span>[**SetFileInformationByHandle**](/windows/desktop/api/FileAPI/nf-fileapi-setfileinformationbyhandle)</span></span><br/>                                                                                                                                                                                                                                   | <span data-ttu-id="c5373-227">如果有交易系結至控制碼，則所做的變更將會針對資訊類別 **FileBasicInfo**、 **FileRenameInfo**、 **FileAllocationInfo**、 **FileEndOfFileInfo** 和 **FileDispositionInfo** 進行交易。</span><span class="sxs-lookup"><span data-stu-id="c5373-227">If there is a transaction bound to the handle, then the changes made will be transacted for the information classes **FileBasicInfo**, **FileRenameInfo**, **FileAllocationInfo**, **FileEndOfFileInfo**, and **FileDispositionInfo**.</span></span><br/>                                                                                                                                                                          |
| <span data-ttu-id="c5373-228"><span id="SetFileShortName"></span><span id="setfileshortname"></span><span id="SETFILESHORTNAME"></span>[**SetFileShortName**](/windows/desktop/api/WinBase/nf-winbase-setfileshortnamea)</span><span class="sxs-lookup"><span data-stu-id="c5373-228"><span id="SetFileShortName"></span><span id="setfileshortname"></span><span id="SETFILESHORTNAME"></span>[**SetFileShortName**](/windows/desktop/api/WinBase/nf-winbase-setfileshortnamea)</span></span><br/>                                                                                                                                                                                                                                                                                     | <span data-ttu-id="c5373-229">如果有交易系結至控制碼，則檔案簡短名稱中的變更就會經過交易。</span><span class="sxs-lookup"><span data-stu-id="c5373-229">If there is a transaction bound to the handle, then the change in the file's short name is transacted.</span></span><br/>                                                                                                                                                                                                                                                                                                          |
| <span data-ttu-id="c5373-230"><span id="SetFileTime"></span><span id="setfiletime"></span><span id="SETFILETIME"></span>[**SetFileTime**](/windows/desktop/api/fileapi/nf-fileapi-setfiletime)</span><span class="sxs-lookup"><span data-stu-id="c5373-230"><span id="SetFileTime"></span><span id="setfiletime"></span><span id="SETFILETIME"></span>[**SetFileTime**](/windows/desktop/api/fileapi/nf-fileapi-setfiletime)</span></span><br/>                                                                                                                                                                                                                                                                                                             | <span data-ttu-id="c5373-231">如果有交易系結至控制碼，檔案時間的變更就會經過交易。</span><span class="sxs-lookup"><span data-stu-id="c5373-231">If there is a transaction bound to the handle, then the change in file time is transacted.</span></span><br/>                                                                                                                                                                                                                                                                                                                      |
| <span data-ttu-id="c5373-232"><span id="WriteFile__________WriteFileEx__and_________WriteFileGather"></span><span id="writefile__________writefileex__and_________writefilegather"></span><span id="WRITEFILE__________WRITEFILEEX__AND_________WRITEFILEGATHER"></span>[**WriteFile**](/windows/desktop/api/FileAPI/nf-fileapi-writefile)、 [**WriteFileEx**](/windows/desktop/api/FileAPI/nf-fileapi-writefileex)和 [**WriteFileGather**](/windows/desktop/api/FileAPI/nf-fileapi-writefilegather)</span><span class="sxs-lookup"><span data-stu-id="c5373-232"><span id="WriteFile__________WriteFileEx__and_________WriteFileGather"></span><span id="writefile__________writefileex__and_________writefilegather"></span><span id="WRITEFILE__________WRITEFILEEX__AND_________WRITEFILEGATHER"></span>[**WriteFile**](/windows/desktop/api/FileAPI/nf-fileapi-writefile), [**WriteFileEx**](/windows/desktop/api/FileAPI/nf-fileapi-writefileex), and [**WriteFileGather**](/windows/desktop/api/FileAPI/nf-fileapi-writefilegather)</span></span><br/>                                                                              | <span data-ttu-id="c5373-233">如果有交易系結至檔案控制代碼，就會將檔案寫入交易。</span><span class="sxs-lookup"><span data-stu-id="c5373-233">If there is a transaction bound to the file handle, then the file write is transacted.</span></span><br/>                                                                                                                                                                                                                                                                                                                          |



 

 

