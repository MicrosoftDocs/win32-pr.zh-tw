---
title: 關於 Tree-View 控制項
description: 樹狀檢視控制項是一種顯示專案階層式清單的視窗，例如檔中的標題、索引中的專案，或磁片上的檔案和目錄。
ms.assetid: 10cc7949-dd77-412d-bad1-db8d8a049582
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: df70a2d3c2f841b022930a07ee2f140ee5bfc8e3
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/21/2020
ms.locfileid: "103933671"
---
# <a name="about-tree-view-controls"></a><span data-ttu-id="1a211-103">關於 Tree-View 控制項</span><span class="sxs-lookup"><span data-stu-id="1a211-103">About Tree-View Controls</span></span>

<span data-ttu-id="1a211-104">樹狀檢視控制項是一種顯示專案階層式清單的視窗，例如檔中的標題、索引中的專案，或磁片上的檔案和目錄。</span><span class="sxs-lookup"><span data-stu-id="1a211-104">A tree-view control is a window that displays a hierarchical list of items, such as the headings in a document, the entries in an index, or the files and directories on a disk.</span></span> <span data-ttu-id="1a211-105">每個項目都包含標籤和選擇性點陣圖影像，因此，每個項目都可以擁有與自己相關的子項目清單。</span><span class="sxs-lookup"><span data-stu-id="1a211-105">Each item consists of a label and an optional bitmapped image, and each item can have a list of subitems associated with it.</span></span> <span data-ttu-id="1a211-106">藉由按一下專案，使用者可以展開或折迭相關聯的子專案清單。</span><span class="sxs-lookup"><span data-stu-id="1a211-106">By clicking an item, the user can expand or collapse the associated list of subitems.</span></span>

<span data-ttu-id="1a211-107">下圖顯示具有根節點、展開節點和折迭節點的簡單樹狀檢視控制項。</span><span class="sxs-lookup"><span data-stu-id="1a211-107">The following illustration shows a simple tree-view control with a root node, an expanded node, and a collapsed node.</span></span> <span data-ttu-id="1a211-108">控制項會針對選取的專案使用一個點陣圖，並針對其他專案使用另一個點陣圖。</span><span class="sxs-lookup"><span data-stu-id="1a211-108">The control uses one bitmap for the selected item and another bitmap for other items.</span></span>

![顯示階層中五個節點的螢幕擷取畫面;系統會選取一個節點的文字，但節點不會依行彼此連結](images/tv-simple.png)

<span data-ttu-id="1a211-110">建立樹狀檢視控制項之後，您可以藉由將訊息傳送至控制項，來加入、移除、排列或其他操作專案。</span><span class="sxs-lookup"><span data-stu-id="1a211-110">After creating a tree-view control, you add, remove, arrange, or otherwise manipulate items by sending messages to the control.</span></span> <span data-ttu-id="1a211-111">每個訊息都有一個或多個您可以使用的對應宏，而不是明確地傳送訊息。</span><span class="sxs-lookup"><span data-stu-id="1a211-111">Each message has one or more corresponding macros that you can use instead of sending the message explicitly.</span></span>

<span data-ttu-id="1a211-112">本節將討論下列主題。</span><span class="sxs-lookup"><span data-stu-id="1a211-112">The following topics are discussed in this section.</span></span>

-   [<span data-ttu-id="1a211-113">樹狀檢視樣式</span><span class="sxs-lookup"><span data-stu-id="1a211-113">Tree-View Styles</span></span>](#tree-view-styles)
-   [<span data-ttu-id="1a211-114">父專案和子專案</span><span class="sxs-lookup"><span data-stu-id="1a211-114">Parent and Child Items</span></span>](#parent-and-child-items)
-   [<span data-ttu-id="1a211-115">專案標籤</span><span class="sxs-lookup"><span data-stu-id="1a211-115">Item Labels</span></span>](#item-labels)
-   [<span data-ttu-id="1a211-116">樹狀檢視標籤編輯</span><span class="sxs-lookup"><span data-stu-id="1a211-116">Tree-View Label Editing</span></span>](#tree-view-label-editing)
-   [<span data-ttu-id="1a211-117">樹狀檢視專案位置</span><span class="sxs-lookup"><span data-stu-id="1a211-117">Tree-View Item Position</span></span>](#tree-view-item-position)
-   [<span data-ttu-id="1a211-118">樹狀檢視專案狀態總覽</span><span class="sxs-lookup"><span data-stu-id="1a211-118">Tree-View Item States Overview</span></span>](#tree-view-item-states-overview)
-   [<span data-ttu-id="1a211-119">專案選取</span><span class="sxs-lookup"><span data-stu-id="1a211-119">Item Selection</span></span>](#item-selection)
-   [<span data-ttu-id="1a211-120">專案資訊</span><span class="sxs-lookup"><span data-stu-id="1a211-120">Item Information</span></span>](#item-information)
-   [<span data-ttu-id="1a211-121">樹狀檢視影像清單</span><span class="sxs-lookup"><span data-stu-id="1a211-121">Tree-View Image Lists</span></span>](#tree-view-image-lists)
-   [<span data-ttu-id="1a211-122">拖放作業</span><span class="sxs-lookup"><span data-stu-id="1a211-122">Drag-and-Drop Operations</span></span>](#drag-and-drop-operations)
-   [<span data-ttu-id="1a211-123">樹狀檢視控制項通知訊息</span><span class="sxs-lookup"><span data-stu-id="1a211-123">Tree-View Control Notification Messages</span></span>](#tree-view-control-notification-messages)
-   [<span data-ttu-id="1a211-124">預設 Tree-View 控制訊息處理</span><span class="sxs-lookup"><span data-stu-id="1a211-124">Default Tree-View Control Message Processing</span></span>](#default-tree-view-control-message-processing)
-   [<span data-ttu-id="1a211-125">相關主題</span><span class="sxs-lookup"><span data-stu-id="1a211-125">Related topics</span></span>](#related-topics)

## <a name="tree-view-styles"></a><span data-ttu-id="1a211-126">Tree-View 樣式</span><span class="sxs-lookup"><span data-stu-id="1a211-126">Tree-View Styles</span></span>

<span data-ttu-id="1a211-127">樹狀檢視樣式會管理樹狀檢視控制面板的各個層面。</span><span class="sxs-lookup"><span data-stu-id="1a211-127">Tree-view styles govern aspects of a tree-view control's appearance.</span></span> <span data-ttu-id="1a211-128">當您建立樹狀檢視控制項時，會設定初始樣式。</span><span class="sxs-lookup"><span data-stu-id="1a211-128">You set the initial styles when you create the tree-view control.</span></span> <span data-ttu-id="1a211-129">您可以使用 [**GetWindowLong**](/windows/desktop/api/winuser/nf-winuser-getwindowlonga) 和 [**SetWindowLong**](/windows/desktop/api/winuser/nf-winuser-setwindowlonga) 函式建立樹狀檢視控制項之後，取得並變更樣式。</span><span class="sxs-lookup"><span data-stu-id="1a211-129">You can retrieve and change the styles after creating the tree-view control by using the [**GetWindowLong**](/windows/desktop/api/winuser/nf-winuser-getwindowlonga) and [**SetWindowLong**](/windows/desktop/api/winuser/nf-winuser-setwindowlonga) functions.</span></span>

<span data-ttu-id="1a211-130">[**電視 \_ HASLINES**](tree-view-control-window-styles.md)樣式會繪製將子專案連結至其父專案的線條，藉以增強樹狀檢視控制項階層的圖形表示，如下圖所示。</span><span class="sxs-lookup"><span data-stu-id="1a211-130">The [**TVS\_HASLINES**](tree-view-control-window-styles.md) style enhances the graphic representation of a tree-view control's hierarchy by drawing lines that link child items to their parent item, as shown in the following illustration.</span></span>

![顯示先前相片順序的螢幕擷取畫面，其中包含加入節點的線條;從根節點遞減的第一行](images/tv-haslines.png)

<span data-ttu-id="1a211-132">這個樣式本身不會在階層的根目錄繪製線條。</span><span class="sxs-lookup"><span data-stu-id="1a211-132">By itself, this style does not draw lines at the root of the hierarchy.</span></span> <span data-ttu-id="1a211-133">若要這樣做，您必須結合 [**電視 \_ HASLINES**](tree-view-control-window-styles.md) 和 [**電視 \_ LINESATROOT**](tree-view-control-window-styles.md) 樣式。</span><span class="sxs-lookup"><span data-stu-id="1a211-133">To do so, you need to combine the [**TVS\_HASLINES**](tree-view-control-window-styles.md) and [**TVS\_LINESATROOT**](tree-view-control-window-styles.md) styles.</span></span> <span data-ttu-id="1a211-134">結果如下圖所示。</span><span class="sxs-lookup"><span data-stu-id="1a211-134">The result is shown in the following illustration.</span></span>

![顯示先前相片順序的螢幕擷取畫面，但開頭為根節點的額外水平線](images/tv-rootlines.png)

<span data-ttu-id="1a211-136">使用者可以按兩下父專案，展開或折迭父項目的子專案清單。</span><span class="sxs-lookup"><span data-stu-id="1a211-136">The user can expand or collapse a parent item's list of child items by double-clicking the parent item.</span></span> <span data-ttu-id="1a211-137">具有 [**電視 \_ HASBUTTONS**](tree-view-control-window-styles.md) 樣式的樹狀檢視控制項會將按鈕加入至每個父專案的左邊。</span><span class="sxs-lookup"><span data-stu-id="1a211-137">A tree-view control that has the [**TVS\_HASBUTTONS**](tree-view-control-window-styles.md) style adds a button to the left side of each parent item.</span></span> <span data-ttu-id="1a211-138">使用者可以按一下按鈕一次，而不是按兩下父元素來展開或折迭子專案。</span><span class="sxs-lookup"><span data-stu-id="1a211-138">The user can click the button once instead of double-clicking the parent item to expand or collapse the child.</span></span> <span data-ttu-id="1a211-139">**電視 \_HASBUTTONS** 不會將按鈕加入至階層根目錄的專案。</span><span class="sxs-lookup"><span data-stu-id="1a211-139">**TVS\_HASBUTTONS** does not add buttons to items at the root of the hierarchy.</span></span> <span data-ttu-id="1a211-140">若要這樣做，您必須結合 [**電視 \_ HASLINES**](tree-view-control-window-styles.md)、 [**電視 \_ LINESATROOT**](tree-view-control-window-styles.md)和 **電視 \_ HASBUTTONS**。</span><span class="sxs-lookup"><span data-stu-id="1a211-140">To do so, you must combine [**TVS\_HASLINES**](tree-view-control-window-styles.md), [**TVS\_LINESATROOT**](tree-view-control-window-styles.md), and **TVS\_HASBUTTONS**.</span></span> <span data-ttu-id="1a211-141">下圖顯示這種樣式的組合。</span><span class="sxs-lookup"><span data-stu-id="1a211-141">This combination of styles is shown in the following illustration.</span></span>

![顯示先前相片順序的螢幕擷取畫面，但在兩行的每個頂點具有展開/折迭按鈕](images/tv-hasbuttons.png)

<span data-ttu-id="1a211-143">[**電視 \_ 核取方塊**](tree-view-control-window-styles.md)樣式會在每個專案旁邊建立核取方塊。</span><span class="sxs-lookup"><span data-stu-id="1a211-143">The [**TVS\_CHECKBOXES**](tree-view-control-window-styles.md) style creates checkboxes next to each item.</span></span> <span data-ttu-id="1a211-144">如果您想要使用核取方塊樣式，必須在建立樹狀檢視控制項之後，以及填入樹狀結構之前，將 **電視 \_ 核取方塊** 樣式 (設定為 [**SetWindowLong**](/windows/desktop/api/winuser/nf-winuser-setwindowlonga)) 。</span><span class="sxs-lookup"><span data-stu-id="1a211-144">If you want to use the checkbox style, you must set the **TVS\_CHECKBOXES** style (with [**SetWindowLong**](/windows/desktop/api/winuser/nf-winuser-setwindowlonga)) after you create the tree-view control and before you populate the tree.</span></span> <span data-ttu-id="1a211-145">否則，視計時問題而定，核取方塊可能會顯示為未選取狀態。</span><span class="sxs-lookup"><span data-stu-id="1a211-145">Otherwise, the checkboxes might appear unchecked, depending on timing issues.</span></span> <span data-ttu-id="1a211-146">下圖顯示覆選框樣式。</span><span class="sxs-lookup"><span data-stu-id="1a211-146">The following illustration shows the checkbox style.</span></span>

![顯示先前相片順序的螢幕擷取畫面，但每個節點旁邊都有一個核取方塊;已選取兩個核取方塊](images/tv-haschecks.png)

<span data-ttu-id="1a211-148">[**電視 \_ FULLROWSELECT**](tree-view-control-window-styles.md)樣式會使選取範圍醒目提示延伸至控制項的全形，而不只是專案本身。</span><span class="sxs-lookup"><span data-stu-id="1a211-148">The [**TVS\_FULLROWSELECT**](tree-view-control-window-styles.md) style causes the selection highlight to extend over the full width of the control, not just over the item itself.</span></span> <span data-ttu-id="1a211-149">下圖顯示此樣式。</span><span class="sxs-lookup"><span data-stu-id="1a211-149">The following illustration shows this style.</span></span>

![顯示五個節點的原始相片順序的螢幕擷取畫面，但選取範圍醒目提示會延伸控制項的全形](images/tv-fullrow.png)

<span data-ttu-id="1a211-151">[**電視 \_ EDITLABELS**](tree-view-control-window-styles.md)樣式讓使用者可以編輯樹狀檢視專案的標籤。</span><span class="sxs-lookup"><span data-stu-id="1a211-151">The [**TVS\_EDITLABELS**](tree-view-control-window-styles.md) style makes it possible for the user to edit the labels of tree-view items.</span></span> <span data-ttu-id="1a211-152">如需編輯標籤的詳細資訊，請參閱 [樹狀檢視標籤編輯](#tree-view-label-editing)。</span><span class="sxs-lookup"><span data-stu-id="1a211-152">For more information about editing labels, see [Tree-View Label Editing](#tree-view-label-editing).</span></span>

<span data-ttu-id="1a211-153">如需這些樣式和其他樣式的詳細資訊，請參閱 [樹狀檢視控制項視窗樣式](tree-view-control-window-styles.md)。</span><span class="sxs-lookup"><span data-stu-id="1a211-153">For more information on these and other styles, see [Tree-View Control Window Styles](tree-view-control-window-styles.md).</span></span>

## <a name="parent-and-child-items"></a><span data-ttu-id="1a211-154">父專案和子專案</span><span class="sxs-lookup"><span data-stu-id="1a211-154">Parent and Child Items</span></span>

<span data-ttu-id="1a211-155">樹狀檢視控制項中的任何專案都可以有相關聯的子專案清單，稱為 *子專案*。</span><span class="sxs-lookup"><span data-stu-id="1a211-155">Any item in a tree-view control can have a list of subitems—called *child items*—associated with it.</span></span> <span data-ttu-id="1a211-156">具有一個或多個子專案的專案稱為 *父專案*。</span><span class="sxs-lookup"><span data-stu-id="1a211-156">An item that has one or more child items is called a *parent item*.</span></span> <span data-ttu-id="1a211-157">子專案會顯示在其父項目下方，並縮排以表示它是父系的從屬專案。</span><span class="sxs-lookup"><span data-stu-id="1a211-157">A child item is displayed below its parent item and is indented to indicate that it is subordinate to the parent.</span></span> <span data-ttu-id="1a211-158">沒有父代的專案會出現在階層的頂端，並稱為 *根專案*。</span><span class="sxs-lookup"><span data-stu-id="1a211-158">An item that has no parent appears at the top of the hierarchy and is called a *root item*.</span></span>

<span data-ttu-id="1a211-159">若要將專案加入至樹狀檢視控制項，請將 [**TVM \_ INSERTITEM**](tvm-insertitem.md) 訊息傳送至控制項。</span><span class="sxs-lookup"><span data-stu-id="1a211-159">To add an item to a tree-view control, send the [**TVM\_INSERTITEM**](tvm-insertitem.md) message to the control.</span></span> <span data-ttu-id="1a211-160">訊息會傳回 HTREEITEM 類型的控制碼，可唯一識別該專案。</span><span class="sxs-lookup"><span data-stu-id="1a211-160">The message returns a handle to the HTREEITEM type, which uniquely identifies the item.</span></span> <span data-ttu-id="1a211-161">加入專案時，您必須指定新專案的父專案的控制碼。</span><span class="sxs-lookup"><span data-stu-id="1a211-161">When adding an item, you must specify the handle to the new item's parent item.</span></span> <span data-ttu-id="1a211-162">如果您在 TVINSERTSTRUCT 結構中指定 **Null** 或 TVI \_ 根目錄值，而不是父 [](/windows/win32/api/commctrl/ns-commctrl-tvinsertstructa)專案控制碼，則會將專案新增為根專案。</span><span class="sxs-lookup"><span data-stu-id="1a211-162">If you specify **NULL** or the TVI\_ROOT value instead of a parent item handle in the [**TVINSERTSTRUCT**](/windows/win32/api/commctrl/ns-commctrl-tvinsertstructa) structure, the item is added as a root item.</span></span>

<span data-ttu-id="1a211-163">在任何指定時間內，父項目的子項目清單狀態可以是展開或摺疊。</span><span class="sxs-lookup"><span data-stu-id="1a211-163">At any given time, the state of a parent item's list of child items can be either expanded or collapsed.</span></span> <span data-ttu-id="1a211-164">當其狀態為展開時，表示子項目會顯示在父項目下方。</span><span class="sxs-lookup"><span data-stu-id="1a211-164">When the state is expanded, the child items are displayed below the parent item.</span></span> <span data-ttu-id="1a211-165">當它摺疊時，則不會顯示子項目。</span><span class="sxs-lookup"><span data-stu-id="1a211-165">When it is collapsed, the child items are not displayed.</span></span> <span data-ttu-id="1a211-166">當使用者按下父專案時，當使用者按兩下父專案時，清單會自動在展開和折迭狀態之間切換，或者，如果父系具有 [**電視 \_ HASBUTTONS**](tree-view-control-window-styles.md) 樣式，則當使用者按一下與父專案相關聯的按鈕時。</span><span class="sxs-lookup"><span data-stu-id="1a211-166">The list automatically toggles between the expanded and collapsed states when the user double-clicks the parent item or, if the parent has the [**TVS\_HASBUTTONS**](tree-view-control-window-styles.md) style, when the user clicks the button associated with the parent item.</span></span> <span data-ttu-id="1a211-167">應用程式可以使用 [**TVM \_ 展開**](tvm-expand.md) 訊息來展開或折迭子專案。</span><span class="sxs-lookup"><span data-stu-id="1a211-167">An application can expand or collapse the child items by using the [**TVM\_EXPAND**](tvm-expand.md) message.</span></span>

<span data-ttu-id="1a211-168">當父專案的子專案清單即將展開或折迭時，樹狀檢視控制項會傳送 [izdebski \_ ITEMEXPANDING](tvn-itemexpanding.md) 通知訊息給父視窗。</span><span class="sxs-lookup"><span data-stu-id="1a211-168">A tree-view control sends the parent window a [TVN\_ITEMEXPANDING](tvn-itemexpanding.md) notification message when a parent item's list of child items is about to be expanded or collapsed.</span></span> <span data-ttu-id="1a211-169">通知會讓應用程式有機會防止變更，或設定相依于子專案清單狀態的父項目的任何屬性。</span><span class="sxs-lookup"><span data-stu-id="1a211-169">The notification gives an application the opportunity to prevent the change or to set any attributes of the parent item that depend on the state of the list of child items.</span></span> <span data-ttu-id="1a211-170">變更清單的狀態之後，樹狀檢視控制項會將 [izdebski \_ ITEMEXPANDED](tvn-itemexpanded.md) 通知訊息傳送至父視窗。</span><span class="sxs-lookup"><span data-stu-id="1a211-170">After changing the state of the list, the tree-view control sends the parent window a [TVN\_ITEMEXPANDED](tvn-itemexpanded.md) notification message.</span></span>

<span data-ttu-id="1a211-171">當子項目清單展開時，它會以相對於父項目的位置進行縮排。</span><span class="sxs-lookup"><span data-stu-id="1a211-171">When a list of child items is expanded, it is indented relative to the parent item.</span></span> <span data-ttu-id="1a211-172">您可以使用 [**TVM \_ SETINDENT**](tvm-setindent.md) 訊息來設定縮排的數量，或使用 [**TVM \_ setindent**](tvm-getindent.md) 訊息來取得目前的金額。</span><span class="sxs-lookup"><span data-stu-id="1a211-172">You can set the amount of indentation by using the [**TVM\_SETINDENT**](tvm-setindent.md) message or retrieve the current amount by using the [**TVM\_GETINDENT**](tvm-getindent.md) message.</span></span>

<span data-ttu-id="1a211-173">樹狀檢視控制項會使用從建立樹狀檢視控制項的進程堆積所配置的記憶體。</span><span class="sxs-lookup"><span data-stu-id="1a211-173">A tree-view control uses memory allocated from the heap of the process that creates the tree-view control.</span></span> <span data-ttu-id="1a211-174">樹狀檢視中的專案數目上限是以堆積中可用的記憶體數量為基礎。</span><span class="sxs-lookup"><span data-stu-id="1a211-174">The maximum number of items in a tree view is based on the amount of memory available in the heap.</span></span>

## <a name="item-labels"></a><span data-ttu-id="1a211-175">專案標籤</span><span class="sxs-lookup"><span data-stu-id="1a211-175">Item Labels</span></span>

<span data-ttu-id="1a211-176">當您將專案加入至樹狀檢視控制項時，通常會指定專案標籤的文字。</span><span class="sxs-lookup"><span data-stu-id="1a211-176">You typically specify the text of an item's label when adding the item to the tree-view control.</span></span> <span data-ttu-id="1a211-177">[**TVM \_ INSERTITEM**](tvm-insertitem.md)訊息包含定義專案屬性的 [**TVITEM**](/windows/win32/api/commctrl/ns-commctrl-tvitema)結構，包括包含標籤文字的字串。</span><span class="sxs-lookup"><span data-stu-id="1a211-177">The [**TVM\_INSERTITEM**](tvm-insertitem.md) message includes a [**TVITEM**](/windows/win32/api/commctrl/ns-commctrl-tvitema) structure that defines the item's properties, including a string containing the text of the label.</span></span>

<span data-ttu-id="1a211-178">樹狀檢視控制項會配置儲存每個專案的記憶體;專案標籤的文字會佔用此記憶體的重要部分。</span><span class="sxs-lookup"><span data-stu-id="1a211-178">A tree-view control allocates memory for storing each item; the text of the item labels takes up a significant portion of this memory.</span></span> <span data-ttu-id="1a211-179">如果您的應用程式在樹狀檢視控制項中維護字串的複本，您可以 \_ 在 [**TVITEM**](/windows/win32/api/commctrl/ns-commctrl-tvitema)的 **PSZTEXT** 成員中指定 LPSTR TEXTCALLBACK 值，而不是將實際字串傳遞至樹狀檢視，藉以減少控制項的記憶體需求。</span><span class="sxs-lookup"><span data-stu-id="1a211-179">If your application maintains a copy of the strings in the tree-view control, you can decrease the memory requirements of the control by specifying the LPSTR\_TEXTCALLBACK value in the **pszText** member of [**TVITEM**](/windows/win32/api/commctrl/ns-commctrl-tvitema) instead of passing actual strings to the tree view.</span></span> <span data-ttu-id="1a211-180">使用 LPSTR \_ TEXTCALLBACK 會讓樹狀檢視控制項在每次需要重新繪製專案時，從父視窗取出專案標籤的文字。</span><span class="sxs-lookup"><span data-stu-id="1a211-180">Using LPSTR\_TEXTCALLBACK causes the tree-view control to retrieve the text of an item's label from the parent window whenever the item needs to be redrawn.</span></span> <span data-ttu-id="1a211-181">若要取出文字，樹狀檢視控制項會傳送 [izdebski \_ GETDISPINFO](tvn-getdispinfo.md) 通知訊息，其中包含 [**NMTVDISPINFO**](/windows/win32/api/commctrl/ns-commctrl-nmtvdispinfoa) 結構的位址。</span><span class="sxs-lookup"><span data-stu-id="1a211-181">To retrieve the text, the tree-view control sends a [TVN\_GETDISPINFO](tvn-getdispinfo.md) notification message, which includes the address of an [**NMTVDISPINFO**](/windows/win32/api/commctrl/ns-commctrl-nmtvdispinfoa) structure.</span></span> <span data-ttu-id="1a211-182">父視窗必須填滿包含結構的適當成員。</span><span class="sxs-lookup"><span data-stu-id="1a211-182">The parent window must fill the appropriate members of the included structure.</span></span>

## <a name="tree-view-label-editing"></a><span data-ttu-id="1a211-183">Tree-View 標籤編輯</span><span class="sxs-lookup"><span data-stu-id="1a211-183">Tree-View Label Editing</span></span>

<span data-ttu-id="1a211-184">使用者可以直接編輯具有 [**電視 \_ EDITLABELS**](tree-view-control-window-styles.md) 樣式之樹狀檢視控制項中的專案標籤。</span><span class="sxs-lookup"><span data-stu-id="1a211-184">The user can directly edit the labels of items in a tree-view control that has the [**TVS\_EDITLABELS**](tree-view-control-window-styles.md) style.</span></span> <span data-ttu-id="1a211-185">按一下具有焦點的項目標籤，使用者就可以開始進行編輯。</span><span class="sxs-lookup"><span data-stu-id="1a211-185">The user begins editing by clicking the label of the item that has the focus.</span></span> <span data-ttu-id="1a211-186">應用程式會使用 [**TVM \_ EDITLABEL**](tvm-editlabel.md) 訊息開始編輯。</span><span class="sxs-lookup"><span data-stu-id="1a211-186">An application begins editing by using the [**TVM\_EDITLABEL**](tvm-editlabel.md) message.</span></span> <span data-ttu-id="1a211-187">當編輯開始時，以及取消或完成時，樹狀檢視控制項會通知父視窗。</span><span class="sxs-lookup"><span data-stu-id="1a211-187">The tree-view control notifies the parent window when editing begins and when it is canceled or completed.</span></span> <span data-ttu-id="1a211-188">編輯完成時，父視窗會負責更新專案的標籤（如果有的話）。</span><span class="sxs-lookup"><span data-stu-id="1a211-188">When editing is completed, the parent window is responsible for updating the item's label, if appropriate.</span></span>

<span data-ttu-id="1a211-189">當標籤編輯開始時，樹狀檢視控制項會將 [izdebski \_ BEGINLABELEDIT](tvn-beginlabeledit.md) 通知訊息傳送至父視窗。</span><span class="sxs-lookup"><span data-stu-id="1a211-189">When label editing begins, a tree-view control sends its parent window a [TVN\_BEGINLABELEDIT](tvn-beginlabeledit.md) notification message.</span></span> <span data-ttu-id="1a211-190">藉由處理此通知，應用程式可以允許編輯某些標籤，並防止編輯其他標籤。</span><span class="sxs-lookup"><span data-stu-id="1a211-190">By processing this notification, an application can allow editing of some labels and prevent editing of others.</span></span> <span data-ttu-id="1a211-191">傳回零可進行編輯，並傳回非零值。</span><span class="sxs-lookup"><span data-stu-id="1a211-191">Returning zero allows editing, and returning nonzero prevents it.</span></span>

<span data-ttu-id="1a211-192">當標籤編輯遭到取消或完成時，樹狀檢視控制項會將 [izdebski \_ ENDLABELEDIT](tvn-endlabeledit.md) 通知訊息傳送至其父視窗。</span><span class="sxs-lookup"><span data-stu-id="1a211-192">When label editing is canceled or completed, a tree-view control sends its parent window a [TVN\_ENDLABELEDIT](tvn-endlabeledit.md) notification message.</span></span> <span data-ttu-id="1a211-193">*LParam* 參數是 [**NMTVDISPINFO**](/windows/win32/api/commctrl/ns-commctrl-nmtvdispinfoa)結構的位址。</span><span class="sxs-lookup"><span data-stu-id="1a211-193">The *lParam* parameter is the address of an [**NMTVDISPINFO**](/windows/win32/api/commctrl/ns-commctrl-nmtvdispinfoa) structure.</span></span> <span data-ttu-id="1a211-194">*Item* 參數是一種 [**TVITEM**](/windows/win32/api/commctrl/ns-commctrl-tvitema)結構，用來識別專案並包含已編輯的文字。</span><span class="sxs-lookup"><span data-stu-id="1a211-194">The *item* parameter is a [**TVITEM**](/windows/win32/api/commctrl/ns-commctrl-tvitema) structure that identifies the item and includes the edited text.</span></span> <span data-ttu-id="1a211-195">如果要保留新的標籤，父視窗會負責更新專案的標籤。</span><span class="sxs-lookup"><span data-stu-id="1a211-195">The parent window is responsible for updating the item's label if it wishes to keep the new label.</span></span> <span data-ttu-id="1a211-196">如果取消編輯，則 **TVITEM** 的 **pszText** 成員為零。</span><span class="sxs-lookup"><span data-stu-id="1a211-196">The **pszText** member of **TVITEM** is zero if editing is canceled.</span></span>

<span data-ttu-id="1a211-197">在標籤編輯期間（通常是為了回應 [izdebski \_ BEGINLABELEDIT](tvn-beginlabeledit.md) 通知訊息），您可以使用 [**TVM \_ GETEDITCONTROL**](tvm-geteditcontrol.md) 訊息來取得編輯標籤所使用之編輯控制項的控制碼。</span><span class="sxs-lookup"><span data-stu-id="1a211-197">During label editing, typically in response to the [TVN\_BEGINLABELEDIT](tvn-beginlabeledit.md) notification message, you can retrieve the handle to the edit control used for label editing by using the [**TVM\_GETEDITCONTROL**](tvm-geteditcontrol.md) message.</span></span> <span data-ttu-id="1a211-198">您可以傳送 [**EM \_ SETLIMITTEXT**](em-setlimittext.md) 訊息給編輯控制項，以限制使用者可以輸入或子類別化編輯控制項來攔截和捨棄無效字元的文字數量。</span><span class="sxs-lookup"><span data-stu-id="1a211-198">You can send the edit control an [**EM\_SETLIMITTEXT**](em-setlimittext.md) message to limit the amount of text a user can enter or subclass the edit control to intercept and discard invalid characters.</span></span> <span data-ttu-id="1a211-199">不過請注意，只有 *在*   傳送 izdebski BEGINLABELEDIT 之後，才會顯示編輯控制項 \_ 。</span><span class="sxs-lookup"><span data-stu-id="1a211-199">Note, however, that the edit control is displayed only *after* TVN\_BEGINLABELEDIT is sent.</span></span>

## <a name="tree-view-item-position"></a><span data-ttu-id="1a211-200">Tree-View 專案位置</span><span class="sxs-lookup"><span data-stu-id="1a211-200">Tree-View Item Position</span></span>

<span data-ttu-id="1a211-201">使用 [**TVM \_ INSERTITEM**](tvm-insertitem.md) 訊息將專案加入至樹狀檢視控制項時，會設定專案的初始位置。</span><span class="sxs-lookup"><span data-stu-id="1a211-201">An item's initial position is set when the item is added to the tree-view control by using the [**TVM\_INSERTITEM**](tvm-insertitem.md) message.</span></span> <span data-ttu-id="1a211-202">此訊息包含 [**TVINSERTSTRUCT**](/windows/win32/api/commctrl/ns-commctrl-tvinsertstructa) 結構，可指定父代專案的控制碼，以及要插入新專案的專案控制碼。</span><span class="sxs-lookup"><span data-stu-id="1a211-202">The message includes a [**TVINSERTSTRUCT**](/windows/win32/api/commctrl/ns-commctrl-tvinsertstructa) structure that specifies the handle to the parent item and the handle to the item after which the new item is to be inserted.</span></span> <span data-ttu-id="1a211-203">第二個控制碼必須識別指定父系或其中一個值的子專案： TVI \_ FIRST、TVI \_ LAST 或 TVI \_ SORT。</span><span class="sxs-lookup"><span data-stu-id="1a211-203">The second handle must identify either a child item of the given parent or one of these values: TVI\_FIRST, TVI\_LAST, or TVI\_SORT.</span></span>

<span data-ttu-id="1a211-204">當 \_ 指定 TVI FIRST 或 TVI \_ LAST 時，樹狀檢視控制項會將新專案放在指定父專案的子專案清單的開頭或結尾。</span><span class="sxs-lookup"><span data-stu-id="1a211-204">When TVI\_FIRST or TVI\_LAST is specified, the tree-view control places the new item at the beginning or end of the given parent item's list of child items.</span></span> <span data-ttu-id="1a211-205">當 \_ 指定 TVI SORT 時，樹狀檢視控制項會根據專案標籤的文字，以字母順序將新專案插入子專案清單。</span><span class="sxs-lookup"><span data-stu-id="1a211-205">When TVI\_SORT is specified, the tree-view control inserts the new item into the list of child items in alphabetical order based on the text of the item labels.</span></span>

<span data-ttu-id="1a211-206">您可以使用 [**TVM \_ SORTCHILDREN**](tvm-sortchildren.md) 訊息，以字母順序將父項目的子專案清單放在一起。</span><span class="sxs-lookup"><span data-stu-id="1a211-206">You can put a parent item's list of child items in alphabetical order by using the [**TVM\_SORTCHILDREN**](tvm-sortchildren.md) message.</span></span> <span data-ttu-id="1a211-207">訊息包含參數，這個參數會指定是否也要依字母順序排序從指定的父專案遞減的所有子專案層級。</span><span class="sxs-lookup"><span data-stu-id="1a211-207">The message includes a parameter that specifies whether all levels of child items descending from the given parent item are also sorted in alphabetical order.</span></span>

<span data-ttu-id="1a211-208">[**TVM \_ SORTCHILDRENCB**](tvm-sortchildrencb.md)訊息可讓您根據所定義的準則來排序子專案。</span><span class="sxs-lookup"><span data-stu-id="1a211-208">The [**TVM\_SORTCHILDRENCB**](tvm-sortchildrencb.md) message allows you to sort child items based on criteria that you define.</span></span> <span data-ttu-id="1a211-209">當您使用這個訊息時，您會指定一個應用程式定義的回呼函式，讓樹狀檢視控制項可以在每次需要決定兩個子專案的相對順序時呼叫。</span><span class="sxs-lookup"><span data-stu-id="1a211-209">When you use this message, you specify an application-defined callback function that the tree-view control can call whenever the relative order of two child items needs to be decided.</span></span> <span data-ttu-id="1a211-210">回呼函數會針對要比較的專案，以及您在傳送 **TVM \_ SORTCHILDRENCB** 時指定的第三個32位值，接收 2 32 位應用程式定義的值。</span><span class="sxs-lookup"><span data-stu-id="1a211-210">The callback function receives two 32-bit application-defined values for the items being compared and a third 32-bit value that you specify when sending **TVM\_SORTCHILDRENCB**.</span></span>

## <a name="tree-view-item-states-overview"></a><span data-ttu-id="1a211-211">Tree-View 專案狀態總覽</span><span class="sxs-lookup"><span data-stu-id="1a211-211">Tree-View Item States Overview</span></span>

<span data-ttu-id="1a211-212">樹狀檢視控制項中的每個專案都有目前的狀態。</span><span class="sxs-lookup"><span data-stu-id="1a211-212">Each item in a tree-view control has a current state.</span></span> <span data-ttu-id="1a211-213">每個專案的狀態資訊都包含一組位旗標，以及表示專案狀態影像和重迭影像的影像清單索引。</span><span class="sxs-lookup"><span data-stu-id="1a211-213">The state information for each item includes a set of bit flags as well as image list indexes that indicate the item's state image and overlay image.</span></span> <span data-ttu-id="1a211-214">位旗標會指出專案為已選取、已停用、已展開等等。</span><span class="sxs-lookup"><span data-stu-id="1a211-214">The bit flags indicate whether the item is selected, disabled, expanded, and so on.</span></span> <span data-ttu-id="1a211-215">在大部分的情況下，樹狀檢視控制項會自動設定專案的狀態以反映使用者動作，例如專案的選取專案。</span><span class="sxs-lookup"><span data-stu-id="1a211-215">For the most part, a tree-view control automatically sets an item's state to reflect user actions, such as selection of an item.</span></span> <span data-ttu-id="1a211-216">不過，您也可以使用 [**TVM \_ SETITEM**](tvm-setitem.md) 訊息來設定專案的狀態，而且您可以使用 [**TVM \_ GETITEM**](tvm-getitem.md) 訊息來取得專案的目前狀態。</span><span class="sxs-lookup"><span data-stu-id="1a211-216">However, you can also set an item's state by using the [**TVM\_SETITEM**](tvm-setitem.md) message, and you can retrieve the current state of an item by using the [**TVM\_GETITEM**](tvm-getitem.md) message.</span></span> <span data-ttu-id="1a211-217">如需專案狀態的完整清單，請參閱 [樹狀檢視控制項專案狀態](tree-view-control-item-states.md)。</span><span class="sxs-lookup"><span data-stu-id="1a211-217">For a complete list of item states, see [Tree-View Control Item States](tree-view-control-item-states.md).</span></span>

<span data-ttu-id="1a211-218">專案的目前狀態是由 [**TVITEM**](/windows/win32/api/commctrl/ns-commctrl-tvitema)結構的 **state** 成員所指定。</span><span class="sxs-lookup"><span data-stu-id="1a211-218">An item's current state is specified by the **state** member of the [**TVITEM**](/windows/win32/api/commctrl/ns-commctrl-tvitema) structure.</span></span> <span data-ttu-id="1a211-219">樹狀檢視控制項可能會變更專案的狀態，以反映使用者動作，例如選取專案或將焦點設定至專案。</span><span class="sxs-lookup"><span data-stu-id="1a211-219">A tree-view control might change an item's state to reflect a user action, such as selecting the item or setting the focus to the item.</span></span> <span data-ttu-id="1a211-220">此外，應用程式可變更項目的狀態以停用或隱藏項目，或指定重疊影像或狀態影像。</span><span class="sxs-lookup"><span data-stu-id="1a211-220">In addition, an application might change an item's state to disable or hide the item or to specify an overlay image or state image.</span></span>

<span data-ttu-id="1a211-221">當您指定或變更專案的狀態時， [**TVITEM**](/windows/win32/api/commctrl/ns-commctrl-tvitema)的 **statemask** 成員會指定要設定的狀態位，而且 **狀態** 成員會包含這些位的新值。</span><span class="sxs-lookup"><span data-stu-id="1a211-221">When you specify or change an item's state, the **statemask** member of [**TVITEM**](/windows/win32/api/commctrl/ns-commctrl-tvitema) specifies which state bits to set, and the **state** member contains the new values for those bits.</span></span>

<span data-ttu-id="1a211-222">若要設定專案的重迭影像， **statemask** 必須包含 [**TVIS \_ OVERLAYMASK**](tree-view-control-item-states.md) 值，且 **狀態** 必須包含覆迭影像的以一為起始的索引，而這是使用 [**INDEXTOOVERLAYMASK**](/windows/desktop/api/Commctrl/nf-commctrl-indextooverlaymask) 宏來向左移動8位的重迭影像。</span><span class="sxs-lookup"><span data-stu-id="1a211-222">To set an item's overlay image, **statemask** must include the [**TVIS\_OVERLAYMASK**](tree-view-control-item-states.md) value, and **state** must include the one-based index of the overlay image shifted left 8 bits by using the [**INDEXTOOVERLAYMASK**](/windows/desktop/api/Commctrl/nf-commctrl-indextooverlaymask) macro.</span></span> <span data-ttu-id="1a211-223">索引可以是零，以指定無重迭影像。</span><span class="sxs-lookup"><span data-stu-id="1a211-223">The index can be zero to specify no overlay image.</span></span>

<span data-ttu-id="1a211-224">狀態影像會顯示在專案的圖示旁邊，以指出應用程式定義的狀態。</span><span class="sxs-lookup"><span data-stu-id="1a211-224">A state image is displayed next to an item's icon to indicate an application-defined state.</span></span> <span data-ttu-id="1a211-225">狀態影像包含在透過傳送 [**TVM \_ SETIMAGELIST**](tvm-setimagelist.md)訊息所指定的 *狀態影像清單* 中。</span><span class="sxs-lookup"><span data-stu-id="1a211-225">State images are contained in a *state image list* that is specified by sending a [**TVM\_SETIMAGELIST**](tvm-setimagelist.md) message.</span></span> <span data-ttu-id="1a211-226">若要設定專案的狀態影像，請在 [**TVITEM**](/windows/win32/api/commctrl/ns-commctrl-tvitema)結構的 **statemask** 成員中包含 [**TVIS \_ STATEIMAGEMASK**](tree-view-control-item-states.md)值。</span><span class="sxs-lookup"><span data-stu-id="1a211-226">To set an item's state image, include the [**TVIS\_STATEIMAGEMASK**](tree-view-control-item-states.md) value in the **statemask** member of the [**TVITEM**](/windows/win32/api/commctrl/ns-commctrl-tvitema) structure.</span></span> <span data-ttu-id="1a211-227">結構 **狀態** 成員的位12到15會在要繪製之影像的狀態影像清單中指定索引。</span><span class="sxs-lookup"><span data-stu-id="1a211-227">Bits 12 through 15 of the structure's **state** member specify the index in the state image list of the image to be drawn.</span></span>

<span data-ttu-id="1a211-228">若要設定狀態影像索引，請使用 [**INDEXTOSTATEIMAGEMASK**](/windows/desktop/api/Commctrl/nf-commctrl-indextostateimagemask)。</span><span class="sxs-lookup"><span data-stu-id="1a211-228">To set the state image index, use [**INDEXTOSTATEIMAGEMASK**](/windows/desktop/api/Commctrl/nf-commctrl-indextostateimagemask).</span></span> <span data-ttu-id="1a211-229">此宏會接受索引，並適當地設定位12到15。</span><span class="sxs-lookup"><span data-stu-id="1a211-229">This macro takes an index, and sets bits 12 through 15 appropriately.</span></span> <span data-ttu-id="1a211-230">若要指出專案沒有狀態影像，請將索引設定為零。</span><span class="sxs-lookup"><span data-stu-id="1a211-230">To indicate that the item has no state image, set the index to zero.</span></span> <span data-ttu-id="1a211-231">這個慣例表示狀態影像清單中的影像零無法用作狀態影像。</span><span class="sxs-lookup"><span data-stu-id="1a211-231">This convention means that image zero in the state image list cannot be used as a state image.</span></span> <span data-ttu-id="1a211-232">若要隔離 **狀態** 成員的位12到15，請使用 [**TVIS \_ STATEIMAGEMASK**](tree-view-control-item-states.md) mask。</span><span class="sxs-lookup"><span data-stu-id="1a211-232">To isolate bits 12 through 15 of the **state** member, use the [**TVIS\_STATEIMAGEMASK**](tree-view-control-item-states.md) mask.</span></span> <span data-ttu-id="1a211-233">如需覆迭和狀態影像的詳細資訊，請參閱 [樹狀檢視影像清單](#tree-view-image-lists)。</span><span class="sxs-lookup"><span data-stu-id="1a211-233">For more information about overlay and state images, see [Tree-View Image Lists](#tree-view-image-lists).</span></span>

## <a name="item-selection"></a><span data-ttu-id="1a211-234">專案選取</span><span class="sxs-lookup"><span data-stu-id="1a211-234">Item Selection</span></span>

<span data-ttu-id="1a211-235">樹狀檢視控制項會在選取專案從某個專案變更為另一個專案時，藉由傳送 [izdebski \_ SELCHANGING](tvn-selchanging.md) 和 [izdebski \_ SELCHANGED](tvn-selchanged.md) 通知訊息，來通知父視窗。</span><span class="sxs-lookup"><span data-stu-id="1a211-235">A tree-view control notifies the parent window when the selection changes from one item to another by sending the [TVN\_SELCHANGING](tvn-selchanging.md) and [TVN\_SELCHANGED](tvn-selchanged.md) notification messages.</span></span> <span data-ttu-id="1a211-236">兩個通知均包含一個值，該值指定變更為按一下滑鼠或是按下按鍵的結果。</span><span class="sxs-lookup"><span data-stu-id="1a211-236">Both notifications include a value that specifies whether the change is the result of a mouse click or a keystroke.</span></span> <span data-ttu-id="1a211-237">通知還包含取得選取範圍的項目和遺失選取範圍的項目的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="1a211-237">The notifications also include information about the item that is gaining the selection and the item that is losing the selection.</span></span> <span data-ttu-id="1a211-238">您可以使用這項資訊來設定項目屬性，而其屬性則視項目的選取狀態而定。</span><span class="sxs-lookup"><span data-stu-id="1a211-238">You can use this information to set item attributes that depend on the selection state of the item.</span></span> <span data-ttu-id="1a211-239">傳回 **TRUE** 以回應 izdebski \_ SELCHANGING 會防止選取範圍變更，而傳回 **FALSE** 則會允許變更。</span><span class="sxs-lookup"><span data-stu-id="1a211-239">Returning **TRUE** in response to TVN\_SELCHANGING prevents the selection from changing, and returning **FALSE** allows the change.</span></span>

<span data-ttu-id="1a211-240">應用程式可以藉由傳送 [**TVM \_ SELECTITEM**](tvm-selectitem.md) 訊息來變更選取專案。</span><span class="sxs-lookup"><span data-stu-id="1a211-240">An application can change the selection by sending the [**TVM\_SELECTITEM**](tvm-selectitem.md) message.</span></span>

## <a name="item-information"></a><span data-ttu-id="1a211-241">專案資訊</span><span class="sxs-lookup"><span data-stu-id="1a211-241">Item Information</span></span>

<span data-ttu-id="1a211-242">樹狀檢視控制項支援許多訊息，這些訊息會抓取控制項中專案的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="1a211-242">Tree-view controls support a number of messages that retrieve information about items in the control.</span></span>

<span data-ttu-id="1a211-243">[**TVM \_ GETITEM**](tvm-getitem.md)訊息可以取出專案的控制碼和屬性。</span><span class="sxs-lookup"><span data-stu-id="1a211-243">The [**TVM\_GETITEM**](tvm-getitem.md) message can retrieve an item's handle and attributes.</span></span> <span data-ttu-id="1a211-244">專案的屬性包括其目前狀態、專案的已選取專案影像清單中的索引，以及 nonselected 的點陣圖影像、指出專案是否有子專案的旗標、專案標籤字串的位址，以及專案的應用程式定義32位值。</span><span class="sxs-lookup"><span data-stu-id="1a211-244">An item's attributes include its current state, the indexes in the control's image list of the item's selected and nonselected bitmapped images, a flag that indicates whether the item has child items, the address of the item's label string, and the item's application-defined 32-bit value.</span></span>

<span data-ttu-id="1a211-245">[**TVM \_ GETNEXTITEM**](tvm-getnextitem.md)訊息會抓取具有目前專案之指定關聯性的樹狀檢視專案。</span><span class="sxs-lookup"><span data-stu-id="1a211-245">The [**TVM\_GETNEXTITEM**](tvm-getnextitem.md) message retrieves the tree-view item that bears the specified relationship to the current item.</span></span> <span data-ttu-id="1a211-246">訊息可以抓取專案的父系、下一個或上一個可見的專案、第一個子專案，依此類推。</span><span class="sxs-lookup"><span data-stu-id="1a211-246">The message can retrieve an item's parent, the next or previous visible item, the first child item, and so on.</span></span>

<span data-ttu-id="1a211-247">[**TVM \_ GETITEMRECT**](tvm-getitemrect.md)訊息會抓取樹狀檢視專案的周框。</span><span class="sxs-lookup"><span data-stu-id="1a211-247">The [**TVM\_GETITEMRECT**](tvm-getitemrect.md) message retrieves the bounding rectangle for a tree-view item.</span></span> <span data-ttu-id="1a211-248">[**TVM \_ GETCOUNT**](tvm-getcount.md)和 [**TVM \_ GETVISIBLECOUNT**](tvm-getvisiblecount.md)訊息會取出樹狀檢視控制項中的專案計數，以及可以在樹狀檢視控制項視窗中完整顯示的專案計數。</span><span class="sxs-lookup"><span data-stu-id="1a211-248">The [**TVM\_GETCOUNT**](tvm-getcount.md) and [**TVM\_GETVISIBLECOUNT**](tvm-getvisiblecount.md) messages retrieve a count of the items in a tree-view control and a count of the items that can be fully visible in the tree-view control's window, respectively.</span></span> <span data-ttu-id="1a211-249">您可以使用 [**TVM \_ ENSUREVISIBLE**](tvm-ensurevisible.md) 訊息，確保可以看見特定的專案。</span><span class="sxs-lookup"><span data-stu-id="1a211-249">You can ensure that a particular item is visible by using the [**TVM\_ENSUREVISIBLE**](tvm-ensurevisible.md) message.</span></span>

## <a name="tree-view-image-lists"></a><span data-ttu-id="1a211-250">Tree-View 影像清單</span><span class="sxs-lookup"><span data-stu-id="1a211-250">Tree-View Image Lists</span></span>

<span data-ttu-id="1a211-251">樹狀檢視控制項中的每個專案都可以有四個相關聯的點陣圖影像。</span><span class="sxs-lookup"><span data-stu-id="1a211-251">Each item in a tree-view control can have four bitmapped images associated with it.</span></span>

-   <span data-ttu-id="1a211-252">選取專案時所顯示的影像，例如開啟的資料夾。</span><span class="sxs-lookup"><span data-stu-id="1a211-252">An image, such as an open folder, displayed when the item is selected.</span></span>
-   <span data-ttu-id="1a211-253">未選取專案時，顯示的影像（例如關閉的資料夾）。</span><span class="sxs-lookup"><span data-stu-id="1a211-253">An image, such as a closed folder, displayed when the item is not selected.</span></span>
-   <span data-ttu-id="1a211-254">以透明方式在選取的或 nonselected 的影像上繪製的重迭影像。</span><span class="sxs-lookup"><span data-stu-id="1a211-254">An overlay image that is drawn transparently over the selected or nonselected image.</span></span>
-   <span data-ttu-id="1a211-255">狀態影像，這是顯示在所選或 nonselected 影像左邊的額外影像。</span><span class="sxs-lookup"><span data-stu-id="1a211-255">A state image, which is an additional image displayed to the left of the selected or nonselected image.</span></span> <span data-ttu-id="1a211-256">您可以使用狀態影像（例如核取和清除的核取方塊）來表示應用程式定義的專案狀態。</span><span class="sxs-lookup"><span data-stu-id="1a211-256">You can use state images, such as checked and cleared check boxes, to indicate application-defined item states.</span></span>

<span data-ttu-id="1a211-257">根據預設，樹狀檢視控制項不會顯示專案影像。</span><span class="sxs-lookup"><span data-stu-id="1a211-257">By default, a tree-view control does not display item images.</span></span> <span data-ttu-id="1a211-258">若要顯示專案影像，您必須建立影像清單，並將它們與控制項建立關聯。</span><span class="sxs-lookup"><span data-stu-id="1a211-258">To display item images, you must create image lists and associate them with the control.</span></span> <span data-ttu-id="1a211-259">如需影像清單的詳細資訊，請參閱 [影像清單](image-lists.md)。</span><span class="sxs-lookup"><span data-stu-id="1a211-259">For more information about image lists, see [Image Lists](image-lists.md).</span></span>

<span data-ttu-id="1a211-260">樹狀檢視控制項可以有兩個影像清單：一般影像清單和狀態影像清單。</span><span class="sxs-lookup"><span data-stu-id="1a211-260">A tree-view control can have two image lists: a normal image list and a state image list.</span></span> <span data-ttu-id="1a211-261">一般影像清單會儲存選取的、nonselected 和重迭影像。</span><span class="sxs-lookup"><span data-stu-id="1a211-261">A normal image list stores the selected, nonselected, and overlay images.</span></span> <span data-ttu-id="1a211-262">狀態影像清單會儲存狀態影像。</span><span class="sxs-lookup"><span data-stu-id="1a211-262">A state image list stores state images.</span></span> <span data-ttu-id="1a211-263">使用 [**ImageList \_ create**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_create) 函式來建立影像清單，然後使用其他影像清單函式將點陣圖加入影像清單中。</span><span class="sxs-lookup"><span data-stu-id="1a211-263">Use the [**ImageList\_Create**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_create) function to create an image list, and use other image list functions to add bitmaps to the image list.</span></span> <span data-ttu-id="1a211-264">然後，若要將影像清單與樹狀檢視控制項產生關聯，請使用 [**TVM \_ SETIMAGELIST**](tvm-setimagelist.md) 訊息。</span><span class="sxs-lookup"><span data-stu-id="1a211-264">Then, to associate the image list with the tree-view control, use the [**TVM\_SETIMAGELIST**](tvm-setimagelist.md) message.</span></span> <span data-ttu-id="1a211-265">[**TVM \_ GETIMAGELIST**](tvm-getimagelist.md)訊息會抓取其中一個樹狀檢視控制項影像清單的控制碼。</span><span class="sxs-lookup"><span data-stu-id="1a211-265">The [**TVM\_GETIMAGELIST**](tvm-getimagelist.md) message retrieves a handle to one of a tree-view control's image lists.</span></span> <span data-ttu-id="1a211-266">如果您需要在清單中新增更多影像，此訊息會很有用。</span><span class="sxs-lookup"><span data-stu-id="1a211-266">This message is useful if you need to add more images to the list.</span></span>

<span data-ttu-id="1a211-267">除了選取和 nonselected 的影像之外，樹狀檢視控制項的一般影像清單最多可包含四個重迭影像。</span><span class="sxs-lookup"><span data-stu-id="1a211-267">In addition to the selected and nonselected images, a tree-view control's normal image list can contain up to four overlay images.</span></span> <span data-ttu-id="1a211-268">重迭影像是由以一為基礎的索引來識別，其設計目的是要在選取和 nonselected 的影像上以透明方式繪製。</span><span class="sxs-lookup"><span data-stu-id="1a211-268">Overlay images are identified by a one-based index and are designed to be drawn transparently over the selected and nonselected images.</span></span> <span data-ttu-id="1a211-269">若要將覆迭遮罩索引指派給標準影像清單中的影像，請呼叫 [**ImageList \_ SetOverlayImage**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_setoverlayimage) 函數。</span><span class="sxs-lookup"><span data-stu-id="1a211-269">To assign an overlay mask index to an image in the normal image list, call the [**ImageList\_SetOverlayImage**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_setoverlayimage) function.</span></span>

<span data-ttu-id="1a211-270">依預設，所有專案都會針對選取和 nonselected 的狀態，顯示一般影像清單中的第一個影像。</span><span class="sxs-lookup"><span data-stu-id="1a211-270">By default, all items display the first image in the normal image list for both the selected and nonselected states.</span></span> <span data-ttu-id="1a211-271">此外，根據預設，專案不會顯示重迭影像或狀態影像。</span><span class="sxs-lookup"><span data-stu-id="1a211-271">Also, by default, items do not display overlay images or state images.</span></span> <span data-ttu-id="1a211-272">您可以藉由傳送 [**TVM \_ INSERTITEM**](tvm-insertitem.md) 或 [**TVM \_ SETITEM**](tvm-setitem.md) 訊息來變更專案的這些預設行為。</span><span class="sxs-lookup"><span data-stu-id="1a211-272">You can change these default behaviors for an item by sending the [**TVM\_INSERTITEM**](tvm-insertitem.md) or [**TVM\_SETITEM**](tvm-setitem.md) message.</span></span> <span data-ttu-id="1a211-273">這些訊息會使用 [**TVITEM**](/windows/win32/api/commctrl/ns-commctrl-tvitema) 結構來指定專案的影像清單索引。</span><span class="sxs-lookup"><span data-stu-id="1a211-273">These messages use the [**TVITEM**](/windows/win32/api/commctrl/ns-commctrl-tvitema) structure to specify image list indexes for an item.</span></span>

<span data-ttu-id="1a211-274">若要指定專案的已選取和 nonselected 影像，請 \_ \_ 在 [**TVITEM**](/windows/win32/api/commctrl/ns-commctrl-tvitema)結構的 **遮罩** 成員中設定 TVIF SELECTEDIMAGE 和 TVIF 影像位，並在 **iSelectImage** 和 **iImage** 成員中指定控制項的一般影像清單中的索引。</span><span class="sxs-lookup"><span data-stu-id="1a211-274">To specify an item's selected and nonselected images, set the TVIF\_SELECTEDIMAGE and TVIF\_IMAGE bits in the **mask** member of the [**TVITEM**](/windows/win32/api/commctrl/ns-commctrl-tvitema) structure and specify indexes from the control's normal image list in the **iSelectImage** and **iImage** members.</span></span> <span data-ttu-id="1a211-275">或者，您可以 \_ 在 **ISelectImage** 和 **iImage** 中指定 I IMAGECALLBACK 值，而不是指定索引。</span><span class="sxs-lookup"><span data-stu-id="1a211-275">Alternatively, you can specify the I\_IMAGECALLBACK value in **iSelectImage** and **iImage** instead of specifying indexes.</span></span> <span data-ttu-id="1a211-276">這會讓控制項在每次重新繪製專案時，查詢其父視窗中的影像清單索引。</span><span class="sxs-lookup"><span data-stu-id="1a211-276">This causes the control to query its parent window for an image list index each time the item is about to be redrawn.</span></span> <span data-ttu-id="1a211-277">此控制項會傳送 [izdebski \_ GETDISPINFO](tvn-getdispinfo.md) 通知訊息，以抓取索引。</span><span class="sxs-lookup"><span data-stu-id="1a211-277">The control sends the [TVN\_GETDISPINFO](tvn-getdispinfo.md) notification message to retrieve the index.</span></span>

<span data-ttu-id="1a211-278">若要將重迭影像與專案產生關聯，請使用 [**INDEXTOOVERLAYMASK**](/windows/desktop/api/Commctrl/nf-commctrl-indextooverlaymask)宏在專案的 [**TVITEM**](/windows/win32/api/commctrl/ns-commctrl-tvitema)結構的 **state** 成員中指定覆迭遮罩索引。</span><span class="sxs-lookup"><span data-stu-id="1a211-278">To associate an overlay image with an item, use the [**INDEXTOOVERLAYMASK**](/windows/desktop/api/Commctrl/nf-commctrl-indextooverlaymask) macro to specify an overlay mask index in the **state** member of the item's [**TVITEM**](/windows/win32/api/commctrl/ns-commctrl-tvitema) structure.</span></span> <span data-ttu-id="1a211-279">您也必須在 **stateMask** 成員中設定 [**TVIS \_ OVERLAYMASK**](tree-view-control-item-states.md)位。</span><span class="sxs-lookup"><span data-stu-id="1a211-279">You must also set the [**TVIS\_OVERLAYMASK**](tree-view-control-item-states.md) bits in the **stateMask** member.</span></span> <span data-ttu-id="1a211-280">覆迭遮罩索引是以一為基礎;索引為零表示未指定任何重迭影像。</span><span class="sxs-lookup"><span data-stu-id="1a211-280">Overlay mask indexes are one-based; an index of zero indicates that no overlay image was specified.</span></span>

<span data-ttu-id="1a211-281">狀態影像會儲存在個別的狀態影像清單中，並以其索引加以識別。</span><span class="sxs-lookup"><span data-stu-id="1a211-281">State images are stored in a separate state image list and identified by their index.</span></span> <span data-ttu-id="1a211-282">若要指定狀態影像清單，請傳送 [**TVM \_ SETIMAGELIST**](tvm-setimagelist.md) 訊息。</span><span class="sxs-lookup"><span data-stu-id="1a211-282">To specify the state image list, send a [**TVM\_SETIMAGELIST**](tvm-setimagelist.md) message.</span></span> <span data-ttu-id="1a211-283">不同于清單視圖控制項（使用以一為基礎的索引來識別狀態影像），樹狀檢視控制項狀態影像會以以零為基底的索引來識別。</span><span class="sxs-lookup"><span data-stu-id="1a211-283">Unlike the list-view control, which uses a one-based index to identify state images, tree-view control state images are identified by a zero-based index.</span></span> <span data-ttu-id="1a211-284">不過，索引為零表示該專案沒有狀態影像。</span><span class="sxs-lookup"><span data-stu-id="1a211-284">However, an index of zero indicates that the item does not have a state image.</span></span> <span data-ttu-id="1a211-285">因此，不能使用影像零做為狀態影像。</span><span class="sxs-lookup"><span data-stu-id="1a211-285">Consequently, image zero cannot be used as a state image.</span></span> <span data-ttu-id="1a211-286">如需專案狀態和狀態影像的進一步討論，請參閱 [樹狀檢視專案狀態總覽](#tree-view-item-states-overview)。</span><span class="sxs-lookup"><span data-stu-id="1a211-286">For further discussion of item states and state images, see [Tree-View Item States Overview](#tree-view-item-states-overview).</span></span>

## <a name="drag-and-drop-operations"></a><span data-ttu-id="1a211-287">拖放作業</span><span class="sxs-lookup"><span data-stu-id="1a211-287">Drag-and-Drop Operations</span></span>

<span data-ttu-id="1a211-288">當使用者開始拖曳專案時，樹狀檢視控制項會通知父視窗。</span><span class="sxs-lookup"><span data-stu-id="1a211-288">A tree-view control notifies the parent window when the user starts to drag an item.</span></span> <span data-ttu-id="1a211-289">當使用者開始拖曳具有滑鼠左鍵的專案時，父視窗會收到 [izdebski \_ BEGINDRAG](tvn-begindrag.md) 通知訊息，而當使用者開始使用右方按鈕拖曳時，會收到 [izdebski \_ BEGINRDRAG](tvn-beginrdrag.md) 通知訊息。</span><span class="sxs-lookup"><span data-stu-id="1a211-289">The parent window receives a [TVN\_BEGINDRAG](tvn-begindrag.md) notification message when the user begins dragging an item with the left mouse button and a [TVN\_BEGINRDRAG](tvn-beginrdrag.md) notification message when the user begins dragging with the right button.</span></span> <span data-ttu-id="1a211-290">您可以將 [**電視 \_ DISABLEDRAGDROP**](tree-view-control-window-styles.md) 樣式提供給樹狀檢視控制項，以防止樹狀檢視控制項傳送這些通知。</span><span class="sxs-lookup"><span data-stu-id="1a211-290">You can prevent a tree-view control from sending these notifications by giving the tree-view control the [**TVS\_DISABLEDRAGDROP**](tree-view-control-window-styles.md) style.</span></span>

<span data-ttu-id="1a211-291">您可以使用 [**TVM \_ CREATEDRAGIMAGE**](tvm-createdragimage.md) 訊息來取得要在拖曳作業期間顯示的影像。</span><span class="sxs-lookup"><span data-stu-id="1a211-291">You obtain an image to display during a drag operation by using the [**TVM\_CREATEDRAGIMAGE**](tvm-createdragimage.md) message.</span></span> <span data-ttu-id="1a211-292">樹狀檢視控制項會根據所拖曳專案的標籤來建立拖曳點陣圖。</span><span class="sxs-lookup"><span data-stu-id="1a211-292">The tree-view control creates a dragging bitmap based on the label of the item being dragged.</span></span> <span data-ttu-id="1a211-293">然後，樹狀檢視控制項會建立影像清單、在其中加入點陣圖，並將控制碼傳回影像清單。</span><span class="sxs-lookup"><span data-stu-id="1a211-293">Then the tree-view control creates an image list, adds the bitmap to it, and returns the handle to the image list.</span></span>

<span data-ttu-id="1a211-294">您必須提供實際拖曳項目的程式碼。</span><span class="sxs-lookup"><span data-stu-id="1a211-294">You must provide the code that actually drags the item.</span></span> <span data-ttu-id="1a211-295">這通常牽涉到使用影像清單函式的拖曳功能，以及處理 [**wm \_ MOUSEMOVE**](/windows/desktop/inputdev/wm-mousemove) 和 [**WM \_ LBUTTONUP**](/windows/desktop/inputdev/wm-lbuttonup) (或 [**wm \_ RBUTTONUP**](/windows/desktop/inputdev/wm-rbuttonup)) 在拖曳作業開始之後傳送至父視窗的訊息。</span><span class="sxs-lookup"><span data-stu-id="1a211-295">This typically involves using the dragging capabilities of the image list functions and processing the [**WM\_MOUSEMOVE**](/windows/desktop/inputdev/wm-mousemove) and [**WM\_LBUTTONUP**](/windows/desktop/inputdev/wm-lbuttonup) (or [**WM\_RBUTTONUP**](/windows/desktop/inputdev/wm-rbuttonup)) messages sent to the parent window after the drag operation has begun.</span></span>

<span data-ttu-id="1a211-296">如果樹狀檢視控制項中的專案是拖放作業的目標，您必須知道滑鼠指標在目標專案上的時間。</span><span class="sxs-lookup"><span data-stu-id="1a211-296">If items in a tree-view control are to be the targets of drag-and-drop operations, you need to know when the mouse pointer is on a target item.</span></span> <span data-ttu-id="1a211-297">您可以使用 [**TVM \_ system.windows.media.visualtreehelper.hittest**](tvm-hittest.md) 訊息來找出。</span><span class="sxs-lookup"><span data-stu-id="1a211-297">You can find out by using the [**TVM\_HITTEST**](tvm-hittest.md) message.</span></span> <span data-ttu-id="1a211-298">您可以指定 [**TVHITTESTINFO**](/windows/win32/api/commctrl/ns-commctrl-tvhittestinfo) 結構的位址，其中包含滑鼠指標目前的座標。</span><span class="sxs-lookup"><span data-stu-id="1a211-298">You specify the address of a [**TVHITTESTINFO**](/windows/win32/api/commctrl/ns-commctrl-tvhittestinfo) structure that contains the current coordinates of the mouse pointer.</span></span> <span data-ttu-id="1a211-299">當 [**SendMessage**](/windows/desktop/api/winuser/nf-winuser-sendmessage) 函式傳回時，結構會包含旗標，指出滑鼠指標相對於樹狀檢視控制項的位置。</span><span class="sxs-lookup"><span data-stu-id="1a211-299">When the [**SendMessage**](/windows/desktop/api/winuser/nf-winuser-sendmessage) function returns, the structure contains a flag indicating the location of the mouse pointer relative to the tree-view control.</span></span> <span data-ttu-id="1a211-300">如果指標位於樹狀檢視控制項中的專案上方，則結構也會包含該專案的控制碼。</span><span class="sxs-lookup"><span data-stu-id="1a211-300">If the pointer is over an item in the tree-view control, the structure contains the handle to the item as well.</span></span>

<span data-ttu-id="1a211-301">您可以使用 [**TVM \_ SETITEM**](tvm-setitem.md) 訊息，將狀態設定為 [**TVIS \_ DROPHILITED**](tree-view-control-item-states.md) 值，以指出專案是拖放作業的目標。</span><span class="sxs-lookup"><span data-stu-id="1a211-301">You can indicate that an item is the target of a drag-and-drop operation by using the [**TVM\_SETITEM**](tvm-setitem.md) message to set the state to the [**TVIS\_DROPHILITED**](tree-view-control-item-states.md) value.</span></span> <span data-ttu-id="1a211-302">具有這個狀態的項目會繪製為用來表示拖放目標的樣式。</span><span class="sxs-lookup"><span data-stu-id="1a211-302">An item that has this state is drawn in the style used to indicate a drag-and-drop target.</span></span>

## <a name="tree-view-control-notification-messages"></a><span data-ttu-id="1a211-303">Tree-View 控制通知訊息</span><span class="sxs-lookup"><span data-stu-id="1a211-303">Tree-View Control Notification Messages</span></span>

<span data-ttu-id="1a211-304">樹狀檢視控制項會以 [**WM \_ 通知**](wm-notify.md) 訊息的形式，將下列通知訊息傳送至其父視窗。</span><span class="sxs-lookup"><span data-stu-id="1a211-304">A tree-view control sends the following notification messages to its parent window in the form of [**WM\_NOTIFY**](wm-notify.md) messages.</span></span>



| <span data-ttu-id="1a211-305">通知</span><span class="sxs-lookup"><span data-stu-id="1a211-305">Notification</span></span>                                    | <span data-ttu-id="1a211-306">Description</span><span class="sxs-lookup"><span data-stu-id="1a211-306">Description</span></span>                                                                            |
|-------------------------------------------------|----------------------------------------------------------------------------------------|
| [<span data-ttu-id="1a211-307">IZDEBSKI \_ BEGINDRAG</span><span class="sxs-lookup"><span data-stu-id="1a211-307">TVN\_BEGINDRAG</span></span>](tvn-begindrag.md)             | <span data-ttu-id="1a211-308">表示拖放作業開始的信號。</span><span class="sxs-lookup"><span data-stu-id="1a211-308">Signals the start of a drag-and-drop operation.</span></span>                                        |
| <span data-ttu-id="1a211-309">[IZDEBSKI \_ BEGINLABELEDIT](tvn-beginlabeledit.md)  </span><span class="sxs-lookup"><span data-stu-id="1a211-309">[TVN\_BEGINLABELEDIT](tvn-beginlabeledit.md)  </span></span> | <span data-ttu-id="1a211-310">表示就地標籤編輯的開始位置。</span><span class="sxs-lookup"><span data-stu-id="1a211-310">Signals the start of in-place label editing.</span></span>                                           |
| [<span data-ttu-id="1a211-311">IZDEBSKI \_ BEGINRDRAG</span><span class="sxs-lookup"><span data-stu-id="1a211-311">TVN\_BEGINRDRAG</span></span>](tvn-beginrdrag.md)           | <span data-ttu-id="1a211-312">表示滑鼠右鍵已啟動拖放操作。</span><span class="sxs-lookup"><span data-stu-id="1a211-312">Signals that the right mouse button has started a drag-and-drop operation.</span></span>             |
| [<span data-ttu-id="1a211-313">IZDEBSKI \_ DELETEITEM</span><span class="sxs-lookup"><span data-stu-id="1a211-313">TVN\_DELETEITEM</span></span>](tvn-deleteitem.md)           | <span data-ttu-id="1a211-314">指出刪除特定專案的信號。</span><span class="sxs-lookup"><span data-stu-id="1a211-314">Signals the deletion of a specific item.</span></span>                                               |
| [<span data-ttu-id="1a211-315">IZDEBSKI \_ ENDLABELEDIT</span><span class="sxs-lookup"><span data-stu-id="1a211-315">TVN\_ENDLABELEDIT</span></span>](tvn-endlabeledit.md)       | <span data-ttu-id="1a211-316">表示標籤編輯結束的信號。</span><span class="sxs-lookup"><span data-stu-id="1a211-316">Signals the end of label editing.</span></span>                                                      |
| [<span data-ttu-id="1a211-317">IZDEBSKI \_ GETDISPINFO</span><span class="sxs-lookup"><span data-stu-id="1a211-317">TVN\_GETDISPINFO</span></span>](tvn-getdispinfo.md)         | <span data-ttu-id="1a211-318">要求樹狀檢視控制項顯示專案所需的資訊。</span><span class="sxs-lookup"><span data-stu-id="1a211-318">Requests information that the tree-view control requires to display an item.</span></span>           |
| [<span data-ttu-id="1a211-319">IZDEBSKI \_ ITEMEXPANDED</span><span class="sxs-lookup"><span data-stu-id="1a211-319">TVN\_ITEMEXPANDED</span></span>](tvn-itemexpanded.md)       | <span data-ttu-id="1a211-320">表示父專案的子專案清單已展開或折迭。</span><span class="sxs-lookup"><span data-stu-id="1a211-320">Signals that a parent item's list of child items was expanded or collapsed.</span></span>            |
| [<span data-ttu-id="1a211-321">IZDEBSKI \_ ITEMEXPANDING</span><span class="sxs-lookup"><span data-stu-id="1a211-321">TVN\_ITEMEXPANDING</span></span>](tvn-itemexpanding.md)     | <span data-ttu-id="1a211-322">表示父專案的子專案清單即將展開或折迭。</span><span class="sxs-lookup"><span data-stu-id="1a211-322">Signals that a parent item's list of child items is about to be expanded or collapsed.</span></span> |
| [<span data-ttu-id="1a211-323">IZDEBSKI \_ KEYDOWN</span><span class="sxs-lookup"><span data-stu-id="1a211-323">TVN\_KEYDOWN</span></span>](tvn-keydown.md)                 | <span data-ttu-id="1a211-324">發出鍵盤事件的信號。</span><span class="sxs-lookup"><span data-stu-id="1a211-324">Signals a keyboard event.</span></span>                                                              |
| [<span data-ttu-id="1a211-325">IZDEBSKI \_ SELCHANGED</span><span class="sxs-lookup"><span data-stu-id="1a211-325">TVN\_SELCHANGED</span></span>](tvn-selchanged.md)           | <span data-ttu-id="1a211-326">表示選取專案已從某個專案變更為另一個專案。</span><span class="sxs-lookup"><span data-stu-id="1a211-326">Signals that the selection has changed from one item to another.</span></span>                       |
| [<span data-ttu-id="1a211-327">IZDEBSKI \_ SELCHANGING</span><span class="sxs-lookup"><span data-stu-id="1a211-327">TVN\_SELCHANGING</span></span>](tvn-selchanging.md)         | <span data-ttu-id="1a211-328">表示選取專案即將從某個專案變更為另一個專案。</span><span class="sxs-lookup"><span data-stu-id="1a211-328">Signals that the selection is about to be changed from one item to another.</span></span>            |
| [<span data-ttu-id="1a211-329">IZDEBSKI \_ SETDISPINFO</span><span class="sxs-lookup"><span data-stu-id="1a211-329">TVN\_SETDISPINFO</span></span>](tvn-setdispinfo.md)         | <span data-ttu-id="1a211-330">通知父視窗，它必須更新它為專案維護的資訊。</span><span class="sxs-lookup"><span data-stu-id="1a211-330">Notifies a parent window that it must update the information it maintains for an item.</span></span> |



 

## <a name="default-tree-view-control-message-processing"></a><span data-ttu-id="1a211-331">預設 Tree-View 控制訊息處理</span><span class="sxs-lookup"><span data-stu-id="1a211-331">Default Tree-View Control Message Processing</span></span>

<span data-ttu-id="1a211-332">本節說明由樹狀檢視控制項所執行的視窗訊息處理。</span><span class="sxs-lookup"><span data-stu-id="1a211-332">This section describes the window message processing performed by a tree-view control.</span></span> <span data-ttu-id="1a211-333">這份檔的其他章節將討論樹狀檢視控制項特定的訊息，因此不包含在此。</span><span class="sxs-lookup"><span data-stu-id="1a211-333">Messages specific to tree-view controls are discussed in other sections of this document, so they are not included here.</span></span>



| <span data-ttu-id="1a211-334">訊息</span><span class="sxs-lookup"><span data-stu-id="1a211-334">Message</span></span>                                            | <span data-ttu-id="1a211-335">處理已執行</span><span class="sxs-lookup"><span data-stu-id="1a211-335">Processing performed</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|----------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="1a211-336">**WM \_ 命令**</span><span class="sxs-lookup"><span data-stu-id="1a211-336">**WM\_COMMAND**</span></span>](/windows/desktop/menurc/wm-command)               | <span data-ttu-id="1a211-337">處理 [en \_ UPDATE](en-update.md) 和 [en \_ KILLFOCUS](en-killfocus.md) 編輯控制項通知訊息，並將所有其他編輯控制項通知轉寄至父視窗。</span><span class="sxs-lookup"><span data-stu-id="1a211-337">Processes the [EN\_UPDATE](en-update.md) and [EN\_KILLFOCUS](en-killfocus.md) edit control notification messages and forwards all other edit control notifications to the parent window.</span></span> <span data-ttu-id="1a211-338">沒有傳回值。</span><span class="sxs-lookup"><span data-stu-id="1a211-338">There is no return value.</span></span>                                                                                                                                                                                                                                                                                                |
| [<span data-ttu-id="1a211-339">**WM \_ 建立**</span><span class="sxs-lookup"><span data-stu-id="1a211-339">**WM\_CREATE**</span></span>](/windows/desktop/winmsg/wm-create)                 | <span data-ttu-id="1a211-340">配置記憶體並初始化內部資料結構。</span><span class="sxs-lookup"><span data-stu-id="1a211-340">Allocates memory and initializes internal data structures.</span></span> <span data-ttu-id="1a211-341">如果成功，則會傳回零，否則會傳回-1。</span><span class="sxs-lookup"><span data-stu-id="1a211-341">It returns zero if successful, or -1 otherwise.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                          |
| [<span data-ttu-id="1a211-342">**WM 損 \_ 毀**</span><span class="sxs-lookup"><span data-stu-id="1a211-342">**WM\_DESTROY**</span></span>](/windows/desktop/winmsg/wm-destroy)               | <span data-ttu-id="1a211-343">釋出與控制項相關聯的所有系統資源。</span><span class="sxs-lookup"><span data-stu-id="1a211-343">Frees all system resources associated with the control.</span></span> <span data-ttu-id="1a211-344">它會傳回零。</span><span class="sxs-lookup"><span data-stu-id="1a211-344">It returns zero.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| [<span data-ttu-id="1a211-345">**\_啟用 WM**</span><span class="sxs-lookup"><span data-stu-id="1a211-345">**WM\_ENABLE**</span></span>](/windows/desktop/winmsg/wm-enable)                 | <span data-ttu-id="1a211-346">啟用或停用控制項。</span><span class="sxs-lookup"><span data-stu-id="1a211-346">Enables or disables the control.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| [<span data-ttu-id="1a211-347">**WM \_ ERASEBKGND**</span><span class="sxs-lookup"><span data-stu-id="1a211-347">**WM\_ERASEBKGND**</span></span>](/windows/desktop/winmsg/wm-erasebkgnd)         | <span data-ttu-id="1a211-348">使用樹狀檢視控制項目前的背景色彩，清除視窗背景。</span><span class="sxs-lookup"><span data-stu-id="1a211-348">Erases the window background using the current background color for the tree-view control.</span></span> <span data-ttu-id="1a211-349">它會傳回 **TRUE**。</span><span class="sxs-lookup"><span data-stu-id="1a211-349">It returns **TRUE**.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                     |
| [<span data-ttu-id="1a211-350">**WM \_ GETDLGCODE**</span><span class="sxs-lookup"><span data-stu-id="1a211-350">**WM\_GETDLGCODE**</span></span>](/windows/desktop/dlgbox/wm-getdlgcode)         | <span data-ttu-id="1a211-351">傳回 DLGC \_ WANTARROWS 和 DLGC WANTCHARS 值的組合 \_ 。</span><span class="sxs-lookup"><span data-stu-id="1a211-351">Returns a combination of the DLGC\_WANTARROWS and DLGC\_WANTCHARS values.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| [<span data-ttu-id="1a211-352">**WM \_ GETFONT**</span><span class="sxs-lookup"><span data-stu-id="1a211-352">**WM\_GETFONT**</span></span>](/windows/desktop/winmsg/wm-getfont)               | <span data-ttu-id="1a211-353">傳回目前標籤字型的控制碼。</span><span class="sxs-lookup"><span data-stu-id="1a211-353">Returns the handle to the current label font.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| [<span data-ttu-id="1a211-354">**WM \_ HSCROLL**</span><span class="sxs-lookup"><span data-stu-id="1a211-354">**WM\_HSCROLL**</span></span>](wm-hscroll.md)                  | <span data-ttu-id="1a211-355">滾動樹狀檢視控制項。</span><span class="sxs-lookup"><span data-stu-id="1a211-355">Scrolls the tree-view control.</span></span> <span data-ttu-id="1a211-356">如果發生滾動，則會傳回 **TRUE** ，否則會傳回 **FALSE** 。</span><span class="sxs-lookup"><span data-stu-id="1a211-356">It returns **TRUE** if scrolling occurs, or **FALSE** otherwise.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                     |
| [<span data-ttu-id="1a211-357">**WM \_ KEYDOWN**</span><span class="sxs-lookup"><span data-stu-id="1a211-357">**WM\_KEYDOWN**</span></span>](/windows/desktop/inputdev/wm-keydown)             | <span data-ttu-id="1a211-358">將 [izdebski \_ KEYDOWN](tvn-keydown.md) 通知訊息傳送至所有索引鍵的父視窗。</span><span class="sxs-lookup"><span data-stu-id="1a211-358">Sends the [TVN\_KEYDOWN](tvn-keydown.md) notification message to the parent window for all keys.</span></span> <span data-ttu-id="1a211-359">當使用者按下 ENTER 鍵時，會將 [NM \_ RETURN (樹狀檢視) ](nm-return-tree-view-.md) 通知訊息。</span><span class="sxs-lookup"><span data-stu-id="1a211-359">Sends the [NM\_RETURN (tree view)](nm-return-tree-view-.md) notification message when the user presses the ENTER key.</span></span> <span data-ttu-id="1a211-360">它會在使用者按下方向鍵或 PAGE UP、PAGE DOWN、HOME、END 或倒退鍵時移動插入號。</span><span class="sxs-lookup"><span data-stu-id="1a211-360">It moves the caret when the user presses the direction keys or the PAGE UP, PAGE DOWN, HOME, END, or BACKSPACE key.</span></span> <span data-ttu-id="1a211-361">當使用者按下 CTRL 鍵與這些按鍵組合時，它會滾動樹狀檢視控制項。</span><span class="sxs-lookup"><span data-stu-id="1a211-361">It scrolls the tree-view control when the user presses the CTRL key in combination with those keys.</span></span> <span data-ttu-id="1a211-362">如果已處理索引鍵，則傳回 **TRUE** ，否則傳回 **FALSE** 。</span><span class="sxs-lookup"><span data-stu-id="1a211-362">It returns **TRUE** if a key is processed, or **FALSE** otherwise.</span></span> |
| [<span data-ttu-id="1a211-363">**WM \_ KILLFOCUS**</span><span class="sxs-lookup"><span data-stu-id="1a211-363">**WM\_KILLFOCUS**</span></span>](/windows/desktop/inputdev/wm-killfocus)         | <span data-ttu-id="1a211-364">重新繪製焦點的專案（如果有的話），然後將 [NM \_ KILLFOCUS (樹狀檢視) ](nm-killfocus-tree-view.md) 通知訊息傳送至父視窗。</span><span class="sxs-lookup"><span data-stu-id="1a211-364">Repaints the focused item, if any, and sends an [NM\_KILLFOCUS (tree view)](nm-killfocus-tree-view.md) notification message to the parent window.</span></span>                                                                                                                                                                                                                                                                                                                                                                  |
| [<span data-ttu-id="1a211-365">**WM \_ LBUTTONDBLCLK**</span><span class="sxs-lookup"><span data-stu-id="1a211-365">**WM\_LBUTTONDBLCLK**</span></span>](/windows/desktop/inputdev/wm-lbuttondblclk) | <span data-ttu-id="1a211-366">取消標籤編輯，如果按兩下專案，則會將 [NM \_ DBLCLK (樹狀檢視) ](nm-dblclk-tree-view.md) 通知訊息傳送至父視窗。</span><span class="sxs-lookup"><span data-stu-id="1a211-366">Cancels label editing and, if an item was double-clicked, sends the [NM\_DBLCLK (tree view)](nm-dblclk-tree-view.md) notification message to the parent window.</span></span> <span data-ttu-id="1a211-367">如果父視窗傳回0，則樹狀檢視控制項會切換專案的展開狀態，並將 [izdebski \_ ITEMEXPANDING](tvn-itemexpanding.md) 和 [izdebski \_ ITEMEXPANDED](tvn-itemexpanded.md) 通知訊息傳送至父視窗。</span><span class="sxs-lookup"><span data-stu-id="1a211-367">If the parent window returns 0, the tree-view control toggles the expanded state of the item, sending the parent window the [TVN\_ITEMEXPANDING](tvn-itemexpanding.md) and [TVN\_ITEMEXPANDED](tvn-itemexpanded.md) notification messages.</span></span> <span data-ttu-id="1a211-368">沒有傳回值。</span><span class="sxs-lookup"><span data-stu-id="1a211-368">There is no return value.</span></span>                                                                             |
| [<span data-ttu-id="1a211-369">**WM \_ LBUTTONDOWN**</span><span class="sxs-lookup"><span data-stu-id="1a211-369">**WM\_LBUTTONDOWN**</span></span>](/windows/desktop/inputdev/wm-lbuttondown)     | <span data-ttu-id="1a211-370">如果使用者按一下與父專案相關聯的按鈕，則切換展開的狀態。</span><span class="sxs-lookup"><span data-stu-id="1a211-370">Toggles the expanded state if the user clicked the button associated with a parent item.</span></span> <span data-ttu-id="1a211-371">如果使用者按一下專案標籤，樹狀檢視控制項會選取焦點，並將焦點設定至專案。</span><span class="sxs-lookup"><span data-stu-id="1a211-371">If the user clicked an item label, the tree-view control selects and sets the focus to the item.</span></span> <span data-ttu-id="1a211-372">如果使用者在放開滑鼠按鍵之前移動滑鼠，則樹狀檢視控制項會開始拖放作業。</span><span class="sxs-lookup"><span data-stu-id="1a211-372">If the user moves the mouse before releasing the mouse button, the tree-view control begins a drag-and-drop operation.</span></span> <span data-ttu-id="1a211-373">沒有傳回值。</span><span class="sxs-lookup"><span data-stu-id="1a211-373">There is no return value.</span></span>                                                                                                                                                                          |
| [<span data-ttu-id="1a211-374">**WM \_ 油漆**</span><span class="sxs-lookup"><span data-stu-id="1a211-374">**WM\_PAINT**</span></span>](/windows/desktop/gdi/wm-paint)                      | <span data-ttu-id="1a211-375">繪製樹狀檢視控制項的無效區域。</span><span class="sxs-lookup"><span data-stu-id="1a211-375">Paints the invalid region of the tree-view control.</span></span> <span data-ttu-id="1a211-376">它會傳回零。</span><span class="sxs-lookup"><span data-stu-id="1a211-376">It returns zero.</span></span> <span data-ttu-id="1a211-377">如果 *wParam* 參數不是 **Null**，則控制項會假設此值是裝置內容的控制碼 (HDC) 並且使用該裝置內容繪製。</span><span class="sxs-lookup"><span data-stu-id="1a211-377">If the *wParam* parameter is non-**NULL**, the control assumes that the value is a handle to a device context (HDC) and paints using that device context.</span></span>                                                                                                                                                                                                                                                                                      |
| [<span data-ttu-id="1a211-378">**WM \_ RBUTTONDOWN**</span><span class="sxs-lookup"><span data-stu-id="1a211-378">**WM\_RBUTTONDOWN**</span></span>](/windows/desktop/inputdev/wm-rbuttondown)     | <span data-ttu-id="1a211-379">檢查是否已按一下專案，並已開始拖曳作業。</span><span class="sxs-lookup"><span data-stu-id="1a211-379">Checks to see if an item was clicked and a drag operation was begun.</span></span> <span data-ttu-id="1a211-380">如果作業已開始，則會將 [izdebski \_ BEGINRDRAG](tvn-beginrdrag.md) 通知訊息傳送至父視窗，並反白顯示放置目標。</span><span class="sxs-lookup"><span data-stu-id="1a211-380">If the operation has begun, it sends a [TVN\_BEGINRDRAG](tvn-beginrdrag.md) notification message to the parent window and highlights the drop target.</span></span> <span data-ttu-id="1a211-381">否則，它會將 [NM \_ RCLICK (樹狀檢視) ](nm-rclick-tree-view.md) 通知訊息傳送至父視窗。</span><span class="sxs-lookup"><span data-stu-id="1a211-381">Otherwise, it sends an [NM\_RCLICK (tree view)](nm-rclick-tree-view.md) notification message to the parent window.</span></span> <span data-ttu-id="1a211-382">沒有傳回值。</span><span class="sxs-lookup"><span data-stu-id="1a211-382">There is no return value.</span></span>                                                                                                                                           |
| [<span data-ttu-id="1a211-383">**WM \_ SETFOCUS**</span><span class="sxs-lookup"><span data-stu-id="1a211-383">**WM\_SETFOCUS**</span></span>](/windows/desktop/inputdev/wm-setfocus)           | <span data-ttu-id="1a211-384">重新繪製焦點的專案（如果有的話），然後將 [NM \_ SETFOCUS](nm-setfocus.md) 通知訊息傳送至父視窗。</span><span class="sxs-lookup"><span data-stu-id="1a211-384">Repaints the focused item, if any, and sends an [NM\_SETFOCUS](nm-setfocus.md) notification message to the parent window.</span></span>                                                                                                                                                                                                                                                                                                                                                                                          |
| [<span data-ttu-id="1a211-385">**WM \_ SETFONT**</span><span class="sxs-lookup"><span data-stu-id="1a211-385">**WM\_SETFONT**</span></span>](/windows/desktop/winmsg/wm-setfont)               | <span data-ttu-id="1a211-386">使用新字型儲存指定的字型控點，並重新繪製樹狀檢視控制項。</span><span class="sxs-lookup"><span data-stu-id="1a211-386">Saves the specified font handle and repaints the tree-view control using the new font.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                              |
| [<span data-ttu-id="1a211-387">**WM \_ SETREDRAW**</span><span class="sxs-lookup"><span data-stu-id="1a211-387">**WM\_SETREDRAW**</span></span>](/windows/desktop/gdi/wm-setredraw)              | <span data-ttu-id="1a211-388">設定或清除重繪旗標。</span><span class="sxs-lookup"><span data-stu-id="1a211-388">Sets or clears the redraw flag.</span></span> <span data-ttu-id="1a211-389">在設定重繪旗標之後，會重新繪製樹狀檢視控制項。</span><span class="sxs-lookup"><span data-stu-id="1a211-389">The tree-view control is redrawn after the redraw flag is set.</span></span> <span data-ttu-id="1a211-390">它會傳回零。</span><span class="sxs-lookup"><span data-stu-id="1a211-390">It returns zero.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                     |
| [<span data-ttu-id="1a211-391">**WM \_ 大小**</span><span class="sxs-lookup"><span data-stu-id="1a211-391">**WM\_SIZE**</span></span>](/windows/desktop/winmsg/wm-size)                     | <span data-ttu-id="1a211-392">旁邊相依于樹狀檢視控制項工作區大小的內部變數。</span><span class="sxs-lookup"><span data-stu-id="1a211-392">Recomputes internal variables that depend on the size of the tree-view control's client area.</span></span> <span data-ttu-id="1a211-393">它會傳回 **TRUE**。</span><span class="sxs-lookup"><span data-stu-id="1a211-393">It returns **TRUE**.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                  |
| [<span data-ttu-id="1a211-394">**WM \_ STYLECHANGED**</span><span class="sxs-lookup"><span data-stu-id="1a211-394">**WM\_STYLECHANGED**</span></span>](/windows/desktop/winmsg/wm-stylechanged)     | <span data-ttu-id="1a211-395">使用新樣式取消編輯標籤，並重新繪製樹狀檢視控制項。</span><span class="sxs-lookup"><span data-stu-id="1a211-395">Cancels label editing and redraws the tree-view control using the new styles.</span></span> <span data-ttu-id="1a211-396">它會傳回零。</span><span class="sxs-lookup"><span data-stu-id="1a211-396">It returns zero.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                      |
| [<span data-ttu-id="1a211-397">**WM \_ SYSCOLORCHANGE**</span><span class="sxs-lookup"><span data-stu-id="1a211-397">**WM\_SYSCOLORCHANGE**</span></span>](/windows/desktop/gdi/wm-syscolorchange)    | <span data-ttu-id="1a211-398">如果已設定重繪旗標，則會使用新的色彩來重繪樹狀檢視控制項。</span><span class="sxs-lookup"><span data-stu-id="1a211-398">Redraws the tree-view control using the new color if the redraw flag is set.</span></span> <span data-ttu-id="1a211-399">沒有傳回值。</span><span class="sxs-lookup"><span data-stu-id="1a211-399">There is no return value.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                              |
| [<span data-ttu-id="1a211-400">**WM \_ 計時器**</span><span class="sxs-lookup"><span data-stu-id="1a211-400">**WM\_TIMER**</span></span>](/windows/desktop/winmsg/wm-timer)                   | <span data-ttu-id="1a211-401">開始編輯專案標籤。</span><span class="sxs-lookup"><span data-stu-id="1a211-401">Begins editing an item label.</span></span> <span data-ttu-id="1a211-402">如果使用者按一下焦點專案的標籤，樹狀檢視控制項會設定計時器，而不是立即進入編輯模式。</span><span class="sxs-lookup"><span data-stu-id="1a211-402">If the user clicks the label of the focused item, the tree-view control sets a timer instead of entering edit mode immediately.</span></span> <span data-ttu-id="1a211-403">計時器讓樹狀檢視可以避免在使用者按兩下標籤時進入編輯模式。</span><span class="sxs-lookup"><span data-stu-id="1a211-403">The timer makes it possible for the tree view to avoid entering edit mode if the user double-clicks the label.</span></span> <span data-ttu-id="1a211-404">它會傳回零。</span><span class="sxs-lookup"><span data-stu-id="1a211-404">It returns zero.</span></span>                                                                                                                                                                                                                       |
| [<span data-ttu-id="1a211-405">**WM \_ VSCROLL**</span><span class="sxs-lookup"><span data-stu-id="1a211-405">**WM\_VSCROLL**</span></span>](wm-vscroll.md)                  | <span data-ttu-id="1a211-406">滾動樹狀檢視控制項。</span><span class="sxs-lookup"><span data-stu-id="1a211-406">Scrolls the tree-view control.</span></span> <span data-ttu-id="1a211-407">如果發生滾動，則會傳回 **TRUE** ，否則會傳回 **FALSE** 。</span><span class="sxs-lookup"><span data-stu-id="1a211-407">It returns **TRUE** if scrolling occurs, or **FALSE** otherwise.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                     |



 

## <a name="related-topics"></a><span data-ttu-id="1a211-408">相關主題</span><span class="sxs-lookup"><span data-stu-id="1a211-408">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="1a211-409">範例： CustDTv 說明 TreeView 中的自訂繪製 (Q248496) </span><span class="sxs-lookup"><span data-stu-id="1a211-409">SAMPLE: CustDTv Illustrates Custom Draw in a TreeView (Q248496)</span></span>](https://support.microsoft.com/default.aspx?scid=kb;EN-US;q248496)
</dt> </dl>

 

 