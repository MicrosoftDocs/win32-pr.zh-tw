---
title: Windows 篩選平台可擴充 Helper 類別
description: Windows 篩選平台 (WFP) 包含網路診斷架構 (NDF) helper 類別，稱為篩選平臺協助程式類別 (FPHC) 。
ms.assetid: 006ea30c-8682-4a3d-803a-73dba5162696
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 858835c1a649602293ed042c13205ca982de9258
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/20/2020
ms.locfileid: "103933319"
---
# <a name="windows-filtering-platform-extensible-helper-class"></a><span data-ttu-id="8561b-103">Windows 篩選平台可擴充 Helper 類別</span><span class="sxs-lookup"><span data-stu-id="8561b-103">Windows Filtering Platform Extensible Helper Class</span></span>

<span data-ttu-id="8561b-104">[Windows 篩選平台 (WFP) ](/windows/desktop/FWP/windows-filtering-platform-start-page)包含網路診斷架構 (NDF) helper 類別，稱為篩選平臺協助程式類別 (FPHC) 。</span><span class="sxs-lookup"><span data-stu-id="8561b-104">The [Windows Filtering Platform (WFP)](/windows/desktop/FWP/windows-filtering-platform-start-page) includes a Network Diagnostics Framework (NDF) helper class, called the Filtering Platform helper class (FPHC).</span></span> <span data-ttu-id="8561b-105">FPHC 可協助識別 WFP 造成連線問題的根本原因。</span><span class="sxs-lookup"><span data-stu-id="8561b-105">FPHC can help identify the root causes of connectivity issues caused by WFP.</span></span> <span data-ttu-id="8561b-106">協力廠商防火牆開發人員可以執行自己的 NDF helper 類別。</span><span class="sxs-lookup"><span data-stu-id="8561b-106">Third-party firewall developers can implement their own NDF helper classes.</span></span> <span data-ttu-id="8561b-107">FPHC 擴充性可讓您在診斷期間叫用這些協力廠商 helper 類別。</span><span class="sxs-lookup"><span data-stu-id="8561b-107">FPHC extensibility allows these third-party helper classes to be invoked during diagnostics.</span></span>

<span data-ttu-id="8561b-108">本主題假設您已熟悉 [WFP API](/windows/desktop/FWP/windows-filtering-platform-start-page)。</span><span class="sxs-lookup"><span data-stu-id="8561b-108">This topic assumes familiarity with the [WFP API](/windows/desktop/FWP/windows-filtering-platform-start-page).</span></span>

## <a name="why-extend-the-fphc"></a><span data-ttu-id="8561b-109">為什麼要延伸 FPHC？</span><span class="sxs-lookup"><span data-stu-id="8561b-109">Why Extend the FPHC?</span></span>

<span data-ttu-id="8561b-110">撰寫呼叫 WFP API 之應用程式的所有開發人員都應該撰寫可延伸 FPHC 的 NDF 協助程式類別。</span><span class="sxs-lookup"><span data-stu-id="8561b-110">All developers that write applications that call the WFP API should write an NDF helper class that extends FPHC.</span></span>

<span data-ttu-id="8561b-111">FPHC 可將 WFP 識別為連接問題的原因。</span><span class="sxs-lookup"><span data-stu-id="8561b-111">FPHC can identify WFP as the cause of a connectivity issue.</span></span> <span data-ttu-id="8561b-112">如果有的話，FPHC 也可以識別建立封鎖網路流量之篩選準則的提供者。</span><span class="sxs-lookup"><span data-stu-id="8561b-112">If available, FPHC can also identify the provider that created the filter that is blocking network traffic.</span></span> <span data-ttu-id="8561b-113">FPHC 會將這項資訊傳遞給 NDF，接著可以通知使用者，WFP 造成連線問題，並提供封鎖流量的提供者名稱。</span><span class="sxs-lookup"><span data-stu-id="8561b-113">FPHC passes this information to NDF, which in turn can then notify the user that WFP is causing the connectivity problem and give the name of the provider blocking traffic.</span></span>

<span data-ttu-id="8561b-114">不過，FPHC 無法對使用者提出矯正措施，也不能提供篩選器封鎖使用者流量的原因。</span><span class="sxs-lookup"><span data-stu-id="8561b-114">However, the FPHC cannot suggest a corrective action to the user, nor can it provide the reason that the filter is blocking traffic to the user.</span></span> <span data-ttu-id="8561b-115">只有 FPHC 延伸模組可以執行這些工作。</span><span class="sxs-lookup"><span data-stu-id="8561b-115">Only a FPHC extension can perform those tasks.</span></span>

<span data-ttu-id="8561b-116">請考慮使用協力廠商防火牆應用程式呼叫 WFP API。</span><span class="sxs-lookup"><span data-stu-id="8561b-116">Consider a third-party firewall application that calls the WFP API.</span></span> <span data-ttu-id="8561b-117">如果協力廠商防火牆會執行 FPHC 延伸模組，則可以執行自訂動作來處理 NDF 所識別的連線問題。</span><span class="sxs-lookup"><span data-stu-id="8561b-117">If the third-party firewall implements a FPHC extension, then custom actions can be implemented to handle connectivity issues identified by NDF.</span></span> <span data-ttu-id="8561b-118">當 NDF 診斷出應用程式已被協力廠商防火牆封鎖時，FPHC 擴充功能可以處理封鎖事件。</span><span class="sxs-lookup"><span data-stu-id="8561b-118">When NDF diagnoses that an application has been blocked by the third-party firewall, the FPHC extension can handle the blocking event.</span></span> <span data-ttu-id="8561b-119">FPHC 延伸模組可以處理事件的其中一種方式，就是向使用者顯示使用防火牆解除封鎖程式的提示，然後在使用者確認時解除封鎖程式。</span><span class="sxs-lookup"><span data-stu-id="8561b-119">One way that the FPHC extension could handle an event is to present the user with a prompt to unblock a program using the firewall and then unblock the program upon user confirmation.</span></span> <span data-ttu-id="8561b-120">或者，FPHC 擴充功能可以藉由通知使用者應用程式被封鎖的原因來處理事件，例如應用程式因為防火牆被視為惡意程式碼而遭到封鎖。</span><span class="sxs-lookup"><span data-stu-id="8561b-120">Alternatively, the FPHC extension could handle an event by notifying the user of the reason why the application was blocked, such as an application was blocked because it was considered malware by the firewall.</span></span>

## <a name="about-wfp-diagnostics"></a><span data-ttu-id="8561b-121">關於 WFP 診斷</span><span class="sxs-lookup"><span data-stu-id="8561b-121">About WFP Diagnostics</span></span>

<span data-ttu-id="8561b-122">當叫用 NDF 以診斷網路問題時，會聯繫協助程式類別，以判斷問題的原因。</span><span class="sxs-lookup"><span data-stu-id="8561b-122">When NDF is invoked to diagnose a network issue, helper classes are contacted to determine the cause of the issue.</span></span> <span data-ttu-id="8561b-123">如果較高層級的協助程式類別判斷有可能是由 WFP 所造成的網路失敗，則會根據可用資訊產生 FPHC 的假設。</span><span class="sxs-lookup"><span data-stu-id="8561b-123">If a higher-level helper class determines that a network failure may be caused by WFP, it generates a hypothesis for FPHC based on available information.</span></span> <span data-ttu-id="8561b-124">NDF 將此假設（以數個事件屬性的形式）傳遞給 FPHC。</span><span class="sxs-lookup"><span data-stu-id="8561b-124">NDF passes this hypothesis, in the form of several event attributes, to FPHC.</span></span> <span data-ttu-id="8561b-125">以下是這些屬性的詳細說明，請參閱下面的 [FPHC 事件屬性](#windows-filtering-platform-extensible-helper-class) 一節。</span><span class="sxs-lookup"><span data-stu-id="8561b-125">These attributes are described in detail in the [FPHC Event Attributes](#windows-filtering-platform-extensible-helper-class) section below.</span></span>

<span data-ttu-id="8561b-126">網路問題可以描述為影響特定連接嘗試的連線問題。</span><span class="sxs-lookup"><span data-stu-id="8561b-126">A network issue can be described as a connectivity problem affecting a particular connection attempt.</span></span> <span data-ttu-id="8561b-127">例如，使用者可能不小心按一下 [ **不允許**] 來封鎖應用程式。</span><span class="sxs-lookup"><span data-stu-id="8561b-127">For example, the user may have accidentally blocked an application by inadvertently clicking **Don't allow**.</span></span> <span data-ttu-id="8561b-128">防火牆接著會封鎖應用程式系結至任何埠。</span><span class="sxs-lookup"><span data-stu-id="8561b-128">The firewall will then block the application from binding to any port.</span></span> <span data-ttu-id="8561b-129">使用者不知道應用程式被封鎖的原因，可能會嘗試透過應用程式提供的進入點來診斷問題。</span><span class="sxs-lookup"><span data-stu-id="8561b-129">The user, not knowing why the application is blocked, may try to diagnose the issue through an entry point offered by the application.</span></span> <span data-ttu-id="8561b-130">FPHC 會查看記錄檔，如果找到相符的記錄檔，就會抓取篩選識別碼和該特定篩選的提供者識別碼。</span><span class="sxs-lookup"><span data-stu-id="8561b-130">FPHC will look at the logs, and if it finds a match it will retrieve the filter ID and the provider ID of that particular filter.</span></span> <span data-ttu-id="8561b-131">此時，FPHC 知道該篩選的擁有者是誰，然後將診斷程式交給適當的協助程式類別，以供進一步診斷。</span><span class="sxs-lookup"><span data-stu-id="8561b-131">At this point, FPHC knows who the owner of that filter is, and it will hand over the diagnostic process to the appropriate helper class for further diagnosis.</span></span>

<span data-ttu-id="8561b-132">系統會選取最新的 WFP 事件記錄檔中要符合屬性的事件，以與網路問題相關。</span><span class="sxs-lookup"><span data-stu-id="8561b-132">The most recent event in the WFP event logs to match the attributes is selected as being relevant to the network issue.</span></span> <span data-ttu-id="8561b-133">如果找不到相符的事件，而且該事件發生的時間已涵蓋于 WFP 記錄中，FPHC 會向 NDF 指出它是否狀況良好。</span><span class="sxs-lookup"><span data-stu-id="8561b-133">If no matching events are found and the time the event happened is covered in the WFP log, FPHC indicates to NDF that it is healthy.</span></span> <span data-ttu-id="8561b-134">如果找不到相符的事件，而且 WFP 記錄未包含事件發生的時間，FPHC 會將未定狀態傳回給 NDF。</span><span class="sxs-lookup"><span data-stu-id="8561b-134">If no matching events are found and the WFP logs do not include the time the event occurred, FPHC returns an indeterminate status to NDF.</span></span>

<span data-ttu-id="8561b-135">如果找到相符的事件，FPHC 會使用篩選準則的提供者識別碼，該篩選器會造成事件識別封鎖連線之安全性規則的提供者。</span><span class="sxs-lookup"><span data-stu-id="8561b-135">If a matching event is found, FPHC uses the provider ID of the filter which caused the event to identify the provider of the security rule that blocked connectivity.</span></span> <span data-ttu-id="8561b-136">然後，FPHC 會檢查該提供者是否有 helper 類別延伸。</span><span class="sxs-lookup"><span data-stu-id="8561b-136">FPHC then checks whether a helper class extension exists for that provider.</span></span> <span data-ttu-id="8561b-137">如果找到一個，FPHC 會產生該提供者的假設，然後 NDF 叫用擴充功能。</span><span class="sxs-lookup"><span data-stu-id="8561b-137">If one is found, FPHC generates a hypothesis for that provider and then NDF invokes the extension.</span></span> <span data-ttu-id="8561b-138">延伸模組應該會傳回有用的診斷和修復資訊給使用者。</span><span class="sxs-lookup"><span data-stu-id="8561b-138">The extension should return helpful diagnostic and repair information to the user.</span></span>

## <a name="helper-class-registration"></a><span data-ttu-id="8561b-139">Helper 類別註冊</span><span class="sxs-lookup"><span data-stu-id="8561b-139">Helper Class Registration</span></span>

<span data-ttu-id="8561b-140">必須註冊 FPHC 延伸模組，如 [註冊 NDF 協助程式類別延伸](registering-ndf-helper-class-extensions.md)所述。</span><span class="sxs-lookup"><span data-stu-id="8561b-140">A FPHC extension must be registered as described in [Registering NDF Helper Class Extensions](registering-ndf-helper-class-extensions.md).</span></span> <span data-ttu-id="8561b-141">執行協助程式類別的開發人員必須註冊其延伸模組，以確保在適當時由 NDF 呼叫此擴充功能。</span><span class="sxs-lookup"><span data-stu-id="8561b-141">Developers implementing a helper class must register their extensions to ensure that the extension is called by NDF when appropriate.</span></span> <span data-ttu-id="8561b-142">以下所述的 *相符屬性* 必須儲存在登錄中的 **HKLM \\ System \\ CurrentControlSet \\ Control \\ NetDiagFx** \\ *VendorName* \\ **HostDLLs** \\ *Helper class DLL* \\ **HelperClasses** \\ *helper class Name* \\ **MatchAttributes** 下。</span><span class="sxs-lookup"><span data-stu-id="8561b-142">The *matching attribute* described below must be stored in the registry under **HKLM\\System\\CurrentControlSet\\Control\\NetDiagFx**\\*VendorName*\\**HostDLLs**\\*Helper Class DLL*\\**HelperClasses**\\*Helper Class Name*\\**MatchAttributes**.</span></span>

<span data-ttu-id="8561b-143">下表顯示用來識別要在 WFP 事件記錄檔中的診斷中使用之假設的相符屬性。</span><span class="sxs-lookup"><span data-stu-id="8561b-143">The following table shows the matching attribute used to identify the hypothesis to use in diagnostics in the WFP event log.</span></span> 

| <span data-ttu-id="8561b-144">名稱</span><span class="sxs-lookup"><span data-stu-id="8561b-144">Name</span></span>       | <span data-ttu-id="8561b-145">類型</span><span class="sxs-lookup"><span data-stu-id="8561b-145">Type</span></span>    | <span data-ttu-id="8561b-146">Description</span><span class="sxs-lookup"><span data-stu-id="8561b-146">Description</span></span>                                                                                                                                                                                                                                                                                                 |
|------------|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="8561b-147">ProviderID</span><span class="sxs-lookup"><span data-stu-id="8561b-147">ProviderID</span></span> | <span data-ttu-id="8561b-148">REG \_ SZ</span><span class="sxs-lookup"><span data-stu-id="8561b-148">REG\_SZ</span></span> | <span data-ttu-id="8561b-149">FPHC 延伸模組的 GUID。</span><span class="sxs-lookup"><span data-stu-id="8561b-149">The GUID of the FPHC extension.</span></span> <span data-ttu-id="8561b-150">此值必須與 WFP 提供者 GUID 相同。</span><span class="sxs-lookup"><span data-stu-id="8561b-150">This value must be the same as the WFP Provider GUID.</span></span> <br/> <span data-ttu-id="8561b-151">這個字串會區分大小寫。</span><span class="sxs-lookup"><span data-stu-id="8561b-151">This string is case-sensitive.</span></span> <span data-ttu-id="8561b-152">它應該以大寫字母儲存在登錄中，並以封入括弧和連字號括住。</span><span class="sxs-lookup"><span data-stu-id="8561b-152">It should be stored in the registry in upper case with enclosing braces and hyphens.</span></span> <span data-ttu-id="8561b-153">例如，{C200E360-38C5-11CE-AE62-08002B2B79EF} 是有效的 ProviderID。</span><span class="sxs-lookup"><span data-stu-id="8561b-153">For example, {C200E360-38C5-11CE-AE62-08002B2B79EF} is a valid ProviderID.</span></span><br/> |



 

<span data-ttu-id="8561b-154">當封鎖篩選的 ProviderID 符合已註冊之 helper 類別的 ProviderID 時，FPHC 會通知 NDF 叫用該 helper 類別，進而擴充 FPHC 的診斷功能。</span><span class="sxs-lookup"><span data-stu-id="8561b-154">When the ProviderID of a blocking filter matches that of a registered helper class, FPHC informs NDF to invoke that helper class, thus extending the diagnostic capability of FPHC.</span></span>

## <a name="fphc-event-attributes"></a><span data-ttu-id="8561b-155">FPHC 事件屬性</span><span class="sxs-lookup"><span data-stu-id="8561b-155">FPHC Event Attributes</span></span>

<span data-ttu-id="8561b-156">下表列出與每個相符事件相關聯的事件屬性。</span><span class="sxs-lookup"><span data-stu-id="8561b-156">The following table lists the event attributes associated with each matching event.</span></span> <span data-ttu-id="8561b-157">每個事件屬性都會儲存在 [**HELPER \_ 屬性**](/windows/win32/api/ndattrib/ns-ndattrib-helper_attribute) 結構中。</span><span class="sxs-lookup"><span data-stu-id="8561b-157">Each event attribute is stored in a [**HELPER\_ATTRIBUTE**](/windows/win32/api/ndattrib/ns-ndattrib-helper_attribute) structure.</span></span> <span data-ttu-id="8561b-158">當找到相符的事件時，NDF 會將這些屬性傳遞至 FPHC。</span><span class="sxs-lookup"><span data-stu-id="8561b-158">These attributes are passed by NDF to FPHC when a matching event is found.</span></span> <span data-ttu-id="8561b-159">這些可以接著傳遞至 FPHC 延伸模組。</span><span class="sxs-lookup"><span data-stu-id="8561b-159">These can in turn be passed to FPHC extensions.</span></span>



| <span data-ttu-id="8561b-160">屬性</span><span class="sxs-lookup"><span data-stu-id="8561b-160">Attribute</span></span>     | <span data-ttu-id="8561b-161">[**屬性 \_類型**](/windows/win32/api/ndattrib/ne-ndattrib-attribute_type) 值</span><span class="sxs-lookup"><span data-stu-id="8561b-161">[**ATTRIBUTE\_TYPE**](/windows/win32/api/ndattrib/ne-ndattrib-attribute_type) value</span></span> | <span data-ttu-id="8561b-162">Description</span><span class="sxs-lookup"><span data-stu-id="8561b-162">Description</span></span>                                                                                                                               |
|---------------|-------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="8561b-163">提供者 GUID</span><span class="sxs-lookup"><span data-stu-id="8561b-163">Provider GUID</span></span> | <span data-ttu-id="8561b-164">位於 \_ GUID</span><span class="sxs-lookup"><span data-stu-id="8561b-164">AT\_GUID</span></span>                                        | <span data-ttu-id="8561b-165">與篩選準則相關聯之提供者的 GUID。</span><span class="sxs-lookup"><span data-stu-id="8561b-165">The GUID of the provider associated with the filter.</span></span>                                                                                      |
| <span data-ttu-id="8561b-166">時間戳記</span><span class="sxs-lookup"><span data-stu-id="8561b-166">Timestamp</span></span>     | <span data-ttu-id="8561b-167">在 \_ 八位 \_ 字串</span><span class="sxs-lookup"><span data-stu-id="8561b-167">AT\_OCTET\_STRING</span></span>                               | <span data-ttu-id="8561b-168">指定事件發生時間的 FILETIME 型別緩衝區。</span><span class="sxs-lookup"><span data-stu-id="8561b-168">A buffer of type FILETIME that specifies the time at which the event occurred.</span></span> <span data-ttu-id="8561b-169">這個時間戳記可以用來唯一識別事件。</span><span class="sxs-lookup"><span data-stu-id="8561b-169">This time stamp can be used to uniquely identify an event.</span></span> |
| <span data-ttu-id="8561b-170">ipProtocol</span><span class="sxs-lookup"><span data-stu-id="8561b-170">ipProtocol</span></span>    | <span data-ttu-id="8561b-171">AT \_ UINT32</span><span class="sxs-lookup"><span data-stu-id="8561b-171">AT\_UINT32</span></span>                                      | <span data-ttu-id="8561b-172">採用 UINT8 格式的傳輸層通訊協定。</span><span class="sxs-lookup"><span data-stu-id="8561b-172">The transport layer protocol, in UINT8 format.</span></span>                                                                                            |
| <span data-ttu-id="8561b-173">LocalAddr</span><span class="sxs-lookup"><span data-stu-id="8561b-173">LocalAddr</span></span>     | <span data-ttu-id="8561b-174">在 \_ SOCKADDR</span><span class="sxs-lookup"><span data-stu-id="8561b-174">AT\_SOCKADDR</span></span>                                    | <span data-ttu-id="8561b-175">儲存在 [**診斷 \_ SOCKADDR**](/windows/win32/api/ndattrib/ns-ndattrib-diag_sockaddr) 結構中的本機 IP 位址和埠。</span><span class="sxs-lookup"><span data-stu-id="8561b-175">The local IP address and port, stored in a [**DIAG\_SOCKADDR**](/windows/win32/api/ndattrib/ns-ndattrib-diag_sockaddr) structure.</span></span>                                             |
| <span data-ttu-id="8561b-176">RemoteAddr</span><span class="sxs-lookup"><span data-stu-id="8561b-176">RemoteAddr</span></span>    | <span data-ttu-id="8561b-177">在 \_ SOCKADDR</span><span class="sxs-lookup"><span data-stu-id="8561b-177">AT\_SOCKADDR</span></span>                                    | <span data-ttu-id="8561b-178">遠端 IP 位址和埠，儲存在 [**診斷 \_ SOCKADDR**](/windows/win32/api/ndattrib/ns-ndattrib-diag_sockaddr) 結構中。</span><span class="sxs-lookup"><span data-stu-id="8561b-178">The remote IP address and port, stored in a [**DIAG\_SOCKADDR**](/windows/win32/api/ndattrib/ns-ndattrib-diag_sockaddr) structure.</span></span>                                            |
| <span data-ttu-id="8561b-179">userId</span><span class="sxs-lookup"><span data-stu-id="8561b-179">userId</span></span>        | <span data-ttu-id="8561b-180">在 \_ 八位 \_ 字串</span><span class="sxs-lookup"><span data-stu-id="8561b-180">AT\_OCTET\_STRING</span></span>                               | <span data-ttu-id="8561b-181">代表 userid 的類型 SID 的緩衝區。</span><span class="sxs-lookup"><span data-stu-id="8561b-181">A buffer of type SID that represents the userid.</span></span> <span data-ttu-id="8561b-182">如果 userId 的長度為0，則無法使用 SID。</span><span class="sxs-lookup"><span data-stu-id="8561b-182">If userId is of length 0, the SID is unavailable.</span></span>                                        |
| <span data-ttu-id="8561b-183">appId</span><span class="sxs-lookup"><span data-stu-id="8561b-183">appId</span></span>         | <span data-ttu-id="8561b-184">在 \_ 字串</span><span class="sxs-lookup"><span data-stu-id="8561b-184">AT\_STRING</span></span>                                      | <span data-ttu-id="8561b-185">儲存抓取的應用程式識別碼的緩衝區。</span><span class="sxs-lookup"><span data-stu-id="8561b-185">A buffer that stores the retrieved application identifier.</span></span> <span data-ttu-id="8561b-186">如果 appId 的值為 L ""，則無法使用應用程式識別碼。</span><span class="sxs-lookup"><span data-stu-id="8561b-186">If appId has a value of L"", the application identifier is unavailable.</span></span>        |



 

## <a name="handling-fphc-events"></a><span data-ttu-id="8561b-187">處理 FPHC 事件</span><span class="sxs-lookup"><span data-stu-id="8561b-187">Handling FPHC Events</span></span>

<span data-ttu-id="8561b-188">建議將診斷和修復資訊提供給使用者之前，FPHC 延伸模組應收集比 FPHC 通知所提供更多的資料。</span><span class="sxs-lookup"><span data-stu-id="8561b-188">Before suggesting diagnostic and repair information to the user, a FPHC extension should gather more data than is provided by the FPHC notifications.</span></span> <span data-ttu-id="8561b-189">您可以從 [WFP 事件管理函數](/windows/desktop/FWP/fwp-mgmt-functions)取得此資料。</span><span class="sxs-lookup"><span data-stu-id="8561b-189">This data can be acquired from the [WFP Event Management Functions](/windows/desktop/FWP/fwp-mgmt-functions).</span></span> <span data-ttu-id="8561b-190">這些函式會在 [顯示 Net Events](/windows/desktop/FWP/displaying-net-events) 範例中示範。</span><span class="sxs-lookup"><span data-stu-id="8561b-190">These functions are demonstrated in the [Displaying Net Events](/windows/desktop/FWP/displaying-net-events) sample.</span></span>

<span data-ttu-id="8561b-191">SDK 中包含更詳細的事件管理範例。</span><span class="sxs-lookup"><span data-stu-id="8561b-191">A more detailed event management sample is included in the SDK.</span></span> <span data-ttu-id="8561b-192">您可以在 SDK 安裝位置的 C： \\ Program Files \\ Microsoft sdk \\ Windows \\ <version number> \\ 範例 \\ NetDs \\ WFP \\ DiagEvents 中找到範例的原始程式碼。</span><span class="sxs-lookup"><span data-stu-id="8561b-192">The source code for the sample can be found in the SDK installation location under C:\\Program Files\\Microsoft SDKs\\Windows\\<version number>\\Samples\\NetDs\\WFP\\DiagEvents.</span></span> <span data-ttu-id="8561b-193">您可以從 [下載中心](https://www.microsoft.com/downloads/details.aspx?FamilyID=f26b1aa4-741a-433a-9be5-fa919850bdbf)取得 WINDOWS Vista SDK。</span><span class="sxs-lookup"><span data-stu-id="8561b-193">The Windows Vista SDK is available from the [Download Center](https://www.microsoft.com/downloads/details.aspx?FamilyID=f26b1aa4-741a-433a-9be5-fa919850bdbf).</span></span>

## <a name="built-in-fphc-diagnostics"></a><span data-ttu-id="8561b-194">內建 FPHC 診斷</span><span class="sxs-lookup"><span data-stu-id="8561b-194">Built-in FPHC Diagnostics</span></span>

<span data-ttu-id="8561b-195">如果沒有 FPHC 延伸模組，FPHC 可以診斷以下所列的案例。</span><span class="sxs-lookup"><span data-stu-id="8561b-195">In the absence of an FPHC extension, FPHC can diagnose the scenarios listed below.</span></span> <span data-ttu-id="8561b-196">因為防火牆會封鎖流量，所以 FPHC 診斷的大部分連線失敗。</span><span class="sxs-lookup"><span data-stu-id="8561b-196">Most connectivity failures diagnosed by FPHC occur because firewalls block traffic.</span></span> <span data-ttu-id="8561b-197">IPsec 案例較不常見。</span><span class="sxs-lookup"><span data-stu-id="8561b-197">The IPsec scenarios are less common.</span></span>

<span data-ttu-id="8561b-198">下表顯示的某些案例會造成 FPHC 診斷的連線失敗，以及傳遞給 NDF 的描述和修復資訊。</span><span class="sxs-lookup"><span data-stu-id="8561b-198">The following table shows some scenarios causing connectivity failures that can be diagnosed by FPHC, along with the description and repair information passed to NDF.</span></span>



| <span data-ttu-id="8561b-199">狀況</span><span class="sxs-lookup"><span data-stu-id="8561b-199">Scenario</span></span>                   | <span data-ttu-id="8561b-200">低健康情況描述</span><span class="sxs-lookup"><span data-stu-id="8561b-200">Low health description</span></span>                                                                                                               | <span data-ttu-id="8561b-201">修復資訊</span><span class="sxs-lookup"><span data-stu-id="8561b-201">Repair information</span></span>                   |
|----------------------------|--------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|
| <span data-ttu-id="8561b-202">防火牆捨棄</span><span class="sxs-lookup"><span data-stu-id="8561b-202">Firewall drop</span></span>              | <span data-ttu-id="8561b-203">這部電腦上的防火牆設定封鎖了連接。</span><span class="sxs-lookup"><span data-stu-id="8561b-203">The firewall settings on this computer are blocking the connection.</span></span>                                                                  | <span data-ttu-id="8561b-204">確認您的防火牆設定。</span><span class="sxs-lookup"><span data-stu-id="8561b-204">Verify your firewall settings.</span></span>       |
| <span data-ttu-id="8561b-205">主要模式失敗</span><span class="sxs-lookup"><span data-stu-id="8561b-205">Main Mode Failure</span></span>          | <span data-ttu-id="8561b-206">因為 IPsec 安全性原則不相符，所以無法連接。</span><span class="sxs-lookup"><span data-stu-id="8561b-206">You cannot connect because of an IPsec security policy mismatch.</span></span>                                                                     | <span data-ttu-id="8561b-207">請洽詢 IPsec 原則擁有者。</span><span class="sxs-lookup"><span data-stu-id="8561b-207">Contact the IPsec policy owner.</span></span>      |
| <span data-ttu-id="8561b-208">快速模式失敗</span><span class="sxs-lookup"><span data-stu-id="8561b-208">Quick Mode Failure</span></span>         | <span data-ttu-id="8561b-209">因為 IPsec 安全性原則不相符，所以無法連接。</span><span class="sxs-lookup"><span data-stu-id="8561b-209">You cannot connect because of an IPsec security policy mismatch.</span></span>                                                                     | <span data-ttu-id="8561b-210">請洽詢 IPsec 原則擁有者。</span><span class="sxs-lookup"><span data-stu-id="8561b-210">Contact the IPsec policy owner.</span></span>      |
| <span data-ttu-id="8561b-211">使用者模式失敗</span><span class="sxs-lookup"><span data-stu-id="8561b-211">User Mode Failure</span></span>          | <span data-ttu-id="8561b-212">因為 IPsec 安全性原則不相符，所以無法連接。</span><span class="sxs-lookup"><span data-stu-id="8561b-212">You cannot connect because of an IPsec security policy mismatch.</span></span>                                                                     | <span data-ttu-id="8561b-213">請洽詢 IPsec 原則擁有者。</span><span class="sxs-lookup"><span data-stu-id="8561b-213">Contact the IPsec policy owner.</span></span>      |
| <span data-ttu-id="8561b-214">認證失敗</span><span class="sxs-lookup"><span data-stu-id="8561b-214">Credential Failure</span></span>         | <span data-ttu-id="8561b-215">因為這部電腦上 (CA) 的根憑證授權單位不符合遠端電腦上的根 CA，所以無法連線。</span><span class="sxs-lookup"><span data-stu-id="8561b-215">You cannot connect because the root certification authority (CA) on this computer does not match the root CA on the remote computer.</span></span> | <span data-ttu-id="8561b-216">更新受信任的根憑證。</span><span class="sxs-lookup"><span data-stu-id="8561b-216">Update the trusted root certificate.</span></span> |
| <span data-ttu-id="8561b-217">過期的憑證</span><span class="sxs-lookup"><span data-stu-id="8561b-217">Expired Certificate</span></span>        | <span data-ttu-id="8561b-218">用於 IPsec 驗證的憑證已過期。</span><span class="sxs-lookup"><span data-stu-id="8561b-218">The certificate used for IPsec authentication has expired.</span></span>                                                                           | <span data-ttu-id="8561b-219">要求憑證。</span><span class="sxs-lookup"><span data-stu-id="8561b-219">Request a certificate.</span></span>               |
| <span data-ttu-id="8561b-220">其他憑證失敗</span><span class="sxs-lookup"><span data-stu-id="8561b-220">Other certificate failures</span></span> | <span data-ttu-id="8561b-221">找不到 IPsec 驗證的有效憑證。</span><span class="sxs-lookup"><span data-stu-id="8561b-221">A valid certificate was not found for IPsec authentication.</span></span>                                                                          | <span data-ttu-id="8561b-222">要求憑證。</span><span class="sxs-lookup"><span data-stu-id="8561b-222">Request a certificate.</span></span>               |
| <span data-ttu-id="8561b-223">Kerberos 失敗</span><span class="sxs-lookup"><span data-stu-id="8561b-223">Kerberos failure</span></span>           | <span data-ttu-id="8561b-224">電腦不是此網域的一部分。</span><span class="sxs-lookup"><span data-stu-id="8561b-224">The computer is not part of this domain.</span></span>                                                                                             | <span data-ttu-id="8561b-225">將此電腦加入網域。</span><span class="sxs-lookup"><span data-stu-id="8561b-225">Join this computer to a domain.</span></span>      |
| <span data-ttu-id="8561b-226">預先共用金鑰</span><span class="sxs-lookup"><span data-stu-id="8561b-226">Preshared Key</span></span>              | <span data-ttu-id="8561b-227">重設預先共用的金鑰。</span><span class="sxs-lookup"><span data-stu-id="8561b-227">Reset the preshared keys.</span></span>                                                                                                            | <span data-ttu-id="8561b-228">重設預先共用的金鑰。</span><span class="sxs-lookup"><span data-stu-id="8561b-228">Reset the preshared keys.</span></span>            |



 

## <a name="related-topics"></a><span data-ttu-id="8561b-229">相關主題</span><span class="sxs-lookup"><span data-stu-id="8561b-229">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="8561b-230">Windows 篩選平台</span><span class="sxs-lookup"><span data-stu-id="8561b-230">Windows Filtering Platform</span></span>](/windows/desktop/FWP/windows-filtering-platform-start-page)
</dt> <dt>

[<span data-ttu-id="8561b-231">設計 NDF Helper 類別延伸模組</span><span class="sxs-lookup"><span data-stu-id="8561b-231">Designing NDF Helper Class Extensions</span></span>](designing-ndf-helper-class-extensions.md)
</dt> <dt>

[<span data-ttu-id="8561b-232">註冊 NDF Helper 類別延伸模組</span><span class="sxs-lookup"><span data-stu-id="8561b-232">Registering NDF Helper Class Extensions</span></span>](registering-ndf-helper-class-extensions.md)
</dt> <dt>

[<span data-ttu-id="8561b-233">NDF Helper 類別範例</span><span class="sxs-lookup"><span data-stu-id="8561b-233">NDF Helper Class Examples</span></span>](ndf-helper-class-examples.md)
</dt> </dl>

 

