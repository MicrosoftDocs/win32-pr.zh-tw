---
title: 登錄重新導向程式
description: 登錄重新導向程式會在 WOW64 上提供登錄某些部分的個別邏輯視圖，以隔離32位和64位應用程式。
ms.assetid: b3989f79-0439-485a-96c1-4f2227d48653
keywords:
- 64位 Windows 程式設計指南64位 Windows 程式設計，登錄重新導向程式
- 登錄重新導向程式 64-位 Windows 程式設計
- 重新導向64位 Windows 程式設計
- WOW64 64 位 Windows 程式設計，登錄重新導向程式
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 04c11e68f307aa014adb7cae8415f1baba155678
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/16/2019
ms.locfileid: "104372286"
---
# <a name="registry-redirector"></a><span data-ttu-id="ae62d-107">登錄重新導向程式</span><span class="sxs-lookup"><span data-stu-id="ae62d-107">Registry Redirector</span></span>

<span data-ttu-id="ae62d-108">登錄重新導向程式會在 WOW64 上提供登錄某些部分的個別邏輯視圖，以隔離32位和64位應用程式。</span><span class="sxs-lookup"><span data-stu-id="ae62d-108">The registry redirector isolates 32-bit and 64-bit applications by providing separate logical views of certain portions of the registry on WOW64.</span></span> <span data-ttu-id="ae62d-109">登錄重新導向程式會攔截其各自邏輯登錄視圖的32位和64位登錄，並將它們對應至對應的實體登錄位置。</span><span class="sxs-lookup"><span data-stu-id="ae62d-109">The registry redirector intercepts 32-bit and 64-bit registry calls to their respective logical registry views and maps them to the corresponding physical registry location.</span></span> <span data-ttu-id="ae62d-110">重新導向程式對應用程式而言是透明的。</span><span class="sxs-lookup"><span data-stu-id="ae62d-110">The redirection process is transparent to the application.</span></span> <span data-ttu-id="ae62d-111">因此，即使資料儲存在64位 Windows 的不同位置，32位應用程式還是可以像在32位 Windows 上執行一樣存取登錄資料。</span><span class="sxs-lookup"><span data-stu-id="ae62d-111">Therefore, a 32-bit application can access registry data as if it were running on 32-bit Windows even if the data is stored in a different location on 64-bit Windows.</span></span>

<span data-ttu-id="ae62d-112">**ARM 上的 Windows 10：** 除了 x86 應用程式的32位邏輯視圖之外，ARM 上的 Windows 10 也包含32位 ARM 應用程式的個別邏輯視圖。</span><span class="sxs-lookup"><span data-stu-id="ae62d-112">**Windows 10 on ARM:** In addition to the 32-bit logical view for x86 applications, Windows 10 on ARM includes a separate logical view for 32-bit ARM applications.</span></span>

<span data-ttu-id="ae62d-113">在重新導向的登錄路徑下，會共用索引鍵的子集。</span><span class="sxs-lookup"><span data-stu-id="ae62d-113">A subset of keys under redirected registry paths are shared.</span></span> <span data-ttu-id="ae62d-114">對共用金鑰的32位登錄呼叫不會重新導向。</span><span class="sxs-lookup"><span data-stu-id="ae62d-114">32-bit registry calls to shared keys are not redirected.</span></span> <span data-ttu-id="ae62d-115">相反地，會將金鑰的一個實體複本對應到登錄的每個邏輯視圖。</span><span class="sxs-lookup"><span data-stu-id="ae62d-115">Instead, one physical copy of the key is mapped into each logical view of the registry.</span></span> <span data-ttu-id="ae62d-116">如需重新導向的金鑰和共用金鑰清單，請參閱 [受 WOW64 影響](shared-registry-keys.md)的登錄機碼。</span><span class="sxs-lookup"><span data-stu-id="ae62d-116">For a list of redirected keys and shared keys, see [Registry Keys Affected by WOW64](shared-registry-keys.md).</span></span>

<span data-ttu-id="ae62d-117">**Windows server 2008、Windows Vista、Windows server 2003 和 WINDOWS XP：** 若要透過 COM 和其他機制來啟用應用程式互通性，重新導向的登錄機碼子集也會 *反映出來*。</span><span class="sxs-lookup"><span data-stu-id="ae62d-117">**Windows Server 2008, Windows Vista, Windows Server 2003 and Windows XP:** To enable application interoperability through COM and other mechanisms, a subset of redirected registry keys are also *reflected*.</span></span> <span data-ttu-id="ae62d-118">登錄反映程式會複製登錄機碼和兩個登錄視圖之間的值，讓它們保持同步。</span><span class="sxs-lookup"><span data-stu-id="ae62d-118">The process of registry reflection copies registry keys and values between two registry views to keep them synchronized.</span></span> <span data-ttu-id="ae62d-119">從 Windows 7 和 Windows Server 2008 R2 開始，已移除登錄反映。</span><span class="sxs-lookup"><span data-stu-id="ae62d-119">Registry reflection was removed starting with Windows 7 and Windows Server 2008 R2.</span></span> <span data-ttu-id="ae62d-120">如需詳細資訊，請參閱登錄 [反映](registry-reflection.md)。</span><span class="sxs-lookup"><span data-stu-id="ae62d-120">For more information, see [Registry Reflection](registry-reflection.md).</span></span>

<span data-ttu-id="ae62d-121">下列案例說明如何使用這些邏輯視圖：</span><span class="sxs-lookup"><span data-stu-id="ae62d-121">The following scenario illustrates the use of these logical views:</span></span>

-   <span data-ttu-id="ae62d-122">32位 x86 應用程式會檢查下列登錄機碼是否存在： **HKEY \_ 本機 \_ 電腦 \\ 軟體 \\ Hello**。</span><span class="sxs-lookup"><span data-stu-id="ae62d-122">A 32-bit x86 application checks for the existence of the following registry key: **HKEY\_LOCAL\_MACHINE\\Software\\Hello**.</span></span> <span data-ttu-id="ae62d-123">如果機碼不存在，則應用程式會建立其預設值 "Hello 32-bit x86 world";否則，它會讀取並顯示值。</span><span class="sxs-lookup"><span data-stu-id="ae62d-123">If the key does not exist, the application creates it with a default value of "Hello 32-bit x86 world"; otherwise, it reads and displays the value.</span></span>
-   <span data-ttu-id="ae62d-124">相同的應用程式已修改為寫入 "Hello 64-bit world"，而不是 "Hello 32 位 x86 world"，並重新編譯為64位 x64 或 ARM64 應用程式。</span><span class="sxs-lookup"><span data-stu-id="ae62d-124">The same application is modified to write "Hello 64-bit world" instead of "Hello 32-bit x86 world" and recompiled as a 64-bit x64 or ARM64 application.</span></span>
-   <span data-ttu-id="ae62d-125">**ARM 上的 Windows 10：** 相同的應用程式會經過修改，以撰寫 "Hello 32 位 ARM world"，並重新編譯為32位 ARM 應用程式。</span><span class="sxs-lookup"><span data-stu-id="ae62d-125">**Windows 10 on ARM:** The same application is modified to write “Hello 32-bit ARM world” and recompiled as a 32-bit ARM application.</span></span>
-   <span data-ttu-id="ae62d-126">當32位 x86 應用程式在64位的 Windows 上執行時，它會顯示「Hello 32 位 x86 world」。</span><span class="sxs-lookup"><span data-stu-id="ae62d-126">When the 32-bit x86 application is run on 64-bit Windows, it displays "Hello 32-bit x86 world".</span></span> <span data-ttu-id="ae62d-127">當64位應用程式執行時，它會顯示 "Hello 64-bit world"。</span><span class="sxs-lookup"><span data-stu-id="ae62d-127">When the 64-bit application is run, it displays "Hello 64-bit world".</span></span> <span data-ttu-id="ae62d-128">**ARM 上的 Windows 10：** 當32位 ARM 應用程式在64位 ARM64 視窗上執行時，它會顯示 "Hello 32 位 ARM world"。</span><span class="sxs-lookup"><span data-stu-id="ae62d-128">**Windows 10 on ARM:** When the 32-bit ARM application is run on 64-bit ARM64 Windows, it displays "Hello 32-bit ARM world".</span></span> <span data-ttu-id="ae62d-129">所有應用程式都會使用相同的預先定義控制碼和相同的索引鍵名稱來呼叫相同的登錄函式;差別在於每個應用程式都是在其登錄的邏輯視圖上操作，而且每個視圖都會對應到不同的登錄實體位置，以保持字串的所有版本保持不變。</span><span class="sxs-lookup"><span data-stu-id="ae62d-129">All applications call the same registry functions with the same predefined handle and the same key name; the difference is that each application operates on its logical view of registry, and each view is mapped to a separate physical location of the registry, which keeps all versions of the string intact.</span></span>

<span data-ttu-id="ae62d-130">重新導向的索引鍵會對應至 **Wow6432Node** 下的實體位置。</span><span class="sxs-lookup"><span data-stu-id="ae62d-130">Redirected keys are mapped to physical locations under **Wow6432Node**.</span></span> <span data-ttu-id="ae62d-131">例如， **HKEY \_ 本機 \_ 電腦 \\ 軟體** 會重新導向至 **HKEY \_ 本機 \_ 電腦 \\ 軟體 \\ Wow6432Node**。</span><span class="sxs-lookup"><span data-stu-id="ae62d-131">For example, **HKEY\_LOCAL\_MACHINE\\Software** is redirected to **HKEY\_LOCAL\_MACHINE\\Software\\Wow6432Node**.</span></span> <span data-ttu-id="ae62d-132">不過，重新導向金鑰的實體位置應該視為系統所保留。</span><span class="sxs-lookup"><span data-stu-id="ae62d-132">However, the physical location of redirected keys should be considered reserved by the system.</span></span> <span data-ttu-id="ae62d-133">應用程式不應該直接存取金鑰的實體位置，因為這個位置可能會變更。</span><span class="sxs-lookup"><span data-stu-id="ae62d-133">Applications should not access a key's physical location directly, because this location may change.</span></span> <span data-ttu-id="ae62d-134">如需詳細資訊，請參閱 [存取替代登錄視圖](accessing-an-alternate-registry-view.md)。</span><span class="sxs-lookup"><span data-stu-id="ae62d-134">For more information, see [Accessing an Alternate Registry View](accessing-an-alternate-registry-view.md).</span></span>

<span data-ttu-id="ae62d-135">**ARM 上的 Windows 10：** 重新導向的32位 ARM 金鑰會對應至 WowAA32Node 下的實體位置。</span><span class="sxs-lookup"><span data-stu-id="ae62d-135">**Windows 10 on ARM:** Redirected 32-bit ARM keys are mapped to physical locations under WowAA32Node.</span></span>

<span data-ttu-id="ae62d-136">為了協助32位的應用程式撰寫 **REG \_ SZ** 或 REG，將包含% ProgramFiles% 或% commonprogramfiles% 的 **\_ \_ SZ 資料展開** 至登錄，WOW64 會攔截這些寫入作業，並將其取代為 "% ProgramFiles (x86) %" 和 "% commonprogramfiles (x86) %"。</span><span class="sxs-lookup"><span data-stu-id="ae62d-136">To help 32-bit applications that write **REG\_SZ** or **REG\_EXPAND\_SZ** data containing %ProgramFiles% or %commonprogramfiles% to the registry, WOW64 intercepts these write operations and replaces them with "%ProgramFiles(x86)%" and "%commonprogramfiles(x86)%".</span></span> <span data-ttu-id="ae62d-137">例如，如果 [Program Files] 目錄位於 C 磁片磁碟機上，則 "% ProgramFiles (x86) %" 會展開為 "C： \\ Program Files (x86) "。</span><span class="sxs-lookup"><span data-stu-id="ae62d-137">For example, if the Program Files directory is on the C drive, then "%ProgramFiles(x86)%" expands to "C:\\Program Files (x86)".</span></span> <span data-ttu-id="ae62d-138">只有在符合下列條件時，才會發生取代：</span><span class="sxs-lookup"><span data-stu-id="ae62d-138">The replacement occurs only if the following conditions are met:</span></span>

-   <span data-ttu-id="ae62d-139">字串的開頭必須是% ProgramFiles% 或% commonprogramfiles%。</span><span class="sxs-lookup"><span data-stu-id="ae62d-139">The string must begin with %ProgramFiles% or %commonprogramfiles%.</span></span> <span data-ttu-id="ae62d-140">如果字串開頭為空格或任何字元以外的任何字元，則不會被取代。</span><span class="sxs-lookup"><span data-stu-id="ae62d-140">If the string begins with a space or any character other than %, it is not replaced.</span></span>
-   <span data-ttu-id="ae62d-141">% ProgramFiles% 或% commonprogramfiles% 的案例必須完全如下所示，因為字串比較會區分大小寫。</span><span class="sxs-lookup"><span data-stu-id="ae62d-141">The case of %ProgramFiles% or %commonprogramfiles% must be exactly as shown because the string comparison is case-sensitive.</span></span> <span data-ttu-id="ae62d-142">例如，如果字串的開頭是% CommonProgramFiles% 而不是% CommonProgramFiles%，就不會被取代。</span><span class="sxs-lookup"><span data-stu-id="ae62d-142">For example, if the string begins with %CommonProgramFiles% instead of %commonprogramfiles%, it is not replaced.</span></span>
-   <span data-ttu-id="ae62d-143">字串不能超過最大 \_ 路徑 \* 2 + 15 個字元。</span><span class="sxs-lookup"><span data-stu-id="ae62d-143">The string cannot exceed MAX\_PATH\*2+15 characters.</span></span> <span data-ttu-id="ae62d-144">如果超過此長度，則不會被取代。</span><span class="sxs-lookup"><span data-stu-id="ae62d-144">If it exceeds this length, it is not replaced.</span></span>
-   <span data-ttu-id="ae62d-145">金鑰無法以 KEY \_ WOW64 \_ 64KEY 開啟。</span><span class="sxs-lookup"><span data-stu-id="ae62d-145">The key cannot be opened with KEY\_WOW64\_64KEY.</span></span> <span data-ttu-id="ae62d-146">此旗標指定應在64位登錄視圖上執行機碼上的作業，因此不會被取代。</span><span class="sxs-lookup"><span data-stu-id="ae62d-146">This flag specifies that operations on the key should be performed on the 64-bit registry view, so it is not replaced.</span></span> <span data-ttu-id="ae62d-147">如需詳細資訊，請參閱 [存取替代登錄視圖](accessing-an-alternate-registry-view.md)。</span><span class="sxs-lookup"><span data-stu-id="ae62d-147">For more information, see [Accessing an Alternate Registry View](accessing-an-alternate-registry-view.md).</span></span>

<span data-ttu-id="ae62d-148">**Windows server 2008、Windows Vista、Windows server 2003 和 WINDOWS XP：** KEY \_ WOW \_ 64 64KEY 旗標不 \_ 會影響是否已取代金鑰。</span><span class="sxs-lookup"><span data-stu-id="ae62d-148">**Windows Server 2008, Windows Vista, Windows Server 2003 and Windows XP:** The KEY\_WOW\_64\_64KEY flag does not affect whether a key is replaced.</span></span> <span data-ttu-id="ae62d-149">此旗標會影響自 Windows 7 和 Windows Server 2008 R2 起的取代。</span><span class="sxs-lookup"><span data-stu-id="ae62d-149">This flag affects replacement starting with Windows 7 and Windows Server 2008 R2.</span></span>

<span data-ttu-id="ae62d-150">此外，REG \_ sz 或 reg \_ 會展開 \_ 包含 system32 的 SZ 索引鍵，並以 syswow64 取代。</span><span class="sxs-lookup"><span data-stu-id="ae62d-150">In addition, REG\_SZ or REG\_EXPAND\_SZ keys containing system32 are replaced with syswow64.</span></span> <span data-ttu-id="ae62d-151">字串的開頭必須是指向或低於% windir% system32 的路徑 \\ 。</span><span class="sxs-lookup"><span data-stu-id="ae62d-151">The string must begin with the path pointing to or under %windir%\\system32.</span></span> <span data-ttu-id="ae62d-152">字串比較不區分大小寫。</span><span class="sxs-lookup"><span data-stu-id="ae62d-152">The string comparison is not case-sensitive.</span></span> <span data-ttu-id="ae62d-153">環境變數會在比對路徑之前展開，所以會取代下列所有路徑：% windir% \\ system32、% SystemRoot% \\ System32 和 C： \\ windows \\ system32。</span><span class="sxs-lookup"><span data-stu-id="ae62d-153">Environment variables are expanded before matching the path, so all of the following paths are replaced: %windir%\\system32, %SystemRoot%\\system32, and C:\\windows\\system32.</span></span> <span data-ttu-id="ae62d-154">此修補程式只適用于在 Windows 7 之前所反映的金鑰。</span><span class="sxs-lookup"><span data-stu-id="ae62d-154">This patch is applied only to the keys that were reflected prior to Windows 7.</span></span>

<span data-ttu-id="ae62d-155">如需詳細資訊，請參閱下列主題：</span><span class="sxs-lookup"><span data-stu-id="ae62d-155">For more information, see the following topics:</span></span>

-   [<span data-ttu-id="ae62d-156">登錄反映</span><span class="sxs-lookup"><span data-stu-id="ae62d-156">Registry Reflection</span></span>](registry-reflection.md)
-   [<span data-ttu-id="ae62d-157">受 WOW64 影響的登錄機碼</span><span class="sxs-lookup"><span data-stu-id="ae62d-157">Registry Keys Affected by WOW64</span></span>](shared-registry-keys.md)
-   [<span data-ttu-id="ae62d-158">存取替代登錄視圖</span><span class="sxs-lookup"><span data-stu-id="ae62d-158">Accessing an Alternate Registry View</span></span>](accessing-an-alternate-registry-view.md)
-   [<span data-ttu-id="ae62d-159">WOW64 上的登錄重新導向範例</span><span class="sxs-lookup"><span data-stu-id="ae62d-159">Example of Registry Redirection on WOW64</span></span>](example-of-registry-reflection-and-redirection-on-wow64.md)
-   [<span data-ttu-id="ae62d-160">64位 Windows 中的遠端登入存取</span><span class="sxs-lookup"><span data-stu-id="ae62d-160">Remote Registry Access in 64-bit Windows</span></span>](remote-registry-access-in-64-bit-windows.md)

 

 




