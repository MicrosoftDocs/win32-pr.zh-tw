---
title: 避免資訊隱藏
description: 有時候，程式會刻意或不慎隱藏 RPC 封送處理引擎的資訊。
ms.assetid: 016b9221-092d-4c25-a396-4f41dcdfb3cf
keywords:
- 回溯相容性 64-位 Windows 程式設計
- 相容性問題 64-位 Windows 程式設計
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3e68ab20ccf267fed187488e4ec2a4d740492338fa1758703827101bd9b98bd3
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/11/2021
ms.locfileid: "119132861"
---
# <a name="avoiding-information-hiding"></a>避免資訊隱藏

有時候，程式會刻意或不慎隱藏 RPC 封送處理引擎的資訊。 部分範例如下：

-   以位元組的無差異區塊形式傳送資料結構
-   利用方法中的副作用，在網路上透過通道傳送額外資料來利用效能
-   嘗試以 **DWORD** 或 **ULONG** 的形式傳遞控制碼來進行偽裝

這些技術幾乎保證會在您將應用程式移植到64位 Windows 之前引進相容性問題。

您可以使用內容控制碼，為代表用戶端的伺服器內容提供不透明的控制碼，而不是在標準遠端程序呼叫中傳送伺服器內容做為 **DWORD** 。 當伺服器建立用戶端的內容控制碼時，由 RPC 執行時間所定義的 Guid 會識別內容。 不透過網路使用指標，且在32或64位界限之間的作業完全透明。 如需使用內容控制碼的詳細資訊，請參閱 [內容控制碼](/windows/desktop/Rpc/context-handles)。

DCOM 介面無法使用內容控制碼，因為 COM 會提供自己的內容管理。 您可以將介面指標傳遞給 COM 物件，而不是建立內容控制碼。 然後，您可以直接透過介面指標呼叫方法，或將指標放在其他呼叫中。 若要釋放伺服器物件，用戶端會透過介面指標呼叫介面的 **發行** 方法。

同樣地，有時候您可能無法變更正在移植之程式碼的原始設計。 如果無法避免將指標以 **dword** 的形式傳送到網路上，您就必須在 **dword** 值和指標之間執行某種形式的伺服器端對應。 其中一種方式是將用戶端應用程式中的指標變更為指標精確度類型，例如 **ULONG \_ Ptr** 或 **DWORD \_** 指標。 然後使用 MIDL \[ [**呼叫 \_ 做為**](/windows/desktop/Midl/call-as) \] 屬性，將指標放在網路上作為 **DWORD** 值。 用戶端包裝函式只需要一併傳遞引數。 伺服器端包裝函式會處理兩種類型之間的對應。 以類似的方式，您可以使用 [ \[ [**傳輸 \_ 為**](/windows/desktop/Midl/transmit-as)] \] 屬性或 [ \[ [**表示 \_ 為**](/windows/desktop/Midl/represent-as)] 屬性，將 \] 您的資料轉換成與與舊版相容的線路表示格式。

如果回溯相容性不是問題，或控制碼不是用於遠端呼叫，而您確定 32-和64位進程之間的遠端呼叫永遠不會發生，您可以將引數重新定義為 **ULONG64**。 如有必要，您可以修改32位應用程式，以將 **DWORD** 傳遞給使用者。 或者，您可以使用32位 Windows 上的 **DWORD** 和64位 Windows 上的 **ULONG64** ，從每個平臺的個別 IDL 檔案建立個別的存根。

 

 