---
description: 當您呼叫 SymInitialize 函式，並將 fInvadeProcess 參數設為 TRUE，或當您呼叫 SymLoadModuleEx 函數來指定模組時，符號處理常式會載入符號。
ms.assetid: fae1895e-9fed-45e3-8ecf-4c6cc67a6094
title: 符號載入
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 705a7af3525c784b2bbcd512b267309a466a11c1
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104385872"
---
# <a name="symbol-loading"></a><span data-ttu-id="d3f99-103">符號載入</span><span class="sxs-lookup"><span data-stu-id="d3f99-103">Symbol Loading</span></span>

<span data-ttu-id="d3f99-104">當您呼叫 [**SymInitialize**](/windows/desktop/api/Dbghelp/nf-dbghelp-syminitialize) 函式，並將 *fInvadeProcess* 參數設為 **TRUE** ，或當您呼叫 [**SymLoadModuleEx**](/windows/desktop/api/Dbghelp/nf-dbghelp-symloadmoduleex) 函數來指定模組時，符號處理常式會載入符號。</span><span class="sxs-lookup"><span data-stu-id="d3f99-104">The symbol handler will load symbols when you call the [**SymInitialize**](/windows/desktop/api/Dbghelp/nf-dbghelp-syminitialize) function with the *fInvadeProcess* parameter set to **TRUE** or when you call the [**SymLoadModuleEx**](/windows/desktop/api/Dbghelp/nf-dbghelp-symloadmoduleex) function to specify a module.</span></span> <span data-ttu-id="d3f99-105">無論是哪一種情況，符號處理常式都會載入符號或延遲符號載入，直到要求符號為止，視 [**SymSetOptions**](/windows/desktop/api/Dbghelp/nf-dbghelp-symsetoptions) 函式所設定的選項而定。</span><span class="sxs-lookup"><span data-stu-id="d3f99-105">In either case, the symbol handler either loads the symbols or defers symbol loading until symbols are requested, depending on the options set by the [**SymSetOptions**](/windows/desktop/api/Dbghelp/nf-dbghelp-symsetoptions) function.</span></span>

<span data-ttu-id="d3f99-106">符號處理常式可用來取出任何模組的符號資訊;它不需要與 [**SymInitialize**](/windows/desktop/api/Dbghelp/nf-dbghelp-syminitialize) 呼叫中指定的進程相關聯。</span><span class="sxs-lookup"><span data-stu-id="d3f99-106">The symbol handler can be used to retrieve symbolic information for any module; it does not need to be associated with a process specified in the [**SymInitialize**](/windows/desktop/api/Dbghelp/nf-dbghelp-syminitialize) call.</span></span> <span data-ttu-id="d3f99-107">若要使用任意模組，請在 *ImageName* 參數中指定模組映射的完整路徑。</span><span class="sxs-lookup"><span data-stu-id="d3f99-107">To use an arbitrary module, specify the full path to the module image in the *ImageName* parameter.</span></span> <span data-ttu-id="d3f99-108">您可以使用任何 ( .exe、.dll、winspool.drv、sys、.scr、cpl 或 .com) 的可執行模組的路徑。</span><span class="sxs-lookup"><span data-stu-id="d3f99-108">You can use a path to any executable module that has debugging information (.exe, .dll, .drv, .sys, .scr, .cpl, or .com).</span></span> <span data-ttu-id="d3f99-109">使用 *BaseOfDll* 參數來指定任何載入位址，然後符號位址會以該位址為基礎。</span><span class="sxs-lookup"><span data-stu-id="d3f99-109">Use the *BaseOfDll* parameter to specify any load address, then symbol addresses will be based from that address.</span></span>

<span data-ttu-id="d3f99-110">您可能不需要在應用程式的持續時間內載入符號模組。</span><span class="sxs-lookup"><span data-stu-id="d3f99-110">It may not be necessary to keep a symbol module loaded through the duration of an application.</span></span> <span data-ttu-id="d3f99-111">若要從符號處理常式的模組清單中釋放符號模組，請使用 [**SymUnloadModule64**](/windows/desktop/api/Dbghelp/nf-dbghelp-symunloadmodule) 函數。</span><span class="sxs-lookup"><span data-stu-id="d3f99-111">To release the symbol module from the symbol handler's list of modules, use the [**SymUnloadModule64**](/windows/desktop/api/Dbghelp/nf-dbghelp-symunloadmodule) function.</span></span> <span data-ttu-id="d3f99-112">此函式會釋放配置給符號模組的記憶體。</span><span class="sxs-lookup"><span data-stu-id="d3f99-112">This function releases the memory allocated for the symbol module.</span></span> <span data-ttu-id="d3f99-113">若要再次使用該模組的符號，您必須呼叫 [**SymLoadModuleEx**](/windows/desktop/api/Dbghelp/nf-dbghelp-symloadmoduleex) 函式，即使已設定符號延後載入選項也一樣。</span><span class="sxs-lookup"><span data-stu-id="d3f99-113">To use symbols for that module again, you must call the [**SymLoadModuleEx**](/windows/desktop/api/Dbghelp/nf-dbghelp-symloadmoduleex) function even if the symbol deferred load option is set.</span></span>

## <a name="diagnosing-symbol-load-problems"></a><span data-ttu-id="d3f99-114">診斷符號載入問題</span><span class="sxs-lookup"><span data-stu-id="d3f99-114">Diagnosing Symbol Load Problems</span></span>

<span data-ttu-id="d3f99-115">若要查看所有載入符號的嘗試，請使用 SYMOPT DEBUG 來呼叫 [**SymSetOptions**](/windows/desktop/api/Dbghelp/nf-dbghelp-symsetoptions) \_ 。</span><span class="sxs-lookup"><span data-stu-id="d3f99-115">To view all attempts to load symbols, call [**SymSetOptions**](/windows/desktop/api/Dbghelp/nf-dbghelp-symsetoptions) with SYMOPT\_DEBUG.</span></span> <span data-ttu-id="d3f99-116">這會導致 DbgHelp 使用符號搜尋的詳細資訊（例如搜尋的目錄和錯誤訊息）來呼叫 [**OutputDebugString**](/windows/win32/api/debugapi/nf-debugapi-outputdebugstringa) 函數。</span><span class="sxs-lookup"><span data-stu-id="d3f99-116">This causes DbgHelp to call the [**OutputDebugString**](/windows/win32/api/debugapi/nf-debugapi-outputdebugstringa) function with detailed information on symbol searches, such as the directories it is searching and and error messages.</span></span> <span data-ttu-id="d3f99-117">如果您的程式碼使用 [**SymRegisterCallback64**](/windows/desktop/api/Dbghelp/nf-dbghelp-symregistercallback)，DbgHelp 會呼叫您的回呼函式，而不是呼叫 **OutputDebugString**。</span><span class="sxs-lookup"><span data-stu-id="d3f99-117">If your code uses [**SymRegisterCallback64**](/windows/desktop/api/Dbghelp/nf-dbghelp-symregistercallback), DbgHelp will call your callback function instead of calling **OutputDebugString**.</span></span> <span data-ttu-id="d3f99-118">*ActionCode* 參數會設定為 CBA \_ DEBUG \_ INFO，而 *CallbackData* 參數是可顯示的字串。</span><span class="sxs-lookup"><span data-stu-id="d3f99-118">The *ActionCode* parameter is set to CBA\_DEBUG\_INFO and the *CallbackData* parameter is a string that can be displayed.</span></span>

<span data-ttu-id="d3f99-119">若要讓此偵錯工具輸出顯示到主控台，而不變更您的原始程式碼，請將 DBGHELP \_ DBGOUT 環境變數設定為非 **Null** 值，然後再呼叫 [**SymInitialize**](/windows/desktop/api/Dbghelp/nf-dbghelp-syminitialize) 函式。</span><span class="sxs-lookup"><span data-stu-id="d3f99-119">To enable this debug output to be displayed to the console without changing your source code, set the DBGHELP\_DBGOUT environment variable to a non-**NULL** value before calling the [**SymInitialize**](/windows/desktop/api/Dbghelp/nf-dbghelp-syminitialize) function.</span></span> <span data-ttu-id="d3f99-120">若要將資訊記錄到檔案中，請將 DBGHELP \_ 記錄環境變數設定為要使用的記錄檔名稱。</span><span class="sxs-lookup"><span data-stu-id="d3f99-120">To log the information to a file, set the DBGHELP\_LOG environment variable to the name of the log file to be used.</span></span>

<span data-ttu-id="d3f99-121">請注意，只有在需要時才應該使用這些功能。</span><span class="sxs-lookup"><span data-stu-id="d3f99-121">Note that these features should be used only when needed.</span></span> <span data-ttu-id="d3f99-122">它們可能會讓包含許多符號的模組的符號載入變慢。</span><span class="sxs-lookup"><span data-stu-id="d3f99-122">They may slow down symbol loading of modules that contain many symbols.</span></span>

 

 
