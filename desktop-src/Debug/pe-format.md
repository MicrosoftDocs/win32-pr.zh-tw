---
description: 此規格描述 Windows 系列作業系統下的可執行檔 (映射) 檔案和物件檔案的結構。 這些檔案分別稱為可攜式可執行檔 (PE) 和通用物件檔案格式 (COFF) 檔。
ms.assetid: 3dbfbf7f-6662-45a4-99f1-e0e24c370dee
title: PE 格式
ms.topic: article
ms.date: 03/31/2021
ms.custom: contperf-fy21q1
ms.openlocfilehash: 3cc6fd777bca831ca4424baaa81c5525a24556ec
ms.sourcegitcommit: 3b9424e1dcd951b2a73e47de3c7f4d734de4263b
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/31/2021
ms.locfileid: "106984493"
---
# <a name="pe-format"></a>PE 格式

此規格描述 Windows 系列作業系統下的可執行檔 (映射) 檔案和物件檔案的結構。 這些檔案分別稱為可攜式可執行檔 (PE) 和通用物件檔案格式 (COFF) 檔。

> [!Note]  
> 本檔的目的是協助開發 Windows 的工具和應用程式，但不保證在所有方面都是完整的規格。 Microsoft 保留修改本檔的權利，恕不另行通知。

此 Microsoft 可攜性可執行檔和通用物件檔案格式規格的修訂，會取代此規格的所有先前修訂。

## <a name="general-concepts"></a>一般概念

本檔會指定 Microsoft Windows 系列作業系統下可執行檔 (映射的結構) 檔案和物件檔案。 這些檔案分別稱為可攜式可執行檔 (PE) 和通用物件檔案格式 (COFF) 檔。 「可移植的可執行檔」名稱是指格式不是架構特定的事實。

下表說明在此規格中出現的特定概念：

| Name                              | 描述                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|-----------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 屬性憑證 <br/> | 用來將可驗證的語句與影像建立關聯的憑證。 有許多不同的可驗證語句可以與檔案產生關聯;其中一個最實用的方法是軟體製造商的陳述，指出影像的訊息摘要應該是什麼。 訊息摘要類似于總和檢查碼，但非常難以偽造。 因此，很難修改檔案，使其具有與原始檔案相同的訊息摘要。 您可以使用公開或私密金鑰密碼編譯配置，來驗證該語句是否由製造商進行。 本檔將說明除了允許其插入影像檔案之外的屬性憑證的詳細資料。 <br/> |
| 日期/時間戳記 <br/>       | 在 PE 或 COFF 檔案的數個位置中，用於不同用途的戳記。 在大部分的情況下，每個戳記的格式與 C 執行時間程式庫中的時間函式所使用的格式相同。 如需例外狀況，請參閱 \_ 偵錯工具 \_ \_ [類型](#debug-type)中的影像偵錯工具類型重現 descriptor。 如果戳記值為0或0xFFFFFFFF，則不代表實際或有意義的日期/時間戳記。 <br/>                                                                                                                                                                                                                                                                                                                                            |
| 檔案指標 <br/>          | 專案在檔案本身的位置，在連結器處理之前， (在) 或載入器的情況下， () 的影像檔案。 換句話說，這是儲存在磁片上的檔案中的位置。 <br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 連結器 <br/>                | Microsoft Visual Studio 所提供連結器的參考。 <br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 目的檔 <br/>           | 提供給連結器輸入的檔案。 連結器會產生影像檔案，然後將它當做載入器的輸入使用。 「目的檔」一詞不一定意指與物件導向程式設計的任何連接。 <br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 保留，必須為0 <br/>   | 欄位的描述，表示產生器的欄位值必須為零，而且取用者必須忽略欄位。 <br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|  (RVA) 的相對虛擬位址 <br/>                   | 在影像檔案中，這是載入記憶體後，將專案的位址從其減去之影像檔的基底位址。 專案的 RVA 幾乎一律與其在磁片 (檔指標) 上的位置不同。 <br/> 在目的檔中，RVA 的意義較低，因為未指派記憶體位置。 在此情況下，RVA 會是區段內的位址 (下表稍後所述的位址) ，稍後會在連結期間套用重新配置。 為了簡單起見，編譯器應該只將每個區段中的第一個 RVA 設為零。 <br/>                                                                                                                                         |
| section <br/>               | PE 或 COFF 檔案內的程式碼或資料的基本單位。 例如，在單一區段或 (中的所有程式碼都可以在單一區段內合併，也可以根據編譯器的行為，) 每個函式可能會佔用自己的區段。 使用更多區段時，會有更多的檔案額外負荷，但連結器可以更有選擇性地連結到程式碼。 區段類似于 Intel 8086 架構中的區段。 您必須連續載入區段中的所有原始資料。 此外，影像檔案也可以包含許多區段，例如 tls 或 reloc，而這些區段具有特殊用途。 <br/>                                                                                                                                                                      |
| 虛擬位址 (VA)  <br/>                    | 與 RVA 相同，不同之處在于影像檔案的基底位址不會被扣除。 位址稱為 VA，因為 Windows 會為每個進程建立不同的 VA 空間，與實體記憶體無關。 針對幾乎所有用途，VA 應該只視為位址。 VA 無法預測為 RVA，因為載入器可能不會在其慣用位置載入映射。 <br/>                                                                                                                                                                                                                                                                                                                                        |

## <a name="overview"></a>概觀

下列清單描述 Microsoft PE 可執行檔案格式，其頂端有影像標頭的基底。 在 PE 標頭之前，從 MS-DOS 2.0 相容 EXE 標頭到未使用區段的區段是 MS-DOS 2.0 區段，而且僅適用于 MS-DOS 相容性。

-   MS-DOS 2.0 相容 EXE 標頭
-   unused
-   OEM 識別碼

    OEM 資訊

    PE 標頭的位移

-   MS-DOS 2.0 Stub 程式和重新配置表

-   unused

-   PE 標頭 (對齊8位元組界限) 

-   區段標題
-   影像頁面：

    匯入資訊

    匯出資訊

    基底重新置放

    資源資訊

下列清單說明 Microsoft COFF 物件模組格式：

-   Microsoft COFF 標頭
-   區段標題
-   原始資料：

    code

    data

    調試資訊

    定位

## <a name="file-headers"></a>檔案標頭

- [只有) 的 MS-DOS 存根 (映射 ](#ms-dos-stub-image-only)
- [只有) 的簽章 (映射 ](#signature-image-only)
- [COFF 檔案標頭 (物件和影像) ](#coff-file-header-object-and-image)
  - [電腦類型](#machine-types)
  - [特性](#characteristics)
- [選用的標頭 (僅限映射) ](#optional-header-image-only)
  - [選擇性的標頭標準欄位僅 (映射) ](#optional-header-standard-fields-image-only)
  - [選擇性的標頭 Windows-Specific 欄位僅 (影像) ](#optional-header-windows-specific-fields-image-only)
  - [選擇性的標頭資料目錄僅 (映射) ](#optional-header-data-directories-image-only)

PE 檔案標頭包含 Microsoft MS-DOS 存根、PE 簽章、COFF 檔案標頭，以及選用的標頭。 COFF 物件檔標頭包含 COFF 檔案標頭和選擇性標頭。 在這兩種情況下，檔案標頭後面都會緊接著區段標頭。

### <a name="ms-dos-stub-image-only"></a>只有) 的 MS-DOS 存根 (映射

MS-DOS 存根是在 MS-DOS 下執行的有效應用程式。 它會放在 EXE 映射的前方。 連結器會在此放置預設的存根，這會在執行映射時，于 MS-DOS 中列印出「此程式無法在 DOS 模式下執行」訊息。 使用者可以使用/STUB 連結器選項指定不同的存根。

在位置0x3c，存根具有 PE 簽章的檔案位移。 此資訊可讓 Windows 適當地執行影像檔案，即使它有 MS-DOS 存根也一樣。 這個檔案位移是在連結期間放置於位置0x3c。

### <a name="signature-image-only"></a>只有) 的簽章 (映射

在 MS-DOS 存根之後，在位移0x3c 指定的檔案位移中，是一個4位元組簽章，可將檔案識別為 PE 格式的影像檔案。 此簽章是 "PE \\ 0 \\ 0" (字母 "P" 和 "E"，後面接著兩個 null 位元組) 。

### <a name="coff-file-header-object-and-image"></a>COFF 檔案標頭 (物件和影像) 

在物件檔案的開頭，或在影像檔案的簽章之後緊接在影像檔案的開頭，是採用下列格式的標準 COFF 檔案標頭。 請注意，Windows 載入器會將區段數限制為96。

| Offset         | 大小          | 欄位                            | 描述                                                                                                                                                                                                                                                          |
|----------------|---------------|----------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 2 <br/> | 電腦 <br/>              | 識別目的電腦類型的數位。 如需詳細資訊，請參閱 [電腦類型](#machine-types)。 <br/>                                                                                                                                        |
| 2 <br/>  | 2 <br/> | NumberOfSections <br/>     | 區段數目。 這指出區段表 (緊接在標頭之後) 的大小。 <br/>                                                                                                                                             |
| 4 <br/>  | 4 <br/> | TimeDateStamp <br/>        | 自00:00 年1月 1970 1 日起的秒數的低32位 (C 執行時間時間 \_ t 值) ，指出檔案的建立時間。 <br/>                                                                                                             |
| 8 <br/>  | 4 <br/> | PointerToSymbolTable <br/> | COFF 符號表的檔案位移，如果沒有任何 COFF 符號表存在，則為零。 因為 COFF 偵錯工具資訊已被取代，所以影像的這個值應該為零。 <br/>                                                                           |
| 12 <br/> | 4 <br/> | NumberOfSymbols <br/>      | 符號表中的專案數。 此資料可以用來尋找字串表 (緊接在符號表之後)。 因為 COFF 偵錯工具資訊已被取代，所以影像的這個值應該為零。 <br/>                        |
| 16 <br/> | 2 <br/> | SizeOfOptionalHeader <br/> | 選用標頭的大小，這是可執行檔所需的大小，但不適用於物件檔。 物件檔案的這個值應該為零。 如需標頭格式的描述，請參閱 [選用標頭 (僅限映射) ](#optional-header-image-only)。 <br/> |
| 18 <br/> | 2 <br/> | 特性 <br/>      | 指出檔案屬性的旗標。 如需特定的旗標值，請參閱 [特性](#characteristics)。 <br/>                                                                                                                               |

#### <a name="machine-types"></a>電腦類型

電腦欄位具有下列其中一個值，可指定 CPU 類型。 影像檔案只能在指定的電腦上執行，或在模擬指定電腦的系統上執行。

| 常數                                    | 值              | 描述                                                                             |
|---------------------------------------------|--------------------|-----------------------------------------------------------------------------------------|
| 圖像 \_ 檔 \_ 電腦 \_ 不明 <br/>   | 0x0 <br/>    | 此欄位的內容假設適用于任何電腦類型 <br/> |
| 圖像 \_ 檔 \_ 機器 \_ AM33 <br/>      | 0x1d3 <br/>  | Matsushita AM33 <br/>                                                             |
| 圖像 \_ 檔 \_ 電腦 \_ AMD64 <br/>     | 0x8664 <br/> | x64 <br/>                                                                         |
| 圖像 \_ 檔 \_ 機器 \_ ARM <br/>       | 0x1c0 <br/>  | ARM 位元組由小到大 <br/>                                                           |
| 圖像 \_ 檔 \_ 機器 \_ ARM64 <br/>     | 0xaa64 <br/> | ARM64 位元組由小到大 <br/>                                                         |
| 圖像 \_ 檔 \_ 機器 \_ ARMNT <br/>     | 0x1c4 <br/>  | ARM Thumb-2 個位元組由小到大 <br/>                                                   |
| 圖像 \_ 檔 \_ 機器 \_ EBC <br/>       | 0xebc <br/>  | EFI 位元組碼 <br/>                                                               |
| 圖像 \_ 檔 \_ 機器 \_ I386 <br/>      | 0x14c <br/>  | Intel 386 或更新版本的處理器和相容處理器 <br/>                     |
| 圖像 \_ 檔案 \_ 電腦 \_ IA64 <br/>      | 0x200 <br/>  | Intel Itanium 處理器系列 <br/>                                              |
| 圖像 \_ 檔 \_ 機器 \_ M32R <br/>      | 0x9041 <br/> | Mitsubishi M32R 位元組由小到大 <br/>                                               |
| 圖像 \_ 檔 \_ 機器 \_ MIPS16 <br/>    | 0x266 <br/>  | MIPS16 <br/>                                                                      |
| 圖像 \_ 檔 \_ 機器 \_ MIPSFPU <br/>   | 0x366 <br/>  | 具有 FPU 的 MIPS <br/>                                                               |
| 圖像 \_ 檔 \_ 機器 \_ MIPSFPU16 <br/> | 0x466 <br/>  | 具有 FPU 的 MIPS16 <br/>                                                             |
| 圖像 \_ 檔 \_ 機器 \_ POWERPC <br/>   | 0x1f0 <br/>  | 強大電腦的位元組由大到小 <br/>                                                      |
| 圖像 \_ 檔 \_ 機器 \_ POWERPCFP <br/> | 0x1f1 <br/>  | 具有浮點支援的電源電腦 <br/>                                        |
| 圖像 \_ 檔 \_ 機器 \_ R4000 <br/>     | 0x166 <br/>  | MIPS 小位元組由小到大 <br/>                                                          |
| 圖像 \_ 檔 \_ 機器 \_ RISCV32 <br/>   | 0x5032 <br/> | RISC-V 32-bit 位址空間 <br/>                                                 |
| 圖像 \_ 檔 \_ 機器 \_ RISCV64 <br/>   | 0x5064 <br/> | RISC-V 64-bit 位址空間 <br/>                                                 |
| 圖像 \_ 檔 \_ 機器 \_ RISCV128 <br/>  | 0x5128 <br/> | RISC-V 128-bit 位址空間 <br/>                                                |
| 圖像 \_ 檔 \_ 機器 \_ SH3 <br/>       | 0x1a2 <br/>  | Hitachi SH3 <br/>                                                                 |
| 圖像 \_ 檔 \_ 機器 \_ SH3DSP <br/>    | 0x1a3 <br/>  | Hitachi SH3 DSP <br/>                                                             |
| 圖像 \_ 檔 \_ 機器 \_ SH4 <br/>       | 0x1a6 <br/>  | Hitachi SH4 <br/>                                                                 |
| 圖像 \_ 檔 \_ 機器 \_ SH5 <br/>       | 0x1a8 <br/>  | Hitachi SH5 <br/>                                                                 |
| 圖像 \_ 檔 \_ 機器 \_ 經驗 <br/>     | 0x1c2 <br/>  | Thumb <br/>                                                                       |
| 圖像 \_ 檔 \_ 機器 \_ WCEMIPSV2 <br/> | 0x169 <br/>  | MIPS 位元組由小到小 WCE v2 <br/>                                                   |

#### <a name="characteristics"></a>特性

[特性] 欄位包含的旗標會指出物件或影像檔的屬性。 目前已定義下列旗標：

| 旗標                                                 | 值              | 描述                                                                                                                                                                                                                                                                                                                                                        |
|------------------------------------------------------|--------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 圖像 \_ 檔案 \_ RELOCS 已 \_ 移除 <br/>            | 0x0001 <br/> | 僅限 Image、Windows CE 和 Microsoft Windows NT 和更新版本。 這表示檔案不包含基底重新置放，因此必須載入其慣用基底位址。 如果無法使用基底位址，則載入器會報告錯誤。 連結器的預設行為是從可執行檔 (EXE 中去除基底重新置放) 檔。 <br/> |
| 圖像 \_ 檔 \_ 可執行 \_ 映射 <br/>           | 0x0002 <br/> | 僅限映射。 這表示影像檔案有效且可以執行。 如果未設定此旗標，則會指出連結器錯誤。 <br/>                                                                                                                                                                                                                          |
| 圖像 \_ 檔 \_ 行 \_ NUMS \_ 已移除 <br/>        | 0x0004 <br/> | 已移除 COFF 行號。 此旗標已被取代，應為零。 <br/>                                                                                                                                                                                                                                                                       |
| 已移除的圖像 \_ 檔案 \_ 本機 \_ SYMS \_ <br/>       | 0x0008 <br/> | 已移除區域符號的 COFF 符號表專案。 此旗標已被取代，應為零。 <br/>                                                                                                                                                                                                                                             |
| 圖像 \_ 檔 \_ 積極的 \_ WS \_ 修剪 <br/>        | 0x0010 <br/> | 已過時。 積極修剪工作集。 此旗標在 Windows 2000 和更新版本中已被取代，而且必須為零。 <br/>                                                                                                                                                                                                                                          |
| 圖像 \_ 檔案 \_ 大型 \_ 位址 \_ 感知 <br/>      | 0x0020 <br/> | 應用程式可以處理 > 2 GB 的位址。 <br/>                                                                                                                                                                                                                                                                                                            |
|                                                      | 0x0040 <br/> | 此旗標已保留供日後使用。 <br/>                                                                                                                                                                                                                                                                                                                  |
| 圖像 \_ 檔案 \_ 位元組 \_ 反轉 \_ LO <br/>         | 0x0080 <br/> | 以位元組由小到大： (LSB) 最不重要的位會在記憶體中 (MSB) 最重要的位之前。 此旗標已被取代，應為零。 <br/>                                                                                                                                                                                                          |
| 圖像 \_ 檔案 \_ 32 位 \_ 電腦 <br/>              | 0x0100 <br/> | 電腦以32位字架構為基礎。 <br/>                                                                                                                                                                                                                                                                                                        |
| 已移除圖像 \_ 檔案 \_ 調試 \_ <br/>             | 0x0200 <br/> | 從影像檔中移除偵錯工具資訊。 <br/>                                                                                                                                                                                                                                                                                                  |
| \_ \_ \_ \_ 從 \_ 交換的影像檔案可移動執行 <br/> | 0x0400 <br/> | 如果映射位於卸載式媒體上，請將它完整載入，並將它複製到交換檔。 <br/>                                                                                                                                                                                                                                                                        |
| \_ \_ \_ \_ 從 \_ 交換執行影像檔案網路 <br/>        | 0x0800 <br/> | 如果映射位於網路媒體上，請將它完整載入，並將它複製到分頁檔。 <br/>                                                                                                                                                                                                                                                                          |
| 圖像 \_ 檔 \_ 系統 <br/>                      | 0x1000 <br/> | 影像檔案是系統檔案，而不是使用者程式。 <br/>                                                                                                                                                                                                                                                                                                   |
| 圖像 \_ 檔案 \_ DLL <br/>                         | 0x2000 <br/> | 影像檔案是動態連結程式庫 (DLL) 。 這類檔案可視為可執行檔供幾乎所有用途使用，但無法直接執行。 <br/>                                                                                                                                                                                              |
| \_ \_ 僅限影像檔 \_ 系統 \_ <br/>            | 0x4000 <br/> | 檔案只能在單處理器機器上執行。 <br/>                                                                                                                                                                                                                                                                                                 |
| 圖像 \_ 檔案 \_ 位元組已 \_ 反轉 \_ <br/>         | 0x8000 <br/> | 位元組由大到小： MSB 在記憶體中的 LSB 之前。 此旗標已被取代，應為零。 <br/>                                                                                                                                                                                                                                                            |

### <a name="optional-header-image-only"></a>選用的標頭 (僅限映射) 

每個影像檔案都有選擇性的標頭，可提供資訊給載入器。 此標頭是選擇性的，因為某些檔案 (特別是) 沒有的物件檔案。 若為影像檔案，則需要此標頭。 物件檔案可以有選擇性的標頭，但此標頭通常在物件檔案中沒有函式，但會增加其大小。

請注意，選擇性標頭的大小不是固定的。 COFF 標頭中的 **SizeOfOptionalHeader** 欄位必須用來驗證特定資料目錄的檔案探查不會超過 **SizeOfOptionalHeader**。 如需詳細資訊，請參閱 [COFF 檔案標頭 (物件和影像) ](#coff-file-header-object-and-image)。

選用標頭的 **NumberOfRvaAndSizes** 欄位也應該用來確保特定資料目錄專案的探查不會超出選擇性標頭。 此外，請務必驗證格式相容性的選用標頭魔術號碼。

選用標頭魔術數位可判斷影像是 PE32 或 PE32 + 可執行檔。

| 魔術數位      | PE 格式         |
|-------------------|-------------------|
| 0x10b <br/> | PE32 <br/>  |
| 0x20b <br/> | PE32 + <br/> |

PE32 + 影像允許64位位址空間，同時將映射大小限制為 2 gb。 其他 PE32 + 修改會在其各自的章節中解決。

選用的標頭本身有三個主要部分。

| Offset (PE32/PE32 +)  | 大小 (PE32/PE32 +)     | 標頭部分                         | 描述                                                                                                                                                                   |
|---------------------|----------------------|-------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>       | 28/24 <br/>    | 標準欄位 <br/>         | 針對所有 COFF （包括 UNIX）執行所定義的欄位。 <br/>                                                                                          |
| 28/24 <br/>   | 68/88 <br/>    | Windows 特定欄位 <br/> | 支援 Windows (特定功能的其他欄位，例如子系統) 。 <br/>                                                                              |
| 96/112 <br/>  | 變數 <br/> | 資料目錄 <br/>        | 在影像檔案中找到且由作業系統使用的特殊資料表的位址/大小組 (例如，匯入資料表和匯出資料表) 。 <br/> |

#### <a name="optional-header-standard-fields-image-only"></a>選擇性的標頭標準欄位僅 (映射) 

選用標頭的前八個欄位是為每個 COFF 的執行所定義的標準欄位。 這些欄位包含適用于載入和執行可執行檔的一般資訊。 PE32 + 格式的設定都不會變更。

| Offset         | 大小          | 欄位                               | 描述                                                                                                                                                                                                                                                                                                                                   |
|----------------|---------------|-------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 2 <br/> | Magic <br/>                   | 識別影像檔案狀態的不帶正負號的整數。 最常見的數位是0x10B，它會將它識別為一般可執行檔。 0x107 會將它識別為 ROM 映射，而0x20B 會將它識別為 PE32 + 可執行檔。 <br/>                                                                                            |
| 2 <br/>  | 1 <br/> | MajorLinkerVersion <br/>      | 連結器主要版本號碼。 <br/>                                                                                                                                                                                                                                                                                                  |
| 3 <br/>  | 1 <br/> | MinorLinkerVersion <br/>      | 連結器次要版本號碼。 <br/>                                                                                                                                                                                                                                                                                                  |
| 4 <br/>  | 4 <br/> | SizeOfCode <br/>              | 如果有多個區段，則程式碼 (文字) 區段的大小，或所有程式碼區段的總和。 <br/>                                                                                                                                                                                                                              |
| 8 <br/>  | 4 <br/> | SizeOfInitializedData <br/>   | 如果有多個資料區段，則為已初始化資料區段的大小，或所有這類區段的總和。 <br/>                                                                                                                                                                                                                    |
| 12 <br/> | 4 <br/> | SizeOfUninitializedData <br/> | 未初始化資料區段的大小 (BSS) ，或如果有多個 BSS 區段，則為所有這類區段的總和。 <br/>                                                                                                                                                                                                             |
| 16 <br/> | 4 <br/> | AddressOfEntryPoint <br/>     | 當可執行檔載入記憶體時，相對於映射基底的進入點位址。 針對程式影像，這是起始位址。 針對設備磁碟機，這是初始化函式的位址。 Dll 的進入點是選擇性的。 如果沒有任何進入點，則此欄位必須為零。 <br/> |
| 20 <br/> | 4 <br/> | BaseOfCode <br/>              | 載入記憶體時，相對於程式碼開頭區段之影像基底的位址。 <br/>                                                                                                                                                                                                                    |

PE32 包含這個額外的欄位，此欄位在 PE32 + 中不存在，請遵循 BaseOfCode。

| Offset         | 大小          | 欄位                  | 描述                                                                                                                |
|----------------|---------------|------------------------|----------------------------------------------------------------------------------------------------------------------------|
| 24 <br/> | 4 <br/> | BaseOfData <br/> | 當載入記憶體時，相對於資料開頭區段之影像基底的位址。 <br/> |

#### <a name="optional-header-windows-specific-fields-image-only"></a>選擇性的標頭 Windows-Specific 欄位僅 (影像) 

接下來的21個欄位是 COFF 選用標頭格式的延伸。 其中包含 Windows 中的連結器和載入器所需的其他資訊。

| Offset (PE32/PE32 +)  | 大小 (PE32/PE32 +)  | 欄位                                   | 描述                                                                                                                                                                                                                                                                                                            |
|----------------------|--------------------|-----------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 28/24 <br/>    | 4/8 <br/>    | Imagebase 設定 <br/>                   | 載入記憶體時，第一個位元組影像的慣用位址;必須是 64 K 的倍數。Dll 的預設值是0x10000000。 Windows CE Exe 的預設值為0x00010000。 Windows NT、Windows 2000、Windows XP、Windows 95、Windows 98 和 Windows Me 的預設值為0x00400000。 <br/>       |
| 32/32 <br/>    | 4 <br/>      | SectionAlignment <br/>            | 載入至記憶體時對齊區段 (以位元組為單位)。 它必須大於或等於 FileAlignment。 預設值為架構的頁面大小。 <br/>                                                                                                                               |
| 36/36 <br/>    | 4 <br/>      | FileAlignment <br/>               | 對齊因素 (以位元組為單位)，用來對齊映像檔中的區段原始資料。 值應為介於512到 64 K （含）之間的2乘冪。 預設值為 512。 如果 SectionAlignment 小於架構的頁面大小，則 FileAlignment 必須符合 SectionAlignment。 <br/> |
| 40/40 <br/>    | 2 <br/>      | MajorOperatingSystemVersion <br/> | 所需作業系統的主要版本號碼。 <br/>                                                                                                                                                                                                                                                 |
| 42/42 <br/>    | 2 <br/>      | MinorOperatingSystemVersion <br/> | 所需作業系統的次要版本號碼。 <br/>                                                                                                                                                                                                                                                 |
| 44/44 <br/>    | 2 <br/>      | MajorImageVersion <br/>           | 映像的主要版本號碼。 <br/>                                                                                                                                                                                                                                                                     |
| 46/46 <br/>    | 2 <br/>      | MinorImageVersion <br/>           | 映像的次要版本號碼。 <br/>                                                                                                                                                                                                                                                                     |
| 48/48 <br/>    | 2 <br/>      | MajorSubsystemVersion <br/>       | 子系統的主要版本號碼。 <br/>                                                                                                                                                                                                                                                                 |
| 50/50 <br/>    | 2 <br/>      | MinorSubsystemVersion <br/>       | 子系統的次要版本號碼。 <br/>                                                                                                                                                                                                                                                                 |
| 52/52 <br/>    | 4 <br/>      | Win32VersionValue <br/>           | Reserved，必須為零。 <br/>                                                                                                                                                                                                                                                                                    |
| 56/56 <br/>    | 4 <br/>      | SizeOfImage <br/>                 | 當映射載入記憶體時，影像的大小 (（以位元組為單位）) （包括所有標頭）。 它必須是 SectionAlignment 的倍數。 <br/>                                                                                                                                                                      |
| 60/60 <br/>    | 4 <br/>      | SizeOfHeaders <br/>               | MS-DOS 存根、PE 標頭和區段標頭的合併大小，四捨五入為 FileAlignment 的倍數。 <br/>                                                                                                                                                                                             |
| 64/64 <br/>    | 4 <br/>      | 校驗 <br/>                    | 影像檔案總和檢查碼。 計算總和檢查碼的演算法會併入 IMAGHELP.DLL 中。 系統會在載入時檢查下列各項的驗證：所有驅動程式、在開機時載入的任何 DLL，以及任何載入至重要 Windows 進程的 DLL。 <br/>                                          |
| 68/68 <br/>    | 2 <br/>      | Subsystem <br/>                   | 執行此映像所需的子系統。 如需詳細資訊，請參閱 [Windows 子系統](#windows-subsystem)。 <br/>                                                                                                                                                                                       |
| 70/70 <br/>    | 2 <br/>      | DllCharacteristics <br/>          | 如需詳細資訊，請參閱此規格稍後的 [DLL 特性](#dll-characteristics) 。 <br/>                                                                                                                                                                                                         |
| 72/72 <br/>    | 4/8 <br/>    | SizeOfStackReserve <br/>          | 要保留的堆疊大小。 僅認可 SizeOfStackCommit;其餘部分會一次提供一個頁面，直到達到保留大小為止。 <br/>                                                                                                                                                    |
| 76/80 <br/>    | 4/8 <br/>    | SizeOfStackCommit <br/>           | 要認可的堆疊大小。 <br/>                                                                                                                                                                                                                                                                           |
| 80/88 <br/>    | 4/8 <br/>    | SizeOfHeapReserve <br/>           | 要保留的區域堆積空間大小。 僅認可 SizeOfHeapCommit;其餘部分會一次提供一個頁面，直到達到保留大小為止。 <br/>                                                                                                                                          |
| 84/96 <br/>    | 4/8 <br/>    | SizeOfHeapCommit <br/>            | 要認可的區域堆積空間大小。 <br/>                                                                                                                                                                                                                                                                |
| 88/104 <br/>   | 4 <br/>      | LoaderFlags <br/>                 | Reserved，必須為零。 <br/>                                                                                                                                                                                                                                                                                    |
| 92/108 <br/>   | 4 <br/>      | NumberOfRvaAndSizes <br/>         | 選用標頭其餘部分中的資料目錄專案數目。 每一個都描述位置和大小。 <br/>                                                                                                                                                                                          |

##### <a name="windows-subsystem"></a>Windows 子系統

針對選擇性標頭的子系統欄位所定義的下列值，會決定執行映射所需的任何)  (的 Windows 子系統。

| 常數                                                  | 值          | 描述                                                      |
|-----------------------------------------------------------|----------------|------------------------------------------------------------------|
| 映射 \_ 子系統 \_ 不明 <br/>                     | 0 <br/>  | 未知的子系統 <br/>                                 |
| 映射 \_ 子系統 \_ 原生 <br/>                      | 1 <br/>  | 設備磁碟機和原生 Windows 進程 <br/>          |
| 映射 \_ 子系統 \_ WINDOWS \_ GUI <br/>                | 2 <br/>  | Windows 圖形化使用者介面 (GUI) 子系統 <br/> |
| 映射 \_ 子系統 \_ 視窗 \_ CUI <br/>                | 3 <br/>  | Windows 字元子系統 <br/>                      |
| 映射 \_ 子系統 \_ OS2 \_ CUI <br/>                    | 5 <br/>  | OS/2 字元子系統 <br/>                         |
| 映射 \_ 子系統 \_ POSIX \_ CUI <br/>                  | 7 <br/>  | Posix 字元子系統 <br/>                        |
| 映射 \_ 子系統 \_ 原生 \_ 視窗 <br/>             | 8 <br/>  | 原生的 Win9x 驅動程式 <br/>                                  |
| 映射 \_ 子系統 \_ WINDOWS \_ CE \_ GUI <br/>            | 9 <br/>  | Windows CE <br/>                                           |
| 映射 \_ 子系統 \_ EFI \_ 應用程式 <br/>            | 10 <br/> |  (EFI) 應用程式的可延伸韌體介面 <br/>   |
| 映射 \_ 子系統 \_ EFI \_ 開機 \_ 服務 \_ 驅動程式 <br/> | 11 <br/> | 具有開機服務的 EFI 驅動程式 <br/>                     |
| 映射 \_ 子系統 \_ EFI \_ 執行時間 \_ 驅動程式 <br/>       | 12 <br/> | EFI 驅動程式與執行時間服務 <br/>                 |
| 映射 \_ 子系統 \_ EFI \_ ROM <br/>                    | 13 <br/> | EFI ROM 映射 <br/>                                     |
| 映射 \_ 子系統 \_ XBOX <br/>                        | 14 <br/> | XBOX <br/>                                                 |
| 映射 \_ 子系統 \_ WINDOWS \_ 開機 \_ 應用程式 <br/>  | 16 <br/> | Windows 開機應用程式。 <br/>                            |

##### <a name="dll-characteristics"></a>DLL 特性

下列值是針對選擇性標頭的 DllCharacteristics 欄位所定義。

| 常數                                                             | 值              | 描述                                                                                             |
|----------------------------------------------------------------------|--------------------|---------------------------------------------------------------------------------------------------------|
|                                                                      | 0x0001 <br/> | Reserved，必須為零。 <br/>                                                                     |
|                                                                      | 0x0002 <br/> | Reserved，必須為零。 <br/>                                                                     |
|                                                                      | 0x0004 <br/> | Reserved，必須為零。 <br/>                                                                     |
|                                                                      | 0x0008 <br/> | Reserved，必須為零。 <br/>                                                                     |
| 影像 \_ DLLCHARACTERISTICS \_ 高 \_ 熵 \_ VA <br/>             | 0x0020 <br/> | 映射可以處理高熵64位虛擬位址空間。 <br/>                               |
| 影像 \_ DLLCHARACTERISTICS\_ <br/> 動態 \_ 基底 <br/>    | 0x0040 <br/> | DLL 可以在載入時重新置放。 <br/>                                                          |
| 影像 \_ DLLCHARACTERISTICS\_ <br/> 強制 \_ 完整性 <br/> | 0x0080 <br/> | 系統會強制執行程式碼完整性檢查。 <br/>                                                         |
| 影像 \_ DLLCHARACTERISTICS\_ <br/> NX \_ 相容性 <br/>       | 0x0100 <br/> | 影像與 NX 相容。 <br/>                                                                     |
| 映射 \_ DLLCHARACTERISTICS \_ 無 \_ 隔離 <br/>                | 0x0200 <br/> | 隔離感知，但不隔離映射。 <br/>                                              |
| 影像 \_ DLLCHARACTERISTICS \_ NO \_ SEH <br/>                      | 0x0400 <br/> | 不會使用結構化例外狀況 (SE) 處理。 在此影像中不能呼叫任何 SE 處理常式。 <br/> |
| 影像 \_ DLLCHARACTERISTICS \_ 沒有系結 \_ <br/>                     | 0x0800 <br/> | 請勿系結此映射。 <br/>                                                                      |
| 映射 \_ DLLCHARACTERISTICS \_ APPCONTAINER <br/>                  | 0x1000 <br/> | 映射必須在 AppContainer 中執行。 <br/>                                                      |
| 影像 \_ DLLCHARACTERISTICS \_ WDM \_ 驅動程式 <br/>                  | 0x2000 <br/> | WDM 驅動程式。 <br/>                                                                               |
| 影像 \_ DLLCHARACTERISTICS \_ 防護 \_ CF <br/>                     | 0x4000 <br/> | 映射支援控制流程防護。 <br/>                                                          |
| 影像 \_ DLLCHARACTERISTICS \_ 終端機 \_ 伺服器 \_ 感知 <br/>      | 0x8000 <br/> | 終端機伺服器感知。 <br/>                                                                      |

#### <a name="optional-header-data-directories-image-only"></a>選擇性的標頭資料目錄僅 (映射) 

每個資料目錄都會提供 Windows 所使用之資料表或字串的位址和大小。 這些資料目錄專案都會載入至記憶體中，讓系統可以在執行時間使用它們。 資料目錄是具有下列宣告的8位元組欄位：

```cpp
typedef struct _IMAGE_DATA_DIRECTORY {
    DWORD   VirtualAddress;
    DWORD   Size;
} IMAGE_DATA_DIRECTORY, *PIMAGE_DATA_DIRECTORY;
```

第一個欄位（VirtualAddress）實際上是資料表的 RVA。 當載入資料表時，RVA 是相對於影像基底位址的資料表位址。 第二個欄位會提供大小（以位元組為單位）。 下表列出資料目錄（形成選用標頭的最後一部分）。

請注意，目錄的數目並不固定。 在尋找特定目錄之前，請檢查選用標頭中的 NumberOfRvaAndSizes 欄位。

此外，請勿假設這個資料表中的 Rva 指向區段的開頭，或包含特定資料表的區段具有特定名稱。

| Offset (PE/PE32 +)    | 大小          | 欄位                               | 描述                                                                                                                                                                          |
|---------------------|---------------|-------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 96/112 <br/>  | 8 <br/> | 匯出資料表 <br/>            | 匯出資料表位址和大小。 如需詳細資訊，請參閱 [Edata 一節 (映射) ](#the-edata-section-image-only)。 <br/>                                                |
| 104/120 <br/> | 8 <br/> | 匯入資料表 <br/>            | 匯入資料表位址和大小。 如需詳細資訊，請參閱 [Idata 一節](#the-idata-section)。<br/>                                                                    |
| 112/128 <br/> | 8 <br/> | 資源表格 <br/>          | 資源資料表的位址和大小。 如需詳細資訊，請參閱 [.Rsrc 一節](#the-rsrc-section)。<br/>                                                                    |
| 120/136 <br/> | 8 <br/> | 例外狀況資料表 <br/>         | 例外狀況資料表位址和大小。 如需詳細資訊，請參閱 [.Pdata 一節](#the-pdata-section)。 <br/>                                                                |
| 128/144 <br/> | 8 <br/> | 憑證資料表 <br/>       | 屬性憑證表格位址和大小。 如需詳細資訊，請參閱 [屬性證書表 (只) 的映射 ](#the-attribute-certificate-table-image-only)。 <br/> |
| 136/152 <br/> | 8 <br/> | 基底重新配置資料表 <br/>   | 基底重新配置資料表位址和大小。 如需詳細資訊，請參閱 [Reloc 一節 (映射) ](#the-reloc-section-image-only)。<br/>                                   |
| 144/160 <br/> | 8 <br/> | 偵錯 <br/>                   | 起始位址和大小的 debug 資料。 如需詳細資訊，請參閱 [Debug 區段](#the-debug-section)。<br/>                                                             |
| 152/168 <br/> | 8 <br/> | 架構 <br/>            | 保留，必須為0 <br/>                                                                                                                                                      |
| 160/176 <br/> | 8 <br/> | 全域 Ptr <br/>              | 要儲存在全域指標暫存器中的值 RVA。 此結構的大小成員必須設定為零。 <br/>                                                 |
| 168/184 <br/> | 8 <br/> | TLS 資料表 <br/>               | 執行緒區域儲存 (TLS) 資料表位址和大小。 如需詳細資訊，請輸入 [Tls 區段](#the-tls-section)。<br/>                                                        |
| 176/192 <br/> | 8 <br/> | 載入設定資料表 <br/>       | 載入設定資料表位址和大小。 如需詳細資訊， [負載設定結構 (映射) ](#the-load-configuration-structure-image-only)。<br/>       |
| 184/200 <br/> | 8 <br/> | 系結匯入 <br/>            | 系結的匯入資料表位址和大小。 <br/>                                                                                                                                 |
| 192/208 <br/> | 8 <br/> | Iat <br/>                     | 匯入位址表格位址和大小。 如需詳細資訊，請參閱匯 [入位址表格](#import-address-table)。<br/>                                                 |
| 200/216 <br/> | 8 <br/> | 延遲匯入描述項 <br/> | 延遲匯入描述項位址和大小。 如需詳細資訊，請參閱 [僅限延遲載入匯入資料表 (映射) ](#delay-load-import-tables-image-only)。<br/>                    |
| 208/224 <br/> | 8 <br/> | CLR 執行時間標頭 <br/>      | CLR 執行時間標頭位址和大小。 如需詳細資訊，請參閱 [Cormeta 一節， (物件) ](#the-cormeta-section-object-only)。<br/>                                |
| 216/232 <br/> | 8 <br/> | 保留，必須為零 <br/>  |                                                                                                                                                                                      |

憑證資料表專案會指向屬性憑證的資料表。 這些憑證不會在映射中載入記憶體中。 因此，這個專案的第一個欄位（通常是 RVA）會改為檔案指標。

## <a name="section-table-section-headers"></a>區段資料表 (區段標題) 

- [區段旗標](#section-flags)
- [群組區段僅 (物件) ](#grouped-sections-object-only)

區段資料表中的每個資料列實際上都是區段標頭。 此資料表緊接在選用標頭之後（如果有的話）。 這個位置是必要的，因為檔案標頭未包含對區段資料表的直接指標。 相反地，區段資料表的位置是藉由計算標頭之後第一個位元組的位置來決定。 請務必使用檔案標頭中指定的選用標頭大小。

區段資料表中的專案數是由檔案標頭中的 NumberOfSections 欄位提供。 區段資料表中的專案會從一個 (1) 開始編號。 [程式碼] 和 [資料記憶體] 區段專案是以連結器選擇的順序排列。

在影像檔案中，區段的 VAs 必須由連結器指派，才能以遞增順序和連續的方式進行，而且它們必須是選擇性標頭中 SectionAlignment 值的倍數。

每個區段標題 (區段資料表專案) 具有下列格式，每個專案總共40個位元組。



| Offset         | 大小          | 欄位                            | 描述                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|----------------|---------------|----------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 8 <br/> | Name <br/>                 | 8位元組、以 null 填補的 UTF-8 編碼字串。 如果字串長度剛好為8個字元，則不會有結束的 null。 若為較長的名稱，此欄位包含斜線 (/) ，後面接著十進位數的 ASCII 標記法，即字串資料表中的位移。 可執行檔映射不會使用字串資料表，且不支援長度超過8個字元的區段名稱。 如果物件檔中的長名稱是發出至可執行檔，則會被截斷。 <br/>                                         |
| 8 <br/>  | 4 <br/> | VirtualSize <br/>          | 載入記憶體時區段的總大小。 如果這個值大於 SizeOfRawData，區段就會填補零。 此欄位僅適用于可執行檔映射，而且對於物件檔案應設為零。 <br/>                                                                                                                                                                                                                                                                                           |
| 12 <br/> | 4 <br/> | VirtualAddress <br/>       | 針對可執行檔映射，當區段載入記憶體時，相對於映射基底之區段第一個位元組的位址。 針對目的檔，此欄位是套用重新配置之前第一個位元組的位址;為了簡單起見，編譯器應該將此值設為零。 否則，它是在重新配置期間減去位移的任意值。 <br/>                                                                                                                                         |
| 16 <br/> | 4 <br/> | SizeOfRawData <br/>        | 物件檔案的區段大小 () 或磁片 (上的已初始化資料大小) 。 針對可執行檔映射，這必須是選擇性標頭中 FileAlignment 的倍數。 如果小於 VirtualSize，區段的其餘部分就會填滿零。 因為 SizeOfRawData 欄位已舍入，但 VirtualSize 欄位不是，所以 SizeOfRawData 也可能大於 VirtualSize。 當某個區段只包含未初始化的資料時，此欄位應為零。 <br/> |
| 20 <br/> | 4 <br/> | PointerToRawData <br/>     | COFF 檔案中區段的第一頁的檔案指標。 針對可執行檔映射，這必須是選擇性標頭中 FileAlignment 的倍數。 針對目的檔，此值應對齊4位元組的界限，以獲得最佳效能。 當某個區段只包含未初始化的資料時，此欄位應為零。 <br/>                                                                                                                                                                               |
| 24 <br/> | 4 <br/> | PointerToRelocations <br/> | 區段重新設定項目開頭的檔案指標。 這會針對可執行檔映射設定為零，或如果沒有重新置放則設定為零。 <br/>                                                                                                                                                                                                                                                                                                                                                                   |
| 28 <br/> | 4 <br/> | PointerToLinenumbers <br/> | 區段之行號專案開頭的檔案指標。 如果沒有 COFF 行號，這會設為零。 因為 COFF 偵錯工具資訊已被取代，所以影像的這個值應該為零。 <br/>                                                                                                                                                                                                                                                                                            |
| 32 <br/> | 2 <br/> | NumberOfRelocations <br/>  | 區段的重新設定項目數目。 這會針對可執行映射設定為零。 <br/>                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 34 <br/> | 2 <br/> | NumberOfLinenumbers <br/>  | 區段的行號專案數目。 因為 COFF 偵錯工具資訊已被取代，所以影像的這個值應該為零。 <br/>                                                                                                                                                                                                                                                                                                                                                                          |
| 36 <br/> | 4 <br/> | 特性 <br/>      | 描述區段特性的旗標。 如需詳細資訊，請參閱 [區段旗標](#section-flags)。<br/>                                                                                                                                                                                                                                                                                                                                                                                                |



 

### <a name="section-flags"></a>區段旗標

區段標頭的 [特性] 欄位中的區段旗標表示區段的特性。



| 旗標                                              | 值                  | 描述                                                                                                                                                                 |
|---------------------------------------------------|------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                                                   | 0x00000000 <br/> | 保留供未來使用。 <br/>                                                                                                                                        |
|                                                   | 0x00000001 <br/> | 保留供未來使用。 <br/>                                                                                                                                        |
|                                                   | 0x00000002 <br/> | 保留供未來使用。 <br/>                                                                                                                                        |
|                                                   | 0x00000004 <br/> | 保留供未來使用。 <br/>                                                                                                                                        |
| 影像 \_ SCN \_ 類型 \_ 無 \_ 板 <br/>             | 0x00000008 <br/> | 區段不應填補至下一個界限。 此旗標已淘汰，並由 IMAGE \_ SCN \_ ALIGN \_ 1BYTES 取代。 這僅適用于物件檔。 <br/> |
|                                                   | 0x00000010 <br/> | 保留供未來使用。 <br/>                                                                                                                                        |
| 影像 \_ SCN \_ CNT 程式 \_ 代碼 <br/>                 | 0x00000020 <br/> | 區段包含可執行程式碼。 <br/>                                                                                                                           |
| 映射 \_ SCN \_ CNT 已 \_ 初始化 \_ 資料 <br/>    | 0x00000040 <br/> | 區段包含已初始化的資料。 <br/>                                                                                                                          |
| 映射 \_ SCN \_ CNT \_ 未初始化的 \_ 資料 <br/> | 0x00000080 <br/> | 區段包含未初始化的資料。 <br/>                                                                                                                        |
| 影像 \_ SCN \_ .LNK \_ 其他 <br/>                | 0x00000100 <br/> | 保留供未來使用。 <br/>                                                                                                                                        |
| 影像 \_ SCN \_ .LNK \_ 資訊 <br/>                 | 0x00000200 <br/> | 區段包含批註或其他資訊。 Drectve 區段具有這個類型。 這僅適用于物件檔。 <br/>                                    |
|                                                   | 0x00000400 <br/> | 保留供未來使用。 <br/>                                                                                                                                        |
| 映射 \_ SCN \_ .LNK \_ 移除 <br/>               | 0x00000800 <br/> | 區段不會成為映射的一部分。 這僅適用于物件檔。 <br/>                                                                             |
| 影像 \_ SCN \_ .LNK \_ COMDAT <br/>               | 0x00001000 <br/> | 此區段包含 COMDAT 資料。 如需詳細資訊，請參閱 [僅 (物件) 的 COMDAT 章節 ](#comdat-sections-object-only)。 這僅適用于物件檔。 <br/> |
| 映射 \_ SCN \_ GPREL <br/>                     | 0x00008000 <br/> | 區段包含透過全域指標 (GP) 參考的資料。 <br/>                                                                                           |
| 映射 \_ SCN \_ 記憶體 \_ PURGEABLE <br/>            | 0x00020000 <br/> | 保留供未來使用。 <br/>                                                                                                                                        |
| 映射 \_ SCN \_ 記憶體 \_ 16BIT <br/>                | 0x00020000 <br/> | 保留供未來使用。 <br/>                                                                                                                                        |
| 影像 \_ SCN \_ 記憶體已 \_ 鎖定 <br/>               | 0x00040000 <br/> | 保留供未來使用。 <br/>                                                                                                                                        |
| 映射 \_ SCN \_ 記憶體 \_ 預先載入 <br/>              | 0x00080000 <br/> | 保留供未來使用。 <br/>                                                                                                                                        |
| 影像 \_ SCN \_ 對齊 \_ 1BYTES <br/>             | 0x00100000 <br/> | 將資料對齊1位元組的界限。 僅適用于物件檔。 <br/>                                                                                                   |
| 影像 \_ SCN \_ 對齊 \_ 2BYTES <br/>             | 0x00200000 <br/> | 將資料對齊2個位元組的界限。 僅適用于物件檔。 <br/>                                                                                                   |
| 影像 \_ SCN \_ 對齊 \_ 4BYTES <br/>             | 0x00300000 <br/> | 將資料對齊4位元組的界限。 僅適用于物件檔。 <br/>                                                                                                   |
| 影像 \_ SCN \_ 對齊 \_ 8BYTES <br/>             | 0x00400000 <br/> | 將資料對齊8位元組的界限。 僅適用于物件檔。 <br/>                                                                                                  |
| 影像 \_ SCN \_ 對齊 \_ 16BYTES <br/>            | 0x00500000 <br/> | 將資料對齊16位元組的界限。 僅適用于物件檔。 <br/>                                                                                                  |
| 影像 \_ SCN \_ 對齊 \_ 32BYTES <br/>            | 0x00600000 <br/> | 將資料對齊32位元組的界限。 僅適用于物件檔。 <br/>                                                                                                  |
| 影像 \_ SCN \_ 對齊 \_ 64BYTES <br/>            | 0x00700000 <br/> | 將資料對齊64位元組的界限。 僅適用于物件檔。 <br/>                                                                                                  |
| 影像 \_ SCN \_ 對齊 \_ 128BYTES <br/>           | 0x00800000 <br/> | 將資料對齊128位元組的界限。 僅適用于物件檔。 <br/>                                                                                                 |
| 影像 \_ SCN \_ 對齊 \_ 256BYTES <br/>           | 0x00900000 <br/> | 將資料對齊256位元組的界限。 僅適用于物件檔。 <br/>                                                                                                 |
| 影像 \_ SCN \_ 對齊 \_ 512BYTES <br/>           | 0x00A00000 <br/> | 將資料對齊512位元組的界限。 僅適用于物件檔。 <br/>                                                                                                 |
| 影像 \_ SCN \_ 對齊 \_ 1024BYTES <br/>          | 0x00B00000 <br/> | 將資料對齊1024位元組的界限。 僅適用于物件檔。 <br/>                                                                                                |
| 影像 \_ SCN \_ 對齊 \_ 2048BYTES <br/>          | 0x00C00000 <br/> | 將資料對齊2048位元組的界限。 僅適用于物件檔。 <br/>                                                                                                |
| 影像 \_ SCN \_ 對齊 \_ 4096BYTES <br/>          | 0x00D00000 <br/> | 將資料對齊4096位元組的界限。 僅適用于物件檔。 <br/>                                                                                                |
| 影像 \_ SCN \_ 對齊 \_ 8192BYTES <br/>          | 0x00E00000 <br/> | 將資料對齊8192位元組的界限。 僅適用于物件檔。 <br/>                                                                                               |
| 影像 \_ SCN \_ .LNK \_ NRELOC \_ OVFL <br/>         | 0x01000000 <br/> | 區段包含擴充重新置放。 <br/>                                                                                                                      |
| 映射 \_ SCN \_ 記憶體 \_ DISCARDABLE <br/>          | 0x02000000 <br/> | 您可以視需要捨棄區段。 <br/>                                                                                                                         |
| 未快取映射 \_ SCN \_ 記憶體 \_ \_ <br/>          | 0x04000000 <br/> | 無法快取區段。 <br/>                                                                                                                                   |
| 映射 \_ SCN \_ 記憶體 \_ 未 \_ 分頁 <br/>           | 0x08000000 <br/> | 區段不可分頁。 <br/>                                                                                                                                    |
| 共用的映射 \_ SCN \_ 記憶體 \_ <br/>               | 0x10000000 <br/> | 區段可以在記憶體中共用。 <br/>                                                                                                                            |
| 映射 \_ SCN \_ 記憶體 \_ 執行 <br/>              | 0x20000000 <br/> | 區段可以用程式碼的形式執行。 <br/>                                                                                                                            |
| 映射 \_ SCN \_ 記憶體 \_ 讀取 <br/>                 | 0x40000000 <br/> | 可以讀取區段。 <br/>                                                                                                                                        |
| 映射 \_ SCN \_ 記憶體 \_ 寫入 <br/>                | 0x80000000 <br/> | 區段可以寫入。 <br/>                                                                                                                                  |



 

IMAGE \_ SCN \_ .Lnk \_ NRELOC \_ OVFL 指出區段的重新置放計數超過在區段標頭中保留的16個位。 如果設定位，而且區段標頭中的 NumberOfRelocations 欄位是0xffff，則實際的重新配置計數會儲存在第一次重新配置的32位 VirtualAddress 欄位中。 如果設定了 IMAGE \_ SCN \_ .Lnk \_ NRELOC \_ OVFL，而且區段中的重新置放少於0xffff，就會發生錯誤。

### <a name="grouped-sections-object-only"></a>群組區段僅 (物件) 

"$"？ 字元 (貨幣正負號) 在物件檔案的區段名稱中有特殊的解讀。

當您決定將包含物件區段內容的影像區段時，連結器會捨棄 "$"？ 和其後的所有字元。 因此，名為的物件區段。**text $ X** 實際上會參與影像中的 **text 區段。**

不過，"$" 後面的字元？ 判斷對影像區段的貢獻順序。 所有具有相同物件區段名稱的投稿都會連續配置於影像中，而投稿區塊會依物件區段名稱以詞法順序排序。 因此，具有 **區段名稱的** 目的檔中的所有專案都會在 **. text $ W** 投稿內容之後，以及在 **. text $ Y** 投稿內容之前。

影像檔案中的區段名稱絕不會包含 "$"？ 字元之後。

## <a name="other-contents-of-the-file"></a>檔案的其他內容

- [區段資料](#section-data)
- [COFF 僅 (物件的重新置放) ](#coff-relocations-object-only)
  - [類型指標](#type-indicators)
- [ (已淘汰的 COFF 行號) ](#coff-line-numbers-deprecated)
- [COFF 符號表](#coff-symbol-table)
  - [符號名稱標記法](#symbol-name-representation)
  - [區段編號值](#section-number-values)
  - [類型標記法](#type-representation)
  - [儲存類別](#storage-class)
- [輔助符號記錄](#auxiliary-symbol-records)
  - [輔助格式1：函式定義](#auxiliary-format-1-function-definitions)
  - [輔助格式2：. bf 和 ef 符號](#auxiliary-format-2-bf-and-ef-symbols)
  - [輔助格式3：弱式外部](#auxiliary-format-3-weak-externals)
  - [輔助格式4：檔案](#auxiliary-format-4-files)
  - [輔助格式5：區段定義](#auxiliary-format-5-section-definitions)
  - [COMDAT 區段僅 (物件) ](#comdat-sections-object-only)
  - [CLR 權杖定義僅 (物件) ](#clr-token-definition-object-only)
- [COFF 字串資料表](#coff-string-table)
- [屬性證書表只 (映射) ](#the-attribute-certificate-table-image-only)
  - [憑證資料](#certificate-data)
- [延遲-僅將匯入資料表載入 (映射) ](#delay-load-import-tables-image-only)
  - [Delay-Load Directory 資料表](#the-delay-load-directory-table)
  - [屬性](#attributes)
  - [名稱](#name)
  - [模組控制碼](#module-handle)
  - [延遲匯入位址表](#delay-import-address-table)
  - [延遲匯入名稱資料表](#delay-import-name-table)
  - [延遲系結匯入位址資料表和時間戳記](#delay-bound-import-address-table-and-time-stamp)
  - [延遲卸載匯入位址表](#delay-unload-import-address-table)

截至目前為止所描述的資料結構（最多可包含選擇性標頭）都位於檔案開頭的固定位移 (或從 PE 標頭中，如果檔案是包含 MS-DOS 存根) 的映射。

COFF 物件或影像檔的其餘部分包含不一定是任何特定檔案位移的資料區塊。 而是透過選擇性標頭或區段標頭中的指標來定義位置。

SectionAlignment 值小於架構的頁面大小 (4 K 適用于 Intel x86 和 MIPS 的影像，以及適用于 Itanium) 的 8 K 的影像除外。 如需 SectionAlignment 的說明，請參閱 [選擇性標頭 (僅) 的影像 ](#optional-header-image-only)。 在此情況下，區段資料的檔案位移上有條件約束，如「區段資料」5.1 一節中所述。 另一個例外狀況是，屬性憑證和偵錯工具資訊必須放在影像檔案的結尾，並在 [偵錯工具] 區段前面加上屬性憑證表格，因為載入器不會將這些屬性對應到記憶體。 但是，屬性憑證和調試資訊的規則不會套用至物件檔案。

### <a name="section-data"></a>區段資料

區段的初始化資料是由簡單的位元組區塊所組成。 不過，對於包含所有零的區段而言，不需要包含資料區段。

每個區段的資料都位於區段標頭中 PointerToRawData 欄位所提供的檔案位移。 檔案中的此資料大小會以 SizeOfRawData 欄位表示。 如果 SizeOfRawData 小於 VirtualSize，其餘部分會以零填補。

在影像檔案中，區段資料必須依照選擇性標頭中 FileAlignment 欄位所指定的界限對齊。 區段資料必須以對應區段的 RVA 值順序出現， (與) 一節中的個別區段標頭相同。

如果選擇性標頭中的 SectionAlignment 值小於架構的頁面大小，則影像檔案會有額外的限制。 針對這類檔案，在載入映射時，檔案中區段資料的位置必須符合其在記憶體中的位置，讓區段資料的實體位移與 RVA 相同。

### <a name="coff-relocations-object-only"></a>COFF 僅 (物件的重新置放) 

目的檔包含 COFF 重新置放，可指定在放置在影像檔案中並接著載入至記憶體時，應如何修改區段資料。

影像檔案不包含 COFF 重新置放，因為所有參考的符號都已指派給一般位址空間中的位址。 影像會以 reloc 區段中的基底重新置放格式來包含重新配置資訊 (除非影像 \_ \_ RELOCS 移除 \_ 屬性) 。 如需詳細資訊，請參閱 [Reloc 一節 (映射) ](#the-reloc-section-image-only)。

針對物件檔案中的每個區段，固定長度記錄的陣列會保存區段的 COFF 重新置放。 陣列的位置和長度是在區段標頭中指定。 陣列的每個元素都具有下列格式。



| Offset        | 大小          | 欄位                        | 描述                                                                                                                                                                                                                                                                                                                                                     |
|---------------|---------------|------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/> | 4 <br/> | VirtualAddress <br/>   | 要套用重新配置的專案位址。 這是區段開頭的位移，加上區段的 RVA/Offset 欄位的值。 請參閱 [區段表格 (區段標題) ](#section-table-section-headers)。 例如，如果區段的第一個位元組具有0x10 的位址，則第三個位元組的位址會是0x12。 <br/> |
| 4 <br/> | 4 <br/> | SymbolTableIndex <br/> | 符號表中以零為基底的索引。 這個符號會提供要用於重新配置的位址。 如果指定的符號具有 section 儲存類別，則符號的位址就是具有相同名稱之第一個區段的位址。 <br/>                                                                                                 |
| 8 <br/> | 2 <br/> | 類型 <br/>             | 值，指出應該執行的重新配置類型。 有效的重新配置類型取決於電腦類型。 請參閱 [類型](#type-indicators)指標。 <br/>                                                                                                                                                                                     |



 

如果 SymbolTableIndex 欄位所參考的符號具有 [儲存類別影像 \_ SYM 類別] \_ \_ 區段，符號的位址就是區段的開頭。 區段通常會在相同的檔案中，但物件檔案是封存 (程式庫) 的一部分。 在此情況下，您可以在封存中的任何其他目的檔中找到此區段，該檔案的封存成員名稱與目前的物件檔案相同。  (與封存成員名稱之間的關聯性，是在匯入資料表的連結中使用，也就是 idata 區段。 ) 

#### <a name="type-indicators"></a>類型指標

重新配置記錄的類型欄位指出應該執行的重新配置類型。 針對每一種類型的電腦定義不同的重新配置類型。

##### <a name="x64-processors"></a>x64 處理器

下列為 x64 和相容處理器定義的重新配置類型指標。



| 常數                                | 值              | 描述                                                                                                                                                   |
|-----------------------------------------|--------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 影像 \_ REL \_ AMD64 \_ 絕對 <br/> | 0x0000 <br/> | 重新配置會被忽略。 <br/>                                                                                                                        |
| 影像 \_ REL \_ AMD64 \_ ADDR64 <br/>   | 0x0001 <br/> | 重新配置目標的64位 VA。 <br/>                                                                                                           |
| 影像 \_ REL \_ AMD64 \_ ADDR32 <br/>   | 0x0002 <br/> | 重新配置目標的32位 VA。 <br/>                                                                                                           |
| 影像 \_ REL \_ AMD64 \_ ADDR32NB <br/> | 0x0003 <br/> | 沒有映射基底 (RVA) 的32位位址。 <br/>                                                                                                   |
| 影像 \_ REL \_ AMD64 \_ REL32 <br/>    | 0x0004 <br/> | 重新配置之後的位元組中的32位相對位址。 <br/>                                                                               |
| 影像 \_ REL \_ AMD64 \_ REL32 \_ 1 <br/> | 0x0005 <br/> | 從重新配置開始，相對於位元組距離1的32位位址。 <br/>                                                                               |
| 影像 \_ REL \_ AMD64 \_ REL32 \_ 2 <br/> | 0x0006 <br/> | 從重新配置開始，相對於位元組距離2的32位位址。 <br/>                                                                               |
| 影像 \_ REL \_ AMD64 \_ REL32 \_ 3 <br/> | 0x0007 <br/> | 從重新配置開始，相對於位元組距離3的32位位址。 <br/>                                                                               |
| 影像 \_ REL \_ AMD64 \_ REL32 \_ 4 <br/> | 0x0008 <br/> | 從重新配置開始，相對於位元組距離4的32位位址。 <br/>                                                                               |
| 影像 \_ REL \_ AMD64 \_ REL32 \_ 5 <br/> | 0x0009 <br/> | 相對於重新配置中位元組距離5的32位位址。 <br/>                                                                               |
| 影像 \_ REL \_ AMD64 \_ 區段 <br/>  | 0x000A <br/> | 包含目標之區段的16位區段索引。 這是用來支援偵錯工具資訊。 <br/>                                  |
| 影像 \_ REL \_ AMD64 \_ SECREL <br/>   | 0x000B <br/> | 目標在其區段開頭的32位位移。 這是用來支援偵錯工具資訊和靜態執行緒區域儲存區。 <br/> |
| 影像 \_ REL \_ AMD64 \_ SECREL7 <br/>  | 0x000C <br/> | 包含目標之區段基底的7位不帶正負號位移。 <br/>                                                                    |
| 影像 \_ REL \_ AMD64 \_ TOKEN <br/>    | 0x000D <br/> | CLR 標記。 <br/>                                                                                                                                       |
| 影像 \_ REL \_ AMD64 \_ SREL32 <br/>   | 0x000E <br/> | 發出至物件的32位帶正負號的範圍相依值。 <br/>                                                                                     |
| 影像 \_ REL \_ AMD64 \_ 配對 <br/>     | 0x000F <br/> | 必須緊接在每個範圍相依值之後的配對。 <br/>                                                                                   |
| 影像 \_ REL \_ AMD64 \_ SSPAN32 <br/>  | 0x0010 <br/> | 在連結時套用的32位帶正負號的範圍相依值。 <br/>                                                                                |



 

##### <a name="arm-processors"></a>ARM 處理器

下列為 ARM 處理器定義的重新配置類型指標。



| 常數                                | 值              | 描述                                                                                                                                                                                                                                                            |
|-----------------------------------------|--------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 影像 \_ REL \_ ARM \_ 絕對 <br/>   | 0x0000 <br/> | 重新配置會被忽略。 <br/>                                                                                                                                                                                                                                 |
| 影像 \_ REL \_ ARM \_ ADDR32 <br/>     | 0x0001 <br/> | 目標的32位 VA。 <br/>                                                                                                                                                                                                                               |
| 影像 \_ REL \_ ARM \_ ADDR32NB <br/>   | 0x0002 <br/> | 目標的32位 RVA。 <br/>                                                                                                                                                                                                                              |
| 影像 \_ REL \_ ARM \_ BRANCH24 <br/>   | 0x0003 <br/> | 目標的24位相對位移。 <br/>                                                                                                                                                                                                            |
| 影像 \_ REL \_ ARM \_ BRANCH11 <br/>   | 0x0004 <br/> | 副程式呼叫的參考。 參考包含具有11位位移的 2 16 位指令。 <br/>                                                                                                                                                 |
| 影像 \_ REL \_ ARM \_ REL32 <br/>      | 0x000A <br/> | 重新配置之後的位元組中的32位相對位址。 <br/>                                                                                                                                                                                        |
| 影像 \_ REL \_ ARM \_ 區段 <br/>    | 0x000E <br/> | 包含目標之區段的16位區段索引。 這是用來支援偵錯工具資訊。 <br/>                                                                                                                                           |
| 影像 \_ REL \_ ARM \_ SECREL <br/>     | 0x000F <br/> | 目標在其區段開頭的32位位移。 這是用來支援偵錯工具資訊和靜態執行緒區域儲存區。 <br/>                                                                                                          |
| 影像 \_ REL \_ ARM \_ MOV32 <br/>      | 0x0010 <br/> | 目標的32位 VA。 這項重新配置的套用方式是使用低16位的 MOVW 指令，後面接著高16位的 MOVT。 <br/>                                                                                                              |
| 影像 \_ REL \_ THUMB \_ MOV32 <br/>    | 0x0011 <br/> | 目標的32位 VA。 這項重新配置的套用方式是使用低16位的 MOVW 指令，後面接著高16位的 MOVT。 <br/>                                                                                                              |
| 影像 \_ REL \_ THUMB \_ BRANCH20 <br/> | 0x0012 <br/> | 此指令會以與2位元組對齊之目標的21位相對位移來修正。 位移的最小位一律為零，且不會儲存。 此重新配置對應于 Thumb-2 32 位條件 B 指令。 <br/> |
| 未使用 <br/>                      | 0x0013 <br/> |                                                                                                                                                                                                                                                                        |
| 影像 \_ REL \_ THUMB \_ BRANCH24 <br/> | 0x0014 <br/> | 此指令會以與2位元組對齊之目標的25位相對位移來修正。 取代的最小位是零，且不會儲存。此重新配置對應至 Thumb-2 B 指令。 <br/>                            |
| 影像 \_ REL \_ THUMB \_ BLX23 <br/>    | 0x0015 <br/> | 此指令會以25位的相對位移與4位元組對齊的目標進行修正。 位移的低2位為零，且不會儲存。 <br/> 此重新配置對應至 Thumb-2 BLX 指令。 <br/>                      |
| 影像 \_ REL \_ ARM \_ 配對 <br/>       | 0x0016 <br/> | 重新配置只有在緊接在 ARM \_ REFHI 或 THUMB REFHI 之後才有效 \_ 。 其 SymbolTableIndex 包含替代，而不是符號資料表中的索引。 <br/>                                                                                |



 

##### <a name="arm64-processors"></a>ARM64 處理器

下列為 ARM64 處理器定義的重新配置類型指標。



| 常數                                       | 值              | 描述                                                                                                                                                   |
|------------------------------------------------|--------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 影像 \_ REL \_ ARM64 \_ 絕對 <br/>        | 0x0000 <br/> | 重新配置會被忽略。 <br/>                                                                                                                        |
| 影像 \_ REL \_ ARM64 \_ ADDR32 <br/>          | 0x0001 <br/> | 目標的32位 VA。 <br/>                                                                                                                      |
| 影像 \_ REL \_ ARM64 \_ ADDR32NB <br/>        | 0x0002 <br/> | 目標的32位 RVA。 <br/>                                                                                                                     |
| 影像 \_ REL \_ ARM64 \_ BRANCH26 <br/>        | 0x0003 <br/> | 對目標的26位相對位移，適用于 B 和 BL 的指示。 <br/>                                                                        |
| 影像 \_ REL \_ ARM64 \_ PAGEBASE \_ REL21 <br/> | 0x0004 <br/> | 目標的頁面基底（適用于 ADRP 指令）。 <br/>                                                                                                |
| 影像 \_ REL \_ ARM64 \_ REL21 <br/>           | 0x0005 <br/> | 目標的12位相對位移，適用于指示 ADR <br/>                                                                               |
| 影像 \_ REL \_ ARM64 \_ PAGEOFFSET \_ 12A <br/> | 0x0006 <br/> | 目標的12位頁面位移，適用于指示新增/新增 (立即) 零位移。 <br/>                                                      |
| 影像 \_ REL \_ ARM64 \_ PAGEOFFSET \_ 12L <br/> | 0x0007 <br/> | 目標的12位頁面位移，適用于指令 LDR (索引、不帶正負號的立即) 。 <br/>                                                          |
| 影像 \_ REL \_ ARM64 \_ SECREL <br/>          | 0x0008 <br/> | 目標在其區段開頭的32位位移。 這是用來支援偵錯工具資訊和靜態執行緒區域儲存區。 <br/> |
| 影像 \_ REL \_ ARM64 \_ SECREL \_ LOW12A <br/>  | 0x0009 <br/> | 目標之區段位移的位0:11，如需新增/新增 (立即) 零班的指示。 <br/>                                                  |
| 影像 \_ REL \_ ARM64 \_ SECREL \_ HIGH12A <br/> | 0x000A <br/> | 目標之區段位移的位12:23，如需新增/新增 (立即) 零班的指示。 <br/>                                                 |
| 影像 \_ REL \_ ARM64 \_ SECREL \_ LOW12L <br/>  | 0x000B <br/> | 目標之區段位移的位0:11，適用于指令 LDR (索引、不帶正負號的立即) 。 <br/>                                                      |
| 影像 \_ REL \_ ARM64 \_ TOKEN <br/>           | 0x000C <br/> | CLR token。 <br/>                                                                                                                                        |
| 影像 \_ REL \_ ARM64 \_ 區段 <br/>         | 0x000D <br/> | 包含目標之區段的16位區段索引。 這是用來支援偵錯工具資訊。 <br/>                                  |
| 影像 \_ REL \_ ARM64 \_ ADDR64 <br/>          | 0x000E <br/> | 重新配置目標的64位 VA。 <br/>                                                                                                           |
| 影像 \_ REL \_ ARM64 \_ BRANCH19 <br/>        | 0x000F <br/> | 適用于條件 B 指令之重新配置目標的19位位移。 <br/>                                                                        |
| 影像 \_ REL \_ ARM64 \_ BRANCH14 <br/>        | 0x0010 <br/> | 重新配置目標的14位位移，以取得 TBZ 和 TBNZ 的指示。 <br/>                                                                        |
| 影像 \_ REL \_ ARM64 \_ REL32 <br/>           | 0x0011 <br/> | 重新配置之後的位元組中的32位相對位址。 <br/>                                                                               |

##### <a name="hitachi-superh-processors"></a>Hitachi SuperH 處理器

下列為 SH3 和 SH4 處理器定義的重新配置類型指標。 SH5 特定的重新置放會注明為具有下列 SHM (SH 媒體) 。



| 常數                                      | 值              | 描述                                                                                                                                                                                                                |
|-----------------------------------------------|--------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 影像 \_ REL \_ SH3 \_ 絕對 <br/>         | 0x0000 <br/> | 重新配置會被忽略。 <br/>                                                                                                                                                                                     |
| 影像 \_ REL \_ SH3 \_ DIRECT16 <br/>         | 0x0001 <br/> | 16位位置的參考，其中包含目標符號的 VA。 <br/>                                                                                                                                  |
| 影像 \_ REL \_ SH3 \_ DIRECT32 <br/>         | 0x0002 <br/> | 目標符號的32位 VA。 <br/>                                                                                                                                                                            |
| 影像 \_ REL \_ SH3 \_ DIRECT8 <br/>          | 0x0003 <br/> | 8位位置的參考，其中包含目標符號的 VA。 <br/>                                                                                                                                   |
| 影像 \_ REL \_ SH3 \_ DIRECT8 \_ WORD <br/>    | 0x0004 <br/> | 8位指令的參考，其中包含目標符號的有效16位 VA。 <br/>                                                                                                               |
| 影像 \_ REL \_ SH3 \_ DIRECT8 \_ LONG <br/>    | 0x0005 <br/> | 8位指令的參考，其中包含目標符號的有效32位 VA。 <br/>                                                                                                               |
| 影像 \_ REL \_ SH3 \_ DIRECT4 <br/>          | 0x0006 <br/> | 8位位置的參考，其低4位包含目標符號的 VA。 <br/>                                                                                                                        |
| 影像 \_ REL \_ SH3 \_ DIRECT4 \_ WORD <br/>    | 0x0007 <br/> | 8位指令的參考，其低4位包含目標符號的有效16位 VA。 <br/>                                                                                                    |
| 影像 \_ REL \_ SH3 \_ DIRECT4 \_ LONG <br/>    | 0x0008 <br/> | 8位指令的參考，其低4位包含目標符號的有效32位 VA。 <br/>                                                                                                    |
| 影像 \_ REL \_ SH3 \_ PCREL8 \_ WORD <br/>     | 0x0009 <br/> | 8位指令的參考，其中包含目標符號的有效16位相對位移。 <br/>                                                                                                  |
| 影像 \_ REL \_ SH3 \_ PCREL8 \_ LONG <br/>     | 0x000A <br/> | 8位指令的參考，其中包含目標符號的有效32位相對位移。 <br/>                                                                                                  |
| 影像 \_ REL \_ SH3 \_ PCREL12 \_ WORD <br/>    | 0x000B <br/> | 16位指令的參考，其低12位包含目標符號的有效16位相對位移。 <br/>                                                                                     |
| 影像 \_ REL \_ SH3 \_ STARTOF \_ 區段 <br/> | 0x000C <br/> | 32位位置的參考，這是包含目標符號之區段的 VA。 <br/>                                                                                                                |
| 影像 \_ REL \_ SH3 \_ SIZEOF \_ 區段 <br/>  | 0x000D <br/> | 32位位置的參考，這是包含目標符號之區段的大小。 <br/>                                                                                                            |
| 影像 \_ REL \_ SH3 \_ 區段 <br/>          | 0x000E <br/> | 包含目標之區段的16位區段索引。 這是用來支援偵錯工具資訊。 <br/>                                                                                               |
| 影像 \_ REL \_ SH3 \_ SECREL <br/>           | 0x000F <br/> | 目標在其區段開頭的32位位移。 這是用來支援偵錯工具資訊和靜態執行緒區域儲存區。 <br/>                                                              |
| 影像 \_ REL \_ SH3 \_ DIRECT32 \_ NB <br/>     | 0x0010 <br/> | 目標符號的32位 RVA。 <br/>                                                                                                                                                                           |
| 影像 \_ REL \_ SH3 \_ GPREL4 \_ LONG <br/>     | 0x0011 <br/> | GP 相關。 <br/>                                                                                                                                                                                                   |
| 影像 \_ REL \_ SH3 \_ TOKEN <br/>            | 0x0012 <br/> | CLR token。 <br/>                                                                                                                                                                                                     |
| 影像 \_ REL \_ 具有下列 SHM \_ PCRELPT <br/>          | 0x0013 <br/> | Longwords 中目前指令的位移。 如果未設定 NOMODE 位，請在 bit 32 插入低位的反向，以選取 PTA 或 PTB。 <br/>                                                          |
| 影像 \_ REL \_ 具有下列 SHM \_ REFLO <br/>            | 0x0014 <br/> | 32位位址的低16位。 <br/>                                                                                                                                                                         |
| 影像 \_ REL \_ 具有下列 SHM \_ REFHALF <br/>          | 0x0015 <br/> | 32位位址的高16位。 <br/>                                                                                                                                                                        |
| 影像 \_ REL \_ 具有下列 SHM \_ RELLO <br/>            | 0x0016 <br/> | 相對位址的低16位。 <br/>                                                                                                                                                                       |
| 影像 \_ REL \_ 具有下列 SHM \_ RELHALF <br/>          | 0x0017 <br/> | 相對位址的高16位。 <br/>                                                                                                                                                                      |
| 影像 \_ REL \_ 具有下列 SHM \_ 配對 <br/>             | 0x0018 <br/> | 重新配置只有在緊接在 REFHALF、RELHALF 或 RELLO 重新配置之後才有效。 重新配置的 SymbolTableIndex 欄位包含替代，而不是符號資料表中的索引。 <br/> |
| 影像 \_ REL \_ 具有下列 SHM \_ NOMODE <br/>           | 0x8000 <br/> | 重新配置會忽略區段模式。 <br/>                                                                                                                                                                           |



 

##### <a name="ibm-powerpc-processors"></a>IBM PowerPC 處理器

下列為 PowerPC 處理器定義的重新配置類型指標。



| 常數                              | 值              | 描述                                                                                                                                                                                                                                                                                                                                                                         |
|---------------------------------------|--------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 影像 \_ REL \_ PPC \_ 絕對 <br/> | 0x0000 <br/> | 重新配置會被忽略。 <br/>                                                                                                                                                                                                                                                                                                                                              |
| 影像 \_ REL \_ PPC \_ ADDR64 <br/>   | 0x0001 <br/> | 目標的64位 VA。 <br/>                                                                                                                                                                                                                                                                                                                                            |
| 影像 \_ REL \_ PPC \_ ADDR32 <br/>   | 0x0002 <br/> | 目標的32位 VA。 <br/>                                                                                                                                                                                                                                                                                                                                            |
| 影像 \_ REL \_ PPC \_ ADDR24 <br/>   | 0x0003 <br/> | 目標 VA 的低24位。 只有當目標符號是絕對的，且可以將其簽章延伸至其原始值時，這個值才有效。 <br/>                                                                                                                                                                                                                          |
| 影像 \_ REL \_ PPC \_ ADDR16 <br/>   | 0x0004 <br/> | 目標 VA 的低16位。 <br/>                                                                                                                                                                                                                                                                                                                                     |
| 影像 \_ REL \_ PPC \_ ADDR14 <br/>   | 0x0005 <br/> | 目標 VA 的低14位。 只有當目標符號是絕對的，且可以將其簽章延伸至其原始值時，這個值才有效。 <br/>                                                                                                                                                                                                                               |
| 影像 \_ REL \_ PPC \_ REL24 <br/>    | 0x0006 <br/> | 符號位置的24位電腦相對位移。 <br/>                                                                                                                                                                                                                                                                                                                   |
| 影像 \_ REL \_ PPC \_ REL14 <br/>    | 0x0007 <br/> | 與符號位置的14位電腦相對位移。 <br/>                                                                                                                                                                                                                                                                                                                   |
| 影像 \_ REL \_ PPC \_ ADDR32NB <br/> | 0x000A <br/> | 目標的32位 RVA。 <br/>                                                                                                                                                                                                                                                                                                                                           |
| 影像 \_ REL \_ PPC \_ SECREL <br/>   | 0x000B <br/> | 目標在其區段開頭的32位位移。 這是用來支援偵錯工具資訊和靜態執行緒區域儲存區。 <br/>                                                                                                                                                                                                                       |
| 影像 \_ REL \_ PPC \_ 區段 <br/>  | 0x000C <br/> | 包含目標之區段的16位區段索引。 這是用來支援偵錯工具資訊。 <br/>                                                                                                                                                                                                                                                        |
| 影像 \_ REL \_ PPC \_ SECREL16 <br/> | 0x000F <br/> | 目標在其區段開頭的16位位移。 這是用來支援偵錯工具資訊和靜態執行緒區域儲存區。 <br/>                                                                                                                                                                                                                       |
| 影像 \_ REL \_ PPC \_ REFHI <br/>    | 0x0010 <br/> | 目標32位 VA 的高16位。 這會用於載入完整位址之雙指令序列中的第一個指令。 此重新配置必須緊接在其 SymbolTableIndex 包含帶正負號的16位位移，且該位移會新增至從正在重新放置之位置取得的16位位移。 <br/> |
| 影像 \_ REL \_ PPC \_ REFLO <br/>    | 0x0011 <br/> | 目標 VA 的低16位。 <br/>                                                                                                                                                                                                                                                                                                                                     |
| 影像 \_ REL \_ PPC \_ 配對 <br/>     | 0x0012 <br/> | 只有在緊接在 REFHI 或 SECRELHI 重新配置之後才會生效的重新配置。 其 SymbolTableIndex 包含替代，而不是符號資料表中的索引。 <br/>                                                                                                                                                                                        |
| 影像 \_ REL \_ PPC \_ SECRELLO <br/> | 0x0013 <br/> | 目標自其區段開頭的32位位移的低16位。 <br/>                                                                                                                                                                                                                                                                                   |
| 影像 \_ REL \_ PPC \_ GPREL <br/>    | 0x0015 <br/> | 目標的16位帶正負號的位移（相對於 GP 登錄）。 <br/>                                                                                                                                                                                                                                                                                               |
| 影像 \_ REL \_ PPC \_ TOKEN <br/>    | 0x0016 <br/> | CLR token。 <br/>                                                                                                                                                                                                                                                                                                                                                          |



 

##### <a name="intel-386-processors"></a>Intel 386 處理器

下列為 Intel 386 和相容處理器定義的重新配置類型指標。



| 常數                               | 值              | 描述                                                                                                                                                   |
|----------------------------------------|--------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 影像 \_ REL \_ I386 的 \_ 絕對 <br/> | 0x0000 <br/> | 重新配置會被忽略。 <br/>                                                                                                                        |
| 影像 \_ REL \_ I386 \_ DIR16 <br/>    | 0x0001 <br/> | 不支援。 <br/>                                                                                                                                    |
| 影像 \_ REL \_ I386 \_ REL16 <br/>    | 0x0002 <br/> | 不支援。 <br/>                                                                                                                                    |
| 影像 \_ REL \_ I386 \_ DIR32 <br/>    | 0x0006 <br/> | 目標的32位 VA。 <br/>                                                                                                                           |
| 影像 \_ REL \_ I386 \_ DIR32NB <br/>  | 0x0007 <br/> | 目標的32位 RVA。 <br/>                                                                                                                          |
| 影像 \_ REL \_ I386 \_ SEG12 <br/>    | 0x0009 <br/> | 不支援。 <br/>                                                                                                                                    |
| 影像 \_ REL \_ I386 \_ 區段 <br/>  | 0x000A <br/> | 包含目標之區段的16位區段索引。 這是用來支援偵錯工具資訊。 <br/>                                  |
| 影像 \_ REL \_ I386 \_ SECREL <br/>   | 0x000B <br/> | 目標在其區段開頭的32位位移。 這是用來支援偵錯工具資訊和靜態執行緒區域儲存區。 <br/> |
| 影像 \_ REL \_ I386 \_ TOKEN <br/>    | 0x000C <br/> | CLR token。 <br/>                                                                                                                                    |
| 影像 \_ REL \_ I386 \_ SECREL7 <br/>  | 0x000D <br/> | 包含目標之區段基底的7位位移。 <br/>                                                                             |
| 影像 \_ REL \_ I386 \_ REL32 <br/>    | 0x0014 <br/> | 目標的32位相對位移。 這支援 x86 相對分支和呼叫指示。 <br/>                                      |



 

##### <a name="intel-itanium-processor-family-ipf"></a>Intel Itanium 處理器系列產品 (IPF)

下列為 Intel Itanium 處理器系列和相容處理器定義的重新配置類型指標。 請注意，重新置放指示會使用組合的位移和位置號碼來進行重新配置位移。



| 常數                                 | 值              | 描述                                                                                                                                                                                                                                                                                                                                     |
|------------------------------------------|--------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 影像 \_ REL \_ IA64 \_ 絕對 <br/>   | 0x0000 <br/> | 重新配置會被忽略。 <br/>                                                                                                                                                                                                                                                                                                          |
| 影像 \_ REL \_ IA64 \_ IMM14 <br/>      | 0x0001 <br/> | 指令重新配置後面可以接著加數重新配置，其值會在插入至 IMM14 組合的指定位置之前，先新增至目標位址。 重新配置目標必須是絕對的或必須固定的映射。 <br/>                                                                                 |
| 影像 \_ REL \_ IA64 \_ IMM22 <br/>      | 0x0002 <br/> | 指令重新配置後面可以接著加數重新配置，其值會在插入至 IMM22 組合的指定位置之前，先新增至目標位址。 重新配置目標必須是絕對的或必須固定的映射。 <br/>                                                                                 |
| 影像 \_ REL \_ IA64 \_ IMM64 <br/>      | 0x0003 <br/> | 此重新配置的插槽號碼必須是一個 (1) 。 重新配置後面可以接著加數重新配置，其值會在儲存于 IMM64 組合的所有三個位置之前，先新增至目標位址。 <br/>                                                                                                                   |
| 影像 \_ REL \_ IA64 \_ DIR32 <br/>      | 0x0004 <br/> | 目標的32位 VA。 只支援/LARGEADDRESSAWARE：沒有映射。 <br/>                                                                                                                                                                                                                                                    |
| 影像 \_ REL \_ IA64 \_ DIR64 <br/>      | 0x0005 <br/> | 目標的64位 VA。 <br/>                                                                                                                                                                                                                                                                                                             |
| 影像 \_ REL \_ IA64 \_ PCREL21B <br/>   | 0x0006 <br/> | 此指令會以與16位對齊目標的25位相對位移來修正。 位移的低4位為零，且不會儲存。 <br/>                                                                                                                                                                     |
| 影像 \_ REL \_ IA64 \_ PCREL21M <br/>   | 0x0007 <br/> | 此指令會以與16位對齊目標的25位相對位移來修正。 不會儲存置換的低4位，也就是零。 <br/>                                                                                                                                                                 |
| 影像 \_ REL \_ IA64 \_ PCREL21F <br/>   | 0x0008 <br/> | 此重新配置位移的 LSBs 必須包含插槽號碼，而其餘的則是組合位址。 組合會以與16位對齊之目標的25位相對位移來修正。 位移的低4位為零，且不會儲存。 <br/>                                                                |
| 影像 \_ REL \_ IA64 \_ GPREL22 <br/>    | 0x0009 <br/> | 指令重新配置後面可以接著加數重新配置，其值會新增至目標位址，然後是計算並套用至 GPREL22 組合的22位 GP 相對位移。 <br/>                                                                                                                            |
| 影像 \_ REL \_ IA64 \_ LTOFF22 <br/>    | 0x000A <br/> | 此指令會透過與目標符號之 literal 資料表專案的22位 GP 相對位移來修正。 連結器會根據此重新配置以及可能遵循的加數重新配置來建立此常值資料表專案。 <br/>                                                                                                        |
| 影像 \_ REL \_ IA64 \_ 區段 <br/>    | 0x000B <br/> | 區段的16位區段索引包含目標。 這是用來支援偵錯工具資訊。 <br/>                                                                                                                                                                                                                         |
| 影像 \_ REL \_ IA64 \_ SECREL22 <br/>   | 0x000C <br/> | 此指示會從其區段開頭的目標22位位移開始修正。 此重新配置可以緊接著加數重新配置，其值欄位包含區段開頭的32位不帶正負號位移。 <br/>                                                     |
| 影像 \_ REL \_ IA64 \_ SECREL64I <br/>  | 0x000D <br/> | 此重新配置的位置號碼必須是一個 (1) 。 此指令會從其區段的開頭加上目標的64位位移來修正。 此重新配置可以緊接在加數重新放置，其值欄位包含從區段開頭起算之目標的32位不帶正負號位移。 <br/> |
| 影像 \_ REL \_ IA64 \_ SECREL32 <br/>   | 0x000E <br/> | 要從其區段開頭以32位位移來修正的資料位址。 <br/>                                                                                                                                                                                                                          |
| 影像 \_ REL \_ IA64 \_ DIR32NB <br/>    | 0x0010 <br/> | 目標的32位 RVA。 <br/>                                                                                                                                                                                                                                                                                                            |
| 影像 \_ REL \_ IA64 \_ SREL14 <br/>     | 0x0011 <br/> | 這會套用至包含兩個可重設目標之間差異的帶正負號的14位立即。 這是連結器的宣告式欄位，表示編譯器已經發出此值。 <br/>                                                                                                              |
| 影像 \_ REL \_ IA64 \_ SREL22 <br/>     | 0x0012 <br/> | 這會套用至包含兩個可重設目標之間差異的帶正負號22位立即。 這是連結器的宣告式欄位，表示編譯器已經發出此值。 <br/>                                                                                                              |
| 影像 \_ REL \_ IA64 \_ SREL32 <br/>     | 0x0013 <br/> | 這會套用至包含兩個可重設值之間差異的帶正負號32位立即。 這是連結器的宣告式欄位，表示編譯器已經發出此值。 <br/>                                                                                                               |
| 影像 \_ REL \_ IA64 \_ UREL32 <br/>     | 0x0014 <br/> | 這會套用至包含兩個可重設值之間差異的不帶正負號32位立即。 這是連結器的宣告式欄位，表示編譯器已經發出此值。 <br/>                                                                                                            |
| 影像 \_ REL \_ IA64 \_ PCREL60X <br/>   | 0x0015 <br/> | 60位的電腦相對修復，一律會保持為 MLX 組合的 BRL 指令。 <br/>                                                                                                                                                                                                                                                 |
| 影像 \_ REL \_ IA64 \_ PCREL60B <br/>   | 0x0016 <br/> | 60位的電腦相對修復。 如果目標置換符合帶正負號的25位欄位，請使用 NOP 將整個組合轉換成 MBB 組合。插槽1中的 B 和25位 BR 指令 (在插槽2中，全部為零且已卸載) 。 <br/>                                                                                          |
| 影像 \_ REL \_ IA64 \_ PCREL60F <br/>   | 0x0017 <br/> | 60位的電腦相對修復。 如果目標置換符合帶正負號的25位欄位，請使用 NOP 將整個組合轉換成 MFB 組合。插槽1中的 F 和25位 (4 個最低位，在插槽2中) BR 指令全部為零和卸載。 <br/>                                                                                                   |
| 影像 \_ REL \_ IA64 \_ PCREL60I <br/>   | 0x0018 <br/> | 60位的電腦相對修復。 如果目標置換符合帶正負號的25位欄位，請使用 NOP 將整個組合轉換成 MIB 組合。I 在插槽1和25位 (4 個最低位，且在插槽2中) BR 指令全部零和卸載。 <br/>                                                                                                   |
| 影像 \_ REL \_ IA64 \_ PCREL60M <br/>   | 0x0019 <br/> | 60位的電腦相對修復。 如果目標置換符合帶正負號的25位欄位，請使用 NOP 將整個組合轉換成 MMB 組合。插槽1中的 M 和25位 (4 個最低位，在插槽2中) BR 指令全部為零和卸載。 <br/>                                                                                                   |
| 影像 \_ REL \_ IA64 \_ IMMGPREL64 <br/> | 0x001a <br/> | 64位的 GP 相對修復。 <br/>                                                                                                                                                                                                                                                                                                         |
| 影像 \_ REL \_ IA64 \_ TOKEN <br/>      | 0x001b <br/> | CLR token。 <br/>                                                                                                                                                                                                                                                                                                                        |
| 影像 \_ REL \_ IA64 \_ GPREL32 <br/>    | 0x001c <br/> | 32位的 GP 相對修復。 <br/>                                                                                                                                                                                                                                                                                                         |
| 影像 \_ REL \_ IA64 \_ 加數 <br/>     | 0x001F <br/> | 重新配置只有在緊接在下列其中一個重新置放之後才有效： IMM14、IMM22、IMM64、GPREL22、LTOFF22、LTOFF64、SECREL22、SECREL64I 或 SECREL32。 其值包含要套用至組合中之指示的加數，而不是資料。 <br/>                                                                  |



 

##### <a name="mips-processors"></a>MIPS 處理器

針對 MIPS 處理器定義了下列重新配置類型指標。



| 常數                                | 值              | 描述                                                                                                                                                                                                                                                                                                                                                                         |
|-----------------------------------------|--------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 影像 \_ REL \_ MIPS \_ 絕對 <br/>  | 0x0000 <br/> | 重新配置會被忽略。 <br/>                                                                                                                                                                                                                                                                                                                                              |
| 影像 \_ REL \_ MIPS \_ REFHALF <br/>   | 0x0001 <br/> | 目標32位 VA 的高16位。 <br/>                                                                                                                                                                                                                                                                                                                             |
| 影像 \_ REL \_ MIPS \_ REFWORD <br/>   | 0x0002 <br/> | 目標的32位 VA。 <br/>                                                                                                                                                                                                                                                                                                                                                 |
| 影像 \_ REL \_ MIPS \_ JMPADDR <br/>   | 0x0003 <br/> | 目標 VA 的低26位。 這支援 MIPS J 和 JAL 指令。 <br/>                                                                                                                                                                                                                                                                                      |
| 影像 \_ REL \_ MIPS \_ REFHI <br/>     | 0x0004 <br/> | 目標32位 VA 的高16位。 這會用於載入完整位址之雙指令序列中的第一個指令。 此重新配置必須緊接在其 SymbolTableIndex 包含帶正負號的16位位移，且該位移會新增至從正在重新放置的位置中取得的16位位移。 <br/> |
| 影像 \_ REL \_ MIPS \_ REFLO <br/>     | 0x0005 <br/> | 目標 VA 的低16位。 <br/>                                                                                                                                                                                                                                                                                                                                     |
| 影像 \_ REL \_ MIPS \_ GPREL <br/>     | 0x0006 <br/> | 目標的16位帶正負號的位移（相對於 GP 登錄）。 <br/>                                                                                                                                                                                                                                                                                                 |
| 影像 \_ REL \_ MIPS \_ 常值 <br/>   | 0x0007 <br/> | 與影像 \_ REL \_ MIPS GPREL 相同 \_ 。 <br/>                                                                                                                                                                                                                                                                                                                                    |
| 影像 \_ REL \_ MIPS \_ 區段 <br/>   | 0x000A <br/> | 區段的16位區段索引包含目標。 這是用來支援偵錯工具資訊。 <br/>                                                                                                                                                                                                                                                             |
| 影像 \_ REL \_ MIPS \_ SECREL <br/>    | 0x000B <br/> | 目標在其區段開頭的32位位移。 這是用來支援偵錯工具資訊和靜態執行緒區域儲存區。 <br/>                                                                                                                                                                                                                       |
| 影像 \_ REL \_ MIPS \_ SECRELLO <br/>  | 0x000C <br/> | 目標自其區段開頭的32位位移的低16位。 <br/>                                                                                                                                                                                                                                                                                   |
| 影像 \_ REL \_ MIPS \_ SECRELHI <br/>  | 0x000D <br/> | 目標自其區段開頭的32位位移的高16位。 映射 \_ REL MIPS 配對的重新配置 \_ \_ 必須緊接在此之後。 配對重新配置的 SymbolTableIndex 包含帶正負號的16位位移，該位移會新增至從正在重新放置的位置中取得的上層16位。 <br/>                            |
| 影像 \_ REL \_ MIPS \_ JMPADDR16 <br/> | 0x0010 <br/> | 目標 VA 的低26位。 這支援 MIPS16 JAL 指令。 <br/>                                                                                                                                                                                                                                                                                           |
| 影像 \_ REL \_ MIPS \_ REFWORDNB <br/> | 0x0022 <br/> | 目標的32位 RVA。 <br/>                                                                                                                                                                                                                                                                                                                                                |
| 影像 \_ REL \_ MIPS \_ 配對 <br/>      | 0x0025 <br/> | 重新配置只有在緊接在 REFHI 或 SECRELHI 重新配置之後才有效。 其 SymbolTableIndex 包含替代，而不是符號資料表中的索引。 <br/>                                                                                                                                                                                           |



 

##### <a name="mitsubishi-m32r"></a>Mitsubishi M32R

下列為 Mitsubishi M32R 處理器定義的重新配置類型指標。



| 常數                               | 值              | 描述                                                                                                                                                                                                                                                                                                                                                                                                   |
|----------------------------------------|--------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 影像 \_ REL \_ M32R \_ 絕對 <br/> | 0x0000 <br/> | 重新配置會被忽略。 <br/>                                                                                                                                                                                                                                                                                                                                                                        |
| 影像 \_ REL \_ M32R \_ ADDR32 <br/>   | 0x0001 <br/> | 目標的32位 VA。 <br/>                                                                                                                                                                                                                                                                                                                                                                           |
| 影像 \_ REL \_ M32R \_ ADDR32NB <br/> | 0x0002 <br/> | 目標的32位 RVA。 <br/>                                                                                                                                                                                                                                                                                                                                                                          |
| 影像 \_ REL \_ M32R \_ ADDR24 <br/>   | 0x0003 <br/> | 目標的24位 VA。 <br/>                                                                                                                                                                                                                                                                                                                                                                           |
| 影像 \_ REL \_ M32R \_ GPREL16 <br/>  | 0x0004 <br/> | 來自 GP 註冊的目標16位位移。 <br/>                                                                                                                                                                                                                                                                                                                                                  |
| 影像 \_ REL \_ M32R \_ PCREL24 <br/>  | 0x0005 <br/> | 程式計數器的目標24位位移 (PC) ，向左移位2位並進行正負號擴充 <br/>                                                                                                                                                                                                                                                                                                |
| 影像 \_ REL \_ M32R \_ PCREL16 <br/>  | 0x0006 <br/> | 來自電腦的目標16位位移，以2位向左移位並進行簽章延伸 <br/>                                                                                                                                                                                                                                                                                                                  |
| 影像 \_ REL \_ M32R \_ PCREL8 <br/>   | 0x0007 <br/> | 從電腦算出的目標8位位移，向左移位2位並進行正負號擴充 <br/>                                                                                                                                                                                                                                                                                                                   |
| 影像 \_ REL \_ M32R \_ REFHALF <br/>  | 0x0008 <br/> | 目標 VA 的 16 MSBs。 <br/>                                                                                                                                                                                                                                                                                                                                                                     |
| 影像 \_ REL \_ M32R \_ REFHI <br/>    | 0x0009 <br/> | 目標 VA 的 16 MSBs，已針對 LSB 符號延伸進行調整。 這適用于兩個指令序列中的第一個指令，可載入完整的32位位址。 此重新配置必須緊接在其 SymbolTableIndex 包含帶正負號的16位位移，且該位移會新增至從正在重新放置的位置中取得的16位位移。 <br/> |
| 影像 \_ REL \_ M32R \_ REFLO <br/>    | 0x000A <br/> | 目標 VA 的 16 LSBs。 <br/>                                                                                                                                                                                                                                                                                                                                                                     |
| 影像 \_ REL \_ M32R \_ 配對 <br/>     | 0x000B <br/> | 重新配置必須遵循 REFHI 重新配置。 其 SymbolTableIndex 包含替代，而不是符號資料表中的索引。 <br/>                                                                                                                                                                                                                                                             |
| 影像 \_ REL \_ M32R \_ 區段 <br/>  | 0x000C <br/> | 包含目標之區段的16位區段索引。 這是用來支援偵錯工具資訊。 <br/>                                                                                                                                                                                                                                                                                  |
| 影像 \_ REL \_ M32R \_ SECREL <br/>   | 0x000D <br/> | 目標在其區段開頭的32位位移。 這是用來支援偵錯工具資訊和靜態執行緒區域儲存區。 <br/>                                                                                                                                                                                                                                                 |
| 影像 \_ REL \_ M32R \_ TOKEN <br/>    | 0x000E <br/> | CLR token。 <br/>                                                                                                                                                                                                                                                                                                                                                                                    |



 

### <a name="coff-line-numbers-deprecated"></a> (已淘汰的 COFF 行號) 

COFF 行號不再產生，未來將不會使用。

COFF 行號表示原始程式檔中的程式碼和行號之間的關聯性。 適用于 COFF 行號的 Microsoft 格式與標準 COFF 相似，但它已經過擴充，可讓單一區段與多個原始程式檔中的行號產生關聯。

COFF 行號是由固定長度記錄的陣列所組成。 區段標頭中指定了位置 (檔案位移) 和陣列的大小。 每個行號記錄都是下列格式。



| Offset        | 大小          | 欄位                  | 描述                                                                                                                                                 |
|---------------|---------------|------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/> | 4 <br/> | 輸入 (\*)  <br/>  | 這是兩個欄位的聯集： SymbolTableIndex 和 VirtualAddress。 是否使用 SymbolTableIndex 或 RVA 取決於 Linenumber 的值。 <br/> |
| 4 <br/> | 2 <br/> | Linenumber <br/> | 若為非零值，則此欄位會指定以一為基礎的行號。 若為零，則會將類型欄位解釋為函式的符號資料表索引。 <br/>    |



 

類型欄位是 2 4 位元組欄位的聯集： SymbolTableIndex 和 VirtualAddress。



| Offset        | 大小          | 欄位                        | 描述                                                                                                                                                                             |
|---------------|---------------|------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/> | 4 <br/> | SymbolTableIndex <br/> | 在 Linenumber 為零時使用：函式的符號資料表專案索引。 這種格式是用來表示一組行號記錄所指的函數。 <br/>      |
| 0 <br/> | 4 <br/> | VirtualAddress <br/>   | 當 Linenumber 為非零時使用：對應至所指定之來源行的可執行程式碼 RVA。 在物件檔案中，這包含區段內的 VA。 <br/> |



 

行號記錄可以將 Linenumber 欄位設定為零，並指向符號表中的函式定義，或藉由提供正整數 (行號) 和物件程式碼中的對應位址，以做為標準的行號專案。

行號專案的群組一律以第一種格式開頭：函式符號的索引。 如果這是區段中的第一個行號記錄，則如果已設定區段的 COMDAT 旗標，則它也是函數的 COMDAT 符號名稱。 請參閱 [僅 (物件) 的 COMDAT 章節 ](#comdat-sections-object-only)。 符號表中的函式輔助記錄具有指向此相同行號記錄的 Linenumber 欄位指標。

識別函式的記錄後面會加上任何數目的行號專案，這些專案會提供實際的行號資訊 (也就是 Linenumber 大於零) 的專案。 這些專案是以1為基礎，相對於函式的開頭，並且代表函式中的每個原始程式列（第一行除外）。

例如，下列範例的第一個行號記錄會指定 ReverseSign 函數 (SymbolTableIndex of ReverseSign and Linenumber 設定為零) 。 然後會遵循 Linenumber 值為1、2和3的記錄，對應至原始程式列，如下所示：


```C++
// some code precedes ReverseSign function
int ReverseSign(int i)
1: {
2:  return -1 * i;
3: }
```



### <a name="coff-symbol-table"></a>COFF 符號表

此區段中的符號表繼承自傳統 COFF 格式。 這與 Microsoft Visual C++ 的 debug 資訊不同。 檔案可以同時包含 COFF 符號表和 Visual C++ 的 debug 資訊，而這兩個檔案會各自分開。 某些 Microsoft 工具會使用符號表進行有限但重要的用途，例如將 COMDAT 資訊傳達給連結器。 區段名稱和檔案名，以及程式碼和資料符號，都會列在符號表中。

符號表的位置會以 COFF 標頭表示。

符號表是一組記錄，每18個位元組長度。 每一筆記錄都是標準或輔助的符號資料表記錄。 標準記錄定義了符號或名稱，且具有下列格式。



| Offset         | 大小          | 欄位                          | 描述                                                                                                                                                                                                                                 |
|----------------|---------------|--------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 8 <br/> | 名稱 (\*)  <br/>          | 符號的名稱，以三個結構的聯集表示。 如果名稱的長度不超過8個位元組，則會使用8個位元組的陣列。 如需詳細資訊，請參閱 [符號名稱表示](https://www.bing.com/search?q=Symbol+Name+Representation)。 <br/> |
| 8 <br/>  | 4 <br/> | 值 <br/>              | 與符號相關聯的值。 此欄位的解讀取決於 SectionNumber 和 StorageClass。 典型的意義是可重定位的位址。 <br/>                                                         |
| 12 <br/> | 2 <br/> | SectionNumber <br/>      | 用來識別區段的帶正負號整數，在區段資料表中使用以一為基礎的索引。 某些值具有特殊意義，如「區段編號值」一節中所定義。 <br/>                                         |
| 14 <br/> | 2 <br/> | 類型 <br/>               | 表示類型的數位。 Microsoft 工具會將此欄位設定為 0x20 (函式) 或 0x0 (不是函數) 。 如需詳細資訊，請參閱 [類型表示](#type-representation)。 <br/>                                                |
| 16 <br/> | 1 <br/> | StorageClass <br/>       | 表示儲存類別的列舉值。 如需詳細資訊，請參閱 [儲存類別](#storage-class)。 <br/>                                                                                                                   |
| 17 <br/> | 1 <br/> | NumberOfAuxSymbols <br/> | 遵循此記錄的輔助符號資料表專案數目。 <br/>                                                                                                                                                           |



 

零個或更多的輔助符號-資料表記錄會立即遵循每個標準的符號資料表記錄。 不過，通常不會有一個以上的輔助符號-資料表記錄會遵循標準的符號資料表記錄 (但) 具有長檔名的檔案記錄。 每個輔助記錄的大小與標準符號資料表記錄相同， (18 個位元組) ，而不是定義新的符號，輔助記錄會提供最後定義之符號的其他資訊。 您可以選擇要使用數種格式的選項，取決於 StorageClass 欄位。 輔助符號表記錄的目前定義格式會顯示于5.5 的「輔助符號記錄」一節中。

讀取 COFF 符號表的工具必須忽略其轉譯不明的輔助符號記錄。 這可讓您擴充符號表格式來加入新的輔助記錄，而不會中斷現有的工具。

#### <a name="symbol-name-representation"></a>符號名稱標記法

符號表中的 ShortName 欄位包含8個位元組，其中包含名稱本身，如果長度不超過8個位元組，或 ShortName 欄位在字串資料表中提供位移。 若要判斷是否已指定名稱本身或位移，請測試前4個位元組是否等於零。

依照慣例，名稱會被視為以零結束的 UTF-8 編碼字串。



| Offset        | 大小          | 欄位                 | 描述                                                                                                          |
|---------------|---------------|-----------------------|----------------------------------------------------------------------------------------------------------------------|
| 0 <br/> | 8 <br/> | ShortName <br/> | 8個位元組的陣列。 如果名稱的長度少於8個位元組，則會在右邊以 null 填補此陣列。 <br/> |
| 0 <br/> | 4 <br/> | 零 <br/>    | 如果名稱長度超過8個位元組，則設定為全部為零的欄位。 <br/>                                     |
| 4 <br/> | 4 <br/> | Offset <br/>    | 字串資料表中的位移。 <br/>                                                                         |



 

#### <a name="section-number-values"></a>區段編號值

一般來說，符號表專案中的 [區段值] 欄位是區段資料表中以單一為基礎的索引。 不過，此欄位是帶正負號的整數，可採用負數值。 下列值（小於1）具有特殊意義。



| 常數                          | 值          | 描述                                                                                                                                                                                                                            |
|-----------------------------------|----------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| \_ \_ 未定義影像 SYM <br/> | 0 <br/>  | 尚未指派區段給符號記錄。 值為零表示外部符號的參考是在其他地方定義。 非零值是具有值所指定之大小的一般符號。 <br/> |
| 影像 \_ SYM \_ 絕對 <br/>  | -1 <br/> | 符號具有絕對 (不可標記的) 值，而且不是位址。 <br/>                                                                                                                                                  |
| 影像 \_ SYM \_ DEBUG <br/>     | -2 <br/> | 符號會提供一般類型或調試資訊，但不會對應至區段。 Microsoft 工具會使用此設定以及檔案記錄 (儲存類別檔案) 。 <br/>                                            |



 

#### <a name="type-representation"></a>類型標記法

符號表專案的 [類型] 欄位包含2個位元組，其中每個位元組都代表類型資訊。 LSB 代表簡單的 (基底) 資料類型，而 MSB 代表複雜型別（如果有的話）：



| MSB                                                       | Lsb                                                        |
|-----------------------------------------------------------|------------------------------------------------------------|
| 複雜類型：無、指標、函數、陣列。 <br/> | 基底類型：整數、浮點數等等。 <br/> |



 

下列值是針對基底類型定義的，雖然 Microsoft 工具通常不會使用此欄位，並將 LSB 設定為0。 相反地，Visual C++ 的 debug 資訊用來表示類型。 不過，在這裡會列出可能的 COFF 值以取得完整性。



| 常數                             | 值          | 描述                                                                            |
|--------------------------------------|----------------|----------------------------------------------------------------------------------------|
| 影像 \_ SYM \_ 類型 \_ Null <br/>   | 0 <br/>  | 沒有類型資訊或未知的基底類型。 Microsoft 工具使用此設定 <br/> |
| 影像 \_ SYM \_ 類型 \_ VOID <br/>   | 1 <br/>  | 沒有有效的類型;搭配 void 指標和函式使用 <br/>                       |
| 影像 \_ SYM \_ 類型 \_ CHAR <br/>   | 2 <br/>  | 字元 (帶正負號的位元組)  <br/>                                                  |
| 影像 \_ SYM \_ 類型 \_ 簡短 <br/>  | 3 <br/>  | 2位元組帶正負號的整數 <br/>                                                    |
| 影像 \_ SYM \_ 類型 \_ INT <br/>    | 4 <br/>  | 自然整數類型在 Windows 中通常 (4 個位元組)  <br/>                       |
| 影像 \_ SYM \_ 類型 \_ LONG <br/>   | 5 <br/>  | 4位元組帶正負號的整數 <br/>                                                    |
| 影像 \_ SYM \_ 類型 \_ FLOAT <br/>  | 6 <br/>  | 4位元組浮點數 <br/>                                             |
| 影像 \_ SYM \_ 類型 \_ DOUBLE <br/> | 7 <br/>  | 8位元組浮點數 <br/>                                            |
| 影像 \_ SYM \_ 類型 \_ 結構 <br/> | 8 <br/>  | 結構 <br/>                                                                |
| 影像 \_ SYM \_ 類型聯 \_ 集 <br/>  | 9 <br/>  | 聯集 <br/>                                                                    |
| 影像 \_ SYM \_ 類型 \_ 列舉 <br/>   | 10 <br/> | 列舉型別 <br/>                                                         |
| 影像 \_ SYM \_ 類型 \_ MOE <br/>    | 11 <br/> | 列舉 (特定值的成員)  <br/>                                 |
| 影像 \_ SYM \_ 類型 \_ 位元組 <br/>   | 12 <br/> | 位元組;不帶正負號的1位元組整數 <br/>                                            |
| 影像 \_ SYM \_ 類型 \_ 文字 <br/>   | 13 <br/> | 單字;不帶正負號的2位元組整數 <br/>                                            |
| 影像 \_ SYM \_ 類型 \_ UINT <br/>   | 14 <br/> | 自然大小的不帶正負號的整數 (正常，4個位元組)  <br/>                    |
| 影像 \_ SYM \_ 類型 \_ DWORD <br/>  | 15 <br/> | 不帶正負號的4位元組整數 <br/>                                                 |



 

最重要的位元組會指定符號為指標、函式傳回，或 LSB 中所指定基底類型的陣列。 Microsoft 工具只會使用此欄位來指出符號是否為函式，因此只有兩個結果值為0x0 和0x20 （類型欄位）。 不過，其他工具可以使用此欄位來傳達更多資訊。

請務必正確地指定函數屬性。 需要這項資訊才能讓增量連結正常運作。 針對某些架構，可能需要此資訊才能進行其他用途。



| 常數                                | 值         | 描述                                                          |
|-----------------------------------------|---------------|----------------------------------------------------------------------|
| 影像 \_ SYM \_ DTYPE \_ Null <br/>     | 0 <br/> | 沒有衍生類型;符號是簡單的純量變數。 <br/> |
| 影像 \_ SYM \_ DTYPE \_ 指標 <br/>  | 1 <br/> | 符號是基底類型的指標。 <br/>                    |
| IMAGE \_ SYM \_ DTYPE 函式 \_ <br/> | 2 <br/> | 符號是傳回基底類型的函式。 <br/>       |
| 影像 \_ SYM \_ DTYPE \_ 陣列 <br/>    | 3 <br/> | 符號是基底類型的陣列。 <br/>                     |



 

#### <a name="storage-class"></a>儲存類別

符號表的 StorageClass 欄位表示符號所代表的定義種類。 下表顯示可能的值。 請注意，StorageClass 欄位是無符號的1位元組整數。 因此，必須採取特殊值-1，以表示其不帶正負號的對等專案0xFF。

雖然傳統的 COFF 格式使用許多儲存類別值，但 Microsoft 工具仍依賴大部分的符號資訊 Visual C++ 的偵錯工具格式，而且通常只會使用四個儲存類別值： EXTERNAL (2) 、靜態 (3) 、函式 (101) 和檔案 (103) 。 除了下面的第二個數據行標題，您應該採用「值」來表示符號記錄的值欄位， (其轉譯取決於找到的儲存類別數目) 。



| 常數                                          | 值                 | 值欄位的描述/解釋                                                                                                                                                                                                                                                                                              |
|---------------------------------------------------|-----------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 影像 \_ SYM \_ 類別 \_ 結束 \_ 函 \_ 式 <br/>  | -1 (0xFF)  <br/> | 代表函式結尾的特殊符號，用於進行調試。 <br/>                                                                                                                                                                                                                                                  |
| 影像 \_ SYM \_ 類別 \_ Null <br/>               | 0 <br/>         | 沒有指派的儲存類別。 <br/>                                                                                                                                                                                                                                                                                                     |
| 影像 \_ SYM \_ 類別 \_ 自動 <br/>          | 1 <br/>         | 自動 (堆疊) 變數。 值欄位會指定堆疊框架位移。 <br/>                                                                                                                                                                                                                                              |
| 影像 \_ SYM \_ 類別 \_ 外部 <br/>           | 2 <br/>         | Microsoft 工具用於外部符號的值。 如果區段編號為 IMAGE \_ SYM \_ UNDEFINED (0) ，則 [值] 欄位會指出大小。 如果區段編號不是零，則 [值] 欄位會指定區段內的位移。 <br/>                                                                                 |
| 影像 \_ SYM \_ 類別 \_ 靜態 <br/>             | 3 <br/>         | 符號在區段內的位移。 如果 [值] 欄位為零，則符號代表區段名稱。 <br/>                                                                                                                                                                                                            |
| 影像 \_ SYM \_ 類別 \_ 註冊 <br/>           | 4 <br/>         | 暫存器變數。 值欄位會指定註冊編號。 <br/>                                                                                                                                                                                                                                                            |
| 影像 \_ SYM \_ 類別 \_ 外部 \_ 定義 <br/>      | 5 <br/>         | 外部定義的符號。 <br/>                                                                                                                                                                                                                                                                                           |
| 影像 \_ SYM \_ 類別 \_ 標籤 <br/>              | 6 <br/>         | 在模組中定義的程式碼標籤。 值欄位會指定區段內符號的位移。 <br/>                                                                                                                                                                                                         |
| 影像 \_ SYM \_ 類別 \_ 未定義 \_ 標籤 <br/>   | 7 <br/>         | 未定義之程式碼標籤的參考。 <br/>                                                                                                                                                                                                                                                                               |
| \_結構的影像 SYM \_ 類別 \_ 成員 \_ \_ <br/> | 8 <br/>         | 結構成員。 值欄位會指定第 n 個成員。 <br/>                                                                                                                                                                                                                                                               |
| IMAGE \_ SYM \_ CLASS \_ 引數 <br/>           | 9 <br/>         | 函式 (參數) 的正式引數。 值欄位會指定第 n 個引數。 <br/>                                                                                                                                                                                                                                      |
| 影像 \_ SYM \_ 類別 \_ 結構 \_ 標記 <br/>        | 10 <br/>        | 結構標記名稱專案。 <br/>                                                                                                                                                                                                                                                                                                  |
| \_UNION 的 IMAGE SYM \_ 類別 \_ 成員 \_ \_ <br/>  | 11 <br/>        | 聯集成員。 值欄位會指定第 n 個成員。 <br/>                                                                                                                                                                                                                                                                     |
| 影像 \_ SYM \_ 類別聯 \_ 集 \_ 標記 <br/>         | 12 <br/>        | 聯集標記名稱專案。 <br/>                                                                                                                                                                                                                                                                                                      |
| 影像 \_ SYM \_ 類別 \_ 類型 \_ 定義 <br/>   | 13 <br/>        | Typedef 專案。 <br/>                                                                                                                                                                                                                                                                                                               |
| 影像 \_ SYM \_ 類別 \_ 未定義 \_ 靜態 <br/>  | 14 <br/>        | 靜態資料宣告。 <br/>                                                                                                                                                                                                                                                                                                     |
| 影像 \_ SYM \_ 類別 \_ 列舉 \_ 標記 <br/>          | 15 <br/>        | 列舉型別 tagname 專案。 <br/>                                                                                                                                                                                                                                                                                              |
| \_列舉的影像 SYM \_ 類別 \_ 成員 \_ \_ <br/>   | 16 <br/>        | 列舉的成員。 值欄位會指定第 n 個成員。 <br/>                                                                                                                                                                                                                                                         |
| 影像 \_ SYM \_ 類別 \_ REGISTER \_ 參數 <br/>    | 17 <br/>        | Register 參數。 <br/>                                                                                                                                                                                                                                                                                                          |
| 影像 \_ SYM \_ 類別 \_ 位 \_ 欄位 <br/>         | 18 <br/>        | 位欄位參考。 值欄位指定位欄位中的 n 位。 <br/>                                                                                                                                                                                                                                                |
| 影像 \_ SYM \_ 類別 \_ 區塊 <br/>              | 100 <br/>       | 從區塊) 的開頭 (，或 (結尾) 記錄的 bb。 值欄位是程式碼位置的可重定位位址。 <br/>                                                                                                                                                                                                      |
| 影像 \_ SYM \_ 類別 \_ 函數 <br/>           | 101 <br/>       | Microsoft 工具用於定義函式範圍之符號記錄的值： begin function (. bf ) 、end function ( ef ) 和函式中的行 (. lf ) 。 若為 lf 記錄，[值] 欄位會提供函數中的原始程式列數目。 若是 ef 記錄，值欄位會提供函數代碼的大小。 <br/> |
| \_結構 SYM \_ 類別 \_ 結尾 \_ \_ <br/>    | 102 <br/>       | 結構結尾的專案。 <br/>                                                                                                                                                                                                                                                                                                     |
| 影像 \_ SYM \_ 類別 \_ 檔案 <br/>               | 103 <br/>       | Microsoft 工具和傳統 COFF 格式的值，用於來源檔案符號記錄。 符號後面接著命名檔案的輔助記錄。 <br/>                                                                                                                                                       |
| 影像 \_ SYM \_ 類別 \_ 區段 <br/>            | 104 <br/>       | 區段的定義 (Microsoft 工具會改為使用靜態儲存類別) 。 <br/>                                                                                                                                                                                                                                                  |
| 影像 \_ SYM \_ 類別 \_ 弱式 \_ 外部 <br/>     | 105 <br/>       | 弱式外部。 如需詳細資訊，請參閱 [輔助格式3：弱式外部](#auxiliary-format-3-weak-externals)。 <br/>                                                                                                                                                                                                           |
| 影像 \_ SYM \_ 類別 \_ CLR \_ TOKEN <br/>         | 107 <br/>       | CLR token 符號。 名稱是包含權杖之十六進位值的 ASCII 字串。 如需詳細資訊，請參閱 [僅 (物件) 的 CLR Token 定義 ](#clr-token-definition-object-only)。 <br/>                                                                                                                        |



 

### <a name="auxiliary-symbol-records"></a>輔助符號記錄

輔助符號表記錄一律遵循，並套用至某些標準符號表記錄。 輔助記錄可以有工具可以辨識的任何格式，但必須配置18個位元組，以便將符號表維護為一般大小的陣列。 目前，Microsoft 工具會辨識下列記錄種類的輔助格式：函式定義、函數開始和結束符號 ( bf 和 ef) 、弱式外部、檔案名和區段定義。

傳統的 COFF 設計也包含陣列和結構的輔助記錄格式。 Microsoft 工具不會使用這些工具，而是改為在 debug 區段中 Visual C++ 的 debug 格式放置符號資訊。

#### <a name="auxiliary-format-1-function-definitions"></a>輔助格式1：函式定義

符號表記錄會標示函式定義的開頭（如果它具有下列所有項）：外部 (2) 的儲存類別、指出其為函式 (0x20) 的型別，以及大於零的區段編號。 請注意，如果符號表記錄的區段編號為 UNDEFINED (0) 不會定義函式，也不會有輔助記錄。 函式定義符號記錄後面會有輔助記錄，如下所述格式：



| Offset         | 大小          | 欄位                             | 描述                                                                                                                                                                                                                   |
|----------------|---------------|-----------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 4 <br/> | TagIndex <br/>              | 對應之 bf (begin 函式的符號資料表索引) 符號記錄。 <br/>                                                                                                                                   |
| 4 <br/>  | 4 <br/> | TotalSize <br/>             | 函數本身的可執行程式碼大小。 如果函式在它自己的區段中，區段標頭中的 SizeOfRawData 就會大於或等於此欄位，視對齊考慮而定。 <br/> |
| 8 <br/>  | 4 <br/> | PointerToLinenumber <br/>   | 函數的第一個 COFF 行號專案的檔案位移，如果不存在則為零。 如需詳細資訊，請參閱 [ (取代) 的 COFF 行號 ](#coff-line-numbers-deprecated)。 <br/>                          |
| 12 <br/> | 4 <br/> | PointerToNextFunction <br/> | 下一個函數之記錄的符號資料表索引。 如果函數是符號資料表中的最後一個，這個欄位就會設定為零。 <br/>                                                                           |
| 16 <br/> | 2 <br/> | 未使用 <br/>                |                                                                                                                                                                                                                               |



 

#### <a name="auxiliary-format-2-bf-and-ef-symbols"></a>輔助格式2：. bf 和 ef 符號

針對符號表中的每個函式定義，三個專案會描述開始、結束和行數。 上述每個符號都有儲存類別函數 (101) ：

名為 bf 的符號記錄 (begin 函數) 。 未使用值欄位。

函數) 中名稱為 lf (行的符號記錄。 值欄位會提供函數中的行數。

名為 ef (函式) 結尾的符號記錄。 值欄位的數目與函式定義符號記錄中的總大小欄位相同。

Bf 和 ef 符號記錄 (但不是。 lf 記錄) 後面接著具有下列格式的輔助記錄：



| Offset         | 大小          | 欄位                                         | 描述                                                                                                                                                                   |
|----------------|---------------|-----------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 4 <br/> | 未使用 <br/>                            |                                                                                                                                                                               |
| 4 <br/>  | 2 <br/> | Linenumber <br/>                        | 實際的序數行號 (1、2、3，依此類推，在原始程式檔中) ，對應于 bf 或 ef 記錄。 <br/>                                               |
| 6 <br/>  | 6 <br/> | 未使用 <br/>                            |                                                                                                                                                                               |
| 12 <br/> | 4 <br/> | PointerToNextFunction (. 僅 bf)  <br/> | 下 bf 符號記錄的符號資料表索引。 如果函數是符號資料表中的最後一個，這個欄位就會設定為零。 它不會用於 ef 記錄。 <br/> |
| 16 <br/> | 2 <br/> | 未使用 <br/>                            |                                                                                                                                                                               |



 

#### <a name="auxiliary-format-3-weak-externals"></a>輔助格式3：弱式外部

「弱式外部」是物件檔案的機制，可在連結時提供彈性。 模組可以 (sym1) 包含無法解析的外部符號，但也可以包含輔助記錄，指出如果連結時沒有 sym1，則會使用另一個外部符號 (sym2) 來改為解析參考。

如果 sym1 的定義已連結，則會正常地解析符號的外部參考。 如果未連結 sym1 的定義，則對 sym1 弱式外部的所有參考都會改為參考 sym2。 外部符號 sym2 必須一律連結;一般而言，它是定義在包含 sym1 弱式參考的模組中。

弱式外部是由具有外部儲存類別的符號表記錄、UNDEF 區段編號，以及零值所表示。 弱式外部符號記錄後面會接著具有下列格式的輔助記錄：



| Offset        | 大小           | 欄位                       | 描述                                                                                                                                                                                                                                                                                                                                                |
|---------------|----------------|-----------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/> | 4 <br/>  | TagIndex <br/>        | Sym2 的符號資料表索引，如果找不到 sym1，則為要連結的符號。 <br/>                                                                                                                                                                                                                                                                  |
| 4 <br/> | 4 <br/>  | 特性 <br/> | 影像 \_ 弱式 \_ 外部搜尋 NOLIBRARY 的值 \_ \_ 表示不應執行 sym1 的程式庫搜尋。 <br/> 映射 \_ 弱式 \_ 外部搜尋程式庫的值 \_ \_ 表示應該執行 sym1 的程式庫搜尋。 <br/> 影像 \_ 弱式 \_ 外部搜尋別名的值 \_ \_ 表示 sym1 是 sym2 的別名。 <br/> |
| 8 <br/> | 10 <br/> | 未使用 <br/>          |                                                                                                                                                                                                                                                                                                                                                            |



 

請注意，WINNT 中並未定義 [特性] 欄位。高相反地，會使用 [大小總計] 欄位。

#### <a name="auxiliary-format-4-files"></a>輔助格式4：檔案

此格式會遵循具有儲存類別檔案 (103) 的符號資料表記錄。 符號名稱本身應該是. file，而後面接著的輔助記錄會提供原始程式碼檔的名稱。



| Offset        | 大小           | 欄位                 | 描述                                                                                                                         |
|---------------|----------------|-----------------------|-------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/> | 18 <br/> | 檔案名稱 <br/> | 提供原始程式檔名稱的 ANSI 字串。 如果小於最大長度，則會以 null 填補。 <br/> |



 

#### <a name="auxiliary-format-5-section-definitions"></a>輔助格式5：區段定義

此格式會遵循定義區段的符號資料表記錄。 這類記錄的符號名稱是區段的名稱 (例如，text 或. drectve) ，而且具有儲存類別 STATIC (3) 。 輔助記錄會提供它所參考之區段的相關資訊。 因此，它會複製區段標頭中的部分資訊。



| Offset         | 大小          | 欄位                           | 描述                                                                                                                                                                                                             |
|----------------|---------------|---------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 4 <br/> | 長度 <br/>              | 區段資料的大小;與區段標頭中的 SizeOfRawData 相同。 <br/>                                                                                                                                  |
| 4 <br/>  | 2 <br/> | NumberOfRelocations <br/> | 區段的重新設定項目數目。 <br/>                                                                                                                                                           |
| 6 <br/>  | 2 <br/> | NumberOfLinenumbers <br/> | 區段的行號專案數目。 <br/>                                                                                                                                                          |
| 8 <br/>  | 4 <br/> | 校驗 <br/>            | 微乎其微資料的總和檢查碼。 如果在 \_ \_ \_ 區段標頭中設定了 IMAGE SCN .lnk COMDAT 旗標，則適用此功能。 如需詳細資訊，請參閱 [僅 (物件) 的 COMDAT 章節 ](#comdat-sections-object-only)。 <br/> |
| 12 <br/> | 2 <br/> | Number <br/>              | 關聯區段的區段資料表中，以一個為基的索引。 當 COMDAT 選項設定為5時，就會使用此選項。 <br/>                                                                                     |
| 14 <br/> | 1 <br/> | 選取 <br/>           | COMDAT 選取專案編號。 這適用于區段為 COMDAT 區段的情況。 <br/>                                                                                                                         |
| 15 <br/> | 3 <br/> | 未使用 <br/>              |                                                                                                                                                                                                                         |



 

#### <a name="comdat-sections-object-only"></a>COMDAT 區段僅 (物件) 

如果區段是 COMDAT 區段，則區段定義輔助格式的 [選取] 欄位適用。 COMDAT 區段是一個可由一個以上的物件檔案定義的區段。  (在 \_ \_ \_ 區段標頭的區段旗標欄位中設定旗標影像 SCN .lnk COMDAT。 ) 選擇欄位會決定連結器解析 COMDAT 區段之多個定義的方式。

第一個具有 COMDAT 區段之區段值的符號必須是區段符號。 此符號具有區段的名稱、等於零的值欄位、COMDAT 區段的區段號碼、等於 IMAGE \_ SYM \_ type \_ Null、CLASS 欄位等於 image \_ SYM \_ 類別 \_ STATIC，以及一個輔助記錄。 第二個符號稱為「COMDAT 符號」，連結器會使用此符號搭配選取欄位。

選擇欄位的值如下所示。



| 常數                                        | 值         | 描述                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|-------------------------------------------------|---------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 影像 \_ COMDAT \_ 選取 \_ NODUPLICATES <br/> | 1 <br/> | 如果已定義此符號，連結器會發出「乘號定義的符號」錯誤。 <br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 影像 \_ COMDAT \_ 選取 \_ 任何 <br/>          | 2 <br/> | 可以連結定義相同 COMDAT 符號的任何區段;其餘部分會被移除。 <br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 影像 \_ COMDAT \_ 選取 \_ 相同的 \_ 大小 <br/>   | 3 <br/> | 連結器會在此符號的定義中選擇任意區段。 如果所有定義的大小都不相同，則會發出「乘量定義的符號」錯誤。 <br/>                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 影像 \_ COMDAT \_ 選取 \_ 完全 \_ 相符 <br/> | 4 <br/> | 連結器會在此符號的定義中選擇任意區段。 如果所有定義不完全相符，則會發出「相乘定義的符號」錯誤。 <br/>                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 影像 \_ COMDAT \_ 選取 \_ 關聯 <br/>  | 5 <br/> | 如果已連結特定其他 COMDAT 區段，則會連結此區段。 此其他區段是由區段定義之輔助符號記錄的數位欄位所表示。 這項設定適用于在多個區段中具有元件的定義 (例如，程式碼在另一個) 中的程式碼，但必須將全部連結或捨棄為集合。 與此區段相關聯的另一節必須是 COMDAT 區段，它可以是另一個關聯 COMDAT 區段。 關聯 COMDAT 區段的區段關聯鏈無法形成迴圈。 區段關聯鏈最後必須是 COMDAT 區段，而且沒有影像 \_ COMDAT \_ 選取 \_ 關聯集。 <br/> |
| 影像 \_ COMDAT \_ 選取 \_ 最大 <br/>      | 6 <br/> | 連結器會從這個符號的所有定義中選擇最大的定義。 如果有多個定義的大小，則兩者之間的選擇是任意的。 <br/>                                                                                                                                                                                                                                                                                                                                                                                                                |



 

#### <a name="clr-token-definition-object-only"></a>CLR 權杖定義僅 (物件) 

此輔助符號通常會遵循 IMAGE \_ SYM \_ 類別 \_ CLR \_ TOKEN。 它是用來將權杖與 COFF 符號表的命名空間產生關聯。



| Offset        | 大小           | 欄位                        | 描述                                                                                |
|---------------|----------------|------------------------------|--------------------------------------------------------------------------------------------|
| 0 <br/> | 1 <br/>  | bAuxType <br/>         | 必須是影像 \_ AUX \_ 符號 \_ 類型 \_ 標記 \_ 定義 (1) 。 <br/>                              |
| 1 <br/> | 1 <br/>  | bReserved <br/>        | Reserved，必須為零。 <br/>                                                        |
| 2 <br/> | 4 <br/>  | SymbolTableIndex <br/> | 此 CLR 權杖定義所參考之 COFF 符號的符號索引。 <br/> |
| 6 <br/> | 12 <br/> |                              | Reserved，必須為零。 <br/>                                                        |



 

### <a name="coff-string-table"></a>COFF 字串資料表

緊接在 COFF 符號表之後的是 COFF 字串資料表。 您可以在 COFF 標頭中取得符號表位址，並加上符號數目乘以符號的大小，以找到此資料表的位置。

COFF 字串資料表的開頭是4個位元組，其中包含字串資料表其餘部分的總大小 (位元組) 。 此大小包含 [大小] 欄位本身，因此如果沒有任何字串，此位置中的值會是4。

之後，其大小為以 null 結束的字串，由 COFF 符號表中的符號所指向。

### <a name="the-attribute-certificate-table-image-only"></a>屬性證書表只 (映射) 

藉由新增屬性證書表，可以將屬性憑證與映射建立關聯。 屬性憑證資料表是由一組連續、雙線對齊的屬性憑證專案所組成。 在檔案的原始結尾和屬性證書表的開頭之間插入零填補，以達成此對齊。 每個屬性的憑證專案都包含下欄欄位。



| Offset       | 大小                         | 欄位                       | 描述                                                                                                |
|--------------|------------------------------|-----------------------------|------------------------------------------------------------------------------------------------------------|
| 0<br/> | 4<br/>                 | dwLength<br/>         | 指定屬性憑證專案的長度。 <br/>                                       |
| 4<br/> | 2<br/>                 | wRevision<br/>        | 包含憑證版本號碼。 如需詳細資訊，請參閱下列文字。<br/>                   |
| 6<br/> | 2<br/>                 | wCertificateType<br/> | 指定 bCertificate 中的內容類型。 如需詳細資訊，請參閱下列文字。<br/>             |
| 8<br/> | 請參閱下列主題<br/> | bCertificate<br/>     | 包含憑證，例如 Authenticode 簽章。 如需詳細資訊，請參閱下列文字。<br/> |



 

選用標頭資料目錄中的憑證資料表專案的虛擬位址值是第一個屬性（attribute）憑證專案的檔案位移。 後續專案的存取方式，是從目前的屬性（attribute）憑證專案的開頭開始，將該專案的 dwLength 位元組（四捨五入至8位元組倍數）向前移動。 這會繼續進行，直到四捨五入 dwLength 值的總和等於選擇性標頭資料目錄中的 [憑證] 資料表專案的大小值。 如果四捨五入 dwLength 值的總和不等於大小值，則 [屬性] 或 [大小] 欄位就會損毀。

例如，如果選擇性的標頭資料目錄的憑證資料表專案包含：


```C++
virtual address = 0x5000
size = 0x1000
```



第一個憑證從磁片上的檔案開頭開始于位移0x5000。 若要前進到所有屬性的憑證專案：

1.  將第一個屬性憑證的 dwLength 值新增至起始位移。
2.  將步驟1中的值四捨五入到最接近的8位元組倍數，以找出第二個屬性憑證專案的位移。
3.  將步驟2中的位移值新增至第二個屬性（attribute）憑證專案的 dwLength 值，然後四捨五入到最接近的8位元組倍數，以判斷第三個屬性憑證專案的位移。
4.  針對每個後續的憑證重複步驟3，直到計算位移等於 0x6000 (0x5000 start + 0x1000 total size) ，這表示您已逐步完成整個資料表。

或者，您可以藉由在迴圈中呼叫 Win32 **ImageEnumerateCertificates** 函式來列舉憑證專案。 如需函式參考頁面的連結，請參閱 [參考](#references)。

只要專案具有正確的 dwLength 值、唯一的 wRevision 值和唯一的 wCertificateType 值，屬性憑證資料表專案可以包含任何憑證類型。 最常見的憑證資料表專案類型是 WIN \_ 憑證結構，其記載于 Wintrust 中，並在本節的其餘部分討論。

WIN \_ 憑證 **wRevision** 成員的選項包含 (但不限於) 下列各項。



| 值             | 名稱                                 | 注意                                                                                                                                                 |
|-------------------|--------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0x0100<br/> | WIN \_ CERT \_ 修訂 \_ 1 \_ 0<br/> | 第1版，即 Win 憑證結構的舊版本 \_ 。 只有驗證舊版 Authenticode 簽章的目的才支援此功能<br/> |
| 0x0200<br/> | WIN \_ CERT \_ 修訂 \_ 2 \_ 0<br/> | 第2版是獲獎憑證結構的最新版本 \_ 。 <br/>                                                                       |



 

WIN \_ 憑證 **wCertificateType** 成員的選項包含 (但不限於下表中的) 專案。 請注意，目前不支援某些值。



| 值             | 名稱                                           | 注意                                                                                   |
|-------------------|------------------------------------------------|-----------------------------------------------------------------------------------------|
| 0x0001<br/> | WIN \_ CERT \_ 類型 \_ X509 <br/>              | bCertificate 包含 x.509 憑證 <br/> 不支援<br/>         |
| 0x0002<br/> | WIN \_ CERT \_ 類型 \_ PKCS \_ 簽署 \_ 資料<br/> | bCertificate 包含 PKCS \# 7 SignedData 結構<br/>                         |
| 0x0003<br/> | WIN \_ 憑證 \_ 類型 \_ 保留 \_ 1<br/>        | 保留 <br/>                                                                    |
| 0x0004<br/> | WIN \_ CERT \_ TYPE \_ TS \_ STACK \_ 已簽署<br/>  | 終端機伺服器通訊協定堆疊憑證簽署 <br/> 不支援<br/> |



 

WIN \_ 憑證結構的 **bCertificate** 成員包含可變長度的位元組陣列，其中包含由 **wCertificateType** 指定的內容類型。 Authenticode 支援的型別是 WIN \_ 憑證 \_ 類型 \_ pkcs \_ 簽署 \_ 資料，即 pkcs \# 7 **SignedData** 結構。 如需 Authenticode 數位簽章格式的詳細資訊，請參閱 [Windows Authenticode 可攜式可執行檔](https://download.microsoft.com/download/9/c/5/9c5b2167-8017-4bae-9fde-d599bac8184a/Authenticode_PE.docx)簽章格式。

如果 **bCertificate** 內容不是在四個四條的界限上結束，則會將屬性憑證專案填補為零，從 **bCertificate** 的結尾到下一個的四個四條界限。

**DwLength** 值是完成的 WIN 憑證結構的長度 \_ ，計算方式如下：

`dwLength = offsetof(WIN_CERTIFICATE, bCertificate) + (size of the variable-length binary array contained within bCertificate)`

此長度應該包含任何填補的大小，其可用來滿足每個 WIN \_ 憑證結構都符合四個准的需求：

` dwLength += (8 - (dwLength & 7)) & 7;`

**憑證資料表大小**-在 [選用標頭資料目錄](#optional-header-data-directories-image-only)的 [**憑證] 資料表** 專案中指定 (映射僅) -包含填補。

如需有關使用 Imagehlp.dll API 來列舉、新增和移除 PE 檔案中憑證的詳細資訊，請參閱 [imagehlp.dll](imagehlp-functions.md)函式。

#### <a name="certificate-data"></a>憑證資料

如上一節所述，屬性憑證表中的憑證可以包含任何憑證類型。 確保 PE 檔案完整性的憑證可以包含 PE 映射雜湊。

PE 映射雜湊 (或檔案雜湊) 類似于檔案總和檢查碼，因為雜湊演算法會產生與檔案完整性相關的訊息摘要。 不過，總和檢查碼是由簡單的演算法所產生，主要是用來偵測磁片上的記憶體區塊是否已損毀，且儲存的值已損毀。 檔案雜湊類似于總和檢查碼，因為它也會偵測到檔案損毀。 但是，與大部分的總和檢查碼演算法不同的是，修改檔案時，不會變更檔案雜湊的原始未修改值是很困難的。 檔案雜湊可供用來偵測對檔案進行刻意甚至微妙的修改，例如病毒、駭客或特洛伊程式所引進的檔案。

包含在憑證中時，映射摘要必須排除 PE 映射中的特定欄位，例如選用標頭資料目錄中的總和檢查碼和憑證資料表專案。 這是因為新增憑證的動作會變更這些欄位，而且會導致計算不同的雜湊值。

Win32 **ImageGetDigestStream** 函式會從目標 PE 檔案中提供用來雜湊函數的資料流程。 在 PE 檔案中新增或移除憑證時，此資料流程會保持一致。 根據傳遞給 **ImageGetDigestStream** 的參數，可以從雜湊計算中省略 PE 映射中的其他資料。 如需函式參考頁面的連結，請參閱 [參考](#references)。

### <a name="delay-load-import-tables-image-only"></a>Delay-Load 只 (映射匯入資料表) 

這些資料表已加入至映射以支援應用程式的統一機制，以延遲載入 DLL，直到第一次呼叫該 DLL 為止。 資料表的版面配置與傳統匯入資料表的版面配置相符，如 [idata](#the-idata-section)一節6.4 中所述。 這裡只會討論一些詳細資料。

#### <a name="the-delay-load-directory-table"></a>Delay-Load Directory 資料表

延遲載入目錄資料表是匯入目錄資料表的對應項。 您可以透過選擇性標頭資料目錄清單中的延遲匯入描述項專案來抓取， (offset 200) 。 資料表的相片順序如下：



| Offset         | 大小          | 欄位                                  | 描述                                                                                                                                                                                                                                                                                                                  |
|----------------|---------------|----------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 4 <br/> | 屬性 <br/>                 | 必須為零。 <br/>                                                                                                                                                                                                                                                                                                    |
| 4 <br/>  | 4 <br/> | Name <br/>                       | 要載入之 DLL 名稱的 RVA。 名稱位於影像的唯讀資料區段中。 <br/>                                                                                                                                                                                                        |
| 8 <br/>  | 4 <br/> | 模組控制碼 <br/>              | 模組的 RVA 會處理要延遲載入之 DLL) 之影像的資料區段中 (。 它是由提供用來管理延遲載入的常式用於儲存。 <br/>                                                                                                                                   |
| 12 <br/> | 4 <br/> | 延遲匯入位址表 <br/> | 延遲載入匯入位址資料表的 RVA。 如需詳細資訊，請參閱 [延遲匯入位址表 (IAT) ](#delay-import-address-table)。 <br/>                                                                                                                                                                       |
| 16 <br/> | 4 <br/> | 延遲匯入名稱資料表 <br/>    | 延遲載入名稱資料表的 RVA，其中包含可能需要載入的匯入名稱。 這與匯入名稱資料表的版面配置相符。 如需詳細資訊，請參閱 [提示/名稱表](#hintname-table)。<br/>                                                                                       |
| 20 <br/> | 4 <br/> | 系結延遲匯入資料表 <br/>   | 系結延遲載入位址資料表的 RVA （如果存在的話）。 <br/>                                                                                                                                                                                                                                                     |
| 24 <br/> | 4 <br/> | 卸載延遲匯入資料表 <br/>  | 卸載延遲載入位址資料表的 RVA （如果存在的話）。 這是延遲匯入位址表的完整複本。 如果呼叫端卸載 DLL，則應該將此資料表複製回延遲匯入位址表，如此一來，後續的 DLL 呼叫就會繼續正確地使用 Thunking 機制。 <br/> |
| 28 <br/> | 4 <br/> | 時間戳記 <br/>                 | 此映射已系結之 DLL 的時間戳記。 <br/>                                                                                                                                                                                                                                                     |



 

此資料結構中所參考的資料表會依其對應專案的形式進行組織和排序，就像傳統匯入一樣。 如需詳細資訊，請參閱 [Idata 一節](#the-idata-section)。

#### <a name="attributes"></a>屬性

但是，不會定義任何屬性旗標。 連結器會將此欄位設定為影像中的零。 您可以使用此欄位來擴充記錄，方法是指出新欄位是否存在，或者可用來指出延遲或卸載 helper 函式的行為。

#### <a name="name"></a>Name

要延遲載入的 DLL 名稱位於映射的唯讀資料區段中。 它是透過 >szname 欄位來參考。

#### <a name="module-handle"></a>模組控制碼

要延遲載入之 DLL 的控制碼位於影像的 [資料] 區段中。 Phmod 欄位指向控制碼。 提供的延遲載入協助程式會使用這個位置，將控制碼儲存至載入的 DLL。

#### <a name="delay-import-address-table"></a>延遲匯入位址表

延遲匯入位址表 (IAT) 由延遲匯入描述元透過 pIAT 欄位參考。 延遲載入協助程式會使用真正的進入點來更新這些指標，讓 Thunk 不再存在於呼叫迴圈中。 您可以使用運算式來存取函式指標 `pINT->u1.Function` 。

#### <a name="delay-import-name-table"></a>延遲匯入名稱資料表

延遲匯入名稱表 (INT) 包含可能需要載入的匯入名稱。 它們的排序方式與 IAT 中的函數指標相同。 它們是由與標準 INT 相同的結構所組成，而且是使用運算式來存取 `pINT->u1.AddressOfData->Name[0]` 。

#### <a name="delay-bound-import-address-table-and-time-stamp"></a>延遲系結匯入位址資料表和時間戳記

延遲系結匯入位址表 (BIAT) 是一份選擇性的影像 \_ THUNK \_ 資料項目資料表，可與延遲載入目錄資料表的時間戳記欄位搭配使用後置處理常式系結階段使用。

#### <a name="delay-unload-import-address-table"></a>延遲卸載匯入位址表

延遲卸載匯入位址表 (UIAT) 是卸載程式 \_ \_ 代碼用來處理明確卸載要求之影像 THUNK 資料項目的選擇性資料表。 它是由唯讀區段中的初始化資料所組成，這是原始 IAT 的完整複本，會將程式碼參考至延遲載入的 Thunk。 在卸載要求中，可以釋出程式庫、 \* 清除 phmod，以及寫入 IAT 的 UIAT，以將所有內容還原至其預先載入的狀態。

## <a name="special-sections"></a>特殊章節

- [Debug 區段](#the-debug-section)
  - [僅限 (映射) 的 Debug Directory ](#debug-directory-image-only)
  - [Debug 型別](#debug-type)
  - [。僅) debug $ F (物件 ](#debugf-object-only)
  - [。 debug $ S 僅 (物件) ](#debugs-object-only)
  - [。僅) debug $ P (物件 ](#debugp-object-only)
  - [。僅) debug $ T (物件 ](#debugt-object-only)
  - [Microsoft Debug 資訊的連結器支援](#linker-support-for-microsoft-debug-information)
- [Drectve 區段僅 (物件) ](#the-drectve-section-object-only)
- [Edata 區段只 (映射) ](#the-edata-section-image-only)
  - [匯出目錄資料表](#export-directory-table)
  - [匯出位址資料表](#export-address-table)
  - [匯出名稱指標資料表](#export-name-pointer-table)
  - [匯出序數資料表](#export-ordinal-table)
  - [匯出名稱資料表](#export-name-table)
- [Idata 區段](#the-idata-section)
  - [匯入目錄資料表](#import-directory-table)
  - [匯入查閱資料表](#import-lookup-table)
  - [提示/名稱表](#hintname-table)
  - [匯入位址表](#delay-import-address-table)
- [.Pdata 區段](#the-pdata-section)
- [Reloc 區段只 (映射) ](#the-reloc-section-image-only)
  - [基底重新配置區塊](#base-relocation-block)
  - [基底重新配置類型](#base-relocation-types)
- [Tls 區段](#the-tls-section)
  - [TLS 目錄](#the-tls-directory)
  - [TLS 回呼函式](#tls-callback-functions)
- [負載設定結構只 (映射) ](#the-load-configuration-structure-image-only)
  - [載入設定目錄](#load-configuration-directory)
  - [載入設定配置](#load-configuration-layout)
- [.Rsrc 區段](#the-rsrc-section)
  - [資源目錄資料表](#resource-directory-table)
  - [資原始目錄專案](#resource-directory-entries)
  - [資原始目錄字串](#resource-directory-string)
  - [資源資料輸入](#resource-data-entry)
- [Cormeta 區段僅 (物件) ](#the-cormeta-section-object-only)
- [Sxdata 區段](#the-sxdata-section)

一般 COFF 區段包含的程式碼或資料，會連結器和 Microsoft Win32 載入器處理，而不需要特別瞭解區段內容。 這些內容僅與正在連結或執行的應用程式相關。

不過，在物件檔案或影像檔中找到某些 COFF 區段時，會有特殊意義。 因為工具和載入器會在區段標頭中設定特殊旗標，所以會辨識這些區段，因為影像選用標頭中的特殊位置會指向它們，或者因為區段名稱本身表示區段的特殊功能。  (即使區段名稱本身並未指出區段的特殊函式，區段名稱仍會依照慣例來決定，因此此規格的作者可以在所有情況下參考區段名稱。 ) 

下表描述保留的區段和其屬性，後面接著保存在可執行檔中的區段型別詳細描述，以及包含擴充的中繼資料的區段類型。



| 區段名稱          | Content                                                                                                                                                                  | 特性                                                                                                                                                                                                                                                                                                                                                                                   |
|-----------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| bss <br/>      |  (免費格式的未初始化資料)  <br/>                                                                                                                             | 映射 \_ SCN \_ CNT \_ 未初始化的 \_ 資料 \| 映射 \_ SCN \_ 記憶體 \_ 讀取 \| 映射 \_ SCN \_ 記憶體 \_ 寫入 <br/>                                                                                                                                                                                                                                                                                               |
| .cormeta <br/>  | 表示物件檔案包含 managed 程式碼的 CLR 中繼資料 <br/>                                                                                       | 影像 \_ SCN \_ .LNK \_ 資訊 <br/>                                                                                                                                                                                                                                                                                                                                                                 |
| 。資料 <br/>     |  (免費格式初始化資料)  <br/>                                                                                                                               | 映射 \_ SCN \_ CNT 已 \_ 初始化 \_ 資料 \| 映射 \_ SCN \_ 記憶體 \_ 讀取 \| 映射 \_ SCN \_ 記憶體 \_ 寫入 <br/>                                                                                                                                                                                                                                                                                                 |
| 。 debug $ F <br/>  | 產生的 FPO debug 資訊僅 (物件、x86 架構，現在已淘汰)  <br/>                                                                       | 映射 \_ SCN \_ CNT 已 \_ 初始化 \_ 資料 \| 映射 \_ SCN \_ 記憶體 \_ 讀取 \| 映射 \_ SCN \_ 記憶體 \_ DISCARDABLE <br/>                                                                                                                                                                                                                                                                                           |
| 。 debug $ P <br/>  | 僅 (物件) 先行編譯的 debug 類型 <br/>                                                                                                                        | 映射 \_ SCN \_ CNT 已 \_ 初始化 \_ 資料 \| 映射 \_ SCN \_ 記憶體 \_ 讀取 \| 映射 \_ SCN \_ 記憶體 \_ DISCARDABLE <br/>                                                                                                                                                                                                                                                                                           |
| 。 debug $ S <br/>  | 僅 (物件的 Debug 符號)  <br/>                                                                                                                                  | 映射 \_ SCN \_ CNT 已 \_ 初始化 \_ 資料 \| 映射 \_ SCN \_ 記憶體 \_ 讀取 \| 映射 \_ SCN \_ 記憶體 \_ DISCARDABLE <br/>                                                                                                                                                                                                                                                                                           |
| 。 debug $ T <br/>  | 僅 (物件的 Debug 類型)  <br/>                                                                                                                                    | 映射 \_ SCN \_ CNT 已 \_ 初始化 \_ 資料 \| 映射 \_ SCN \_ 記憶體 \_ 讀取 \| 映射 \_ SCN \_ 記憶體 \_ DISCARDABLE <br/>                                                                                                                                                                                                                                                                                           |
| .drective <br/> | 連結器選項 <br/>                                                                                                                                               | 影像 \_ SCN \_ .LNK \_ 資訊 <br/>                                                                                                                                                                                                                                                                                                                                                                 |
| .edata <br/>    | 匯出資料表 <br/>                                                                                                                                                | 映射 \_ SCN \_ CNT 已 \_ 初始化 \_ 資料 \| 映射 \_ SCN \_ 記憶體 \_ 讀取 <br/>                                                                                                                                                                                                                                                                                                                           |
| .idata <br/>    | 匯入資料表 <br/>                                                                                                                                                | 映射 \_ SCN \_ CNT 已 \_ 初始化 \_ 資料 \| 映射 \_ SCN \_ 記憶體 \_ 讀取 \| 映射 \_ SCN \_ 記憶體 \_ 寫入 <br/>                                                                                                                                                                                                                                                                                                 |
| . .idlsym <br/>   | 包含已註冊的 SEH (映射) 支援 IDL 屬性。 如需詳細資訊，請參閱本主題結尾之 [參考](#references) 中的「IDL 屬性」。 <br/> | 影像 \_ SCN \_ .LNK \_ 資訊 <br/>                                                                                                                                                                                                                                                                                                                                                                 |
| . .pdata <br/>    | 例外狀況資訊 <br/>                                                                                                                                        | 映射 \_ SCN \_ CNT 已 \_ 初始化 \_ 資料 \| 映射 \_ SCN \_ 記憶體 \_ 讀取 <br/>                                                                                                                                                                                                                                                                                                                           |
| . .rdata <br/>    | 唯讀的初始化資料 <br/>                                                                                                                                   | 映射 \_ SCN \_ CNT 已 \_ 初始化 \_ 資料 \| 映射 \_ SCN \_ 記憶體 \_ 讀取 <br/>                                                                                                                                                                                                                                                                                                                           |
| .reloc <br/>    | 映射重新置放 <br/>                                                                                                                                            | 映射 \_ SCN \_ CNT 已 \_ 初始化 \_ 資料 \| 映射 \_ SCN \_ 記憶體 \_ 讀取 \| 映射 \_ SCN \_ 記憶體 \_ DISCARDABLE <br/>                                                                                                                                                                                                                                                                                           |
| . .rsrc <br/>     | 資原始目錄 <br/>                                                                                                                                           | 映射 \_ SCN \_ CNT 已 \_ 初始化 \_ 資料 \| 映射 \_ SCN \_ 記憶體 \_ 讀取 <br/>                                                                                                                                                                                                                                                                                                                           |
| .sbss <br/>     | GP 相關的未初始化資料 (免費格式)  <br/>                                                                                                                 | 影像 \_ scn \_ CNT \_ 未初始化的 \_ 資料 \| 映射 \_ scn \_ 記憶體 \_ 讀取 \| 映射 \_ scn \_ 記憶體 \_ 寫入 \| 映射 \_ scn \_ GPREL \_ \_ 僅應針對 IA64 架構設定影像 scn GPREL 旗標; 此旗標對其他架構而言是不正確。 影像 \_ scn \_ GPREL 旗標僅適用于物件檔案; 當這個區段類型出現在影像檔案中時， \_ \_ 不能設定影像 scn GPREL 旗標。 <br/> |
| .sdata <br/>    |  (免費格式的 GP 相關初始化資料)  <br/>                                                                                                                   | 影像 \_ scn \_ CNT 已 \_ 初始化 \_ 資料 \| 映射 \_ scn \_ 記憶體 \_ 讀取 \| 映射 \_ scn \_ 記憶體 \_ 寫入 \| 映射 \_ scn \_ GPREL \_ \_ 應只針對 IA64 架構設定影像 scn GPREL 旗標; 此旗標對其他架構而言是不正確。 影像 \_ scn \_ GPREL 旗標僅適用于物件檔案; 當這個區段類型出現在影像檔案中時， \_ \_ 不能設定影像 scn GPREL 旗標。 <br/>   |
| .srdata <br/>   |  (免費格式的 GP 相對唯讀資料)  <br/>                                                                                                                     | 映射 \_ scn \_ CNT 已 \_ 初始化 \_ 資料 \| 映射 \_ SCN \_ 記憶體 \_ 讀取 \| 映射 \_ scn \_ GPREL 映射 \_ scn \_ GPREL 旗標只能針對 IA64 架構設定; 此旗標對其他架構而言是不正確。 影像 \_ scn \_ GPREL 旗標僅適用于物件檔案; 當這個區段類型出現在影像檔案中時， \_ \_ 不能設定影像 scn GPREL 旗標。 <br/>                             |
| .sxdata <br/>   | 已註冊的例外狀況處理常式資料 (自由格式和 x86/物件)  <br/>                                                                                          | 影像 \_ SCN \_ .Lnk \_ 資訊包含每個例外狀況處理常式的符號索引，這些例外狀況處理常式是由該物件檔案中的程式碼所參考。 此符號可以是適用于 UNDEF 符號或該模組中所定義的符號。 <br/>                                                                                                                                                                     |
| .text <br/>     |  (免費格式的可執行程式碼)  <br/>                                                                                                                                | 影像 \_ SCN \_ CNT 程式 \_ 代碼 \| 圖像 \_ SCN \_ 記憶體 \_ 執行 IIMAGE 的 \| \_ SCN \_ 記憶體 \_ 讀取 <br/>                                                                                                                                                                                                                                                                                                           |
| tls <br/>      | 僅限執行緒區域儲存 (物件)  <br/>                                                                                                                           | 映射 \_ SCN \_ CNT 已 \_ 初始化 \_ 資料 \| 映射 \_ SCN \_ 記憶體 \_ 讀取 \| 映射 \_ SCN \_ 記憶體 \_ 寫入 <br/>                                                                                                                                                                                                                                                                                                 |
| tls $ <br/>     | 僅限執行緒區域儲存 (物件)  <br/>                                                                                                                           | 映射 \_ SCN \_ CNT 已 \_ 初始化 \_ 資料 \| 映射 \_ SCN \_ 記憶體 \_ 讀取 \| 映射 \_ SCN \_ 記憶體 \_ 寫入 <br/>                                                                                                                                                                                                                                                                                                 |
| .vsdata <br/>   | GP 相關的初始化資料 (免費格式，而且僅適用于 ARM、SH4 和 Thumb 架構)  <br/>                                                                    | 映射 \_ SCN \_ CNT 已 \_ 初始化 \_ 資料 \| 映射 \_ SCN \_ 記憶體 \_ 讀取 \| 映射 \_ SCN \_ 記憶體 \_ 寫入 <br/>                                                                                                                                                                                                                                                                                                 |
| . .xdata <br/>    |  (免費格式的例外狀況資訊)  <br/>                                                                                                                          | 映射 \_ SCN \_ CNT 已 \_ 初始化 \_ 資料 \| 映射 \_ SCN \_ 記憶體 \_ 讀取 <br/>                                                                                                                                                                                                                                                                                                                           |



 

此處所列的部分區段會標示為「僅限物件」或「僅限影像」，以表示它們的特殊語義分別與物件檔案或影像檔相關。 標示為「僅限影像」的區段可能仍會出現在目的檔中，以取得影像檔案，但該區段對連結器沒有特殊意義，只適用于影像檔載入器。

### <a name="the-debug-section"></a>Debug 區段

Debug 區段可用於物件檔案中，以包含編譯器產生的偵錯工具資訊和影像檔案，以包含所有產生的偵錯工具資訊。 本節說明如何在物件和影像檔案中封裝偵錯工具資訊。

下一節描述 debug 目錄的格式，它可以是影像中的任何位置。 後續各節將說明包含偵錯工具的物件檔案中的「群組」。

連結器的預設值是，偵錯工具資訊不會對應至映射的位址空間。 答：只有在將 debug 資訊對應到位址空間時，才會存在 debug 區段。

#### <a name="debug-directory-image-only"></a>僅限 (映射) 的 Debug Directory

影像檔案包含選擇性的偵錯工具目錄，指出有哪些形式的 debug 資訊存在，以及在何處。 此目錄包含的偵錯工具目錄專案陣列，其位置和大小會在影像選用標頭中指出。

Debug 目錄可以位於 discardable 中， (（如果有的話）) ，或可包含在影像檔的任何其他區段中，或完全不在區段中。

每個 debug directory 專案都會識別一組偵錯工具資訊的位置和大小。 如果區段標題未涵蓋 debug 資訊，指定的 RVA 可以是零 (也就是說，它位於影像檔中，且未對應到執行時間位址空間) 。 如果對應，RVA 就是其位址。

Debug directory 專案的格式如下：



| Offset         | 大小          | 欄位                        | 描述                                                                                                                                            |
|----------------|---------------|------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 4 <br/> | 特性 <br/>  | Reserved，必須為零。 <br/>                                                                                                                    |
| 4 <br/>  | 4 <br/> | TimeDateStamp <br/>    | 建立偵錯工具資料的時間和日期。 <br/>                                                                                         |
| 8 <br/>  | 2 <br/> | MajorVersion <br/>     | Debug 資料格式的主要版本號碼。 <br/>                                                                                         |
| 10 <br/> | 2 <br/> | MinorVersion <br/>     | Debug 資料格式的次要版本號碼。 <br/>                                                                                         |
| 12 <br/> | 4 <br/> | 類型 <br/>             | 偵錯工具資訊的格式。 此欄位可支援多個偵錯工具。 如需詳細資訊，請參閱 [偵錯工具類型](#debug-type)。<br/> |
| 16 <br/> | 4 <br/> | SizeOfData <br/>       | Debug 資料的大小 (不包括 debug 目錄本身) 。 <br/>                                                                     |
| 20 <br/> | 4 <br/> | AddressOfRawData <br/> | 相較于映射基底載入時的 debug 資料位址。 <br/>                                                                     |
| 24 <br/> | 4 <br/> | PointerToRawData <br/> | 調試資料的檔案指標。 <br/>                                                                                                        |



 

#### <a name="debug-type"></a>Debug 型別

以下是針對 debug 目錄專案的 [類型] 欄位所定義的值：



| 常數                                        | 值          | 描述                                                                                                                                                                                                      |
|-------------------------------------------------|----------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 影像 \_ 調試 \_ 類型 \_ 未知 <br/>         | 0 <br/>  | 所有工具都會忽略未知值。 <br/>                                                                                                                                                       |
| 影像 \_ DEBUG \_ 類型 \_ COFF <br/>            | 1 <br/>  | COFF 偵錯資訊 (行號、符號表和字串表)。 使用檔案標頭中的欄位也可指向這類偵錯資訊。 <br/>                                          |
| 影像 \_ 調試 \_ 型別 \_ CODEVIEW <br/>        | 2 <br/>  | Visual C++ 的 debug 資訊。 <br/>                                                                                                                                                                    |
| 影像的 \_ DEBUG \_ 型別 \_ FPO <br/>             | 3 <br/>  | 框架指標會省略 (的 FPO) 資訊。 這種資訊會告知偵錯工具如何解讀非標準的堆疊框架，其使用 EBP 暫存器做為框架指標以外的用途。 <br/> |
| 影像 \_ 調試 \_ 型別的 \_ 其他 <br/>            | 4 <br/>  | DBG 檔案的位置。 <br/>                                                                                                                                                                            |
| 影像 \_ 調試 \_ 型別 \_ 例外狀況 <br/>       | 5 <br/>  | .Pdata 區段的複本。 <br/>                                                                                                                                                                            |
| 影像 \_ 調試 \_ 類型 \_ 修復 <br/>           | 6 <br/>  | 保留的。 <br/>                                                                                                                                                                                            |
| \_ \_ \_ OMAP \_ 至 \_ SRC 的影像調試型別 <br/>   | 7 <br/>  | 從影像中的 RVA 對應到來源影像中的 RVA。 <br/>                                                                                                                                          |
| \_ \_ \_ \_ 從 SRC OMAP 的影像調試型別 \_ <br/> | 8 <br/>  | 從來源影像中的 RVA 到影像中 RVA 的對應。 <br/>                                                                                                                                          |
| 影像 \_ 調試 \_ 型別 \_ BORLAND <br/>         | 9 <br/>  | 保留給 Borland。 <br/>                                                                                                                                                                                |
| 影像 \_ 調試 \_ 型別 \_ RESERVED10 <br/>      | 10 <br/> | 保留的。 <br/>                                                                                                                                                                                            |
| 影像 \_ 調試 \_ 型別 \_ CLSID <br/>           | 11 <br/> | 保留的。 <br/>                                                                                                                                                                                            |
| 映射 \_ 調試 \_ 型別 \_ 重現 <br/>           | 16 <br/> | PE 確定性或重現性。 <br/>                                                                                                                                                                   |
| 影像 \_ 調試 \_ 型別， \_ 例如 \_ DLLCHARACTERISTICS | 20 | 擴充的 DLL 特性位。 |



 

如果 [型別] 欄位設定為 [IMAGE \_ DEBUG \_ 型別 FPO] \_ ，則 DEBUG 原始資料是一個陣列，其中每個成員都會描述函式的堆疊框架。 並非影像檔中的每個函式都必須定義它的 FPO 資訊，即使 debug 型別為 FPO 也是一樣。 沒有 FPO 資訊的函式會假設為具有正常的堆疊框架。 FPO 資訊的格式如下所示：


```C++
#define FRAME_FPO   0               
#define FRAME_TRAP  1
#define FRAME_TSS   2
               
typedef struct _FPO_DATA {
    DWORD       ulOffStart;            // offset 1st byte of function code
    DWORD       cbProcSize;            // # bytes in function
    DWORD       cdwLocals;             // # bytes in locals/4
    WORD        cdwParams;             // # bytes in params/4
    WORD        cbProlog : 8;          // # bytes in prolog
    WORD        cbRegs   : 3;          // # regs saved
    WORD        fHasSEH  : 1;          // TRUE if SEH in func
    WORD        fUseBP   : 1;          // TRUE if EBP has been allocated
    WORD        reserved : 1;          // reserved for future use
    WORD        cbFrame  : 2;          // frame type
} FPO_DATA;
```



如果存在型別為「影像偵測型別重現」的專案， \_ \_ \_ 表示 PE 檔是以達成確定性或重現性的方式來建立。 如果輸入沒有變更，則不論產生 PE 的時間或位置為何，輸出 PE 檔保證都是位相同的。 PE 檔案中的各種日期/時間戳記欄位會填入使用 PE 檔案內容做為輸入的計算雜湊值中的部分或所有位，因此不再表示產生 PE 檔案或 PE 中相關特定資料的實際日期和時間。 此 debug 專案的原始資料可能是空的，或可能包含之前有四個位元組值的計算雜湊值，以表示雜湊值的長度。

如果 [型別] 欄位設定為 [影像偵測 \_ \_ 類型] \_ \_ （例如 DLLCHARACTERISTICS），則 DEBUG 原始資料包含擴充的 DLL 特性位，其他則可在映射的選擇性標頭中設定。 請參閱[ (僅限映射) 的區段選用標頭 Windows-Specific 欄位](#optional-header-windows-specific-fields-image-only)中的[DLL 特性](#dll-characteristics)。

##### <a name="extended-dll-characteristics"></a>擴充的 DLL 特性

下列是針對延伸 DLL 特性位定義的值。

| 常數 | 值 | 描述 |
|-|-|-|
| 影像 \_ DLLCHARACTERISTICS \_ 例如 \_ CET \_ 相容性 | 0x0001 | 映射與 CET 相容。 |

#### <a name="debugf-object-only"></a>。僅) debug $ F (物件

此區段中的資料已在 Visual C++ 7.0 版和更新版本中被取代，並由一組更廣泛的資料發出至 **debug $ S** 子區段。

物件檔案可以包含. debug $ F 區段，其內容為一或多個 FPO \_ 資料記錄 (框架指標省略資訊) 。 請參閱 \_ \_ \_ [DEBUG 型](#debug-type)別中的「影像調試型別 FPO」。

連結器會辨識這些 **. debug $ F** 記錄。 如果正在產生 debug 資訊，連結器會依 \_ 程式 RVA 排序 FPO 資料記錄，並為其產生一個 debug 目錄專案。

編譯器不應針對具有標準框架格式的程式產生 FPO 記錄。

#### <a name="debugs-object-only"></a>。 debug $ S 僅 (物件) 

本節包含 Visual C++ 的 (符號資訊) 的 debug 資訊。

#### <a name="debugp-object-only"></a>。僅) debug $ P (物件

本章節包含 (先行編譯資訊) Visual C++ 的 debug 資訊。 這些都是使用這個物件所產生之先行編譯標頭檔編譯的所有物件之間的共用類型。

#### <a name="debugt-object-only"></a>。僅) debug $ T (物件

本章節包含 (類型資訊) 的 Visual C++ debug 資訊。

#### <a name="linker-support-for-microsoft-debug-information"></a>Microsoft Debug 資訊的連結器支援

若要支援 debug 資訊，連結器：

-   從 **debug $ F**、 **debug $ S**、 **debug $ P** 和 **. debug $ T** 區段收集所有相關的 debug 資料。

-   會將該資料與連結器產生的偵錯工具產生的偵錯工具一起處理至 PDB 檔案中，並建立一個 debug 目錄專案來參考它。

### <a name="the-drectve-section-object-only"></a>Drectve 區段僅 (物件) 

如果區段 \_ \_ \_ 標頭中已設定 IMAGE SCN .lnk INFO 旗標，且 **drectve** 區段名稱為，則區段是指示詞區段。 連結器會在處理資訊之後移除 **drectve** 區段，因此區段不會出現在所連結的影像檔案中。

**Drectve** 區段是由可編碼為 ANSI 或 utf-8 的文字字串所組成。 如果 (BOM 的 UTF-8 位元組順序標記，則包含0xEF、0xBB 和 0xBF) 的三位元組前置詞不存在，指示詞字串會轉譯為 ANSI。 指示詞字串是以空格分隔的一系列連結器選項。 每個選項都包含連字號、選項名稱和任何適當的屬性。 如果選項包含空格，則選項必須以引號括住。 **Drectve** 區段不得有重新置放或行號。

### <a name="the-edata-section-image-only"></a>Edata 區段只 (映射) 

匯出資料區段（名為 edata）包含其他影像可透過動態連結存取之符號的相關資訊。 匯出的符號通常會在 Dll 中找到，但是 Dll 也可以匯入符號。

以下將說明匯出區段的一般結構。 所述的資料表通常會依顯示的順序在檔案中是連續的， (但) 不需要這麼做。 將符號匯出為序數時，只需要匯出目錄資料表和匯出位址表。  (序數是匯出，可直接透過匯出位址資料表索引來存取。 ) 名稱指標資料表、序數資料表和匯出名稱資料表都存在，以支援使用匯出名稱。



| 資料表名稱                         | Description                                                                                                                                                                                                                                                                                                                                                |
|------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 匯出目錄資料表 <br/> | 只有一個資料列的資料表 (與 debug 目錄) 不同。 下表指出其他匯出資料表的位置和大小。 <br/>                                                                                                                                                                                                               |
| 匯出位址資料表 <br/>   | 已匯出符號之 Rva 的陣列。 這些是在可執行程式碼和資料區段內匯出的函式和資料的實際位址。 其他影像檔案可以使用此資料表的索引來匯入符號， (序數) 或者，您也可以使用對應至序數的公用名稱（如果已定義公用名稱的話）。 <br/> |
| 名稱指標表 <br/>     | 公開匯出名稱指標的陣列，以遞增順序排序。 <br/>                                                                                                                                                                                                                                                                    |
| 序數資料表 <br/>          | 序數的陣列，對應至名稱指標資料表的成員。 對應的位置是：因此，名稱指標資料表和序數資料表必須有相同數目的成員。 每個序數都是匯出位址資料表的索引。 <br/>                                                                        |
| 匯出名稱資料表 <br/>      | 一系列以 null 終止的 ASCII 字串。 名稱指標表格的成員會指向此區域。 這些名稱是用來匯入和匯出符號的公用名稱;它們不一定會與在影像檔案中使用的私用名稱相同。 <br/>                                                           |



 

當另一個影像檔案依名稱匯入符號時，Win32 載入器會在名稱指標資料表中搜尋相符的字串。 如果找到相符的字串，則會藉由查詢序數資料表中對應的成員來識別相關聯的序數 (也就是序數資料表的成員，其索引與在名稱指標資料表中找到的字串指標相同) 。 產生的序數是匯出位址資料表中的索引，可提供所需符號的實際位置。 每個匯出符號都可以透過序數來存取。

當另一個影像檔依序數匯入符號時，不需要在名稱指標資料表中搜尋相符的字串。 因此，直接使用序數是更有效率的方式。 不過，匯出名稱比較容易記住，使用者也不需要知道符號的資料表索引。

#### <a name="export-directory-table"></a>匯出目錄資料表

匯出符號資訊會以匯出目錄資料表開頭，其描述匯出符號資訊的其餘部分。 匯出目錄資料表包含位址資訊，可用來將匯入解析為此映射內的進入點。



| Offset         | 大小          | 欄位                                | 描述                                                                                                                                                               |
|----------------|---------------|--------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 4 <br/> | 匯出旗標 <br/>             | 保留，必須是0。 <br/>                                                                                                                                          |
| 4 <br/>  | 4 <br/> | 時間/日期戳記 <br/>          | 建立匯出資料的時間和日期。 <br/>                                                                                                           |
| 8 <br/>  | 2 <br/> | 主要版本 <br/>            | 主要版本號碼。 使用者可以設定主要和次要版本號碼。 <br/>                                                                         |
| 10 <br/> | 2 <br/> | 次要版本 <br/>            | 次要版本號碼。 <br/>                                                                                                                                     |
| 12 <br/> | 4 <br/> | 名稱 RVA <br/>                 | 包含 DLL 名稱之 ASCII 字串的位址。 此位址是相對於映射基底。 <br/>                                                |
| 16 <br/> | 4 <br/> | 序數基底 <br/>             | 此影像中匯出的起始序號。 此欄位指定匯出位址資料表的起始序號。 通常會設定為1。 <br/> |
| 20 <br/> | 4 <br/> | 位址資料表專案 <br/>    | 匯出位址資料表中的專案數。 <br/>                                                                                                            |
| 24 <br/> | 4 <br/> | 名稱指標的數目 <br/>  | 名稱指標資料表中的專案數。 這也是序數資料表中的專案數。 <br/>                                                     |
| 28 <br/> | 4 <br/> | 匯出位址資料表 RVA <br/> | 相對於映射基底的匯出位址資料表位址。 <br/>                                                                                          |
| 32 <br/> | 4 <br/> | 名稱指標 RVA <br/>         | 相對於映射基底的匯出名稱指標資料表位址。 資料表大小是由 [名稱指標] 欄位的數目所指定。 <br/>                       |
| 36 <br/> | 4 <br/> | 序數資料表 RVA <br/>        | 相對於映射基底的序數資料表位址。 <br/>                                                                                                 |



 

#### <a name="export-address-table"></a>匯出位址資料表

匯出位址表包含匯出的進入點和匯出的資料和變成以絕對性的位址。 序數會用來做為匯出位址資料表的索引。

匯出位址表中的每個專案都是一個欄位，使用下表中的兩種格式之一。 如果指定的位址不在匯出區段內 (（如選擇性標頭) 中所指出的位址和長度所定義），則欄位是匯出 RVA，也就是程式碼或資料中的實際位址。 否則，此欄位是轉寄站 RVA，會在另一個 DLL 中命名符號。



| Offset        | 大小          | 欄位                     | 描述                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|---------------|---------------|---------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/> | 4 <br/> | 匯出 RVA <br/>    | 載入至記憶體（相對於映射基底）時所匯出符號的位址。 例如，匯出函式的位址。 <br/>                                                                                                                                                                                                                                                                                                       |
| 0 <br/> | 4 <br/> | 轉寄站 RVA <br/> | 匯出區段中以 null 終止的 ASCII 字串指標。 此字串必須在匯出資料表資料目錄專案所指定的範圍內。 請參閱 [僅)  (映射的選擇性標頭資料目錄 ](#optional-header-data-directories-image-only)。 這個字串會提供 DLL 名稱和匯出 (的名稱，例如 "MYDLL.DLL. expfunc" ) 或 DLL 名稱和匯出 (的序數，例如 "MYDLL.DLL. \#27 ") 。 <br/> |



 

轉寄站 RVA 會從其他影像匯出定義，使其看起來像是目前映射正在匯出的定義。 因此，符號會同時匯入和匯出。

例如，在 Windows XP 的 Kernel32.dll 中，會將名為 "HeapAlloc" 的匯出轉送至字串 "NTDLL.DLL"。RtlAllocateHeap." 如此一來，應用程式就可以使用 Windows XP 特定模組 Ntdll.dll，而不需要實際包含其匯入參考。 應用程式的匯入資料表只會參考 Kernel32.dll。 因此，應用程式不是 Windows XP 特有的，而且可以在任何 Win32 系統上執行。

#### <a name="export-name-pointer-table"></a>匯出名稱指標資料表

匯出名稱指標資料表是 (Rva) 至匯出名稱資料表的位址陣列。 指標分別為32位，且相對於映射基底。 指標會以詞法順序排序以允許二進位搜尋。

只有當匯出名稱指標資料表包含指標時，才會定義匯出名稱。

#### <a name="export-ordinal-table"></a>匯出序數資料表

匯出序數資料表是匯出位址資料表中的16位無偏差索引陣列。 序數會依匯出目錄資料表的序數基底欄位而偏差。 換句話說，必須從序數減去序數基底，才能取得匯出位址資料表的真正索引。

匯出名稱指標資料表和匯出序數表形成兩個平行陣列，以允許自然的欄位對齊。 這兩個數據表實際上會以一個資料表的形式運作，其中匯出名稱指標資料行會指向公用 (匯出) 名稱，而匯出序數資料行則會提供該公用名稱的對應序數。 匯出名稱指標資料表的成員和匯出序數資料表成員的關聯，是在其各自的陣列中 (索引) 的相同位置。

因此，在搜尋匯出名稱指標表格，並在位置 i 找到相符的字串時，尋找符號之 RVA 和偏差序數的演算法為：

```C++
i = Search_ExportNamePointerTable (name);
ordinal = ExportOrdinalTable [i];

rva = ExportAddressTable [ordinal];
biased_ordinal = ordinal + OrdinalBase;
```

當 (偏差) 序數來搜尋符號時，尋找符號之 RVA 和名稱的演算法為：

```C++
ordinal = biased_ordinal - OrdinalBase;
i = Search_ExportOrdinalTable (ordinal);

rva = ExportAddressTable [ordinal];
name = ExportNameTable [i];
```

#### <a name="export-name-table"></a>匯出名稱資料表

匯出名稱資料表包含匯出名稱指標資料表所指向的實際字串資料。 下表中的字串是其他影像可以用來匯入符號的公用名稱。 這些公用匯出名稱不一定會與符號在其本身的影像檔和原始程式碼中的私用符號名稱相同，不過它們可以是。

每個匯出的符號都有序數值，而這只是匯出位址資料表中的索引。 不過，使用匯出名稱是選擇性的。 部分、全部或沒有匯出的符號都可以有匯出名稱。 針對具有匯出名稱的匯出符號，匯出名稱指標資料表和匯出序數資料表中的對應專案會一起運作，以將每個名稱與序數產生關聯。

匯出名稱資料表的結構是以 null 結束的一系列可變長度的 ASCII 字串。

### <a name="the-idata-section"></a>Idata 區段

所有匯入符號的影像檔，包括幾乎所有可執行檔 (EXE) 檔案，都有 idata 區段。 匯入資訊的一般檔案版面配置如下：

-   目錄資料表

    Null 目錄專案

-   DLL1 匯入查閱資料表

    Null

-   DLL2 匯入查閱資料表

    Null

-   DLL3 匯入查閱資料表

    Null

-   Hint-Name 資料表

#### <a name="import-directory-table"></a>匯入目錄資料表

匯入資訊的開頭為 [匯入目錄] 資料表，其中描述匯入資訊的其餘部分。 匯入目錄資料表包含位址資訊，可用來解析 DLL 映射內進入點的修復參考。 匯入目錄資料表是由匯入目錄專案的陣列所組成，此為影像所參考之每個 DLL 的一個專案。 最後一個目錄專案是空的 (填入 null 值) ，表示目錄資料表的結尾。

每個匯入目錄專案的格式如下：



| Offset         | 大小          | 欄位                                                 | 描述                                                                                                                                                                                 |
|----------------|---------------|-------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 4 <br/> | 匯入查閱資料表 RVA (特性)  <br/> | 匯入查閱資料表的 RVA。 此資料表包含每個匯入的名稱或序數。  (在 Winnt 中使用 "特性" 的名稱，但不再描述此欄位。 )  <br/> |
| 4 <br/>  | 4 <br/> | 時間/日期戳記 <br/>                           | 在影像系結之前，設定為零的戳記。 在系結影像之後，這個欄位會設定為 DLL 的時間/資料戳記。 <br/>                                          |
| 8 <br/>  | 4 <br/> | 轉寄站鏈 <br/>                           | 第一個轉寄站參考的索引。 <br/>                                                                                                                                     |
| 12 <br/> | 4 <br/> | 名稱 RVA <br/>                                  | 包含 DLL 名稱之 ASCII 字串的位址。 此位址是相對於映射基底。 <br/>                                                                   |
| 16 <br/> | 4 <br/> | 匯入位址表 RVA (Thunk 資料表)  <br/>    | 匯入位址資料表的 RVA。 此資料表的內容與匯入查閱資料表的內容相同，直到影像系結為止。 <br/>                              |



 

#### <a name="import-lookup-table"></a>匯入查閱資料表

匯入查閱資料表是 PE32 的32位數位陣列，或 PE32 + 的64位數位陣列。 每個專案都會使用下表所述的位欄位格式。 以這種格式來說，PE32 和 bit 63 最重要的一點是 PE32 + 最重要的位。 這些專案的集合描述來自指定 DLL 的所有匯入。 最後一個專案設定為零 (Null) 指出資料表的結尾。



| 位 (s)             | 大小           | 位元欄位                       | Description                                                                                                                                                               |
|-------------------|----------------|---------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31/63 <br/> | 1 <br/>  | 序數/名稱旗標 <br/>   | 如果設定此位，則依序數匯入。 否則，請依名稱匯入。 Bit 會遮罩為 PE32、0x8000000000000000 for PE32 + 的0x80000000。 <br/>                         |
| 15-0 <br/>  | 16 <br/> | 序數 <br/>      | 16位序數。 只有當序數/名稱旗標位欄位是 1 (由序數) 匯入時，才會使用此欄位。 Bits 30-15 或62-15 必須為0。 <br/>                  |
| 30-0 <br/>  | 31 <br/> | 提示/名稱資料表 RVA <br/> | 提示/名稱資料表專案的31位 RVA。 只有當序數/名稱旗標位欄位為 0 (依名稱) 匯入時，才會使用此欄位。 PE32 + bits 62-31 必須為零。 <br/> |



 

#### <a name="hintname-table"></a>提示/名稱表

針對整個匯入區段尾碼一個提示/名稱資料表。 提示/名稱表中的每個專案都具有下列格式：



| Offset         | 大小                 | 欄位            | 描述                                                                                                                                                                                       |
|----------------|----------------------|------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 2 <br/>        | 提示 <br/> | 匯出名稱指標資料表中的索引。 首先會使用這個值來嘗試符合項。 如果失敗，則會對 DLL 的匯出名稱指標資料表執行二進位搜尋。 <br/>            |
| 2 <br/>  | 變動 <br/> | Name <br/> | 包含要匯入之名稱的 ASCII 字串。 這是必須與 DLL 中的公用名稱相符的字串。 這個字串會區分大小寫，並以 null 位元組終止。 <br/> |
| \* <br/> | 0 或 1 <br/>   | Pad <br/>  | 尾端的零填補位元組（如有必要）會出現在尾端 null 位元組之後，以對齊偶數界限的下一個專案。 <br/>                                                        |



 

#### <a name="import-address-table"></a>匯入位址表

匯入位址表的結構和內容與匯入查閱資料表的結構和內容相同，直到檔案系結為止。 在系結期間，匯入位址表中的專案會覆寫為 PE32) 的32位 (，或要匯入的符號之 PE32 +) 位址的64位 (。 這些位址是符號的實際記憶體位址，雖然技術上，它們仍稱為「虛擬位址」。 載入器通常會處理系結。

### <a name="the-pdata-section"></a>.Pdata 區段

.Pdata 區段包含函式資料表專案的陣列，用於例外狀況處理。 它是由 image data 目錄中的例外狀況資料表專案所指向。 這些專案必須根據函數位址來排序 (每個結構中的第一個欄位) ，然後才會發出到最終的影像。 目標平臺會使用下面所述的三個函式資料表輸入格式變化來決定哪一種。

若為32位的 MIPS 映射，函式資料表專案的格式如下：



| Offset         | 大小          | 欄位                          | 描述                                                                    |
|----------------|---------------|--------------------------------|--------------------------------------------------------------------------------|
| 0 <br/>  | 4 <br/> | 開始位址 <br/>      | 對應函式的 VA。 <br/>                              |
| 4 <br/>  | 4 <br/> | 結束位址 <br/>        | 函數結尾的 VA。 <br/>                                 |
| 8 <br/>  | 4 <br/> | 例外狀況處理常式 <br/>  | 要執行之例外狀況處理常式的指標。 <br/>               |
| 12 <br/> | 4 <br/> | 處理常式資料 <br/>       | 要傳遞給處理常式之其他資訊的指標。 <br/> |
| 16 <br/> | 4 <br/> | 初構結束位址 <br/> | 函數初構結尾的 VA。 <br/>                        |



 

針對 ARM、PowerPC、SH3 和 SH4 Windows CE 平臺，函數資料表專案具有下列格式：



| Offset        | 大小                | 欄位                       | 描述                                                                                                               |
|---------------|---------------------|-----------------------------|---------------------------------------------------------------------------------------------------------------------------|
| 0 <br/> | 4 <br/>       | 開始位址 <br/>   | 對應函式的 VA。 <br/>                                                                         |
| 4 <br/> | 8 位元 <br/>  | 初構長度 <br/>   | 函數初構中的指令數目。 <br/>                                                          |
| 4 <br/> | 22位 <br/> | 函數長度 <br/> | 函數中的指令數目。 <br/>                                                                   |
| 4 <br/> | 1位 <br/>   | 32位旗標 <br/>     | 如果設定，則函式包含32位的指令。 如果清除，則函式包含16位指令。 <br/> |
| 4 <br/> | 1位 <br/>   | 例外狀況旗標 <br/>  | 如果設定，則函式會有例外狀況處理常式。 否則，就不會有任何例外狀況處理常式。 <br/>                 |



 

針對 x64 和 Itanium 平臺，函數資料表專案具有下列格式：



| Offset        | 大小          | 欄位                          | 描述                                        |
|---------------|---------------|--------------------------------|----------------------------------------------------|
| 0 <br/> | 4 <br/> | 開始位址 <br/>      | 對應函數的 RVA。 <br/> |
| 4 <br/> | 4 <br/> | 結束位址 <br/>        | 函數結尾的 RVA。 <br/>    |
| 8 <br/> | 4 <br/> | 回溯資訊 <br/> | 回溯資訊的 RVA。 <br/>     |



 

### <a name="the-reloc-section-image-only"></a>Reloc 區段只 (映射) 

基底重新配置資料表包含映射中所有基底重新置放的專案。 選用標頭資料目錄中的基底重新配置資料表欄位會提供基底重新配置資料表中的位元組數目。 如需詳細資訊，請參閱 [選擇性的標頭資料目錄 (映射) ](#optional-header-data-directories-image-only)。 基底重新配置資料表會分割成區塊。 每個區塊都代表4K 頁面的基底重新置放。 每個區塊都必須在32位界限上啟動。

除非載入映射無法在 PE 標頭中指定的映射基底載入，否則不需要載入器處理連結器所解析的基底重新置放。

#### <a name="base-relocation-block"></a>基底重新配置區塊

每個基底重新配置區塊的開頭都是下列結構：



| Offset        | 大小          | 欄位                  | 描述                                                                                                                                              |
|---------------|---------------|------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/> | 4 <br/> | Page RVA <br/>   | 映射基底加上頁面 RVA 會新增至每個位移，以建立必須套用基底重新配置的 VA。 <br/>                         |
| 4 <br/> | 4 <br/> | 區塊大小 <br/> | 基底重新配置區塊中的總位元組數，包括頁面 RVA 和區塊大小欄位，以及後續的類型/位移欄位。 <br/> |



 

[區塊大小] 欄位後面接著任何數目的類型或位移欄位專案。 每個專案都是一個字 (2 個位元組) ，而且具有下列結構：



| Offset        | 大小                | 欄位              | 描述                                                                                                                                                                                                            |
|---------------|---------------------|--------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/> | 4位 <br/>  | 類型 <br/>   | 儲存在單字的高4位中，此值表示要套用的基底重新配置類型。 如需詳細資訊，請參閱 [基底](#base-relocation-types)重新配置類型。<br/>                         |
| 0 <br/> | 12個位 <br/> | Offset <br/> | 儲存在單字的其餘12個位中，從區塊的 Page RVA 欄位中指定的起始位址位移。 此位移指定要套用基底重新配置的位置。 <br/> |



 

若要套用基底重新配置，則會在慣用基底位址和實際載入映射的基底之間計算差異。 如果映射是以其慣用的基底載入，則差異為零，因此不需要套用基底重新置放。

#### <a name="base-relocation-types"></a>基底重新配置類型



| 常數                                       | 值          | 描述                                                                                                                                                                                                                                                                                                                       |
|------------------------------------------------|----------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 影像 \_ REL \_ 型 \_ 絕對 <br/>        | 0 <br/>  | 已略過基底重新配置。 此類型可以用來填補區塊。 <br/>                                                                                                                                                                                                                                                 |
| 影像 \_ REL \_ （ \_ 高度） <br/>            | 1 <br/>  | 基底重新配置會在位移的16位欄位中加入差異的高16位。 16位欄位代表32位字的最高值。 <br/>                                                                                                                                                               |
| 影像 \_ REL \_ （ \_ 低） <br/>             | 2 <br/>  | 基底重新配置會將差的低16位加入至位移的16位欄位。 16位欄位代表32位單字的下半部。 <br/>                                                                                                                                                                  |
| 影像 \_ REL \_ 型 \_ HIGHLOW <br/>         | 3 <br/>  | 基底重新配置會將所有32位的差異套用至位移上的32位欄位。 <br/>                                                                                                                                                                                                                              |
| 影像 \_ REL \_ 型 \_ HIGHADJ <br/>         | 4 <br/>  | 基底重新配置會在位移的16位欄位中加入差異的高16位。 16位欄位代表32位字的最高值。 32位值的低16位會儲存在此基底重新配置之後的16位字組中。 這表示此基底重新配置佔用兩個位置。 <br/> |
| 以影像 \_ REL 為 \_ 基礎的 \_ MIPS \_ JMPADDR <br/>   | 5 <br/>  | 重新配置轉譯相依于電腦類型。 <br/> 當機器類型是 MIPS 時，基底重新配置會套用至 MIPS 跳躍指令。 <br/>                                                                                                                                                    |
| 以影像 \_ REL 為 \_ 基礎的 \_ ARM \_ MOV32 <br/>      | 5 <br/>  | 只有當機器類型為 ARM 或 Thumb 時，此重新配置才有意義。 基底重新配置會跨連續的 MOVW/MOVT 指令配對套用符號的32位位址。 <br/>                                                                                                                                 |
| 影像 \_ REL \_ 型 \_ RISCV \_ HIGH20 <br/>   | 5 <br/>  | 只有當機器類型為 RISC-V 時，此重新配置才有意義。 基底重新配置適用于32位絕對位址的高20位。 <br/>                                                                                                                                                                     |
|                                                | 6 <br/>  | Reserved，必須為零。 <br/>                                                                                                                                                                                                                                                                                               |
| 影像 \_ REL \_ 型 \_ THUMB \_ MOV32 <br/>    | 7 <br/>  | 只有當機器類型為 Thumb 時，此重新配置才有意義。 基底重新配置會將符號的32位位址套用至連續的 MOVW/MOVT 指令配對。 <br/>                                                                                                                                            |
| 影像 \_ REL \_ 型 \_ RISCV \_ LOW12I <br/>   | 7 <br/>  | 只有當機器類型為 RISC-V 時，此重新配置才有意義。 基底重新配置適用于以 RISC-V I 類型指令格式形成的32位絕對位址的低12位。 <br/>                                                                                                                           |
| 影像 \_ REL \_ 型 \_ RISCV \_ LOW12S <br/>   | 8 <br/>  | 只有當機器類型為 RISC-V 時，此重新配置才有意義。 基底重新配置適用于以 RISC-V S 類型指令格式形成的32位絕對位址的低12位。 <br/>                                                                                                                           |
| 以影像 \_ REL 為 \_ 基礎的 \_ MIPS \_ JMPADDR16 <br/> | 9 <br/>  | 只有當機器類型是 MIPS 時，重新配置才有意義。 基底重新配置適用于 MIPS16 跳躍指令。 <br/>                                                                                                                                                                                            |
| 影像 \_ REL \_ 型 \_ DIR64 <br/>           | 10 <br/> | 基底重新配置會在位移的64位欄位上套用差異。 <br/>                                                                                                                                                                                                                                             |



 

### <a name="the-tls-section"></a>Tls 區段

Tls 區段為靜態執行緒區域儲存 (TLS) 提供直接 PE 和 COFF 支援。 TLS 是一種特殊的儲存類別，可讓資料物件不是自動 (stack) 變數，而是在執行程式碼的每個個別執行緒的本機上。 因此，每個執行緒都可以針對使用 TLS 所宣告的變數維護不同的值。

請注意，您可以使用 API 呼叫 TlsAlloc、TlsFree、TlsSetValue 和 TlsGetValue 來支援任何數量的 TLS 資料。 PE 或 COFF 實作為使用 API 的替代方法，其優點是可從高階語言程式設計師的觀點來簡化。 這項實行可讓您定義和初始化 TLS 資料，類似于程式中的一般靜態變數。 例如，在 Visual C++ 中，靜態 TLS 變數可以定義如下，而不需要使用 Windows API：

`__declspec (thread) int tlsFlag = 1;`

為了支援此程式設計結構，PE 和 COFF 區段會指定下列資訊：初始化資料、每個執行緒初始化和終止的回呼常式，以及 TLS 索引（將在下列討論中說明）。

> [!Note]
>
> 靜態宣告的 TLS 資料物件只能用在靜態載入的影像檔案中。 這種事實可讓您不可靠地在 DLL 中使用靜態 TLS 資料，除非您知道 DLL 或靜態連結的任何資料都不會以 LoadLibrary API 函數動態載入。

 

可執行程式碼會透過下列步驟來存取靜態 TLS 資料物件：

1.  在連結時，連結器會設定 TLS 目錄的索引欄位位址。 此欄位會指向程式預期接收 TLS 索引的位置。

    Microsoft 執行時間程式庫可讓您定義 TLS 目錄的記憶體映射，並為其提供特殊名稱「 \_ \_ 使用 tls」 \_ (Intel x86 平臺) 或「 \_ 使用的 tls」 \_ (其他平臺) 。 連結器會尋找這個記憶體映射，並使用該處的資料來建立 TLS 目錄。 其他支援 TLS 和使用 Microsoft 連結器的編譯器必須使用相同的技術。

2.  建立執行緒時，載入器會藉由將執行緒環境區塊的位址放在 FS 註冊 (TEB) ，來傳達執行緒的 TLS 陣列位址。 TLS 陣列的指標位於 TEB 開頭的0x2C 位移。 這是 Intel x86 特定的行為。

3.  載入器會將 TLS 索引的值指派給索引欄位位址所指示的位置。

4.  可執行程式碼會抓取 TLS 索引，也會抓取 TLS 陣列的位置。

5.  程式碼會使用 TLS 索引和 TLS 陣列位置 (將索引乘以4，然後使用它做為陣列的位移) 來取得指定程式和模組的 TLS 資料區域位址。 每個執行緒都有自己的 TLS 資料區域，但這對程式而言是透明的，不需要知道如何為個別執行緒配置資料。

6.  在 TLS 資料區域中，會將個別的 TLS 資料物件當作一些固定的位移來存取。

TLS 陣列是系統為每個執行緒維護的位址陣列。 此陣列中的每個位址會提供程式中)  (EXE 或 DLL 的 TLS 資料位置。 TLS 索引會指出要使用的陣列成員。 索引是一個數位 (只對識別模組的系統) 有意義。

#### <a name="the-tls-directory"></a>TLS 目錄

TLS 目錄的格式如下：



| Offset (PE32/PE32 +)  | 大小 (PE32/PE32 +)  | 欄位                            | 描述                                                                                                                                                                                                                                                                                                                                         |
|----------------------|--------------------|----------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>        | 4/8 <br/>    | 原始資料開始 VA <br/>    | TLS 範本的起始位址。 此範本是用來初始化 TLS 資料的資料區塊。 系統會在每次建立執行緒時複製這些資料，因此它不一定會損毀。 請注意，此位址不是 RVA;它是 reloc 區段中應該有基底重新配置的位址。 <br/> |
| 4/8 <br/>      | 4/8 <br/>    | 原始資料結束 VA <br/>      | TLS 最後一個位元組的位址，但不含填滿。 如同 Raw Data Start VA 欄位，這是 VA，而非 RVA。 <br/>                                                                                                                                                                                                       |
| 8/16 <br/>     | 4/8 <br/>    | 索引的位址 <br/>     | 要接收 TLS 索引的位置，載入器會將它指派。 這個位置是在一般資料區段中，因此可以指定程式可存取的符號名稱。 <br/>                                                                                                                                                    |
| 12/24 <br/>    | 4/8 <br/>    | 回呼位址 <br/> | TLS 回呼函數陣列的指標。 陣列以 null 終止，因此如果不支援任何回呼函式，則此欄位會指向4個位元組，並設定為零。 如需這些函式原型的詳細資訊，請參閱 [TLS 回呼函數](#tls-callback-functions)。<br/>                                                      |
| 16/32 <br/>    | 4 <br/>      | 大小為零填滿 <br/>    | 範本的大小（以位元組為單位），超過原始資料開始 VA 和原始資料 End VA 欄位所分隔的初始化資料。 範本大小總計應與影像檔案中的 TLS 資料大小總計相同。 零填滿是在初始化的非零資料之後的資料量。 <br/>                            |
| 20/36 <br/>    | 4 <br/>      | 特性 <br/>      | 四個位 \[ 23:20 \] 描述對齊方式資訊。 可能的值是定義為影像 \_ SCN \_ 對齊的值 \_ \* ，也就是用來描述物件檔中的區段對齊。 其他28位則保留供日後使用。 <br/>                                                                                                       |



 

#### <a name="tls-callback-functions"></a>TLS 回呼函式

此程式可以提供一或多個 TLS 回呼函式，以支援 TLS 資料物件的額外初始化和終止。 這類回呼函數的一般用法是呼叫物件的函式和析構函數。

雖然通常不會有一個以上的回呼函式，但是回呼會實作為陣列，讓您可以視需要新增其他回呼函數。 如果有一個以上的回呼函式，每個函式都會依其位址出現在陣列中的順序來呼叫。 Null 指標會結束陣列。 具有空的清單 (沒有回呼支援的) ，在這種情況下，回呼陣列只有一個成員-a null 指標。

回呼函式的原型 (由型別 PIMAGE TLS 回呼) 的指標所指向，與 \_ \_ DLL 進入點函數的參數相同：


```C++
typedef VOID
(NTAPI *PIMAGE_TLS_CALLBACK) (
    PVOID DllHandle,
    DWORD Reason,
    PVOID Reserved
    );
```



保留參數應設為零。 Reason 參數可以採用下列值：



| 設定                          | 值         | 描述                                                                                          |
|----------------------------------|---------------|------------------------------------------------------------------------------------------------------|
| DLL \_ 進程 \_ 附加 <br/> | 1 <br/> | 已開始新的進程，包括第一個執行緒。 <br/>                                   |
| DLL \_ 執行緒 \_ 附加 <br/>  | 2 <br/> | 已建立新的執行緒。 這是針對所有的第一個執行緒傳送的通知。 <br/>      |
| DLL \_ 執行緒卸 \_ 離 <br/>  | 3 <br/> | 執行緒即將終止。 這是針對所有的第一個執行緒傳送的通知。 <br/> |
| DLL \_ 進程卸 \_ 離 <br/> | 0 <br/> | 進程即將終止，包括原始執行緒。 <br/>                          |



 

### <a name="the-load-configuration-structure-image-only"></a>負載設定結構只 (映射) 

負載設定結構 (映射 \_ 載入設定 \_ \_ 目錄) 先前在 Windows NT 作業系統本身的極少數情況下使用，以描述太難或太大而無法在映射的檔案標頭或選擇性標頭中描述的各種功能。 目前版本的 Microsoft 連結器和 Windows XP 及更新版本的 Windows 會針對32位 x86 系統（包括保留的 SEH 技術）使用此結構的新版本。 這會提供作業系統在例外狀況分派期間使用的安全結構化例外狀況處理常式清單。 如果處理常式位址位於影像的 VA 範圍內，並標示為保留的 SEH 感知 (也就是，在 \_ \_ \_ 選擇性標頭的 DLLCHARACTERISTICS 欄位中沒有 SEH 清除，如先前) 所述，則處理常式必須在該映射的已知安全處理常式清單中。 否則，作業系統會終止應用程式。 這有助於防止「x86 例外狀況處理常式劫持」惡意探索過去用來控制作業系統。

Microsoft 連結器會自動提供預設的載入設定結構，以包含保留的 SEH 資料。 如果使用者程式碼已經提供負載設定結構，則必須包含新的保留 SEH 欄位。 否則，連結器不能包含保留的 SEH 資料，而且映射也不會標示為包含保留的 SEH。

#### <a name="load-configuration-directory"></a>載入設定目錄

預先保留的 SEH 負載設定結構的資料目錄專案必須指定負載設定結構的特定大小，因為作業系統載入器一律會預期它是特定的值。 就這一點而言，大小其實只是版本檢查。 為了與 Windows XP 和舊版的 Windows 相容，x86 映射的大小必須為64。

#### <a name="load-configuration-layout"></a>載入設定配置

針對32位和64位 PE 檔案，負載設定結構具有下列配置：



| Offset              | 大小            | 欄位                                      | 描述                                                                                                                                                                                                                                                                                 |
|---------------------|-----------------|--------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>       | 4 <br/>   | 特性 <br/>                | 指出檔案屬性的旗標，目前未使用。 <br/>                                                                                                                                                                                                                   |
| 4 <br/>       | 4 <br/>   | TimeDateStamp <br/>                  | 日期和時間戳記值。 此值會以秒數表示，從午夜 (00:00:00) 、1970年1月1日、全球協調時間（根據系統時鐘）。 您可以使用 C 執行時間 (CRT) 時間函數來列印時間戳記。 <br/> |
| 8 <br/>       | 2 <br/>   | MajorVersion <br/>                   | 主要版本號碼。 <br/>                                                                                                                                                                                                                                                           |
| 10 <br/>      | 2 <br/>   | MinorVersion <br/>                   | 次要版本號碼。 <br/>                                                                                                                                                                                                                                                           |
| 12 <br/>      | 4 <br/>   | GlobalFlagsClear <br/>               | 當載入器啟動處理常式時，要清除此進程的全域載入器旗標。 <br/>                                                                                                                                                                                             |
| 16 <br/>      | 4 <br/>   | GlobalFlagsSet <br/>                 | 當載入器啟動處理常式時，要為此進程設定的全域載入器旗標。 <br/>                                                                                                                                                                                               |
| 20 <br/>      | 4 <br/>   | CriticalSectionDefaultTimeout <br/>  | 要在這個進程的重要區段中使用的預設超時值。 <br/>                                                                                                                                                                                       |
| 24 <br/>      | 4/8 <br/> | DeCommitFreeBlockThreshold <br/>     | 必須在傳回給系統之前釋放的記憶體（以位元組為單位）。 <br/>                                                                                                                                                                                                        |
| 28/32 <br/>   | 4/8 <br/> | DeCommitTotalFreeThreshold <br/>     | 可用記憶體總量（以位元組為單位）。 <br/>                                                                                                                                                                                                                                          |
| 32/40 <br/>   | 4/8 <br/> | LockPrefixTable <br/>                | \[x86 僅限 \] 使用鎖定首碼之地址清單的 VA，讓它們可以在單一處理器電腦上以 NOP 取代。 <br/>                                                                                                                                    |
| 36/48 <br/>   | 4/8 <br/> | MaximumAllocationSize <br/>          | 配置大小上限（以位元組為單位）。 <br/>                                                                                                                                                                                                                                              |
| 40/56 <br/>   | 4/8 <br/> | VirtualMemoryThreshold <br/>         | 最大虛擬記憶體大小（以位元組為單位）。 <br/>                                                                                                                                                                                                                                          |
| 44/64 <br/>   | 4/8 <br/> | ProcessAffinityMask <br/>            | 將此欄位設定為非零值，相當於在進程啟動期間使用此值來呼叫 SetProcessAffinityMask ( .exe)  <br/>                                                                                                                                       |
| 48/72 <br/>   | 4 <br/>   | ProcessHeapFlags <br/>               | 進程堆積旗標，其對應至 HeapCreate 函數的第一個引數。 這些旗標適用于在進程啟動期間建立的進程堆積。 <br/>                                                                                                              |
| 52/76 <br/>   | 2 <br/>   | CSDVersion <br/>                     | Service pack 版本識別碼。 <br/>                                                                                                                                                                                                                                            |
| 54/78 <br/>   | 2 <br/>   | 保留 <br/>                       | 必須為零。 <br/>                                                                                                                                                                                                                                                                   |
| 56/80 <br/>   | 4/8 <br/> | EditList <br/>                       | 保留供系統使用。 <br/>                                                                                                                                                                                                                                                 |
| 60/88 <br/>   | 4/8 <br/> | SecurityCookie <br/>                 | Visual C++ 或 GS 執行所使用的 cookie 指標。 <br/>                                                                                                                                                                                                          |
| 64/96 <br/>   | 4/8 <br/> | SEHandlerTable <br/>                 | \[x86 只是 \] 影像中每個有效、唯一 SE 處理常式之 rva 的已排序資料表的 VA。 <br/>                                                                                                                                                                                  |
| 68/104 <br/>  | 4/8 <br/> | SEHandlerCount <br/>                 | \[x86：僅限 \] 資料表中唯一處理程式的計數。 <br/>                                                                                                                                                                                                                         |
| 72/112 <br/>  | 4/8 <br/> | GuardCFCheckFunctionPointer <br/>    | 儲存控制流程防護檢查函數指標的 VA。 <br/>                                                                                                                                                                                                               |
| 76/120 <br/>  | 4/8 <br/> | GuardCFDispatchFunctionPointer <br/> | 儲存控制流程防護分派函式指標的 VA。 <br/>                                                                                                                                                                                                            |
| 80/128 <br/>  | 4/8 <br/> | GuardCFFunctionTable <br/>           | 影像中每個控制流程防護函式之 Rva 的已排序表格的 VA。 <br/>                                                                                                                                                                                            |
| 84/136 <br/>  | 4/8 <br/> | GuardCFFunctionCount <br/>           | 上表中唯一 Rva 的計數。 <br/>                                                                                                                                                                                                                                    |
| 88/144 <br/>  | 4 <br/>   | GuardFlags <br/>                     | 控制流程防護的相關旗標。 <br/>                                                                                                                                                                                                                                               |
| 92/148 <br/>  | 12 <br/>  | CodeIntegrity <br/>                  | 程式碼完整性資訊。 <br/>                                                                                                                                                                                                                                                     |
| 104/160 <br/> | 4/8 <br/> | GuardAddressTakenIatEntryTable <br/> | 已儲存控制流程防護位址取得 IAT 表格的 VA。 <br/>                                                                                                                                                                                                              |
| 108/168 <br/> | 4/8 <br/> | GuardAddressTakenIatEntryCount <br/> | 上表中唯一 Rva 的計數。 <br/>                                                                                                                                                                                                                                    |
| 112/176 <br/> | 4/8 <br/> | GuardLongJumpTargetTable <br/>       | 儲存控制流程防護長跳躍目標資料表的 VA。 <br/>                                                                                                                                                                                                               |
| 116/184 <br/> | 4/8 <br/> | GuardLongJumpTargetCount <br/>       | 上表中唯一 Rva 的計數。 <br/>                                                                                                                                                                                                                                    |



 

GuardFlags 欄位包含下列一或多個旗標和子欄位的組合：

-   模組會使用系統提供的支援來執行控制流程完整性檢查。

    ` #define IMAGE_GUARD_CF_INSTRUMENTED  0x00000100`

-   模組會執行控制流程和寫入完整性檢查。

    ` #define IMAGE_GUARD_CFW_INSTRUMENTED  0x00000200`

-   模組包含有效的控制流程目標中繼資料。

    `#define IMAGE_GUARD_CF_FUNCTION_TABLE_PRESENT  0x00000400`

-   模組未利用/GS 安全性 cookie。

    ` #define IMAGE_GUARD_SECURITY_COOKIE_UNUSED  0x00000800`

-   模組支援唯讀延遲載入 IAT。

    `#define IMAGE_GUARD_PROTECT_DELAYLOAD_IAT  0x00001000`

-   Delayload 匯入資料表本身的 didat 區段 (沒有任何其他專案) 可以自由重新保護。

    ` #define IMAGE_GUARD_DELAYLOAD_IAT_IN_ITS_OWN_SECTION  0x00002000`

-   模組包含隱藏的匯出資訊。 這也會推斷已取得 IAT 資料表的位址也會出現在 load 設定中。

    `#define  IMAGE_GUARD_CF_EXPORT_SUPPRESSION_INFO_PRESENT  0x00004000`

-   模組允許隱藏匯出。

    `#define IMAGE_GUARD_CF_ENABLE_EXPORT_SUPPRESSION  0x00008000`

-   模組包含 longjmp 目標資訊。

    ` #define IMAGE_GUARD_CF_LONGJUMP_TABLE_PRESENT  0x00010000`

-   子欄位的遮罩，其中包含控制流程防護函式資料表專案的 stride (也就是每個資料表專案的額外位元組計數) 。

    ` #define IMAGE_GUARD_CF_FUNCTION_TABLE_SIZE_MASK  0xF0000000`

此外，Windows SDK winnt. h 標頭會定義這個宏，以將 GuardFlags 值以右至右對齊控制流程防護函式資料表 stride 的位數：

` #define IMAGE_GUARD_CF_FUNCTION_TABLE_SIZE_SHIFT  28`

### <a name="the-rsrc-section"></a>.Rsrc 區段

資源是由多層級二進位排序的樹狀結構來編制索引。 一般設計可以合併 2 \* \* 31 層級。 不過，根據慣例，Windows 會使用三個層級：

<dl> 類型  
名稱  
語言  
</dl>

一系列的資源目錄資料表會以下列方式建立所有層級的關聯：每個目錄資料表後面都有一系列的目錄專案，這些專案會提供該層級的名稱或識別碼 (識別碼)  (類型、名稱或語言層級) 以及資料描述或其他目錄資料表的位址。 如果位址指向資料描述，則資料是樹狀結構中的分葉。 如果位址指向另一個目錄資料表，則該資料表會列出下一個層級下的目錄專案。

分葉的類型、名稱和語言識別項都是由目錄資料表所取得的路徑來決定，以到達分葉。 第一個資料表會決定類型識別碼、第二個數據表 (由第一個資料表中的目錄專案所指向的) 判斷名稱識別碼，而第三個數據表則決定語言識別項。

.Rsrc 區段的一般結構如下：



| 資料                                                                   | 描述                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 資源目錄資料表 (和資原始目錄專案)  <br/> | 一系列資料表，樹狀結構中的每個節點群組各一。 所有最上層 (類型) 節點會列在第一個資料表中。 此資料表中的專案會指向第二層資料表。 每個第二層樹狀結構具有相同的類型識別碼，但名稱識別碼不同。 第三層樹狀結構具有相同的類型和名稱識別碼，但語言識別項不同。 <br/> 每個個別資料表都會緊接在目錄專案後面，其中每個專案都有名稱或數位識別碼，以及指向下一個較低層級的資料描述或資料表指標。 <br/> |
| 資原始目錄字串 <br/>                                 | 雙位元組對齊的 Unicode 字串，作為目錄專案所指向的字串資料。 <br/>                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 資源資料描述 <br/>                                  | 資料表所指向的記錄陣列，描述資源資料的實際大小和位置。 這些記錄是資源描述樹狀目錄中的保留。 <br/>                                                                                                                                                                                                                                                                                                                                                                |
| 資源資料 <br/>                                              | 資源區段的原始資料。 資源資料描述欄位中的大小和位置資訊會分隔資源資料的個別區域。 <br/>                                                                                                                                                                                                                                                                                                                                                                              |



 

#### <a name="resource-directory-table"></a>資源目錄資料表

每個資源目錄資料表都有下列格式。 此資料結構應該視為資料表的標題，因為資料表實際上是由目錄專案所組成， (一節6.9.2、「資原始目錄專案」 ) 和此結構中所述：



| Offset         | 大小          | 欄位                              | 描述                                                                                                                                                                     |
|----------------|---------------|------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 4 <br/> | 特性 <br/>        | 資源旗標。 這個欄位保留作未來使用。 目前設定為零。 <br/>                                                                                 |
| 4 <br/>  | 4 <br/> | 時間/日期戳記 <br/>        | 資源編譯器建立資源資料的時間。 <br/>                                                                                               |
| 8 <br/>  | 2 <br/> | 主要版本 <br/>          | 使用者所設定的主要版本號碼。 <br/>                                                                                                                          |
| 10 <br/> | 2 <br/> | 次要版本 <br/>          | 使用者所設定的次要版本號碼。 <br/>                                                                                                                          |
| 12 <br/> | 2 <br/> | 名稱專案的數目 <br/> | 依照資料表) 的層級而定，緊接在使用字串來識別類型、名稱或語言專案的資料表後面的目錄專案數目 (。 <br/> |
| 14 <br/> | 2 <br/> | 識別碼專案的數目 <br/>   | 緊接在類型、名稱或語言專案中使用數值識別碼的名稱專案之後的目錄專案數目。 <br/>                                    |



 

#### <a name="resource-directory-entries"></a>資原始目錄專案

目錄專案組成資料表的資料列。 每個資原始目錄專案都具有下列格式。 專案是否為名稱或識別碼專案是由資源目錄資料表所表示，它會指出在該資料表的所有識別碼專案之前的名稱和識別碼專案 (請記住，所有名稱專案都在資料表) 的所有識別碼專案之前。 資料表的所有專案都會以遞增順序排序：依區分大小寫的字串和識別碼專案的名稱專案。 位移會相對於映射 \_ 目錄 \_ 專案資源 DataDirectory 中的位址 \_ 。 如需詳細資訊，請參閱 [PE 內的對等互連： Win32 可移植可執行檔案格式的導覽](/previous-versions/ms809762(v=msdn.10)#pe-file-resources) 。



| Offset        | 大小          | 欄位                           | 描述                                                                                                          |
|---------------|---------------|---------------------------------|----------------------------------------------------------------------------------------------------------------------|
| 0 <br/> | 4 <br/> | 名稱位移 <br/>         | 提供類型、名稱或語言識別項專案之字串的位移，視資料表層級而定。 <br/>     |
| 0 <br/> | 4 <br/> | 整數識別碼 <br/>          | 識別類型、名稱或語言識別項專案的32位整數。 <br/>                                   |
| 4 <br/> | 4 <br/> | 資料輸入位移 <br/>   | 高位0。  (分葉) 的資源資料專案位址。 <br/>                                                   |
| 4 <br/> | 4 <br/> | 子目錄位移 <br/> | 高位1。 較低的31位是另一個資源目錄資料表的位址， (下一個層級下) 。 <br/> |



 

#### <a name="resource-directory-string"></a>資原始目錄字串

資原始目錄字串區域是由 Unicode 字串所組成，這些字串是以文字對齊。 這些字串會在最後一個資原始目錄專案之後，以及第一個資源資料項之前儲存在一起。 這會將這些可變長度字串的影響降至最低，以對齊固定大小的目錄專案。 每個資原始目錄字串的格式如下：



| Offset        | 大小                 | 欄位                      | 描述                                                            |
|---------------|----------------------|----------------------------|------------------------------------------------------------------------|
| 0 <br/> | 2 <br/>        | 長度 <br/>         | 字串的大小，不包含長度欄位本身。 <br/> |
| 2 <br/> | 變動 <br/> | Unicode 字串 <br/> | 可變長度的 Unicode 字串資料，以文字對齊。 <br/>     |



 

#### <a name="resource-data-entry"></a>資源資料輸入

每個資源資料專案會描述資源資料區域中的實際原始資料單位。 資源資料項的格式如下：



| Offset         | 大小          | 欄位                            | 描述                                                                                                                                           |
|----------------|---------------|----------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 4 <br/> | 資料 RVA <br/>             | 資源資料區域中資源資料單位的位址。 <br/>                                                                         |
| 4 <br/>  | 4 <br/> | 大小 <br/>                 | Data RVA 欄位所指向之資源資料的大小（以位元組為單位）。 <br/>                                                        |
| 8 <br/>  | 4 <br/> | codepage <br/>             | 用來解碼資源資料內的程式碼點值的字碼頁。 程式字碼頁面通常會是 Unicode 字碼頁。 <br/> |
| 12 <br/> | 4 <br/> | 保留，必須是0。 <br/> |                                                                                                                                                       |



 

### <a name="the-cormeta-section-object-only"></a>Cormeta 區段僅 (物件) 

CLR 中繼資料會儲存在此區段中。 它是用來指出此物件檔案包含 managed 程式碼。 中繼資料的格式未記載，但是可以傳遞給 CLR 介面以處理中繼資料。

### <a name="the-sxdata-section"></a>Sxdata 區段

物件的有效例外狀況處理常式會列在該物件的 **sxdata** 區段中。 區段會標示為 IMAGE \_ SCN 的 \_ .lnk \_ 資訊。 它包含每個有效處理常式的 COFF 符號索引（每個索引使用4個位元組）。

此外，編譯器會發出絕對符號 " @feat.00 "，並將值欄位的 LSB 設為1，以將 COFF 物件標示為已註冊的 SEH。 沒有已註冊 SEH 處理常式的 COFF 物件會有 " @feat.00 " 符號，但不能有 **. sxdata** 區段。

## <a name="archive-library-file-format"></a>封存 (程式庫) 檔案格式

- [封存檔案簽章](#archive-file-signature)
- [封存成員標頭](#archive-member-headers)
- [第一個連結器成員](#first-linker-member)
- [第二個連結器成員](#second-linker-member)
- [Longnames 成員](#longnames-member)

COFF 封存格式提供儲存物件檔案集合的標準機制。 這些集合通常稱為程式設計檔中的程式庫。

封存的前8個位元組包含檔案簽章。 封存的其餘部分是由一系列的封存成員所組成，如下所示：

-   第一個和第二個成員是 "連結器成員"。 每個成員都有自己的格式，如區段匯 [入名稱類型](#import-name-type)中所述。 通常，連結器會將資訊放入這些封存成員中。 連結器成員包含封存的目錄。

-   第三個成員是 "longnames" 成員。 這個選擇性成員是由一系列以 null 終止的 ASCII 字串所組成，其中每個字串都是另一個封存成員的名稱。

-   封存的其餘部分包含標準 (的物件檔案) 成員。 其中每個成員都包含一個物件檔案的完整內容。

封存成員標頭會在每個成員之前。 下列清單顯示封存的一般結構：

-   Signature： "！ &lt;a 架構 &gt; \\ n "
-   標頭

    <dl> 第1個連結器成員  
    </dl>

-   標頭

    <dl> 第2個連結器成員  
    </dl>

-   標頭

    <dl> Longnames 成員  
    </dl>

-   標頭

    <dl> OBJ 檔案1的內容  
     (COFF 格式)   
    </dl>

-   標頭

    <dl> OBJ 檔案2的內容  
     (COFF 格式)   
    </dl>

### <a name="archive-file-signature"></a>封存檔案簽章

保存檔案簽章會識別檔案類型。 任何公用程式 (例如，將封存檔視為輸入的連結器) 都可以藉由讀取此簽章來檢查檔案類型。 簽章包含下列 ASCII 字元，其中的每個字元都是以字面表示，但分行符號 (\\ n) 字元除外：

`!<arch>\n`

### <a name="archive-member-headers"></a>封存成員標頭

每個成員 (連結器、longnames 或物件檔案成員) 之前都是標頭。 封存成員標頭的格式如下，其中每個欄位都是一個 ASCII 文字字串，此字串會靠左對齊，並以空格填補至欄位結尾。 這些欄位中的任何一個都沒有終止的 null 字元。

每個成員標頭會在前一個封存成員結尾的第一個偶數位址開始。



| Offset         | 大小           | 欄位                     | 描述                                                                                                                                                                                                 |
|----------------|----------------|---------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 16 <br/> | Name <br/>          | 封存成員的名稱，加上斜線 (/) 附加以終止名稱。 如果第一個字元是斜線，則名稱具有特殊的解讀，如下表所述。 <br/> |
| 16 <br/> | 12 <br/> | Date <br/>          | 封存成員的建立日期和時間：這是自 1/1/1970 UCT 以來的秒數的 ASCII 小數表示。 <br/>                                                    |
| 28 <br/> | 6 <br/>  | 使用者識別碼 <br/>       | 使用者識別碼的 ASCII 十進位標記法。 此欄位在 Windows 平臺上不包含有意義的值，因為 Microsoft 工具會發出所有的空白。 <br/>                                    |
| 34 <br/> | 6 <br/>  | 群組識別碼 <br/>      | 群組識別碼的 ASCII 十進位標記法。 此欄位在 Windows 平臺上不包含有意義的值，因為 Microsoft 工具會發出所有的空白。 <br/>                                   |
| 40 <br/> | 8 <br/>  | 模式 <br/>          | 成員檔案模式的 ASCII 八進位標記法。 這是 \_ 來自 C 執行時間函數 wstat 的 ST 模式值 \_ 。 <br/>                                                                       |
| 48 <br/> | 10 <br/> | 大小 <br/>          | 封存成員總大小的 ASCII 十進位標記法，不包括標頭的大小。 <br/>                                                                                  |
| 58 <br/> | 2 <br/>  | 標頭結尾 <br/> | C 字串 "̃ n" 中的兩個位元組 \\ (0X60 0x0A) 。 <br/>                                                                                                                                               |



 

[名稱] 欄位具有下表所示的其中一種格式。 如先前所述，每個字串都會保持對齊，並在16位元組的欄位內以尾端空格填補：



| 名稱欄位的內容 | Description                                                                                                                                                                                                                                                                                          |
|------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 人名 <br/>      | 封存成員的名稱。 <br/>                                                                                                                                                                                                                                                          |
| / <br/>          | 封存成員是兩個連結器成員的其中一個。 這兩個連結器成員都有這個名稱。 <br/>                                                                                                                                                                                          |
| // <br/>         | 封存成員是 longnames 成員，由一系列以 null 終止的 ASCII 字串所組成。 Longnames 成員是第三個封存成員，而且是選擇性的。 <br/>                                                                     |
| /n <br/>         | 封存成員的名稱位於 longnames 成員內的位移 n。 數位 n 是位移的十進位標記法。 例如： "/26" 表示封存成員的名稱位於 longnames 成員內容開頭以外的26個位元組。 <br/> |



 

### <a name="first-linker-member"></a>第一個連結器成員

第一個連結器成員的名稱為 "/"。 包含第一個連結器成員以提供回溯相容性。 目前的連結器不會使用它，但其格式必須正確。 此連結器成員提供符號名稱的目錄，就像第二個連結器成員一樣。 針對每個符號，此資訊會指出要在何處尋找包含符號的封存成員。

第一個連結器成員具有下列格式。 此資訊會出現在標頭之後：



| Offset         | 大小               | 欄位                         | 描述                                                                                                                                                                                                                                                                                                                                                        |
|----------------|--------------------|-------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 4 <br/>      | 符號數目 <br/> | 不帶正負號的長度，包含已編制索引的符號數目。 這個數位會以位元組由大到小的格式儲存。 每個物件檔案成員通常會定義一或多個外部符號。 <br/>                                                                                                                                                                         |
| 4 <br/>  | 4 \* n <br/> | 位移 <br/>           | 封存成員標頭的檔案位移陣列，其中 n 等於符號欄位數目。 陣列中的每個數位都是不帶正負號的長度，以位元組由大到小的格式儲存。 針對字串資料表中所命名的每個符號，位移陣列中的對應專案會提供包含符號之封存成員的位置。 <br/> |
| \* <br/> | \* <br/>     | 字串資料表 <br/>      | 以 null 結束的一連串字串，其命名目錄中的所有符號。 每個字串會緊接在先前字串中的 null 字元之後開始。 字串數目必須等於 [符號] 欄位數目的值。 <br/>                                                                                                       |



 

位移陣列中的元素必須以遞增順序排列。 這表示字串資料表中的符號必須根據封存成員的順序來排列。 例如，第一個物件檔案成員中的所有符號都必須列在第二個物件檔的符號前面。

### <a name="second-linker-member"></a>第二個連結器成員

第二個連結器成員的名稱為 "/"，就像第一個連結器成員一樣。 雖然這兩個連結器成員都提供包含它們的符號和封存成員目錄，但第二個連結器成員會優先使用於所有目前連結器的第一個程式庫。 第二個連結器成員以詞法順序包含符號名稱，可讓您更快速地依名稱搜尋。

第二個成員具有下列格式。 此資訊會出現在標頭之後：



| Offset         | 大小               | 欄位                         | 描述                                                                                                                                                                                                                                                                                                                                                                                              |
|----------------|--------------------|-------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 4 <br/>      | 成員數目 <br/> | 不帶正負號的長度，包含封存成員的數目。 <br/>                                                                                                                                                                                                                                                                                                                                |
| 4 <br/>  | 4 \* m <br/> | 位移 <br/>           | 封存成員標頭的檔案位移陣列，以遞增順序排列。 每個位移都是不帶正負號的長整數。 數位 m 等於 [成員數目] 欄位的值。 <br/>                                                                                                                                                                                                        |
| \* <br/> | 4 <br/>      | 符號數目 <br/> | 不帶正負號的長度，包含已編制索引的符號數目。 每個物件檔案成員通常會定義一或多個外部符號。 <br/>                                                                                                                                                                                                                                                        |
| \* <br/> | 2 \* n <br/> | 指標 <br/>           | 以1為基礎之索引的陣列 (不帶正負號的短 ) ，可將符號名稱對應至封存成員位移。 數位 n 等於符號欄位數目。 對於字串資料表中所命名的每個符號，索引陣列中的對應元素都會提供位移陣列的索引。 位移陣列接著會提供包含符號之封存成員的位置。 <br/> |
| \* <br/> | \* <br/>     | 字串資料表 <br/>      | 一系列以 null 終止的字串，用來命名目錄中的所有符號。 每個字串都會緊接在上一個字串中的 null 位元組之後開始。 字串數目必須等於 [符號] 欄位數目的值。 下表以遞增的順序列出所有的符號名稱。 <br/>                                                                             |



 

### <a name="longnames-member"></a>Longnames 成員

Longnames 成員的名稱為 "//"。 Longnames 成員是一系列封存成員名稱的字串。 只有當 Name 欄位的空間不足時，才會出現名稱 (16 個位元組) 。 Longnames 成員是選擇性的。 只有標頭可以是空的，或者即使沒有標頭也可完全不存在。

字串以 null 結束。 每個字串都會緊接在上一個字串中的 null 位元組之後開始。

## <a name="import-library-format"></a>匯入程式庫格式

- [匯入標頭](#import-header)
- [匯入類型](#import-type)

傳統的匯入程式庫（也就是描述從某個影像匯出以供其他人使用的程式庫）通常會遵循第7節中所述的配置， [) 檔案格式](#archive-library-file-format)的封存 (程式庫。 主要差異在於，匯入程式庫成員包含虛擬物件檔案，而不是實際的檔案，其中每個成員都包含建立匯入資料表所需的投稿區段（如6.4 章節所 [述），](#the-idata-section) 連結器會在建立匯出應用程式時產生此封存。

匯入的區段投稿可以從一小部分的資訊來推斷。 連結器可以在建立程式庫時，為每個成員的匯入程式庫產生完整的詳細資訊，或只將標準資訊寫入程式庫，讓稍後使用它的應用程式產生必要的資料。

在具有完整格式的匯入程式庫中，單一成員會包含下列資訊：

<dl> 封存成員標頭  
檔案標頭  
區段標題  
對應至每個區段標頭的資料  
COFF 符號表  
字串  
  
</dl>

相反地，簡短的匯入程式庫撰寫如下：

<dl> 封存成員標頭  
匯入標頭  
以 Null 結束的匯入名稱字串  
以 Null 結束的 DLL 名稱字串  
</dl>

這是足夠的資訊，可在使用時精確地重建成員的整個內容。

### <a name="import-header"></a>匯入標頭

匯入標頭包含下欄欄位和位移：



| Offset         | 大小                | 欄位                       | 描述                                                                                                                  |
|----------------|---------------------|-----------------------------|------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 2 <br/>       | Sig1 <br/>            | 必須是圖像 \_ 檔 \_ 電腦 \_ 未知。 如需詳細資訊，請參閱 [電腦類型](#machine-types)。 <br/>                |
| 2 <br/>  | 2 <br/>       | Sig2 <br/>            | 必須是0xFFFF。 <br/>                                                                                                  |
| 4 <br/>  | 2 <br/>       | 版本 <br/>         | 結構版本。 <br/>                                                                                           |
| 6 <br/>  | 2 <br/>       | 電腦 <br/>         | 識別目的電腦類型的數位。 如需詳細資訊，請參閱 [電腦類型](#machine-types)。<br/> |
| 8 <br/>  | 4 <br/>       | Time-Date 戳記 <br/> | 建立檔案的時間和日期。 <br/>                                                                     |
| 12 <br/> | 4 <br/>       | 資料的大小 <br/>    | 標頭後面的字串大小。 <br/>                                                                  |
| 16 <br/> | 2 <br/>       | 序數/提示 <br/>    | 匯入的序數或提示，是由 [名稱類型] 欄位中的值所決定。 <br/>                   |
| 18 <br/> | 2位 <br/>  | 類型 <br/>            | 匯入類型。 如需特定的值和描述，請參閱匯 [入類型](#import-type)。<br/>                           |
|                | 3位 <br/>  | 名稱類型 <br/>       | 匯入名稱類型。 如需詳細資訊，請參閱匯 [入名稱類型](#import-name-type)。 <br/>                           |
|                | 11 位元 <br/> | 保留 <br/>        | 保留，必須是0。 <br/>                                                                                             |



 

此結構後面會接著兩個以 null 終止的字串，這些字串會描述匯入的符號名稱和它的來源 DLL。

### <a name="import-type"></a>匯入類型

下列值是針對匯入標頭中的 [類型] 欄位所定義：

| 常數                  | 值         | 描述                                      |
|---------------------------|---------------|--------------------------------------------------|
| 匯入程式 \_ 代碼 <br/>  | 0 <br/> | 可執行程式碼。 <br/>                     |
| 匯入 \_ 資料 <br/>  | 1 <br/> | 資料。 <br/>                                |
| 匯入 \_ CONST <br/> | 2 <br/> | 在 .def 檔中指定為 CONST。 <br/> |

這些值可用來判斷當工具必須存取資料時，哪個部分的投稿必須由使用程式庫的工具產生。

### <a name="import-name-type"></a>匯入名稱類型

以 null 結束的匯入符號名稱會緊接在其相關聯的匯入標頭之後。 下列值是針對匯入標頭中的名稱類型欄位所定義的。 它們表示如何使用名稱來產生代表匯入的正確符號：

| 常數 | 值 | 描述 |
| - | - | - |
| 匯入 \_ 序數 | 0 | 匯入是依序數。 這表示匯入標頭的序數/提示欄位中的值是匯入的序數。 如果未指定這個常數，則序數/提示欄位應該一律解釋為匯入的提示。 |
| 匯入 \_ 名稱 | 1 | 匯入名稱與公用符號名稱相同。 |
| 匯入 \_ 名稱 \_ NOPREFIX | 2 | 匯入名稱是公用符號名稱，但略過前置的？、@ 或選擇性的 \_ 。 |
| 匯入 \_ 名稱 \_ UNDECORATE | 3 | 匯入名稱是公用符號名稱，但略過開頭的？、@ 或（選擇性 \_ ），並在第一次截斷 @ 。 |

## <a name="appendix-a-calculating-authenticode-pe-image-hash"></a>附錄 A：計算 Authenticode PE 映射雜湊

- [什麼是 Authenticode PE 映射雜湊？](#what-is-an-authenticode-pe-image-hash)
- [Authenticode PE 映射雜湊涵蓋了哪些內容？](#what-is-covered-in-an-authenticode-pe-image-hash)

需要使用數個屬性憑證來驗證映射的完整性。 不過，最常見的是 Authenticode 簽章。 您可以使用 Authenticode 簽章來確認 PE 影像檔的相關區段是否已從檔案的原始表單中以任何方式改變。 為了完成這項工作，Authenticode 簽章包含稱為 PE 映射雜湊的內容

### <a name="what-is-an-authenticode-pe-image-hash"></a>什麼是 Authenticode PE 映射雜湊？

Authenticode PE 映射雜湊或簡短的檔案雜湊類似于檔案總和檢查碼，因為它會產生與檔案完整性相關的較小值。 總和檢查碼是由簡單的演算法所產生，主要是用來偵測記憶體失敗。 也就是說，它會用來偵測磁片上的記憶體區塊是否已損毀，且儲存的值已損毀。 檔案雜湊類似于總和檢查碼，因為它也會偵測到檔案損毀。 但是，與大部分的總和檢查碼演算法不同的是，修改檔案時，它的檔案雜湊與原始 (未修改的) 形式很困難。 也就是說，總和檢查碼旨在偵測造成損毀的簡單記憶體失敗，但檔案雜湊可用來偵測檔案的蓄意甚至微妙修改，例如病毒、駭客或特洛伊木馬程式所引進的檔案。

在 Authenticode 簽章中，檔案雜湊會使用只有檔案簽署者知道的私密金鑰，以數位方式簽署。 軟體取用者可以藉由計算檔案的雜湊值，並將其與 Authenticode 數位簽章中包含的已簽署雜湊值相比較，來驗證檔案的完整性。 如果檔案雜湊不相符，則已修改 PE 映射雜湊所涵蓋的部分檔案。

### <a name="what-is-covered-in-an-authenticode-pe-image-hash"></a>Authenticode PE 映射雜湊涵蓋了哪些內容？

在 PE 映射雜湊的計算中，不可能或不需要包含所有影像檔案資料。 有時候，它只會顯示不想要的特性 (例如，無法從公開發行的檔案中移除偵錯工具資訊) ;有時候就是不可能的。 例如，您無法在 Authenticode 簽章中包含影像檔案中的所有資訊，然後將包含該 PE 映射雜湊的 Authenticode 簽章插入 PE 映射中，並在稍後將所有影像檔案資料都包含在計算中，藉以產生相同的 PE 映射雜湊，因為檔案現在包含原本沒有的 Authenticode 簽章。

#### <a name="process-for-generating-the-authenticode-pe-image-hash"></a>產生 Authenticode PE 映射雜湊的進程

本節說明如何計算 PE 映射雜湊，以及可以修改 PE 映射的哪些部分，而不使 Authenticode 簽章失效。

> [!NOTE]
> 特定檔案的 PE 映射雜湊可包含在個別的類別目錄檔案中，而不需要在雜湊的檔案內包含屬性憑證。 這是相關的，因為它可以藉由修改未實際包含 Authenticode 簽章的 PE 映射，使 Authenticode 簽署類別目錄檔案中的 PE 映射雜湊失效。

在區段資料表中指定之 PE 映射區段中的所有資料，都會以整體方式雜湊，但不包括下列排除範圍：

- **選用標頭之 Windows 特定欄位的 [檔案總和檢查碼] 欄位。** 此總和檢查碼包含整個檔案 (包括) 檔案中的任何屬性憑證。 在所有可能性中，總和檢查碼在插入 Authenticode 簽章之後將會與原始值不同。

- **與屬性憑證相關的資訊**。 與 Authenticode 簽章相關的 PE 映射區域不包含在計算 PE 映射雜湊中，因為可以在映射中新增或移除 Authenticode 簽章，而不會影響映射的整體完整性。 這並不成問題，因為有一些使用者案例相依于重新簽署 PE 映射或新增時間戳記。 Authenticode 從雜湊計算中排除下列資訊：

  - 選用標頭資料目錄的憑證資料表欄位。

  - 憑證資料表和對應的憑證（由上述的憑證表格欄位所指向）。

  為了計算 PE 映射雜湊，Authenticode 會依位址範圍排列在區段資料表中指定的區段，然後雜湊產生的位元組序列，並傳遞排除範圍。

- **前一節結尾的資訊。** 最後一個區段之後的區域 (由最高位移) 所定義，則不會進行雜湊處理。 此區域通常包含調試資訊。 Debug 資訊通常可以視為偵錯工具的諮詢;它不會影響可執行程式的實際完整性。 在傳遞產品之後，您可以從影像中移除偵錯工具，而不會影響到程式的功能。 事實上，這有時是以磁片儲存量值來完成。 值得注意的是，在不 invaliding Authenticode 簽章的情況下，無法移除包含在 PE 映射指定區段內的偵錯工具資訊。

您可以使用 Windows Platform SDK 中提供的 makecert 和 signtool 工具，來試驗如何建立和驗證 Authenticode 簽章。 如需詳細資訊，請參閱下方的參考。

## <a name="references"></a>參考資料

[Windows (的下載和工具組含 Windows SDK) ](https://developer.microsoft.com/windows/downloads)

[建立、查看及管理憑證](/windows/desktop/SecCrypto/creating-viewing-and-managing-certificates)

[核心模式程式碼簽署逐步解說 ( .doc) ](https://download.microsoft.com/download/9/c/5/9c5b2167-8017-4bae-9fde-d599bac8184a/KMCS_Walkthrough.doc)

[SignTool](/windows/desktop/SecCrypto/signtool)

[Windows Authenticode 可移植可執行檔案格式 ( .docx) ](https://download.microsoft.com/download/9/c/5/9c5b2167-8017-4bae-9fde-d599bac8184a/Authenticode_PE.docx)

[Imagehlp.dll 函式](/windows/desktop/Debug/imagehlp-functions)