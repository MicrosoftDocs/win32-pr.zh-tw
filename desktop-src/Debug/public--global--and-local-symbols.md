---
description: DbgHelp API 的符號處理功能已演變多年。
ms.assetid: 6dc41682-6104-418b-b045-7afe8c2b11e9
title: Public、Global 和 Local 符號
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 623bf93ec8f11d1cec9c5fec64e2479dd91ee5cd
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104025880"
---
# <a name="public-global-and-local-symbols"></a><span data-ttu-id="5f75e-103">Public、Global 和 Local 符號</span><span class="sxs-lookup"><span data-stu-id="5f75e-103">Public, Global, and Local Symbols</span></span>

<span data-ttu-id="5f75e-104">DbgHelp API 的符號處理功能已演變多年。</span><span class="sxs-lookup"><span data-stu-id="5f75e-104">The symbol handling capabilities of the DbgHelp API have evolved over the years.</span></span> <span data-ttu-id="5f75e-105">為了確保您的程式碼可在各種案例中運作，並提供符號的完整詳細資料，請盡可能使用最新的函式。</span><span class="sxs-lookup"><span data-stu-id="5f75e-105">To ensure that your code works in a variety of scenarios and provides full details on the symbols, use the newest functions whenever possible.</span></span> <span data-ttu-id="5f75e-106">例如， [**SymEnumSymbols**](/windows/desktop/api/Dbghelp/nf-dbghelp-symenumsymbols) 會取代 [**SymEnumerateSymbols64**](/windows/desktop/api/Dbghelp/nf-dbghelp-symenumeratesymbols)、 [**SymFromName**](/windows/desktop/api/Dbghelp/nf-dbghelp-symfromname) 取代 [**SymGetSymFromName64**](/windows/desktop/api/Dbghelp/nf-dbghelp-symgetsymfromname)， [**SymFromAddr**](/windows/desktop/api/Dbghelp/nf-dbghelp-symfromaddr) 會取代 [**SymGetSymFromAddr64**](/windows/desktop/api/Dbghelp/nf-dbghelp-symgetsymfromaddr)。</span><span class="sxs-lookup"><span data-stu-id="5f75e-106">For example, [**SymEnumSymbols**](/windows/desktop/api/Dbghelp/nf-dbghelp-symenumsymbols) replaces [**SymEnumerateSymbols64**](/windows/desktop/api/Dbghelp/nf-dbghelp-symenumeratesymbols), [**SymFromName**](/windows/desktop/api/Dbghelp/nf-dbghelp-symfromname) replaces [**SymGetSymFromName64**](/windows/desktop/api/Dbghelp/nf-dbghelp-symgetsymfromname), and [**SymFromAddr**](/windows/desktop/api/Dbghelp/nf-dbghelp-symfromaddr) replaces [**SymGetSymFromAddr64**](/windows/desktop/api/Dbghelp/nf-dbghelp-symgetsymfromaddr).</span></span>

## <a name="public-symbols"></a><span data-ttu-id="5f75e-107">公用符號</span><span class="sxs-lookup"><span data-stu-id="5f75e-107">Public Symbols</span></span>

<span data-ttu-id="5f75e-108">DbgHelp.dll 的初始版本僅支援檢查公用符號。</span><span class="sxs-lookup"><span data-stu-id="5f75e-108">Initial versions of DbgHelp.dll supported examining only public symbols.</span></span> <span data-ttu-id="5f75e-109">您必須在不同的原始程式檔之間公開的程式碼中的任何專案，都會產生這些符號。</span><span class="sxs-lookup"><span data-stu-id="5f75e-109">These symbols are generated for any item in the code that must be exposed between different source files.</span></span> <span data-ttu-id="5f75e-110">它們也包含從模組中匯出的所有專案。</span><span class="sxs-lookup"><span data-stu-id="5f75e-110">They also include all items that are exported out of the module.</span></span>

<span data-ttu-id="5f75e-111">這些符號可能內嵌于影像中，或個別儲存在 dbg 或 .pdb 檔案中。</span><span class="sxs-lookup"><span data-stu-id="5f75e-111">The symbols are either embedded in the image, or stored separately in a .dbg or .pdb file.</span></span> <span data-ttu-id="5f75e-112">唯一儲存的資訊是符號名稱和位址。</span><span class="sxs-lookup"><span data-stu-id="5f75e-112">The only information stored is the symbol name and address.</span></span> <span data-ttu-id="5f75e-113">這些名稱會以裝飾名稱的形式提供。</span><span class="sxs-lookup"><span data-stu-id="5f75e-113">The names are available as decorated names.</span></span> <span data-ttu-id="5f75e-114">若要查看未修飾的名稱，請使用 SYMOPT Undname.exe 呼叫 [**SymSetOptions**](/windows/desktop/api/Dbghelp/nf-dbghelp-symsetoptions) 函式 \_ ，或使用 [**UnDecorateSymbolName**](/windows/desktop/api/Dbghelp/nf-dbghelp-undecoratesymbolname) 函數。</span><span class="sxs-lookup"><span data-stu-id="5f75e-114">To view undecorated names, call the [**SymSetOptions**](/windows/desktop/api/Dbghelp/nf-dbghelp-symsetoptions) function with SYMOPT\_UNDNAME, or use the [**UnDecorateSymbolName**](/windows/desktop/api/Dbghelp/nf-dbghelp-undecoratesymbolname) function.</span></span>

<span data-ttu-id="5f75e-115">請注意，DbgHelp API 一開始不是設計來支援模組內相同符號的多個實例。</span><span class="sxs-lookup"><span data-stu-id="5f75e-115">Note that the DbgHelp API was not initially designed to support multiple instances of the same symbol within a module.</span></span> <span data-ttu-id="5f75e-116">這是因為公用符號會限制為模組內的唯一名稱。</span><span class="sxs-lookup"><span data-stu-id="5f75e-116">This is because public symbols are restricted to unique names within a module.</span></span> <span data-ttu-id="5f75e-117">因此， [**SymGetSymFromName64**](/windows/desktop/api/Dbghelp/nf-dbghelp-symgetsymfromname) 只會傳回符合的第一個符號。</span><span class="sxs-lookup"><span data-stu-id="5f75e-117">Therefore, [**SymGetSymFromName64**](/windows/desktop/api/Dbghelp/nf-dbghelp-symgetsymfromname) returns only the first symbol that matches.</span></span> <span data-ttu-id="5f75e-118">若要取出所有符合的符號，請呼叫 [**SymEnumSymbols**](/windows/desktop/api/Dbghelp/nf-dbghelp-symenumsymbols)。</span><span class="sxs-lookup"><span data-stu-id="5f75e-118">To retrieve all symbols that match, call [**SymEnumSymbols**](/windows/desktop/api/Dbghelp/nf-dbghelp-symenumsymbols).</span></span>

## <a name="global-and-local-symbols"></a><span data-ttu-id="5f75e-119">全域和區域符號</span><span class="sxs-lookup"><span data-stu-id="5f75e-119">Global and Local Symbols</span></span>

<span data-ttu-id="5f75e-120">較新版本的 DbgHelp.dll 在使用 .pdb 檔案時，支援 global 和 local 符號。</span><span class="sxs-lookup"><span data-stu-id="5f75e-120">Newer versions of DbgHelp.dll support global and local symbols when using .pdb files.</span></span> <span data-ttu-id="5f75e-121">這些新版本包括靜態函式、範圍在原始檔中的函式、函式參數，以及本機變數。</span><span class="sxs-lookup"><span data-stu-id="5f75e-121">These new versions include static functions, functions scoped within a source file, function parameters, and local variables.</span></span> <span data-ttu-id="5f75e-122">當 DbgHelp 搜尋符號時，會先檢查全域和區域符號表，再檢查公用符號表。</span><span class="sxs-lookup"><span data-stu-id="5f75e-122">When DbgHelp searches for a symbol, it checks the global and local symbol tables before checking the public symbol table.</span></span> <span data-ttu-id="5f75e-123">這是因為這些類型的符號有更多可用的資訊，而不是公用符號的可用資訊。</span><span class="sxs-lookup"><span data-stu-id="5f75e-123">This is because there is more information available for these types of symbols than is available for public symbols.</span></span>

<span data-ttu-id="5f75e-124">全域和區域符號會以未修飾的名稱儲存。</span><span class="sxs-lookup"><span data-stu-id="5f75e-124">Global and local symbols are stored with undecorated names.</span></span> <span data-ttu-id="5f75e-125">因此，SYMOPT \_ undname.exe 旗標沒有任何作用。</span><span class="sxs-lookup"><span data-stu-id="5f75e-125">Therefore, the SYMOPT\_UNDNAME flag has no effect.</span></span> <span data-ttu-id="5f75e-126">若要取得裝飾符號名稱，您必須使用 \_ \_ 僅限 SYMOPT PUBLICS 旗標。</span><span class="sxs-lookup"><span data-stu-id="5f75e-126">To get decorated symbol names, you must use the SYMOPT\_PUBLICS\_ONLY flag.</span></span> <span data-ttu-id="5f75e-127">這會導致 DbgHelp 只搜尋公用符號。</span><span class="sxs-lookup"><span data-stu-id="5f75e-127">This causes DbgHelp to search only the public symbols.</span></span>

<span data-ttu-id="5f75e-128">若要查看本機符號或函式參數，請呼叫 [**SymSetCoNtext**](/windows/desktop/api/Dbghelp/nf-dbghelp-symsetcontext)函數，並將 [**imagehlp.dll \_ 堆疊 \_ 框架**](/windows/desktop/api/DbgHelp/ns-dbghelp-imagehlp_stack_frame)結構的 **InstructionOffset** 成員設為任何函式符號的位址。</span><span class="sxs-lookup"><span data-stu-id="5f75e-128">To view local symbols or function parameters, call the [**SymSetContext**](/windows/desktop/api/Dbghelp/nf-dbghelp-symsetcontext) function with the **InstructionOffset** member of the [**IMAGEHLP\_STACK\_FRAME**](/windows/desktop/api/DbgHelp/ns-dbghelp-imagehlp_stack_frame) structure set to the address of any function symbol.</span></span> <span data-ttu-id="5f75e-129">後續對 [**SymFromName**](/windows/desktop/api/Dbghelp/nf-dbghelp-symfromname) 和 [**SymEnumSymbols**](/windows/desktop/api/Dbghelp/nf-dbghelp-symenumsymbols) 的呼叫，都可以在此位址的內容中運作。</span><span class="sxs-lookup"><span data-stu-id="5f75e-129">Subsequent calls to [**SymFromName**](/windows/desktop/api/Dbghelp/nf-dbghelp-symfromname) and [**SymEnumSymbols**](/windows/desktop/api/Dbghelp/nf-dbghelp-symenumsymbols) can operate within the context of this address.</span></span> <span data-ttu-id="5f75e-130">若要這樣做，請將 *BaseOfDll* 參數設定為 **Null** ，並省略 *Name* 或 *Mask* 參數中的模組規範。</span><span class="sxs-lookup"><span data-stu-id="5f75e-130">To do so, set the *BaseOfDll* parameter to **NULL** and omit the module specifier from the *Name* or *Mask* parameter.</span></span> <span data-ttu-id="5f75e-131">這會強制 DbgHelp 在 **SymSetCoNtext** 所指示的範圍內搜尋相符的符號。</span><span class="sxs-lookup"><span data-stu-id="5f75e-131">This forces DbgHelp to search for matching symbols within the scope indicated by **SymSetContext**.</span></span>

<span data-ttu-id="5f75e-132">若要判斷符號是否為參數，請檢查 [**符號 \_ 資訊**](/windows/desktop/api/DbgHelp/ns-dbghelp-symbol_info)結構的 **旗標** 成員。</span><span class="sxs-lookup"><span data-stu-id="5f75e-132">To determine if a symbol is a parameter, check the **Flags** member of the [**SYMBOL\_INFO**](/windows/desktop/api/DbgHelp/ns-dbghelp-symbol_info) structure.</span></span> <span data-ttu-id="5f75e-133">如果符號是參數，則成員包含 SYMFLAG \_ 參數。</span><span class="sxs-lookup"><span data-stu-id="5f75e-133">If the symbol is a parameter, the member contains SYMFLAG\_PARAMETER.</span></span> <span data-ttu-id="5f75e-134">如果是本機符號，則成員會包含 SYMFLAG \_ local。</span><span class="sxs-lookup"><span data-stu-id="5f75e-134">If it is a local symbol, the member contains SYMFLAG\_LOCAL.</span></span>

 

 



