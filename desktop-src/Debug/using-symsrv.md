---
description: 使用 SymSrv
ms.assetid: d400f222-c50c-4c7b-8f8a-0c3ed3bba3b9
title: 使用 SymSrv
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ae79d9fd045ab3ce946c14468e56419d3074858c
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104187725"
---
# <a name="using-symsrv"></a><span data-ttu-id="546d0-103">使用 SymSrv</span><span class="sxs-lookup"><span data-stu-id="546d0-103">Using SymSrv</span></span>

<span data-ttu-id="546d0-104">SymSrv 會從集中式符號存放區傳遞符號檔。</span><span class="sxs-lookup"><span data-stu-id="546d0-104">SymSrv delivers symbol files from centralized symbol stores.</span></span> <span data-ttu-id="546d0-105">這些存放區可包含任意數目的符號檔案，對應至任意數目的程式或作業系統。</span><span class="sxs-lookup"><span data-stu-id="546d0-105">These stores can contain any number of symbol files, corresponding to any number of programs or operating systems.</span></span> <span data-ttu-id="546d0-106">存放區也可以包含二進位檔案，這在對小型傾印檔案進行調試時特別有用。</span><span class="sxs-lookup"><span data-stu-id="546d0-106">The stores can also contain binary files, which are particularly useful when debugging minidump files.</span></span>

<span data-ttu-id="546d0-107">存放區可以包含實際的符號和二進位檔案，或只包含符號檔的指標。</span><span class="sxs-lookup"><span data-stu-id="546d0-107">The stores can contain the actual symbol and binary files or simply pointers to symbol files.</span></span> <span data-ttu-id="546d0-108">如果存放區包含指標，SymSrv 會直接從其來源取得實際的檔案。</span><span class="sxs-lookup"><span data-stu-id="546d0-108">If the store contains pointers, SymSrv will retrieve the actual files directly from their sources.</span></span>

<span data-ttu-id="546d0-109">SymSrv 也可以將大型符號存放區分成較小的子集，以供特殊的偵錯工具使用。</span><span class="sxs-lookup"><span data-stu-id="546d0-109">SymSrv can also separate a large symbol store into a smaller subset that is appropriate for a specialized debugging task.</span></span>

<span data-ttu-id="546d0-110">最後，SymSrv 可以使用作業系統所提供的登入資訊，從 HTTP 或 HTTPS 來源取得符號檔。</span><span class="sxs-lookup"><span data-stu-id="546d0-110">Finally, SymSrv can obtain symbol files from an HTTP or HTTPS source using the logon information provided by the operating system.</span></span> <span data-ttu-id="546d0-111">SymSrv 支援以智慧卡、憑證和一般登入和密碼保護的 HTTPS 網站。</span><span class="sxs-lookup"><span data-stu-id="546d0-111">SymSrv supports HTTPS sites protected by smartcards, certificates, and regular logins and passwords.</span></span>

## <a name="setting-the-symbol-path"></a><span data-ttu-id="546d0-112">設定符號路徑</span><span class="sxs-lookup"><span data-stu-id="546d0-112">Setting the Symbol Path</span></span>

<span data-ttu-id="546d0-113">如 [符號](symbol-paths.md)路徑中所述，符號路徑 (\_ NT \_ 符號 \_ 路徑環境變數) 可由數個以分號分隔的路徑元素組成。</span><span class="sxs-lookup"><span data-stu-id="546d0-113">As described in [Symbol Paths](symbol-paths.md), the symbol path (\_NT\_SYMBOL\_PATH environment variable) can be made up of several path elements separated by semicolons.</span></span> <span data-ttu-id="546d0-114">如果其中一或多個路徑元素的開頭是 "srv" 文字 \* ，則元素是符號伺服器，並會使用 SymSrv 來尋找符號檔。</span><span class="sxs-lookup"><span data-stu-id="546d0-114">If any one or more of these path elements begins with the text "srv\*", then the element is a symbol server and will use SymSrv to locate symbol files.</span></span>

> [!Note]  
> <span data-ttu-id="546d0-115">如果 \* 未指定 "srv" 文字，但實際的 path 元素是符號伺服器存放區，則符號處理常式將會如同指定了 "srv \* " 一樣。</span><span class="sxs-lookup"><span data-stu-id="546d0-115">If the "srv\*" text is not specified but the actual path element is a symbol server store, then the symbol handler will act as if "srv\*" were specified.</span></span> <span data-ttu-id="546d0-116">符號處理常式會搜尋指定路徑的根目錄中名為 "pingme.txt" 的檔案是否存在，以進行這項判斷。</span><span class="sxs-lookup"><span data-stu-id="546d0-116">The symbol handler makes this determination by searching for the existence of a file called "pingme.txt" in the root directory of the specified path.</span></span>

 

<span data-ttu-id="546d0-117">如同符號路徑是由以分號分隔的符號路徑元素組成，符號伺服器是由以星號分隔的符號存放區元素所組成。</span><span class="sxs-lookup"><span data-stu-id="546d0-117">Just as symbol paths are made up of symbol path elements separated by semicolons, symbol servers are made up of symbol store elements separated by asterisks.</span></span> <span data-ttu-id="546d0-118">"Srv" 前置詞之後最多可以有10個符號存放區 \* 。</span><span class="sxs-lookup"><span data-stu-id="546d0-118">There can be up to 10 symbol stores after the "srv\*" prefix.</span></span> <span data-ttu-id="546d0-119">列在清單左邊的商店稱為 *下游* 存放區，右邊的商店稱為 *上游* 存放區。</span><span class="sxs-lookup"><span data-stu-id="546d0-119">Stores listed to the left of the list are called *downstream* stores and stores to the right are called *upstream* stores.</span></span>

<dl> <span data-ttu-id="546d0-120">srv \* *SymbolStore*</span><span class="sxs-lookup"><span data-stu-id="546d0-120">srv\**SymbolStore*</span></span>  
<span data-ttu-id="546d0-121">srv \* *SymbolStore1* \* *SymbolStoreN*  
</span><span class="sxs-lookup"><span data-stu-id="546d0-121">srv\**SymbolStore1*\**SymbolStoreN*  
</span></span></dl>

<span data-ttu-id="546d0-122">如果路徑中只包含一個符號存放區元素，則 SymSrv 將會嘗試直接從該存放區使用任何要求的檔案。</span><span class="sxs-lookup"><span data-stu-id="546d0-122">If only one symbol store element is included in the path, then SymSrv will attempt to use the any requested file directly from that store.</span></span>

<span data-ttu-id="546d0-123">如果路徑中有兩個符號存放區，SymSrv 會在最左邊的符號存放區中尋找符號檔。</span><span class="sxs-lookup"><span data-stu-id="546d0-123">If there are two symbol stores in the path, SymSrv looks for the symbol file in the leftmost symbol store.</span></span> <span data-ttu-id="546d0-124">如果檔案存在，就會使用它。</span><span class="sxs-lookup"><span data-stu-id="546d0-124">If the file is there, it is used.</span></span> <span data-ttu-id="546d0-125">如果不存在，SymSrv 就會在右邊的符號存放區中尋找。</span><span class="sxs-lookup"><span data-stu-id="546d0-125">If it is not there, SymSrv looks in the symbol store immediately to the right.</span></span> <span data-ttu-id="546d0-126">如果檔案存在，則會將它複製到左側存放區，並從該處開啟。</span><span class="sxs-lookup"><span data-stu-id="546d0-126">If the file is there, it is copied to the left store and opened from there.</span></span>

<span data-ttu-id="546d0-127">如果有兩個以上的商店，此行為會繼續向右，直到找到檔案或清單中沒有其他存放區為止。</span><span class="sxs-lookup"><span data-stu-id="546d0-127">If there are more than two stores, this behavior continues to the right until the file is found or there are no more stores in the list.</span></span>

<span data-ttu-id="546d0-128">永遠不會從任何存放區開啟檔案，而是從最左邊的存放區開啟。</span><span class="sxs-lookup"><span data-stu-id="546d0-128">The file is never opened from any store but the leftmost store.</span></span> <span data-ttu-id="546d0-129">如果在鏈中的其他位置找到該檔案，它就會複製到它左邊的每個存放區。</span><span class="sxs-lookup"><span data-stu-id="546d0-129">If the file is found anywhere else in the chain, it is copied to every store to the left of it.</span></span> <span data-ttu-id="546d0-130">這項複製程式稱為「串聯」，並提供將在本檔稍後 clarfied 的一些優點。</span><span class="sxs-lookup"><span data-stu-id="546d0-130">This copy process is called "cascading" and provides certain benefits that will clarfied later in this document.</span></span>

## <a name="types-of-symbol-stores"></a><span data-ttu-id="546d0-131">符號存放區的類型</span><span class="sxs-lookup"><span data-stu-id="546d0-131">Types of Symbol Stores</span></span>

<span data-ttu-id="546d0-132">下表顯示支援的符號存放區類型範例。</span><span class="sxs-lookup"><span data-stu-id="546d0-132">The following table displays examples of the supported symbol store types..</span></span>

|                            |                                                                                                                                                                                                                                                                                                                                                           |
|----------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="546d0-133">\\\\伺服器 \\ 共用</span><span class="sxs-lookup"><span data-stu-id="546d0-133">\\\\server\\share</span></span>          | <span data-ttu-id="546d0-134">遠端伺服器上共用的完整 UNC 路徑。</span><span class="sxs-lookup"><span data-stu-id="546d0-134">A fully qualified UNC path to a share on a remote server.</span></span>                                                                                                                                                                                                                                                                                                 |
| <span data-ttu-id="546d0-135">c： \\ LocalCache</span><span class="sxs-lookup"><span data-stu-id="546d0-135">c:\\LocalCache</span></span>             | <span data-ttu-id="546d0-136">用戶端電腦上目錄的路徑。</span><span class="sxs-lookup"><span data-stu-id="546d0-136">A path to a directory on the client computer.</span></span>                                                                                                                                                                                                                                                                                                             |
| https://InternetSite        | <span data-ttu-id="546d0-137">裝載符號之網站的 URL。</span><span class="sxs-lookup"><span data-stu-id="546d0-137">The URL to a web site hosting the symbols.</span></span> <span data-ttu-id="546d0-138">必須是清單中最右邊的存放區，而且不可以是清單中的唯一存放區。</span><span class="sxs-lookup"><span data-stu-id="546d0-138">Must be the rightmost store in the list and should not be the only store in the list.</span></span>                                                                                                                                                                                                                          |
| https://SecureInternetSite | <span data-ttu-id="546d0-139">裝載符號之安全網站的 URL。</span><span class="sxs-lookup"><span data-stu-id="546d0-139">The URL to a secure web site hosting the symbols.</span></span> <span data-ttu-id="546d0-140">這可支援密碼、Windows 登入認證、憑證和智慧卡。</span><span class="sxs-lookup"><span data-stu-id="546d0-140">This can support passwords, Windows login credentials, certificates, and smartcards.</span></span> <span data-ttu-id="546d0-141">必須是清單中最右邊的存放區，而且不可以是清單中的唯一存放區。</span><span class="sxs-lookup"><span data-stu-id="546d0-141">Must be the rightmost store in the list and should not be the only store in the list.</span></span>                                                                                                                              |
| <blank>              | <span data-ttu-id="546d0-142">如果兩個星號之間沒有文字，這表示預設的 *下游存放區*。</span><span class="sxs-lookup"><span data-stu-id="546d0-142">If there is no text between two asterisks, this indicates the *default downstream store*.</span></span> <span data-ttu-id="546d0-143">您可以藉由呼叫 [**SymSetHomeDirectory**](/windows/desktop/api/Dbghelp/nf-dbghelp-symsethomedirectory)來設定位置。</span><span class="sxs-lookup"><span data-stu-id="546d0-143">The location is set by calling [**SymSetHomeDirectory**](/windows/desktop/api/Dbghelp/nf-dbghelp-symsethomedirectory).</span></span> <span data-ttu-id="546d0-144">預設值是名為 "sym" 的目錄，緊接在呼叫應用程式的程式目錄正下方。</span><span class="sxs-lookup"><span data-stu-id="546d0-144">The default value is a directory named "sym" immediately below the program directory of the calling application.</span></span> <span data-ttu-id="546d0-145">這有時稱為 *預設本機* 快取。</span><span class="sxs-lookup"><span data-stu-id="546d0-145">This is sometimes referred to as the *default local cache*.</span></span> |



 

<span data-ttu-id="546d0-146">因為無法寫入 HTTP 型的符號存放區，所以它必須是清單中最右邊的存放區。</span><span class="sxs-lookup"><span data-stu-id="546d0-146">Because an HTTP-based symbol store cannot be written to, it must be the rightmost store in the list.</span></span> <span data-ttu-id="546d0-147">如果以 HTTP 為基礎的符號存放區位於商店清單的中間或左邊，則無法將任何找到的檔案複製到其中，且鏈會中斷。</span><span class="sxs-lookup"><span data-stu-id="546d0-147">If an HTTP-based symbol store was located in the middle or the left of the store list, it would not be possible to copy any found files to it and the chain would be broken.</span></span> <span data-ttu-id="546d0-148">此外，由於符號處理常式無法從網站開啟檔案，因此以 HTTP 為基礎的存放區不能是最左邊的或只有清單中的存放區。</span><span class="sxs-lookup"><span data-stu-id="546d0-148">Furthermore, because the symbol handler cannot open a file from a web site, an HTTP-based store should not be the leftmost or only store on the list.</span></span> <span data-ttu-id="546d0-149">如果使用此符號路徑來呈現 SymSrv，它將會嘗試將檔案複製到預設下游存放區，並從該處開啟它，而不考慮預設下游存放區是否在符號路徑中指出。</span><span class="sxs-lookup"><span data-stu-id="546d0-149">If SymSrv is ever presented with this symbol path, it will attempt to recover by copying the file to the default downstream store and open it from there, regardless of whether the default downstream store is indicated in the symbol path or not.</span></span>

## <a name="examples"></a><span data-ttu-id="546d0-150">範例</span><span class="sxs-lookup"><span data-stu-id="546d0-150">Examples</span></span>

<span data-ttu-id="546d0-151">若要在 mybuilds mysymbols 上使用 SymSrv 搭配符號存放區 \\ \\ \\ ，請設定下列符號路徑：</span><span class="sxs-lookup"><span data-stu-id="546d0-151">To use SymSrv with a symbol store on \\\\mybuilds\\mysymbols, set the following symbol path:</span></span>

<span data-ttu-id="546d0-152">**設定 \_ NT \_ 符號 \_ 路徑 = srv \* \\ \\ mybuilds \\ mysymbols**</span><span class="sxs-lookup"><span data-stu-id="546d0-152">**set \_NT\_SYMBOL\_PATH= srv\*\\\\mybuilds\\mysymbols**</span></span>

<span data-ttu-id="546d0-153">若要設定符號路徑，讓偵錯工具將符號檔從 mybuilds mysymbols 上的符號存放區複製 \\ \\ \\ 到本機目錄 c： \\ localsymbols，請使用：</span><span class="sxs-lookup"><span data-stu-id="546d0-153">To set the symbol path so that the debugger will copy symbol files from a symbol store on \\\\mybuilds\\mysymbols to your local directory c:\\localsymbols, use:</span></span>

<span data-ttu-id="546d0-154">**設定 \_ NT \_ 符號 \_ 路徑 = srv \* c： \\ localsymbols \* \\ \\ mybuilds \\ mysymbols**</span><span class="sxs-lookup"><span data-stu-id="546d0-154">**set \_NT\_SYMBOL\_PATH=srv\*c:\\localsymbols\*\\\\mybuilds\\mysymbols**</span></span>

<span data-ttu-id="546d0-155">若要設定符號路徑，讓偵錯工具將符號檔從 mybuilds mysymbols 上的符號存放區複製 \\ \\ \\ 到預設下游存放區 (通常是 c： \\ 偵錯工具 \\ sym) ，請使用：</span><span class="sxs-lookup"><span data-stu-id="546d0-155">To set the symbol path so that the debugger will copy symbol files from a symbol store on \\\\mybuilds\\mysymbols to the default downstream store (typically c:\\debuggers\\sym), use:</span></span>

<span data-ttu-id="546d0-156">**設定 \_ NT \_ 符號 \_ 路徑 = srv \* \* \\ \\ mybuilds \\ mysymbols**</span><span class="sxs-lookup"><span data-stu-id="546d0-156">**set \_NT\_SYMBOL\_PATH=srv\*\*\\\\mybuilds\\mysymbols**</span></span>

<span data-ttu-id="546d0-157">若要使用串聯存放區，請設定下列符號路徑：</span><span class="sxs-lookup"><span data-stu-id="546d0-157">To use a cascading store, set the following symbol path:</span></span>

<span data-ttu-id="546d0-158">**設定 \_ NT \_ 符號 \_ 路徑 = srv \* c： \\ localsymbols \* \\ \\ NearbyServer \\ store\*https://DistantServer**</span><span class="sxs-lookup"><span data-stu-id="546d0-158">**set \_NT\_SYMBOL\_PATH = srv\*c:\\localsymbols\*\\\\NearbyServer\\store\*https://DistantServer**</span></span>

<span data-ttu-id="546d0-159">在此範例中，SymSrv 會先在 c： localsymbols 中尋找檔案 \\ 。</span><span class="sxs-lookup"><span data-stu-id="546d0-159">In this example, SymSrv first looks for the file in c:\\localsymbols.</span></span> <span data-ttu-id="546d0-160">如果找到，它會傳回檔案的路徑。</span><span class="sxs-lookup"><span data-stu-id="546d0-160">If it is found there, it will return a path to the file.</span></span> <span data-ttu-id="546d0-161">否則，SymSrv 會在 \\ \\ NearbyServer 存放區中尋找檔案 \\ 。</span><span class="sxs-lookup"><span data-stu-id="546d0-161">Otherwise, SymSrv looks for the file in \\\\NearbyServer\\store.</span></span> <span data-ttu-id="546d0-162">如果找到該檔案，SymSrv 會將檔案複製到 c： \\ localsymbols，並傳回該檔案的路徑; 如果找不到檔案，SymSrv 會在中尋找檔案， https://DistantServer 如果找到的話，SymSrv 會將檔案複製到 \\ \\ NearbyServer \\ 存放區，然後再複製到 c： \\ localsymbols。</span><span class="sxs-lookup"><span data-stu-id="546d0-162">If it is found there, SymSrv copies the file to c:\\localsymbols and returns a path to the file; if it is not found, SymSrv looks for the file in https://DistantServer, and if it is found there, SymSrv copies the file to \\\\NearbyServer\\store, then to c:\\localsymbols.</span></span>

<span data-ttu-id="546d0-163">最後一個範例顯示如何使用符號路徑的合理設計，將符號的下載優化。</span><span class="sxs-lookup"><span data-stu-id="546d0-163">This last example shows how judicious design of a symbol path can be used to optimize the downloading of symbols.</span></span> <span data-ttu-id="546d0-164">如果您有一個具有偵錯工具群組的工作網站，而且它們都需要從遙遠的位置取得符號，您可以在所有偵錯工具附近設定具有符號存放區的泛型服務器。</span><span class="sxs-lookup"><span data-stu-id="546d0-164">If you have a work site with a group of debuggers and they all need to get symbols from a distant location, you can set up a common server with a symbol store near all the debuggers.</span></span> <span data-ttu-id="546d0-165">然後使用上述的符號路徑來設定每個偵錯工具。</span><span class="sxs-lookup"><span data-stu-id="546d0-165">Then setup every debugger with the symbol path above.</span></span> <span data-ttu-id="546d0-166">第一個需要特定版本 foo .pdb 的偵錯工具會將它從下載 https://DistantServer 到 \\ \\ NearbyServer \\ 存放區，然後從它自己的電腦載入 c： \\ localsymbols。</span><span class="sxs-lookup"><span data-stu-id="546d0-166">The first debugger that requires a certain version of foo.pdb will download it from https://DistantServer to \\\\NearbyServer\\store and then to its own machine in c:\\localsymbols.</span></span> <span data-ttu-id="546d0-167">需要相同檔案的下一個偵錯工具將能夠從 \\ \\ NearbyServer 存放區下載， \\ 因為先前的偵錯工具已經將它下載到該位置。</span><span class="sxs-lookup"><span data-stu-id="546d0-167">The next debugger that requires the same file will be able to download it from \\\\NearbyServer\\store because it was already downloaded to that location by the previous debugger.</span></span> <span data-ttu-id="546d0-168">此多層快取可節省大量時間和網路頻寬。</span><span class="sxs-lookup"><span data-stu-id="546d0-168">This multi-level caching saves significant time and network bandwidth.</span></span>

## <a name="microsoft-symbol-store"></a><span data-ttu-id="546d0-169">Microsoft 符號存放區</span><span class="sxs-lookup"><span data-stu-id="546d0-169">Microsoft Symbol Store</span></span>

<span data-ttu-id="546d0-170">Microsoft 提供網際網路符號伺服器的存取權，該伺服器包含許多 Windows 作業系統版本的符號檔。</span><span class="sxs-lookup"><span data-stu-id="546d0-170">Microsoft provides access to an Internet symbol server that contains symbol files for the many versions of the Windows operating system.</span></span> <span data-ttu-id="546d0-171">此符號目錄不保證已完成，但很廣泛。</span><span class="sxs-lookup"><span data-stu-id="546d0-171">This catalog of symbols is not guaranteed to be complete, but it is extensive.</span></span> <span data-ttu-id="546d0-172">其他 Microsoft 產品也會呈現。</span><span class="sxs-lookup"><span data-stu-id="546d0-172">Other Microsoft products are also represented.</span></span>

<span data-ttu-id="546d0-173">網際網路符號伺服器會使用 Microsoft Windows 作業系統的各種 Windows 符號填入，包括熱修正、Service Pack、安全性匯總套件和零售版。</span><span class="sxs-lookup"><span data-stu-id="546d0-173">The Internet symbol server is populated with a variety of Windows symbols for Microsoft Windows operating systems, including hot fixes, Service Packs, Security Rollup Packages, and retail releases.</span></span> <span data-ttu-id="546d0-174">您也可以在伺服器上取得適用于 Windows 產品目前搶鮮版和候選版的符號，以及各種其他 Microsoft 產品，例如 Microsoft Internet Explorer。</span><span class="sxs-lookup"><span data-stu-id="546d0-174">Symbols are also available on the server for current Betas and Release Candidates for Windows products, plus a variety of other Microsoft products, such as Microsoft Internet Explorer.</span></span>

<span data-ttu-id="546d0-175">如果您在進行偵錯工具時可以存取網際網路，您可以設定偵錯工具在偵錯工具期間視需要下載符號，而不是在偵錯工具會話之前個別下載符號檔。</span><span class="sxs-lookup"><span data-stu-id="546d0-175">If you have access to the Internet during debugging, you can configure the debugger to download symbols as needed during a debugging session, rather than downloading symbol files separately before a debugging session.</span></span> <span data-ttu-id="546d0-176">符號會下載至您指定的目錄位置，然後偵錯工具會從該處載入這些符號。</span><span class="sxs-lookup"><span data-stu-id="546d0-176">The symbols are downloaded to a directory location that you specify and then the debugger loads them from there.</span></span>

<span data-ttu-id="546d0-177">Microsoft 符號存放區的 URL 為 https://msdl.microsoft.com/download/symbols 。</span><span class="sxs-lookup"><span data-stu-id="546d0-177">The URL for the Microsoft symbol store is https://msdl.microsoft.com/download/symbols.</span></span> <span data-ttu-id="546d0-178">下列範例會示範如何設定偵錯工具符號路徑， (以您的下游存放區路徑取代 *c： \\ DownstreamStore*) ：</span><span class="sxs-lookup"><span data-stu-id="546d0-178">The following example shows how to set the debugger symbol path (substitute your downstream store path for *c:\\DownstreamStore*):</span></span>

``` syntax
srv*c:\DownstreamStore*https://msdl.microsoft.com/download/symbols
```

## <a name="compressed-files"></a><span data-ttu-id="546d0-179">壓縮檔案</span><span class="sxs-lookup"><span data-stu-id="546d0-179">Compressed Files</span></span>

<span data-ttu-id="546d0-180">SymSrv 與包含壓縮檔案的符號存放區相容，只要使用 Windows Server 2003 資源套件所散發的 compress.exe 工具來執行此壓縮即可。</span><span class="sxs-lookup"><span data-stu-id="546d0-180">SymSrv is compatible with symbol stores that contain compressed files, as long as this compression has been preformed with the compress.exe tool that was distributed with the Windows Server 2003 Resource Kit.</span></span> <span data-ttu-id="546d0-181">壓縮檔案副檔名中的最後一個字元應該有底線 (例如， \_ module2 \_) 。</span><span class="sxs-lookup"><span data-stu-id="546d0-181">Compressed files should have an underscore as the last character in their file extensions (for example, module1.pd\_ or module2.db\_).</span></span> <span data-ttu-id="546d0-182">如需詳細資訊，請參閱 [使用 SymStore](using-symstore.md)。</span><span class="sxs-lookup"><span data-stu-id="546d0-182">For details, see [Using SymStore](using-symstore.md).</span></span>

<span data-ttu-id="546d0-183">當串聯時，除非目標存放區是路徑中最左邊的存放區，否則不會將檔案解壓縮。</span><span class="sxs-lookup"><span data-stu-id="546d0-183">When cascading, files are not uncompressed unless the target store is the leftmost store in the path.</span></span> <span data-ttu-id="546d0-184">如果路徑中只有一個存放區，且其中包含一個壓縮的檔案，則 SymSrv 會將該檔案複製到預設的下游存放區，並從該處開啟它，即使它們的符號路徑中並未指出預設的下游存放區也一樣。</span><span class="sxs-lookup"><span data-stu-id="546d0-184">If there is only one store in the path and it contains a compressed file, SymSrv will copy the file to the default downstream store and open it from there, even though the default downstream store is not indicated in they symbol path.</span></span>

<span data-ttu-id="546d0-185">**DbgHelp 6.1 及更早版本。：** 如果主要存放區中的檔案已壓縮，您必須使用下游存放區。</span><span class="sxs-lookup"><span data-stu-id="546d0-185">**DbgHelp 6.1 and earlier.:** If the files in the master store are compressed, you must use a downstream store.</span></span> <span data-ttu-id="546d0-186">SymSrv 會先解壓縮所有檔案，再將它們複製到下游存放區。</span><span class="sxs-lookup"><span data-stu-id="546d0-186">SymSrv will uncompress all files before copying them to the downstream store.</span></span>

## <a name="deleting-the-cache"></a><span data-ttu-id="546d0-187">刪除快取</span><span class="sxs-lookup"><span data-stu-id="546d0-187">Deleting the Cache</span></span>

<span data-ttu-id="546d0-188">如果您使用下游存放區做為快取，您隨時都可以刪除這個目錄來儲存磁碟空間。</span><span class="sxs-lookup"><span data-stu-id="546d0-188">If you are using a downstream store as a cache, you can delete this directory at any time to save disk space.</span></span>

<span data-ttu-id="546d0-189">您可以有大量的符號存放區，其中包含許多不同程式或 Windows 版本的符號檔。</span><span class="sxs-lookup"><span data-stu-id="546d0-189">It is possible to have a vast symbol store that includes symbol files for many different programs or Windows versions.</span></span> <span data-ttu-id="546d0-190">如果您升級目的電腦上所使用的 Windows 版本，則快取的符號檔全都會符合先前的版本。</span><span class="sxs-lookup"><span data-stu-id="546d0-190">If you upgrade the version of Windows used on your target computer, the cached symbol files will all match the earlier version.</span></span> <span data-ttu-id="546d0-191">這些快取的檔案不會進一步使用，因此這可能是刪除快取的好時機。</span><span class="sxs-lookup"><span data-stu-id="546d0-191">These cached files will not be of any further use, and therefore this might be a good time to delete the cache.</span></span>

<span data-ttu-id="546d0-192">適用于 Windows 的偵錯工具隨附一個稱為 agestore.exe 的公用程式，它會選擇性地從目錄樹狀結構中移除檔案，保留最近使用的檔案。</span><span class="sxs-lookup"><span data-stu-id="546d0-192">Debugging Tools for Windows comes with a utility called agestore.exe that will selectively remove files from a directory tree, leaving the most recently used files.</span></span> <span data-ttu-id="546d0-193">此工具的設計目的是要從符號伺服器存放區中剪除未使用的檔案。</span><span class="sxs-lookup"><span data-stu-id="546d0-193">This tool is designed for pruning out unused files from symbol server stores.</span></span> <span data-ttu-id="546d0-194">它可讓您控制許多選項，包括「剪下日期」和「目錄大小」演算法。</span><span class="sxs-lookup"><span data-stu-id="546d0-194">It allows you to control many options including cut off date and directory size algorithms.</span></span>

## <a name="flat-cache-directory"></a><span data-ttu-id="546d0-195">一般快取目錄</span><span class="sxs-lookup"><span data-stu-id="546d0-195">Flat Cache Directory</span></span>

<span data-ttu-id="546d0-196">您可以將預設下游存放區宣告為一般目錄，而不是標準符號樹狀結構。</span><span class="sxs-lookup"><span data-stu-id="546d0-196">It is possible to declare the default downstream store as a flat directory, rather than a standard symbol tree structure.</span></span> <span data-ttu-id="546d0-197">若要這樣做，請使用 SYMOPT 的 **一般 \_ \_ 目錄** 來呼叫 [**SymSetOptions**](/windows/desktop/api/Dbghelp/nf-dbghelp-symsetoptions)函式 (這也會在 SymSrv) 中設定 **SSRVOPT 一般 \_ \_ 預設 \_ 存放區** 選項。</span><span class="sxs-lookup"><span data-stu-id="546d0-197">To do so, call the [**SymSetOptions**](/windows/desktop/api/Dbghelp/nf-dbghelp-symsetoptions) function with **SYMOPT\_FLAT\_DIRECTORY** (this also sets the **SSRVOPT\_FLAT\_DEFAULT\_STORE** option in SymSrv).</span></span> <span data-ttu-id="546d0-198">在這麼做之前，請務必先呼叫 [**SymSetHomeDirectory**](/windows/desktop/api/Dbghelp/nf-dbghelp-symsethomedirectory) ;否則，您可以將符號檔寫入至程式目錄。</span><span class="sxs-lookup"><span data-stu-id="546d0-198">Be sure to call [**SymSetHomeDirectory**](/windows/desktop/api/Dbghelp/nf-dbghelp-symsethomedirectory) before doing so; otherwise, the symbol files can be written to the program directory.</span></span>

## <a name="pointer-files"></a><span data-ttu-id="546d0-199">指標檔</span><span class="sxs-lookup"><span data-stu-id="546d0-199">Pointer Files</span></span>

<span data-ttu-id="546d0-200">SymStore 可以建立及使用指向目標檔案的檔案，而不是目標檔案本身。</span><span class="sxs-lookup"><span data-stu-id="546d0-200">SymStore can create and use files that point to a target file rather than the target file itself.</span></span> <span data-ttu-id="546d0-201">如果符號存放區包含這類指標檔案，則預設會將檔案從指標檔案中指出的位置複製到存放區。</span><span class="sxs-lookup"><span data-stu-id="546d0-201">If a symbol store contains such a pointer file, the default is to copy the file from the location indicated in the pointer file to the store.</span></span> <span data-ttu-id="546d0-202">若要設定存放區，以複製指標檔案，而不是它所指向的檔案，請在目標存放區的根目錄中建立名為 wantsptr.txt 的檔案。</span><span class="sxs-lookup"><span data-stu-id="546d0-202">To configure a store such that the pointer file is copied instead of the file it points to, create a file named wantsptr.txt in the root of the target store.</span></span> <span data-ttu-id="546d0-203">wantsptr.txt 的內容並不重要，只有檔案存在。</span><span class="sxs-lookup"><span data-stu-id="546d0-203">The contents of wantsptr.txt are not important, only the presence of the file.</span></span>

## <a name="excluding-files-from-symbols-list"></a><span data-ttu-id="546d0-204">從符號清單中排除檔案</span><span class="sxs-lookup"><span data-stu-id="546d0-204">Excluding Files from Symbols List</span></span>

<span data-ttu-id="546d0-205">若要從符號搜尋中排除檔案，您可以在 symsrv.ini 或登錄中指定其名稱。</span><span class="sxs-lookup"><span data-stu-id="546d0-205">To exclude files from a symbols search, you can specify their names in symsrv.ini or in the registry.</span></span> <span data-ttu-id="546d0-206">若要在 symsrv.ini 中指定檔案，請建立名為排除的區段，並列出檔案。</span><span class="sxs-lookup"><span data-stu-id="546d0-206">To specify the files in symsrv.ini, create a section named Exclusions and list the files.</span></span> <span data-ttu-id="546d0-207">檔案名可以包含萬用字元，如下列範例所示：</span><span class="sxs-lookup"><span data-stu-id="546d0-207">The file names can contain wildcards, as shown in the following example:</span></span>

``` syntax
[Exclusions]
dbghelp.pdb
symsrv.*
mso*
```

<span data-ttu-id="546d0-208">Symsrv.ini 應該位於 symsrv.dll 所在的相同目錄中。</span><span class="sxs-lookup"><span data-stu-id="546d0-208">Symsrv.ini should be located in the same directory that symsrv.dll resides.</span></span> <span data-ttu-id="546d0-209">在大部分的安裝中，檔案不存在，您將需要建立一個新的檔案。</span><span class="sxs-lookup"><span data-stu-id="546d0-209">In most installations, the file does not exist and you will need to create a new one.</span></span>

<span data-ttu-id="546d0-210">或者，您可以儲存要在登錄中排除的檔案。</span><span class="sxs-lookup"><span data-stu-id="546d0-210">Alternatively, you can store the files to be excluded in the registry.</span></span> <span data-ttu-id="546d0-211">建立下列登錄機碼： **HKEY \_ 本機 \_ 電腦 \\ 軟體 \\ Microsoft \\ 符號伺服器 \\ 排除** 專案。</span><span class="sxs-lookup"><span data-stu-id="546d0-211">Create the following registry key: **HKEY\_LOCAL\_MACHINE\\Software\\Microsoft\\Symbol Server\\Exclusions**.</span></span> <span data-ttu-id="546d0-212">將每個檔案名儲存為字串值， (REG \_ SZ) 在此機碼中。</span><span class="sxs-lookup"><span data-stu-id="546d0-212">Store each file name as a string value (REG\_SZ) within this key.</span></span> <span data-ttu-id="546d0-213">字串值的名稱指定要排除的檔案名。</span><span class="sxs-lookup"><span data-stu-id="546d0-213">The name of the string value specifies the name of the file to be excluded.</span></span> <span data-ttu-id="546d0-214">您可以使用字串值的內容來儲存批註，以說明檔案的排除原因。</span><span class="sxs-lookup"><span data-stu-id="546d0-214">You can use the contents of the string value to store a comment describing why the file is being excluded.</span></span>

## <a name="installation"></a><span data-ttu-id="546d0-215">安裝</span><span class="sxs-lookup"><span data-stu-id="546d0-215">Installation</span></span>

<span data-ttu-id="546d0-216">SymSrv (symsrv.dll) 符號伺服器包含在適用于 Windows 的偵錯工具套件中。</span><span class="sxs-lookup"><span data-stu-id="546d0-216">The SymSrv (symsrv.dll) symbol server is included in the Debugging Tools for Windows package.</span></span> <span data-ttu-id="546d0-217">它必須安裝在您要載入的 dbghelp.dll 複本所在的相同目錄中。</span><span class="sxs-lookup"><span data-stu-id="546d0-217">It must be installed in the same directory as the copy of dbghelp.dll that you are loading.</span></span> <span data-ttu-id="546d0-218">如需詳細資訊，請參閱 [呼叫 DbgHelp 程式庫](calling-the-dbghelp-library.md)。</span><span class="sxs-lookup"><span data-stu-id="546d0-218">For more details, see [Calling the DbgHelp Library](calling-the-dbghelp-library.md).</span></span>

 

 



