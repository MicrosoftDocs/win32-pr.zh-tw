---
title: 安全性考慮 Windows 消費者介面
description: 本主題提供有關 Windows 消費者介面中安全性考慮的資訊。
ms.assetid: D560E59A-D6C8-40a9-AABB-DE5A47C94E6E
keywords:
- Windows 消費者介面，安全性
- Windows 消費者介面的安全性
- 字串安全性
- 使用者輸入，驗證
- 驗證使用者輸入
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 71b714de3ab12cb10d6e5d9a2e251c34eeeff7a5
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/20/2020
ms.locfileid: "104023900"
---
# <a name="security-considerations-windows-user-interface"></a>安全性考慮： Windows 消費者介面

本主題提供有關 Windows 消費者介面中安全性考慮的資訊。 本主題不提供您需要瞭解的安全性問題。 相反地，請使用它作為此技術領域的起點和參考。

隨著電腦互連能力的增加，開發人員現在必須關注應用程式安全性。 不過，安全性也增強了一般的應用程式安全性和穩定性;因此，開發人員可以使用另一種方式來提供絕佳的使用者體驗。 下列主題將討論使用 Windows 消費者介面時的一些潛在安全性考慮。

-   [字串考慮](#string-considerations)
-   [使用者輸入](#user-input)
-   [安全性警示](#security-alerts)
-   [相關主題](#related-topics)

## <a name="string-considerations"></a>字串考慮

許多函式、訊息和宏會在其參數中使用字串。 不過，通常不會檢查字串是否為 null 終止或長度。 相關的考慮是 miscalculating 字串或緩衝區的長度。 在任一種情況下，這可能會導致緩衝區溢位或資料截斷，這可能會對您的應用程式造成負面影響。 如需有關緩衝區溢位和其他安全性考慮的詳細資訊，請參閱由 Michael Howard 和 David Leblanc *撰寫安全* 的程式碼，Microsoft 請按2002。

若要以安全的方式處理字串，您應該執行下列作業：

-   視需要檢查 null 終止或適當長度的字串。
-   請特別小心判斷字串或緩衝區的長度，尤其是在包含 **TCHAR** 值的時候。
-   如果您建立字串或使用先前使用的字串，請視需要將它初始化為零或插入 null 結束字元。

此外，在處理字串時，請考慮使用 [>strsafe.h](/windows/desktop/menurc/strsafe-ovw) 函數。 這些函數是設計來安全地處理字串。

## <a name="user-input"></a>使用者輸入

Windows 使用者介面是關於取得和回應使用者的資訊。 不過，輸入不正確資料的使用者可能會中斷您的應用程式，不論他們是否想要這樣做。 因此，基本規則是必須驗證所有輸入。

主要考慮是字串資料，會在 [字串考慮](#string-considerations)中加以討論。 不過，所有類型的輸入都應該先經過驗證，您的應用程式才能使用。 另一個問題是當資料在某個時間點進行驗證，但在使用之前發生變更時，例如，收到提供文字長度的訊息時。 因此，如果資料可能會變更，您應該在使用資料之前檢查資料

## <a name="security-alerts"></a>安全性警示

下表列出如果使用不當，可能會危及應用程式安全性的功能。



| 功能                                                                                                                                                   | 降低                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [**GetAtomName**](/windows/desktop/api/winbase/nf-winbase-getatomnamea)                                                                                                               | 指定緩衝區的大小時，請務必小心。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| [**GlobalGetAtomName**](/windows/desktop/api/winbase/nf-winbase-globalgetatomnamea)                                                                                                   | 全域字串原子可供任何應用程式存取。 但是，如果另一個應用程式是粗心，它可以 mishandle 參考計數並加以刪除。 您應考慮改為使用全域整數原子。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| [**ImpersonateDdeClientWindow**](/windows/desktop/api/dde/nf-dde-impersonateddeclientwindow)                                                                                 | 如果函式失敗，則會在呼叫進程的安全性內容中進行後續的用戶端要求。 如果呼叫的進程是以高許可權的帳戶執行，這可能會造成問題。 因此，如果呼叫失敗或引發錯誤，則不會繼續執行用戶端要求。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| [**DdeImpersonateClient**](/windows/desktop/api/ddeml/nf-ddeml-ddeimpersonateclient)                                                                                             | 如果函式失敗，則會在呼叫進程的安全性內容中進行後續的用戶端要求。 如果呼叫的進程是以高許可權的帳戶執行，這可能會造成問題。 因此，如果呼叫失敗或引發錯誤，則不會繼續執行用戶端要求。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| [**GetClipboardFormatName**](/windows/desktop/api/winuser/nf-winuser-getclipboardformatnamea)                                                                                         | Miscalculating 適當的 *lpszFormatName* 緩衝區大小，特別是當應用程式同時用於 ANSI 和 Unicode 版本時，可能會造成緩衝區溢位。 此外，請注意，如果字串長度超過 *cchMaxCount* 參數（可能會導致資訊遺失），則會截斷字串。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| [**GetMenuString**](/windows/desktop/api/winuser/nf-winuser-getmenustringa)                                                                                                           | *LpString* 參數是 **TCHAR** 緩衝區，而 *nMaxCount* 是 **TCHAR** s 中功能表字串的長度。 將這些參數的大小不正確，可能是以字元為單位的功能表字串長度。 不正確地調整這些參數的大小可能會導致字串截斷，導致資料可能遺失。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| [**GetStringTypeA**](/windows/desktop/api/winnls/nf-winnls-getstringtypea)、 [**GetStringTypeEx**](/windows/win32/api/stringapiset/nf-stringapiset-getstringtypeexw)、 [**GetStringTypeW**](/windows/desktop/api/stringapiset/nf-stringapiset-getstringtypew) | 若要避免緩衝區溢位，請正確地設定 *lpCharType* 緩衝區的大小。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| [**LoadLibrary**](/windows/desktop/api/libloaderapi/nf-libloaderapi-loadlibrarya)                                                                                                                       | 不當使用 **LoadLibrary** 可能會載入錯誤的 DLL，進而危及應用程式的安全性。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| [**Loadstring 時**](/windows/desktop/api/winuser/nf-winuser-loadstringa)                                                                                                                 | 不正確的用法包括在 *nBufferMax* 參數中指定錯誤的大小。 例如，sizeof (*lpBuffer*) 會提供緩衝區的大小（以位元組為單位），這可能會導致函式的 Unicode 版本發生緩衝區溢位。 緩衝區溢位的情況是應用程式中許多安全性問題的原因。 在此情況下，使用會 `sizeof(lpBuffer)/sizeof(TCHAR)` 提供適當的緩衝區大小。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| [**lstrcat**](/windows/desktop/api/winbase/nf-winbase-lstrcata)                                                                                                                       | 此函數會使用結構化例外狀況處理 (SEH) 攔截存取違規和其他錯誤。 當此函式捕捉至 SEH 錯誤時，它會傳回 **null** ，而不會以 null 結束字串，而不會傳回 null，而不會對字串進行 null 終止，也不會通知呼叫端錯誤。 呼叫端無法安全地假設空間不足是錯誤狀況。 第一個引數 *lpString1* 必須夠大，才能容納 *lpString2* 和結尾 ' \\ 0 '，否則可能會發生緩衝區溢位。 如果發生存取違規，緩衝區溢位可能會對應用程式造成阻絕服務攻擊。 在最糟的情況下，緩衝區溢位可能會讓攻擊者將可執行檔程式碼插入您的進程，特別是當 *lpString1* 是堆疊型緩衝區時。 請考慮使用下列其中一個替代方案。 [**StringCbCat**](/windows/desktop/api/strsafe/nf-strsafe-stringcbcata) 或 [**StringCchCat**](/windows/desktop/api/strsafe/nf-strsafe-stringcchcata)。                                                                                                                                                                                       |
| [**lstrcpy**](/windows/desktop/api/winbase/nf-winbase-lstrcpya)                                                                                                                       | 此函數會使用結構化例外狀況處理 (SEH) 攔截存取違規和其他錯誤。 當此函式捕捉至 SEH 錯誤時，它會傳回 **null** ，而不會以 null 結束字串，而不會傳回 null，而不會對字串進行 null 終止，也不會通知呼叫端錯誤。 呼叫端無法安全地假設空間不足是錯誤狀況。 第一個引數 *lpString1* 必須夠大，才能容納 *lpString2* 和結尾 ' \\ 0 '，否則可能會發生緩衝區溢位。 如果發生存取違規，緩衝區溢位可能會對應用程式造成阻絕服務攻擊。 在最糟的情況下，緩衝區溢位可能會讓攻擊者將可執行檔程式碼插入您的進程，特別是當 *lpString1* 是堆疊型緩衝區時。 請考慮改為使用 [**StringCchCopy**](/windows/desktop/api/strsafe/nf-strsafe-stringcchcopya) 。                                                                                                                                                                                                                                                               |
| [**lstrcpyn**](/windows/desktop/api/winbase/nf-winbase-lstrcpyna)                                                                                                                     | 此函數會使用結構化例外狀況處理 (SEH) 攔截存取違規和其他錯誤。 當此函式捕捉至 SEH 錯誤時，它會傳回 **null** ，而不會以 null 結束字串，而不會傳回 null，而不會對字串進行 null 終止，也不會通知呼叫端錯誤。 呼叫端無法安全地假設空間不足是錯誤狀況。 如果 *lpString1* 不夠大，無法包含複製的字串，則可能會發生緩衝區溢位。 此外，在複製整個字串時，請注意 [sizeof](https://msdn.microsoft.com/library/0w557fh7(VS.71).aspx) 會傳回位元組數目，而不是 **WCHAR**，而 **sizeof** 會傳回位元組數而非字元，這對此函式的 Unicode 版本而言不正確。 如果發生存取違規，緩衝區溢位可能會對應用程式造成阻絕服務攻擊。 在最糟的情況下，緩衝區溢位可能會讓攻擊者將可執行檔程式碼插入您的進程，特別是當 *lpString1* 是堆疊型緩衝區時。 請考慮改為使用 [**StringCchCopy**](/windows/desktop/api/strsafe/nf-strsafe-stringcchcopya) 。 |
| [**lstrlen**](/windows/desktop/api/winbase/nf-winbase-lstrlena)                                                                                                                       | [**lstrlen**](/windows/desktop/api/winbase/nf-winbase-lstrlena) 假設 *lpString* 是以 null 終止的字串。 如果不是，這可能會導致緩衝區溢位或對您的應用程式造成阻絕服務攻擊。 請考慮使用下列其中一個替代方案。 [**StringCbLength**](/windows/desktop/api/strsafe/nf-strsafe-stringcblengtha) 或 [**StringCchLength**](/windows/desktop/api/strsafe/nf-strsafe-stringcchlengtha)。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| [**wsprintf**](/windows/desktop/api/winuser/nf-winuser-wsprintfa)                                                                                                                     | *LpOut* 中傳回的字串不保證會以 null 終止。 此外，請避免使用% s 格式，這可能會導致緩衝區溢位。 如果發生存取違規，就會導致您的應用程式拒絕服務。 在更糟的情況下，攻擊者可以插入可執行程式碼。 請考慮使用下列其中一個替代方案。 [**StringCbPrintf**](/windows/desktop/api/strsafe/nf-strsafe-stringcbprintfa)、 [**StringCbPrintfEx**](/windows/desktop/api/strsafe/nf-strsafe-stringcbprintfexa)、 [**StringCbVPrintf**](/windows/desktop/api/strsafe/nf-strsafe-stringcbvprintfa)、 [**StringCbVPrintfEx**](/windows/desktop/api/strsafe/nf-strsafe-stringcbvprintfexa)、 [**StringCchPrintf**](/windows/desktop/api/strsafe/nf-strsafe-stringcchprintfa)、 [**StringCchPrintfEx**](/windows/desktop/api/strsafe/nf-strsafe-stringcchprintfexa)、 [**StringCchVPrintf**](/windows/desktop/api/strsafe/nf-strsafe-stringcchvprintfa)或 [**StringCchVPrintfEx**](/windows/desktop/api/strsafe/nf-strsafe-stringcchvprintfexa)。                                                                                                                                                                                                                                                                                                                                         |
| [**wvsprintf**](/windows/desktop/api/winuser/nf-winuser-wvsprintfa)                                                                                                                   | *LpOutput* 中傳回的字串不保證會以 null 終止。 此外，請避免使用% s 格式，這可能會導致緩衝區溢位。 如果造成存取違規，或攻擊者可能插入可執行程式碼，這可能會導致阻絕服務。 請考慮使用下列其中一個替代方案。 [**StringCbPrintf**](/windows/desktop/api/strsafe/nf-strsafe-stringcbprintfa)、 [**StringCbPrintfEx**](/windows/desktop/api/strsafe/nf-strsafe-stringcbprintfexa)、 [**StringCbVPrintf**](/windows/desktop/api/strsafe/nf-strsafe-stringcbvprintfa)、 [**StringCbVPrintfEx**](/windows/desktop/api/strsafe/nf-strsafe-stringcbvprintfexa)、 [**StringCchPrintf**](/windows/desktop/api/strsafe/nf-strsafe-stringcchprintfa)、 [**StringCchPrintfEx**](/windows/desktop/api/strsafe/nf-strsafe-stringcchprintfexa)、 [**StringCchVPrintf**](/windows/desktop/api/strsafe/nf-strsafe-stringcchvprintfa)或 [**StringCchVPrintfEx**](/windows/desktop/api/strsafe/nf-strsafe-stringcchvprintfexa)。                                                                                                                                                                                                                                                                                                                                                      |



 

## <a name="related-topics"></a>相關主題

<dl> <dt>

[Microsoft 安全性](https://www.microsoft.com/security/)
</dt> <dt>

[安全性和身分識別](/windows/desktop/security)
</dt> <dt>

[安全性 how to Index](/previous-versions/msp-n-p/ff650055(v=pandp.10))
</dt> <dt>

[TechNet 安全性資源](https://www.microsoft.com/technet/security/default.mspx)
</dt> <dt>

[安全性 Api 的最佳作法](/windows/desktop/SecBP/best-practices-for-the-security-apis)
</dt> </dl>

 

 