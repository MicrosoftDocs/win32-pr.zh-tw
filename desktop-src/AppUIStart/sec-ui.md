---
title: 安全性考慮 Windows 消費者介面
description: 本主題提供有關 Windows 消費者介面中安全性考慮的資訊。
ms.assetid: D560E59A-D6C8-40a9-AABB-DE5A47C94E6E
keywords:
- Windows 消費者介面，安全性
- Windows 消費者介面的安全性
- 字串安全性
- 使用者輸入，驗證
- 驗證使用者輸入
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 71b714de3ab12cb10d6e5d9a2e251c34eeeff7a5
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/20/2020
ms.locfileid: "104023900"
---
# <a name="security-considerations-windows-user-interface"></a><span data-ttu-id="e272c-108">安全性考慮： Windows 消費者介面</span><span class="sxs-lookup"><span data-stu-id="e272c-108">Security Considerations: Windows User Interface</span></span>

<span data-ttu-id="e272c-109">本主題提供有關 Windows 消費者介面中安全性考慮的資訊。</span><span class="sxs-lookup"><span data-stu-id="e272c-109">This topic provides information about security considerations in the Windows User Interface.</span></span> <span data-ttu-id="e272c-110">本主題不提供您需要瞭解的安全性問題。</span><span class="sxs-lookup"><span data-stu-id="e272c-110">This topic doesn't provide all you need to know about security issues.</span></span> <span data-ttu-id="e272c-111">相反地，請使用它作為此技術領域的起點和參考。</span><span class="sxs-lookup"><span data-stu-id="e272c-111">Instead, use it as a starting point and reference for this technology area.</span></span>

<span data-ttu-id="e272c-112">隨著電腦互連能力的增加，開發人員現在必須關注應用程式安全性。</span><span class="sxs-lookup"><span data-stu-id="e272c-112">With the increase in computer interconnectivity, developers now must concern themselves with application security.</span></span> <span data-ttu-id="e272c-113">不過，安全性也增強了一般的應用程式安全性和穩定性;因此，開發人員可以使用另一種方式來提供絕佳的使用者體驗。</span><span class="sxs-lookup"><span data-stu-id="e272c-113">However, security also enhances general application safety and robustness; therefore it is another way that the developer can provide a good user experience.</span></span> <span data-ttu-id="e272c-114">下列主題將討論使用 Windows 消費者介面時的一些潛在安全性考慮。</span><span class="sxs-lookup"><span data-stu-id="e272c-114">The following topics discuss some potential security concerns when using the Windows User Interface.</span></span>

-   [<span data-ttu-id="e272c-115">字串考慮</span><span class="sxs-lookup"><span data-stu-id="e272c-115">String Considerations</span></span>](#string-considerations)
-   [<span data-ttu-id="e272c-116">使用者輸入</span><span class="sxs-lookup"><span data-stu-id="e272c-116">User Input</span></span>](#user-input)
-   [<span data-ttu-id="e272c-117">安全性警示</span><span class="sxs-lookup"><span data-stu-id="e272c-117">Security Alerts</span></span>](#security-alerts)
-   [<span data-ttu-id="e272c-118">相關主題</span><span class="sxs-lookup"><span data-stu-id="e272c-118">Related topics</span></span>](#related-topics)

## <a name="string-considerations"></a><span data-ttu-id="e272c-119">字串考慮</span><span class="sxs-lookup"><span data-stu-id="e272c-119">String Considerations</span></span>

<span data-ttu-id="e272c-120">許多函式、訊息和宏會在其參數中使用字串。</span><span class="sxs-lookup"><span data-stu-id="e272c-120">Many functions, messages, and macros use strings in their parameters.</span></span> <span data-ttu-id="e272c-121">不過，通常不會檢查字串是否為 null 終止或長度。</span><span class="sxs-lookup"><span data-stu-id="e272c-121">However, often the strings are not checked for null-termination or for length.</span></span> <span data-ttu-id="e272c-122">相關的考慮是 miscalculating 字串或緩衝區的長度。</span><span class="sxs-lookup"><span data-stu-id="e272c-122">A related concern is miscalculating the length of a string or buffer.</span></span> <span data-ttu-id="e272c-123">在任一種情況下，這可能會導致緩衝區溢位或資料截斷，這可能會對您的應用程式造成負面影響。</span><span class="sxs-lookup"><span data-stu-id="e272c-123">In either case, this can lead to buffer overflow or data truncation, which can affect your application adversely.</span></span> <span data-ttu-id="e272c-124">如需有關緩衝區溢位和其他安全性考慮的詳細資訊，請參閱由 Michael Howard 和 David Leblanc *撰寫安全* 的程式碼，Microsoft 請按2002。</span><span class="sxs-lookup"><span data-stu-id="e272c-124">For more information about buffer overruns and other security concerns, see *Writing Secure Code* by Michael Howard and David Leblanc, Microsoft Press, 2002.</span></span>

<span data-ttu-id="e272c-125">若要以安全的方式處理字串，您應該執行下列作業：</span><span class="sxs-lookup"><span data-stu-id="e272c-125">To handle strings in a safe manner, you should do the following:</span></span>

-   <span data-ttu-id="e272c-126">視需要檢查 null 終止或適當長度的字串。</span><span class="sxs-lookup"><span data-stu-id="e272c-126">Check strings for null-termination or for the proper length, as appropriate.</span></span>
-   <span data-ttu-id="e272c-127">請特別小心判斷字串或緩衝區的長度，尤其是在包含 **TCHAR** 值的時候。</span><span class="sxs-lookup"><span data-stu-id="e272c-127">Take special care to determine the length of a string or buffer, especially when it contains **TCHAR** values.</span></span>
-   <span data-ttu-id="e272c-128">如果您建立字串或使用先前使用的字串，請視需要將它初始化為零或插入 null 結束字元。</span><span class="sxs-lookup"><span data-stu-id="e272c-128">If you create a string or use a string that was used previously, initialize it to zero or insert a null-terminator, as appropriate.</span></span>

<span data-ttu-id="e272c-129">此外，在處理字串時，請考慮使用 [>strsafe.h](/windows/desktop/menurc/strsafe-ovw) 函數。</span><span class="sxs-lookup"><span data-stu-id="e272c-129">In addition, consider using the [StrSafe](/windows/desktop/menurc/strsafe-ovw) functions when dealing with strings.</span></span> <span data-ttu-id="e272c-130">這些函數是設計來安全地處理字串。</span><span class="sxs-lookup"><span data-stu-id="e272c-130">These functions are designed to handle strings safely.</span></span>

## <a name="user-input"></a><span data-ttu-id="e272c-131">使用者輸入</span><span class="sxs-lookup"><span data-stu-id="e272c-131">User Input</span></span>

<span data-ttu-id="e272c-132">Windows 使用者介面是關於取得和回應使用者的資訊。</span><span class="sxs-lookup"><span data-stu-id="e272c-132">The Windows user interface is concerned with getting and responding to information from users.</span></span> <span data-ttu-id="e272c-133">不過，輸入不正確資料的使用者可能會中斷您的應用程式，不論他們是否想要這樣做。</span><span class="sxs-lookup"><span data-stu-id="e272c-133">However, users who enter incorrect data can disrupt your application, whether or not they intend to do so.</span></span> <span data-ttu-id="e272c-134">因此，基本規則是必須驗證所有輸入。</span><span class="sxs-lookup"><span data-stu-id="e272c-134">Thus, the cardinal rule is that all input must be validated.</span></span>

<span data-ttu-id="e272c-135">主要考慮是字串資料，會在 [字串考慮](#string-considerations)中加以討論。</span><span class="sxs-lookup"><span data-stu-id="e272c-135">Of primary concern is string data, which is discussed in [String Considerations](#string-considerations).</span></span> <span data-ttu-id="e272c-136">不過，所有類型的輸入都應該先經過驗證，您的應用程式才能使用。</span><span class="sxs-lookup"><span data-stu-id="e272c-136">However, all types of input should be validated before being used by your application.</span></span> <span data-ttu-id="e272c-137">另一個問題是當資料在某個時間點進行驗證，但在使用之前發生變更時，例如，收到提供文字長度的訊息時。</span><span class="sxs-lookup"><span data-stu-id="e272c-137">Another concern is when data is validated at one point but changes before it is used, for example, when receiving messages that give the length of text.</span></span> <span data-ttu-id="e272c-138">因此，如果資料可能會變更，您應該在使用資料之前檢查資料</span><span class="sxs-lookup"><span data-stu-id="e272c-138">So, if there is a chance the data might change, you should check the data just before you use it</span></span>

## <a name="security-alerts"></a><span data-ttu-id="e272c-139">安全性警示</span><span class="sxs-lookup"><span data-stu-id="e272c-139">Security Alerts</span></span>

<span data-ttu-id="e272c-140">下表列出如果使用不當，可能會危及應用程式安全性的功能。</span><span class="sxs-lookup"><span data-stu-id="e272c-140">The following table lists features that, if used incorrectly, can compromise the security of your applications.</span></span>



| <span data-ttu-id="e272c-141">功能</span><span class="sxs-lookup"><span data-stu-id="e272c-141">Feature</span></span>                                                                                                                                                   | <span data-ttu-id="e272c-142">降低</span><span class="sxs-lookup"><span data-stu-id="e272c-142">Mitigation</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="e272c-143">**GetAtomName**</span><span class="sxs-lookup"><span data-stu-id="e272c-143">**GetAtomName**</span></span>](/windows/desktop/api/winbase/nf-winbase-getatomnamea)                                                                                                               | <span data-ttu-id="e272c-144">指定緩衝區的大小時，請務必小心。</span><span class="sxs-lookup"><span data-stu-id="e272c-144">Be careful when specifying the size of the buffer.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| [<span data-ttu-id="e272c-145">**GlobalGetAtomName**</span><span class="sxs-lookup"><span data-stu-id="e272c-145">**GlobalGetAtomName**</span></span>](/windows/desktop/api/winbase/nf-winbase-globalgetatomnamea)                                                                                                   | <span data-ttu-id="e272c-146">全域字串原子可供任何應用程式存取。</span><span class="sxs-lookup"><span data-stu-id="e272c-146">Global string atoms are accessible to any application.</span></span> <span data-ttu-id="e272c-147">但是，如果另一個應用程式是粗心，它可以 mishandle 參考計數並加以刪除。</span><span class="sxs-lookup"><span data-stu-id="e272c-147">However, if another application is careless, it could mishandle their reference counts and delete them.</span></span> <span data-ttu-id="e272c-148">您應考慮改為使用全域整數原子。</span><span class="sxs-lookup"><span data-stu-id="e272c-148">You should consider using global integer atoms instead.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| [<span data-ttu-id="e272c-149">**ImpersonateDdeClientWindow**</span><span class="sxs-lookup"><span data-stu-id="e272c-149">**ImpersonateDdeClientWindow**</span></span>](/windows/desktop/api/dde/nf-dde-impersonateddeclientwindow)                                                                                 | <span data-ttu-id="e272c-150">如果函式失敗，則會在呼叫進程的安全性內容中進行後續的用戶端要求。</span><span class="sxs-lookup"><span data-stu-id="e272c-150">If the function fails, subsequent client requests are made in the security context of the calling process.</span></span> <span data-ttu-id="e272c-151">如果呼叫的進程是以高許可權的帳戶執行，這可能會造成問題。</span><span class="sxs-lookup"><span data-stu-id="e272c-151">This can be a problem if the calling process is running as a highly privileged account.</span></span> <span data-ttu-id="e272c-152">因此，如果呼叫失敗或引發錯誤，則不會繼續執行用戶端要求。</span><span class="sxs-lookup"><span data-stu-id="e272c-152">Therefore, if the call fails or raises an error do not continue execution of the client request.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| [<span data-ttu-id="e272c-153">**DdeImpersonateClient**</span><span class="sxs-lookup"><span data-stu-id="e272c-153">**DdeImpersonateClient**</span></span>](/windows/desktop/api/ddeml/nf-ddeml-ddeimpersonateclient)                                                                                             | <span data-ttu-id="e272c-154">如果函式失敗，則會在呼叫進程的安全性內容中進行後續的用戶端要求。</span><span class="sxs-lookup"><span data-stu-id="e272c-154">If the function fails, subsequent client requests are made in the security context of the calling process.</span></span> <span data-ttu-id="e272c-155">如果呼叫的進程是以高許可權的帳戶執行，這可能會造成問題。</span><span class="sxs-lookup"><span data-stu-id="e272c-155">This can be a problem if the calling process is running as a highly privileged account.</span></span> <span data-ttu-id="e272c-156">因此，如果呼叫失敗或引發錯誤，則不會繼續執行用戶端要求。</span><span class="sxs-lookup"><span data-stu-id="e272c-156">Therefore, if the call fails or raises an error do not continue execution of the client request.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| [<span data-ttu-id="e272c-157">**GetClipboardFormatName**</span><span class="sxs-lookup"><span data-stu-id="e272c-157">**GetClipboardFormatName**</span></span>](/windows/desktop/api/winuser/nf-winuser-getclipboardformatnamea)                                                                                         | <span data-ttu-id="e272c-158">Miscalculating 適當的 *lpszFormatName* 緩衝區大小，特別是當應用程式同時用於 ANSI 和 Unicode 版本時，可能會造成緩衝區溢位。</span><span class="sxs-lookup"><span data-stu-id="e272c-158">Miscalculating the proper size of the *lpszFormatName* buffer, especially when the application is used in both ANSI and Unicode versions, can cause a buffer overflow.</span></span> <span data-ttu-id="e272c-159">此外，請注意，如果字串長度超過 *cchMaxCount* 參數（可能會導致資訊遺失），則會截斷字串。</span><span class="sxs-lookup"><span data-stu-id="e272c-159">Also, note that the string is truncated if it is longer than the *cchMaxCount* parameter, which can lead to loss of information.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| [<span data-ttu-id="e272c-160">**GetMenuString**</span><span class="sxs-lookup"><span data-stu-id="e272c-160">**GetMenuString**</span></span>](/windows/desktop/api/winuser/nf-winuser-getmenustringa)                                                                                                           | <span data-ttu-id="e272c-161">*LpString* 參數是 **TCHAR** 緩衝區，而 *nMaxCount* 是 **TCHAR** s 中功能表字串的長度。</span><span class="sxs-lookup"><span data-stu-id="e272c-161">The *lpString* parameter is a **TCHAR** buffer, and *nMaxCount* is the length of the menu string in **TCHAR** s.</span></span> <span data-ttu-id="e272c-162">將這些參數的大小不正確，可能是以字元為單位的功能表字串長度。</span><span class="sxs-lookup"><span data-stu-id="e272c-162">Sizing these parameters incorrectly can is the length of the menu string in characters.</span></span> <span data-ttu-id="e272c-163">不正確地調整這些參數的大小可能會導致字串截斷，導致資料可能遺失。</span><span class="sxs-lookup"><span data-stu-id="e272c-163">Sizing these parameters incorrectly can cause truncation of the string, leading to possible loss of data.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| <span data-ttu-id="e272c-164">[**GetStringTypeA**](/windows/desktop/api/winnls/nf-winnls-getstringtypea)、 [**GetStringTypeEx**](/windows/win32/api/stringapiset/nf-stringapiset-getstringtypeexw)、 [**GetStringTypeW**](/windows/desktop/api/stringapiset/nf-stringapiset-getstringtypew)</span><span class="sxs-lookup"><span data-stu-id="e272c-164">[**GetStringTypeA**](/windows/desktop/api/winnls/nf-winnls-getstringtypea), [**GetStringTypeEx**](/windows/win32/api/stringapiset/nf-stringapiset-getstringtypeexw), [**GetStringTypeW**](/windows/desktop/api/stringapiset/nf-stringapiset-getstringtypew)</span></span> | <span data-ttu-id="e272c-165">若要避免緩衝區溢位，請正確地設定 *lpCharType* 緩衝區的大小。</span><span class="sxs-lookup"><span data-stu-id="e272c-165">To avoid a buffer overflow, set the size of the *lpCharType* buffer correctly.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| [<span data-ttu-id="e272c-166">**LoadLibrary**</span><span class="sxs-lookup"><span data-stu-id="e272c-166">**LoadLibrary**</span></span>](/windows/desktop/api/libloaderapi/nf-libloaderapi-loadlibrarya)                                                                                                                       | <span data-ttu-id="e272c-167">不當使用 **LoadLibrary** 可能會載入錯誤的 DLL，進而危及應用程式的安全性。</span><span class="sxs-lookup"><span data-stu-id="e272c-167">Using **LoadLibrary** incorrectly can compromise the security of your application by loading the wrong DLL.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| [<span data-ttu-id="e272c-168">**Loadstring 時**</span><span class="sxs-lookup"><span data-stu-id="e272c-168">**LoadString**</span></span>](/windows/desktop/api/winuser/nf-winuser-loadstringa)                                                                                                                 | <span data-ttu-id="e272c-169">不正確的用法包括在 *nBufferMax* 參數中指定錯誤的大小。</span><span class="sxs-lookup"><span data-stu-id="e272c-169">Incorrect use includes specifying the wrong size in the *nBufferMax* parameter.</span></span> <span data-ttu-id="e272c-170">例如，sizeof (*lpBuffer*) 會提供緩衝區的大小（以位元組為單位），這可能會導致函式的 Unicode 版本發生緩衝區溢位。</span><span class="sxs-lookup"><span data-stu-id="e272c-170">For example, sizeof(*lpBuffer*) gives the size of the buffer in bytes, which could lead to a buffer overflow for the Unicode version of the function.</span></span> <span data-ttu-id="e272c-171">緩衝區溢位的情況是應用程式中許多安全性問題的原因。</span><span class="sxs-lookup"><span data-stu-id="e272c-171">Buffer overflow situations are the cause of many security problems in applications.</span></span> <span data-ttu-id="e272c-172">在此情況下，使用會 `sizeof(lpBuffer)/sizeof(TCHAR)` 提供適當的緩衝區大小。</span><span class="sxs-lookup"><span data-stu-id="e272c-172">In this case, using `sizeof(lpBuffer)/sizeof(TCHAR)` gives the proper size of the buffer.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| [<span data-ttu-id="e272c-173">**lstrcat**</span><span class="sxs-lookup"><span data-stu-id="e272c-173">**lstrcat**</span></span>](/windows/desktop/api/winbase/nf-winbase-lstrcata)                                                                                                                       | <span data-ttu-id="e272c-174">此函數會使用結構化例外狀況處理 (SEH) 攔截存取違規和其他錯誤。</span><span class="sxs-lookup"><span data-stu-id="e272c-174">This function uses structured exception handling (SEH) to catch access violations and other errors.</span></span> <span data-ttu-id="e272c-175">當此函式捕捉至 SEH 錯誤時，它會傳回 **null** ，而不會以 null 結束字串，而不會傳回 null，而不會對字串進行 null 終止，也不會通知呼叫端錯誤。</span><span class="sxs-lookup"><span data-stu-id="e272c-175">When this function catches SEH errors, it returns **NULL** without null-terminating the string and without NULL without null-terminating the string and without notifying the caller of the error.</span></span> <span data-ttu-id="e272c-176">呼叫端無法安全地假設空間不足是錯誤狀況。</span><span class="sxs-lookup"><span data-stu-id="e272c-176">The caller is not safe to assume that insufficient space is the error condition.</span></span> <span data-ttu-id="e272c-177">第一個引數 *lpString1* 必須夠大，才能容納 *lpString2* 和結尾 ' \\ 0 '，否則可能會發生緩衝區溢位。</span><span class="sxs-lookup"><span data-stu-id="e272c-177">The first argument, *lpString1*, must be large enough to hold *lpString2* and the closing '\\0', otherwise a buffer overrun may occur.</span></span> <span data-ttu-id="e272c-178">如果發生存取違規，緩衝區溢位可能會對應用程式造成阻絕服務攻擊。</span><span class="sxs-lookup"><span data-stu-id="e272c-178">Buffer overruns may lead to a denial of service attack against the application if an access violation occurs.</span></span> <span data-ttu-id="e272c-179">在最糟的情況下，緩衝區溢位可能會讓攻擊者將可執行檔程式碼插入您的進程，特別是當 *lpString1* 是堆疊型緩衝區時。</span><span class="sxs-lookup"><span data-stu-id="e272c-179">In the worst case, a buffer overrun may allow an attacker to inject executable code into your process, especially if *lpString1* is a stack-based buffer.</span></span> <span data-ttu-id="e272c-180">請考慮使用下列其中一個替代方案。</span><span class="sxs-lookup"><span data-stu-id="e272c-180">Consider using one of the following alternatives.</span></span> <span data-ttu-id="e272c-181">[**StringCbCat**](/windows/desktop/api/strsafe/nf-strsafe-stringcbcata) 或 [**StringCchCat**](/windows/desktop/api/strsafe/nf-strsafe-stringcchcata)。</span><span class="sxs-lookup"><span data-stu-id="e272c-181">[**StringCbCat**](/windows/desktop/api/strsafe/nf-strsafe-stringcbcata) or [**StringCchCat**](/windows/desktop/api/strsafe/nf-strsafe-stringcchcata).</span></span>                                                                                                                                                                                       |
| [<span data-ttu-id="e272c-182">**lstrcpy**</span><span class="sxs-lookup"><span data-stu-id="e272c-182">**lstrcpy**</span></span>](/windows/desktop/api/winbase/nf-winbase-lstrcpya)                                                                                                                       | <span data-ttu-id="e272c-183">此函數會使用結構化例外狀況處理 (SEH) 攔截存取違規和其他錯誤。</span><span class="sxs-lookup"><span data-stu-id="e272c-183">This function uses structured exception handling (SEH) to catch access violations and other errors.</span></span> <span data-ttu-id="e272c-184">當此函式捕捉至 SEH 錯誤時，它會傳回 **null** ，而不會以 null 結束字串，而不會傳回 null，而不會對字串進行 null 終止，也不會通知呼叫端錯誤。</span><span class="sxs-lookup"><span data-stu-id="e272c-184">When this function catches SEH errors, it returns **NULL** without null-terminating the string and without NULL without null-terminating the string and without notifying the caller of the error.</span></span> <span data-ttu-id="e272c-185">呼叫端無法安全地假設空間不足是錯誤狀況。</span><span class="sxs-lookup"><span data-stu-id="e272c-185">The caller is not safe to assume that insufficient space is the error condition.</span></span> <span data-ttu-id="e272c-186">第一個引數 *lpString1* 必須夠大，才能容納 *lpString2* 和結尾 ' \\ 0 '，否則可能會發生緩衝區溢位。</span><span class="sxs-lookup"><span data-stu-id="e272c-186">The first argument, *lpString1*, must be large enough to hold *lpString2* and the closing '\\0', otherwise a buffer overrun may occur.</span></span> <span data-ttu-id="e272c-187">如果發生存取違規，緩衝區溢位可能會對應用程式造成阻絕服務攻擊。</span><span class="sxs-lookup"><span data-stu-id="e272c-187">Buffer overruns may lead to a denial of service attack against the application if an access violation occurs.</span></span> <span data-ttu-id="e272c-188">在最糟的情況下，緩衝區溢位可能會讓攻擊者將可執行檔程式碼插入您的進程，特別是當 *lpString1* 是堆疊型緩衝區時。</span><span class="sxs-lookup"><span data-stu-id="e272c-188">In the worst case, a buffer overrun may allow an attacker to inject executable code into your process, especially if *lpString1* is a stack-based buffer.</span></span> <span data-ttu-id="e272c-189">請考慮改為使用 [**StringCchCopy**](/windows/desktop/api/strsafe/nf-strsafe-stringcchcopya) 。</span><span class="sxs-lookup"><span data-stu-id="e272c-189">Consider using [**StringCchCopy**](/windows/desktop/api/strsafe/nf-strsafe-stringcchcopya) instead.</span></span>                                                                                                                                                                                                                                                               |
| [<span data-ttu-id="e272c-190">**lstrcpyn**</span><span class="sxs-lookup"><span data-stu-id="e272c-190">**lstrcpyn**</span></span>](/windows/desktop/api/winbase/nf-winbase-lstrcpyna)                                                                                                                     | <span data-ttu-id="e272c-191">此函數會使用結構化例外狀況處理 (SEH) 攔截存取違規和其他錯誤。</span><span class="sxs-lookup"><span data-stu-id="e272c-191">This function uses structured exception handling (SEH) to catch access violations and other errors.</span></span> <span data-ttu-id="e272c-192">當此函式捕捉至 SEH 錯誤時，它會傳回 **null** ，而不會以 null 結束字串，而不會傳回 null，而不會對字串進行 null 終止，也不會通知呼叫端錯誤。</span><span class="sxs-lookup"><span data-stu-id="e272c-192">When this function catches SEH errors, it returns **NULL** without null-terminating the string and without NULL without null-terminating the string and without notifying the caller of the error.</span></span> <span data-ttu-id="e272c-193">呼叫端無法安全地假設空間不足是錯誤狀況。</span><span class="sxs-lookup"><span data-stu-id="e272c-193">The caller is not safe to assume that insufficient space is the error condition.</span></span> <span data-ttu-id="e272c-194">如果 *lpString1* 不夠大，無法包含複製的字串，則可能會發生緩衝區溢位。</span><span class="sxs-lookup"><span data-stu-id="e272c-194">If *lpString1* is not large enough to contain the copied string, a buffer overrun can occur.</span></span> <span data-ttu-id="e272c-195">此外，在複製整個字串時，請注意 [sizeof](https://msdn.microsoft.com/library/0w557fh7(VS.71).aspx) 會傳回位元組數目，而不是 **WCHAR**，而 **sizeof** 會傳回位元組數而非字元，這對此函式的 Unicode 版本而言不正確。</span><span class="sxs-lookup"><span data-stu-id="e272c-195">Also, when copying an entire string, note that [sizeof](https://msdn.microsoft.com/library/0w557fh7(VS.71).aspx) returns the number of bytes rather than **WCHAR**, that **sizeof** returns the number of bytes rather than characters, which is incorrect for the Unicode version of this function.</span></span> <span data-ttu-id="e272c-196">如果發生存取違規，緩衝區溢位可能會對應用程式造成阻絕服務攻擊。</span><span class="sxs-lookup"><span data-stu-id="e272c-196">Buffer overruns can cause a denial of service attack against the application if an access violation occurs.</span></span> <span data-ttu-id="e272c-197">在最糟的情況下，緩衝區溢位可能會讓攻擊者將可執行檔程式碼插入您的進程，特別是當 *lpString1* 是堆疊型緩衝區時。</span><span class="sxs-lookup"><span data-stu-id="e272c-197">In the worst case, a buffer overrun may allow an attacker to inject executable code into your process, especially if *lpString1* is a stack-based buffer.</span></span> <span data-ttu-id="e272c-198">請考慮改為使用 [**StringCchCopy**](/windows/desktop/api/strsafe/nf-strsafe-stringcchcopya) 。</span><span class="sxs-lookup"><span data-stu-id="e272c-198">Consider using [**StringCchCopy**](/windows/desktop/api/strsafe/nf-strsafe-stringcchcopya) instead.</span></span> |
| [<span data-ttu-id="e272c-199">**lstrlen**</span><span class="sxs-lookup"><span data-stu-id="e272c-199">**lstrlen**</span></span>](/windows/desktop/api/winbase/nf-winbase-lstrlena)                                                                                                                       | <span data-ttu-id="e272c-200">[**lstrlen**](/windows/desktop/api/winbase/nf-winbase-lstrlena) 假設 *lpString* 是以 null 終止的字串。</span><span class="sxs-lookup"><span data-stu-id="e272c-200">[**lstrlen**](/windows/desktop/api/winbase/nf-winbase-lstrlena) assumes that *lpString* is a null-terminated string.</span></span> <span data-ttu-id="e272c-201">如果不是，這可能會導致緩衝區溢位或對您的應用程式造成阻絕服務攻擊。</span><span class="sxs-lookup"><span data-stu-id="e272c-201">If it is not, this could lead to a buffer overrun or a denial of service attack against your application.</span></span> <span data-ttu-id="e272c-202">請考慮使用下列其中一個替代方案。</span><span class="sxs-lookup"><span data-stu-id="e272c-202">Consider using one of the following alternatives.</span></span> <span data-ttu-id="e272c-203">[**StringCbLength**](/windows/desktop/api/strsafe/nf-strsafe-stringcblengtha) 或 [**StringCchLength**](/windows/desktop/api/strsafe/nf-strsafe-stringcchlengtha)。</span><span class="sxs-lookup"><span data-stu-id="e272c-203">[**StringCbLength**](/windows/desktop/api/strsafe/nf-strsafe-stringcblengtha) or [**StringCchLength**](/windows/desktop/api/strsafe/nf-strsafe-stringcchlengtha).</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| [<span data-ttu-id="e272c-204">**wsprintf**</span><span class="sxs-lookup"><span data-stu-id="e272c-204">**wsprintf**</span></span>](/windows/desktop/api/winuser/nf-winuser-wsprintfa)                                                                                                                     | <span data-ttu-id="e272c-205">*LpOut* 中傳回的字串不保證會以 null 終止。</span><span class="sxs-lookup"><span data-stu-id="e272c-205">The string returned in *lpOut* is not guaranteed to be null-terminated.</span></span> <span data-ttu-id="e272c-206">此外，請避免使用% s 格式，這可能會導致緩衝區溢位。</span><span class="sxs-lookup"><span data-stu-id="e272c-206">Also, avoid the %s format, which can lead to a buffer overrun.</span></span> <span data-ttu-id="e272c-207">如果發生存取違規，就會導致您的應用程式拒絕服務。</span><span class="sxs-lookup"><span data-stu-id="e272c-207">If an access violation occurs it causes a denial of service against your application.</span></span> <span data-ttu-id="e272c-208">在更糟的情況下，攻擊者可以插入可執行程式碼。</span><span class="sxs-lookup"><span data-stu-id="e272c-208">In the worse case, an attacker can inject executable code.</span></span> <span data-ttu-id="e272c-209">請考慮使用下列其中一個替代方案。</span><span class="sxs-lookup"><span data-stu-id="e272c-209">Consider using one of the following alternatives.</span></span> <span data-ttu-id="e272c-210">[**StringCbPrintf**](/windows/desktop/api/strsafe/nf-strsafe-stringcbprintfa)、 [**StringCbPrintfEx**](/windows/desktop/api/strsafe/nf-strsafe-stringcbprintfexa)、 [**StringCbVPrintf**](/windows/desktop/api/strsafe/nf-strsafe-stringcbvprintfa)、 [**StringCbVPrintfEx**](/windows/desktop/api/strsafe/nf-strsafe-stringcbvprintfexa)、 [**StringCchPrintf**](/windows/desktop/api/strsafe/nf-strsafe-stringcchprintfa)、 [**StringCchPrintfEx**](/windows/desktop/api/strsafe/nf-strsafe-stringcchprintfexa)、 [**StringCchVPrintf**](/windows/desktop/api/strsafe/nf-strsafe-stringcchvprintfa)或 [**StringCchVPrintfEx**](/windows/desktop/api/strsafe/nf-strsafe-stringcchvprintfexa)。</span><span class="sxs-lookup"><span data-stu-id="e272c-210">[**StringCbPrintf**](/windows/desktop/api/strsafe/nf-strsafe-stringcbprintfa), [**StringCbPrintfEx**](/windows/desktop/api/strsafe/nf-strsafe-stringcbprintfexa), [**StringCbVPrintf**](/windows/desktop/api/strsafe/nf-strsafe-stringcbvprintfa), [**StringCbVPrintfEx**](/windows/desktop/api/strsafe/nf-strsafe-stringcbvprintfexa), [**StringCchPrintf**](/windows/desktop/api/strsafe/nf-strsafe-stringcchprintfa), [**StringCchPrintfEx**](/windows/desktop/api/strsafe/nf-strsafe-stringcchprintfexa), [**StringCchVPrintf**](/windows/desktop/api/strsafe/nf-strsafe-stringcchvprintfa), or [**StringCchVPrintfEx**](/windows/desktop/api/strsafe/nf-strsafe-stringcchvprintfexa).</span></span>                                                                                                                                                                                                                                                                                                                                         |
| [<span data-ttu-id="e272c-211">**wvsprintf**</span><span class="sxs-lookup"><span data-stu-id="e272c-211">**wvsprintf**</span></span>](/windows/desktop/api/winuser/nf-winuser-wvsprintfa)                                                                                                                   | <span data-ttu-id="e272c-212">*LpOutput* 中傳回的字串不保證會以 null 終止。</span><span class="sxs-lookup"><span data-stu-id="e272c-212">The string returned in *lpOutput* is not guaranteed to be null-terminated.</span></span> <span data-ttu-id="e272c-213">此外，請避免使用% s 格式，這可能會導致緩衝區溢位。</span><span class="sxs-lookup"><span data-stu-id="e272c-213">Also, avoid the use of the %s format, which can lead to a buffer overrun.</span></span> <span data-ttu-id="e272c-214">如果造成存取違規，或攻擊者可能插入可執行程式碼，這可能會導致阻絕服務。</span><span class="sxs-lookup"><span data-stu-id="e272c-214">This can lead to a denial of service if it results in an access violation, or an attacker may inject executable code.</span></span> <span data-ttu-id="e272c-215">請考慮使用下列其中一個替代方案。</span><span class="sxs-lookup"><span data-stu-id="e272c-215">Consider using one of the following alternatives.</span></span> <span data-ttu-id="e272c-216">[**StringCbPrintf**](/windows/desktop/api/strsafe/nf-strsafe-stringcbprintfa)、 [**StringCbPrintfEx**](/windows/desktop/api/strsafe/nf-strsafe-stringcbprintfexa)、 [**StringCbVPrintf**](/windows/desktop/api/strsafe/nf-strsafe-stringcbvprintfa)、 [**StringCbVPrintfEx**](/windows/desktop/api/strsafe/nf-strsafe-stringcbvprintfexa)、 [**StringCchPrintf**](/windows/desktop/api/strsafe/nf-strsafe-stringcchprintfa)、 [**StringCchPrintfEx**](/windows/desktop/api/strsafe/nf-strsafe-stringcchprintfexa)、 [**StringCchVPrintf**](/windows/desktop/api/strsafe/nf-strsafe-stringcchvprintfa)或 [**StringCchVPrintfEx**](/windows/desktop/api/strsafe/nf-strsafe-stringcchvprintfexa)。</span><span class="sxs-lookup"><span data-stu-id="e272c-216">[**StringCbPrintf**](/windows/desktop/api/strsafe/nf-strsafe-stringcbprintfa), [**StringCbPrintfEx**](/windows/desktop/api/strsafe/nf-strsafe-stringcbprintfexa), [**StringCbVPrintf**](/windows/desktop/api/strsafe/nf-strsafe-stringcbvprintfa), [**StringCbVPrintfEx**](/windows/desktop/api/strsafe/nf-strsafe-stringcbvprintfexa), [**StringCchPrintf**](/windows/desktop/api/strsafe/nf-strsafe-stringcchprintfa), [**StringCchPrintfEx**](/windows/desktop/api/strsafe/nf-strsafe-stringcchprintfexa), [**StringCchVPrintf**](/windows/desktop/api/strsafe/nf-strsafe-stringcchvprintfa), or [**StringCchVPrintfEx**](/windows/desktop/api/strsafe/nf-strsafe-stringcchvprintfexa).</span></span>                                                                                                                                                                                                                                                                                                                                                      |



 

## <a name="related-topics"></a><span data-ttu-id="e272c-217">相關主題</span><span class="sxs-lookup"><span data-stu-id="e272c-217">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="e272c-218">Microsoft 安全性</span><span class="sxs-lookup"><span data-stu-id="e272c-218">Microsoft Security</span></span>](https://www.microsoft.com/security/)
</dt> <dt>

[<span data-ttu-id="e272c-219">安全性和身分識別</span><span class="sxs-lookup"><span data-stu-id="e272c-219">Security and Identity</span></span>](/windows/desktop/security)
</dt> <dt>

<span data-ttu-id="e272c-220">[安全性 how to Index](/previous-versions/msp-n-p/ff650055(v=pandp.10))</span><span class="sxs-lookup"><span data-stu-id="e272c-220">[Security How Tos Index](/previous-versions/msp-n-p/ff650055(v=pandp.10))</span></span>
</dt> <dt>

[<span data-ttu-id="e272c-221">TechNet 安全性資源</span><span class="sxs-lookup"><span data-stu-id="e272c-221">TechNet Security Resources</span></span>](https://www.microsoft.com/technet/security/default.mspx)
</dt> <dt>

[<span data-ttu-id="e272c-222">安全性 Api 的最佳作法</span><span class="sxs-lookup"><span data-stu-id="e272c-222">Best Practices for the Security APIs</span></span>](/windows/desktop/SecBP/best-practices-for-the-security-apis)
</dt> </dl>

 

 