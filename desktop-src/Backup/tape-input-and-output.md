---
title: 磁帶輸入和輸出
description: 有幾個函數可讓應用程式用來在磁帶機上 (i/o) 執行輸入和輸出。 磁帶 i/o 類似于在通訊裝置上執行的 i/o。
ms.assetid: 1862c267-0070-4fe8-bb77-40167913978a
keywords:
- 磁帶輸入和輸出備份
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5946659f1ad0246e37981201e4e08611b45b70b1
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/20/2020
ms.locfileid: "104315898"
---
# <a name="tape-input-and-output"></a><span data-ttu-id="90a02-105">磁帶輸入和輸出</span><span class="sxs-lookup"><span data-stu-id="90a02-105">Tape Input and Output</span></span>

<span data-ttu-id="90a02-106">有幾個函數可讓應用程式用來在磁帶機上 (i/o) 執行輸入和輸出。</span><span class="sxs-lookup"><span data-stu-id="90a02-106">There are several functions that applications can use to perform input and output (I/O) on a tape drive.</span></span> <span data-ttu-id="90a02-107">磁帶 i/o 類似于在通訊裝置上執行的 i/o。</span><span class="sxs-lookup"><span data-stu-id="90a02-107">Tape I/O is similar to I/O performed on a communications device.</span></span>

<span data-ttu-id="90a02-108">執行磁帶 i/o 時，有些磁帶機會將磁帶固件資訊儲存在磁帶上的前幾個區塊中，通常會使用第一個100區塊的部分。</span><span class="sxs-lookup"><span data-stu-id="90a02-108">When performing tape I/O, some tape drives store tape firmware information in the first few blocks on a tape, typically using some portion of the first 100 blocks.</span></span> <span data-ttu-id="90a02-109">應用程式不應該使用這些區塊。</span><span class="sxs-lookup"><span data-stu-id="90a02-109">Applications should not use those blocks.</span></span> <span data-ttu-id="90a02-110">您可以從個別的磁帶系統製造商取得此主題的更具體資訊。</span><span class="sxs-lookup"><span data-stu-id="90a02-110">More specific information on this subject is available from individual tape system manufacturers.</span></span> <span data-ttu-id="90a02-111">一般情況下，略過磁帶上第一個100區塊的應用程式會避免磁帶機的特性。</span><span class="sxs-lookup"><span data-stu-id="90a02-111">In general, an application that skips the first 100 blocks on a tape will avoid tape drive idiosyncrasies.</span></span>

<span data-ttu-id="90a02-112">[**GetTapePosition**](/windows/desktop/api/Winbase/nf-winbase-gettapeposition)和 [**SetTapePosition**](/windows/desktop/api/Winbase/nf-winbase-settapeposition)函式會取出目前的磁帶位置並進行移動。</span><span class="sxs-lookup"><span data-stu-id="90a02-112">The [**GetTapePosition**](/windows/desktop/api/Winbase/nf-winbase-gettapeposition) and [**SetTapePosition**](/windows/desktop/api/Winbase/nf-winbase-settapeposition) functions retrieve and move the current tape position.</span></span> <span data-ttu-id="90a02-113">[**WriteTapemark**](/windows/desktop/api/Winbase/nf-winbase-writetapemark)函式會寫入指定數目的 setmarks、格式標記、簡短的標記和長的標記。</span><span class="sxs-lookup"><span data-stu-id="90a02-113">The [**WriteTapemark**](/windows/desktop/api/Winbase/nf-winbase-writetapemark) function writes a specified number of setmarks, filemarks, short filemarks, and long filemarks.</span></span> <span data-ttu-id="90a02-114">[**EraseTape**](/windows/desktop/api/Winbase/nf-winbase-erasetape)函式會清除所有或部分的磁帶。</span><span class="sxs-lookup"><span data-stu-id="90a02-114">The [**EraseTape**](/windows/desktop/api/Winbase/nf-winbase-erasetape) function erases all or part of a tape.</span></span>

<span data-ttu-id="90a02-115">[**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile)和 [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile)函式會從磁帶讀取和寫入檔案資料。</span><span class="sxs-lookup"><span data-stu-id="90a02-115">The [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) and [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile) functions read and write file data from and to the tape.</span></span> <span data-ttu-id="90a02-116">資料是以完整區塊讀取和寫入。</span><span class="sxs-lookup"><span data-stu-id="90a02-116">The data is read and written in complete blocks.</span></span> <span data-ttu-id="90a02-117">如果磁帶的區塊大小為512個位元組，則所有讀取和寫入作業都必須使用屬於該區塊大小之簡單整數倍數的緩衝區：512、1024、1536、2048等等。</span><span class="sxs-lookup"><span data-stu-id="90a02-117">If the tape's block size is 512 bytes, all read and write operations must use buffers that are simple integer multiples of that block size: 512, 1024, 1536, 2048, and so on.</span></span> <span data-ttu-id="90a02-118">大部分（如果不是全部），磁片磁碟機只允許在磁帶倒轉或讀取作業產生資料結束錯誤訊息之後，進行寫入操作。</span><span class="sxs-lookup"><span data-stu-id="90a02-118">Most, if not all, drives only allow a write operation after the tape is rewound or after a read operation produces an end-of-data error message.</span></span>

<span data-ttu-id="90a02-119">若要在可變長度的區塊模式中，讀取或寫入磁帶的檔案資料，請執行下列步驟：</span><span class="sxs-lookup"><span data-stu-id="90a02-119">To read or write file data to or from a tape in variable-length block mode, perform the following steps:</span></span>

1.  <span data-ttu-id="90a02-120">藉由呼叫 [**GetTapeParameters**](/windows/desktop/api/Winbase/nf-winbase-gettapeparameters)函式，並檢查 \_ \_ \_ 所傳回 [**磁帶 \_ 取得 \_ 磁片磁碟機 \_ 參數**](/windows/desktop/api/Winnt/ns-winnt-tape_get_drive_parameters)結構之 **FeaturesLow** 成員的磁帶機變數區塊位，判斷磁帶機是否支援可變長度的封鎖模式。</span><span class="sxs-lookup"><span data-stu-id="90a02-120">Determine whether the tape drive supports variable-length block mode by calling the [**GetTapeParameters**](/windows/desktop/api/Winbase/nf-winbase-gettapeparameters) function and checking the TAPE\_DRIVE\_VARIABLE\_BLOCK bit of the **FeaturesLow** member of the returned [**TAPE\_GET\_DRIVE\_PARAMETERS**](/windows/desktop/api/Winnt/ns-winnt-tape_get_drive_parameters) structure.</span></span>
2.  <span data-ttu-id="90a02-121">藉由呼叫 [**SetTapeParameters**](/windows/desktop/api/Winbase/nf-winbase-settapeparameters)函式，將 [**磁帶 \_ 組 \_ 媒體 \_ 參數**](/windows/desktop/api/Winnt/ns-winnt-tape_set_media_parameters)結構的 **區塊** 成員設定為零，以指定變數區塊大小模式。</span><span class="sxs-lookup"><span data-stu-id="90a02-121">Specify the variable block size mode by calling the [**SetTapeParameters**](/windows/desktop/api/Winbase/nf-winbase-settapeparameters) function, setting the **BlockSize** member of the [**TAPE\_SET\_MEDIA\_PARAMETERS**](/windows/desktop/api/Winnt/ns-winnt-tape_set_media_parameters) structure to zero.</span></span> <span data-ttu-id="90a02-122">然後，使用 [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) 或 [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile) 來讀取或寫入檔案資料。</span><span class="sxs-lookup"><span data-stu-id="90a02-122">Then, use [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) or [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile) to read or write the file data.</span></span>

<span data-ttu-id="90a02-123">如果 [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) 遇到標記標記，就會讀取到標記最多的資料，且函式會失敗。</span><span class="sxs-lookup"><span data-stu-id="90a02-123">If [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) encounters a filemark, the data up to the filemark is read and the function fails.</span></span> <span data-ttu-id="90a02-124"> ([**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) 函式會傳回錯誤碼，指出所遇到的標記類型。 ) 作業系統會將磁帶移出標記後，應用程式可以再次呼叫 **ReadFile** 以繼續讀取。</span><span class="sxs-lookup"><span data-stu-id="90a02-124">(The [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) function returns an error code indicating the type of filemark that was encountered.) The operating system moves the tape past the filemark, and an application can call **ReadFile** again to continue reading.</span></span>

<span data-ttu-id="90a02-125">[**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) 和 [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile) 只會讀取和寫入資料流程。</span><span class="sxs-lookup"><span data-stu-id="90a02-125">[**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) and [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile) read and write only the data stream.</span></span> <span data-ttu-id="90a02-126">[**BackupRead**](/windows/desktop/api/Winbase/nf-winbase-backupread)和 [**BackupWrite**](/windows/desktop/api/Winbase/nf-winbase-backupwrite)函式會讀取和寫入與檔案相關聯的所有資料流程。</span><span class="sxs-lookup"><span data-stu-id="90a02-126">The [**BackupRead**](/windows/desktop/api/Winbase/nf-winbase-backupread) and [**BackupWrite**](/windows/desktop/api/Winbase/nf-winbase-backupwrite) functions read and write all the streams associated with a file.</span></span> <span data-ttu-id="90a02-127">這些包括資料、擴充屬性、安全性和替代資料流程。</span><span class="sxs-lookup"><span data-stu-id="90a02-127">These include data, extended attributes, security, and alternative data streams.</span></span> <span data-ttu-id="90a02-128">安全性和替代資料流程只與 NTFS 檔案系統磁碟分割相關。</span><span class="sxs-lookup"><span data-stu-id="90a02-128">The security and alternate data streams are relevant only on the NTFS file system partition.</span></span>

<span data-ttu-id="90a02-129">[**BackupSeek**](/windows/desktop/api/Winbase/nf-winbase-backupseek)函式會向前搜尋 [**BackupRead**](/windows/desktop/api/Winbase/nf-winbase-backupread)或 [**BackupWrite**](/windows/desktop/api/Winbase/nf-winbase-backupwrite)一開始所存取的檔案。</span><span class="sxs-lookup"><span data-stu-id="90a02-129">The [**BackupSeek**](/windows/desktop/api/Winbase/nf-winbase-backupseek) function seeks forward in a file initially accessed by [**BackupRead**](/windows/desktop/api/Winbase/nf-winbase-backupread) or [**BackupWrite**](/windows/desktop/api/Winbase/nf-winbase-backupwrite).</span></span> <span data-ttu-id="90a02-130">此函式可讓應用程式略過導致存取錯誤的資訊。</span><span class="sxs-lookup"><span data-stu-id="90a02-130">This function enables an application to skip information that causes access errors.</span></span>

<span data-ttu-id="90a02-131">如果應用程式只需要存取檔案資料，則應該使用 [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) 和 [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile)。</span><span class="sxs-lookup"><span data-stu-id="90a02-131">If an application needs to access only the file data, it should use [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) and [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile).</span></span> <span data-ttu-id="90a02-132">如果資料流程是使用 [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) 函數所建立，則這些函式也可以讀取替代資料流程。</span><span class="sxs-lookup"><span data-stu-id="90a02-132">These functions can also read alternative data streams if the streams were created by using the [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) function.</span></span>

<span data-ttu-id="90a02-133">磁帶備份應用程式必須使用 [**BackupRead**](/windows/desktop/api/Winbase/nf-winbase-backupread) 和 [**BackupWrite**](/windows/desktop/api/Winbase/nf-winbase-backupwrite) 來複製與檔案相關的所有資訊。</span><span class="sxs-lookup"><span data-stu-id="90a02-133">A tape-backup application must use [**BackupRead**](/windows/desktop/api/Winbase/nf-winbase-backupread) and [**BackupWrite**](/windows/desktop/api/Winbase/nf-winbase-backupwrite) to copy all information pertaining to a file.</span></span> <span data-ttu-id="90a02-134">不過，這些函式不會讀取或寫入檔案特性，例如屬性、檔案建立時間等等。</span><span class="sxs-lookup"><span data-stu-id="90a02-134">However, these functions do not read or write file characteristics such as attributes, file creation time, and so on.</span></span> <span data-ttu-id="90a02-135">應用程式必須使用檔案輸入和輸出函式（例如 [**GetFileAttributes**](/windows/desktop/api/fileapi/nf-fileapi-getfileattributesa) 和 [**SetFileAttributes**](/windows/desktop/api/fileapi/nf-fileapi-setfileattributesa)）來取得和設定這些值。</span><span class="sxs-lookup"><span data-stu-id="90a02-135">Applications must use the file input and output functions, such as [**GetFileAttributes**](/windows/desktop/api/fileapi/nf-fileapi-getfileattributesa) and [**SetFileAttributes**](/windows/desktop/api/fileapi/nf-fileapi-setfileattributesa), to retrieve and set those values.</span></span>

 

 