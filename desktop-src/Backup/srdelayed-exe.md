---
title: Srdelayed.exe
description: 在作業系統啟動初期執行系統狀態還原作業的應用程式，可能無法使用檔案管理功能來移動、刪除或設定特定系統檔案的簡短名稱。
ms.assetid: cedeb48e-bc1d-48d1-9bee-0b8b0132c3e5
keywords:
- Srdelayed.exe 備份
- 系統狀態修復備份
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5a5f6b281c07f5b0ad8d6cd7e59b4f93ec9208a5
ms.sourcegitcommit: 46376be61d3fa308f9b1a06d7e2fa122a39755af
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/10/2020
ms.locfileid: "104463876"
---
# <a name="srdelayedexe"></a><span data-ttu-id="6023d-105">Srdelayed.exe</span><span class="sxs-lookup"><span data-stu-id="6023d-105">Srdelayed.exe</span></span>

<span data-ttu-id="6023d-106">在作業系統啟動初期執行系統狀態還原作業的應用程式，可能無法使用檔案管理功能來移動、刪除或設定特定系統檔案的簡短名稱。</span><span class="sxs-lookup"><span data-stu-id="6023d-106">Applications that perform system state restore operations early in the startup of the operating system may be unable to use the file management functions to move, delete, or set the short name of certain system files.</span></span> <span data-ttu-id="6023d-107">Srdelayed.exe 是 Windows Server 2008 中的 Windows Server Backup (WSB) 功能所提供的可執行檔，可讓系統狀態修復應用程式移動、刪除和設定系統檔案的簡短名稱。</span><span class="sxs-lookup"><span data-stu-id="6023d-107">Srdelayed.exe is an executable file, provided with the Windows Server Backup (WSB) feature in Windows Server 2008, that can enable system state recovery applications to move, delete, and set the short name of system files.</span></span>

<span data-ttu-id="6023d-108">Srdelayed 工具適用于系統狀態恢復應用程式;它不會取代檔案管理功能。</span><span class="sxs-lookup"><span data-stu-id="6023d-108">The Srdelayed tool is intended for system state recovery applications; it does not replace the file management functions.</span></span> <span data-ttu-id="6023d-109">只有當應用程式無法使用 [**MoveFileEx**](/windows/desktop/api/winbase/nf-winbase-movefileexa)、 [**DeleteFile**](/windows/desktop/api/fileapi/nf-fileapi-deletefilea)和 [**SetFileShortName**](/windows/desktop/api/winbase/nf-winbase-setfileshortnamea) 函數來移動、刪除或設定系統檔案的簡短名稱時，才應該使用此工具。</span><span class="sxs-lookup"><span data-stu-id="6023d-109">This tool should be used only when the application is unable to move, delete, or set the short name of a system file using the [**MoveFileEx**](/windows/desktop/api/winbase/nf-winbase-movefileexa), [**DeleteFile**](/windows/desktop/api/fileapi/nf-fileapi-deletefilea), and [**SetFileShortName**](/windows/desktop/api/winbase/nf-winbase-setfileshortnamea) functions.</span></span> <span data-ttu-id="6023d-110">在系統狀態還原和重新開機期間，系統還原和 wbadmin.exe 命令列工具會使用 Srdelayed.exe 來移動、刪除和設定特定系統檔案的簡短名稱。</span><span class="sxs-lookup"><span data-stu-id="6023d-110">During a system state restore and restart, Srdelayed.exe is used by System Restore and the wbadmin.exe command-line tool to move, delete, and set the short name on certain system files.</span></span> <span data-ttu-id="6023d-111">因此，Srdelayed 可能會對需要能夠在自己的系統狀態復原應用程式中還原這些系統檔案的開發人員很有用。</span><span class="sxs-lookup"><span data-stu-id="6023d-111">Srdelayed may therefore be useful to developers that require the capability to restore these system files in their own system state recovery applications.</span></span>

<span data-ttu-id="6023d-112">Srdelayed 可以執行下列作業：</span><span class="sxs-lookup"><span data-stu-id="6023d-112">Srdelayed can perform the following operations:</span></span>

-   <span data-ttu-id="6023d-113">移動檔案作業類似于 [**MoveFileEx**](/windows/desktop/api/winbase/nf-winbase-movefileexa) 函式， **MOVEFILE 延遲到 \_ \_ \_ 重新開機** 旗標</span><span class="sxs-lookup"><span data-stu-id="6023d-113">A move file operation similar to the [**MoveFileEx**](/windows/desktop/api/winbase/nf-winbase-movefileexa) function with the **MOVEFILE\_DELAY\_UNTIL\_REBOOT** flag</span></span>
-   <span data-ttu-id="6023d-114">類似于 [**DeleteFile**](/windows/desktop/api/fileapi/nf-fileapi-deletefilea) 函數的刪除檔案作業</span><span class="sxs-lookup"><span data-stu-id="6023d-114">A delete file operation similar to the [**DeleteFile**](/windows/desktop/api/fileapi/nf-fileapi-deletefilea) function</span></span>
-   <span data-ttu-id="6023d-115">類似于 [**SetFileShortName**](/windows/desktop/api/winbase/nf-winbase-setfileshortnamea) 函式的設定簡短名稱運算</span><span class="sxs-lookup"><span data-stu-id="6023d-115">A set short-name operation similar to the [**SetFileShortName**](/windows/desktop/api/winbase/nf-winbase-setfileshortnamea) function</span></span>

<span data-ttu-id="6023d-116">若要使用 Srdelayed，您的應用程式需要 Srdelayed.exe 檔案位置的完整路徑，以及您所撰寫的 Unicode 文字檔的完整路徑，以包含工具執行所要求的所有檔案管理作業所需的資訊。</span><span class="sxs-lookup"><span data-stu-id="6023d-116">To use Srdelayed, your application requires the full path to the location of the Srdelayed.exe file and the full path to a Unicode text file that you have authored to contain the information the tool needs to perform all the file management operations being requested.</span></span> <span data-ttu-id="6023d-117">您的應用程式會負責確保這個文字檔不包含作業的重複要求，而且它會處理任何必要的檔案管理作業順序。</span><span class="sxs-lookup"><span data-stu-id="6023d-117">Your application is responsible for ensuring that this text file does not contain redundant requests for an operation and that it handles any required ordering of the file management operations.</span></span> <span data-ttu-id="6023d-118">例如，由於資料夾必須是空的，因此，您的應用程式必須確保在要求刪除資料夾之前，文字檔會先移除資料夾內的所有檔案。</span><span class="sxs-lookup"><span data-stu-id="6023d-118">For example, because a folder must be empty to be deleted, your application needs to ensure that the text file specifies the removal of all files inside the folder before requesting the folder be deleted.</span></span>

<span data-ttu-id="6023d-119">如果 **SetupExecute** 專案尚未存在於登錄中，則您的應用程式必須在下列登錄機碼底下，建立名 **為 SetupExecute** 的 **REG \_ 多重 \_ SZ** 類型專案： **HKEY \_ LOCAL \_ MACHINE** \\ **System** \\ **CurrentControlSet** \\ **Control** \\ **Session Manager**。</span><span class="sxs-lookup"><span data-stu-id="6023d-119">If the **SetupExecute** entry does not already exist in the registry, your application needs to create a **REG\_MULTI\_SZ** type entry named **SetupExecute** under the following registry key: **HKEY\_LOCAL\_MACHINE**\\**System**\\**CurrentControlSet**\\**Control**\\**Session Manager**.</span></span>

<span data-ttu-id="6023d-120">您的應用程式應該使用下列格式，將 **SetupExecute** 的值設定為 Srdelayed.exe 檔案位置的完整路徑，以及文字檔位置的完整路徑。</span><span class="sxs-lookup"><span data-stu-id="6023d-120">Your application should use the following format to set the value of **SetupExecute** to the full path to the location of the Srdelayed.exe file and the full path to the location of the text file.</span></span> <span data-ttu-id="6023d-121">將 " \\ \\ ？？ \\ " 前置詞設為文字檔的路徑，如下所示：</span><span class="sxs-lookup"><span data-stu-id="6023d-121">Prefix "\\\\??\\" to the path of the text file, as follows:</span></span>

<span data-ttu-id="6023d-122">*Srdelayed.exe的完整路徑* \\ \\ ？ \\*文字檔的完整路徑*</span><span class="sxs-lookup"><span data-stu-id="6023d-122">*Full Path to Srdelayed.exe* \\\\??\\*Full Path to Text file*</span></span>  


<span data-ttu-id="6023d-123">例如，下列 **SetupExecute** 值表示 Srdelayed.exe 位於 System32 資料夾中，而文字檔名為 DelayedOperations：</span><span class="sxs-lookup"><span data-stu-id="6023d-123">For example, the following value for **SetupExecute** indicates that the Srdelayed.exe is located in the System32 folder and the text file is named DelayedOperations:</span></span>

<span data-ttu-id="6023d-124">C： \\ Windows \\ System32 \\srdelayed.exe \\ \\ ？？ \\C： \\ temp \\ DelayedOperations</span><span class="sxs-lookup"><span data-stu-id="6023d-124">C:\\Windows\\System32\\srdelayed.exe \\\\??\\C:\\temp\\DelayedOperations</span></span>  


<span data-ttu-id="6023d-125">路徑和名稱中的空格應該以十六進位編碼。</span><span class="sxs-lookup"><span data-stu-id="6023d-125">Spaces in the path and name should be hexadecimal encoded.</span></span> <span data-ttu-id="6023d-126">例如，在 *程式* 檔中，將路徑編碼為 " \\ \\ ？？ \\C:Program%20Files \\a.dll」。</span><span class="sxs-lookup"><span data-stu-id="6023d-126">For example, for *Program Files*, encode the path as "\\\\??\\C:Program%20Files\\a.dll".</span></span>

<span data-ttu-id="6023d-127">在重新開機時還原登錄或系統時，您的應用程式必須確保 **SetupExecute** 會寫入正確的登錄 hive。</span><span class="sxs-lookup"><span data-stu-id="6023d-127">When the registry or system is being restored upon restart, your application needs to ensure that **SetupExecute** gets written in the correct registry hive.</span></span> <span data-ttu-id="6023d-128">在 Srdelayed.exe 執行之前，會先執行登錄的復原。</span><span class="sxs-lookup"><span data-stu-id="6023d-128">Recovery of the registry is performed before Srdelayed.exe is run.</span></span> <span data-ttu-id="6023d-129">應用程式需要將 **SetupExecute** 寫入至復原的登錄版本，因為這是所讀取的版本。</span><span class="sxs-lookup"><span data-stu-id="6023d-129">The application needs to write **SetupExecute** into the recovered version of the registry because this is the version that is read.</span></span>

## <a name="format-for-the-srdelayed-input-file"></a><span data-ttu-id="6023d-130">Srdelayed 輸入檔的格式</span><span class="sxs-lookup"><span data-stu-id="6023d-130">Format for the Srdelayed Input File</span></span>

<span data-ttu-id="6023d-131">Srdelayed 執行檔案管理作業所需的所有資訊都指定為 Unicode 文字檔中的 Unicode 字元字串。</span><span class="sxs-lookup"><span data-stu-id="6023d-131">All the information Srdelayed needs to perform file management operations is specified as a string of Unicode characters in a Unicode text file.</span></span> <span data-ttu-id="6023d-132">Unicode 字元的字串會分割成各自各自分割成四個欄位的記錄。</span><span class="sxs-lookup"><span data-stu-id="6023d-132">The string of Unicode characters is partitioned into records that are themselves each partitioned into four fields.</span></span> <span data-ttu-id="6023d-133">每一筆記錄會指定單一移動檔案、刪除檔案或設定簡短名稱作業。</span><span class="sxs-lookup"><span data-stu-id="6023d-133">Each record specifies a single move file, delete file, or set short-name operation.</span></span> <span data-ttu-id="6023d-134">每一筆記錄的四個欄位都包含作業的參數。</span><span class="sxs-lookup"><span data-stu-id="6023d-134">The four fields of each record contain the parameters for the operation.</span></span> <span data-ttu-id="6023d-135">Srdelayed.exe 會依照其記錄出現在字串中的順序來執行每個作業。</span><span class="sxs-lookup"><span data-stu-id="6023d-135">Srdelayed.exe performs each operation in the order that their records occur in the string.</span></span> <span data-ttu-id="6023d-136">您的應用程式應該檢查此檔案中是否有任何重複的記錄，並移除重複專案。</span><span class="sxs-lookup"><span data-stu-id="6023d-136">Your application should check for any duplicate records in this file and remove the duplicates.</span></span>

<span data-ttu-id="6023d-137">下列字串說明要求兩項作業並由兩筆記錄組成之檔案的格式。</span><span class="sxs-lookup"><span data-stu-id="6023d-137">The following string illustrates the format for a file requesting two operations and consisting of two records.</span></span> <span data-ttu-id="6023d-138">每個參數欄位的結尾都是單一 L ' \\ 0 ' 字元。</span><span class="sxs-lookup"><span data-stu-id="6023d-138">Each parameter field ends with a single L'\\0' character.</span></span> <span data-ttu-id="6023d-139">記錄是由四個連續欄位所組成。</span><span class="sxs-lookup"><span data-stu-id="6023d-139">A record is composed of four consecutive fields.</span></span> <span data-ttu-id="6023d-140">\\在所有記錄的結尾附加一個額外的單一 L ' 0 ' 字元。</span><span class="sxs-lookup"><span data-stu-id="6023d-140">An additional single L'\\0' character is appended to the end of all records.</span></span>

`<ParamA1>L'\0'<ParamA2>L'\0'<ParamA3>L'\0'<ParamA4>L'\0'<ParamB1>L'\0'<ParamB2>L'\0'<ParamB3>L'\0'<ParamB4>L'\0'L'\0'`  
`|-----------------------RecordA------------------------|------------------------RecordB------------------------|`  


<span data-ttu-id="6023d-141">第一個、第二、第三和第四個參數欄位的意義取決於記錄是否描述移動、刪除或設定的簡短名稱作業。</span><span class="sxs-lookup"><span data-stu-id="6023d-141">The meaning of the first, second, third, and fourth parameter fields depends on whether the record describes a move, delete, or set short-name operation.</span></span>

## <a name="format-for-a-move-file-record"></a><span data-ttu-id="6023d-142">移動檔案記錄的格式</span><span class="sxs-lookup"><span data-stu-id="6023d-142">Format for a Move File Record</span></span>

<span data-ttu-id="6023d-143">欄位1將此識別為移動檔案的要求。</span><span class="sxs-lookup"><span data-stu-id="6023d-143">Field 1 identifies this as a request to move a file.</span></span> <span data-ttu-id="6023d-144">此欄位中的值一律為 L "MoveFile"，而且會區分大小寫。</span><span class="sxs-lookup"><span data-stu-id="6023d-144">The value in this field is always L"MoveFile" and is case sensitive.</span></span>

<span data-ttu-id="6023d-145">欄位2：指定檔案的來源位置。</span><span class="sxs-lookup"><span data-stu-id="6023d-145">Field 2 specifies the source location of the file.</span></span> <span data-ttu-id="6023d-146">Srdelayed 移動檔案操作不支援移動資料夾。</span><span class="sxs-lookup"><span data-stu-id="6023d-146">The Srdelayed move file operation does not support moving a folder.</span></span> <span data-ttu-id="6023d-147">必須在此欄位中指定檔案。</span><span class="sxs-lookup"><span data-stu-id="6023d-147">A file must be specified in this field.</span></span> <span data-ttu-id="6023d-148">這個欄位的值是附加至 "？？" 之檔案的完整路徑 \\ \\ \\ ，除非路徑包含 (GUID) 的全域唯一識別碼，這會使用 " \\ \\ ？ \\ " 作為前置詞。</span><span class="sxs-lookup"><span data-stu-id="6023d-148">The value for this field is the full path of the file appended to "\\\\??\\" unless the path includes a globally unique identifier (GUID), which uses "\\\\?\\" as a prefix.</span></span> <span data-ttu-id="6023d-149">請先移除 " \\ \\ ？ \\ " 再附加至 " \\ \\ ？？ \\ "。</span><span class="sxs-lookup"><span data-stu-id="6023d-149">Remove "\\\\?\\" before appending to "\\\\??\\".</span></span>

<span data-ttu-id="6023d-150">欄位3：指定檔案的目的地。</span><span class="sxs-lookup"><span data-stu-id="6023d-150">Field 3 specifies the destination of the file.</span></span> <span data-ttu-id="6023d-151">移動檔案作業只會在磁片區內運作。</span><span class="sxs-lookup"><span data-stu-id="6023d-151">The move file operation works only within a volume.</span></span> <span data-ttu-id="6023d-152">來源和目的地必須位於相同的磁片區上。</span><span class="sxs-lookup"><span data-stu-id="6023d-152">The source and destination must be on the same volume.</span></span> <span data-ttu-id="6023d-153">這個欄位的值是附加至 "？？" 之檔案的完整路徑 \\ \\ \\ ，除非路徑包含 (GUID) 的全域唯一識別碼，這會使用 " \\ \\ ？ \\ " 作為前置詞。</span><span class="sxs-lookup"><span data-stu-id="6023d-153">The value for this field is the full path of the file appended to "\\\\??\\" unless the path includes a globally unique identifier (GUID), which uses "\\\\?\\" as a prefix.</span></span> <span data-ttu-id="6023d-154">請先移除 " \\ \\ ？ \\ " 再附加至 " \\ \\ ？？ \\ "。</span><span class="sxs-lookup"><span data-stu-id="6023d-154">Remove "\\\\?\\" before appending to "\\\\??\\".</span></span>

<span data-ttu-id="6023d-155">欄位4會接收來自 Srdelayed 的狀態資訊。</span><span class="sxs-lookup"><span data-stu-id="6023d-155">Field 4 receives status information from Srdelayed.</span></span> <span data-ttu-id="6023d-156">此欄位中的值應設定為 L "NotExecuted" 作為新記錄。</span><span class="sxs-lookup"><span data-stu-id="6023d-156">The value in this field should be set to L"NotExecuted" for a new record.</span></span>

<span data-ttu-id="6023d-157">下列範例會依磁片磁碟機路徑來參考檔案。</span><span class="sxs-lookup"><span data-stu-id="6023d-157">The following example references the file by drive path.</span></span> <span data-ttu-id="6023d-158">如果來源的路徑和名稱為 C： \\ 階段 \\a.dll，此記錄會要求 Srdelayed 將它移至 C： \\ temp \\a.dll。</span><span class="sxs-lookup"><span data-stu-id="6023d-158">If the path and name of the source is C:\\Stage\\a.dll, this record requests that Srdelayed move it to C:\\temp\\a.dll.</span></span>

<span data-ttu-id="6023d-159">MoveFile \\ \\ ？？ \\C： \\ 階段 \\a.dll \\ \\ ？？ \\C： \\ temp \\a.dll NotExecuted</span><span class="sxs-lookup"><span data-stu-id="6023d-159">MoveFile \\\\??\\C:\\Stage\\a.dll \\\\??\\C:\\temp\\a.dll NotExecuted</span></span>  


<span data-ttu-id="6023d-160">下列範例會依磁片區 GUID 路徑來參考檔案。</span><span class="sxs-lookup"><span data-stu-id="6023d-160">The following example references the file by volume GUID path.</span></span> <span data-ttu-id="6023d-161">如果來源的路徑和名稱是 \\ \\ ？ \\磁片區 {26a21bda-a627-11d7-9931-806e6f6e6963} \\ 階段 \\a.dll，此記錄會要求 Srdelayed 將它移至 \\ \\ ？ \\Volume {26a21bda-a627-11d7-9931-806e6f6e6963} \\ temp \\a.dll</span><span class="sxs-lookup"><span data-stu-id="6023d-161">If the path and name of the source is \\\\?\\Volume{26a21bda-a627-11d7-9931-806e6f6e6963}\\Stage\\a.dll, this record requests that Srdelayed move it to \\\\?\\Volume{26a21bda-a627-11d7-9931-806e6f6e6963}\\temp\\a.dll</span></span>

 <span data-ttu-id="6023d-162">MoveFile \\ \\ ？？ \\磁片區 {26a21bda-a627-11d7-9931-806e6f6e6963} \\ 階段 \\a.dll \\ \\ ？？ \\Volume {26a21bda-a627-11d7-9931-806e6f6e6963} \\ temp \\a.dll NotExecuted</span><span class="sxs-lookup"><span data-stu-id="6023d-162">MoveFile \\\\??\\Volume{26a21bda-a627-11d7-9931-806e6f6e6963}\\Stage\\a.dll \\\\??\\Volume{26a21bda-a627-11d7-9931-806e6f6e6963}\\temp\\a.dll NotExecuted</span></span>  


## <a name="format-for-a-delete-file-record"></a><span data-ttu-id="6023d-163">刪除檔案記錄的格式</span><span class="sxs-lookup"><span data-stu-id="6023d-163">Format for a Delete File Record</span></span>

<span data-ttu-id="6023d-164">欄位1將此識別為刪除檔案的要求。</span><span class="sxs-lookup"><span data-stu-id="6023d-164">Field 1 identifies this as a request to delete a file.</span></span> <span data-ttu-id="6023d-165">此欄位中的值一律為 L "DeleteFile"，而且會區分大小寫。</span><span class="sxs-lookup"><span data-stu-id="6023d-165">The value in this field is always L"DeleteFile" and is case sensitive.</span></span>

<span data-ttu-id="6023d-166">未使用欄位2。</span><span class="sxs-lookup"><span data-stu-id="6023d-166">Field 2 is unused.</span></span> <span data-ttu-id="6023d-167">此欄位中的值應設定為 L "未使用"。</span><span class="sxs-lookup"><span data-stu-id="6023d-167">The value in this field should be set to L"Unused".</span></span>

<span data-ttu-id="6023d-168">欄位3：指定要移除的檔案。</span><span class="sxs-lookup"><span data-stu-id="6023d-168">Field 3 specifies the file to be removed.</span></span> <span data-ttu-id="6023d-169">資料夾必須是空的，才能移除。</span><span class="sxs-lookup"><span data-stu-id="6023d-169">A folder must be empty to be removed.</span></span> <span data-ttu-id="6023d-170">移除資料夾之前，請使用 [刪除檔案作業] 移除資料夾中的所有檔案。</span><span class="sxs-lookup"><span data-stu-id="6023d-170">Use delete file operations to remove all files in the folder before removing the folder.</span></span> <span data-ttu-id="6023d-171">這個欄位的值是附加至 "？？" 之檔案的完整路徑 \\ \\ \\ ，除非路徑包含 (GUID) 的全域唯一識別碼，這會使用 " \\ \\ ？ \\ " 作為前置詞。</span><span class="sxs-lookup"><span data-stu-id="6023d-171">The value for this field is the full path of the file appended to "\\\\??\\" unless the path includes a globally unique identifier (GUID), which uses "\\\\?\\" as a prefix.</span></span> <span data-ttu-id="6023d-172">請先移除 " \\ \\ ？ \\ " 再附加至 " \\ \\ ？？ \\ "。</span><span class="sxs-lookup"><span data-stu-id="6023d-172">Remove "\\\\?\\" before appending to "\\\\??\\".</span></span>

<span data-ttu-id="6023d-173">欄位4會接收來自 Srdelayed 的狀態資訊。</span><span class="sxs-lookup"><span data-stu-id="6023d-173">Field 4 receives status information from Srdelayed.</span></span> <span data-ttu-id="6023d-174">此欄位中的值應設定為 L "NotExecuted" 作為新記錄。</span><span class="sxs-lookup"><span data-stu-id="6023d-174">The value in this field should be set to L"NotExecuted" for a new record.</span></span>

<span data-ttu-id="6023d-175">下列範例會依磁片磁碟機路徑來參考檔案。</span><span class="sxs-lookup"><span data-stu-id="6023d-175">The following example references the file by drive path.</span></span> <span data-ttu-id="6023d-176">如果路徑和名稱為 C： \\ temp \\b.dll，此記錄會要求 Srdelayed 刪除該檔案。</span><span class="sxs-lookup"><span data-stu-id="6023d-176">If the path and name is C:\\temp\\b.dll, this record requests that Srdelayed delete the file.</span></span>

<span data-ttu-id="6023d-177">DeleteFile 未使用 \\ \\ ？？ \\C： \\ temp \\b.dll NotExecuted</span><span class="sxs-lookup"><span data-stu-id="6023d-177">DeleteFile Unused \\\\??\\C:\\temp\\b.dll NotExecuted</span></span>  


<span data-ttu-id="6023d-178">下列範例會依磁片區 GUID 來參考檔案。</span><span class="sxs-lookup"><span data-stu-id="6023d-178">The following example references the file by volume GUID.</span></span> <span data-ttu-id="6023d-179">如果路徑和名稱是 \\ \\ ？ \\磁片區 {26a21bda-a627-11d7-9931-806e6f6e6963} \\ temp \\b.dll，此記錄會要求 Srdelayed 移除該檔案。</span><span class="sxs-lookup"><span data-stu-id="6023d-179">If the path and name is \\\\?\\Volume{26a21bda-a627-11d7-9931-806e6f6e6963}\\temp\\b.dll, this record requests that Srdelayed remove the file.</span></span>

<span data-ttu-id="6023d-180">DeleteFile 未使用 \\ \\ ？？ \\Volume {26a21bda-a627-11d7-9931-806e6f6e6963} \\ temp \\b.dll\\ NotExecuted</span><span class="sxs-lookup"><span data-stu-id="6023d-180">DeleteFile Unused \\\\??\\Volume{26a21bda-a627-11d7-9931-806e6f6e6963}\\temp\\b.dll\\ NotExecuted</span></span>  


## <a name="format-for-set-short-name-record"></a><span data-ttu-id="6023d-181">Set Short-Name Record 的格式</span><span class="sxs-lookup"><span data-stu-id="6023d-181">Format for Set Short-Name Record</span></span>

<span data-ttu-id="6023d-182">[欄位 1] 將此識別為要求設定檔案的簡短名稱。</span><span class="sxs-lookup"><span data-stu-id="6023d-182">Field 1 identifies this as a request to set a file's short name.</span></span> <span data-ttu-id="6023d-183">此欄位中的值一律為 L "SetFileShortName"，而且會區分大小寫。</span><span class="sxs-lookup"><span data-stu-id="6023d-183">The value in this field is always L"SetFileShortName" and is case sensitive.</span></span>

<span data-ttu-id="6023d-184">欄位2：指定簡短名稱。</span><span class="sxs-lookup"><span data-stu-id="6023d-184">Field 2 specifies the short name.</span></span>

<span data-ttu-id="6023d-185">[欄位 3] 欄位指定要接收簡短名稱的路徑和完整名稱。</span><span class="sxs-lookup"><span data-stu-id="6023d-185">Field 3 field specifies the path and long name to receive the short name.</span></span> <span data-ttu-id="6023d-186">此欄位的值是附加至 "？？" 之檔案的路徑和完整名稱 \\ \\ \\ ，除非路徑包含 (GUID) 的全域唯一識別碼，這會使用 " \\ \\ ？ \\ " 作為前置詞。</span><span class="sxs-lookup"><span data-stu-id="6023d-186">The value for this field is the path and long name of the file appended to "\\\\??\\" unless the path includes a globally unique identifier (GUID), which uses "\\\\?\\" as a prefix.</span></span> <span data-ttu-id="6023d-187">請先移除 " \\ \\ ？ \\ " 再附加至 " \\ \\ ？？ \\ "。</span><span class="sxs-lookup"><span data-stu-id="6023d-187">Remove "\\\\?\\" before appending to "\\\\??\\".</span></span>

<span data-ttu-id="6023d-188">欄位4會接收來自 Srdelayed 的狀態資訊。</span><span class="sxs-lookup"><span data-stu-id="6023d-188">Field 4 receives status information from Srdelayed.</span></span> <span data-ttu-id="6023d-189">此欄位中的值應設定為 L "NotExecuted" 作為新記錄。</span><span class="sxs-lookup"><span data-stu-id="6023d-189">The value in this field should be set to L"NotExecuted" for a new record.</span></span>

<span data-ttu-id="6023d-190">下列範例會依磁片磁碟機路徑來參考檔案。</span><span class="sxs-lookup"><span data-stu-id="6023d-190">The following example references the file by drive path.</span></span> <span data-ttu-id="6023d-191">如果檔案的路徑和名稱為 C： \\ temp \\ShortFileName.dll，此記錄會要求檔案收到簡短名稱 ShortN ~1.dll。</span><span class="sxs-lookup"><span data-stu-id="6023d-191">If the path and name of the file is C:\\temp\\ShortFileName.dll, this record requests that the file receive a short name, ShortN~1.dll.</span></span>

<span data-ttu-id="6023d-192">SetFileShortName ShortN ~1.dll \\ \\ ？？ \\C： \\ temp \\ShortFileName.dll NotExecuted</span><span class="sxs-lookup"><span data-stu-id="6023d-192">SetFileShortName ShortN~1.dll \\\\??\\C:\\temp\\ShortFileName.dll NotExecuted</span></span>  


<span data-ttu-id="6023d-193">下列範例會依磁片區 GUID 來參考檔案。</span><span class="sxs-lookup"><span data-stu-id="6023d-193">The following example references the file by volume GUID.</span></span> <span data-ttu-id="6023d-194">如果檔案的路徑和名稱是 \\ \\ ？ \\磁片區 {26a21bda-a627-11d7-9931-806e6f6e6963} \\ temp \\ShortFileName.dll\\ ，此記錄會要求檔案收到簡短名稱 ShortN ~1.dll。</span><span class="sxs-lookup"><span data-stu-id="6023d-194">If the path and name of the file is \\\\?\\Volume{26a21bda-a627-11d7-9931-806e6f6e6963}\\temp\\ShortFileName.dll\\, this record requests that the file receive a short name, ShortN~1.dll.</span></span>

<span data-ttu-id="6023d-195">SetFileShortName ShortN ~1.dll \\ \\ ？？ \\Volume {26a21bda-a627-11d7-9931-806e6f6e6963} \\ temp \\ShortFileName.dll\\ NotExecuted</span><span class="sxs-lookup"><span data-stu-id="6023d-195">SetFileShortName ShortN~1.dll \\\\??\\Volume{26a21bda-a627-11d7-9931-806e6f6e6963}\\temp\\ShortFileName.dll\\ NotExecuted</span></span>  


## <a name="srdelayed-operations-status"></a><span data-ttu-id="6023d-196">Srdelayed 作業狀態</span><span class="sxs-lookup"><span data-stu-id="6023d-196">Srdelayed Operations Status</span></span>

<span data-ttu-id="6023d-197">Srdelayed 會將 "SC =*>xxxxxxx*" 字串寫入到文字檔的每個記錄的第四個欄位中，其中 *>xxxxxxx* 是表示要求的作業狀態的十六進位。</span><span class="sxs-lookup"><span data-stu-id="6023d-197">Srdelayed writes the string L"SC=*xxxxxxx*" into the fourth field of each record of the text file, where *xxxxxxx* is a hexadecimal that indicates the status of the requested operation.</span></span> <span data-ttu-id="6023d-198">值為零表示作業成功。</span><span class="sxs-lookup"><span data-stu-id="6023d-198">A value of zero indicates the operation succeeded.</span></span>

<span data-ttu-id="6023d-199">Srdelayed 會在 **HKEY \_ LOCAL \_ MACHINE** Software Microsoft Windows NT CurrentVersion 下建立名為 **SystemRestore** 的登錄機碼 \\  \\  \\  \\  ，以記錄整個還原作業的結果。</span><span class="sxs-lookup"><span data-stu-id="6023d-199">Srdelayed creates a registry key named **SystemRestore** under **HKEY\_LOCAL\_MACHINE**\\**Software**\\**Microsoft**\\**Windows NT**\\**CurrentVersion** to log the outcome of the entire restore operation.</span></span> <span data-ttu-id="6023d-200">如果 Srdelayed 執行所有要求的作業成功，則名稱 RestoreStatusResult 會以零值寫入此索引鍵。</span><span class="sxs-lookup"><span data-stu-id="6023d-200">If Srdelayed performs all the requested operations with success, the name RestoreStatusResult is written under this key with a zero value.</span></span> <span data-ttu-id="6023d-201">如果 Srdelayed 無法執行任何要求的作業，名稱 RestoreStatusResult 和 RestoreStatusDetails 會以非零值寫入此索引鍵下。</span><span class="sxs-lookup"><span data-stu-id="6023d-201">If Srdelayed is unable to perform any of the requested operations, the names RestoreStatusResult and RestoreStatusDetails are written under this key with nonzero values.</span></span> <span data-ttu-id="6023d-202">只有在 Srdelayed 無法執行任何要求的作業時，才會在此機碼下寫入名稱 RestoreStatusDetails。</span><span class="sxs-lookup"><span data-stu-id="6023d-202">The name RestoreStatusDetails is written under this key only if Srdelayed is unable to perform any requested operations.</span></span> <span data-ttu-id="6023d-203">如果設定檔案簡短名稱的作業不成功，Srdelayed 會繼續進行下一項作業。</span><span class="sxs-lookup"><span data-stu-id="6023d-203">If an operation to set the short name of a file is unsuccessful, Srdelayed continues to the next operation.</span></span> <span data-ttu-id="6023d-204">Srdelayed 會將移動檔案和刪除檔案作業視為重要，且如果移動或刪除作業失敗，則不會繼續。</span><span class="sxs-lookup"><span data-stu-id="6023d-204">Srdelayed considers the move file and delete file operations to be critical and does not continue if a move or delete operation is unsuccessful.</span></span>

 

 