---
title: 用戶端/伺服器應用程式指導方針
description: 用戶端/伺服器應用程式不能假設單一電腦連接相當於單一使用者會話。
ms.assetid: 69822ef1-eca8-4302-b014-8e5894d52109
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cd0c1a71256f3ab469bfeb1c08b2d096b56ac1b5
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/20/2020
ms.locfileid: "106965429"
---
# <a name="clientserver-application-guidelines"></a><span data-ttu-id="281fd-103">用戶端/伺服器應用程式指導方針</span><span class="sxs-lookup"><span data-stu-id="281fd-103">Client/Server application guidelines</span></span>

<span data-ttu-id="281fd-104">用戶端/伺服器應用程式不能假設單一電腦連接相當於單一使用者會話。</span><span class="sxs-lookup"><span data-stu-id="281fd-104">Client/server applications must not assume that a single computer connection is equivalent to a single user session.</span></span> <span data-ttu-id="281fd-105">這是 [IP 位址和電腦名稱稱](ip-addresses-and-computer-names.md)中所討論之問題的特殊案例。</span><span class="sxs-lookup"><span data-stu-id="281fd-105">This is a special case of the issue discussed in [IP Addresses and Computer Names](ip-addresses-and-computer-names.md).</span></span>

<span data-ttu-id="281fd-106">若要唯一識別用戶端/伺服器連接，每個用戶端模組都必須使用唯一的名稱或識別碼。</span><span class="sxs-lookup"><span data-stu-id="281fd-106">To uniquely identify a client/server connection, each client module must use a unique name or identifier.</span></span> <span data-ttu-id="281fd-107">應用程式可以使用命名物件或管道、通訊端或其他 IPC 方法。</span><span class="sxs-lookup"><span data-stu-id="281fd-107">Applications can use named objects or pipes, sockets, or other IPC methods.</span></span> <span data-ttu-id="281fd-108">如需詳細資訊，請參閱 [核心物件命名空間](kernel-object-namespaces.md)。</span><span class="sxs-lookup"><span data-stu-id="281fd-108">For more information, see [Kernel Object Namespaces](kernel-object-namespaces.md).</span></span>

<span data-ttu-id="281fd-109">若要遠端桌面服務相容，用戶端/伺服器應用程式中的伺服器模組必須能夠處理從同一部電腦連接的多個用戶端。</span><span class="sxs-lookup"><span data-stu-id="281fd-109">To be Remote Desktop Services compatible, the server module in a client/server application must be able to handle multiple clients connecting from the same computer.</span></span> <span data-ttu-id="281fd-110">為了達成此目的，伺服器模組必須透過定義完善的全域介面（例如 RPC 或具名管道）接受用戶端連接。</span><span class="sxs-lookup"><span data-stu-id="281fd-110">To accomplish this, the server module must accept client connections through a well-defined global interface, such as RPC or named pipes.</span></span> <span data-ttu-id="281fd-111">伺服器和用戶端必須為每個使用者會話協調不同的通道。</span><span class="sxs-lookup"><span data-stu-id="281fd-111">The server and client must negotiate a different communication channel for each user session.</span></span> <span data-ttu-id="281fd-112">用戶端必須使用可輕鬆支援這類作業的通訊協定（例如 TCP/IP）來建立與伺服器的連線，其中每個用戶端應用程式都可以使用不同的通訊端連線。</span><span class="sxs-lookup"><span data-stu-id="281fd-112">The client must establish a connection to the server by using protocols that easily support this type of operation, such as TCP/IP, where a different socket connection can be used for each client application.</span></span>

<span data-ttu-id="281fd-113">用戶端模組可以呼叫 [**ProcessIdToSessionId**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-processidtosessionid) 函式，以取得其遠端桌面服務會話的識別碼。</span><span class="sxs-lookup"><span data-stu-id="281fd-113">The client module can call the [**ProcessIdToSessionId**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-processidtosessionid) function to retrieve the identifier of its Remote Desktop Services session.</span></span> <span data-ttu-id="281fd-114">然後，用戶端會使用某種形式的處理序間通訊，將其會話識別碼傳遞至伺服器模組。</span><span class="sxs-lookup"><span data-stu-id="281fd-114">The client then uses some form of interprocess communication to pass its session identifier to the server module.</span></span> <span data-ttu-id="281fd-115">然後，用戶端和伺服器模組可以使用會話識別碼設定私人通道。</span><span class="sxs-lookup"><span data-stu-id="281fd-115">The client and server modules can then use the session identifier to set up a private communication channel.</span></span> <span data-ttu-id="281fd-116">例如，伺服器模組可以使用會話識別碼來存取核心物件的會話命名空間中的物件。</span><span class="sxs-lookup"><span data-stu-id="281fd-116">For example, the server module can use a session identifier to access objects in the session's namespace for kernel objects.</span></span>

<span data-ttu-id="281fd-117">此外，伺服器模組可以使用 [**WTSQuerySessionInformation**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtsquerysessioninformationa) 呼叫中的會話識別碼，來取得用戶端的其他相關資訊。</span><span class="sxs-lookup"><span data-stu-id="281fd-117">Furthermore, the server module can use the session identifier in a [**WTSQuerySessionInformation**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtsquerysessioninformationa) call to retrieve additional information about the client.</span></span> <span data-ttu-id="281fd-118">伺服器模組也可以使用 [**WTSSendMessage**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtssendmessagea) 呼叫中的會話識別碼，在用戶端終端機上顯示訊息。</span><span class="sxs-lookup"><span data-stu-id="281fd-118">The server module can also use the session identifier in a [**WTSSendMessage**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtssendmessagea) call to display a message on the client terminal.</span></span> <span data-ttu-id="281fd-119">伺服器模組也可以建立兩個事件，以監視會話的用戶端連接和中斷連接。</span><span class="sxs-lookup"><span data-stu-id="281fd-119">The server module can also create two events to monitor client connection to and disconnection from a session.</span></span> <span data-ttu-id="281fd-120">但是，它必須在遠端桌面工作階段主機 (RD 工作階段主機) 伺服器上註冊才能完成此動作。</span><span class="sxs-lookup"><span data-stu-id="281fd-120">However, it must be registered on the Remote Desktop Session Host (RD Session Host) server to do this.</span></span> <span data-ttu-id="281fd-121">如需詳細資訊，請參閱 [監視會話連接和中斷連接](monitoring-session-connections-and-disconnections.md)。</span><span class="sxs-lookup"><span data-stu-id="281fd-121">For more information, see [Monitoring Session Connections and Disconnections](monitoring-session-connections-and-disconnections.md).</span></span>

<span data-ttu-id="281fd-122">提示使用者輸入是用戶端/伺服器應用程式可能發生的問題來源。</span><span class="sxs-lookup"><span data-stu-id="281fd-122">Prompts for user input are a potential source of problems for client/server applications.</span></span> <span data-ttu-id="281fd-123">例如，如果服務呼叫 [**MessageBox**](/windows/desktop/api/winuser/nf-winuser-messagebox) 函式，則訊息方塊會顯示在 RD 工作階段主機伺服器的桌面上，而不會顯示在用戶端桌面上。</span><span class="sxs-lookup"><span data-stu-id="281fd-123">For example, if a service calls the [**MessageBox**](/windows/desktop/api/winuser/nf-winuser-messagebox) function, the message box is displayed on the desktop of the RD Session Host server, not on the client desktop.</span></span> <span data-ttu-id="281fd-124">若要在用戶端桌面上顯示訊息，服務可以呼叫 [**WtsSendMessage**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtssendmessagea) 函數。</span><span class="sxs-lookup"><span data-stu-id="281fd-124">To display a message on a client desktop, the service can call the [**WtsSendMessage**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtssendmessagea) function.</span></span> <span data-ttu-id="281fd-125">或者，服務可以要求用戶端模組的輸入，而且用戶端模組可以顯示使用者介面，並將產生的輸入傳回服務。</span><span class="sxs-lookup"><span data-stu-id="281fd-125">Alternatively, the service can request input from the client module, and the client module can display the user interface and send the resulting input back to the service.</span></span>

<span data-ttu-id="281fd-126">從多個會話產生的進程，可以透過使用共用記憶體區塊，將資料傳送到彼此，並接收彼此的資料。</span><span class="sxs-lookup"><span data-stu-id="281fd-126">Processes spawned from multiple sessions can send data to and receive data from each other through the use of shared memory blocks.</span></span> <span data-ttu-id="281fd-127">如需詳細資訊，請參閱 [建立命名共用記憶體](/windows/desktop/Memory/creating-named-shared-memory)。</span><span class="sxs-lookup"><span data-stu-id="281fd-127">For more information, see [Creating Named Shared Memory](/windows/desktop/Memory/creating-named-shared-memory).</span></span> <span data-ttu-id="281fd-128">在下列情況下，無法使用共用記憶體：</span><span class="sxs-lookup"><span data-stu-id="281fd-128">Shared memory cannot be used under the following conditions:</span></span>

-   <span data-ttu-id="281fd-129">使用共用記憶體區塊的處理常式是由多個會話所產生。</span><span class="sxs-lookup"><span data-stu-id="281fd-129">The processes using the shared memory block were spawned by multiple sessions.</span></span>
-   <span data-ttu-id="281fd-130">這些會話會共用相同的使用者驗證認證。</span><span class="sxs-lookup"><span data-stu-id="281fd-130">The sessions share the same user authentication credential.</span></span>

 

 