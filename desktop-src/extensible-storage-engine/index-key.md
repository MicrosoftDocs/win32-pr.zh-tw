---
description: 深入瞭解：索引鍵
title: 索引鍵
TOCTitle: Index Key
ms:assetid: 104bdb1c-71ac-44f4-bbda-c553131aaad4
ms:mtpsurl: https://msdn.microsoft.com/library/Gg269188(v=EXCHG.10)
ms:contentKeyID: 32765491
ms.date: 04/11/2016
ms.topic: article
ms.openlocfilehash: eff0812f363fa83d133ab087140d415d8e2dbad3
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104568683"
---
# <a name="index-key"></a><span data-ttu-id="e0f77-103">索引鍵</span><span class="sxs-lookup"><span data-stu-id="e0f77-103">Index Key</span></span>


<span data-ttu-id="e0f77-104">_**適用于：** Windows |Windows Server_</span><span class="sxs-lookup"><span data-stu-id="e0f77-104">_**Applies to:** Windows | Windows Server_</span></span>

## <a name="index-key"></a><span data-ttu-id="e0f77-105">索引鍵</span><span class="sxs-lookup"><span data-stu-id="e0f77-105">Index Key</span></span>

<span data-ttu-id="e0f77-106">建立索引時，會在具有[JetCreateIndex](./jetcreateindex-function.md)的資料表中建立資料，或使用[JET_INDEXCREATE](./jet-indexcreate-structure.md)結構，同時建立多個索引與[JetCreateIndex2](./jetcreateindex2-function.md) 。</span><span class="sxs-lookup"><span data-stu-id="e0f77-106">An index is created over data in the table with [JetCreateIndex](./jetcreateindex-function.md) or multiple indexes may be created simultaneously with [JetCreateIndex2](./jetcreateindex2-function.md) using the [JET_INDEXCREATE](./jet-indexcreate-structure.md) structure.</span></span> <span data-ttu-id="e0f77-107">索引是以依優先順序排列的資料行陣列來定義。</span><span class="sxs-lookup"><span data-stu-id="e0f77-107">The index is defined in terms of an array of columns, in precedence order.</span></span> <span data-ttu-id="e0f77-108">此資料行的陣列也稱為索引鍵。</span><span class="sxs-lookup"><span data-stu-id="e0f77-108">This array of columns is also called the index key.</span></span> <span data-ttu-id="e0f77-109">當在 [JetCreateIndex](./jetcreateindex-function.md)或 [JET_INDEXCREATE](./jet-indexcreate-structure.md)的 *grbit* 參數中設定 JET_bitIndexPrimary 選項時，索引鍵可能會定義為主要索引。</span><span class="sxs-lookup"><span data-stu-id="e0f77-109">The index key may be defined as the primary index when the JET_bitIndexPrimary option is set in the *grbit* parameter of [JetCreateIndex](./jetcreateindex-function.md) or [JET_INDEXCREATE](./jet-indexcreate-structure.md).</span></span> <span data-ttu-id="e0f77-110">索引鍵是 null 終止權杖的 null 結束字串，如下列範例所示：</span><span class="sxs-lookup"><span data-stu-id="e0f77-110">The index key is a null terminated string of null terminated tokens as shown in the following example:</span></span>

<span data-ttu-id="e0f77-111">\+Col1 \\ 0-Col2 \\ 0 + Col3 \\ 0 \\ 0</span><span class="sxs-lookup"><span data-stu-id="e0f77-111">\+Col1\\0-Col2\\0+Col3\\0\\0</span></span>

<span data-ttu-id="e0f77-112">您可以使用範例中的索引鍵，在資料表中的三個數據行上建立索引。</span><span class="sxs-lookup"><span data-stu-id="e0f77-112">The key in the example may be used to create an index over three columns in the table.</span></span> <span data-ttu-id="e0f77-113">索引中指定的每個資料行都稱為「索引區段」或「索引鍵資料行」。</span><span class="sxs-lookup"><span data-stu-id="e0f77-113">Each column specified in the index is referred to as the "index segment" or "key column".</span></span> <span data-ttu-id="e0f77-114">索引區段可能是遞增或遞減的順序貢獻。</span><span class="sxs-lookup"><span data-stu-id="e0f77-114">The index segment may be either ascending or descending in terms of its ordering contribution.</span></span> <span data-ttu-id="e0f77-115">在上述範例中，索引中第一個資料行的名稱是 Col1。</span><span class="sxs-lookup"><span data-stu-id="e0f77-115">In the example above, the name of the first column in the index is Col1.</span></span> <span data-ttu-id="e0f77-116">+ 表示 Col1 以遞增順序編制索引。</span><span class="sxs-lookup"><span data-stu-id="e0f77-116">The + indicates that Col1 is indexed in ascending order.</span></span> <span data-ttu-id="e0f77-117">–之前的 Col2 表示以遞減順序編制索引。</span><span class="sxs-lookup"><span data-stu-id="e0f77-117">The – before Col2 indicates that it is indexed in descending order.</span></span>

<span data-ttu-id="e0f77-118">當索引中出現條件資料行時，會使用 [JET_CONDITIONALCOLUMN](./jet-conditionalcolumn-structure.md) 結構來指出如何編制索引。</span><span class="sxs-lookup"><span data-stu-id="e0f77-118">When conditional columns are present in the index, the [JET_CONDITIONALCOLUMN](./jet-conditionalcolumn-structure.md) structure is used to indicate how they are indexed.</span></span> <span data-ttu-id="e0f77-119">條件式資料行可用來根據對應的條件式資料行中的值，控制索引中的索引項目目是否存在，而不會影響索引的排序次序。</span><span class="sxs-lookup"><span data-stu-id="e0f77-119">A conditional column may be used to control the presence or absence of an index entry in an index based on the value in the corresponding conditional column without affecting the sort order of the index.</span></span> <span data-ttu-id="e0f77-120">如果對應記錄的條件式資料行值為 Null，條件資料行可能會包含或排除索引中的索引項目。</span><span class="sxs-lookup"><span data-stu-id="e0f77-120">A conditional column may include or exclude an index entry from the index if the value of that conditional column is NULL for the corresponding record.</span></span>

<span data-ttu-id="e0f77-121">根據預設，索引鍵的大小上限是由 JET_cbKeyMost 常數所提供，其一律為255位元組的正規化資料 (位元組的資料，包括編制索引的額外負荷) 。</span><span class="sxs-lookup"><span data-stu-id="e0f77-121">By default, the maximum size of the index key is given by the JET_cbKeyMost constant which has always been 255 bytes of normalized data (bytes of data including the indexing overhead).</span></span> <span data-ttu-id="e0f77-122">從 Windows Vista 開始，可以使用 [JET_INDEXCREATE](./jet-indexcreate-structure.md) 結構來設定索引鍵的大小上限。</span><span class="sxs-lookup"><span data-stu-id="e0f77-122">Starting with Windows Vista, the maximum size of the index key can be set with the [JET_INDEXCREATE](./jet-indexcreate-structure.md) structure.</span></span> <span data-ttu-id="e0f77-123">索引鍵的大小上限會對應到資料庫頁面大小。</span><span class="sxs-lookup"><span data-stu-id="e0f77-123">The maximum size of the index key corresponds to the database page size.</span></span> <span data-ttu-id="e0f77-124">若要啟用自訂的最大索引鍵大小，請在 [JET_INDEXCREATE](./jet-indexcreate-structure.md)的 grbits 成員中指定 Jet_bitIndexKeyMost 選項，然後將 **cbKeyMost** 成員設定為下列其中一個值：</span><span class="sxs-lookup"><span data-stu-id="e0f77-124">To enable a custom maximum key size, specify the Jet_bitIndexKeyMost option in the grbits member of [JET_INDEXCREATE](./jet-indexcreate-structure.md), and set the **cbKeyMost** member to one of the following values:</span></span>

  - <span data-ttu-id="e0f77-125">JET_cbKeyMost2KBytePage：當資料庫頁面大小為2048個位元組時，最大的索引鍵大小可介於255個位元組之間，最大可達500個位元組。</span><span class="sxs-lookup"><span data-stu-id="e0f77-125">JET_cbKeyMost2KBytePage: When the database page size is 2048 bytes, the maximum index key size can be between 255 bytes minimum, and 500 bytes maximum.</span></span>

  - <span data-ttu-id="e0f77-126">JET_cbKeyMost4KBytePage：當資料庫頁面大小為4096個位元組時，最大的索引鍵大小可介於255個位元組之間，最大可達1000個位元組。</span><span class="sxs-lookup"><span data-stu-id="e0f77-126">JET_cbKeyMost4KBytePage: When the database page size is 4096 bytes, the maximum index key size can be between 255 bytes minimum, and 1000 bytes maximum.</span></span>

  - <span data-ttu-id="e0f77-127">JET_cbKeyMost8KBytePage：當資料庫頁面大小為8196個位元組時，最大的索引鍵大小可介於255個位元組之間，最大可達2000個位元組。</span><span class="sxs-lookup"><span data-stu-id="e0f77-127">JET_cbKeyMost8KBytePage: When the database page size is 8196 bytes, the maximum index key size can be between 255 bytes minimum, and 2000 bytes maximum.</span></span>

<span data-ttu-id="e0f77-128">下圖中的範例顯示包含員工資訊的資料表。</span><span class="sxs-lookup"><span data-stu-id="e0f77-128">The example in the diagram below shows a table containing employee information.</span></span> <span data-ttu-id="e0f77-129">資料表有6個數據行，每個資料行都定義了特定的 employee 屬性。</span><span class="sxs-lookup"><span data-stu-id="e0f77-129">The table has 6 columns, each defining a specific employee attribute.</span></span> <span data-ttu-id="e0f77-130">資料表中的記錄包含員工的值，例如資料行1中的員工名稱和資料行2中的員工識別碼。</span><span class="sxs-lookup"><span data-stu-id="e0f77-130">A record in the table contains values for an employee, such as the employee name in column 1 and employee ID in column 2.</span></span> <span data-ttu-id="e0f77-131">針對此資料表所建立的主要索引會根據員工名稱和員工識別碼（第二個）來組織資料。</span><span class="sxs-lookup"><span data-stu-id="e0f77-131">A primary index created for this table organizes the data according to the employee name first, and the employee ID second.</span></span> <span data-ttu-id="e0f77-132">名稱和識別碼都會以遞增的順序編制索引。</span><span class="sxs-lookup"><span data-stu-id="e0f77-132">Both name and ID are indexed in ascending order.</span></span> <span data-ttu-id="e0f77-133">例如，包含名稱 Johnson 和員工識別碼12345的記錄會列在具有員工名稱的記錄之前，識別碼為10000。</span><span class="sxs-lookup"><span data-stu-id="e0f77-133">For example, a record containing the name Johnson and employee ID 12345 will be listed before of a record with an employee name Jones and an ID of 10000.</span></span> <span data-ttu-id="e0f77-134">所有的放置記錄都會一起儲存在資料表中，其員工識別碼的遞增順序如下表所示。</span><span class="sxs-lookup"><span data-stu-id="e0f77-134">All the records for Jones are stored together in the table, with their employee IDs in ascending order as shown in the table.</span></span>

<span data-ttu-id="e0f77-135">![ESE_Documentation_IndexTable](images/Gg269188.ESE_Documentation_IndexTable(EXCHG.10).gif "ESE_Documentation_IndexTable")</span><span class="sxs-lookup"><span data-stu-id="e0f77-135">![ESE_Documentation_IndexTable](images/Gg269188.ESE_Documentation_IndexTable(EXCHG.10).gif "ESE_Documentation_IndexTable")</span></span>

<span data-ttu-id="e0f77-136">主要索引中的索引鍵必須是唯一的，但次要索引中的索引鍵可能是重複的。</span><span class="sxs-lookup"><span data-stu-id="e0f77-136">The key in the primary index must be unique, but the keys in the secondary index can be duplicates.</span></span> <span data-ttu-id="e0f77-137">例如，如果索引是以姓氏建立的，而且資料庫中有兩個使用者 Stevens，則當應用程式嘗試插入第二個 "Stevens" 時，ESE 會從 [JetUpdate](./jetupdate-function.md) 或 [JetUpdate2](./jetupdate2-function.md)傳回 Jet_errKeyDuplicate 錯誤。</span><span class="sxs-lookup"><span data-stu-id="e0f77-137">For example, if an index is created over last name, and there are two people with Stevens in the database, ESE returns a Jet_errKeyDuplicate error from [JetUpdate](./jetupdate-function.md) or [JetUpdate2](./jetupdate2-function.md), when the application attempts to insert the second "Stevens".</span></span> <span data-ttu-id="e0f77-138">當實際索引鍵大於最大金鑰大小時，就會截斷金鑰。</span><span class="sxs-lookup"><span data-stu-id="e0f77-138">When the actual key is larger than the maximum key size, the key is truncated.</span></span> <span data-ttu-id="e0f77-139">搜尋和唯一性的主要截斷效果，應該由應用程式管理。</span><span class="sxs-lookup"><span data-stu-id="e0f77-139">Key truncation effects searching and uniqueness and should be managed by the application.</span></span> <span data-ttu-id="e0f77-140">例如，如果 "Stevens" 和 "Stevenson" 儲存于姓氏的索引中，而最大金鑰大小太小，無法儲存 "Stevenson" 的 "on" 部分，則金鑰截斷會導致資料庫引擎宣告 "Stevens" 和 "Stevenson" 是重複的，即使它們不是也是一樣。</span><span class="sxs-lookup"><span data-stu-id="e0f77-140">For example, if "Stevens" and "Stevenson" were stored in an index over last name and the max key size were too small to store the "on" portion of "Stevenson" then key truncation would result in the database engine declaring that "Stevens" and "Stevenson" are duplicates even though they are not.</span></span> <span data-ttu-id="e0f77-141">如果索引定義和它所編制索引的資料行值都是可能的，應用程式必須準備好在搜尋和更新期間處理這類案例。</span><span class="sxs-lookup"><span data-stu-id="e0f77-141">The application must be prepared to handle cases like this during search and update if the index definition and the column values it indexes are such that key truncation is a possibility.</span></span> <span data-ttu-id="e0f77-142">從 Windows Vista 開始，應用程式可以在 [JET_INDEXCREATE](./jet-indexcreate-structure.md) 或 [JetMakeKey](./jetmakekey-function.md)中指定 Jet_bitIndexDisallowTruncation 選項。</span><span class="sxs-lookup"><span data-stu-id="e0f77-142">Starting in Windows Vista, applications can specify the Jet_bitIndexDisallowTruncation option in [JET_INDEXCREATE](./jet-indexcreate-structure.md) or [JetMakeKey](./jetmakekey-function.md).</span></span> <span data-ttu-id="e0f77-143">指定此旗標會導致索引的任何更新會導致截斷的金鑰因 JET_errKeyTruncated 而失敗。</span><span class="sxs-lookup"><span data-stu-id="e0f77-143">Specifying this flag will cause any update to the index that would result in a truncated key to fail with JET_errKeyTruncated.</span></span> <span data-ttu-id="e0f77-144">否則，將會以無訊息方式截斷金鑰。</span><span class="sxs-lookup"><span data-stu-id="e0f77-144">Otherwise, keys will be silently truncated.</span></span> <span data-ttu-id="e0f77-145">這可讓應用程式在不考慮先前所述的金鑰截斷所造成的成品的情況下運作。</span><span class="sxs-lookup"><span data-stu-id="e0f77-145">This will allow the application to function without concern for the artifacts caused by key truncation that were previously described.</span></span>
