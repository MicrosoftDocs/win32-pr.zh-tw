---
title: IPropertySetStorage-Compound 檔案的執行
description: COM 複合檔案儲存體物件的執行包含兩個 IPropertyStorage 的實部：管理單一持續性屬性集的介面，以及管理持續性屬性集群組的介面 IPropertySetStorage。
ms.assetid: de2cb778-c6eb-4487-996b-87405674f603
keywords:
- IPropertySetStorage Strctd Stg.、執行、複合檔案
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9053a7cf6bf1ae7e4230b15eb0117c428acb08da
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/20/2020
ms.locfileid: "103682803"
---
# <a name="ipropertysetstorage-compound-file-implementation"></a><span data-ttu-id="9b6f6-104">IPropertySetStorage-Compound 檔案的執行</span><span class="sxs-lookup"><span data-stu-id="9b6f6-104">IPropertySetStorage-Compound File Implementation</span></span>

<span data-ttu-id="9b6f6-105">[COM 複合檔案儲存體物件的執行](ipropertystorage-compound-file-implementation.md)包含兩個 [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage)的實部：管理單一持續性屬性集的介面，以及管理持續性屬性集群組的介面 [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage)。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-105">The [COM compound file storage object implementation](ipropertystorage-compound-file-implementation.md) includes an implementation of both [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage), the interface that manages a single persistent property set, and [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage), the interface that manages groups of persistent property sets.</span></span>

<span data-ttu-id="9b6f6-106">若要取得 [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage)的複合檔案執行指標，請將識別碼 IID IStorage 的標頭定義名稱指定 \_ 為 *riid* 參數，或使用 [**StgCreateStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex) 或 [**StgOpenStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex) 函數。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-106">To get a pointer to the compound file implementation of [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage), specify the header-defined name for the identifier IID\_IStorage as the *riid* parameter, or use the [**StgCreateStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex) or [**StgOpenStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex) functions.</span></span> <span data-ttu-id="9b6f6-107">在這兩種情況下，請 \_ 將 STGFMT 儲存體指定為 *STGFMT* 參數。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-107">In both cases, specify STGFMT\_STORAGE as the *stgfmt* parameter.</span></span> <span data-ttu-id="9b6f6-108"> (STGFMT \_ ，也可以在 **StgOpenStorageEx** 的情況下指定任何。 ) 此外，也請將介面識別碼 (iid) iid IPropertySetStorage 的標頭定義名稱指定 \_ 為 *riid* 參數。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-108">(STGFMT\_ANY can alternatively be specified in the case of **StgOpenStorageEx**.) Also, specify the header-defined name for the interface identifier (IID) IID\_IPropertySetStorage as the *riid* parameter.</span></span> <span data-ttu-id="9b6f6-109">這兩個函數都會提供物件 **IPropertySetStorage** 介面的指標。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-109">Both functions supply a pointer to the object **IPropertySetStorage** interface.</span></span>

<span data-ttu-id="9b6f6-110">另一種取得複合檔案執行指標的方式，就是將識別碼 IID IStorage 的標頭定義名稱指定 \_ 為 *riid* 參數，或使用 [**StgCreateDocfile**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatedocfile) 或 [**StgOpenStorage**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorage) 函數。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-110">Another way to get a pointer to the compound file implementation is to specify the header-defined name for the identifier IID\_IStorage as the *riid* parameter, or to use the [**StgCreateDocfile**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatedocfile) or [**StgOpenStorage**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorage) functions.</span></span> <span data-ttu-id="9b6f6-111">這會提供物件 [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) 介面的指標。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-111">This will supply a pointer to the object [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) interface.</span></span> <span data-ttu-id="9b6f6-112">當您想要處理持續性屬性集時，請呼叫 [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage)介面的 [**IStorage：： QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) 。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-112">When you want to deal with persistent property sets, call [**IStorage::QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) for the [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) interface.</span></span>

## <a name="when-to-use-ipropertysetstorage"></a><span data-ttu-id="9b6f6-113">使用 IPropertySetStorage 的時機</span><span class="sxs-lookup"><span data-stu-id="9b6f6-113">When to Use IPropertySetStorage</span></span>

<span data-ttu-id="9b6f6-114">呼叫 [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) 的方法，以建立、開啟或刪除目前複合檔案屬性集儲存區中的屬性集。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-114">Call the methods of [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) to create, open, or delete property sets in the current compound-file property set storage.</span></span> <span data-ttu-id="9b6f6-115">另外還有一個方法 [**IPropertySetStorage：： Enum**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-enum)，它會提供列舉值的指標，可用來列舉儲存區中的屬性集。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-115">There is also a method, [**IPropertySetStorage::Enum**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-enum), that supplies a pointer to an enumerator that can be used to enumerate the property sets in the storage.</span></span>

## <a name="methods"></a><span data-ttu-id="9b6f6-116">方法</span><span class="sxs-lookup"><span data-stu-id="9b6f6-116">Methods</span></span>

[<span data-ttu-id="9b6f6-117">**IPropertySetStorage：： Create**</span><span class="sxs-lookup"><span data-stu-id="9b6f6-117">**IPropertySetStorage::Create**</span></span>](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create)

<span data-ttu-id="9b6f6-118">在目前的複合檔案儲存體中建立新的屬性集，並在傳回時提供介面指標給 [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) 的複合檔案執行。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-118">Creates a new property set in the current compound file storage and, on return, supplies an interface pointer to the [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) compound-file implementation.</span></span> <span data-ttu-id="9b6f6-119">在這個執行中，只有在指定 PROPSETFLAG 簡單時，才可以交易屬性集 \_ 。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-119">In this implementation, property sets may be transacted only if PROPSETFLAG\_NONSIMPLE is specified.</span></span> <span data-ttu-id="9b6f6-120">這個方法要求 *grfMode* 參數中指定的共用模式必須是 STGM \_ 共用 \_ 專屬，而且存取模式是 STGM \_ READ 或 STGM \_ READWRITE (STGM \_ 寫入模式不支援) 。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-120">This method requires that the sharing mode specified in the *grfMode* parameter be STGM\_SHARE\_EXCLUSIVE, and that the access mode be either STGM\_READ or STGM\_READWRITE (STGM\_WRITE mode is not supported).</span></span>

[<span data-ttu-id="9b6f6-121">**IPropertySetStorage：： Open**</span><span class="sxs-lookup"><span data-stu-id="9b6f6-121">**IPropertySetStorage::Open**</span></span>](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open)

<span data-ttu-id="9b6f6-122">開啟目前屬性儲存區中的現有屬性集。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-122">Opens an existing property set in the current property storage.</span></span> <span data-ttu-id="9b6f6-123">傳回時，它會提供 [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage)的複合檔案執行介面指標。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-123">On return, it supplies an interface pointer to the compound file implementation of [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage).</span></span> <span data-ttu-id="9b6f6-124">這個方法需要在 *grfMode* 參數中指定的共用模式必須是 STGM \_ 共用 \_ 專屬的，而且存取模式是 STGM \_ READ 或 STGM \_ READWRITE (STGM \_ WRITE 不支援) 。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-124">This method requires that the sharing mode specified in the *grfMode* parameter be STGM\_SHARE\_EXCLUSIVE, and that the access mode be either STGM\_READ or STGM\_READWRITE (STGM\_WRITE is not supported).</span></span>

[<span data-ttu-id="9b6f6-125">**IPropertySetStorage：:D elete**</span><span class="sxs-lookup"><span data-stu-id="9b6f6-125">**IPropertySetStorage::Delete**</span></span>](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-delete)

<span data-ttu-id="9b6f6-126">刪除這個屬性儲存體中設定的屬性。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-126">Deletes a property set in this property storage.</span></span>

[<span data-ttu-id="9b6f6-127">**IPropertySetStorage：： Enum**</span><span class="sxs-lookup"><span data-stu-id="9b6f6-127">**IPropertySetStorage::Enum**</span></span>](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-enum)

<span data-ttu-id="9b6f6-128">建立用來列舉 [**STATPROPSETSTG**](/windows/win32/api/propidlbase/nn-propidlbase-ienumstatpropsetstg) 結構的物件。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-128">Creates an object used to enumerate [**STATPROPSETSTG**](/windows/win32/api/propidlbase/nn-propidlbase-ienumstatpropsetstg) structures.</span></span> <span data-ttu-id="9b6f6-129">每個 **STATPROPSETSTG** 結構都會提供單一屬性集的相關資料。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-129">Each **STATPROPSETSTG** structure provides data about a single property set.</span></span>

## <a name="remarks"></a><span data-ttu-id="9b6f6-130">備註</span><span class="sxs-lookup"><span data-stu-id="9b6f6-130">Remarks</span></span>

<span data-ttu-id="9b6f6-131">從 Windows 2000 開始， [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) 的複合檔案執行支援簡單模式。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-131">Starting with Windows 2000, the compound-file implementation of [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) supports simple mode.</span></span> <span data-ttu-id="9b6f6-132">藉由為 \_ [**StgCreateStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex) 和 [**STGOPENSTORAGEEX**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex) 函式指定 STGM simple 旗標，即可指出簡單模式。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-132">Simple mode is indicated by specifying the STGM\_SIMPLE flag for the [**StgCreateStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex) and [**StgOpenStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex) functions.</span></span> <span data-ttu-id="9b6f6-133">如果複合檔案是在簡單模式中開啟，則相關聯的 **IPropertySetStorage** 執行會受到限制，如下所示：</span><span class="sxs-lookup"><span data-stu-id="9b6f6-133">If the compound file is opened in simple mode, the associated **IPropertySetStorage** implementation is limited as follows:</span></span>

-   <span data-ttu-id="9b6f6-134">只能建立簡單的屬性集。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-134">Only simple property sets can be created.</span></span> <span data-ttu-id="9b6f6-135">也就是說， \_ 在 [**IPropertySetStorage：： Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create)方法的 *GRFFLAGS* 參數中指定 PROPSETFLAG 簡單值會導致錯誤。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-135">That is, specifying the PROPSETFLAG\_NONSIMPLE value in the *grfFlags* parameter for the [**IPropertySetStorage::Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create) method results in an error.</span></span>
-   <span data-ttu-id="9b6f6-136">使用 STGM SIMPLE 和 query for IPropertySetStorage 介面建立具有 [**StgCreateStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex)的複合檔案之後 \_ ，您只能呼叫 [](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) [**IPropertySetStorage：： create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create)一次。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-136">After you create a compound file with [**StgCreateStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex) using STGM\_SIMPLE and query for the [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) interface, you can only call [**IPropertySetStorage::Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create) once.</span></span> <span data-ttu-id="9b6f6-137">然後，您必須先釋放 [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) 介面，再呼叫 **Create** 方法。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-137">Then you must release the [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) interface before calling the **Create** method again.</span></span> <span data-ttu-id="9b6f6-138">如需簡單模式的詳細資訊，請參閱 [**STGM 常數**](stgm-constants.md)。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-138">For more information about simple mode, see [**STGM Constants**](stgm-constants.md).</span></span>
-   <span data-ttu-id="9b6f6-139">使用 [**StgCreateStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex)建立儲存物件之後，就無法使用 [**IPropertySetStorage：： open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open)方法來開啟屬性集。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-139">You cannot use the [**IPropertySetStorage::Open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open) method to open a property set after using [**StgCreateStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex) to create the storage object.</span></span> <span data-ttu-id="9b6f6-140">相反地，您必須先使用 [**StgOpenStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex) ，然後再查詢 [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) 和呼叫 **Open** 方法。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-140">Instead you must use [**StgOpenStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex) before querying for [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) and calling the **Open** method.</span></span>
-   <span data-ttu-id="9b6f6-141">當您使用 STGM SIMPLE 旗標並查詢 IPropertySetStorage 介面開啟具有 [**StgOpenStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex)的複合檔案之後 \_ ，您可以使用 [**IPropertySetStorage：： open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open)，一次開啟一個屬性集。 [](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage)</span><span class="sxs-lookup"><span data-stu-id="9b6f6-141">After you open a compound file with [**StgOpenStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex) using the STGM\_SIMPLE flag and query for the [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) interface, you can open one property set at a time using [**IPropertySetStorage::Open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open).</span></span> <span data-ttu-id="9b6f6-142">此外，當屬性集開啟時，屬性集的總大小可能不會增加。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-142">Also, it may not be possible for the total size of the property set to be increased while the property set is open.</span></span>

<span data-ttu-id="9b6f6-143">無法交易簡單的屬性集。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-143">Simple property sets cannot be transacted.</span></span> <span data-ttu-id="9b6f6-144">\_除非您同時在 [](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create) [](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open) \_ *grfFlags* 參數中指定 PROPSETFLAG 簡單，否則無法在 Create 和 Open 方法的 grfmode 參數中指定 STGM 交易。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-144">You cannot specify STGM\_TRANSACTED in the *grfmode* parameter of the [**Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create) and [**Open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open) methods unless you also specify PROPSETFLAG\_NONSIMPLE in the *grfFlags* parameter.</span></span> <span data-ttu-id="9b6f6-145">請注意，簡單且非簡單的屬性集與上述的簡單模式屬性集無關。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-145">Be aware that simple and non-simple property sets are unrelated to the simple-mode property sets described above.</span></span> <span data-ttu-id="9b6f6-146">如需簡單和簡單屬性集的詳細資訊，請參閱 [屬性集的儲存和資料流程物件](storage-vs--stream-for-a-property-set.md)。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-146">For more information about simple and nonsimple property sets, see [Storage and Stream Objects for a Property Set](storage-vs--stream-for-a-property-set.md).</span></span>

> [!Note]  
> <span data-ttu-id="9b6f6-147">DocumentSummaryInformation 和使用者配置的屬性集會是唯一的，因為它們可能會有兩個屬性集區段。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-147">The DocumentSummaryInformation and UserDefined property sets are unique in that they may have two property set sections.</span></span> <span data-ttu-id="9b6f6-148">如需詳細資訊，請參閱 [DocumentSummaryInformation 和使用者設定的屬性集](the-documentsummaryinformation-and-userdefined-property-sets.md)。</span><span class="sxs-lookup"><span data-stu-id="9b6f6-148">For more information, see [The DocumentSummaryInformation and UserDefined Property Sets](the-documentsummaryinformation-and-userdefined-property-sets.md).</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="9b6f6-149">相關主題</span><span class="sxs-lookup"><span data-stu-id="9b6f6-149">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="9b6f6-150">IPropertyStorage-複合檔案執行</span><span class="sxs-lookup"><span data-stu-id="9b6f6-150">IPropertyStorage - Compound File Implementation</span></span>](ipropertystorage-compound-file-implementation.md)
</dt> <dt>

[<span data-ttu-id="9b6f6-151">**IPropertySetStorage**</span><span class="sxs-lookup"><span data-stu-id="9b6f6-151">**IPropertySetStorage**</span></span>](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage)
</dt> <dt>

[<span data-ttu-id="9b6f6-152">**IPropertyStorage**</span><span class="sxs-lookup"><span data-stu-id="9b6f6-152">**IPropertyStorage**</span></span>](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage)
</dt> <dt>

[<span data-ttu-id="9b6f6-153">**IStorage：： EnumElements**</span><span class="sxs-lookup"><span data-stu-id="9b6f6-153">**IStorage::EnumElements**</span></span>](/windows/desktop/api/Objidl/nf-objidl-istorage-enumelements)
</dt> <dt>

[<span data-ttu-id="9b6f6-154">**PROPSETFLAG 常數**</span><span class="sxs-lookup"><span data-stu-id="9b6f6-154">**PROPSETFLAG Constants**</span></span>](propsetflag-constants.md)
</dt> <dt>

[<span data-ttu-id="9b6f6-155">**STATPROPSETSTG**</span><span class="sxs-lookup"><span data-stu-id="9b6f6-155">**STATPROPSETSTG**</span></span>](/windows/win32/api/propidlbase/nn-propidlbase-ienumstatpropsetstg)
</dt> </dl>

 

 