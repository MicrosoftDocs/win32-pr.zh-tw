---
title: 建立並執行 StoClien 範例
description: StoClien 可與 COM 伺服器中的 COPaper 物件合作，以在 COM 複合檔案中達成繪圖的持續性儲存。
ms.assetid: bf622104-10dd-4649-88f0-e2bfb15289b1
keywords:
- 建立並執行 StoClien 範例
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6f00274293c05e21e660dc8e9448ca95946cab8a
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/16/2019
ms.locfileid: "106965977"
---
# <a name="create-and-run-stoclien-sample"></a><span data-ttu-id="15329-104">建立並執行 StoClien 範例</span><span class="sxs-lookup"><span data-stu-id="15329-104">Create and Run StoClien Sample</span></span>

<span data-ttu-id="15329-105">**StoClien** 可與 com 伺服器中的 COPaper 物件合作，以在 com 複合檔案中達成繪圖的持續性儲存。</span><span class="sxs-lookup"><span data-stu-id="15329-105">**StoClien** works in cooperation with a COPaper object in a COM server to achieve persistent storage of drawings in COM compound files.</span></span> <span data-ttu-id="15329-106">如需 COPaper 在提供給 COPaper by **StoClien** 的複合檔案中使用資料流程的詳細資訊，請參閱 [**StoServe**](structured-storage-server-sample--stoserve-.md) 範例和 STOSERVE.HTM。</span><span class="sxs-lookup"><span data-stu-id="15329-106">For more information about COPaper's use of streams in the compound file provided to COPaper by **StoClien**, see [**StoServe**](structured-storage-server-sample--stoserve-.md) sample and STOSERVE.HTM.</span></span> <span data-ttu-id="15329-107">**StoServe** 範例也涵蓋了 COPaper 的結構及其 IPaper 介面。</span><span class="sxs-lookup"><span data-stu-id="15329-107">COPaper's construction and its IPaper interface are also covered in the **StoServe** sample.</span></span>

## <a name="code-tour"></a><span data-ttu-id="15329-108">程式碼導覽</span><span class="sxs-lookup"><span data-stu-id="15329-108">Code Tour</span></span>

<span data-ttu-id="15329-109">本程式碼教學課程中涵蓋的主要主題如下：</span><span class="sxs-lookup"><span data-stu-id="15329-109">The major topics covered in this code tour are:</span></span>

-   <span data-ttu-id="15329-110">**CGuiPaper** 如何封裝 **StoClien** 的電子繪圖紙張的 GUI 行為</span><span class="sxs-lookup"><span data-stu-id="15329-110">How **CGuiPaper** encapsulates the GUI behavior of **StoClien**'s electronic drawing paper</span></span>
-   <span data-ttu-id="15329-111">**StoClien** 如何捕捉及顯示互動式繪圖活動</span><span class="sxs-lookup"><span data-stu-id="15329-111">How **StoClien** captures and displays interactive drawing activity</span></span>
-   <span data-ttu-id="15329-112">**CGuiPaper** 物件如何使用 COPaper 來記錄繪圖資料</span><span class="sxs-lookup"><span data-stu-id="15329-112">How the **CGuiPaper** object uses COPaper to record drawing data</span></span>
-   <span data-ttu-id="15329-113">IPaperSink 連接在重新繪製中的使用方式</span><span class="sxs-lookup"><span data-stu-id="15329-113">How an IPaperSink connection is used in repainting</span></span>
-   <span data-ttu-id="15329-114">CPapFile **載入** 和 **儲存** 方法如何使用複合檔案中的結構化儲存體</span><span class="sxs-lookup"><span data-stu-id="15329-114">How the CPapFile **Load** and **Save** methods use the structured storage in compound files</span></span>

<span data-ttu-id="15329-115">因為 FRECLIEN 和 CONCLIEN 範例中使用的 **CGuiBall** 類別封裝了彈跳球的行為，所以 **StoClien** 會使用 **CGuiPaper** c + + 類別來封裝電子繪圖紙的資料和 GUI 行為。</span><span class="sxs-lookup"><span data-stu-id="15329-115">As the **CGuiBall** class used in the FRECLIEN and CONCLIEN samples encapsulated the behavior of a bouncing ball, **StoClien** uses a **CGuiPaper** C++ class to encapsulate the data and GUI behavior of electronic drawing paper.</span></span>

<span data-ttu-id="15329-116">下表列出與 **StoClien** 範例相關的檔案。</span><span class="sxs-lookup"><span data-stu-id="15329-116">The following table lists the files pertinent to the **StoClien** sample.</span></span>



| <span data-ttu-id="15329-117">檔案</span><span class="sxs-lookup"><span data-stu-id="15329-117">Files</span></span>        | <span data-ttu-id="15329-118">Description</span><span class="sxs-lookup"><span data-stu-id="15329-118">Description</span></span>                                                                                                                      |
|--------------|----------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="15329-119">STOCLIEN.TXT</span><span class="sxs-lookup"><span data-stu-id="15329-119">STOCLIEN.TXT</span></span> | <span data-ttu-id="15329-120">簡短範例描述。</span><span class="sxs-lookup"><span data-stu-id="15329-120">Short sample description.</span></span>                                                                                                        |
| <span data-ttu-id="15329-121">生成</span><span class="sxs-lookup"><span data-stu-id="15329-121">MAKEFILE</span></span>     | <span data-ttu-id="15329-122">用來建立程式碼範例的一般 makefile。</span><span class="sxs-lookup"><span data-stu-id="15329-122">The generic makefile for building the code sample.</span></span>                                                                               |
| <span data-ttu-id="15329-123">STOCLIEN.H</span><span class="sxs-lookup"><span data-stu-id="15329-123">STOCLIEN.H</span></span>   | <span data-ttu-id="15329-124">**StoClien** 應用程式的 include 檔。</span><span class="sxs-lookup"><span data-stu-id="15329-124">The include file for the **StoClien** application.</span></span> <span data-ttu-id="15329-125">包含類別宣告、函數原型和資源識別碼。</span><span class="sxs-lookup"><span data-stu-id="15329-125">Contains class declarations, function prototypes, and resource identifiers.</span></span>   |
| <span data-ttu-id="15329-126">STOCLIEN.Cpp</span><span class="sxs-lookup"><span data-stu-id="15329-126">STOCLIEN.CPP</span></span> | <span data-ttu-id="15329-127">STOCLIEN.EXE 的主要執行檔。</span><span class="sxs-lookup"><span data-stu-id="15329-127">The main implementation file for STOCLIEN.EXE.</span></span> <span data-ttu-id="15329-128">具有 WinMain 和 CMainWindow 的執行，以及主功能表分派。</span><span class="sxs-lookup"><span data-stu-id="15329-128">Has WinMain and CMainWindow implementation, as well as the main menu dispatching.</span></span> |
| <span data-ttu-id="15329-129">STOCLIEN.鋼筋混凝土</span><span class="sxs-lookup"><span data-stu-id="15329-129">STOCLIEN.RC</span></span>  | <span data-ttu-id="15329-130">應用程式資源定義檔。</span><span class="sxs-lookup"><span data-stu-id="15329-130">The application resource definition file.</span></span>                                                                                        |
| <span data-ttu-id="15329-131">STOCLIEN..ICO</span><span class="sxs-lookup"><span data-stu-id="15329-131">STOCLIEN.ICO</span></span> | <span data-ttu-id="15329-132">應用程式圖示資源。</span><span class="sxs-lookup"><span data-stu-id="15329-132">The application icon resource.</span></span>                                                                                                   |
| <span data-ttu-id="15329-133">STOCLIEN.Pap</span><span class="sxs-lookup"><span data-stu-id="15329-133">STOCLIEN.PAP</span></span> | <span data-ttu-id="15329-134">應用程式的預設檔繪圖檔案。</span><span class="sxs-lookup"><span data-stu-id="15329-134">A default paper drawing file for the application.</span></span>                                                                                |
| <span data-ttu-id="15329-135">鉛筆。當前</span><span class="sxs-lookup"><span data-stu-id="15329-135">PENCIL.CUR</span></span>   | <span data-ttu-id="15329-136">用戶端視窗資料指標的鉛筆影像。</span><span class="sxs-lookup"><span data-stu-id="15329-136">A pencil image for the client window cursor.</span></span>                                                                                     |
| <span data-ttu-id="15329-137">下沉。H</span><span class="sxs-lookup"><span data-stu-id="15329-137">SINK.H</span></span>       | <span data-ttu-id="15329-138">COPaperSink COM 物件類別的類別宣告。</span><span class="sxs-lookup"><span data-stu-id="15329-138">The class declaration for the COPaperSink COM object class.</span></span>                                                                      |
| <span data-ttu-id="15329-139">下沉。Cpp</span><span class="sxs-lookup"><span data-stu-id="15329-139">SINK.CPP</span></span>     | <span data-ttu-id="15329-140">COPaperSink COM 物件類別的實檔案名。</span><span class="sxs-lookup"><span data-stu-id="15329-140">Implementation file for the COPaperSink COM object class.</span></span>                                                                        |
| <span data-ttu-id="15329-141">PAPFILE.H</span><span class="sxs-lookup"><span data-stu-id="15329-141">PAPFILE.H</span></span>    | <span data-ttu-id="15329-142">**CPapFile** c + + 類別的類別宣告。</span><span class="sxs-lookup"><span data-stu-id="15329-142">The class declaration for the **CPapFile** C++ class.</span></span>                                                                            |
| <span data-ttu-id="15329-143">PAPFILE.Cpp</span><span class="sxs-lookup"><span data-stu-id="15329-143">PAPFILE.CPP</span></span>  | <span data-ttu-id="15329-144">**CPapFile** c + + 類別的實檔案。</span><span class="sxs-lookup"><span data-stu-id="15329-144">Implementation file for the **CPapFile** C++ class.</span></span>                                                                              |
| <span data-ttu-id="15329-145">GUIPAPER.H</span><span class="sxs-lookup"><span data-stu-id="15329-145">GUIPAPER.H</span></span>   | <span data-ttu-id="15329-146">**CGuiPaper** c + + 類別的類別宣告。</span><span class="sxs-lookup"><span data-stu-id="15329-146">The class declaration for the **CGuiPaper** C++ class.</span></span>                                                                           |
| <span data-ttu-id="15329-147">GUIPAPER.Cpp</span><span class="sxs-lookup"><span data-stu-id="15329-147">GUIPAPER.CPP</span></span> | <span data-ttu-id="15329-148">**CGuiPaper** c + + 類別的實檔案。</span><span class="sxs-lookup"><span data-stu-id="15329-148">Implementation file for the **CGuiPaper** C++ class.</span></span>                                                                             |
| <span data-ttu-id="15329-149">STOCLIEN.Dsp</span><span class="sxs-lookup"><span data-stu-id="15329-149">STOCLIEN.DSP</span></span> | <span data-ttu-id="15329-150">Microsoft Visual Studio 專案檔。</span><span class="sxs-lookup"><span data-stu-id="15329-150">Microsoft Visual Studio Project file.</span></span>                                                                                            |



 

## <a name="compound-files"></a><span data-ttu-id="15329-151">複合檔案</span><span class="sxs-lookup"><span data-stu-id="15329-151">Compound Files</span></span>

<span data-ttu-id="15329-152">**StoClien** 依賴 COPaper 來記錄繪圖資料。</span><span class="sxs-lookup"><span data-stu-id="15329-152">**StoClien** relies on COPaper to record drawing data.</span></span> <span data-ttu-id="15329-153">它也依賴 COPaper 將資料儲存在複合檔案中。</span><span class="sxs-lookup"><span data-stu-id="15329-153">It also relies on COPaper to store the data in a compound file.</span></span> <span data-ttu-id="15329-154">不過，在 COM 用戶端與伺服器之間的一般人力部門中， **StoClien** 會共用檔案儲存體的部分責任。</span><span class="sxs-lookup"><span data-stu-id="15329-154">However, in a typical division of labor between COM client and server, **StoClien** shares part of the responsibility for file storage.</span></span> <span data-ttu-id="15329-155">在用戶端為容器且伺服器為内嵌物件的 COM 應用程式中，這項工作相當重要。</span><span class="sxs-lookup"><span data-stu-id="15329-155">This division of labor is important in COM applications where the client is a container and the server is an embedded object.</span></span> <span data-ttu-id="15329-156">在這種安排中，用戶端會負責建立或開啟結構化儲存體檔案，而伺服器物件則負責將該儲存體用於自己的資料儲存用途。</span><span class="sxs-lookup"><span data-stu-id="15329-156">In this arrangement, the client is responsible for creating or opening a structured storage file, while the server object is responsible for using that storage for its own data storage purposes.</span></span> <span data-ttu-id="15329-157">這可能牽涉到伺服器物件在提供給它的儲存體中建立 substorages。</span><span class="sxs-lookup"><span data-stu-id="15329-157">This may involve the server object creating substorages in the storage that is given to it.</span></span> <span data-ttu-id="15329-158">它通常涉及在儲存體中建立資料流程物件的伺服器物件。</span><span class="sxs-lookup"><span data-stu-id="15329-158">It usually involves the server object creating stream objects in the storage.</span></span> <span data-ttu-id="15329-159">COPaper 使用儲存體串流的詳細資訊請見 **StoClien** 範例。</span><span class="sxs-lookup"><span data-stu-id="15329-159">COPaper's use of storage streams is detailed in the **StoClien** sample.</span></span>

<span data-ttu-id="15329-160">[**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage)介面是由用戶端和伺服器物件用來執行檔案作業。</span><span class="sxs-lookup"><span data-stu-id="15329-160">The [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) interface is used by both client and server object to perform file operations.</span></span> <span data-ttu-id="15329-161">使用結構化儲存架構的複合檔案執行。</span><span class="sxs-lookup"><span data-stu-id="15329-161">The compound files implementation of the Structured Storage architecture is used.</span></span> <span data-ttu-id="15329-162">標準服務函數用於複合檔案的作業。</span><span class="sxs-lookup"><span data-stu-id="15329-162">Standard service functions are used for operations on compound files.</span></span> <span data-ttu-id="15329-163">例如， [**StgCreateDocfile**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatedocfile) 函式一開始會建立複合檔案，並傳回可用於操作檔案的 **IStorage** 指標。</span><span class="sxs-lookup"><span data-stu-id="15329-163">For example, the [**StgCreateDocfile**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatedocfile) function initially creates a compound file and passes back an **IStorage** pointer that can be used to manipulate the file.</span></span> <span data-ttu-id="15329-164">這個特定的函式會在 **StoClien** 中呼叫。</span><span class="sxs-lookup"><span data-stu-id="15329-164">This particular function is called in **StoClien**.</span></span> <span data-ttu-id="15329-165">它取得的 **IStorage** 介面會以參數的形式傳遞給 COPaper，以供使用。</span><span class="sxs-lookup"><span data-stu-id="15329-165">The **IStorage** interface it obtains is passed as a parameter to COPaper for its use.</span></span> <span data-ttu-id="15329-166">COPaper 物件不會自行建立或開啟複合檔案：它會使用 **IStorage** 和 [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) 介面，在提供給它的複合檔案中運作。</span><span class="sxs-lookup"><span data-stu-id="15329-166">The COPaper object does not create or open compound files on its own: It uses the **IStorage** and [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) interfaces to work in compound files that are given to it.</span></span>

<span data-ttu-id="15329-167">這些 [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) 和 [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) 介面不會在 **StoClien** 或 **StoServe** 中執行。</span><span class="sxs-lookup"><span data-stu-id="15329-167">These [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) and [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) interfaces are not implemented within **StoClien** or **StoServe**.</span></span> <span data-ttu-id="15329-168">它們是在 COM 程式庫中執行。</span><span class="sxs-lookup"><span data-stu-id="15329-168">They are implemented within the COM libraries.</span></span> <span data-ttu-id="15329-169">當取得其中一個介面的指標時，它們的方法基本上會用來做為複合檔案上操作的一組服務。</span><span class="sxs-lookup"><span data-stu-id="15329-169">When a pointer to one of these interfaces is obtained, their methods are essentially used as a set of services to operate on a compound file.</span></span>

 

 




