---
title: 尋找和載入資源
description: 本主題討論如何將資源載入記憶體中。
ms.assetid: 9e56cfdd-b365-4433-a507-a30220b4a92d
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ca9590927cad28772a6b4a5b761d74c9ebf101a6
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/19/2020
ms.locfileid: "104463000"
---
# <a name="finding-and-loading-resources"></a><span data-ttu-id="833e9-103">尋找和載入資源</span><span class="sxs-lookup"><span data-stu-id="833e9-103">Finding and Loading Resources</span></span>

<span data-ttu-id="833e9-104">使用資源之前，應用程式必須將它載入記憶體中。</span><span class="sxs-lookup"><span data-stu-id="833e9-104">Before using a resource, an application must load it into memory.</span></span> <span data-ttu-id="833e9-105">[**FindResource**](/windows/desktop/api/Winbase/nf-winbase-findresourcea)和 [**FindResourceEx**](/windows/desktop/api/Winbase/nf-winbase-findresourceexa)函數會尋找模組中的資源，並將控制碼傳回給二進位資源資料。</span><span class="sxs-lookup"><span data-stu-id="833e9-105">The [**FindResource**](/windows/desktop/api/Winbase/nf-winbase-findresourcea) and [**FindResourceEx**](/windows/desktop/api/Winbase/nf-winbase-findresourceexa) functions find a resource in a module and return a handle to the binary resource data.</span></span> <span data-ttu-id="833e9-106">**FindResource** 會依類型和名稱來尋找資源。</span><span class="sxs-lookup"><span data-stu-id="833e9-106">**FindResource** locates a resource by type and name.</span></span> <span data-ttu-id="833e9-107">**FindResourceEx** 會依類型、名稱和語言來尋找資源。</span><span class="sxs-lookup"><span data-stu-id="833e9-107">**FindResourceEx** locates the resource by type, name, and language.</span></span> <span data-ttu-id="833e9-108">本主題中的 **FindResource** 相關資訊也適用于 **FindResourceEx**。</span><span class="sxs-lookup"><span data-stu-id="833e9-108">Information about **FindResource** in this topic also applies to **FindResourceEx**.</span></span>

<span data-ttu-id="833e9-109">[**LoadResource**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadresource)函式會使用 [**FindResource**](/windows/desktop/api/Winbase/nf-winbase-findresourcea)所傳回的資源控制碼，將資源載入記憶體中。</span><span class="sxs-lookup"><span data-stu-id="833e9-109">The [**LoadResource**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadresource) function uses the resource handle returned by [**FindResource**](/windows/desktop/api/Winbase/nf-winbase-findresourcea) to load the resource into memory.</span></span> <span data-ttu-id="833e9-110">應用程式使用 **LoadResource** 載入資源之後，只有在其模組的所有參考都透過 [**FreeLibrary**](/windows/desktop/api/libloaderapi/nf-libloaderapi-freelibrary)釋放時，系統才會卸載相關聯的記憶體。</span><span class="sxs-lookup"><span data-stu-id="833e9-110">After an application loads a resource by using **LoadResource**, the system will unload the associated memory only when all references to its module are freed through [**FreeLibrary**](/windows/desktop/api/libloaderapi/nf-libloaderapi-freelibrary).</span></span> <span data-ttu-id="833e9-111">需要重複存取特定模組內相同或多個資源的應用程式，可能會因為在重複的 [**LoadLibrary**](/windows/desktop/api/libloaderapi/nf-libloaderapi-loadlibrarya) 和 **FreeLibrary** 呼叫中發生記憶體對應而導致效能受到負面影響。</span><span class="sxs-lookup"><span data-stu-id="833e9-111">Applications which need to repeatedly access the same or many resources within a particular module may incur performance penalties due to the memory mapping taking place in repeated [**LoadLibrary**](/windows/desktop/api/libloaderapi/nf-libloaderapi-loadlibrarya) and **FreeLibrary** calls.</span></span> <span data-ttu-id="833e9-112">應用程式應該儲存單一模組控制碼，直到不再需要資源，然後再呼叫 **FreeLibrary**。</span><span class="sxs-lookup"><span data-stu-id="833e9-112">Applications should store a single module handle until resources are no longer needed, and then call **FreeLibrary**.</span></span> <span data-ttu-id="833e9-113">從記憶體卸載模組之後，資源控制碼會變成無效。</span><span class="sxs-lookup"><span data-stu-id="833e9-113">After a module is unloaded from memory, resource handles become invalid.</span></span>

<span data-ttu-id="833e9-114">應用程式可以使用 [**FindResource**](/windows/desktop/api/Winbase/nf-winbase-findresourcea) 和 [**LoadResource**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadresource) 來尋找和載入任何類型的資源，但是這些函式只能在下列其中一種情況下使用：</span><span class="sxs-lookup"><span data-stu-id="833e9-114">An application can use [**FindResource**](/windows/desktop/api/Winbase/nf-winbase-findresourcea) and [**LoadResource**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadresource) to find and load any type of resource, but these functions should be used only in one of these situations:</span></span>

-   <span data-ttu-id="833e9-115">當應用程式無法使用現有的資源特定功能來存取資源時。</span><span class="sxs-lookup"><span data-stu-id="833e9-115">When the application cannot access the resource by using an existing resource-specific function.</span></span>
-   <span data-ttu-id="833e9-116">當應用程式必須以二進位資料的形式存取資源，以進行後續的函式呼叫。</span><span class="sxs-lookup"><span data-stu-id="833e9-116">When the application must access the resource as binary data for subsequent function calls.</span></span>

<span data-ttu-id="833e9-117">如果可能的話，應用程式應該改為使用下列其中一個資源特定的函式，在一個呼叫中尋找和載入資源：</span><span class="sxs-lookup"><span data-stu-id="833e9-117">Whenever possible, an application should instead use one of the following resource-specific functions to find and load resources in one call:</span></span>



| <span data-ttu-id="833e9-118">函式</span><span class="sxs-lookup"><span data-stu-id="833e9-118">Function</span></span>                                     | <span data-ttu-id="833e9-119">動作</span><span class="sxs-lookup"><span data-stu-id="833e9-119">Action</span></span>                                   | <span data-ttu-id="833e9-120">移除資源</span><span class="sxs-lookup"><span data-stu-id="833e9-120">To remove resource</span></span>                                                                                               |
|----------------------------------------------|------------------------------------------|------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="833e9-121">**FormatMessage**</span><span class="sxs-lookup"><span data-stu-id="833e9-121">**FormatMessage**</span></span>](/windows/desktop/api/winbase/nf-winbase-formatmessage)      | <span data-ttu-id="833e9-122">載入並格式化訊息資料表專案。</span><span class="sxs-lookup"><span data-stu-id="833e9-122">Loads and formats a message-table entry.</span></span> | <span data-ttu-id="833e9-123">不需採取動作。</span><span class="sxs-lookup"><span data-stu-id="833e9-123">No action needed.</span></span>                                                                                                |
| [<span data-ttu-id="833e9-124">**LoadAccelerators**</span><span class="sxs-lookup"><span data-stu-id="833e9-124">**LoadAccelerators**</span></span>](/windows/desktop/api/Winuser/nf-winuser-loadacceleratorsa) | <span data-ttu-id="833e9-125">載入快速鍵對應表。</span><span class="sxs-lookup"><span data-stu-id="833e9-125">Loads an accelerator table.</span></span>              | [<span data-ttu-id="833e9-126">**DestroyAcceleratorTable**</span><span class="sxs-lookup"><span data-stu-id="833e9-126">**DestroyAcceleratorTable**</span></span>](/windows/desktop/api/Winuser/nf-winuser-destroyacceleratortable)                                                       |
| [<span data-ttu-id="833e9-127">**LoadBitmap**</span><span class="sxs-lookup"><span data-stu-id="833e9-127">**LoadBitmap**</span></span>](/windows/desktop/api/winuser/nf-winuser-loadbitmapa)             | <span data-ttu-id="833e9-128">載入點陣圖資源。</span><span class="sxs-lookup"><span data-stu-id="833e9-128">Loads a bitmap resource.</span></span>                 | [<span data-ttu-id="833e9-129">**DeleteObject**</span><span class="sxs-lookup"><span data-stu-id="833e9-129">**DeleteObject**</span></span>](/windows/desktop/api/wingdi/nf-wingdi-deleteobject)                                                                             |
| [<span data-ttu-id="833e9-130">**LoadCursor**</span><span class="sxs-lookup"><span data-stu-id="833e9-130">**LoadCursor**</span></span>](/windows/desktop/api/Winuser/nf-winuser-loadcursora)             | <span data-ttu-id="833e9-131">載入資料指標資源。</span><span class="sxs-lookup"><span data-stu-id="833e9-131">Loads a cursor resource.</span></span>                 | [<span data-ttu-id="833e9-132">**DestroyCursor**</span><span class="sxs-lookup"><span data-stu-id="833e9-132">**DestroyCursor**</span></span>](/windows/desktop/api/Winuser/nf-winuser-destroycursor)                                                                           |
| [<span data-ttu-id="833e9-133">**LoadIcon**</span><span class="sxs-lookup"><span data-stu-id="833e9-133">**LoadIcon**</span></span>](/windows/desktop/api/Winuser/nf-winuser-loadicona)                 | <span data-ttu-id="833e9-134">載入圖示資源。</span><span class="sxs-lookup"><span data-stu-id="833e9-134">Loads an icon resource.</span></span>                  | [<span data-ttu-id="833e9-135">**DestroyIcon**</span><span class="sxs-lookup"><span data-stu-id="833e9-135">**DestroyIcon**</span></span>](/windows/desktop/api/Winuser/nf-winuser-destroyicon)                                                                               |
| [<span data-ttu-id="833e9-136">**LoadImage**</span><span class="sxs-lookup"><span data-stu-id="833e9-136">**LoadImage**</span></span>](/windows/desktop/api/Winuser/nf-winuser-loadimagea)               | <span data-ttu-id="833e9-137">載入圖示、游標或點陣圖。</span><span class="sxs-lookup"><span data-stu-id="833e9-137">Loads an icon, cursor, or bitmap.</span></span>        | <span data-ttu-id="833e9-138">[**DestroyIcon**](/windows/desktop/api/Winuser/nf-winuser-destroyicon)、 [**DestroyCursor**](/windows/desktop/api/Winuser/nf-winuser-destroycursor)、 [**DeleteObject**](/windows/desktop/api/wingdi/nf-wingdi-deleteobject)</span><span class="sxs-lookup"><span data-stu-id="833e9-138">[**DestroyIcon**](/windows/desktop/api/Winuser/nf-winuser-destroyicon), [**DestroyCursor**](/windows/desktop/api/Winuser/nf-winuser-destroycursor), [**DeleteObject**](/windows/desktop/api/wingdi/nf-wingdi-deleteobject)</span></span> |
| [<span data-ttu-id="833e9-139">**LoadMenu**</span><span class="sxs-lookup"><span data-stu-id="833e9-139">**LoadMenu**</span></span>](/windows/desktop/api/Winuser/nf-winuser-loadmenua)                 | <span data-ttu-id="833e9-140">載入功能表資源。</span><span class="sxs-lookup"><span data-stu-id="833e9-140">Loads a menu resource.</span></span>                   | [<span data-ttu-id="833e9-141">**DestroyMenu**</span><span class="sxs-lookup"><span data-stu-id="833e9-141">**DestroyMenu**</span></span>](/windows/desktop/api/Winuser/nf-winuser-destroymenu)                                                                               |
| [<span data-ttu-id="833e9-142">**Loadstring 時**</span><span class="sxs-lookup"><span data-stu-id="833e9-142">**LoadString**</span></span>](/windows/desktop/api/Winuser/nf-winuser-loadstringa)             | <span data-ttu-id="833e9-143">載入字串資料表專案。</span><span class="sxs-lookup"><span data-stu-id="833e9-143">Loads a string-table entry.</span></span>              | <span data-ttu-id="833e9-144">不需採取動作。</span><span class="sxs-lookup"><span data-stu-id="833e9-144">No action needed.</span></span>                                                                                                |



 

<span data-ttu-id="833e9-145">請注意上表中的發行功能。</span><span class="sxs-lookup"><span data-stu-id="833e9-145">Note the release functions in the table above.</span></span> <span data-ttu-id="833e9-146">在終止之前，應用程式應該使用適當的函式來釋出快速鍵資料表、點陣圖、游標、圖示和功能表所佔用的記憶體。</span><span class="sxs-lookup"><span data-stu-id="833e9-146">Before terminating, an application should release the memory occupied by accelerator tables, bitmaps, cursors, icons, and menus by using the appropriate functions.</span></span>

<span data-ttu-id="833e9-147">透過 [**FindResource**](/windows/desktop/api/Winbase/nf-winbase-findresourcea) 和 [**LoadResource**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadresource) 所載入之資源的相關記憶體，將會在該模組被 [**FreeLibrary**](/windows/desktop/api/libloaderapi/nf-libloaderapi-freelibrary)的呼叫卸載之後釋放。</span><span class="sxs-lookup"><span data-stu-id="833e9-147">Memory associated with resources loaded through [**FindResource**](/windows/desktop/api/Winbase/nf-winbase-findresourcea) and [**LoadResource**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadresource) will be released once the module has been unloaded by a call to [**FreeLibrary**](/windows/desktop/api/libloaderapi/nf-libloaderapi-freelibrary).</span></span> <span data-ttu-id="833e9-148">系統會自動釋放在應用程式終止時保持卸載的任何資源。</span><span class="sxs-lookup"><span data-stu-id="833e9-148">Any resources which remain unloaded at application termination will be automatically released by the system.</span></span>

 

 