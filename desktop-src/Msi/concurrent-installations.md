---
description: 並行安裝（也稱為嵌套安裝）是 Windows Installer 的已淘汰功能。
ms.assetid: 579ae4ee-47a0-440e-81ca-ea8bf60c5349
title: 並行安裝
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d89f2ef4af062c8151935fefab471603f79d7633
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "103850252"
---
# <a name="concurrent-installations"></a><span data-ttu-id="a8bce-103">並行安裝</span><span class="sxs-lookup"><span data-stu-id="a8bce-103">Concurrent Installations</span></span>

<span data-ttu-id="a8bce-104">並行安裝（也稱為嵌套安裝）是 Windows Installer 的已淘汰功能。</span><span class="sxs-lookup"><span data-stu-id="a8bce-104">Concurrent Installations, also called Nested Installations, is a deprecated feature of the Windows Installer.</span></span> <span data-ttu-id="a8bce-105">隨著並行安裝安裝的應用程式最後可能會失敗，因為客戶很難正確地服務。</span><span class="sxs-lookup"><span data-stu-id="a8bce-105">Applications installed with concurrent installations can eventually fail because they are difficult for customers to service correctly.</span></span> <span data-ttu-id="a8bce-106">請勿使用並行安裝來安裝要發行至公用的產品。</span><span class="sxs-lookup"><span data-stu-id="a8bce-106">Do not use concurrent installations to install products that are intended to be released to the public.</span></span> <span data-ttu-id="a8bce-107">當使用安裝的應用程式不適合公開發行時，並行安裝在受控制的公司環境中可能會有有限的適用性。</span><span class="sxs-lookup"><span data-stu-id="a8bce-107">Concurrent installations can have limited applicability in controlled corporate environments when used to install applications that are not intended for public release.</span></span> <span data-ttu-id="a8bce-108">並行安裝檔是針對想要將並行安裝與非公開發布的應用程式一起使用的封裝作者提供的。</span><span class="sxs-lookup"><span data-stu-id="a8bce-108">The concurrent installations documentation is provided for package authors that wish to use concurrent installations with applications that are not for public distribution.</span></span>

<span data-ttu-id="a8bce-109">同時安裝動作會在目前執行的安裝期間安裝另一個 Windows Installer 套件。</span><span class="sxs-lookup"><span data-stu-id="a8bce-109">A concurrent installation action installs another Windows Installer package during a currently running installation.</span></span> <span data-ttu-id="a8bce-110">同時安裝會新增至封裝，方法是在 [CustomAction 資料表](customaction-table.md) 中撰寫並行安裝動作，並將此自訂動作排程到順序資料表中。</span><span class="sxs-lookup"><span data-stu-id="a8bce-110">A concurrent installation is added to a package by authoring a concurrent installation action into the [CustomAction table](customaction-table.md) and scheduling this custom action into the sequence tables.</span></span> <span data-ttu-id="a8bce-111">CustomAction 資料表的目標欄位包含並行安裝所使用的公用屬性設定字串。</span><span class="sxs-lookup"><span data-stu-id="a8bce-111">The Target field of the CustomAction table contains a string of public property settings used by the concurrent installation.</span></span> <span data-ttu-id="a8bce-112">CustomAction 資料表的來源欄位會識別並行套件。</span><span class="sxs-lookup"><span data-stu-id="a8bce-112">The Source field of the CustomAction table identifies the concurrent package.</span></span> <span data-ttu-id="a8bce-113">同時安裝動作只能重新安裝或移除目前應用程式安裝套件已安裝的應用程式。</span><span class="sxs-lookup"><span data-stu-id="a8bce-113">A concurrent installation action can only reinstall or remove an application that has been installed by the current application's installation package.</span></span>

<span data-ttu-id="a8bce-114">並行安裝動作的類型是在 CustomAction 資料表的 [類型] 欄位中指定。</span><span class="sxs-lookup"><span data-stu-id="a8bce-114">The type of concurrent installation action is specified in the Type field of the CustomAction table.</span></span> <span data-ttu-id="a8bce-115">根據自訂動作類型而定，並行應用程式的封裝可以位於主要套件的 substorage 中，做為檔案在屬性指定位置的檔案，或作為使用者電腦上的公告應用程式。</span><span class="sxs-lookup"><span data-stu-id="a8bce-115">Depending upon the custom action type, the package for the concurrent application can reside in a substorage of the main package, as a file at a location specified by a property, or as an advertised application on the user's machine.</span></span> <span data-ttu-id="a8bce-116">下列自訂動作類型會執行並行安裝。</span><span class="sxs-lookup"><span data-stu-id="a8bce-116">The following types of custom actions perform a concurrent installation.</span></span>



| <span data-ttu-id="a8bce-117">自訂動作類型</span><span class="sxs-lookup"><span data-stu-id="a8bce-117">Custom action type</span></span>                                 | <span data-ttu-id="a8bce-118">Description</span><span class="sxs-lookup"><span data-stu-id="a8bce-118">Description</span></span>                                                                     |
|----------------------------------------------------|---------------------------------------------------------------------------------|
| [<span data-ttu-id="a8bce-119">自訂動作類型7</span><span class="sxs-lookup"><span data-stu-id="a8bce-119">Custom Action Type 7</span></span>](custom-action-type-7.md)   | <span data-ttu-id="a8bce-120">產品的並行安裝，位於安裝套件中。</span><span class="sxs-lookup"><span data-stu-id="a8bce-120">Concurrent installation of a product residing in the installation package.</span></span>      |
| [<span data-ttu-id="a8bce-121">自訂動作類型23</span><span class="sxs-lookup"><span data-stu-id="a8bce-121">Custom Action Type 23</span></span>](custom-action-type-23.md) | <span data-ttu-id="a8bce-122">在目前的來源樹狀結構中同時安裝安裝程式套件。</span><span class="sxs-lookup"><span data-stu-id="a8bce-122">Concurrent installation of an installer package within the current source tree.</span></span> |
| [<span data-ttu-id="a8bce-123">自訂動作類型39</span><span class="sxs-lookup"><span data-stu-id="a8bce-123">Custom Action Type 39</span></span>](custom-action-type-39.md) | <span data-ttu-id="a8bce-124">同時安裝已公告的安裝程式套件。</span><span class="sxs-lookup"><span data-stu-id="a8bce-124">Concurrent installation of an advertised installer package.</span></span>                     |



 

<span data-ttu-id="a8bce-125">並行安裝會共用與主要安裝相同的使用者介面和記錄設定。</span><span class="sxs-lookup"><span data-stu-id="a8bce-125">A concurrent installation shares the same user interface and logging settings as the main installation.</span></span>

<span data-ttu-id="a8bce-126">並行安裝動作應放置在主要安裝動作順序的 [InstallInitialize 動作](installinitialize-action.md) 和 [InstallFinalize 動作](installfinalize-action.md) 之間。</span><span class="sxs-lookup"><span data-stu-id="a8bce-126">Concurrent installation actions should be placed between the [InstallInitialize action](installinitialize-action.md) and [InstallFinalize action](installfinalize-action.md) of the main installation's action sequence.</span></span> <span data-ttu-id="a8bce-127">復原主要安裝之後，安裝程式也會復原並行安裝。</span><span class="sxs-lookup"><span data-stu-id="a8bce-127">Upon rollback of the main installation, the installer will then rollback the concurrent installation as well.</span></span> <span data-ttu-id="a8bce-128">因為安裝程式結合並行和主要安裝的復原資訊，所以不需要使用 [順延強制](deferred-execution-custom-actions.md) 搭配並行安裝動作。</span><span class="sxs-lookup"><span data-stu-id="a8bce-128">The use of [deferred execution](deferred-execution-custom-actions.md) with concurrent installation actions is unnecessary because the installer combines rollback information from the concurrent and main installations.</span></span> <span data-ttu-id="a8bce-129">復原安裝時，所有變更都會反轉。</span><span class="sxs-lookup"><span data-stu-id="a8bce-129">All changes are reversed upon a rollback installation.</span></span>

<span data-ttu-id="a8bce-130">並行安裝動作的傳回值與其他自訂動作的值相同。</span><span class="sxs-lookup"><span data-stu-id="a8bce-130">The return values for concurrent installation actions are the same as for other custom actions.</span></span> <span data-ttu-id="a8bce-131">請參閱 [自訂動作傳回值](custom-action-return-values.md)。</span><span class="sxs-lookup"><span data-stu-id="a8bce-131">See [Custom Action Return Values](custom-action-return-values.md).</span></span>

<span data-ttu-id="a8bce-132">指定自動重新開機系統，或要求使用者重新開機的標準或自訂動作，也可以從並行安裝內執行重新開機或要求。</span><span class="sxs-lookup"><span data-stu-id="a8bce-132">Standard or custom actions that specify an automatic restart of the system, or request the user to restart, can also perform restart or request from within a concurrent installation.</span></span>

<span data-ttu-id="a8bce-133">一旦安裝程式開始並行安裝，它就會鎖定所有其他安裝，直到並行安裝完成，然後再繼續主要安裝。</span><span class="sxs-lookup"><span data-stu-id="a8bce-133">Once the installer begins a concurrent installation, it locks out all other installations until the concurrent installation is complete and before continuing the main installation.</span></span> <span data-ttu-id="a8bce-134">安裝程式只能以同步的自訂動作來執行並行安裝。</span><span class="sxs-lookup"><span data-stu-id="a8bce-134">The installer can only execute concurrent installations as synchronous custom actions.</span></span> <span data-ttu-id="a8bce-135">查看 [同步和非同步自訂動作](synchronous-and-asynchronous-custom-actions.md)。</span><span class="sxs-lookup"><span data-stu-id="a8bce-135">See [Synchronous and Asynchronous Custom Actions](synchronous-and-asynchronous-custom-actions.md).</span></span> <span data-ttu-id="a8bce-136">[自訂動作傳回處理選項](custom-action-return-processing-options.md)中所述的選項旗標必須設定為 none (+ 0) 或 **msidbCustomActionTypeContinue** (+ 64) 。</span><span class="sxs-lookup"><span data-stu-id="a8bce-136">The option flags described in [Custom Action Return Processing Options](custom-action-return-processing-options.md) must be set to none (+0) or **msidbCustomActionTypeContinue** (+64).</span></span>

<span data-ttu-id="a8bce-137">並行安裝動作可以安裝要在本機執行的應用程式、從來源執行、重新安裝，或是以使用 [**MsiInstallProduct**](/windows/desktop/api/Msi/nf-msi-msiinstallproducta) 進行一般安裝時的相同方式來移除。</span><span class="sxs-lookup"><span data-stu-id="a8bce-137">A concurrent installation action can install an application to be run locally, to run from source, to be reinstalled, or to be removed in the same manner as when using [**MsiInstallProduct**](/windows/desktop/api/Msi/nf-msi-msiinstallproducta) for a regular installation.</span></span> <span data-ttu-id="a8bce-138">若要指定安裝類型，請將 [ [**ADDLOCAL**](addlocal.md)]、[ [**ADDSOURCE**](addsource.md)]、[ [**重新安裝**](reinstall.md)] 或 [ [**移除**](remove.md) ] 屬性傳遞至 [並行安裝] 動作。</span><span class="sxs-lookup"><span data-stu-id="a8bce-138">To specify the type of installation, pass either the [**ADDLOCAL**](addlocal.md), [**ADDSOURCE**](addsource.md), [**REINSTALL**](reinstall.md), or [**REMOVE**](remove.md) property to the concurrent installation action.</span></span>

<span data-ttu-id="a8bce-139">並行安裝動作可以成對撰寫，一個用於安裝的動作，還有另一個用來移除並行安裝的動作。</span><span class="sxs-lookup"><span data-stu-id="a8bce-139">Concurrent installation actions can be authored in pairs, one action used for installing and the other action used for removing the concurrent installation.</span></span> <span data-ttu-id="a8bce-140">[自訂動作類型 7](custom-action-type-7.md)或[自訂動作類型 23](custom-action-type-23.md)通常用來安裝。</span><span class="sxs-lookup"><span data-stu-id="a8bce-140">A [Custom Action Type 7](custom-action-type-7.md) or [Custom Action Type 23](custom-action-type-23.md) is typically used to install.</span></span> <span data-ttu-id="a8bce-141">[自訂動作類型 39](custom-action-type-39.md)通常用來在卸載父產品時移除並行安裝。</span><span class="sxs-lookup"><span data-stu-id="a8bce-141">A [Custom Action Type 39](custom-action-type-39.md) is typically used to remove the concurrent installation when the parent product is uninstalled.</span></span> <span data-ttu-id="a8bce-142">[CustomAction 資料表](customaction-table.md)中移除自訂動作的記錄，在來源欄位中可以有產品代碼 GUID，而在目標欄位中可以有「移除 = 全部」。</span><span class="sxs-lookup"><span data-stu-id="a8bce-142">The record for the removal custom action in the [CustomAction table](customaction-table.md) can have the product code GUID in the Source field and "REMOVE=ALL" in the Target field.</span></span> <span data-ttu-id="a8bce-143">您必須在具有互斥條件的動作順序資料表中撰寫兩個自訂動作。</span><span class="sxs-lookup"><span data-stu-id="a8bce-143">The two custom actions need to be authored in the action sequence table with mutually exclusive conditions.</span></span> <span data-ttu-id="a8bce-144">例如，安裝產品的自訂動作在其條件欄位中可能會有「未安裝」，而自訂動作會移除其條件欄位中的並行安裝可以有 REMOVE = "ALL"。</span><span class="sxs-lookup"><span data-stu-id="a8bce-144">For example, the custom action that installs the product can have "NOT Installed" in its Condition field and the custom action removes the concurrent installation can have REMOVE="ALL" in its Condition field.</span></span>

<span data-ttu-id="a8bce-145">沒有任何方法可查詢套件的成本。</span><span class="sxs-lookup"><span data-stu-id="a8bce-145">There is no method for querying a package for its cost.</span></span> <span data-ttu-id="a8bce-146">這使得並行安裝的成本變得很困難。</span><span class="sxs-lookup"><span data-stu-id="a8bce-146">This makes the costing of a concurrent installations difficult.</span></span> <span data-ttu-id="a8bce-147">您必須將資料列加入至 [ReserveCost 資料表](reservecost-table.md) ，以指出與並行安裝相關聯之元件的資料夾與最差案例成本。</span><span class="sxs-lookup"><span data-stu-id="a8bce-147">Rows must be added to the [ReserveCost table](reservecost-table.md) to indicate the folders and worst-case costs of the component associated with the concurrent install.</span></span>

<span data-ttu-id="a8bce-148">並行安裝動作唯一可用的 [自訂動作傳回處理選項](custom-action-return-processing-options.md) 為 none (+ 0) 或 **msidbCustomActionTypeContinue** (+ 64) 。</span><span class="sxs-lookup"><span data-stu-id="a8bce-148">The only [Custom Action Return Processing Options](custom-action-return-processing-options.md) available with concurrent installation actions are none (+0) or **msidbCustomActionTypeContinue** (+64).</span></span>

<span data-ttu-id="a8bce-149">請注意，父安裝無法呼叫其本身的套件作為並行安裝動作。</span><span class="sxs-lookup"><span data-stu-id="a8bce-149">Note that a parent installation cannot call its own package as a concurrent installation action.</span></span>

<span data-ttu-id="a8bce-150">請注意，如果個別電腦安裝嘗試執行個別使用者的並行安裝，則安裝程式預設會將父安裝註冊為每位使用者。</span><span class="sxs-lookup"><span data-stu-id="a8bce-150">Note that if a per-machine installation attempts to run a per-user concurrent installation, the installer registers the parent installation as per-user by default.</span></span> <span data-ttu-id="a8bce-151">這可能會導致安裝程式不正確地移除應用程式，因為安裝程式會在實際註冊為每位使用者的情況下，每一部電腦卸載應用程式。</span><span class="sxs-lookup"><span data-stu-id="a8bce-151">This can cause the installer to incorrectly remove the application because the installer attempts to uninstall the application per-machine when it is actually registered as per-user.</span></span> <span data-ttu-id="a8bce-152">若要強制並行安裝的狀態追蹤其父安裝的狀態，請 \[ \] 在 [CustomAction 資料表](customaction-table.md)的目標資料行中輸入 ALLUSERS = "allusers"。</span><span class="sxs-lookup"><span data-stu-id="a8bce-152">To force the state of a concurrent installation to track the state of its parent installation, enter ALLUSERS="\[ALLUSERS\]" in the Target column of the [CustomAction table](customaction-table.md).</span></span> <span data-ttu-id="a8bce-153">在此情況下，如果父代為每部電腦，則並行安裝為每部電腦，如果父系為每位使用者，則並行安裝為每位使用者。</span><span class="sxs-lookup"><span data-stu-id="a8bce-153">In this case, the concurrent installation is per-machine if the parent is per-machine, and the concurrent installation is per-user if the parent is per-user.</span></span>

<span data-ttu-id="a8bce-154">開發人員在撰寫並行安裝時，應該注意下列警告。</span><span class="sxs-lookup"><span data-stu-id="a8bce-154">Developers should note the following warnings when authoring concurrent installations.</span></span>

-   <span data-ttu-id="a8bce-155">並行安裝無法共用元件。</span><span class="sxs-lookup"><span data-stu-id="a8bce-155">Concurrent installations cannot share components.</span></span>
-   <span data-ttu-id="a8bce-156">系統管理安裝也不能包含並行安裝。</span><span class="sxs-lookup"><span data-stu-id="a8bce-156">An administrative installation cannot also contain a concurrent installation.</span></span>
-   <span data-ttu-id="a8bce-157">修補和升級可能無法搭配並行安裝使用。</span><span class="sxs-lookup"><span data-stu-id="a8bce-157">Patching and upgrading may not work with concurrent installations.</span></span>
-   <span data-ttu-id="a8bce-158">安裝程式可能不會正確地產生並行安裝的成本。</span><span class="sxs-lookup"><span data-stu-id="a8bce-158">The installer may not properly cost a concurrent installation.</span></span>
-   <span data-ttu-id="a8bce-159">整合式 ProgressBars 無法搭配並行安裝使用。</span><span class="sxs-lookup"><span data-stu-id="a8bce-159">Integrated ProgressBars cannot be used with concurrent installations.</span></span>
-   <span data-ttu-id="a8bce-160">並行安裝無法安裝要公告的資源。</span><span class="sxs-lookup"><span data-stu-id="a8bce-160">Resources that are to be advertised cannot be installed by the concurrent installation.</span></span>
-   <span data-ttu-id="a8bce-161">執行應用程式並行安裝的封裝，也應該在父產品卸載時卸載並行應用程式。</span><span class="sxs-lookup"><span data-stu-id="a8bce-161">A package that performs a concurrent installation of an application should also uninstall the concurrent application when the parent product is uninstalled.</span></span>

<span data-ttu-id="a8bce-162">若要防止封裝安裝為並行安裝，請將下列其中一個條件陳述式加入至 [LaunchCondition](launchcondition-table.md) 資料表。</span><span class="sxs-lookup"><span data-stu-id="a8bce-162">To prevent a package from ever being installed as a concurrent installation, add either of the following conditional statements to the [LaunchCondition](launchcondition-table.md) table.</span></span> <span data-ttu-id="a8bce-163">這可防止另一個安裝執行的並行安裝動作來安裝套件。</span><span class="sxs-lookup"><span data-stu-id="a8bce-163">This prevents the package from ever being installed by a concurrent installation action run by another installation.</span></span> <span data-ttu-id="a8bce-164">這不會防止 [RemoveExistingProducts](removeexistingproducts-action.md) 動作移除套件。</span><span class="sxs-lookup"><span data-stu-id="a8bce-164">This does not prevent the package from being removed by the [RemoveExistingProducts](removeexistingproducts-action.md) action.</span></span> <span data-ttu-id="a8bce-165">另請參閱 [**ParentOriginalDatabase**](parentoriginaldatabase.md) 屬性和 [**ParentProductCode**](parentproductcode.md) 屬性。</span><span class="sxs-lookup"><span data-stu-id="a8bce-165">See also the [**ParentOriginalDatabase**](parentoriginaldatabase.md) property and [**ParentProductCode**](parentproductcode.md) property.</span></span>

``` syntax
"Not ParentProductCode"
```

``` syntax
"Not ParentOriginalDatabase"
```

 

 



