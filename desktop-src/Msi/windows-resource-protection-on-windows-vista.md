---
description: Windows Installer 在 Windows Server 2008 和更新版本以及 Windows Vista 及更新版本中安裝基本的系統檔案、資料夾和登錄資訊時，會遵守 Windows 資源保護 (WRP) 。
ms.assetid: 38865ee1-22ef-430b-99ce-1c6983c3b51f
title: 使用 Windows Installer 和 Windows 資源保護
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 72808184ff11b29bfeb02dda576e9393e34189fd
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "103944474"
---
# <a name="using-windows-installer-and-windows-resource-protection"></a><span data-ttu-id="c5df2-103">使用 Windows Installer 和 Windows 資源保護</span><span class="sxs-lookup"><span data-stu-id="c5df2-103">Using Windows Installer and Windows Resource Protection</span></span>

<span data-ttu-id="c5df2-104">Windows Installer 在 Windows Server 2008 和更新版本以及 Windows Vista 及更新版本中安裝基本的系統檔案、資料夾和登錄資訊時，會遵守 Windows 資源保護 (WRP) 。</span><span class="sxs-lookup"><span data-stu-id="c5df2-104">Windows Installer adheres to Windows Resource Protection (WRP) when installing essential system files, folders, and registry information in Windows Server 2008 and later and Windows Vista and later.</span></span>

<span data-ttu-id="c5df2-105">Windows Server 2008 和 windows Vista 中的 WRP 取代了 windows Server 2003、Windows XP 及 Windows 2000 中的 Windows 檔案保護 (WFP) 。</span><span class="sxs-lookup"><span data-stu-id="c5df2-105">WRP in Windows Server 2008 and Windows Vista replaces Windows File Protection (WFP) in Windows Server 2003, Windows XP, and Windows 2000.</span></span> <span data-ttu-id="c5df2-106">Windows Installer 開發人員應該注意下列變更：安裝程式如何在 Windows Server 2008 和更新版本以及 Windows Vista 和更新版本中處理受保護的資源：</span><span class="sxs-lookup"><span data-stu-id="c5df2-106">Windows Installer developers should note the following changes in how the installer handles protected resources in Windows Server 2008 and later and Windows Vista and later:</span></span>

-   <span data-ttu-id="c5df2-107">在 Windows Server 2008 （含）以後版本或 Windows Vista 和更新版本上執行時，Windows Installer 會略過 WRP 所保護之任何檔案的安裝，安裝程式會在記錄檔中輸入警告，並繼續安裝的其餘部分，而不會發生錯誤。</span><span class="sxs-lookup"><span data-stu-id="c5df2-107">When running on Windows Server 2008 and later or Windows Vista and later, the Windows Installer skips the installation of any file that is protected by WRP, the installer enters a warning in the log file, and continues with the remainder of the installation without an error.</span></span> <span data-ttu-id="c5df2-108">在 Windows Server 2003、Windows XP 及 Windows 2000 中，當 Windows Installer 遇到受 WFP 保護的檔案時，安裝程式會要求 WFP 安裝檔案。</span><span class="sxs-lookup"><span data-stu-id="c5df2-108">In Windows Server 2003, Windows XP, and Windows 2000, when the Windows Installer encountered a WFP-protected file, the installer would request that WFP install the file.</span></span>
-   <span data-ttu-id="c5df2-109">WRP 在 Windows Server 2008 和更新版本或 Windows Vista 和更新版本上，除了檔案之外，還可以保護登錄機碼。</span><span class="sxs-lookup"><span data-stu-id="c5df2-109">WRP on Windows Server 2008 and later or Windows Vista and later can protect registry keys in addition to files.</span></span> <span data-ttu-id="c5df2-110">如果 Windows Installer 遇到受 WRP 保護的登錄機碼，安裝程式會略過該登錄機碼的安裝，安裝程式會在記錄檔中輸入警告，並繼續進行安裝的其餘部分，而不會發生錯誤。</span><span class="sxs-lookup"><span data-stu-id="c5df2-110">If the Windows Installer encounters a WRP-protected registry key, the installer skips the installation of that registry key, the installer enters a warning in the log file, and continues with the remainder of the installation without an error.</span></span>
-   <span data-ttu-id="c5df2-111">請注意，如果 Windows Installer 元件包含受 WRP 保護的檔案或登錄機碼，則必須使用此資源做為元件的 KeyPath。</span><span class="sxs-lookup"><span data-stu-id="c5df2-111">Note that if a Windows Installer component contains a file or registry key that is protected by WRP, this resource must be used as the KeyPath for the component.</span></span> <span data-ttu-id="c5df2-112">在此情況下，Windows Installer 不會安裝、更新或移除元件。</span><span class="sxs-lookup"><span data-stu-id="c5df2-112">In this case, Windows Installer does not install, update, or remove the component.</span></span> <span data-ttu-id="c5df2-113">您不應該在安裝套件中包含任何受保護的資源。</span><span class="sxs-lookup"><span data-stu-id="c5df2-113">You should not include any protected resources in an installation package.</span></span> <span data-ttu-id="c5df2-114">相反地，您應該針對[Windows 資源保護](../wfp/windows-resource-protection-portal.md)使用[支援的資源取代機制](../wfp/supported-file-replacement-mechanisms.md)。</span><span class="sxs-lookup"><span data-stu-id="c5df2-114">Instead, you should use the [supported resource replacement mechanisms](../wfp/supported-file-replacement-mechanisms.md) for [Windows Resource Protection](../wfp/windows-resource-protection-portal.md).</span></span>

<span data-ttu-id="c5df2-115">如需 WRP 的詳細資訊，請參閱[Microsoft Technet](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc709691(v=ws.10))上提供的[Windows 資源保護](../wfp/windows-resource-protection-portal.md)和資訊。</span><span class="sxs-lookup"><span data-stu-id="c5df2-115">For more information about WRP, see [Windows Resource Protection](../wfp/windows-resource-protection-portal.md) and information that is provided on [Microsoft Technet](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc709691(v=ws.10)).</span></span>

## <a name="wfp-for-windows-server-2003-and-windows-xp2000"></a><span data-ttu-id="c5df2-116">適用于 Windows Server 2003 和 Windows XP/2000 的 WFP</span><span class="sxs-lookup"><span data-stu-id="c5df2-116">WFP for Windows Server 2003 and Windows XP/2000</span></span>

<span data-ttu-id="c5df2-117">Windows Installer 在 Windows Server 2003、Windows XP 和 Windows 2000 上安裝基本的系統檔案時，會遵守 Windows 檔案保護 (WFP) 。</span><span class="sxs-lookup"><span data-stu-id="c5df2-117">Windows Installer adheres to Windows File Protection (WFP) when installing essential system files on Windows Server 2003, Windows XP and Windows 2000.</span></span> <span data-ttu-id="c5df2-118">如果應用程式的自動安裝修改了受保護的系統檔案，則 WFP 會將檔案還原至已驗證的檔案版本。</span><span class="sxs-lookup"><span data-stu-id="c5df2-118">If a protected system file is modified by an unattended installation of an application, WFP restores the file to the verified file version.</span></span>

<span data-ttu-id="c5df2-119">Windows Installer 永遠不會嘗試安裝或取代受保護的檔案。</span><span class="sxs-lookup"><span data-stu-id="c5df2-119">Windows Installer never attempts to install or replace a protected file.</span></span> <span data-ttu-id="c5df2-120">當 [InstallFiles](installfiles-action.md) 動作或 InstallFiles 之前排程的任何其他動作嘗試安裝在 windows Server 2003、windows XP 或 windows 2000 上受到保護的檔案時，安裝程式會使用安裝或取代受保護檔案的要求來呼叫 WFP。</span><span class="sxs-lookup"><span data-stu-id="c5df2-120">When the [InstallFiles](installfiles-action.md) action or any other action scheduled before InstallFiles attempts to install a file protected on Windows Server 2003, Windows XP or Windows 2000, the installer calls WFP with a request to install or replace the protected file.</span></span> <span data-ttu-id="c5df2-121">執行 InstallFiles 動作之後，安裝程式會立即從 WFP 要求檔案安裝。</span><span class="sxs-lookup"><span data-stu-id="c5df2-121">The installer requests the file installation from WFP immediately after executing the InstallFiles action.</span></span> <span data-ttu-id="c5df2-122">WFP 會以受保護檔案的快取版本，安裝或取代使用者系統上的檔案。</span><span class="sxs-lookup"><span data-stu-id="c5df2-122">WFP installs or replaces the file on the user's system with a cached version of the protected file.</span></span> <span data-ttu-id="c5df2-123">請注意，這並不保證從快取安裝的檔版本是應用程式所需的版本。</span><span class="sxs-lookup"><span data-stu-id="c5df2-123">Note that this does not guarantee that the version of the file installed from the cache is the version required by the application.</span></span> <span data-ttu-id="c5df2-124">在 WFP 安裝檔案之後，安裝程式會判斷此版本是否符合套件中的版本。</span><span class="sxs-lookup"><span data-stu-id="c5df2-124">After WFP has installed the file, the installer determines whether this version matches the version in the package.</span></span> <span data-ttu-id="c5df2-125">如果封裝中的檔案版本大於安裝的版本，安裝程式會通知使用者其無法更新系統，且應用程式可能需要作業系統的更新。</span><span class="sxs-lookup"><span data-stu-id="c5df2-125">If the file version in the package is greater than the installed version, the installer informs the user that it cannot update the system and that an update of the operating system may be required for the application.</span></span>

<span data-ttu-id="c5df2-126">如果在 [InstallFiles](installfiles-action.md) 之後排序的任何動作嘗試安裝或取代系統上尚未安裝的受保護檔案，安裝程式就無法呼叫 WFP 來安裝檔案。</span><span class="sxs-lookup"><span data-stu-id="c5df2-126">If any action sequenced after [InstallFiles](installfiles-action.md) attempts to install or replace a protected file not already installed on the system, the installer cannot call WFP to install the file.</span></span> <span data-ttu-id="c5df2-127">在此情況下，安裝程式會通知使用者無法更新系統，且應用程式可能需要作業系統的更新。</span><span class="sxs-lookup"><span data-stu-id="c5df2-127">In this case, the installer informs the user that it cannot update the system and that an update of the operating system may be required for the application.</span></span>

<span data-ttu-id="c5df2-128">移除檔案時，安裝程式也會檢查 WFP，而且永遠不會嘗試移除受保護的系統檔案。</span><span class="sxs-lookup"><span data-stu-id="c5df2-128">The installer also checks with WFP when removing files and never attempts to remove protected system files.</span></span>

## <a name="component-key-files-protected-by-wfp"></a><span data-ttu-id="c5df2-129">由 WFP 保護的元件金鑰檔案</span><span class="sxs-lookup"><span data-stu-id="c5df2-129">Component Key Files Protected by WFP</span></span>

<span data-ttu-id="c5df2-130">請注意，如果 Windows Installer 元件包含 WFP 檔案，則必須將此檔案指定為元件的金鑰路徑。</span><span class="sxs-lookup"><span data-stu-id="c5df2-130">Note that if a Windows Installer component contains a WFP file, this file must be specified as the key path for the component.</span></span>

<span data-ttu-id="c5df2-131">當安裝程式嘗試在 Windows Server 2003、Windows XP 或 Windows 2000 上安裝元件的金鑰檔時，它會先呼叫 WFP 來判斷金鑰檔是否受到保護。</span><span class="sxs-lookup"><span data-stu-id="c5df2-131">When the installer attempts to install a component's key file on Windows Server 2003, Windows XP or Windows 2000, it first calls WFP to determine if the key file is protected.</span></span> <span data-ttu-id="c5df2-132">當元件的金鑰檔受到 WFP 的保護，且已安裝該金鑰檔時，只有當封裝中的金鑰檔版本大於安裝的版本時，安裝程式才會更新該元件。</span><span class="sxs-lookup"><span data-stu-id="c5df2-132">When the key file of a component is protected by WFP, and that key file is already installed, the installer updates the component only if the version of the key file in the package is greater than the installed version.</span></span> <span data-ttu-id="c5df2-133">如果安裝套件指定元件已安裝，且目前未安裝元件的金鑰檔，則不論金鑰檔是否受到保護，安裝程式都會安裝元件。</span><span class="sxs-lookup"><span data-stu-id="c5df2-133">If the installation package specifies that a component be installed, and the key file of the component is not currently installed, then regardless of whether the key file is protected the installer installs the component.</span></span> <span data-ttu-id="c5df2-134">一旦安裝了任何具有 WFP 保護之金鑰檔的元件之後，就會永久安裝它，而安裝程式永遠不會移除或取代元件。</span><span class="sxs-lookup"><span data-stu-id="c5df2-134">Once any component having a key file protected by WFP is installed, it is permanently installed, and the installer never removes or replaces the component.</span></span>

## <a name="installation-of-assemblies-by-wfp"></a><span data-ttu-id="c5df2-135">以 WFP 安裝元件</span><span class="sxs-lookup"><span data-stu-id="c5df2-135">Installation of Assemblies by WFP</span></span>

<span data-ttu-id="c5df2-136">適用于元件的 WFP 與系統檔案的 WFP 不同。</span><span class="sxs-lookup"><span data-stu-id="c5df2-136">WFP for assemblies differs from WFP for system files.</span></span>

<span data-ttu-id="c5df2-137">WFP 會偵測取代受保護系統檔案的嘗試，以保護 Windows Server 2003、Windows XP 和 Windows 2000 系統檔案。</span><span class="sxs-lookup"><span data-stu-id="c5df2-137">WFP protects Windows Server 2003, Windows XP and Windows 2000 system files by detecting attempts to replace protected system files.</span></span> <span data-ttu-id="c5df2-138">當 WFP 收到受保護目錄中檔案的目錄變更通知之後，就會觸發這項保護。</span><span class="sxs-lookup"><span data-stu-id="c5df2-138">This protection is triggered after WFP receives a directory change notification for a file in a protected directory.</span></span> <span data-ttu-id="c5df2-139">當 WFP 收到此通知時，它會判斷已變更的檔案。</span><span class="sxs-lookup"><span data-stu-id="c5df2-139">When WFP receives this notification, it determines which file has changed.</span></span> <span data-ttu-id="c5df2-140">如果檔案受到保護，則 WFP 會查閱靜態類別目錄檔案中的檔案簽章，以判斷新的檔案是否為正確的版本。</span><span class="sxs-lookup"><span data-stu-id="c5df2-140">If the file is protected, WFP looks up the file signature in a static catalog file to determine if the new file is the correct version.</span></span> <span data-ttu-id="c5df2-141">如果檔案版本不正確，系統會從快取或散發媒體將檔案取代為正確的版本。</span><span class="sxs-lookup"><span data-stu-id="c5df2-141">If the file version is not correct, the system replaces the file with the correct version from either the cache or distribution media.</span></span>

<span data-ttu-id="c5df2-142">相反地，元件的 WFP 是動態的。</span><span class="sxs-lookup"><span data-stu-id="c5df2-142">In contrast, WFP of assemblies is dynamic.</span></span> <span data-ttu-id="c5df2-143">當檔案新增至共用並存元件快取時，會將 WFP 擴充至檔案。</span><span class="sxs-lookup"><span data-stu-id="c5df2-143">WFP is extended to files as they are added to the shared side-by-side assembly cache.</span></span> <span data-ttu-id="c5df2-144">如果元件損毀，則 WFP 會要求安裝程式取代檔案。</span><span class="sxs-lookup"><span data-stu-id="c5df2-144">If an assembly becomes corrupted, WFP will request that the installer replace the file.</span></span> <span data-ttu-id="c5df2-145">根據來源套件是否可存取，Windows Installer 可能或可能無法取代檔案。</span><span class="sxs-lookup"><span data-stu-id="c5df2-145">Windows Installer may or may not be able to replace the file depending on whether the source package is accessible.</span></span> <span data-ttu-id="c5df2-146">如果無法存取來源封裝，WFP 將會出現一個對話方塊，指出它無法還原檔案。</span><span class="sxs-lookup"><span data-stu-id="c5df2-146">If the source package is inaccessible, WFP will put up a dialog box stating that it is unable to restore the file.</span></span>

<span data-ttu-id="c5df2-147">請注意，安裝在% windir% winsxs 中的非受控共用並存元件 \\ 會受到 WFP 保護。</span><span class="sxs-lookup"><span data-stu-id="c5df2-147">Note that unmanaged shared side-by-side assemblies, installed in %windir%\\winsxs, are protected by WFP.</span></span> <span data-ttu-id="c5df2-148">未受管理的私用元件（安裝在應用程式目錄中）不受 WFP 保護。</span><span class="sxs-lookup"><span data-stu-id="c5df2-148">Unmanaged private assemblies, installed in the application directory, are not protected by WFP.</span></span> <span data-ttu-id="c5df2-149">在應用程式目錄中安裝的 Managed 通用群組件或% windir% \\ 元件 \\ gac 未受 WFP 保護。</span><span class="sxs-lookup"><span data-stu-id="c5df2-149">Managed global assemblies installed in the application directory or %windir%\\assembly\\gac are not protected by WFP.</span></span>

## <a name="related-topics"></a><span data-ttu-id="c5df2-150">相關主題</span><span class="sxs-lookup"><span data-stu-id="c5df2-150">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="c5df2-151">Windows 資源保護</span><span class="sxs-lookup"><span data-stu-id="c5df2-151">Windows Resource Protection</span></span>](../wfp/windows-resource-protection-portal.md)
</dt> </dl>

 

 
