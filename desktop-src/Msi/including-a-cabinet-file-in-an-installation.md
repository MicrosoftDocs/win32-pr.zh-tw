---
description: 本節說明如何在安裝中包含封包檔。 如需詳細資訊，請參閱使用封包和壓縮的來源。
ms.assetid: 17ea7f76-90b2-48fb-8187-64dc6d294443
title: 在安裝中包含封包檔
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 098e660de3f7ec7097ab02613d75219ac0a0d624
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "106989360"
---
# <a name="including-a-cabinet-file-in-an-installation"></a><span data-ttu-id="a3e87-104">在安裝中包含封包檔</span><span class="sxs-lookup"><span data-stu-id="a3e87-104">Including a Cabinet File in an Installation</span></span>

<span data-ttu-id="a3e87-105">本節說明如何在安裝中包含封包檔。</span><span class="sxs-lookup"><span data-stu-id="a3e87-105">This section describes including cabinet files in installations.</span></span> <span data-ttu-id="a3e87-106">如需詳細資訊，請參閱 [使用封包和壓縮的來源](using-cabinets-and-compressed-sources.md)。</span><span class="sxs-lookup"><span data-stu-id="a3e87-106">For more information, see [Using Cabinets and Compressed Sources](using-cabinets-and-compressed-sources.md).</span></span>

<span data-ttu-id="a3e87-107">**若要在安裝套件中包含封包檔**</span><span class="sxs-lookup"><span data-stu-id="a3e87-107">**To include a cabinet file in a installation package**</span></span>

1.  <span data-ttu-id="a3e87-108">使用封包建立工具，將來源檔案壓縮成封包檔。</span><span class="sxs-lookup"><span data-stu-id="a3e87-108">Use a cabinet creation tool to compress the source files into a cabinet file.</span></span> <span data-ttu-id="a3e87-109">請參閱封 [包](cabinet-files.md)檔。</span><span class="sxs-lookup"><span data-stu-id="a3e87-109">See [Cabinet Files](cabinet-files.md).</span></span>
2.  <span data-ttu-id="a3e87-110">封包檔必須位於 .msi 檔案內的資料流程中，或位於 [目錄資料表](directory-table.md)所指定來源樹狀結構根目錄的個別封包檔中。</span><span class="sxs-lookup"><span data-stu-id="a3e87-110">The cabinet file must either be located in a data stream inside the .msi file or in a separate cabinet file located at the root of the source tree specified by the [Directory Table](directory-table.md).</span></span>
3.  <span data-ttu-id="a3e87-111">判斷來源是否為壓縮類型，或是同時具有未壓縮和壓縮檔案的混合類型。</span><span class="sxs-lookup"><span data-stu-id="a3e87-111">Determine whether the source is to be a compressed type or a mixed type that has both uncompressed and compressed files.</span></span> <span data-ttu-id="a3e87-112">請參閱 [壓縮和未壓縮的來源](compressed-and-uncompressed-sources.md)。</span><span class="sxs-lookup"><span data-stu-id="a3e87-112">See [Compressed and Uncompressed Sources](compressed-and-uncompressed-sources.md).</span></span> <span data-ttu-id="a3e87-113">視來源影像的類型而定，設定 [ [**字數統計摘要**](word-count-summary.md) ] 屬性的壓縮或未壓縮旗標位。</span><span class="sxs-lookup"><span data-stu-id="a3e87-113">Depending on the type of source image, set the compressed or uncompressed flag bits of the [**Word Count Summary**](word-count-summary.md) Property.</span></span>
4.  <span data-ttu-id="a3e87-114">針對封包中的每個檔案，將記錄新增至檔案 [資料表](file-table.md) 。</span><span class="sxs-lookup"><span data-stu-id="a3e87-114">Add a record to the [File table](file-table.md) for each of the files in the cabinet.</span></span> <span data-ttu-id="a3e87-115">在 [檔案] 欄中輸入檔案索引鍵，其完全符合封包中檔案的檔案索引鍵。</span><span class="sxs-lookup"><span data-stu-id="a3e87-115">Enter a file key in the File column that exactly matches the file key of the file in the cabinet.</span></span> <span data-ttu-id="a3e87-116">檔案索引鍵會區分大小寫。</span><span class="sxs-lookup"><span data-stu-id="a3e87-116">The file keys are case-sensitive.</span></span> <span data-ttu-id="a3e87-117">檔案資料表和封包中的檔案安裝順序也必須相同。</span><span class="sxs-lookup"><span data-stu-id="a3e87-117">The file installation sequence in the File table and the cabinet must also be the same.</span></span> <span data-ttu-id="a3e87-118">檔案順序是由 [順序] 資料行中的序號所指定。</span><span class="sxs-lookup"><span data-stu-id="a3e87-118">The file sequence is specified by the sequence number in the Sequence column.</span></span> <span data-ttu-id="a3e87-119">若要抵達封包中第一個檔案的序號，請執行下列動作。</span><span class="sxs-lookup"><span data-stu-id="a3e87-119">To arrive at the sequence number for the first file in the cabinet, do the following.</span></span> <span data-ttu-id="a3e87-120">在 [DiskID] 資料行中，尋找 [媒體資料表](media-table.md) 中具有最大值的現有記錄。</span><span class="sxs-lookup"><span data-stu-id="a3e87-120">Find the existing record in the [Media table](media-table.md) having the greatest value in the DiskID column.</span></span> <span data-ttu-id="a3e87-121">此記錄的 LastSequence 欄位會提供媒體上所使用的最後一個檔案序號。</span><span class="sxs-lookup"><span data-stu-id="a3e87-121">The LastSequence field of this record gives the last file sequence number used on the media.</span></span> <span data-ttu-id="a3e87-122">在 File 資料表中，將新封包的第一個檔案指派為大於此值的序號。</span><span class="sxs-lookup"><span data-stu-id="a3e87-122">In the File table, assign the first file of the new cabinet a sequence number that is greater than this.</span></span> <span data-ttu-id="a3e87-123">依照封包檔中的相同順序，將序號指派給其餘所有檔案。</span><span class="sxs-lookup"><span data-stu-id="a3e87-123">Assign sequence numbers to all of the remaining files in the same order as in the cabinet file.</span></span> <span data-ttu-id="a3e87-124">如需其餘記錄欄位的說明，請參閱檔案 [資料表](file-table.md)。</span><span class="sxs-lookup"><span data-stu-id="a3e87-124">For a description of the remaining record fields, see [File table](file-table.md).</span></span>
5.  <span data-ttu-id="a3e87-125">將記錄加入至封包的 [媒體資料表](media-table.md) 。</span><span class="sxs-lookup"><span data-stu-id="a3e87-125">Add a record to the [Media table](media-table.md) for the cabinet.</span></span> <span data-ttu-id="a3e87-126">在新記錄的 DiskID 欄位中，指定大於資料表中現有最大 DiskID 值的值。</span><span class="sxs-lookup"><span data-stu-id="a3e87-126">Specify a value in the DiskID field of this new record that is greater than the largest DiskID value already existing in the table.</span></span> <span data-ttu-id="a3e87-127">將封包的名稱放入 [封包] 欄位中。</span><span class="sxs-lookup"><span data-stu-id="a3e87-127">Put the name of the cabinet into the Cabinet field.</span></span> <span data-ttu-id="a3e87-128">這個名稱必須是封 [包](cabinet.md) 資料類型的形式。</span><span class="sxs-lookup"><span data-stu-id="a3e87-128">This name must be in the form of a [Cabinet](cabinet.md) data type.</span></span> <span data-ttu-id="a3e87-129">\#如果封包是儲存在 .msi 檔案中的資料流程，請在名稱前面加上數位記號 ""。</span><span class="sxs-lookup"><span data-stu-id="a3e87-129">Prefix the name with a number sign "\#" if the cabinet is a data stream stored in the .msi file.</span></span> <span data-ttu-id="a3e87-130">請注意，如果封包是資料流程，封包的名稱會區分大小寫。</span><span class="sxs-lookup"><span data-stu-id="a3e87-130">Note that if the cabinet is a data stream, the name of the cabinet is case-sensitive.</span></span> <span data-ttu-id="a3e87-131">如果封包是個別的檔案，則檔案的名稱不區分大小寫。</span><span class="sxs-lookup"><span data-stu-id="a3e87-131">If the cabinet is a separate file, the name of the file is not case-sensitive.</span></span>
6.  <span data-ttu-id="a3e87-132">藉由檢查已更新檔案資料表的 [順序] 資料行，在新的封包中判斷最大的檔案序號。</span><span class="sxs-lookup"><span data-stu-id="a3e87-132">Determine the greatest file sequence number in the new cabinet by checking the Sequence column of the updated File table.</span></span> <span data-ttu-id="a3e87-133">在 [媒體] 資料表的新記錄的 [LastSequence] 欄位中輸入大於此值的值。</span><span class="sxs-lookup"><span data-stu-id="a3e87-133">Enter a value that is greater than this into the LastSequence field of the new record of the Media table.</span></span> <span data-ttu-id="a3e87-134">如需其餘記錄欄位的說明，請參閱 [媒體資料表](media-table.md)。</span><span class="sxs-lookup"><span data-stu-id="a3e87-134">For a description of the remaining record fields, see [Media table](media-table.md).</span></span>
7.  <span data-ttu-id="a3e87-135">您可以使用工具（例如 Msidb.exe）或使用安裝程式的 [資料庫](database-functions.md)函式，將封包檔儲存在安裝套件中。</span><span class="sxs-lookup"><span data-stu-id="a3e87-135">You can store the cabinet file in the installation package either by using a tool such as Msidb.exe or by using the installer's [Database Functions](database-functions.md).</span></span> <span data-ttu-id="a3e87-136">下列四個步驟說明如何使用資料庫函數，從程式新增封包。</span><span class="sxs-lookup"><span data-stu-id="a3e87-136">The following four steps explain how to add the cabinet from a program by using the database functions.</span></span>
8.  <span data-ttu-id="a3e87-137">若要從程式將封包新增至安裝套件，請使用 [**MsiDatabaseOpenView**](/windows/desktop/api/Msiquery/nf-msiquery-msidatabaseopenviewa)在資料庫的 [ \_ 資料流程資料表](-streams-table.md)上開啟一個 view。</span><span class="sxs-lookup"><span data-stu-id="a3e87-137">To add the cabinet to the installation package from a program open a view on the [\_Streams table](-streams-table.md) of the database using [**MsiDatabaseOpenView**](/windows/desktop/api/Msiquery/nf-msiquery-msidatabaseopenviewa).</span></span>
9.  <span data-ttu-id="a3e87-138">使用 [**MsiRecordSetString**](/windows/desktop/api/Msiquery/nf-msiquery-msirecordsetstringa) 將資料流程資料表的 [名稱] 資料行，設定 \_ 為在 [Media 資料表](media-table.md)的 [封包] 資料行中顯示的名稱。</span><span class="sxs-lookup"><span data-stu-id="a3e87-138">Use [**MsiRecordSetString**](/windows/desktop/api/Msiquery/nf-msiquery-msirecordsetstringa) to set the Name column of the \_Streams table to the name appearing in the Cabinet column of the [Media table](media-table.md).</span></span> <span data-ttu-id="a3e87-139">省略數位記號： \# 。</span><span class="sxs-lookup"><span data-stu-id="a3e87-139">Omit the number sign: \#.</span></span>
10. <span data-ttu-id="a3e87-140">使用 [**MsiRecordSetStream**](/windows/desktop/api/Msiquery/nf-msiquery-msirecordsetstreama) 將資料流程資料表的資料行設定 \_ 為封包的資料。</span><span class="sxs-lookup"><span data-stu-id="a3e87-140">Use [**MsiRecordSetStream**](/windows/desktop/api/Msiquery/nf-msiquery-msirecordsetstreama) to set the Data column of the \_Streams table to the cabinet's data.</span></span>
11. <span data-ttu-id="a3e87-141">使用 [**MsiViewModify**](/windows/desktop/api/Msiquery/nf-msiquery-msiviewmodify) 來更新資料流程資料表中的記錄 \_ 。</span><span class="sxs-lookup"><span data-stu-id="a3e87-141">Use [**MsiViewModify**](/windows/desktop/api/Msiquery/nf-msiquery-msiviewmodify) to update the record in the \_Streams table.</span></span>
12. <span data-ttu-id="a3e87-142">若要使用 Msidb.exe 將封包檔 Mycab.cab 新增至名為 Mydatabase.msi 的安裝套件，請使用下列命令列： Msidb.exe-d mydatabase.msi-a mycab.cab。</span><span class="sxs-lookup"><span data-stu-id="a3e87-142">To use Msidb.exe to add the cabinet file Mycab.cab to the installation package named Mydatabase.msi, use the following command line: Msidb.exe -d mydatabase.msi -a mycab.cab.</span></span> <span data-ttu-id="a3e87-143">在此情況下，媒體資料表的 [封包] 資料行應該包含 [字串： \#mycab.cab]。</span><span class="sxs-lookup"><span data-stu-id="a3e87-143">In this case, the Cabinet column of the Media table should contain the string: \#mycab.cab.</span></span>

 

 



