---
description: 撰寫安裝封裝時，您可以使用 MsiViewModify 函式或 View. Modify 方法，以確定您輸入的資料語法正確。
ms.assetid: c960e9df-dcd6-44d2-8662-40a1dea81f45
title: 內部驗證
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ca3c1a9e6f7b7e35b4d7d91287af64eff7812de6
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104112260"
---
# <a name="internal-validation"></a><span data-ttu-id="dffc9-103">內部驗證</span><span class="sxs-lookup"><span data-stu-id="dffc9-103">Internal Validation</span></span>

<span data-ttu-id="dffc9-104">撰寫安裝封裝時，您可以使用 [**MsiViewModify**](/windows/desktop/api/Msiquery/nf-msiquery-msiviewmodify) 函式或 View. Modify 方法，以確定您輸入的資料語法正確。</span><span class="sxs-lookup"><span data-stu-id="dffc9-104">When authoring an installation package, you can use the [**MsiViewModify**](/windows/desktop/api/Msiquery/nf-msiquery-msiviewmodify) function or the View.Modify method to ensure that the data you enter is syntactically correct.</span></span> <span data-ttu-id="dffc9-105">如需詳細資訊，請參閱 [**Modify 方法**](view-modify.md)。</span><span class="sxs-lookup"><span data-stu-id="dffc9-105">For more information, see [**Modify method**](view-modify.md).</span></span> <span data-ttu-id="dffc9-106">在最低層級，資料庫資料表的資料行可以儲存整數 (短或長) 、字串或二進位資料。</span><span class="sxs-lookup"><span data-stu-id="dffc9-106">At the lowest level, a database table's column can store integers (short or long), strings, or binary data.</span></span> <span data-ttu-id="dffc9-107">但是，安裝封裝需要特定資料表中的特定整數或字串。</span><span class="sxs-lookup"><span data-stu-id="dffc9-107">However, an installation package requires specific integers or strings in certain tables.</span></span> <span data-ttu-id="dffc9-108">這些規格會保留在[ \_ 驗證資料表](-validation-table.md)中。</span><span class="sxs-lookup"><span data-stu-id="dffc9-108">These specifications are maintained in the [\_Validation table](-validation-table.md).</span></span> <span data-ttu-id="dffc9-109">例如， [file 資料表](file-table.md) 的 FileName 資料行是字串資料行，但是它會特別儲存檔案名。</span><span class="sxs-lookup"><span data-stu-id="dffc9-109">For example, the FileName column of the [File table](file-table.md) is a string column, but it specifically stores a file name.</span></span> <span data-ttu-id="dffc9-110">因此，您的專案不應該只是字串，但也應該遵循命名檔案的需求。</span><span class="sxs-lookup"><span data-stu-id="dffc9-110">Therefore, not only should your entry be a string, but it should also follow the requirements for naming files.</span></span>

<span data-ttu-id="dffc9-111">與 [**MsiViewModify**](/windows/desktop/api/Msiquery/nf-msiquery-msiviewmodify) 函數搭配使用的各種驗證列舉值，允許在不同層級進行立即驗證。</span><span class="sxs-lookup"><span data-stu-id="dffc9-111">The various validation enum values used with the [**MsiViewModify**](/windows/desktop/api/Msiquery/nf-msiquery-msiviewmodify) function allow for immediate validation at different levels.</span></span> <span data-ttu-id="dffc9-112">MSIMODIFY \_ validate \_ FIELD enum 可以用來驗證記錄的個別欄位。</span><span class="sxs-lookup"><span data-stu-id="dffc9-112">The MSIMODIFY\_VALIDATE\_FIELD enum can be used to validate individual fields of a record.</span></span> <span data-ttu-id="dffc9-113">它不會驗證外鍵。</span><span class="sxs-lookup"><span data-stu-id="dffc9-113">It does not validate foreign keys.</span></span> <span data-ttu-id="dffc9-114">MSIMODIFY \_ VALIDATE 列舉會驗證整個資料列，並包含外鍵驗證。</span><span class="sxs-lookup"><span data-stu-id="dffc9-114">The MSIMODIFY\_VALIDATE enum validates an entire row and includes foreign key validation.</span></span> <span data-ttu-id="dffc9-115">如果您要在資料表中插入新的資料列，請使用 MSIMODIFY \_ VALIDATE \_ new 列舉來確認您要加入有效的資料，以及使用唯一的主鍵。</span><span class="sxs-lookup"><span data-stu-id="dffc9-115">If you are inserting a new row into a table, use the MSIMODIFY\_VALIDATE\_NEW enum to verify that you are adding valid data as well as using unique primary keys.</span></span> <span data-ttu-id="dffc9-116">如果主鍵不是唯一的，插入會失敗。</span><span class="sxs-lookup"><span data-stu-id="dffc9-116">An insert fails if the primary keys are not unique.</span></span> <span data-ttu-id="dffc9-117">如果使用其中一個驗證列舉呼叫 **MsiViewModify** 時傳回錯誤，您可以對 [**MsiViewGetError**](/windows/desktop/api/Msiquery/nf-msiquery-msiviewgeterrora) 進行重複呼叫以診斷問題。</span><span class="sxs-lookup"><span data-stu-id="dffc9-117">If a call to **MsiViewModify** with one of the validation enums returns an error, you can make repeated calls to [**MsiViewGetError**](/windows/desktop/api/Msiquery/nf-msiquery-msiviewgeterrora) for diagnosing the problem.</span></span> <span data-ttu-id="dffc9-118">**MsiViewGetError** 會指出發生錯誤的資料行，以及列舉值以協助修正問題。</span><span class="sxs-lookup"><span data-stu-id="dffc9-118">**MsiViewGetError** indicates the column where the error occurred as well as the enum value to help fix the problem.</span></span> <span data-ttu-id="dffc9-119">如需詳細資訊，請參閱 [**GetError 方法**](view-geterror.md)。</span><span class="sxs-lookup"><span data-stu-id="dffc9-119">For more information, see [**GetError method**](view-geterror.md).</span></span>

<span data-ttu-id="dffc9-120">您也可以使用內部驗證，以確保其他作者將資料正確地輸入您的自訂資料表。</span><span class="sxs-lookup"><span data-stu-id="dffc9-120">You can also use internal validation to ensure that other authors enter data correctly into your custom table.</span></span> <span data-ttu-id="dffc9-121">\_使用自訂資料表名稱和資料行名稱做為主要索引鍵，將自訂資料表的每個資料行加入至驗證資料表。</span><span class="sxs-lookup"><span data-stu-id="dffc9-121">Add each of the columns of your custom table to the \_Validation table using the custom table name and column name as the primary key.</span></span> <span data-ttu-id="dffc9-122">在 [驗證] 資料表的 [描述] 資料行中，提供每個資料行的描述或用途 \_ 。</span><span class="sxs-lookup"><span data-stu-id="dffc9-122">Provide a description or purpose of each column in the Description column of the \_Validation table.</span></span> <span data-ttu-id="dffc9-123">使用可為 Null、MinValue、int32.maxvalue、KeyTable、KeyColumn、Category 和 Set 資料行，為每個資料行輸入適用的需求：</span><span class="sxs-lookup"><span data-stu-id="dffc9-123">Enter the applicable requirements for each column using the Nullable, MinValue, MaxValue, KeyTable, KeyColumn, Category, and Set columns:</span></span>

-   <span data-ttu-id="dffc9-124">如果資料行可為 Null，請輸入 ' Y '。</span><span class="sxs-lookup"><span data-stu-id="dffc9-124">If the column is Nullable, enter a 'Y'.</span></span> <span data-ttu-id="dffc9-125">如果沒有，請輸入 ' N '。</span><span class="sxs-lookup"><span data-stu-id="dffc9-125">If not, enter a 'N'.</span></span>
-   <span data-ttu-id="dffc9-126">如果資料行是整數資料行，而且可以包含整數的範圍，請使用 MinValue 和 Timespan.maxvalue 資料行來輸入該範圍。</span><span class="sxs-lookup"><span data-stu-id="dffc9-126">If the column is an integer column and can contain a range of integers, enter that range using the MinValue and MaxValue columns.</span></span>
-   <span data-ttu-id="dffc9-127">外鍵資料行是使用 KeyTable 和 KeyColumn 資料行來識別。</span><span class="sxs-lookup"><span data-stu-id="dffc9-127">Foreign key columns are identified using the KeyTable and KeyColumn columns.</span></span>
-   <span data-ttu-id="dffc9-128">若為字串資料行，請指定類別目錄，例如檔案名、GUID 或識別碼。</span><span class="sxs-lookup"><span data-stu-id="dffc9-128">For string columns, specify a Category such as Filename, GUID, or Identifier.</span></span> <span data-ttu-id="dffc9-129">如需詳細資訊，請參閱 [資料行資料類型](column-data-types.md)。</span><span class="sxs-lookup"><span data-stu-id="dffc9-129">For more information, see [column data types](column-data-types.md).</span></span>
-   <span data-ttu-id="dffc9-130">如果資料只能與特定數目的值相關 (字串或整數) ，請使用 Set 資料行來列出可接受的值。</span><span class="sxs-lookup"><span data-stu-id="dffc9-130">If the data can only pertain to a specific number of values (string or integer), use the Set column to list the acceptable values.</span></span>

<span data-ttu-id="dffc9-131">除了您的資料 \_ 行是指定的型別，您也可以在驗證資料表中填入資料表、資料行和描述)  (的資料行清單。</span><span class="sxs-lookup"><span data-stu-id="dffc9-131">The following is a list of the columns (in addition to Table, Column, and Description) in the \_Validation table that can be filled in if your column is of the specified type.</span></span> <span data-ttu-id="dffc9-132"> (請注意，您不需要填入所有的資料行。 ) </span><span class="sxs-lookup"><span data-stu-id="dffc9-132">(Note that you do not have to fill in all the columns.)</span></span>



| <span data-ttu-id="dffc9-133">類型</span><span class="sxs-lookup"><span data-stu-id="dffc9-133">Type</span></span>    | <span data-ttu-id="dffc9-134">資料行</span><span class="sxs-lookup"><span data-stu-id="dffc9-134">Columns</span></span>                                                          |
|---------|------------------------------------------------------------------|
| <span data-ttu-id="dffc9-135">整數</span><span class="sxs-lookup"><span data-stu-id="dffc9-135">Integer</span></span> | <span data-ttu-id="dffc9-136">Nullable、MinValue、int32.maxvalue、KeyTable、KeyColumn、Set</span><span class="sxs-lookup"><span data-stu-id="dffc9-136">Nullable, MinValue, MaxValue, KeyTable, KeyColumn, Set</span></span>           |
| <span data-ttu-id="dffc9-137">String</span><span class="sxs-lookup"><span data-stu-id="dffc9-137">String</span></span>  | <span data-ttu-id="dffc9-138">Nullable、KeyTable、KeyColumn、Category、Set、MinValue、int32.maxvalue</span><span class="sxs-lookup"><span data-stu-id="dffc9-138">Nullable, KeyTable, KeyColumn, Category, Set, MinValue, MaxValue</span></span> |
| <span data-ttu-id="dffc9-139">Binary</span><span class="sxs-lookup"><span data-stu-id="dffc9-139">Binary</span></span>  | <span data-ttu-id="dffc9-140">可為 null、類別 (分類必須是 "Binary" ) </span><span class="sxs-lookup"><span data-stu-id="dffc9-140">Nullable, Category (Category must be "Binary")</span></span>                   |



 

<span data-ttu-id="dffc9-141">撰寫環境可能會使用 MSIMODIFY \_ 驗證 \_ 刪除。</span><span class="sxs-lookup"><span data-stu-id="dffc9-141">Authoring environments may make use of MSIMODIFY\_VALIDATE\_DELETE.</span></span> <span data-ttu-id="dffc9-142">此列舉假設您想要刪除資料列。</span><span class="sxs-lookup"><span data-stu-id="dffc9-142">This enum assumes that you want to delete the row.</span></span> <span data-ttu-id="dffc9-143">未執行任何欄位或外鍵驗證。</span><span class="sxs-lookup"><span data-stu-id="dffc9-143">No field or foreign key validation is performed.</span></span> <span data-ttu-id="dffc9-144">此列舉實際上會執行反向外鍵驗證。</span><span class="sxs-lookup"><span data-stu-id="dffc9-144">This enum actually performs a reverse foreign key validation.</span></span> <span data-ttu-id="dffc9-145">它會檢查 \_ 驗證資料表中是否有「已刪除」資料列所屬之資料表的 KeyTable 和 KeyColumn 資料行中的參考。</span><span class="sxs-lookup"><span data-stu-id="dffc9-145">It checks the \_Validation table for references in the KeyTable and KeyColumn columns for the table to which the "deleted" row belongs.</span></span> <span data-ttu-id="dffc9-146">如果有資料行列出包含「已刪除」資料列做為潛在外鍵的資料表，它會迴圈處理該資料行，以查看是否有任何值參考「已刪除」資料列中的值。</span><span class="sxs-lookup"><span data-stu-id="dffc9-146">If there are columns that list the table containing the "deleted" row as a potential foreign key, it cycles through that column to see if any of the values reference values in the "deleted" row.</span></span> <span data-ttu-id="dffc9-147">傳回錯誤表示您藉由刪除資料列來中斷資料庫的關聯式完整性。</span><span class="sxs-lookup"><span data-stu-id="dffc9-147">An error return means that you break the relational integrity of the database by deleting the row.</span></span>

 

 



