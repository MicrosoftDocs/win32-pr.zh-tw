---
description: 下表列出用來滿足範例規格的五個自訂動作： ProcessAccounts、UninstallAccounts、CreateAccounts、RemoveAccounts 和 RollbackAccounts。
ms.assetid: 389ec652-243e-4392-aec9-3a7eb90e6c68
title: 撰寫自訂動作
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e09525490304762b98635bcbbe6c238ce3fe413f
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "103944006"
---
# <a name="authoring-the-custom-actions"></a><span data-ttu-id="69e07-103">撰寫自訂動作</span><span class="sxs-lookup"><span data-stu-id="69e07-103">Authoring the Custom Actions</span></span>

<span data-ttu-id="69e07-104">下表列出用來滿足範例規格的五個自訂動作： ProcessAccounts、UninstallAccounts、CreateAccounts、RemoveAccounts 和 RollbackAccounts。</span><span class="sxs-lookup"><span data-stu-id="69e07-104">The table below lists the five custom actions used to meet the sample specifications: ProcessAccounts, UninstallAccounts, CreateAccounts, RemoveAccounts, and RollbackAccounts.</span></span> <span data-ttu-id="69e07-105">所有這些自訂動作都位於[二進位資料表](binary-table.md)中所儲存的[動態連結程式庫](dynamic-link-libraries.md)中。</span><span class="sxs-lookup"><span data-stu-id="69e07-105">All of these custom actions are in [dynamic-link libraries](dynamic-link-libraries.md) stored in the [Binary Table](binary-table.md).</span></span> <span data-ttu-id="69e07-106">Windows Installer SDK 提供包含範例自訂動作之動態連結程式庫的 c + + 原始程式碼。</span><span class="sxs-lookup"><span data-stu-id="69e07-106">The C++ source code for the dynamic-link libraries containing the sample custom actions are provided in the Windows Installer SDK.</span></span> <span data-ttu-id="69e07-107">ProcessAccounts 和 UninstallAccounts 位於檔案處理常式 .cpp 中。</span><span class="sxs-lookup"><span data-stu-id="69e07-107">ProcessAccounts and UninstallAccounts are in the file Process.cpp.</span></span> <span data-ttu-id="69e07-108">CreateAccount 位於 file Create .cpp 中。</span><span class="sxs-lookup"><span data-stu-id="69e07-108">CreateAccount is in the file Create.cpp.</span></span> <span data-ttu-id="69e07-109">RemoveAccount 和 RollbackAccount 位於檔案 Remove 中。</span><span class="sxs-lookup"><span data-stu-id="69e07-109">RemoveAccount and RollbackAccount are in the file Remove.cpp.</span></span> <span data-ttu-id="69e07-110">這些來源檔案可以用來建立檔案 Process.dll、Create.dll 和 Remove.dll。</span><span class="sxs-lookup"><span data-stu-id="69e07-110">These source files can be used to create the files Process.dll, Create.dll, and Remove.dll.</span></span>

<span data-ttu-id="69e07-111">由於建立或移除使用者帳戶需要較高的許可權，因此必須使用在系統內容中執行的 [延後執行自訂動作](deferred-execution-custom-actions.md) 來建立、移除或復原使用者帳戶。</span><span class="sxs-lookup"><span data-stu-id="69e07-111">Because the creation or removal of a user account requires elevated privileges, [deferred execution custom actions](deferred-execution-custom-actions.md) that run in the context of the system must be used to create, remove, or roll back user accounts.</span></span> <span data-ttu-id="69e07-112">立即執行自訂動作（ProcessAccounts 和 UninstallAccounts）會產生延遲的自訂動作，以建立、移除或復原使用者帳戶： CreateAccount、RemoveAccount 和 RollbackAccount。</span><span class="sxs-lookup"><span data-stu-id="69e07-112">The immediate execution custom actions, ProcessAccounts and UninstallAccounts, generate the deferred custom actions that create, remove, or rollback user accounts: CreateAccount, RemoveAccount, and RollbackAccount.</span></span>

<span data-ttu-id="69e07-113">由於延後自訂動作無法讀取資料庫資料表中的資訊，因此 ProcessAccounts 和 UninstallUserAccouts 必須設定 CustomActionData 屬性，將 UserAccounts 資料表中的資訊傳遞給延遲的自訂動作，如 [取得順延強制自訂動作的內容資訊](obtaining-context-information-for-deferred-execution-custom-actions.md)中所述。</span><span class="sxs-lookup"><span data-stu-id="69e07-113">Because deferred custom actions cannot read information in database tables, ProcessAccounts and UninstallUserAccouts must set a CustomActionData property to pass the information in the UserAccounts table to the deferred custom actions as described in [Obtaining Context Information for Deferred Execution Custom Actions](obtaining-context-information-for-deferred-execution-custom-actions.md).</span></span> <span data-ttu-id="69e07-114">當安裝程式執行執行腳本時，延後的自訂動作會根據 CustomActionData 屬性中的資訊來處理使用者帳戶。</span><span class="sxs-lookup"><span data-stu-id="69e07-114">When the installer runs the execution script, the deferred custom actions handle user accounts according to the information in the CustomActionData property.</span></span>

<span data-ttu-id="69e07-115">因為所有自訂動作都是在二進位資料表中儲存的動態連結程式庫中，所以它們全都會在其基底數數值型別中包含常數 msidbCustomActionTypeDll 和 msidbCustomActionTypeBinaryData。</span><span class="sxs-lookup"><span data-stu-id="69e07-115">Because all the custom actions are in dynamic-link libraries stored in the Binary table, they all include the constants msidbCustomActionTypeDll and msidbCustomActionTypeBinaryData in their base numeric type.</span></span> <span data-ttu-id="69e07-116">ProcessAccounts 和 UninstallAccounts 是純 [自訂動作類型 1](custom-action-type-1.md)的範例。</span><span class="sxs-lookup"><span data-stu-id="69e07-116">ProcessAccounts and UninstallAccounts are examples of pure [Custom Action Type 1](custom-action-type-1.md).</span></span> <span data-ttu-id="69e07-117">如需其他自訂動作類型的詳細資訊，請參閱 [所有自訂動作類型的摘要清單](summary-list-of-all-custom-action-types.md)。</span><span class="sxs-lookup"><span data-stu-id="69e07-117">For information on other custom action types see the [Summary List of All Custom Action Types](summary-list-of-all-custom-action-types.md).</span></span>

<span data-ttu-id="69e07-118">CreateAccount 和 RemoveAccount 是 [延後執行的自訂動作](deferred-execution-custom-actions.md) ，不允許服務模擬特定的使用者。</span><span class="sxs-lookup"><span data-stu-id="69e07-118">CreateAccount and RemoveAccount are [deferred execution custom actions](deferred-execution-custom-actions.md) that do not allow services to impersonate particular users.</span></span> <span data-ttu-id="69e07-119">這些自訂動作包括常數 msidbCustomActionTypeInScript 和 msidbCustomActionTypeNoImpersonate，以指定這些 [自訂動作的腳本執行選項](custom-action-in-script-execution-options.md)。</span><span class="sxs-lookup"><span data-stu-id="69e07-119">These custom actions include the constants msidbCustomActionTypeInScript and msidbCustomActionTypeNoImpersonate to specify these [custom action in-script execution options](custom-action-in-script-execution-options.md).</span></span>

<span data-ttu-id="69e07-120">RollbackAccount 是 [復原自訂動作](rollback-custom-actions.md) ，只會在 [復原安裝](rollback-installation.md)期間移除使用者帳戶。</span><span class="sxs-lookup"><span data-stu-id="69e07-120">RollbackAccount is a [rollback custom action](rollback-custom-actions.md) that only removes user accounts during a [rollback installation](rollback-installation.md).</span></span> <span data-ttu-id="69e07-121">RollbackAccount 包含常數 msidbCustomActionTypeInScript 和 msidbCustomActionTypeRollback，以指定這些 [自訂動作的腳本執行選項](custom-action-in-script-execution-options.md)。</span><span class="sxs-lookup"><span data-stu-id="69e07-121">RollbackAccount includes the constants msidbCustomActionTypeInScript and msidbCustomActionTypeRollback to specify these [custom action in-script execution options](custom-action-in-script-execution-options.md).</span></span>

<span data-ttu-id="69e07-122">這些自訂動作可能會處理敏感性資料，例如不應寫入記錄檔的使用者密碼。</span><span class="sxs-lookup"><span data-stu-id="69e07-122">These custom actions may handle sensitive data such as user passwords, which should not be written to the log file.</span></span> <span data-ttu-id="69e07-123">因此，延遲的自訂動作應該會在自訂動作類型中包含 msidbCustomActionTypeHideTarget。</span><span class="sxs-lookup"><span data-stu-id="69e07-123">The deferred custom actions should therefore include msidbCustomActionTypeHideTarget in the custom action type.</span></span> <span data-ttu-id="69e07-124">延後自訂動作的名稱也必須加入至 [屬性工作表](property-table.md)中的 [**MsiHiddenProperties**](msihiddenproperties.md)屬性清單，因為立即的自訂動作會使用 CustomActionData 屬性，將資料傳遞至延遲的自訂動作。</span><span class="sxs-lookup"><span data-stu-id="69e07-124">The names of the deferred custom actions also need to be added to the [**MsiHiddenProperties**](msihiddenproperties.md) property list in the [Property table](property-table.md) because of the way immediate custom actions pass data to deferred custom actions using the CustomActionData property.</span></span>



| <span data-ttu-id="69e07-125">自訂動作</span><span class="sxs-lookup"><span data-stu-id="69e07-125">Custom action</span></span>     | <span data-ttu-id="69e07-126">DLL 進入點</span><span class="sxs-lookup"><span data-stu-id="69e07-126">DLL entry point</span></span>                       | <span data-ttu-id="69e07-127">自訂動作類型</span><span class="sxs-lookup"><span data-stu-id="69e07-127">Custom action type</span></span>                                                                                                                                                         |
|-------------------|---------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="69e07-128">ProcessAccounts</span><span class="sxs-lookup"><span data-stu-id="69e07-128">ProcessAccounts</span></span>   | <span data-ttu-id="69e07-129">Process.dll 中的 ProcessUserAccounts。</span><span class="sxs-lookup"><span data-stu-id="69e07-129">ProcessUserAccounts in Process.dll.</span></span>   | <span data-ttu-id="69e07-130">msidbCustomActionTypeDll + msidbCustomActionTypeBinaryData = 1</span><span class="sxs-lookup"><span data-stu-id="69e07-130">msidbCustomActionTypeDll + msidbCustomActionTypeBinaryData = 1</span></span>                                                                                                             |
| <span data-ttu-id="69e07-131">UninstallAccounts</span><span class="sxs-lookup"><span data-stu-id="69e07-131">UninstallAccounts</span></span> | <span data-ttu-id="69e07-132">Process.dll 中的 UninstallUserAccounts。</span><span class="sxs-lookup"><span data-stu-id="69e07-132">UninstallUserAccounts in Process.dll.</span></span> | <span data-ttu-id="69e07-133">msidbCustomActionTypeDll + msidbCustomActionTypeBinaryData = 1</span><span class="sxs-lookup"><span data-stu-id="69e07-133">msidbCustomActionTypeDll + msidbCustomActionTypeBinaryData = 1</span></span>                                                                                                             |
| <span data-ttu-id="69e07-134">CreateAccount</span><span class="sxs-lookup"><span data-stu-id="69e07-134">CreateAccount</span></span>     | <span data-ttu-id="69e07-135">Create.dll 中的 CreateUserAccount。</span><span class="sxs-lookup"><span data-stu-id="69e07-135">CreateUserAccount in Create.dll.</span></span>      | <span data-ttu-id="69e07-136">msidbCustomActionTypeDll + msidbCustomActionTypeBinaryData + msidbCustomActionTypeInScript + msidbCustomActionTypeNoImpersonate + msidbCustomActionTypeHideTarget = 11265。</span><span class="sxs-lookup"><span data-stu-id="69e07-136">msidbCustomActionTypeDll + msidbCustomActionTypeBinaryData + msidbCustomActionTypeInScript + msidbCustomActionTypeNoImpersonate + msidbCustomActionTypeHideTarget = 11265.</span></span> |
| <span data-ttu-id="69e07-137">RemoveAccount</span><span class="sxs-lookup"><span data-stu-id="69e07-137">RemoveAccount</span></span>     | <span data-ttu-id="69e07-138">Remove.dll 中的 RemoveUserAccount。</span><span class="sxs-lookup"><span data-stu-id="69e07-138">RemoveUserAccount in Remove.dll.</span></span>      | <span data-ttu-id="69e07-139">msidbCustomActionTypeDll + msidbCustomActionTypeBinaryData + msidbCustomActionTypeInScript + msidbCustomActionTypeNoImpersonate + msidbCustomActionTypeHideTarget = 11265。</span><span class="sxs-lookup"><span data-stu-id="69e07-139">msidbCustomActionTypeDll + msidbCustomActionTypeBinaryData + msidbCustomActionTypeInScript + msidbCustomActionTypeNoImpersonate + msidbCustomActionTypeHideTarget = 11265.</span></span> |
| <span data-ttu-id="69e07-140">RollbackAccount</span><span class="sxs-lookup"><span data-stu-id="69e07-140">RollbackAccount</span></span>   | <span data-ttu-id="69e07-141">Remove.dll 中的 RemoveUserAccount。</span><span class="sxs-lookup"><span data-stu-id="69e07-141">RemoveUserAccount in Remove.dll.</span></span>      | <span data-ttu-id="69e07-142">msidbCustomActionTypeDll + msidbCustomActionTypeBinaryData + msidbCustomActionTypeInScript + msidbCustomActionTypeRollback + msidbCustomActionTypeHideTarget = 9473。</span><span class="sxs-lookup"><span data-stu-id="69e07-142">msidbCustomActionTypeDll + msidbCustomActionTypeBinaryData + msidbCustomActionTypeInScript + msidbCustomActionTypeRollback + msidbCustomActionTypeHideTarget = 9473.</span></span>       |



 

<span data-ttu-id="69e07-143">繼續 [撰寫 CustomAction 資料表](authoring-the-customaction-table.md)。</span><span class="sxs-lookup"><span data-stu-id="69e07-143">Continue to [Authoring the CustomAction Table](authoring-the-customaction-table.md).</span></span>

 

 



