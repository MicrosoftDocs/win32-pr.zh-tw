---
description: Windows Installer 包含在動作顯示對話方塊中顯示進度指標的功能。
ms.assetid: cfc2d974-4f2d-4f52-9835-eab1dc091c9b
title: 撰寫 ProgressBar 控制項
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b872ed2dd36fb8ed04ee48fd69e4680fce002a18
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "103848961"
---
# <a name="authoring-a-progressbar-control"></a><span data-ttu-id="6b922-103">撰寫 ProgressBar 控制項</span><span class="sxs-lookup"><span data-stu-id="6b922-103">Authoring a ProgressBar Control</span></span>

<span data-ttu-id="6b922-104">Windows Installer 包含在動作顯示對話方塊中顯示進度指標的功能。</span><span class="sxs-lookup"><span data-stu-id="6b922-104">Windows Installer contains functionality to display a progress indicator in an action display dialog.</span></span> <span data-ttu-id="6b922-105">[ProgressBar 控制項會](progressbar-control.md)以圖形表示個別元件的安裝，以及報表在安裝完成之前，相對於剩餘時間或大約總剩餘時間的總時間。</span><span class="sxs-lookup"><span data-stu-id="6b922-105">The [ProgressBar control](progressbar-control.md) graphically represents the installation of individual components and reports either the total time elapsed relative to time remaining or the approximate total time remaining until the installation is complete.</span></span>

<span data-ttu-id="6b922-106">為了判斷安裝所預期的總時間，安裝程式會在執行腳本產生期間追蹤每個動作所預期的總進度刻度。</span><span class="sxs-lookup"><span data-stu-id="6b922-106">To determine the total time anticipated for the installation, the installer tracks the total progress ticks anticipated by each action during generation of the execution script.</span></span> <span data-ttu-id="6b922-107">當腳本產生完成時，會儲存進度滴答總計，並開始安裝。</span><span class="sxs-lookup"><span data-stu-id="6b922-107">When script generation is complete, the progress tick total is stored and the installation begins.</span></span>

<span data-ttu-id="6b922-108">詳細說明進度刻度數量的進度訊息會傳送至使用中的訊息處理常式，因為腳本中的每個動作都會執行。</span><span class="sxs-lookup"><span data-stu-id="6b922-108">Progress messages detailing the elapsed number of progress ticks are sent to the active message handler as each action in the script is executed.</span></span> <span data-ttu-id="6b922-109">在每個進度訊息中，安裝程式會將 [SetProgress ControlEvent](setprogress-controlevent.md) 廣播到目前作用中的對話方塊。</span><span class="sxs-lookup"><span data-stu-id="6b922-109">On each progress message, the installer broadcasts a [SetProgress ControlEvent](setprogress-controlevent.md) to the currently active dialog box.</span></span> <span data-ttu-id="6b922-110">在腳本執行期間，您應該撰寫 UI 順序來建立動作顯示對話方塊，以接收來自安裝程式的 SetProgress ControlEvent 訊息。</span><span class="sxs-lookup"><span data-stu-id="6b922-110">The UI sequence should be authored to create the action display dialog box during script execution to receive the SetProgress ControlEvent messages from the installer.</span></span>

<span data-ttu-id="6b922-111">當 [動作顯示] 對話方塊收到 SetProgress ControlEvent 時，它會檢查 [EventMapping 資料表](eventmapping-table.md) 是否有任何訂閱該 ControlEvent 的控制項。</span><span class="sxs-lookup"><span data-stu-id="6b922-111">When the action display dialog box receives a SetProgress ControlEvent, it checks the [EventMapping table](eventmapping-table.md) for any controls subscribing to the ControlEvent.</span></span> <span data-ttu-id="6b922-112">[動作顯示] 對話方塊上的 ProgressBar 控制項是使用 [屬性] 資料行中指定的進度控制項屬性訂閱。</span><span class="sxs-lookup"><span data-stu-id="6b922-112">The ProgressBar control on the action display dialog box is subscribed to with the Progress control attribute specified in the Attributes column.</span></span> <span data-ttu-id="6b922-113">進度控制項屬性指定 ProgressBar 控制項將會傳遞 "ticksSoFar" 和 "totalTicks" 值，以及 SetProgress ControlEvent。</span><span class="sxs-lookup"><span data-stu-id="6b922-113">The Progress Control attribute specifies that the ProgressBar control will be passed "ticksSoFar" and "totalTicks" values along with the SetProgress ControlEvent.</span></span> <span data-ttu-id="6b922-114">進度列控制項使用這種資訊，從左至右將安裝和從右至左往左移動圖形列，以進行 [復原](rollback-installation.md) 作業。</span><span class="sxs-lookup"><span data-stu-id="6b922-114">The progress bar control uses this information to advance the graphical bar from left to right for an installation and from right to left for a [rollback](rollback-installation.md) operation.</span></span>

<span data-ttu-id="6b922-115">此外，安裝程式會在每個進度訊息上廣播 [TimeRemaining ControlEvent](timeremaining-controlevent.md) 。</span><span class="sxs-lookup"><span data-stu-id="6b922-115">In addition, the installer broadcasts a [TimeRemaining ControlEvent](timeremaining-controlevent.md) on each progress message.</span></span> <span data-ttu-id="6b922-116">安裝的剩餘時間總計是藉由先計算執行速率來決定，也就是已耗用的總滴答數除以安裝開始之後的總時間。</span><span class="sxs-lookup"><span data-stu-id="6b922-116">The total time remaining for the installation is determined by first calculating the execution rate, which is the total number of ticks elapsed divided by the total time since the installation began.</span></span> <span data-ttu-id="6b922-117">剩餘的總刻度除以執行速率，可提供大約的剩餘時間。</span><span class="sxs-lookup"><span data-stu-id="6b922-117">The total ticks remaining divided by the execution rate gives the approximate time remaining.</span></span>

<span data-ttu-id="6b922-118">當動作顯示對話方塊收到 TimeRemaining ControlEvent 時，它會再次在 EventMapping 資料表中尋找任何已訂閱的控制項。</span><span class="sxs-lookup"><span data-stu-id="6b922-118">When the action display dialog box receives the TimeRemaining ControlEvent, it again looks in the EventMapping table for any controls that are subscribed.</span></span> <span data-ttu-id="6b922-119">為了顯示剩餘的時間，必須使用 [屬性] 資料行中指定的[TimeRemaining 控制項屬性](timeremaining-control-attribute.md)，將[文字控制項](text-control.md)訂閱給 TimeRemaining ControlEvent。</span><span class="sxs-lookup"><span data-stu-id="6b922-119">In order to display the time remaining, a [Text control](text-control.md) must be subscribed to the TimeRemaining ControlEvent with the [TimeRemaining control attribute](timeremaining-control-attribute.md) specified in the Attributes column.</span></span>

<span data-ttu-id="6b922-120">訂閱的文字控制項會查詢 [UIText 資料表](uitext-table.md) 中名為 "TimeRemaining" 的參數化範本字串。</span><span class="sxs-lookup"><span data-stu-id="6b922-120">The subscribed Text control queries the [UIText table](uitext-table.md) for a parameterized template string named "TimeRemaining".</span></span> <span data-ttu-id="6b922-121">這個字串有兩個參數， \[ 1 \] 表示分鐘， \[ 2 \] 秒。</span><span class="sxs-lookup"><span data-stu-id="6b922-121">This string has two parameters, \[1\] for minutes, and \[2\] for seconds.</span></span> <span data-ttu-id="6b922-122">文字控制項會將每個值轉換為分鐘和秒，並評估 TimeRemaining 範本字串，並以新的資訊更新文字控制項。</span><span class="sxs-lookup"><span data-stu-id="6b922-122">The Text control converts each value to minutes and seconds, evaluates the TimeRemaining template string, and updates the text control with the new information.</span></span>

<span data-ttu-id="6b922-123">如果 UI 顯示層級設定為 [基本] 或 [較低]，安裝程式會顯示預設對話方塊，其中包含進度列和 [TimeRemaining 文字] 欄位。</span><span class="sxs-lookup"><span data-stu-id="6b922-123">If the UI display level is set to basic or lower, the installer displays a default dialog box containing a progress bar and TimeRemaining text field.</span></span> <span data-ttu-id="6b922-124">如需詳細資訊，請參閱 [消費者介面層級](user-interface-levels.md)。</span><span class="sxs-lookup"><span data-stu-id="6b922-124">For more information, see [User Interface Levels](user-interface-levels.md).</span></span>

 

 



