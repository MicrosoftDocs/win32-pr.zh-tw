---
description: 修補具有變數內容的檔案時，可能需要保留目標檔案的選取區域，以避免遺失重要資訊。
ms.assetid: 4a610588-556e-489f-ac14-73e5e6b776fe
title: 修補選取的檔案區域
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 778df4b0cc98eeacd1106929b18c7461c6fa9e70
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "106974109"
---
# <a name="patching-selected-regions-of-a-file"></a><span data-ttu-id="22807-103">修補選取的檔案區域</span><span class="sxs-lookup"><span data-stu-id="22807-103">Patching Selected Regions of a File</span></span>

<span data-ttu-id="22807-104">修補具有變數內容的檔案時，可能需要保留目標檔案的選取區域，以避免遺失重要資訊。</span><span class="sxs-lookup"><span data-stu-id="22807-104">When patching files having variable content, it may be necessary to retain selected regions of the target file to prevent the lost of critical information.</span></span> <span data-ttu-id="22807-105">例如，有些應用程式會將使用者資訊標記為可執行檔。</span><span class="sxs-lookup"><span data-stu-id="22807-105">For example, some applications stamp user information into the executable file.</span></span> <span data-ttu-id="22807-106">由於目標檔案的內容可能取決於安裝應用程式的電腦，因此很難判斷特定檔案是否為修補程式的有效目標。</span><span class="sxs-lookup"><span data-stu-id="22807-106">Because the contents of the target file might depend upon the computer on which the application is installed, it becomes difficult to determine whether a particular file is a valid target for the patch.</span></span> <span data-ttu-id="22807-107">寫入至目標檔案的使用者資訊也可以透過修補程式來覆寫。</span><span class="sxs-lookup"><span data-stu-id="22807-107">User information written in the target file can also be overwritten by a patch.</span></span>

<span data-ttu-id="22807-108">當您產生 patch 建立屬性 (使用 [Msimsp.exe](msimsp-exe.md) 和 [PATCHWIZ.DLL](patchwiz-dll.md)PCP) 檔案時，可以指定在修補期間忽略目標檔案特定區域中的資訊。</span><span class="sxs-lookup"><span data-stu-id="22807-108">When you generate a patch creation properties (PCP) file with [Msimsp.exe](msimsp-exe.md) and [PATCHWIZ.DLL](patchwiz-dll.md), you can specify that the information in certain regions of the target file be ignored during patching.</span></span> <span data-ttu-id="22807-109">您也可以指定目標檔案的其他區域中的資訊保留並複製到已更新檔案中的位移位置。</span><span class="sxs-lookup"><span data-stu-id="22807-109">You can also specify that information in other regions of the target file be retained and copied to an offset location in the updated file.</span></span> <span data-ttu-id="22807-110">您可以指定要忽略的目標檔案區域，以及撰寫 [TargetFiles OptionalData](targetfiles-optionaldata-table-patchwiz-dll-.md)、 [ExternalFiles](externalfiles-table-patchwiz-dll-.md)和 [FamilyFileRanges](familyfileranges-table-patchwiz-dll-.md) 資料表時要保留的區域。</span><span class="sxs-lookup"><span data-stu-id="22807-110">You specify which regions of the target file to ignore and which regions to retain when authoring the [TargetFiles OptionalData](targetfiles-optionaldata-table-patchwiz-dll-.md), [ExternalFiles](externalfiles-table-patchwiz-dll-.md), and [FamilyFileRanges](familyfileranges-table-patchwiz-dll-.md) tables.</span></span>

<span data-ttu-id="22807-111">使用 [TargetFiles OptionalData](targetfiles-optionaldata-table-patchwiz-dll-.md) 資料表的 RetainOffsets 資料行以及 [RetainLengths](familyfileranges-table-patchwiz-dll-.md) 資料表的 RetainOffsets 和 FamilyFileRanges 資料行，將目標檔案中的資訊範圍複製到已更新檔案中的位移範圍。</span><span class="sxs-lookup"><span data-stu-id="22807-111">Use the RetainOffsets column of the [TargetFiles OptionalData](targetfiles-optionaldata-table-patchwiz-dll-.md) table and the RetainOffsets and RetainLengths columns of the [FamilyFileRanges](familyfileranges-table-patchwiz-dll-.md) table to copy a range of information from the target file to an offset range in the updated file.</span></span> <span data-ttu-id="22807-112">此範圍中的資訊會保留下來。</span><span class="sxs-lookup"><span data-stu-id="22807-112">The information in this range is retained.</span></span> <span data-ttu-id="22807-113">使用 FamilyFileRanges 資料表的 RetainLengths 資料行，指定範圍的長度。</span><span class="sxs-lookup"><span data-stu-id="22807-113">Specify the length of the range using the RetainLengths columns of the FamilyFileRanges table.</span></span> <span data-ttu-id="22807-114">保留範圍的長度在目標和更新的檔案中是相同的。</span><span class="sxs-lookup"><span data-stu-id="22807-114">The length of the retained range is the same in the target and updated files.</span></span> <span data-ttu-id="22807-115">使用 TargetFiles OptionalData 資料表的 RetainOffsets 資料行，在目標檔案中指定範圍的位移。</span><span class="sxs-lookup"><span data-stu-id="22807-115">Specify the offset of the range in the target file using the RetainOffsets column of the TargetFiles OptionalData table.</span></span> <span data-ttu-id="22807-116">使用 FamilyFileRanges 資料表的 RetainOffsets 資料行，在更新的檔案中指定範圍的位移。</span><span class="sxs-lookup"><span data-stu-id="22807-116">Specify the offset of the range in the updated file using the RetainOffsets column of the FamilyFileRanges table.</span></span> <span data-ttu-id="22807-117">因此，保留的目標檔案範圍是 TargetFiles OptionalData 資料表中 RetainOffsets 的值加上 RetainLengths。</span><span class="sxs-lookup"><span data-stu-id="22807-117">The range of the target file retained is therefore the value of RetainOffsets in the TargetFiles OptionalData table plus RetainLengths.</span></span> <span data-ttu-id="22807-118">這項資訊會複製到 FamilyFileRanges 資料表中 RetainOffsets 值所提供之範圍內的更新檔案，加上 RetainLengths。</span><span class="sxs-lookup"><span data-stu-id="22807-118">This information gets copied to the update file in the range given by the value of RetainOffsets in the FamilyFileRanges tables plus RetainLengths.</span></span> <span data-ttu-id="22807-119">您可以指定多個範圍，但是長度的順序必須符合位移的順序。</span><span class="sxs-lookup"><span data-stu-id="22807-119">You can specify multiple ranges but the order of the lengths must match the order of the offsets.</span></span>

<span data-ttu-id="22807-120">使用 [TargetFiles OptionalData](targetfiles-optionaldata-table-patchwiz-dll-.md) 資料表來忽略目標檔案的範圍。</span><span class="sxs-lookup"><span data-stu-id="22807-120">Use the [TargetFiles OptionalData](targetfiles-optionaldata-table-patchwiz-dll-.md) table to ignore a range of the target file.</span></span> <span data-ttu-id="22807-121">修補程式仍可覆寫這個目標檔範圍內的資訊。</span><span class="sxs-lookup"><span data-stu-id="22807-121">Information in this range of the target file can still be overwritten by the patch.</span></span> <span data-ttu-id="22807-122">在 [IgnoreOffsets] 資料行中指定範圍的位移，並在 [IgnoreLengths] 資料行中指定其長度。</span><span class="sxs-lookup"><span data-stu-id="22807-122">Specify the offset of the range in the IgnoreOffsets column and its length in the IgnoreLengths column.</span></span> <span data-ttu-id="22807-123">您可以指定多個範圍，但是長度的順序必須符合位移的順序。</span><span class="sxs-lookup"><span data-stu-id="22807-123">You can specify multiple ranges but the order of the lengths must match the order of the offsets.</span></span>

<span data-ttu-id="22807-124">[長度] 和 [位移] 資料行中的值可以是十進位或十六進位。</span><span class="sxs-lookup"><span data-stu-id="22807-124">The values in the lengths and offsets columns can be decimal or hexadecimal.</span></span> <span data-ttu-id="22807-125">[PATCHWIZ.DLL](patchwiz-dll.md) 將值視為十六進位（如果前面加上 "0x"）。</span><span class="sxs-lookup"><span data-stu-id="22807-125">[PATCHWIZ.DLL](patchwiz-dll.md) treats the value as hexadecimal if it is prefixed by "0x".</span></span> <span data-ttu-id="22807-126">這些資料行是字串資料行，所以 PATCHWIZ.DLL 將值轉換為 Ulong。</span><span class="sxs-lookup"><span data-stu-id="22807-126">The columns are string columns, so PATCHWIZ.DLL converts the values to ULONGs.</span></span> <span data-ttu-id="22807-127">Length 資料行指定長度（以位元組為單位）。</span><span class="sxs-lookup"><span data-stu-id="22807-127">The length column specifies the length in bytes.</span></span>

 

 



