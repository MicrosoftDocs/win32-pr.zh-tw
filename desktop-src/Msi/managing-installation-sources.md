---
description: 具有系統管理許可權的使用者和應用程式可以取得和修改系統上 Windows Installer 應用程式和修補程式的網路、URL 和媒體來源清單資訊。
ms.assetid: e8c66bad-f594-4926-b3b4-c8b245dcfa83
title: 管理安裝來源
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d7fc45253af20ae5f9792ee3a5ec7dd318c80295
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "106979390"
---
# <a name="managing-installation-sources"></a><span data-ttu-id="85ef4-103">管理安裝來源</span><span class="sxs-lookup"><span data-stu-id="85ef4-103">Managing Installation Sources</span></span>

<span data-ttu-id="85ef4-104">具有系統管理許可權的使用者和應用程式可以取得和修改系統上 Windows Installer 應用程式和修補程式的網路、URL 和媒體來源清單資訊。</span><span class="sxs-lookup"><span data-stu-id="85ef4-104">Users and applications with administrative privileges can retrieve and modify network, URL, and media source list information for Windows Installer applications and patches on the system.</span></span>

<span data-ttu-id="85ef4-105">**Windows Installer 2.0：** 不支援。</span><span class="sxs-lookup"><span data-stu-id="85ef4-105">**Windows Installer 2.0:** Not supported.</span></span> <span data-ttu-id="85ef4-106">系統管理員無法讀取、重新排列或取代來源清單中的專案，也無法修改或抓取來源清單屬性。</span><span class="sxs-lookup"><span data-stu-id="85ef4-106">Administrators cannot read, reorder, or replace entries in the source list and cannot modify or retrieve source list properties.</span></span> <span data-ttu-id="85ef4-107">您可以管理網路來源，但不能管理 URL 或媒體來源。</span><span class="sxs-lookup"><span data-stu-id="85ef4-107">It is possible to manage Network sources, but not URL or Media sources.</span></span> <span data-ttu-id="85ef4-108">系統管理員只能針對目前的使用者，管理個別電腦應用程式或安裝為每位使用者之應用程式的來源清單。</span><span class="sxs-lookup"><span data-stu-id="85ef4-108">Administrators can only manage source lists for per-machine applications or applications installed as per-user for the current user.</span></span> <span data-ttu-id="85ef4-109">這可防止系統管理員使用早于 Windows Installer 版本3.0 的版本，管理系統中所有使用者的來源清單資訊。</span><span class="sxs-lookup"><span data-stu-id="85ef4-109">This prevents administrators using versions earlier than Windows Installer version 3.0 from managing source list information for all users in the system.</span></span>

<span data-ttu-id="85ef4-110">**Windows Installer 3.0 和更新版本：** 具有系統管理員許可權的使用者和應用程式，可以針對所有使用者在系統上安裝的 Windows Installer 應用程式和修補程式，取得和修改來源清單資訊。</span><span class="sxs-lookup"><span data-stu-id="85ef4-110">**Windows Installer 3.0 and later:** Users and applications that have administrator privileges can retrieve and modify source list information for Windows Installer applications and patches installed on the system for all users.</span></span> <span data-ttu-id="85ef4-111">來源清單函式可以用來管理網路、URL 和媒體來源的來源清單和來源清單屬性。</span><span class="sxs-lookup"><span data-stu-id="85ef4-111">The source list functions can be used to manage source lists and source list properties for network, URL and media sources.</span></span> <span data-ttu-id="85ef4-112">安裝程式可以重新排列外部進程的來源清單。</span><span class="sxs-lookup"><span data-stu-id="85ef4-112">The installer can reorder source lists from an external process.</span></span>

<span data-ttu-id="85ef4-113">具有系統管理許可權的使用者和應用程式，可以讀取和修改下列類型的來源清單資訊：</span><span class="sxs-lookup"><span data-stu-id="85ef4-113">Users and applications that have administrative privileges can read and modify the following types of source list information:</span></span>

-   <span data-ttu-id="85ef4-114">針對系統上的所有使用者安裝的應用程式和修補程式的來源清單。</span><span class="sxs-lookup"><span data-stu-id="85ef4-114">Source lists for applications and patches installed for all users on the system.</span></span>
-   <span data-ttu-id="85ef4-115">存在於應用程式來源之外之修補程式來源的來源清單。</span><span class="sxs-lookup"><span data-stu-id="85ef4-115">Source lists for patch sources that exist apart from the application sources.</span></span>
-   <span data-ttu-id="85ef4-116">存在於網路來源之外的 URL 和媒體來源的來源清單。</span><span class="sxs-lookup"><span data-stu-id="85ef4-116">Source lists for URL and media sources that exist apart from network sources.</span></span>
-   <span data-ttu-id="85ef4-117">來源清單屬性，例如 [**MEDIAPACKAGEPATH**](mediapackagepath.md)、 [**DiskPrompt**](diskprompt.md)、 **LastUsedSource**、 **LastUsedType** 和 **PackageName**。</span><span class="sxs-lookup"><span data-stu-id="85ef4-117">Source list properties such as [**MEDIAPACKAGEPATH**](mediapackagepath.md), [**DiskPrompt**](diskprompt.md), **LastUsedSource**, **LastUsedType**, and **PackageName**.</span></span>

<span data-ttu-id="85ef4-118">來源清單函式可以藉由指定安裝內容和使用者內容，限制找到的來源清單範圍。</span><span class="sxs-lookup"><span data-stu-id="85ef4-118">The source lists functions can limit the scope of the source lists found by specifying the installation context and user context.</span></span> <span data-ttu-id="85ef4-119">有三種可能的安裝內容：每位使用者 (非受控) 、每部電腦，以及每位使用者管理。</span><span class="sxs-lookup"><span data-stu-id="85ef4-119">There are three possible installation contexts: per-user (unmanaged), per-machine, and per-user managed.</span></span> <span data-ttu-id="85ef4-120">使用者內容可以是系統上的特定使用者或所有使用者。</span><span class="sxs-lookup"><span data-stu-id="85ef4-120">The user context can be a particular user or all users on the system.</span></span>

<span data-ttu-id="85ef4-121">非系統管理員無法修改存在於其他使用者的每個使用者 (受控或非受控) 內容中之應用程式或修補程式實例的來源清單。</span><span class="sxs-lookup"><span data-stu-id="85ef4-121">Non-administrators cannot modify the source list of an instance of an application or patch that exists under another user's per-user (managed or unmanaged) context.</span></span> <span data-ttu-id="85ef4-122">非系統管理員可以修改下列內容所安裝之應用程式或修補程式實例的來源清單：</span><span class="sxs-lookup"><span data-stu-id="85ef4-122">Non-administrators can modify the source lists of an instance of an application or patch installed under the following contexts:</span></span>

-   <span data-ttu-id="85ef4-123">自己的每位使用者 (非受控) 內容。</span><span class="sxs-lookup"><span data-stu-id="85ef4-123">Their own per-user(unmanaged) context.</span></span>
-   <span data-ttu-id="85ef4-124">電腦內容，但只有在 [DisableBrowse](disablebrowse.md)、 [AllowLockdownBrowse](allowlockdownbrowse.md)和 [AlwaysInstallElevated](alwaysinstallelevated.md) 原則允許它們流覽應用程式或修補程式來源時才會提供。</span><span class="sxs-lookup"><span data-stu-id="85ef4-124">The machine context, but only if the [DisableBrowse](disablebrowse.md), [AllowLockdownBrowse](allowlockdownbrowse.md), and [AlwaysInstallElevated](alwaysinstallelevated.md) policies allows them to browse for an application or patch source.</span></span>
-   <span data-ttu-id="85ef4-125">他們自己的每個使用者管理內容，但只有在 [DisableBrowse](disablebrowse.md)、 [AllowLockdownBrowse](allowlockdownbrowse.md)和 [AlwaysInstallElevated](alwaysinstallelevated.md) 原則允許他們流覽應用程式或修補程式來源時才可使用。</span><span class="sxs-lookup"><span data-stu-id="85ef4-125">Their own per-user managed context, but only if the [DisableBrowse](disablebrowse.md), [AllowLockdownBrowse](allowlockdownbrowse.md), and [AlwaysInstallElevated](alwaysinstallelevated.md) policies allows them to browse for an application or patch source.</span></span>

<span data-ttu-id="85ef4-126">系統管理員可以修改非系統管理員可以修改的任何來源清單。</span><span class="sxs-lookup"><span data-stu-id="85ef4-126">Administrators can modify any source list that a non-administrator can modify.</span></span> <span data-ttu-id="85ef4-127">此外，具有系統管理許可權的系統管理員和應用程式，可以修改下列內容所安裝之應用程式或修補程式的來源清單：</span><span class="sxs-lookup"><span data-stu-id="85ef4-127">In addition, administrators and applications that have administrative privileges can modify the source lists of an application or patch installed under the following contexts:</span></span>

-   <span data-ttu-id="85ef4-128">每一電腦的內容。</span><span class="sxs-lookup"><span data-stu-id="85ef4-128">Per-machine context.</span></span>
-   <span data-ttu-id="85ef4-129">他們自己的每位使用者 (非受控) 或自己的個別使用者管理內容。</span><span class="sxs-lookup"><span data-stu-id="85ef4-129">Their own per-user (unmanaged) or their own per-user managed context.</span></span>
-   <span data-ttu-id="85ef4-130">另一位使用者的每個使用者管理內容。</span><span class="sxs-lookup"><span data-stu-id="85ef4-130">Another user's per-user managed context.</span></span>

> [!Note]  
> <span data-ttu-id="85ef4-131">具有系統管理許可權的使用者和應用程式無法修改個別使用者 (非受控) 內容中所安裝之應用程式或修補程式實例的來源清單。</span><span class="sxs-lookup"><span data-stu-id="85ef4-131">Users and applications that have administrative privileges cannot modify the source list of an instance of an application or patch installed in the per-user (unmanaged) context of another user.</span></span>

 

## <a name="managing-network-and-url-sources-for-products-and-patches"></a><span data-ttu-id="85ef4-132">管理產品和修補程式的網路和 URL 來源</span><span class="sxs-lookup"><span data-stu-id="85ef4-132">Managing Network and URL sources for Products and Patches</span></span>

<span data-ttu-id="85ef4-133">您可以使用 [**MsiSourceListAddSourceEx**](/windows/desktop/api/Msi/nf-msi-msisourcelistaddsourceexa) 函式，針對特定內容中的修補程式或應用程式，新增或重新排序網路和 URL 來源的來源清單。</span><span class="sxs-lookup"><span data-stu-id="85ef4-133">Use the [**MsiSourceListAddSourceEx**](/windows/desktop/api/Msi/nf-msi-msisourcelistaddsourceexa) function to add or reorder the source list of network and URL sources for a patch or application in a particular context.</span></span> <span data-ttu-id="85ef4-134">使用 *dwCoNtext* 參數來指定安裝內容。</span><span class="sxs-lookup"><span data-stu-id="85ef4-134">Use the *dwContext* parameter to specify the installation context.</span></span> <span data-ttu-id="85ef4-135">使用 *szUserSid* 參數來指定使用者內容。</span><span class="sxs-lookup"><span data-stu-id="85ef4-135">Use the *szUserSid* parameter to specify the user context.</span></span>

<span data-ttu-id="85ef4-136">您可以使用 [**MsiSourceListAddSourceEx**](/windows/desktop/api/Msi/nf-msi-msisourcelistaddsourceexa) 函式，針對尚未套用至指定內容中任何應用程式的修補程式建立來源清單。</span><span class="sxs-lookup"><span data-stu-id="85ef4-136">Use the [**MsiSourceListAddSourceEx**](/windows/desktop/api/Msi/nf-msi-msisourcelistaddsourceexa) function to create a source list for a patch that has not yet been applied to any application in the specified context.</span></span> <span data-ttu-id="85ef4-137">當註冊 patch 以擁有較高的許可權時，這會很有用。</span><span class="sxs-lookup"><span data-stu-id="85ef4-137">This can be useful when registering a patch to have elevated privileges.</span></span> <span data-ttu-id="85ef4-138">如需有關為修補程式註冊更高許可權的詳細資訊，請參閱 [修補 Per-User 受控應用程式](patching-per-user-managed-applications.md)。</span><span class="sxs-lookup"><span data-stu-id="85ef4-138">For more information about registering elevated privileges for a patch, see [Patching Per-User Managed Applications](patching-per-user-managed-applications.md).</span></span>

<span data-ttu-id="85ef4-139">您可以使用 [**MsiSourceListClearSource**](/windows/desktop/api/Msi/nf-msi-msisourcelistclearsourcea) 函式，在指定的內容中移除應用程式或修補程式的現有來源。</span><span class="sxs-lookup"><span data-stu-id="85ef4-139">Use the [**MsiSourceListClearSource**](/windows/desktop/api/Msi/nf-msi-msisourcelistclearsourcea) function to remove an existing source for an application or patch in a specified context.</span></span> <span data-ttu-id="85ef4-140">移除應用程式或修補程式的目前來源，會強制安裝程式在下次需要來源時搜尋來源清單中的來源。</span><span class="sxs-lookup"><span data-stu-id="85ef4-140">Removing the current source for an application or patch forces the installer to search the source list for a source the next time a source is required.</span></span>

<span data-ttu-id="85ef4-141">您可以使用 [**MsiSourceListEnumSources**](/windows/desktop/api/Msi/nf-msi-msisourcelistenumsourcesa) 函式來列舉指定修補程式或應用程式的來源清單中的來源。</span><span class="sxs-lookup"><span data-stu-id="85ef4-141">Use the [**MsiSourceListEnumSources**](/windows/desktop/api/Msi/nf-msi-msisourcelistenumsourcesa) function to enumerate sources in the source list of a specified patch or application.</span></span>

## <a name="managing-media-sources-for-products-and-patches"></a><span data-ttu-id="85ef4-142">管理產品和修補程式的媒體來源</span><span class="sxs-lookup"><span data-stu-id="85ef4-142">Managing Media sources for Products and Patches</span></span>

<span data-ttu-id="85ef4-143">使用 [**MsiSourceListAddMediaDisk**](/windows/desktop/api/Msi/nf-msi-msisourcelistaddmediadiska) 函式來新增或更新已註冊之應用程式或修補程式之媒體來源的磁片資訊。</span><span class="sxs-lookup"><span data-stu-id="85ef4-143">Use the [**MsiSourceListAddMediaDisk**](/windows/desktop/api/Msi/nf-msi-msisourcelistaddmediadiska) function to add or update the disk information of the media source of a registered application or patch.</span></span> <span data-ttu-id="85ef4-144">每個專案都是以磁片識別碼來唯一識別。</span><span class="sxs-lookup"><span data-stu-id="85ef4-144">Each entry is uniquely identified by a disk ID.</span></span> <span data-ttu-id="85ef4-145">如果磁片已存在，則會以新的磁片區標籤和磁片提示值進行更新。</span><span class="sxs-lookup"><span data-stu-id="85ef4-145">If the disk already exists, it is updated with the new volume label and disk prompt values.</span></span> <span data-ttu-id="85ef4-146">如果磁片不存在，就會以新的值建立新的磁片專案。</span><span class="sxs-lookup"><span data-stu-id="85ef4-146">If the disk does not exist, a new disk entry is created with the new values.</span></span>

<span data-ttu-id="85ef4-147">您可以使用 [**MsiSourceListClearMediaDisk**](/windows/desktop/api/Msi/nf-msi-msisourcelistclearmediadiska) 函式，在特定內容中，針對應用程式或修補程式的媒體來源，移除現有的已註冊磁片。</span><span class="sxs-lookup"><span data-stu-id="85ef4-147">Use the [**MsiSourceListClearMediaDisk**](/windows/desktop/api/Msi/nf-msi-msisourcelistclearmediadiska) function to remove an existing registered disk under the media source for an application or patch in a specific context.</span></span>

<span data-ttu-id="85ef4-148">使用 [**MsiSourceListEnumMediaDisks**](/windows/desktop/api/Msi/nf-msi-msisourcelistenummediadisksa) 函式來列舉針對應用程式或修補程式，在媒體來源下註冊的磁片清單。</span><span class="sxs-lookup"><span data-stu-id="85ef4-148">Use the [**MsiSourceListEnumMediaDisks**](/windows/desktop/api/Msi/nf-msi-msisourcelistenummediadisksa) function to enumerate a list of disks registered under the media source for an application or patch.</span></span>

## <a name="retrieval-and-modification-of-source-list-information"></a><span data-ttu-id="85ef4-149">提取和修改來源清單資訊</span><span class="sxs-lookup"><span data-stu-id="85ef4-149">Retrieval and modification of source list information</span></span>

<span data-ttu-id="85ef4-150">您可以使用 [**MsiSourceListGetInfo**](/windows/desktop/api/Msi/nf-msi-msisourcelistgetinfoa) 和 [**MsiSourceListSetInfo**](/windows/desktop/api/Msi/nf-msi-msisourcelistsetinfoa) 函式來抓取或修改特定內容中，應用程式或修補程式的來源清單相關資訊。</span><span class="sxs-lookup"><span data-stu-id="85ef4-150">Use the [**MsiSourceListGetInfo**](/windows/desktop/api/Msi/nf-msi-msisourcelistgetinfoa) and [**MsiSourceListSetInfo**](/windows/desktop/api/Msi/nf-msi-msisourcelistsetinfoa) functions to retrieve or modify information about the source list for an application or patch in a specific context.</span></span> <span data-ttu-id="85ef4-151">使用 *dwCoNtext* 參數來指定安裝內容。</span><span class="sxs-lookup"><span data-stu-id="85ef4-151">Use the *dwContext* parameter to specify the installation context.</span></span> <span data-ttu-id="85ef4-152">使用 *szUserSid* 參數來指定使用者內容。</span><span class="sxs-lookup"><span data-stu-id="85ef4-152">Use the *szUserSid* parameter to specify the user context.</span></span>

<span data-ttu-id="85ef4-153">可以存取來源清單屬性，例如 [**MEDIAPACKAGEPATH**](mediapackagepath.md)、 [**DiskPrompt**](diskprompt.md)、 **LastUsedSource**、 **LastUsedType** 和 **PackageName** 。</span><span class="sxs-lookup"><span data-stu-id="85ef4-153">Source list properties such as [**MEDIAPACKAGEPATH**](mediapackagepath.md), [**DiskPrompt**](diskprompt.md), **LastUsedSource**, **LastUsedType**, and **PackageName** can be accessed.</span></span>

> [!Note]  
> <span data-ttu-id="85ef4-154">只能讀取 **LastUsedType** 來源清單屬性。</span><span class="sxs-lookup"><span data-stu-id="85ef4-154">The **LastUsedType** source list property can only be read.</span></span> <span data-ttu-id="85ef4-155">無法使用 [**MsiSourceListSetInfo**](/windows/desktop/api/Msi/nf-msi-msisourcelistsetinfoa) 函數直接設定。</span><span class="sxs-lookup"><span data-stu-id="85ef4-155">It cannot be set directly using the [**MsiSourceListSetInfo**](/windows/desktop/api/Msi/nf-msi-msisourcelistsetinfoa) function.</span></span>

 

## <a name="clearing-the-complete-source-list-or-forcing-a-source-resolution"></a><span data-ttu-id="85ef4-156">清除完整來源清單或強制進行來源解析</span><span class="sxs-lookup"><span data-stu-id="85ef4-156">Clearing the complete source list or forcing a source resolution</span></span>

<span data-ttu-id="85ef4-157">您可以使用 [**MsiSourceListClearAllEx**](/windows/desktop/api/Msi/nf-msi-msisourcelistclearallexa) 函式，針對指定的應用程式或 patch 實例，移除指定來源類型的所有現有來源。</span><span class="sxs-lookup"><span data-stu-id="85ef4-157">Use the [**MsiSourceListClearAllEx**](/windows/desktop/api/Msi/nf-msi-msisourcelistclearallexa) function to remove all the existing sources of a given source type for the specified application or patch instance.</span></span> <span data-ttu-id="85ef4-158">如果相同內容中的任何應用程式未安裝修補程式，也會移除修補註冊。</span><span class="sxs-lookup"><span data-stu-id="85ef4-158">The patch registration is also removed if the patch is not installed by any application in the same context.</span></span> <span data-ttu-id="85ef4-159">使用 *dwCoNtext* 參數來指定安裝內容。</span><span class="sxs-lookup"><span data-stu-id="85ef4-159">Use the *dwContext* parameter to specify the installation context.</span></span> <span data-ttu-id="85ef4-160">使用 *szUserSid* 參數來指定使用者內容。</span><span class="sxs-lookup"><span data-stu-id="85ef4-160">Use the *szUserSid* parameter to specify the user context.</span></span>

<span data-ttu-id="85ef4-161">使用 [**MsiSourceListForceResolutionEx**](/windows/desktop/api/Msi/nf-msi-msisourcelistforceresolutionexa) 清除在指定的內容中，應用程式或修補程式的上次使用來源專案。</span><span class="sxs-lookup"><span data-stu-id="85ef4-161">Use the [**MsiSourceListForceResolutionEx**](/windows/desktop/api/Msi/nf-msi-msisourcelistforceresolutionexa) to clear the last used source entry for an application or patch in the specified context.</span></span> <span data-ttu-id="85ef4-162">此函式會移除名為 **LastUsedSource** 的屬性註冊。</span><span class="sxs-lookup"><span data-stu-id="85ef4-162">This function removes the registration of the property called **LastUsedSource**.</span></span> <span data-ttu-id="85ef4-163">此函數不會影響已註冊的來源清單。</span><span class="sxs-lookup"><span data-stu-id="85ef4-163">This function does not affect the registered source list.</span></span> <span data-ttu-id="85ef4-164">清除 **LastUsedSource** 註冊會強制安裝程式在下次需要來源時，對已註冊的來源進行來源解析。</span><span class="sxs-lookup"><span data-stu-id="85ef4-164">Clearing the **LastUsedSource** registration forces the installer to do a source resolution against the registered sources the next time it requires the source.</span></span>

 

 



