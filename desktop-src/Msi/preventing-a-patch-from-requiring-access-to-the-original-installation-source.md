---
description: 您無法刪除修補程式應用程式可能需要存取原始安裝來源的所有情況。
ms.assetid: f7028c55-e4a5-4596-af7a-728c9f4f367e
title: 防止 Patch 要求存取原始安裝來源
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: baee8b261ff0a3f6bb94fb141ee765726ffa2ced
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "103848925"
---
# <a name="preventing-a-patch-from-requiring-access-to-the-original-installation-source"></a><span data-ttu-id="8ebf7-103">防止 Patch 要求存取原始安裝來源</span><span class="sxs-lookup"><span data-stu-id="8ebf7-103">Preventing a Patch from Requiring Access to the Original Installation Source</span></span>

<span data-ttu-id="8ebf7-104">您無法刪除修補程式應用程式可能需要存取原始安裝來源的所有情況。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-104">It is not possible to eliminate all circumstances under which the application of a patch may require access to the original installation source.</span></span>

<span data-ttu-id="8ebf7-105">遵循下列各點以將修補程式需要存取原始來源的可能性降至最低：</span><span class="sxs-lookup"><span data-stu-id="8ebf7-105">Adhere to following points to minimize the possibility that your patch will require access to the original source:</span></span>

-   <span data-ttu-id="8ebf7-106">使用僅限整個檔案的修補程式。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-106">Use whole-file only patches.</span></span> <span data-ttu-id="8ebf7-107">這樣就不需要針對所有先前發行的檔案版本建立二進位修補程式。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-107">This eliminates the need to create binary patches for all previously released versions of the file.</span></span> <span data-ttu-id="8ebf7-108">請注意，整個檔案修補程式的大小通常會大於二進位修補程式。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-108">Note that whole file patches are generally larger in size than binary patches.</span></span> <span data-ttu-id="8ebf7-109">您可以輕鬆地將修補程式設為整個檔案修補程式，方法是撰寫 IncludeWholeFilesOnly 屬性，其值為1， (修補程式建立屬性中的一個)  (PCP) 檔。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-109">You can easily set a patch to be a whole file patch by authoring the IncludeWholeFilesOnly property with a value of 1 (one) in the Patch Creation Properties (PCP) file.</span></span>
-   <span data-ttu-id="8ebf7-110">確定您的任何自訂動作都不會存取原始來源位置。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-110">Ensure that none of your custom actions access the original source location.</span></span>
-   <span data-ttu-id="8ebf7-111">確定 ResolveSource 動作是 conditionalized，讓它只在必要時才執行，或者完全不存在。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-111">Ensure that the ResolveSource action is conditionalized so that it only runs when needed, or alternatively is not present at all.</span></span>
-   <span data-ttu-id="8ebf7-112">填入所有未建立版本檔案的 [MsiFileHash 資料表](msifilehash-table.md) 。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-112">Populate the [MsiFileHash Table](msifilehash-table.md) for all unversioned files.</span></span> <span data-ttu-id="8ebf7-113">Msifiler.exe 的 Windows Installer SDK 工具可以輕易地為您完成此作業。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-113">The Windows Installer SDK tool, Msifiler.exe, can easily do this for you.</span></span>
-   <span data-ttu-id="8ebf7-114">確定所有檔案都具有正確的版本和語言資訊。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-114">Ensure that all files have the correct version and language information.</span></span> <span data-ttu-id="8ebf7-115">Msifiler.exe 的 Windows Installer SDK 工具可以輕易地為您完成此作業。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-115">The Windows Installer SDK tool, Msifiler.exe, can easily do this for you.</span></span>

## <a name="source-requirements-when-patching"></a><span data-ttu-id="8ebf7-116">修補時的來源需求</span><span class="sxs-lookup"><span data-stu-id="8ebf7-116">Source Requirements When Patching</span></span>

<span data-ttu-id="8ebf7-117">在下列情況下，可能需要存取原始安裝來源才能套用修補程式：</span><span class="sxs-lookup"><span data-stu-id="8ebf7-117">Access to the original installation sources may be required to apply the patch in the following cases:</span></span>

-   <span data-ttu-id="8ebf7-118">修補程式適用于目前從來源執行的功能。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-118">The patch applies to a feature that is currently run from source.</span></span> <span data-ttu-id="8ebf7-119">在此情況下，此功能會從來源執行狀態轉換為本機狀態。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-119">In this case, the feature is transitioned from the run-from-source state to the local state.</span></span>
-   <span data-ttu-id="8ebf7-120">修補程式適用于遺失或損毀檔案的元件。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-120">The patch applies to a component that has a missing or corrupted file.</span></span>
-   <span data-ttu-id="8ebf7-121">修補程式會套用至元件中的檔案，其中也包含沒有 MsiFileHash 專案的未建立版本檔案。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-121">The patch applies to a file in a component that also contains unversioned files with no MsiFileHash entries.</span></span> <span data-ttu-id="8ebf7-122">需要填入的 [MsiFileHash 資料表](msifilehash-table.md) ，以防止來自來源位置的不必要 recopying 未建立版本檔案。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-122">A populated [MsiFileHash Table](msifilehash-table.md) is required to prevent unnecessary recopying of unversioned files from the source location.</span></span>
-   <span data-ttu-id="8ebf7-123">修補程式是以 amus 或 emus 的 REINSTALLMODE 來套用。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-123">The patch was applied with a REINSTALLMODE of amus or emus.</span></span> <span data-ttu-id="8ebf7-124">這個選項很危險，因為它會執行檔案複製作業，而不論檔案版本為何。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-124">This option is dangerous in that it performs file copy operations regardless of file version.</span></span> <span data-ttu-id="8ebf7-125">這可能會導致檔案 reving，而且幾乎一律需要來源。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-125">This can lead to down-reving of files and almost always requires the source.</span></span> <span data-ttu-id="8ebf7-126">建議的 REINSTALLMODE 值為 omus reinstall。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-126">The recommended REINSTALLMODE value is omus.</span></span>
-   <span data-ttu-id="8ebf7-127">遺漏產品的快取套件。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-127">The cached package for the product is missing.</span></span> <span data-ttu-id="8ebf7-128">修補程式需要有快取的封裝。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-128">The cached package is needed for application of a patch.</span></span> <span data-ttu-id="8ebf7-129">快取的封裝會儲存在% windir% \\ Installer 資料夾中。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-129">The cached package is stored in the %windir%\\Installer folder.</span></span>
-   <span data-ttu-id="8ebf7-130">封裝是為了呼叫 [ResolveSource 動作](resolvesource-action.md)而撰寫的。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-130">The package is authored to make a call to the [ResolveSource Action](resolvesource-action.md).</span></span> <span data-ttu-id="8ebf7-131">此動作通常應該避免或 conditionalized 適當，因為它的執行一律會導致存取來源。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-131">This action should generally be avoided or conditionalized appropriately, because its execution always results in an access to the source.</span></span>
-   <span data-ttu-id="8ebf7-132">套件具有可嘗試以某種方式存取來源的自訂動作。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-132">The package has a custom action that attempts to access the source in some manner.</span></span> <span data-ttu-id="8ebf7-133">最常見的範例是「類型23並行安裝」自訂動作。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-133">The most common example is a type 23 concurrent installation custom action.</span></span>
    > [!Note]  
    > <span data-ttu-id="8ebf7-134">不建議將並行安裝用於安裝應用程式，以供公開發行。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-134">Concurrent installations are not recommended for the installation of applications intended for release to the public.</span></span> <span data-ttu-id="8ebf7-135">如需並行安裝的詳細資訊，請參閱 [並行安裝](concurrent-installations.md)。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-135">For information about concurrent installations please see [Concurrent Installations](concurrent-installations.md).</span></span>

     

-   <span data-ttu-id="8ebf7-136">Patch 封裝是由二進位修補程式所組成，這些修補程式並不會套用到電腦上目前版本的檔案。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-136">The patch package consists of binary patches that do not apply to the current version of the file on the computer.</span></span>

<span data-ttu-id="8ebf7-137">請考慮下列範例，其中 Windows Installer 在套用修補程式時需要存取原始來源：</span><span class="sxs-lookup"><span data-stu-id="8ebf7-137">Consider the following example where Windows Installer requires access to the original source when applying a patch:</span></span>

1.  <span data-ttu-id="8ebf7-138">安裝 RTM 版本的產品範例。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-138">Install RTM version of the product Example.</span></span>
2.  <span data-ttu-id="8ebf7-139">將 patch Qfe1 套用至電腦。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-139">Apply patch Qfe1.msp to the computer.</span></span> <span data-ttu-id="8ebf7-140">此修補程式1.0 版 Example.dll 版本1.1。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-140">This patches version 1.0 of Example.dll to version 1.1.</span></span>
3.  <span data-ttu-id="8ebf7-141">提供新的 patch、Qfe2，它會將 Example.dll 更新至1.2 版和 obsoletes Qfe1 .msp。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-141">A new patch, Qfe2.msp is provided, which updates Example.dll to version 1.2 and obsoletes Qfe1.msp.</span></span> <span data-ttu-id="8ebf7-142">不過，修補程式只會建立為目標1.0 版的 Example.dll，因為它是使用產品的 RTM 版本所產生。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-142">However, the patch was only created to target version 1.0 of Example.dll because it was generated using the RTM version of the product.</span></span> <span data-ttu-id="8ebf7-143">Example.dll 1.2 版包含 Example.dll 1.1 版中所包含的修正程式，但在 RTM 和 QFE2 映射之間產生 .msp 檔案。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-143">Example.dll version 1.2 includes the fix contained in Example.dll version 1.1, but the .msp file was generated between the RTM and QFE2 images.</span></span> <span data-ttu-id="8ebf7-144">因此，當 Qfe2 套用至電腦時，Windows Installer 必須存取原始來源。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-144">So, when Qfe2.msp is applied to the computer, Windows Installer needs to access the original source.</span></span> <span data-ttu-id="8ebf7-145">Example.dll 的二進位修補程式無法套用至1.1 版;它只能套用至1.0 版。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-145">The binary patch for Example.dll cannot apply to version 1.1; it can only apply to version 1.0.</span></span> <span data-ttu-id="8ebf7-146">這會導致安裝程式 recopying 1.0 版的 Example.dll 從原始來源位置開始，以便順利套用修補程式。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-146">This results in the Installer recopying version 1.0 of Example.dll from the original source location so that the patch can be applied successfully.</span></span>

## <a name="source-requirements-when-removing-a-patch"></a><span data-ttu-id="8ebf7-147">移除修補程式時的來源需求</span><span class="sxs-lookup"><span data-stu-id="8ebf7-147">Source Requirements When Removing a Patch</span></span>

<span data-ttu-id="8ebf7-148">如果 Windows Installer 尚未儲存修補程式的基準資訊，可能需要存取原始安裝來源才能移除修補程式。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-148">Access to the original installation sources may be required to remove a patch if the Windows Installer has not stored baseline information about the patch.</span></span> <span data-ttu-id="8ebf7-149">從 Windows Installer 3.0 開始，安裝程式會選擇性地儲存更新檔案時的相關基準資訊。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-149">Beginning with Windows Installer 3.0, the installer selectively saves baseline information about files when they are updated.</span></span> <span data-ttu-id="8ebf7-150">如需基準快取的詳細資訊，請參閱 [減少修補程式大小](reducing-patch-size.md) 。</span><span class="sxs-lookup"><span data-stu-id="8ebf7-150">For more information about the baseline cache, see [Reducing Patch Size](reducing-patch-size.md) .</span></span>

 

 



