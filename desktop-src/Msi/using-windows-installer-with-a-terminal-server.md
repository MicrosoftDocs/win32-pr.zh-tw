---
description: 使用終端機伺服器時，下列可能會影響 Windows Installer 安裝。 當使用者同時使用終端機伺服器時，安裝程式開發人員應該一律測試其 Windows Installer 套件是否如預期般安裝。
ms.assetid: deda9efa-a0fc-4b4e-a531-650ac201fd84
title: 使用 Windows Installer 與終端機伺服器
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d471fa19b4588a01a2730af44fa5e9d978d18859
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104468916"
---
# <a name="using-windows-installer-with-a-terminal-server"></a><span data-ttu-id="fe679-104">使用 Windows Installer 與終端機伺服器</span><span class="sxs-lookup"><span data-stu-id="fe679-104">Using Windows Installer with a Terminal Server</span></span>

<span data-ttu-id="fe679-105">使用終端機伺服器時，下列可能會影響 Windows Installer 安裝。</span><span class="sxs-lookup"><span data-stu-id="fe679-105">The following may affect Windows Installer installations when using a terminal server.</span></span> <span data-ttu-id="fe679-106">當使用者同時使用終端機伺服器時，安裝程式開發人員應該一律測試其 Windows Installer 套件是否如預期般安裝。</span><span class="sxs-lookup"><span data-stu-id="fe679-106">Setup developers should always test that their Windows Installer package installs as expected when users are also using a terminal server.</span></span>

-   <span data-ttu-id="fe679-107">在 Windows Server 2008 和 Windows Vista 之前的作業系統上，必須設定 [EnableAdminTSRemote](enableadmintsremote.md) 系統原則，讓系統管理員能夠在用戶端會話中執行安裝。</span><span class="sxs-lookup"><span data-stu-id="fe679-107">On operating systems earlier than Windows Server 2008 and Windows Vista, the [EnableAdminTSRemote](enableadmintsremote.md) system policy must be set to enable administrators to perform installations in the client session.</span></span> <span data-ttu-id="fe679-108">從 Windows Server 2008 和 Windows Vista 開始，EnableAdminTSRemote 原則不再具有任何作用。</span><span class="sxs-lookup"><span data-stu-id="fe679-108">Beginning with Windows Server 2008 and Windows Vista, the EnableAdminTSRemote policy no longer has any effect.</span></span> <span data-ttu-id="fe679-109">無論其設定為何，系統管理員和非系統管理員都可以在用戶端會話或主控台會話中執行安裝。</span><span class="sxs-lookup"><span data-stu-id="fe679-109">Regardless of its setting, administrators and non-administrators can perform an installation in the client session or the console session.</span></span> <span data-ttu-id="fe679-110">系統管理員和非系統管理員隨時都可以在主控台會話中執行 Windows Installer 安裝。</span><span class="sxs-lookup"><span data-stu-id="fe679-110">Administrators and non-administrators can always perform Windows Installer installations in the console session.</span></span>
-   <span data-ttu-id="fe679-111">如果[DisableUserInstalls](disableuserinstalls.md)[系統原則](system-policy.md)設定為1，Windows Installer 會防止在個別使用者[安裝內容](installation-context.md)中進行安裝。</span><span class="sxs-lookup"><span data-stu-id="fe679-111">The Windows Installer prevents installation in the per-user [installation context](installation-context.md) if the [DisableUserInstalls](disableuserinstalls.md)[system policy](system-policy.md) is set to 1.</span></span> <span data-ttu-id="fe679-112">在此情況下，安裝程式會忽略所有註冊為每位使用者的應用程式，而且只會搜尋以每一電腦註冊的應用程式。</span><span class="sxs-lookup"><span data-stu-id="fe679-112">In this case, the installer ignores all applications registered as per-user and searches only for applications registered as per-machine.</span></span>
-   <span data-ttu-id="fe679-113">當系統管理員在 Windows 2000 中裝載的終端機伺服器的用戶端會話中執行安裝時，安裝必須使用 UNC 路徑，而不是對應的磁碟機號。</span><span class="sxs-lookup"><span data-stu-id="fe679-113">When an administrator performs an installation in a client session of a terminal server that is hosted in Windows 2000, the installation must use a UNC path and not a mapped drive letter.</span></span>

<span data-ttu-id="fe679-114">開發人員在開發可與終端機伺服器搭配使用的 Windows Installer 元件時，應遵循下列指導方針。</span><span class="sxs-lookup"><span data-stu-id="fe679-114">Developers should adhere to the following guidelines when developing a Windows Installer component that may be used with a terminal server.</span></span>

-   <span data-ttu-id="fe679-115">在登錄的 **HKCU** Software 部分中，寫入所有 **hkcu** 登錄資訊 \\  。</span><span class="sxs-lookup"><span data-stu-id="fe679-115">Write all **HKCU** registry information in the **HKCU**\\**Software** part of the registry.</span></span>
-   <span data-ttu-id="fe679-116">不建議將設定資訊儲存在 INI 檔案中。</span><span class="sxs-lookup"><span data-stu-id="fe679-116">Storing configuration information in INI files is not recommended.</span></span>
-   <span data-ttu-id="fe679-117">第一次執行應用程式時，而不是在安裝時，將每個使用者的資訊寫入登錄中。</span><span class="sxs-lookup"><span data-stu-id="fe679-117">Write per-user information to the registry when the application is run for the first time and not at installation time.</span></span> <span data-ttu-id="fe679-118">如果您必須在安裝時將每位使用者的資訊寫入登錄，請將每位使用者和每一電腦的資訊分成不同的 Windows Installer 元件。</span><span class="sxs-lookup"><span data-stu-id="fe679-118">If you must write per-user information to the registry at installation time, separate the per-user and per-machine information into different Windows Installer components.</span></span> <span data-ttu-id="fe679-119">撰寫套件，讓安裝程式在安裝應用程式時，不會嘗試驗證及修復包含每個使用者資訊的元件。</span><span class="sxs-lookup"><span data-stu-id="fe679-119">Author the package such that the installer does not attempt to validate and repair the components containing per-user information when the application is installed.</span></span>
-   <span data-ttu-id="fe679-120">僅適用于每部電腦安裝的套件，應該 \* 在 [環境資料表](environment-table.md)的 [名稱] 資料行中包含，將環境變數寫入電腦的環境中。</span><span class="sxs-lookup"><span data-stu-id="fe679-120">A package used for only per-machine installations should write environment variables to the computer's environment by including \* in the Name column of the [Environment Table](environment-table.md).</span></span> <span data-ttu-id="fe679-121">如果封裝可用於每個使用者安裝或每部電腦安裝，請使用兩個元件。</span><span class="sxs-lookup"><span data-stu-id="fe679-121">If the package can be used for per-user installations or per-machine installations, use two components.</span></span> <span data-ttu-id="fe679-122">在 [元件資料表](condition-table.md) 中包含每個使用者的元件，並在 [環境] 資料表中輸入使用者設定。</span><span class="sxs-lookup"><span data-stu-id="fe679-122">Include the per-user component in the [Component Table](condition-table.md) and enter the user settings in the Environment Table.</span></span> <span data-ttu-id="fe679-123">在元件資料表中包含每一電腦的元件，並在 [環境] 資料表中輸入電腦設定。</span><span class="sxs-lookup"><span data-stu-id="fe679-123">Include the per-machine component in the Component Table and enter the computer settings in the Environment Table.</span></span> <span data-ttu-id="fe679-124">根據元件資料表的條件欄位中的 [**ALLUSERS**](allusers.md) 屬性，使用條件陳述式來控制要安裝的元件。</span><span class="sxs-lookup"><span data-stu-id="fe679-124">Control which component gets installed by using conditional statements based upon the [**ALLUSERS**](allusers.md) property in the Condition field of the Component Table.</span></span>
-   <span data-ttu-id="fe679-125">從終端機伺服器執行每部電腦安裝時，安裝程式會將每個使用者的環境變數寫入 **HKCU** \\ **。預設** \\ **環境**。</span><span class="sxs-lookup"><span data-stu-id="fe679-125">When performing per-machine installations from a terminal server, the installer writes per-user environment variables to **HKCU**\\ **.Default**\\**Environment**.</span></span> <span data-ttu-id="fe679-126">因為終端機伺服器不會複寫登錄的這個區段，所以安裝不會設定每個使用者的環境變數。</span><span class="sxs-lookup"><span data-stu-id="fe679-126">Because the terminal server does not replicate this section of the registry, the installation does not set the per-user environment variables.</span></span>
-   <span data-ttu-id="fe679-127">因為伺服器可能設定為防止使用者修復應用程式，所以您的應用程式應該正常地處理遺失登錄機碼的情況。</span><span class="sxs-lookup"><span data-stu-id="fe679-127">Because a server may be configured to prevent users from repairing applications, your application should handle the case of missing registry keys gracefully.</span></span>

<span data-ttu-id="fe679-128">當使用 DLL、EXE 或腳本 [自訂動作](custom-actions.md) 的 Windows Installer 封裝安裝在終端機伺服器上的每部電腦安裝內容中時，將會發生下列情況。</span><span class="sxs-lookup"><span data-stu-id="fe679-128">The following applies when a Windows Installer package that uses DLL, EXE, or Script [custom actions](custom-actions.md) is installed in the per-machine installation context on a terminal server.</span></span> <span data-ttu-id="fe679-129">在此情況下，安裝程式會設定 [**TerminalServer**](terminalserver.md) 屬性。</span><span class="sxs-lookup"><span data-stu-id="fe679-129">In this case, the installer sets the [**TerminalServer**](terminalserver.md) property.</span></span>

-   <span data-ttu-id="fe679-130">延遲的自訂動作會在本機系統的內容中執行，除非該動作具有 **msidbCustomActionTypeTSAware** 屬性。</span><span class="sxs-lookup"><span data-stu-id="fe679-130">Deferred custom actions run in the context of the local system unless the action has the **msidbCustomActionTypeTSAware** attribute.</span></span> <span data-ttu-id="fe679-131">即使自訂動作在非終端機伺服器的系統上模擬使用者，也是如此。</span><span class="sxs-lookup"><span data-stu-id="fe679-131">This is true even if the custom action impersonates the user on a system that is not a terminal server.</span></span> <span data-ttu-id="fe679-132">請注意，如果自訂動作的 **msidbCustomActionTypeTSAware** 屬性變更了使用者的登錄，安裝程式就不會自動確保電腦上每位使用者的登錄中也會進行這些變更。</span><span class="sxs-lookup"><span data-stu-id="fe679-132">Note that if a custom action having the **msidbCustomActionTypeTSAware** attribute changes the user's registry, the installer does not automatically ensure that those changes are also made in the registry of every user on the computer.</span></span>
-   <span data-ttu-id="fe679-133">在延遲的自訂動作中，從 **HKCU** 登錄 hive 讀取的任何登錄作業都會看到系統的預設登錄區，而不是目前使用者的登錄 hive。</span><span class="sxs-lookup"><span data-stu-id="fe679-133">Any registry operations in a deferred custom action that read from the **HKCU** registry hive sees the system's default registry hive and not the current user's registry hive.</span></span>
-   <span data-ttu-id="fe679-134">在延遲的自訂動作中，寫入 **HKCU** 軟體的任何登錄作業 \\ 都是由安裝程式偵測到，並且會在使用者下次登入時複製到電腦的每個使用者。</span><span class="sxs-lookup"><span data-stu-id="fe679-134">Any registry operations in a deferred custom action that write to **HKCU**\\**Software** are detected by the installer and copied to every user of the computer at the next logon of the user.</span></span>
-   <span data-ttu-id="fe679-135">安裝程式不會偵測到在延遲自訂動作中寫入 **HKCU** 但不在 **HKCU** \\ **Software** 登錄機碼下的任何登錄作業。</span><span class="sxs-lookup"><span data-stu-id="fe679-135">Any registry operations in a deferred custom action that write to **HKCU**, but are not under the **HKCU**\\**Software** registry key, are not detected by the installer or copied.</span></span>

<span data-ttu-id="fe679-136">如需詳細資訊，請參閱 Microsoft Windows 軟體開發套件 (SDK) 中的 [終端機服務](../termserv/terminal-services-portal.md) 。</span><span class="sxs-lookup"><span data-stu-id="fe679-136">For more information, see [Terminal Services](../termserv/terminal-services-portal.md) in the Microsoft Windows Software Development Kit (SDK).</span></span>

## <a name="related-topics"></a><span data-ttu-id="fe679-137">相關主題</span><span class="sxs-lookup"><span data-stu-id="fe679-137">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="fe679-138">EnableAdminTSRemote</span><span class="sxs-lookup"><span data-stu-id="fe679-138">EnableAdminTSRemote</span></span>](enableadmintsremote.md)
</dt> <dt>

[<span data-ttu-id="fe679-139">**TerminalServer 屬性**</span><span class="sxs-lookup"><span data-stu-id="fe679-139">**TerminalServer property**</span></span>](terminalserver.md)
</dt> <dt>

[<span data-ttu-id="fe679-140">**RemoteAdminTS 屬性**</span><span class="sxs-lookup"><span data-stu-id="fe679-140">**RemoteAdminTS property**</span></span>](remoteadmints.md)
</dt> <dt>

[<span data-ttu-id="fe679-141">終端機服務</span><span class="sxs-lookup"><span data-stu-id="fe679-141">Terminal Services</span></span>](../termserv/terminal-services-portal.md)
</dt> </dl>

 

 
