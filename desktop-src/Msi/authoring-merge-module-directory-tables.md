---
description: 合併模組可以套用至 .msi 檔案，以將目錄新增至安裝，但是無法取代或移除任何現有的目錄。
ms.assetid: 5b808aa2-b2b2-4703-bd57-0b5e1e73b306
title: 撰寫合併模組目錄資料表
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 98332f2c0bda10a5cc076f0ec80df3bf4b2e05aa
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "103848960"
---
# <a name="authoring-merge-module-directory-tables"></a><span data-ttu-id="6d344-103">撰寫合併模組目錄資料表</span><span class="sxs-lookup"><span data-stu-id="6d344-103">Authoring Merge Module Directory Tables</span></span>

<span data-ttu-id="6d344-104">合併模組可以套用至 .msi 檔案，以將目錄新增至安裝，但是無法取代或移除任何現有的目錄。</span><span class="sxs-lookup"><span data-stu-id="6d344-104">A merge module can be applied to an .msi file to add directories to the installation but it cannot replace or remove any existing directories.</span></span> <span data-ttu-id="6d344-105">[目錄資料表](directory-table.md)會指定合併模組提供給目標安裝之目錄的版面配置。</span><span class="sxs-lookup"><span data-stu-id="6d344-105">The [Directory table](directory-table.md) specifies the layout of the directories the merge module provides to the target installation.</span></span> <span data-ttu-id="6d344-106">每個合併模組都需要目錄資料表。</span><span class="sxs-lookup"><span data-stu-id="6d344-106">A Directory table is required in every merge module.</span></span>

<span data-ttu-id="6d344-107">在合併模組中撰寫目錄資料表時，請使用下列指導方針。</span><span class="sxs-lookup"><span data-stu-id="6d344-107">Use the following guidelines when authoring the Directory Table in a merge module.</span></span> <span data-ttu-id="6d344-108">如需詳細資訊，請參閱 [目錄資料表](directory-table.md) 和 [使用目錄資料表](using-the-directory-table.md)。</span><span class="sxs-lookup"><span data-stu-id="6d344-108">For more information, see [Directory Table](directory-table.md) and [Using The Directory Table](using-the-directory-table.md).</span></span>

-   <span data-ttu-id="6d344-109">合併模組新增的目錄結構必須有單一根目錄。</span><span class="sxs-lookup"><span data-stu-id="6d344-109">The directory structure added by the merge module must have a single root directory.</span></span> <span data-ttu-id="6d344-110">根目錄必須命名為 TARGETDIR。</span><span class="sxs-lookup"><span data-stu-id="6d344-110">The root must be named TARGETDIR.</span></span> <span data-ttu-id="6d344-111">使用者可能會在合併期間變更 TARGETDIR 的值，以指定要將模組目錄結構附加至目標目錄樹狀結構的位置。</span><span class="sxs-lookup"><span data-stu-id="6d344-111">The user may change the value of TARGETDIR during the merge to specify where to attach the module's directory structure onto the target's directory tree.</span></span>
-   <span data-ttu-id="6d344-112">目錄資料表以外的合併模組資料表不能直接參考要 TARGETDIR 的目錄位置。</span><span class="sxs-lookup"><span data-stu-id="6d344-112">Merge module tables other than the Directory table must not directly reference directory locations to TARGETDIR.</span></span> <span data-ttu-id="6d344-113">如果使用者變更了 TARGETDIR 的值，這類參考的位置就會變更。</span><span class="sxs-lookup"><span data-stu-id="6d344-113">The location of such a reference changes if the value of TARGETDIR is changed by the user.</span></span>
-   <span data-ttu-id="6d344-114">合併模組中的資料表必須參考 TARGETDIR 的子目錄位置，或合併模組樹狀結構中的另一個目錄。</span><span class="sxs-lookup"><span data-stu-id="6d344-114">The tables in the merge module must reference the location of a child directory of TARGETDIR, or another directory in the merge module's tree.</span></span> <span data-ttu-id="6d344-115">執行下列動作，將 TARGETDIR 指定為合併模組中目錄的父系。</span><span class="sxs-lookup"><span data-stu-id="6d344-115">Do the following to specify TARGETDIR as the parent of a directory in the merge module.</span></span> <span data-ttu-id="6d344-116">在 [目錄] 資料行中輸入目錄，然後在目錄父資料行中輸入 TARGETDIR \_ 。</span><span class="sxs-lookup"><span data-stu-id="6d344-116">Enter the directory into the Directory column and enter TARGETDIR into the Directory\_Parent column.</span></span> <span data-ttu-id="6d344-117">在 DefaultDir 資料行中使用 "." 標記法，以表示此目錄位於沒有子目錄的 TARGETDIR 中。</span><span class="sxs-lookup"><span data-stu-id="6d344-117">Use the "." notation in the DefaultDir column to indicate that this directory is located in TARGETDIR without a subdirectory.</span></span> <span data-ttu-id="6d344-118">如需詳細資訊，請參閱 [使用目錄資料表](using-the-directory-table.md)。</span><span class="sxs-lookup"><span data-stu-id="6d344-118">For more information, see [Using the Directory Table](using-the-directory-table.md).</span></span>
-   <span data-ttu-id="6d344-119">合併模組新增的目錄名稱必須使用在 [合併模組資料庫中命名主鍵](naming-primary-keys-in-merge-module-databases.md)所述的命名慣例。</span><span class="sxs-lookup"><span data-stu-id="6d344-119">The names of directories added by the merge module must use the naming conventions described in [Naming Primary Keys in Merge Module Databases](naming-primary-keys-in-merge-module-databases.md).</span></span> <span data-ttu-id="6d344-120">這包括依屬性（例如 [**SystemFolder**](systemfolder.md) 屬性和 [**ProgramFilesFolder**](programfilesfolder.md) 屬性）預先定義的目錄。</span><span class="sxs-lookup"><span data-stu-id="6d344-120">This includes directories predefined by properties such as the [**SystemFolder**](systemfolder.md) property and [**ProgramFilesFolder**](programfilesfolder.md) property.</span></span>
-   <span data-ttu-id="6d344-121">將 [*GUID*](g-gly.md) 附加至目錄資料表中的每個專案 (但 TARGETDIR 除外。 ) 這包含指定 Windows Installer [**SystemFolder**](systemfolder.md) 屬性的目錄資料表專案，例如 SystemFolder. 00000000 \_ 0000 \_ 0000 \_ 0000 \_ 000000000000。</span><span class="sxs-lookup"><span data-stu-id="6d344-121">Append a [*GUID*](g-gly.md) to every entry in the Directory table (except TARGETDIR.) This includes Directory table entries that specify Windows Installer [**SystemFolder**](systemfolder.md) properties, for example, SystemFolder.00000000\_0000\_0000\_0000\_000000000000.</span></span> <span data-ttu-id="6d344-122">程式庫 Mergemod.dll 會新增自訂動作來設定 **SystemFolder** 屬性。</span><span class="sxs-lookup"><span data-stu-id="6d344-122">The library Mergemod.dll adds custom actions to set the **SystemFolder** property.</span></span>
-   <span data-ttu-id="6d344-123">當合併模組中包含預先定義的目錄時，合併工具會自動將 [自訂動作類型 51](custom-action-type-51.md) 新增至目標資料庫。</span><span class="sxs-lookup"><span data-stu-id="6d344-123">When a predefined directory is included in a merge module, the merge tool automatically adds a [Custom Action Type 51](custom-action-type-51.md) to the target database.</span></span> <span data-ttu-id="6d344-124">合併模組作者必須確定也包含 [CustomAction 資料表](customaction-table.md) 。</span><span class="sxs-lookup"><span data-stu-id="6d344-124">The merge module author must ensure that a [CustomAction table](customaction-table.md) is also included.</span></span> <span data-ttu-id="6d344-125">CustomAction 資料表可能是空的，但此資料表必須存在於目標資料庫中，並確保修改過的預先定義目錄會寫入正確的位置。</span><span class="sxs-lookup"><span data-stu-id="6d344-125">The CustomAction table may be empty, but this table is required to exist in the target database and ensures that the modified predefined directories are written to the correct locations.</span></span> <span data-ttu-id="6d344-126">例如，當合併模組中包含系統目錄時，合併模組作者必須確定自訂動作資料表是否存在。</span><span class="sxs-lookup"><span data-stu-id="6d344-126">For example, when a system directory is included in a merge module, the merge module author must ensure that a Custom Action table exists.</span></span>

    <span data-ttu-id="6d344-127">請注意，產生這些類型51自訂動作的相符演算法只會檢查目錄名稱的開頭是否為其中一個預先定義的 [**SystemFolder**](systemfolder.md) 屬性。</span><span class="sxs-lookup"><span data-stu-id="6d344-127">Note that the matching algorithm for the generation of these type 51 custom actions only checks that the directory name begins with one of the predefined [**SystemFolder**](systemfolder.md) properties.</span></span> <span data-ttu-id="6d344-128">它不會驗證目錄名稱是否與 directory 屬性完全相等。</span><span class="sxs-lookup"><span data-stu-id="6d344-128">It does not verify that the directory name exactly equals the directory property.</span></span> <span data-ttu-id="6d344-129">任何以這些標準資料夾名稱開頭的任何目錄都會取得類型51自訂動作，即使名稱的其餘部分不是 GUID 也一樣。</span><span class="sxs-lookup"><span data-stu-id="6d344-129">Any directory beginning with one of these standard folder names gets a type 51 custom action, even if the rest of the name is not a GUID.</span></span> <span data-ttu-id="6d344-130">作者必須注意，這不會在以其中一個 **SystemFolder** 屬性開頭的衍生主鍵上產生錯誤的正面相符專案，以及非預期的自訂動作產生。</span><span class="sxs-lookup"><span data-stu-id="6d344-130">Authors need to take care that this does not generate false positive matches, and unintended custom action generation, on derivative primary keys that begin with one of the **SystemFolder** properties.</span></span>

<span data-ttu-id="6d344-131">以下是合併模組中的目錄資料表和預期的已解析目錄範例。</span><span class="sxs-lookup"><span data-stu-id="6d344-131">The following is an example of a Directory table in a merge module and the expected resolved directories.</span></span>



| <span data-ttu-id="6d344-132">目錄</span><span class="sxs-lookup"><span data-stu-id="6d344-132">Directory</span></span>                                              | <span data-ttu-id="6d344-133">目錄 \_ 父系</span><span class="sxs-lookup"><span data-stu-id="6d344-133">Directory\_Parent</span></span>                                | <span data-ttu-id="6d344-134">DefaultDir</span><span class="sxs-lookup"><span data-stu-id="6d344-134">DefaultDir</span></span>  |
|--------------------------------------------------------|--------------------------------------------------|-------------|
| <span data-ttu-id="6d344-135">TARGETDIR</span><span class="sxs-lookup"><span data-stu-id="6d344-135">TARGETDIR</span></span>                                              |                                                  | <span data-ttu-id="6d344-136">SourceDir</span><span class="sxs-lookup"><span data-stu-id="6d344-136">SourceDir</span></span>   |
| <span data-ttu-id="6d344-137">Dir00. BC82E350 \_ C7FC \_ 11d1 \_ A848-006097ABDE17</span><span class="sxs-lookup"><span data-stu-id="6d344-137">Dir00.BC82E350\_ C7FC\_11d1\_ A848-006097ABDE17</span></span>        | <span data-ttu-id="6d344-138">TARGETDIR</span><span class="sxs-lookup"><span data-stu-id="6d344-138">TARGETDIR</span></span>                                        | <span data-ttu-id="6d344-139">.： MMM \_ 進程</span><span class="sxs-lookup"><span data-stu-id="6d344-139">.:MMM\_Prog</span></span> |
| <span data-ttu-id="6d344-140">SystemFolder. BC82E350 \_ C7FC \_ 11d1 \_ A848-006097ABDE17</span><span class="sxs-lookup"><span data-stu-id="6d344-140">SystemFolder.BC82E350\_ C7FC\_11d1\_ A848-006097ABDE17</span></span> | <span data-ttu-id="6d344-141">TARGETDIR</span><span class="sxs-lookup"><span data-stu-id="6d344-141">TARGETDIR</span></span>                                        | <span data-ttu-id="6d344-142">MMM \_ Sys</span><span class="sxs-lookup"><span data-stu-id="6d344-142">MMM\_Sys</span></span>    |
| <span data-ttu-id="6d344-143">Dir02. BC82E350 \_ C7FC \_ 11d1 \_ A848-006097ABDE17</span><span class="sxs-lookup"><span data-stu-id="6d344-143">Dir02.BC82E350\_ C7FC\_11d1\_ A848-006097ABDE17</span></span>        | <span data-ttu-id="6d344-144">Dir00. BC82E350 \_ C7FC \_ 11d1 \_ A848 \_ 006097ABDE17</span><span class="sxs-lookup"><span data-stu-id="6d344-144">Dir00.BC82E350\_ C7FC\_11d1\_ A848\_006097ABDE17</span></span> | <span data-ttu-id="6d344-145">MFC \_ OCX</span><span class="sxs-lookup"><span data-stu-id="6d344-145">MFC\_OCX</span></span>    |



 

<span data-ttu-id="6d344-146">具有上述目錄資料表的合併模組預期會產生下列目錄結構。</span><span class="sxs-lookup"><span data-stu-id="6d344-146">A merge module with the above Directory table is expected to result in the following directory structure.</span></span>



| <span data-ttu-id="6d344-147">目錄</span><span class="sxs-lookup"><span data-stu-id="6d344-147">Directory</span></span>                                              | <span data-ttu-id="6d344-148">目標</span><span class="sxs-lookup"><span data-stu-id="6d344-148">Target</span></span>                                     | <span data-ttu-id="6d344-149">來源</span><span class="sxs-lookup"><span data-stu-id="6d344-149">Source</span></span>                                               |
|--------------------------------------------------------|--------------------------------------------|------------------------------------------------------|
| <span data-ttu-id="6d344-150">Dir00. BC82E350 \_ C7FC \_ 11d1 \_ A848-006097ABDE17</span><span class="sxs-lookup"><span data-stu-id="6d344-150">Dir00.BC82E350\_ C7FC\_11d1\_ A848-006097ABDE17</span></span>        | <span data-ttu-id="6d344-151">\[合併模組的安裝點\]</span><span class="sxs-lookup"><span data-stu-id="6d344-151">\[Merge Module's Install Point\]</span></span>\\         | <span data-ttu-id="6d344-152">\[合併模組的來源點 \] \\ MMM \_ 進程</span><span class="sxs-lookup"><span data-stu-id="6d344-152">\[Merge Module's Source Point\]\\MMM\_Prog</span></span>           |
| <span data-ttu-id="6d344-153">SystemFolder. BC82E350 \_ C7FC \_ 11d1 \_ A848-006097ABDE17</span><span class="sxs-lookup"><span data-stu-id="6d344-153">SystemFolder.BC82E350\_ C7FC\_11d1\_ A848-006097ABDE17</span></span> | <span data-ttu-id="6d344-154">\[SystemFolder\]</span><span class="sxs-lookup"><span data-stu-id="6d344-154">\[SystemFolder\]</span></span>\\                         | <span data-ttu-id="6d344-155">\[合併模組的來源點 \] \\ MMM \_ Sys</span><span class="sxs-lookup"><span data-stu-id="6d344-155">\[Merge Module's Source Point\]\\MMM\_Sys</span></span>            |
| <span data-ttu-id="6d344-156">Dir02. BC82E350 \_ C7FC \_ 11d1 \_ A848-006097ABDE17</span><span class="sxs-lookup"><span data-stu-id="6d344-156">Dir02.BC82E350\_ C7FC\_11d1\_ A848-006097ABDE17</span></span>        | <span data-ttu-id="6d344-157">\[合併模組的安裝點 \] \\ MFC \_ OCX</span><span class="sxs-lookup"><span data-stu-id="6d344-157">\[Merge Module's Install Point\]\\MFC\_OCX</span></span> | <span data-ttu-id="6d344-158">\[合併模組的來源點 \] \\ MMM \_ 程式 \\ MFC \_ OCX</span><span class="sxs-lookup"><span data-stu-id="6d344-158">\[Merge Module's Source Point\]\\MMM\_Prog\\MFC\_OCX</span></span> |



 

 

 



