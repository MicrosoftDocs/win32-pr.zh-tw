---
description: 合併模組提供一種標準方法，可讓開發人員將共用的 Windows Installer 元件和設定邏輯傳遞給其應用程式。
ms.assetid: 3eb087b1-0f44-40d8-a950-67d489f09408
title: 使用 API 將合併模組合併至資料庫
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2e68298671045825dda41ad120896fa22c89f068
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "106987680"
---
# <a name="using-the-api-to-merge-a-merge-module-into-a-database"></a><span data-ttu-id="f4a97-103">使用 API 將合併模組合併至資料庫</span><span class="sxs-lookup"><span data-stu-id="f4a97-103">Using the API to Merge a Merge Module into a Database</span></span>

<span data-ttu-id="f4a97-104">[合併模組](merge-modules.md) 提供一種標準方法，可讓開發人員將共用的 Windows Installer [*元件*](c-gly.md) 和設定邏輯傳遞給其應用程式。</span><span class="sxs-lookup"><span data-stu-id="f4a97-104">[Merge modules](merge-modules.md) provide a standard method for developers to deliver shared Windows Installer [*components*](c-gly.md) and setup logic to their applications.</span></span> <span data-ttu-id="f4a97-105">合併模組必須合併為使用合併工具的安裝套件。</span><span class="sxs-lookup"><span data-stu-id="f4a97-105">Merge modules must be merged into an installation package using a merge tool.</span></span> <span data-ttu-id="f4a97-106">最好的替代方法是取得自由散發的合併工具，或購買獨立軟體廠商提供的其中一個合併工具。</span><span class="sxs-lookup"><span data-stu-id="f4a97-106">The best alternative is to obtain a freely distributed merge tool or purchase one of the merging tools available from independent software vendors.</span></span> <span data-ttu-id="f4a97-107">例如，您可以使用 [Mergemod.dll](merge-module-automation.md)所提供的功能。</span><span class="sxs-lookup"><span data-stu-id="f4a97-107">For example you can use the functionality provided by [Mergemod.dll](merge-module-automation.md).</span></span>

<span data-ttu-id="f4a97-108">依序使用下列步驟，透過 [Mergemod.dll](merge-module-automation.md)的 API 將合併模組合併到 Windows Installer 安裝資料庫中。</span><span class="sxs-lookup"><span data-stu-id="f4a97-108">Use the following steps in sequence to merge a merge module into a Windows Installer installation database by the API of [Mergemod.dll](merge-module-automation.md).</span></span>

<span data-ttu-id="f4a97-109">**將合併模組合併到 Windows Installer 安裝資料庫**</span><span class="sxs-lookup"><span data-stu-id="f4a97-109">**To merge a merge module into a Windows Installer installation database**</span></span>

1.  <span data-ttu-id="f4a97-110">使用 [**OpenLog**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-openlog)開啟記錄檔。</span><span class="sxs-lookup"><span data-stu-id="f4a97-110">Open a log file using [**OpenLog**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-openlog).</span></span> <span data-ttu-id="f4a97-111">只有當您需要為合併進程建立記錄檔或附加現有的記錄檔時，才需要執行此步驟。</span><span class="sxs-lookup"><span data-stu-id="f4a97-111">This step is required only if you need to create a log file, or append an existing log file, for the merge process.</span></span>
2.  <span data-ttu-id="f4a97-112">開啟安裝資料庫（ [.msi](windows-installer-file-extensions.md)檔案），該檔案將會使用 [**OpenDatabase**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-opendatabase)接收合併模組。</span><span class="sxs-lookup"><span data-stu-id="f4a97-112">Open the installation database, an [.msi file](windows-installer-file-extensions.md), that will receive the merge module using [**OpenDatabase**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-opendatabase).</span></span> <span data-ttu-id="f4a97-113">這是必要步驟。</span><span class="sxs-lookup"><span data-stu-id="f4a97-113">This step is required.</span></span>
3.  <span data-ttu-id="f4a97-114">開啟使用 [**OpenModule**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-openmodule)合併到資料庫的 merge 模組（ [.msm](windows-installer-file-extensions.md)檔案）。</span><span class="sxs-lookup"><span data-stu-id="f4a97-114">Open the merge module, an [.msm file](windows-installer-file-extensions.md), that is being merged into the database using [**OpenModule**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-openmodule).</span></span> <span data-ttu-id="f4a97-115">必須先開啟模組，才能與安裝資料庫合併。</span><span class="sxs-lookup"><span data-stu-id="f4a97-115">A module must be opened before it can be merged with an installation database.</span></span> <span data-ttu-id="f4a97-116">這是必要步驟。</span><span class="sxs-lookup"><span data-stu-id="f4a97-116">This step is required.</span></span>
4.  <span data-ttu-id="f4a97-117">使用 [**merge**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-merge) 或 [**MergeEx**](/windows/desktop/api/Mergemod/nf-mergemod-imsmmerge2-mergeex)將模組合併至安裝資料庫。</span><span class="sxs-lookup"><span data-stu-id="f4a97-117">Merge the module into the installation database by using [**Merge**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-merge) or [**MergeEx**](/windows/desktop/api/Mergemod/nf-mergemod-imsmmerge2-mergeex).</span></span> <span data-ttu-id="f4a97-118">請注意， **merge** 或 **MergeEx** 只能呼叫一次，以合併 .msi 和 .msm 檔案的特定組合。</span><span class="sxs-lookup"><span data-stu-id="f4a97-118">Note that **Merge** or **MergeEx** can only be called once to merge a particular combination of .msi and .msm files.</span></span> <span data-ttu-id="f4a97-119">只有在使用 [Mergemod.dll 2.0 版](merge-module-automation.md)或更新版本，且只有在使用 [IMsmMerge2](/windows/desktop/api/Mergemod/nn-mergemod-imsmmerge2)介面時，才能使用 **MergeEx** 。</span><span class="sxs-lookup"><span data-stu-id="f4a97-119">**MergeEx** is only available when using [Mergemod.dll version 2.0](merge-module-automation.md) or later and only when using the [IMsmMerge2](/windows/desktop/api/Mergemod/nn-mergemod-imsmmerge2) interface.</span></span> <span data-ttu-id="f4a97-120">這是必要步驟。</span><span class="sxs-lookup"><span data-stu-id="f4a97-120">This step is required.</span></span>
5.  <span data-ttu-id="f4a97-121">呼叫 [**取得 \_ 錯誤**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-get_errors) ，並檢查針對合併衝突或其他錯誤所抓取的錯誤收集。</span><span class="sxs-lookup"><span data-stu-id="f4a97-121">Call [**get\_Errors**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-get_errors) and examine the retrieved collection of errors for merge conflicts or other errors.</span></span> <span data-ttu-id="f4a97-122">抓取是非破壞性的。</span><span class="sxs-lookup"><span data-stu-id="f4a97-122">The retrieval is non-destructive.</span></span> <span data-ttu-id="f4a97-123">您可以重複讀取呼叫的 **get \_ 錯誤**，以抓取錯誤集合的多個實例。</span><span class="sxs-lookup"><span data-stu-id="f4a97-123">Multiple instances of the error collection may be retrieved by repeatedly reading calling **get\_Errors**.</span></span> <span data-ttu-id="f4a97-124">您將需要解決適合您案例的任何錯誤。</span><span class="sxs-lookup"><span data-stu-id="f4a97-124">You will need to resolve any errors as appropriate for your case.</span></span>
6.  <span data-ttu-id="f4a97-125">將合併模組的元件與已經或將使用 [**Connect**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-connect)合併到安裝資料庫中的任何其他功能產生關聯。</span><span class="sxs-lookup"><span data-stu-id="f4a97-125">Associate the components of the merge module with any additional features that have been, or will be, merged into the installation database using [**Connect**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-connect).</span></span> <span data-ttu-id="f4a97-126">在呼叫這個方法之前，功能必須已經存在。</span><span class="sxs-lookup"><span data-stu-id="f4a97-126">The feature must already exist before calling this method.</span></span> <span data-ttu-id="f4a97-127">只有當您有其他功能時，才需要此步驟。如需詳細資訊，請參閱將 [合併模組連接到多項功能](connecting-a-merge-module-to-multiple-features.md)</span><span class="sxs-lookup"><span data-stu-id="f4a97-127">This step is only required if you have additional features, for more information see [Connecting a Merge Module to Multiple Features](connecting-a-merge-module-to-multiple-features.md)</span></span>
7.  <span data-ttu-id="f4a97-128">如有必要，請執行下列一或多個動作，以從模組中解壓縮原始程式檔。</span><span class="sxs-lookup"><span data-stu-id="f4a97-128">If necessary, extract source files from the module by doing one or more of the following.</span></span>

    <span data-ttu-id="f4a97-129">若要從內嵌的 .cab 檔解壓縮檔案，然後將檔案複製到指定的目錄中，請使用 [**ExtractFiles**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-extractfiles) 或 [**ExtractFilesEx**](/windows/desktop/api/Mergemod/nf-mergemod-imsmmerge2-extractfilesex)。</span><span class="sxs-lookup"><span data-stu-id="f4a97-129">To extract files from an embedded .cab file and then copy into a specified directory, use [**ExtractFiles**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-extractfiles) or [**ExtractFilesEx**](/windows/desktop/api/Mergemod/nf-mergemod-imsmmerge2-extractfilesex).</span></span> <span data-ttu-id="f4a97-130">請注意， **ExtractFilesEx** 需要 [Mergemod.dll 2.0 版](merge-module-automation.md) 或更新版本。</span><span class="sxs-lookup"><span data-stu-id="f4a97-130">Note that **ExtractFilesEx** requires [Mergemod.dll version 2.0](merge-module-automation.md) or later.</span></span>

    <span data-ttu-id="f4a97-131">若要從內嵌的 .cab 檔解壓縮檔案，然後儲存在指定的檔案中，請使用 [**ExtractCAB**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-extractcab)。</span><span class="sxs-lookup"><span data-stu-id="f4a97-131">To extract files from an embedded .cab file and then save in a specified file, use [**ExtractCAB**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-extractcab).</span></span>

    <span data-ttu-id="f4a97-132">若要從模組解壓縮檔案，然後在合併之後複製到磁片上的來源映射，請使用 [**CreateSourceImage**](/windows/desktop/api/Mergemod/nf-mergemod-imsmmerge2-createsourceimage)。</span><span class="sxs-lookup"><span data-stu-id="f4a97-132">To extract files from a module and then copy to a source image on disk after the merge, use [**CreateSourceImage**](/windows/desktop/api/Mergemod/nf-mergemod-imsmmerge2-createsourceimage).</span></span> <span data-ttu-id="f4a97-133">請注意， **CreateSourceImage** 僅適用于 [Mergemod.dll 2.0 版](merge-module-automation.md) 或更新版本。</span><span class="sxs-lookup"><span data-stu-id="f4a97-133">Note that **CreateSourceImage** is only available with [Mergemod.dll version 2.0](merge-module-automation.md) or later.</span></span>

8.  <span data-ttu-id="f4a97-134">使用 [**CloseModule**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-closemodule)關閉目前的開啟合併模組。</span><span class="sxs-lookup"><span data-stu-id="f4a97-134">Close the current open merge module using [**CloseModule**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-closemodule).</span></span> <span data-ttu-id="f4a97-135">這是必要步驟。</span><span class="sxs-lookup"><span data-stu-id="f4a97-135">This step is required.</span></span>
9.  <span data-ttu-id="f4a97-136">使用 [**CloseDatabase**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-closedatabase)關閉目前開啟的安裝資料庫。</span><span class="sxs-lookup"><span data-stu-id="f4a97-136">Close the current open installation database using [**CloseDatabase**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-closedatabase).</span></span> <span data-ttu-id="f4a97-137">這是必要步驟。</span><span class="sxs-lookup"><span data-stu-id="f4a97-137">This step is required.</span></span> <span data-ttu-id="f4a97-138">關閉資料庫會清除所有相依性資訊，但不會影響任何未取出的錯誤。</span><span class="sxs-lookup"><span data-stu-id="f4a97-138">Closing a database clears all dependency information but does not affect any errors that have not been retrieved.</span></span>
10. <span data-ttu-id="f4a97-139">使用 [**CloseLog**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-closelog)關閉目前的記錄檔。</span><span class="sxs-lookup"><span data-stu-id="f4a97-139">Close the current log file using [**CloseLog**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-closelog).</span></span> <span data-ttu-id="f4a97-140">如果您已開啟記錄檔，則需要此步驟。</span><span class="sxs-lookup"><span data-stu-id="f4a97-140">This step is required if you have opened a log file.</span></span>

<span data-ttu-id="f4a97-141">使用 [Mergemod.dll](merge-module-automation.md)將模組合併到資料庫之後，必須更新 [媒體資料表](media-table.md) 以描述所需的來源影像版面配置。</span><span class="sxs-lookup"><span data-stu-id="f4a97-141">After the module has been merged into the database using [Mergemod.dll](merge-module-automation.md), the [Media Table](media-table.md) must be updated to describe the desired source image layout.</span></span> <span data-ttu-id="f4a97-142">Mergemod.dll 提供的合併處理不會更新媒體資料表，因為合併模組的取用者可以選取各種配置來源影像的方式。</span><span class="sxs-lookup"><span data-stu-id="f4a97-142">The merge process provided by Mergemod.dll does not update the Media Table because the consumer of the merge module can select various ways to layout the source image.</span></span>

 

 
