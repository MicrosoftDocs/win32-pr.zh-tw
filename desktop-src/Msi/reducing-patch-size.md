---
description: 從 Windows Installer 版本3.0 開始，修補程式作者可以使用安裝程式所快取的產品基準，更輕鬆地以較小的 delta 修補程式來服務應用程式。
ms.assetid: ab5b193d-79ce-4ed4-af53-89a4197197c1
title: 減少修補程式大小
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4fa365e831ab8685073347dc254bac58269135f1
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "106981564"
---
# <a name="reducing-patch-size"></a><span data-ttu-id="2722b-103">減少修補程式大小</span><span class="sxs-lookup"><span data-stu-id="2722b-103">Reducing Patch Size</span></span>

<span data-ttu-id="2722b-104">從 Windows Installer 版本3.0 開始，修補程式作者可以使用安裝程式所快取的產品基準，更輕鬆地以較小的 delta 修補程式來服務應用程式。</span><span class="sxs-lookup"><span data-stu-id="2722b-104">Beginning with Windows Installer version 3.0, patch authors can use the product baseline cached by the installer to more easily service applications with smaller delta patches.</span></span> <span data-ttu-id="2722b-105">在許多情況下，將服務資訊傳遞給應用程式的 [*delta 修補*](d-gly.md) 程式，可能會比提供相同資訊的完整檔案修補程式或安裝套件小得多。</span><span class="sxs-lookup"><span data-stu-id="2722b-105">In many cases, a [*delta patch*](d-gly.md) that delivers servicing information to an application can be significantly smaller than a full-file patch or installation package that delivers the same information.</span></span>

<span data-ttu-id="2722b-106">**Windows Installer 2.0：** 不支援。</span><span class="sxs-lookup"><span data-stu-id="2722b-106">**Windows Installer 2.0:** Not supported.</span></span> <span data-ttu-id="2722b-107">從 Windows Installer 3.0 開始，安裝程式會選擇性地儲存更新檔案時的相關基準資訊。</span><span class="sxs-lookup"><span data-stu-id="2722b-107">Beginning with Windows Installer 3.0, the installer selectively saves baseline information about files when they are updated.</span></span>

<span data-ttu-id="2722b-108">Windows Installer 提供三種方法來更新和服務應用程式： [小型更新](small-updates.md)、 [次要升級](minor-upgrades.md)和 [主要升級](major-upgrades.md)。</span><span class="sxs-lookup"><span data-stu-id="2722b-108">Windows Installer provides three methods for updating and servicing applications: [small updates](small-updates.md), [minor upgrades](minor-upgrades.md), and [major upgrades](major-upgrades.md).</span></span> <span data-ttu-id="2722b-109">小型更新也稱為快速修正工程 (QFE) 更新，而次要升級也稱為 service pack (SP) update。</span><span class="sxs-lookup"><span data-stu-id="2722b-109">A small update is also referred to as a quick fix engineering (QFE) update, and a minor upgrade is also referred to as a service pack (SP) update.</span></span> <span data-ttu-id="2722b-110">一般的主要升級會移除先前的應用程式，並安裝新的應用程式。</span><span class="sxs-lookup"><span data-stu-id="2722b-110">A typical major upgrade removes a previous application and installs a new application.</span></span> <span data-ttu-id="2722b-111">Windows Installer 可以將服務資訊以 [安裝套件](installation-package.md) 的形式提供給應用程式 ( .msi 檔案) 或作為 [修補套件](patch-packages.md) ( .msp 檔) 。</span><span class="sxs-lookup"><span data-stu-id="2722b-111">Windows Installer can deliver servicing information to applications as an [installation package](installation-package.md) (.msi file) or as a [patch package](patch-packages.md) (.msp file).</span></span>

<span data-ttu-id="2722b-112">針對小型更新或次要升級提供服務資訊的 Windows Installer 修補套件，通常比提供相同服務資訊的對等安裝套件小很多。</span><span class="sxs-lookup"><span data-stu-id="2722b-112">A Windows Installer patch package that delivers servicing information for a small update or minor upgrade is generally much smaller than the equivalent installation package that delivers the same servicing information.</span></span> <span data-ttu-id="2722b-113">建議將修補套件用於小型和次要升級的散發。</span><span class="sxs-lookup"><span data-stu-id="2722b-113">It is recommended that patch packages be used for the distribution of small and minor upgrades.</span></span> <span data-ttu-id="2722b-114">建議您將安裝套件用於散發主要升級。</span><span class="sxs-lookup"><span data-stu-id="2722b-114">It is recommended that an installation package be used for the distribution of a major upgrade.</span></span>

<span data-ttu-id="2722b-115">Windows Installer 修補程式 ( .msp 檔) 可以從完整的檔案或檔案差異產生， (也稱為檔案差異。 ) 從檔案差異產生的 Windows Installer 修補程式可能會比對等的完整檔案修補程式小得多。</span><span class="sxs-lookup"><span data-stu-id="2722b-115">Windows Installer patches (.msp files) can be generated from either full files or from file differences (also called file deltas.) A Windows Installer patch generated from file deltas can be much smaller than the equivalent full-file patch.</span></span> <span data-ttu-id="2722b-116">所有版本的 Windows Installer 都可以使用完整檔案修補程式或 delta 修補程式。</span><span class="sxs-lookup"><span data-stu-id="2722b-116">All versions of the Windows Installer can use both full-file patches or delta patches.</span></span>

<span data-ttu-id="2722b-117">從 Windows Installer 版本3.0 開始，安裝程式會選擇性地儲存更新檔案時的相關基準資訊。</span><span class="sxs-lookup"><span data-stu-id="2722b-117">Beginning with Windows Installer version 3.0, the installer selectively saves baseline information about files when they are updated.</span></span> <span data-ttu-id="2722b-118"> (RTM 版本) 的原始基底應用程式相關資訊，以及最新的次要升級 (service pack) 會在應用程式安裝或收到次要升級時儲存在私人位置。</span><span class="sxs-lookup"><span data-stu-id="2722b-118">Information about the original base application (the RTM version) and the most recent minor upgrade (service pack) are saved in a private location when the application is installed or receives a minor upgrade.</span></span>

<span data-ttu-id="2722b-119">安裝程式會執行下列動作，以將基準快取的大小降至最低：</span><span class="sxs-lookup"><span data-stu-id="2722b-119">The installer does the following to minimize the size of the baseline cache:</span></span>

-   <span data-ttu-id="2722b-120">每個應用程式都不會維護兩個以上的基準：原本發行 (RTM) 的檔案基準，以及最新次要升級 (service pack 中的檔案基準。 ) </span><span class="sxs-lookup"><span data-stu-id="2722b-120">No more than two baselines are maintained for each application: a baseline of the file as originally released (RTM) and a baseline of the file at the most recent minor upgrade (service pack.)</span></span>
-   <span data-ttu-id="2722b-121">在修補檔案之前，不會將檔案新增至快取。</span><span class="sxs-lookup"><span data-stu-id="2722b-121">A file is not added to the cache until it is patched.</span></span> <span data-ttu-id="2722b-122">基準快取是寫入時複製。</span><span class="sxs-lookup"><span data-stu-id="2722b-122">The baseline cache is copy-on-write.</span></span>
-   <span data-ttu-id="2722b-123">如果從未更新過應用程式，基準快取中沒有任何檔案。</span><span class="sxs-lookup"><span data-stu-id="2722b-123">If the application has never been updated, there are no files in the baseline cache.</span></span>
-   <span data-ttu-id="2722b-124">當應用程式的最後一項服務是 (service pack 的次要升級時) 應用程式位於基準層級，而且電腦上最多可以有兩個檔案複本。</span><span class="sxs-lookup"><span data-stu-id="2722b-124">When the application's last servicing was a minor upgrade (service pack) the application is at a baseline level and at most two copies of a file can be present on the computer.</span></span> <span data-ttu-id="2722b-125">其中一個檔案複本位於安裝的目標目錄中。</span><span class="sxs-lookup"><span data-stu-id="2722b-125">One copy of the file is in the target directory of the installation.</span></span> <span data-ttu-id="2722b-126">另一個複本可以位於 RTM 基準快取中。</span><span class="sxs-lookup"><span data-stu-id="2722b-126">The other copy can be in the RTM baseline cache.</span></span>
-   <span data-ttu-id="2722b-127">當應用程式的最後一項服務是小型更新時 (QFE) 應用程式不在基準層級，而且電腦上最多可以有三個檔案複本。</span><span class="sxs-lookup"><span data-stu-id="2722b-127">When the application's last servicing was a small update (QFE) the application is not at a baseline level and at most three copies of a file can be present on the computer.</span></span> <span data-ttu-id="2722b-128">檔案的第一個複本位於安裝的目標目錄中。</span><span class="sxs-lookup"><span data-stu-id="2722b-128">The first copy of the file is in the target directory of the installation.</span></span> <span data-ttu-id="2722b-129">檔案的第二個複本位於 RTM 基準快取中。</span><span class="sxs-lookup"><span data-stu-id="2722b-129">The second copy of the file is in the RTM baseline cache.</span></span> <span data-ttu-id="2722b-130">檔案的最後一個複本是最新的基準快取。</span><span class="sxs-lookup"><span data-stu-id="2722b-130">The last copy of the file is in the most recent baseline cache.</span></span>
-   <span data-ttu-id="2722b-131">卸載產品時，會移除應用程式的基準快取。</span><span class="sxs-lookup"><span data-stu-id="2722b-131">The application's baseline cache is removed when the product is uninstalled.</span></span>

<span data-ttu-id="2722b-132">從 Windows Installer 版本3.0 開始，當修補程式套用至應用程式時，安裝程式可以使用基準快取。</span><span class="sxs-lookup"><span data-stu-id="2722b-132">Beginning with Windows Installer version 3.0, the installer can use the baseline cache when patches are applied to the application.</span></span> <span data-ttu-id="2722b-133">您可以使用基準資訊來套用差異修補程式，或在卸載修補程式期間將檔案還原為先前的版本。</span><span class="sxs-lookup"><span data-stu-id="2722b-133">The baseline information can be used to apply a delta patch or to revert a file to a previous version during a patch uninstall.</span></span> <span data-ttu-id="2722b-134">這可以讓修補程式作者受益于較小的差異修補程式。</span><span class="sxs-lookup"><span data-stu-id="2722b-134">This can enable patch authors to benefit from smaller delta patches.</span></span> <span data-ttu-id="2722b-135">如果安裝程式發現 delta 修補程式無法套用至目標檔案，則安裝程式會嘗試使用儲存在基準快取中的檔案做為起始點。</span><span class="sxs-lookup"><span data-stu-id="2722b-135">If the installer finds that the delta patch cannot be applied to the target file, the installer can attempt to use a file saved in the baseline cache as a starting point.</span></span> <span data-ttu-id="2722b-136">安裝程式只會在嘗試快取中的所有可能性之後，才要求原始安裝來源。</span><span class="sxs-lookup"><span data-stu-id="2722b-136">The installer only resorts to requesting the original installation source after trying all the possibilities in the cache.</span></span>

<span data-ttu-id="2722b-137">遵循下列指導方針可協助修補作者使用 Windows Installer 3.0 版修補程式和基準快取來建立較小的 delta 修補程式：</span><span class="sxs-lookup"><span data-stu-id="2722b-137">Adherence to the following guidelines can help patch authors use Windows Installer version 3.0 patches and the baseline cache to create smaller delta patches:</span></span>

-   <span data-ttu-id="2722b-138">撰寫包含 [MsiPatchSequence 資料表](msipatchsequence-table.md)的修補程式。</span><span class="sxs-lookup"><span data-stu-id="2722b-138">Author patches that include the [MsiPatchSequence table](msipatchsequence-table.md).</span></span> <span data-ttu-id="2722b-139">需要有此資料表才能使用基準快取，從 Windows Installer 版本3.0 開始提供。</span><span class="sxs-lookup"><span data-stu-id="2722b-139">This table is required to use the baseline cache and is available beginning with Windows Installer version 3.0.</span></span>
-   <span data-ttu-id="2722b-140">請勿設定防止基準快取的原則。</span><span class="sxs-lookup"><span data-stu-id="2722b-140">Do not set policy that prevents baseline caching.</span></span> <span data-ttu-id="2722b-141">[MaxPatchCacheSize](maxpatchcachesize.md)原則的值會指定可用磁碟空間的最大百分比。</span><span class="sxs-lookup"><span data-stu-id="2722b-141">The value of the [MaxPatchCacheSize](maxpatchcachesize.md) policy specifies the maximum percentage of disk space that can be used.</span></span> <span data-ttu-id="2722b-142">如果 MaxPatchCacheSize 原則設定為0，則基準快取中不會儲存任何其他檔案。</span><span class="sxs-lookup"><span data-stu-id="2722b-142">If the MaxPatchCacheSize policy is set to 0, no additional files are saved in the baseline cache.</span></span> <span data-ttu-id="2722b-143">如果未設定此原則，則預設值為最多可使用10% 的磁碟空間。</span><span class="sxs-lookup"><span data-stu-id="2722b-143">If the policy is not set, the default is that a maximum of 10% of the disk space can be used.</span></span> <span data-ttu-id="2722b-144">如果快取的總大小達到磁碟空間的最大百分比，則不會儲存任何其他檔案。</span><span class="sxs-lookup"><span data-stu-id="2722b-144">If the total size of the cache reaches the maximum percentage of disk space, no additional files are saved.</span></span> <span data-ttu-id="2722b-145">原則不會影響已儲存的檔案。</span><span class="sxs-lookup"><span data-stu-id="2722b-145">The policy does not affect files that have already been saved.</span></span> <span data-ttu-id="2722b-146">即使停用快取，安裝程式還是可以使用現有的產品基準快取。</span><span class="sxs-lookup"><span data-stu-id="2722b-146">Even when caching is disabled, the installer can use existing product baseline caches.</span></span>
-   <span data-ttu-id="2722b-147">如果套用的第一個修補套裝程式含 [MsiPatchSequence 資料表](msipatchsequence-table.md)，則會為應用程式啟用快取。</span><span class="sxs-lookup"><span data-stu-id="2722b-147">If the first patch applied includes the [MsiPatchSequence table](msipatchsequence-table.md), caching is enabled for the application.</span></span>
-   <span data-ttu-id="2722b-148">如果服務交易中的任何修補程式未包含 [MsiPatchSequence 資料表](msipatchsequence-table.md)，則只有在包含 MsiPatchSequence 資料表的次要升級修補程式 (service pack) 已成功套用至產品時，才會為應用程式啟用快取。</span><span class="sxs-lookup"><span data-stu-id="2722b-148">If any patch in the servicing transaction does not include the [MsiPatchSequence table](msipatchsequence-table.md), caching is enabled for the application only if a minor upgrade patch (service pack) that includes the MsiPatchSequence table is successfully applied to the product.</span></span>
-   <span data-ttu-id="2722b-149">使用修補程式建立工具產生修補程式套件，例如 [Msimsp.exe](msimsp-exe.md) 和 [PATCHWIZ.DLL](patchwiz-dll.md)。</span><span class="sxs-lookup"><span data-stu-id="2722b-149">Generate the patch package using patch creation tools such as [Msimsp.exe](msimsp-exe.md) and [PATCHWIZ.DLL](patchwiz-dll.md).</span></span>
-   <span data-ttu-id="2722b-150">請一律以應用程式 RTM 版本的修補程式為目標，或 (service pack) 版本的應用程式進行次要升級。</span><span class="sxs-lookup"><span data-stu-id="2722b-150">Always target patches for the RTM version of the application or a minor upgrade (service pack) version of the application.</span></span> <span data-ttu-id="2722b-151">在 Patch 建立屬性 (PCP) 檔案的 [TargetImages 資料表](targetimages-table-patchwiz-dll-.md) 中指定的目標應該是 [**ProductVersion**](productversion.md) 屬性的前三個欄位所定義的產品檢查點。</span><span class="sxs-lookup"><span data-stu-id="2722b-151">The targets specified in the [TargetImages table](targetimages-table-patchwiz-dll-.md) of the Patch Creation Properties (PCP) file should be product check points defined by the first three fields of the [**ProductVersion**](productversion.md) property.</span></span>
-   <span data-ttu-id="2722b-152">絕對不要將修補程式的目標設為小型更新映射。</span><span class="sxs-lookup"><span data-stu-id="2722b-152">Never target patches at small update images.</span></span> <span data-ttu-id="2722b-153">建立修補程式的目標不應包含先前的小型更新升級映射。</span><span class="sxs-lookup"><span data-stu-id="2722b-153">The targets for building the patch should not include previous small update upgrade images.</span></span>

 

 



