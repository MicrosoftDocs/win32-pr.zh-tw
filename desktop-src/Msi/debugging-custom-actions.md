---
description: 您可以使用適用于 Windows 的偵錯工具，來根據動態連結程式庫來進行自訂動作的偵錯工具。 您無法使用以可執行檔或腳本為基礎的自訂動作進行動態調試。
ms.assetid: 4241a27a-c127-4c65-96a2-1d655b343eba
title: 自訂動作的調試
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9ddfbc9952f0dd7fc1b85b5c64fa6a23381ceafe
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "106997810"
---
# <a name="debugging-custom-actions"></a><span data-ttu-id="748c2-104">自訂動作的調試</span><span class="sxs-lookup"><span data-stu-id="748c2-104">Debugging Custom Actions</span></span>

<span data-ttu-id="748c2-105">您可以使用[適用于 Windows 的調試](https://www.microsoft.com/?ref=go)程式，來根據[動態連結程式庫](dynamic-link-libraries.md)來進行自訂動作的偵錯工具。</span><span class="sxs-lookup"><span data-stu-id="748c2-105">You can debug custom actions that are based on [dynamic-link libraries](dynamic-link-libraries.md) by using [Debugging Tools for Windows](https://www.microsoft.com/?ref=go).</span></span> <span data-ttu-id="748c2-106">您無法使用以 [可執行檔](executable-files.md) 或 [腳本](scripts.md)為基礎的自訂動作進行動態調試。</span><span class="sxs-lookup"><span data-stu-id="748c2-106">It is not possible to use dynamic debugging with custom actions based on [executable files](executable-files.md) or [scripts](scripts.md).</span></span>

<span data-ttu-id="748c2-107">本節所述的技術可協助您進行 Windows Installer 自訂動作的調試。</span><span class="sxs-lookup"><span data-stu-id="748c2-107">The techniques described in this section can help you debug Windows Installer custom actions.</span></span> <span data-ttu-id="748c2-108">如需適用 [于 Windows 的調試](https://www.microsoft.com/?ref=go)程式的詳細資訊，請參閱 WINDOWS 驅動程式套件 (WDK) 的驅動程式開發工具一節。</span><span class="sxs-lookup"><span data-stu-id="748c2-108">See the Driver Development Tools section of the Windows Driver Kit (WDK) for information about [Debugging Tools for Windows](https://www.microsoft.com/?ref=go).</span></span>

<span data-ttu-id="748c2-109">Windows Installer 使用 MsiBreak 環境變數來判斷要進行調試的自訂動作。</span><span class="sxs-lookup"><span data-stu-id="748c2-109">Windows Installer uses the MsiBreak environment variable to determine which custom action is to be debugged.</span></span> <span data-ttu-id="748c2-110">如果您可以存取自訂動作的原始程式碼，您可以在不 MsiBreak 的情況下使用偵錯工具。</span><span class="sxs-lookup"><span data-stu-id="748c2-110">If you have access to the custom action's source code, you may be able to use debugging without MsiBreak.</span></span> <span data-ttu-id="748c2-111">若要在不 MsiBreak 的情況下開始進行偵錯工具，請在動作程式碼的開頭放置一個暫時的訊息方塊。</span><span class="sxs-lookup"><span data-stu-id="748c2-111">To start debugging without MsiBreak, put a temporary message box at the beginning of the action's code.</span></span> <span data-ttu-id="748c2-112">在安裝期間出現訊息方塊時，將偵錯工具附加至擁有訊息方塊的進程。</span><span class="sxs-lookup"><span data-stu-id="748c2-112">When the message box appears during the installation, attach the debugger to the process owning the message box.</span></span> <span data-ttu-id="748c2-113">然後，您可以設定任何必要的中斷點，並關閉訊息方塊以繼續執行。</span><span class="sxs-lookup"><span data-stu-id="748c2-113">You can then set any necessary breakpoints and dismiss the message box to resume execution.</span></span> <span data-ttu-id="748c2-114">您無法使用這個方法來將自訂動作的先前部分進行 debug 錯。</span><span class="sxs-lookup"><span data-stu-id="748c2-114">It is not possible to debug the earlier portions of the custom action by this method.</span></span>

<span data-ttu-id="748c2-115">若要使用 MsiBreak 環境變數來對自訂動作進行自訂，請將 MsiBreak 設定為 [CustomAction 資料表](customaction-table.md)中自訂動作的名稱。</span><span class="sxs-lookup"><span data-stu-id="748c2-115">To use the MsiBreak environment variable to debug the custom action, set MsiBreak to the custom action's name in the [CustomAction table](customaction-table.md).</span></span> <span data-ttu-id="748c2-116">MsiBreak 可以是系統或使用者環境變數。</span><span class="sxs-lookup"><span data-stu-id="748c2-116">MsiBreak can be either a system or a user environment variable.</span></span> <span data-ttu-id="748c2-117">如果變數設定為系統變數，則當值變更為偵測新值時，可能需要重新開機系統。</span><span class="sxs-lookup"><span data-stu-id="748c2-117">If the variable is set as a system variable, a restart of the system may be needed when the value is changed to detect the new value.</span></span>

<span data-ttu-id="748c2-118">若要使用 MsiBreak 環境變數來對內嵌使用者介面進行偵錯工具，請將 MsiBreak 的值設定為 MsiEmbeddedUI。</span><span class="sxs-lookup"><span data-stu-id="748c2-118">To use the MsiBreak environment variable to debug an embedded user interface, set the value of MsiBreak to MsiEmbeddedUI.</span></span>

<span data-ttu-id="748c2-119">Windows Installer 只有在使用者為系統管理員時，才會檢查 MsiBreak 環境變數。</span><span class="sxs-lookup"><span data-stu-id="748c2-119">Windows Installer only checks the MsiBreak environment variable if the user is an Administrator.</span></span> <span data-ttu-id="748c2-120">如果使用者不是系統管理員，則安裝程式會忽略 MsiBreak 的值，即使這是 [*受控應用程式*](m-gly.md)也一樣。</span><span class="sxs-lookup"><span data-stu-id="748c2-120">The installer ignores the value of MsiBreak if the user is not an Administrator, even if this is a [*managed application*](m-gly.md).</span></span>

<span data-ttu-id="748c2-121">如果您要對執行順序中提高 (系統) 許可權執行的自訂動作進行偵錯工具，請將偵錯工具附加至 Windows Installer 服務。</span><span class="sxs-lookup"><span data-stu-id="748c2-121">If you are debugging a custom action that runs with elevated (system) privileges in the execution sequence, attach the debugger to the Windows Installer service.</span></span> <span data-ttu-id="748c2-122">當您在執行順序中對以模擬許可權執行的自訂動作進行偵錯工具時，系統會以對話方塊提示，指出應該調試的進程。</span><span class="sxs-lookup"><span data-stu-id="748c2-122">When debugging a custom action that runs with impersonated privileges in the execution sequence, the system prompts with a dialog box that indicates which process should be debugged.</span></span> <span data-ttu-id="748c2-123">系統會以對話方塊提示使用者，指出要進行偵錯工具的進程。</span><span class="sxs-lookup"><span data-stu-id="748c2-123">The user is prompted with a dialog box indicating which process to debug.</span></span> <span data-ttu-id="748c2-124">如需更高的自訂動作的詳細資訊，請參閱 [自訂動作安全性](custom-action-security.md)。</span><span class="sxs-lookup"><span data-stu-id="748c2-124">For more information about elevated custom actions, see [Custom Action Security](custom-action-security.md).</span></span>

<span data-ttu-id="748c2-125">當偵錯工具附加至正確的進程之後，安裝程式就會在呼叫 DLL 的進入點之前，立即觸發偵錯工具中斷點。</span><span class="sxs-lookup"><span data-stu-id="748c2-125">Once the debugger has been attached to the correct process, the installer triggers a debugger breakpoint immediately before calling the entry point of the DLL.</span></span> <span data-ttu-id="748c2-126">在中斷點，您的 DLL 已載入至進程，並已判斷進入點位址。</span><span class="sxs-lookup"><span data-stu-id="748c2-126">At the breakpoint, your DLL is already loaded into the process and the entry point address determined.</span></span> <span data-ttu-id="748c2-127">如果無法載入您的自訂動作 DLL 或自訂動作輸入點不存在，則不會觸發任何中斷點。</span><span class="sxs-lookup"><span data-stu-id="748c2-127">If your custom action DLL could not be loaded or the custom action entry point did not exist, no breakpoint is triggered.</span></span> <span data-ttu-id="748c2-128">因為中斷點會在呼叫 DLL 函式之前觸發，所以在觸發中斷點之後，您應該使用偵錯工具向前復原，直到呼叫您的自訂動作進入點為止。</span><span class="sxs-lookup"><span data-stu-id="748c2-128">Because the breakpoint is triggered before calling the DLL function, once the breakpoint has been triggered you should use your debugger to step forward until your custom action entry point is called.</span></span> <span data-ttu-id="748c2-129">或者，您可以在自訂動作的任何位置設定中斷點，然後繼續正常執行。</span><span class="sxs-lookup"><span data-stu-id="748c2-129">Alternately, you can set a breakpoint anywhere in your custom action and resume normal execution.</span></span>

<span data-ttu-id="748c2-130">Windows Installer 直接從 DLL 位置執行未儲存在 [二進位資料表](binary-table.md) 中的 dll。</span><span class="sxs-lookup"><span data-stu-id="748c2-130">The Windows Installer executes DLLs not stored in the [Binary table](binary-table.md) directly from the DLL location.</span></span> <span data-ttu-id="748c2-131">安裝程式不知道二進位資料表中所儲存之 DLL 的原始名稱，而是在暫存檔案名稱下執行 DLL 自訂動作。</span><span class="sxs-lookup"><span data-stu-id="748c2-131">The installer does not know the original name of a DLL stored in the Binary table and runs the DLL custom action under a temporary file name.</span></span> <span data-ttu-id="748c2-132">暫存檔案名稱的形式為 MSI?????。Tmp。</span><span class="sxs-lookup"><span data-stu-id="748c2-132">The form of the temporary file name is MSI?????.TMP.</span></span> <span data-ttu-id="748c2-133">在 Windows XP 上，此暫存檔案儲存在安全的位置，通常是 <WindowFolder> \\ 安裝程式。</span><span class="sxs-lookup"><span data-stu-id="748c2-133">On Windows XP, this temporary file is stored in a secure location, commonly <WindowFolder>\\Installer.</span></span>

<span data-ttu-id="748c2-134">請注意，針對偵錯工具所建立的許多 Dll 都包含對應之 PDB 檔的名稱和路徑，做為 DLL 本身的一部分。</span><span class="sxs-lookup"><span data-stu-id="748c2-134">Note that many DLLs created for debugging contain the name and path of the corresponding PDB file as part of the DLL itself.</span></span> <span data-ttu-id="748c2-135">在可以在 DLL 儲存的位置找到 PDB 的系統上，對此類型的 DLL 進行偵錯工具時，偵錯工具工具可能會自動載入符號。</span><span class="sxs-lookup"><span data-stu-id="748c2-135">When debugging this type of DLL on a system where the PDB can be found at the location stored in the DLL, symbols may be loaded automatically by the debugger tool.</span></span> <span data-ttu-id="748c2-136">在無法于預存位置找到 PDB 的情況下，偵錯工具不支援從預存位置載入符號，或 DLL 未以偵錯工具建立的情況下，您可能需要使用暫存 DLL 檔將符號檔案放在資料夾中。</span><span class="sxs-lookup"><span data-stu-id="748c2-136">In situations where the PDB cannot be found at the stored location, where the debugger does not support loading symbols from the stored location, or where the DLL was not built with debugging information, you may need to place your symbol files in the folder with the temporary DLL file.</span></span>

<span data-ttu-id="748c2-137">安裝程式會將自訂動作腳本的偵錯工具新增至安裝記錄檔。</span><span class="sxs-lookup"><span data-stu-id="748c2-137">The installer adds debugging information for custom action scripts to the installation log file.</span></span>

``` syntax
There is a problem with this Windows Installer package. A script 
required for this install to complete could not be run. Contact your 
support personnel or package vendor.  {Custom action [2] script error 
[3], [4]: [5] Line [6], Column [7], [8] }
```

 

 



