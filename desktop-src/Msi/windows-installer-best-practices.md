---
description: 本節列舉連結至主要 Windows Installer SDK 檔的秘訣清單，以協助應用程式開發人員、設定作者、IT 專業人員和基礎結構開發人員探索使用 Windows Installer 的最佳作法：
ms.assetid: ff48d995-fe6f-4d1b-898d-67574ed3c5b7
title: Windows Installer 最佳作法
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0ffaf6aae83afbe510f2b1eefc447e34754296ba
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "104027019"
---
# <a name="windows-installer-best-practices"></a><span data-ttu-id="47522-103">Windows Installer 最佳作法</span><span class="sxs-lookup"><span data-stu-id="47522-103">Windows Installer Best Practices</span></span>

<span data-ttu-id="47522-104">本節列舉連結至主要 Windows Installer SDK 檔的秘訣清單，以協助應用程式開發人員、設定作者、IT 專業人員和基礎結構開發人員探索使用 Windows Installer 的最佳作法：</span><span class="sxs-lookup"><span data-stu-id="47522-104">This section enumerates a list of tips, linked to the main Windows Installer SDK documentation, to help Application Developers, Setup Authors, IT Professionals, and Infrastructure Developers discover best practices for using the Windows Installer:</span></span>

-   [<span data-ttu-id="47522-105">更新 Windows Installer 版本。</span><span class="sxs-lookup"><span data-stu-id="47522-105">Update the Windows Installer version.</span></span>](#update-the-windows-installer-version)
-   [<span data-ttu-id="47522-106">符合 Windows 標誌認證需求。</span><span class="sxs-lookup"><span data-stu-id="47522-106">Meet the Windows Logo certification requirements.</span></span>](#meet-the-windows-logo-certification-requirements)
-   [<span data-ttu-id="47522-107">準備套件以進行當地語系化。</span><span class="sxs-lookup"><span data-stu-id="47522-107">Prepare the package for localization.</span></span>](#prepare-the-package-for-localization)
-   [<span data-ttu-id="47522-108">更新您的 Windows Installer 開發工具和檔。</span><span class="sxs-lookup"><span data-stu-id="47522-108">Update your Windows Installer development tools and documentation.</span></span>](#update-your-windows-installer-development-tools-and-documentation)
-   [<span data-ttu-id="47522-109">如果您決定重新封裝舊版安裝應用程式，請遵循妥善的重新封裝做法。</span><span class="sxs-lookup"><span data-stu-id="47522-109">If you decide to repackage a legacy setup application, follow good repackaging practices.</span></span>](#if-you-decide-to-repackage-a-legacy-setup-application-follow-good-repackaging-practices)
-   [<span data-ttu-id="47522-110">請勿嘗試取代受保護的資源。</span><span class="sxs-lookup"><span data-stu-id="47522-110">Do not try to replace protected resources.</span></span>](#do-not-try-to-replace-protected-resources)
-   [<span data-ttu-id="47522-111">請勿依賴非關鍵性的資源。</span><span class="sxs-lookup"><span data-stu-id="47522-111">Do not depend upon non-critical resources.</span></span>](#do-not-depend-upon-non-critical-resources)
-   [<span data-ttu-id="47522-112">使用 API 來取出 Windows Installer 設定資訊。</span><span class="sxs-lookup"><span data-stu-id="47522-112">Use the API to retrieve Windows Installer configuration information.</span></span>](#use-the-api-to-retrieve-windows-installer-configuration-information)
-   [<span data-ttu-id="47522-113">在元件周圍組織應用程式的安裝。</span><span class="sxs-lookup"><span data-stu-id="47522-113">Organize the installation of your application around components.</span></span>](#organize-the-installation-of-your-application-around-components)
-   [<span data-ttu-id="47522-114">減少大型 Windows Installer 套件的大小。</span><span class="sxs-lookup"><span data-stu-id="47522-114">Reduce the size of large Windows Installer packages.</span></span>](#reduce-the-size-of-large-windows-installer-packages)
-   [<span data-ttu-id="47522-115">如果您使用自訂動作，請遵循良好的自訂動作實務。</span><span class="sxs-lookup"><span data-stu-id="47522-115">If you use custom actions, follow good custom action practices.</span></span>](#if-you-use-custom-actions-follow-good-custom-action-practices)
-   [<span data-ttu-id="47522-116">如果您使用元件，請遵循良好的元件實務</span><span class="sxs-lookup"><span data-stu-id="47522-116">If you use assemblies, follow good assembly practices</span></span>](#if-you-use-assemblies-follow-good-assembly-practices)
-   [<span data-ttu-id="47522-117">請勿運送並行安裝。</span><span class="sxs-lookup"><span data-stu-id="47522-117">Do not ship concurrent installations.</span></span>](#do-not-ship-concurrent-installations)
-   [<span data-ttu-id="47522-118">讓套件名稱和套件碼保持一致。</span><span class="sxs-lookup"><span data-stu-id="47522-118">Keep package names and package codes consistent.</span></span>](#keep-package-names-and-package-codes-consistent)
-   [<span data-ttu-id="47522-119">請勿使用 SelfReg 和 TypeLib 資料表。</span><span class="sxs-lookup"><span data-stu-id="47522-119">Do not use the SelfReg and TypeLib tables.</span></span>](#do-not-use-the-selfreg-and-typelib-tables)
-   [<span data-ttu-id="47522-120">提供在沒有使用者介面的情況下安裝的選項。</span><span class="sxs-lookup"><span data-stu-id="47522-120">Provide the option to install without a user interface.</span></span>](#provide-the-option-to-install-without-a-user-interface)
-   [<span data-ttu-id="47522-121">避免使用 AlwaysInstallElevated 原則。</span><span class="sxs-lookup"><span data-stu-id="47522-121">Avoid using the AlwaysInstallElevated policy.</span></span>](#avoid-using-the-alwaysinstallelevated-policy)
-   [<span data-ttu-id="47522-122">啟用 DisableMedia 原則以限制未經授權的安裝。</span><span class="sxs-lookup"><span data-stu-id="47522-122">Enable the DisableMedia policy to limit unauthorized installation.</span></span>](#enable-the-disablemedia-policy-to-limit-unauthorized-installation)
-   [<span data-ttu-id="47522-123">將原始套件來源檔案保持安全並可供使用者使用。</span><span class="sxs-lookup"><span data-stu-id="47522-123">Keep the original package source files secure and available to users.</span></span>](#keep-the-original-package-source-files-secure-and-available-to-users)
-   [<span data-ttu-id="47522-124">針對部署進行疑難排解時，請在使用者的電腦上啟用詳細資訊記錄。</span><span class="sxs-lookup"><span data-stu-id="47522-124">Enable verbose logging on user's computer when troubleshooting deployment.</span></span>](#enable-verbose-logging-on-users-computer-when-troubleshooting-deployment)
-   [<span data-ttu-id="47522-125">卸載會將使用者的電腦保持在乾淨的狀態。</span><span class="sxs-lookup"><span data-stu-id="47522-125">Uninstallation leaves the user's computer in a clean state.</span></span>](#uninstallation-leaves-the-users-computer-in-a-clean-state)
-   [<span data-ttu-id="47522-126">針對每位使用者和每部電腦的安裝部署測試套件。</span><span class="sxs-lookup"><span data-stu-id="47522-126">Test packages for both per-user and per-machine installation deployment.</span></span>](#test-packages-for-both-per-user-and-per-machine-installation-deployment)
-   [<span data-ttu-id="47522-127">先規劃及測試服務策略，再寄送應用程式。</span><span class="sxs-lookup"><span data-stu-id="47522-127">Plan and test a servicing strategy before shipping the application.</span></span>](#plan-and-test-a-servicing-strategy-before-shipping-the-application)
-   [<span data-ttu-id="47522-128">在原始來源上減少更新的相依性。</span><span class="sxs-lookup"><span data-stu-id="47522-128">Reduce the dependency of updates upon the original sources.</span></span>](#reduce-the-dependency-of-updates-upon-the-original-sources)
-   [<span data-ttu-id="47522-129">請勿散發 unserviceable 合併模組。</span><span class="sxs-lookup"><span data-stu-id="47522-129">Do not distribute unserviceable merge modules.</span></span>](#do-not-distribute-unserviceable-merge-modules)
-   [<span data-ttu-id="47522-130">避免修補系統管理安裝。</span><span class="sxs-lookup"><span data-stu-id="47522-130">Avoid patching administrative installations.</span></span>](#avoid-patching-administrative-installations)
-   [<span data-ttu-id="47522-131">以較高的許可權註冊更新以執行。</span><span class="sxs-lookup"><span data-stu-id="47522-131">Register updates to run with elevated privilege.</span></span>](#register-updates-to-run-with-elevated-privilege)
-   [<span data-ttu-id="47522-132">使用 MsiPatchSequence 資料表來排列修補程式的順序。</span><span class="sxs-lookup"><span data-stu-id="47522-132">Use the MsiPatchSequence Table to sequence patches.</span></span>](#use-the-msipatchsequence-table-to-sequence-patches)
-   [<span data-ttu-id="47522-133">徹底測試安裝套件。</span><span class="sxs-lookup"><span data-stu-id="47522-133">Test the installation package thoroughly.</span></span>](#test-the-installation-package-thoroughly)
-   [<span data-ttu-id="47522-134">請先修正所有驗證錯誤，再部署新的或修改過的安裝套件。</span><span class="sxs-lookup"><span data-stu-id="47522-134">Fix all validation errors before deploying a new or revised installation package.</span></span>](#fix-all-validation-errors-before-deploying-a-new-or-revised-installation-package)
-   [<span data-ttu-id="47522-135">撰寫安全的安裝。</span><span class="sxs-lookup"><span data-stu-id="47522-135">Author a secure installation.</span></span>](#author-a-secure-installation)
-   [<span data-ttu-id="47522-136">使用 PMSIHANDLE 而非控制碼</span><span class="sxs-lookup"><span data-stu-id="47522-136">Use PMSIHANDLE instead of HANDLE</span></span>](#use-pmsihandle-instead-of-handle)

## <a name="update-the-windows-installer-version"></a><span data-ttu-id="47522-137">更新 Windows Installer 版本。</span><span class="sxs-lookup"><span data-stu-id="47522-137">Update the Windows Installer version.</span></span>

-   <span data-ttu-id="47522-138">在 Windows Server 2008 R2 和 Windows 7 上使用 Windows Installer 5.0。</span><span class="sxs-lookup"><span data-stu-id="47522-138">Use Windows Installer 5.0 on Windows Server 2008 R2 and Windows 7.</span></span> <span data-ttu-id="47522-139">這是作業系統隨附的 Windows Installer 版本。</span><span class="sxs-lookup"><span data-stu-id="47522-139">This is the Windows Installer version provided with the operating system.</span></span>
-   <span data-ttu-id="47522-140">在 Windows Server 2008、Windows Server 2003 Service Pack 1 (SP1) 、Windows Vista （含 Service Pack 1） (SP1) 或 Windows XP Service Pack 2 (SP2) 中使用 Windows Installer 4.5。</span><span class="sxs-lookup"><span data-stu-id="47522-140">Use Windows Installer 4.5 on Windows Server 2008, Windows Server 2003 with Service Pack 1 (SP1), Windows Vista with Service Pack 1 (SP1), or Windows XP with Service Pack 2 (SP2).</span></span> <span data-ttu-id="47522-141">如需取得最新 Windows Installer 版本的詳細資訊，請參閱 [Windows Installer](windows-installer-redistributables.md)可轉散發套件。</span><span class="sxs-lookup"><span data-stu-id="47522-141">For information about obtaining the latest Windows Installer version, see [Windows Installer Redistributables](windows-installer-redistributables.md).</span></span>
-   <span data-ttu-id="47522-142">在 Windows 2000 Service Pack 3 (SP3) 上使用 Windows Installer 3.1。</span><span class="sxs-lookup"><span data-stu-id="47522-142">Use Windows Installer 3.1 on Windows 2000 with Service Pack 3 (SP3).</span></span> <span data-ttu-id="47522-143">Windows Installer 3.1 版具有可加速應用程式服務和 [修補](patching.md)的功能。</span><span class="sxs-lookup"><span data-stu-id="47522-143">Windows Installer version 3.1 has features that facilitate better application servicing and [patching](patching.md).</span></span>
-   <span data-ttu-id="47522-144">版本3.0 引進了許多重要的功能，並且列在 [Windows Installer 版本2.0 中不支援](not-supported-in-windows-installer-version-2-0.md)的章節。</span><span class="sxs-lookup"><span data-stu-id="47522-144">Many important features were introduced with version 3.0 and are listed in the section [Not Supported in Windows Installer Version 2.0](not-supported-in-windows-installer-version-2-0.md).</span></span> <span data-ttu-id="47522-145">您可以使用 Windows Installer 3.0 和更新版本，安裝針對 Windows Installer 2.0 建立的安裝套件和更新。</span><span class="sxs-lookup"><span data-stu-id="47522-145">Installation packages and updates that were created for Windows Installer 2.0 can be installed using Windows Installer 3.0 and later.</span></span> <span data-ttu-id="47522-146">如果修補封裝包含 Windows Installer 3.0 所使用的新資料表，仍然可以使用舊版 Windows Installer，但不含 Windows Installer 3.0 修補功能。</span><span class="sxs-lookup"><span data-stu-id="47522-146">Patch packages that contain the new tables used by Windows Installer 3.0 can still be applied using earlier versions of Windows Installer but without the Windows Installer 3.0 patching functionality.</span></span> <span data-ttu-id="47522-147">您也可以撰寫明確需要 Windows Installer 3.0 的修補程式，而這些修補程式無法由舊版 Windows Installer 套用。</span><span class="sxs-lookup"><span data-stu-id="47522-147">It is also possible to author patches that explicitly require the Windows Installer 3.0 that cannot be applied by earlier versions of Windows Installer.</span></span> <span data-ttu-id="47522-148">如果使用者無法更新安裝程式版本，請確定您的應用程式或更新將與未來的 Windows Installer 更新相容。</span><span class="sxs-lookup"><span data-stu-id="47522-148">If a user is unable to update the installer version, ensure that your application or update will be compatible with a future update of the Windows Installer.</span></span>
-   <span data-ttu-id="47522-149">如需舊版 Windows Installer 不支援的 Windows Installer 功能清單，請參閱 [Windows Installer 中的新](what-s-new-in-windows-installer.md)功能。</span><span class="sxs-lookup"><span data-stu-id="47522-149">For a list of the Windows Installer features not supported by earlier versions of the Windows installer see [What's New in Windows Installer](what-s-new-in-windows-installer.md).</span></span>

## <a name="meet-the-windows-logo-certification-requirements"></a><span data-ttu-id="47522-150">符合 Windows 標誌認證需求。</span><span class="sxs-lookup"><span data-stu-id="47522-150">Meet the Windows Logo certification requirements.</span></span>

-   <span data-ttu-id="47522-151">即使您不打算將您的應用程式提交到標誌計畫，遵循標誌認證指導方針可協助讓您的 Windows Installer 套件更好。</span><span class="sxs-lookup"><span data-stu-id="47522-151">Even if you do not intend to submit your application to the logo program, following the logo certification guidelines can help make your Windows Installer package better.</span></span> <span data-ttu-id="47522-152">如需標誌需求的總覽，以及特定標誌認證計畫的連結，請參閱 [Windows Installer 和標誌需求](windows-installer-and-logo-requirements.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-152">For an overview of the logo requirements, and links to specific logo certification programs, see [Windows Installer and Logo Requirements](windows-installer-and-logo-requirements.md).</span></span>

## <a name="prepare-the-package-for-localization"></a><span data-ttu-id="47522-153">準備套件以進行當地語系化。</span><span class="sxs-lookup"><span data-stu-id="47522-153">Prepare the package for localization.</span></span>

-   <span data-ttu-id="47522-154">撰寫原始安裝套件時，最好先準備好未來的當地語系化。</span><span class="sxs-lookup"><span data-stu-id="47522-154">It is a good practice to prepare for future localization when authoring the original installation package.</span></span> <span data-ttu-id="47522-155">您可以依照建議的封裝當地語系化程式來 [當地語系化 Windows Installer 套件](localizing-a-windows-installer-package.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-155">You can follow the suggested package localization procedure in [Localizing a Windows Installer Package](localizing-a-windows-installer-package.md).</span></span>

## <a name="update-your-windows-installer-development-tools-and-documentation"></a><span data-ttu-id="47522-156">更新您的 Windows Installer 開發工具和檔。</span><span class="sxs-lookup"><span data-stu-id="47522-156">Update your Windows Installer development tools and documentation.</span></span>

-   <span data-ttu-id="47522-157">[Windows Installer 的開發工具](windows-installer-development-tools.md)不是可轉散發套件，您應該只使用 Microsoft 提供的這些工具版本。</span><span class="sxs-lookup"><span data-stu-id="47522-157">The [Windows Installer Development Tools](windows-installer-development-tools.md) are not redistributable, and you should only use the versions of these tools available from Microsoft.</span></span> <span data-ttu-id="47522-158">這些都可在 Microsoft Windows 軟體開發套件 (SDK) 中 [Windows Installer 開發人員的 Windows SDK 元件中取得](platform-sdk-components-for-windows-installer-developers.md) 。</span><span class="sxs-lookup"><span data-stu-id="47522-158">These are available in the [Windows SDK Components for Windows Installer Developers](platform-sdk-components-for-windows-installer-developers.md) in the Microsoft Windows Software Development Kit (SDK).</span></span>
-   <span data-ttu-id="47522-159">許多獨立軟體廠商提供建立或修改 Windows Installer 套件的工具。</span><span class="sxs-lookup"><span data-stu-id="47522-159">Several independent software vendors offer tools to create or modify Windows Installer packages.</span></span> <span data-ttu-id="47522-160">這些工具可以提供封裝撰寫環境，比 Windows Installer SDK 中提供的工具更容易使用。</span><span class="sxs-lookup"><span data-stu-id="47522-160">These tools can provide a package authoring environment that may be easier to use than the tools provided in the Windows Installer SDK.</span></span> <span data-ttu-id="47522-161">您可以從 [Windows Installer 資訊的其他來源](other-sources-of-windows-installer-information.md)中所討論的資訊資源，深入瞭解這些工具。</span><span class="sxs-lookup"><span data-stu-id="47522-161">You can learn more about these tools from the information resources discussed in [Other Sources of Windows Installer Information](other-sources-of-windows-installer-information.md).</span></span>
-   <span data-ttu-id="47522-162">對某些開發人員而言，從文字檔建立封裝的功能可能更直覺化。</span><span class="sxs-lookup"><span data-stu-id="47522-162">The capability to build a package from text files may be more intuitive for some developers.</span></span> <span data-ttu-id="47522-163">[Sourceforge.net](https://sourceforge.net/projects/wix)上提供的 Windows Installer Xml (WiX) 工具組會從 XML 原始程式碼建立 Windows 安裝套件。</span><span class="sxs-lookup"><span data-stu-id="47522-163">The Windows Installer XML (WiX) toolset available on [Sourceforge.net](https://sourceforge.net/projects/wix) builds Windows installation packages from XML source code.</span></span>
-   <span data-ttu-id="47522-164">MSDN 線上程式庫中所發行 [WINDOWS INSTALLER SDK](./windows-installer-portal.md) 的檔最常更新。</span><span class="sxs-lookup"><span data-stu-id="47522-164">The documentation in the [Windows Installer SDK](./windows-installer-portal.md) released in the MSDN Online Library is updated the most frequently.</span></span>
-   <span data-ttu-id="47522-165">使用適用于 Windows Vista 或更新版本的[Windows Installer 開發人員 Windows SDK 元件](platform-sdk-components-for-windows-installer-developers.md)中提供的[Msizap.exe](msizap-exe.md) (版本3.1.4000.2726 或更高版本) 。</span><span class="sxs-lookup"><span data-stu-id="47522-165">Use the recent version of [Msizap.exe](msizap-exe.md) (version 3.1.4000.2726 or greater) that is available in the [Windows SDK Components for Windows Installer Developers](platform-sdk-components-for-windows-installer-developers.md) for Windows Vista or greater.</span></span> <span data-ttu-id="47522-166">較低版本的 Msizap.exe 可以移除已套用至使用者電腦上其他應用程式之所有更新的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="47522-166">Lesser versions of Msizap.exe can remove information about all updates that have been applied to other applications on the user's computer.</span></span> <span data-ttu-id="47522-167">如果移除此資訊，可能需要移除並重新安裝這些其他應用程式才能接收其他更新。</span><span class="sxs-lookup"><span data-stu-id="47522-167">If this information is removed, these other applications may need to be removed and reinstalled to receive additional updates.</span></span>
-   <span data-ttu-id="47522-168">資料庫資料表編輯器 [Orca.exe](orca-exe.md) 是用來建立和編輯 Windows Installer 封裝和合併模組的資料庫資料表編輯器。</span><span class="sxs-lookup"><span data-stu-id="47522-168">The database table editor [Orca.exe](orca-exe.md) is a database table editor for creating and editing Windows Installer packages and merge modules.</span></span> <span data-ttu-id="47522-169">它有基本的 GUI 介面，但支援 Windows Installer 資料庫的 advanced 編輯。</span><span class="sxs-lookup"><span data-stu-id="47522-169">It has a basic GUI interface but supports advanced editing of Windows Installer databases.</span></span> <span data-ttu-id="47522-170">即使您使用其他應用程式作為主要開發工具，但您可能會發現使用 Orca.exe 在對封裝進行疑難排解和測試時，會很方便。</span><span class="sxs-lookup"><span data-stu-id="47522-170">Even if you use another application as your primary development tool, you may find using Orca.exe is convenient when troubleshooting and testing a package.</span></span>
-   <span data-ttu-id="47522-171">如需最新的 Windows Installer 資訊，請參閱 [Windows Installer 資訊的其他來源](other-sources-of-windows-installer-information.md) ，這些資訊可在 blog、技術聊天室、新聞群組、技術文章和網站中取得。</span><span class="sxs-lookup"><span data-stu-id="47522-171">See [Other Sources of Windows Installer Information](other-sources-of-windows-installer-information.md) for current Windows Installer information available in blogs, technical chats, newsgroups, technical articles, and websites.</span></span>

## <a name="if-you-decide-to-repackage-a-legacy-setup-application-follow-good-repackaging-practices"></a><span data-ttu-id="47522-172">如果您決定重新封裝舊版安裝應用程式，請遵循妥善的重新封裝做法。</span><span class="sxs-lookup"><span data-stu-id="47522-172">If you decide to repackage a legacy setup application, follow good repackaging practices.</span></span>

<span data-ttu-id="47522-173">許多應用程式廠商都提供安裝或其產品的原生 Windows Installer 套件。</span><span class="sxs-lookup"><span data-stu-id="47522-173">Many application vendors provide native Windows Installer packages for the installation or their products.</span></span> <span data-ttu-id="47522-174">將現有舊版安裝應用程式轉換成 Windows Installer 套件的軟體稱為「重新封裝」工具。</span><span class="sxs-lookup"><span data-stu-id="47522-174">Software that converts an existing legacy setup application into a Windows Installer package is referred to as a repackaging tool.</span></span> <span data-ttu-id="47522-175">[針對 Windows Installer 建立 Windows Installer 套件和重新封裝軟體的白皮書逐步指南](https://www.microsoft.com/technet/prodtechnol/windows2000serv/howto/winstall.mspx)，描述商用的可重新封裝工具。</span><span class="sxs-lookup"><span data-stu-id="47522-175">The whitepaper [Step-by-Step Guide to Creating Windows Installer Packages and Repackaging Software for the Windows Installer](https://www.microsoft.com/technet/prodtechnol/windows2000serv/howto/winstall.mspx) describes a commercially available repackaging tool.</span></span> <span data-ttu-id="47522-176">重新封裝現有的安裝應用程式並不是最佳的開發作法。</span><span class="sxs-lookup"><span data-stu-id="47522-176">Repackaging an existing setup application is not the best development practice.</span></span> <span data-ttu-id="47522-177">從開始設計的應用程式會利用 Windows Installer 功能，可讓使用者更輕鬆地安裝及服務。</span><span class="sxs-lookup"><span data-stu-id="47522-177">Applications that have been designed from the start to take advantage of Windows Installer features can be easier for users to install and service.</span></span> <span data-ttu-id="47522-178">如果您決定使用重新封裝軟體，下列做法可協助您產生更好的 Windows Installer 套件。</span><span class="sxs-lookup"><span data-stu-id="47522-178">If you decide to use a repackaging software the following practices can help you produce a better Windows Installer package.</span></span>

-   <span data-ttu-id="47522-179">重新封裝工具會將舊版安裝轉換成 Windows Installer 套件，方法是在安裝前後拍攝預備系統的圖片。</span><span class="sxs-lookup"><span data-stu-id="47522-179">Repackaging tools convert legacy installations into a Windows Installer package by taking a picture of a staging system before and after installation.</span></span> <span data-ttu-id="47522-180">在執行捕獲程式期間發生的任何登錄變更、檔案變更或系統設定，都會包含在安裝中。</span><span class="sxs-lookup"><span data-stu-id="47522-180">Any registry changes, file changes, or system setting that occurs during the capture process is included in the installation.</span></span> <span data-ttu-id="47522-181">將用來重新封裝安裝的電腦硬體和軟體設定為盡可能接近預期的使用者系統。</span><span class="sxs-lookup"><span data-stu-id="47522-181">Configure the hardware and software of the computer used to repackage the installation as close as possible to the intended user's system.</span></span> <span data-ttu-id="47522-182">為每個不同的硬體設定建立個別的套件。</span><span class="sxs-lookup"><span data-stu-id="47522-182">Create a separate package for each different hardware configuration.</span></span> <span data-ttu-id="47522-183">使用乾淨的預備電腦重新封裝。</span><span class="sxs-lookup"><span data-stu-id="47522-183">Repackage using a clean staging computer.</span></span> <span data-ttu-id="47522-184">移除任何不必要的應用程式。</span><span class="sxs-lookup"><span data-stu-id="47522-184">Remove any unnecessary applications.</span></span> <span data-ttu-id="47522-185">停止所有不必要的進程。</span><span class="sxs-lookup"><span data-stu-id="47522-185">Stop all unnecessary processes.</span></span> <span data-ttu-id="47522-186">關閉所有非基本的系統服務。</span><span class="sxs-lookup"><span data-stu-id="47522-186">Close all non-essential system services.</span></span>
-   <span data-ttu-id="47522-187">請一律建立原始安裝的複本，然後開始處理它。</span><span class="sxs-lookup"><span data-stu-id="47522-187">Always make a copy of the original installation before starting to work on it.</span></span> <span data-ttu-id="47522-188">一律使用複製。</span><span class="sxs-lookup"><span data-stu-id="47522-188">Always work on the copy.</span></span> <span data-ttu-id="47522-189">在完成封裝的建立之前，絕對不要停止重新封裝器。</span><span class="sxs-lookup"><span data-stu-id="47522-189">Never stop a repackager before it finishes building the package.</span></span> <span data-ttu-id="47522-190">如果重新封裝器損毀封裝，您仍然會有原始的。</span><span class="sxs-lookup"><span data-stu-id="47522-190">If the repackager damages the package you will still have the original.</span></span>
-   <span data-ttu-id="47522-191">請勿將 Microsoft 軟體更新重新封裝成 Windows Installer 套件。</span><span class="sxs-lookup"><span data-stu-id="47522-191">Do not repackage Microsoft software updates into a Windows Installer package.</span></span> <span data-ttu-id="47522-192">Microsoft 會將軟體更新（例如 service pack）發行為自動執行安裝的自動解壓縮檔案。</span><span class="sxs-lookup"><span data-stu-id="47522-192">Microsoft releases software updates, such as service packs, as self-extracting files that automatically runs installation.</span></span> <span data-ttu-id="47522-193">這些更新會使用不同于 Windows Installer 的安裝程式來取代受保護的 Windows 資源，且無法轉換成 Windows Installer 套件。</span><span class="sxs-lookup"><span data-stu-id="47522-193">These updates use different installers than the Windows Installer to replace protected Windows resources and cannot be converted into a Windows Installer package.</span></span> <span data-ttu-id="47522-194">如需有關如何部署 Windows service pack 的詳細資訊，請參閱 [Microsoft TechNet](https://technet.microsoft.com/)上的 service pack 部署指南。</span><span class="sxs-lookup"><span data-stu-id="47522-194">For information about how to deploy Windows service packs, see the service pack's deployment guide on [Microsoft TechNet](https://technet.microsoft.com/).</span></span>
-   <span data-ttu-id="47522-195">請勿使用重新封裝工具將 Windows Installer 封裝轉換成新的套件。</span><span class="sxs-lookup"><span data-stu-id="47522-195">Do not use a repackaging tool to convert a Windows Installer package into a new package.</span></span> <span data-ttu-id="47522-196">Windows Installer 會將設定資訊新增至系統以及應用程式資源。</span><span class="sxs-lookup"><span data-stu-id="47522-196">The Windows Installer adds configuration information to the system as well as application resources.</span></span> <span data-ttu-id="47522-197">當重新封裝工具在安裝前後比較系統時，重新封裝器會誤譯設定資訊作為應用程式的一部分。</span><span class="sxs-lookup"><span data-stu-id="47522-197">When a repackaging tool compares the system before and after the installation, the repackager misinterprets the configuration information as part of the application.</span></span> <span data-ttu-id="47522-198">這通常會損害重新封裝的應用程式。</span><span class="sxs-lookup"><span data-stu-id="47522-198">This usually damages the repackaged application.</span></span> <span data-ttu-id="47522-199">改為使用 [自訂轉換](a-customization-transform-example.md) 來修改現有的 Windows Installer 封裝，或建立新的封裝。</span><span class="sxs-lookup"><span data-stu-id="47522-199">Instead use [customization transforms](a-customization-transform-example.md) to modify an existing Windows Installer package, or make an new package.</span></span> <span data-ttu-id="47522-200">您可以使用 [Msitran.exe](msitran-exe.md) 工具來建立自訂轉換。</span><span class="sxs-lookup"><span data-stu-id="47522-200">You can create customization transforms using the [Msitran.exe](msitran-exe.md) tool.</span></span>
-   <span data-ttu-id="47522-201">請勿使用重新封裝工具，將數個 Windows Installer 套件合併成單一套件。</span><span class="sxs-lookup"><span data-stu-id="47522-201">Do not use a repackaging tool to consolidate several Windows Installer packages into a single package.</span></span> <span data-ttu-id="47522-202">您可以改為使用 [Msistuff.exe](msistuff-exe.md) 工具來設定 Setup.exe 啟動程式可執行檔，以逐一安裝套件。</span><span class="sxs-lookup"><span data-stu-id="47522-202">Instead you can use the [Msistuff.exe](msistuff-exe.md) tool to configure the Setup.exe bootstrap executable to install the packages one after another.</span></span>
-   <span data-ttu-id="47522-203">製作您的 Windows Installer 套件，讓客戶可以輕鬆地自訂。</span><span class="sxs-lookup"><span data-stu-id="47522-203">Make your Windows Installer package so that it can be easily customized by the customer.</span></span> <span data-ttu-id="47522-204">在安裝期間，Windows Installer 所使用的全域變數可以使用公用 [屬性](properties.md) 或 [自訂轉換](a-customization-transform-example.md)來設定。</span><span class="sxs-lookup"><span data-stu-id="47522-204">Global variables used by the Windows Installer during an installation can be set using public [properties](properties.md) or [customization transforms](a-customization-transform-example.md).</span></span> <span data-ttu-id="47522-205">提供檔，說明如何使用這些屬性以及所有可自訂值的實際預設值。</span><span class="sxs-lookup"><span data-stu-id="47522-205">Provide documentation for the use of those properties and practical default values for all customizable values.</span></span> <span data-ttu-id="47522-206">如需取得和設定屬性的詳細資訊，請參閱 [使用屬性](using-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-206">For information about getting and setting properties see [Using Properties](using-properties.md).</span></span> <span data-ttu-id="47522-207">如需自訂轉換的範例，請參閱 [自訂轉換範例](a-customization-transform-example.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-207">For an example of a customization transform see [A Customization Transform Example](a-customization-transform-example.md).</span></span>

## <a name="do-not-try-to-replace-protected-resources"></a><span data-ttu-id="47522-208">請勿嘗試取代受保護的資源。</span><span class="sxs-lookup"><span data-stu-id="47522-208">Do not try to replace protected resources.</span></span>

<span data-ttu-id="47522-209">在安裝或更新期間，Windows Installer 套件不應嘗試取代受保護的資源。</span><span class="sxs-lookup"><span data-stu-id="47522-209">Windows Installer packages should not attempt to replace protected resources during installation or update.</span></span> <span data-ttu-id="47522-210">Windows Installer 不會移除或取代這些資源，因為 Windows 會防止取代必要的系統檔案、資料夾和登錄機碼。</span><span class="sxs-lookup"><span data-stu-id="47522-210">The Windows Installer does not remove or replace these resources because Windows prevents the replacement of essential system files, folders, and registry keys.</span></span> <span data-ttu-id="47522-211">保護這些資源可防止應用程式和作業系統失敗。</span><span class="sxs-lookup"><span data-stu-id="47522-211">Protecting these resources prevents application and operating system failures.</span></span>

-   <span data-ttu-id="47522-212">在 Windows Server 2008 或 Windows Vista 上執行時，Windows Installer 會略過 [Windows 資源保護](../wfp/windows-resource-protection-portal.md) (WRP) 所保護的任何檔案或登錄機碼的安裝，安裝程式會在記錄檔中輸入警告，並繼續安裝的其餘部分，而不會發生錯誤。</span><span class="sxs-lookup"><span data-stu-id="47522-212">When running on Windows Server 2008 or Windows Vista, the Windows Installer skips the installation of any file or registry key that is protected by [Windows Resource Protection](../wfp/windows-resource-protection-portal.md) (WRP), the installer enters a warning in the log file, and continues with the remainder of the installation without an error.</span></span> <span data-ttu-id="47522-213">如需詳細資訊，請參閱 [使用 Windows Installer 和 Windows 資源保護](windows-resource-protection-on-windows-vista.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-213">For information, see [Using Windows Installer and Windows Resource Protection](windows-resource-protection-on-windows-vista.md).</span></span>
-   <span data-ttu-id="47522-214">WRP 是 Windows 檔案保護 (WFP) 的新名稱。</span><span class="sxs-lookup"><span data-stu-id="47522-214">WRP is the new name for Windows File Protection (WFP).</span></span> <span data-ttu-id="47522-215">WRP 可保護登錄機碼和資料夾，以及基本的系統檔案。</span><span class="sxs-lookup"><span data-stu-id="47522-215">WRP protects registry keys and folders as well as essential system files.</span></span> <span data-ttu-id="47522-216">在 Windows Server 2003、Windows XP 及 Windows 2000 中，當 Windows Installer 遇到受 WFP 保護的檔案時，安裝程式會要求 WFP 安裝檔案。</span><span class="sxs-lookup"><span data-stu-id="47522-216">In Windows Server 2003, Windows XP, and Windows 2000, when the Windows Installer encountered a WFP-protected file, the installer would request that WFP install the file.</span></span> <span data-ttu-id="47522-217">如需詳細資訊，請參閱 [使用 Windows Installer 和 Windows 資源保護](windows-resource-protection-on-windows-vista.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-217">For information, see [Using Windows Installer and Windows Resource Protection](windows-resource-protection-on-windows-vista.md).</span></span>

## <a name="do-not-depend-upon-non-critical-resources"></a><span data-ttu-id="47522-218">請勿依賴非關鍵性的資源。</span><span class="sxs-lookup"><span data-stu-id="47522-218">Do not depend upon non-critical resources.</span></span>

<span data-ttu-id="47522-219">基於下列原因，您的安裝或更新不應該相依于非關鍵性資源的安裝。</span><span class="sxs-lookup"><span data-stu-id="47522-219">Your installation or update should not depend upon the installation of non-critical resources for the following reasons.</span></span>

-   <span data-ttu-id="47522-220">如果自訂動作相依于某個元件，而該元件屬於使用者所通告的功能，而不是安裝，則可能會失敗。</span><span class="sxs-lookup"><span data-stu-id="47522-220">Custom actions can fail if they depend upon a component belonging to a feature that the user advertises rather than installs.</span></span>
-   <span data-ttu-id="47522-221">如果自訂動作相依于包含所安裝元件的元件，則在 [InstallFinalize](installfinalize-action.md) 動作之前排序的自訂動作可能會失敗。</span><span class="sxs-lookup"><span data-stu-id="47522-221">Custom actions sequenced before the [InstallFinalize](installfinalize-action.md) action can fail if they depend on a component containing an assembly that is being installed.</span></span> <span data-ttu-id="47522-222">Windows Installer 在 InstallFinalize 動作完成之前，不會將元件認可至全域組件快取 (GAC) 。</span><span class="sxs-lookup"><span data-stu-id="47522-222">The Windows Installer does not commit assemblies to the Global Assembly Cache (GAC) until the InstallFinalize action completes.</span></span>

## <a name="use-the-api-to-retrieve-windows-installer-configuration-information"></a><span data-ttu-id="47522-223">使用 API 來取出 Windows Installer 設定資訊。</span><span class="sxs-lookup"><span data-stu-id="47522-223">Use the API to retrieve Windows Installer configuration information.</span></span>

<span data-ttu-id="47522-224">安裝您的應用程式或更新時，不應該相依于您電腦上所儲存 Windows Installer 設定資訊的直接存取。</span><span class="sxs-lookup"><span data-stu-id="47522-224">The installation of your application or update should not depend upon direct access to Windows Installer configuration information saved on your computer.</span></span> <span data-ttu-id="47522-225">改為使用 Windows Installer 應用程式開發介面來取得設定資訊。</span><span class="sxs-lookup"><span data-stu-id="47522-225">Instead use the Windows Installer application programming interface to retrieve configuration information.</span></span> <span data-ttu-id="47522-226">設定資訊的位置和格式是由 Windows Installer 服務所管理，而且可以變更。</span><span class="sxs-lookup"><span data-stu-id="47522-226">The location and format of configuration information is managed by the Windows Installer service and can change.</span></span>

-   <span data-ttu-id="47522-227">Windows Installer API 的安裝和設定功能將在 [安裝程式函數參考](installer-function-reference.md)中說明。</span><span class="sxs-lookup"><span data-stu-id="47522-227">The Installation and Configuration Functions of the Windows Installer API are described in the [Installer Function Reference](installer-function-reference.md).</span></span>
-   <span data-ttu-id="47522-228">設定 [屬性](property-reference.md) 會在屬性參考中描述。</span><span class="sxs-lookup"><span data-stu-id="47522-228">The [Configuration Properties](property-reference.md) are described in the Property Reference.</span></span>
-   <span data-ttu-id="47522-229">Automation [介面參考](automation-interface-reference.md)中說明了自動化方法和屬性。</span><span class="sxs-lookup"><span data-stu-id="47522-229">The automation methods and properties are described in the [Automation Interface Reference](automation-interface-reference.md).</span></span> <span data-ttu-id="47522-230">範例腳本 WiLstPrd.vbs 連接到安裝程式物件，並列舉已註冊的產品和產品資訊。</span><span class="sxs-lookup"><span data-stu-id="47522-230">The sample script WiLstPrd.vbs connects to an Installer object and enumerates registered products and product information.</span></span> <span data-ttu-id="47522-231">如需詳細資訊，請參閱 [列出產品、屬性、功能和元件](list-products-properties-features-and-components.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-231">For information see [List Products, Properties, Features, and Components](list-products-properties-features-and-components.md).</span></span>

## <a name="organize-the-installation-of-your-application-around-components"></a><span data-ttu-id="47522-232">在元件周圍組織應用程式的安裝。</span><span class="sxs-lookup"><span data-stu-id="47522-232">Organize the installation of your application around components.</span></span>

<span data-ttu-id="47522-233">Windows Installer 服務會安裝或移除稱為 [元件](windows-installer-components.md)的資源集合。</span><span class="sxs-lookup"><span data-stu-id="47522-233">The Windows Installer service installs or removes collections of resources referred to as [components](windows-installer-components.md).</span></span> <span data-ttu-id="47522-234">因為通常會共用元件，所以安裝套件的作者在指定功能或應用程式的元件時，必須遵循規則。</span><span class="sxs-lookup"><span data-stu-id="47522-234">Because components are commonly shared, the author of an installation package must follow rules when specifying the components of a feature or application.</span></span>

-   <span data-ttu-id="47522-235">將 [應用程式組織成元件](organizing-applications-into-components.md) 時，請遵循元件規則，以確保可以安裝和移除新元件或新版本的元件，而不會破壞其他應用程式。</span><span class="sxs-lookup"><span data-stu-id="47522-235">Adhere to the component rules when [Organizing Applications into Components](organizing-applications-into-components.md) to ensure that new components, or new versions of components, can be installed and removed without damaging other applications.</span></span> <span data-ttu-id="47522-236">您可以依照 [定義安裝程式元件](defining-installer-components.md)中所述的程式進行操作。</span><span class="sxs-lookup"><span data-stu-id="47522-236">You can follow the procedure described in [Defining Installer Components](defining-installer-components.md).</span></span>
-   <span data-ttu-id="47522-237">安裝程式會依 [元件表格](component-table.md)中所指定的個別元件識別碼 GUID 來追蹤每個元件。</span><span class="sxs-lookup"><span data-stu-id="47522-237">The installer tracks every component by the respective component ID GUID specified in the [Component table](component-table.md).</span></span> <span data-ttu-id="47522-238">這對 Windows Installer 的參考計數機制而言很重要，因為元件識別碼 GUID 是正確的。</span><span class="sxs-lookup"><span data-stu-id="47522-238">It is essential for the operation of the Windows Installer reference-counting mechanism that the component ID GUID is correct.</span></span> <span data-ttu-id="47522-239">遵循 [變更元件程式碼](changing-the-component-code.md)的指導方針。</span><span class="sxs-lookup"><span data-stu-id="47522-239">Follow the guidelines in [Changing the Component Code](changing-the-component-code.md).</span></span>
-   <span data-ttu-id="47522-240">如果您的套件必須中斷元件規則，請留意可能的結果，並確定您的安裝絕不會安裝這些元件，而這些元件可能會損毀使用者系統上的元件。</span><span class="sxs-lookup"><span data-stu-id="47522-240">If your package must break the component rules, be aware of the possible consequences and ensure that your installation never installs these components where they may damage components on the user's system.</span></span> <span data-ttu-id="47522-241">如需詳細資訊，請參閱 [元件規則中斷時，會發生什麼事？](what-happens-if-the-component-rules-are-broken.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-241">For information see [What happens if the component rules are broken?](what-happens-if-the-component-rules-are-broken.md).</span></span>
-   <span data-ttu-id="47522-242">[取代現有](replacing-existing-files.md)的檔案時，請注意 Windows Installer 如何套用檔案[版本控制規則](file-versioning-rules.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-242">Be aware how the Windows Installer applies the [File Versioning Rules](file-versioning-rules.md) when [Replacing Existing Files](replacing-existing-files.md).</span></span> <span data-ttu-id="47522-243">Windows Installer 先決定是否已安裝元件的金鑰檔，然後再嘗試安裝元件的任何檔案。</span><span class="sxs-lookup"><span data-stu-id="47522-243">The Windows Installer first determines whether the component's key file is already installed before attempting to install any of the files of the component.</span></span> <span data-ttu-id="47522-244">如果安裝程式找到的檔案與安裝在目標位置中的元件金鑰檔名稱相同，則會比較兩個金鑰檔的版本、日期和語言，並使用檔案版本控制規則來判斷是否要安裝封裝所提供的元件。</span><span class="sxs-lookup"><span data-stu-id="47522-244">If the installer finds a file with the same name as the component's key file installed in the target location, it compares the version, date, and language of the two key files and uses file versioning rules to determine whether to install the component provided by the package.</span></span> <span data-ttu-id="47522-245">如果安裝程式判斷需要在金鑰檔上取代元件基底，則會在每個已安裝的檔案上使用檔案版本控制規則，以判斷是否要取代檔案。</span><span class="sxs-lookup"><span data-stu-id="47522-245">If the installer determines it needs to replace the component base upon the key file, then it uses the file versioning rules on each installed file to determine whether to replace the file.</span></span>

## <a name="reduce-the-size-of-large-windows-installer-packages"></a><span data-ttu-id="47522-246">減少大型 Windows Installer 套件的大小。</span><span class="sxs-lookup"><span data-stu-id="47522-246">Reduce the size of large Windows Installer packages.</span></span>

<span data-ttu-id="47522-247">非常大型的 Windows 套件採用系統資源，而且可能很難安裝使用者。</span><span class="sxs-lookup"><span data-stu-id="47522-247">Very large Windows Packages take system resources and can be difficult for users to install.</span></span> <span data-ttu-id="47522-248">最好的作法是使用下列方法來縮減超大型 Windows Installer 套件的大小。</span><span class="sxs-lookup"><span data-stu-id="47522-248">It is good practice to reduce the size of very large Windows Installer Packages by the following methods.</span></span>

-   <span data-ttu-id="47522-249">壓縮安裝中的檔案，並將它們儲存在封包 ( .cab) 檔案中。</span><span class="sxs-lookup"><span data-stu-id="47522-249">Compress the files in the installation and store them in a cabinet (.cab) file .</span></span> <span data-ttu-id="47522-250">安裝程式允許將 .cab 檔儲存為個別的外部檔案，或儲存為 MSI 封裝本身的資料流程。</span><span class="sxs-lookup"><span data-stu-id="47522-250">The Installer allows the .cab file to be stored as a separate external file, or as a data stream in the MSI package itself.</span></span> <span data-ttu-id="47522-251">如需詳細資訊，請參閱 [使用封包和壓縮的來源](using-cabinets-and-compressed-sources.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-251">For information see [Using Cabinets and Compressed Sources](using-cabinets-and-compressed-sources.md).</span></span>
-   <span data-ttu-id="47522-252">使用 [減少 .msi 檔案大小](reducing-the-size-of-an--msi-file.md)所討論的其中一個選項，移除 .msi 檔案中浪費的儲存空間。</span><span class="sxs-lookup"><span data-stu-id="47522-252">Remove wasted storage space in the .msi file using one of the options discussed in [Reducing the Size of an .msi File](reducing-the-size-of-an--msi-file.md).</span></span>
-   <span data-ttu-id="47522-253">如果您的 Windows Installer 封裝包含32767以上的檔案，您必須變更資料庫的架構。</span><span class="sxs-lookup"><span data-stu-id="47522-253">If your Windows Installer package contains more than 32767 files, you must change the schema of the database.</span></span> <span data-ttu-id="47522-254">如需詳細資訊，請參閱 [撰寫大型封裝](authoring-a-large-package.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-254">For information see [Authoring a Large Package](authoring-a-large-package.md).</span></span>

## <a name="if-you-use-custom-actions-follow-good-custom-action-practices"></a><span data-ttu-id="47522-255">如果您使用自訂動作，請遵循良好的自訂動作實務。</span><span class="sxs-lookup"><span data-stu-id="47522-255">If you use custom actions, follow good custom action practices.</span></span>

<span data-ttu-id="47522-256">Windows Installer 在安裝和維護應用程式時，有許多內建的 [標準動作](standard-actions-reference.md) 。</span><span class="sxs-lookup"><span data-stu-id="47522-256">The Windows Installer has many built-in [standard actions](standard-actions-reference.md) for the installation and maintenance of applications.</span></span> <span data-ttu-id="47522-257">開發人員應該儘量依賴標準動作，而不是建立自己的 [自訂動作](custom-actions.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-257">Developers should attempt to rely upon the standard actions as much as practical, rather than create their own [custom actions](custom-actions.md).</span></span> <span data-ttu-id="47522-258">不過，在某些情況下，安裝套件的開發人員會發現需要撰寫自訂動作。</span><span class="sxs-lookup"><span data-stu-id="47522-258">However, there are situations where the developer of an installation package finds it necessary to write a custom action.</span></span>

-   <span data-ttu-id="47522-259">遵循 [使用自訂動作](using-custom-actions.md)的指導方針。</span><span class="sxs-lookup"><span data-stu-id="47522-259">Follow the guidelines for [Using Custom Actions](using-custom-actions.md).</span></span>
-   <span data-ttu-id="47522-260">遵循 [指導方針來保護自訂動作](guidelines-for-securing-custom-actions.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-260">Follow the [Guidelines for Securing Custom Actions](guidelines-for-securing-custom-actions.md).</span></span> <span data-ttu-id="47522-261">使用敏感性資訊的自訂動作不應將此資訊寫入記錄檔中。</span><span class="sxs-lookup"><span data-stu-id="47522-261">Custom actions that use sensitive information should not write this information into the log.</span></span> <span data-ttu-id="47522-262">如需詳細資訊，請參閱 [自訂動作安全性](custom-action-security.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-262">For information see [Custom Action Security](custom-action-security.md).</span></span>
-   <span data-ttu-id="47522-263">自訂動作不能嘗試設定自訂動作內的系統還原進入點。</span><span class="sxs-lookup"><span data-stu-id="47522-263">Custom Actions must not attempt to set a System Restore entry point from within a custom action.</span></span> <span data-ttu-id="47522-264">如需詳細資訊，請參閱 [設定自訂動作的還原點](setting-a-restore-point-from-a-custom-action.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-264">For information see [Setting a restore point from a Custom Action](setting-a-restore-point-from-a-custom-action.md).</span></span>
-   <span data-ttu-id="47522-265">從自訂動作傳回錯誤訊息，並將它們寫入記錄檔，以協助疑難排解自訂動作。</span><span class="sxs-lookup"><span data-stu-id="47522-265">Return error messages from custom actions and write them to the log to facilitate troubleshooting custom actions.</span></span> <span data-ttu-id="47522-266">如需詳細資訊，請參閱 [錯誤訊息自訂動作](error-message-custom-actions.md) 和 [從自訂動作傳回錯誤訊息](returning-error-messages-from-custom-actions.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-266">For information see [Error Message Custom Actions](error-message-custom-actions.md) and [Returning Error Messages from Custom Actions](returning-error-messages-from-custom-actions.md).</span></span>
-   <span data-ttu-id="47522-267">請勿變更來自立即自訂動作的系統狀態。</span><span class="sxs-lookup"><span data-stu-id="47522-267">Do not change the system state from an immediate custom action.</span></span> <span data-ttu-id="47522-268">直接變更系統或呼叫另一個系統服務的自訂動作，必須延後至執行安裝腳本的時間。</span><span class="sxs-lookup"><span data-stu-id="47522-268">Custom actions that change the system directly or call another system service must be deferred to the time when the installation script is executed.</span></span> <span data-ttu-id="47522-269">變更系統狀態的每個 [順延強制自訂動作](deferred-execution-custom-actions.md) 之前都必須加上 [rollback 自訂動作](rollback-custom-actions.md) ，以復原安裝復原上的系統狀態變更。</span><span class="sxs-lookup"><span data-stu-id="47522-269">Every [deferred execution custom action](deferred-execution-custom-actions.md) that changes the system state must be preceded by a [rollback custom action](rollback-custom-actions.md) to undo the system state change on an installation rollback.</span></span> <span data-ttu-id="47522-270">如需詳細資訊，請參閱 [使用自訂動作變更系統狀態](changing-the-system-state-using-a-custom-action.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-270">For information see [Changing the System State Using a Custom Action](changing-the-system-state-using-a-custom-action.md).</span></span>
-   <span data-ttu-id="47522-271">執行複雜安裝作業的自訂動作應該是 [可執行檔](executable-files.md) 或 [動態連結程式庫](dynamic-link-libraries.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-271">Custom actions that perform complex installation operations should be an [executable file](executable-files.md) or [dynamic-link library](dynamic-link-libraries.md).</span></span> <span data-ttu-id="47522-272">根據 [腳本](scripts.md) ，將自訂動作的使用限制為簡單的安裝作業。</span><span class="sxs-lookup"><span data-stu-id="47522-272">Limit the use of custom actions based on [scripts](scripts.md) to simple installation operations.</span></span>
-   <span data-ttu-id="47522-273">將您的自訂動作的詳細資料提供給系統管理員，方便探索到系統管理員。</span><span class="sxs-lookup"><span data-stu-id="47522-273">Make the details of what your custom action does to the system easily discoverable to system administrators.</span></span> <span data-ttu-id="47522-274">將自訂動作所使用的登錄專案和檔案的詳細資料，放入自訂的資料表，並從這個資料表讀取自訂動作。</span><span class="sxs-lookup"><span data-stu-id="47522-274">Put the details of registry entries and files used by your custom action into a custom table and have the custom action read from this table.</span></span> <span data-ttu-id="47522-275">這是 [使用自訂動作在本機電腦上建立使用者帳戶](using-a-custom-action-to-create-user-accounts-on-a-local-computer.md)的範例所示範。</span><span class="sxs-lookup"><span data-stu-id="47522-275">This is demonstrated by the example in [Using a Custom Action to Create User Accounts on a Local Computer](using-a-custom-action-to-create-user-accounts-on-a-local-computer.md).</span></span> <span data-ttu-id="47522-276">如需將自訂資料表加入至資料庫的詳細資訊，請參閱[使用 SQL 和腳本](examples-of-database-queries-using-sql-and-script.md)[處理查詢](working-with-queries.md)和資料庫查詢範例。</span><span class="sxs-lookup"><span data-stu-id="47522-276">For information on adding custom tables to a database, see [Working with Queries](working-with-queries.md) and [Examples of Database Queries Using SQL and Script](examples-of-database-queries-using-sql-and-script.md).</span></span>
-   <span data-ttu-id="47522-277">自訂動作不應顯示對話方塊。</span><span class="sxs-lookup"><span data-stu-id="47522-277">A custom actions should not display a dialog box.</span></span> <span data-ttu-id="47522-278">需要使用者介面的自訂動作可以改用 [**MsiProcessMessage**](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage) 函數。</span><span class="sxs-lookup"><span data-stu-id="47522-278">Custom actions requiring a user interface can use the [**MsiProcessMessage**](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage) function instead.</span></span> <span data-ttu-id="47522-279">請參閱 [使用 MsiProcessMessage 將訊息傳送至 Windows Installer](sending-messages-to-windows-installer-using-msiprocessmessage.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-279">See [Sending Messages to Windows Installer Using MsiProcessMessage](sending-messages-to-windows-installer-using-msiprocessmessage.md).</span></span>
-   <span data-ttu-id="47522-280">自訂動作不得使用頁面上所列的任何函式： [非自訂動作中使用](functions-not-for-use-in-custom-actions.md)的函式。</span><span class="sxs-lookup"><span data-stu-id="47522-280">Custom actions must not use any of the functions listed on the page: [Functions Not for Use in Custom Actions](functions-not-for-use-in-custom-actions.md).</span></span>
-   <span data-ttu-id="47522-281">如果安裝是要在終端機伺服器上執行，請測試所有自訂動作都能在終端機伺服器上執行。</span><span class="sxs-lookup"><span data-stu-id="47522-281">If the installation is intended to run on a terminal server, test that all your custom actions are capable of running on a terminal server.</span></span> <span data-ttu-id="47522-282">如需詳細資訊，請參閱 [**TerminalServer**](terminalserver.md) 屬性。</span><span class="sxs-lookup"><span data-stu-id="47522-282">For more information see [**TerminalServer**](terminalserver.md) property.</span></span>
-   <span data-ttu-id="47522-283">若要在卸載特定的修補程式時執行自訂動作，自訂動作必須存在於原始應用程式中，或者必須在永遠套用之產品的修補程式中。</span><span class="sxs-lookup"><span data-stu-id="47522-283">To have a custom action run when a particular patch is uninstalled the custom action must either be present in the original application or be in a patch for the product that is always applied.</span></span> <span data-ttu-id="47522-284">如需詳細資訊，請參閱 [修補卸載自訂動作](patch-uninstall-custom-actions.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-284">For more information see [Patch Uninstall Custom Actions](patch-uninstall-custom-actions.md).</span></span>
-   <span data-ttu-id="47522-285">自訂動作不應使用 UI 層級做為將錯誤訊息傳送至安裝程式的條件，因為這可能會干擾記錄和外部訊息。</span><span class="sxs-lookup"><span data-stu-id="47522-285">Custom actions should not use the UI level as a condition for sending error messages to the installer because this can interfere with logging and external messages.</span></span> <span data-ttu-id="47522-286">如需詳細資訊，請參閱 [從自訂動作判斷 UI 層級](determining-ui-level-from-a-custom-action.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-286">For information see [Determining UI Level from a Custom Action](determining-ui-level-from-a-custom-action.md).</span></span>
-   <span data-ttu-id="47522-287">使用條件陳述式和 [條件陳述式語法](conditional-statement-syntax.md) ，以確保您的封裝會正確執行自訂動作、不執行自訂動作，或在卸載套件時執行替代自訂動作。</span><span class="sxs-lookup"><span data-stu-id="47522-287">Use conditional statements and [Conditional Statement Syntax](conditional-statement-syntax.md) to ensure that your package correctly runs custom actions, does not run a custom actions, or runs alternate custom action when the package is uninstalled.</span></span> <span data-ttu-id="47522-288">測試套件在 [卸載自訂動作](uninstalling-custom-actions.md)時是否如預期般運作。</span><span class="sxs-lookup"><span data-stu-id="47522-288">Test that the package works as expected when [uninstalling custom actions](uninstalling-custom-actions.md).</span></span> <span data-ttu-id="47522-289">如需詳細資訊，請參閱 [移除時要執行的調節動作](conditioning-actions-to-run-during-removal.md)</span><span class="sxs-lookup"><span data-stu-id="47522-289">For information see [Conditioning Actions to Run During Removal](conditioning-actions-to-run-during-removal.md)</span></span>
-   <span data-ttu-id="47522-290">如果安裝必須能夠由沒有系統管理員許可權的使用者執行，請進行測試以確保所有自訂動作都能以非系統管理員許可權執行。</span><span class="sxs-lookup"><span data-stu-id="47522-290">If the installation must be capable of being run by users that do not have administrator privileges, test to ensure that all the custom actions can be run with non-administrator privileges.</span></span> <span data-ttu-id="47522-291">自訂動作需要較高的許可權，才能修改系統中非特定使用者的部分。</span><span class="sxs-lookup"><span data-stu-id="47522-291">Custom actions require elevated privileges to modify parts of the system that are not user specific.</span></span> <span data-ttu-id="47522-292">如果正在安裝受管理的應用程式，或已針對較高的許可權指定系統原則，則安裝程式可能會以更高的許可權執行自訂動作。</span><span class="sxs-lookup"><span data-stu-id="47522-292">The installer may run custom actions with elevated privileges if a managed application is being installed or if the system policy has been specified for elevated privileges.</span></span> <span data-ttu-id="47522-293">需要提高許可權的任何自訂動作都必須在自訂動作類型中包含 msidbCustomActionTypeInScript 和 msidbCustomActionTypeNoImpersonate [自訂動作 In-Script 執行選項](custom-action-in-script-execution-options.md) 。</span><span class="sxs-lookup"><span data-stu-id="47522-293">Any custom actions the require elevated privileges must include the msidbCustomActionTypeInScript and msidbCustomActionTypeNoImpersonate [Custom Action In-Script Execution Options](custom-action-in-script-execution-options.md) in the custom action type.</span></span> <span data-ttu-id="47522-294">這是 [使用自訂動作在本機電腦上建立使用者帳戶](using-a-custom-action-to-create-user-accounts-on-a-local-computer.md)的範例所示範。</span><span class="sxs-lookup"><span data-stu-id="47522-294">This is demonstrated by the example in [Using a Custom Action to Create User Accounts on a Local Computer](using-a-custom-action-to-create-user-accounts-on-a-local-computer.md).</span></span>

## <a name="if-you-use-assemblies-follow-good-assembly-practices"></a><span data-ttu-id="47522-295">如果您使用元件，請遵循良好的元件實務</span><span class="sxs-lookup"><span data-stu-id="47522-295">If you use assemblies, follow good assembly practices</span></span>

<span data-ttu-id="47522-296">如果您的套件使用軟體 [元件](assemblies.md)，請遵循將 [元件新增至套件](adding-assemblies-to-a-package.md)、 [更新元件](updating-assemblies.md)，以及 [安裝和移除元件](installing-and-removing-assemblies.md)的指導方針。</span><span class="sxs-lookup"><span data-stu-id="47522-296">If your package uses software [assemblies](assemblies.md), follow the guidelines for [Adding Assemblies to a Package](adding-assemblies-to-a-package.md), [Updating Assemblies](updating-assemblies.md), and [Installing and Removing Assemblies](installing-and-removing-assemblies.md).</span></span>

## <a name="do-not-ship-concurrent-installations"></a><span data-ttu-id="47522-297">請勿運送並行安裝。</span><span class="sxs-lookup"><span data-stu-id="47522-297">Do not ship concurrent installations.</span></span>

<span data-ttu-id="47522-298">[並行安裝](concurrent-installations.md)（也稱為嵌套安裝）會在目前執行的安裝期間安裝另一個 Windows Installer 套件。</span><span class="sxs-lookup"><span data-stu-id="47522-298">[Concurrent Installations](concurrent-installations.md), also called Nested Installations, install another Windows Installer package during a currently running installation.</span></span> <span data-ttu-id="47522-299">使用並行安裝不是很好的作法，因為它們對客戶而言很難服務。</span><span class="sxs-lookup"><span data-stu-id="47522-299">The use of concurrent installations is not a good practice because they are difficult for customers to service.</span></span> <span data-ttu-id="47522-300">修補和升級可能無法搭配並行安裝使用。</span><span class="sxs-lookup"><span data-stu-id="47522-300">Patching and upgrading may not work with concurrent installations.</span></span> <span data-ttu-id="47522-301">使用並行安裝的建議替代方式是改為使用安裝應用程式和外部 UI 處理常式，依序安裝數個 Windows Installer 套件。</span><span class="sxs-lookup"><span data-stu-id="47522-301">The recommended alternative to using concurrent installations is to instead use a setup application and external UI handler to install several Windows Installer packages sequentially.</span></span>

<span data-ttu-id="47522-302">如需使用外部 UI 處理常式的詳細資訊，請參閱 [使用 MsiSetExternalUI 監視安裝](monitoring-an-installation-using-msisetexternalui.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-302">For more information about using an external UI handler see [Monitoring an Installation Using MsiSetExternalUI](monitoring-an-installation-using-msisetexternalui.md).</span></span> <span data-ttu-id="47522-303">如需使用以記錄為基礎的外部處理常式的詳細資訊，請參閱 [使用 MsiSetExternalUIRecord 監視安裝](monitoring-an-installation-using-msisetexternaluirecord.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-303">For more information about using a record-based external handler, see [Monitoring an Installation Using MsiSetExternalUIRecord](monitoring-an-installation-using-msisetexternaluirecord.md).</span></span>

<span data-ttu-id="47522-304">在受控制的公司環境中，有時會使用並行安裝來安裝不適合公用的應用程式。</span><span class="sxs-lookup"><span data-stu-id="47522-304">Concurrent installations are sometimes used in controlled corporate environments to install applications that are not intended for the public.</span></span> <span data-ttu-id="47522-305">如果您決定要使用並行安裝，請遵循這些指導方針。</span><span class="sxs-lookup"><span data-stu-id="47522-305">Follow these guidelines if you decide to use concurrent installations.</span></span>

-   <span data-ttu-id="47522-306">請勿使用並行安裝來安裝或更新出貨產品。</span><span class="sxs-lookup"><span data-stu-id="47522-306">Do not use concurrent installations to install or update a shipping product.</span></span>
-   <span data-ttu-id="47522-307">並行安裝不應共用元件。</span><span class="sxs-lookup"><span data-stu-id="47522-307">Concurrent installations should not share components.</span></span>
-   <span data-ttu-id="47522-308">系統管理安裝不應包含並行安裝。</span><span class="sxs-lookup"><span data-stu-id="47522-308">An administrative installation should not contain a concurrent installation.</span></span>
-   <span data-ttu-id="47522-309">整合式 ProgressBars 不應搭配並行安裝使用。</span><span class="sxs-lookup"><span data-stu-id="47522-309">Integrated ProgressBars should not be used with concurrent installations.</span></span>
-   <span data-ttu-id="47522-310">同時安裝不應安裝要通告的資源。</span><span class="sxs-lookup"><span data-stu-id="47522-310">Resources that are to be advertised should not be installed by a concurrent installation.</span></span>
-   <span data-ttu-id="47522-311">執行應用程式並行安裝的封裝，也應該在父產品卸載時卸載並行應用程式。</span><span class="sxs-lookup"><span data-stu-id="47522-311">A package that performs a concurrent installation of an application should also uninstall the concurrent application when the parent product is uninstalled.</span></span> <span data-ttu-id="47522-312">在主控台的 [新增/移除程式] 中，父產品的內容下會有嵌套的安裝。</span><span class="sxs-lookup"><span data-stu-id="47522-312">A nested installation exists under the context of the parent product in the Add/Remove Programs in Control Panel.</span></span>

## <a name="keep-package-names-and-package-codes-consistent"></a><span data-ttu-id="47522-313">讓套件名稱和套件碼保持一致。</span><span class="sxs-lookup"><span data-stu-id="47522-313">Keep package names and package codes consistent.</span></span>

<span data-ttu-id="47522-314">.Msi 檔案可以提供任何有助於使用者識別封裝的名稱，但不應該變更該名稱，也不需要變更產品代碼。</span><span class="sxs-lookup"><span data-stu-id="47522-314">The .msi file can be given any name that helps users identify the package, but the name should not be changed without also changing the product code.</span></span>

-   <span data-ttu-id="47522-315">為您的 .msi 檔案提供可讓使用者識別 Windows Installer 套件內容的易記名稱。</span><span class="sxs-lookup"><span data-stu-id="47522-315">Give your .msi file a user-friendly name that enables the user to identify the contents of the Windows Installer package.</span></span>
-   <span data-ttu-id="47522-316">[產品代碼](product-codes.md)是應用程式的主體識別，且必須在應用程式的完整更新時變更。</span><span class="sxs-lookup"><span data-stu-id="47522-316">The [product code](product-codes.md) is the principal identification of an application and must change whenever there is a comprehensive update to the application.</span></span> <span data-ttu-id="47522-317">如需詳細資訊，請參閱 [ [**ProductCode**](productcode.md) ] 和 [[變更產品代碼](changing-the-product-code.md)]。</span><span class="sxs-lookup"><span data-stu-id="47522-317">For information, see [**ProductCode**](productcode.md) and [Changing the Product Code](changing-the-product-code.md).</span></span> <span data-ttu-id="47522-318">變更應用程式 .msi 檔案的名稱會被視為完整的變更，而且一律需要對產品程式碼進行對應的變更，才能維持一致性。</span><span class="sxs-lookup"><span data-stu-id="47522-318">Changing the name of the application's .msi file is considered a comprehensive change and always requires a corresponding change of the product code to maintain consistency.</span></span>
-   <span data-ttu-id="47522-319">[封裝程式碼](package-codes.md)是安裝程式用來搜尋並驗證指定安裝之正確封裝的主要識別碼。</span><span class="sxs-lookup"><span data-stu-id="47522-319">The [package code](package-codes.md) is the primary identifier used by the installer to search for and validate the correct package for a given installation.</span></span> <span data-ttu-id="47522-320">沒有兩個 nonidentical .msi 檔案應該要有相同的套件程式碼。</span><span class="sxs-lookup"><span data-stu-id="47522-320">No two nonidentical .msi files should ever have the same package code.</span></span> <span data-ttu-id="47522-321">如果在未變更套件程式碼的情況下變更套件，安裝程式仍可存取安裝程式時，安裝程式可能不會使用較新的套件。</span><span class="sxs-lookup"><span data-stu-id="47522-321">If a package is changed without changing the package code, the installer may not use the newer package if both are still accessible to the installer.</span></span> <span data-ttu-id="47522-322">封裝程式碼會儲存在 [摘要資訊資料流程](summary-information-stream.md)的 [[**修訂編號摘要**](revision-number-summary.md)] 屬性中。</span><span class="sxs-lookup"><span data-stu-id="47522-322">The package code is stored in the [**Revision Number Summary**](revision-number-summary.md) Property of the [Summary Information Stream](summary-information-stream.md).</span></span>
-   <span data-ttu-id="47522-323">請注意，產品代碼和套件程式碼 [guid](guid.md) 中的字母都必須全部都是大寫。</span><span class="sxs-lookup"><span data-stu-id="47522-323">Note that letters in product code and package code [GUIDs](guid.md) must all be uppercase.</span></span>

## <a name="do-not-use-the-selfreg-and-typelib-tables"></a><span data-ttu-id="47522-324">請勿使用 SelfReg 和 TypeLib 資料表。</span><span class="sxs-lookup"><span data-stu-id="47522-324">Do not use the SelfReg and TypeLib tables.</span></span>

-   <span data-ttu-id="47522-325">強烈建議您不要使用自我註冊和 [SelfReg](selfreg-table.md) 資料表的安裝套件作者。</span><span class="sxs-lookup"><span data-stu-id="47522-325">Installation package authors are strongly advised against using self registration and the [SelfReg](selfreg-table.md) table.</span></span> <span data-ttu-id="47522-326">相反地，他們應該藉由在登錄 [資料表群組](registry-tables-group.md)中撰寫一或多個資料表來註冊模組。</span><span class="sxs-lookup"><span data-stu-id="47522-326">Instead they should register modules by authoring one or more of the tables in the [Registry Tables Group](registry-tables-group.md).</span></span> <span data-ttu-id="47522-327">由於自我註冊常式通常會隱藏重要的設定資訊，因此 Windows Installer 的許多優點會因為自我註冊而遺失。</span><span class="sxs-lookup"><span data-stu-id="47522-327">Many of the benefits of the Windows Installer are lost with self registration because self-registration routines tend to hide critical configuration information.</span></span> <span data-ttu-id="47522-328">如需避免自行註冊的原因清單，請參閱 [SelfReg 資料表](selfreg-table.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-328">For a list of the reasons for avoiding self registration see [SelfReg table](selfreg-table.md).</span></span>
-   <span data-ttu-id="47522-329">使用 [TypeLib](typelib-table.md) 資料表時，強烈建議使用安裝套件作者。</span><span class="sxs-lookup"><span data-stu-id="47522-329">Installation package authors are strongly advised against using the [TypeLib](typelib-table.md) table.</span></span> <span data-ttu-id="47522-330">使用登錄資料表來註冊類型程式庫，而不是 [使用 TypeLib](registry-table.md) 資料表。</span><span class="sxs-lookup"><span data-stu-id="47522-330">Instead of using the TypeLib table, register type libraries by using [Registry](registry-table.md) table.</span></span> <span data-ttu-id="47522-331">如果使用 TypeLib 資料表的安裝失敗，而且必須回復，則回復可能不會將電腦還原到復原之前存在的相同狀態。</span><span class="sxs-lookup"><span data-stu-id="47522-331">If an installation using the TypeLib table fails and must be rolled back, the rollback may not restore the computer to the same state that existed prior to the rollback.</span></span>

## <a name="provide-the-option-to-install-without-a-user-interface"></a><span data-ttu-id="47522-332">提供在沒有使用者介面的情況下安裝的選項。</span><span class="sxs-lookup"><span data-stu-id="47522-332">Provide the option to install without a user interface.</span></span>

<span data-ttu-id="47522-333">系統管理員通常偏好在公司內部部署應用程式，而不需要使用者互動。</span><span class="sxs-lookup"><span data-stu-id="47522-333">Administrators often prefer to deploy applications within a corporation without requiring user interaction.</span></span> <span data-ttu-id="47522-334">最好的作法是讓您的應用程式提供選項，讓 [使用者介面層級](user-interface-levels.md) 為 [無]。</span><span class="sxs-lookup"><span data-stu-id="47522-334">It is good practice to enable your application to provide the option of being installed with the [user interface level](user-interface-levels.md) of None.</span></span>

-   <span data-ttu-id="47522-335">使用 [公用屬性](public-properties.md) 來取得設定資訊。</span><span class="sxs-lookup"><span data-stu-id="47522-335">Use [public properties](public-properties.md) for configuration information.</span></span> <span data-ttu-id="47522-336">系統管理員可以在命令列上提供此資訊。</span><span class="sxs-lookup"><span data-stu-id="47522-336">Administrators can provide this information on the command-line.</span></span>
-   <span data-ttu-id="47522-337">不需要安裝取決於使用者與對話方塊的互動所搜集的資訊。</span><span class="sxs-lookup"><span data-stu-id="47522-337">Do not require that the installation depend upon information gathered from user interaction with dialog boxes.</span></span> <span data-ttu-id="47522-338">無訊息安裝期間無法使用這項資訊。</span><span class="sxs-lookup"><span data-stu-id="47522-338">This information is not available during a silent installation.</span></span>
-   <span data-ttu-id="47522-339">請勿在無訊息安裝期間自動重新開機使用者的電腦。</span><span class="sxs-lookup"><span data-stu-id="47522-339">Do not automatically restart the user's computer during a silent installation.</span></span>
-   <span data-ttu-id="47522-340">系統管理員可以使用[命令列選項](command-line-options.md)"/q"，在安裝時設定[使用者介面層級](user-interface-levels.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-340">Administrators can set the [user interface level](user-interface-levels.md) when installing by using the [command line option](command-line-options.md) "/q".</span></span> <span data-ttu-id="47522-341">您也可以使用呼叫 [**MsiSetInternalUI**](/windows/desktop/api/Msi/nf-msi-msisetinternalui)，以程式設計方式設定使用者介面層級。</span><span class="sxs-lookup"><span data-stu-id="47522-341">The user interface level can also be set programmatically with a call to [**MsiSetInternalUI**](/windows/desktop/api/Msi/nf-msi-msisetinternalui).</span></span>

## <a name="avoid-using-the-alwaysinstallelevated-policy"></a><span data-ttu-id="47522-342">避免使用 AlwaysInstallElevated 原則。</span><span class="sxs-lookup"><span data-stu-id="47522-342">Avoid using the AlwaysInstallElevated policy.</span></span>

<span data-ttu-id="47522-343">如果未設定 [AlwaysInstallElevated](alwaysinstallelevated.md) 原則，系統會使用使用者的許可權來安裝未由系統管理員散發的應用程式，而且只有受管理的應用程式才會取得較高的許可權。</span><span class="sxs-lookup"><span data-stu-id="47522-343">If the [AlwaysInstallElevated](alwaysinstallelevated.md) policy is not set, applications not distributed by the administrator are installed using the user's privileges and only managed applications get elevated privileges.</span></span> <span data-ttu-id="47522-344">設定此原則會指示 Windows Installer 在系統上安裝應用程式時使用系統許可權。</span><span class="sxs-lookup"><span data-stu-id="47522-344">Setting this policy directs Windows Installer to use system permissions when it installs the application on the system.</span></span> <span data-ttu-id="47522-345">這種方法可以開啟電腦的安全性風險，因為當設定此原則時，非系統管理員的使用者可以使用較 [*高*](e-gly.md) 的許可權執行安裝，並存取電腦上的安全位置。</span><span class="sxs-lookup"><span data-stu-id="47522-345">This method can open a computer to a security risk, because when this policy is set, a non-administrator user can run installations with [*elevated*](e-gly.md) privileges and access secure locations on the computer.</span></span> <span data-ttu-id="47522-346">以 [較高的許可權安裝具有非系統管理員](installing-a-package-with-elevated-privileges-for-a-non-admin.md) 或 [修補 Per-User 受控應用程式](patching-per-user-managed-applications.md)的套件時，最好使用其他方法，而不是 AlwaysInstallElevated 原則。</span><span class="sxs-lookup"><span data-stu-id="47522-346">It is a good practice to use another method than the AlwaysInstallElevated policy when [Installing a Package with Elevated Privileges for a Non-Admin](installing-a-package-with-elevated-privileges-for-a-non-admin.md) or [Patching Per-User Managed Applications](patching-per-user-managed-applications.md).</span></span>

## <a name="enable-the-disablemedia-policy-to-limit-unauthorized-installation"></a><span data-ttu-id="47522-347">啟用 DisableMedia 原則以限制未經授權的安裝。</span><span class="sxs-lookup"><span data-stu-id="47522-347">Enable the DisableMedia policy to limit unauthorized installation.</span></span>

<span data-ttu-id="47522-348">[DisableMedia](disablemedia.md)原則可防止未經授權的應用程式安裝。</span><span class="sxs-lookup"><span data-stu-id="47522-348">The [DisableMedia](disablemedia.md) policy can prevent unauthorized installation of applications.</span></span> <span data-ttu-id="47522-349">啟用此原則時，執行一項產品維護安裝的使用者和系統管理員，將無法使用 [流覽] 對話方塊來流覽媒體來源（例如 CD-ROM），以取得其他可安裝產品的來源。</span><span class="sxs-lookup"><span data-stu-id="47522-349">When this policy is enabled, users and administrators running a maintenance installation of one product are prevented from using the Browse Dialog to browse media sources, such as CD-ROM, for the sources of other installable products.</span></span> <span data-ttu-id="47522-350">無論是否以較高的許可權進行安裝，都會防止流覽其他產品。</span><span class="sxs-lookup"><span data-stu-id="47522-350">Browsing for other products is prevented regardless of whether the installation is done with elevated privileges.</span></span> <span data-ttu-id="47522-351">如果使用者已正確標示媒體來源，則使用者仍然可以從媒體重新安裝產品。</span><span class="sxs-lookup"><span data-stu-id="47522-351">It is still possible for the user to reinstall the product from media if the user has a correctly labeled media source.</span></span>

## <a name="keep-the-original-package-source-files-secure-and-available-to-users"></a><span data-ttu-id="47522-352">將原始套件來源檔案保持安全並可供使用者使用。</span><span class="sxs-lookup"><span data-stu-id="47522-352">Keep the original package source files secure and available to users.</span></span>

<span data-ttu-id="47522-353">在某些情況下，可能需要 Windows Installer 套件的原始來源，才能視需要安裝、修復或更新應用程式。</span><span class="sxs-lookup"><span data-stu-id="47522-353">In some cases the original source of the Windows Installer package may be needed to install-on-demand, repair, or update an application.</span></span> <span data-ttu-id="47522-354">如果安裝程式找不到可用的來源，系統會要求使用者提供媒體或移至包含所需來源的網路位置。</span><span class="sxs-lookup"><span data-stu-id="47522-354">If the installer is unable to locate an available source, the user is asked to provide media or to go to a network location containing the needed sources.</span></span> <span data-ttu-id="47522-355">確定安裝程式具有所需的來源，而不需要提示使用者，是很好的作法。</span><span class="sxs-lookup"><span data-stu-id="47522-355">It is a good practice to ensure that the installer has the sources it needs without having to prompt the user.</span></span>

-   <span data-ttu-id="47522-356">使用 [數位簽章和外部封包](digital-signatures-and-external-cabinet-files.md) 檔，以確保安裝程式所使用的 origial 來源是安全的。</span><span class="sxs-lookup"><span data-stu-id="47522-356">Use [Digital Signatures and External Cabinet Files](digital-signatures-and-external-cabinet-files.md) to ensure that the origial sources being used by the installer are secure.</span></span> <span data-ttu-id="47522-357">儲存在公用位置的未壓縮來源映射不安全。</span><span class="sxs-lookup"><span data-stu-id="47522-357">An uncompressed source image stored in an public location is not secure.</span></span>
-   <span data-ttu-id="47522-358">在 [**SOURCELIST**](sourcelist.md) 屬性中包含應用程式安裝套件之網路或 URL 來源路徑的完整清單。</span><span class="sxs-lookup"><span data-stu-id="47522-358">Include a complete list of network or URL source paths to the application's installation package in the [**SOURCELIST**](sourcelist.md) property.</span></span>
-   <span data-ttu-id="47522-359">針對來源路徑使用分散式檔案系統 (DFS) 共用。</span><span class="sxs-lookup"><span data-stu-id="47522-359">Use a Distributed File System (DFS) share for the source path.</span></span>
-   <span data-ttu-id="47522-360">使用 Windows Installer API 來取得和修改 Windows Installer 應用程式和修補程式的來源清單資訊。</span><span class="sxs-lookup"><span data-stu-id="47522-360">Use the Windows Installer API to retrieve and modify source list information for Windows Installer applications and patches.</span></span> <span data-ttu-id="47522-361">如需詳細資訊，請參閱 [管理安裝來源](managing-installation-sources.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-361">For information see [Managing Installation Sources](managing-installation-sources.md).</span></span>
-   <span data-ttu-id="47522-362">您可以使用 [**安裝程式物件**](installer-object.md)、 [**Product 物件**](product-object.md)和 [**Patch 物件**](patch-object.md) 的方法和屬性，來取得和修改 Windows Installer 應用程式和修補程式的來源清單資訊。</span><span class="sxs-lookup"><span data-stu-id="47522-362">Use the methods and properties of the [**Installer Object**](installer-object.md), [**Product Object**](product-object.md), and [**Patch Object**](patch-object.md) to retrieve and modify source list information for Windows Installer applications and patches.</span></span>
-   <span data-ttu-id="47522-363">遵循所列的， [防止修補程式要求存取原始安裝來源](preventing-a-patch-from-requiring-access-to-the-original-installation-source.md) 點，以將修補程式需要存取原始來源的可能性降至最低。</span><span class="sxs-lookup"><span data-stu-id="47522-363">Adhere to points listed in [Preventing a Patch from Requiring Access to the Original Installation Source](preventing-a-patch-from-requiring-access-to-the-original-installation-source.md) points to minimize the possibility that your patch will require access to the original sources.</span></span>
-   <span data-ttu-id="47522-364">將套件來源檔案儲存在非系統暫存資料夾的位置。</span><span class="sxs-lookup"><span data-stu-id="47522-364">Store the package source files in a location that is not the system's temporary folder.</span></span> <span data-ttu-id="47522-365">儲存在暫存資料夾中的 Windows Installer 原始檔可能會變成無法供使用者使用。</span><span class="sxs-lookup"><span data-stu-id="47522-365">Windows Installer source files stored in the temporary folder can become unavailable to users.</span></span>

## <a name="enable-verbose-logging-on-users-computer-when-troubleshooting-deployment"></a><span data-ttu-id="47522-366">針對部署進行疑難排解時，請在使用者的電腦上啟用詳細資訊記錄。</span><span class="sxs-lookup"><span data-stu-id="47522-366">Enable verbose logging on user's computer when troubleshooting deployment.</span></span>

<span data-ttu-id="47522-367">[Windows Installer 記錄](windows-installer-logging.md) 包含可在使用者電腦上啟用的詳細資訊記錄選項。</span><span class="sxs-lookup"><span data-stu-id="47522-367">[Windows Installer Logging](windows-installer-logging.md) includes a verbose logging option that can be enabled on a user's computer.</span></span> <span data-ttu-id="47522-368">當您嘗試針對 Windows Installer 套件部署進行疑難排解時，詳細資訊記錄檔中的資訊可能很有説明。</span><span class="sxs-lookup"><span data-stu-id="47522-368">The information in a verbose log can helpful when trying to troubleshoot Windows Installer package deployment.</span></span>

-   <span data-ttu-id="47522-369">您可以使用 [命令列選項](command-line-options.md)、 [**MsiLogging**](msilogging.md) 屬性、 [記錄原則](logging.md)、 [**MsiEnableLog**](/windows/desktop/api/Msi/nf-msi-msienableloga)和 [**EnableLog**](installer-enablelog.md) 方法，在使用者的電腦上啟用詳細資訊記錄。</span><span class="sxs-lookup"><span data-stu-id="47522-369">You can enable verbose logging on the user's computer by using [Command Line Options](command-line-options.md), the [**MsiLogging**](msilogging.md) property, [Logging policy](logging.md), [**MsiEnableLog**](/windows/desktop/api/Msi/nf-msi-msienableloga), and [**EnableLog**](installer-enablelog.md) method.</span></span>
-   <span data-ttu-id="47522-370">有一項非常實用的資源可解讀 Windows Installer 的記錄檔 [Wilogutl.exe](wilogutl-exe.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-370">A very useful resource for interpreting Windows Installer log files is [Wilogutl.exe](wilogutl-exe.md).</span></span> <span data-ttu-id="47522-371">這項工具可協助分析記錄檔，並顯示在記錄檔中找到之錯誤的建議解決方案。</span><span class="sxs-lookup"><span data-stu-id="47522-371">This tool assists the analysis of log files and displays suggested solutions to errors that are found in a log file.</span></span>
-   <span data-ttu-id="47522-372">如需有關解讀 Windows Installer 記錄檔的詳細資訊，請參閱 TechNet 網站上提供的白皮書： [Windows Installer：系統管理員的權益和實行](https://www.microsoft.com/technet/prodtechnol/windows2000serv/maintain/featusability/winmsi.mspx)。</span><span class="sxs-lookup"><span data-stu-id="47522-372">For more information about interpreting Windows Installer log files, see the white paper available on the TechNet site: [Windows Installer: Benefits and Implementation for System Administrators](https://www.microsoft.com/technet/prodtechnol/windows2000serv/maintain/featusability/winmsi.mspx).</span></span>
-   <span data-ttu-id="47522-373">詳細資訊記錄選項應該僅用於疑難排解用途，不應該保持開啟，因為它可能會對系統效能和磁碟空間造成負面影響。</span><span class="sxs-lookup"><span data-stu-id="47522-373">The verbose logging option should be used only for troubleshooting purposes and should not be left on because it can have adverse effects on system performance and disk space.</span></span> <span data-ttu-id="47522-374">每次您使用主控台中的 [新增/移除程式] 工具時，都會建立新的檔案。</span><span class="sxs-lookup"><span data-stu-id="47522-374">Each time you use the Add/Remove Programs tool in Control Panel, a new file is created.</span></span>

## <a name="uninstallation-leaves-the-users-computer-in-a-clean-state"></a><span data-ttu-id="47522-375">卸載會將使用者的電腦保持在乾淨的狀態。</span><span class="sxs-lookup"><span data-stu-id="47522-375">Uninstallation leaves the user's computer in a clean state.</span></span>

<span data-ttu-id="47522-376">應用程式的移除就像安裝一樣重要。</span><span class="sxs-lookup"><span data-stu-id="47522-376">Application removal is as important as installation.</span></span> <span data-ttu-id="47522-377">卸載 Windows Installer 套件時，不會在使用者的電腦上留下任何無用的部分。</span><span class="sxs-lookup"><span data-stu-id="47522-377">When a Windows Installer package is uninstalled it should leave no useless parts of itself behind on the user's computer.</span></span>

-   <span data-ttu-id="47522-378">如果在執行卸載之後，必須從使用者的電腦中移除的檔案仍已安裝，則安裝程式可能不會移除包含檔案的元件，原因是 [移除擱置](removing-stranded-files.md)的檔案中所述的一或多個原因。</span><span class="sxs-lookup"><span data-stu-id="47522-378">If a file that should have been removed from the user's computer remains installed after running an uninstall, the installer may not be removing the component containing the file for one or more of the reasons described in [Removing Stranded Files](removing-stranded-files.md).</span></span>
-   <span data-ttu-id="47522-379">如果必須註冊應用程式，請在卸載應用程式時撰寫套件以移除登錄資訊。</span><span class="sxs-lookup"><span data-stu-id="47522-379">If an application must be registered, author the package to remove registry information when the application is uninstalled.</span></span> <span data-ttu-id="47522-380">如需相關資訊，請參閱在 [安裝或移除元件時新增或移除登錄機碼](adding-or-removing-registry-keys-on-the-installation-or-removal-of-components.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-380">For information see [Adding or Removing Registry Keys on the Installation or Removal of Components](adding-or-removing-registry-keys-on-the-installation-or-removal-of-components.md).</span></span> <span data-ttu-id="47522-381">如果未註冊應用程式，則應用程式不會列在主控台的 [新增或移除程式] 功能中，也無法使用 Windows Installer 來管理。</span><span class="sxs-lookup"><span data-stu-id="47522-381">If an application is not registered, the application is not listed in the Add or Remove Programs feature in Control Panel and cannot be managed by using the Windows Installer.</span></span>
-   <span data-ttu-id="47522-382">若要從主控台中的 [新增或移除程式] 功能隱藏應用程式，且仍然能夠使用 Windows Installer 來管理應用程式，請遵循新增和移除應用程式中所述的指導方針， [並在登錄中保留沒有追蹤](adding-and-removing-an-application-and-leaving-no-trace-in-the-registry.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-382">To hide an application from the Add or Remove Programs feature in Control Panel and still be able to use the Windows Installer to manage the application, follow the guidelines described in [Adding and Removing an Application and Leaving No Trace in the Registry](adding-and-removing-an-application-and-leaving-no-trace-in-the-registry.md).</span></span>
-   <span data-ttu-id="47522-383">自訂動作應受條件地執行，而不需要在卸載時執行。</span><span class="sxs-lookup"><span data-stu-id="47522-383">Custom actions should be conditioned to run or not as needed upon uninstallation.</span></span> <span data-ttu-id="47522-384">安裝和卸載時，可能需要執行不同的自訂動作。</span><span class="sxs-lookup"><span data-stu-id="47522-384">Different custom actions may need to run on install and uninstall.</span></span>
-   <span data-ttu-id="47522-385">使用者特定的自訂資訊可以儲存在電腦的文字檔中。</span><span class="sxs-lookup"><span data-stu-id="47522-385">User-specific customization information can be stored in a text file on the computer.</span></span> <span data-ttu-id="47522-386">這樣做的優點是，當應用程式卸載時可以移除檔案，即使這個自訂的使用者目前未登入也一樣。</span><span class="sxs-lookup"><span data-stu-id="47522-386">This has the advantage that the file can be removed when the application is uninstalled, even if the user of this customization is not currently logged on.</span></span>

## <a name="test-packages-for-both-per-user-and-per-machine-installation-deployment"></a><span data-ttu-id="47522-387">針對每位使用者和每部電腦的安裝部署測試套件。</span><span class="sxs-lookup"><span data-stu-id="47522-387">Test packages for both per-user and per-machine installation deployment.</span></span>

<span data-ttu-id="47522-388">最好的作法是讓客戶決定是否要在每部電腦或每一使用者的 [安裝內容](installation-context.md)中部署套件以進行安裝。</span><span class="sxs-lookup"><span data-stu-id="47522-388">It is good practice to enable customers to decide whether to deploy a package for installation in either the per-machine or per-user [installation context](installation-context.md).</span></span>

-   <span data-ttu-id="47522-389">請考慮應用程式是否應該僅供特定使用者或電腦的所有使用者使用，在開發過程中。</span><span class="sxs-lookup"><span data-stu-id="47522-389">Consider whether the application should be available to only particular users or all users of the computer during the development process.</span></span>
-   <span data-ttu-id="47522-390">測試套件是否可針對每個使用者安裝和個別電腦的安裝內容正確運作。</span><span class="sxs-lookup"><span data-stu-id="47522-390">Test that the package works correctly for both the per-user installation and per-machine installation contexts.</span></span>
-   <span data-ttu-id="47522-391">使套件易於自訂，並讓客戶決定是否要將它部署為每位使用者或每部電腦。</span><span class="sxs-lookup"><span data-stu-id="47522-391">Make the package easily customizable and let customers decide whether to deploy it per-user or per-machine.</span></span>

## <a name="plan-and-test-a-servicing-strategy-before-shipping-the-application"></a><span data-ttu-id="47522-392">先規劃及測試服務策略，再寄送應用程式。</span><span class="sxs-lookup"><span data-stu-id="47522-392">Plan and test a servicing strategy before shipping the application.</span></span>

<span data-ttu-id="47522-393">第一次部署應用程式之前，您應該先決定要如何為應用程式提供服務。</span><span class="sxs-lookup"><span data-stu-id="47522-393">You should decide how you intend to service the application before deploying the application for the first time.</span></span>

-   <span data-ttu-id="47522-394">請考慮未來您預期用來服務應用程式的更新類型。</span><span class="sxs-lookup"><span data-stu-id="47522-394">Consider the types of updates you expect to use to service your application in the future.</span></span> <span data-ttu-id="47522-395">Windows Installer 提供三種類型的更新： [小型更新](small-updates.md)、 [次要升級](minor-upgrades.md)和 [主要升級](major-upgrades.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-395">The Windows Installer provides three types of updates: [Small Update](small-updates.md), [Minor Upgrade](minor-upgrades.md), and [Major Upgrades](major-upgrades.md).</span></span> <span data-ttu-id="47522-396">[修補和升級](patching-and-upgrades.md)主題將說明這些差異。</span><span class="sxs-lookup"><span data-stu-id="47522-396">The differences between these are described in [Patching and Upgrades](patching-and-upgrades.md) topic.</span></span>
-   <span data-ttu-id="47522-397">在交付您的應用程式之前，請先測試它在使用每個更新類型進行服務之後是否能正常運作。</span><span class="sxs-lookup"><span data-stu-id="47522-397">Before shipping your application, test that it works as expected after servicing with each update type.</span></span>

## <a name="reduce-the-dependency-of-updates-upon-the-original-sources"></a><span data-ttu-id="47522-398">在原始來源上減少更新的相依性。</span><span class="sxs-lookup"><span data-stu-id="47522-398">Reduce the dependency of updates upon the original sources.</span></span>

<span data-ttu-id="47522-399">如果需要原始來源檔案來更新您的應用程式，這可能會讓應用程式的服務變得更困難。</span><span class="sxs-lookup"><span data-stu-id="47522-399">If the original source files are required to update your application, this can make servicing the application more difficult.</span></span> <span data-ttu-id="47522-400">下列方法可協助減少原始來源的更新相依性。</span><span class="sxs-lookup"><span data-stu-id="47522-400">The following methods can help reduce the dependence of updates upon the original sources.</span></span>

-   <span data-ttu-id="47522-401">使用 [*差異修補*](d-gly.md) 程式來更新應用程式的基準版本，例如 RTM 版本和 service pack 版本。</span><span class="sxs-lookup"><span data-stu-id="47522-401">Use a [*delta patch*](d-gly.md) to update the baseline versions of your application, such as the RTM version and the service pack versions.</span></span> <span data-ttu-id="47522-402">遵循主題： [減少修補程式大小](reducing-patch-size.md)中所述之差異修補程式的使用指導方針。</span><span class="sxs-lookup"><span data-stu-id="47522-402">Follow the guidelines for using delta patches described in the topic: [Reducing Patch Size](reducing-patch-size.md).</span></span>
-   <span data-ttu-id="47522-403">遵循主題中所列的建議： [防止 Patch 要求存取原始安裝來源](preventing-a-patch-from-requiring-access-to-the-original-installation-source.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-403">Follow the recommendations listed in the topic: [Preventing a Patch from Requiring Access to the Original Installation Source](preventing-a-patch-from-requiring-access-to-the-original-installation-source.md).</span></span>

## <a name="do-not-distribute-unserviceable-merge-modules"></a><span data-ttu-id="47522-404">請勿散發 unserviceable 合併模組。</span><span class="sxs-lookup"><span data-stu-id="47522-404">Do not distribute unserviceable merge modules.</span></span>

<span data-ttu-id="47522-405">如果合併模組的擁有者和應用程式的擁有者不同，則應用程式不應該相依于安裝元件的 [合併模組](merge-modules.md) 。</span><span class="sxs-lookup"><span data-stu-id="47522-405">Applications should not depend on [merge modules](merge-modules.md) for the installation of component if the owner of the merge module and the owner of the application are different.</span></span> <span data-ttu-id="47522-406">這可能會讓應用程式變得很困難，因為這兩個擁有者都需要協調以更新應用程式或模組。</span><span class="sxs-lookup"><span data-stu-id="47522-406">This can make it difficult to service the application because both owners need to coordinate to update the application or module.</span></span> <span data-ttu-id="47522-407">如果不知道已使用合併模組的所有應用程式，應用程式的擁有者就無法更新合併模組，而且不會有風險，因為更新可能與其他應用程式不相容。</span><span class="sxs-lookup"><span data-stu-id="47522-407">Without knowing all the applications that have used the merge module, the owner of the application is unable update the merge module without risking that the update might be incompatible with another application.</span></span> <span data-ttu-id="47522-408">合併模組的擁有者沒有直接的方法可更新已安裝合併模組的 Windows Installer 封裝。</span><span class="sxs-lookup"><span data-stu-id="47522-408">The owner of the merge module has no direct method for updating Windows Installer packages that have already installed the merge module.</span></span>

-   <span data-ttu-id="47522-409">請考慮為使用者提供所需的元件，因為另一個 Windows Installer 安裝。</span><span class="sxs-lookup"><span data-stu-id="47522-409">Consider providing the needed components to users as another Windows Installer installation.</span></span>

## <a name="avoid-patching-administrative-installations"></a><span data-ttu-id="47522-410">避免修補系統管理安裝。</span><span class="sxs-lookup"><span data-stu-id="47522-410">Avoid patching administrative installations.</span></span>

<span data-ttu-id="47522-411">在網路上提供應用程式原始 Windows Installer 套件的 [系統管理安裝](administrative-installation.md) ，讓工作組的成員可以安裝應用程式。</span><span class="sxs-lookup"><span data-stu-id="47522-411">Provide on a network an [administrative installation](administrative-installation.md) of your application's original Windows Installer package to enable members of a workgroup to install the application.</span></span> <span data-ttu-id="47522-412">然後，這個系統管理映射的使用者應該將更新套用到位於其電腦上的應用程式的本機實例。</span><span class="sxs-lookup"><span data-stu-id="47522-412">Users of this administrative image should then apply updates to the local instance of the application located on their computer.</span></span> <span data-ttu-id="47522-413">這樣可讓使用者與系統管理映射保持同步。</span><span class="sxs-lookup"><span data-stu-id="47522-413">This keeps users in synchronization with the administrative image.</span></span> <span data-ttu-id="47522-414">基於下列原因，不建議將更新套用至管理安裝。</span><span class="sxs-lookup"><span data-stu-id="47522-414">Applying updates to the administrative installation is not recommended for the following reasons.</span></span>

-   <span data-ttu-id="47522-415">相較于下載修補程式，使用者取得更新所需的下載大小和延遲會增加。</span><span class="sxs-lookup"><span data-stu-id="47522-415">The size and latency of the download required for users to obtain an update is increased compared to downloading a patch.</span></span> <span data-ttu-id="47522-416">整個更新後的 Windows Installer 套件和來源檔案必須下載、recached 和重新安裝。</span><span class="sxs-lookup"><span data-stu-id="47522-416">The entire updated Windows Installer package and source files must download, recached, and reinstalled.</span></span>
-   <span data-ttu-id="47522-417">使用者在重新緩存並重新安裝應用程式之前，無法 [視需要安裝](installation-on-demand.md) 和修復更新的系統管理安裝中的應用程式。</span><span class="sxs-lookup"><span data-stu-id="47522-417">Users are unable to [installation-on-demand](installation-on-demand.md) and repair applications from an updated administrative installation until they recache and reinstall the application.</span></span>
-   <span data-ttu-id="47522-418">將修補程式套用至系統管理安裝時，會從套件中移除數位簽章。</span><span class="sxs-lookup"><span data-stu-id="47522-418">Applying a patch to an administrative installation removes the digital signature from the package.</span></span> <span data-ttu-id="47522-419">系統管理員必須重新簽署封裝。</span><span class="sxs-lookup"><span data-stu-id="47522-419">An administrator must resign the package.</span></span> <span data-ttu-id="47522-420">如需有關使用數位簽章的詳細資訊，請參閱 [數位簽章和 Windows Installer](digital-signatures-and-windows-installer.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-420">For more information about using digital signatures, see [Digital Signatures and Windows Installer](digital-signatures-and-windows-installer.md).</span></span>
-   <span data-ttu-id="47522-421">許多二進位修補程式都是以應用程式的 RTM 映射為目標，而且需要先前的檔案版本。</span><span class="sxs-lookup"><span data-stu-id="47522-421">Many binary patches target the RTM image of the application and require a previous file version.</span></span> <span data-ttu-id="47522-422">從更新的系統管理安裝所安裝之應用程式的本機實例可能不適用於其他更新。</span><span class="sxs-lookup"><span data-stu-id="47522-422">The local instance of an application installed from an updated administrative installation may not work with other updates.</span></span> <span data-ttu-id="47522-423">許多二進位修補程式應用程式可能會失敗。</span><span class="sxs-lookup"><span data-stu-id="47522-423">Many binary patch applications can fail.</span></span>
-   <span data-ttu-id="47522-424">將修補程式套用至系統管理安裝會更新來源檔案和 .msi 檔案，但不會使用更新的相關資訊來戳記網路映射。</span><span class="sxs-lookup"><span data-stu-id="47522-424">Applying a patch to an administrative installation updates the source files and the .msi file but does not stamp the network image with information about the update.</span></span> <span data-ttu-id="47522-425">使用者無法判斷他們從系統管理安裝所收到的更新。</span><span class="sxs-lookup"><span data-stu-id="47522-425">Users cannot determine which updates they have received from the administrative installation.</span></span> <span data-ttu-id="47522-426">如此一來，在使用者端套用的更新順序將會套用至已套用於系統管理映射端的更新。</span><span class="sxs-lookup"><span data-stu-id="47522-426">This makes it impossible to sequence updates applied on the user side with those already applied on the administrative image side.</span></span>
-   <span data-ttu-id="47522-427">套用至系統管理安裝的修補程式不是 [可卸載修補程式](uninstallable-patches.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-427">Patches applied to an administrative installation are not [uninstallable patches](uninstallable-patches.md).</span></span> <span data-ttu-id="47522-428">這可防止使用者電腦上快取的套件程式碼與系統管理安裝上的套件程式碼不同。</span><span class="sxs-lookup"><span data-stu-id="47522-428">This can prevent the package code cached on the user's computer from becoming different than the package code on the administrative installation.</span></span> <span data-ttu-id="47522-429">如果使用者電腦上快取的套件程式碼與系統管理安裝上的不同，請從系統管理安裝重新安裝該應用程式，然後再修補用戶端電腦。</span><span class="sxs-lookup"><span data-stu-id="47522-429">If the package code cached on the user's computer becomes different from that on the administrative installation, reinstall the application from the administrative installation and then patch the client computer.</span></span>
-   <span data-ttu-id="47522-430">如果您決定透過修補系統管理映射來套用小型更新，請依照主題中所述的指導方針： [修補系統管理映射以套用 Small update](applying-small-updates-by-patching-an-administrative-image.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-430">If you decide to apply small updates by patching an administrative image, follow the guidelines described in the topic: [Applying Small Updates by Patching an Administrative Image](applying-small-updates-by-patching-an-administrative-image.md).</span></span>

## <a name="register-updates-to-run-with-elevated-privilege"></a><span data-ttu-id="47522-431">以較高的許可權註冊更新以執行。</span><span class="sxs-lookup"><span data-stu-id="47522-431">Register updates to run with elevated privilege.</span></span>

<span data-ttu-id="47522-432">從 Windows Installer 3.0 開始，在修補程式註冊為具有更高的許可權之後，就可以將修補程式套用至每個使用者管理內容中已安裝的應用程式。</span><span class="sxs-lookup"><span data-stu-id="47522-432">Beginning with Windows Installer 3.0, it is possible to apply patches to an application that has been installed in a per-user-managed context, after the patch has been registered as having elevated privileges.</span></span> <span data-ttu-id="47522-433">您無法使用3.0 版之前的 Windows Installer 版本，將修補程式套用至每個使用者管理內容中安裝的應用程式。</span><span class="sxs-lookup"><span data-stu-id="47522-433">You cannot apply patches to applications that are installed in a per-user managed context using versions of Windows Installer earlier than version 3.0.</span></span>

-   <span data-ttu-id="47522-434">使用 [**SourceListAddSource**](patch-sourcelistaddsource.md) 方法或 [**MsiSourceListAddSourceEx**](/windows/desktop/api/Msi/nf-msi-msisourcelistaddsourceexa) 函式，以較高的許可權註冊 patch 套件。</span><span class="sxs-lookup"><span data-stu-id="47522-434">Use the [**SourceListAddSource**](patch-sourcelistaddsource.md) method or [**MsiSourceListAddSourceEx**](/windows/desktop/api/Msi/nf-msi-msisourcelistaddsourceexa) function to register a patch package as having elevated privileges.</span></span> <span data-ttu-id="47522-435">遵循在 [修補 Per-User 受控應用程式](patching-per-user-managed-applications.md)中所提供的指導方針與範例。</span><span class="sxs-lookup"><span data-stu-id="47522-435">Follow the guidelines and examples provided in [Patching Per-User Managed Applications](patching-per-user-managed-applications.md).</span></span>
-   <span data-ttu-id="47522-436">在 Windows Vista 上執行 Windows Installer 4.0 版時，您也可以使用 [ [使用者帳戶控制] (UAC) 修補](user-account-control--uac--patching.md) 程式，讓 Windows Installer 安裝的作者找出可由非系統管理員使用者未來套用的數位簽章修補程式。</span><span class="sxs-lookup"><span data-stu-id="47522-436">When running Windows Installer version 4.0 on Windows Vista you can also use [User Account Control (UAC) Patching](user-account-control--uac--patching.md) to enables the authors of Windows Installer installations to identify digitally-signed patches that can be applied in the future by non-administrator users.</span></span> <span data-ttu-id="47522-437">這僅適用于在個別電腦 [安裝內容](installation-context.md) 中安裝套件 (ALLUSERS = 1) 。</span><span class="sxs-lookup"><span data-stu-id="47522-437">This is only available with the installation of packages in the per-machine [installation context](installation-context.md) (ALLUSERS=1).</span></span>
-   <span data-ttu-id="47522-438">藉由設定 [**MSIDISABLELUAPATCHING**](msidisableluapatching.md) 屬性或 [DisableLUAPatching](disableluapatching.md) 原則，確保未停用最低許可權修補。</span><span class="sxs-lookup"><span data-stu-id="47522-438">Ensure that least-privilege patching has not been disabled by setting the [**MSIDISABLELUAPATCHING**](msidisableluapatching.md) property or the [DisableLUAPatching](disableluapatching.md) policy.</span></span>

## <a name="use-the-msipatchsequence-table-to-sequence-patches"></a><span data-ttu-id="47522-439">使用 MsiPatchSequence 資料表來排列修補程式的順序。</span><span class="sxs-lookup"><span data-stu-id="47522-439">Use the MsiPatchSequence Table to sequence patches.</span></span>

<span data-ttu-id="47522-440">在您的封裝中包含 [MsiPatchSequence 資料表](msipatchsequence-table.md) ，並新增修補程式排序資訊。</span><span class="sxs-lookup"><span data-stu-id="47522-440">Include a [MsiPatchSequence Table](msipatchsequence-table.md) in your package and add patch sequencing information.</span></span> <span data-ttu-id="47522-441">從 Windows Installer 版本3.0 開始，安裝程式可以在 [安裝多個修補](installing-multiple-patches.md) 程式時使用 MsiPatchSequence 資料表，以判斷最佳的修補程式應用程式順序。</span><span class="sxs-lookup"><span data-stu-id="47522-441">Beginning with Windows Installer version 3.0, the installer can use the MsiPatchSequence Table when [installing multiple patches](installing-multiple-patches.md) to determine the best patch application sequence.</span></span> <span data-ttu-id="47522-442">使用 [Windows Installer 3.0 版白皮書中的修補程式順序中](https://www.microsoft.com/downloads/details.aspx?FamilyID=ad7ac91e-2493-4549-ae6f-bf5e007c12a3) 所述的指導方針來定義修補程式系列。</span><span class="sxs-lookup"><span data-stu-id="47522-442">Use the guidelines described in the [Patch Sequencing in Windows Installer version 3.0](https://www.microsoft.com/downloads/details.aspx?FamilyID=ad7ac91e-2493-4549-ae6f-bf5e007c12a3) white paper for defining patch families.</span></span>

-   <span data-ttu-id="47522-443">如果可行的話，請將所有修補程式指定為屬於單一修補程式系列。</span><span class="sxs-lookup"><span data-stu-id="47522-443">If practical, specify all patches as belonging to a single patch family.</span></span> <span data-ttu-id="47522-444">在許多情況下，單一修補程式系列提供足夠的彈性來排列修補程式。</span><span class="sxs-lookup"><span data-stu-id="47522-444">In many cases a single patch family provides enough flexibility to sequence patches.</span></span> <span data-ttu-id="47522-445">使用多個修補程式系列時，撰寫的複雜度會增加。</span><span class="sxs-lookup"><span data-stu-id="47522-445">The complexity of authoring increases when multiple patch families are used.</span></span> <span data-ttu-id="47522-446">為修補程式系列指派有意義的名稱，並在該修補程式系列中指派隨時間增加的順序值。</span><span class="sxs-lookup"><span data-stu-id="47522-446">Assign a meaningful name to the patch family and assign sequence values in that patch family that increase over time.</span></span> <span data-ttu-id="47522-447">遵循 [多重修補範例](multiple-patching-example.md) ，依照發行修補程式的順序套用修補程式。</span><span class="sxs-lookup"><span data-stu-id="47522-447">Follow the [Multiple Patching Example](multiple-patching-example.md) to apply patches in the order in which they have been issued.</span></span>
-   <span data-ttu-id="47522-448">使用[Patchwiz.dll](patchwiz-dll.md)中的[PatchSequence 資料表](patchsequence-table--patchwiz-dll-.md)來產生[MsiPatchSequence 資料表](msipatchsequence-table.md)中的資訊。</span><span class="sxs-lookup"><span data-stu-id="47522-448">Use the [PatchSequence Table](patchsequence-table--patchwiz-dll-.md) in [Patchwiz.dll](patchwiz-dll.md) to generate the information in [MsiPatchSequence Table](msipatchsequence-table.md).</span></span> <span data-ttu-id="47522-449">使用 Windows Installer 3.0 發行的 PATCHWIZ.DLL 版本可以自動產生修補程式排序資訊。</span><span class="sxs-lookup"><span data-stu-id="47522-449">The version of PATCHWIZ.DLL that was released with Windows Installer 3.0 can automatically generate patch sequencing information.</span></span> <span data-ttu-id="47522-450">如需有關如何新增修補程式的詳細資訊，請參閱 [產生修補程式順序資訊](generating-patch-sequence-information---patchwiz-dll-.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-450">For more information on how to add a new patch, see [Generating Patch Sequence Information](generating-patch-sequence-information---patchwiz-dll-.md).</span></span> <span data-ttu-id="47522-451">如需修補程式排序案例的詳細資訊，請參閱白皮書： [Windows Installer 版本3.0 中的修補程式順序](https://www.microsoft.com/downloads/details.aspx?FamilyID=ad7ac91e-2493-4549-ae6f-bf5e007c12a3)。</span><span class="sxs-lookup"><span data-stu-id="47522-451">For more information about patch sequencing scenarios, see the whitepaper: [Patch Sequencing in Windows Installer version 3.0](https://www.microsoft.com/downloads/details.aspx?FamilyID=ad7ac91e-2493-4549-ae6f-bf5e007c12a3).</span></span>

## <a name="test-the-installation-package-thoroughly"></a><span data-ttu-id="47522-452">徹底測試安裝套件。</span><span class="sxs-lookup"><span data-stu-id="47522-452">Test the installation package thoroughly.</span></span>

<span data-ttu-id="47522-453">測試您的 Windows Installer 套件是否正確安裝、修復和移除。</span><span class="sxs-lookup"><span data-stu-id="47522-453">Test for correct installation, repair, and removal of your Windows Installer package.</span></span> <span data-ttu-id="47522-454">您可以將測試程式分成下列部分。</span><span class="sxs-lookup"><span data-stu-id="47522-454">You can divide your testing process into the following parts.</span></span>

-   <span data-ttu-id="47522-455">安裝測試-使用所有可能的應用程式功能組合來測試安裝。</span><span class="sxs-lookup"><span data-stu-id="47522-455">Installation Testing - Test the installation with all possible combinations of application features.</span></span> <span data-ttu-id="47522-456">測試所有類型的安裝，包括系統 [管理安裝](administrative-installation.md)、 [復原安裝](rollback-installation.md)和 [隨選安裝](installation-on-demand.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-456">Test all types of installation, including [Administrative Installation](administrative-installation.md), [Rollback Installation](rollback-installation.md), and [Installation-On-Demand](installation-on-demand.md).</span></span> <span data-ttu-id="47522-457">嘗試安裝的所有可能方法，包括按一下 .msi 檔案、 [命令列選項](command-line-options.md)，以及從 [控制台] 進行安裝。</span><span class="sxs-lookup"><span data-stu-id="47522-457">Try all possible methods of installation, including clicking on the .msi file, [command line options](command-line-options.md), and installing from the control panel.</span></span> <span data-ttu-id="47522-458">測試封裝是否可由使用者在所有可能的許可權內容中進行安裝。</span><span class="sxs-lookup"><span data-stu-id="47522-458">Test that the package can be installed by users in all possible privilege contexts.</span></span> <span data-ttu-id="47522-459">在所有可能的方法部署套件之後，請嘗試安裝該套件。</span><span class="sxs-lookup"><span data-stu-id="47522-459">Try installing the package after it has been deployed by all possible methods.</span></span> <span data-ttu-id="47522-460">啟用每個測試的 [Windows Installer 記錄](windows-installer-logging.md) ，並解決安裝程式記錄檔和事件記錄檔中找到的所有錯誤。</span><span class="sxs-lookup"><span data-stu-id="47522-460">Enable [Windows Installer Logging](windows-installer-logging.md) for each test and resolve all errors found in the installer log and event log.</span></span>
-   <span data-ttu-id="47522-461">消費者介面測試-以所有可能的 [使用者介面層級](user-interface-levels.md)安裝時測試封裝。</span><span class="sxs-lookup"><span data-stu-id="47522-461">User Interface Testing - Test the package when installed with all possible [user interface levels](user-interface-levels.md).</span></span> <span data-ttu-id="47522-462">測試安裝的套件不含使用者介面，以及透過使用者介面提供的所有資訊。</span><span class="sxs-lookup"><span data-stu-id="47522-462">Test the package installed with no user interface and with all information provided through the user interface.</span></span> <span data-ttu-id="47522-463">確定使用者介面的 [存取](accessibility.md) 範圍，以及使用者介面如預期般針對不同的螢幕解析度和字型大小運作。</span><span class="sxs-lookup"><span data-stu-id="47522-463">Ensure the [Accessibility](accessibility.md) of the user interface and that the user interface functions as expected for different screen resolutions and font sizes.</span></span>
-   <span data-ttu-id="47522-464">服務和修復測試-測試封裝是否可以處理[小型更新](small-updates.md)、[次要升級](minor-upgrades.md)和[主要升級](major-upgrades.md)所提供的[修補和升級](patching-and-upgrades.md)。</span><span class="sxs-lookup"><span data-stu-id="47522-464">Servicing and Repair Testing - Test that the package can handle [Patching and Upgrades](patching-and-upgrades.md) delivered by a [Small Update](small-updates.md), [Minor Upgrade](minor-upgrades.md), and [Major Upgrades](major-upgrades.md).</span></span> <span data-ttu-id="47522-465">在部署套件之前，請先撰寫每個類型的試用更新，並嘗試將它套用至原始套件。</span><span class="sxs-lookup"><span data-stu-id="47522-465">Before deploying the package, write a trial update of each type and try applying it to the original package.</span></span>
-   <span data-ttu-id="47522-466">卸載測試-確認移除套件時，不會在使用者的電腦上留下無用的部分，而且只會移除屬於封裝的資訊。</span><span class="sxs-lookup"><span data-stu-id="47522-466">Uninstall Testing - Verify that when the package is removed it leaves no useless parts of itself behind on the user's computer and that only information belonging to the package has been removed.</span></span> <span data-ttu-id="47522-467">卸載封裝之後，請重新開機測試電腦，並確認通用系統工具和其他標準應用程式的完整性。</span><span class="sxs-lookup"><span data-stu-id="47522-467">Reboot the test computer after uninstalling the package and verify the integrity of common system tools and other standard applications.</span></span> <span data-ttu-id="47522-468">測試封裝是否可由使用者在所有可能的許可權內容中移除。</span><span class="sxs-lookup"><span data-stu-id="47522-468">Test that the package can be removed by users in all possible privilege contexts.</span></span> <span data-ttu-id="47522-469">測試所有方法以移除封裝，按一下 .msi 檔案，嘗試 [命令列選項](command-line-options.md)，然後嘗試從 [控制台] 移除套件。</span><span class="sxs-lookup"><span data-stu-id="47522-469">Test all methods to remove the package, click the .msi file, try the [command line options](command-line-options.md), and try removing the package from the control panel.</span></span> <span data-ttu-id="47522-470">啟用每個測試的 [Windows Installer 記錄](windows-installer-logging.md) ，並解決安裝程式記錄檔和事件記錄檔中找到的所有錯誤。</span><span class="sxs-lookup"><span data-stu-id="47522-470">Enable [Windows Installer Logging](windows-installer-logging.md) for each test and resolve all errors found in the installer log and event log.</span></span>
-   <span data-ttu-id="47522-471">產品功能測試-確保應用程式在安裝、修復或移除套件之後如預期般運作。</span><span class="sxs-lookup"><span data-stu-id="47522-471">Product Functionality Testing - Ensure that the application functions as expected after the installation, repair, or removal of the package.</span></span>

## <a name="fix-all-validation-errors-before-deploying-a-new-or-revised-installation-package"></a><span data-ttu-id="47522-472">請先修正所有驗證錯誤，再部署新的或修改過的安裝套件。</span><span class="sxs-lookup"><span data-stu-id="47522-472">Fix all validation errors before deploying a new or revised installation package.</span></span>

<span data-ttu-id="47522-473">先在新的或修改過的 Windows Installer 封裝上執行 [套件驗證](package-validation.md) ，再嘗試第一次安裝。</span><span class="sxs-lookup"><span data-stu-id="47522-473">Run [package validation](package-validation.md) on a new or revised Windows Installer package before attempting to install it for the first time.</span></span> <span data-ttu-id="47522-474">驗證會檢查 Windows Installer 資料庫是否有撰寫錯誤。</span><span class="sxs-lookup"><span data-stu-id="47522-474">Validation checks the Windows Installer database for authoring errors.</span></span> <span data-ttu-id="47522-475">嘗試安裝未通過驗證的封裝可能會損毀使用者的系統。</span><span class="sxs-lookup"><span data-stu-id="47522-475">Attempting to install a package that does not pass validation can damage the user's system.</span></span>

-   <span data-ttu-id="47522-476">您可以使用 [Orca.exe](orca-exe.md) 或 [Msival2.exe](msival2-exe.md)來驗證您的封裝。</span><span class="sxs-lookup"><span data-stu-id="47522-476">You can validate your package using [Orca.exe](orca-exe.md) or [Msival2.exe](msival2-exe.md).</span></span> <span data-ttu-id="47522-477">這兩種工具都隨附于 Windows SDK。</span><span class="sxs-lookup"><span data-stu-id="47522-477">Both tools are provided with the Windows SDK.</span></span> <span data-ttu-id="47522-478">協力廠商也可以將 ICE 驗證系統納入其撰寫環境中。</span><span class="sxs-lookup"><span data-stu-id="47522-478">Third-party vendors may also incorporate the ICE validation system into their authoring environment.</span></span>
-   <span data-ttu-id="47522-479">您可以使用 SDK 隨附的 .cub 檔中所包含的一組標準 [內部一致性評估](internal-consistency-evaluators-ices.md) 工具，或藉由 [建立 ICE](building-an-ice.md) 並將其新增至 .cub 檔案來自訂驗證。</span><span class="sxs-lookup"><span data-stu-id="47522-479">You can use the standard set of [Internal Consistency Evaluators - ICEs](internal-consistency-evaluators-ices.md) included in the .cub files provided with the SDK, or customize validation by [Building an ICE](building-an-ice.md) and adding it to the .cub file.</span></span>
-   <span data-ttu-id="47522-480">您可以使用 Evalcom2.dll 來執行安裝封裝和合併模組的 [驗證自動化](validation-automation.md) 。</span><span class="sxs-lookup"><span data-stu-id="47522-480">You can use the Evalcom2.dll to implement [Validation Automation](validation-automation.md) for installation packages and merge modules.</span></span>

## <a name="author-a-secure-installation"></a><span data-ttu-id="47522-481">撰寫安全的安裝。</span><span class="sxs-lookup"><span data-stu-id="47522-481">Author a secure installation.</span></span>

<span data-ttu-id="47522-482">開發封裝時，請遵循這些指導方針，以協助在安裝期間維護安全的環境。</span><span class="sxs-lookup"><span data-stu-id="47522-482">Following these guidelines when developing your package to help maintain a secure environment during installation.</span></span>

-   [<span data-ttu-id="47522-483">撰寫安全安裝的指導方針</span><span class="sxs-lookup"><span data-stu-id="47522-483">Guidelines for Authoring Secure Installations</span></span>](guidelines-for-authoring-secure-installations.md)
-   [<span data-ttu-id="47522-484">在鎖定的電腦上保護套件安全的指導方針</span><span class="sxs-lookup"><span data-stu-id="47522-484">Guidelines for Securing Packages on Locked-Down Computers</span></span>](guidelines-for-securing-packages-on-locked-down-computers.md)
-   [<span data-ttu-id="47522-485">保護自訂動作的指導方針</span><span class="sxs-lookup"><span data-stu-id="47522-485">Guidelines for Securing Custom Actions</span></span>](guidelines-for-securing-custom-actions.md)

## <a name="use-pmsihandle-instead-of-handle"></a><span data-ttu-id="47522-486">使用 PMSIHANDLE 而非控制碼</span><span class="sxs-lookup"><span data-stu-id="47522-486">Use PMSIHANDLE instead of HANDLE</span></span>

<span data-ttu-id="47522-487">**PMSIHANDLE** 類型變數是在 msi 中定義。</span><span class="sxs-lookup"><span data-stu-id="47522-487">The **PMSIHANDLE** type variables is defined in msi.h.</span></span> <span data-ttu-id="47522-488">建議您的應用程式使用 **PMSIHANDLE** 類型，因為安裝程式會在超出範圍時關閉 **PMSIHANDLE** 物件，而您的應用程式必須藉由呼叫 [**MsiCloseHandle**](/windows/desktop/api/Msi/nf-msi-msiclosehandle)來關閉 **MSIHANDLE** 物件。</span><span class="sxs-lookup"><span data-stu-id="47522-488">It is recommended that your application use the **PMSIHANDLE** type because the installer closes **PMSIHANDLE** objects as they go out of scope, whereas your application must close **MSIHANDLE** objects by calling [**MsiCloseHandle**](/windows/desktop/api/Msi/nf-msi-msiclosehandle).</span></span>

<span data-ttu-id="47522-489">例如，如果您使用如下所示的程式碼：</span><span class="sxs-lookup"><span data-stu-id="47522-489">For example, if you use code like this:</span></span>

``` syntax
MSIHANDLE hRec = MsiCreateRecord(3);
```

<span data-ttu-id="47522-490">將它變更為：</span><span class="sxs-lookup"><span data-stu-id="47522-490">Change it to:</span></span>

``` syntax
PMSIHANDLE hRec = MsiCreateRecord(3);
```

 

 
