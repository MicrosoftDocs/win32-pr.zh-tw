---
description: Windows Installer 可以判斷何時需要重新開機系統，並自動提示使用者在安裝結束時重新開機。
ms.assetid: 10117d2c-c2c8-456f-9fce-a89c2d69d3c1
title: 系統重新開機
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9b32149bbcd43e284f45d7cabcba94a080be5262
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "106981148"
---
# <a name="system-reboots"></a><span data-ttu-id="b70bf-103">系統重新開機</span><span class="sxs-lookup"><span data-stu-id="b70bf-103">System Reboots</span></span>

<span data-ttu-id="b70bf-104">Windows Installer 可以判斷何時需要重新開機系統，並自動提示使用者在安裝結束時重新開機。</span><span class="sxs-lookup"><span data-stu-id="b70bf-104">The Windows Installer can determine when a reboot of the system is necessary and automatically prompt the user to reboot at the end of the installation.</span></span> <span data-ttu-id="b70bf-105">例如，安裝程式在安裝期間需要取代任何正在使用的檔案時，會自動提示重新開機。</span><span class="sxs-lookup"><span data-stu-id="b70bf-105">For example, the installer automatically prompts for a reboot if it needs to replace any files that are in use during the installation.</span></span>

<span data-ttu-id="b70bf-106">使用 [Windows Installer](windows-installer-portal.md) 4.0 版或更新版本進行安裝和服務的應用程式會自動使用 [重新開機管理員](../rstmgr/restart-manager-portal.md) 來減少系統重新開機。</span><span class="sxs-lookup"><span data-stu-id="b70bf-106">Applications that use [Windows Installer](windows-installer-portal.md) version 4.0 or later for installation and servicing automatically use the [Restart Manager](../rstmgr/restart-manager-portal.md) to reduce system restarts.</span></span> <span data-ttu-id="b70bf-107">Windows Installer 4.0 版或更新版本的屬性和原則，可讓封裝作者和系統管理員控制 Windows Installer 與重新開機管理員的互動。</span><span class="sxs-lookup"><span data-stu-id="b70bf-107">Windows Installer version 4.0 or later has properties and policies that enable the package author and administrators to control the interaction of Windows Installer with the Restart Manager.</span></span> <span data-ttu-id="b70bf-108">如需詳細資訊，請參閱搭配 [使用 Windows Installer 與重新開機管理員](using-windows-installer-with-restart-manager.md)。</span><span class="sxs-lookup"><span data-stu-id="b70bf-108">For more information, see [Using Windows Installer with Restart Manager](using-windows-installer-with-restart-manager.md).</span></span>

<span data-ttu-id="b70bf-109">安裝套件作者可以使用順序資料表中的標準動作和設定屬性來排程和隱藏重新開機。</span><span class="sxs-lookup"><span data-stu-id="b70bf-109">Installation package authors can schedule and suppress reboots by using standard actions in the sequence tables and by setting properties.</span></span> <span data-ttu-id="b70bf-110">以下是用來處理系統重新開機的動作和屬性。</span><span class="sxs-lookup"><span data-stu-id="b70bf-110">The following actions and properties are used to handle system reboots.</span></span>



| <span data-ttu-id="b70bf-111">動作、對話方塊或屬性</span><span class="sxs-lookup"><span data-stu-id="b70bf-111">Action, dialog box, or property</span></span>                                                | <span data-ttu-id="b70bf-112">簡短描述</span><span class="sxs-lookup"><span data-stu-id="b70bf-112">Brief description</span></span>                                                                                                                                             |
|--------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="b70bf-113">ForceReboot 動作</span><span class="sxs-lookup"><span data-stu-id="b70bf-113">ForceReboot Action</span></span>](forcereboot-action.md)                                   | <span data-ttu-id="b70bf-114">在安裝期間提示使用者重新開機。</span><span class="sxs-lookup"><span data-stu-id="b70bf-114">Prompts the user for a reboot during the installation.</span></span>                                                                                                        |
| [<span data-ttu-id="b70bf-115">ScheduleReboot 動作</span><span class="sxs-lookup"><span data-stu-id="b70bf-115">ScheduleReboot Action</span></span>](schedulereboot-action.md)                             | <span data-ttu-id="b70bf-116">提示使用者在安裝結束時重新開機。</span><span class="sxs-lookup"><span data-stu-id="b70bf-116">Prompts the user for a reboot at the end of the installation.</span></span>                                                                                                 |
| [<span data-ttu-id="b70bf-117">**重新開機屬性**</span><span class="sxs-lookup"><span data-stu-id="b70bf-117">**REBOOT Property**</span></span>](reboot.md)                                              | <span data-ttu-id="b70bf-118">強制或抑制系統重新開機的特定自動提示。</span><span class="sxs-lookup"><span data-stu-id="b70bf-118">Forces or suppresses certain automatic prompts for a system reboot.</span></span>                                                                                           |
| [<span data-ttu-id="b70bf-119">**REBOOTPROMPT 屬性**</span><span class="sxs-lookup"><span data-stu-id="b70bf-119">**REBOOTPROMPT Property**</span></span>](rebootprompt.md)                                  | <span data-ttu-id="b70bf-120">抑制重新開機使用者的提示顯示。</span><span class="sxs-lookup"><span data-stu-id="b70bf-120">Suppresses the display of prompts for reboots to the user.</span></span> <span data-ttu-id="b70bf-121">任何需要的重新開機都會自動發生。</span><span class="sxs-lookup"><span data-stu-id="b70bf-121">Any needed reboots happen automatically.</span></span>                                                           |
| [<span data-ttu-id="b70bf-122">**AFTERREBOOT 屬性**</span><span class="sxs-lookup"><span data-stu-id="b70bf-122">**AFTERREBOOT Property**</span></span>](afterreboot.md)                                    | <span data-ttu-id="b70bf-123">常用於 ForceReboot 動作所加諸的條件中。</span><span class="sxs-lookup"><span data-stu-id="b70bf-123">Commonly used in a condition imposed on the ForceReboot Action.</span></span>                                                                                               |
| [<span data-ttu-id="b70bf-124">InstallValidate 動作</span><span class="sxs-lookup"><span data-stu-id="b70bf-124">InstallValidate Action</span></span>](installvalidate-action.md)                           | <span data-ttu-id="b70bf-125">如有必要，會顯示 [FilesInUse] 對話方塊，讓使用者有機會關閉程式，並避免某些系統重新開機。</span><span class="sxs-lookup"><span data-stu-id="b70bf-125">Displays the FilesInUse Dialog, if necessary, giving users the opportunity to shut down processes and avoid some system reboots.</span></span>                              |
| [<span data-ttu-id="b70bf-126">FilesInUse 對話方塊</span><span class="sxs-lookup"><span data-stu-id="b70bf-126">FilesInUse Dialog</span></span>](filesinuse-dialog.md)                                     | <span data-ttu-id="b70bf-127">讓使用者有機會關閉進程，以避免某些系統重新開機。</span><span class="sxs-lookup"><span data-stu-id="b70bf-127">Gives users the opportunity to shut down processes to avoid some system reboots.</span></span>                                                                              |
| [<span data-ttu-id="b70bf-128">MsiRMFilesInUse 對話方塊</span><span class="sxs-lookup"><span data-stu-id="b70bf-128">MsiRMFilesInUse Dialog</span></span>](msirmfilesinuse-dialog.md)                           | <span data-ttu-id="b70bf-129">提供使用者使用 [重新開機管理員](../rstmgr/restart-manager-portal.md) 來關閉和重新開機應用程式的選項。</span><span class="sxs-lookup"><span data-stu-id="b70bf-129">Gives users the option to use the [Restart Manager](../rstmgr/restart-manager-portal.md) to close and restart applications.</span></span> <span data-ttu-id="b70bf-130">從 Windows Installer 4.0 版開始提供。</span><span class="sxs-lookup"><span data-stu-id="b70bf-130">Available beginning with Windows Installer version 4.0.</span></span> |
| [<span data-ttu-id="b70bf-131">**ReplacedInUseFiles 屬性**</span><span class="sxs-lookup"><span data-stu-id="b70bf-131">**ReplacedInUseFiles Property**</span></span>](replacedinusefiles.md)                      | <span data-ttu-id="b70bf-132">設定安裝程式是否要在使用中的檔案上安裝。</span><span class="sxs-lookup"><span data-stu-id="b70bf-132">Set if the installer installs over a file in use.</span></span> <span data-ttu-id="b70bf-133">自訂動作會使用這個屬性來偵測是否需要重新開機。</span><span class="sxs-lookup"><span data-stu-id="b70bf-133">This property is used by custom actions to detect that a reboot is required.</span></span>                                |
| [<span data-ttu-id="b70bf-134">**MSIRESTARTMANAGERCONTROL**</span><span class="sxs-lookup"><span data-stu-id="b70bf-134">**MSIRESTARTMANAGERCONTROL**</span></span>](msirestartmanagercontrol.md)                   | <span data-ttu-id="b70bf-135">要停用 Windows Installer 與 [重新開機管理員](../rstmgr/restart-manager-portal.md)互動的屬性。</span><span class="sxs-lookup"><span data-stu-id="b70bf-135">Property to disable Windows Installer interaction with the [Restart Manager](../rstmgr/restart-manager-portal.md).</span></span> <span data-ttu-id="b70bf-136">從 Windows Installer 4.0 版開始提供。</span><span class="sxs-lookup"><span data-stu-id="b70bf-136">Available beginning with Windows Installer version 4.0.</span></span>          |
| [<span data-ttu-id="b70bf-137">**MSIDISABLERMRESTART**</span><span class="sxs-lookup"><span data-stu-id="b70bf-137">**MSIDISABLERMRESTART**</span></span>](msidisablermrestart.md)                             | <span data-ttu-id="b70bf-138">指定 [重新開機管理員](../rstmgr/restart-manager-portal.md) 關閉和重新開機應用程式的方式。</span><span class="sxs-lookup"><span data-stu-id="b70bf-138">Specifies how the [Restart Manager](../rstmgr/restart-manager-portal.md) closes and restarts applications.</span></span> <span data-ttu-id="b70bf-139">從 Windows Installer 4.0 版開始提供。</span><span class="sxs-lookup"><span data-stu-id="b70bf-139">Available beginning with Windows Installer version 4.0.</span></span>                  |
| [<span data-ttu-id="b70bf-140">**MSIRMSHUTDOWN**</span><span class="sxs-lookup"><span data-stu-id="b70bf-140">**MSIRMSHUTDOWN**</span></span>](msirmshutdown.md)                                         | <span data-ttu-id="b70bf-141">指定 [重新開機管理員](../rstmgr/restart-manager-portal.md) 關閉和重新開機應用程式的方式。</span><span class="sxs-lookup"><span data-stu-id="b70bf-141">Specifies how the [Restart Manager](../rstmgr/restart-manager-portal.md) closes and restarts applications.</span></span> <span data-ttu-id="b70bf-142">從 Windows Installer 4.0 版開始提供。</span><span class="sxs-lookup"><span data-stu-id="b70bf-142">Available beginning with Windows Installer version 4.0.</span></span>                  |
| [<span data-ttu-id="b70bf-143">**MsiSystemRebootPending**</span><span class="sxs-lookup"><span data-stu-id="b70bf-143">**MsiSystemRebootPending**</span></span>](msisystemrebootpending.md)                       | <span data-ttu-id="b70bf-144">如果作業系統重新開機正在擱置中，安裝程式會設定此屬性。</span><span class="sxs-lookup"><span data-stu-id="b70bf-144">Installer sets this property if a restart of the operating system is pending.</span></span> <span data-ttu-id="b70bf-145">從 Windows Installer 4.0 版開始提供。</span><span class="sxs-lookup"><span data-stu-id="b70bf-145">Available beginning with Windows Installer version 4.0.</span></span>                         |
| [<span data-ttu-id="b70bf-146">DisableAutomaticApplicationShutdown</span><span class="sxs-lookup"><span data-stu-id="b70bf-146">DisableAutomaticApplicationShutdown</span></span>](disableautomaticapplicationshutdown.md) | <span data-ttu-id="b70bf-147">停用與 [重新開機管理員](../rstmgr/restart-manager-portal.md)Windows Installer 互動的原則。</span><span class="sxs-lookup"><span data-stu-id="b70bf-147">Policy to disable Windows Installer interaction with [Restart Manager](../rstmgr/restart-manager-portal.md).</span></span> <span data-ttu-id="b70bf-148">從 Windows Installer 4.0 版開始提供。</span><span class="sxs-lookup"><span data-stu-id="b70bf-148">Available beginning with Windows Installer version 4.0.</span></span>                |



 

<span data-ttu-id="b70bf-149">「安裝暫止時發生錯誤」 \_ \_ 表示安裝未完成或回復。</span><span class="sxs-lookup"><span data-stu-id="b70bf-149">ERROR\_INSTALL\_SUSPEND means the installation did not complete or rollback.</span></span> <span data-ttu-id="b70bf-150">安裝必須在完成之前繼續進行。</span><span class="sxs-lookup"><span data-stu-id="b70bf-150">The installation must resume before it is completed.</span></span> <span data-ttu-id="b70bf-151">系統可能需要重新開機後，才能繼續安裝。</span><span class="sxs-lookup"><span data-stu-id="b70bf-151">The system may need to be rebooted before the installation can resume.</span></span>

<span data-ttu-id="b70bf-152">\_ \_ 當[ForceReboot 動作](forcereboot-action.md)執行時，WINDOWS INSTALLER 會傳回錯誤碼錯誤安裝暫止。</span><span class="sxs-lookup"><span data-stu-id="b70bf-152">The Windows Installer returns the error code ERROR\_INSTALL\_SUSPEND when the [ForceReboot action](forcereboot-action.md) is run.</span></span> <span data-ttu-id="b70bf-153">\_ \_ \_ 如果在執行應用程式之前需要重新開機，它會傳回錯誤成功重新開機， \_ \_ \_ 如果安裝程式真的開始重新開機，則會傳回錯誤成功重新開機。</span><span class="sxs-lookup"><span data-stu-id="b70bf-153">It returns ERROR\_SUCCESS\_REBOOT\_REQUIRED if a reboot is required before running the application, and it returns ERROR\_SUCCESS\_REBOOT\_INITIATED if the installer has actually started a reboot.</span></span> <span data-ttu-id="b70bf-154">請注意，因為重新開機是非同步，所以可能會在傳回錯誤碼之前實際重新開機。</span><span class="sxs-lookup"><span data-stu-id="b70bf-154">Note that because reboots are asynchronous, the reboot may actually occur before the error code is returned.</span></span> <span data-ttu-id="b70bf-155">如需詳細資訊，請參閱 [錯誤碼](error-codes.md)。</span><span class="sxs-lookup"><span data-stu-id="b70bf-155">For more information, see [Error Codes](error-codes.md).</span></span>

<span data-ttu-id="b70bf-156">自訂動作可以藉由呼叫 [**MsiSetMode**](/windows/desktop/api/Msiquery/nf-msiquery-msisetmode)來強制提示在安裝結束時重新開機。</span><span class="sxs-lookup"><span data-stu-id="b70bf-156">Custom actions can force a prompt for reboot at the end of an installation by calling [**MsiSetMode**](/windows/desktop/api/Msiquery/nf-msiquery-msisetmode).</span></span> <span data-ttu-id="b70bf-157">自訂動作也可以藉由呼叫 [**MsiGetMode**](/windows/desktop/api/Msiquery/nf-msiquery-msigetmode)來檢查暫止的重新開機提示。</span><span class="sxs-lookup"><span data-stu-id="b70bf-157">Custom actions can also check for a pending reboot prompt by calling [**MsiGetMode**](/windows/desktop/api/Msiquery/nf-msiquery-msigetmode).</span></span>

## <a name="filesinuse-dialog"></a><span data-ttu-id="b70bf-158">FilesInUse 對話方塊</span><span class="sxs-lookup"><span data-stu-id="b70bf-158">FilesInUse Dialog</span></span>

<span data-ttu-id="b70bf-159">安裝程式可以判斷何時需要重新開機系統，並提示使用者重新開機要求。</span><span class="sxs-lookup"><span data-stu-id="b70bf-159">The installer can determine when a reboot of the system is necessary and prompt the user with a request to reboot.</span></span> <span data-ttu-id="b70bf-160">通常需要重新開機系統，因為安裝程式正在嘗試安裝目前正在使用的檔案。</span><span class="sxs-lookup"><span data-stu-id="b70bf-160">Commonly, a system reboot is required because the installer is attempting to install a file that is currently being used.</span></span> <span data-ttu-id="b70bf-161">如果 [ [InstallValidate] 動作](installvalidate-action.md) 偵測到檔案的安裝已在使用中，則會顯示 [ [FilesInUse] 對話方塊](filesinuse-dialog.md)。</span><span class="sxs-lookup"><span data-stu-id="b70bf-161">If the [InstallValidate action](installvalidate-action.md) detects the installation of a file in use it displays the [FilesInUse Dialog](filesinuse-dialog.md).</span></span>

<span data-ttu-id="b70bf-162">如果您預期安裝程式會顯示 FilesInUseDialog，但卻沒有，這可能是下列其中一個原因所造成：</span><span class="sxs-lookup"><span data-stu-id="b70bf-162">If you expect the installer to display a FilesInUseDialog, but it does not, this may be due to one of the following reasons:</span></span>

-   <span data-ttu-id="b70bf-163">使用中的檔案不是可執行檔。</span><span class="sxs-lookup"><span data-stu-id="b70bf-163">The files in use are not executables.</span></span>
-   <span data-ttu-id="b70bf-164">安裝程式不會實際嘗試安裝這些檔案。</span><span class="sxs-lookup"><span data-stu-id="b70bf-164">The installer is not actually trying to install those files.</span></span>
-   <span data-ttu-id="b70bf-165">保存這些檔案的程式是叫用安裝的進程。</span><span class="sxs-lookup"><span data-stu-id="b70bf-165">The process holding those files is the process invoking the installation.</span></span>
-   <span data-ttu-id="b70bf-166">保存這些檔案的程式是沒有標題與其相關聯之視窗的進程。</span><span class="sxs-lookup"><span data-stu-id="b70bf-166">The process holding those files is one that does not have a window with a title associated with it.</span></span>

<span data-ttu-id="b70bf-167">如需詳細資訊，請參閱 [重新開機要求的記錄](logging-of-reboot-requests.md)。</span><span class="sxs-lookup"><span data-stu-id="b70bf-167">For more information, see [Logging of Reboot Requests](logging-of-reboot-requests.md).</span></span>

 

 
