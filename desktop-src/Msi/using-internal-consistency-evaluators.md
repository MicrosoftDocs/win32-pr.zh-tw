---
description: 若要驗證資料庫，請使用特殊的驗證工具，將包含內部一致性評估工具的 .cub 檔案， (等) 併入您的資料庫、執行等，然後報告結果。
ms.assetid: bdf38673-ee3d-47d8-ad6e-562cd5626918
title: 使用內部一致性評估工具
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 423e6dab453ae495dc6029b54eb039c8acc60f33
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "106973649"
---
# <a name="using-internal-consistency-evaluators"></a><span data-ttu-id="4d552-103">使用內部一致性評估工具</span><span class="sxs-lookup"><span data-stu-id="4d552-103">Using Internal Consistency Evaluators</span></span>

<span data-ttu-id="4d552-104">若要驗證資料庫，請使用特殊的驗證工具，將包含 [內部一致性評估](internal-consistency-evaluators-ices.md) 工具的 .cub 檔案， (等) 併入您的資料庫、執行等，然後報告結果。</span><span class="sxs-lookup"><span data-stu-id="4d552-104">To validate a database, use a special validation tool to merge a .cub file containing the [Internal Consistency Evaluators](internal-consistency-evaluators-ices.md) (ICEs) into your database, execute the ICEs, and report the results.</span></span> <span data-ttu-id="4d552-105">Microsoft Windows 軟體開發套件 (SDK) 提供許多這類工具。</span><span class="sxs-lookup"><span data-stu-id="4d552-105">Several such tools are provided in the Microsoft Windows Software Development Kit (SDK).</span></span> <span data-ttu-id="4d552-106">從協力廠商撰寫環境也可以將 ICE 驗證系統納入其撰寫環境中。</span><span class="sxs-lookup"><span data-stu-id="4d552-106">Authoring environments from third-party vendors also may incorporate the ICE validation system into their authoring environment.</span></span> <span data-ttu-id="4d552-107">您也可以撰寫自己的工具來執行 ICE 驗證。</span><span class="sxs-lookup"><span data-stu-id="4d552-107">It is also possible to write your own tool to perform ICE validation.</span></span> <span data-ttu-id="4d552-108">大部分的 ICE 驗證工具會將 .cub 檔和您的資料庫合併為第三個暫存資料庫。</span><span class="sxs-lookup"><span data-stu-id="4d552-108">Most ICE validation tools merge the .cub file and your database into a third, temporary database.</span></span> <span data-ttu-id="4d552-109">Windows Installer 在 .cub 檔案中執行每個 ICE 時，會顯示警告、錯誤、調試資訊和 API 錯誤。</span><span class="sxs-lookup"><span data-stu-id="4d552-109">Windows Installer displays warnings, errors, debugging information, and API errors as it executes each ICE in the .cub file.</span></span> <span data-ttu-id="4d552-110">當安裝程式完成執行時，它會關閉 .msi 檔案、.cub 檔和暫存資料庫，而不會儲存任何變更。</span><span class="sxs-lookup"><span data-stu-id="4d552-110">When the installer finishes executing the ICEs it closes the .msi file, .cub file, and temporary database without saving any changes.</span></span> <span data-ttu-id="4d552-111">此 .msi 檔案和 .cub 檔案會由驗證測試保持不變。</span><span class="sxs-lookup"><span data-stu-id="4d552-111">The .msi file and .cub file remain unchanged by the validation test.</span></span>

<span data-ttu-id="4d552-112">ICE 自訂動作會藉由呼叫 [**MsiProcessMessage**](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage) 和張貼 INSTALLMESSAGE 使用者訊息來與使用者通訊 \_ 。</span><span class="sxs-lookup"><span data-stu-id="4d552-112">ICE custom actions communicate to the user by calling [**MsiProcessMessage**](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage) and posting an INSTALLMESSAGE\_USER message.</span></span> <span data-ttu-id="4d552-113">ICE 訊息通常會傳回如下的資訊：</span><span class="sxs-lookup"><span data-stu-id="4d552-113">An ICE message commonly returns information such as the following:</span></span>

-   <span data-ttu-id="4d552-114">發現錯誤的 ICE 名稱</span><span class="sxs-lookup"><span data-stu-id="4d552-114">Name of the ICE that has found an error</span></span>
-   <span data-ttu-id="4d552-115">ICE 的建立日期</span><span class="sxs-lookup"><span data-stu-id="4d552-115">Date the ICE was created</span></span>
-   <span data-ttu-id="4d552-116">ICE 作者</span><span class="sxs-lookup"><span data-stu-id="4d552-116">Author of the ICE</span></span>
-   <span data-ttu-id="4d552-117">ICE 上次修改的日期。</span><span class="sxs-lookup"><span data-stu-id="4d552-117">Date the ICE was last modified.</span></span>
-   <span data-ttu-id="4d552-118">導致 ICE 失敗的 API 錯誤描述</span><span class="sxs-lookup"><span data-stu-id="4d552-118">Description of the API error causing the ICE to fail</span></span>
-   <span data-ttu-id="4d552-119">錯誤的描述</span><span class="sxs-lookup"><span data-stu-id="4d552-119">Description of the error</span></span>
-   <span data-ttu-id="4d552-120">使用者的警告</span><span class="sxs-lookup"><span data-stu-id="4d552-120">A warning to the user</span></span>
-   <span data-ttu-id="4d552-121">包含錯誤或警告的資料庫資料表名稱</span><span class="sxs-lookup"><span data-stu-id="4d552-121">Name of the database table containing the error or warning</span></span>
-   <span data-ttu-id="4d552-122">包含錯誤或警告的資料表資料行名稱</span><span class="sxs-lookup"><span data-stu-id="4d552-122">Name of the table column containing the error or warning</span></span>
-   <span data-ttu-id="4d552-123">包含錯誤或警告的資料表主要索引鍵</span><span class="sxs-lookup"><span data-stu-id="4d552-123">Primary keys of the table containing the error or warning</span></span>
-   <span data-ttu-id="4d552-124">提供調試建議的 HTML 檔案 URL</span><span class="sxs-lookup"><span data-stu-id="4d552-124">A URL to a HTML file giving debugging suggestions</span></span>
-   <span data-ttu-id="4d552-125">可能包含其他資訊的字串</span><span class="sxs-lookup"><span data-stu-id="4d552-125">A string that can contain other information</span></span>

<span data-ttu-id="4d552-126">安裝套件的作者可以撰寫 ICE 自訂動作，或使用 SDK 隨附的 .cub 檔案中包含的標準一組標準。</span><span class="sxs-lookup"><span data-stu-id="4d552-126">Authors of installation packages can write ICE custom actions or use the standard set of ICEs included in the .cub files provided with the SDK.</span></span> <span data-ttu-id="4d552-127">如需如何撰寫 ICE 的詳細資訊，請參閱 [建立 ice](building-an-ice.md)。</span><span class="sxs-lookup"><span data-stu-id="4d552-127">For more information on how to write an ICE, see [Building an ICE](building-an-ice.md).</span></span>

<span data-ttu-id="4d552-128">撰寫適當的 Ices-003 以進行驗證之後，開發人員必須將自訂動作一起收集到 .msi 資料庫（稱為 .cub 檔），其中只包含等位及其所需的資料表。</span><span class="sxs-lookup"><span data-stu-id="4d552-128">After writing the appropriate ICEs for validation, a developer must collect the custom actions together into an .msi database, called a .cub file, that contains only the ICEs and their required tables.</span></span> <span data-ttu-id="4d552-129">無法安裝 .cub 檔案，而且只能用來儲存和提供 ICE 自訂動作的存取權。</span><span class="sxs-lookup"><span data-stu-id="4d552-129">A .cub file cannot be installed and is used only to store and provide access to ICE custom actions.</span></span> <span data-ttu-id="4d552-130">如需建立 .cub 檔案的詳細資訊，請參閱 [建立 ICE 資料庫](building-an-ice-database.md)。</span><span class="sxs-lookup"><span data-stu-id="4d552-130">For more information on making .cub files, see [Building an ICE Database](building-an-ice-database.md).</span></span> <span data-ttu-id="4d552-131">或者，開發人員可以使用 [ICE 參考](ice-reference.md)中所述的現有內容來驗證其安裝套件。</span><span class="sxs-lookup"><span data-stu-id="4d552-131">Alternatively, developers can validate their installation package using the existing ICEs described in [ICE Reference](ice-reference.md).</span></span> <span data-ttu-id="4d552-132">您可以從 SDK 隨附的標準 .cub 檔案取得這些等。</span><span class="sxs-lookup"><span data-stu-id="4d552-132">These ICEs can be obtained from standard .cub files provided with the SDK.</span></span>

<span data-ttu-id="4d552-133">安裝資料庫資料表編輯器 Orca 或驗證工具 msival2 會提供 .cub、Darice 和 Mergemod 等檔案。</span><span class="sxs-lookup"><span data-stu-id="4d552-133">The installation of the database table editor Orca or the validation tool msival2 provides the Logo.cub, Darice.cub, and Mergemod.cub files.</span></span> <span data-ttu-id="4d552-134">標誌中的一組等量檔案是 Darice 檔中的一組。</span><span class="sxs-lookup"><span data-stu-id="4d552-134">The set of ICEs in the Logo.cub file is a subset of those in the Darice.cub file.</span></span> <span data-ttu-id="4d552-135">如果您的套件使用 Darice 傳遞驗證，它就會以 .cub 來傳遞。</span><span class="sxs-lookup"><span data-stu-id="4d552-135">If your package passes validation using Darice.cub, it will pass with Logo.cub.</span></span> <span data-ttu-id="4d552-136">Mergemod 包含一組用來驗證合併模組的一組。</span><span class="sxs-lookup"><span data-stu-id="4d552-136">Mergemod.cub contains a set of ICEs used to validate merge modules.</span></span> <span data-ttu-id="4d552-137">如需詳細資訊，請參閱 [合併模組 ICE 參考](merge-module-ice-reference.md)。</span><span class="sxs-lookup"><span data-stu-id="4d552-137">For more information, see [Merge Module ICE Reference](merge-module-ice-reference.md).</span></span>

<span data-ttu-id="4d552-138">**驗證安裝套件**</span><span class="sxs-lookup"><span data-stu-id="4d552-138">**To validate an installation package**</span></span>

1.  <span data-ttu-id="4d552-139">取得或撰寫適當的 ICE 自訂動作。</span><span class="sxs-lookup"><span data-stu-id="4d552-139">Obtain or author the appropriate ICE custom actions.</span></span> <span data-ttu-id="4d552-140">您可以使用 [ICE 參考](ice-reference.md)中所述的一或多個現有的 ices-003。</span><span class="sxs-lookup"><span data-stu-id="4d552-140">You may be able to use one or more of the existing ICEs described in the [ICE Reference](ice-reference.md).</span></span> <span data-ttu-id="4d552-141">如果您的驗證需要不在這份清單中的 ICE，您可以建立新的 ICE，如 [建立 ice](building-an-ice.md)所述。</span><span class="sxs-lookup"><span data-stu-id="4d552-141">If your validation requires an ICE not yet in this list, you can create a new ICE as described in [Building an ICE](building-an-ice.md).</span></span>
2.  <span data-ttu-id="4d552-142">準備包含所有 ICE 自訂動作的 ICE 資料庫。</span><span class="sxs-lookup"><span data-stu-id="4d552-142">Prepare an ICE Database containing all the ICE custom actions.</span></span> <span data-ttu-id="4d552-143">如需準備 .cub 檔案的相關資訊，請參閱 [建立 ICE 資料庫](building-an-ice-database.md) 一節。</span><span class="sxs-lookup"><span data-stu-id="4d552-143">See the section [Building An ICE Database](building-an-ice-database.md) for information about preparing a .cub file.</span></span>
3.  <span data-ttu-id="4d552-144">將 .cub 檔案和 .msi 檔案提供給封裝驗證工具，例如 [Orca.exe](orca-exe.md) 或 [Msival2.exe](msival2-exe.md)。</span><span class="sxs-lookup"><span data-stu-id="4d552-144">Provide the .cub file and the .msi file to a package validation tool such as [Orca.exe](orca-exe.md) or [Msival2.exe](msival2-exe.md).</span></span>

<span data-ttu-id="4d552-145">請注意，合併模組應該依照 [驗證合併模組](validating-merge-modules.md)中的說明進行驗證。</span><span class="sxs-lookup"><span data-stu-id="4d552-145">Note that merge modules should be validated as described in [Validating Merge Modules](validating-merge-modules.md).</span></span>

 

 



