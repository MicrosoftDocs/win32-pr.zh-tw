---
description: 從 Windows Installer 3.0 開始，作者可以將修補程式排序資訊新增至 MsiPatchSequence 資料表中的 patch 封裝資料庫。
ms.assetid: 9cdcb25f-2c3d-411e-9aae-bdd52df38a97
title: 排序修補程式
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: aa9cbd9aead596abfaeb50d972915bf4d618440d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "104195420"
---
# <a name="sequencing-patches"></a><span data-ttu-id="3c0bf-103">排序修補程式</span><span class="sxs-lookup"><span data-stu-id="3c0bf-103">Sequencing Patches</span></span>

<span data-ttu-id="3c0bf-104">從 Windows Installer 3.0 開始，作者可以將修補程式排序資訊新增至 [MsiPatchSequence](msipatchsequence-table.md) 資料表中的 patch 封裝資料庫。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-104">Beginning with Windows Installer 3.0, authors can add patch sequencing information to the patch package database in the [MsiPatchSequence](msipatchsequence-table.md) table.</span></span> <span data-ttu-id="3c0bf-105">安裝程式可以使用這項資訊來判斷哪些修補程式適用于安裝套件、判斷最佳修補順序，以及以固定順序安裝修補程式，而不受系統提供的順序影響。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-105">The installer can use this information to determine which patches are applicable to an installation package, to determine the best patching sequence, and to install patches in an constant order independent of the order they are provided to the system.</span></span>

<span data-ttu-id="3c0bf-106">**Windows Installer 2.0：** 不支援。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-106">**Windows Installer 2.0:** Not supported.</span></span> <span data-ttu-id="3c0bf-107">Windows Installer Windows Installer 3.0 之前的版本會依照提供給系統的順序來安裝修補程式，而不論它們是否包含 [MsiPatchSequence](msipatchsequence-table.md) 資料表。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-107">Windows Installer versions previous to Windows Installer 3.0 install patches in the order that they are provided to the system regardless of whether they contain an [MsiPatchSequence](msipatchsequence-table.md) table.</span></span>

<span data-ttu-id="3c0bf-108">以下是使用修補程式排序功能的必要條件。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-108">The following are required to use the patch sequencing functionality.</span></span>

-   <span data-ttu-id="3c0bf-109"> ( .msp 檔) [修補套件](patch-packages.md)必須有一個包含順序資訊的[MsiPatchSequence](msipatchsequence-table.md)資料表。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-109">[Patch packages](patch-packages.md) (.msp files) must have a [MsiPatchSequence](msipatchsequence-table.md) table containing sequencing information.</span></span> <span data-ttu-id="3c0bf-110">安裝程式會以提供給系統的順序來安裝沒有 MsiPatchSequence 資料表的修補程式。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-110">The installer installs patches that do not have a MsiPatchSequence table in the order that they are provided to the system.</span></span>
-   <span data-ttu-id="3c0bf-111">使用 Windows Installer 3.0 或更新版本安裝修補程式。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-111">Patches are installed using Windows Installer 3.0 or later.</span></span>

<span data-ttu-id="3c0bf-112">Windows Installer 3.0 版具有下列功能，可讓應用程式用來判斷最佳的修補順序。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-112">Windows Installer version 3.0 has the following functions that applications can use to determine the best patching sequence.</span></span>

-   <span data-ttu-id="3c0bf-113">[**MsiDeterminePatchSequence**](/windows/desktop/api/Msi/nf-msi-msideterminepatchsequencea)函式會取得修補程式的清單，並決定可將它們套用至已安裝產品的順序。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-113">The [**MsiDeterminePatchSequence**](/windows/desktop/api/Msi/nf-msi-msideterminepatchsequencea) function takes a list of patches and determines in what sequence they can be applied to an installed product.</span></span> <span data-ttu-id="3c0bf-114">此函式會針對已安裝在系統上的任何修補程式或產品進行帳戶。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-114">This function accounts for any patches or products that have already been installed on the system.</span></span>
-   <span data-ttu-id="3c0bf-115">[**MsiDetermineApplicablePatches**](/windows/desktop/api/Msi/nf-msi-msidetermineapplicablepatchesa)函式會取得修補程式的清單，並決定可將它們套用至已安裝產品的順序。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-115">The [**MsiDetermineApplicablePatches**](/windows/desktop/api/Msi/nf-msi-msidetermineapplicablepatchesa) function takes a list of patches and determines in what sequence they can be applied to an installed product.</span></span> <span data-ttu-id="3c0bf-116">此函式不會考慮已安裝在系統上的任何修補程式或產品。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-116">This function does not account for any patches or products that have already been installed on the system.</span></span>

<span data-ttu-id="3c0bf-117">Windows Installer 版本3.0 可在單一修補安裝中，將多個修補程式套用至產品。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-117">Windows Installer version 3.0 can apply multiple patches to a product in a single patching installation.</span></span> <span data-ttu-id="3c0bf-118">修補程式的群組可以包含修補程式，其中包括修補順序資訊 ([MsiPatchSequence](msipatchsequence-table.md) 資料表) 和不包含的修補程式。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-118">The group of patches can contain patches that include patching sequence information (a [MsiPatchSequence](msipatchsequence-table.md) table) and patches that do not.</span></span> <span data-ttu-id="3c0bf-119">Windows Installer 會以提供給系統的順序，安裝沒有此資料表的修補套件。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-119">The Windows Installer installs the patch packages without this table in the order that they are provided to the system.</span></span> <span data-ttu-id="3c0bf-120">安裝程式會將缺少 MsiPatchSequence 資料表的修補程式帳戶，但在下一節中所述的方法標示為已淘汰或取代的修補程式。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-120">The installer accounts for patch packages that lack a MsiPatchSequence table, but that have been marked as obsolete or superseded patches by the method described in the following section.</span></span>

<span data-ttu-id="3c0bf-121">當 Windows Installer 3.0 版安裝多個修補程式時，會遵循下列步驟來判斷將個別修補程式套用至產品的順序：</span><span class="sxs-lookup"><span data-stu-id="3c0bf-121">When Windows Installer version 3.0 installs multiple patches, it follows these steps to determine the sequence in which individual patches are applied to the product:</span></span>

1.  <span data-ttu-id="3c0bf-122">安裝的修補程式如果沒有 [MsiPatchSequence](msipatchsequence-table.md) 資料表，則會依照套用至產品的順序放入順序中。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-122">Installed patches without a [MsiPatchSequence](msipatchsequence-table.md) table are put in the sequence in the order that they were applied to the product.</span></span> <span data-ttu-id="3c0bf-123">第一個套用的修補程式會先放置於序列中。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-123">The first patch that was applied is placed first in the sequence.</span></span>
2.  <span data-ttu-id="3c0bf-124">在序列中會放入沒有 [MsiPatchSequence 資料表](msipatchsequence-table.md) 的新修補程式。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-124">New patches without a [MsiPatchSequence table](msipatchsequence-table.md) are put in the sequence.</span></span> <span data-ttu-id="3c0bf-125">目前的修補安裝正在套用這些修補程式。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-125">These patches are being applied by the current patching installation.</span></span> <span data-ttu-id="3c0bf-126">它們會依照提供給系統的順序放置，並放在步驟1中的所有修補程式之後。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-126">They are put in the order that they are provided to the system, and placed after all the patches in step 1.</span></span>
3.  <span data-ttu-id="3c0bf-127">已淘汰的修補程式會從修補程式順序中去除。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-127">Obsolete patches are eliminated from the sequence of patches.</span></span>
    > [!Note]  
    > <span data-ttu-id="3c0bf-128">Patch 封裝可在 [ [**修訂編號摘要**](revision-number-summary.md) ] 屬性中指定修補程式要移除之過時修補程式的明確清單。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-128">A patch package can specify in the [**Revision Number Summary**](revision-number-summary.md) property an explicit list of obsolete patches to be removed by the patch.</span></span> <span data-ttu-id="3c0bf-129">這份清單適用于3.0 版之前的 Windows Installer 版本。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-129">This list is intended for use by Windows Installer versions earlier than version 3.0.</span></span> <span data-ttu-id="3c0bf-130">Windows Installer 版本3.0 會從序列中移除標示為過時的修補程式（只有在修補程式沒有 [MsiPatchSequence 資料表](msipatchsequence-table.md)時）。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-130">Windows Installer version 3.0 removes the patches marked as obsolete from the sequence, only if the patches do not have the [MsiPatchSequence table](msipatchsequence-table.md).</span></span>

     

4.  <span data-ttu-id="3c0bf-131">安裝程式會逐步解說修補順序，並判斷哪些修補程式適用于指定的順序。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-131">The installer steps through the patching sequence and determines which patches are applicable in the given sequence.</span></span> <span data-ttu-id="3c0bf-132">當有多個修補程式套用至產品時，序列中的每個修補程式也會將產品的安裝資料庫轉換 ( .msi 檔案) 。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-132">When multiple patches are applied to a product, each patch in the sequence also transforms the product's installation database (.msi file).</span></span> <span data-ttu-id="3c0bf-133">只有當修補程式的資料庫轉換能夠採用將所有先前 [修補封裝](patch-packages.md)的轉換套用至 product 資料庫所產生的 [產品代碼](product-codes.md)、[**版本**](productversion.md)、[**語言**](productlanguage.md)和 [**upgradecode**](upgradecode.md)時，才適用于特定的順序。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-133">A patch is applicable in a particular sequence only if its database transform is capable of taking the [product code](product-codes.md), [**version**](productversion.md), [**language**](productlanguage.md), and [**upgradecode**](upgradecode.md) that result from applying the transforms of all preceding [patch packages](patch-packages.md) to the product database.</span></span> <span data-ttu-id="3c0bf-134">安裝程式會從序列中排除任何不適用修補程式。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-134">The installer eliminates any inapplicable patches from the sequence.</span></span>
5.  <span data-ttu-id="3c0bf-135">安裝程式會開始將具有排序資訊的修補程式放在其 [MsiPatchSequence](msipatchsequence-table.md) 資料表中。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-135">The installer begins placing patches that have sequencing information in their [MsiPatchSequence](msipatchsequence-table.md) table.</span></span> <span data-ttu-id="3c0bf-136">具有 MsiPatchSequence 資料表的[次要升級](minor-upgrades.md)修補程式會放在先前步驟中已排序的修補程式之後，以及升級後的最低到最高產品版本順序。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-136">[Minor upgrade](minor-upgrades.md) patches that have the MsiPatchSequence table are placed in the sequence after the patches that were sequenced in previous steps and in the order of their lowest to highest product versions after being upgraded.</span></span> <span data-ttu-id="3c0bf-137">Windows Installer 接著會排除在此順序中不適用的任何次要升級修補程式。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-137">Windows Installer then eliminates any minor upgrade patches that are inapplicable in this sequence.</span></span>
6.  <span data-ttu-id="3c0bf-138">以具有[MsiPatchSequence](msipatchsequence-table.md)資料表的[次要](minor-upgrades.md)升級為目標的[小型更新](small-updates.md)修補程式，會指派給順序中最高版本的次要升級修補程式。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-138">[Small update](small-updates.md) patches targeting [minor upgrades](minor-upgrades.md) having a [MsiPatchSequence](msipatchsequence-table.md) table, are assigned to the highest version of the minor upgrade patch in the sequence.</span></span>
7.  <span data-ttu-id="3c0bf-139">在先前步驟之後維持未指派，且具有[MsiPatchSequence](msipatchsequence-table.md)資料表的所有[小型更新](small-updates.md)修補程式，都會放在具有 MsiPatchSequence 資料表的第一個[次要升級](minor-upgrades.md)之前，以及在 .msi 安裝資料庫和沒有 MsiPatchSequence 資料表的任何修補程式之後。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-139">All [small update](small-updates.md) patches that remain unassigned after the previous steps, and that have the [MsiPatchSequence](msipatchsequence-table.md) table, are put in the sequence before the first [minor upgrade](minor-upgrades.md) that has the MsiPatchSequence table, and after the .msi installation database and any patches without the MsiPatchSequence table.</span></span> <span data-ttu-id="3c0bf-140">Windows Installer 接著會排除在此順序中不適用的任何小型更新修補程式。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-140">Windows Installer then eliminates any small update patches that are inapplicable in this sequence.</span></span>
8.  <span data-ttu-id="3c0bf-141">Windows Installer 版本3.0 會從序列中排除已取代的修補程式。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-141">Windows Installer version 3.0 eliminates superseded patches from the sequence.</span></span> <span data-ttu-id="3c0bf-142">當修補程式取代稍早在修補程式順序中所發生的修補程式時，修補程式會包含先前修補程式中的所有修正程式。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-142">When a patch supersedes patches that occur earlier in the patch sequence, the patch contains all the fixes in the earlier patches.</span></span> <span data-ttu-id="3c0bf-143">不再需要較舊的修補程式。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-143">The earlier patches are no longer required.</span></span> <span data-ttu-id="3c0bf-144">Windows Installer 需要 [MsiPatchSequence](msipatchsequence-table.md) 資料表中的資訊，以排除取代的修補程式。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-144">The Windows Installer requires the information in the [MsiPatchSequence](msipatchsequence-table.md) table to eliminate superseded patches.</span></span>
    > [!Note]  
    > <span data-ttu-id="3c0bf-145">必須撰寫修補程式以取代舊版修補程式的修補程式，以取代所有修補程式系列中的較早修補程式。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-145">Patches intended to supersede an earlier set of patches must be authored to supersede the earlier patches in all patch families.</span></span> <span data-ttu-id="3c0bf-146">[小型更新](small-updates.md) 修補程式只能取代小更新。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-146">[Small update](small-updates.md) patches can only supersede small updates.</span></span> <span data-ttu-id="3c0bf-147">[次要升級](minor-upgrades.md) 可以取代小型更新和其他次要升級。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-147">[Minor upgrades](minor-upgrades.md) can supersede both small updates and other minor upgrades.</span></span>

     

9.  <span data-ttu-id="3c0bf-148">包含[MsiPatchSequence](msipatchsequence-table.md)資料表的[小型更新](small-updates.md)修補程式，會根據其 MsiPatchSequence 資料表中的排序資訊，在產品版本中進行排序。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-148">[Small update](small-updates.md) patches that carry [MsiPatchSequence](msipatchsequence-table.md) tables, get sequenced within product versions according to the sequencing information in their MsiPatchSequence tables.</span></span> <span data-ttu-id="3c0bf-149">這會決定最終的修補順序。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-149">This determines the final patching sequence.</span></span>

<span data-ttu-id="3c0bf-150">不應再使用的修補程式可以從修補順序中排除。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-150">A patch that should no longer be used can be eliminated from the patching sequence.</span></span> <span data-ttu-id="3c0bf-151">如需如何從修補順序中消除修補程式的詳細資訊，請參閱 [消除修補程式](eliminating-patches.md)。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-151">For more information about how to eliminate patches from the patching sequence, see [Eliminating Patches](eliminating-patches.md).</span></span>

<span data-ttu-id="3c0bf-152">如需如何使用 [MsiPatchSequence](msipatchsequence-table.md) 資料表來依照撰寫的順序套用修補程式的範例，請參閱 [多個修補範例](multiple-patching-example.md)。</span><span class="sxs-lookup"><span data-stu-id="3c0bf-152">For an example of how the [MsiPatchSequence](msipatchsequence-table.md) table can be used to apply patches in the order in which they are authored, see the [Multiple Patching Example](multiple-patching-example.md).</span></span>

 

 



