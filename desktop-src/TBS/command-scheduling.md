---
title: 命令排程
description: 每個命令都有與其相關聯的優先順序。
ms.assetid: 63f6ba9d-0b87-403b-916b-aa8550f98a11
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 06512f0748aa88f6b32de3291e2ed1c262212ba2
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/16/2019
ms.locfileid: "106967626"
---
# <a name="command-scheduling"></a><span data-ttu-id="85f7d-103">命令排程</span><span class="sxs-lookup"><span data-stu-id="85f7d-103">Command Scheduling</span></span>

## <a name="command-scheduling"></a><span data-ttu-id="85f7d-104">命令排程</span><span class="sxs-lookup"><span data-stu-id="85f7d-104">Command Scheduling</span></span>

<span data-ttu-id="85f7d-105">您可以隨時從多個內容將命令提交至 TB。</span><span class="sxs-lookup"><span data-stu-id="85f7d-105">Commands can be submitted to the TBS from multiple contexts at any time.</span></span> <span data-ttu-id="85f7d-106">不過，實體 TPM 一次只能處理一個命令，而某些命令可能會執行一段很長的時間。</span><span class="sxs-lookup"><span data-stu-id="85f7d-106">However, a physical TPM can only process one command at a time, and some commands can run for a significant period of time.</span></span> <span data-ttu-id="85f7d-107">當有多個命令暫止時，TBS 會決定要傳送至 TPM 的命令。</span><span class="sxs-lookup"><span data-stu-id="85f7d-107">When multiple commands are pending, the TBS decides which command to send to the TPM.</span></span> <span data-ttu-id="85f7d-108">提交命令時，每個命令都會有相關聯的優先順序。</span><span class="sxs-lookup"><span data-stu-id="85f7d-108">When a command is submitted, each command has a priority associated with it.</span></span> <span data-ttu-id="85f7d-109">TBS 會使用這些優先順序來判斷每次 TPM 免費時要提交的暫止命令。</span><span class="sxs-lookup"><span data-stu-id="85f7d-109">The TBS uses these priorities to determine which pending command to submit whenever the TPM is free.</span></span> <span data-ttu-id="85f7d-110">這四個優先權等級為 low、normal、high 和 system。</span><span class="sxs-lookup"><span data-stu-id="85f7d-110">The four levels of priority are low, normal, high, and system.</span></span> <span data-ttu-id="85f7d-111">應用程式應該使用低、一般或高優先順序。</span><span class="sxs-lookup"><span data-stu-id="85f7d-111">Applications should use low, normal, or high priority.</span></span> <span data-ttu-id="85f7d-112">雖然高優先順序的命令通常會在低優先順序的命令之前執行，但 [TB] 命令排程器具有過時原則，最終會為已封鎖的命令提供非常高的優先權。</span><span class="sxs-lookup"><span data-stu-id="85f7d-112">Although high-priority commands are usually executed before low-priority commands, the TBS command scheduler has an aging policy that eventually gives very high priority to commands that have been blocked for significant periods of time.</span></span>

## <a name="context-management"></a><span data-ttu-id="85f7d-113">內容管理</span><span class="sxs-lookup"><span data-stu-id="85f7d-113">Context Management</span></span>

<span data-ttu-id="85f7d-114">\_使用虛擬控制碼將 TPM SaveCoNtext 或 TPM2 CoNtextSave 命令提交到 TBS 所管理的資源時，會在實體資源上執行適當的命令，並將結果傳回給呼叫者（如果資源實際上存在於 TPM 中）。</span><span class="sxs-lookup"><span data-stu-id="85f7d-114">When a TPM\_SaveContext or TPM2 ContextSave command is submitted with a virtual handle to a resource that the TBS is managing, the TBS executes the appropriate command on the physical resource and returns the result to the caller if the resource is physically present in the TPM.</span></span> <span data-ttu-id="85f7d-115">如果資源實際上不在 TPM 中，則 TPM \_ SaveCoNtext 或 TPM2 CoNtextSave 命令的前置處理 \_ 會導致重新載入資源，此時內容將會儲存並傳回給呼叫端。</span><span class="sxs-lookup"><span data-stu-id="85f7d-115">If the resource is not physically present in the TPM, the preprocessing of the TPM\_SaveContext or TPM2\_ContextSave command causes the resource to be reloaded, at which point the context will be saved and returned to the caller.</span></span> <span data-ttu-id="85f7d-116">如果儲存的資源類型通常會在儲存後自動從 TPM 自動排清，則在完成此命令時，會使虛擬資源失效。</span><span class="sxs-lookup"><span data-stu-id="85f7d-116">If the resource being saved is of a type that is normally flushed automatically from the TPM after saving, the TBS invalidates the virtual resource upon completion of this command.</span></span> <span data-ttu-id="85f7d-117">將 TPM \_ LoadCoNtext 或 TPM2 \_ CoNtextLoad 命令提交到 tb 時，tb 會立即執行命令。</span><span class="sxs-lookup"><span data-stu-id="85f7d-117">When a TPM\_LoadContext or TPM2\_ContextLoad command is submitted to the TBS, the TBS executes the command immediately.</span></span> <span data-ttu-id="85f7d-118">如果命令成功完成，則會將資源控制碼虛擬化，並將產生的 TPM 位元組串流傳遞給呼叫端。</span><span class="sxs-lookup"><span data-stu-id="85f7d-118">If the command completes successfully, the TBS virtualizes the resource handle and passes the resulting TPM byte stream to the caller.</span></span> <span data-ttu-id="85f7d-119">\_使用虛擬控制碼將 tpm FlushSpecific 或 TPM2 \_ FlushCoNtext 命令提交到 TBS 所管理的資源時，此 tb 會執行 tpm \_ FlushSpecific 或 TPM2 \_ FlushCoNtext 命令，以從 tpm 中收回資源（如果實際上有的話）。</span><span class="sxs-lookup"><span data-stu-id="85f7d-119">When a TPM\_FlushSpecific or TPM2\_FlushContext command is submitted with a virtual handle to a resource that the TBS is managing, the TBS executes a TPM\_FlushSpecific or TPM2\_FlushContext command to evict the resource from the TPM if it is physically present.</span></span> <span data-ttu-id="85f7d-120">在此情況下，TBS 會使虛擬資源失效，並將 flush 命令的結果傳回給呼叫者。</span><span class="sxs-lookup"><span data-stu-id="85f7d-120">In this case, the TBS invalidates the virtual resource and returns the result of the flush command to the caller.</span></span> <span data-ttu-id="85f7d-121">如果資源實際上不存在於 TPM 中，則 TPM \_ FlushSpecific 或 TPM2 \_ FlushCoNtext 命令的前置處理會載入對應于虛擬控制碼的資源，但它會在實際處理命令時進行清除。</span><span class="sxs-lookup"><span data-stu-id="85f7d-121">If the resource is not physically present in the TPM, the preprocessing of the TPM\_FlushSpecific or TPM2\_FlushContext command will load the resource that corresponds to the virtual handle, but it will then be flushed when the command is actually processed.</span></span> <span data-ttu-id="85f7d-122">此 TB 不支援 tpm \_ KeyControlOwner 位或 tpm LoadCoNtext 作業的 keepHandle 功能 \_ ，因此它不會為資源提供儲存內容之前的相同處理常式。</span><span class="sxs-lookup"><span data-stu-id="85f7d-122">The TBS does not support the TPM\_KeyControlOwner bit or the keepHandle functionality of the TPM\_LoadContext operation, so it will not give a resource the same handle it had before the context was saved.</span></span>

## <a name="other-commands"></a><span data-ttu-id="85f7d-123">其他命令</span><span class="sxs-lookup"><span data-stu-id="85f7d-123">Other Commands</span></span>

<span data-ttu-id="85f7d-124">本檔中未提及的命令會藉由在) 必要時將虛擬金鑰控制碼取代 (的實體金鑰控制碼來處理，並將其提交至 TPM。</span><span class="sxs-lookup"><span data-stu-id="85f7d-124">Commands that are not mentioned in this documentation are processed by replacing virtual key handles with physical key handles (if necessary) and submitting them to the TPM.</span></span> <span data-ttu-id="85f7d-125">這是在執行適當的作業之後完成，以確保所使用的資源實際上存在於 TPM 上。</span><span class="sxs-lookup"><span data-stu-id="85f7d-125">This is done after performing the appropriate operations to ensure that resources being used are physically present on the TPM.</span></span> <span data-ttu-id="85f7d-126">不會執行其他特殊處理。</span><span class="sxs-lookup"><span data-stu-id="85f7d-126">No additional special processing is performed.</span></span> <span data-ttu-id="85f7d-127">只要修改從 TPM 傳回的資料做為 TPM \_ GetCapabilities 或 TPM2 GetCapability 查詢的一部分，此 tb 就不會嘗試改善虛擬化的精確度 \_ 。</span><span class="sxs-lookup"><span data-stu-id="85f7d-127">The TBS does not attempt to improve the fidelity of the virtualization by modifying data passed back from the TPM as part of a TPM\_GetCapabilities or TPM2\_GetCapability query.</span></span> <span data-ttu-id="85f7d-128">此 TB 也支援 TCG 實體存在性命令。</span><span class="sxs-lookup"><span data-stu-id="85f7d-128">The TBS also supports TCG Physical Presence commands.</span></span> <span data-ttu-id="85f7d-129">此 TB 可作為實體存在性命令的傳遞：TBS 本身不會執行任何特殊處理。</span><span class="sxs-lookup"><span data-stu-id="85f7d-129">The TBS acts as a pass-through for Physical Presence commands; no special processing is performed by the TBS itself.</span></span>

## <a name="cleanup"></a><span data-ttu-id="85f7d-130">清除</span><span class="sxs-lookup"><span data-stu-id="85f7d-130">Cleanup</span></span>

<span data-ttu-id="85f7d-131">當內容結束時，與其相關聯的所有實體和虛擬資源都會清除，使其不再耗用系統資源。</span><span class="sxs-lookup"><span data-stu-id="85f7d-131">When a context exits, all physical and virtual resources associated with it are cleaned up so they no longer consume system resources.</span></span>

 

 




