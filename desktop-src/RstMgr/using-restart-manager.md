---
title: 使用重新開機管理員
description: 下列各節說明如何使用重新開機管理員 API。
ms.assetid: 78448d5e-20f6-45b6-b833-7d7791e5e4c6
keywords:
- 重新開機管理員重新開機管理員，使用
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6e4ac72edb9f2395bbd67236806c3ab3029372cc
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/20/2020
ms.locfileid: "103842611"
---
# <a name="using-restart-manager"></a><span data-ttu-id="1cf1c-104">使用重新開機管理員</span><span class="sxs-lookup"><span data-stu-id="1cf1c-104">Using Restart Manager</span></span>

<span data-ttu-id="1cf1c-105">下列各節說明如何使用重新開機管理員 API。</span><span class="sxs-lookup"><span data-stu-id="1cf1c-105">The following sections describe using the Restart Manager API.</span></span> <span data-ttu-id="1cf1c-106">您的應用程式和服務也應該遵循 [應用程式和服務的指導方針](guidelines-for-applications-and-services.md)。</span><span class="sxs-lookup"><span data-stu-id="1cf1c-106">Your applications and services should also follow the [Guidelines for Applications and Services](guidelines-for-applications-and-services.md).</span></span>

## <a name="using-the-microsoft-windows-installer"></a><span data-ttu-id="1cf1c-107">使用 Microsoft Windows Installer</span><span class="sxs-lookup"><span data-stu-id="1cf1c-107">Using the Microsoft Windows Installer</span></span>

<span data-ttu-id="1cf1c-108">[Microsoft Windows Installer](/windows/desktop/Msi/windows-installer-portal) 4.0 版是 Windows Vista 或 windows Server 2008 的應用程式安裝服務。</span><span class="sxs-lookup"><span data-stu-id="1cf1c-108">The [Microsoft Windows Installer](/windows/desktop/Msi/windows-installer-portal) Version 4.0 is the application installation service of Windows Vista or Windows Server 2008.</span></span> <span data-ttu-id="1cf1c-109">使用 Windows Installer 4.0 版進行安裝和服務的應用程式會自動使用重新開機管理員來減少系統重新開機。</span><span class="sxs-lookup"><span data-stu-id="1cf1c-109">Applications that use the Windows Installer version 4.0 for installation and servicing automatically use the Restart Manager to reduce system restarts.</span></span> <span data-ttu-id="1cf1c-110">自訂安裝程式也可以設計來呼叫重新開機管理員 API，以直接關閉和重新開機應用程式和服務，以避免需要重新開機系統。</span><span class="sxs-lookup"><span data-stu-id="1cf1c-110">Custom installers can also be designed to call the Restart Manager API to shut down and restart applications and services directly to avoid requiring a system restart.</span></span> <span data-ttu-id="1cf1c-111">在無法避免系統重新開機的情況下，安裝程式可以使用 [**InitiateShutdown**](/windows/desktop/api/winreg/nf-winreg-initiateshutdowna) 或 [**ExitWindowsEx**](/windows/desktop/api/winuser/nf-winuser-exitwindowsex) 函式，以將使用者的干擾降至最低的方式進行排程。</span><span class="sxs-lookup"><span data-stu-id="1cf1c-111">In cases where a system restart is unavoidable, installers can use the [**InitiateShutdown**](/windows/desktop/api/winreg/nf-winreg-initiateshutdowna) or [**ExitWindowsEx**](/windows/desktop/api/winuser/nf-winuser-exitwindowsex) function to schedule it in such a way that it minimizes the disruption to the user.</span></span> <span data-ttu-id="1cf1c-112">互動式 Windows Installer 套件應該執行包含 [MsiRMFilesInUse](/windows/desktop/Msi/msirmfilesinuse-dialog) 對話方塊的使用者介面。</span><span class="sxs-lookup"><span data-stu-id="1cf1c-112">Interactive Windows Installer packages should implement a user interface that includes a [MsiRMFilesInUse](/windows/desktop/Msi/msirmfilesinuse-dialog) dialog box.</span></span> <span data-ttu-id="1cf1c-113">如需詳細資訊，請參閱 Windows Installer SDK 檔中的 [使用 Windows Installer 與重新開機管理員](/windows/desktop/Msi/using-windows-installer-with-restart-manager) 。</span><span class="sxs-lookup"><span data-stu-id="1cf1c-113">For more information, see [Using Windows Installer with Restart Manager](/windows/desktop/Msi/using-windows-installer-with-restart-manager) in the Windows Installer SDK documentation.</span></span>

## <a name="using-the-restart-manager-api-with-custom-installers"></a><span data-ttu-id="1cf1c-114">使用重新開機管理員 API 搭配自訂安裝程式</span><span class="sxs-lookup"><span data-stu-id="1cf1c-114">Using the Restart Manager API with Custom Installers</span></span>

<span data-ttu-id="1cf1c-115">自訂安裝程式，或包含導致系統重新開機之自訂動作的 Windows Installer 套件，可以使用重新開機管理員 API 來關閉和重新開機應用程式和服務。</span><span class="sxs-lookup"><span data-stu-id="1cf1c-115">Custom installers, or a Windows Installer package that contains custom actions that cause a system restart, can use the Restart Manager API to shut down and restart applications and services.</span></span>

-   <span data-ttu-id="1cf1c-116">使用重新開機管理員 API 執行的所有作業都必須與會話相關聯。</span><span class="sxs-lookup"><span data-stu-id="1cf1c-116">All operations that are performed using the Restart Manager API must be associated with a session.</span></span> <span data-ttu-id="1cf1c-117">每個使用者會話最多可同時在系統上開啟64個重新開機管理員會話。</span><span class="sxs-lookup"><span data-stu-id="1cf1c-117">A maximum of 64 Restart Manager sessions per user session can be open on the system at the same time.</span></span> <span data-ttu-id="1cf1c-118">主要安裝程式會啟動並結束重新開機管理員會話。</span><span class="sxs-lookup"><span data-stu-id="1cf1c-118">The primary installer starts and ends the Restart Manager session.</span></span> <span data-ttu-id="1cf1c-119">如需搭配單一安裝程式使用重新開機管理員的詳細資訊，請參閱搭配 [主要安裝程式使用重新開機管理員](using-restart-manager-with-a-primary-installer.md)。</span><span class="sxs-lookup"><span data-stu-id="1cf1c-119">For more information about using Restart Manager with a single installer, see [Using Restart Manager with a Primary Installer](using-restart-manager-with-a-primary-installer.md).</span></span>
-   <span data-ttu-id="1cf1c-120">如果安裝有必要，您可以將一或多個次要安裝程式聯結到重新開機管理員會話，並且可以執行同進程或跨進程的主要安裝程式。</span><span class="sxs-lookup"><span data-stu-id="1cf1c-120">If necessary for the installation, one or more secondary installers can be joined to the Restart Manager session and can run either in-process or out-of-process of the primary installer.</span></span> <span data-ttu-id="1cf1c-121">次要安裝程式需要主要安裝程式提供工作階段金鑰，才能加入會話。</span><span class="sxs-lookup"><span data-stu-id="1cf1c-121">Secondary installers require that the session key be provided by the primary installer to join a session.</span></span> <span data-ttu-id="1cf1c-122">如需詳細資訊和使用次要安裝程式的範例，請參閱搭配 [次要安裝程式使用重新開機管理員](using-restart-manager-with-a-secondary-installer.md)。</span><span class="sxs-lookup"><span data-stu-id="1cf1c-122">For more information and an example of using secondary installers, see [Using Restart Manager with a Secondary Installer](using-restart-manager-with-a-secondary-installer.md).</span></span>
-   <span data-ttu-id="1cf1c-123">互動式安裝程式應該執行包含 [MsiRMFilesInUse](/windows/desktop/Msi/msirmfilesinuse-dialog) 對話方塊的使用者介面，該對話方塊可要求使用者關閉應用程式和服務。</span><span class="sxs-lookup"><span data-stu-id="1cf1c-123">Interactive installers should implement a user interface that includes an [MsiRMFilesInUse](/windows/desktop/Msi/msirmfilesinuse-dialog) dialog box that can ask users to close applications and services.</span></span> <span data-ttu-id="1cf1c-124">如需詳細資訊，請參閱 Windows Installer SDK 檔中的 [使用 Windows Installer 與重新開機管理員](/windows/desktop/Msi/using-windows-installer-with-restart-manager) 。</span><span class="sxs-lookup"><span data-stu-id="1cf1c-124">For more information, see [Using Windows Installer with Restart Manager](/windows/desktop/Msi/using-windows-installer-with-restart-manager) in the Windows Installer SDK documentation.</span></span>
-   <span data-ttu-id="1cf1c-125">安裝程式可以呼叫重新開機管理員 API 來變更、取消和取得目前重新開機管理員操作的狀態。</span><span class="sxs-lookup"><span data-stu-id="1cf1c-125">Installers can call the Restart Manager API to change, cancel, and get the status of the current Restart Manager operation.</span></span> <span data-ttu-id="1cf1c-126">如需詳細資訊，請參閱下列主題： [取得重新開機管理員作業的狀態](getting-the-status-of-a-restart-manager-operation.md) ，並 [取消目前的重新開機管理員操作](canceling-the-current-restart-manager-operation.md)。</span><span class="sxs-lookup"><span data-stu-id="1cf1c-126">For more information, see the following topics: [Getting the Status of a Restart Manager Operation](getting-the-status-of-a-restart-manager-operation.md) and [Canceling the Current Restart Manager Operation](canceling-the-current-restart-manager-operation.md).</span></span>
-   <span data-ttu-id="1cf1c-127">在呼叫重新開機管理員 API 之前，安裝程式不應停用檔案系統重新導向。</span><span class="sxs-lookup"><span data-stu-id="1cf1c-127">Installers should not disable file system redirection before calling the Restart Manager API.</span></span> <span data-ttu-id="1cf1c-128">在64位 Windows 上執行的某些32位安裝程式可能無法在% windir% system32 目錄中註冊檔案 \\ 。</span><span class="sxs-lookup"><span data-stu-id="1cf1c-128">Some 32-bit installers run on 64-bit Windows may be unable to register a file in the %windir%\\system32 directory.</span></span>

 

 