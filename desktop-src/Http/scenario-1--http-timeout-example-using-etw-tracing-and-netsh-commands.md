---
title: 使用 ETW 追蹤和 Netsh 命令的案例 1 HTTP Timeout 範例
description: 透過 ETW 追蹤，可以檢查透過 HTTP 伺服器 API 元件進行的資料流程，以診斷問題。
ms.assetid: b6b24161-c3da-4972-b49f-c545da2fc81e
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: aa50f438aca664651b24db822f2b9e3a30da4682
ms.sourcegitcommit: 37f276b5d887a3aad04b1ba86e390dea9d87e591
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 02/04/2021
ms.locfileid: "104567309"
---
# <a name="scenario-1-http-timeout-example-using-etw-tracing-and-netsh-commands"></a><span data-ttu-id="cf50e-103">案例1：使用 ETW 追蹤和 Netsh 命令的 HTTP Timeout 範例</span><span class="sxs-lookup"><span data-stu-id="cf50e-103">Scenario 1: HTTP Timeout Example Using ETW Tracing and Netsh Commands</span></span>

<span data-ttu-id="cf50e-104">透過 ETW 追蹤，可以檢查透過 HTTP 伺服器 API 元件進行的資料流程，以診斷問題。</span><span class="sxs-lookup"><span data-stu-id="cf50e-104">Through ETW tracing, the flow of data through the HTTP Server API component can be inspected to diagnose problems.</span></span> <span data-ttu-id="cf50e-105">例如，web 應用程式的使用者可能會在其瀏覽器中看到網頁無法顯示的錯誤訊息。</span><span class="sxs-lookup"><span data-stu-id="cf50e-105">For example, users of a web application may see error messages in their browser that a web page cannot display.</span></span> <span data-ttu-id="cf50e-106">在裝載 web 應用程式的伺服器上，IT 專業人員也會看到 HTTP 錯誤記錄檔中的連接逾時專案，如下面的 [圖 1] 所示。</span><span class="sxs-lookup"><span data-stu-id="cf50e-106">On the server hosting the web application, the IT professional also sees a connection timeout entry within the HTTP Error Log, as shown in Figure 1 below.</span></span> <span data-ttu-id="cf50e-107">您可以在下列目錄中找到 HTTP 錯誤記錄檔：% windir% \\ System32 記錄檔 \\ \\ HTTPERR \\ 。</span><span class="sxs-lookup"><span data-stu-id="cf50e-107">The HTTP Error Log can be found in the following directory: %windir%\\System32\\LogFiles\\HTTPERR\\.</span></span>

![顯示 netsh H T P 命令視窗的螢幕擷取畫面，其中顯示 timeout 的 H T T 錯誤記錄檔。](images/httperrorlog.png)

<span data-ttu-id="cf50e-109">圖1： HTTP 錯誤記錄檔中的超時時間</span><span class="sxs-lookup"><span data-stu-id="cf50e-109">Figure 1: HTTP Error Log for Timeout</span></span>

## <a name="generating-an-etw-trace-report"></a><span data-ttu-id="cf50e-110">產生 ETW 追蹤報告</span><span class="sxs-lookup"><span data-stu-id="cf50e-110">Generating an ETW Trace Report</span></span>

<span data-ttu-id="cf50e-111">若要產生 HTTP 伺服器 API 元件的 ETW 追蹤報告，請從命令提示字元執行下列步驟。</span><span class="sxs-lookup"><span data-stu-id="cf50e-111">To generate an ETW trace report for the HTTP Server API component, run the steps below from the command prompt.</span></span> <span data-ttu-id="cf50e-112">在此範例中，追蹤是在伺服器上執行，因為它會裝載 web 應用程式。</span><span class="sxs-lookup"><span data-stu-id="cf50e-112">In this example, the trace is run on the server since it is hosting the web application.</span></span>

<span data-ttu-id="cf50e-113">下列步驟會產生名為 HTTPtrace 的追蹤，然後將追蹤轉換成稱為 httptrace.csv 的 CSV 檔案。</span><span class="sxs-lookup"><span data-stu-id="cf50e-113">The steps below generate a trace called httptrace.etl and then convert the trace into a CSV file called httptrace.csv.</span></span> <span data-ttu-id="cf50e-114">如下所示，HTTP 伺服器 API 的 ETW 提供者稱為 Microsoft Windows-HttpService。</span><span class="sxs-lookup"><span data-stu-id="cf50e-114">As shown below, the ETW provider for the HTTP Server API is called Microsoft-Windows-HttpService.</span></span> <span data-ttu-id="cf50e-115">0xFFF 命令列選項表示應捕捉此提供者的所有 ETW 事件。</span><span class="sxs-lookup"><span data-stu-id="cf50e-115">The 0xFFF command-line option indicates that all ETW events for this provider should be captured.</span></span>

<span data-ttu-id="cf50e-116">**產生 ETW 追蹤報告**</span><span class="sxs-lookup"><span data-stu-id="cf50e-116">**Generate an ETW Trace Report**</span></span>

1.  <span data-ttu-id="cf50e-117">啟動 HTTP 伺服器 API 元件的 ETW 追蹤： l **ogman.exe 啟動 HTTPtrace-p Microsoft-Windows-HttpService 0xffff-o HTTPtrace. etl – ets**</span><span class="sxs-lookup"><span data-stu-id="cf50e-117">Start ETW trace for HTTP Server API component: l **ogman.exe start httptrace -p Microsoft-Windows-HttpService 0xFFFF -o httptrace.etl –ets**</span></span>
2.  <span data-ttu-id="cf50e-118">重現問題，讓它可以在追蹤中捕捉。</span><span class="sxs-lookup"><span data-stu-id="cf50e-118">Reproduce the issue so that it can be captured in the trace.</span></span> <span data-ttu-id="cf50e-119">在此範例中，從用戶端電腦存取 web 應用程式，而導致在用戶端上顯示「**無法顯示頁面**」訊息。</span><span class="sxs-lookup"><span data-stu-id="cf50e-119">In this example, access the web application from a client machine, resulting in the "**page cannot be displayed**" message being shown on the client.</span></span>
3.  <span data-ttu-id="cf50e-120">現在已重現問題，請停止追蹤： **logman.exe 停止 HTTPtrace – ets**</span><span class="sxs-lookup"><span data-stu-id="cf50e-120">Now that the issue has been reproduced, stop the trace: **logman.exe stop httptrace –ets**</span></span>
4.  <span data-ttu-id="cf50e-121">將報表轉換成 CSV 格式： **tracerpt.exe HTTPtrace---------------httptrace.csv**</span><span class="sxs-lookup"><span data-stu-id="cf50e-121">Convert the report into CSV format: **tracerpt.exe httptrace.etl -of CSV -o httptrace.csv**</span></span>
5.  <span data-ttu-id="cf50e-122">查看追蹤報表。</span><span class="sxs-lookup"><span data-stu-id="cf50e-122">View the trace report.</span></span> <span data-ttu-id="cf50e-123">CSV 追蹤的摘錄如下表1所示。</span><span class="sxs-lookup"><span data-stu-id="cf50e-123">An excerpt from a CSV trace is shown below in Table 1.</span></span>

## <a name="viewing-the-trace-and-diagnosing"></a><span data-ttu-id="cf50e-124">查看追蹤和診斷</span><span class="sxs-lookup"><span data-stu-id="cf50e-124">Viewing the Trace and Diagnosing</span></span>

<span data-ttu-id="cf50e-125">您可以在 Excel 或支援 CSV 格式的任何工具中，查看所產生的追蹤 CSV 檔案。</span><span class="sxs-lookup"><span data-stu-id="cf50e-125">The resulting CSV file for traces can be viewed in Excel or any tool that supports the CSV format.</span></span> <span data-ttu-id="cf50e-126">下表1顯示範例追蹤檔 (httptrace.csv) 的摘錄。</span><span class="sxs-lookup"><span data-stu-id="cf50e-126">Table 1 below shows excerpts from a sample trace file (httptrace.csv).</span></span> <span data-ttu-id="cf50e-127">在追蹤報表中，[層級] 資料行會顯示值為 "3" 的專案，這會對應至 ETW 中的警告。</span><span class="sxs-lookup"><span data-stu-id="cf50e-127">In the trace report, the "Level" column shows an entry with a value of "3", which corresponds to a warning in ETW.</span></span> <span data-ttu-id="cf50e-128">HTTP 伺服器 API 元件會遵循下列文章中定義的 ETW 層級： (https://msdn2.microsoft.com/library/aa382793.aspx) 。</span><span class="sxs-lookup"><span data-stu-id="cf50e-128">The HTTP Server API component follows the ETW Levels defined in the following article: (https://msdn2.microsoft.com/library/aa382793.aspx).</span></span> <span data-ttu-id="cf50e-129">ETW 層級包括：</span><span class="sxs-lookup"><span data-stu-id="cf50e-129">The ETW levels include:</span></span>



| <span data-ttu-id="cf50e-130">層級</span><span class="sxs-lookup"><span data-stu-id="cf50e-130">Level</span></span> | <span data-ttu-id="cf50e-131">意義</span><span class="sxs-lookup"><span data-stu-id="cf50e-131">Meaning</span></span>      |
|-------|--------------|
| <span data-ttu-id="cf50e-132">1</span><span class="sxs-lookup"><span data-stu-id="cf50e-132">1</span></span>     | <span data-ttu-id="cf50e-133">重大</span><span class="sxs-lookup"><span data-stu-id="cf50e-133">Critical</span></span>     |
| <span data-ttu-id="cf50e-134">2</span><span class="sxs-lookup"><span data-stu-id="cf50e-134">2</span></span>     | <span data-ttu-id="cf50e-135">錯誤</span><span class="sxs-lookup"><span data-stu-id="cf50e-135">Error</span></span>        |
| <span data-ttu-id="cf50e-136">3</span><span class="sxs-lookup"><span data-stu-id="cf50e-136">3</span></span>     | <span data-ttu-id="cf50e-137">警告</span><span class="sxs-lookup"><span data-stu-id="cf50e-137">Warning</span></span>      |
| <span data-ttu-id="cf50e-138">4</span><span class="sxs-lookup"><span data-stu-id="cf50e-138">4</span></span>     | <span data-ttu-id="cf50e-139">Infomational</span><span class="sxs-lookup"><span data-stu-id="cf50e-139">Infomational</span></span> |
| <span data-ttu-id="cf50e-140">5</span><span class="sxs-lookup"><span data-stu-id="cf50e-140">5</span></span>     | <span data-ttu-id="cf50e-141">「詳細資訊」</span><span class="sxs-lookup"><span data-stu-id="cf50e-141">Verbose</span></span>      |



 

<span data-ttu-id="cf50e-142">使用此警告時，事件種類 (類型資料行) 報告 "ConnTimedOut"。</span><span class="sxs-lookup"><span data-stu-id="cf50e-142">With this warning, the event type (Type column) reports "ConnTimedOut".</span></span> <span data-ttu-id="cf50e-143">在 ConnTimeOut 事件的後續資料行中，過期的特定計時器會回報為「計時器 \_ ConnectionIdle」。</span><span class="sxs-lookup"><span data-stu-id="cf50e-143">In the subsequent columns for the ConnTimeOut event, the specific timer that expired is reported as "Timer\_ConnectionIdle".</span></span> <span data-ttu-id="cf50e-144">請注意，資料表中包含 "Timer \_ ConnectionIdle" 專案的資料行未包含在資料表中，以求簡潔，並避免 excerpting 不連續的資料行。</span><span class="sxs-lookup"><span data-stu-id="cf50e-144">Note the column with the "Timer\_ConnectionIdle" entry is not included in the table for the sake brevity and to avoid excerpting noncontiguous columns.</span></span>



| <span data-ttu-id="cf50e-145">事件名稱</span><span class="sxs-lookup"><span data-stu-id="cf50e-145">Event name</span></span>                    | <span data-ttu-id="cf50e-146">類型</span><span class="sxs-lookup"><span data-stu-id="cf50e-146">Type</span></span>            | <span data-ttu-id="cf50e-147">事件識別碼</span><span class="sxs-lookup"><span data-stu-id="cf50e-147">Event ID</span></span> | <span data-ttu-id="cf50e-148">版本</span><span class="sxs-lookup"><span data-stu-id="cf50e-148">Version</span></span> | <span data-ttu-id="cf50e-149">通路</span><span class="sxs-lookup"><span data-stu-id="cf50e-149">Channel</span></span> | <span data-ttu-id="cf50e-150">層級</span><span class="sxs-lookup"><span data-stu-id="cf50e-150">Level</span></span> |
|-------------------------------|-----------------|----------|---------|---------|-------|
| <span data-ttu-id="cf50e-151">EventTrace</span><span class="sxs-lookup"><span data-stu-id="cf50e-151">EventTrace</span></span>                    | <span data-ttu-id="cf50e-152">標頭</span><span class="sxs-lookup"><span data-stu-id="cf50e-152">Header</span></span>          | <span data-ttu-id="cf50e-153">0</span><span class="sxs-lookup"><span data-stu-id="cf50e-153">0</span></span>        | <span data-ttu-id="cf50e-154">2</span><span class="sxs-lookup"><span data-stu-id="cf50e-154">2</span></span>       | <span data-ttu-id="cf50e-155">0</span><span class="sxs-lookup"><span data-stu-id="cf50e-155">0</span></span>       | <span data-ttu-id="cf50e-156">0</span><span class="sxs-lookup"><span data-stu-id="cf50e-156">0</span></span>     |
| <span data-ttu-id="cf50e-157">Microsoft-Windows-HttpService</span><span class="sxs-lookup"><span data-stu-id="cf50e-157">Microsoft-Windows-HttpService</span></span> | <span data-ttu-id="cf50e-158">ChgUrlGrpProp</span><span class="sxs-lookup"><span data-stu-id="cf50e-158">ChgUrlGrpProp</span></span>   | <span data-ttu-id="cf50e-159">28</span><span class="sxs-lookup"><span data-stu-id="cf50e-159">28</span></span>       | <span data-ttu-id="cf50e-160">0</span><span class="sxs-lookup"><span data-stu-id="cf50e-160">0</span></span>       | <span data-ttu-id="cf50e-161">16</span><span class="sxs-lookup"><span data-stu-id="cf50e-161">16</span></span>      | <span data-ttu-id="cf50e-162">4</span><span class="sxs-lookup"><span data-stu-id="cf50e-162">4</span></span>     |
| <span data-ttu-id="cf50e-163">Microsoft-Windows-HttpService</span><span class="sxs-lookup"><span data-stu-id="cf50e-163">Microsoft-Windows-HttpService</span></span> | <span data-ttu-id="cf50e-164">AddUrl</span><span class="sxs-lookup"><span data-stu-id="cf50e-164">AddUrl</span></span>          | <span data-ttu-id="cf50e-165">31</span><span class="sxs-lookup"><span data-stu-id="cf50e-165">31</span></span>       | <span data-ttu-id="cf50e-166">0</span><span class="sxs-lookup"><span data-stu-id="cf50e-166">0</span></span>       | <span data-ttu-id="cf50e-167">16</span><span class="sxs-lookup"><span data-stu-id="cf50e-167">16</span></span>      | <span data-ttu-id="cf50e-168">4</span><span class="sxs-lookup"><span data-stu-id="cf50e-168">4</span></span>     |
| <span data-ttu-id="cf50e-169">Microsoft-Windows-HttpService</span><span class="sxs-lookup"><span data-stu-id="cf50e-169">Microsoft-Windows-HttpService</span></span> | <span data-ttu-id="cf50e-170">ChgReqQueueProp</span><span class="sxs-lookup"><span data-stu-id="cf50e-170">ChgReqQueueProp</span></span> | <span data-ttu-id="cf50e-171">30</span><span class="sxs-lookup"><span data-stu-id="cf50e-171">30</span></span>       | <span data-ttu-id="cf50e-172">0</span><span class="sxs-lookup"><span data-stu-id="cf50e-172">0</span></span>       | <span data-ttu-id="cf50e-173">16</span><span class="sxs-lookup"><span data-stu-id="cf50e-173">16</span></span>      | <span data-ttu-id="cf50e-174">4</span><span class="sxs-lookup"><span data-stu-id="cf50e-174">4</span></span>     |
| <span data-ttu-id="cf50e-175">Microsoft-Windows-HttpService</span><span class="sxs-lookup"><span data-stu-id="cf50e-175">Microsoft-Windows-HttpService</span></span> | <span data-ttu-id="cf50e-176">ChgUrlGrpProp</span><span class="sxs-lookup"><span data-stu-id="cf50e-176">ChgUrlGrpProp</span></span>   | <span data-ttu-id="cf50e-177">28</span><span class="sxs-lookup"><span data-stu-id="cf50e-177">28</span></span>       | <span data-ttu-id="cf50e-178">0</span><span class="sxs-lookup"><span data-stu-id="cf50e-178">0</span></span>       | <span data-ttu-id="cf50e-179">16</span><span class="sxs-lookup"><span data-stu-id="cf50e-179">16</span></span>      | <span data-ttu-id="cf50e-180">4</span><span class="sxs-lookup"><span data-stu-id="cf50e-180">4</span></span>     |
| <span data-ttu-id="cf50e-181">Microsoft-Windows-HttpService</span><span class="sxs-lookup"><span data-stu-id="cf50e-181">Microsoft-Windows-HttpService</span></span> | <span data-ttu-id="cf50e-182">ChgSrvSesProp</span><span class="sxs-lookup"><span data-stu-id="cf50e-182">ChgSrvSesProp</span></span>   | <span data-ttu-id="cf50e-183">29</span><span class="sxs-lookup"><span data-stu-id="cf50e-183">29</span></span>       | <span data-ttu-id="cf50e-184">0</span><span class="sxs-lookup"><span data-stu-id="cf50e-184">0</span></span>       | <span data-ttu-id="cf50e-185">16</span><span class="sxs-lookup"><span data-stu-id="cf50e-185">16</span></span>      | <span data-ttu-id="cf50e-186">4</span><span class="sxs-lookup"><span data-stu-id="cf50e-186">4</span></span>     |
| <span data-ttu-id="cf50e-187">Microsoft-Windows-HttpService</span><span class="sxs-lookup"><span data-stu-id="cf50e-187">Microsoft-Windows-HttpService</span></span> | <span data-ttu-id="cf50e-188">ChgSrvSesProp</span><span class="sxs-lookup"><span data-stu-id="cf50e-188">ChgSrvSesProp</span></span>   | <span data-ttu-id="cf50e-189">29</span><span class="sxs-lookup"><span data-stu-id="cf50e-189">29</span></span>       | <span data-ttu-id="cf50e-190">0</span><span class="sxs-lookup"><span data-stu-id="cf50e-190">0</span></span>       | <span data-ttu-id="cf50e-191">16</span><span class="sxs-lookup"><span data-stu-id="cf50e-191">16</span></span>      | <span data-ttu-id="cf50e-192">4</span><span class="sxs-lookup"><span data-stu-id="cf50e-192">4</span></span>     |
| <span data-ttu-id="cf50e-193">Microsoft-Windows-HttpService</span><span class="sxs-lookup"><span data-stu-id="cf50e-193">Microsoft-Windows-HttpService</span></span> | <span data-ttu-id="cf50e-194">ConnConnect</span><span class="sxs-lookup"><span data-stu-id="cf50e-194">ConnConnect</span></span>     | <span data-ttu-id="cf50e-195">21</span><span class="sxs-lookup"><span data-stu-id="cf50e-195">21</span></span>       | <span data-ttu-id="cf50e-196">0</span><span class="sxs-lookup"><span data-stu-id="cf50e-196">0</span></span>       | <span data-ttu-id="cf50e-197">16</span><span class="sxs-lookup"><span data-stu-id="cf50e-197">16</span></span>      | <span data-ttu-id="cf50e-198">4</span><span class="sxs-lookup"><span data-stu-id="cf50e-198">4</span></span>     |
| <span data-ttu-id="cf50e-199">Microsoft-Windows-HttpService</span><span class="sxs-lookup"><span data-stu-id="cf50e-199">Microsoft-Windows-HttpService</span></span> | <span data-ttu-id="cf50e-200">ConnIdAssgn</span><span class="sxs-lookup"><span data-stu-id="cf50e-200">ConnIdAssgn</span></span>     | <span data-ttu-id="cf50e-201">22</span><span class="sxs-lookup"><span data-stu-id="cf50e-201">22</span></span>       | <span data-ttu-id="cf50e-202">0</span><span class="sxs-lookup"><span data-stu-id="cf50e-202">0</span></span>       | <span data-ttu-id="cf50e-203">16</span><span class="sxs-lookup"><span data-stu-id="cf50e-203">16</span></span>      | <span data-ttu-id="cf50e-204">4</span><span class="sxs-lookup"><span data-stu-id="cf50e-204">4</span></span>     |
| <span data-ttu-id="cf50e-205">Microsoft-Windows-HttpService</span><span class="sxs-lookup"><span data-stu-id="cf50e-205">Microsoft-Windows-HttpService</span></span> | <span data-ttu-id="cf50e-206">RecvReq</span><span class="sxs-lookup"><span data-stu-id="cf50e-206">RecvReq</span></span>         | <span data-ttu-id="cf50e-207">1</span><span class="sxs-lookup"><span data-stu-id="cf50e-207">1</span></span>        | <span data-ttu-id="cf50e-208">0</span><span class="sxs-lookup"><span data-stu-id="cf50e-208">0</span></span>       | <span data-ttu-id="cf50e-209">16</span><span class="sxs-lookup"><span data-stu-id="cf50e-209">16</span></span>      | <span data-ttu-id="cf50e-210">4</span><span class="sxs-lookup"><span data-stu-id="cf50e-210">4</span></span>     |
| <span data-ttu-id="cf50e-211">Microsoft-Windows-HttpService</span><span class="sxs-lookup"><span data-stu-id="cf50e-211">Microsoft-Windows-HttpService</span></span> | <span data-ttu-id="cf50e-212">剖析</span><span class="sxs-lookup"><span data-stu-id="cf50e-212">Parse</span></span>           | <span data-ttu-id="cf50e-213">2</span><span class="sxs-lookup"><span data-stu-id="cf50e-213">2</span></span>        | <span data-ttu-id="cf50e-214">0</span><span class="sxs-lookup"><span data-stu-id="cf50e-214">0</span></span>       | <span data-ttu-id="cf50e-215">16</span><span class="sxs-lookup"><span data-stu-id="cf50e-215">16</span></span>      | <span data-ttu-id="cf50e-216">4</span><span class="sxs-lookup"><span data-stu-id="cf50e-216">4</span></span>     |
| <span data-ttu-id="cf50e-217">Microsoft-Windows-HttpService</span><span class="sxs-lookup"><span data-stu-id="cf50e-217">Microsoft-Windows-HttpService</span></span> | <span data-ttu-id="cf50e-218">LogFileWrite</span><span class="sxs-lookup"><span data-stu-id="cf50e-218">LogFileWrite</span></span>    | <span data-ttu-id="cf50e-219">51</span><span class="sxs-lookup"><span data-stu-id="cf50e-219">51</span></span>       | <span data-ttu-id="cf50e-220">0</span><span class="sxs-lookup"><span data-stu-id="cf50e-220">0</span></span>       | <span data-ttu-id="cf50e-221">16</span><span class="sxs-lookup"><span data-stu-id="cf50e-221">16</span></span>      | <span data-ttu-id="cf50e-222">4</span><span class="sxs-lookup"><span data-stu-id="cf50e-222">4</span></span>     |
| <span data-ttu-id="cf50e-223">Microsoft-Windows-HttpService</span><span class="sxs-lookup"><span data-stu-id="cf50e-223">Microsoft-Windows-HttpService</span></span> | <span data-ttu-id="cf50e-224">ConnCleanup</span><span class="sxs-lookup"><span data-stu-id="cf50e-224">ConnCleanup</span></span>     | <span data-ttu-id="cf50e-225">24</span><span class="sxs-lookup"><span data-stu-id="cf50e-225">24</span></span>       | <span data-ttu-id="cf50e-226">0</span><span class="sxs-lookup"><span data-stu-id="cf50e-226">0</span></span>       | <span data-ttu-id="cf50e-227">16</span><span class="sxs-lookup"><span data-stu-id="cf50e-227">16</span></span>      | <span data-ttu-id="cf50e-228">4</span><span class="sxs-lookup"><span data-stu-id="cf50e-228">4</span></span>     |
| <span data-ttu-id="cf50e-229">Microsoft-Windows-HttpService</span><span class="sxs-lookup"><span data-stu-id="cf50e-229">Microsoft-Windows-HttpService</span></span> | <span data-ttu-id="cf50e-230">ConnTimedOut</span><span class="sxs-lookup"><span data-stu-id="cf50e-230">ConnTimedOut</span></span>    | <span data-ttu-id="cf50e-231">53</span><span class="sxs-lookup"><span data-stu-id="cf50e-231">53</span></span>       | <span data-ttu-id="cf50e-232">0</span><span class="sxs-lookup"><span data-stu-id="cf50e-232">0</span></span>       | <span data-ttu-id="cf50e-233">16</span><span class="sxs-lookup"><span data-stu-id="cf50e-233">16</span></span>      | <span data-ttu-id="cf50e-234">3</span><span class="sxs-lookup"><span data-stu-id="cf50e-234">3</span></span>     |



 

<span data-ttu-id="cf50e-235">表1：從計時器問題的範例追蹤報表摘錄</span><span class="sxs-lookup"><span data-stu-id="cf50e-235">Table 1: Excerpts from a Sample Trace Report for a Timer Issue</span></span>

<span data-ttu-id="cf50e-236">在此範例中，標頭計時器的到期 (ConnTimeOut 事件)  (計時器 \_ ConnectionIdle) 是終端使用者在其 web 用戶端中看到「無法顯示頁面」訊息的原因。</span><span class="sxs-lookup"><span data-stu-id="cf50e-236">In this example, the expiration (ConnTimeOut event) of the header timer (Timer\_ConnectionIdle) is the reason end-users see the "page cannot be displayed" message in their web clients.</span></span> <span data-ttu-id="cf50e-237">可能的超時原因可能是因為連線速度很慢，所以 Web 用戶端傳送速度很慢。</span><span class="sxs-lookup"><span data-stu-id="cf50e-237">A potential reason for the timeout may be that Web clients are sending slowly due to slow connections.</span></span> <span data-ttu-id="cf50e-238">若要解決此問題，可以透過 Netsh 命令來調整超時值。</span><span class="sxs-lookup"><span data-stu-id="cf50e-238">To address this issue, the timeout value can be adjusted through Netsh commands.</span></span>

## <a name="adjusting-timeout-through-netsh-and-verifying-the-solution"></a><span data-ttu-id="cf50e-239">透過 Netsh 調整 Timeout 並驗證解決方案</span><span class="sxs-lookup"><span data-stu-id="cf50e-239">Adjusting Timeout through Netsh and Verifying the Solution</span></span>

<span data-ttu-id="cf50e-240">下列適用于 HTTP 的 Netsh 命令可讓 IT 專業人員查看和設定 HTTP 伺服器 API 元件上的設定值。</span><span class="sxs-lookup"><span data-stu-id="cf50e-240">The Netsh commands for HTTP listed below allow an IT professional to view and configure setting values on the HTTP Server API component.</span></span> <span data-ttu-id="cf50e-241">透過 Netsh HTTP 命令進行的變更會影響該電腦的 HTTP 伺服器 API 元件所裝載的所有伺服器應用程式。</span><span class="sxs-lookup"><span data-stu-id="cf50e-241">Changes through Netsh HTTP commands affect all server applications hosted by the HTTP Server API component for that machine.</span></span> <span data-ttu-id="cf50e-242">這些變更會保存在元件重新開機後重新開機電腦。</span><span class="sxs-lookup"><span data-stu-id="cf50e-242">These changes persist across restarts of the component and reboots of the machine.</span></span> <span data-ttu-id="cf50e-243">Netsh HTTP 命令可在 windows Vista 和 Windows Server 2008 中使用，並在 Windows Vista 和 Windows Server 2008 上執行時取代 Windows Server 2003 資源套件的 HttpCfg.exe 工具。</span><span class="sxs-lookup"><span data-stu-id="cf50e-243">The Netsh HTTP commands are available in Windows Vista and Windows Server 2008 and replace the Windows Server 2003 Resource Kit's HttpCfg.exe tool when running on Windows Vista and Windows Server 2008.</span></span> <span data-ttu-id="cf50e-244">在此案例中，我們會調整超時值，然後驗證解決方案。</span><span class="sxs-lookup"><span data-stu-id="cf50e-244">In this scenario, we will adjust a timeout value and then verify the solution.</span></span> <span data-ttu-id="cf50e-245">HTTP 伺服器 API 元件中有計時器，可確保可用性並防止不正確或惡意的使用者過度耗用。</span><span class="sxs-lookup"><span data-stu-id="cf50e-245">Timers exist in the HTTP Server API component to ensure availability and protect against overconsumption by a misconfigured or malicious user.</span></span> <span data-ttu-id="cf50e-246">從預設值調整計時器應謹慎地針對潛在的 DoS 攻擊進行評估。</span><span class="sxs-lookup"><span data-stu-id="cf50e-246">Adjusting timers from default values should be carefully evaluated against a potential DoS attack.</span></span>

<span data-ttu-id="cf50e-247">在此範例中，web 用戶端位於低速網路連線後方，導致計時器 \_ CONNECTIONIDLE ETW 事件。</span><span class="sxs-lookup"><span data-stu-id="cf50e-247">In this example, the web clients are behind a slow network connection, resulting in the Timer\_ConnectionIdle ETW event.</span></span> <span data-ttu-id="cf50e-248">在考慮到因為對伺服器負載造成的超時和平衡的原因之後，會決定將超時值增加為240秒的值。</span><span class="sxs-lookup"><span data-stu-id="cf50e-248">After consideration of the cause of the timeouts and balancing with the impact on the server's load, the decision is made to increase the timeout values to a value of 240 seconds.</span></span> <span data-ttu-id="cf50e-249">您可以使用下列程式來查看並設定計時器。</span><span class="sxs-lookup"><span data-stu-id="cf50e-249">You can view and then configure the timer with the following procedure.</span></span>

<span data-ttu-id="cf50e-250">**\_使用 Netsh (timer ConnectionIdle) 設定閒置連接計時器**</span><span class="sxs-lookup"><span data-stu-id="cf50e-250">**Configure the idle connection timer (Timer\_ConnectionIdle) with Netsh**</span></span>

1.  <span data-ttu-id="cf50e-251">在伺服器上，開啟提高許可權的命令視窗，然後執行下列步驟來查看和設定 timeout 值。</span><span class="sxs-lookup"><span data-stu-id="cf50e-251">On the server, open an elevated command window and run the steps below to view and configure the timeout value.</span></span> <span data-ttu-id="cf50e-252">[圖 2] 顯示 Netsh HTTP 命令的螢幕擷取畫面。</span><span class="sxs-lookup"><span data-stu-id="cf50e-252">A screenshot of the Netsh HTTP command is shown in Figure 2 below.</span></span>
2.  <span data-ttu-id="cf50e-253">顯示目前的超時值： **Netsh HTTP show timeout**</span><span class="sxs-lookup"><span data-stu-id="cf50e-253">Show the current timeout values: **Netsh http show timeout**</span></span>
3.  <span data-ttu-id="cf50e-254">設定計時器 \_ ConnectionIdle timeout 值。</span><span class="sxs-lookup"><span data-stu-id="cf50e-254">Configure the Timer\_ConnectionIdle timeout value.</span></span> <span data-ttu-id="cf50e-255">在此範例中，值會變更為240秒： **Netsh HTTP add timeout timeouttype = idleconnectiontimeout value = 240**</span><span class="sxs-lookup"><span data-stu-id="cf50e-255">In this example, the value is changed to 240 seconds: **Netsh http add timeout timeouttype=idleconnectiontimeout value=240**</span></span>

![netsh HTTP 命令視窗](images/netshhttpcommand.png)

<span data-ttu-id="cf50e-257">圖2： Netsh HTTP 命令視窗</span><span class="sxs-lookup"><span data-stu-id="cf50e-257">Figure 2: Netsh HTTP command window</span></span>

<span data-ttu-id="cf50e-258">設定 timeout 值之後，請重新執行 ETW 診斷步驟。</span><span class="sxs-lookup"><span data-stu-id="cf50e-258">After configuring the timeout value, rerun the ETW diagnosis steps.</span></span> <span data-ttu-id="cf50e-259">如果錯誤狀況已更正，ETW 追蹤應該不會再顯示連接閒置計時器之 ETW 層級為 "3" 的超時時間。</span><span class="sxs-lookup"><span data-stu-id="cf50e-259">If the error condition is corrected, the ETW trace should no longer show a timeout with an ETW level of "3" for the connection idle timer.</span></span>

 

 




