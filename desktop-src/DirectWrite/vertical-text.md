---
title: 垂直文字
description: 從 Windows 8 開始，DirectWrite 有一些新的 Api，可讓您在應用程式中使用垂直文字。
ms.assetid: F40A79AE-F7BF-4CAC-9480-1489CD212DA8
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0db8788a6be97a55911694942a930e17dc69976a
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/20/2020
ms.locfileid: "103933283"
---
# <a name="vertical-text"></a><span data-ttu-id="386ac-103">垂直文字</span><span class="sxs-lookup"><span data-stu-id="386ac-103">Vertical Text</span></span>

<span data-ttu-id="386ac-104">從 Windows 8 開始， [DirectWrite](direct-write-portal.md) 有一些新的 api，可讓您在應用程式中使用垂直文字。</span><span class="sxs-lookup"><span data-stu-id="386ac-104">Starting with the Windows 8, [DirectWrite](direct-write-portal.md) has a number of new APIs that allow you to use vertical text in your apps.</span></span>

## <a name="drawing-vertical-text"></a><span data-ttu-id="386ac-105">繪製垂直文字</span><span class="sxs-lookup"><span data-stu-id="386ac-105">Drawing vertical text</span></span>

<span data-ttu-id="386ac-106">您可以使用 [**DrawTextLayout**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtextlayout) 方法，以 Direct2D 繪製垂直文字。</span><span class="sxs-lookup"><span data-stu-id="386ac-106">You can draw vertical text with Direct2D by using the [**DrawTextLayout**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtextlayout) methods.</span></span> <span data-ttu-id="386ac-107">若要垂直繪製文字，請將 [**DWRITE 的 \_ 讀取方向從上往 \_ \_ \_ \_ 下**](/windows/win32/api/dwrite/ne-dwrite-dwrite_reading_direction) 傳遞至 [**IDWriteTextFormat：： SetReadingDirection**](/windows/win32/api/dwrite/nf-dwrite-idwritetextformat-setreadingdirection) 方法，並將 [**DWRITE \_ 流程方向由 \_ \_ 右 \_ \_ 移**](/windows/win32/api/dwrite/ne-dwrite-dwrite_flow_direction) 至 [**IDWriteTextFormatSetFlowDirection**](/windows/win32/api/dwrite/nf-dwrite-idwritetextformat-setflowdirection) 方法。</span><span class="sxs-lookup"><span data-stu-id="386ac-107">To draw the text vertically, pass [**DWRITE\_READING\_DIRECTION\_TOP\_TO\_BOTTOM**](/windows/win32/api/dwrite/ne-dwrite-dwrite_reading_direction) to the [**IDWriteTextFormat::SetReadingDirection**](/windows/win32/api/dwrite/nf-dwrite-idwritetextformat-setreadingdirection) method and [**DWRITE\_FLOW\_DIRECTION\_RIGHT\_TO\_LEFT**](/windows/win32/api/dwrite/ne-dwrite-dwrite_flow_direction) to the [**IDWriteTextFormatSetFlowDirection**](/windows/win32/api/dwrite/nf-dwrite-idwritetextformat-setflowdirection) method.</span></span> <span data-ttu-id="386ac-108">然後，您可以建立和繪製垂直 [**IDWriteTextLayout**](/windows/win32/api/dwrite/nn-dwrite-idwritetextlayout) 物件。</span><span class="sxs-lookup"><span data-stu-id="386ac-108">Then you can create and draw a vertical [**IDWriteTextLayout**](/windows/win32/api/dwrite/nn-dwrite-idwritetextlayout) object.</span></span>

## <a name="analyzing-character-orientation"></a><span data-ttu-id="386ac-109">分析字元方向</span><span class="sxs-lookup"><span data-stu-id="386ac-109">Analyzing character orientation</span></span>

<span data-ttu-id="386ac-110">每個字元都有一個慣用的字元方向，或字元應該以任何方向配置來導向的方向。</span><span class="sxs-lookup"><span data-stu-id="386ac-110">Every character has a preferred character orientation, or the direction that the character should be oriented in any directional layout.</span></span> <span data-ttu-id="386ac-111">例如，在傳統水準配置中，拉丁文字和中文文字都是垂直方向。</span><span class="sxs-lookup"><span data-stu-id="386ac-111">For example, in traditional horizontal layout, both the Latin text and the Chinese text are oriented vertically.</span></span> <span data-ttu-id="386ac-112">另一方面，在垂直版面配置中，中文文字會保持直立，而拉丁文字會旋轉90度。</span><span class="sxs-lookup"><span data-stu-id="386ac-112">On the other hand, in a vertical layout, the Chinese text remains upright, and the Latin text is rotated 90 degrees.</span></span> <span data-ttu-id="386ac-113">此處的範例會顯示這項差異。</span><span class="sxs-lookup"><span data-stu-id="386ac-113">This difference in orientation is seen in the example here.</span></span>

![水準和垂直版面配置中的英文和中文文字影像。](images/vertical-text.png)

<span data-ttu-id="386ac-115">若要判斷您擁有的文字方向，您需要執行 [**IDWriteTextAnalysisSink1**](/windows/win32/api/dwrite_1/nn-dwrite_1-idwritetextanalysissink1) 和 [**IDWriteTextAnalysisSource1**](/windows/win32/api/dwrite_1/nn-dwrite_1-idwritetextanalysissource1) 介面。</span><span class="sxs-lookup"><span data-stu-id="386ac-115">To determine the orientation of the text you have, you need to implement the [**IDWriteTextAnalysisSink1**](/windows/win32/api/dwrite_1/nn-dwrite_1-idwritetextanalysissink1) and [**IDWriteTextAnalysisSource1**](/windows/win32/api/dwrite_1/nn-dwrite_1-idwritetextanalysissource1) interfaces.</span></span> <span data-ttu-id="386ac-116">來源和接收會接受圖像執行，並可讓您檢查它們是否為垂直方向。</span><span class="sxs-lookup"><span data-stu-id="386ac-116">The source and sink take in the glyph runs and let you check if they are oriented vertically or not.</span></span>

<span data-ttu-id="386ac-117">在您執行來源和接收器之後，請呼叫 [**AnalyzeVerticalGlyphOrientation**](/windows/win32/api/dwrite_1/nf-dwrite_1-idwritetextanalyzer1-analyzeverticalglyphorientation) 方法。</span><span class="sxs-lookup"><span data-stu-id="386ac-117">After you implement your source and sink, you call the [**AnalyzeVerticalGlyphOrientation**](/windows/win32/api/dwrite_1/nf-dwrite_1-idwritetextanalyzer1-analyzeverticalglyphorientation) method.</span></span> <span data-ttu-id="386ac-118">在範例影像中，此函式會傳回3個回合：「英文」、「中國」和「英文」。</span><span class="sxs-lookup"><span data-stu-id="386ac-118">In the example image, this function returns 3 runs: "English", "中国", and "English."</span></span>

## <a name="going-from-characters-to-glyphs"></a><span data-ttu-id="386ac-119">從字元到字元</span><span class="sxs-lookup"><span data-stu-id="386ac-119">Going from characters to glyphs</span></span>

<span data-ttu-id="386ac-120">現在您已經知道執行包含垂直圖像，您需要取得這些字元的存取權。</span><span class="sxs-lookup"><span data-stu-id="386ac-120">Now that you know the run contains vertical glyphs, you need to get access to those glyphs.</span></span> <span data-ttu-id="386ac-121">在目前為止的範例中，有3個執行：一個具有垂直圖像，另一個則沒有。</span><span class="sxs-lookup"><span data-stu-id="386ac-121">In the example so far, there are 3 runs: one with vertical glyphs and two without.</span></span> <span data-ttu-id="386ac-122">若要從字元轉換成字元，您可以呼叫 [**GetGlyphIndices**](/windows/win32/api/dwrite/nf-dwrite-idwritefontface-getglyphindices)。</span><span class="sxs-lookup"><span data-stu-id="386ac-122">To transition from characters to glyphs, you call [**GetGlyphIndices**](/windows/win32/api/dwrite/nf-dwrite-idwritefontface-getglyphindices).</span></span> <span data-ttu-id="386ac-123">這個方法會針對範例中的字元傳回對應的圖像索引。</span><span class="sxs-lookup"><span data-stu-id="386ac-123">This method returns the corresponding glyph indices for the characters in the example.</span></span> <span data-ttu-id="386ac-124">因為 [**AnalyzeVerticalGlyphOrientation**](/windows/win32/api/dwrite_1/nf-dwrite_1-idwritetextanalyzer1-analyzeverticalglyphorientation) 方法會傳回具有垂直字元的回合，所以您必須呼叫 [**GetVerticalGlyphVariants**](/windows/win32/api/dwrite_1/nf-dwrite_1-idwritefontface1-getverticalglyphvariants)，這會傳回垂直方向的圖像 id 以取代目前的圖像 id。</span><span class="sxs-lookup"><span data-stu-id="386ac-124">Because the [**AnalyzeVerticalGlyphOrientation**](/windows/win32/api/dwrite_1/nf-dwrite_1-idwritetextanalyzer1-analyzeverticalglyphorientation) method returns a run with vertical glyphs, you need to call [**GetVerticalGlyphVariants**](/windows/win32/api/dwrite_1/nf-dwrite_1-idwritefontface1-getverticalglyphvariants), which returns the vertically oriented glyph IDs in place of the current glyph IDs.</span></span>

## <a name="drawing-text-vertically"></a><span data-ttu-id="386ac-125">垂直繪製文字</span><span class="sxs-lookup"><span data-stu-id="386ac-125">Drawing text vertically</span></span>

<span data-ttu-id="386ac-126">最後，您需要配置和繪製文字。</span><span class="sxs-lookup"><span data-stu-id="386ac-126">Finally, you need to lay out and draw the text.</span></span> <span data-ttu-id="386ac-127">因為您是以垂直方式繪製文字，所以您需要取得一些資訊，才能正確地繪製拉丁文字。</span><span class="sxs-lookup"><span data-stu-id="386ac-127">Because you're drawing the text vertically, you need to get some more info so that the Latin text is drawn correctly.</span></span> <span data-ttu-id="386ac-128">如果您在中央基準中繪製所有文字，則會在該行中間以浮點數顯示拉丁文字。</span><span class="sxs-lookup"><span data-stu-id="386ac-128">If you draw all of the text along the central baseline, the Latin text appears to float in the middle of the line.</span></span> <span data-ttu-id="386ac-129">您需要存取中央和羅馬字基準才能正確對齊文字。</span><span class="sxs-lookup"><span data-stu-id="386ac-129">You need access to both the central and Roman baseline to align the text correctly.</span></span> <span data-ttu-id="386ac-130">使用 [**IDWriteTextAnalyzer1：： GetBaseline**](/windows/win32/api/dwrite_1/nf-dwrite_1-idwritetextanalyzer1-getbaseline) 方法，取得您指定之基準的數值。</span><span class="sxs-lookup"><span data-stu-id="386ac-130">Use the [**IDWriteTextAnalyzer1::GetBaseline**](/windows/win32/api/dwrite_1/nf-dwrite_1-idwritetextanalyzer1-getbaseline) method to get the numerical values of the baselines you specify.</span></span> <span data-ttu-id="386ac-131">您可以從中央基準減去羅馬字基準，以取得兩者之間的位移。</span><span class="sxs-lookup"><span data-stu-id="386ac-131">You can subtract the Roman baseline from the central baseline to get the offset between the two.</span></span>

<span data-ttu-id="386ac-132">使用這些資訊，您可以在螢幕上繪製文字。</span><span class="sxs-lookup"><span data-stu-id="386ac-132">With all this info, you can draw the text on the screen.</span></span> <span data-ttu-id="386ac-133">首先，使用 [**IDWriteTextAnalysisSink1**](/windows/win32/api/dwrite_1/nn-dwrite_1-idwritetextanalysissink1)和 [**IDWriteTextAnalysisSource1**](/windows/win32/api/dwrite_1/nn-dwrite_1-idwritetextanalysissource1)物件的結果來呼叫 [**GetGlyphOrientationTransform**](/windows/win32/api/dwrite_1/nf-dwrite_1-idwritetextanalyzer1-getglyphorientationtransform)方法。</span><span class="sxs-lookup"><span data-stu-id="386ac-133">First, call the [**GetGlyphOrientationTransform**](/windows/win32/api/dwrite_1/nf-dwrite_1-idwritetextanalyzer1-getglyphorientationtransform) method with the results from the [**IDWriteTextAnalysisSink1**](/windows/win32/api/dwrite_1/nn-dwrite_1-idwritetextanalysissink1) and [**IDWriteTextAnalysisSource1**](/windows/win32/api/dwrite_1/nn-dwrite_1-idwritetextanalysissource1) objects.</span></span>

<span data-ttu-id="386ac-134">如果您使用的是 [Direct2D](rendering-by-using-direct2d.md) ，也必須在 Direct2D 轉譯目標上設定「世界」轉換，以進行垂直轉譯。</span><span class="sxs-lookup"><span data-stu-id="386ac-134">If you’re using [Direct2D](rendering-by-using-direct2d.md) you also need to set the world transform on the Direct2D render target for vertical rendering.</span></span>

<span data-ttu-id="386ac-135">最後，呼叫 [**DrawGlyphRun**](/windows/win32/api/dwrite/nf-dwrite-idwritebitmaprendertarget-drawglyphrun) 三次，在每個文字區塊上呼叫一次。</span><span class="sxs-lookup"><span data-stu-id="386ac-135">Finally, call [**DrawGlyphRun**](/windows/win32/api/dwrite/nf-dwrite-idwritebitmaprendertarget-drawglyphrun) three times, once on each block of text.</span></span> <span data-ttu-id="386ac-136">在兩個英文的文字區塊上，您必須套用在羅馬和 central 基準之間計算的位移。</span><span class="sxs-lookup"><span data-stu-id="386ac-136">On the two blocks of text that are in English, you need to apply the offset that we calculated between the Roman and central baselines.</span></span>

<span data-ttu-id="386ac-137">現在，您應用程式中的文字會以正確的字元方向垂直繪製。</span><span class="sxs-lookup"><span data-stu-id="386ac-137">Now, the text in your app will be drawn vertically, with the correct glyph orientation.</span></span>

 

 