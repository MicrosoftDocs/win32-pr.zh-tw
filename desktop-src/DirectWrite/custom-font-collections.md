---
title: " (Windows 7/8) 的自訂字型集合"
description: DirectWrite 可讓您使用 IDWriteFactory GetSystemFontCollection 方法存取系統字型集合。
ms.assetid: ec892904-6778-4fbd-93b4-62d0db5b82ea
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 39aa764330f27b72051ef682c6ce5f1176c42c7d
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/20/2020
ms.locfileid: "103682703"
---
# <a name="custom-font-collections-windows-78"></a><span data-ttu-id="f451c-103"> (Windows 7/8) 的自訂字型集合</span><span class="sxs-lookup"><span data-stu-id="f451c-103">Custom Font Collections (Windows 7/8)</span></span>

<span data-ttu-id="f451c-104">[DirectWrite](direct-write-portal.md) 會使用 [**IDWriteFactory：： GetSystemFontCollection**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-getsystemfontcollection) 方法，提供系統字型集合的存取權。</span><span class="sxs-lookup"><span data-stu-id="f451c-104">[DirectWrite](direct-write-portal.md) provides access to the system font collection by using the [**IDWriteFactory::GetSystemFontCollection**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-getsystemfontcollection) method.</span></span> <span data-ttu-id="f451c-105">這是最常使用的字型集合。</span><span class="sxs-lookup"><span data-stu-id="f451c-105">This is the font collection that is most frequently used.</span></span> <span data-ttu-id="f451c-106">不過，有些應用程式必須使用系統上未安裝的字型，例如從包含的字型檔案或內嵌于應用程式中的字型檔案。</span><span class="sxs-lookup"><span data-stu-id="f451c-106">However some applications have to use fonts that are not installed on the system, such as from included font files or font files embedded in the application.</span></span>

<span data-ttu-id="f451c-107">如果您想要的字型不在系統字型集合中，您可以建立衍生自 [**IDWriteFontCollection**](/windows/win32/api/dwrite/nn-dwrite-idwritefontcollection)的自訂字型集合。</span><span class="sxs-lookup"><span data-stu-id="f451c-107">If the fonts that you want are not in the system font collection, you can create a custom font collection derived from [**IDWriteFontCollection**](/windows/win32/api/dwrite/nn-dwrite-idwritefontcollection).</span></span>

<span data-ttu-id="f451c-108">此總覽包含下列部分：</span><span class="sxs-lookup"><span data-stu-id="f451c-108">This overview consists of the following parts:</span></span>

-   [<span data-ttu-id="f451c-109">註冊和取消註冊字型集合載入器</span><span class="sxs-lookup"><span data-stu-id="f451c-109">Registering and unregistering a Font Collection Loader</span></span>](#registering-and-unregistering-a-font-collection-loader)
-   [<span data-ttu-id="f451c-110">IDWriteFontCollectionLoader</span><span class="sxs-lookup"><span data-stu-id="f451c-110">IDWriteFontCollectionLoader</span></span>](#idwritefontcollectionloader)
-   [<span data-ttu-id="f451c-111">IDWriteFontFileEnumerator</span><span class="sxs-lookup"><span data-stu-id="f451c-111">IDWriteFontFileEnumerator</span></span>](#idwritefontfileenumerator)
-   [<span data-ttu-id="f451c-112">CreateCustomFontFileReference</span><span class="sxs-lookup"><span data-stu-id="f451c-112">CreateCustomFontFileReference</span></span>](#createcustomfontfilereference)
-   [<span data-ttu-id="f451c-113">IDWriteFontFileLoader</span><span class="sxs-lookup"><span data-stu-id="f451c-113">IDWriteFontFileLoader</span></span>](#idwritefontfileloader)
-   [<span data-ttu-id="f451c-114">IDWriteFontFileStream</span><span class="sxs-lookup"><span data-stu-id="f451c-114">IDWriteFontFileStream</span></span>](#idwritefontfilestream)

## <a name="registering-and-unregistering-a-font-collection-loader"></a><span data-ttu-id="f451c-115">註冊和取消註冊字型集合載入器</span><span class="sxs-lookup"><span data-stu-id="f451c-115">Registering and unregistering a Font Collection Loader</span></span>

<span data-ttu-id="f451c-116">您可以使用 [**IDWriteFactory：： RegisterFontCollectionLoader**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-registerfontcollectionloader) 方法來註冊字型集合載入器，並將應用程式實作為單一物件的 [**IDWriteFontCollectionLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontcollectionloader) 介面傳遞給它。</span><span class="sxs-lookup"><span data-stu-id="f451c-116">You register a font collection loader by using the [**IDWriteFactory::RegisterFontCollectionLoader**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-registerfontcollectionloader) method and passing it an [**IDWriteFontCollectionLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontcollectionloader) interface implemented by the application as a singleton object.</span></span> <span data-ttu-id="f451c-117">當要求自訂集合時，這個物件會載入字型。</span><span class="sxs-lookup"><span data-stu-id="f451c-117">This object will load the fonts when the custom collection is requested.</span></span> <span data-ttu-id="f451c-118">系統字型集合和自訂字型集合都會進行快取，因此只會載入一次字型。</span><span class="sxs-lookup"><span data-stu-id="f451c-118">Both the system font collection and custom font collections are cached, so the fonts are only loaded one time.</span></span>

<span data-ttu-id="f451c-119">字型集合載入器最後必須使用 [**IDWriteFactory：： UnregisterFontCollectionLoader**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-unregisterfontcollectionloader)卸載。</span><span class="sxs-lookup"><span data-stu-id="f451c-119">The font collection loader must be unloaded eventually by using the [**IDWriteFactory::UnregisterFontCollectionLoader**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-unregisterfontcollectionloader).</span></span>

> [!Note]  
> <span data-ttu-id="f451c-120">註冊字型集合載入器會新增至參考計數;請勿從函式內呼叫 [**UnregisterFontCollectionLoader**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-unregisterfontcollectionloader) ，否則將永遠不會取消註冊集合載入器物件。</span><span class="sxs-lookup"><span data-stu-id="f451c-120">Registering the font collection loader adds to the reference count; do not call [**UnregisterFontCollectionLoader**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-unregisterfontcollectionloader) from within the destructor or the collection loader object will never be unregistered.</span></span>

 

## <a name="idwritefontcollectionloader"></a><span data-ttu-id="f451c-121">IDWriteFontCollectionLoader</span><span class="sxs-lookup"><span data-stu-id="f451c-121">IDWriteFontCollectionLoader</span></span>

<span data-ttu-id="f451c-122">您可以使用 [**IDWriteFactory：： CreateCustomFontCollection**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontcollection)建立 [**IDWriteFontFileEnumerator**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileenumerator)物件，並將它傳遞至應用程式定義的索引鍵。</span><span class="sxs-lookup"><span data-stu-id="f451c-122">You create an [**IDWriteFontFileEnumerator**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileenumerator) object by using the [**IDWriteFactory::CreateCustomFontCollection**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontcollection) and passing it an application-defined key.</span></span> <span data-ttu-id="f451c-123">索引鍵是 void 指標，而資料類型、格式和意義是由應用程式所定義，而且對字型系統而言是不透明的。</span><span class="sxs-lookup"><span data-stu-id="f451c-123">The key is a void pointer and the data type, format, and meaning are defined by the application and are opaque to the font system.</span></span>

<span data-ttu-id="f451c-124">雖然索引鍵可以是任何內容，但 [DirectWrite](direct-write-portal.md) 需要每個金鑰都是：</span><span class="sxs-lookup"><span data-stu-id="f451c-124">Whereas the key can be anything, [DirectWrite](direct-write-portal.md) requires that each key is both:</span></span>

-   <span data-ttu-id="f451c-125">在載入器範圍內的單一字型集合中是唯一的。</span><span class="sxs-lookup"><span data-stu-id="f451c-125">Unique to a single font collection within the scope of the loader.</span></span>
-   <span data-ttu-id="f451c-126">在使用 factory 取消註冊載入器之前有效。</span><span class="sxs-lookup"><span data-stu-id="f451c-126">Valid until the loader is unregistered using the factory.</span></span>

<span data-ttu-id="f451c-127">呼叫 [**CreateCustomFontCollection**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontcollection) 方法時， [DirectWrite](direct-write-portal.md) 會呼叫回 [**IDWriteFontCollectionLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontcollectionloader) 介面，應用程式會將它實作為單一物件。</span><span class="sxs-lookup"><span data-stu-id="f451c-127">When the [**CreateCustomFontCollection**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontcollection) method is called, [DirectWrite](direct-write-portal.md) calls back to an [**IDWriteFontCollectionLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontcollectionloader) interface implemented as a singleton object by the application.</span></span> <span data-ttu-id="f451c-128">[**IDWriteFontCollectionLoader：： CreateEnumeratorFromKey**](/windows/win32/api/dwrite/nf-dwrite-idwritefontcollectionloader-createenumeratorfromkey)回呼方法是由 DirectWrite 用來取出應用程式所執行的 [**IDWriteFontFileEnumerator**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileenumerator)物件。</span><span class="sxs-lookup"><span data-stu-id="f451c-128">The [**IDWriteFontCollectionLoader::CreateEnumeratorFromKey**](/windows/win32/api/dwrite/nf-dwrite-idwritefontcollectionloader-createenumeratorfromkey) callback method is used by DirectWrite to retrieve an [**IDWriteFontFileEnumerator**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileenumerator) object implemented by the application.</span></span> <span data-ttu-id="f451c-129">用來建立集合的 [**IDWriteFactory**](/windows/win32/api/dwrite/nn-dwrite-idwritefactory) 物件會傳遞給這個方法，且應該由字型檔案列舉值用來建立要包含在集合中的 [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) 物件。</span><span class="sxs-lookup"><span data-stu-id="f451c-129">The [**IDWriteFactory**](/windows/win32/api/dwrite/nn-dwrite-idwritefactory) object that is being used to create the collection is passed to this method and should be used by the font file enumerator to create the [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) objects to be included in the collection.</span></span>

<span data-ttu-id="f451c-130">傳遞給這個方法的金鑰會識別字型集合，而且是傳遞給 [**CreateCustomFontCollection**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontcollection)的相同索引鍵。</span><span class="sxs-lookup"><span data-stu-id="f451c-130">The key passed to this method identifies the font collection and is the same key passed to [**CreateCustomFontCollection**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontcollection).</span></span>

## <a name="idwritefontfileenumerator"></a><span data-ttu-id="f451c-131">IDWriteFontFileEnumerator</span><span class="sxs-lookup"><span data-stu-id="f451c-131">IDWriteFontFileEnumerator</span></span>

<span data-ttu-id="f451c-132">[**CreateEnumeratorFromKey**](/windows/win32/api/dwrite/nf-dwrite-idwritefontcollectionloader-createenumeratorfromkey)方法所建立的應用程式定義 [**IDWriteFontFileEnumerator**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileenumerator)物件是用來列舉集合中的字型檔案，為每個檔案建立 [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile)物件。</span><span class="sxs-lookup"><span data-stu-id="f451c-132">The application-defined [**IDWriteFontFileEnumerator**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileenumerator) object that was created by the [**CreateEnumeratorFromKey**](/windows/win32/api/dwrite/nf-dwrite-idwritefontcollectionloader-createenumeratorfromkey) method is used to enumerate the font files in a collection, creating an [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) object for each file.</span></span> <span data-ttu-id="f451c-133">[**IDWriteFontFileEnumerator：： MoveNext**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileenumerator-movenext)方法會將位置變更為下一個字型檔案。</span><span class="sxs-lookup"><span data-stu-id="f451c-133">The [**IDWriteFontFileEnumerator::MoveNext**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileenumerator-movenext) method changes the position to the next font file.</span></span> <span data-ttu-id="f451c-134">如果位置有檔案，則會將 *hasCurrentFile* 設為 **TRUE**。</span><span class="sxs-lookup"><span data-stu-id="f451c-134">If there is a file at the position, it will set the *hasCurrentFile* to **TRUE**.</span></span> <span data-ttu-id="f451c-135">否則，它會設為 **FALSE** ，而且方法會傳回 **S \_ OK**。</span><span class="sxs-lookup"><span data-stu-id="f451c-135">Otherwise it will be set to **FALSE** and the method will return **S\_OK**.</span></span>

> [!Note]  
> <span data-ttu-id="f451c-136">字型檔案列舉值的開頭必須是在第一個元素之前，並在第一次呼叫 [**MoveNext**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileenumerator-movenext)時開始。</span><span class="sxs-lookup"><span data-stu-id="f451c-136">The font file enumerator must start positioned before the first element and advanced at the first call to [**MoveNext**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileenumerator-movenext).</span></span>

 

<span data-ttu-id="f451c-137">[**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile)物件是由 [**IDWriteFontFileEnumerator：： GetCurrentFontFile**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileenumerator-getcurrentfontfile)方法輸出。</span><span class="sxs-lookup"><span data-stu-id="f451c-137">An [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) object is output by the [**IDWriteFontFileEnumerator::GetCurrentFontFile**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileenumerator-getcurrentfontfile) method.</span></span> <span data-ttu-id="f451c-138">如果目前位置沒有字型檔案，因為 [**MoveNext**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileenumerator-movenext) 尚未呼叫或 hasCurrentFile 設定為 **FALSE**，則 **GetCurrentFontFile** 會傳回 **E \_ 失敗**。</span><span class="sxs-lookup"><span data-stu-id="f451c-138">If there is no font file at the current position, because [**MoveNext**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileenumerator-movenext) has not yet been called or hasCurrentFile was set to **FALSE**, then **GetCurrentFontFile** will return **E\_FAIL**.</span></span>

## <a name="createcustomfontfilereference"></a><span data-ttu-id="f451c-139">CreateCustomFontFileReference</span><span class="sxs-lookup"><span data-stu-id="f451c-139">CreateCustomFontFileReference</span></span>

<span data-ttu-id="f451c-140">藉由呼叫 [**IDWriteFactory：： CreateCustomFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontfilereference)，即可建立 [**GetCurrentFontFile**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileenumerator-getcurrentfontfile)的 [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile)物件輸出。</span><span class="sxs-lookup"><span data-stu-id="f451c-140">The [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) object output by [**GetCurrentFontFile**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileenumerator-getcurrentfontfile) can be created by calling [**IDWriteFactory::CreateCustomFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontfilereference).</span></span> <span data-ttu-id="f451c-141">字型檔案參考索引鍵會識別特定的字型檔案參考，且在載入檔案的字型檔案載入器中必須是唯一的。</span><span class="sxs-lookup"><span data-stu-id="f451c-141">The font file reference key identifies a specific font file reference and must be unique within the font file loader that will load the file.</span></span>

## <a name="idwritefontfileloader"></a><span data-ttu-id="f451c-142">IDWriteFontFileLoader</span><span class="sxs-lookup"><span data-stu-id="f451c-142">IDWriteFontFileLoader</span></span>

<span data-ttu-id="f451c-143">[**CreateCustomFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontfilereference)方法會採用應用程式所執行的 [**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader)物件，此物件是用來載入字型。</span><span class="sxs-lookup"><span data-stu-id="f451c-143">The [**CreateCustomFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontfilereference) method takes an [**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader) object implemented by the application that is used to load the font.</span></span> <span data-ttu-id="f451c-144">[**IDWriteFontFileLoader：： CreateStreamFromKey**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileloader-createstreamfromkey)回呼方法會傳遞金鑰，並輸出 [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream)物件。</span><span class="sxs-lookup"><span data-stu-id="f451c-144">The [**IDWriteFontFileLoader::CreateStreamFromKey**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileloader-createstreamfromkey) callback method is passed the key and outputs an [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) object.</span></span>

## <a name="idwritefontfilestream"></a><span data-ttu-id="f451c-145">IDWriteFontFileStream</span><span class="sxs-lookup"><span data-stu-id="f451c-145">IDWriteFontFileStream</span></span>

<span data-ttu-id="f451c-146">應用程式所執行的 [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) 物件會從自訂字型檔案載入器提供字型檔案參考的字型檔案資料。</span><span class="sxs-lookup"><span data-stu-id="f451c-146">The application-implemented [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) object provides the font file data for a font file reference from a custom font file loader.</span></span> <span data-ttu-id="f451c-147">除了檔案大小和上次寫入時間，它也提供方法 ([**ReadFileFragment**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfilestream-readfilefragment)) ，以抓取要編譯成 [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) 物件的檔案片段。</span><span class="sxs-lookup"><span data-stu-id="f451c-147">Together with the file size and last write time, it provides a method ([**ReadFileFragment**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfilestream-readfilefragment)) for retrieving file fragments that are to be compiled into an [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) object.</span></span>

> [!Note]  
> <span data-ttu-id="f451c-148">如果要求的片段超出檔案範圍， [**ReadFileFragment**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfilestream-readfilefragment)的執行應該會傳回錯誤。</span><span class="sxs-lookup"><span data-stu-id="f451c-148">[**ReadFileFragment**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfilestream-readfilefragment) implementations should return an error if the requested fragment is outside the file bounds.</span></span>

 

<span data-ttu-id="f451c-149">[**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream)可以從任何地方取得字型檔案內容，例如本機硬碟或內嵌的資源。</span><span class="sxs-lookup"><span data-stu-id="f451c-149">An [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) can get the font file contents from anywhere, such as the local hard disk drive, or embedded resources.</span></span>

 

 