---
description: 當 CreateThread 或 CreateRemoteThread 函數建立新的執行緒時，就會傳回該執行緒的控制碼。
ms.assetid: ff91fe27-9773-4185-bc1e-57e897be3821
title: 執行緒控制碼和識別碼
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 501d449bdb34d158ad14e52409967d4ef17f62f3
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "103849259"
---
# <a name="thread-handles-and-identifiers"></a><span data-ttu-id="5a974-103">執行緒控制碼和識別碼</span><span class="sxs-lookup"><span data-stu-id="5a974-103">Thread Handles and Identifiers</span></span>

<span data-ttu-id="5a974-104">當 [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread) 或 [**CreateRemoteThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread) 函數建立新的執行緒時，就會傳回該執行緒的控制碼。</span><span class="sxs-lookup"><span data-stu-id="5a974-104">When a new thread is created by the [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread) or [**CreateRemoteThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread) function, a handle to the thread is returned.</span></span> <span data-ttu-id="5a974-105">根據預設，這個控制碼具有完整存取權限，而且受限於安全性存取檢查，可用於任何接受執行緒控制碼的函式。</span><span class="sxs-lookup"><span data-stu-id="5a974-105">By default, this handle has full access rights, and—subject to security access checking—can be used in any of the functions that accept a thread handle.</span></span> <span data-ttu-id="5a974-106">這個控制碼可由子進程繼承，視建立時指定的繼承旗標而定。</span><span class="sxs-lookup"><span data-stu-id="5a974-106">This handle can be inherited by child processes, depending on the inheritance flag specified when it is created.</span></span> <span data-ttu-id="5a974-107">此控制碼可由 [**DuplicateHandle**](/windows/win32/api/handleapi/nf-handleapi-duplicatehandle)複製，可讓您建立具有存取權限子集的執行緒控制碼。</span><span class="sxs-lookup"><span data-stu-id="5a974-107">The handle can be duplicated by [**DuplicateHandle**](/windows/win32/api/handleapi/nf-handleapi-duplicatehandle), which enables you to create a thread handle with a subset of the access rights.</span></span> <span data-ttu-id="5a974-108">控制碼在關閉之前是有效的，即使在其代表的執行緒終止之後也是如此。</span><span class="sxs-lookup"><span data-stu-id="5a974-108">The handle is valid until closed, even after the thread it represents has been terminated.</span></span>

<span data-ttu-id="5a974-109">[**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread)和 [**CreateRemoteThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread)函式也會傳回可唯一識別整個系統中之執行緒的識別碼。</span><span class="sxs-lookup"><span data-stu-id="5a974-109">The [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread) and [**CreateRemoteThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread) functions also return an identifier that uniquely identifies the thread throughout the system.</span></span> <span data-ttu-id="5a974-110">執行緒可以使用 [**GetCurrentThreadId**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getcurrentthreadid) 函數來取得自己的執行緒識別碼。</span><span class="sxs-lookup"><span data-stu-id="5a974-110">A thread can use the [**GetCurrentThreadId**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getcurrentthreadid) function to get its own thread identifier.</span></span> <span data-ttu-id="5a974-111">線上程終止之前，識別碼會從建立執行緒的時間起有效。</span><span class="sxs-lookup"><span data-stu-id="5a974-111">The identifiers are valid from the time the thread is created until the thread has been terminated.</span></span> <span data-ttu-id="5a974-112">請注意，任何執行緒識別碼都不會是0。</span><span class="sxs-lookup"><span data-stu-id="5a974-112">Note that no thread identifier will ever be 0.</span></span>

<span data-ttu-id="5a974-113">如果您有線程識別碼，您可以藉由呼叫 [**OpenThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-openthread) 函數來取得執行緒控制碼。</span><span class="sxs-lookup"><span data-stu-id="5a974-113">If you have a thread identifier, you can get the thread handle by calling the [**OpenThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-openthread) function.</span></span> <span data-ttu-id="5a974-114">**OpenThread** 可讓您指定控制碼的存取權限，以及是否可以繼承。</span><span class="sxs-lookup"><span data-stu-id="5a974-114">**OpenThread** enables you to specify the handle's access rights and whether it can be inherited.</span></span>

<span data-ttu-id="5a974-115">執行緒可以使用 [**GetCurrentThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getcurrentthread) 函式，將 *虛擬控制碼* 取出至本身的執行緒物件。</span><span class="sxs-lookup"><span data-stu-id="5a974-115">A thread can use the [**GetCurrentThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getcurrentthread) function to retrieve a *pseudo handle* to its own thread object.</span></span> <span data-ttu-id="5a974-116">這個虛擬控制碼只對呼叫進程有效;它無法被繼承或複製以供其他進程使用。</span><span class="sxs-lookup"><span data-stu-id="5a974-116">This pseudo handle is valid only for the calling process; it cannot be inherited or duplicated for use by other processes.</span></span> <span data-ttu-id="5a974-117">若要取得執行緒的實際控制碼，請在給定虛擬控制碼的情況下，使用 [**DuplicateHandle**](/windows/win32/api/handleapi/nf-handleapi-duplicatehandle) 函數。</span><span class="sxs-lookup"><span data-stu-id="5a974-117">To get the real handle to the thread, given a pseudo handle, use the [**DuplicateHandle**](/windows/win32/api/handleapi/nf-handleapi-duplicatehandle) function.</span></span>

<span data-ttu-id="5a974-118">若要列舉進程的執行緒，請使用 [**Thread32First**](/windows/win32/api/tlhelp32/nf-tlhelp32-thread32first) 和 [**Thread32Next**](/windows/win32/api/tlhelp32/nf-tlhelp32-thread32next) 函數。</span><span class="sxs-lookup"><span data-stu-id="5a974-118">To enumerate the threads of a process, use the [**Thread32First**](/windows/win32/api/tlhelp32/nf-tlhelp32-thread32first) and [**Thread32Next**](/windows/win32/api/tlhelp32/nf-tlhelp32-thread32next) functions.</span></span>

 

 
