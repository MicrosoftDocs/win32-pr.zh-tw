---
description: 64位版本的 Windows 7 和 Windows Server 2008 R2 和更新版本的 Windows 在單一電腦上支援超過64個邏輯處理器。 這項功能不適用於32位版本的 Windows。
ms.assetid: c627ac0f-96e8-48b5-9103-4316f487e173
title: 處理器群組
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cebc5b9ab1b386847b6561a9f6322c2fca0e2ae5
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104026746"
---
# <a name="processor-groups"></a><span data-ttu-id="4adfb-104">處理器群組</span><span class="sxs-lookup"><span data-stu-id="4adfb-104">Processor Groups</span></span>

<span data-ttu-id="4adfb-105">64位版本的 Windows 7 和 Windows Server 2008 R2 和更新版本的 Windows 在單一電腦上支援超過64個邏輯處理器。</span><span class="sxs-lookup"><span data-stu-id="4adfb-105">The 64-bit versions of Windows 7 and Windows Server 2008 R2 and later versions of Windows support more than 64 logical processors on a single computer.</span></span> <span data-ttu-id="4adfb-106">這項功能不適用於32位版本的 Windows。</span><span class="sxs-lookup"><span data-stu-id="4adfb-106">This functionality is not available on 32-bit versions of Windows.</span></span>

<span data-ttu-id="4adfb-107">具有多個實體處理器的系統，或具有多個核心之實體處理器的系統，會提供具有多個邏輯處理器的作業系統。</span><span class="sxs-lookup"><span data-stu-id="4adfb-107">Systems with more than one physical processor or systems with physical processors that have multiple cores provide the operating system with multiple logical processors.</span></span> <span data-ttu-id="4adfb-108">*邏輯處理器* 是從作業系統、應用程式或驅動程式的角度來看，一個邏輯運算引擎。</span><span class="sxs-lookup"><span data-stu-id="4adfb-108">A *logical processor* is one logical computing engine from the perspective of the operating system, application or driver.</span></span> <span data-ttu-id="4adfb-109">*核心* 是一個處理器單位，可包含一或多個邏輯處理器。</span><span class="sxs-lookup"><span data-stu-id="4adfb-109">A *core* is one processor unit, which can consist of one or more logical processors.</span></span> <span data-ttu-id="4adfb-110">*實體處理器* 可以包含一或多個核心。</span><span class="sxs-lookup"><span data-stu-id="4adfb-110">A *physical processor* can consist of one or more cores.</span></span> <span data-ttu-id="4adfb-111">實體處理器與處理器套件、通訊端或 CPU 相同。</span><span class="sxs-lookup"><span data-stu-id="4adfb-111">A physical processor is the same as a processor package, a socket, or a CPU.</span></span>

<span data-ttu-id="4adfb-112">支援具有超過64個邏輯處理器的系統，是以 *處理器群組* 的概念為基礎，這是一組最多64個邏輯處理器的靜態集合，可視為單一排程實體。</span><span class="sxs-lookup"><span data-stu-id="4adfb-112">Support for systems that have more than 64 logical processors is based on the concept of a *processor group*, which is a static set of up to 64 logical processors that is treated as a single scheduling entity.</span></span> <span data-ttu-id="4adfb-113">處理器群組的編號是從0開始。</span><span class="sxs-lookup"><span data-stu-id="4adfb-113">Processor groups are numbered starting with 0.</span></span> <span data-ttu-id="4adfb-114">具有少於64個邏輯處理器的系統一律會有單一群組（群組0）。</span><span class="sxs-lookup"><span data-stu-id="4adfb-114">Systems with fewer than 64 logical processors always have a single group, Group 0.</span></span>

<span data-ttu-id="4adfb-115">**Windows server 2008、Windows Vista、Windows server 2003 和 WINDOWS XP：** 不支援處理器群組。</span><span class="sxs-lookup"><span data-stu-id="4adfb-115">**Windows Server 2008, Windows Vista, Windows Server 2003 and Windows XP:** Processor groups are not supported.</span></span>

<span data-ttu-id="4adfb-116">當系統啟動時，作業系統會建立處理器群組，並將邏輯處理器指派給群組。</span><span class="sxs-lookup"><span data-stu-id="4adfb-116">When the system starts, the operating system creates processor groups and assigns logical processors to the groups.</span></span> <span data-ttu-id="4adfb-117">如果系統能夠熱新增處理器，作業系統會允許系統在執行時可能抵達的處理器群組中的空間。</span><span class="sxs-lookup"><span data-stu-id="4adfb-117">If the system is capable of hot-adding processors, the operating system allows space in groups for processors that might arrive while the system is running.</span></span> <span data-ttu-id="4adfb-118">作業系統會將系統中的群組數目降至最低。</span><span class="sxs-lookup"><span data-stu-id="4adfb-118">The operating system minimizes the number of groups in a system.</span></span> <span data-ttu-id="4adfb-119">例如，具有128邏輯處理器的系統會在每個群組中有兩個具有64處理器的處理器群組，而不是每個群組中有32個邏輯處理器的四個群組。</span><span class="sxs-lookup"><span data-stu-id="4adfb-119">For example, a system with 128 logical processors would have two processor groups with 64 processors in each group, not four groups with 32 logical processors in each group.</span></span>

<span data-ttu-id="4adfb-120">為了達到較佳的效能，作業系統會在將邏輯處理器指派給群組時，將實體位置列入考慮。</span><span class="sxs-lookup"><span data-stu-id="4adfb-120">For better performance, the operating system takes physical locality into account when assigning logical processors to groups.</span></span> <span data-ttu-id="4adfb-121">核心中的所有邏輯處理器，以及實體處理器中的所有核心，會盡可能指派給相同的群組。</span><span class="sxs-lookup"><span data-stu-id="4adfb-121">All of the logical processors in a core, and all of the cores in a physical processor, are assigned to the same group, if possible.</span></span> <span data-ttu-id="4adfb-122">實際接近另一個的實體處理器會指派給相同的群組。</span><span class="sxs-lookup"><span data-stu-id="4adfb-122">Physical processors that are physically close to one another are assigned to the same group.</span></span> <span data-ttu-id="4adfb-123">除非節點的容量超過群組大小上限，否則 NUMA 節點會指派給單一群組。</span><span class="sxs-lookup"><span data-stu-id="4adfb-123">A NUMA node is assigned to a single group unless the capacity of the node exceeds the maximum group size.</span></span> <span data-ttu-id="4adfb-124">如需詳細資訊，請參閱 [NUMA 支援](numa-support.md)。</span><span class="sxs-lookup"><span data-stu-id="4adfb-124">For more information, see [NUMA Support](numa-support.md).</span></span>

<span data-ttu-id="4adfb-125">在具有64或更少處理器的系統上，現有的應用程式不需要修改就能正常運作。</span><span class="sxs-lookup"><span data-stu-id="4adfb-125">On systems with 64 or fewer processors, existing applications will operate correctly without modification.</span></span> <span data-ttu-id="4adfb-126">未呼叫任何使用處理器親和性遮罩或處理器號碼之函式的應用程式，在所有系統上都能正常運作，不論處理器數目為何。</span><span class="sxs-lookup"><span data-stu-id="4adfb-126">Applications that do not call any functions that use processor affinity masks or processor numbers will operate correctly on all systems, regardless of the number of processors.</span></span> <span data-ttu-id="4adfb-127">若要在具有超過64個邏輯處理器的系統上正常運作，下列類型的應用程式可能需要修改：</span><span class="sxs-lookup"><span data-stu-id="4adfb-127">To operate correctly on systems with more than 64 logical processors, the following kinds of applications might require modification:</span></span>

-   <span data-ttu-id="4adfb-128">針對整個系統管理、維護或顯示每個處理器資訊的應用程式，必須修改為支援64個以上的邏輯處理器。</span><span class="sxs-lookup"><span data-stu-id="4adfb-128">Applications that manage, maintain, or display per-processor information for the entire system must be modified to support more than 64 logical processors.</span></span> <span data-ttu-id="4adfb-129">這類應用程式的其中一個範例是 Windows 工作管理員，它會顯示系統中每個處理器的工作負載。</span><span class="sxs-lookup"><span data-stu-id="4adfb-129">An example of such an application is Windows Task Manager, which displays the workload of each processor in the system.</span></span>
-   <span data-ttu-id="4adfb-130">效能很重要且可以有效率地擴充超過64個邏輯處理器的應用程式，必須經過修改才能在這類系統上執行。</span><span class="sxs-lookup"><span data-stu-id="4adfb-130">Applications for which performance is critical and that can scale efficiently beyond 64 logical processors must be modified to run on such systems.</span></span> <span data-ttu-id="4adfb-131">例如，資料庫應用程式可能會受益于修改。</span><span class="sxs-lookup"><span data-stu-id="4adfb-131">For example, database applications might benefit from modifications.</span></span>
-   <span data-ttu-id="4adfb-132">如果應用程式使用的 DLL 具有每一處理器的資料結構，而且 DLL 尚未修改為支援超過64個邏輯處理器，則應用程式中呼叫 DLL 所匯出之函式的所有線程都必須指派給相同的群組。</span><span class="sxs-lookup"><span data-stu-id="4adfb-132">If an application uses a DLL that has per-processor data structures, and the DLL has not been modified to support more than 64 logical processors, all threads in the application that call functions exported by the DLL must be assigned to the same group.</span></span>

<span data-ttu-id="4adfb-133">根據預設，應用程式會限制為單一群組，這應該為一般應用程式提供充足的處理功能。</span><span class="sxs-lookup"><span data-stu-id="4adfb-133">By default, an application is constrained to a single group, which should provide ample processing capability for the typical application.</span></span> <span data-ttu-id="4adfb-134">作業系統一開始會以迴圈配置資源方式，將每個進程指派給系統中的各個群組。</span><span class="sxs-lookup"><span data-stu-id="4adfb-134">The operating system initially assigns each process to a single group in a round-robin manner across the groups in the system.</span></span> <span data-ttu-id="4adfb-135">進程會開始執行指派給一個群組的作業。</span><span class="sxs-lookup"><span data-stu-id="4adfb-135">A process begins its execution assigned to one group.</span></span> <span data-ttu-id="4adfb-136">進程的第一個執行緒最初是在指派進程的群組中執行。</span><span class="sxs-lookup"><span data-stu-id="4adfb-136">The first thread of a process initially runs in the group to which the process is assigned.</span></span> <span data-ttu-id="4adfb-137">每個新建立的執行緒會指派給建立它的執行緒相同的群組。</span><span class="sxs-lookup"><span data-stu-id="4adfb-137">Each newly created thread is assigned to the same group as the thread that created it.</span></span>

<span data-ttu-id="4adfb-138">需要使用多個群組才能在64以上的處理器上執行的應用程式，必須明確地判斷要在哪裡執行其執行緒，並負責將執行緒的處理器親和性設定為所需的群組。</span><span class="sxs-lookup"><span data-stu-id="4adfb-138">An application that requires the use of multiple groups so that it can run on more than 64 processors must explicitly determine where to run its threads and is responsible for setting the threads' processor affinities to the desired groups.</span></span> <span data-ttu-id="4adfb-139">「 [繼承 \_ 父項 \_ 親和性](process-creation-flags.md) 」旗標可以用來指定父進程 (這可以與目前的進程) 不同，以產生新進程的親和性。</span><span class="sxs-lookup"><span data-stu-id="4adfb-139">The [INHERIT\_PARENT\_AFFINITY](process-creation-flags.md) flag can be used to specify a parent process (which can be different than the current process) from which to generate the affinity for a new process.</span></span> <span data-ttu-id="4adfb-140">如果處理常式是在單一群組中執行，它可以使用 [**GetProcessAffinityMask**](/windows/desktop/api/WinBase/nf-winbase-getprocessaffinitymask) 和 [**SetProcessAffinityMask**](/windows/desktop/api/WinBase/nf-winbase-setprocessaffinitymask) 來讀取和修改其親和性，同時在相同的群組中剩餘;如果已修改進程親和性，則新的親和性會套用至其執行緒。</span><span class="sxs-lookup"><span data-stu-id="4adfb-140">If the process is running in a single group, it can read and modify its affinity using [**GetProcessAffinityMask**](/windows/desktop/api/WinBase/nf-winbase-getprocessaffinitymask) and [**SetProcessAffinityMask**](/windows/desktop/api/WinBase/nf-winbase-setprocessaffinitymask) while remaining in the same group; if the process affinity is modified, the new affinity is applied to its threads.</span></span>

<span data-ttu-id="4adfb-141">執行緒的親和性可以在建立時指定，其方式是使用 [**PROC \_ 執行緒 \_ 屬性 \_ 群組 \_ 親和性**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-updateprocthreadattribute) 擴充屬性搭配 [**CreateRemoteThreadEx**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethreadex) 函數。</span><span class="sxs-lookup"><span data-stu-id="4adfb-141">A thread's affinity can be specified at creation using the [**PROC\_THREAD\_ATTRIBUTE\_GROUP\_AFFINITY**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-updateprocthreadattribute) extended attribute with the [**CreateRemoteThreadEx**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethreadex) function.</span></span> <span data-ttu-id="4adfb-142">建立執行緒之後，您可以藉由呼叫 [**SetThreadAffinityMask**](/windows/desktop/api/WinBase/nf-winbase-setthreadaffinitymask) 或 [**SetThreadGroupAffinity**](/windows/win32/api/processtopologyapi/nf-processtopologyapi-setthreadgroupaffinity)來變更其相似性。</span><span class="sxs-lookup"><span data-stu-id="4adfb-142">After the thread is created, its affinity can be changed by calling [**SetThreadAffinityMask**](/windows/desktop/api/WinBase/nf-winbase-setthreadaffinitymask) or [**SetThreadGroupAffinity**](/windows/win32/api/processtopologyapi/nf-processtopologyapi-setthreadgroupaffinity).</span></span> <span data-ttu-id="4adfb-143">如果執行緒指派給與進程不同的群組，進程的親和性就會更新為包含執行緒的親和性，而且程式會變成多群組進程。</span><span class="sxs-lookup"><span data-stu-id="4adfb-143">If a thread is assigned to a different group than the process, the process's affinity is updated to include the thread's affinity and the process becomes a multi-group process.</span></span> <span data-ttu-id="4adfb-144">您必須對個別的執行緒進行進一步的親和性變更;無法使用 [**SetProcessAffinityMask**](/windows/desktop/api/WinBase/nf-winbase-setprocessaffinitymask)修改多群組進程的親和性。</span><span class="sxs-lookup"><span data-stu-id="4adfb-144">Further affinity changes must be made for individual threads; a multi-group process's affinity cannot be modified using [**SetProcessAffinityMask**](/windows/desktop/api/WinBase/nf-winbase-setprocessaffinitymask).</span></span> <span data-ttu-id="4adfb-145">[**GetProcessGroupAffinity**](/windows/win32/api/processtopologyapi/nf-processtopologyapi-getprocessgroupaffinity)函式會抓取進程及其執行緒所指派的群組集合。</span><span class="sxs-lookup"><span data-stu-id="4adfb-145">The [**GetProcessGroupAffinity**](/windows/win32/api/processtopologyapi/nf-processtopologyapi-getprocessgroupaffinity) function retrieves the set of groups to which a process and its threads are assigned.</span></span>

<span data-ttu-id="4adfb-146">若要為與工作物件相關聯的所有進程指定親和性，請使用 [**SetInformationJobObject**](/windows/win32/api/jobapi2/nf-jobapi2-setinformationjobobject) 函數搭配 **JobObjectGroupInformation** 或 **JobObjectGroupInformationEx** 資訊類別。</span><span class="sxs-lookup"><span data-stu-id="4adfb-146">To specify affinity for all processes associated with a job object, use the [**SetInformationJobObject**](/windows/win32/api/jobapi2/nf-jobapi2-setinformationjobobject) function with the **JobObjectGroupInformation** or **JobObjectGroupInformationEx** information class.</span></span>

<span data-ttu-id="4adfb-147">邏輯處理器是由其群組編號和其群組相關處理器編號來識別。</span><span class="sxs-lookup"><span data-stu-id="4adfb-147">A logical processor is identified by its group number and its group-relative processor number.</span></span> <span data-ttu-id="4adfb-148">這是以 [**處理器 \_ 編號**](/windows/desktop/api/WinNT/ns-winnt-processor_number) 結構表示。</span><span class="sxs-lookup"><span data-stu-id="4adfb-148">This is represented by a [**PROCESSOR\_NUMBER**](/windows/desktop/api/WinNT/ns-winnt-processor_number) structure.</span></span> <span data-ttu-id="4adfb-149">舊版函式所使用的數值處理器號碼是群組相關的。</span><span class="sxs-lookup"><span data-stu-id="4adfb-149">Numeric processor numbers used by legacy functions are group-relative.</span></span>

<span data-ttu-id="4adfb-150">如需作業系統架構變更以支援64個以上處理器的討論，請參閱 [支援超過64個處理器之系統](https://www.microsoft.com/whdc/system/Sysinternals/MoreThan64proc.mspx)的技術白皮書。</span><span class="sxs-lookup"><span data-stu-id="4adfb-150">For a discussion of operating system architecture changes to support more than 64 processors, see the white paper [Supporting Systems That Have More Than 64 Processors](https://www.microsoft.com/whdc/system/Sysinternals/MoreThan64proc.mspx).</span></span>

<span data-ttu-id="4adfb-151">如需支援處理器群組的新函式和結構清單，請參閱 [進程和執行緒的新](what-s-new-in-processes-and-threads.md)功能。</span><span class="sxs-lookup"><span data-stu-id="4adfb-151">For a list of new functions and structures that support processor groups, see [What's New in Processes and Threads](what-s-new-in-processes-and-threads.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="4adfb-152">相關主題</span><span class="sxs-lookup"><span data-stu-id="4adfb-152">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="4adfb-153">多個處理器</span><span class="sxs-lookup"><span data-stu-id="4adfb-153">Multiple Processors</span></span>](multiple-processors.md)
</dt> <dt>

[<span data-ttu-id="4adfb-154">NUMA 支援</span><span class="sxs-lookup"><span data-stu-id="4adfb-154">NUMA Support</span></span>](numa-support.md)
</dt> </dl>

 

 
