---
description: 執行緒順序服務會控制一個或多個用戶端執行緒的執行。 它可確保每個用戶端執行緒在指定的期間內以及相對循序執行一次。
ms.assetid: 5c37873a-ced4-447e-a6e1-55cfa8ab24b4
title: 執行緒順序服務
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 72b3cd12b26124b47d506585425388a4542a70df
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "106974271"
---
# <a name="thread-ordering-service"></a><span data-ttu-id="03b84-104">執行緒順序服務</span><span class="sxs-lookup"><span data-stu-id="03b84-104">Thread Ordering Service</span></span>

<span data-ttu-id="03b84-105">*執行緒順序服務* 會控制一個或多個用戶端執行緒的執行。</span><span class="sxs-lookup"><span data-stu-id="03b84-105">The *thread ordering service* controls the execution of one or more client threads.</span></span> <span data-ttu-id="03b84-106">它可確保每個用戶端執行緒在指定的期間內以及相對循序執行一次。</span><span class="sxs-lookup"><span data-stu-id="03b84-106">It ensures that each client thread runs once during the specified period and in relative order.</span></span>

<span data-ttu-id="03b84-107">**Windows Server 2003 和 WINDOWS XP：** 從 Windows Vista 和 Windows Server 2008 開始，可以使用「執行緒順序」服務。</span><span class="sxs-lookup"><span data-stu-id="03b84-107">**Windows Server 2003 and Windows XP:** The thread ordering service is available starting with Windows Vista and Windows Server 2008.</span></span>

<span data-ttu-id="03b84-108">依預設，執行緒順序服務為關閉，且必須由使用者啟動。</span><span class="sxs-lookup"><span data-stu-id="03b84-108">The thread ordering service is off by default and must be started by the user.</span></span> <span data-ttu-id="03b84-109">當執行緒排序服務正在執行時，會每隔5秒啟動一次，以檢查是否有新的要求，即使系統處於閒置狀態也一樣。</span><span class="sxs-lookup"><span data-stu-id="03b84-109">While the thread ordering service is running, it is activated every 5 seconds to check whether there is a new request, even if the system is idle.</span></span> <span data-ttu-id="03b84-110">這可防止系統睡眠超過5秒，導致系統耗用更多電源。</span><span class="sxs-lookup"><span data-stu-id="03b84-110">This prevents the system from sleeping for longer than 5 seconds, causing the system to consume more power.</span></span> <span data-ttu-id="03b84-111">如果能源效率對應用程式而言是很重要的，最好不要使用「執行緒順序」服務，而是讓系統排程器管理執行緒的執行。</span><span class="sxs-lookup"><span data-stu-id="03b84-111">If energy efficiency is critical to the application, it is better not to use the thread ordering service and instead allow the system scheduler to manage execution of threads.</span></span>

<span data-ttu-id="03b84-112">每個用戶端執行緒都屬於 *執行緒順序群組*。</span><span class="sxs-lookup"><span data-stu-id="03b84-112">Each client thread belongs to a *thread ordering group*.</span></span> <span data-ttu-id="03b84-113">*父執行緒* 藉由呼叫 [**AvRtCreateThreadOrderingGroup**](/windows/desktop/api/Avrt/nf-avrt-avrtcreatethreadorderinggroup)函式來建立一或多個執行緒排序群組。</span><span class="sxs-lookup"><span data-stu-id="03b84-113">The *parent thread* creates one or more thread ordering groups by calling the [**AvRtCreateThreadOrderingGroup**](/windows/desktop/api/Avrt/nf-avrt-avrtcreatethreadorderinggroup) function.</span></span> <span data-ttu-id="03b84-114">父執行緒會使用這個函數來指定執行緒順序群組的期間和逾時間隔。</span><span class="sxs-lookup"><span data-stu-id="03b84-114">The parent thread uses this function to specify the period for the thread ordering group and a time-out interval.</span></span>

<span data-ttu-id="03b84-115">其他用戶端執行緒會呼叫 [**AvRtJoinThreadOrderingGroup**](/windows/desktop/api/Avrt/nf-avrt-avrtjointhreadorderinggroup) 函式來聯結現有的執行緒排序群組。</span><span class="sxs-lookup"><span data-stu-id="03b84-115">Additional client threads call the [**AvRtJoinThreadOrderingGroup**](/windows/desktop/api/Avrt/nf-avrt-avrtjointhreadorderinggroup) function to join an existing thread ordering group.</span></span> <span data-ttu-id="03b84-116">這些執行緒會指出其是否為執行順序中父執行緒的前置或後置。</span><span class="sxs-lookup"><span data-stu-id="03b84-116">These threads indicate whether they are to be a predecessor or successor to the parent thread in the execution order.</span></span> <span data-ttu-id="03b84-117">每個用戶端執行緒預期每個期間都會完成特定數量的處理。</span><span class="sxs-lookup"><span data-stu-id="03b84-117">Each client thread is expected to complete a certain amount of processing each period.</span></span> <span data-ttu-id="03b84-118">群組內的所有線程都應該在期間加上逾時間隔來完成其執行。</span><span class="sxs-lookup"><span data-stu-id="03b84-118">All threads within the group should complete their execution within the period plus the time-out interval.</span></span>

<span data-ttu-id="03b84-119">執行緒順序群組的執行緒會將其處理常式代碼括在 [**AvRtWaitOnThreadOrderingGroup**](/windows/desktop/api/Avrt/nf-avrt-avrtwaitonthreadorderinggroup) 函式所控制的迴圈中。</span><span class="sxs-lookup"><span data-stu-id="03b84-119">The threads of a thread ordering group enclose their processing code within a loop that is controlled by the [**AvRtWaitOnThreadOrderingGroup**](/windows/desktop/api/Avrt/nf-avrt-avrtwaitonthreadorderinggroup) function.</span></span> <span data-ttu-id="03b84-120">首先，前置執行緒會依照其加入群組的順序，一次執行一個執行緒，而父和後續的執行緒則會在呼叫 **AvRtWaitOnThreadOrderingGroup** 時遭到封鎖。</span><span class="sxs-lookup"><span data-stu-id="03b84-120">First, the predecessor threads are executed one at a time in the order that they joined the group, while the parent and successor threads are blocked on their calls to **AvRtWaitOnThreadOrderingGroup**.</span></span> <span data-ttu-id="03b84-121">當每個前置執行緒完成處理時，控制權會回到其處理迴圈的最上方，然後執行緒會再次呼叫 **AvRtWaitOnThreadOrderingGroup** 來封鎖，直到下一個回合為止。</span><span class="sxs-lookup"><span data-stu-id="03b84-121">When each predecessor thread is finished with its processing, control of execution returns to the top of its processing loop and the thread calls **AvRtWaitOnThreadOrderingGroup** again to block until its next turn.</span></span> <span data-ttu-id="03b84-122">在所有前置執行緒都呼叫這個函式之後，執行緒順序服務就可以排程父執行緒。</span><span class="sxs-lookup"><span data-stu-id="03b84-122">After all predecessor threads have called this function, the thread ordering service can schedule the parent thread.</span></span> <span data-ttu-id="03b84-123">最後，當父執行緒完成其處理，並再次呼叫 **AvRtWaitOnThreadOrderingGroup** 時，執行緒順序服務可以依其加入群組的順序，一次排程一個後續執行緒。</span><span class="sxs-lookup"><span data-stu-id="03b84-123">Finally, when the parent thread finishes its processing and calls **AvRtWaitOnThreadOrderingGroup** again, the thread ordering service can schedule the successor threads one at a time in the order that they joined the group.</span></span> <span data-ttu-id="03b84-124">如果所有線程在一段時間結束之前完成其執行，則所有線程都會等到句號的其餘部分經過一段時間後才會再次執行。</span><span class="sxs-lookup"><span data-stu-id="03b84-124">If all threads complete their execution before a period ends, all threads wait until the remainder of the period elapses before any are executed again.</span></span>

<span data-ttu-id="03b84-125">當用戶端不再以執行緒排列群組的一部分執行時，它會呼叫 [**AvRtLeaveThreadOrderingGroup**](/windows/desktop/api/Avrt/nf-avrt-avrtleavethreadorderinggroup) 函式，以從群組中移除本身。</span><span class="sxs-lookup"><span data-stu-id="03b84-125">When the client need no longer run as part of the thread ordering group, it calls the [**AvRtLeaveThreadOrderingGroup**](/windows/desktop/api/Avrt/nf-avrt-avrtleavethreadorderinggroup) function to remove itself from the group.</span></span> <span data-ttu-id="03b84-126">請注意，父執行緒不應從執行緒排序群組中移除本身。</span><span class="sxs-lookup"><span data-stu-id="03b84-126">Note that the parent thread should not remove itself from a thread ordering group.</span></span> <span data-ttu-id="03b84-127">如果執行緒未在期間加上逾時間隔之前完成其執行，則會從群組中刪除。</span><span class="sxs-lookup"><span data-stu-id="03b84-127">If a thread does not complete its execution before the period plus the time-out interval elapses, then it is deleted from the group.</span></span>

<span data-ttu-id="03b84-128">父執行緒會呼叫 [**AvRtDeleteThreadOrderingGroup**](/windows/desktop/api/Avrt/nf-avrt-avrtdeletethreadorderinggroup) 函數來刪除線程排序群組。</span><span class="sxs-lookup"><span data-stu-id="03b84-128">The parent thread calls the [**AvRtDeleteThreadOrderingGroup**](/windows/desktop/api/Avrt/nf-avrt-avrtdeletethreadorderinggroup) function to delete the thread ordering group.</span></span> <span data-ttu-id="03b84-129">如果父執行緒未在期間加上逾時間隔之前完成其執行，則也會終結執行緒順序群組。</span><span class="sxs-lookup"><span data-stu-id="03b84-129">The thread ordering group is also destroyed if the parent thread does not complete its execution before the period plus the time-out interval elapses.</span></span> <span data-ttu-id="03b84-130">當執行緒排序群組終結時，從該群組之執行緒 [**AvRtWaitOnThreadOrderingGroup**](/windows/desktop/api/Avrt/nf-avrt-avrtwaitonthreadorderinggroup) 的任何呼叫都會失敗或超時。</span><span class="sxs-lookup"><span data-stu-id="03b84-130">When the thread ordering group is destroyed, any calls to [**AvRtWaitOnThreadOrderingGroup**](/windows/desktop/api/Avrt/nf-avrt-avrtwaitonthreadorderinggroup) from threads of that group fail or time out.</span></span>

 

 



