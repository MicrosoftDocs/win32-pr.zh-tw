---
title: 記憶體別名和資料繼承
description: 放置和保留的資源可能會在堆積內為實體記憶體加上別名。 當堆積已設定共用旗標，或當別名的資源有完整定義的記憶體配置時，放置的資源可提供比保留資源更多的資料繼承案例。
ms.assetid: 53C5804B-0F81-41AF-83D2-A96DCDFDC94A
ms.localizationpriority: high
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2b584ef95f4ee89bc98940c8407427203a19f55046134e1d3c15cb672fef8fef
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/11/2021
ms.locfileid: "119460918"
---
# <a name="memory-aliasing-and-data-inheritance"></a>記憶體別名和資料繼承

放置和保留的資源可能會在堆積內為實體記憶體加上別名。 當堆積已設定共用旗標，或當別名的資源有完整定義的記憶體配置時，放置的資源可提供比保留資源更多的資料繼承案例。

-   [鋸齒化](#memory-aliasing-and-data-inheritance)
-   [資料繼承](#data-inheritance)
-   [相關主題](#related-topics)

## <a name="aliasing"></a>別名

即使您不想要資料繼承，也必須在共用相同實體記憶體的兩個資源的使用方式之間發出別名屏障。 簡單的使用模型至少必須代表與這類作業相關的目的地資源。 如需更多詳細資料和先進的使用模型，請參閱 [**CreatePlacedResource**](/windows/desktop/api/d3d12/nf-d3d12-id3d12device-createplacedresource) 。

存取資源之後，任何與該資源分享實體記憶體的資源都會變成無效，除非允許進行資料繼承。 讀取不正確資源會導致未定義的資源內容。 寫入不正確資源也會產生未定義的資源內容，除非發生兩個狀況：

-   資源沒有 D3D12 \_ 資源 \_ 旗標 \_ 允許 \_ 呈現 \_ 目標或 D3D12 \_ 資源 \_ 旗標 \_ 允許深度樣板 \_ \_ 。
-   寫入是整個 subresource 或磚的複製或清除操作。 磚-初始化僅適用于具有 64KB \_ 磚 \_ 未定義 \_ SWIZZLE 和 64kb \_ 磚 \_ 標準 \_ SWIZZLE 的資源。

當版面配置提供有關材質資料位置位置的資訊，以及當資源處於某些轉換屏障狀態時，重迭的失效範圍會限定為較小的資料細微性。 但是，失效的大小不能小於資源對齊資料細微性。

緩衝區對齊細微性是64KB，較大的對齊細微性則優先。 這在考慮4KB 紋理時很重要，因為多個4KB 紋理可以位於64KB 區域，而不會彼此重迭。 但是，相同64KB 區域的緩衝區別名無法與其中任何4KB 紋理一起使用。 應用程式無法可靠地將緩衝區的存取權與 4 KB 的材質分開，因為 Gpu 可在64KB 區域內以未定義模式 swizzle 4 KB 的材質資料。

64KB \_ 圖格 \_ 未定義 \_ SWIZZLE、64kb \_ 磚 \_ 標準 \_ SWIZZLE 和資料列 \_ 主要材質版面配置會通知應用程式，對齊資料細微性的重迭對齊已失效。 例如：應用程式可以建立2D 轉譯目標紋理陣列，其中包含2個數組配量、單一 mip 層級，以及 64KB \_ 磚 \_ 未定義的 \_ SWIZZLE 版面配置。 假設應用程式瞭解每個陣列配量占 100 64KB 的圖格。 應用程式可以使用陣列配量0放棄，並針對 ~ 6MB 緩衝區、~ 6MB 紋理（具有未定義的版面配置等等）重複使用該記憶體。接下來，假設應用程式不再需要陣列配量1的第一個圖格。 然後，應用程式也可以在該處找出64KB 緩衝區，直到轉譯再次需要陣列配量1的第一個圖格。 應用程式必須執行完整的磚清除或複製，才能重新使用第一個具有材質陣列的磚。

但是，即使材質具有已定義的版面配置仍有問題的情況。 材質資源大小可能會與應用程式本身的計算方式有很大的不同，因為某些介面卡架構會為紋理配置額外的記憶體，以在一般轉譯案例期間減少有效的頻寬。 任何失效的額外記憶體區域都會導致整個資源失效。 如需詳細資訊，請參閱 [**GetResourceAllocationInfo**](/windows/desktop/api/d3d12/nf-d3d12-id3d12device-getresourceallocationinfo) 。

## <a name="data-inheritance"></a>資料繼承

放置的資源會啟用最多紋理的資料繼承，即使是未定義的記憶體配置。 應用程式可以藉由在共用堆積的相同位移上找出兩個具有相同資源屬性的材質，來模擬共用認可資源所啟用的資料繼承功能。 整個資源描述必須完全相同，包括優化的純量值和資源建立方法的類型， (放置或保留) 。 但是，這兩個資源可能會有不同的初始轉換屏障狀態。

保留的資源可啟用個別圖格資料繼承;但是資源轉換屏障狀態通常會有限制。

若要繼承資料，這兩個資源必須處於相容的資源轉換屏障狀態：

-   對於緩衝區、同時存取材質和跨介面卡材質，資源轉換狀態並不重要，而且所有狀態都是「相容」。
-   針對沒有先前屬性的保留紋理或其他每個圖格的資料繼承到 64KB \_ 磚 \_ 未定義 \_ SWIZZLE 或 64kb \_ 圖格 \_ 標準 \_ SWIZZLE，資源轉換屏障狀態（包括磚）必須處於一般狀態。
-   對於資源描述完全相符的所有其他材質，每個對應子資源的資源轉換屏障狀態必須：
    -   處於一般狀態。
    -   當狀態的 GPU 寫入旗標相同時，就等於。

當 GPU 支援標準 swizzle 時，緩衝區和標準 swizzle 材質可能會對相同的記憶體進行別名，並在兩者之間繼承資料。 應用程式可以操控緩衝區標記法中的材質，因為標準 swizzle 模式描述材質在記憶體中的配置方式。 CPU 可見的 swizzle 模式相當於緩衝區中看到的 GPU 可見 swizzle 模式。

## <a name="related-topics"></a>相關主題

<dl> <dt>

[堆積中的子分配](suballocation-within-heaps.md)
</dt> </dl>

 

 




