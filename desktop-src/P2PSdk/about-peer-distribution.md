---
description: 對等散發 API （支援 Windows 7、Windows Server 2008 R2、Windows 8 和 Windows Server 2012 中的分支快取功能）提供了一組平臺 Api，可在從遠端辦公室存取時提高集中式應用程式的網路回應能力，並協助降低整體廣域網路 (WAN) 使用率，而不會干擾網路安全性技術。
ms.assetid: feb9666e-563a-49f4-ad1c-f166a0faff31
title: 關於對等分佈
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1c996aed35ac691284ba61b757d6ff5a88033aad
ms.sourcegitcommit: b32433cc0394159c7263809ae67615ab5792d40d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/30/2021
ms.locfileid: "113120433"
---
# <a name="about-peer-distribution"></a><span data-ttu-id="1d4bb-103">關於對等分佈</span><span class="sxs-lookup"><span data-stu-id="1d4bb-103">About Peer Distribution</span></span>

<span data-ttu-id="1d4bb-104">對等散發 API （支援 Windows 7、Windows Server 2008 R2、Windows 8 和 Windows Server 2012 中的分支快取功能）提供了一組平臺 Api，可在從遠端辦公室存取時提高集中式應用程式的網路回應能力，並協助降低整體廣域網路 (WAN) 使用率，而不會干擾網路安全性技術。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-104">The Peer Distribution API, which supports the Branch Cache feature in Windows 7, Windows Server 2008 R2, Windows 8, and Windows Server 2012 offers a set of platform APIs that can increase network responsiveness of centralized applications when accessed from remote offices and aid in reducing overall wide area network (WAN) utilization without interfering with the network security technologies.</span></span>

<span data-ttu-id="1d4bb-105">對等散發系統提供一組平臺 Api，供發行者用來提供數位內容和要求的取用者。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-105">The Peer Distribution system offers a set of platform APIs utilized by both the publishers that provide digital content and consumers that request it.</span></span> <span data-ttu-id="1d4bb-106">若要輕鬆地區分這些角色，您可以更輕鬆地將伺服器角色中的發行者和用戶端角色中的取用者想像。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-106">To easily differentiate these roles, it may be easier to think of the publisher in a server role and the consumer in a client role.</span></span> <span data-ttu-id="1d4bb-107">除此之外，請務必記住，在這些概念角色之前，對等散發服務是真正的對等系統，這是由任何對等分佈節點發布和取用數位內容的能力所表示。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-107">That aside, it is important to remember that aside from these conceptual roles, the Peer Distribution service is a true peer system, as indicated by the ability for any Peer Distribution node to both publish and consume digital content.</span></span> <span data-ttu-id="1d4bb-108">對等散發平臺 Api 是由 Win32 匯入連結 **庫 (的**) 來公開給發行者和取用者。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-108">The Peer Distribution platform APIs are exposed to publishers and consumers by a Win32 import library (**PeerDist.Lib**).</span></span>

<span data-ttu-id="1d4bb-109">發行者提供的內容生命週期，由具有對等散發服務的取用者所抓取，是由下列作業所組成：</span><span class="sxs-lookup"><span data-stu-id="1d4bb-109">The lifecycle of content supplied by a publisher and retrieved by a consumer with the Peer Distribution service is composed of the following operations:</span></span>



|                         | <span data-ttu-id="1d4bb-110">描述</span><span class="sxs-lookup"><span data-stu-id="1d4bb-110">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|-------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="1d4bb-111">**內容發佈**</span><span class="sxs-lookup"><span data-stu-id="1d4bb-111">**Content Publication**</span></span> | <span data-ttu-id="1d4bb-112">發佈的目的是要產生稱為 **內容資訊** 的內容描述，或簡短的 **內容資訊** 。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-112">Publishing is done to produce a description of content termed **Content Information**, or **Content Info** for short.</span></span> <span data-ttu-id="1d4bb-113">這項內容資訊可供對等散發服務的實例用來驗證和重建內容。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-113">This Content Info can then be used by an instance of the Peer Distribution service to authenticate and rebuild the content.</span></span> <span data-ttu-id="1d4bb-114">當應用程式將內容發佈至對等散發服務（在概念上是伺服器端作業）時，該內容會變成與發行者身分識別相關聯，這是以與執行緒存取權杖相關聯之使用者的 SID 為基礎。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-114">When content is published by an application into the Peer Distribution service, which is conceptually a server-side operation, that content becomes associated with the Publisher Identity, which is based on the SID of the user associated with the thread access token.</span></span> <span data-ttu-id="1d4bb-115">這項系結是為了限制未經授權的實體存取內容而完成。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-115">This binding is done to limit access to content by unauthorized entities.</span></span> <span data-ttu-id="1d4bb-116">不過，請務必注意，內容資訊的存取相當於存取內容本身，因為內容資訊可以用來取得對等或託管快取的內容。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-116">However, it is important to note that access to the content information is equivalent to access to the content itself, as the content information can be used to obtain the content from peers or a hosted cache.</span></span><br/> <span data-ttu-id="1d4bb-117">Windows 8 中有新版本的內容資訊資料結構;不過，仍支援舊版。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-117">There is a new version of the content information data structure in Windows 8; however, the previous version is still supported.</span></span> <span data-ttu-id="1d4bb-118">若要與 Windows 7 用戶端交互操作，系統管理員可以將對等散發服務設定為使用舊版的內容資訊資料結構。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-118">To interoperate with Windows 7 clients, an administrator may configure the Peer Distribution service to use the previous version of the content information data structure.</span></span><br/> |
| <span data-ttu-id="1d4bb-119">**內容抓取**</span><span class="sxs-lookup"><span data-stu-id="1d4bb-119">**Content Retrieval**</span></span>   | <span data-ttu-id="1d4bb-120">若要讓取用者從對等散發服務取得內容，必須將存取權提供給與該內容相關聯的已發佈內容資訊。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-120">For a consumer to retrieve content from the Peer Distribution service, access must be provided to the published Content Info associated with that content.</span></span> <span data-ttu-id="1d4bb-121">用來發佈內容的對等散發服務可以提供相關聯的內容資訊。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-121">The Peer Distribution service used to publish the content can provide the associated Content Info.</span></span> <span data-ttu-id="1d4bb-122">當取用者具有內容資訊之後，其他對等散發 Api 就可以用來向對等散發服務要求內容。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-122">Once the consumer has the Content Info, other Peer Distribution APIs can be used to request content from the Peer Distribution service.</span></span> <span data-ttu-id="1d4bb-123">對等散發服務將嘗試從區域網路取得內容。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-123">The Peer Distribution service will attempt to retrieve the content from the local network.</span></span> <span data-ttu-id="1d4bb-124">如果內容無法使用，用戶端應用程式會負責從來源伺服器抓取內容。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-124">If the content is not available, the client application is responsible for retrieving the content from the source server.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| <span data-ttu-id="1d4bb-125">**移除發行集**</span><span class="sxs-lookup"><span data-stu-id="1d4bb-125">**Publication Removal**</span></span> | <span data-ttu-id="1d4bb-126">針對已將內容發佈至對等散發服務的應用程式，已提供 [**PeerDistServerUnpublish**](/windows/desktop/api/PeerDist/nf-peerdist-peerdistserverunpublish) 函式以允許解除發佈內容。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-126">For applications that have published content into the Peer Distribution service, the [**PeerDistServerUnpublish**](/windows/desktop/api/PeerDist/nf-peerdist-peerdistserverunpublish) function has been provided to allow content to be unpublished.</span></span> <span data-ttu-id="1d4bb-127">解除發佈內容之後，本機對等散發服務將不再提供與該內容相關聯的內容資訊。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-127">Once content has been unpublished, the local Peer Distribution service will no longer provide the content info associated with that content.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |



 

## <a name="asynchronous-completions"></a><span data-ttu-id="1d4bb-128">非同步完成</span><span class="sxs-lookup"><span data-stu-id="1d4bb-128">Asynchronous Completions</span></span>

<span data-ttu-id="1d4bb-129">對等散發 API 支援非同步 API 模型，因此對等散發 Api 可讓您使用 i/o 完成埠或事件作為處理非同步對等散發作業完成的信號機制。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-129">The Peer Distribution API supports an asynchronous API model, and as a result Peer Distribution APIs allow for the use of either I/O Completion Ports or Events as the signaling mechanisms for processing asynchronous Peer Distribution operation completions.</span></span> <span data-ttu-id="1d4bb-130">針對任一個機制，對等分佈會使用重迭 [**的結構。**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped)</span><span class="sxs-lookup"><span data-stu-id="1d4bb-130">For either mechanism, Peer Distribution uses an [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure.</span></span> <span data-ttu-id="1d4bb-131">一般而言，對等散發會取得重 **迭結構的** 擁有權，以及用戶端傳遞給非同步 API 函式的任何 out 參數。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-131">In general, Peer Distribution takes the ownership of an **OVERLAPPED** structure and any out parameters that the Client passes to asynchronous API functions.</span></span> <span data-ttu-id="1d4bb-132">在特定非同步函式完成之前，用戶端不能存取這些資源。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-132">The Client must not access these resources until the particular asynchronous function completes.</span></span> <span data-ttu-id="1d4bb-133">非同步函式完成時，對等散發服務將不再需要這些資源的存取權，而且可以在呼叫的應用程式符合時重複使用。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-133">As soon as the asynchronous functions completes, the Peer Distribution service will no longer require access to these resources and they may be reused as the calling application sees fit.</span></span>

<span data-ttu-id="1d4bb-134">如果函式傳回 **錯誤 \_ IO \_ 擱置** 以外的任何錯誤碼，將不會有任何非同步完成。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-134">There will not be any asynchronous completion if the function returns any error code other than **ERROR\_IO\_PENDING**.</span></span> <span data-ttu-id="1d4bb-135">傳回 **錯誤 \_ IO \_ 暫** 止的值表示呼叫同步失敗。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-135">The return of a value other than **ERROR\_IO\_PENDING** means that the call has failed synchronously.</span></span> <span data-ttu-id="1d4bb-136">如果對等散發 API 傳回 **錯誤 \_ IO \_ 暫** 止，則呼叫端必須等候非同步完成。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-136">If the Peer Distribution API returns **ERROR\_IO\_PENDING**, the caller must wait for asynchronous completion.</span></span>

<span data-ttu-id="1d4bb-137">您可以透過下列兩種方式之一來抓取非同步完成的錯誤碼：</span><span class="sxs-lookup"><span data-stu-id="1d4bb-137">The error code of the asynchronous completion can be retrieved in one of two ways:</span></span>

<span data-ttu-id="1d4bb-138">**I/o 完成埠自動完成**</span><span class="sxs-lookup"><span data-stu-id="1d4bb-138">**I/O Completion Port Based Completion**</span></span>

<span data-ttu-id="1d4bb-139">使用者藉由提供完成埠控制碼和完成金鑰給下列 API 函式，來叫用 i/o 完成埠機制：</span><span class="sxs-lookup"><span data-stu-id="1d4bb-139">User invokes the I/O completion port mechanism by providing a completion port handle and completion key to the following API functions:</span></span>

<dl>

[<span data-ttu-id="1d4bb-140">**PeerDistRegisterForStatusChangeNotification**</span><span class="sxs-lookup"><span data-stu-id="1d4bb-140">**PeerDistRegisterForStatusChangeNotification**</span></span>](/windows/desktop/api/PeerDist/nf-peerdist-peerdistregisterforstatuschangenotification)  
[<span data-ttu-id="1d4bb-141">**PeerDistServerPublishStream**</span><span class="sxs-lookup"><span data-stu-id="1d4bb-141">**PeerDistServerPublishStream**</span></span>](/windows/desktop/api/PeerDist/nf-peerdist-peerdistserverpublishstream)  
[<span data-ttu-id="1d4bb-142">**PeerDistServerOpenContentInformation**</span><span class="sxs-lookup"><span data-stu-id="1d4bb-142">**PeerDistServerOpenContentInformation**</span></span>](/windows/desktop/api/PeerDist/nf-peerdist-peerdistserveropencontentinformation)  
[<span data-ttu-id="1d4bb-143">**PeerDistClientOpenContent**</span><span class="sxs-lookup"><span data-stu-id="1d4bb-143">**PeerDistClientOpenContent**</span></span>](/windows/desktop/api/PeerDist/nf-peerdist-peerdistclientopencontent)  
</dl>

<span data-ttu-id="1d4bb-144">使用者可以藉由呼叫 [**CreateIoCompletionPort**](/windows/desktop/FileIO/createiocompletionport)來建立完成埠。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-144">The User creates a completion port by calling [**CreateIoCompletionPort**](/windows/desktop/FileIO/createiocompletionport).</span></span> <span data-ttu-id="1d4bb-145">此完成埠控制碼可同時用於其他非同步 i/o 作業，以及對等散發的特定作業。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-145">This completion port handle can be simultaneously used for other asynchronous I/O operations as well as Peer Distribution specific operations.</span></span>

<span data-ttu-id="1d4bb-146">呼叫端應該使用 [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus) 函數來管理非同步完成。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-146">The caller should use [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus) function to manage asynchronous completion.</span></span> <span data-ttu-id="1d4bb-147">如果非同步作業失敗， **GetQueuedCompletionStatus** 函式會傳回 **FALSE** ，而 [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) 會傳回適當的錯誤碼。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-147">If the asynchronous operation fails the **GetQueuedCompletionStatus** function will return **FALSE** and [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) will return the appropriate error code.</span></span> <span data-ttu-id="1d4bb-148">如果錯誤碼是 **錯誤 \_ 成功** 以外的任何欄位，則呼叫端應該忽略重 [**迭結構的**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped)所有欄位。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-148">The caller should ignore all the fields of the [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure if the error code is anything other than **ERROR\_SUCCESS**.</span></span> <span data-ttu-id="1d4bb-149">如果 **GetQueuedCompletionStatus** 函數傳回 **TRUE**，則非同步作業會成功。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-149">The asynchronous operation succeeds if the **GetQueuedCompletionStatus** function returns **TRUE**.</span></span>

<span data-ttu-id="1d4bb-150">如需詳細資訊，請參閱 [I/o 完成埠](/windows/desktop/FileIO/i-o-completion-ports)。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-150">For more information see [I/O Completion Ports](/windows/desktop/FileIO/i-o-completion-ports).</span></span>

<span data-ttu-id="1d4bb-151">**以事件為基礎的完成**</span><span class="sxs-lookup"><span data-stu-id="1d4bb-151">**Event Based Completion**</span></span>

<span data-ttu-id="1d4bb-152">如果呼叫端將有效的事件控制碼設定為重迭 [**結構的**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) *hEvent* 欄位，則對等分佈會使用它來表示相關聯的非同步 i/o 作業已完成。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-152">If the caller sets a valid Event handle to the *hEvent* field of [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure, Peer Distribution uses it to signal that the associated asynchronous I/O operation has completed.</span></span>

<span data-ttu-id="1d4bb-153">執行緒呼叫端可以在其中一個等候函式中指定重 [**迭結構的**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) 手動重設事件物件的控制碼，以管理重迭的作業。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-153">A thread caller can manage overlapped operations by specifying a handle to the [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure's manual-reset event object in one of the wait functions.</span></span> <span data-ttu-id="1d4bb-154">在事件發出信號之後，呼叫端必須呼叫 [**PeerGetOverlappedResult**](https://www.bing.com/search?q=**PeerGetOverlappedResult**) **傳入適當的** 重迭結構。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-154">After the Event is signaled the caller must call [**PeerGetOverlappedResult**](https://www.bing.com/search?q=**PeerGetOverlappedResult**) passing in the appropriate **OVERLAPPED** structure.</span></span> <span data-ttu-id="1d4bb-155">**PeerGetOverlappedResult** 會傳回 **FALSE** ，而且呼叫端必須呼叫 [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) 才能取得錯誤碼。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-155">**PeerGetOverlappedResult** will return **FALSE** and the caller must call [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) in order to retrieve the error code.</span></span> <span data-ttu-id="1d4bb-156">如果錯誤碼是 **錯誤 \_ 成功** 以外的任何欄位，則呼叫端應該忽略重 **迭結構的** 所有欄位。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-156">The caller should ignore all the fields of the **OVERLAPPED** structure if the error code is anything other than **ERROR\_SUCCESS**.</span></span> <span data-ttu-id="1d4bb-157">如果 **PeerGetOverlappedResult** 函數傳回 **TRUE**，則非同步作業會成功。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-157">The asynchronous operation succeeds if the **PeerGetOverlappedResult** function returns **TRUE**.</span></span>

<span data-ttu-id="1d4bb-158">如果呼叫端提供完成埠以及事件，則會使用此事件做為完成機制。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-158">If the caller provides a completion port along with an event, the event will be used as the completion mechanism.</span></span>

<span data-ttu-id="1d4bb-159">**Windows 7：** 使用 [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) 函式，而不是 [**PeerGetOverlappedResult**](https://www.bing.com/search?q=**PeerGetOverlappedResult**)。</span><span class="sxs-lookup"><span data-stu-id="1d4bb-159">**Windows 7:** Use the [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) function instead of [**PeerGetOverlappedResult**](https://www.bing.com/search?q=**PeerGetOverlappedResult**).</span></span>

## <a name="related-topics"></a><span data-ttu-id="1d4bb-160">相關主題</span><span class="sxs-lookup"><span data-stu-id="1d4bb-160">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="1d4bb-161">對等散發 API 參考</span><span class="sxs-lookup"><span data-stu-id="1d4bb-161">Peer Distribution API Reference</span></span>](peer-distribution-api-reference.md)
</dt> </dl>

 

