---
description: 本主題討論應用程式如何使用對等群組 Api 連接至對等群組。
ms.assetid: 56fa28d8-3b3a-4cd5-8448-c8c4ce8d0b2c
title: 如何連接至對等群組
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d5bb3f41342573742e634a6e7ebce283188f3ffd
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "106998107"
---
# <a name="how-to-connect-to-a-peer-group"></a><span data-ttu-id="28e6a-103">如何連接至對等群組</span><span class="sxs-lookup"><span data-stu-id="28e6a-103">How to Connect to a Peer Group</span></span>

<span data-ttu-id="28e6a-104">本主題討論應用程式如何使用對等群組 Api 連接至對等群組。</span><span class="sxs-lookup"><span data-stu-id="28e6a-104">This topic discusses how an application connects to a peer group using the Peer Grouping APIs.</span></span>

## <a name="joining-a-peer-group"></a><span data-ttu-id="28e6a-105">加入對等群組</span><span class="sxs-lookup"><span data-stu-id="28e6a-105">Joining a Peer Group</span></span>

<span data-ttu-id="28e6a-106">若要加入對等群組，請呼叫 [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin)，傳入對等的身分識別名稱和邀請 (以及選擇性的 PNRP 雲端名稱（如果邀請中的雲端名稱不明確) ）。</span><span class="sxs-lookup"><span data-stu-id="28e6a-106">To join a peer group, call [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin), passing in the identity name of the peer and the invitation (and an optional PNRP cloud name, if the cloud name in the invitation is ambiguous).</span></span>

<span data-ttu-id="28e6a-107">如果成功， [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin) 會傳回對等群組的控制碼。</span><span class="sxs-lookup"><span data-stu-id="28e6a-107">If successful, [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin) returns a handle to the peer group.</span></span>

<span data-ttu-id="28e6a-108">如果對等互連先前已加入對等群組，然後關閉該控制碼，則應該透過呼叫 [**PeerGroupOpen**](/windows/desktop/api/P2P/nf-p2p-peergroupopen) 並傳入對等群組的名稱來重新開啟對等群組。</span><span class="sxs-lookup"><span data-stu-id="28e6a-108">If the peer has previously joined the peer group and then closed the handle, the peer group should be reopened by calling [**PeerGroupOpen**](/windows/desktop/api/P2P/nf-p2p-peergroupopen) and passing in the name of the peer group.</span></span> <span data-ttu-id="28e6a-109">此呼叫會傳回新的對等群組控制碼。</span><span class="sxs-lookup"><span data-stu-id="28e6a-109">This call returns a new peer group handle.</span></span>

<span data-ttu-id="28e6a-110">當對等群組成功聯結之後，對等可以直接連接到對等群組，並藉由呼叫 [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect)來開始互動。</span><span class="sxs-lookup"><span data-stu-id="28e6a-110">Once the peer group is successfully joined, the peer may connect directly to the peer group and begin interacting by calling [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect).</span></span> <span data-ttu-id="28e6a-111">連接之後，對等會被視為「線上」。</span><span class="sxs-lookup"><span data-stu-id="28e6a-111">After connecting, the peer is considered to be "online".</span></span>

<span data-ttu-id="28e6a-112">如果應用程式目前不會與群組互動，它可以維持「離線」狀態。</span><span class="sxs-lookup"><span data-stu-id="28e6a-112">If an application will not interact with the group at the time, it can remain "offline".</span></span> <span data-ttu-id="28e6a-113">如果它選擇直接在稍後的實例中參與對等群組，後續的 [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) 呼叫將會使其上線。</span><span class="sxs-lookup"><span data-stu-id="28e6a-113">If it chooses to participate directly in the peer group at a later instance, a subsequent call to [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) will bring it online.</span></span> <span data-ttu-id="28e6a-114">對等互連加入對等群組之後，必須至少連接一次，才能夠將記錄發行至對等群組。</span><span class="sxs-lookup"><span data-stu-id="28e6a-114">After a peer has joined the peer group, it must connect at least once before it will be able to publish records to the peer group.</span></span>

## <a name="opening-a-peer-group-without-connecting-offline"></a><span data-ttu-id="28e6a-115">開啟對等群組而不連接 (離線) </span><span class="sxs-lookup"><span data-stu-id="28e6a-115">Opening a Peer Group Without Connecting (Offline)</span></span>

<span data-ttu-id="28e6a-116">通常，您可能會想要讓應用程式連線至對等群組，但不直接參與它、接收和發行記錄更新，但不會傳送或接收資料訊息。</span><span class="sxs-lookup"><span data-stu-id="28e6a-116">Often, you may wish to have an application connect to a peer group but not directly participate it, receiving and publishing record updates but not sending or receiving data messages.</span></span> <span data-ttu-id="28e6a-117">在呼叫 [**PeerGroupCreate**](/windows/desktop/api/P2P/nf-p2p-peergroupcreate)、 [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin)或 [**PeerGroupOpen**](/windows/desktop/api/P2P/nf-p2p-peergroupopen) 之後，應用程式會立即處於「離線」狀態。</span><span class="sxs-lookup"><span data-stu-id="28e6a-117">An application is in this "offline" state immediately after [**PeerGroupCreate**](/windows/desktop/api/P2P/nf-p2p-peergroupcreate), [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin), or [**PeerGroupOpen**](/windows/desktop/api/P2P/nf-p2p-peergroupopen) have been called.</span></span>

<span data-ttu-id="28e6a-118">離線應用程式可以隨時透過呼叫 [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect)上線。</span><span class="sxs-lookup"><span data-stu-id="28e6a-118">An offline application can go online at any time by calling [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect).</span></span> <span data-ttu-id="28e6a-119">一旦連線之後，對等群組將無法離線，直到與此身分識別相關聯的其他所有應用程式和共用此群組的連接也都關閉為止。</span><span class="sxs-lookup"><span data-stu-id="28e6a-119">Once connected, a peer group cannot go offline until all other applications associated with this identity and sharing this group have closed connections to it as well.</span></span>

<span data-ttu-id="28e6a-120">對等群組是共用資源，具有相同的對等群組可供多個應用程式使用。</span><span class="sxs-lookup"><span data-stu-id="28e6a-120">A peer group is a shared resource, with the same peer group available to multiple applications.</span></span> <span data-ttu-id="28e6a-121">如果有一個以上的應用程式適用于相同的身分識別，而 Windows 使用者使用相同的對等群組，則它們也會共用相同的基礎資料庫和連接 (鄰近和直接) 。</span><span class="sxs-lookup"><span data-stu-id="28e6a-121">If more than one application for the same identity and Windows user is using the same peer group, they also share the same underlying database and connections (neighbor and direct).</span></span> <span data-ttu-id="28e6a-122">如果其中任何一個應用程式呼叫 [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect)，則參與群組的這個身分識別/使用者的所有其他應用程式也會連接到群組。</span><span class="sxs-lookup"><span data-stu-id="28e6a-122">If any one of these applications calls [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect), all of the other applications for this identity/user participating in the group also connect to the group.</span></span> <span data-ttu-id="28e6a-123">如果某個應用程式在群組離線時新增了記錄，其他應用程式也可以看到它。</span><span class="sxs-lookup"><span data-stu-id="28e6a-123">If a record is added by one application while the group is offline, other applications are also be able to see it.</span></span> <span data-ttu-id="28e6a-124">如此一來，應用程式就必須隨時都可上線。</span><span class="sxs-lookup"><span data-stu-id="28e6a-124">As a result, an application must be ready to go online at any time.</span></span>

## <a name="connecting-to-a-peer-group-online"></a><span data-ttu-id="28e6a-125">連接至對等群組 (線上) </span><span class="sxs-lookup"><span data-stu-id="28e6a-125">Connecting to a Peer Group (Online)</span></span>

<span data-ttu-id="28e6a-126">若要開始參與群組，請在建立、加入或開啟群組之後，呼叫 [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) 。</span><span class="sxs-lookup"><span data-stu-id="28e6a-126">To begin participating in a group, call [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) after creating, joining, or opening the group.</span></span> <span data-ttu-id="28e6a-127">在此狀態下，您可以藉由呼叫 [**PeerGroupOpenDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection)，以其他對等參與相同群組的對等來開啟直接連接。</span><span class="sxs-lookup"><span data-stu-id="28e6a-127">In this state, direct connections can be opened with other peers participating in the same group by calling [**PeerGroupOpenDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection).</span></span>

<span data-ttu-id="28e6a-128">若要偵測連接嘗試是否失敗，請註冊對等 \_ 群組 \_ 事件 \_ 連接 \_ 失敗事件。</span><span class="sxs-lookup"><span data-stu-id="28e6a-128">To detect if a connection attempt has failed, register for the PEER\_GROUP\_EVENT\_CONNECTION\_FAILED event.</span></span> <span data-ttu-id="28e6a-129">如果群組基礎結構找不到另一個要連接的成員，或在同步處理群組資料庫之前連接失敗，而且無法建立另一個連接，就會引發此事件。</span><span class="sxs-lookup"><span data-stu-id="28e6a-129">This event is raised if the grouping infrastructure cannot find another member to connect to, or if the connection fails before the group database is synchronized and another connection cannot be established.</span></span>

<span data-ttu-id="28e6a-130">雖然在對等上執行的多個應用程式和參與相同對等身分識別的相同群組可能已離線，但任何一個應用程式所 [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) 的呼叫都會導致所有應用程式變成上線。</span><span class="sxs-lookup"><span data-stu-id="28e6a-130">Although multiple applications executing on the peer and participating in the same group with the same peer identity may be offline, a call to [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) by any one of the applications results in all of the applications becoming online.</span></span>

<span data-ttu-id="28e6a-131">此外，如果對等上的一個應用程式已連接到群組，則任何其他呼叫 [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin) 或 [**PeerGroupOpen**](/windows/desktop/api/P2P/nf-p2p-peergroupopen) 的應用程式也會立即連線。</span><span class="sxs-lookup"><span data-stu-id="28e6a-131">Also, if one application on the peer has connected to the group, any other applications that call [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin) or [**PeerGroupOpen**](/windows/desktop/api/P2P/nf-p2p-peergroupopen) are immediately connected as well.</span></span> <span data-ttu-id="28e6a-132">如果應用程式呼叫 [**PeerGroupClose**](/windows/desktop/api/P2P/nf-p2p-peergroupclose)，則只有該應用程式的控制碼會關閉。</span><span class="sxs-lookup"><span data-stu-id="28e6a-132">If an application calls [**PeerGroupClose**](/windows/desktop/api/P2P/nf-p2p-peergroupclose), the handle is closed for only that application.</span></span> <span data-ttu-id="28e6a-133">因此，應用程式所 **PeerGroupOpen** 的後續呼叫會傳回新的群組控制碼，而如果其他任何參與相同群組的應用程式仍在連線，應用程式就會立即上線。</span><span class="sxs-lookup"><span data-stu-id="28e6a-133">Thus, a subsequent call to **PeerGroupOpen** by the application returns a new group handle, and the application is brought online immediately if any other applications participating in the same group are still connected.</span></span>

## <a name="sending-and-receiving-data"></a><span data-ttu-id="28e6a-134">傳送和接收資料</span><span class="sxs-lookup"><span data-stu-id="28e6a-134">Sending and Receiving Data</span></span>

<span data-ttu-id="28e6a-135">若要在群組中的特定成員節點之間傳送和接收資料，必須使用您想要與之互動的成員來建立直接連接。</span><span class="sxs-lookup"><span data-stu-id="28e6a-135">To send and receive data between specific member nodes in the group, direct connections must be established with those members you intend to interact with.</span></span> <span data-ttu-id="28e6a-136">建立直接連線是非同步呼叫 [**PeerGroupOpenDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection)，它會傳入連接群組的控制碼，以及您想要連接之群組內的對等身分識別。</span><span class="sxs-lookup"><span data-stu-id="28e6a-136">Establishing a direct connection is an asynchronous call to [**PeerGroupOpenDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection), passing in the handle for a connected group as well as the identity of the peer within the group you wish to connect to.</span></span> <span data-ttu-id="28e6a-137">這個方法會傳回連接識別碼。</span><span class="sxs-lookup"><span data-stu-id="28e6a-137">This method will return a connection ID.</span></span> <span data-ttu-id="28e6a-138">如果呼叫成功，對 \_ \_ 等群組事件 \_ 直接 \_ 連接事件會在對等上引發，驗證連接識別碼。</span><span class="sxs-lookup"><span data-stu-id="28e6a-138">If the call is successful, a PEER\_GROUP\_EVENT\_DIRECT\_CONNECTION event is raised on the peer, validating the connection ID.</span></span>

<span data-ttu-id="28e6a-139">若要接收來自其他線上對等的直接連線，請透過呼叫 PeerGroupRegisterEvent 來註冊對等 \_ 群組 \_ 事件 \_ 直接 \_ 連接事件。 [](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent)</span><span class="sxs-lookup"><span data-stu-id="28e6a-139">To receive direct connections from other online peers, register for the PEER\_GROUP\_EVENT\_DIRECT\_CONNECTION event with a call to [**PeerGroupRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent).</span></span>

<span data-ttu-id="28e6a-140">成功建立直接連線之後，應用程式就可以開始使用 [**PeerGroupSendData**](/windows/desktop/api/P2P/nf-p2p-peergroupsenddata)呼叫傳送資料，並傳遞有效的連接識別碼。</span><span class="sxs-lookup"><span data-stu-id="28e6a-140">Once a direct connection has been successfully established, the application can begin sending data with calls to [**PeerGroupSendData**](/windows/desktop/api/P2P/nf-p2p-peergroupsenddata), passing the valid connection ID.</span></span> <span data-ttu-id="28e6a-141">多部分資料傳輸的排序是由 **PeerGroupSendData** 處理。</span><span class="sxs-lookup"><span data-stu-id="28e6a-141">The ordering of multipart data transmissions is handled by **PeerGroupSendData**.</span></span> <span data-ttu-id="28e6a-142">不過，應用程式應該執行適當的通訊協定堆疊，以處理此 API 呼叫所傳回的不透明資料。</span><span class="sxs-lookup"><span data-stu-id="28e6a-142">However, applications should implement a proper protocol stack for handling the opaque data returned by this API call.</span></span>

<span data-ttu-id="28e6a-143">若要透過直接連接接收資料，應用程式必須向 PeerGroupRegisterEvent 註冊對等 \_ 群組事件內送 \_ \_ \_ 資料[](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent)事件。</span><span class="sxs-lookup"><span data-stu-id="28e6a-143">To receive data over a direct connection, the application must register for the PEER\_GROUP\_EVENT\_INCOMING\_DATA event with [**PeerGroupRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent).</span></span> <span data-ttu-id="28e6a-144">事件處理常式會負責取得和排序不透明的資料，並將其傳遞至應用程式。</span><span class="sxs-lookup"><span data-stu-id="28e6a-144">The event handler is responsible for obtaining and ordering the opaque data, and passing it to the application.</span></span> <span data-ttu-id="28e6a-145">這項資料是透過呼叫 [**PeerGroupGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata) 與已註冊事件的控制碼，在事件處理常式中取得。</span><span class="sxs-lookup"><span data-stu-id="28e6a-145">This data is obtained within the event handler by calling [**PeerGroupGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata) with the handle to the registered events.</span></span>

<span data-ttu-id="28e6a-146">直接連接的關閉方式是呼叫 [**PeerGroupCloseDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupclosedirectconnection) ，並將先前呼叫所取得的連接識別碼傳入對 [](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection)等 \_ 事件 \_ 群組 \_ 直接連接的事件資料中，並傳入 PeerGroupOpenDirectConnection 或接收的連接識別碼 \_ 。</span><span class="sxs-lookup"><span data-stu-id="28e6a-146">A direct connection is closed by calling [**PeerGroupCloseDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupclosedirectconnection) and passing in the connection ID obtained by a previous call to [**PeerGroupOpenDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection) or received in the event data for PEER\_EVENT\_GROUP\_DIRECT\_CONNECTION.</span></span>

 

 



