---
description: 對等群組是一種技術，可讓開發人員快速且有效地建立安全的對等網路。
ms.assetid: ee72f60b-1e5b-4b69-bda0-2ae80734c144
title: 如何使用群組
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f7bebf958d0c3fdee6ad0dc400d495c54ec2e6fe
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104513412"
---
# <a name="how-to-work-with-groups"></a><span data-ttu-id="e0496-103">如何使用群組</span><span class="sxs-lookup"><span data-stu-id="e0496-103">How to Work With Groups</span></span>

<span data-ttu-id="e0496-104">對等群組是一種技術，可讓開發人員快速且有效地建立安全的對等網路。</span><span class="sxs-lookup"><span data-stu-id="e0496-104">Peer-to-peer Grouping is a technology that allows a developer to create a secure peer network quickly and effectively.</span></span> <span data-ttu-id="e0496-105">下列清單指出建立對等群組應用程式的主要考慮。</span><span class="sxs-lookup"><span data-stu-id="e0496-105">The following list identifies the major considerations in creating a peer grouping application.</span></span>

-   [<span data-ttu-id="e0496-106">取得對等身分識別</span><span class="sxs-lookup"><span data-stu-id="e0496-106">Obtaining a Peer Identity</span></span>](#obtaining-a-peer-identity)
-   [<span data-ttu-id="e0496-107">啟動對等群組</span><span class="sxs-lookup"><span data-stu-id="e0496-107">Starting Up a Peer Group</span></span>](#starting-up-the-peer-grouping-infrastructure)
-   [<span data-ttu-id="e0496-108">註冊群組事件</span><span class="sxs-lookup"><span data-stu-id="e0496-108">Registering for Grouping Events</span></span>](#registering-for-peer-grouping-events)
-   [<span data-ttu-id="e0496-109">連接到群組</span><span class="sxs-lookup"><span data-stu-id="e0496-109">Connecting to a Group</span></span>](#obtaining-a-group-handle)
-   [<span data-ttu-id="e0496-110">建立系統管理員和成員角色</span><span class="sxs-lookup"><span data-stu-id="e0496-110">Creating Administrator and Member Roles</span></span>](#creating-administrator-and-member-roles)
-   [<span data-ttu-id="e0496-111">尋找對等</span><span class="sxs-lookup"><span data-stu-id="e0496-111">Finding a Peer</span></span>](#finding-a-peer)
-   [<span data-ttu-id="e0496-112">直接連接至對等</span><span class="sxs-lookup"><span data-stu-id="e0496-112">Connecting Directly to a Peer</span></span>](#connecting-directly-to-a-peer)
-   [<span data-ttu-id="e0496-113">關閉和關閉群組</span><span class="sxs-lookup"><span data-stu-id="e0496-113">Closing and Shutting Down a Group</span></span>](#closing-and-shutting-down-a-peer-group)

## <a name="obtaining-a-peer-identity"></a><span data-ttu-id="e0496-114">取得對等身分識別</span><span class="sxs-lookup"><span data-stu-id="e0496-114">Obtaining a Peer Identity</span></span>

<span data-ttu-id="e0496-115">在建立或連接到群組之前，對等必須取得對等身分識別，這是用來唯一識別群組對等的名稱。</span><span class="sxs-lookup"><span data-stu-id="e0496-115">Before creating or connecting to a group, a peer must obtain a peer identity, which is a name used to uniquely identify a peer to a group.</span></span> <span data-ttu-id="e0496-116">若要取得對等上定義之所有對等身分識別的列舉清單，請呼叫 [**PeerEnumIdentities**](/windows/desktop/api/P2P/nf-p2p-peerenumidentities)，它會傳回列舉的控制碼。</span><span class="sxs-lookup"><span data-stu-id="e0496-116">To obtain an enumerated list of all peer identities defined on the peer, call [**PeerEnumIdentities**](/windows/desktop/api/P2P/nf-p2p-peerenumidentities), which returns a handle to the enumeration.</span></span> <span data-ttu-id="e0496-117">若要取得對等身分識別，請使用列舉控制碼和要取出的成員數目來呼叫 [**PeerGetNextItem**](/windows/desktop/api/P2P/nf-p2p-peergetnextitem) 。</span><span class="sxs-lookup"><span data-stu-id="e0496-117">To obtain the peer identities, call [**PeerGetNextItem**](/windows/desktop/api/P2P/nf-p2p-peergetnextitem) with the enumeration handle and the number of members to retrieve.</span></span> <span data-ttu-id="e0496-118">繼續呼叫 **PeerGetNextItem** ，直到 *pCount* 參數傳回的值小於要求的對等身分識別數目。</span><span class="sxs-lookup"><span data-stu-id="e0496-118">Continue calling **PeerGetNextItem** until the *pCount* parameter returns a value less than the number of peer identities requested.</span></span>

<span data-ttu-id="e0496-119">如果對等的對等身分識別不存在，則可以藉由呼叫 [**PeerIdentityCreate**](/windows/desktop/api/P2P/nf-p2p-peeridentitycreate)來建立。</span><span class="sxs-lookup"><span data-stu-id="e0496-119">If a peer identity for the peer does not exist, it can be created by calling [**PeerIdentityCreate**](/windows/desktop/api/P2P/nf-p2p-peeridentitycreate).</span></span> <span data-ttu-id="e0496-120">建立對等身分識別之後，對等會產生身分識別 XML blob，其中包含指派給它的公開金鑰。</span><span class="sxs-lookup"><span data-stu-id="e0496-120">After creating a peer identity, the peer generates an identity XML blob that contains the public key assigned to it</span></span>

<span data-ttu-id="e0496-121">呼叫 [**PeerIdentityGetXML**](/windows/desktop/api/P2P/nf-p2p-peeridentitygetxml)可取得對等身分識別資訊。</span><span class="sxs-lookup"><span data-stu-id="e0496-121">The peer identity information is obtained by calling [**PeerIdentityGetXML**](/windows/desktop/api/P2P/nf-p2p-peeridentitygetxml).</span></span> <span data-ttu-id="e0496-122">群組建立者或系統管理員會使用此對等身分識別資訊，來發出加入群組所需的認證，作為邀請 XML blob。</span><span class="sxs-lookup"><span data-stu-id="e0496-122">This peer identity information is used by the group creator or an administrator to issue the credentials needed to join the group, as an invitation XML blob.</span></span>

<span data-ttu-id="e0496-123">如需對等身分識別的詳細資訊，請參閱 [Identity MANAGER API](identity-manager-api.md) 檔</span><span class="sxs-lookup"><span data-stu-id="e0496-123">For more information on peer identities, please refer to the [Identity Manager API](identity-manager-api.md) documentation</span></span>

## <a name="starting-up-the-peer-grouping-infrastructure"></a><span data-ttu-id="e0496-124">啟動對等群組基礎結構</span><span class="sxs-lookup"><span data-stu-id="e0496-124">Starting Up the Peer Grouping Infrastructure</span></span>

<span data-ttu-id="e0496-125">在對等群組 API 中的任何函式由應用程式呼叫之前，必須先呼叫 [**PeerGroupStartup**](/windows/desktop/api/P2P/nf-p2p-peergroupstartup) 。</span><span class="sxs-lookup"><span data-stu-id="e0496-125">Before any function in the Peer Grouping API is called by an application, [**PeerGroupStartup**](/windows/desktop/api/P2P/nf-p2p-peergroupstartup) must be called.</span></span> <span data-ttu-id="e0496-126">此函數會初始化應用程式的對等群組基礎結構，並設定支援的版本。</span><span class="sxs-lookup"><span data-stu-id="e0496-126">This function initializes the Peer Grouping Infrastructure for the application and sets the supported version.</span></span>

## <a name="obtaining-a-group-handle"></a><span data-ttu-id="e0496-127">取得群組控制碼</span><span class="sxs-lookup"><span data-stu-id="e0496-127">Obtaining a Group Handle</span></span>

<span data-ttu-id="e0496-128">若要連接到群組並開始參與，必須取得對等群組的控制碼。</span><span class="sxs-lookup"><span data-stu-id="e0496-128">To connect to a group and begin participating, a handle to a peer group must be obtained.</span></span> <span data-ttu-id="e0496-129">下列清單會識別用來連接到對等群組的三種方式：</span><span class="sxs-lookup"><span data-stu-id="e0496-129">The following list identifies the three ways to connect to a peer group:</span></span>

-   <span data-ttu-id="e0496-130">藉由呼叫 [**PeerGroupCreate**](/windows/desktop/api/P2P/nf-p2p-peergroupcreate)來建立對等群組，這會初始化新的對等群組，並以擁有者和唯一系統管理員的對等來傳回有效的控制碼。</span><span class="sxs-lookup"><span data-stu-id="e0496-130">Creating a peer group by calling [**PeerGroupCreate**](/windows/desktop/api/P2P/nf-p2p-peergroupcreate), which initializes a new peer group and returns a valid handle with the peer as the owner and sole administrator.</span></span>
-   <span data-ttu-id="e0496-131">藉由呼叫 [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin)來加入對等群組。</span><span class="sxs-lookup"><span data-stu-id="e0496-131">Joining a peer group by calling [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin).</span></span> <span data-ttu-id="e0496-132">若要加入對等群組，對等必須收到對等群組系統管理員的邀請。</span><span class="sxs-lookup"><span data-stu-id="e0496-132">To join a peer group, a peer must receive an invitation from a peer group administrator.</span></span> <span data-ttu-id="e0496-133">若要取得邀請，請將身分識別資訊 XML blob 傳送給建立邀請的系統管理員，並使用外部機制（例如電子郵件或 FTP）將它傳送給您。</span><span class="sxs-lookup"><span data-stu-id="e0496-133">To obtain an invitation, send the identity information XML blob to the administrator who creates an invitation and sends it to you by an external mechanism, such as email or FTP.</span></span> <span data-ttu-id="e0496-134">邀請和對等身分識別會傳遞至 **PeerGroupJoin**，這會將有效的控制碼傳回給群組。</span><span class="sxs-lookup"><span data-stu-id="e0496-134">The invitation and peer identity are passed to **PeerGroupJoin**, which returns a valid handle to the group.</span></span>
-   <span data-ttu-id="e0496-135">藉由呼叫 [**PeerGroupOpen**](/windows/desktop/api/P2P/nf-p2p-peergroupopen)，開啟對等互連先前已加入的對等群組。</span><span class="sxs-lookup"><span data-stu-id="e0496-135">Opening a peer group that a peer has joined previously by calling [**PeerGroupOpen**](/windows/desktop/api/P2P/nf-p2p-peergroupopen).</span></span> <span data-ttu-id="e0496-136">在此情況下，不需要取得邀請。</span><span class="sxs-lookup"><span data-stu-id="e0496-136">In this situation, obtaining an invitation is not necessary.</span></span>

<span data-ttu-id="e0496-137">從上述其中一個函式取得有效的對等群組控制碼之後，您可以使用新的控制碼呼叫 [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) ，以連接到對等群組。</span><span class="sxs-lookup"><span data-stu-id="e0496-137">After you obtain a valid peer group handle from one of the above functions, you can connect to a peer group by calling [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) with the new handle.</span></span>

> [!Note]  
> <span data-ttu-id="e0496-138">如果對等群組的連接失敗， \_ 就會發生「對等群組 \_ 事件 \_ 連接 \_ 失敗」事件。</span><span class="sxs-lookup"><span data-stu-id="e0496-138">If the connection to a peer group fails, the PEER\_GROUP\_EVENT\_CONNECTION\_FAILED event occurs.</span></span> <span data-ttu-id="e0496-139">處理常式可以嘗試重新建立對等群組的連接。</span><span class="sxs-lookup"><span data-stu-id="e0496-139">The handler can attempt to reestablish the connection to the peer group.</span></span>

 

## <a name="registering-for-peer-grouping-events"></a><span data-ttu-id="e0496-140">註冊對等群組事件</span><span class="sxs-lookup"><span data-stu-id="e0496-140">Registering for Peer Grouping Events</span></span>

<span data-ttu-id="e0496-141">對等互連參與對等群組之前，對等體必須註冊對等群組事件。</span><span class="sxs-lookup"><span data-stu-id="e0496-141">Before a peer participates in a peer group, the peer must register for peer group events.</span></span> <span data-ttu-id="e0496-142">若要註冊特定的對等事件，請呼叫 [**PeerGroupRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent)，然後傳入對等 \_ 群組 \_ 事件種類中定義的一或多個對等事件種類 \_ 。</span><span class="sxs-lookup"><span data-stu-id="e0496-142">To register for specific peer events, call [**PeerGroupRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent), and pass in one or more of the peer event types defined in PEER\_GROUP\_EVENT\_TYPE.</span></span> <span data-ttu-id="e0496-143">您必須註冊適用于應用程式的每個對等事件;例如，若要透過直接連接接收資料，請註冊對等 \_ 群組 \_ 事件 \_ 直接 \_ 連接和對等 \_ 群組事件內送 \_ \_ \_ 資料事件。</span><span class="sxs-lookup"><span data-stu-id="e0496-143">You must register for each peer event that applies to your application; for example, to receive data over a direct connection, register for the PEER\_GROUP\_EVENT\_DIRECT\_CONNECTION and PEER\_GROUP\_EVENT\_INCOMING\_DATA events.</span></span> <span data-ttu-id="e0496-144">每個呼叫都會接受一個事件控制碼，並傳回該對等事件的 **HPEEREVENT** 控制碼。</span><span class="sxs-lookup"><span data-stu-id="e0496-144">Each call takes an event handle and returns an **HPEEREVENT** handle for that peer event.</span></span>

<span data-ttu-id="e0496-145">事件處理常式可以將已註冊之對等事件的控制碼傳遞至 [**PeerGroupGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata)，以取得與對等事件相關聯的資料。</span><span class="sxs-lookup"><span data-stu-id="e0496-145">Event handlers can obtain the data associated with a peer event by passing the handle to registered peer events to [**PeerGroupGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata).</span></span> <span data-ttu-id="e0496-146">此對等事件資料會以對等 \_ 群組 \_ 事件資料聯集的形式傳回 \_ 。</span><span class="sxs-lookup"><span data-stu-id="e0496-146">This peer event data is returned as a PEER\_GROUP\_EVENT\_DATA union.</span></span> <span data-ttu-id="e0496-147">如果對等事件佇列是空的，則此函式會傳回對等 \_ S \_ 沒有任何 \_ 事件 \_ 資料。</span><span class="sxs-lookup"><span data-stu-id="e0496-147">If the peer event queue is empty, this function returns PEER\_S\_NO\_EVENT\_DATA.</span></span>

<span data-ttu-id="e0496-148">您可以藉由呼叫 [**PeerGroupUnregisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergroupunregisterevent) 並提供您想要取消註冊之對等事件的控制碼，以取消註冊對等事件。</span><span class="sxs-lookup"><span data-stu-id="e0496-148">You can unregister for peer events by calling [**PeerGroupUnregisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergroupunregisterevent) and providing the handle for the peer event you want to unregister.</span></span> <span data-ttu-id="e0496-149">呼叫函式之後，與控制碼相關聯的對等事件就不再註冊。</span><span class="sxs-lookup"><span data-stu-id="e0496-149">After the function is called, the peer events associated with the handle are no longer registered.</span></span>

## <a name="creating-administrator-and-member-roles"></a><span data-ttu-id="e0496-150">建立系統管理員和成員角色</span><span class="sxs-lookup"><span data-stu-id="e0496-150">Creating Administrator and Member Roles</span></span>

<span data-ttu-id="e0496-151">建立對等群組的對等稱為「對等群組建立者」，預設為「系統管理員」角色。</span><span class="sxs-lookup"><span data-stu-id="e0496-151">The peer who creates the peer group is known as the peer group creator, and has the administrator role by default.</span></span> <span data-ttu-id="e0496-152">只有對等群組建立者可以設定群組屬性。</span><span class="sxs-lookup"><span data-stu-id="e0496-152">Only the peer group creator can set the group properties.</span></span>

<span data-ttu-id="e0496-153">受邀至對等群組的對等可以是系統管理員或成員。</span><span class="sxs-lookup"><span data-stu-id="e0496-153">Peers invited to the peer group can be either an administrator or a member.</span></span> <span data-ttu-id="e0496-154">如果系統管理員將發出邀請的系統管理員角色指派給他們，他們可以邀請新成員加入對等群組，並同樣地將系統管理員角色指派給其他成員。</span><span class="sxs-lookup"><span data-stu-id="e0496-154">If they are assigned an administrator role by the administrator issuing the invitation, they can invite new members to the peer group, and likewise assign the administrator role to other members.</span></span>

<span data-ttu-id="e0496-155">對等群組成員的角色是在系統管理員提供給成員的邀請中設定。</span><span class="sxs-lookup"><span data-stu-id="e0496-155">The roles of peer group members are set in the invitations the administrator gives to a member.</span></span> <span data-ttu-id="e0496-156">若要新增更多系統管理員，請 [](/windows/desktop/api/P2P/nf-p2p-peergroupcreateinvitation) \_ \_ \_ 在建立邀請時，將 PeerGroupCreateInvitation 的 pRoles 參數值設定為對等群組角色系統管理員。</span><span class="sxs-lookup"><span data-stu-id="e0496-156">To add more administrators, set the value of the *pRoles* parameter of [**PeerGroupCreateInvitation**](/windows/desktop/api/P2P/nf-p2p-peergroupcreateinvitation) to PEER\_GROUP\_ROLE\_ADMIN when creating an invitation.</span></span>

<span data-ttu-id="e0496-157">成員可以參與對等群組，但無法邀請及授權新的成員、設定群組屬性，或更新或刪除他們未特別建立的群組記錄。</span><span class="sxs-lookup"><span data-stu-id="e0496-157">Members can participate in a peer group, but cannot invite and authorize new members, set group properties, or update or delete group records that they do not specifically create.</span></span> <span data-ttu-id="e0496-158">若要將成員狀態指派給參與的對等，請 [](/windows/desktop/api/P2P/nf-p2p-peergroupcreateinvitation) \_ \_ \_ 在建立該對等的邀請時，將 PeerGroupCreateInvitation 的 pRoles 參數值設定為對等群組角色成員。</span><span class="sxs-lookup"><span data-stu-id="e0496-158">To assign member status to a participating peer, set the value of the **pRoles** parameter of [**PeerGroupCreateInvitation**](/windows/desktop/api/P2P/nf-p2p-peergroupcreateinvitation) to PEER\_GROUP\_ROLE\_MEMBER when you create an invitation for that peer.</span></span>

<span data-ttu-id="e0496-159">若要變更成員的角色，必須將包含新角色的新認證發行給該成員。</span><span class="sxs-lookup"><span data-stu-id="e0496-159">To change the role of a member, new credentials containing the new role must be issued to that member.</span></span> <span data-ttu-id="e0496-160">若要完成此動作，請從 PeerGroupEnumMembers 傳回的對等成員結構取得這個成員的 [**對等 \_ 認證 \_ 資訊**](/windows/desktop/api/P2P/ns-p2p-peer_credential_info)結構 \_ 。 [](/windows/desktop/api/P2P/nf-p2p-peergroupenummembers)</span><span class="sxs-lookup"><span data-stu-id="e0496-160">To accomplish this, obtain the [**PEER\_CREDENTIAL\_INFO**](/windows/desktop/api/P2P/ns-p2p-peer_credential_info) structure for this member from the PEER\_MEMBER structure returned by [**PeerGroupEnumMembers**](/windows/desktop/api/P2P/nf-p2p-peergroupenummembers).</span></span> <span data-ttu-id="e0496-161">將 **對等 \_ 認證 \_ 資訊** 中的 **pRoles** 欄位變更為新的角色，並將結構傳遞至 [**PeerGroupIssueCredentials**](/windows/desktop/api/P2P/nf-p2p-peergroupissuecredentials)。</span><span class="sxs-lookup"><span data-stu-id="e0496-161">Change the **pRoles** field in **PEER\_CREDENTIAL\_INFO** to the new role, and pass the structure to [**PeerGroupIssueCredentials**](/windows/desktop/api/P2P/nf-p2p-peergroupissuecredentials).</span></span>

<span data-ttu-id="e0496-162">新的認證在連線到對等群組之前，將不會對對等的作用。</span><span class="sxs-lookup"><span data-stu-id="e0496-162">The new credentials will not go into effect for the peer until they connect to the peer group.</span></span> <span data-ttu-id="e0496-163">如果目前已連線，則必須關閉群組並重新連線，以取得更新的認證。</span><span class="sxs-lookup"><span data-stu-id="e0496-163">If they are currently connected, they must close the group and reconnect to obtain the updated credentials.</span></span>

## <a name="finding-a-peer"></a><span data-ttu-id="e0496-164">尋找對等</span><span class="sxs-lookup"><span data-stu-id="e0496-164">Finding a Peer</span></span>

<span data-ttu-id="e0496-165">若要取得參與對等群組之所有對等的列舉清單，請使用群組控制碼呼叫 [**PeerGroupEnumMembers**](/windows/desktop/api/P2P/nf-p2p-peergroupenummembers) ，此控制碼會傳回列舉的控制碼。</span><span class="sxs-lookup"><span data-stu-id="e0496-165">To obtain an enumerated list of all peers participating in the peer group, call [**PeerGroupEnumMembers**](/windows/desktop/api/P2P/nf-p2p-peergroupenummembers) with the group handle, which returns a handle to the enumeration.</span></span> <span data-ttu-id="e0496-166">若要取得成員，請使用列舉控制碼和要取出的成員數目來呼叫 [**PeerGetNextItem**](/windows/desktop/api/P2P/nf-p2p-peergetnextitem) 。</span><span class="sxs-lookup"><span data-stu-id="e0496-166">To obtain the members, call [**PeerGetNextItem**](/windows/desktop/api/P2P/nf-p2p-peergetnextitem) with the enum handle and the number of members to retrieve.</span></span> <span data-ttu-id="e0496-167">繼續呼叫 **PeerGetNextItem** ，直到 *pCount* 參數傳回的值小於要求的成員數目。</span><span class="sxs-lookup"><span data-stu-id="e0496-167">Continue calling **PeerGetNextItem** until the *pCount* parameter returns a value less than the number of members requested.</span></span> <span data-ttu-id="e0496-168">請注意，可能不會傳回可用成員的完整清單。</span><span class="sxs-lookup"><span data-stu-id="e0496-168">Note that the complete list of available members may not be returned.</span></span>

<span data-ttu-id="e0496-169">每個成員都會表示為 [**對等 \_ 成員**](/windows/desktop/api/P2P/ns-p2p-peer_member) 結構，其中包含作用中對等的對等、節點識別碼和 IP 位址的識別。</span><span class="sxs-lookup"><span data-stu-id="e0496-169">Each member is represented as a [**PEER\_MEMBER**](/windows/desktop/api/P2P/ns-p2p-peer_member) structure, which contains the identity of the peer, node IDs, and IP addresses for active peers.</span></span>

<span data-ttu-id="e0496-170">完成時，請藉由呼叫 [**PeerEndEnumeration**](/windows/desktop/api/P2P/nf-p2p-peerendenumeration)來關閉列舉並釋放相關聯的記憶體。</span><span class="sxs-lookup"><span data-stu-id="e0496-170">When finished, close the enumeration and release the associated memory by calling [**PeerEndEnumeration**](/windows/desktop/api/P2P/nf-p2p-peerendenumeration).</span></span>

## <a name="connecting-directly-to-a-peer"></a><span data-ttu-id="e0496-171">直接連接至對等</span><span class="sxs-lookup"><span data-stu-id="e0496-171">Connecting Directly to a Peer</span></span>

<span data-ttu-id="e0496-172">當對等互連連線至對等群組時，會藉由呼叫 [**PeerGroupOpenDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection) 並提供另一個對等的身分識別，來初始化與其他連接的成員進行的直接交換。</span><span class="sxs-lookup"><span data-stu-id="e0496-172">When a peer is connected to a peer group, direct one-to-one exchanges with other connected members are initiated by calling [**PeerGroupOpenDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection) and supplying the identity of the other peer.</span></span> <span data-ttu-id="e0496-173">此呼叫是非同步，而且會傳回64位的連接識別碼。</span><span class="sxs-lookup"><span data-stu-id="e0496-173">This call is asynchronous, and returns a 64-bit connection ID.</span></span> <span data-ttu-id="e0496-174">如果呼叫成功，您會收到對等 \_ 群組 \_ 事件 \_ DIRECT \_ 連接 \_ 事件對等事件，指出連接成功。</span><span class="sxs-lookup"><span data-stu-id="e0496-174">If the call is successful, you receive the PEER\_GROUP\_EVENT\_DIRECT\_CONNECTION\_EVENT peer event to indicate that the connection is successful.</span></span> <span data-ttu-id="e0496-175">如果連接成功，連接識別碼會是有效的，而且可用來透過直接連接來傳送和接收資料。</span><span class="sxs-lookup"><span data-stu-id="e0496-175">If the connection is successful, the connection ID is valid and can be used to send and receive data through the direct connection.</span></span>

<span data-ttu-id="e0496-176">若要能夠接收直接連接，另一個對等也必須先前註冊對等 \_ 群組 \_ 事件 \_ 直接 \_ 連接對等事件。</span><span class="sxs-lookup"><span data-stu-id="e0496-176">To be able to receive direct connections, the other peer must also have previously registered for the PEER\_GROUP\_EVENT\_DIRECT\_CONNECTION peer event.</span></span>

<span data-ttu-id="e0496-177">若要將資料傳送給對等，請使用有效的連接識別碼呼叫 [**PeerGroupSendData**](/windows/desktop/api/P2P/nf-p2p-peergroupsenddata) 。</span><span class="sxs-lookup"><span data-stu-id="e0496-177">To send data to a peer, call [**PeerGroupSendData**](/windows/desktop/api/P2P/nf-p2p-peergroupsenddata) with a valid connection ID.</span></span> <span data-ttu-id="e0496-178">若要接收資料，必須為對等 \_ 群組 \_ 事件 \_ 傳入 \_ 資料對等事件註冊另一個對等。</span><span class="sxs-lookup"><span data-stu-id="e0496-178">To receive data, the other peer must be registered for the PEER\_GROUP\_EVENT\_INCOMING\_DATA peer event.</span></span> <span data-ttu-id="e0496-179">同樣地，如果傳送對等想要接收資料，它也必須針對對等 \_ 群組事件內送 \_ \_ \_ 資料對等事件註冊。</span><span class="sxs-lookup"><span data-stu-id="e0496-179">Likewise, if the sending peer wants to receive data in turn, it also must be registered for the PEER\_GROUP\_EVENT\_INCOMING\_DATA peer event.</span></span>

<span data-ttu-id="e0496-180">若要接收群組中其他對等目前作用中直接連接的總集合，請呼叫 [**PeerGroupEnumConnections**](/windows/desktop/api/P2P/nf-p2p-peergroupenumconnections) 開啟列舉，然後使用 [**PeerGetNextItem**](/windows/desktop/api/P2P/nf-p2p-peergetnextitem)來逐一查看連接清單。</span><span class="sxs-lookup"><span data-stu-id="e0496-180">To receive the total set of currently active direct connections with other peers in a group, call [**PeerGroupEnumConnections**](/windows/desktop/api/P2P/nf-p2p-peergroupenumconnections) to open the enumeration and iterate through the list of connections by using [**PeerGetNextItem**](/windows/desktop/api/P2P/nf-p2p-peergetnextitem).</span></span>

<span data-ttu-id="e0496-181">若要關閉直接連接，請呼叫 [**PeerGroupCloseDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupclosedirectconnection) 並傳入連接識別碼。</span><span class="sxs-lookup"><span data-stu-id="e0496-181">To close a direct connection, call [**PeerGroupCloseDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupclosedirectconnection) and pass in the connection ID.</span></span>

## <a name="closing-and-shutting-down-a-peer-group"></a><span data-ttu-id="e0496-182">關閉和關閉對等群組</span><span class="sxs-lookup"><span data-stu-id="e0496-182">Closing and Shutting Down a Peer Group</span></span>

<span data-ttu-id="e0496-183">若要關閉對等群組的連接，請呼叫 [**PeerGroupClose**](/windows/desktop/api/P2P/nf-p2p-peergroupclose)，使群組控制碼失效，但不關閉對等群組基礎結構。</span><span class="sxs-lookup"><span data-stu-id="e0496-183">To close a connection to a peer group, call [**PeerGroupClose**](/windows/desktop/api/P2P/nf-p2p-peergroupclose), which invalidates the group handle, but does not shut down the Peer Grouping Infrastructure.</span></span> <span data-ttu-id="e0496-184">呼叫 [**PeerGroupDelete**](/windows/desktop/api/P2P/nf-p2p-peergroupdelete)會刪除對等群組資料。</span><span class="sxs-lookup"><span data-stu-id="e0496-184">Peer-to-peer group data is deleted by calling [**PeerGroupDelete**](/windows/desktop/api/P2P/nf-p2p-peergroupdelete).</span></span>

<span data-ttu-id="e0496-185">當應用程式使用對等群組基礎結構完成時，必須呼叫 [**PeerGroupShutdown**](/windows/desktop/api/P2P/nf-p2p-peergroupshutdown)。</span><span class="sxs-lookup"><span data-stu-id="e0496-185">When the application is finished using the Peer Grouping Infrastructure, it must call [**PeerGroupShutdown**](/windows/desktop/api/P2P/nf-p2p-peergroupshutdown).</span></span>

 

 



