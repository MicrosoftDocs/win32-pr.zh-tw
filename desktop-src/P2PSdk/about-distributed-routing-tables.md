---
description: 分散式路由表 (的 DRT) 存在作為合作節點的網格，其中每個節點都是使用 DRT API 的應用程式實例。
ms.assetid: 257ad7ea-636b-45f2-b514-4a213939d107
title: 關於分散式路由表
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2dfca9f81cc609d97584ef5a11f999722c696858
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "103849323"
---
# <a name="about-distributed-routing-tables"></a><span data-ttu-id="e0906-103">關於分散式路由表</span><span class="sxs-lookup"><span data-stu-id="e0906-103">About Distributed Routing Tables</span></span>

<span data-ttu-id="e0906-104">分散式路由表 (的 DRT) 存在作為合作節點的網格，其中每個節點都是使用 DRT API 的應用程式實例。</span><span class="sxs-lookup"><span data-stu-id="e0906-104">A Distributed Routing Table (DRT) exists as a mesh of cooperating nodes, where each node is an instance of an application using the DRT API.</span></span> <span data-ttu-id="e0906-105">發佈金鑰的節點負責協助其他節點發布和解析金鑰。</span><span class="sxs-lookup"><span data-stu-id="e0906-105">Nodes that publish keys are responsible for assisting other nodes publish and resolve keys.</span></span> <span data-ttu-id="e0906-106">節點也可以參與「僅解決」的方式，這不需要它們來協助對等。</span><span class="sxs-lookup"><span data-stu-id="e0906-106">Nodes can also participate in a "resolve only" fashion, which does not require them to assist peers.</span></span> <span data-ttu-id="e0906-107">DRT 通訊協定會透過 UDP/IPv6 傳輸來執行。</span><span class="sxs-lookup"><span data-stu-id="e0906-107">The DRT protocol executes over a UDP/IPv6 transport.</span></span>

<span data-ttu-id="e0906-108">一個節點，它會發佈金鑰組建，並維護網格中其他節點的本機路由表。</span><span class="sxs-lookup"><span data-stu-id="e0906-108">A node that publishes a key builds and maintains a local routing table of other nodes in the mesh.</span></span> <span data-ttu-id="e0906-109">此路由表經過優化，可讓節點藉由直接在本機路由表中尋找金鑰，或要求其他節點以接近目標的方式來發佈索引鍵，來快速找到網格中的特定索引鍵。</span><span class="sxs-lookup"><span data-stu-id="e0906-109">This routing table is optimized so that the node can quickly locate a specific key in the mesh by finding the key directly in the local routing table, or by asking other nodes publishing keys numerically close to the target.</span></span> <span data-ttu-id="e0906-110">此動作會重複，直到找到必要的索引鍵或節點判斷沒有這類金鑰存在為止。</span><span class="sxs-lookup"><span data-stu-id="e0906-110">This action is repeated until the required key is found or the node determines that no such key exists.</span></span>

<span data-ttu-id="e0906-111">DRT 金鑰是256位不帶正負號的整數。</span><span class="sxs-lookup"><span data-stu-id="e0906-111">DRT keys are 256-bit unsigned integers.</span></span> <span data-ttu-id="e0906-112">索引鍵之間的接近程度會以兩者之間的數值差異來定義。</span><span class="sxs-lookup"><span data-stu-id="e0906-112">Closeness between keys is defined by the numerical difference between them.</span></span> <span data-ttu-id="e0906-113">將 DRT keyspace 視為圓形。</span><span class="sxs-lookup"><span data-stu-id="e0906-113">The DRT keyspace is considered circular.</span></span> <span data-ttu-id="e0906-114">例如，第一個可能的索引鍵值和最後一個可能的金鑰值視為相鄰。</span><span class="sxs-lookup"><span data-stu-id="e0906-114">For example, the first possible key value, and the last possible key value are considered neighbors.</span></span>

<span data-ttu-id="e0906-115">在安全的 DRT 中，需要有節點來驗證它們所發佈的金鑰。</span><span class="sxs-lookup"><span data-stu-id="e0906-115">In a secure DRT, nodes are required to authenticate the keys they publish.</span></span> <span data-ttu-id="e0906-116">當您初始化了 DRT 時，必須使用 DRT API 來設定節點用來驗證金鑰的機制。</span><span class="sxs-lookup"><span data-stu-id="e0906-116">The mechanism by which nodes authenticate keys must be set using the DRT API when the DRT is initialized.</span></span> <span data-ttu-id="e0906-117">這是藉由選擇適用于 DRT 的安全性提供者來完成。</span><span class="sxs-lookup"><span data-stu-id="e0906-117">This is done by choosing a security provider for the DRT.</span></span> <span data-ttu-id="e0906-118">安全性提供者是一個模組，可產生用來驗證金鑰的權杖，以及驗證其他節點所產生的權杖。</span><span class="sxs-lookup"><span data-stu-id="e0906-118">A security provider is a module that can produce tokens used to authenticate keys, and verify tokens produced by other nodes.</span></span> <span data-ttu-id="e0906-119">它必須執行本檔中定義的安全性提供者介面。</span><span class="sxs-lookup"><span data-stu-id="e0906-119">It must implement the security provider interface that is defined in this documentation.</span></span> <span data-ttu-id="e0906-120">Windows 7 DRT 隨附兩個完全實行的安全性提供者，可用於建立 Windows 應用程式。</span><span class="sxs-lookup"><span data-stu-id="e0906-120">The Windows 7 DRT ships with two fully implemented security providers that can be used to build Windows applications.</span></span>

<span data-ttu-id="e0906-121">在初始化期間，應用程式也必須提供啟動程式提供者的 DRT。</span><span class="sxs-lookup"><span data-stu-id="e0906-121">During initialization, an application must also supply the DRT with a bootstrap provider.</span></span> <span data-ttu-id="e0906-122">啟動載入器提供者是一個模組，可抓取在 DRT 網狀中已存在之節點的網路端點，並在建立新節點時由該模組呼叫。</span><span class="sxs-lookup"><span data-stu-id="e0906-122">The bootstrap provider is a module that can retrieve the network endpoints of nodes already present in the DRT mesh, and is called upon by the DRT when a new node is established.</span></span> <span data-ttu-id="e0906-123">和安全性提供者模組一樣，啟動載入器提供者必須執行妥善定義的介面。</span><span class="sxs-lookup"><span data-stu-id="e0906-123">Like the security provider module, the bootstrap provider must implement a well defined interface.</span></span> <span data-ttu-id="e0906-124">Windows 7 DRT 隨附兩個完全實行的啟動程式提供者。</span><span class="sxs-lookup"><span data-stu-id="e0906-124">The Windows 7 DRT ships with two fully implemented bootstrap providers.</span></span>

<span data-ttu-id="e0906-125">DRT 會考慮金鑰的直屬鄰居（特殊）。</span><span class="sxs-lookup"><span data-stu-id="e0906-125">The DRT considers the immediate neighbors of a key special.</span></span> <span data-ttu-id="e0906-126">這五個最接近的索引鍵會以較小的數位，而最接近的五個索引鍵則會大於已發佈的按鍵格式</span><span class="sxs-lookup"><span data-stu-id="e0906-126">The five closest keys numerically smaller and the five closest keys numerically larger than a published key form what is called a leaf set.</span></span> <span data-ttu-id="e0906-127">DRT 會透過 DRT API，將變更回報給某個金鑰的分葉組。</span><span class="sxs-lookup"><span data-stu-id="e0906-127">The DRT reports changes to the leaf set of a key through the DRT API.</span></span>

## <a name="drt-life-cycle-and-state-transitions"></a><span data-ttu-id="e0906-128">DRT 生命週期和狀態轉換</span><span class="sxs-lookup"><span data-stu-id="e0906-128">DRT Life Cycle and State Transitions</span></span>

<span data-ttu-id="e0906-129">應用程式可以使用 [**DrtOpen**](/windows/desktop/api/drt/nf-drt-drtopen) 函式來初始化本機的 DRT 實例。</span><span class="sxs-lookup"><span data-stu-id="e0906-129">An application can initialize a local DRT instance using the [**DrtOpen**](/windows/desktop/api/drt/nf-drt-drtopen) function.</span></span> <span data-ttu-id="e0906-130">此函式會觸發開機載入程式，其中的 DRT API 會在啟動載入器提供者上呼叫，以瞭解已參與 DRT 的其他節點的金鑰和網路端點。</span><span class="sxs-lookup"><span data-stu-id="e0906-130">This function triggers the bootstrapping process, where the DRT API calls upon the bootstrap provider to learn the keys and network endpoints of other nodes already participating in the DRT.</span></span> <span data-ttu-id="e0906-131">如果啟動載入器提供者成功找到至少一個其他節點，則 DRT 會進入 [DRT \_ 主動] 狀態。</span><span class="sxs-lookup"><span data-stu-id="e0906-131">If the bootstrap provider successfully locates at least one other node, the DRT enters the DRT\_ACTIVE state.</span></span> <span data-ttu-id="e0906-132">在此狀態下，應用程式可以搜尋由其他節點發布的金鑰，並且可以發佈可以解析的金鑰。</span><span class="sxs-lookup"><span data-stu-id="e0906-132">In this state, the application can search for keys published by other nodes, and can publish keys that can be resolved.</span></span> <span data-ttu-id="e0906-133">如果啟動載入器提供者無法成功找出其他節點，則 DRT 會進入「僅限 DRT」 \_ 狀態。</span><span class="sxs-lookup"><span data-stu-id="e0906-133">If the bootstrap provider cannot successfully locate other nodes, the DRT enters the DRT\_ALONE state.</span></span> <span data-ttu-id="e0906-134">此 DRT 將保持在「僅限在 DRT」 \_ 狀態，並會嘗試定期啟動以找出對等，並移至「drt \_ 主動」狀態。</span><span class="sxs-lookup"><span data-stu-id="e0906-134">The DRT will stay in the DRT\_ALONE state and will attempt to bootstrap periodically in order to locate peers and move to the DRT\_ACTIVE state.</span></span>

<span data-ttu-id="e0906-135">節點可以從「DRT 主動」轉換至這些狀態 \_ 。</span><span class="sxs-lookup"><span data-stu-id="e0906-135">A node can transition to these states from DRT\_ACTIVE.</span></span>

| <span data-ttu-id="e0906-136">生命週期狀態</span><span class="sxs-lookup"><span data-stu-id="e0906-136">Life Cycle State</span></span> | <span data-ttu-id="e0906-137">條件</span><span class="sxs-lookup"><span data-stu-id="e0906-137">Conditions</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                 |
|------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="e0906-138">單獨的 DRT \_</span><span class="sxs-lookup"><span data-stu-id="e0906-138">DRT\_ALONE</span></span>       | <span data-ttu-id="e0906-139">本機節點尚未探索到在 DRT 中的其他節點。</span><span class="sxs-lookup"><span data-stu-id="e0906-139">The local node has not discovered other nodes in the DRT.</span></span> <span data-ttu-id="e0906-140">處於此狀態時，節點會繼續接聽在 DRT 內的其他節點。</span><span class="sxs-lookup"><span data-stu-id="e0906-140">While in this state, the node continues to listen for other nodes within the DRT.</span></span><br/> <span data-ttu-id="e0906-141">如果另一個節點加入了 DRT，本機節點將會轉換為 [DRT \_ 主動] 狀態。</span><span class="sxs-lookup"><span data-stu-id="e0906-141">If another node joins the DRT, the local node will transition to the DRT\_ACTIVE state.</span></span> <span data-ttu-id="e0906-142">如果網路已關閉，則會轉換為「 \_ 無法進行 \_ 網路」。</span><span class="sxs-lookup"><span data-stu-id="e0906-142">If the network is down, it will transition to DRT\_NO\_NETWORK.</span></span> <span data-ttu-id="e0906-143">發生嚴重錯誤時，節點將會轉換為「DRT 錯誤」 \_ 狀態。</span><span class="sxs-lookup"><span data-stu-id="e0906-143">In the event of a serious error with the DRT the node will transition to the DRT\_FAULTED state.</span></span><br/> |
| <span data-ttu-id="e0906-144">DRT \_ 無 \_ 網路</span><span class="sxs-lookup"><span data-stu-id="e0906-144">DRT\_NO\_NETWORK</span></span> | <span data-ttu-id="e0906-145">當節點失去網路連線時，它會轉換為「 \_ 無 \_ 網路」狀態。</span><span class="sxs-lookup"><span data-stu-id="e0906-145">When a node loses network connectivity, it transitions to the DRT\_NO\_NETWORK state.</span></span> <span data-ttu-id="e0906-146">此時，應用程式可以等待還原網路連線，並可關閉 DRT。</span><span class="sxs-lookup"><span data-stu-id="e0906-146">At this point the application can wait for network connectivity to be restored, and can close the DRT.</span></span><br/>                                                                                                                                                                                                                    |
| <span data-ttu-id="e0906-147">DRT \_ 發生錯誤</span><span class="sxs-lookup"><span data-stu-id="e0906-147">DRT\_FAULTED</span></span>     | <span data-ttu-id="e0906-148">本機節點內發生嚴重錯誤。</span><span class="sxs-lookup"><span data-stu-id="e0906-148">A serious error has occurred within the local node.</span></span> <span data-ttu-id="e0906-149">例如，如果本機電腦用盡實體記憶體。</span><span class="sxs-lookup"><span data-stu-id="e0906-149">For example, if the local machine runs out of physical memory.</span></span><br/> <span data-ttu-id="e0906-150">當節點進入此狀態時，應用程式必須呼叫 [**DrtClose**](/windows/desktop/api/drt/nf-drt-drtclose) API、更正問題，然後使用 [**DrtOpen**](/windows/desktop/api/drt/nf-drt-drtopen)重新初始化該 DRT。</span><span class="sxs-lookup"><span data-stu-id="e0906-150">While a node enters this state, the application must call the [**DrtClose**](/windows/desktop/api/drt/nf-drt-drtclose) API, correct the problem, and re-initialize the DRT with [**DrtOpen**](/windows/desktop/api/drt/nf-drt-drtopen).</span></span><br/>                                                                                                   |



 

## <a name="related-topics"></a><span data-ttu-id="e0906-151">相關主題</span><span class="sxs-lookup"><span data-stu-id="e0906-151">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="e0906-152">使用分散式路由資料表 API</span><span class="sxs-lookup"><span data-stu-id="e0906-152">Using the Distributed Routing Table API</span></span>](using-the-distributed-routing-table-api.md)
</dt> <dt>

[<span data-ttu-id="e0906-153">分散式路由資料表 API 參考</span><span class="sxs-lookup"><span data-stu-id="e0906-153">Distributed Routing Table API Reference</span></span>](distributed-routing-table-api-reference.md)
</dt> </dl>

 

 




