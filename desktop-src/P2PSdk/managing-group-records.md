---
description: 群組記錄是發佈至對等群組的所有作用中成員的特定資料，例如聊天訊息或應用程式特定的狀態更新。
ms.assetid: 073ee4e9-0e97-451a-a808-8265575d073c
title: 管理群組記錄
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3b6d9e3257cc597b715dc9c65eb5945c00c15286
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "106987540"
---
# <a name="managing-group-records"></a><span data-ttu-id="fb043-103">管理群組記錄</span><span class="sxs-lookup"><span data-stu-id="fb043-103">Managing Group Records</span></span>

<span data-ttu-id="fb043-104">群組記錄是發佈至對等群組的所有作用中成員的特定資料，例如聊天訊息或應用程式特定的狀態更新。</span><span class="sxs-lookup"><span data-stu-id="fb043-104">A group record is specific data published to all active members of a peer group, for example, a chat message or an application-specific status update.</span></span> <span data-ttu-id="fb043-105">記錄是以 [**對等 \_ 記錄**](/windows/desktop/api/P2P/ns-p2p-peer_record) 結構表示，並包含下列有關對等的資訊：</span><span class="sxs-lookup"><span data-stu-id="fb043-105">A record is represented by the [**PEER\_RECORD**](/windows/desktop/api/P2P/ns-p2p-peer_record) structure, and contains the following information about a peer:</span></span>

-   <span data-ttu-id="fb043-106">記錄識別碼是可唯一識別對等群組中之記錄的值。</span><span class="sxs-lookup"><span data-stu-id="fb043-106">The record ID is a value that uniquely identifies a record in the peer group.</span></span>
-   <span data-ttu-id="fb043-107">指定記錄類型的 GUID。</span><span class="sxs-lookup"><span data-stu-id="fb043-107">A GUID that specifies the record type.</span></span> <span data-ttu-id="fb043-108">應用程式可支援不同的記錄類型。</span><span class="sxs-lookup"><span data-stu-id="fb043-108">Applications can support different record types.</span></span> <span data-ttu-id="fb043-109">應用程式會根據記錄類型來解讀記錄的 **資料** 欄位。</span><span class="sxs-lookup"><span data-stu-id="fb043-109">An application interprets the **data** field of a record based on the record type.</span></span> <span data-ttu-id="fb043-110">某些 Guid 是保留的，而且 API 呼叫會在應用程式嘗試使用時，傳回 **\_ \_ 未 \_ 授權的對等 E** 。</span><span class="sxs-lookup"><span data-stu-id="fb043-110">Some GUIDs are reserved, and the API call returns **PEER\_E\_NOT\_AUTHORIZED** when the application attempts to use them.</span></span>
-   <span data-ttu-id="fb043-111">描述為 XML 字串的一組記錄屬性。</span><span class="sxs-lookup"><span data-stu-id="fb043-111">A set of record attributes described as an XML string.</span></span> <span data-ttu-id="fb043-112">搜尋記錄時，會使用屬性。</span><span class="sxs-lookup"><span data-stu-id="fb043-112">The attributes are used when searching records.</span></span> <span data-ttu-id="fb043-113">如需屬性的詳細資訊，請參閱 [記錄屬性架構](record-attribute-schema.md)。</span><span class="sxs-lookup"><span data-stu-id="fb043-113">For more information about attributes, see [Record Attribute Schema](record-attribute-schema.md).</span></span>
-   <span data-ttu-id="fb043-114">建立記錄的對等時間。</span><span class="sxs-lookup"><span data-stu-id="fb043-114">The peer time that a record is created.</span></span>
-   <span data-ttu-id="fb043-115">記錄到期的對等時間。</span><span class="sxs-lookup"><span data-stu-id="fb043-115">The peer time that a record expires.</span></span>
-   <span data-ttu-id="fb043-116">修改記錄的對等時間。</span><span class="sxs-lookup"><span data-stu-id="fb043-116">The peer time that a record is modified.</span></span>
-   <span data-ttu-id="fb043-117">記錄的建立者。</span><span class="sxs-lookup"><span data-stu-id="fb043-117">The creator of a record.</span></span>
-   <span data-ttu-id="fb043-118">修改記錄的成員。</span><span class="sxs-lookup"><span data-stu-id="fb043-118">The member who modifies a record.</span></span>
-   <span data-ttu-id="fb043-119">[**對等 \_ 資料**](/windows/desktop/api/P2P/ns-p2p-peer_data)結構，包含此 [**對等 \_ 記錄**](/windows/desktop/api/P2P/ns-p2p-peer_record)結構中所有欄位的密碼編譯簽章。</span><span class="sxs-lookup"><span data-stu-id="fb043-119">A [**PEER\_DATA**](/windows/desktop/api/P2P/ns-p2p-peer_data) structure that contains the cryptographic signature for all of the fields in this [**PEER\_RECORD**](/windows/desktop/api/P2P/ns-p2p-peer_record) structure.</span></span> <span data-ttu-id="fb043-120">對等不能直接更新或修改此欄位。</span><span class="sxs-lookup"><span data-stu-id="fb043-120">This field cannot be directly updated or altered by a peer.</span></span>
-   <span data-ttu-id="fb043-121">[**對等 \_ 資料**](/windows/desktop/api/P2P/ns-p2p-peer_data)結構，其中包含與此記錄相關聯的應用程式特定資料，做為位元組陣列。</span><span class="sxs-lookup"><span data-stu-id="fb043-121">A [**PEER\_DATA**](/windows/desktop/api/P2P/ns-p2p-peer_data) structure that contains the application-specific data associated with this record as an array of bytes.</span></span> <span data-ttu-id="fb043-122">這個欄位中的資料類型是由應用程式定義的記錄類型所決定。</span><span class="sxs-lookup"><span data-stu-id="fb043-122">The type of data present in this field is determined by application-defined record type.</span></span>

## <a name="obtaining-peer-group-records"></a><span data-ttu-id="fb043-123">取得對等群組記錄</span><span class="sxs-lookup"><span data-stu-id="fb043-123">Obtaining Peer Group Records</span></span>

<span data-ttu-id="fb043-124">藉由呼叫 [**PeerGroupGetRecord**](/windows/desktop/api/P2P/nf-p2p-peergroupgetrecord) 與記錄的識別碼，即可取得個別記錄。</span><span class="sxs-lookup"><span data-stu-id="fb043-124">Individual records are obtained by calling [**PeerGroupGetRecord**](/windows/desktop/api/P2P/nf-p2p-peergroupgetrecord) with the ID of the record.</span></span> <span data-ttu-id="fb043-125">處理特定類型的所有記錄時，會先呼叫 [**PeerGroupEnumRecords**](/windows/desktop/api/P2P/nf-p2p-peergroupenumrecords) 來開啟列舉，然後反復呼叫 [**PeerGetNextItem**](/windows/desktop/api/P2P/nf-p2p-peergetnextitem) ，直到所有記錄都被抓取，藉以取得所有目前對等群組記錄的列舉集合。</span><span class="sxs-lookup"><span data-stu-id="fb043-125">When processing all records of a specific type, the enumerated set of all current peer group records is obtained by first calling [**PeerGroupEnumRecords**](/windows/desktop/api/P2P/nf-p2p-peergroupenumrecords) to open the enumeration and then iteratively calling [**PeerGetNextItem**](/windows/desktop/api/P2P/nf-p2p-peergetnextitem) until all records are retrieved.</span></span> <span data-ttu-id="fb043-126">完成時，請藉由呼叫 [**PeerEndEnumeration**](/windows/desktop/api/P2P/nf-p2p-peerendenumeration)來關閉列舉並釋放與其相關聯的記憶體。</span><span class="sxs-lookup"><span data-stu-id="fb043-126">When finished, close the enumeration and release the memory associated with it by calling [**PeerEndEnumeration**](/windows/desktop/api/P2P/nf-p2p-peerendenumeration).</span></span>

<span data-ttu-id="fb043-127">當對等體建立、刪除或更新記錄時，受影響的記錄會透過 **對等 \_ 群組 \_ 事件 \_ 記錄 \_ 變更** 事件發行至對等群組的所有成員。</span><span class="sxs-lookup"><span data-stu-id="fb043-127">When a record is created, deleted, or updated by a peer, the affected record is published to all members of the peer group by way of the **PEER\_GROUP\_EVENT\_RECORD\_CHANGE** event.</span></span> <span data-ttu-id="fb043-128">請注意，如果對等互連未連接到群組，它會在下次連線時接收更新的記錄。</span><span class="sxs-lookup"><span data-stu-id="fb043-128">Note that if a peer is not connected to the group, it will receive the updated record then next time it connects.</span></span> <span data-ttu-id="fb043-129">如果您的應用程式以任何有意義的方式維護或記錄管理，請務必使用 [**PeerGroupRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent) 註冊此事件。</span><span class="sxs-lookup"><span data-stu-id="fb043-129">It is important to register for this event with [**PeerGroupRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent) if your application maintains or manages records in any meaningful way.</span></span> <span data-ttu-id="fb043-130">或者，應用程式可以使用 [**PeerGroupSearchRecords**](/windows/desktop/api/P2P/nf-p2p-peergroupsearchrecords)視需要查詢記錄資料庫。</span><span class="sxs-lookup"><span data-stu-id="fb043-130">Alternatively, the application can query the record database on demand using [**PeerGroupSearchRecords**](/windows/desktop/api/P2P/nf-p2p-peergroupsearchrecords).</span></span>

<span data-ttu-id="fb043-131">當 **對等 \_ 群組 \_ 事件 \_ 記錄 \_ 變更** 事件引發時，將會收到特定的記錄識別碼和類型，以及變更的類型 (新增、更新、刪除) 會被視為 [**對等 \_ 事件 \_ 記錄 \_ 變更 \_ 資料**](/windows/desktop/api/P2P/ns-p2p-peer_event_record_change_data) 結構。</span><span class="sxs-lookup"><span data-stu-id="fb043-131">When the **PEER\_GROUP\_EVENT\_RECORD\_CHANGE** event is raised, the specific record ID and type as well as the type of change (add, update, delete) is received as a [**PEER\_EVENT\_RECORD\_CHANGE\_DATA**](/windows/desktop/api/P2P/ns-p2p-peer_event_record_change_data) structure.</span></span> <span data-ttu-id="fb043-132">此結構是透過呼叫 [**PeerGroupGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata)來取得。</span><span class="sxs-lookup"><span data-stu-id="fb043-132">This structure is obtained with a call to [**PeerGroupGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata).</span></span> <span data-ttu-id="fb043-133">如果變更是新增或更新，您應該使用 [**PeerGroupGetRecord**](/windows/desktop/api/P2P/nf-p2p-peergroupgetrecord) 取得具有所提供識別碼的記錄。</span><span class="sxs-lookup"><span data-stu-id="fb043-133">If the change is an add or an update, you should use [**PeerGroupGetRecord**](/windows/desktop/api/P2P/nf-p2p-peergroupgetrecord) to obtain the record with the supplied ID.</span></span> <span data-ttu-id="fb043-134">基礎結構的本機記錄資料庫會自動更新。</span><span class="sxs-lookup"><span data-stu-id="fb043-134">The local record database for the infrastructure is updated automatically.</span></span>

<span data-ttu-id="fb043-135">您也可以根據 [**對等 \_ 記錄**](/windows/desktop/api/P2P/ns-p2p-peer_record)的 **pwzAttributes** 欄位中提供的特定自訂屬性以及任何預先定義的屬性，來搜尋特定的記錄。</span><span class="sxs-lookup"><span data-stu-id="fb043-135">You can also search for specific records based on specific custom attributes supplied in the **pwzAttributes** field of [**PEER\_RECORD**](/windows/desktop/api/P2P/ns-p2p-peer_record), as well as any predefined attributes.</span></span> <span data-ttu-id="fb043-136">若要完成此動作，請使用 [**PeerGroupSearchRecords**](/windows/desktop/api/P2P/nf-p2p-peergroupsearchrecords) 函式搭配 [ [記錄搜尋查詢格式](record-search-query-format.md) ] 主題中指定的 XML 搜尋查詢格式。</span><span class="sxs-lookup"><span data-stu-id="fb043-136">To accomplish this, use the [**PeerGroupSearchRecords**](/windows/desktop/api/P2P/nf-p2p-peergroupsearchrecords) function with an XML search query formatted as specified in the [Record Search Query Format](record-search-query-format.md) topic.</span></span>

<span data-ttu-id="fb043-137">如需使用對等基礎結構中記錄的詳細資訊，請參閱[使用對等基礎結構](using-the-peer-infrastructure.md)中的[記錄](records.md)主題。</span><span class="sxs-lookup"><span data-stu-id="fb043-137">For more details on working with records in the Peer Infrastructure, please refer to the [Records](records.md) topic in [Using the Peer Infrastructure](using-the-peer-infrastructure.md).</span></span>

## <a name="administration-of-peer-group-records"></a><span data-ttu-id="fb043-138">對等群組記錄的管理</span><span class="sxs-lookup"><span data-stu-id="fb043-138">Administration of Peer Group Records</span></span>

<span data-ttu-id="fb043-139">當對等群組的建立者發出初始邀請時，它可以指定特定成員在系統管理角色中提供 (對等 \_ 群組 \_ 角色系統 \_ 管理員) 只要透過 [**PeerGroupCreateInvitation**](/windows/desktop/api/P2P/nf-p2p-peergroupcreateinvitation) 或 [**PeerGroupIssueCredentials**](/windows/desktop/api/P2P/nf-p2p-peergroupissuecredentials)) 向使用者 (發出新認證。</span><span class="sxs-lookup"><span data-stu-id="fb043-139">When the initial invitations are issued by the peer group's creator, it can specify that certain members serve in an administrative role (PEER\_GROUP\_ROLE\_ADMIN) whenever it issues new credentials to the user (via either [**PeerGroupCreateInvitation**](/windows/desktop/api/P2P/nf-p2p-peergroupcreateinvitation) or [**PeerGroupIssueCredentials**](/windows/desktop/api/P2P/nf-p2p-peergroupissuecredentials)).</span></span> <span data-ttu-id="fb043-140">系統管理員可以直接新增、刪除及更新任何對等群組記錄。</span><span class="sxs-lookup"><span data-stu-id="fb043-140">An administrator has the ability to directly add, delete, and update any peer group records.</span></span> <span data-ttu-id="fb043-141">相反地，如果對等群組成員的角色設定為 **對等 \_ 群組 \_ 角色 \_ 成員** 或 **對等群組角色，則 \_ \_ \_ 邀請 \_ 成員** 的對等群組成員只能新增、更新及刪除其本身的記錄 (s) 。</span><span class="sxs-lookup"><span data-stu-id="fb043-141">Conversely, a peer group member with it's role set to either **PEER\_GROUP\_ROLE\_MEMBER** or **PEER\_GROUP\_ROLE\_INVITING\_MEMBER** can only add, update, and delete its own record(s).</span></span>

<span data-ttu-id="fb043-142">建立者預設具有系統管理員角色。</span><span class="sxs-lookup"><span data-stu-id="fb043-142">The creator has the administrator role by default.</span></span>

<span data-ttu-id="fb043-143">若要更新記錄，請取得具有 [**PeerGroupGetRecord**](/windows/desktop/api/P2P/nf-p2p-peergroupgetrecord) 或 [**PeerGroupEnumRecords**](/windows/desktop/api/P2P/nf-p2p-peergroupenumrecords)的記錄、進行變更，然後將更新的記錄傳遞至 [**PeerGroupUpdateRecord**](/windows/desktop/api/P2P/nf-p2p-peergroupupdaterecord)。</span><span class="sxs-lookup"><span data-stu-id="fb043-143">To update a record, obtain the record with [**PeerGroupGetRecord**](/windows/desktop/api/P2P/nf-p2p-peergroupgetrecord) or [**PeerGroupEnumRecords**](/windows/desktop/api/P2P/nf-p2p-peergroupenumrecords), make the changes, and pass the updated record to [**PeerGroupUpdateRecord**](/windows/desktop/api/P2P/nf-p2p-peergroupupdaterecord).</span></span>

<span data-ttu-id="fb043-144">若要刪除記錄，請將記錄識別碼傳遞至 [**PeerGroupDeleteRecord**](/windows/desktop/api/P2P/nf-p2p-peergroupdeleterecord)。</span><span class="sxs-lookup"><span data-stu-id="fb043-144">To delete a record, pass the record ID to delete to [**PeerGroupDeleteRecord**](/windows/desktop/api/P2P/nf-p2p-peergroupdeleterecord).</span></span>

<span data-ttu-id="fb043-145">若要新增記錄，請建立新的 [**對等 \_ 記錄**](/windows/desktop/api/P2P/ns-p2p-peer_record) 結構，並填入下欄欄位：</span><span class="sxs-lookup"><span data-stu-id="fb043-145">To add a record, create a new [**PEER\_RECORD**](/windows/desktop/api/P2P/ns-p2p-peer_record) structure and populate the following fields:</span></span>

-   <span data-ttu-id="fb043-146">**dwSize**。</span><span class="sxs-lookup"><span data-stu-id="fb043-146">**dwSize**.</span></span> <span data-ttu-id="fb043-147">此欄位包含 **sizeof** ([**對等 \_ 記錄**](/windows/desktop/api/P2P/ns-p2p-peer_record)) 的值。</span><span class="sxs-lookup"><span data-stu-id="fb043-147">This field contains the value of **sizeof**([**PEER\_RECORD**](/windows/desktop/api/P2P/ns-p2p-peer_record)).</span></span>
-   <span data-ttu-id="fb043-148">**ftExpiration**。</span><span class="sxs-lookup"><span data-stu-id="fb043-148">**ftExpiration**.</span></span> <span data-ttu-id="fb043-149">此欄位包含此記錄的到期日期和時間，以對等時程表示為 **FILETIME** 結構。</span><span class="sxs-lookup"><span data-stu-id="fb043-149">This field contains the expiration date and time of this record, expressed in peer time as a **FILETIME** structure.</span></span>
-   <span data-ttu-id="fb043-150">**輸入**。</span><span class="sxs-lookup"><span data-stu-id="fb043-150">**type**.</span></span> <span data-ttu-id="fb043-151">此欄位包含識別應用程式之記錄類型的 **GUID** 值。</span><span class="sxs-lookup"><span data-stu-id="fb043-151">This field contains a **GUID** value that identifies the record type to the application.</span></span> <span data-ttu-id="fb043-152">如果此類型是您應用程式基礎結構的自訂，您也應該填入 **資料** 欄位。</span><span class="sxs-lookup"><span data-stu-id="fb043-152">If this type is custom to your application infrastructure, you should also populate the **data** field.</span></span>

<span data-ttu-id="fb043-153">下欄欄位會由基礎結構填入，且如果應用程式設定，則會予以忽略：</span><span class="sxs-lookup"><span data-stu-id="fb043-153">The following fields are populated by the infrastructure, and will be ignored if set by the application:</span></span>

-   <span data-ttu-id="fb043-154">**id**</span><span class="sxs-lookup"><span data-stu-id="fb043-154">**id**</span></span>
-   <span data-ttu-id="fb043-155">**pwzCreatorId**</span><span class="sxs-lookup"><span data-stu-id="fb043-155">**pwzCreatorId**</span></span>
-   <span data-ttu-id="fb043-156">**pwzLastModifiedById**</span><span class="sxs-lookup"><span data-stu-id="fb043-156">**pwzLastModifiedById**</span></span>
-   <span data-ttu-id="fb043-157">**ftCreation**</span><span class="sxs-lookup"><span data-stu-id="fb043-157">**ftCreation**</span></span>
-   <span data-ttu-id="fb043-158">**ftLastModified**</span><span class="sxs-lookup"><span data-stu-id="fb043-158">**ftLastModified**</span></span>
-   <span data-ttu-id="fb043-159">**securityData**</span><span class="sxs-lookup"><span data-stu-id="fb043-159">**securityData**</span></span>

<span data-ttu-id="fb043-160">其餘欄位是選擇性的。</span><span class="sxs-lookup"><span data-stu-id="fb043-160">The remaining fields are optional.</span></span> <span data-ttu-id="fb043-161">若要將這個新記錄加入至對等群組，請將它傳遞給 [**PeerGroupAddRecord**](/windows/desktop/api/P2P/nf-p2p-peergroupaddrecord)。</span><span class="sxs-lookup"><span data-stu-id="fb043-161">To add this new record to the peer group, pass it to [**PeerGroupAddRecord**](/windows/desktop/api/P2P/nf-p2p-peergroupaddrecord).</span></span>

## <a name="importing-and-exporting-records"></a><span data-ttu-id="fb043-162">匯入和匯出記錄</span><span class="sxs-lookup"><span data-stu-id="fb043-162">Importing and Exporting Records</span></span>

<span data-ttu-id="fb043-163">對等群組記錄會以資料庫的形式在本機進行維護。</span><span class="sxs-lookup"><span data-stu-id="fb043-163">Peer-to-peer group records are maintained locally as a database.</span></span> <span data-ttu-id="fb043-164">若要將對等群組記錄資料庫的目前快照集儲存到本機檔案，請呼叫 [**PeerGroupExportDatabase**](/windows/desktop/api/P2P/nf-p2p-peergroupexportdatabase)，並將控制碼傳遞給對等群組。</span><span class="sxs-lookup"><span data-stu-id="fb043-164">To save a current snapshot of the peer group record database to a local file, call [**PeerGroupExportDatabase**](/windows/desktop/api/P2P/nf-p2p-peergroupexportdatabase), and pass it the handle to the peer group.</span></span> <span data-ttu-id="fb043-165">然後，您可以將此檔案傳輸到不同的電腦或應用程式，藉由呼叫 [**PeerGroupImportDatabase**](/windows/desktop/api/P2P/nf-p2p-peergroupimportdatabase)來解壓縮和使用此記錄資料庫。</span><span class="sxs-lookup"><span data-stu-id="fb043-165">This file can then be transported to a different computer or application, which can extract and use this record database by calling [**PeerGroupImportDatabase**](/windows/desktop/api/P2P/nf-p2p-peergroupimportdatabase).</span></span>

 

 



