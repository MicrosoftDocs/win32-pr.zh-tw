---
title: Echo 範例的運作方式
description: Echo 範例的運作方式
ms.assetid: 554afc08-6e4f-427c-8a09-0d1ebf3ca8dc
keywords:
- Windows Media Player 外掛程式，Echo 範例總覽
- 外掛程式，Echo 範例總覽
- 數位信號處理外掛程式，Echo 範例總覽
- DSP 外掛程式，Echo 範例總覽
- Echo DSP 外掛程式範例，關於
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 08814a6f0d604c7d566a0fc8d9f07b05446fca64
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/16/2019
ms.locfileid: "106999782"
---
# <a name="how-the-echo-sample-works"></a>Echo 範例的運作方式

程式碼會建立回應效果，方法是配置夠大的緩衝區，以包含可在延遲時間值指定的時間範圍內轉譯的音訊資料量。 緩衝區的大小是以位元組為單位計算，並以下列公式計算：

緩衝區大小 = 延遲時間 \* 採樣速率/1000 \* 區塊對齊

延遲時間是以毫秒為單位。 取樣率和區塊對齊值會以 WAVEFORMATEX 結構提供。 取樣率為每秒樣本數;除以1000會每毫秒產生樣本。 區塊對齊等同于 mono 的 (1、身歷聲) 的乘積、每個樣本的位數 (8 或 16) 除以每個位元組的 8 (位) 。

除了指向延遲緩衝區開頭的指標變數之外，此程式碼會建立一個可移動指標，以逐步執行緩衝區中的資料與 **DoProcessOutput** 函數中的處理迴圈進行同步處理。 當可移動指標到達延遲緩衝區的結尾時，會移回緩衝區的標頭。 以這種方式使用的緩衝區稱為圓形緩衝區。

一旦延遲緩衝區存在，而且 Windows Media Player 配置了輸入緩衝區來提供音訊資料和輸出緩衝區來接收處理的音訊資料，回應處理會如下所示：

1.  輸入可在輸入緩衝區中處理每個音訊樣本的迴圈。
2.  從輸入緩衝區取出範例。 然後，將輸入緩衝區指標向前移至下一個範例，以準備下一個迴圈反覆運算。
3.  從延遲緩衝區取出範例。
4.  從輸入緩衝區將範例複製到延遲緩衝區中的相同位置，以從中抓取最後一個延遲樣本。
5.  將延遲緩衝區指標向前移至下一個範例。 如果指標移動超過緩衝區的結尾，請將它移至緩衝區的標頭。
6.  結合輸入緩衝區中的範例與延遲緩衝區中的範例。
7.  將結果複製到輸出緩衝區。 然後，將輸出緩衝區指標向下移動至下一個單元，以準備下一個迴圈反復專案。
8.  重複直到所有範例都已處理。

當步驟2中取出的輸入範例複製到步驟4中的延遲緩衝區時，它會一直留在那裡，直到可移動指標逐步執行延遲緩衝區中的每個樣本，最後返回相同位置為止。 由於延遲緩衝區的大小是設計來與延遲時間相對應，因此複製到延遲緩衝區的樣本與要再次抓取的樣本之間的經過時間，等於指定的延遲 (加上實際處理) 所引進的任何延遲。

當資料流程開始時，將不會產生延遲資料，直到延遲時間經過為止。 因此，延遲緩衝區一開始必須包含無回應。 如果延遲緩衝區包含亂數據，使用者會聽到白色雜訊，直到外掛程式產生足夠的延遲資料來覆寫整個延遲緩衝區為止。

## <a name="related-topics"></a>相關主題

<dl> <dt>

[**Echo 範例總覽**](echo-sample-overview.md)
</dt> </dl>

 

 




