---
title: 類型 2 線上商店外掛程式
description: 類型 2 線上商店外掛程式
ms.assetid: 16e90a01-20be-49a6-96df-de81a7283f42
keywords:
- Windows Media Player 線上商店、外掛程式
- 線上商店、外掛程式
- 類型2線上商店、外掛程式
- Windows Media Player 線上商店、IWMPSubscriptionService 介面
- 線上商店、IWMPSubscriptionService 介面
- 類型2線上商店、IWMPSubscriptionService 介面
- 外掛程式，Windows Media Player 線上商店
- 外掛程式，線上商店
- 外掛程式，輸入2個線上商店
- 外掛程式，IWMPSubscriptionService 介面
- Windows Media Player 外掛程式，請輸入2個線上商店
- Windows Media Player 外掛程式，線上商店
- Windows Media Player 外掛程式，Windows Media Player 線上商店
- Windows Media Player 外掛程式、IWMPSubscriptionService 介面
- IWMPSubscriptionService
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c6d2f3aeeaa7456c3452b498a1a728e24c96783c
ms.sourcegitcommit: ad672d3a10192c5ccac619ad2524407109266e93
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 05/25/2020
ms.locfileid: "104092589"
---
# <a name="type-2-online-store-plug-in"></a><span data-ttu-id="aae0b-118">類型 2 線上商店外掛程式</span><span class="sxs-lookup"><span data-stu-id="aae0b-118">Type 2 Online Store Plug-in</span></span>

<span data-ttu-id="aae0b-119">Type 2 online store 外掛程式是一種 COM 元件，可實 [IWMPSubscriptionService](/previous-versions/windows/desktop/api/subscriptionservices/nn-subscriptionservices-iwmpsubscriptionservice) 介面並選擇性地執行 [IWMPSubscriptionService2](/previous-versions/windows/desktop/api/subscriptionservices/nn-subscriptionservices-iwmpsubscriptionservice2) 介面。</span><span class="sxs-lookup"><span data-stu-id="aae0b-119">A type 2 online store plug-in is a COM component that implements the [IWMPSubscriptionService](/previous-versions/windows/desktop/api/subscriptionservices/nn-subscriptionservices-iwmpsubscriptionservice) interface and optionally the [IWMPSubscriptionService2](/previous-versions/windows/desktop/api/subscriptionservices/nn-subscriptionservices-iwmpsubscriptionservice2) interface.</span></span> <span data-ttu-id="aae0b-120">Windows Media Player 9 會呼叫 **IWMPSubscriptionService** 介面的方法。</span><span class="sxs-lookup"><span data-stu-id="aae0b-120">Windows Media Player 9 calls the methods of the **IWMPSubscriptionService** interface.</span></span> <span data-ttu-id="aae0b-121">Windows Media Player 10 或更新版本會呼叫 **IWMPSubscriptionService** 和 **IWMPSubscriptionService2** 介面的方法。</span><span class="sxs-lookup"><span data-stu-id="aae0b-121">Windows Media Player 10 or later calls the methods of both the **IWMPSubscriptionService** and **IWMPSubscriptionService2** interfaces.</span></span>

<span data-ttu-id="aae0b-122">Type 2 online store 外掛程式會封裝為同進程 COM 伺服器。</span><span class="sxs-lookup"><span data-stu-id="aae0b-122">A type 2 online store plug-in is packaged as an in-process COM server.</span></span> <span data-ttu-id="aae0b-123">也就是說，外掛程式會在對應至 Windows Media Player 進程的 .dll 檔案中執行。</span><span class="sxs-lookup"><span data-stu-id="aae0b-123">That is, the plug-in is implemented in a .dll file that is mapped into the Windows Media Player process.</span></span>

<span data-ttu-id="aae0b-124">Windows Media Player 視需要啟用 type 2 online store 外掛程式。</span><span class="sxs-lookup"><span data-stu-id="aae0b-124">Windows Media Player activates type 2 online store plug-ins as needed.</span></span> <span data-ttu-id="aae0b-125">例如，假設使用者嘗試播放受保護的歌曲，而且沒有任何目前的授權可以播放。</span><span class="sxs-lookup"><span data-stu-id="aae0b-125">For example, suppose the user attempts to play a protected song, and there is no current license to play it.</span></span> <span data-ttu-id="aae0b-126">在此情況下，Windows Media Player 會檢查檔案標頭或 DRM 標頭中的 **ContentDistributor** 屬性。</span><span class="sxs-lookup"><span data-stu-id="aae0b-126">In that case, Windows Media Player inspects the **ContentDistributor** attribute in either the file header or the DRM header.</span></span> <span data-ttu-id="aae0b-127">如果存在與線上商店的金鑰名稱相符的值，Windows Media Player 會檢查登錄以查看該線上商店是否已提供類型2外掛程式。</span><span class="sxs-lookup"><span data-stu-id="aae0b-127">If a value exists that matches the key name of an online store, Windows Media Player checks the registry to see whether that online store has provided a type 2 plug-in.</span></span> <span data-ttu-id="aae0b-128">如果外掛程式存在，Windows Media Player 載入外掛程式並呼叫其方法，以判斷使用者是否具有播放歌曲的許可權。</span><span class="sxs-lookup"><span data-stu-id="aae0b-128">If the plug-in exists, Windows Media Player loads the plug-in and calls its methods to determine whether the user is has the rights to play the song.</span></span>

<span data-ttu-id="aae0b-129">下列清單描述 Windows Media Player 呼叫 type 2 online store 外掛程式的一些案例。</span><span class="sxs-lookup"><span data-stu-id="aae0b-129">The following list describes some of the scenarios in which Windows Media Player calls a type 2 online store plug-in.</span></span>

-   <span data-ttu-id="aae0b-130">**使用者嘗試播放線上商店內容。**</span><span class="sxs-lookup"><span data-stu-id="aae0b-130">**The user attempts to play online store content.**</span></span> <span data-ttu-id="aae0b-131">發生這種情況時，Windows Media Player 會呼叫外掛程式的 [IWMPSubscriptionService：： allowPlay](/previous-versions/windows/desktop/api/subscriptionservices/nf-subscriptionservices-iwmpsubscriptionservice-allowplay) 方法，並將指標傳遞至使用者嘗試播放的數位媒體專案。</span><span class="sxs-lookup"><span data-stu-id="aae0b-131">When this happens, Windows Media Player calls the plug-in's [IWMPSubscriptionService::allowPlay](/previous-versions/windows/desktop/api/subscriptionservices/nf-subscriptionservices-iwmpsubscriptionservice-allowplay) method, passing a pointer to the digital media item that the user is attempting to play.</span></span> <span data-ttu-id="aae0b-132">線上商店可以使用此功能來更新使用者的授權，以播放內容或不允許播放。</span><span class="sxs-lookup"><span data-stu-id="aae0b-132">The online store can use this as an opportunity to update the user's license to play the content or to disallow playback.</span></span> <span data-ttu-id="aae0b-133">如果外掛程式在 *pfAllowPlay* 參數中傳回 **TRUE** ，Windows Media Player 會嘗試播放內容。</span><span class="sxs-lookup"><span data-stu-id="aae0b-133">If the plug-in returns **TRUE** in the *pfAllowPlay* parameter, Windows Media Player attempts to play the content.</span></span> <span data-ttu-id="aae0b-134">如果有效的授權不存在，播放仍會失敗;此流程不會規避 (DRM) 的數位版權管理。</span><span class="sxs-lookup"><span data-stu-id="aae0b-134">Playback will still fail if a valid license does not exist; this process does not circumvent digital rights management (DRM).</span></span>
-   <span data-ttu-id="aae0b-135">**使用者要求將內容燒錄到 CD 或 DVD 的許可權。**</span><span class="sxs-lookup"><span data-stu-id="aae0b-135">**The user requests permission to burn content to a CD or DVD.**</span></span> <span data-ttu-id="aae0b-136">發生這種情況時，Windows Media Player 會呼叫外掛程式的 [IWMPSubscriptionService：： allowCDBurn](/previous-versions/windows/desktop/api/subscriptionservices/nf-subscriptionservices-iwmpsubscriptionservice-allowcdburn) 方法。</span><span class="sxs-lookup"><span data-stu-id="aae0b-136">When this happens, Windows Media Player calls the plug-in's [IWMPSubscriptionService::allowCDBurn](/previous-versions/windows/desktop/api/subscriptionservices/nf-subscriptionservices-iwmpsubscriptionservice-allowcdburn) method.</span></span>
-   <span data-ttu-id="aae0b-137">**使用者嘗試同步處理線上商店內容與裝置，或 Windows Media Player 已準備好自動同步處理線上商店內容與裝置。**</span><span class="sxs-lookup"><span data-stu-id="aae0b-137">**The user attempts to synchronize online store content with a device, or Windows Media Player is ready to automatically synchronize online store content with a device.**</span></span> <span data-ttu-id="aae0b-138">發生這種情況時，Windows Media Player 會呼叫外掛程式的 [IWMPSubscriptionService2：:P repareforsync](/previous-versions/windows/desktop/api/subscriptionservices/nf-subscriptionservices-iwmpsubscriptionservice2-prepareforsync) 方法，以警示線上存放區，媒體專案即將與特定裝置同步處理（由其正式名稱識別）。</span><span class="sxs-lookup"><span data-stu-id="aae0b-138">When this happens, Windows Media Player calls the plug-in's [IWMPSubscriptionService2::prepareForSync](/previous-versions/windows/desktop/api/subscriptionservices/nf-subscriptionservices-iwmpsubscriptionservice2-prepareforsync) method to alert the online store that a media item is about to be synchronized with a particular device, which is identified by its canonical name.</span></span> <span data-ttu-id="aae0b-139">這是線上商店用來判斷是否允許使用者與裝置同步處理媒體專案的機會。</span><span class="sxs-lookup"><span data-stu-id="aae0b-139">This is an opportunity for the online store to determine whether the user is allowed to synchronize the media item with the device.</span></span> <span data-ttu-id="aae0b-140">線上商店也有機會準備裝置進行同步處理，以及更新與裝置或媒體專案相關聯的記錄，例如同步處理計數。</span><span class="sxs-lookup"><span data-stu-id="aae0b-140">It is also an opportunity for the online store to prepare the device for synchronization and to update records, such as synchronization counts, associated with the device or the media item.</span></span> <span data-ttu-id="aae0b-141">外掛程式應將許可權、準備和記錄保留工作傳遞給個別的執行緒，並立即從 **prepareForSync** 傳回。</span><span class="sxs-lookup"><span data-stu-id="aae0b-141">The plug-in should pass the permission, preparation, and record-keeping tasks to a separate thread and return immediately from **prepareForSync**.</span></span> <span data-ttu-id="aae0b-142">當個別的執行緒完成其工作時，必須呼叫 [IWMPSubscriptionServiceCallback：： onComplete](/previous-versions/windows/desktop/api/subscriptionservices/nf-subscriptionservices-iwmpsubscriptionservicecallback-oncomplete)來通知 Windows Media Player。</span><span class="sxs-lookup"><span data-stu-id="aae0b-142">When the separate thread has finished its work, it must notify Windows Media Player by calling [IWMPSubscriptionServiceCallback::onComplete](/previous-versions/windows/desktop/api/subscriptionservices/nf-subscriptionservices-iwmpsubscriptionservicecallback-oncomplete).</span></span>
-   <span data-ttu-id="aae0b-143">**裝置會變成可供背景處理。**</span><span class="sxs-lookup"><span data-stu-id="aae0b-143">**A device becomes available for background processing.**</span></span> <span data-ttu-id="aae0b-144">當裝置連線時，Windows Media Player 藉由呼叫 [IWMPSubscriptionService2：:D eviceavailable](/previous-versions/windows/desktop/api/subscriptionservices/nf-subscriptionservices-iwmpsubscriptionservice2-deviceavailable)，向線上商店發出裝置可用和閒置的警示。</span><span class="sxs-lookup"><span data-stu-id="aae0b-144">When a device is connected, Windows Media Player alerts the online store that the device is available and idle by calling [IWMPSubscriptionService2::deviceAvailable](/previous-versions/windows/desktop/api/subscriptionservices/nf-subscriptionservices-iwmpsubscriptionservice2-deviceavailable).</span></span>
-   <span data-ttu-id="aae0b-145">**使用者按一下按鈕，即可在 Windows Media Player 中啟用線上商店。**</span><span class="sxs-lookup"><span data-stu-id="aae0b-145">**The user clicks a button to activate an online store in Windows Media Player.**</span></span> <span data-ttu-id="aae0b-146">發生這種情況時，Windows Media Player 會呼叫外掛程式的 [IWMPSubscriptionService2：： serviceEvent](/previous-versions/windows/desktop/api/subscriptionservices/nf-subscriptionservices-iwmpsubscriptionservice2-serviceevent) 方法。</span><span class="sxs-lookup"><span data-stu-id="aae0b-146">When this occurs, Windows Media Player calls the plug-in's [IWMPSubscriptionService2::serviceEvent](/previous-versions/windows/desktop/api/subscriptionservices/nf-subscriptionservices-iwmpsubscriptionservice2-serviceevent) method.</span></span> <span data-ttu-id="aae0b-147">當使用者切換至另一個服務時，Windows Media Player 也會呼叫這個方法。</span><span class="sxs-lookup"><span data-stu-id="aae0b-147">Windows Media Player also calls this method when the user switches to another service.</span></span>
-   <span data-ttu-id="aae0b-148">**Windows Media Player 進入較低的活動狀態。**</span><span class="sxs-lookup"><span data-stu-id="aae0b-148">**Windows Media Player enters a state of low activity.**</span></span> <span data-ttu-id="aae0b-149">當這種情況發生時，播放程式會呼叫外掛程式的 [IWMPSubscriptionService：： startBackgroundProcessing](/previous-versions/windows/desktop/api/subscriptionservices/nf-subscriptionservices-iwmpsubscriptionservice-startbackgroundprocessing) 方法。</span><span class="sxs-lookup"><span data-stu-id="aae0b-149">When this happens, the Player calls the plug-in's [IWMPSubscriptionService::startBackgroundProcessing](/previous-versions/windows/desktop/api/subscriptionservices/nf-subscriptionservices-iwmpsubscriptionservice-startbackgroundprocessing) method.</span></span> <span data-ttu-id="aae0b-150">線上商店可以使用這個機會來啟動或喚醒任何執行背景工作的執行緒，例如更新過期的授權或編譯播放次數資料。</span><span class="sxs-lookup"><span data-stu-id="aae0b-150">The online store can use this opportunity to start or wake up any threads that perform background tasks, such as renewing expired licenses or compiling play-count data.</span></span>
-   <span data-ttu-id="aae0b-151">**Windows Media Player 進入高活動的狀態。**</span><span class="sxs-lookup"><span data-stu-id="aae0b-151">**Windows Media Player enters a state of high activity.**</span></span> <span data-ttu-id="aae0b-152">發生這種情況時，Windows Media Player 會呼叫外掛程式的 [IWMPSubscriptionService2：： stopBackgroundProcessing](/previous-versions/windows/desktop/api/subscriptionservices/nf-subscriptionservices-iwmpsubscriptionservice2-stopbackgroundprocessing) 方法。</span><span class="sxs-lookup"><span data-stu-id="aae0b-152">When this happens, Windows Media Player calls the plug-in's [IWMPSubscriptionService2::stopBackgroundProcessing](/previous-versions/windows/desktop/api/subscriptionservices/nf-subscriptionservices-iwmpsubscriptionservice2-stopbackgroundprocessing) method.</span></span> <span data-ttu-id="aae0b-153">這會通知外掛程式必須暫停任何正在執行背景工作的執行緒。</span><span class="sxs-lookup"><span data-stu-id="aae0b-153">This informs the plug-in that it must suspend any threads that are performing background tasks.</span></span>

<span data-ttu-id="aae0b-154">當玩家會話結束時，Windows Media Player 會釋放線上商店元件。</span><span class="sxs-lookup"><span data-stu-id="aae0b-154">Windows Media Player releases the online store component when the Player session ends.</span></span> <span data-ttu-id="aae0b-155">在發行時，元件必須中斷進行中的任何背景處理，然後關閉。</span><span class="sxs-lookup"><span data-stu-id="aae0b-155">Upon release, the component must interrupt any background processing in progress and then shut down.</span></span>

## <a name="related-topics"></a><span data-ttu-id="aae0b-156">相關主題</span><span class="sxs-lookup"><span data-stu-id="aae0b-156">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="aae0b-157">**IWMPSubscriptionService 介面**</span><span class="sxs-lookup"><span data-stu-id="aae0b-157">**IWMPSubscriptionService Interface**</span></span>](/previous-versions/windows/desktop/api/subscriptionservices/nn-subscriptionservices-iwmpsubscriptionservice)
</dt> <dt>

[<span data-ttu-id="aae0b-158">**IWMPSubscriptionService2 介面**</span><span class="sxs-lookup"><span data-stu-id="aae0b-158">**IWMPSubscriptionService2 Interface**</span></span>](/previous-versions/windows/desktop/api/subscriptionservices/nn-subscriptionservices-iwmpsubscriptionservice2)
</dt> <dt>

[<span data-ttu-id="aae0b-159">**IWMPSubscriptionServiceCallback 介面**</span><span class="sxs-lookup"><span data-stu-id="aae0b-159">**IWMPSubscriptionServiceCallback Interface**</span></span>](/previous-versions/windows/desktop/api/subscriptionservices/nn-subscriptionservices-iwmpsubscriptionservicecallback)
</dt> <dt>

[<span data-ttu-id="aae0b-160">**類型2線上商店範例**</span><span class="sxs-lookup"><span data-stu-id="aae0b-160">**Type 2 Online Store Samples**</span></span>](type-2-online-store-samples.md)
</dt> </dl>

 

 




