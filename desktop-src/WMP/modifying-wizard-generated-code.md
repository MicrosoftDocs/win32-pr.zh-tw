---
title: 修改 Wizard 產生的程式碼
description: 修改 Wizard 產生的程式碼
ms.assetid: 391a7773-c3e2-499a-bb63-e5934537d963
keywords:
- Windows Media Player 行動裝置、外掛程式
- Windows Media Player 行動裝置、使用者介面外掛程式
- Windows Media Player Mobile 外掛程式
- 外掛程式，使用者介面
- 外掛程式，Windows Media Player Mobile
- 使用者介面外掛程式，Windows Media Player Mobile
- UI 外掛程式，Windows Media Player Mobile
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a83bda7cb265d0c2e039ada6d9d827c6da3faf63
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/16/2019
ms.locfileid: "106967214"
---
# <a name="modifying-wizard-generated-code"></a><span data-ttu-id="91068-110">修改 Wizard 產生的程式碼</span><span class="sxs-lookup"><span data-stu-id="91068-110">Modifying Wizard-generated Code</span></span>

<span data-ttu-id="91068-111">在嚮導產生的外掛程式程式碼中，您必須先修改數個位置，您的外掛程式才能使用 Windows Media Player 10 行動裝置版。</span><span class="sxs-lookup"><span data-stu-id="91068-111">There are several places in the wizard-generated plug-in code that you must modify before your plug-in will work with Windows Media Player 10 Mobile.</span></span> <span data-ttu-id="91068-112">在下列範例中，您必須修改的程式碼為粗體。</span><span class="sxs-lookup"><span data-stu-id="91068-112">The code you must modify is bold in the following examples.</span></span>

## <a name="changes-to-wmpplugh"></a><span data-ttu-id="91068-113">變更為 wmpplug。h</span><span class="sxs-lookup"><span data-stu-id="91068-113">Changes to wmpplug.h</span></span>

<span data-ttu-id="91068-114">執行 Windows CE 的裝置不支援 ANSI 方法，因此您必須修改 wmpplug 中的 wizard 所產生的下列 ANSI 方法：</span><span class="sxs-lookup"><span data-stu-id="91068-114">ANSI methods are not supported on devices running Windows CE, so you must modify the following ANSI method generated by the wizard in wmpplug.h:</span></span>


```C++
return( ::PostMessage( HWND_BROADCAST, ::RegisterWindowMessageA( "WMPlayer_PluginAddRemove" ), 0, 0 ) );
```



<span data-ttu-id="91068-115">如下所示修改它，使它變成 Unicode 方法：</span><span class="sxs-lookup"><span data-stu-id="91068-115">Modify it as shown in the following so that it becomes a Unicode method:</span></span>


```C++
return( ::PostMessage( HWND_BROADCAST, ::RegisterWindowMessageW( L"WMPlayer_PluginAddRemove" ), 0, 0 ) );
```



## <a name="changes-to-networkpluginh"></a><span data-ttu-id="91068-116">變更為 NetworkPlugin。h</span><span class="sxs-lookup"><span data-stu-id="91068-116">Changes to NetworkPlugin.h</span></span>

<span data-ttu-id="91068-117">在 NetworkPlugin 中尋找下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="91068-117">Find the following code in NetworkPlugin.h:</span></span>


```C++
BEGIN_COM_MAP(CNetworkPlugin)
    COM_INTERFACE(IWMPPluginUI)
END_COM_MAP()
```



<span data-ttu-id="91068-118">修改程式碼，使其看起來像這樣：</span><span class="sxs-lookup"><span data-stu-id="91068-118">Modify the code so that it looks like this:</span></span>


```C++
BEGIN_COM_MAP(CNetworkPlugin)
    
COM_INTERFACE_ENTRY_IID(__uuidof(IWMPPluginUI), IWMPPluginUI)
END_COM_MAP()
```



## <a name="changes-to-networkplugindllcpp"></a><span data-ttu-id="91068-119">變更為 NetworkPlugindll .cpp</span><span class="sxs-lookup"><span data-stu-id="91068-119">Changes to NetworkPlugindll.cpp</span></span>

<span data-ttu-id="91068-120">在 NetworkPlugindll 中尋找 **DllMain** 函數：</span><span class="sxs-lookup"><span data-stu-id="91068-120">Find the **DllMain** function in NetworkPlugindll.cpp:</span></span>


```C++
extern "C" BOOL WINAPI DllMain(HINSTANCE hInstance, DWORD dwReason, LPVOID /*lpReserved*/)
{
    if (dwReason == DLL_PROCESS_ATTACH)
    {
        _Module.Init(ObjectMap, hInstance);
        DisableThreadLibraryCalls(hInstance);
    }
    else if (dwReason == DLL_PROCESS_DETACH)
        _Module.Term();
    return TRUE;    // ok
}
```



<span data-ttu-id="91068-121">修改程式碼，使其看起來像這樣：</span><span class="sxs-lookup"><span data-stu-id="91068-121">Modify the code so that it looks like this:</span></span>


```C++
extern "C" BOOL WINAPI DllMain(HANDLE hInstance, DWORD dwReason, LPVOID /*lpReserved*/)
{
    if (dwReason == DLL_PROCESS_ATTACH)
    {
        _Module.Init(ObjectMap, (HINSTANCE)hInstance);
#ifndef UNDER_CE
        DisableThreadLibraryCalls((HINSTANCE)hInstance);
#endif
    }
    else if (dwReason == DLL_PROCESS_DETACH)
        _Module.Term();
    return TRUE;    // ok
}
```



## <a name="changes-to-networkplugincpp"></a><span data-ttu-id="91068-122">變更為 NetworkPlugin .cpp</span><span class="sxs-lookup"><span data-stu-id="91068-122">Changes to NetworkPlugin.cpp</span></span>

<span data-ttu-id="91068-123">在 NetworkPlugin 中找出下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="91068-123">Find the following code in NetworkPlugin.cpp:</span></span>


```C++
hr = m_spCore->QueryInterface(&spConnectionContainer);
```



<span data-ttu-id="91068-124">修改程式碼，使其看起來像這樣：</span><span class="sxs-lookup"><span data-stu-id="91068-124">Modify the code so that it looks like this:</span></span>


```C++
hr = m_spCore->QueryInterface(__uuidof(IConnectionPointContainer), (void**)&spConnectionContainer);
```



## <a name="change-the-threading-model"></a><span data-ttu-id="91068-125">變更執行緒模型</span><span class="sxs-lookup"><span data-stu-id="91068-125">Change the Threading Model</span></span>

<span data-ttu-id="91068-126">不同于 Windows 的 ATL，適用于 Windows CE 的 ATL 不支援單元執行緒模型，因為在單一線程和自由執行緒模型的情況下，單元模型需要更多記憶體資源。</span><span class="sxs-lookup"><span data-stu-id="91068-126">Unlike ATL for Windows, ATL for Windows CE does not support the apartment threading model because the apartment model requires more memory resources than the single threading and free threading models.</span></span> <span data-ttu-id="91068-127">因此，您必須在 Stdafx.h .h 和 NetworkPlugin 中尋找所有單元執行緒的實例，並加以變更以表示可用執行緒。</span><span class="sxs-lookup"><span data-stu-id="91068-127">Therefore, you must find all instances of apartment threading in StdAfx.h and NetworkPlugin.rgs and change them to indicate free threading.</span></span>

<span data-ttu-id="91068-128">此外，您只能從建立它的執行緒呼叫 Windows Media Player 10 行動裝置控制項。</span><span class="sxs-lookup"><span data-stu-id="91068-128">Also, you can only call the Windows Media Player 10 Mobile control from the thread on which it was created.</span></span>

## <a name="build-and-test-the-project"></a><span data-ttu-id="91068-129">建立和測試專案</span><span class="sxs-lookup"><span data-stu-id="91068-129">Build and Test the Project</span></span>

<span data-ttu-id="91068-130">進行這些變更之後，您可以建立您的專案，以確認它在新增任何自訂程式碼之前會先進行編譯。</span><span class="sxs-lookup"><span data-stu-id="91068-130">After making these changes outlined here, you can build your project to verify that it compiles before you add any custom code.</span></span>

1.  <span data-ttu-id="91068-131">將作用中的專案設定設為 Win32 (WCE ARMV4) Debug 或 Win32 (WCE ARMV4) 版本。</span><span class="sxs-lookup"><span data-stu-id="91068-131">Set the active project configuration to Win32 (WCE ARMV4) Debug or Win32 (WCE ARMV4) Release.</span></span>
2.  <span data-ttu-id="91068-132">將使用中平臺設定為 [Pocket PC 2003]。</span><span class="sxs-lookup"><span data-stu-id="91068-132">Set the active platform to Pocket PC 2003.</span></span>
3.  <span data-ttu-id="91068-133">按一下 [ **組建** ] 功能表項目，然後選取 [ **建立 NetworkPlugin.dll**]。</span><span class="sxs-lookup"><span data-stu-id="91068-133">Click the **Build** menu item, and then select **Build NetworkPlugin.dll**.</span></span> <span data-ttu-id="91068-134">它應該會在您的裝置上進行編譯、下載及註冊。</span><span class="sxs-lookup"><span data-stu-id="91068-134">It should compile, download, and register itself on your device.</span></span>

## <a name="related-topics"></a><span data-ttu-id="91068-135">相關主題</span><span class="sxs-lookup"><span data-stu-id="91068-135">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="91068-136">**建立 Windows Media Player 10 行動裝置版的消費者介面外掛程式**</span><span class="sxs-lookup"><span data-stu-id="91068-136">**Creating a User Interface Plug-in for Windows Media Player 10 Mobile**</span></span>](creating-a-user-interface-plug-in-for-windows-media-player-10-mobile.md)
</dt> </dl>

 

 




