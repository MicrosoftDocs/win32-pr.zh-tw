---
description: 檔案時間是64位的值，代表自上午12:00 以來經過的 100-毫微秒間隔數。 1601年1月1日國際標準時間 (UTC) 。 當應用程式建立、存取和寫入檔案時，系統會記錄檔案的時間。
ms.assetid: 52d80b82-9ab0-4631-9e70-85df21da4946
title: 檔案時間
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5919a2378e08798e4cd64d8f8357cb55692bd22e
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "103853104"
---
# <a name="file-times"></a><span data-ttu-id="3bb96-105">檔案時間</span><span class="sxs-lookup"><span data-stu-id="3bb96-105">File Times</span></span>

<span data-ttu-id="3bb96-106">檔案 *時間* 是64位的值，代表自上午12:00 以來經過的 100-毫微秒間隔數。</span><span class="sxs-lookup"><span data-stu-id="3bb96-106">A *file time* is a 64-bit value that represents the number of 100-nanosecond intervals that have elapsed since 12:00 A.M.</span></span> <span data-ttu-id="3bb96-107">1601年1月1日國際標準時間 (UTC) 。</span><span class="sxs-lookup"><span data-stu-id="3bb96-107">January 1, 1601 Coordinated Universal Time (UTC).</span></span> <span data-ttu-id="3bb96-108">當應用程式建立、存取和寫入檔案時，系統會記錄檔案的時間。</span><span class="sxs-lookup"><span data-stu-id="3bb96-108">The system records file times when applications create, access, and write to files.</span></span>

<span data-ttu-id="3bb96-109">NTFS 檔案系統會以 UTC 格式儲存時間值，因此不會受到時區或日光節約時間變更的影響。</span><span class="sxs-lookup"><span data-stu-id="3bb96-109">The NTFS file system stores time values in UTC format, so they are not affected by changes in time zone or daylight saving time.</span></span> <span data-ttu-id="3bb96-110">FAT 檔案系統會根據電腦的本機時間來儲存時間值。</span><span class="sxs-lookup"><span data-stu-id="3bb96-110">The FAT file system stores time values based on the local time of the computer.</span></span> <span data-ttu-id="3bb96-111">例如，在華盛頓州儲存于3： 00 PST 的檔案會在 NTFS 磁片區上顯示為6： 00 EST，但在 FAT 磁片區上的紐約會顯示為3： 00 EST。</span><span class="sxs-lookup"><span data-stu-id="3bb96-111">For example, a file that is saved at 3:00pm PST in Washington is seen as 6:00pm EST in New York on an NTFS volume, but it is seen as 3:00pm EST in New York on a FAT volume.</span></span>

<span data-ttu-id="3bb96-112">時間戳記會在不同的時間更新，並基於各種原因。</span><span class="sxs-lookup"><span data-stu-id="3bb96-112">Time stamps are updated at various times and for various reasons.</span></span> <span data-ttu-id="3bb96-113">唯一的保證是，檔案時間戳記的保證是在變更的控制碼關閉時，檔案時間會正確地反映出來。</span><span class="sxs-lookup"><span data-stu-id="3bb96-113">The only guarantee about a file time stamp is that the file time is correctly reflected when the handle that makes the change is closed.</span></span>

<span data-ttu-id="3bb96-114">並非所有檔案系統都可以記錄建立和上次存取時間，而且並非所有檔案系統都會以相同的方式記錄它們。</span><span class="sxs-lookup"><span data-stu-id="3bb96-114">Not all file systems can record creation and last access times, and not all file systems record them in the same manner.</span></span> <span data-ttu-id="3bb96-115">例如，在 FAT 上的建立時間解析為10毫秒，而寫入時間的解析為2秒，而存取時間的解析為1天，所以實際上是存取日期。</span><span class="sxs-lookup"><span data-stu-id="3bb96-115">For example, the resolution of create time on FAT is 10 milliseconds, while write time has a resolution of 2 seconds and access time has a resolution of 1 day, so it is really the access date.</span></span> <span data-ttu-id="3bb96-116">NTFS 檔案系統會在最後一次存取後最多1小時延遲檔案的上次存取時間更新。</span><span class="sxs-lookup"><span data-stu-id="3bb96-116">The NTFS file system delays updates to the last access time for a file by up to 1 hour after the last access.</span></span>

<span data-ttu-id="3bb96-117">若要取得指定檔案的檔案時間，請使用 [**GetFileTime**](/windows/desktop/api/FileAPI/nf-fileapi-getfiletime) 函數。</span><span class="sxs-lookup"><span data-stu-id="3bb96-117">To retrieve the file times for a specified file, use the [**GetFileTime**](/windows/desktop/api/FileAPI/nf-fileapi-getfiletime) function.</span></span> <span data-ttu-id="3bb96-118">**GetFileTime** 會將建立、上次存取和上次寫入時間複製到個別的 [**FILETIME**](/windows/win32/api/minwinbase/ns-minwinbase-filetime) 結構。</span><span class="sxs-lookup"><span data-stu-id="3bb96-118">**GetFileTime** copies the creation, last access, and last write times to individual [**FILETIME**](/windows/win32/api/minwinbase/ns-minwinbase-filetime) structures.</span></span> <span data-ttu-id="3bb96-119">您也可以使用 [**FindFirstFile**](/windows/desktop/api/fileapi/nf-fileapi-findfirstfilea) 和 [**FindNextFile**](/windows/desktop/api/fileapi/nf-fileapi-findnextfilea) 函數來取出檔案時間。</span><span class="sxs-lookup"><span data-stu-id="3bb96-119">You can also retrieve file times using the [**FindFirstFile**](/windows/desktop/api/fileapi/nf-fileapi-findfirstfilea) and [**FindNextFile**](/windows/desktop/api/fileapi/nf-fileapi-findnextfilea) functions.</span></span> <span data-ttu-id="3bb96-120">這些函數會將檔案時間複製到 [**WIN32 \_ 尋找 \_ 資料**](/windows/desktop/api/minwinbase/ns-minwinbase-win32_find_dataa)結構中的 **FILETIME** 結構。</span><span class="sxs-lookup"><span data-stu-id="3bb96-120">These functions copy the file times to **FILETIME** structures in a [**WIN32\_FIND\_DATA**](/windows/desktop/api/minwinbase/ns-minwinbase-win32_find_dataa) structure.</span></span> <span data-ttu-id="3bb96-121">寫入檔案時，除非已關閉用於寫入的所有控制碼，否則最後寫入時間不會完全更新。</span><span class="sxs-lookup"><span data-stu-id="3bb96-121">When writing to a file, the last write time is not fully updated until all handles that are used for writing are closed.</span></span>

<span data-ttu-id="3bb96-122">若要設定檔案的檔案時間，請使用 [**SetFileTime**](/windows/desktop/api/FileAPI/nf-fileapi-setfiletime) 函數。</span><span class="sxs-lookup"><span data-stu-id="3bb96-122">To set the file times for a file, use the [**SetFileTime**](/windows/desktop/api/FileAPI/nf-fileapi-setfiletime) function.</span></span> <span data-ttu-id="3bb96-123">此函式可讓您修改建立、上次存取和上次寫入時間，而不需要變更檔案的內容。</span><span class="sxs-lookup"><span data-stu-id="3bb96-123">This function lets you modify creation, last access, and last write times without changing the content of the file.</span></span> <span data-ttu-id="3bb96-124">您可以使用 [**CompareFileTime**](/windows/desktop/api/FileAPI/nf-fileapi-comparefiletime) 函數來比較不同檔案的時間。</span><span class="sxs-lookup"><span data-stu-id="3bb96-124">You can compare the times of different files by using the [**CompareFileTime**](/windows/desktop/api/FileAPI/nf-fileapi-comparefiletime) function.</span></span> <span data-ttu-id="3bb96-125">此函式會比較兩個檔案的時間，並傳回值，這個值會指出哪一個時間較晚，或傳回 0 (零) 如果時間相等。</span><span class="sxs-lookup"><span data-stu-id="3bb96-125">The function compares two file times and returns a value that indicates which time is later or returns 0 (zero) if the times are equal.</span></span>

<span data-ttu-id="3bb96-126">如果您打算修改指定檔案的檔案時間，您可以使用 [**SystemTimeToFileTime**](/windows/win32/api/timezoneapi/nf-timezoneapi-systemtimetofiletime) 函式，將日期和時間轉換成檔案時間。</span><span class="sxs-lookup"><span data-stu-id="3bb96-126">If you plan to modify file times for specified files, you can convert a date and time of day to a file time by using the [**SystemTimeToFileTime**](/windows/win32/api/timezoneapi/nf-timezoneapi-systemtimetofiletime) function.</span></span> <span data-ttu-id="3bb96-127">您也可以藉由呼叫 [**GetSystemTimeAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimeasfiletime)函數，以 [**FILETIME**](/windows/win32/api/minwinbase/ns-minwinbase-filetime)結構取得系統時間。</span><span class="sxs-lookup"><span data-stu-id="3bb96-127">You can also obtain the system time in a [**FILETIME**](/windows/win32/api/minwinbase/ns-minwinbase-filetime) structure by calling the [**GetSystemTimeAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimeasfiletime) function.</span></span>

<span data-ttu-id="3bb96-128">若要讓使用者輕鬆地向使用者顯示檔案，請使用 [**FileTimeToSystemTime**](/windows/win32/api/timezoneapi/nf-timezoneapi-filetimetosystemtime) 函數。</span><span class="sxs-lookup"><span data-stu-id="3bb96-128">To make a file time easy to display to a user, use the [**FileTimeToSystemTime**](/windows/win32/api/timezoneapi/nf-timezoneapi-filetimetosystemtime) function.</span></span> <span data-ttu-id="3bb96-129">**FileTimeToSystemTime** 會轉換檔案時間，並將月、日、年和日的時間從檔案時間複製到 [**SYSTEMTIME**](/windows/win32/api/minwinbase/ns-minwinbase-systemtime) 結構。</span><span class="sxs-lookup"><span data-stu-id="3bb96-129">**FileTimeToSystemTime** converts the file time and copies the month, day, year, and time of day from the file time to a [**SYSTEMTIME**](/windows/win32/api/minwinbase/ns-minwinbase-systemtime) structure.</span></span>

## <a name="file-times-and-daylight-saving-time"></a><span data-ttu-id="3bb96-130">檔案時間和日光節約時間</span><span class="sxs-lookup"><span data-stu-id="3bb96-130">File Times and Daylight Saving Time</span></span>

<span data-ttu-id="3bb96-131">如果使用者已將系統設定為自動調整日光節約時間，您必須小心使用檔案時間。</span><span class="sxs-lookup"><span data-stu-id="3bb96-131">You must take care when using file times if the user has set the system to automatically adjust for daylight saving time.</span></span>

<span data-ttu-id="3bb96-132">若要將檔案時間轉換為本地時間，請使用 [**FileTimeToLocalFileTime**](/windows/desktop/api/FileAPI/nf-fileapi-filetimetolocalfiletime) 函數。</span><span class="sxs-lookup"><span data-stu-id="3bb96-132">To convert a file time to local time, use the [**FileTimeToLocalFileTime**](/windows/desktop/api/FileAPI/nf-fileapi-filetimetolocalfiletime) function.</span></span> <span data-ttu-id="3bb96-133">不過， **FileTimeToLocalFileTime** 會使用時區和日光節約時間的目前設定。</span><span class="sxs-lookup"><span data-stu-id="3bb96-133">However, **FileTimeToLocalFileTime** uses the current settings for the time zone and daylight saving time.</span></span> <span data-ttu-id="3bb96-134">因此，如果是日光節約時間，即使您要轉換的檔案時間是標準時間，也會將日光節約時間納入考慮。</span><span class="sxs-lookup"><span data-stu-id="3bb96-134">Therefore, if it is daylight saving time, it takes daylight saving time into account, even if the file time you are converting is in standard time.</span></span>

<span data-ttu-id="3bb96-135">FAT 檔案系統會以當地時間記錄磁片的時間。</span><span class="sxs-lookup"><span data-stu-id="3bb96-135">The FAT file system records times on disk in local time.</span></span> <span data-ttu-id="3bb96-136">[**GetFileTime**](/windows/desktop/api/FileAPI/nf-fileapi-getfiletime) 會從 FAT 檔案系統抓取快取的 UTC 時間。</span><span class="sxs-lookup"><span data-stu-id="3bb96-136">[**GetFileTime**](/windows/desktop/api/FileAPI/nf-fileapi-getfiletime) retrieves cached UTC times from the FAT file system.</span></span> <span data-ttu-id="3bb96-137">當它變成日光節約時間時， **GetFileTime** 所取出的時間會關閉一小時，因為快取未更新。</span><span class="sxs-lookup"><span data-stu-id="3bb96-137">When it becomes daylight saving time, the time retrieved by **GetFileTime** is off an hour, because the cache is not updated.</span></span> <span data-ttu-id="3bb96-138">當您重新開機電腦時， **GetFileTime** 抓取的快取時間是正確的。</span><span class="sxs-lookup"><span data-stu-id="3bb96-138">When you restart the computer, the cached time that **GetFileTime** retrieves is correct.</span></span> <span data-ttu-id="3bb96-139">[**FindFirstFile**](/windows/desktop/api/fileapi/nf-fileapi-findfirstfilea) 會從 FAT 檔案系統抓取當地時間，並使用時區和日光節約時間的目前設定，將其轉換為 UTC。</span><span class="sxs-lookup"><span data-stu-id="3bb96-139">[**FindFirstFile**](/windows/desktop/api/fileapi/nf-fileapi-findfirstfilea) retrieves the local time from the FAT file system and converts it to UTC by using the current settings for the time zone and daylight saving time.</span></span> <span data-ttu-id="3bb96-140">因此，如果是日光節約時間， **FindFirstFile** 會將日光節約時間納入考慮，即使您要轉換的檔案時間是標準時間也一樣。</span><span class="sxs-lookup"><span data-stu-id="3bb96-140">Therefore, if it is daylight saving time, **FindFirstFile** takes daylight saving time into account, even if the file time you are converting is in standard time.</span></span>

<span data-ttu-id="3bb96-141">NTFS 檔案系統會以 UTC 時間記錄磁片上的時間。</span><span class="sxs-lookup"><span data-stu-id="3bb96-141">The NTFS file system records times on disk in UTC.</span></span> <span data-ttu-id="3bb96-142">若要在將檔案時間轉換為當地時間時考慮日光節約時間，請使用下列一連串的函式，而不是使用 [**FileTimeToLocalFileTime**](/windows/desktop/api/FileAPI/nf-fileapi-filetimetolocalfiletime)：</span><span class="sxs-lookup"><span data-stu-id="3bb96-142">To account for daylight saving time when converting a file time to a local time, use the following sequence of functions instead of using [**FileTimeToLocalFileTime**](/windows/desktop/api/FileAPI/nf-fileapi-filetimetolocalfiletime):</span></span>

-   [<span data-ttu-id="3bb96-143">**FileTimeToSystemTime**</span><span class="sxs-lookup"><span data-stu-id="3bb96-143">**FileTimeToSystemTime**</span></span>](/windows/win32/api/timezoneapi/nf-timezoneapi-filetimetosystemtime)
-   [<span data-ttu-id="3bb96-144">**SystemTimeToTzSpecificLocalTime**</span><span class="sxs-lookup"><span data-stu-id="3bb96-144">**SystemTimeToTzSpecificLocalTime**</span></span>](/windows/win32/api/timezoneapi/nf-timezoneapi-systemtimetotzspecificlocaltime)
-   [<span data-ttu-id="3bb96-145">**SystemTimeToFileTime**</span><span class="sxs-lookup"><span data-stu-id="3bb96-145">**SystemTimeToFileTime**</span></span>](/windows/win32/api/timezoneapi/nf-timezoneapi-systemtimetofiletime)

## <a name="file-times-and-cdfs"></a><span data-ttu-id="3bb96-146">檔案時間和 CDFS.SYS</span><span class="sxs-lookup"><span data-stu-id="3bb96-146">File Times and CDFS</span></span>

<span data-ttu-id="3bb96-147">使用 Compact 光碟檔案系統在媒體上的檔案日期和時間戳記 (CDFS.SYS) 會針對當地時區進行調整。</span><span class="sxs-lookup"><span data-stu-id="3bb96-147">The date and time stamps of files that are located on or originate from media using Compact Disc File System (CDFS) are adjusted for the local time zone.</span></span> <span data-ttu-id="3bb96-148">ISO 9660 指出，CDFS.SYS 是為了正確地顯示當地時區的日期資訊。</span><span class="sxs-lookup"><span data-stu-id="3bb96-148">ISO 9660 states that CDFS is to display the date information correctly for the local time zone.</span></span> <span data-ttu-id="3bb96-149">這樣做的目的是要讓 CDFS.SYS 上的檔案日期與國際磁碟格式的日期顯示 (UDF) 。</span><span class="sxs-lookup"><span data-stu-id="3bb96-149">This is done so that dates for files on CDFS are displayed the same as those on Universal Disk Format (UDF).</span></span> <span data-ttu-id="3bb96-150">UDF 是發佈媒體的較新標準。</span><span class="sxs-lookup"><span data-stu-id="3bb96-150">UDF is the newer standard for distribution media.</span></span> <span data-ttu-id="3bb96-151">如果您的程式碼相依于使用 CDFS.SYS 從媒體或源自媒體的檔案未修改的日期資訊，則可能無法正確運作。</span><span class="sxs-lookup"><span data-stu-id="3bb96-151">If your code depends on the unmodified date information for a file that resides on or originates from media using CDFS, it may not function correctly.</span></span>

 

 
