---
description: '應用程式驗證器 (Windows 7 和 Windows Server 2008 R2 應用程式品質逐步指南) '
ms.assetid: edf719b7-9bd9-4e23-9bba-d0d7c3c5dbf5
title: '應用程式驗證器 (Windows 7 和 Windows Server 2008 R2 應用程式品質逐步指南) '
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bac2a8bc900ea9d1f35ae228371226355657b930
ms.sourcegitcommit: 95685061d5b0333bbf9e6ebd208dde8190f97005
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/28/2021
ms.locfileid: "108088686"
---
# <a name="application-verifier-windows-7-and-windows-server-2008-r2-application-quality-cookbook"></a>應用程式驗證器 (Windows 7 和 Windows Server 2008 R2 應用程式品質逐步指南) 

## <a name="affected-platforms"></a>受影響的平臺

**客戶** 端-windows XP、windows Vista、windows 7  
**伺服器** -windows server 2003、windows server 2008、windows Server 2008 R2  


## <a name="description"></a>Description

升級並強制執行應用程式驗證器成為所有開發的品質閘道。 它包含數個改進：

-   我們已提供額外的檢查，以解決 Windows 錯誤報告團隊線上程集區使用期間發現的問題。
-   我們結合了32和64位版本的套件來解決 Windows 7 的變更，包括在64位版本的 Windows 下測試32位元件的需求，以及一般簡化。
-   我們已包含多執行緒應用程式的額外檢查、在64位 Windows 上執行32位應用程式，以及許多 bug 修正。

這些變更對未啟用執行緒檢查的使用者應該不會有負面影響;他們應該會在探索和診斷現有的執行緒集區使用問題時收到額外支援。 無論您是否啟用執行緒檢查，都將受益于此服務中的其他增強功能和錯誤修正。

當使用此服務時，效能層級會稍微降低，因為通常不會在零售環境中執行，因此效能層級應該保持可接受。

## <a name="usage"></a>使用方式

**一般資訊**

提供可靠的 Windows 應用程式：

1.  測試以非受控 (原生) 程式碼撰寫的應用程式，並在偵錯工具下使用應用程式驗證器，並在將它釋出給客戶之前，使用完整頁面堆積
2.  遵循應用程式驗證器所提供的步驟來解決不當條件。
3.  一旦發行您的應用程式之後，請定期監視 Windows 錯誤報告所收集的應用程式失敗報告。

依預設，會在「基本」檢查標題下啟用執行緒集區檢查。 因為這會包含在預設設定中，所以使用者只需要在其程式碼上執行應用程式驗證器，並使用預設設定來利用新的檢查。

**詳細資料**

您至少應該使用所選的基本設定來執行應用程式驗證器。 這是 WinLogo 和 WinQual 的必要項。 基本設定會檢查下列各項：

-   **例外狀況停止詳細資料** -確保應用程式不會使用結構化例外狀況處理來隱藏存取違規
-   **處理停止詳細資料** -測試以確保應用程式不會嘗試使用不正確控制碼
-   堆積 **停止詳細資料**-檢查堆積中的記憶體損毀問題
-   **輸入/輸出停止詳細資料** -監視非同步 IO 的執行，並執行各種驗證
-   流失 **停止詳細資料**-藉由追蹤 dll 所產生的資源，而不是 dll 卸載時所釋放的資源，來偵測流失
-   **鎖定停止詳細資料** -確認重要區段的正確用法
-   **記憶體停止詳細資料** -確保正確使用虛擬空間操作的 api (例如 VirtualAlloc、MapViewOfFile) 
-   **TLS 停止詳細資料** -確保正確使用執行緒區域儲存 api
-   **Threadpool 停止詳細資料** -確保執行緒集區 api 的正確使用，並在回呼後對背景工作執行緒狀態強制執行一致性檢查

如果您的應用程式是從「Vista 前」應用程式進行遷移，您會想要利用「LuaPriv」 (也稱為 UAC 檢查) 。 受限的使用者帳戶許可權預測 (LuaPriv) 有兩個主要目標：

-   **預測** 性：執行具有系統管理許可權的應用程式時，如果以較低許可權執行 (通常是一般的使用者) ，請預測該應用程式是否也能運作。 例如，如果應用程式寫入僅允許系統管理員存取的檔案，則該應用程式將無法寫入至相同的檔案（如果以非系統管理員身分執行）。
-   **診斷**：在以非系統管理員許可權執行時，識別目前執行可能已存在的潛在問題。 繼續先前的範例，如果應用程式嘗試寫入僅授與系統管理員群組成員存取權的檔案，則應用程式將會收到 \_ 拒絕存取錯誤。 如果應用程式無法正常運作，此作業可能會是錯誤。

LuaPriv 可識別下列類型的問題：



| **潛在問題**       | **說明**                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|---------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 限制的命名空間     | 在不含命名空間的情況下， (事件、信號、Mutex 等) 建立未命名的同步處理物件，可能會因為作業系統可能會選擇將物件放在受限制的命名空間中而變得複雜。 在受限制的命名空間中建立這類物件 (例如全域命名空間) 需要 SeCreateGlobalPrivilege，只授與系統管理員。<br/> 如果偵測到這些問題，LuaPriv 會將這兩個問題旗標。<br/> |
| 硬系統管理員檢查 | 有些應用程式會詢問使用者的安全性權杖，以找出他/她擁有多少許可權。 在這些情況下，應用程式可能會根據它認為使用者的耗電量來變更其行為。 <br/> LuaPriv 會將傳回此資訊的旗標 API 呼叫加以旗標。<br/>                                                                                                                                                                                                |
| 要求許可權     | 應用程式可能會嘗試啟用安全性相關的許可權 (例如 SeTcbPrivilege 或 SeSecurityPrivilege) ，然後再執行需要它的作業。 <br/> LuaPriv 旗標會嘗試啟用安全性相關的許可權。 <br/>                                                                                                                                                                                                                               |
| 缺少許可權        | 如果應用程式嘗試啟用使用者沒有的許可權，可能會表示應用程式需要許可權，這可能會導致行為差異。 <br/> LuaPriv 旗標失敗的許可權要求。 <br/>                                                                                                                                                                                                                                       |
| INI-File 作業       | 嘗試寫入對應的 INI 檔案 (WritePrivateProfileSection 和類似的 Api) 可能會失敗為非系統管理員使用者。 <br/> LuaPriv 旗標這類作業。<br/>                                                                                                                                                                                                                                                                                                            |
| 拒絕存取             | 如果應用程式嘗試存取 (檔案、登錄機碼等) 的物件，但嘗試因為存取權不足而失敗，則應用程式可能預期會以比它更多的許可權來執行。 <br/> LuaPriv 會旗標物件-開啟拒絕存取的嘗試 \_ ，以及類似的錯誤。<br/>                                                                                                                                                               |
| Deny Ace                 | 如果物件在其 DACL 中有 Deny Ace，則會明確拒絕對特定實體的存取。 <br/> 這種情況並不常見，因此很難進行預測，所以 LuaPriv 旗標會在找到時旗標拒絕 Ace。<br/>                                                                                                                                                                                                                                                                     |
| 存取受限         | 如果應用程式嘗試針對未授與一般使用者的許可權開啟物件 (例如，嘗試寫入只能由系統管理員) 寫入的檔案，則應用程式在以一般使用者的身分執行時，可能不會有相同的運作方式。 <br/> LuaPriv 旗標這類作業。<br/>                                                                                                                                                                      |
| 允許的最大值 \_          | 如果應用程式針對允許的最大值開啟物件 \_ ，則物件上的實際存取權檢查將會出現在其他地方。 大部分執行此作業的程式碼都無法正常運作，而且在沒有許可權的情況下執行時幾乎不會有不同的運作方式。 <br/> 因此，LuaPriv 會標示最大允許的所有事件 \_ 。 <br/>                                                                                                                                                            |



 

常見的忽略問題會在含糊的其他檢查中捕捉：

-   危險 Api 停止詳細資料
-   中途堆疊停止詳細資料
-   時間變換

我們已加入新的列印驗證器。 這一層可協助您尋找應用程式呼叫列印子系統時可能產生的問題，並進行疑難排解。 列印驗證器會以列印子系統的兩層、PrintAPI 層和 PrintDriver 層為目標。

*列印 API 層*

Print Verifier 會測試程式與 Winspool.drv 之間的介面。 winspool.drv 和 prntvpt.dll，並測試這些 Dll 的介面。 您可以在 MSDN [說明] 區段中，針對 winspool.drv. winspool.drv 所匯出的 Api 和 prntvpt.dll，檢查此介面中呼叫函式的規則。

*列印驅動層*

列印驗證器也會測試核心列印驅動程式（例如 UNIDRV.DLL、UNIDRUI.DLL、PSCRIPT5.DLL、PS5UI.DLL 或 MXDWDRV.DLL）與列印驅動程式外掛程式之間的介面。您可以在 MSDN 和 WDK 中找到此介面的相關資訊。

請注意，其中有些檢查僅適用于 Windows 7，其他檢查則只在 Windows 7 下執行得更好。

一般來說，只有 debug 版本會執行應用程式驗證器，因此效能通常不會發生問題。 如果使用這項或任何其他應用程式驗證器檢查產生效能問題，請在執行所有必要的檢查時，一次執行一次檢查。

在 Windows 系統上，應用程式損毀的將近10% 是因為堆積損毀。 這些損毀幾乎無法在事實之後進行調試。 避免這些問題的最佳方式，就是使用應用程式驗證器中的頁面堆積功能進行測試。 頁面堆積有兩種類別：「完整」和「淺色」。 Full 是預設值;它會強制偵錯工具在偵測到損毀時立即停止。 這項功能必須在偵錯工具下執行。 不過，這也是最耗費資源的需求。 如果使用者有時間問題，且已在 [完整] 頁面堆積下執行案例，將其設定為 [淺色] 可能會解決這些問題。 此外，在進程結束之前，輕量頁面堆積不會損毀。 它確實會提供堆疊追蹤給配置，但使用它的完整對應，可能需要更長的時間來進行診斷。

透過 Winqual web 入口網站監視應用程式的可靠性狀態。 此入口網站會顯示透過 Windows 錯誤報告收集的錯誤報表，因此很容易就能找出最常見的失敗。 在 Windows 錯誤報告：開始使用瞭解這一點。 Microsoft 不會對此服務收費。

若要利用 WinQual，您必須：

1.  註冊您的公司以進行 WinQual，這需要 VeriSign 識別碼。 您可以在開發人員入口網站的 windows Vista SP1 windows Server 2008 下，找到有關 WinQual 的 Windows 7 資訊 \\ 。 它很快就會有 Windows 7 的位置。
2.  將 ISV 應用程式對應到產品名稱和 ISV 名稱，將失敗報告連結到公司。 其他 Isv 無法查看您的錯誤報表。
3.  使用入口網站來找出最重要的問題。 Isv 也可以建立回應，通知客戶失敗後應採取的步驟。 回應系統支援全球超過10種語言。

另外一點要注意：應用程式驗證器只與您執行它的程式碼路徑一樣好。 將此工具與程式碼涵蓋範圍工具結合的價值無法過。

## <a name="links-to-other-resources"></a>其他資源的連結

**適用于 Windows 的偵錯工具：**

-   [總覽和下載網站](https://msdn.microsoft.com/windows/hardware/bg127145)
-   [MSDN 線上檔](/windows-hardware/drivers/debugger/)

**應用程式驗證器：**

-   [概觀](/previous-versions/ms220948(v=vs.80))
-   [下載](https://www.microsoft.com/downloads/details.aspx?FamilyID=c4a25ab9-649d-4a1b-b4a7-c9d8b095df18&amp;DisplayLang=en)
-   [適用于 Microsoft Visual Studio 2008/.NET Framework 3.5 的應用程式驗證器](/previous-versions/ms220948(v=vs.80))

    **注意：** 隨附于 Visual Studio 的應用程式驗證器版本相當的日期。 可能的話，請改用獨立套件。 基於這個理由，未來的 Visual Studio 版本將不再有內嵌應用程式驗證器。

**WinQual:**

-   [Windows Quality Online Services (Winqual) ](/windows-hardware/drivers/dashboard/winqual-submission-tool--winqualexe-)
-   [Windows 錯誤報告：開始使用](../wer/using-wer.md)

 

 
