---
description: 若要協助防止惡意攻擊，請判斷您的應用程式是否需要系統管理員許可權。 對於需要系統管理員許可權的函式，請建立個別的應用程式，並使用 Windows RunAs 命令列命令。
ms.assetid: afa520fc-c206-49de-8d73-8f6566ec4fb6
title: 以系統管理員許可權執行
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: dc28843195e9b5cabadc13aa2317b0bdd8058ef8
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "106989990"
---
# <a name="running-with-administrator-privileges"></a><span data-ttu-id="b9788-104">以系統管理員許可權執行</span><span class="sxs-lookup"><span data-stu-id="b9788-104">Running with Administrator Privileges</span></span>

<span data-ttu-id="b9788-105">建立應用程式所需執行的帳戶類型的第一個步驟，就是檢查應用程式將使用的資源，以及它所要呼叫的特殊許可權 Api。</span><span class="sxs-lookup"><span data-stu-id="b9788-105">The first step in establishing which type of account your application needs to run under is to examine what resources the application will use and what privileged APIs it will call.</span></span> <span data-ttu-id="b9788-106">您可能會發現應用程式或其中的大型元件不需要系統管理員許可權。</span><span class="sxs-lookup"><span data-stu-id="b9788-106">You may find that the application, or large parts of it, do not require administrator privileges.</span></span> <span data-ttu-id="b9788-107">*撰寫安全* 的程式碼時，Michael Howard 和 David LeBlanc 提供如何執行這項評量的絕佳描述，而且強烈建議您這樣做。</span><span class="sxs-lookup"><span data-stu-id="b9788-107">*Writing Secure Code*, by Michael Howard and David LeBlanc offers an excellent description of how to carry out this assessment and is highly recommended.</span></span> <span data-ttu-id="b9788-108"> (此資源可能無法在某些語言及國家/地區使用。 ) </span><span class="sxs-lookup"><span data-stu-id="b9788-108">(This resource may not be available in some languages and countries.)</span></span>

<span data-ttu-id="b9788-109">您可以使用下列其中一種方法，提供應用程式所需的許可權，減少暴露于惡意攻擊的風險：</span><span class="sxs-lookup"><span data-stu-id="b9788-109">You can provide the privileges your application needs with less exposure to malicious attack by using one of the following approaches:</span></span>

-   <span data-ttu-id="b9788-110">以較少許可權的帳戶執行。</span><span class="sxs-lookup"><span data-stu-id="b9788-110">Run under an account with less privilege.</span></span> <span data-ttu-id="b9788-111">執行這項作業的其中一種方式是使用 [**PrivilegeCheck**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-privilegecheck) 來判斷在權杖中啟用的許可權。</span><span class="sxs-lookup"><span data-stu-id="b9788-111">One way to do this is to use [**PrivilegeCheck**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-privilegecheck) to determine what privileges are enabled in a token.</span></span> <span data-ttu-id="b9788-112">如果可用的許可權不適合目前的作業，您可以停用該程式碼，並要求使用者登入具有系統管理員許可權的帳戶。</span><span class="sxs-lookup"><span data-stu-id="b9788-112">If the available privileges are not adequate for the current operation, you can disable that code and ask the user to logon to an account with administrator privileges.</span></span>
-   <span data-ttu-id="b9788-113">中斷需要系統管理員許可權的個別應用程式功能。</span><span class="sxs-lookup"><span data-stu-id="b9788-113">Break into a separate application functions that require administrator permissions.</span></span> <span data-ttu-id="b9788-114">您可以為使用者提供執行 RunAs 命令的快捷方式。</span><span class="sxs-lookup"><span data-stu-id="b9788-114">You can provide for the user a shortcut that executes the RunAs command.</span></span> <span data-ttu-id="b9788-115">如需有關如何設定快捷方式的詳細指示，請在 [說明] 中搜尋「runas」。</span><span class="sxs-lookup"><span data-stu-id="b9788-115">For detailed instructions on how to set up the shortcut, search for "runas" in Help.</span></span> <span data-ttu-id="b9788-116">您可以用程式設計的方式，在應用程式的[AppId 金鑰](/windows/desktop/com/appid-key)登錄機碼下設定[RunAs](/windows/desktop/com/runas)命令。</span><span class="sxs-lookup"><span data-stu-id="b9788-116">Programmatically, you can configure the [RunAs](/windows/desktop/com/runas) command under the [AppId Key](/windows/desktop/com/appid-key) registry key for your application.</span></span>
-   <span data-ttu-id="b9788-117">藉由呼叫 [**CredUIPromptForCredentials**](/windows/desktop/api/wincred/nf-wincred-creduipromptforcredentialsa) (GUI) 或 [**CredUICmdLinePromptForCredentials**](/windows/desktop/api/wincred/nf-wincred-creduicmdlinepromptforcredentialsa) (命令列) 來取得使用者名稱和密碼，來驗證使用者。</span><span class="sxs-lookup"><span data-stu-id="b9788-117">Authenticate the user by calling [**CredUIPromptForCredentials**](/windows/desktop/api/wincred/nf-wincred-creduipromptforcredentialsa) (GUI) or [**CredUICmdLinePromptForCredentials**](/windows/desktop/api/wincred/nf-wincred-creduicmdlinepromptforcredentialsa) (command line) to obtain user name and password.</span></span> <span data-ttu-id="b9788-118">如需範例，請參閱 [要求使用者提供認證](asking-the-user-for-credentials.md)。</span><span class="sxs-lookup"><span data-stu-id="b9788-118">For an example, see [Asking the User for Credentials](asking-the-user-for-credentials.md).</span></span>
-   <span data-ttu-id="b9788-119">模擬使用者。</span><span class="sxs-lookup"><span data-stu-id="b9788-119">Impersonate the user.</span></span> <span data-ttu-id="b9788-120">以高許可權帳戶（例如系統）啟動的進程，可以藉由呼叫 [**ImpersonateLoggedOnUser**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-impersonateloggedonuser) 或類似的模擬函式來模擬使用者帳戶，進而減少許可權層級。</span><span class="sxs-lookup"><span data-stu-id="b9788-120">A process that starts under a highly privileged account like System can impersonate a user account by calling [**ImpersonateLoggedOnUser**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-impersonateloggedonuser) or similar Impersonate functions, thus reducing privilege level.</span></span> <span data-ttu-id="b9788-121">但是，如果對 [**RevertToSelf**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-reverttoself) 的呼叫插入執行緒中，則進程會回到原始系統許可權。</span><span class="sxs-lookup"><span data-stu-id="b9788-121">However, if a call to [**RevertToSelf**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-reverttoself) is injected into the thread, the process returns to the original System privileges.</span></span>

<span data-ttu-id="b9788-122">如果您已判斷出應用程式必須在具有系統管理員許可權的帳戶下執行，而且系統管理員密碼必須儲存在軟體系統中，請參閱為安全地執行此操作的方法 [處理密碼](handling-passwords.md) 。</span><span class="sxs-lookup"><span data-stu-id="b9788-122">If you have determined that your application must run under an account with administrator privileges and that an administrator password must be stored in the software system, see [Handling Passwords](handling-passwords.md) for methods of doing this safely.</span></span>

 

 
