---
title: 成分
description: 組合是暫時的輸入狀態，可讓文字服務指定應用程式和使用者的輸入文字仍處於變更狀態。
ms.assetid: 3d9da4f2-ceb9-4abc-8979-d3756d948a57
keywords:
- 文字服務架構 (TSF) 、撰寫
- TSF (文字服務架構) ，組合
- 文字服務，組合
- 啟用 TSF 的應用程式，組合
- compositions
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0b03f3e991f76ee7c6dca3830267796576c7b842
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/20/2020
ms.locfileid: "104376264"
---
# <a name="compositions"></a><span data-ttu-id="c4374-108">成分</span><span class="sxs-lookup"><span data-stu-id="c4374-108">Compositions</span></span>

<span data-ttu-id="c4374-109">組合是暫時的輸入狀態，可讓文字服務指定應用程式和使用者的輸入文字仍處於變更狀態。</span><span class="sxs-lookup"><span data-stu-id="c4374-109">A composition is a temporary input state that enables a text service to specify both to the application and the user that the input text is still in a state of change.</span></span> <span data-ttu-id="c4374-110">應用程式可以和應該取得組合的顯示內容資訊，並使用此資訊向使用者顯示組合狀態。</span><span class="sxs-lookup"><span data-stu-id="c4374-110">An application can and should obtain display attribute information about the composition and use this information to display the composition state to the user.</span></span>

<span data-ttu-id="c4374-111">在語音輸入期間使用組合的其中一個範例。</span><span class="sxs-lookup"><span data-stu-id="c4374-111">One example of the use of a composition is during speech input.</span></span> <span data-ttu-id="c4374-112">當使用者說話時，語音文字服務會建立組合。</span><span class="sxs-lookup"><span data-stu-id="c4374-112">While the user is speaking, the speech text service creates a composition.</span></span> <span data-ttu-id="c4374-113">這項組合將保持不變，直到整個語音輸入完成為止。</span><span class="sxs-lookup"><span data-stu-id="c4374-113">This composition will remain intact until the entire speech input is complete.</span></span> <span data-ttu-id="c4374-114">當會話結束時，語音文字服務會終止組合。</span><span class="sxs-lookup"><span data-stu-id="c4374-114">When the session ends, the speech text service terminates the composition.</span></span>

<span data-ttu-id="c4374-115">應用程式會使用組合的存在和不存在，來決定如何顯示文字，以及應對文字執行哪些作業（如果有的話）。</span><span class="sxs-lookup"><span data-stu-id="c4374-115">An application uses the presence and absence of a composition to determine how to display text and what, if any, processing should be performed on the text.</span></span> <span data-ttu-id="c4374-116">例如，如果使用者使用語音引擎來輸入文字，則應用程式不應對任何組合文字執行任何拼寫或文法檢查。</span><span class="sxs-lookup"><span data-stu-id="c4374-116">For example, if the user is using the speech engine to input text, the application should not perform any spelling or grammar checking on any composition text.</span></span> <span data-ttu-id="c4374-117">在結束組合之前，會將文字視為未完成。</span><span class="sxs-lookup"><span data-stu-id="c4374-117">The text is considered incomplete until the composition is terminated.</span></span>

## <a name="text-services"></a><span data-ttu-id="c4374-118">文字服務</span><span class="sxs-lookup"><span data-stu-id="c4374-118">Text Services</span></span>

<span data-ttu-id="c4374-119">文字服務會藉由呼叫 [ITfCoNtextComposition：： StartComposition](/windows/desktop/api/msctf/nf-msctf-itfcontextcomposition-startcomposition)來建立組合。</span><span class="sxs-lookup"><span data-stu-id="c4374-119">A text service creates a composition by calling [ITfContextComposition::StartComposition](/windows/desktop/api/msctf/nf-msctf-itfcontextcomposition-startcomposition).</span></span> <span data-ttu-id="c4374-120">文字服務可以選擇性地執行接收撰寫事件通知的 [ITfCompositionSink](/windows/desktop/api/msctf/nn-msctf-itfcompositionsink) 物件。</span><span class="sxs-lookup"><span data-stu-id="c4374-120">The text service can optionally implement an [ITfCompositionSink](/windows/desktop/api/msctf/nn-msctf-itfcompositionsink) object that receives composition event notifications.</span></span> <span data-ttu-id="c4374-121">StartComposition 會傳回 [ITfComposition](/windows/desktop/api/msctf/nn-msctf-itfcomposition) 物件，此物件可讓文字服務保存參考，並使用來修改和終止組合。</span><span class="sxs-lookup"><span data-stu-id="c4374-121">StartComposition returns an [ITfComposition](/windows/desktop/api/msctf/nn-msctf-itfcomposition) object that the text service keeps a reference to and uses to modify and terminate the composition.</span></span> <span data-ttu-id="c4374-122">文字服務會藉由呼叫 [ITfComposition：： EndComposition](/windows/desktop/api/msctf/nf-msctf-itfcomposition-endcomposition)來終止組合。</span><span class="sxs-lookup"><span data-stu-id="c4374-122">The text service terminates the composition by calling [ITfComposition::EndComposition](/windows/desktop/api/msctf/nf-msctf-itfcomposition-endcomposition).</span></span>

<span data-ttu-id="c4374-123">如果文字服務將建立組合，也應該支援顯示內容，讓應用程式顯示與標準文字不同的組合文字。</span><span class="sxs-lookup"><span data-stu-id="c4374-123">If a text service is going to create compositions, it should also support display attributes to enable an application to display text that is part of a composition differently than standard text.</span></span> <span data-ttu-id="c4374-124">如需詳細資訊，請參閱 [提供顯示內容](providing-display-attributes.md)。</span><span class="sxs-lookup"><span data-stu-id="c4374-124">For more information, see [Providing Display Attributes](providing-display-attributes.md).</span></span>

## <a name="applications"></a><span data-ttu-id="c4374-125">應用程式</span><span class="sxs-lookup"><span data-stu-id="c4374-125">Applications</span></span>

<span data-ttu-id="c4374-126">應用程式可以藉由安裝 [ITfCoNtextOwnerCompositionSink](/windows/desktop/api/msctf/nn-msctf-itfcontextownercompositionsink) 接收，來監視組合的建立、變更和終止。</span><span class="sxs-lookup"><span data-stu-id="c4374-126">An application can monitor the creation, change and termination of compositions by installing an [ITfContextOwnerCompositionSink](/windows/desktop/api/msctf/nn-msctf-itfcontextownercompositionsink) sink.</span></span> <span data-ttu-id="c4374-127">當組合開始時，會呼叫 [ITfCoNtextOwnerCompositionSink：： OnStartComposition](/windows/desktop/api/msctf/nf-msctf-itfcontextownercompositionsink-onstartcomposition) 。</span><span class="sxs-lookup"><span data-stu-id="c4374-127">When a composition is started, [ITfContextOwnerCompositionSink::OnStartComposition](/windows/desktop/api/msctf/nf-msctf-itfcontextownercompositionsink-onstartcomposition) is called.</span></span> <span data-ttu-id="c4374-128">同樣地，當組合變更或終止時，會分別呼叫 [ITfCoNtextOwnerCompositionSink：： OnUpdateComposition](/windows/desktop/api/msctf/nf-msctf-itfcontextownercompositionsink-onupdatecomposition) 和 [ITfCoNtextOwnerCompositionSink：： OnEndComposition](/windows/desktop/api/msctf/nf-msctf-itfcontextownercompositionsink-onendcomposition) 。</span><span class="sxs-lookup"><span data-stu-id="c4374-128">Likewise, when a composition is changed or terminated, [ITfContextOwnerCompositionSink::OnUpdateComposition](/windows/desktop/api/msctf/nf-msctf-itfcontextownercompositionsink-onupdatecomposition) and [ITfContextOwnerCompositionSink::OnEndComposition](/windows/desktop/api/msctf/nf-msctf-itfcontextownercompositionsink-onendcomposition) will be called, respectively.</span></span>

<span data-ttu-id="c4374-129">以下是使用組合來更新檔的一般程式。</span><span class="sxs-lookup"><span data-stu-id="c4374-129">The following is a typical procedure to update a document using a composition.</span></span>

1.  <span data-ttu-id="c4374-130">[ITextStoreACP：： InsertTextAtSelection](/windows/desktop/api/Textstor/nf-textstor-itextstoreacp-inserttextatselection) 或 [ITextStoreAnchor：： InsertTextAtSelection](/windows/desktop/api/Textstor/nf-textstor-itextstoreanchor-inserttextatselection) 通常用來將初始文字插入組合中。</span><span class="sxs-lookup"><span data-stu-id="c4374-130">[ITextStoreACP::InsertTextAtSelection](/windows/desktop/api/Textstor/nf-textstor-itextstoreacp-inserttextatselection) or [ITextStoreAnchor::InsertTextAtSelection](/windows/desktop/api/Textstor/nf-textstor-itextstoreanchor-inserttextatselection) are typically used to insert the initial text into the composition.</span></span>
2.  <span data-ttu-id="c4374-131">組合是使用 [ITfCoNtextComposition：： StartComposition](/windows/desktop/api/Msctf/nf-msctf-itfcontextcomposition-startcomposition)的呼叫來啟動，並使用 **InsertTextAtSelection** 所傳回的文字範圍。</span><span class="sxs-lookup"><span data-stu-id="c4374-131">The composition is started with a call to [ITfContextComposition::StartComposition](/windows/desktop/api/Msctf/nf-msctf-itfcontextcomposition-startcomposition), using the range of text returned by **InsertTextAtSelection**.</span></span>
3.  <span data-ttu-id="c4374-132">當它收到新的輸入（例如語音或鍵盤輸入）時，應用程式會使用 [ITextStoreACP：： SetText](/windows/desktop/api/Textstor/nf-textstor-itextstoreacp-settext) 或 [ITextStoreAnchor：： SetText](/windows/desktop/api/Textstor/nf-textstor-itextstoreanchor-settext)來更新組合。</span><span class="sxs-lookup"><span data-stu-id="c4374-132">When it receives new input such as speech or keyboard entry, the application updates the composition with [ITextStoreACP::SetText](/windows/desktop/api/Textstor/nf-textstor-itextstoreacp-settext) or [ITextStoreAnchor::SetText](/windows/desktop/api/Textstor/nf-textstor-itextstoreanchor-settext).</span></span>
4.  <span data-ttu-id="c4374-133">當應用程式判斷是否要結束組合時，它會呼叫 [ITfComposition：： EndComposition](/windows/desktop/api/Msctf/nf-msctf-itfcomposition-endcomposition)。</span><span class="sxs-lookup"><span data-stu-id="c4374-133">When the application determines that it is time to end the composition, it calls [ITfComposition::EndComposition](/windows/desktop/api/Msctf/nf-msctf-itfcomposition-endcomposition).</span></span>

<span data-ttu-id="c4374-134">應用程式應該使用文字服務所提供的顯示內容，隨時修改文字的顯示，而不只是在組合為使用中時。</span><span class="sxs-lookup"><span data-stu-id="c4374-134">The application should use the display attributes provided by the text service to modify the display of text at all times and not just when a composition is active.</span></span> <span data-ttu-id="c4374-135">如需詳細資訊，請參閱 [使用顯示內容](using-display-attributes.md)。</span><span class="sxs-lookup"><span data-stu-id="c4374-135">For more information, see [Using Display Attributes](using-display-attributes.md).</span></span>

<span data-ttu-id="c4374-136">如有必要，應用程式可以藉由呼叫 [ITfCoNtextOwnerCompositionServices：： TerminateComposition](/windows/desktop/api/msctf/nf-msctf-itfcontextownercompositionservices-terminatecomposition)來終止組合。</span><span class="sxs-lookup"><span data-stu-id="c4374-136">If necessary, an application can terminate a composition by calling [ITfContextOwnerCompositionServices::TerminateComposition](/windows/desktop/api/msctf/nf-msctf-itfcontextownercompositionservices-terminatecomposition).</span></span>

 

 