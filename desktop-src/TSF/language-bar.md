---
title: 'Language Bar (Text Services) '
description: 語言列
ms.assetid: 82b92567-fdc1-488c-b395-4cb95257955c
keywords:
- 文字服務架構 (TSF) 、language bar
- TSF (文字服務架構) 、language bar
- 文字服務，語言列
- 語言列
- 文字服務架構 (TSF) 、按鈕
- TSF (文字服務架構) 、按鈕
- 文字服務，按鈕
- 文字服務架構 (TSF) 、功能表
- TSF (文字服務架構) 、功能表
- 文字服務、功能表
- 按鈕樣式
- 功能表按鈕
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c41d64a488406f6eefcff5fef6c11093af00bc5b
ms.sourcegitcommit: 8fa6614b715bddf14648cce36d2df22e5232801a
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 12/10/2020
ms.locfileid: "104383753"
---
# <a name="language-bar-text-services"></a><span data-ttu-id="15eeb-115">Language Bar (Text Services) </span><span class="sxs-lookup"><span data-stu-id="15eeb-115">Language Bar (Text Services)</span></span>

## <a name="implementing-the-language-bar-object"></a><span data-ttu-id="15eeb-116">執行語言橫條圖物件</span><span class="sxs-lookup"><span data-stu-id="15eeb-116">Implementing the Language Bar Object</span></span>

<span data-ttu-id="15eeb-117">若要支援將專案加入至語言列，文字服務必須執行支援 [ITfSource](/windows/desktop/api/msctf/nn-msctf-itfsource) 介面的物件，以及其中一個 [ITfLangBarItem](/windows/desktop/api/ctfutb/nn-ctfutb-itflangbaritem) 控制項元素。</span><span class="sxs-lookup"><span data-stu-id="15eeb-117">To support adding an item to the language bar, a text service must implement an object that supports the [ITfSource](/windows/desktop/api/msctf/nn-msctf-itfsource) interface and one of the [ITfLangBarItem](/windows/desktop/api/ctfutb/nn-ctfutb-itflangbaritem) control elements.</span></span> <span data-ttu-id="15eeb-118">當安裝專案時，語言列會藉由呼叫專案的[ITfSource：： AdviseSink](/windows/desktop/api/msctf/nf-msctf-itfsource-advisesink)和 IID ITfLangBarItemSink 來安裝[ITfLangBarItemSink](/windows/desktop/api/ctfutb/nn-ctfutb-itflangbaritemsink)接收器 \_ 。</span><span class="sxs-lookup"><span data-stu-id="15eeb-118">When the item is installed, the language bar installs an [ITfLangBarItemSink](/windows/desktop/api/ctfutb/nn-ctfutb-itflangbaritemsink) sink by calling the item's [ITfSource::AdviseSink](/windows/desktop/api/msctf/nf-msctf-itfsource-advisesink) with IID\_ITfLangBarItemSink.</span></span> <span data-ttu-id="15eeb-119">專案會使用 **ITfLangBarItemSink** 介面來通知語言列的變更，例如隱藏、顯示、啟用或停用專案。</span><span class="sxs-lookup"><span data-stu-id="15eeb-119">The item uses the **ITfLangBarItemSink** interface to notify the language bar of changes, for example when the item is hidden, shown, enabled, or disabled.</span></span>

<span data-ttu-id="15eeb-120">您可以安裝四種類型的語言橫條圖，並從 **ITfLangBarItem** 建立每個必要的介面。</span><span class="sxs-lookup"><span data-stu-id="15eeb-120">Four types of language bar items can be installed and each of the required interfaces is created from **ITfLangBarItem**.</span></span> <span data-ttu-id="15eeb-121">以下是可能的 **ITfLangBarItem** 控制項元素。</span><span class="sxs-lookup"><span data-stu-id="15eeb-121">The following are possible **ITfLangBarItem** control elements.</span></span>



|               |                                                                                                                                                                                   |
|---------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="15eeb-122">按鈕</span><span class="sxs-lookup"><span data-stu-id="15eeb-122">Button</span></span>        | <span data-ttu-id="15eeb-123">語言列按鈕的功能是命令按鈕、切換控制項或語言列上的功能表。</span><span class="sxs-lookup"><span data-stu-id="15eeb-123">A language bar button functions as a command button, toggle control, or a menu on the language bar.</span></span> <span data-ttu-id="15eeb-124">物件必須支援 ITfLangBarItemButton 介面。</span><span class="sxs-lookup"><span data-stu-id="15eeb-124">The object must support the ITfLangBarItemButton interface.</span></span>                   |
| <span data-ttu-id="15eeb-125">氣球</span><span class="sxs-lookup"><span data-stu-id="15eeb-125">Balloon</span></span>       | <span data-ttu-id="15eeb-126">語言列球形球形函式可作為語言列上的快顯通知。</span><span class="sxs-lookup"><span data-stu-id="15eeb-126">A language bar balloon functions as a pop-up notification on the language bar.</span></span> <span data-ttu-id="15eeb-127">物件必須支援 ITfLangBarItemBalloon 介面。</span><span class="sxs-lookup"><span data-stu-id="15eeb-127">The object must support the ITfLangBarItemBalloon interface.</span></span>                                       |
| <span data-ttu-id="15eeb-128">點陣圖</span><span class="sxs-lookup"><span data-stu-id="15eeb-128">Bitmap</span></span>        | <span data-ttu-id="15eeb-129">語言橫條圖點陣圖可作為顯示點陣圖之語言列上的靜態元素。</span><span class="sxs-lookup"><span data-stu-id="15eeb-129">A language bar bitmap functions as a static element on the language bar that displays a bitmap.</span></span> <span data-ttu-id="15eeb-130">物件必須支援 ITfLangBarItemBitmap 介面。</span><span class="sxs-lookup"><span data-stu-id="15eeb-130">The object must support the ITfLangBarItemBitmap interface.</span></span>                       |
| <span data-ttu-id="15eeb-131">點陣圖按鈕</span><span class="sxs-lookup"><span data-stu-id="15eeb-131">Bitmap Button</span></span> | <span data-ttu-id="15eeb-132">語言橫條圖點陣圖按鈕可作為顯示文字和點陣圖之語言列上的按鈕元素。</span><span class="sxs-lookup"><span data-stu-id="15eeb-132">A language bar bitmap button functions as a button element on the language bar that displays text and a bitmap.</span></span> <span data-ttu-id="15eeb-133">物件必須支援 ITfLangBarItemBitmapButton 介面。</span><span class="sxs-lookup"><span data-stu-id="15eeb-133">The object must support the ITfLangBarItemBitmapButton interface.</span></span> |



 

## <a name="button-styles"></a><span data-ttu-id="15eeb-134">按鈕樣式</span><span class="sxs-lookup"><span data-stu-id="15eeb-134">Button Styles</span></span>

<span data-ttu-id="15eeb-135">按鈕元素可做為下列任何一項。</span><span class="sxs-lookup"><span data-stu-id="15eeb-135">A button element can function as any of the following.</span></span> <span data-ttu-id="15eeb-136">按鈕專案的函式取決於在 [ITfLangBarItem：： GetInfo](/windows/desktop/api/ctfutb/nf-ctfutb-itflangbaritem-getinfo)方法中的 [TF \_ LANGBARITEMINFO](/windows/desktop/api/ctfutb/ns-ctfutb-tf_langbariteminfo)結構之 **dwStyle** 成員中設定的旗標。</span><span class="sxs-lookup"><span data-stu-id="15eeb-136">The function of the button item is determined by the flags set in the **dwStyle** member of the [TF\_LANGBARITEMINFO](/windows/desktop/api/ctfutb/ns-ctfutb-tf_langbariteminfo) structure in the [ITfLangBarItem::GetInfo](/windows/desktop/api/ctfutb/nf-ctfutb-itflangbaritem-getinfo) method.</span></span>



|               |                                                                                                                                                                                                                                                                                                                                                                                      |
|---------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="15eeb-137">按鈕</span><span class="sxs-lookup"><span data-stu-id="15eeb-137">Button</span></span>        | <span data-ttu-id="15eeb-138">按鈕會作為標準命令按鈕。</span><span class="sxs-lookup"><span data-stu-id="15eeb-138">The button functions as a standard command button.</span></span> <span data-ttu-id="15eeb-139">此按鈕樣式是由 TF \_ LBI \_ style \_ BTN \_ 按鈕樣式所識別。</span><span class="sxs-lookup"><span data-stu-id="15eeb-139">This button style is identified by the TF\_LBI\_STYLE\_BTN\_BUTTON style.</span></span> <span data-ttu-id="15eeb-140">按一下專案時，會呼叫 ITfLangBarItemButton：： OnClick。</span><span class="sxs-lookup"><span data-stu-id="15eeb-140">ITfLangBarItemButton::OnClick is called when the item is clicked.</span></span> <span data-ttu-id="15eeb-141">未使用 ITfLangBarItemButton：： InitMenu 和 ITfLangBarItemButton：： OnMenuSelect。</span><span class="sxs-lookup"><span data-stu-id="15eeb-141">ITfLangBarItemButton::InitMenu and ITfLangBarItemButton::OnMenuSelect are not used.</span></span>                                                                                                   |
| <span data-ttu-id="15eeb-142">切換按鈕</span><span class="sxs-lookup"><span data-stu-id="15eeb-142">Toggle Button</span></span> | <span data-ttu-id="15eeb-143">按鈕可作為切換控制項，可以維持已按下的狀態，類似于核取方塊。</span><span class="sxs-lookup"><span data-stu-id="15eeb-143">The button functions as a toggle control that can maintain a clicked state, similar to a check box.</span></span> <span data-ttu-id="15eeb-144">此按鈕樣式是由 TF \_ LBI \_ style \_ BTN \_ 轉場樣式所識別。</span><span class="sxs-lookup"><span data-stu-id="15eeb-144">This button style is identified by the TF\_LBI\_STYLE\_BTN\_TOGGLE style.</span></span> <span data-ttu-id="15eeb-145">按一下專案時，會呼叫 ITfLangBarItemButton：： OnClick。</span><span class="sxs-lookup"><span data-stu-id="15eeb-145">ITfLangBarItemButton::OnClick is called when the item is clicked.</span></span> <span data-ttu-id="15eeb-146">未使用 ITfLangBarItemButton：： InitMenu 和 ITfLangBarItemButton：： OnMenuSelect。</span><span class="sxs-lookup"><span data-stu-id="15eeb-146">ITfLangBarItemButton::InitMenu and ITfLangBarItemButton::OnMenuSelect are not used.</span></span>                                                  |
| <span data-ttu-id="15eeb-147">功能表</span><span class="sxs-lookup"><span data-stu-id="15eeb-147">Menu</span></span>          | <span data-ttu-id="15eeb-148">按鈕會以下拉式功能表的形式來運作。</span><span class="sxs-lookup"><span data-stu-id="15eeb-148">The button functions as a drop-down menu.</span></span> <span data-ttu-id="15eeb-149">這個按鈕樣式是由 TF \_ LBI \_ style \_ BTN \_ 功能表樣式來識別。</span><span class="sxs-lookup"><span data-stu-id="15eeb-149">This button style is identified by the TF\_LBI\_STYLE\_BTN\_MENU style.</span></span> <span data-ttu-id="15eeb-150">按一下按鈕時，會呼叫 ITfLangBarItemButton：： InitMenu。</span><span class="sxs-lookup"><span data-stu-id="15eeb-150">ITfLangBarItemButton::InitMenu is called when the button is clicked.</span></span> <span data-ttu-id="15eeb-151">當使用者選取功能表中的專案時，語言列會以所選功能表項目的識別碼呼叫 ITfLangBarItemButton：： OnMenuSelect。</span><span class="sxs-lookup"><span data-stu-id="15eeb-151">When the user selects an item in the menu, the language bar calls ITfLangBarItemButton::OnMenuSelect with the identifier of the selected menu item.</span></span> <span data-ttu-id="15eeb-152">ITfLangBarItemButton：： OnClickis 未使用。</span><span class="sxs-lookup"><span data-stu-id="15eeb-152">ITfLangBarItemButton::OnClickis not used.</span></span> |



 

## <a name="implementing-a-menu-button"></a><span data-ttu-id="15eeb-153">執行功能表按鈕</span><span class="sxs-lookup"><span data-stu-id="15eeb-153">Implementing a Menu Button</span></span>

<span data-ttu-id="15eeb-154">當使用者按一下功能表按鈕時，語言列會呼叫 [ITfLangBarItemButton：： InitMenu](/windows/desktop/api/Ctfutb/nf-ctfutb-itflangbaritembutton-initmenu)。</span><span class="sxs-lookup"><span data-stu-id="15eeb-154">When the user clicks a menu button, the language bar calls [ITfLangBarItemButton::InitMenu](/windows/desktop/api/Ctfutb/nf-ctfutb-itflangbaritembutton-initmenu).</span></span> <span data-ttu-id="15eeb-155">專案會使用傳遞至 InitMenu 的 [ITfMenu](/windows/desktop/api/ctfutb/nn-ctfutb-itfmenu) 介面，將專案加入功能表中。</span><span class="sxs-lookup"><span data-stu-id="15eeb-155">The item adds items to the menu using the [ITfMenu](/windows/desktop/api/ctfutb/nn-ctfutb-itfmenu) interface passed to InitMenu.</span></span>

<span data-ttu-id="15eeb-156">若要將子功能表加入功能表中，請呼叫 [ITfMenu：： AddMenuItem](/windows/desktop/api/Ctfutb/nf-ctfutb-itfmenu-addmenuitem) with TF \_ LBMENUF \_ 子功能表。</span><span class="sxs-lookup"><span data-stu-id="15eeb-156">To add a submenu to the menu, call [ITfMenu::AddMenuItem](/windows/desktop/api/Ctfutb/nf-ctfutb-itfmenu-addmenuitem) with TF\_LBMENUF\_SUBMENU.</span></span> <span data-ttu-id="15eeb-157">完成這項操作時，會在 AddMenuItem 的 *ppMenu* 參數中傳回代表子功能表的新 **ITfMenu** 物件。</span><span class="sxs-lookup"><span data-stu-id="15eeb-157">When this is done, a new **ITfMenu** object that represents the submenu is returned in the *ppMenu* parameter of AddMenuItem.</span></span> <span data-ttu-id="15eeb-158">這個新的功能表物件是用來將專案新增至子功能表。</span><span class="sxs-lookup"><span data-stu-id="15eeb-158">This new menu object is used to add items to the submenu.</span></span>

<span data-ttu-id="15eeb-159">當使用者選取功能表中的專案時，語言列會以所選功能表項目的識別碼呼叫 [ITfLangBarItemButton：： OnMenuSelect](/windows/desktop/api/Ctfutb/nf-ctfutb-itflangbaritembutton-onmenuselect) 。</span><span class="sxs-lookup"><span data-stu-id="15eeb-159">When the user selects an item in the menu, the language bar calls [ITfLangBarItemButton::OnMenuSelect](/windows/desktop/api/Ctfutb/nf-ctfutb-itflangbaritembutton-onmenuselect) with the identifier of the selected menu item.</span></span>

## <a name="adding-items-to-the-language-bar"></a><span data-ttu-id="15eeb-160">將專案新增至語言列</span><span class="sxs-lookup"><span data-stu-id="15eeb-160">Adding Items to the Language Bar</span></span>

<span data-ttu-id="15eeb-161">文字服務應該在呼叫 [ITfTextInputProcessor：： Activate](/windows/desktop/api/msctf/nf-msctf-itftextinputprocessor-activate) 方法時，將其專案加入至語言列，並在呼叫其 [ITfTextInputProcessor：:D eactivate](/windows/desktop/api/msctf/nf-msctf-itftextinputprocessor-deactivate) 時將其移除。</span><span class="sxs-lookup"><span data-stu-id="15eeb-161">A text service should add its items to the language bar when its [ITfTextInputProcessor::Activate](/windows/desktop/api/msctf/nf-msctf-itftextinputprocessor-activate) method is called and remove them when its [ITfTextInputProcessor::Deactivate](/windows/desktop/api/msctf/nf-msctf-itftextinputprocessor-deactivate) is called.</span></span>

<span data-ttu-id="15eeb-162">為了將專案加入至語言列，文字服務會透過使用 IID ITfLangBarItemMgr 呼叫 ITfThreadMgr：： QueryInterface 來取得 [ITfLangBarItemMgr](/windows/desktop/api/ctfutb/nn-ctfutb-itflangbaritemmgr) 介面 \_ 。</span><span class="sxs-lookup"><span data-stu-id="15eeb-162">To add an item to the language bar, the text service obtains an [ITfLangBarItemMgr](/windows/desktop/api/ctfutb/nn-ctfutb-itflangbaritemmgr) interface by calling ITfThreadMgr::QueryInterface with IID\_ITfLangBarItemMgr.</span></span> <span data-ttu-id="15eeb-163">文字服務接著會使用語言列專案物件的指標來呼叫 [ITfLangBarItemMgr：： AddItem](/windows/desktop/api/ctfutb/nf-ctfutb-itflangbaritemmgr-additem) 。</span><span class="sxs-lookup"><span data-stu-id="15eeb-163">The text service then calls [ITfLangBarItemMgr::AddItem](/windows/desktop/api/ctfutb/nf-ctfutb-itflangbaritemmgr-additem) with the pointer to the language bar item object.</span></span>

<span data-ttu-id="15eeb-164">文字服務必須在停用時移除專案。</span><span class="sxs-lookup"><span data-stu-id="15eeb-164">The text service must remove the item when deactivated.</span></span> <span data-ttu-id="15eeb-165">文字服務會使用用來加入專案的相同 **ITfLangBarItemMgr** 介面，或取得介面的另一個實例。</span><span class="sxs-lookup"><span data-stu-id="15eeb-165">The text service either uses the same **ITfLangBarItemMgr** interface used to add the items or obtains another instance of the interface.</span></span> <span data-ttu-id="15eeb-166">然後，文字服務會呼叫 [ITfLangBarItemMgr：： RemoveItem](/windows/desktop/api/ctfutb/nf-ctfutb-itflangbaritemmgr-removeitem) ，以及要移除之專案的介面指標。</span><span class="sxs-lookup"><span data-stu-id="15eeb-166">The text service then calls [ITfLangBarItemMgr::RemoveItem](/windows/desktop/api/ctfutb/nf-ctfutb-itflangbaritemmgr-removeitem) with the interface pointer of the item to remove.</span></span>

## <a name="extending-system-language-bar-items"></a><span data-ttu-id="15eeb-167">擴充 System Language Bar 專案</span><span class="sxs-lookup"><span data-stu-id="15eeb-167">Extending System Language Bar Items</span></span>

<span data-ttu-id="15eeb-168">TSF 可讓您將功能表項目加入至現有的語言列功能表。</span><span class="sxs-lookup"><span data-stu-id="15eeb-168">TSF provides the ability to add menu items to existing language bar menus.</span></span> <span data-ttu-id="15eeb-169">這可讓文字服務將專案加入至其他文字服務的功能表中，而不需要將個別按鈕新增至工具列。</span><span class="sxs-lookup"><span data-stu-id="15eeb-169">This enables a text service to add items to the menu of another text service without having to add a separate button to the toolbar.</span></span> <span data-ttu-id="15eeb-170">這也可讓功能表項目組織成邏輯群組。</span><span class="sxs-lookup"><span data-stu-id="15eeb-170">This also enables the menu items to be organized into logical groups.</span></span> <span data-ttu-id="15eeb-171">例如，將其他功能提供給標準語音文字服務的文字服務，可以將專案新增至語音文字服務功能表，而不是加入自己的最上層功能表按鈕。</span><span class="sxs-lookup"><span data-stu-id="15eeb-171">For example, a text service that provides additional features to the standard speech text service can add items to the speech text service menu rather than adding its own top-level menu button.</span></span>

<span data-ttu-id="15eeb-172">文字服務會藉由執行支援 [ITfSystemLangBarItemSink](/windows/desktop/api/ctfutb/nn-ctfutb-itfsystemlangbaritemsink) 介面的物件，提供語言列功能表延伸。</span><span class="sxs-lookup"><span data-stu-id="15eeb-172">A text service provides a language bar menu extension by implementing an object that supports the [ITfSystemLangBarItemSink](/windows/desktop/api/ctfutb/nn-ctfutb-itfsystemlangbaritemsink) interface.</span></span> <span data-ttu-id="15eeb-173">這個介面的運作方式與功能表按鈕的 [ITfLangBarItemButton](/windows/desktop/api/Ctfutb/nn-ctfutb-itflangbaritembutton) 介面完全相同。</span><span class="sxs-lookup"><span data-stu-id="15eeb-173">This interface works exactly like the [ITfLangBarItemButton](/windows/desktop/api/Ctfutb/nn-ctfutb-itflangbaritembutton) interface for a menu button.</span></span> <span data-ttu-id="15eeb-174">顯示功能表時，所擴充的文字服務會呼叫 [ITfSystemLangBarItemSink：： InitMenu](/windows/desktop/api/ctfutb/nf-ctfutb-itfsystemlangbaritemsink-initmenu)。</span><span class="sxs-lookup"><span data-stu-id="15eeb-174">When the menu is displayed, the text service being extended calls [ITfSystemLangBarItemSink::InitMenu](/windows/desktop/api/ctfutb/nf-ctfutb-itfsystemlangbaritemsink-initmenu).</span></span> <span data-ttu-id="15eeb-175">此延伸模組會使用傳遞至 **InitMenu** 的 [ITfMenu](/windows/desktop/api/ctfutb/nn-ctfutb-itfmenu)介面，將專案新增至功能表中。</span><span class="sxs-lookup"><span data-stu-id="15eeb-175">The extension adds items to the menu using the [ITfMenu](/windows/desktop/api/ctfutb/nn-ctfutb-itfmenu) interface passed to **InitMenu**.</span></span> <span data-ttu-id="15eeb-176">當使用者選取擴充功能所加入的專案時，所擴充的文字服務會呼叫 [ITfSystemLangBarItemSink：： OnMenuSelect](/windows/desktop/api/ctfutb/nf-ctfutb-itfsystemlangbaritemsink-onmenuselect) ，並提供所選功能表項目的識別碼。</span><span class="sxs-lookup"><span data-stu-id="15eeb-176">When the user selects an item added by the extension, the text service being extended calls [ITfSystemLangBarItemSink::OnMenuSelect](/windows/desktop/api/ctfutb/nf-ctfutb-itfsystemlangbaritemsink-onmenuselect) with the identifier of the selected menu item.</span></span>

<span data-ttu-id="15eeb-177">若要安裝語言列功能表擴充功能，文字服務會完成下列步驟。</span><span class="sxs-lookup"><span data-stu-id="15eeb-177">To install a language bar menu extension, the text service completes the following steps.</span></span>

1.  <span data-ttu-id="15eeb-178">藉由呼叫 [ITfLangBarItemMgr：： GetItem](/windows/desktop/api/ctfutb/nf-ctfutb-itflangbaritemmgr-getitem)和要擴充之專案的 **GUID** ，來取得要延伸之專案的 **ITfLangBarItem** 介面。</span><span class="sxs-lookup"><span data-stu-id="15eeb-178">Obtain the **ITfLangBarItem** interface for the item to extend by calling [ITfLangBarItemMgr::GetItem](/windows/desktop/api/ctfutb/nf-ctfutb-itflangbaritemmgr-getitem) with the **GUID** for the item to be extended.</span></span>
2.  <span data-ttu-id="15eeb-179">藉由使用 IID ITfSource 來呼叫 ITfLangBarItem：： QueryInterface，以取得要延伸之專案的 **ITfSource** 介面 \_ 。</span><span class="sxs-lookup"><span data-stu-id="15eeb-179">Obtain the **ITfSource** interface for the item to extend by calling ITfLangBarItem::QueryInterface with IID\_ITfSource.</span></span>
3.  <span data-ttu-id="15eeb-180">使用 [](/windows/desktop/api/msctf/nf-msctf-itfsource-advisesink) IID \_ ITfSystemLangBarItemSink 和 **ITfSystemLangBarItemSink** 物件的指標呼叫 ITfSource：： AdviseSink。</span><span class="sxs-lookup"><span data-stu-id="15eeb-180">Call [ITfSource::AdviseSink](/windows/desktop/api/msctf/nf-msctf-itfsource-advisesink) with IID\_ITfSystemLangBarItemSink and the pointer to the **ITfSystemLangBarItemSink** object.</span></span> <span data-ttu-id="15eeb-181">如果 ITfSource：： AdviseSink 失敗，則文字服務不支援功能表延伸。</span><span class="sxs-lookup"><span data-stu-id="15eeb-181">If ITfSource::AdviseSink fails, the text service does not support menu extensions.</span></span>

<span data-ttu-id="15eeb-182">[ITfSource：： UnadviseSink](/windows/desktop/api/msctf/nf-msctf-itfsource-unadvisesink)**ITfSource：： AdviseSink**</span><span class="sxs-lookup"><span data-stu-id="15eeb-182">[ITfSource::UnadviseSink](/windows/desktop/api/msctf/nf-msctf-itfsource-unadvisesink)**ITfSource::AdviseSink**</span></span>

## <a name="supporting-language-bar-menu-extensions"></a><span data-ttu-id="15eeb-183">支援語言列功能表延伸模組</span><span class="sxs-lookup"><span data-stu-id="15eeb-183">Supporting Language Bar Menu Extensions</span></span>

<span data-ttu-id="15eeb-184">文字服務可以讓其他文字服務將專案新增至其語言列功能表，如上所示。</span><span class="sxs-lookup"><span data-stu-id="15eeb-184">A text service can enable other text services to add items to its language bar menus as shown above.</span></span> <span data-ttu-id="15eeb-185">必須發行其 GUID 的文字服務，以便藉由呼叫 [ITfLangBarItemMgr：： GetItem](/windows/desktop/api/ctfutb/nf-ctfutb-itflangbaritemmgr-getitem)來取得專案。</span><span class="sxs-lookup"><span data-stu-id="15eeb-185">The text service that must publish its GUID so that the item can be obtained by calling [ITfLangBarItemMgr::GetItem](/windows/desktop/api/ctfutb/nf-ctfutb-itflangbaritemmgr-getitem).</span></span>

<span data-ttu-id="15eeb-186">若要支援功能表延伸，文字服務必須支援 [ITfSource](/windows/desktop/api/msctf/nn-msctf-itfsource) 介面。</span><span class="sxs-lookup"><span data-stu-id="15eeb-186">To support menu extensions, the text service must support the [ITfSource](/windows/desktop/api/msctf/nn-msctf-itfsource) interface.</span></span> <span data-ttu-id="15eeb-187">下列步驟可讓您支援一或多個功能表延伸模組。</span><span class="sxs-lookup"><span data-stu-id="15eeb-187">The following steps enable support for one or more menu extensions.</span></span>

1.  <span data-ttu-id="15eeb-188">當呼叫 [ITfSource：： AdviseSink](/windows/desktop/api/msctf/nf-msctf-itfsource-advisesink) 與 IID \_ ITfSystemLangBarItemSink 時，文字服務必須儲存 **ITfSystemLangBarItemSink** 介面，並傳回將識別延伸模組的 cookie 值。</span><span class="sxs-lookup"><span data-stu-id="15eeb-188">When [ITfSource::AdviseSink](/windows/desktop/api/msctf/nf-msctf-itfsource-advisesink) with IID\_ITfSystemLangBarItemSink is called, the text service must store the **ITfSystemLangBarItemSink** interface and return a cookie value that will identify the extension.</span></span>
2.  <span data-ttu-id="15eeb-189">呼叫 [ITfLangBarItemButton：： InitMenu](/windows/desktop/api/Ctfutb/nf-ctfutb-itflangbaritembutton-initmenu) 時，文字服務會呼叫延伸模組的 [ITfSystemLangBarItemSink：： InitMenu](/windows/desktop/api/ctfutb/nf-ctfutb-itfsystemlangbaritemsink-initmenu) 方法。</span><span class="sxs-lookup"><span data-stu-id="15eeb-189">When [ITfLangBarItemButton::InitMenu](/windows/desktop/api/Ctfutb/nf-ctfutb-itflangbaritembutton-initmenu) is called, the text service calls the extension's [ITfSystemLangBarItemSink::InitMenu](/windows/desktop/api/ctfutb/nf-ctfutb-itfsystemlangbaritemsink-initmenu) method.</span></span> <span data-ttu-id="15eeb-190">文字服務必須執行方法來識別擴充功能所加入的功能表項目，而不是文字服務本身加入的專案。</span><span class="sxs-lookup"><span data-stu-id="15eeb-190">The text service must implement a way to identify the menu items added by the extension as opposed to the items added by the text service itself.</span></span>
3.  <span data-ttu-id="15eeb-191">使用屬於延伸模組的功能表項目識別碼呼叫 [ITfLangBarItemButton：： OnMenuSelect](/windows/desktop/api/Ctfutb/nf-ctfutb-itflangbaritembutton-onmenuselect) 時，文字服務會呼叫延伸模組的 **ITfSystemLangBarItemSink：： OnMenuSelect** 方法。</span><span class="sxs-lookup"><span data-stu-id="15eeb-191">When [ITfLangBarItemButton::OnMenuSelect](/windows/desktop/api/Ctfutb/nf-ctfutb-itflangbaritembutton-onmenuselect) is called with a menu item identifier that belongs to an extension, the text service calls the extensions's **ITfSystemLangBarItemSink::OnMenuSelect** method.</span></span>
4.  <span data-ttu-id="15eeb-192">使用適當的 cookie 呼叫 [ITfSource：： UnadviseSink](/windows/desktop/api/msctf/nf-msctf-itfsource-unadvisesink) 時，文字服務會移除功能表延伸。</span><span class="sxs-lookup"><span data-stu-id="15eeb-192">When [ITfSource::UnadviseSink](/windows/desktop/api/msctf/nf-msctf-itfsource-unadvisesink) is called with the appropriate cookie, the text service removes the menu extension.</span></span>

## <a name="related-topics"></a><span data-ttu-id="15eeb-193">相關主題</span><span class="sxs-lookup"><span data-stu-id="15eeb-193">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="15eeb-194">如何設定文字服務架構</span><span class="sxs-lookup"><span data-stu-id="15eeb-194">How To Set Up Text Services Framework</span></span>](how-to-set-up-tsf.md)
</dt> <dt>

[<span data-ttu-id="15eeb-195">Language Bar (應用程式) </span><span class="sxs-lookup"><span data-stu-id="15eeb-195">Language Bar (Applications)</span></span>](language-bar-app.md)
</dt> </dl>

 

 
