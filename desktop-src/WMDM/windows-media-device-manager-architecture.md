---
title: Windows Media 裝置管理員架構
description: Windows Media 裝置管理員架構
ms.assetid: 3c1b2da4-559d-427b-b502-5ef8dc055a8e
keywords:
- Windows Media 裝置管理員，架構
- 裝置管理員，架構
- Windows Media 裝置管理員的架構
- Windows Media 裝置管理員，桌面應用程式
- 裝置管理員，桌面應用程式
- Windows Media 裝置管理員、服務提供者
- 裝置管理員，服務提供者
- Windows Media 裝置管理員、外掛程式
- 裝置管理員、外掛程式
- 桌面應用程式、Windows Media 裝置管理員架構
- 服務提供者、Windows Media 裝置管理員架構
- 外掛程式，Windows Media 裝置管理員架構
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9fda87e4ed4bce2c82bbb9c0863c119851965940
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/16/2019
ms.locfileid: "104183234"
---
# <a name="windows-media-device-manager-architecture"></a><span data-ttu-id="d1daf-115">Windows Media 裝置管理員架構</span><span class="sxs-lookup"><span data-stu-id="d1daf-115">Windows Media Device Manager Architecture</span></span>

<span data-ttu-id="d1daf-116">Windows Media 裝置管理員可讓應用程式或外掛程式與裝置通訊。</span><span class="sxs-lookup"><span data-stu-id="d1daf-116">Windows Media Device Manager enables an application or plug-in to communicate with a device.</span></span> <span data-ttu-id="d1daf-117">應用程式可以要求裝置中繼資料、列舉和探索連接的裝置，以及傳送或接收物件 (資料夾、檔案、播放清單等) 。</span><span class="sxs-lookup"><span data-stu-id="d1daf-117">Applications can request device metadata, enumerate and explore attached devices, and send or receive objects (folders, files, playlists, and so on).</span></span> <span data-ttu-id="d1daf-118">無論 (MTP 或大型儲存類別所呼叫的裝置類型為何，Windows Media 裝置管理員都會提供單一 API 給呼叫的應用程式，而這些服務提供者是以舊版 Windows Media 裝置管理員) 的版本10或服務提供者為基礎。</span><span class="sxs-lookup"><span data-stu-id="d1daf-118">Windows Media Device Manager provides a single API to the calling application, no matter what type of device is being called (MTP or Mass Storage Class, service providers built on version 10 or service providers built on earlier versions of Windows Media Device Manager).</span></span>

<span data-ttu-id="d1daf-119">Windows Media 裝置管理員可作為系統的三個主要元件的「移至」：應用程式，這會要求 (資訊的要求、讀取或寫入資料，以及) ;安全內容提供者，其為處理受 DRM 保護檔案之通訊的元件;和服務提供者，會接收來自應用程式的要求，並與裝置通訊以執行這些要求。</span><span class="sxs-lookup"><span data-stu-id="d1daf-119">Windows Media Device Manager acts as a go-between for the three major components of the system: the application, which makes requests (for information, to read or write data, and so on); a secure content provider, which is a component that handles communication with DRM-protected files; and a service provider, which receives requests from the application and communicates with the device to perform these requests.</span></span> <span data-ttu-id="d1daf-120">應用程式和服務提供者都是以 Windows Media 裝置管理員 SDK 為基礎。</span><span class="sxs-lookup"><span data-stu-id="d1daf-120">Both the application and the service provider are built on the Windows Media Device Manager SDK.</span></span>

<span data-ttu-id="d1daf-121">下圖顯示桌面應用程式如何使用 Windows Media 裝置管理員11來與裝置通訊。</span><span class="sxs-lookup"><span data-stu-id="d1daf-121">The following diagram shows how a desktop application communicates with a device using Windows Media Device Manager 11.</span></span>

![此圖顯示與四種不同類型的裝置通訊的應用程式。](images/wmdm-device-communication.gif)

<span data-ttu-id="d1daf-123">上圖顯示的應用程式與四種不同類型的裝置通訊，每個裝置都有自己的服務提供者。</span><span class="sxs-lookup"><span data-stu-id="d1daf-123">The preceding diagram shows an application communicating with four different types of devices, each with its own service provider.</span></span> <span data-ttu-id="d1daf-124">每個服務提供者的設計都是為了與特定類型的裝置通訊;下圖顯示三個 Microsoft 提供的服務提供者 (適用于大型儲存類別裝置、RAPI 裝置和 MTP 裝置) 的一般類別驅動程式，以及由協力廠商所建立之專屬裝置的自訂服務提供者。</span><span class="sxs-lookup"><span data-stu-id="d1daf-124">Every service provider is designed to communicate with a specific type of device; this diagram shows the three Microsoft-provided service providers (generic class drivers for Mass Storage Class devices, RAPI devices, and MTP devices), as well as a custom service provider for a proprietary device built by a third party.</span></span> <span data-ttu-id="d1daf-125">當裝置連線時，Windows Media 裝置管理員會將為該裝置註冊的服務提供者實例具現化。</span><span class="sxs-lookup"><span data-stu-id="d1daf-125">When a device connects, Windows Media Device Manager instantiates an instance of the service provider registered for that device.</span></span> <span data-ttu-id="d1daf-126">服務提供者會透過其所執行的 Windows Media 裝置管理員介面，從應用程式取得要求、使用適當的驅動程式與裝置通訊，以及傳回適當的結果。</span><span class="sxs-lookup"><span data-stu-id="d1daf-126">The service providers get requests from the application through Windows Media Device Manager interfaces that they implement, use appropriate drivers to communicate with the device, and return appropriate results.</span></span> <span data-ttu-id="d1daf-127">服務提供者與裝置之間的通訊是在 Windows Media 裝置管理員的網域之外。</span><span class="sxs-lookup"><span data-stu-id="d1daf-127">Communication between the service provider and the device is outside the domain of Windows Media Device Manager.</span></span>

<span data-ttu-id="d1daf-128">應用程式無法看到服務提供者;應用程式只會看到「裝置」清單，因為 Windows Media 裝置管理員會為所有裝置公開一組標準的方法和介面。</span><span class="sxs-lookup"><span data-stu-id="d1daf-128">Service providers are invisible to the application; an application sees only a list of "devices" because Windows Media Device Manager exposes a standard set of methods and interfaces for all devices.</span></span> <span data-ttu-id="d1daf-129">如果製造商建立自訂服務提供者，則如果應用程式能夠使用裝置，則必須處理所有標準 Windows Media 裝置管理員方法。</span><span class="sxs-lookup"><span data-stu-id="d1daf-129">If a manufacturer creates a custom service provider, it must handle all the standard Windows Media Device Manager methods if applications are to be able to use the device.</span></span>

<span data-ttu-id="d1daf-130">此圖表也會顯示 (SCP) 模組的安全內容提供者。</span><span class="sxs-lookup"><span data-stu-id="d1daf-130">This diagram also shows a secure content provider (SCP) module.</span></span> <span data-ttu-id="d1daf-131">本課程模組負責處理 (DRM) 受保護內容的數位版權管理。</span><span class="sxs-lookup"><span data-stu-id="d1daf-131">This module is responsible for handling digital rights management (DRM) protected content.</span></span> <span data-ttu-id="d1daf-132">Microsoft 提供可處理受 DRM 保護的 WMA 和 WMV 檔案的 SCP 模組。</span><span class="sxs-lookup"><span data-stu-id="d1daf-132">Microsoft provides an SCP module that can handle DRM-protected WMA and WMV files.</span></span> <span data-ttu-id="d1daf-133">如果應用程式或裝置打算處理其他受保護的格式，則必須提供自己的 SCP 模組。</span><span class="sxs-lookup"><span data-stu-id="d1daf-133">If an application or device intends to handle other protected formats, it must provide its own SCP module.</span></span> <span data-ttu-id="d1daf-134">應用程式和服務提供者都不會直接處理 SCP。</span><span class="sxs-lookup"><span data-stu-id="d1daf-134">Neither the application nor the service provider deals with the SCP directly.</span></span>

<span data-ttu-id="d1daf-135">應用程式和服務提供者都建置於 Windows Media 裝置管理員，其會在應用程式和裝置的適當服務提供者之間路由傳送呼叫;服務提供者負責直接與裝置通訊。</span><span class="sxs-lookup"><span data-stu-id="d1daf-135">Both the application and the service provider are built on Windows Media Device Manager, which routes calls between the application and the appropriate service provider for a device; the service provider is responsible for communicating directly with the device.</span></span> <span data-ttu-id="d1daf-136">Windows Media 裝置管理員確實會執行一些 (動作，例如列舉連線的裝置、路由呼叫，以及處理元件驗證) ;不過，大部分的工作都是由服務提供者完成，它會接收來自應用程式的要求，並與裝置通訊。</span><span class="sxs-lookup"><span data-stu-id="d1daf-136">Windows Media Device Manager does perform some actions itself (such as enumerating connected devices, routing calls, and handling component verification); however, most of the work is done by the service provider, which receives requests from the application and communicates with the device.</span></span>

<span data-ttu-id="d1daf-137">以 Windows Media 裝置管理員為基礎的應用程式可以與建立在舊版 Windows Media 裝置管理員上的裝置和服務提供者進行通訊;不過，這些較舊的裝置將會透過9個系列元件執行， (不會顯示) ，而且不支援最新的功能，特別是更先進的數位版權管理技術。</span><span class="sxs-lookup"><span data-stu-id="d1daf-137">An application built on Windows Media Device Manager can communicate with devices and service providers built on earlier versions of Windows Media Device Manager; however, these older devices will be run through 9 Series components (not shown), and will not support the newest features, particularly the more advanced digital rights management technology.</span></span>

<span data-ttu-id="d1daf-138">裝置的架構</span><span class="sxs-lookup"><span data-stu-id="d1daf-138">Architecture of a Device</span></span>

<span data-ttu-id="d1daf-139">下圖顯示使用 Windows Media 裝置管理員的應用程式所看到的簡化裝置和儲存體階層。</span><span class="sxs-lookup"><span data-stu-id="d1daf-139">The following diagram shows a simplified hierarchy of devices and storages as seen by an application using Windows Media Device Manager.</span></span>

![顯示裝置上存放裝置的圖表。](images/wmdm-basic-device-layout.gif)

<span data-ttu-id="d1daf-141">上圖顯示連接快閃磁片磁碟機的簡化版本，如 Windows Media 裝置管理員應用程式所見。</span><span class="sxs-lookup"><span data-stu-id="d1daf-141">The preceding diagram shows a simplified version of a connected flash drive, as seen by a Windows Media Device Manager application.</span></span> <span data-ttu-id="d1daf-142">快閃磁片磁碟機有屬性和屬性，例如序號和支援的格式設定。</span><span class="sxs-lookup"><span data-stu-id="d1daf-142">The flash drive has attributes and properties, such as a serial number and supported format configurations.</span></span> <span data-ttu-id="d1daf-143">Flash 裝置的直屬子系是根儲存物件，它包含資料夾，其本身包含影像和歌曲。</span><span class="sxs-lookup"><span data-stu-id="d1daf-143">An immediate child of the flash device is the root storage object, which contains a folder, which itself contains an image and a song.</span></span>

<span data-ttu-id="d1daf-144">應用程式會藉由呼叫根 [**IWMDeviceManager**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdevicemanager) 介面所公開的列舉方法來列舉附加裝置的清單。</span><span class="sxs-lookup"><span data-stu-id="d1daf-144">An application enumerates the list of attached devices by calling an enumeration method exposed by the root [**IWMDeviceManager**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdevicemanager) interface.</span></span> <span data-ttu-id="d1daf-145">裝置會以 [**IWMDMDevice**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdmdevice) (或衍生) 介面表示。</span><span class="sxs-lookup"><span data-stu-id="d1daf-145">Devices are represented by an [**IWMDMDevice**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdmdevice) (or a derived) interface.</span></span> <span data-ttu-id="d1daf-146">此介面會公開方法，以抓取裝置名稱、格式功能、序號等，以及列舉裝置上之 *存儲* 設備的方法。</span><span class="sxs-lookup"><span data-stu-id="d1daf-146">This interface exposes methods to retrieve the device name, format capabilities, serial number, and so on, as well as a method that enumerates *storages* on the device.</span></span> <span data-ttu-id="d1daf-147">在 Windows Media 裝置管理員中，儲存體是裝置上的任何一種物件，不論它是否為實際的資料 blob。</span><span class="sxs-lookup"><span data-stu-id="d1daf-147">In Windows Media Device Manager, a storage is any kind of object on the device, whether or not it is an actual blob of data.</span></span> <span data-ttu-id="d1daf-148">例如：儲存為檔案的音訊檔案、文字檔、資料夾、播放清單，以及儲存為中繼資料的播放清單都會被視為儲存，即使資料夾和中繼資料專案可能不代表實體檔案也是一樣。</span><span class="sxs-lookup"><span data-stu-id="d1daf-148">For example: audio files, text files, folders, playlists stored as files, and playlists stored as metadata are all considered storages, even though folders and metadata items probably do not represent a physical file.</span></span> <span data-ttu-id="d1daf-149">您可以藉由呼叫 [**GetAttributes**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage-getattributes) (或 [**GetMetadata**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage3-getmetadata)，要求儲存) 的格式，來抓取儲存體的類型 (或格式) 。</span><span class="sxs-lookup"><span data-stu-id="d1daf-149">The type (or format) of a storage can be retrieved by calling [**GetAttributes**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage-getattributes) (or [**GetMetadata**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage3-getmetadata), requesting the format of the storage).</span></span>

<span data-ttu-id="d1daf-150">裝置上的儲存體會以階層方式儲存，所有裝置都有根儲存體。</span><span class="sxs-lookup"><span data-stu-id="d1daf-150">Storages on a device are stored hierarchically, and all devices have a root storage.</span></span> <span data-ttu-id="d1daf-151">每個儲存區可以保留零個或多個子物件，藉由呼叫該儲存體的 [**IWMDMStorage：： EnumStorage**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage-enumstorage) 方法來列舉。</span><span class="sxs-lookup"><span data-stu-id="d1daf-151">Each storage can hold zero or more child objects, enumerated by calling that storage's [**IWMDMStorage::EnumStorage**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage-enumstorage) method.</span></span>

<span data-ttu-id="d1daf-152">請注意，圖表中的每個儲存區都有相關聯的屬性和中繼資料 (並非所有值都會顯示) 。</span><span class="sxs-lookup"><span data-stu-id="d1daf-152">Note that each storage in the diagram has attributes and metadata associated with it (not all values are shown).</span></span> <span data-ttu-id="d1daf-153">屬性很簡單，也就是布林資訊，通常描述管理或導覽資訊 (例如「有資料夾」或「可刪除」 ) ，中繼資料可以是字串值、數位或複雜的資訊 (例如) 的轉譯功能。</span><span class="sxs-lookup"><span data-stu-id="d1daf-153">Attributes are simple, Boolean information often describing management or navigational information (such as "has folders" or "can delete"), whereas metadata can be string values, numbers, or complex information (such as rendering capabilities).</span></span> <span data-ttu-id="d1daf-154">屬性是由 SDK 所定義且一組相當有限的旗標所描述，並藉由呼叫 [**IWMDMStorage：： GetAttributes**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage-getattributes) 或 [**IWMDMStorage2：： GetAttributes2**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage2-getattributes2)來加以取出。</span><span class="sxs-lookup"><span data-stu-id="d1daf-154">Attributes are described by a fairly limited set of flags defined by the SDK and retrieved by calling [**IWMDMStorage::GetAttributes**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage-getattributes) or [**IWMDMStorage2::GetAttributes2**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage2-getattributes2).</span></span> <span data-ttu-id="d1daf-155">中繼資料值是以唯一名稱抓取;SDK 會定義許多裝置應該支援的中繼資料值，但裝置可以定義自己的 [中繼資料常數](metadata-constants.md)。</span><span class="sxs-lookup"><span data-stu-id="d1daf-155">Metadata values are retrieved by a unique name; the SDK defines a number of metadata values that devices should support, but devices can define their own [metadata constants](metadata-constants.md).</span></span> <span data-ttu-id="d1daf-156">但是，如果裝置或服務提供者定義了新的中繼資料常數，除非應用程式開發人員知道這個新的常數，否則應用程式將無法要求或設定這個值。</span><span class="sxs-lookup"><span data-stu-id="d1daf-156">However, if a device or service provider defines a new metadata constant, applications won't be able to request or set this value unless the application developers were aware of this new constant.</span></span> <span data-ttu-id="d1daf-157">服務提供者必須支援 [**IWMDMStorage3**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdmstorage3) 或更新版本，才能支援抓取或設定中繼資料。</span><span class="sxs-lookup"><span data-stu-id="d1daf-157">A service provider must support [**IWMDMStorage3**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdmstorage3) or later to support retrieving or setting metadata.</span></span> <span data-ttu-id="d1daf-158">如需詳細資訊，請參閱 [取得和設定中繼資料和屬性](getting-and-setting-metadata-and-attributes.md)。</span><span class="sxs-lookup"><span data-stu-id="d1daf-158">For more information, see [Getting and Setting Metadata and Attributes](getting-and-setting-metadata-and-attributes.md).</span></span>

<span data-ttu-id="d1daf-159">服務提供者</span><span class="sxs-lookup"><span data-stu-id="d1daf-159">Service Providers</span></span>

<span data-ttu-id="d1daf-160">服務提供者會作為應用程式與裝置之間的中間人。</span><span class="sxs-lookup"><span data-stu-id="d1daf-160">The service provider acts as a middleman between the application and the device.</span></span> <span data-ttu-id="d1daf-161">應用程式開發人員看不到服務提供者，因此應用程式開發人員不需要知道有關開發服務提供者的任何事項。</span><span class="sxs-lookup"><span data-stu-id="d1daf-161">The service provider is invisible to the application developer, so an application developer does not need to know anything about developing a service provider.</span></span> <span data-ttu-id="d1daf-162">不過，它是可執行與裝置通訊之工作的服務提供者。</span><span class="sxs-lookup"><span data-stu-id="d1daf-162">However, it is the service provider that does the work of communicating with a device.</span></span>

<span data-ttu-id="d1daf-163">服務提供者是建立在 Windows Media 裝置管理員上的 COM DLL，可接收來自應用程式的要求，並與裝置通訊以執行這些要求。</span><span class="sxs-lookup"><span data-stu-id="d1daf-163">A service provider is a COM DLL built on Windows Media Device Manager that receives requests from an application and communicates with the device to perform them.</span></span> <span data-ttu-id="d1daf-164">與桌面應用程式的通訊是由 Windows Media 裝置管理員 mediated;與裝置的通訊是在服務提供者的控制之下。</span><span class="sxs-lookup"><span data-stu-id="d1daf-164">Communication with the desktop application is mediated by Windows Media Device Manager; communication with the device is under the control of the service provider.</span></span>

<span data-ttu-id="d1daf-165">服務提供者會接收來自應用程式的要求，以列舉裝置內容、裝置功能要求、讀取或寫入資料的要求等等。</span><span class="sxs-lookup"><span data-stu-id="d1daf-165">A service provider receives requests from the application to enumerate device content, requests for device capabilities, requests to read or write data, and so on.</span></span> <span data-ttu-id="d1daf-166">它必須知道裝置的設計是否足夠，才能以適當的格式和通訊協定來傳送命令。</span><span class="sxs-lookup"><span data-stu-id="d1daf-166">It must know the design of a device well enough that it can send commands in the proper format and protocol.</span></span> <span data-ttu-id="d1daf-167">它也應該能夠隱藏裝置特定需求，例如播放清單的必要副檔名，讓應用程式不需要知道這些需求就能使用裝置。</span><span class="sxs-lookup"><span data-stu-id="d1daf-167">It should also be able to hide device-specific requirements, such as a required file extension for playlists, so that applications do not need to know these requirements in order to use the device.</span></span>

<span data-ttu-id="d1daf-168">Microsoft 提供許多標準裝置類型的服務提供者，包括一般 MTP 裝置、大型儲存類別裝置，以及 RAPI 裝置。</span><span class="sxs-lookup"><span data-stu-id="d1daf-168">Microsoft provides a number of service providers for standard device types, including generic MTP devices, Mass Storage Class devices, and RAPI devices.</span></span> <span data-ttu-id="d1daf-169">裝置設計工具需要建立自訂服務提供者的唯一原因是，裝置有一些特定或不尋常的標準服務提供者未處理的資料儲存需求，例如，如果檔案必須儲存在特定的位置，而裝置作業系統不會自動處理這種情況。</span><span class="sxs-lookup"><span data-stu-id="d1daf-169">The only reason a device designer should need to create a custom service provider is if a device has some specific or unusual data storage requirements that the standard service providers do not handle—for instance, if files must be stored in specific locations and the device operating system does not handle this automatically.</span></span>

<span data-ttu-id="d1daf-170">當裝置連接到電腦時，作業系統會為每個 Windows Media 裝置管理員的應用程式，建立一個適當服務提供者的實例。</span><span class="sxs-lookup"><span data-stu-id="d1daf-170">When a device is connected to the computer, the operating system creates one instance of the appropriate service provider for each Windows Media Device Manager application.</span></span> <span data-ttu-id="d1daf-171">如果第二個 Windows Media 裝置管理員應用程式啟動，則會載入服務提供者的第二個實例。</span><span class="sxs-lookup"><span data-stu-id="d1daf-171">If a second Windows Media Device Manager application starts, a second instance of the service provider will be loaded.</span></span> <span data-ttu-id="d1daf-172">不過，每個服務提供者都可以處理多個裝置。</span><span class="sxs-lookup"><span data-stu-id="d1daf-172">However, each service provider can handle multiple devices.</span></span> <span data-ttu-id="d1daf-173">下圖顯示這個關係。</span><span class="sxs-lookup"><span data-stu-id="d1daf-173">The following diagram illustrates this.</span></span>

![此圖顯示兩個與兩個應用程式通訊的 mtp 裝置。](images/wmdm-sp-to-device.gif)

<span data-ttu-id="d1daf-175">上圖顯示兩個不同的應用程式與兩個 MTP 裝置通訊。</span><span class="sxs-lookup"><span data-stu-id="d1daf-175">The preceding diagram shows two different applications communicating with two MTP devices.</span></span> <span data-ttu-id="d1daf-176">裝置使用相同的服務提供者類別，但每個應用程式都有自己的相同服務提供者實例。</span><span class="sxs-lookup"><span data-stu-id="d1daf-176">The devices use the same service provider class, but each application has its own instance of the same service provider.</span></span> <span data-ttu-id="d1daf-177">每個服務提供者實例正在與裝置通訊。</span><span class="sxs-lookup"><span data-stu-id="d1daf-177">Each service provider instance is communicating with devices.</span></span> <span data-ttu-id="d1daf-178">不同的服務提供者實例彼此都不會察覺。</span><span class="sxs-lookup"><span data-stu-id="d1daf-178">The different instances of the service provider are not aware of each other.</span></span>

<span data-ttu-id="d1daf-179">許多應用程式方法都有相對應的名稱服務提供者方法。</span><span class="sxs-lookup"><span data-stu-id="d1daf-179">Many application methods have a correspondingly named service provider method.</span></span> <span data-ttu-id="d1daf-180">當應用程式呼叫方法時，Windows Media 裝置管理員會在服務提供者上將呼叫路由傳送至對應的方法 (但它可能會) 先執行一些額外的內部動作。</span><span class="sxs-lookup"><span data-stu-id="d1daf-180">When the application calls a method, Windows Media Device Manager routes the call to the corresponding method on the service provider (though it might perform some additional internal actions first).</span></span> <span data-ttu-id="d1daf-181">例如，當應用程式呼叫 [**IWMDMDevice3：： GetProperty**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmdevice3-getproperty)時，Windows Media 裝置管理員會將此呼叫路由傳送至服務提供者的 [**IMDSPDevice3：： GetProperty**](/windows/desktop/api/mswmdm/nf-mswmdm-imdspdevice3-getproperty)的執行。</span><span class="sxs-lookup"><span data-stu-id="d1daf-181">For example, when the application calls [**IWMDMDevice3::GetProperty**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmdevice3-getproperty), Windows Media Device Manager routes this call to the service provider's implementation of [**IMDSPDevice3::GetProperty**](/windows/desktop/api/mswmdm/nf-mswmdm-imdspdevice3-getproperty).</span></span> <span data-ttu-id="d1daf-182"> (大部分的應用程式介面都以 IWMDM 開頭，且對應的服務提供者介面開頭為 IMDSP) 。</span><span class="sxs-lookup"><span data-stu-id="d1daf-182">(Most application interfaces begin with IWMDM, and the corresponding service provider interface begins with IMDSP).</span></span> <span data-ttu-id="d1daf-183">服務提供者預期會處理此方法呼叫，並傳回適當的結果。</span><span class="sxs-lookup"><span data-stu-id="d1daf-183">The service provider is expected to handle this method call and return an appropriate result.</span></span>

<span data-ttu-id="d1daf-184">應用程式永遠不會直接 (探索或與裝置通訊，除非它呼叫 [**IWMDMDevice3：:D eviceiocontrol**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmdevice3-deviceiocontrol) 或 [**IWMDMStorage：： SendOpaqueCommand**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage-sendopaquecommand)) ;應用程式會與服務提供者進行通訊，該服務提供者必須以最具邏輯和簡單的方式來代表裝置。</span><span class="sxs-lookup"><span data-stu-id="d1daf-184">An application never explores or communicates with a device directly (unless it calls [**IWMDMDevice3::DeviceIoControl**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmdevice3-deviceiocontrol) or [**IWMDMStorage::SendOpaqueCommand**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage-sendopaquecommand)); the application communicates with the service provider, which must represent a device in the most logical and simple manner possible.</span></span> <span data-ttu-id="d1daf-185">當應用程式要求裝置的相關資訊，或列舉裝置上的物件時，服務提供者會以適當的方式查詢裝置，並取得並傳回適當的資訊。</span><span class="sxs-lookup"><span data-stu-id="d1daf-185">When the application requests information about the device, or enumerates objects on the device, the service provider queries the device in an appropriate manner and acquires and returns the appropriate information.</span></span> <span data-ttu-id="d1daf-186">它可能會以不同的方式將裝置上的檔案組織公開于裝置上（如果適合的話）。</span><span class="sxs-lookup"><span data-stu-id="d1daf-186">It may expose the file organization on the device differently from how it is physically stored on the device, if that is appropriate.</span></span> <span data-ttu-id="d1daf-187">不過，它會公開裝置，它應該是以一致的邏輯方式，讓應用程式能夠找出所需的內容，並處理它所傳送的命令。</span><span class="sxs-lookup"><span data-stu-id="d1daf-187">However it exposes the device, it should be in a consistent, logical manner, to enable the application to find what it needs and handle the commands it sends.</span></span> <span data-ttu-id="d1daf-188">良好的服務提供者將會隱藏裝置特定的特性，例如，如果裝置實際將播放清單儲存為具有自訂副檔名的檔案，則服務提供者應該會在應用程式在裝置上建立播放清單時自動新增該擴充功能;建立播放清單物件時，應用程式不應該知道適當的副檔名。</span><span class="sxs-lookup"><span data-stu-id="d1daf-188">A good service provider will hide device-specific peculiarities—for example, if the device physically stores a playlist as a file with a custom file extension, the service provider should add that extension automatically when the application creates a playlist on the device; it should not expect the application to know the proper extension when creating a playlist object.</span></span>

<span data-ttu-id="d1daf-189">服務提供者會在呼叫應用程式的進程內執行。</span><span class="sxs-lookup"><span data-stu-id="d1daf-189">Service providers run inside the process of the calling application.</span></span> <span data-ttu-id="d1daf-190">唯一的例外是 MTP 服務提供者，它會在自己的進程中執行。</span><span class="sxs-lookup"><span data-stu-id="d1daf-190">The only exception to this is the MTP service provider, which runs in its own process.</span></span> <span data-ttu-id="d1daf-191">因此，封鎖的服務提供者會造成呼叫應用程式封鎖的風險。</span><span class="sxs-lookup"><span data-stu-id="d1daf-191">Because of this, there is some risk that a blocked service provider will cause the calling application to block.</span></span> <span data-ttu-id="d1daf-192">因此，服務提供者應設計為穩定且防止封鎖，應用程式應設計成在特定方法呼叫不會快速傳回時避免拖延。</span><span class="sxs-lookup"><span data-stu-id="d1daf-192">Therefore, service providers should be designed to be robust and prevent blocking, and applications should be designed to avoid stalling if a particular method call does not return quickly.</span></span>

## <a name="related-topics"></a><span data-ttu-id="d1daf-193">相關主題</span><span class="sxs-lookup"><span data-stu-id="d1daf-193">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="d1daf-194">**開始使用**</span><span class="sxs-lookup"><span data-stu-id="d1daf-194">**Getting Started**</span></span>](getting-started.md)
</dt> </dl>

 

 




