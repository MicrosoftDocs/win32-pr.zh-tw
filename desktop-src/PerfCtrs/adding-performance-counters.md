---
description: 應用程式專屬的效能計數器可協助您在開發和偵測應用程式時微調效能。
ms.assetid: 016386f6-4675-409e-8446-599e4ff96109
title: 新增效能計數器
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8660af9406de4dedec3ecbd76169a23b342aa7d2
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "106980855"
---
# <a name="adding-performance-counters"></a><span data-ttu-id="bc918-103">新增效能計數器</span><span class="sxs-lookup"><span data-stu-id="bc918-103">Adding Performance Counters</span></span>

> [!IMPORTANT]
> <span data-ttu-id="bc918-104">由於有顯著的效能和可靠性限制，提供本主題所描述的效能計數器資料的方法，可能會在未來變更或無法使用。</span><span class="sxs-lookup"><span data-stu-id="bc918-104">Due to significant performance and reliability limitations, the method for providing performance counter data that this topic describes may be altered or unavailable in the future.</span></span> <span data-ttu-id="bc918-105">相反地，Microsoft 建議您使用使用 [2.0 版提供計數器資料](providing-counter-data-using-version-2-0.md) 來建立新的效能計數器，以及遷移現有的效能計數器來使用該方法所述的方法。</span><span class="sxs-lookup"><span data-stu-id="bc918-105">Instead, Microsoft recommends that you use the method described in [Providing Counter Data Using Version 2.0](providing-counter-data-using-version-2-0.md) for creating new performance counters, and that you migrate existing performance counters to use that method as well.</span></span>

<span data-ttu-id="bc918-106">應用程式專屬的效能計數器可協助您在開發和偵測應用程式時微調效能。</span><span class="sxs-lookup"><span data-stu-id="bc918-106">Performance counters specific to your application can help you tune performance while you develop and debug the application.</span></span> <span data-ttu-id="bc918-107">當您的應用程式完成並安裝在目標系統上之後，計數器可協助系統管理員調整您應用程式的可設定設定。</span><span class="sxs-lookup"><span data-stu-id="bc918-107">After your application is complete and installed on target systems, the counters can help system administrators adjust configurable settings for your application.</span></span>

## <a name="adding-a-performance-object-and-its-counters"></a><span data-ttu-id="bc918-108">新增效能物件與其計數器</span><span class="sxs-lookup"><span data-stu-id="bc918-108">Adding a performance object and its counters</span></span>

1. <span data-ttu-id="bc918-109">設計應用程式的物件類型和計數器。</span><span class="sxs-lookup"><span data-stu-id="bc918-109">Design the object types and counters for the application.</span></span> <span data-ttu-id="bc918-110">如需詳細資訊，請參閱 [物件和計數器設計](object-and-counter-design.md)。</span><span class="sxs-lookup"><span data-stu-id="bc918-110">For details, see [Object and Counter Design](object-and-counter-design.md).</span></span>
2. <span data-ttu-id="bc918-111">建立包含您所提供之效能物件和計數器名稱和描述的 ( .ini) 檔案的初始化。</span><span class="sxs-lookup"><span data-stu-id="bc918-111">Create an initialization (.ini) file containing the names and descriptions of the performance objects and counters that you provide.</span></span> <span data-ttu-id="bc918-112">如需詳細資訊，請參閱 [將計數器名稱和描述新增至](adding-counter-names-and-descriptions-to-the-registry.md)登錄。</span><span class="sxs-lookup"><span data-stu-id="bc918-112">For details, see [Adding Counter Names and Descriptions to the Registry](adding-counter-names-and-descriptions-to-the-registry.md).</span></span>
3. <span data-ttu-id="bc918-113">建立標頭 ( .h) 檔案，其中包含計數器物件和計數器將在登錄中安裝的相對位移。</span><span class="sxs-lookup"><span data-stu-id="bc918-113">Create a header (.h) file containing the relative offsets at which the counter objects and counters will be installed in the registry.</span></span> <span data-ttu-id="bc918-114">如需詳細資訊，請參閱 [將計數器名稱和描述新增至](adding-counter-names-and-descriptions-to-the-registry.md)登錄。</span><span class="sxs-lookup"><span data-stu-id="bc918-114">For details, see [Adding Counter Names and Descriptions to the Registry](adding-counter-names-and-descriptions-to-the-registry.md).</span></span>
4. <span data-ttu-id="bc918-115">在登錄中設定所需的效能監視專案。</span><span class="sxs-lookup"><span data-stu-id="bc918-115">Set up the necessary performance monitoring entries in the registry.</span></span> <span data-ttu-id="bc918-116">這包括下列步驟。</span><span class="sxs-lookup"><span data-stu-id="bc918-116">This includes the following steps.</span></span>
    1. <span data-ttu-id="bc918-117">在應用程式的 **服務** 金鑰中建立登錄機碼。</span><span class="sxs-lookup"><span data-stu-id="bc918-117">Create a registry key in the **Services** key for the application.</span></span> <span data-ttu-id="bc918-118">如果您沒有這類節點，請在下列登錄機碼底下建立它： `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services` 。</span><span class="sxs-lookup"><span data-stu-id="bc918-118">If you do not have such a node, create it under the following registry key: `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services`.</span></span> <span data-ttu-id="bc918-119">如需詳細資訊，請參閱 [建立應用程式的效能金鑰](creating-the-applications-performance-key.md)。</span><span class="sxs-lookup"><span data-stu-id="bc918-119">For details, see [Creating the Application's Performance Key](creating-the-applications-performance-key.md).</span></span>
    2. <span data-ttu-id="bc918-120">使用 **lodctr** 公用程式搭配 .ini 和 .h 檔案，在登錄中安裝資訊。</span><span class="sxs-lookup"><span data-stu-id="bc918-120">Use the **lodctr** utility with the .ini and .h files to install the information in the registry.</span></span> <span data-ttu-id="bc918-121">只有當應用程式的 **服務** 金鑰中有效能金鑰時，此公用程式才會成功。</span><span class="sxs-lookup"><span data-stu-id="bc918-121">This utility succeeds only if a performance key exists in the **Services** key for the application.</span></span> <span data-ttu-id="bc918-122">如需詳細資訊，請參閱 [將計數器名稱和描述新增至](adding-counter-names-and-descriptions-to-the-registry.md)登錄。</span><span class="sxs-lookup"><span data-stu-id="bc918-122">For details, see [Adding Counter Names and Descriptions to the Registry](adding-counter-names-and-descriptions-to-the-registry.md).</span></span>
5. <span data-ttu-id="bc918-123">建立包含一組匯出函數的效能 DLL，這些函式會將查詢的計數器資料提供給取用者。</span><span class="sxs-lookup"><span data-stu-id="bc918-123">Create a performance DLL containing a set of exported functions that provide the queried counter data to the consumer.</span></span> <span data-ttu-id="bc918-124">如需詳細資訊，請參閱 [建立效能延伸模組 DLL](creating-a-performance-extension-dll.md)。</span><span class="sxs-lookup"><span data-stu-id="bc918-124">For details, see [Creating a Performance Extension DLL](creating-a-performance-extension-dll.md).</span></span>
6. <span data-ttu-id="bc918-125">修改應用程式的安裝檔案，以自動將資訊新增至登錄 (如步驟 4) 所述，並在安裝時將效能 DLL 複製到應用程式的目錄。</span><span class="sxs-lookup"><span data-stu-id="bc918-125">Modify the application's setup file to automate adding information to the registry (as described in step 4) and copy your performance DLL to your application's directory at setup.</span></span>

<span data-ttu-id="bc918-126">如需其他登錄專案的詳細資訊，請參閱 [建立其他登錄專案](creating-other-registry-entries.md)。</span><span class="sxs-lookup"><span data-stu-id="bc918-126">For information about additional registry entries, see [Creating Other Registry Entries](creating-other-registry-entries.md).</span></span>
