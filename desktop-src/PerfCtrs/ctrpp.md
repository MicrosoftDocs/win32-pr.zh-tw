---
description: CTRPP 工具是可剖析和驗證計數器資訊清單的預處理器。
ms.assetid: 3939f6a1-0a94-429d-a71e-b37f045fea13
title: CTRPP
ms.topic: reference
ms.date: 08/17/2020
topic_type:
- APIRef
- kbSyntax
api_name:
- CTRPP
api_type:
- NA
api_location: ''
ms.openlocfilehash: eacfbb83abd56becc579c6b9bbaedacda96f94b4
ms.sourcegitcommit: b32433cc0394159c7263809ae67615ab5792d40d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/30/2021
ms.locfileid: "113119103"
---
# <a name="ctrpp"></a><span data-ttu-id="c127e-103">CTRPP</span><span class="sxs-lookup"><span data-stu-id="c127e-103">CTRPP</span></span>

<span data-ttu-id="c127e-104">CTRPP 工具是可剖析並驗證 V2 提供者資訊清單的預處理器。</span><span class="sxs-lookup"><span data-stu-id="c127e-104">The CTRPP tool is a pre-processor that parses and validates the manifest for your V2 provider.</span></span> <span data-ttu-id="c127e-105">此工具 `.rc` 會使用提供者的取用者所需的字串產生資源，並使用 `.h` 您用來提供計數器資料的程式碼來產生標頭。</span><span class="sxs-lookup"><span data-stu-id="c127e-105">The tool generates `.rc` resources with the strings needed by consumers of your provider, and it generates a `.h` header with code that you use to provide your counter data.</span></span> <span data-ttu-id="c127e-106">您應該在提供者的組建期間執行 CTRPP 工具。</span><span class="sxs-lookup"><span data-stu-id="c127e-106">You should run the CTRPP tool during the build of your provider.</span></span> <span data-ttu-id="c127e-107">開發提供者時，您應該使用產生的程式碼作為起點，而不是自行嘗試產生此程式碼。</span><span class="sxs-lookup"><span data-stu-id="c127e-107">You should use the generated code as a starting point when developing your provider instead of trying to generate this code yourself.</span></span>

```syntax
ctrpp -o codeFile -rc rcFile [-legacy] [-MemoryRoutines] [-NotificationCallback] [-prefix prefix] [-ch symFile] [-backcompat] inputFile
```

## <a name="arguments"></a><span data-ttu-id="c127e-108">引數</span><span class="sxs-lookup"><span data-stu-id="c127e-108">Arguments</span></span>

|<span data-ttu-id="c127e-109">選項</span><span class="sxs-lookup"><span data-stu-id="c127e-109">Option</span></span>              |<span data-ttu-id="c127e-110">描述</span><span class="sxs-lookup"><span data-stu-id="c127e-110">Description</span></span>
|--------------------|-----------
|<span data-ttu-id="c127e-111">*inputFile*</span><span class="sxs-lookup"><span data-stu-id="c127e-111">*inputFile*</span></span>         |<span data-ttu-id="c127e-112">**必要：** 指定 `.man` 定義您的計數器 (XML 資訊清單) 檔案的名稱。</span><span class="sxs-lookup"><span data-stu-id="c127e-112">**Required:** Specifies the name of the `.man` (XML manifest) file that defines your counters.</span></span>
|<span data-ttu-id="c127e-113">**-o** *codeFile*</span><span class="sxs-lookup"><span data-stu-id="c127e-113">**-o** *codeFile*</span></span>   |<span data-ttu-id="c127e-114">**必要：** 指定 `.h` 要由 CTRPP 產生的程式碼檔案名。</span><span class="sxs-lookup"><span data-stu-id="c127e-114">**Required:** Specifies the name of the `.h` code file to be generated by CTRPP.</span></span> <span data-ttu-id="c127e-115">這個檔案將包含 C/c + + 內嵌 helper 函式，可簡化您的提供者的初始化和取消初始化。</span><span class="sxs-lookup"><span data-stu-id="c127e-115">This file will contain C/C++ inline helper functions that simplify initializing and uninitializing your provider.</span></span>
|<span data-ttu-id="c127e-116">**-rc** *rcFile*</span><span class="sxs-lookup"><span data-stu-id="c127e-116">**-rc** *rcFile*</span></span>    |<span data-ttu-id="c127e-117">**必要：** 指定 `.rc` CTRPP 要產生的 (資源檔名稱) 。</span><span class="sxs-lookup"><span data-stu-id="c127e-117">**Required:** Specifies the name of the `.rc` (resource file) to be generated by CTRPP.</span></span> <span data-ttu-id="c127e-118">這個檔案將包含提供者的字串資料表。</span><span class="sxs-lookup"><span data-stu-id="c127e-118">This file will contain the provider's string table.</span></span>
|<span data-ttu-id="c127e-119">**-ch** *symFile*</span><span class="sxs-lookup"><span data-stu-id="c127e-119">**-ch** *symFile*</span></span>   |<span data-ttu-id="c127e-120">指定 `.h` 要由 CTRPP 產生的選擇性符號檔名稱。</span><span class="sxs-lookup"><span data-stu-id="c127e-120">Specifies the name of the optional `.h` symbol file to be generated by CTRPP.</span></span> <span data-ttu-id="c127e-121">此檔案將包含 C/c + + 符號，以取得提供者中每個 counterset 的名稱和 Guid。</span><span class="sxs-lookup"><span data-stu-id="c127e-121">This file will contain C/C++ symbols for the names and GUIDs of each counterset in the provider.</span></span>
|<span data-ttu-id="c127e-122">**-前置** 詞 *前置* 詞</span><span class="sxs-lookup"><span data-stu-id="c127e-122">**-prefix** *prefix*</span></span>|<span data-ttu-id="c127e-123">指定在產生的標頭檔中定義的變數和函數所使用的前置詞。</span><span class="sxs-lookup"><span data-stu-id="c127e-123">Specifies the prefix to use for the variables and functions defined in the generated header file.</span></span>
|<span data-ttu-id="c127e-124">**-NotificationCallback**</span><span class="sxs-lookup"><span data-stu-id="c127e-124">**-NotificationCallback**</span></span>|<span data-ttu-id="c127e-125">變更 [**CounterInitialize**](counterinitialize.md) 函式的預設簽章，以包含用來指定 [*ControlCallback*](/windows/desktop/api/Perflib/nc-perflib-perflibrequest)、 [*AllocateMemory*](/windows/desktop/api/Perflib/nc-perflib-perf_mem_alloc)和 [*FreeMemory*](/windows/desktop/api/Perflib/nc-perflib-perf_mem_free) 回呼函數名稱的參數。</span><span class="sxs-lookup"><span data-stu-id="c127e-125">Changes the default signature of the [**CounterInitialize**](counterinitialize.md) function to include parameters for specifying the name of [*ControlCallback*](/windows/desktop/api/Perflib/nc-perflib-perflibrequest), [*AllocateMemory*](/windows/desktop/api/Perflib/nc-perflib-perf_mem_alloc), and [*FreeMemory*](/windows/desktop/api/Perflib/nc-perflib-perf_mem_free) callback functions.</span></span> <span data-ttu-id="c127e-126">這個引數的效果與在 `callback` [**provider**](/windows/desktop/PerfCtrs/performance-counters-provider--counters--element) 元素中包含屬性相同。</span><span class="sxs-lookup"><span data-stu-id="c127e-126">This argument has the same effect as including the `callback` attribute in the [**provider**](/windows/desktop/PerfCtrs/performance-counters-provider--counters--element) element.</span></span>
|<span data-ttu-id="c127e-127">**-遷移** *outputFile*</span><span class="sxs-lookup"><span data-stu-id="c127e-127">**-migrate** *outputFile*</span></span>|<span data-ttu-id="c127e-128">將 `.h` `.rc` *inputFile* 資訊清單升級為最新版本，並將其儲存至 *outputFile*，而不是產生和檔案。</span><span class="sxs-lookup"><span data-stu-id="c127e-128">Instead of generating `.h` and `.rc` files, upgrades the *inputFile* manifest to the latest version and saves it to *outputFile*.</span></span> <span data-ttu-id="c127e-129">此參數不能搭配其他參數使用。</span><span class="sxs-lookup"><span data-stu-id="c127e-129">This switch cannot be used with other switches.</span></span> <span data-ttu-id="c127e-130">使用方式：`CTRPP -migrate NewFile.man OldFile.man`</span><span class="sxs-lookup"><span data-stu-id="c127e-130">Usage: `CTRPP -migrate NewFile.man OldFile.man`</span></span>
|<span data-ttu-id="c127e-131">**-回溯相容性**</span><span class="sxs-lookup"><span data-stu-id="c127e-131">**-BackCompat**</span></span>     |<span data-ttu-id="c127e-132">已 **淘汰：** Windows 7 已新增對核心模式提供者的支援。</span><span class="sxs-lookup"><span data-stu-id="c127e-132">**Deprecated:** Support for kernel-mode providers was added in Windows 7.</span></span> <span data-ttu-id="c127e-133">根據預設，CTRPP 針對核心模式提供者所產生的程式碼將會與舊版的 Windows 不相容 (驅動程式因為缺少 api) 而無法載入 `Pcw***` 。</span><span class="sxs-lookup"><span data-stu-id="c127e-133">By default, the code generated by CTRPP for kernel-mode providers will be incompatible with earlier versions of Windows (driver will fail to load due to missing `Pcw***` APIs).</span></span> <span data-ttu-id="c127e-134">設定 `-BackCompat` 為啟用與舊版 Windows 的相容性。</span><span class="sxs-lookup"><span data-stu-id="c127e-134">Set `-BackCompat` to enable compatibility with earlier versions of Windows.</span></span> <span data-ttu-id="c127e-135">驅動程式會以動態方式載入必要的 Api，而產生的程式碼會在 Api 無法使用時，以無訊息方式停用提供者。</span><span class="sxs-lookup"><span data-stu-id="c127e-135">The driver will dynamically load the necessary APIs and the generated code will silently disable the provider if the APIs are not available.</span></span>
|<span data-ttu-id="c127e-136">**-MemoryRoutines**</span><span class="sxs-lookup"><span data-stu-id="c127e-136">**-MemoryRoutines**</span></span> |<span data-ttu-id="c127e-137">已 **淘汰：** 搭配參數使用時 `-Legacy` ，會在產生的程式碼中包含記憶體常式的範本。</span><span class="sxs-lookup"><span data-stu-id="c127e-137">**Deprecated:** When used with the `-Legacy` switch, includes templates for memory routines in the generated code.</span></span> <span data-ttu-id="c127e-138">否則，此引數與參數的效果相同 `-NotificationCallback` 。</span><span class="sxs-lookup"><span data-stu-id="c127e-138">Otherwise, this argument has the same effect as the `-NotificationCallback` switch.</span></span>
|<span data-ttu-id="c127e-139">**-舊版**</span><span class="sxs-lookup"><span data-stu-id="c127e-139">**-Legacy**</span></span>         |<span data-ttu-id="c127e-140">已 **淘汰：**`*.h` `*.c` `*.rc` 使用 Windows Vista 程式碼範本產生、、和檔案 `*_r.h` (產生 PerfAutoInitialize 和 PerfAutoCleanup，而不是 CounterInitialize 和 CounterCleanup) 。</span><span class="sxs-lookup"><span data-stu-id="c127e-140">**Deprecated:** Generates `*.h`, `*.c`, `*.rc`, and `*_r.h` files using the Windows Vista code templates (generates PerfAutoInitialize and PerfAutoCleanup instead of CounterInitialize and CounterCleanup).</span></span> <span data-ttu-id="c127e-141">這個參數可以搭配 **-MemoryRoutines** 和 **-NotificationCallback** 使用，但不能搭配任何其他參數使用。</span><span class="sxs-lookup"><span data-stu-id="c127e-141">This switch can be used with **-MemoryRoutines** and **-NotificationCallback** but cannot be used with any other switches.</span></span> <span data-ttu-id="c127e-142">請勿使用 **-o** 或 **-rc** 參數搭配此參數。</span><span class="sxs-lookup"><span data-stu-id="c127e-142">Do not use the **-o** or **-rc** switches with this switch.</span></span> <span data-ttu-id="c127e-143">產生的檔案會根據資訊清單的名稱命名，並且會寫入包含資訊清單的目錄。</span><span class="sxs-lookup"><span data-stu-id="c127e-143">The generated files will be named based on the name of the manifest and will be written to the directory that contained the manifest.</span></span> <span data-ttu-id="c127e-144">使用方式：`CTRPP -legacy OldFile.man`</span><span class="sxs-lookup"><span data-stu-id="c127e-144">Usage: `CTRPP -legacy OldFile.man`</span></span>

## <a name="remarks"></a><span data-ttu-id="c127e-145">備註</span><span class="sxs-lookup"><span data-stu-id="c127e-145">Remarks</span></span>

<span data-ttu-id="c127e-146">CTRPP 工具會產生 `.h` 程式碼檔案、 `.rc` 資源檔，並選擇性地產生 `.h` 符號檔。</span><span class="sxs-lookup"><span data-stu-id="c127e-146">The CTRPP tool generates a `.h` code file, an `.rc` resource file, and optionally generates a `.h` symbol file.</span></span>

### <a name="using-the-generated-resource-file"></a><span data-ttu-id="c127e-147">使用產生的資源檔</span><span class="sxs-lookup"><span data-stu-id="c127e-147">Using the generated resource file</span></span>

<span data-ttu-id="c127e-148">CTRPP 工具會產生 `.rc` 資源檔，其中包含提供者 countersets 取用者所需的可當地語系化字串。</span><span class="sxs-lookup"><span data-stu-id="c127e-148">The CTRPP tool will generate a `.rc` resource file that contains the localizable strings needed by consumers of the provider's countersets.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="c127e-149">此檔案中的資源必須包含在提供者二進位檔中，而提供者二進位檔的完整路徑必須在安裝提供者的資訊清單期間註冊。</span><span class="sxs-lookup"><span data-stu-id="c127e-149">The resources from this file must be included into your provider binary and the full path to the provider binary must be registered during the installation of your provider's manifest.</span></span> <span data-ttu-id="c127e-150">無法尋找和載入資源的取用者將無法使用您的提供者 countersets。</span><span class="sxs-lookup"><span data-stu-id="c127e-150">Consumers that are unable to locate and load the resources will be unable to use your provider's countersets.</span></span>

<span data-ttu-id="c127e-151">字串資源應該依照下列方式處理：</span><span class="sxs-lookup"><span data-stu-id="c127e-151">The string resources should be handled as follows:</span></span>

- <span data-ttu-id="c127e-152">開發人員會編輯提供者資訊清單 () 檔案，將 `.man` 提供者的 `applicationIdentity` 屬性設定為提供者二進位檔的名稱 (.DLL、.SYS 或 .EXE，其中將包含提供者的字串資源，且將會安裝為提供者元件的一部分。</span><span class="sxs-lookup"><span data-stu-id="c127e-152">The developer edits the provider manifest (`.man`) file to set the `applicationIdentity` attribute of the provider to the name of a provider binary (.DLL, .SYS, or .EXE) that will contain the string resources for the provider and will be installed as part of the provider component.</span></span>
- <span data-ttu-id="c127e-153">CTRPP 工具會讀取提供者資訊清單，並產生檔案 `.rc` 。</span><span class="sxs-lookup"><span data-stu-id="c127e-153">The CTRPP tool reads the provider manifest and generates an `.rc` file.</span></span>
- <span data-ttu-id="c127e-154">[RC (資源編譯器) ](../menurc/resource-compiler.md)工具會從 CTRPP 產生的檔案編譯資料 `.rc` ，以產生 `.res` 包含二進位資源的檔案。</span><span class="sxs-lookup"><span data-stu-id="c127e-154">The [RC (resource compiler)](../menurc/resource-compiler.md) tool compiles the data from the CTRPP-generated `.rc` file to generate a `.res` file containing the binary resources.</span></span> <span data-ttu-id="c127e-155">這可以藉由直接編譯 CTRPP 產生的檔案 `.rc` ，或透過指示詞編譯 `.rc` 包含 CTRPP 產生之檔案的另一個檔案來完成 `.rc` `#include` 。</span><span class="sxs-lookup"><span data-stu-id="c127e-155">This can be done either by directly compiling the CTRPP-generated `.rc` file OR by compiling another `.rc` file that includes the CTRPP-generated `.rc` file via an `#include` directive.</span></span>
- <span data-ttu-id="c127e-156">連結器會將 RC 產生之檔案中的資料內嵌 `.res` 至提供者二進位檔。</span><span class="sxs-lookup"><span data-stu-id="c127e-156">The linker embeds the data from the RC-generated `.res` file into the provider binary.</span></span>
- <span data-ttu-id="c127e-157">在安裝期間，會將提供者二進位檔複製到使用者的系統，並使用 [lodctr 工具](/windows-server/administration/windows-commands/lodctr)來註冊提供者資訊清單。</span><span class="sxs-lookup"><span data-stu-id="c127e-157">During installation, the provider binary is copied onto the user's system and the provider manifest is registered using the [lodctr tool](/windows-server/administration/windows-commands/lodctr).</span></span> <span data-ttu-id="c127e-158">Lodctr 工具會將 `applicationIdentity` 提供者資訊清單的屬性轉換為完整路徑，並記錄登錄中提供者二進位檔的完整路徑。</span><span class="sxs-lookup"><span data-stu-id="c127e-158">The lodctr tool converts the `applicationIdentity` attribute of the provider manifest into a full path and records the full path to the provider binary in the registry.</span></span>
  - <span data-ttu-id="c127e-159">如果提供者二進位檔位於與資訊清單相同的目錄中，請使用： `lodctr.exe /m:"C:\full\manifest\path\manifest.man"` 。</span><span class="sxs-lookup"><span data-stu-id="c127e-159">If the provider binary is in the same directory as the manifest, use: `lodctr.exe /m:"C:\full\manifest\path\manifest.man"`.</span></span> <span data-ttu-id="c127e-160">lodctr 會將指定的資訊清單路徑與資訊清單的屬性結合， `applicationIdentity` 以形成完整的路徑。</span><span class="sxs-lookup"><span data-stu-id="c127e-160">lodctr will combine the specified manifest path with the manifest's `applicationIdentity` attribute to form the full path.</span></span>
  - <span data-ttu-id="c127e-161">否則，使用 `lodctr.exe /m:"C:\full\manifest\path\manifest.man" "c:\full\binary\path"`。</span><span class="sxs-lookup"><span data-stu-id="c127e-161">Otherwise, use `lodctr.exe /m:"C:\full\manifest\path\manifest.man" "c:\full\binary\path"`.</span></span> <span data-ttu-id="c127e-162">lodctr 會將指定的二進位路徑與資訊清單的 `applicationIdentity` 屬性結合，以形成完整的路徑。</span><span class="sxs-lookup"><span data-stu-id="c127e-162">lodctr will combine the specified binary path with the manifest's `applicationIdentity` attribute to form the full path.</span></span>
  - <span data-ttu-id="c127e-163">為了診斷用途，您可以檢查登錄機碼的值，以檢查記錄的完整路徑 `ApplicationIdentity` `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Perflib\_V2Providers\{<ProviderGuid>}` 。</span><span class="sxs-lookup"><span data-stu-id="c127e-163">For diagnostic purposes, you can inspect the recorded full path by checking the `ApplicationIdentity` value of registry key `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Perflib\_V2Providers\{<ProviderGuid>}`.</span></span>
  - <span data-ttu-id="c127e-164">如果二進位檔使用 MUI 進行當地語系化，請務必複製 MUI 檔案以及二進位檔。</span><span class="sxs-lookup"><span data-stu-id="c127e-164">If the binary is using MUI for localization, be sure to copy the MUI file along with the binary.</span></span>
- <span data-ttu-id="c127e-165">在 counterset 集合期間，取用者會使用提供者二進位檔的記錄完整路徑，從提供者二進位的資源中找出並載入必要的字串。</span><span class="sxs-lookup"><span data-stu-id="c127e-165">During counterset collection, the consumer uses the recorded full path to the provider binary to locate and load the necessary strings from the provider binary's resources.</span></span>

### <a name="using-the-generated-code-file-in-a-user-mode-provider"></a><span data-ttu-id="c127e-166">在使用者模式提供者中使用產生的程式碼檔案</span><span class="sxs-lookup"><span data-stu-id="c127e-166">Using the generated code file in a user-mode provider</span></span>

<span data-ttu-id="c127e-167">CTRPP 工具會產生 `.h` C/c + + 程式碼檔案。</span><span class="sxs-lookup"><span data-stu-id="c127e-167">The CTRPP tool will generate a `.h` C/C++ code file.</span></span> <span data-ttu-id="c127e-168">如果提供者資訊清單的 `providerType` 屬性設定為 `userMode` ，則產生的程式碼檔案將包含下列定義，在撰寫使用者模式提供者時很有説明：</span><span class="sxs-lookup"><span data-stu-id="c127e-168">If the provider manifest's `providerType` attribute is set to `userMode`, the generated code file will contain the following definitions that are helpful in coding a user-mode provider:</span></span>

- <span data-ttu-id="c127e-169">名為 [ \* **prefix \* CounterInitialize**](counterinitialize.md)的提供者初始化函數。</span><span class="sxs-lookup"><span data-stu-id="c127e-169">An provider initialization function named [\***prefix\*CounterInitialize**](counterinitialize.md).</span></span>
- <span data-ttu-id="c127e-170">名為 [ \* **prefix \* CounterCleanup**](countercleanup.md)的提供者清除函數。</span><span class="sxs-lookup"><span data-stu-id="c127e-170">A provider cleanup function named [\***prefix\*CounterCleanup**](countercleanup.md).</span></span>
- <span data-ttu-id="c127e-171">全域 ***提供者** _ 變數，會儲存 _ *_prefix_CounterInitialize** 函式所開啟的提供者控制碼。</span><span class="sxs-lookup"><span data-stu-id="c127e-171">A global ***provider** _ variable that stores the provider handle opened by the _ *_prefix_CounterInitialize** function.</span></span> <span data-ttu-id="c127e-172">變數的名稱是 `symbol` `provider` 資訊清單中元素的屬性值。</span><span class="sxs-lookup"><span data-stu-id="c127e-172">The variable's name is the value of the `symbol` attribute of the `provider` element in the manifest.</span></span> <span data-ttu-id="c127e-173">此變數應該用於對 `PerfCreateInstance` 、 `PerfDeleteInstance` 和其他 api 的呼叫，以控制您的提供者資料。</span><span class="sxs-lookup"><span data-stu-id="c127e-173">This variable should be used in calls to `PerfCreateInstance`, `PerfDeleteInstance`, and other APIs for controlling your provider's data.</span></span>
- <span data-ttu-id="c127e-174">針對每個 counterset，具有 counterset GUID 的 global \***counterset \* GUID** 變數。</span><span class="sxs-lookup"><span data-stu-id="c127e-174">For each counterset, a global \***counterset\*GUID** variable with the counterset GUID.</span></span> <span data-ttu-id="c127e-175">變數的名稱是元素屬性的值加上後置字元 `counterSet` `symbol` "GUID"，例如 `MyCounterSetGUID` 。</span><span class="sxs-lookup"><span data-stu-id="c127e-175">The variable's name is the value of the `counterSet` element's `symbol` attribute plus the suffix "GUID", e.g. `MyCounterSetGUID`.</span></span> <span data-ttu-id="c127e-176">此變數應該用於對 `PerfCreateInstance` 、 `PerfDeleteInstance` 和其他 api 的呼叫，以控制您的提供者資料。</span><span class="sxs-lookup"><span data-stu-id="c127e-176">This variable should be used in calls to `PerfCreateInstance`, `PerfDeleteInstance`, and other APIs for controlling your provider's data.</span></span>
- <span data-ttu-id="c127e-177">針對每個計數器，具有計數器值的 ***計數器*** 宏 `id` 。</span><span class="sxs-lookup"><span data-stu-id="c127e-177">For each counter, a ***counter*** macro with the counter's `id` value.</span></span> <span data-ttu-id="c127e-178">宏的名稱是 `counter` 元素屬性的值 `symbol` 。</span><span class="sxs-lookup"><span data-stu-id="c127e-178">The macro's name is the value of the `counter` element's `symbol` attribute.</span></span> <span data-ttu-id="c127e-179">在呼叫 `PerfSetCounterRefValue` 、 `PerfSetULongLongCounterValue` 和其他 api 來設定提供者的資料時，應該使用這個宏。</span><span class="sxs-lookup"><span data-stu-id="c127e-179">This macro should be used in calls to `PerfSetCounterRefValue`, `PerfSetULongLongCounterValue`, and other APIs for setting your provider's data.</span></span>

<span data-ttu-id="c127e-180">在函數名稱中， ***前置*** 詞是指 `-prefix` 命令列參數的值。</span><span class="sxs-lookup"><span data-stu-id="c127e-180">In the function names, ***prefix*** refers to the value of the `-prefix` command-line parameter.</span></span> <span data-ttu-id="c127e-181">如果 `-prefix` 未使用參數，函式將會命名為 `CounterInitialize` 和 `CounterCleanup` 。</span><span class="sxs-lookup"><span data-stu-id="c127e-181">If the `-prefix` parameter is not used the functions will be named `CounterInitialize` and `CounterCleanup`.</span></span>

### <a name="using-the-generated-code-file-in-a-kernel-mode-provider"></a><span data-ttu-id="c127e-182">在核心模式提供者中使用產生的程式碼檔案</span><span class="sxs-lookup"><span data-stu-id="c127e-182">Using the generated code file in a kernel-mode provider</span></span>

<span data-ttu-id="c127e-183">CTRPP 工具會產生 `.h` C/c + + 程式碼檔案。</span><span class="sxs-lookup"><span data-stu-id="c127e-183">The CTRPP tool will generate a `.h` C/C++ code file.</span></span> <span data-ttu-id="c127e-184">如果提供者資訊清單的 `providerType` 屬性設定為 `kernelMode` ，則產生的程式碼檔案將包含下列定義，在撰寫核心模式提供者的 countersets 時很有説明：</span><span class="sxs-lookup"><span data-stu-id="c127e-184">If the provider manifest's `providerType` attribute is set to `kernelMode`, the generated code file will contain the following definitions that are helpful in coding a kernel-mode provider's countersets:</span></span>

- <span data-ttu-id="c127e-185">名為 <b> *Prefix* Register *counterset*</b>的 counterset 初始化函數。</span><span class="sxs-lookup"><span data-stu-id="c127e-185">A counterset initialization function named <b>*prefix* Register *Counterset*</b>.</span></span> <span data-ttu-id="c127e-186">此函式會填入 [RegInfo](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_registration_information) 結構，然後叫用 [PcwRegister](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwregister)，將產生的 counterset 註冊控制碼放入全域 ***counterset*** 變數中。</span><span class="sxs-lookup"><span data-stu-id="c127e-186">This function fills in a [RegInfo](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_registration_information) structure then invokes [PcwRegister](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwregister), putting the resulting counterset registration handle into the global ***Counterset*** variable.</span></span>
- <span data-ttu-id="c127e-187">名為 <b>*前置* 詞取消註冊 *counterset*</b>的 counterset 清除函數。</span><span class="sxs-lookup"><span data-stu-id="c127e-187">A counterset cleanup function named <b>*prefix* Unregister *Counterset*</b>.</span></span> <span data-ttu-id="c127e-188">此函式會在全域 ***counterset*** 變數中的 counterset 註冊控制碼上叫用 [PcwUnregister](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwunregister) 。</span><span class="sxs-lookup"><span data-stu-id="c127e-188">This function invokes [PcwUnregister](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwunregister) on the counterset registration handle in the global ***Counterset*** variable.</span></span>
- <span data-ttu-id="c127e-189">名為 <b> *Prefix* Create *Counterset*</b>的實例建立函數。</span><span class="sxs-lookup"><span data-stu-id="c127e-189">An instance creation function named <b>*prefix* Create *Counterset*</b>.</span></span> <span data-ttu-id="c127e-190">此函式會填入 [PcwData](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_data)結構的陣列，然後使用全域 ***counterset*** 變數中的 counterset 註冊控制碼來叫用 [PcwCreateInstance](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwcreateinstance) 。</span><span class="sxs-lookup"><span data-stu-id="c127e-190">This function fills in an array of [PcwData](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_data) structures then invokes [PcwCreateInstance](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwcreateinstance) using the counterset registration handle in the global ***Counterset*** variable.</span></span>
- <span data-ttu-id="c127e-191">名為 <b> *Prefix* Close *Counterset*</b>的實例清除函數。</span><span class="sxs-lookup"><span data-stu-id="c127e-191">An instance cleanup function named <b>*prefix* Close *Counterset*</b>.</span></span> <span data-ttu-id="c127e-192">此函式會叫用 [PcwCloseInstance](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwcloseinstance)。</span><span class="sxs-lookup"><span data-stu-id="c127e-192">This function invokes [PcwCloseInstance](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwcloseinstance).</span></span>
- <span data-ttu-id="c127e-193">名為「 <b>\*前置\*\*\*</b>詞」的實例報告函式會從 Counterset 回呼函數中使用。</span><span class="sxs-lookup"><span data-stu-id="c127e-193">An instance reporting function named <b>*prefix* Add *Counterset*</b> to be used from the counterset callback function.</span></span> <span data-ttu-id="c127e-194">此函數會填入 [PcwData](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_data) 結構的陣列，然後叫用 [PcwAddInstance](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwaddinstance)。</span><span class="sxs-lookup"><span data-stu-id="c127e-194">This function fills in an array of [PcwData](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_data) structures then invokes [PcwAddInstance](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwaddinstance).</span></span>
- <span data-ttu-id="c127e-195">**Windows SDK 20H1 和更新版本：** 名為 <b> *Prefix* InitRegistrationInformation *Counterset*</b>的 RegInfo 初始化函數，用於 advanced 案例中。</span><span class="sxs-lookup"><span data-stu-id="c127e-195">**Windows SDK 20H1 and later:** A RegInfo initialization function named <b>*prefix* InitRegistrationInformation *Counterset*</b> for use in advanced scenarios.</span></span> <span data-ttu-id="c127e-196">此函數會填入 [RegInfo](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_registration_information) 結構。</span><span class="sxs-lookup"><span data-stu-id="c127e-196">This function fills in a [RegInfo](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_registration_information) structure.</span></span> <span data-ttu-id="c127e-197">當產生的 <b>\*首碼\*\*\*</b>登錄區不符合您的需求時，例如，當您想要自訂 RegInfo 結構中的值，或當您想要將傳回的控制碼儲存在另一個變數時，就可以使用這個函式。</span><span class="sxs-lookup"><span data-stu-id="c127e-197">This function can be used in cases where the generated <b>*prefix* Register *Counterset*</b> does not meet your needs, e.g. when you want to customize the values in the RegInfo structure or when you want to store the returned handle in another variable.</span></span>

<span data-ttu-id="c127e-198">在函數名稱中， ***前置*** 詞是指 `-prefix` 命令列參數的值。</span><span class="sxs-lookup"><span data-stu-id="c127e-198">In the function names, ***prefix*** refers to the value of the `-prefix` command-line parameter.</span></span> <span data-ttu-id="c127e-199">如果 `-prefix` 未使用參數，函數將不會有前置詞。</span><span class="sxs-lookup"><span data-stu-id="c127e-199">If the `-prefix` parameter is not used the functions will have no prefix.</span></span>

> [!NOTE]
> <span data-ttu-id="c127e-200">當您有 Counterset 回呼時，會使用產生的 <b>*前置* 詞 Add *Counterset*</b>函數。</span><span class="sxs-lookup"><span data-stu-id="c127e-200">The generated <b>*prefix* Add *Counterset*</b> function is used when you have a counterset callback.</span></span> <span data-ttu-id="c127e-201">當您沒有 Counterset 回呼時，會使用產生的 <b>*前置* 詞 Create *Counterset*</b>和 <b> *prefix* Close *Counterset*</b>函數。</span><span class="sxs-lookup"><span data-stu-id="c127e-201">The generated <b>*prefix* Create *Counterset*</b> and <b>*prefix* Close *Counterset*</b> functions are used when you do not have a counterset callback.</span></span>

### <a name="using-the-generated-symbol-file"></a><span data-ttu-id="c127e-202">使用產生的符號檔</span><span class="sxs-lookup"><span data-stu-id="c127e-202">Using the generated symbol file</span></span>

<span data-ttu-id="c127e-203">如果在命令列上指定 **-ch** 參數，CTRPP 工具將會產生 `.h` 符號檔。</span><span class="sxs-lookup"><span data-stu-id="c127e-203">If the **-ch** parameter is specified on the command line, the CTRPP tool will generate a `.h` symbol file.</span></span> <span data-ttu-id="c127e-204">此檔案包含提供者中每個 counterset 的名稱和 Guid 的 C/c + + 符號。</span><span class="sxs-lookup"><span data-stu-id="c127e-204">This file contains the C/C++ symbols for the names and GUIDs of each counterset in the provider.</span></span> <span data-ttu-id="c127e-205">使用 [PerfLib V2 取用者](using-the-perflib-functions-to-consume-counter-data.md)函式撰寫硬式編碼的程式來取用此 counterset 的資料時，可以使用這些符號。</span><span class="sxs-lookup"><span data-stu-id="c127e-205">The symbols can be used when writing programs that are hard-coded to consume the data from this counterset using the [PerfLib V2 Consumer functions](using-the-perflib-functions-to-consume-counter-data.md).</span></span>

## <a name="requirements"></a><span data-ttu-id="c127e-206">規格需求</span><span class="sxs-lookup"><span data-stu-id="c127e-206">Requirements</span></span>

| <span data-ttu-id="c127e-207">需求</span><span class="sxs-lookup"><span data-stu-id="c127e-207">Requirement</span></span>             | <span data-ttu-id="c127e-208">值</span><span class="sxs-lookup"><span data-stu-id="c127e-208">Value</span></span> |
|-------------------------|-------|
| <span data-ttu-id="c127e-209">最低支援的用戶端</span><span class="sxs-lookup"><span data-stu-id="c127e-209">Minimum supported client</span></span>| <span data-ttu-id="c127e-210">\[僅限 Windows Vista 桌面應用程式\]</span><span class="sxs-lookup"><span data-stu-id="c127e-210">Windows Vista \[desktop apps only\]</span></span>
| <span data-ttu-id="c127e-211">最低支援的伺服器</span><span class="sxs-lookup"><span data-stu-id="c127e-211">Minimum supported server</span></span>| <span data-ttu-id="c127e-212">僅限 Windows Server 2008 \[ desktop 應用程式\]</span><span class="sxs-lookup"><span data-stu-id="c127e-212">Windows Server 2008 \[desktop apps only\]</span></span>
