---
title: Active Directory 消費者和電腦屬性工作表
description: Active Directory 消費者和電腦 MMC 嵌入式管理單元是設計來顯示 Active Directory 伺服器中各種物件的屬性工作表。
ms.assetid: 38032d89-9549-475c-90aa-dac5cfe11084
ms.tgt_platform: multiple
keywords:
- Active Directory 消費者和電腦屬性工作表廣告
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 30ea24f34e86f21af178e975852accb667bb69e4
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/17/2020
ms.locfileid: "103681699"
---
# <a name="active-directory-users-and-computers-property-sheets"></a><span data-ttu-id="62974-104">Active Directory 消費者和電腦屬性工作表</span><span class="sxs-lookup"><span data-stu-id="62974-104">Active Directory Users and Computers Property Sheets</span></span>

<span data-ttu-id="62974-105">Active Directory 消費者和電腦 MMC 嵌入式管理單元是設計來顯示 Active Directory 伺服器中各種物件的屬性工作表。</span><span class="sxs-lookup"><span data-stu-id="62974-105">The Active Directory Users and Computers MMC snap-in is designed to display a property sheet for various objects in an Active Directory server.</span></span> <span data-ttu-id="62974-106">屬性工作表包含一或多個用來查看和修改物件資料的頁面。</span><span class="sxs-lookup"><span data-stu-id="62974-106">The property sheet contains one or more pages that are used to view and modify object data.</span></span> <span data-ttu-id="62974-107">不同的物件類型會顯示不同的頁面集合。</span><span class="sxs-lookup"><span data-stu-id="62974-107">Different object types have different sets of pages displayed for them.</span></span> <span data-ttu-id="62974-108">Active Directory 消費者和電腦 MMC 嵌入式管理單元也可讓協力廠商廠商將自訂頁面新增至特定物件類型的屬性工作表。</span><span class="sxs-lookup"><span data-stu-id="62974-108">The Active Directory Users and Computers MMC snap-in also enables third party vendors to add custom pages to the property sheet for a specific type of object.</span></span> <span data-ttu-id="62974-109">如需詳細資訊，請參閱搭配 [顯示規範使用的屬性頁](property-pages-for-use-with-display-specifiers.md)。</span><span class="sxs-lookup"><span data-stu-id="62974-109">For more information, see [Property Pages for Use with Display Specifiers](property-pages-for-use-with-display-specifiers.md).</span></span>

<span data-ttu-id="62974-110">某些應用程式（Active Directory 消費者和電腦 MMC 嵌入式管理單元以外）必須為使用者提供 Active Directory 伺服器中物件的 [查看] 和 [編輯] 屬性的功能。</span><span class="sxs-lookup"><span data-stu-id="62974-110">Some applications, other than the Active Directory Users and Computers MMC snap-in, must provide the user with the ability view and edit attributes for an object in an Active Directory server.</span></span> <span data-ttu-id="62974-111">應用程式可執行自己的屬性工作表，但最好提供一致的使用者介面，以減少混淆和學習時間。</span><span class="sxs-lookup"><span data-stu-id="62974-111">The application could implement its own property sheets, but it is better to offer a consistent user interface to reduce confusion and learning time.</span></span> <span data-ttu-id="62974-112">幸運的是，Active Directory 消費者和電腦 MMC 嵌入式管理單元可讓任何 OLE COM 應用程式顯示物件的屬性工作表，該物件等同于相同物件的 Active Directory 消費者和電腦 MMC 嵌入式管理單元所顯示的屬性工作表。</span><span class="sxs-lookup"><span data-stu-id="62974-112">Fortunately, the Active Directory Users and Computers MMC snap-in allows any OLE COM application to display a property sheet for an object that is identical to the property sheet that would be displayed by the Active Directory Users and Computers MMC snap-in for the same object.</span></span>

<span data-ttu-id="62974-113">如需裝載 Active Directory 消費者和電腦屬性工作表的詳細資訊和程式碼範例，請參閱平臺軟體發展工具組 (SDK) 中的 PropSheetHost 範例。</span><span class="sxs-lookup"><span data-stu-id="62974-113">For more information and a code example that hosts an Active Directory Users and Computers property sheet, see the PropSheetHost sample in the Platform Software Development Kit (SDK).</span></span>

## <a name="developer-audience"></a><span data-ttu-id="62974-114">開發人員讀者</span><span class="sxs-lookup"><span data-stu-id="62974-114">Developer Audience</span></span>

<span data-ttu-id="62974-115">本檔假設讀者已熟悉使用 c + + 的 COM 作業和元件開發。</span><span class="sxs-lookup"><span data-stu-id="62974-115">This documentation assumes that the reader is familiar with COM operation and component development using C++.</span></span> <span data-ttu-id="62974-116">目前，您無法使用 Visual Basic 來建立 Active Directory 的屬性工作表延伸模組。</span><span class="sxs-lookup"><span data-stu-id="62974-116">Currently, it is not possible to create an Active Directory property sheet extension using Visual Basic.</span></span>

## <a name="hosting-an-active-directory-users-and-computers-property-sheet"></a><span data-ttu-id="62974-117">裝載 Active Directory 消費者和電腦屬性工作表</span><span class="sxs-lookup"><span data-stu-id="62974-117">Hosting an Active Directory Users and Computers Property Sheet</span></span>

<span data-ttu-id="62974-118">**在 Active Directory 伺服器中顯示物件的屬性工作表**</span><span class="sxs-lookup"><span data-stu-id="62974-118">**To display a property sheet for an object in an Active Directory server**</span></span>

1.  <span data-ttu-id="62974-119">建立可以用來處理訊息的視窗。</span><span class="sxs-lookup"><span data-stu-id="62974-119">Create a window that can be used to process messages.</span></span> <span data-ttu-id="62974-120">這可以是現有的視窗或特殊用途的視窗。</span><span class="sxs-lookup"><span data-stu-id="62974-120">This can be an existing window or a special purpose window.</span></span> <span data-ttu-id="62974-121">這就是所謂的 *隱藏視窗*。</span><span class="sxs-lookup"><span data-stu-id="62974-121">This is known as the *hidden window*.</span></span>
2.  <span data-ttu-id="62974-122">建立衍生自 [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject)的 OLE COM 物件。</span><span class="sxs-lookup"><span data-stu-id="62974-122">Create an OLE COM object that is derived from [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject).</span></span> <span data-ttu-id="62974-123">此資料物件必須支援下列資料格式：</span><span class="sxs-lookup"><span data-stu-id="62974-123">This data object must support the following data formats:</span></span>

    -   <span data-ttu-id="62974-124">[**CFSTR \_DSOBJECTNAMES**](cfstr-dsobjectnames.md) 此資料格式包含可識別屬性工作表所適用之物件的 [**DSOBJECTNAMES**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) 。</span><span class="sxs-lookup"><span data-stu-id="62974-124">[**CFSTR\_DSOBJECTNAMES**](cfstr-dsobjectnames.md) This data format contains a [**DSOBJECTNAMES**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) that identifies the object that the property sheet applies to.</span></span> <span data-ttu-id="62974-125">裝載屬性工作表時，下列清單會顯示 **DSOBJECTNAMES** 結構的更重要成員。</span><span class="sxs-lookup"><span data-stu-id="62974-125">When hosting a property sheet, the more significant members of the **DSOBJECTNAMES** structure are shown in the following list.</span></span>

        <span data-ttu-id="62974-126">**clsidNamespace** 保留。</span><span class="sxs-lookup"><span data-stu-id="62974-126">**clsidNamespace** Reserved.</span></span> <span data-ttu-id="62974-127">如果您的應用程式在未來使用，請將此設定為您應用程式的 GUID。</span><span class="sxs-lookup"><span data-stu-id="62974-127">Set this to a GUID for your application here in case that it is used in the future.</span></span>
        
        <span data-ttu-id="62974-128">**aObjects** 包含 [**DSBOJECT**](/windows/desktop/api/Dsclient/ns-dsclient-dsobject) 結構的陣列。</span><span class="sxs-lookup"><span data-stu-id="62974-128">**aObjects** Contains an array of [**DSBOJECT**](/windows/desktop/api/Dsclient/ns-dsclient-dsobject) structures.</span></span> <span data-ttu-id="62974-129">每個 **DSBOJECT** 結構都代表單一目錄物件。</span><span class="sxs-lookup"><span data-stu-id="62974-129">Each **DSBOJECT** structure represents a single directory object.</span></span> <span data-ttu-id="62974-130">**CItems** 成員包含陣列中的元素數目。</span><span class="sxs-lookup"><span data-stu-id="62974-130">The **cItems** member contains the number of elements in the array.</span></span> <span data-ttu-id="62974-131">只會使用這個陣列中的第一個物件。</span><span class="sxs-lookup"><span data-stu-id="62974-131">Only the first object in this array is used.</span></span> <span data-ttu-id="62974-132">系統會忽略其他物件。</span><span class="sxs-lookup"><span data-stu-id="62974-132">Other objects are ignored.</span></span>

    -   <span data-ttu-id="62974-133">[**CFSTR \_DSDISPLAYSPECOPTIONS**](cfstr-ds-display-spec-options.md) 此資料格式包含 [**DSDISPLAYSPECOPTIONS**](/windows/desktop/api/Dsclient/ns-dsclient-dsdisplayspecoptions) 結構，其中包含屬性頁將使用的資料，例如從中載入屬性頁的位置、伺服器和要使用的認證等等。</span><span class="sxs-lookup"><span data-stu-id="62974-133">[**CFSTR\_DSDISPLAYSPECOPTIONS**](cfstr-ds-display-spec-options.md) This data format contains a [**DSDISPLAYSPECOPTIONS**](/windows/desktop/api/Dsclient/ns-dsclient-dsdisplayspecoptions) structure that contains data that will be used by the property pages, such as where to load the property pages from, the server and credentials to use, and so on.</span></span> <span data-ttu-id="62974-134">下列清單中會顯示更重要的 **DSDISPLAYSPECOPTIONS** 成員。</span><span class="sxs-lookup"><span data-stu-id="62974-134">The more significant members of the **DSDISPLAYSPECOPTIONS** are shown in the following list.</span></span>

        <span data-ttu-id="62974-135">**offsetAttribPrefix** 屬性前置詞字串會決定取得屬性頁清單的位置。</span><span class="sxs-lookup"><span data-stu-id="62974-135">**offsetAttribPrefix** The attribute prefix string determines where the list of property pages is obtained.</span></span> <span data-ttu-id="62974-136">這必須包含下列其中一個字串。</span><span class="sxs-lookup"><span data-stu-id="62974-136">This must contain one of the following strings.</span></span>

        

        | <span data-ttu-id="62974-137">屬性前置詞字串</span><span class="sxs-lookup"><span data-stu-id="62974-137">Attribute prefix string</span></span> | <span data-ttu-id="62974-138">Description</span><span class="sxs-lookup"><span data-stu-id="62974-138">Description</span></span>                                              |
        |-------------------------|----------------------------------------------------------------------------------------------------------------------|
        | <span data-ttu-id="62974-139">管理員</span><span class="sxs-lookup"><span data-stu-id="62974-139">"admin"</span></span><br/>      | <span data-ttu-id="62974-140">屬性頁是從 [**adminPropertyPages**](/windows/desktop/ADSchema/a-adminpropertypages) 屬性載入的。</span><span class="sxs-lookup"><span data-stu-id="62974-140">The property pages are loaded from the [**adminPropertyPages**](/windows/desktop/ADSchema/a-adminpropertypages) attribute.</span></span><br/> |
        | <span data-ttu-id="62974-141">shell</span><span class="sxs-lookup"><span data-stu-id="62974-141">"shell"</span></span><br/>      | <span data-ttu-id="62974-142">屬性頁是從 [**shellPropertyPages**](/windows/desktop/ADSchema/a-shellpropertypages) 屬性載入的。</span><span class="sxs-lookup"><span data-stu-id="62974-142">The property pages are loaded from the [**shellPropertyPages**](/windows/desktop/ADSchema/a-shellpropertypages) attribute.</span></span><br/> |

        


    -   <span data-ttu-id="62974-143">[**CFSTR \_DS \_ PROPSHEETCONFIG**](cfstr-ds-propsheetconfig.md) 此資料格式包含包含屬性工作表主機資料的 [**PROPSHEETCFG**](propsheetcfg.md) 結構。</span><span class="sxs-lookup"><span data-stu-id="62974-143">[**CFSTR\_DS\_PROPSHEETCONFIG**](cfstr-ds-propsheetconfig.md) This data format contains a [**PROPSHEETCFG**](propsheetcfg.md) structure that contains property sheet host data.</span></span> <span data-ttu-id="62974-144">裝載屬性工作表時， **PROPSHEETCFG** 結構中較大的成員會包含下列清單中所顯示的資料。</span><span class="sxs-lookup"><span data-stu-id="62974-144">When hosting a property sheet, the more significant members of the **PROPSHEETCFG** structure contain the data shown in the following list.</span></span>

        <span data-ttu-id="62974-145">**lNotifyHandle** 必須為零。</span><span class="sxs-lookup"><span data-stu-id="62974-145">**lNotifyHandle** Must be zero.</span></span>
        <span data-ttu-id="62974-146">**hwndParentSheet**  包含視窗的控制碼，可在其中一個頁面中的某個內容變更並套用時，接收 [**WM \_ ADSPROP \_ 通知 \_ 變更**](wm-adsprop-notify-change.md) 訊息。</span><span class="sxs-lookup"><span data-stu-id="62974-146">**hwndParentSheet**  Contains the handle of the window to receive [**WM\_ADSPROP\_NOTIFY\_CHANGE**](wm-adsprop-notify-change.md) messages when something in one of the pages changes and is applied.</span></span> <span data-ttu-id="62974-147">如果不需要此訊息，則可以是 **Null** 。</span><span class="sxs-lookup"><span data-stu-id="62974-147">Can be **NULL** if this message is not desired.</span></span>

        <span data-ttu-id="62974-148">**hwndHidden** 包含視窗的控制碼，可接收 [**WM \_ dsa \_ 工作表 \_ 建立 \_ 通知**](wm-dsa-sheet-create-notify.md) 和 [**WM \_ dsa \_ 工作表 \_ 關閉 \_ 通知**](wm-dsa-sheet-close-notify.md) 訊息。</span><span class="sxs-lookup"><span data-stu-id="62974-148">**hwndHidden** Contains the handle of the window to receive [**WM\_DSA\_SHEET\_CREATE\_NOTIFY**](wm-dsa-sheet-create-notify.md) and [**WM\_DSA\_SHEET\_CLOSE\_NOTIFY**](wm-dsa-sheet-close-notify.md) messages.</span></span> <span data-ttu-id="62974-149">將此設定為隱藏視窗的控制碼。</span><span class="sxs-lookup"><span data-stu-id="62974-149">Set this to the handle of your hidden window.</span></span>

        <span data-ttu-id="62974-150">**wParamSheetClose** 包含應用程式定義的識別碼，此識別碼會在「 [**WM \_ DSA \_ 工作表 \_ 關閉 \_ 通知**](wm-dsa-sheet-close-notify.md)」訊息的 *wParam* 中傳回。</span><span class="sxs-lookup"><span data-stu-id="62974-150">**wParamSheetClose** Contains an application-defined identifier that is returned in the *wParam* in the [**WM\_DSA\_SHEET\_CLOSE\_NOTIFY**](wm-dsa-sheet-close-notify.md) message.</span></span> <span data-ttu-id="62974-151">如果此成員為零，則會將「 **WM \_ DSA \_ 工作表 \_ 關閉 \_ 通知** 」訊息張貼至隱藏視窗。</span><span class="sxs-lookup"><span data-stu-id="62974-151">If this member is zero, the **WM\_DSA\_SHEET\_CLOSE\_NOTIFY** message will not be posted to the hidden window.</span></span>


3.  <span data-ttu-id="62974-152">建立 [**CLSID \_ DsPropertyPages**](guids-of-user-interface-elements.md) 物件的實例，並取得物件的 [**IShellExtInit**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellextinit) 介面。</span><span class="sxs-lookup"><span data-stu-id="62974-152">Create an instance of the [**CLSID\_DsPropertyPages**](guids-of-user-interface-elements.md) object and obtain the [**IShellExtInit**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellextinit) interface for the object.</span></span> <span data-ttu-id="62974-153">您也可以複製 **CLSID \_ DsPropertyPages** 物件的行為。</span><span class="sxs-lookup"><span data-stu-id="62974-153">It is also possible to duplicate the behavior of the **CLSID\_DsPropertyPages** object.</span></span> <span data-ttu-id="62974-154">如需詳細資訊，請參閱複製 CLSID \_ DsPropertyPages 物件的行為。</span><span class="sxs-lookup"><span data-stu-id="62974-154">For more information, see Duplicating the Behavior of the CLSID\_DsPropertyPages Object.</span></span>
4.  <span data-ttu-id="62974-155">藉由呼叫 [**IShellExtInit：： initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize)方法來初始化 [**CLSID \_ DsPropertyPages**](guids-of-user-interface-elements.md)物件。</span><span class="sxs-lookup"><span data-stu-id="62974-155">Initialize the [**CLSID\_DsPropertyPages**](guids-of-user-interface-elements.md) object by calling the [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) method.</span></span> <span data-ttu-id="62974-156">這個方法不會使用 *pidlFolder* 和 *hkeyProgID* 參數。</span><span class="sxs-lookup"><span data-stu-id="62974-156">The *pidlFolder* and *hkeyProgID* parameters are not used in this method.</span></span> <span data-ttu-id="62974-157">*Pdtobj* 參數是在步驟2中建立之資料物件的指標。</span><span class="sxs-lookup"><span data-stu-id="62974-157">The *pdtobj* parameter is the pointer to the data object created in Step 2.</span></span> <span data-ttu-id="62974-158">呼叫 **IShellExtInit：： Initialize** 方法時， **CLSID \_ DsPropertyPages** 物件將會儲存資料物件的參考。</span><span class="sxs-lookup"><span data-stu-id="62974-158">When the **IShellExtInit::Initialize** method is called, the **CLSID\_DsPropertyPages** object will save a reference to the data object.</span></span>
5.  <span data-ttu-id="62974-159">取得 [**CLSID \_ DsPropertyPages**](guids-of-user-interface-elements.md)物件的 [**IShellPropSheetExt**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellpropsheetext)介面，然後呼叫 [**IShellPropSheetExt：： AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages)方法。</span><span class="sxs-lookup"><span data-stu-id="62974-159">Obtain the [**IShellPropSheetExt**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellpropsheetext) interface for the [**CLSID\_DsPropertyPages**](guids-of-user-interface-elements.md) object and call the [**IShellPropSheetExt::AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) method.</span></span> <span data-ttu-id="62974-160">*LpfnAddPage* 參數是您必須執行的回呼函式的位址。</span><span class="sxs-lookup"><span data-stu-id="62974-160">The *lpfnAddPage* parameter is the address of a callback function that you must implement.</span></span> <span data-ttu-id="62974-161">此函數的格式如下所示。</span><span class="sxs-lookup"><span data-stu-id="62974-161">The format of this function is shown below.</span></span> <span data-ttu-id="62974-162">如果回呼函式宣告為 c + + 類別的成員，則回呼函數必須宣告為 **static**。</span><span class="sxs-lookup"><span data-stu-id="62974-162">If the callback function is declared as a member of a C++ class, the callback function must be declared as **static**.</span></span> <span data-ttu-id="62974-163">*LParam* 參數是應用程式定義的值，可用來識別實回呼函數的物件。</span><span class="sxs-lookup"><span data-stu-id="62974-163">The *lParam* parameter is an application-defined value that can be used to identify the object that implements the callback function.</span></span> <span data-ttu-id="62974-164">呼叫 **IShellPropSheetExt：： AddPages** 方法時， **CLSID \_ DsPropertyPages** 物件將會從資料物件取得資料，並列舉針對物件顯示規範所註冊的屬性頁。</span><span class="sxs-lookup"><span data-stu-id="62974-164">When the **IShellPropSheetExt::AddPages** method is called, the **CLSID\_DsPropertyPages** object will obtain the data from the data object and enumerate the property pages registered for the object display specifiers.</span></span> <span data-ttu-id="62974-165">**CLSID \_ DsPropertyPages** 物件接著會列舉屬性頁物件，並呼叫每個物件的 **IShellPropSheetExt：： AddPages** 方法。</span><span class="sxs-lookup"><span data-stu-id="62974-165">The **CLSID\_DsPropertyPages** object will then enumerate the property page objects, calling each object's **IShellPropSheetExt::AddPages** method.</span></span>

    ```C++
    BOOL CALLBACK AddPagesCallback(HPROPSHEETPAGE, LPARAM)
    ```

    

6.  <span data-ttu-id="62974-166">每個由屬性頁物件新增的頁面都會導致呼叫回呼函式時，使用屬性頁的控制碼和應用程式定義的值。</span><span class="sxs-lookup"><span data-stu-id="62974-166">Each page added by the property page objects will result in your callback function being called with the handle to the property page and the application-defined value.</span></span> <span data-ttu-id="62974-167">您的回呼函數必須儲存每個傳遞的屬性頁控制碼。</span><span class="sxs-lookup"><span data-stu-id="62974-167">Your callback function must store each property page handle that is passed.</span></span> <span data-ttu-id="62974-168">當 [**CLSID \_ DsPropertyPages**](guids-of-user-interface-elements.md) 物件的 [**IShellPropSheetExt：： AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) 方法傳回時，會透過您的回呼函式加入所有頁面。</span><span class="sxs-lookup"><span data-stu-id="62974-168">When the [**CLSID\_DsPropertyPages**](guids-of-user-interface-elements.md) object's [**IShellPropSheetExt::AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) method returns, all pages will have been added via your callback function.</span></span>
7.  <span data-ttu-id="62974-169">填入 [**PROPSHEETHEADER**](/windows/win32/api/prsht/ns-prsht-propsheetheadera_v2) 結構以顯示內容表。</span><span class="sxs-lookup"><span data-stu-id="62974-169">Fill in a [**PROPSHEETHEADER**](/windows/win32/api/prsht/ns-prsht-propsheetheadera_v2) structure to display the property sheet.</span></span> <span data-ttu-id="62974-170">**Phpage** 成員會收到回呼函數所收集之頁面控點陣列的指標。</span><span class="sxs-lookup"><span data-stu-id="62974-170">The **phpage** member receives a pointer to an array of page handles that were collected by your callback function.</span></span> <span data-ttu-id="62974-171">**NPages** 成員會收到頁面控點陣列中的頁面數目。</span><span class="sxs-lookup"><span data-stu-id="62974-171">The **nPages** member receives the number of pages in the page handle array.</span></span>
8.  <span data-ttu-id="62974-172">藉由呼叫 [**PropertySheet**](/windows/win32/api/prsht/nf-prsht-propertysheeta) 函數來顯示內容表。</span><span class="sxs-lookup"><span data-stu-id="62974-172">Display the property sheet by calling the [**PropertySheet**](/windows/win32/api/prsht/nf-prsht-propertysheeta) function.</span></span>

<span data-ttu-id="62974-173">如果任何頁面中的資料已變更，且按一下 [**確定]** 或 [套用]**按鈕，** 由 [**PROPSHEETCFG**](propsheetcfg.md)結構的 **hwndParentSheet** 成員所識別的視窗就會收到 [**WM \_ ADSPROP \_ 通知 \_ 變更**](wm-adsprop-notify-change.md)訊息。</span><span class="sxs-lookup"><span data-stu-id="62974-173">If the data in any page is changed and the **OK** or **Apply** buttons are clicked, the window identified by the **hwndParentSheet** member of the [**PROPSHEETCFG**](propsheetcfg.md) structure will receive a [**WM\_ADSPROP\_NOTIFY\_CHANGE**](wm-adsprop-notify-change.md) message.</span></span> <span data-ttu-id="62974-174">這則訊息完全是通知，不需要採取任何特定動作。</span><span class="sxs-lookup"><span data-stu-id="62974-174">This message is strictly a notification and requires no specific action.</span></span>

<span data-ttu-id="62974-175">當頁面關閉時， [**PROPSHEETCFG**](propsheetcfg.md)結構的 **hwndHidden** 成員所識別的視窗將會收到 [**WM 的 \_ DSA \_ 工作表 \_ 關閉 \_ 通知**](wm-dsa-sheet-close-notify.md)訊息。</span><span class="sxs-lookup"><span data-stu-id="62974-175">When the page is closed, the window identified by the **hwndHidden** member of the [**PROPSHEETCFG**](propsheetcfg.md) structure will receive a [**WM\_DSA\_SHEET\_CLOSE\_NOTIFY**](wm-dsa-sheet-close-notify.md) message.</span></span> <span data-ttu-id="62974-176">這則訊息完全是通知，不需要執行特定動作。</span><span class="sxs-lookup"><span data-stu-id="62974-176">This message is strictly a notification and requires no specific action to be performed.</span></span>

<span data-ttu-id="62974-177">在某些情況下，現有的屬性工作表將需要顯示次要屬性工作表。</span><span class="sxs-lookup"><span data-stu-id="62974-177">In some cases, the existing property sheets will need to display a secondary property sheet.</span></span> <span data-ttu-id="62974-178">例如，如果您顯示使用者物件的屬性工作表，並選取 [ **成員** ] 頁面，則會顯示使用者所屬群組的清單。</span><span class="sxs-lookup"><span data-stu-id="62974-178">For example, if you display the property sheet for a user object and select the **Member Of** page, a list of groups that the user is a member of will be displayed.</span></span> <span data-ttu-id="62974-179">如果您按兩下清單中的其中一個群組，則會顯示該群組的屬性工作表。</span><span class="sxs-lookup"><span data-stu-id="62974-179">If you double-click one of these groups in the list, the property sheet for that group will be displayed.</span></span> <span data-ttu-id="62974-180">主要屬性工作表不會單獨顯示次要工作表。</span><span class="sxs-lookup"><span data-stu-id="62974-180">The primary property sheet does not display the secondary sheet by itself.</span></span> <span data-ttu-id="62974-181">它會要求主機藉由將 [**WM \_ DSA \_ 工作表 \_ 建立 \_ 通知**](wm-dsa-sheet-create-notify.md)訊息傳送至 [**PROPSHEETCFG**](propsheetcfg.md)結構的 **hwndHidden** 成員所識別的視窗，來顯示次要工作表。</span><span class="sxs-lookup"><span data-stu-id="62974-181">It requests that the host display the secondary sheet by sending a [**WM\_DSA\_SHEET\_CREATE\_NOTIFY**](wm-dsa-sheet-create-notify.md) message to the window identified by the **hwndHidden** member of the [**PROPSHEETCFG**](propsheetcfg.md) structure.</span></span> <span data-ttu-id="62974-182">[ **WM \_ dsa \_ 工作表 \_ 建立 \_ 通知** 訊息] 的 *wParam* 是 [**DSA \_ SEC \_ 頁面 \_ 資訊**](dsa-sec-page-info.md)結構的指標，其中包含次要屬性工作表及其代表物件的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="62974-182">The *wParam* of the **WM\_DSA\_SHEET\_CREATE\_NOTIFY** message is a pointer to a [**DSA\_SEC\_PAGE\_INFO**](dsa-sec-page-info.md) structure that contains information about the secondary property sheet and the object that it represents.</span></span> <span data-ttu-id="62974-183">為了回應這則訊息，屬性工作表主機必須以上述方式顯示次要屬性工作表。</span><span class="sxs-lookup"><span data-stu-id="62974-183">In response to this message, the property sheet host must display the secondary property sheet in the same manner as shown above.</span></span> <span data-ttu-id="62974-184">處理 **WM \_ DSA \_ 工作表 \_ 建立 \_ 通知** 訊息之後，訊息接收者必須將 *wParam* 值傳遞給 [**>localfree**](/windows/desktop/api/winbase/nf-winbase-localfree)函式，以釋放 **DSA \_ SEC \_ 頁面 \_ 資訊** 結構。</span><span class="sxs-lookup"><span data-stu-id="62974-184">After processing the **WM\_DSA\_SHEET\_CREATE\_NOTIFY** message, the message receiver must free the **DSA\_SEC\_PAGE\_INFO** structure by passing the *wParam* value to the [**LocalFree**](/windows/desktop/api/winbase/nf-winbase-localfree) function.</span></span>

## <a name="duplicating-the-behavior-of-the-clsid_dspropertypages-object"></a><span data-ttu-id="62974-185">複製 CLSID DsPropertyPages 物件的行為 \_</span><span class="sxs-lookup"><span data-stu-id="62974-185">Duplicating the Behavior of the CLSID\_DsPropertyPages Object</span></span>

<span data-ttu-id="62974-186">**複製 CLSID \_ DsPropertyPages 物件的行為**</span><span class="sxs-lookup"><span data-stu-id="62974-186">**To duplicate the behavior of the CLSID\_DsPropertyPages object**</span></span>

1.  <span data-ttu-id="62974-187">列舉物件類別之顯示規範的 [**adminPropertyPages**](/windows/desktop/ADSchema/a-adminpropertypages) 或 [**shellPropertyPages**](/windows/desktop/ADSchema/a-shellpropertypages) 屬性中的值。</span><span class="sxs-lookup"><span data-stu-id="62974-187">Enumerate the values in the [**adminPropertyPages**](/windows/desktop/ADSchema/a-adminpropertypages) or [**shellPropertyPages**](/windows/desktop/ADSchema/a-shellpropertypages) attribute for the display specifier for the object class.</span></span> <span data-ttu-id="62974-188">每個值都是一個字串，其中包含數位，後面接著逗號，接著是屬性頁延伸的類別識別碼的字串表示。</span><span class="sxs-lookup"><span data-stu-id="62974-188">Each value is a string that contains a number, followed by a comma, followed by the string representation of the class identifier of the property page extension.</span></span> <span data-ttu-id="62974-189">如需屬性頁的格式顯示規範值的詳細資訊，請參閱 [在顯示規範中註冊屬性頁 COM 物件](registering-the-property-page-com-object-in-a-display-specifier.md)。</span><span class="sxs-lookup"><span data-stu-id="62974-189">For more information about the format of the property pages display specifier values, see [Registering the Property Page COM Object in a Display Specifier](registering-the-property-page-com-object-in-a-display-specifier.md).</span></span>
2.  <span data-ttu-id="62974-190">使用 [**CLSIDFromString**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromclsid)函式，將每個類別識別碼字串轉換成 **CLSID** 。</span><span class="sxs-lookup"><span data-stu-id="62974-190">Convert each class identifier string into a **CLSID** using the [**CLSIDFromString**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromclsid) function.</span></span>
3.  <span data-ttu-id="62974-191">依屬性值中每個類別識別碼字串前面的數位來排序擴充類別識別碼。</span><span class="sxs-lookup"><span data-stu-id="62974-191">Sort the extension class identifiers by the number that precedes each class identifier string in the attribute value.</span></span> <span data-ttu-id="62974-192">如果兩個數字相同，請依照從 Active Directory 伺服器取得屬性值的順序來排序類別識別碼。</span><span class="sxs-lookup"><span data-stu-id="62974-192">If two numbers are identical, sort the class identifiers in the order that the attribute values are obtained from the Active Directory server.</span></span>
4.  <span data-ttu-id="62974-193">列舉擴充類別識別碼，建立每個延伸模組的實例。</span><span class="sxs-lookup"><span data-stu-id="62974-193">Enumerate the extension class identifiers, creating an instance of each extension.</span></span>
5.  <span data-ttu-id="62974-194">針對每個擴充功能，依照上面排序的順序，以裝載 Active Directory 消費者和電腦屬性工作表程式的步驟4中所述的相同資訊，呼叫延伸模組的 [**IShellExtInit：： Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) 。</span><span class="sxs-lookup"><span data-stu-id="62974-194">For each extension, in the order sorted above, call the extension's [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) with the same information described in Step 4 of the Hosting an Active Directory Users and Computers Property Sheet procedure.</span></span>
6.  <span data-ttu-id="62974-195">針對每個擴充功能，依照以上排序的順序，以裝載 Active Directory 消費者和電腦屬性工作表程式的步驟5中所述的相同資訊，呼叫延伸模組的 [**IShellPropSheetExt：： AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) 。</span><span class="sxs-lookup"><span data-stu-id="62974-195">For each extension, in the order sorted above, call the extension's [**IShellPropSheetExt::AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) with the same information described in Step 5 of the Hosting an Active Directory Users and Computers Property Sheet procedure.</span></span>

<span data-ttu-id="62974-196">可能的話，請使用 [**CLSID \_ DsPropertyPages**](guids-of-user-interface-elements.md) 物件來建立頁面，而不是手動執行。</span><span class="sxs-lookup"><span data-stu-id="62974-196">If possible, use the [**CLSID\_DsPropertyPages**](guids-of-user-interface-elements.md) object to create the pages rather than do this manually.</span></span> <span data-ttu-id="62974-197">**CLSID \_ DsPropertyPages** 已經過優化，而且會正確處理失敗的情況，例如，當目前的地區設定沒有可用的顯示規範時。</span><span class="sxs-lookup"><span data-stu-id="62974-197">The **CLSID\_DsPropertyPages** has been optimized and will correctly handle failure cases, such as when no display specifier is available for the current locale.</span></span> <span data-ttu-id="62974-198">此外， **CLSID \_ DsPropertyPages** 物件可能會在未來變更，這表示您的屬性工作表可能不會完全符合 Active Directory 消費者和電腦 MMC 嵌入式管理單元所顯示的內容表。</span><span class="sxs-lookup"><span data-stu-id="62974-198">Also, the **CLSID\_DsPropertyPages** object may change in the future, which means your property sheets may not exactly match those displayed by the Active Directory Users and Computers MMC snap-in.</span></span>

## <a name="special-programming-elements"></a><span data-ttu-id="62974-199">特殊程式設計項目</span><span class="sxs-lookup"><span data-stu-id="62974-199">Special Programming Elements</span></span>

<span data-ttu-id="62974-200">目前，已發行的標頭檔中未定義下列程式設計項目。</span><span class="sxs-lookup"><span data-stu-id="62974-200">Currently, the following programming elements are not defined in a published header file.</span></span> <span data-ttu-id="62974-201">若要使用這些專案，您必須以特定參考頁面中顯示的確切格式來定義它們。</span><span class="sxs-lookup"><span data-stu-id="62974-201">To use these elements, you must define them yourself in the exact format shown in the particular reference page.</span></span>

-   [<span data-ttu-id="62974-202">**CFSTR \_ DS \_ PROPSHEETCONFIG**</span><span class="sxs-lookup"><span data-stu-id="62974-202">**CFSTR\_DS\_PROPSHEETCONFIG**</span></span>](cfstr-ds-propsheetconfig.md)
-   [<span data-ttu-id="62974-203">**PROPSHEETCFG**</span><span class="sxs-lookup"><span data-stu-id="62974-203">**PROPSHEETCFG**</span></span>](propsheetcfg.md)
-   [<span data-ttu-id="62974-204">**WM \_ DSA \_ 工作表 \_ 關閉 \_ 通知**</span><span class="sxs-lookup"><span data-stu-id="62974-204">**WM\_DSA\_SHEET\_CLOSE\_NOTIFY**</span></span>](wm-dsa-sheet-close-notify.md)
-   [<span data-ttu-id="62974-205">**WM \_ DSA \_ 工作表 \_ 建立 \_ 通知**</span><span class="sxs-lookup"><span data-stu-id="62974-205">**WM\_DSA\_SHEET\_CREATE\_NOTIFY**</span></span>](wm-dsa-sheet-create-notify.md)
-   [<span data-ttu-id="62974-206">**DSA \_ 秒 \_ 頁面 \_ 資訊**</span><span class="sxs-lookup"><span data-stu-id="62974-206">**DSA\_SEC\_PAGE\_INFO**</span></span>](dsa-sec-page-info.md)

## <a name="example-code"></a><span data-ttu-id="62974-207">範例程式碼</span><span class="sxs-lookup"><span data-stu-id="62974-207">Example Code</span></span>

<span data-ttu-id="62974-208">下列 c + + 程式碼範例會示範定義這些專案的安全方式，即使這些專案是在未來已發行的標頭檔中定義，這些元素仍會繼續運作。</span><span class="sxs-lookup"><span data-stu-id="62974-208">The following C++ code example shows a safe way to define these elements that will continue to work even if these elements are defined in a published header file in the future.</span></span>


```C++
#ifndef CFSTR_DS_PROPSHEETCONFIG
    #define CFSTR_DS_PROPSHEETCONFIG_W L"DsPropSheetCfgClipFormat"
    #define CFSTR_DS_PROPSHEETCONFIG_A "DsPropSheetCfgClipFormat"

    #ifdef UNICODE
        #define CFSTR_DS_PROPSHEETCONFIG CFSTR_DS_PROPSHEETCONFIG_W
    #else
        #define CFSTR_DS_PROPSHEETCONFIG CFSTR_DS_PROPSHEETCONFIG_A
    #endif //UNICODE
#endif //CFSTR_DS_PROPSHEETCONFIG


#ifndef WM_ADSPROP_SHEET_CREATE
    #define WM_ADSPROP_SHEET_CREATE (WM_USER + 1108)
#endif


#ifndef WM_DSA_SHEET_CREATE_NOTIFY
    #define WM_DSA_SHEET_CREATE_NOTIFY (WM_USER + 6)
#endif


#ifndef WM_DSA_SHEET_CLOSE_NOTIFY
    #define WM_DSA_SHEET_CLOSE_NOTIFY (WM_USER + 5) 
#endif


#ifndef DSA_SEC_PAGE_INFO
    typedef struct _DSA_SEC_PAGE_INFO
    {
        HWND    hwndParentSheet;
        DWORD   offsetTitle;
        DSOBJECTNAMES dsObjectNames;
    } DSA_SEC_PAGE_INFO, *PDSA_SEC_PAGE_INFO;
#endif //DSA_SEC_PAGE_INFO

#ifndef PROPSHEETCFG
    typedef struct _PROPSHEETCFG
    {  
        LONG_PTR lNotifyHandle;  
        HWND hwndParentSheet;  
        HWND hwndHidden;  
        WPARAM wParamSheetClose;
    } PROPSHEETCFG, *PPROPSHEETCFG;
#endif //PROPSHEETCFG
```



 

