---
title: 系統管理通知處理常式
description: Microsoft Active Directory 消費者和電腦 MMC 嵌入式管理單元提供一種機制，可讓元件在使用者刪除、重新命名、移動或變更物件的屬性時，使用嵌入式管理單元來接收通知。
ms.assetid: 49dbb995-c760-4fac-a72f-d5d94afb63c7
ms.tgt_platform: multiple
keywords:
- 系統管理通知處理常式廣告
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: baa6f48f8b56ab8e4a1d64d0fe15543bfee6c09e
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/17/2020
ms.locfileid: "103842103"
---
# <a name="administrative-notification-handlers"></a><span data-ttu-id="a2b90-104">系統管理通知處理常式</span><span class="sxs-lookup"><span data-stu-id="a2b90-104">Administrative Notification Handlers</span></span>

<span data-ttu-id="a2b90-105">Microsoft Active Directory 消費者和電腦 MMC 嵌入式管理單元提供一種機制，可讓元件在使用者刪除、重新命名、移動或變更物件的屬性時，使用嵌入式管理單元來接收通知。</span><span class="sxs-lookup"><span data-stu-id="a2b90-105">The Microsoft Active Directory Users and Computers MMC snap-in provides a mechanism to enable components to receive notifications when the user deletes, renames, moves, or changes the properties of an object using the snap-in.</span></span> <span data-ttu-id="a2b90-106">接收通知的元件稱為「通知處理常式」。</span><span class="sxs-lookup"><span data-stu-id="a2b90-106">The component that receives the notifications is known as a "notification handler".</span></span>

<span data-ttu-id="a2b90-107">當多個物件連結在一起，且必須存在於相同的容器內時，這會很有用。</span><span class="sxs-lookup"><span data-stu-id="a2b90-107">This is useful when multiple objects are linked together and must exist within the same container.</span></span> <span data-ttu-id="a2b90-108">如果移動其中一個連結化物件，則會提供通知處理常式的通知，而通知處理常式可以將其他連結的物件移至相同的資料夾。</span><span class="sxs-lookup"><span data-stu-id="a2b90-108">If one of the linked objects is moved, a notification is supplied to the notification handler and the notification handler can move the other linked objects to the same folder.</span></span>

<span data-ttu-id="a2b90-109">當執行其中一項作業並安裝一或多個通知處理常式時，[使用者和電腦] 嵌入式管理單元會顯示確認對話方塊，其中會列出通知處理常式，以及每個處理常式的核取方塊。</span><span class="sxs-lookup"><span data-stu-id="a2b90-109">When one of the operations is performed and one or more notification handlers is installed, the Users and Computers snap-in will display a confirmation dialog box that lists the notification handlers and a check box for each handler.</span></span> <span data-ttu-id="a2b90-110">如果選取處理常式的核取方塊，就會通知處理常式。</span><span class="sxs-lookup"><span data-stu-id="a2b90-110">If the check box for a handler is selected, the handler is notified.</span></span> <span data-ttu-id="a2b90-111">如果未選取此核取方塊，則不會通知處理常式。</span><span class="sxs-lookup"><span data-stu-id="a2b90-111">If the check box is not selected, the handler is not notified.</span></span>

## <a name="implementing-a-notification-handler"></a><span data-ttu-id="a2b90-112">執行通知處理常式</span><span class="sxs-lookup"><span data-stu-id="a2b90-112">Implementing a Notification Handler</span></span>

<span data-ttu-id="a2b90-113">通知處理常式是實作為同進程伺服器的 COM 物件。</span><span class="sxs-lookup"><span data-stu-id="a2b90-113">A notification handler is a COM object implemented as an in-proc server.</span></span> <span data-ttu-id="a2b90-114">通知處理常式必須執行 [**IDsAdminNotifyHandler**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnotifyhandler) 介面。</span><span class="sxs-lookup"><span data-stu-id="a2b90-114">The notification handler must implement the [**IDsAdminNotifyHandler**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnotifyhandler) interface.</span></span>

<span data-ttu-id="a2b90-115">當發生會導致通知的事件時，[使用者和電腦] 嵌入式管理單元會列舉已註冊的通知處理常式，並使用處理程式的 CLSID 來建立每一個通知處理常式。</span><span class="sxs-lookup"><span data-stu-id="a2b90-115">When an event occurs that will cause a notification, the Users and Computers snap-in enumerates the registered notification handlers and creates each one using the CLSID for the handler.</span></span> <span data-ttu-id="a2b90-116">建立處理常式之後，嵌入式管理單元會呼叫 [**IDsAdminNotifyHandler：： Initialize**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnotifyhandler-initialize) 方法。</span><span class="sxs-lookup"><span data-stu-id="a2b90-116">After the handler is created, the snap-in calls the [**IDsAdminNotifyHandler::Initialize**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnotifyhandler-initialize) method.</span></span> <span data-ttu-id="a2b90-117">**Initialize** 方法會提供嵌入式管理單元與處理常式應接收的事件。</span><span class="sxs-lookup"><span data-stu-id="a2b90-117">The **Initialize** method supplies the snap-in with the events the handler should receive.</span></span>

<span data-ttu-id="a2b90-118">如果事件是應該傳送給通知處理常式的事件，此嵌入式管理單元會呼叫 [**IDsAdminNotifyHandler：： Begin**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnotifyhandler-begin) 方法。</span><span class="sxs-lookup"><span data-stu-id="a2b90-118">If the event is one that should be sent to the notification handler, the snap-in calls the [**IDsAdminNotifyHandler::Begin**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnotifyhandler-begin) method.</span></span> <span data-ttu-id="a2b90-119">**Begin** 方法會提供事件發生時的處理常式、發生事件之物件的相關資料，以及物件將變成的資料（視事件而定）。</span><span class="sxs-lookup"><span data-stu-id="a2b90-119">The **Begin** method provides the handler with the event occurring, data about the object that the event is occurring on and, depending on the event, data about what the object will become.</span></span> <span data-ttu-id="a2b90-120">**Begin** 方法也會提供嵌入式管理單元，其中包含應該在確認對話方塊中顯示的處理常式文字。</span><span class="sxs-lookup"><span data-stu-id="a2b90-120">The **Begin** method also provides the snap-in with the text that should be displayed for the handler in the confirmation dialog box.</span></span>

<span data-ttu-id="a2b90-121">呼叫每個處理常式的 [**Begin**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnotifyhandler-begin) 方法時，嵌入式管理單元會顯示確認對話方塊。</span><span class="sxs-lookup"><span data-stu-id="a2b90-121">When the [**Begin**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnotifyhandler-begin) method for each handler has been called, the snap-in displays the confirmation dialog box.</span></span> <span data-ttu-id="a2b90-122">確認對話方塊會提示使用者選取要接收通知的處理常式。</span><span class="sxs-lookup"><span data-stu-id="a2b90-122">The confirmation dialog box prompts the user to select which handlers will receive the notification.</span></span> <span data-ttu-id="a2b90-123">如果使用者在確認對話方塊中按下 [ **否** ] 按鈕，系統就不會通知任何處理程式。</span><span class="sxs-lookup"><span data-stu-id="a2b90-123">If the user presses the **No** push button in the confirmation dialog, none of the handlers are notified.</span></span> <span data-ttu-id="a2b90-124">如果使用者按下 [ **是]** 按鈕，在 [確認] 對話方塊中選取的每個處理常式都會收到通知。</span><span class="sxs-lookup"><span data-stu-id="a2b90-124">If the user presses the **Yes** push button, each of the handlers selected in the confirmation dialog box receive the notification.</span></span> <span data-ttu-id="a2b90-125">此嵌入式管理單元會藉由呼叫 [**IDsAdminNotifyHandler：： Notify**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnotifyhandler-notify) 方法，將通知傳送給處理常式。</span><span class="sxs-lookup"><span data-stu-id="a2b90-125">The snap-in sends the notification to the handler by calling the [**IDsAdminNotifyHandler::Notify**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnotifyhandler-notify) method.</span></span>

<span data-ttu-id="a2b90-126">通知所有處理常式之後，嵌入式管理單元會呼叫 [**IDsAdminNotifyHandler：： End**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnotifyhandler-end) 方法。</span><span class="sxs-lookup"><span data-stu-id="a2b90-126">After all of the handlers have been notified, the snap-in calls the [**IDsAdminNotifyHandler::End**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnotifyhandler-end) method.</span></span> <span data-ttu-id="a2b90-127">一律會呼叫 **End** 方法，即使沒有呼叫 [**Notify**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnotifyhandler-notify) 方法也一樣。</span><span class="sxs-lookup"><span data-stu-id="a2b90-127">The **End** method is always called, even if the [**Notify**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnotifyhandler-notify) method is not called.</span></span>

## <a name="registering-a-notification-handler-in-the-windows-registry"></a><span data-ttu-id="a2b90-128">在 Windows 登錄中註冊通知處理常式</span><span class="sxs-lookup"><span data-stu-id="a2b90-128">Registering a Notification Handler in the Windows Registry</span></span>

<span data-ttu-id="a2b90-129">和所有 COM 伺服器一樣，必須在 Windows 登錄中註冊通知處理常式。</span><span class="sxs-lookup"><span data-stu-id="a2b90-129">Like all COM servers, a notification handler must be registered in the Windows registry.</span></span> <span data-ttu-id="a2b90-130">此處理程式會在下列機碼下註冊：</span><span class="sxs-lookup"><span data-stu-id="a2b90-130">The handler is registered under the following key:</span></span>


```C++
HKEY_CLASSES_ROOT - CLSID - <CLSID>
```



<span data-ttu-id="a2b90-131">**<CLSID>** 這是 [**StringFromCLSID**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromclsid) 函數所產生之 CLSID 的字串表示。</span><span class="sxs-lookup"><span data-stu-id="a2b90-131">**<CLSID>** is the string representation of the CLSID as produced by the [**StringFromCLSID**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromclsid) function.</span></span> <span data-ttu-id="a2b90-132">在機 **<CLSID>** 碼下，有一個 **InProcServer32** 機碼會將物件識別為32位的內部進程伺服器。</span><span class="sxs-lookup"><span data-stu-id="a2b90-132">Under the **<CLSID>** key, there is an **InProcServer32** key that identifies the object as a 32-bit in-proc server.</span></span> <span data-ttu-id="a2b90-133">在 **InProcServer32** 索引鍵下，DLL 的位置會指定為預設值，而執行緒模型則是在 **>threadingmodel** 值中指定。</span><span class="sxs-lookup"><span data-stu-id="a2b90-133">Under the **InProcServer32** key, the location of the DLL is specified in the default value and the threading model is specified in the **ThreadingModel** value.</span></span> <span data-ttu-id="a2b90-134">所有通知處理常式都必須使用 **單元** 執行緒模型。</span><span class="sxs-lookup"><span data-stu-id="a2b90-134">All notification handlers must use the **Apartment** threading model.</span></span>

## <a name="registering-a-notification-handler-with-an-active-directory-server"></a><span data-ttu-id="a2b90-135">向 Active Directory 伺服器註冊通知處理常式</span><span class="sxs-lookup"><span data-stu-id="a2b90-135">Registering a Notification Handler with an Active Directory Server</span></span>

<span data-ttu-id="a2b90-136">在 Active Directory Domain Services 中，通知處理常式註冊是一種地區設定特有的。</span><span class="sxs-lookup"><span data-stu-id="a2b90-136">Within Active Directory Domain Services, notification handler registration is specific to one locale.</span></span> <span data-ttu-id="a2b90-137">如果通知處理常式套用至所有地區設定，則必須在 DisplaySpecifiers 容器中所有地區設定子容器的 **displaySpecifier** 物件中註冊該處理常式。</span><span class="sxs-lookup"><span data-stu-id="a2b90-137">If the notification handler applies to all locales, it must be registered in the **displaySpecifier** object in all of the locale subcontainers in the DisplaySpecifiers container.</span></span> <span data-ttu-id="a2b90-138">如果通知處理常式已針對特定地區設定進行當地語系化，則會在該地區設定的 subcontainer 中，將它註冊在 **displaySpecifier** 物件中。</span><span class="sxs-lookup"><span data-stu-id="a2b90-138">If the notification handler is localized for a certain locale, it is registered in the **displaySpecifier** object in that locale's subcontainer.</span></span> <span data-ttu-id="a2b90-139">如需 DisplaySpecifiers 容器和地區設定的詳細資訊，請參閱 [顯示](display-specifiers.md) 規範和 [DisplaySpecifiers 容器](displayspecifiers-container.md)。</span><span class="sxs-lookup"><span data-stu-id="a2b90-139">For more information about the DisplaySpecifiers container and locales, see [Display Specifiers](display-specifiers.md) and [DisplaySpecifiers Container](displayspecifiers-container.md).</span></span>

<span data-ttu-id="a2b90-140">通知處理常式會在 **DS-UI 預設設定** 容器的 **dsUIAdminNotification** 屬性下註冊。</span><span class="sxs-lookup"><span data-stu-id="a2b90-140">Notification handlers are registered under the **dsUIAdminNotification** attribute in the **DS-UI-Default-Settings** container.</span></span> <span data-ttu-id="a2b90-141">此為多重值的 Unicode 字串值，其中每個值都需要下列格式：</span><span class="sxs-lookup"><span data-stu-id="a2b90-141">This a multi-valued Unicode string value where each value requires the following format:</span></span>


```C++
<order number>,<CLSID>
```



<span data-ttu-id="a2b90-142">「 &lt; 訂單編號」 &gt; 是一個不帶正負號的數位，表示處理常式在確認對話方塊中的位置。</span><span class="sxs-lookup"><span data-stu-id="a2b90-142">The "&lt;order number&gt;" is an unsigned number that represents the position of the handler in the confirmation dialog.</span></span> <span data-ttu-id="a2b90-143">當 [確認] 對話方塊出現時，會使用每個值的「訂單編號」比較來排序這些值 &lt; &gt; 。</span><span class="sxs-lookup"><span data-stu-id="a2b90-143">When the confirmation dialog is displayed, the values are sorted using a comparison of each value's "&lt;order number&gt;".</span></span> <span data-ttu-id="a2b90-144">如果有一個以上的值具有相同的「 &lt; 訂單編號」 &gt; ，這些處理常式會依照從 Active Directory 伺服器讀取的順序來顯示。</span><span class="sxs-lookup"><span data-stu-id="a2b90-144">If more than one value has the same "&lt;order number&gt;", those handlers are displayed in the order they are read from the Active Directory server.</span></span> <span data-ttu-id="a2b90-145">非現有的（也就是屬性中的其他值未使用的值）， &lt; &gt; 如果可能的話，應該使用「訂單編號」。</span><span class="sxs-lookup"><span data-stu-id="a2b90-145">A non-existing, that is, one not used by other values in the property, "&lt;order number&gt;" should be used if possible.</span></span> <span data-ttu-id="a2b90-146">沒有指定的開始位置，而間距可以出現在「 &lt; 訂單編號」 &gt; 序列中。</span><span class="sxs-lookup"><span data-stu-id="a2b90-146">There is no prescribed starting position, and gaps can appear in the "&lt;order number&gt;" sequence.</span></span>

<span data-ttu-id="a2b90-147">" &lt; Clsid &gt; " 是 [**StringFromCLSID**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromclsid) 函式所產生之 CLSID 的字串表示。</span><span class="sxs-lookup"><span data-stu-id="a2b90-147">The "&lt;CLSID&gt;" is the string representation of the CLSID as produced by the [**StringFromCLSID**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromclsid) function.</span></span>

 

 