---
title: 建立控制項存取權
description: 若要將存取權限新增至 Active Directory 伺服器，請在設定磁碟分割的 Extended-Rights 容器中建立 controlAccessRight 物件。
ms.assetid: dacd42c6-17d9-4dfe-8f51-e4a470766494
ms.tgt_platform: multiple
keywords:
- 建立控制項存取權的 AD
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 11bdc764b09f0fe5bd165e87e23a89db7d368bfe
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/17/2020
ms.locfileid: "103681681"
---
# <a name="creating-a-control-access-right"></a><span data-ttu-id="d7f35-104">建立控制項存取權</span><span class="sxs-lookup"><span data-stu-id="d7f35-104">Creating a Control Access Right</span></span>

<span data-ttu-id="d7f35-105">若要將存取權限新增至 Active Directory 伺服器，請在設定磁碟分割的 Extended-Rights 容器中建立 [**controlAccessRight**](/windows/desktop/ADSchema/c-controlaccessright) 物件。</span><span class="sxs-lookup"><span data-stu-id="d7f35-105">To add a control access right to an Active Directory server, create a [**controlAccessRight**](/windows/desktop/ADSchema/c-controlaccessright) object in the Extended-Rights container of the Configuration partition.</span></span> <span data-ttu-id="d7f35-106">如需詳細資訊和程式碼範例，請參閱 [建立控制項存取權的範例程式碼](example-code-for-creating-a-control-access-right.md)。</span><span class="sxs-lookup"><span data-stu-id="d7f35-106">For more information and a code example, see [Example Code for Creating a Control Access Right](example-code-for-creating-a-control-access-right.md).</span></span> <span data-ttu-id="d7f35-107">若要使用 control 存取權限，您必須完成幾個步驟，視控制項存取權是否適用于特殊作業或屬性集而定。</span><span class="sxs-lookup"><span data-stu-id="d7f35-107">To use the control access right, you must complete a few more steps, depending on whether the control access right is for a special operation or a property set.</span></span>

<span data-ttu-id="d7f35-108">如果您為屬性集定義控制項存取權，請使用 [**controlAccessRight**](/windows/desktop/ADSchema/c-controlaccessright)物件的 **rightsGUID** 來識別集合中的屬性。</span><span class="sxs-lookup"><span data-stu-id="d7f35-108">If you define a control access right for a property set, use the **rightsGUID** of the [**controlAccessRight**](/windows/desktop/ADSchema/c-controlaccessright) object to identify the properties in the set.</span></span> <span data-ttu-id="d7f35-109">每個屬性都是由 Active Directory 架構中的 [**attributeSchema**](/windows/desktop/ADSchema/c-attributeschema) 物件所定義。</span><span class="sxs-lookup"><span data-stu-id="d7f35-109">Every property is defined by an [**attributeSchema**](/windows/desktop/ADSchema/c-attributeschema) object in the Active Directory schema.</span></span> <span data-ttu-id="d7f35-110">**AttributeSchema** 物件的 [**attributeSecurityGUID**](/windows/desktop/ADSchema/a-attributesecurityguid)屬性會識別屬性所屬的屬性集（如果有的話）。</span><span class="sxs-lookup"><span data-stu-id="d7f35-110">The [**attributeSecurityGUID**](/windows/desktop/ADSchema/a-attributesecurityguid) property of an **attributeSchema** object identifies the property set, if any, that the property belongs to.</span></span> <span data-ttu-id="d7f35-111">請注意， **attributeSecurityGUID** 屬性是單一值，並以二進位格式儲存 GUID， (八進位字串語法) 。</span><span class="sxs-lookup"><span data-stu-id="d7f35-111">Be aware that the **attributeSecurityGUID** property is single-valued and stores the GUID in binary format (octet string syntax).</span></span>

<span data-ttu-id="d7f35-112">如果您定義控制項存取權來對特定作業的存取進行限制，則當使用者嘗試操作時，您的應用程式必須執行存取檢查。</span><span class="sxs-lookup"><span data-stu-id="d7f35-112">If you define a control access right to place restrictions on access to a particular operation, your application must perform the access check when a user attempts the operation.</span></span>

<span data-ttu-id="d7f35-113">**若要設定存取權檢查**</span><span class="sxs-lookup"><span data-stu-id="d7f35-113">**To set up access check**</span></span>

1.  <span data-ttu-id="d7f35-114">建立可定義應用程式或服務存取類型的 control 存取權限。</span><span class="sxs-lookup"><span data-stu-id="d7f35-114">Create a control access right that defines the type of access to the application or service.</span></span> <span data-ttu-id="d7f35-115">如需詳細資訊，請參閱下列程式碼範例。</span><span class="sxs-lookup"><span data-stu-id="d7f35-115">For more information, see the following code example.</span></span>
2.  <span data-ttu-id="d7f35-116">建立 Active Directory Domain Services 物件，代表您要保護的應用程式、服務或資源。</span><span class="sxs-lookup"><span data-stu-id="d7f35-116">Create an Active Directory Domain Services object that represents the application, service, or resource that you are protecting.</span></span>
3.  <span data-ttu-id="d7f35-117">將物件 Ace 新增至物件安全描述項中的 DACL，以授與或拒絕使用者或群組該物件上的控制項存取權限。</span><span class="sxs-lookup"><span data-stu-id="d7f35-117">Add object ACEs to the DACL in the object security descriptor to grant or deny users or groups the control access right on that object.</span></span> <span data-ttu-id="d7f35-118">如需詳細資訊，請參閱 [在物件的 ACL 中設定控制項存取許可權 ACE](setting-a-control-access-right-ace-in-an-objectampaposs-acl.md)。</span><span class="sxs-lookup"><span data-stu-id="d7f35-118">For more information, see [Setting a Control Access Right ACE in an Object's ACL](setting-a-control-access-right-ace-in-an-objectampaposs-acl.md).</span></span>
4.  <span data-ttu-id="d7f35-119">當使用者嘗試執行此作業時，請將物件安全描述項和使用者存取權杖傳遞至 [**AccessCheckByTypeResultList**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-accesscheckbytyperesultlist) 函式，以驗證使用者權限。</span><span class="sxs-lookup"><span data-stu-id="d7f35-119">When a user attempts to perform the operation, verify the user rights by passing the object security descriptor and the user access token to the [**AccessCheckByTypeResultList**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-accesscheckbytyperesultlist) function.</span></span> <span data-ttu-id="d7f35-120">如需詳細資訊，請參閱 [在物件的 ACL 中檢查控制項訪問](checking-a-control-access-right-in-an-objectampaposs-acl.md)許可權。</span><span class="sxs-lookup"><span data-stu-id="d7f35-120">For more information, see [Checking a Control Access Right in an Object's ACL](checking-a-control-access-right-in-an-objectampaposs-acl.md).</span></span>

<span data-ttu-id="d7f35-121">根據對物件進行存取檢查的結果，應用程式或服務可以允許或拒絕使用者存取應用程式或服務。</span><span class="sxs-lookup"><span data-stu-id="d7f35-121">Based on the result of the access check on the object, the application or service can allow or deny the user access to the application or service.</span></span>

<span data-ttu-id="d7f35-122">當您建立 [**controlAccessRight**](/windows/desktop/ADSchema/c-controlaccessright) 物件時，請設定下表所列的屬性，讓物件成為 Active Directory Domain Services 和 Windows 安全性系統所能辨識的合法控制存取權。</span><span class="sxs-lookup"><span data-stu-id="d7f35-122">When you create a [**controlAccessRight**](/windows/desktop/ADSchema/c-controlaccessright) object, set the attributes, listed in the following table, to make the object a legal control access right that is recognized by Active Directory Domain Services and the Windows security systems.</span></span>



| <span data-ttu-id="d7f35-123">屬性</span><span class="sxs-lookup"><span data-stu-id="d7f35-123">Attribute</span></span>                                     | <span data-ttu-id="d7f35-124">描述</span><span class="sxs-lookup"><span data-stu-id="d7f35-124">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|-----------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="d7f35-125">**cn**</span><span class="sxs-lookup"><span data-stu-id="d7f35-125">**cn**</span></span>](/windows/desktop/ADSchema/a-cn)                       | <span data-ttu-id="d7f35-126">單一值屬性，此屬性是物件的相對辨別名稱 (RDN) 在 Extended-Rights 容器中。</span><span class="sxs-lookup"><span data-stu-id="d7f35-126">A single-valued property that is the object's relative distinguished name (RDN) in the Extended-Rights container.</span></span> <span data-ttu-id="d7f35-127">**Cn** 是 Active Directory Domain Services 中存取控制的名稱。</span><span class="sxs-lookup"><span data-stu-id="d7f35-127">The **cn** is the name of the access control right in Active Directory Domain Services.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| [<span data-ttu-id="d7f35-128">**appliesTo**</span><span class="sxs-lookup"><span data-stu-id="d7f35-128">**appliesTo**</span></span>](/windows/desktop/ADSchema/a-appliesto)         | <span data-ttu-id="d7f35-129">多值屬性，會列出存取控制許可權適用的物件類別。</span><span class="sxs-lookup"><span data-stu-id="d7f35-129">A multi-valued property that lists the object classes that the access control right applies to.</span></span> <span data-ttu-id="d7f35-130">例如，[[**傳送為**](/windows/desktop/ADSchema/r-send-as)] 存取控制許可權會列出其 **appliesTo** 屬性中的 [[**使用者**](/windows/desktop/ADSchema/c-user)] 和 [[**電腦**](/windows/desktop/ADSchema/c-computer)] 物件類別。</span><span class="sxs-lookup"><span data-stu-id="d7f35-130">For example, the [**Send-As**](/windows/desktop/ADSchema/r-send-as) access control right lists the [**user**](/windows/desktop/ADSchema/c-user) and [**computer**](/windows/desktop/ADSchema/c-computer) object classes in its **appliesTo** property.</span></span> <span data-ttu-id="d7f35-131">在清單中，每個物件類別都是由其 [**classSchema**](/windows/desktop/ADSchema/c-classschema)物件的 [**schemaIDGUID**](/windows/desktop/ADSchema/a-schemaidguid)所識別。</span><span class="sxs-lookup"><span data-stu-id="d7f35-131">In the list, each object class is identified by the [**schemaIDGUID**](/windows/desktop/ADSchema/a-schemaidguid) of its [**classSchema**](/windows/desktop/ADSchema/c-classschema) object.</span></span> <span data-ttu-id="d7f35-132">Guid 會儲存為 COM 程式庫中 [**StringFromGUID2**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2) 函式所產生的格式字串，但不含開始和結束括弧 ( {} ) 。</span><span class="sxs-lookup"><span data-stu-id="d7f35-132">The GUIDs are stored as strings of the form produced by the [**StringFromGUID2**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2) function in the COM library but without the starting and terminating braces ({ }).</span></span> <span data-ttu-id="d7f35-133">例如，下列 GUID 是 [**computer**](/windows/desktop/ADSchema/c-computer)類別的 **schemaIDGUID** ： bf967a86-0de6-11d0-a285-00aa003049e2。</span><span class="sxs-lookup"><span data-stu-id="d7f35-133">For example, the following GUID is the **schemaIDGUID** for the [**computer**](/windows/desktop/ADSchema/c-computer) class: bf967a86-0de6-11d0-a285-00aa003049e2.</span></span><br/> <span data-ttu-id="d7f35-134">請注意， [**classSchema**](/windows/desktop/ADSchema/c-classschema)物件的 [**schemaIDGUID**](/windows/desktop/ADSchema/a-schemaidguid)屬性會使用八位字串語法儲存為二進位 GUID。</span><span class="sxs-lookup"><span data-stu-id="d7f35-134">Be aware that the [**schemaIDGUID**](/windows/desktop/ADSchema/a-schemaidguid) property of a [**classSchema**](/windows/desktop/ADSchema/c-classschema) object is stored as a binary GUID using the octet string syntax.</span></span> <span data-ttu-id="d7f35-135">若要將此八進位字串格式轉換成在 [**appliesTo**](/windows/desktop/ADSchema/a-appliesto) 屬性中使用的字串格式，請使用 [**StringFromGUID2**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2) 函式，並從傳回的字串中移除大括弧。</span><span class="sxs-lookup"><span data-stu-id="d7f35-135">To convert this octet string format to the string format used in the [**appliesTo**](/windows/desktop/ADSchema/a-appliesto) property, use the [**StringFromGUID2**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2) function and remove the braces from the returned string.</span></span><br/> <span data-ttu-id="d7f35-136">如需其中一個預先定義的物件類別（例如 [**使用者**](/windows/desktop/ADSchema/c-user)或 [**電腦**](/windows/desktop/ADSchema/c-computer)） [**schemaIDGUID**](/windows/desktop/ADSchema/a-schemaidguid)屬性的詳細資訊，請參閱 [Active Directory Domain Services 參考](active-directory-domain-services-reference.md)的 Active Directory 架構參考中的類別參考頁面。</span><span class="sxs-lookup"><span data-stu-id="d7f35-136">For more information about the [**schemaIDGUID**](/windows/desktop/ADSchema/a-schemaidguid) property of one of the predefined object classes, such as [**user**](/windows/desktop/ADSchema/c-user) or [**computer**](/windows/desktop/ADSchema/c-computer), see the class reference page in the Active Directory Schema Reference in the [Active Directory Domain Services Reference](active-directory-domain-services-reference.md).</span></span> <span data-ttu-id="d7f35-137">如需從 classSchema 物件抓取 **schemaIDGUID** 的詳細資訊和程式碼範例，請參閱 [讀取 AttributeSchema 和 classSchema 物件](reading-attributeschema-and-classschema-objects.md)。</span><span class="sxs-lookup"><span data-stu-id="d7f35-137">For more information and a code example that retrieves a **schemaIDGUID** from a classSchema object, see [Reading attributeSchema and classSchema Objects](reading-attributeschema-and-classschema-objects.md).</span></span><br/> |
| [<span data-ttu-id="d7f35-138">**displayName**</span><span class="sxs-lookup"><span data-stu-id="d7f35-138">**displayName**</span></span>](/windows/desktop/ADSchema/a-displayname)     | <span data-ttu-id="d7f35-139">用來在使用者介面中顯示存取控制許可權的字串，例如 [ **安全性** ] 屬性頁和 Active Directory 消費者和電腦 MMC 嵌入式管理單元中的其他位置。</span><span class="sxs-lookup"><span data-stu-id="d7f35-139">The string used to display the access control right in user interfaces such as the **Security** property page and other places in the Active Directory Users and Computers MMC snap-in.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| [<span data-ttu-id="d7f35-140">**rightsGuid**</span><span class="sxs-lookup"><span data-stu-id="d7f35-140">**rightsGuid**</span></span>](/windows/desktop/ADSchema/a-rightsguid)       | <span data-ttu-id="d7f35-141">識別 ACE 中控制項存取權的 GUID。</span><span class="sxs-lookup"><span data-stu-id="d7f35-141">A GUID that identifies the control access right in an ACE.</span></span> <span data-ttu-id="d7f35-142">GUID 會儲存為 [**StringFromGUID2**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2) 函式所產生的格式字串，但不含開頭和結尾的大括弧。</span><span class="sxs-lookup"><span data-stu-id="d7f35-142">The GUID is stored as a string of the form produced by the [**StringFromGUID2**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2) function, but without the starting and terminating braces.</span></span> <span data-ttu-id="d7f35-143">針對其他公用程式使用 Uuidgen.exe，以產生控制項存取權的 GUID。如果您定義新的屬性集，您可以使用 [**controlAccessRight**](/windows/desktop/ADSchema/c-controlaccessright)物件的 [**rightsGuid**](/windows/desktop/ADSchema/a-rightsguid)來識別集合中的屬性。</span><span class="sxs-lookup"><span data-stu-id="d7f35-143">Use Uuidgen.exe for some other utility to generate a GUID for the control access right.If you define a new property set, you use the [**rightsGuid**](/windows/desktop/ADSchema/a-rightsguid) of the [**controlAccessRight**](/windows/desktop/ADSchema/c-controlaccessright) object to identify the properties in the set.</span></span> <span data-ttu-id="d7f35-144">針對屬性集中的每個屬性，將屬性的 [**attributeSecurityGUID**](/windows/desktop/ADSchema/a-attributesecurityguid) 值設定為屬性集之 **rightsGUID** 的值。</span><span class="sxs-lookup"><span data-stu-id="d7f35-144">For each property in the property set, set the property's [**attributeSecurityGUID**](/windows/desktop/ADSchema/a-attributesecurityguid) value to the value of the property set's **rightsGUID**.</span></span> <span data-ttu-id="d7f35-145">屬性的 **attributeSecurityGUID** 值會儲存在 Active Directory 架構的屬性 [**attributeSchema**](/windows/desktop/ADSchema/c-attributeschema) 定義中。</span><span class="sxs-lookup"><span data-stu-id="d7f35-145">A property's **attributeSecurityGUID** value is stored in the property's [**attributeSchema**](/windows/desktop/ADSchema/c-attributeschema) definition in the Active Directory schema.</span></span> <span data-ttu-id="d7f35-146">**AttributeSecurityGUID** 屬性是單一值，並以二進位格式儲存 GUID， (八進位字串語法) 。</span><span class="sxs-lookup"><span data-stu-id="d7f35-146">The **attributeSecurityGUID** property is single-valued and stores the GUID in binary format (octet string syntax).</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| [<span data-ttu-id="d7f35-147">**objectClass**</span><span class="sxs-lookup"><span data-stu-id="d7f35-147">**objectClass**</span></span>](/windows/desktop/ADSchema/a-objectclass)     | <span data-ttu-id="d7f35-148">這個屬性會將 [**controlAccessRight**](/windows/desktop/ADSchema/c-controlaccessright) 指定為物件類別。</span><span class="sxs-lookup"><span data-stu-id="d7f35-148">This attribute specifies [**controlAccessRight**](/windows/desktop/ADSchema/c-controlaccessright) as the object class.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| [<span data-ttu-id="d7f35-149">**validAccesses**</span><span class="sxs-lookup"><span data-stu-id="d7f35-149">**validAccesses**</span></span>](/windows/desktop/ADSchema/a-validaccesses) | <span data-ttu-id="d7f35-150">若為屬性集，請將此屬性設定為 0x30< (**ads \_ 正確的 \_ ds \_ 讀取 \_** 屬性 \| **ads \_ 正確的 \_ ds \_ 寫入 \_** 配置) 。</span><span class="sxs-lookup"><span data-stu-id="d7f35-150">For property sets, set this attribute to 0x30 (**ADS\_RIGHT\_DS\_READ\_PROP** \| **ADS\_RIGHT\_DS\_WRITE\_PROP**).</span></span> <span data-ttu-id="d7f35-151">若要控制存取權限，請將此屬性設定為 0x100 (**ADS \_ RIGHT \_ DS \_ control \_ 存取**) 。</span><span class="sxs-lookup"><span data-stu-id="d7f35-151">For control access rights, set this attribute to 0x100 (**ADS\_RIGHT\_DS\_CONTROL\_ACCESS**).</span></span> <span data-ttu-id="d7f35-152">只有當 [**validAccesses**](/windows/desktop/ADSchema/a-validaccesses) 屬性設定為適當的值時，[安全性] 屬性頁才會辨識 control 存取權限。</span><span class="sxs-lookup"><span data-stu-id="d7f35-152">The security property page recognizes control access rights only if the [**validAccesses**](/windows/desktop/ADSchema/a-validaccesses) attribute is set to the appropriate value.</span></span> <span data-ttu-id="d7f35-153">如果為零，[安全性] 屬性頁會忽略或不顯示控制項存取權限。</span><span class="sxs-lookup"><span data-stu-id="d7f35-153">If zero, the control access right is ignored or not displayed by the security property page.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |



 

<span data-ttu-id="d7f35-154">請注意，預先定義的架構類別會使用 [**controlAccessRight**](/windows/desktop/ADSchema/c-controlaccessright)物件的 **localizationDisplayId** 屬性，來指定用來從 Dssec.dll 取出當地語系化顯示名稱的訊息識別碼。</span><span class="sxs-lookup"><span data-stu-id="d7f35-154">Be aware that the predefined schema classes use the **localizationDisplayId** attribute of a [**controlAccessRight**](/windows/desktop/ADSchema/c-controlaccessright) object to specify a message identifier used to retrieve a localized display name from Dssec.dll.</span></span> <span data-ttu-id="d7f35-155">如果您定義新的 **controlAccessRight** 物件，請不要設定 **localizationDisplayId** 屬性。</span><span class="sxs-lookup"><span data-stu-id="d7f35-155">Do not set the **localizationDisplayId** attribute if you define a new **controlAccessRight** object.</span></span>

 

