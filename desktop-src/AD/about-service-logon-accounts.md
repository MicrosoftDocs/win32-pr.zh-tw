---
title: 關於服務登入帳戶
description: 以 Win32 為基礎的服務啟動時，會登入本機電腦。
ms.assetid: 637ad0c0-118f-43e8-9d21-a93f6886f546
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 328b33d5dab36ccc5a803eb7c43ca3112e96ecf8
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/17/2020
ms.locfileid: "104092613"
---
# <a name="about-service-logon-accounts"></a><span data-ttu-id="25a78-103">關於服務登入帳戶</span><span class="sxs-lookup"><span data-stu-id="25a78-103">About Service Logon Accounts</span></span>

<span data-ttu-id="25a78-104">以 Win32 為基礎的服務啟動時，會登入本機電腦。</span><span class="sxs-lookup"><span data-stu-id="25a78-104">When a Win32-based service starts, it logs on to the local computer.</span></span> <span data-ttu-id="25a78-105">可以用下列方式登入：</span><span class="sxs-lookup"><span data-stu-id="25a78-105">It can log on as:</span></span>

-   <span data-ttu-id="25a78-106">本機或網域使用者帳戶。</span><span class="sxs-lookup"><span data-stu-id="25a78-106">A local or domain user account.</span></span>
-   <span data-ttu-id="25a78-107">LocalSystem 帳戶。</span><span class="sxs-lookup"><span data-stu-id="25a78-107">The LocalSystem account.</span></span>

<span data-ttu-id="25a78-108">登入帳戶會在執行時間決定服務的安全性識別，也就是服務的主要安全性內容。</span><span class="sxs-lookup"><span data-stu-id="25a78-108">The logon account determines the security identity of the service at run time, that is, the service's primary security context.</span></span> <span data-ttu-id="25a78-109">安全性內容會決定服務存取本機和網路資源的能力。</span><span class="sxs-lookup"><span data-stu-id="25a78-109">The security context determines the service's ability to access local and network resources.</span></span> <span data-ttu-id="25a78-110">例如，在本機使用者帳戶的安全性內容中執行的服務無法存取網路資源。</span><span class="sxs-lookup"><span data-stu-id="25a78-110">For example, a service running in the security context of a local user account cannot access network resources.</span></span> <span data-ttu-id="25a78-111">相反地，在 Windows 2000 網域控制站 (DC) 的 LocalSystem 帳戶安全性內容中執行的服務，將不受限制地存取 DC。</span><span class="sxs-lookup"><span data-stu-id="25a78-111">Conversely, a service running in the security context of the LocalSystem account on a Windows 2000 domain controller (DC), would have unrestricted access to the DC.</span></span> <span data-ttu-id="25a78-112">如需詳細資訊，以及使用者帳戶和 LocalSystem 之間的優點和限制的討論，請參閱 [安全性內容和 Active Directory Domain Services](security-contexts-and-active-directory-domain-services.md)。</span><span class="sxs-lookup"><span data-stu-id="25a78-112">For more information, and a discussion of the benefits and limitations between user accounts and LocalSystem, see [Security Contexts and Active Directory Domain Services](security-contexts-and-active-directory-domain-services.md).</span></span>

<span data-ttu-id="25a78-113">最後，安裝服務的系統管理員可以控制服務的登入帳戶。</span><span class="sxs-lookup"><span data-stu-id="25a78-113">Ultimately, administrators on the system where the service is installed have control over the service's logon account.</span></span> <span data-ttu-id="25a78-114">基於安全性理由，某些系統管理員可能不允許您在 LocalSystem 帳戶下安裝您的服務。</span><span class="sxs-lookup"><span data-stu-id="25a78-114">For security reasons, some administrators may not allow you to install your service under the LocalSystem account.</span></span> <span data-ttu-id="25a78-115">您的服務必須能夠以網域使用者帳戶執行。</span><span class="sxs-lookup"><span data-stu-id="25a78-115">Your service must be able to run under a domain user account.</span></span> <span data-ttu-id="25a78-116">如果您是程式設計人員，您可以對服務的登入帳戶執行一些控制權。</span><span class="sxs-lookup"><span data-stu-id="25a78-116">As a programmer, you can exercise some control over your service's logon account.</span></span> <span data-ttu-id="25a78-117">您的服務安裝程式會在呼叫 [**CreateService**](/windows/desktop/api/winsvc/nf-winsvc-createservicea) 函式時，指定服務的登入帳戶，以在主機電腦上安裝服務。</span><span class="sxs-lookup"><span data-stu-id="25a78-117">Your service installer specifies the service's logon account when it calls the [**CreateService**](/windows/desktop/api/winsvc/nf-winsvc-createservicea) function to install the service on a host computer.</span></span> <span data-ttu-id="25a78-118">您的安裝程式可以建議預設的登入帳戶，但它應該允許系統管理員指定實際的帳戶。</span><span class="sxs-lookup"><span data-stu-id="25a78-118">Your installer can suggest a default logon account, but it should allow an administrator to specify the actual account.</span></span>

<span data-ttu-id="25a78-119">您的安裝程式也可以執行與服務登入帳戶相關的下列工作：</span><span class="sxs-lookup"><span data-stu-id="25a78-119">Your installer can also perform the following tasks relating to your service's logon account:</span></span>

-   <span data-ttu-id="25a78-120">安裝。</span><span class="sxs-lookup"><span data-stu-id="25a78-120">Installation.</span></span> <span data-ttu-id="25a78-121">如果您的服務是在使用者帳戶下執行，則帳戶必須存在，才能呼叫 [**CreateService**](/windows/desktop/api/winsvc/nf-winsvc-createservicea)。</span><span class="sxs-lookup"><span data-stu-id="25a78-121">If installing your service to run under a user account, the account must exist before you call [**CreateService**](/windows/desktop/api/winsvc/nf-winsvc-createservicea).</span></span> <span data-ttu-id="25a78-122">您可以使用現有的帳戶，或在主機電腦的 installrt 中建立一個帳戶。</span><span class="sxs-lookup"><span data-stu-id="25a78-122">You can use an existing account or create one as part of the host-computer installrt.</span></span> <span data-ttu-id="25a78-123">如需詳細資訊，請參閱 [設定服務的使用者帳戶](setting-up-a-serviceampaposs-user-account.md)。</span><span class="sxs-lookup"><span data-stu-id="25a78-123">For more information, see [Setting up a Service's User Account](setting-up-a-serviceampaposs-user-account.md).</span></span>
-   <span data-ttu-id="25a78-124">驗證。</span><span class="sxs-lookup"><span data-stu-id="25a78-124">Authentication.</span></span> <span data-ttu-id="25a78-125">如果您想要讓用戶端使用 Kerberos 相互驗證，請在服務的登入帳戶上註冊 Spn。</span><span class="sxs-lookup"><span data-stu-id="25a78-125">If you want clients to use Kerberos mutual authentication, register the SPNs on the service's logon account.</span></span> <span data-ttu-id="25a78-126">如果服務是以 LocalSystem 帳戶執行，服務的登入帳戶就是主機電腦的電腦帳戶。</span><span class="sxs-lookup"><span data-stu-id="25a78-126">If the service runs under the LocalSystem account, the service's logon account is the computer account of the host computer.</span></span> <span data-ttu-id="25a78-127">如需詳細資訊，請參閱[服務主體名稱](service-principal-names.md)。</span><span class="sxs-lookup"><span data-stu-id="25a78-127">For more information, see [Service Principal Names](service-principal-names.md).</span></span>
-   <span data-ttu-id="25a78-128">授與存取權。</span><span class="sxs-lookup"><span data-stu-id="25a78-128">Grant Access.</span></span> <span data-ttu-id="25a78-129">確定服務在執行時間具有執行其工作所需的存取權和許可權。</span><span class="sxs-lookup"><span data-stu-id="25a78-129">Ensure that the service at run time has the access rights and privileges that it requires to perform its tasks.</span></span> <span data-ttu-id="25a78-130">這可能需要在各種資源（也就是目錄物件、檔案共用等）的安全描述項中，設定 (Ace) 的存取控制專案，以允許使用者或電腦帳戶的必要存取權限。</span><span class="sxs-lookup"><span data-stu-id="25a78-130">This can require setting access-control entries (ACEs) in the security descriptors of various resources, that is directory objects, file shares, and so on, to allow the necessary access rights to the user or computer account.</span></span> <span data-ttu-id="25a78-131">如需詳細資訊，請參閱授 [與服務登入帳戶的存取](granting-access-rights-to-the-service-logon-account.md)權。</span><span class="sxs-lookup"><span data-stu-id="25a78-131">For more information, see [Granting Access Rights to the Service Logon Account](granting-access-rights-to-the-service-logon-account.md).</span></span>
-   <span data-ttu-id="25a78-132">設定許可權。</span><span class="sxs-lookup"><span data-stu-id="25a78-132">Set Privileges.</span></span> <span data-ttu-id="25a78-133">指派許可權給指定的登入帳戶，例如以服務方式登入主機電腦的許可權。</span><span class="sxs-lookup"><span data-stu-id="25a78-133">Assign privileges to the specified logon account, such as the right to logon as a service to the host computer.</span></span> <span data-ttu-id="25a78-134">如需詳細資訊，請參閱 [主機電腦上的授與以服務方式登入許可權](granting-logon-as-service-right-on-the-host-computer.md)。</span><span class="sxs-lookup"><span data-stu-id="25a78-134">For more information, see [Granting Logon as Service Right on the Host Computer](granting-logon-as-service-right-on-the-host-computer.md).</span></span>

<span data-ttu-id="25a78-135">安裝服務之後，會有與您的服務登入帳戶相關的維護工作。</span><span class="sxs-lookup"><span data-stu-id="25a78-135">After a service is installed, there are maintenance tasks that relate to your service logon account.</span></span> <span data-ttu-id="25a78-136">如需詳細資訊，請參閱 [登入帳戶維護](logon-account-maintenance-tasks.md)工作。</span><span class="sxs-lookup"><span data-stu-id="25a78-136">For more information, see [Logon Account Maintenance Tasks](logon-account-maintenance-tasks.md).</span></span>

-   <span data-ttu-id="25a78-137">密碼維護。</span><span class="sxs-lookup"><span data-stu-id="25a78-137">Password maintenance.</span></span> <span data-ttu-id="25a78-138">對於在使用者帳戶下執行的服務，您必須定期變更密碼，並將密碼與一或多個本機服務控制管理員用來啟動服務的密碼保持同步。</span><span class="sxs-lookup"><span data-stu-id="25a78-138">For a service that runs under a user account, you must periodically change the password and keep the password in sync with the password used by one or more local service control managers to start the service.</span></span>
-   <span data-ttu-id="25a78-139">SPN 維護。</span><span class="sxs-lookup"><span data-stu-id="25a78-139">SPN maintenance.</span></span> <span data-ttu-id="25a78-140">如果服務登入帳戶變更，請移除舊帳戶上所註冊的 Spn，並在新帳戶上註冊。</span><span class="sxs-lookup"><span data-stu-id="25a78-140">If a service logon account changes, remove the SPNs registered on the old account and register them on the new account.</span></span> <span data-ttu-id="25a78-141">請注意，安裝服務時，網域系統管理員可以變更您的服務執行所使用的帳戶;使用「電腦管理」系統管理工具的 Win32 函數或使用者介面。</span><span class="sxs-lookup"><span data-stu-id="25a78-141">Be aware that when a service is installed, a domain administrator can change the account under which your service runs; use Win32 functions or the user interface of the Computer Management administrative tool.</span></span>
-   <span data-ttu-id="25a78-142">ACE 維護。</span><span class="sxs-lookup"><span data-stu-id="25a78-142">ACE maintenance.</span></span> <span data-ttu-id="25a78-143">如果服務登入帳戶變更，您需要更新 Ace 和群組成員資格，以確保服務仍然可以存取所需的資源。</span><span class="sxs-lookup"><span data-stu-id="25a78-143">If a service logon account changes, you need to update ACEs and group memberships to ensure that the service can still access the necessary resources.</span></span>

 

 