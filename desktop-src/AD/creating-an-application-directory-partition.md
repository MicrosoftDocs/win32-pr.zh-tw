---
title: 建立應用程式目錄分割
description: 應用程式目錄分割是由 domainDNS 物件代表，其 instanceType 屬性值為 DS \_ instanceType \_ \_ \_ 。 nc HEAD 與 ds instanceType nc 的組合 \_ \_ \_ 是可 \_ 寫入的。
ms.assetid: 5e90f316-9d67-484d-98b8-0632dd3c2c43
ms.tgt_platform: multiple
keywords:
- 建立應用程式目錄分割廣告
- 應用程式目錄分割廣告，建立
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9a17471696825179b6e49230b5168abbaf88b8e2
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/17/2020
ms.locfileid: "104462897"
---
# <a name="creating-an-application-directory-partition"></a><span data-ttu-id="5894a-105">建立應用程式目錄分割</span><span class="sxs-lookup"><span data-stu-id="5894a-105">Creating an Application Directory Partition</span></span>

<span data-ttu-id="5894a-106">應用程式目錄分割是由 [**domainDNS**](/windows/desktop/ADSchema/c-domaindns) 物件代表，其 [**instanceType**](/windows/desktop/ADSchema/a-instancetype) 屬性值為 **ds InstanceType。 \_ \_ \_ nc \_ HEAD** 與 **ds instanceType nc 的組合 \_ \_ \_ 是可 \_ 寫入** 的。</span><span class="sxs-lookup"><span data-stu-id="5894a-106">An application directory partition is represented by a [**domainDNS**](/windows/desktop/ADSchema/c-domaindns) object with an [**instanceType**](/windows/desktop/ADSchema/a-instancetype) attribute value of **DS\_INSTANCETYPE\_IS\_NC\_HEAD** combined with **DS\_INSTANCETYPE\_NC\_IS\_WRITEABLE**.</span></span> <span data-ttu-id="5894a-107">這個 **domainDNS** 物件代表應用程式目錄分割根目錄 (NC head) ，其命名類似一般網域分割區，例如 "DC = DYNAMICDATA，DC = FABRIKAM，DC = com"，其對應至 DNS 名稱 "dynamicdata.fabrikam.com"。</span><span class="sxs-lookup"><span data-stu-id="5894a-107">This **domainDNS** object represents the application directory partition root (NC head), and is named similar to a regular domain partition, for example, "DC=dynamicdata,DC=fabrikam,DC=com", which corresponds to a DNS name of "dynamicdata.fabrikam.com".</span></span> <span data-ttu-id="5894a-108">因此，應用程式目錄分割可以在可具現化網域分割區的任何地方具現化。</span><span class="sxs-lookup"><span data-stu-id="5894a-108">An application directory partition can, therefore, be instantiated anywhere a domain partition can be instantiated.</span></span> <span data-ttu-id="5894a-109">沒有與應用程式目錄分割相關聯的 NetBIOS 名稱。</span><span class="sxs-lookup"><span data-stu-id="5894a-109">There is no NetBIOS name associated with an application directory partition.</span></span>

<span data-ttu-id="5894a-110">您可以嵌套應用程式目錄分割，也就是應用程式目錄分割可以有子應用程式目錄分割。</span><span class="sxs-lookup"><span data-stu-id="5894a-110">It is possible to nest application directory partitions, that is, an application directory partition can have child application directory partitions.</span></span> <span data-ttu-id="5894a-111">使用根目錄在應用程式目錄分割前端之子樹範圍的搜尋，將會產生子應用程式目錄分割的接續參考。</span><span class="sxs-lookup"><span data-stu-id="5894a-111">Searches with subtree scope rooted at an application directory partition head will generate continuation references to the child application directory partitions.</span></span>

<span data-ttu-id="5894a-112">只有當 Windows Server 2003 和更新版本的網域控制站持有 Domain-Naming FSMO 角色時，才能在 Windows Server 2003 和更新版本上執行的網域控制站上建立應用程式目錄分割複本。</span><span class="sxs-lookup"><span data-stu-id="5894a-112">An application directory partition replica can only be created on a domain controller that is running on Windows Server 2003 and later and only while the Domain-Naming FSMO role is held by a Windows Server 2003 and later domain controller.</span></span> <span data-ttu-id="5894a-113">在同時具有 Windows Server 2003 網域控制站和下層網域控制站 (Windows 2000 網域控制站或 Windows NT 4.0 網域主控站) 的混合樹系中，嘗試在下層網域控制站上建立應用程式目錄分割複本將會失敗。</span><span class="sxs-lookup"><span data-stu-id="5894a-113">In a mixed forest that has both Windows Server 2003 domain controllers and down-level domain controllers (Windows 2000 domain controllers or Windows NT 4.0 primary domain controllers), an attempt to create an application directory partition replica on a down-level domain controller will fail.</span></span>

<span data-ttu-id="5894a-114">應用程式目錄分割在設定分割區的分割區容器中也有對應的 [**交叉引用**](/windows/desktop/ADSchema/c-crossref) 物件。</span><span class="sxs-lookup"><span data-stu-id="5894a-114">An application directory partition also has a corresponding [**crossRef**](/windows/desktop/ADSchema/c-crossref) object in the Partitions container of the configuration partition.</span></span> <span data-ttu-id="5894a-115">您可以在建立 [**domainDNS**](/windows/desktop/ADSchema/c-domaindns)物件之前，手動預先建立 **交叉引用**。</span><span class="sxs-lookup"><span data-stu-id="5894a-115">The **crossRef** can be pre-created manually before creating the [**domainDNS**](/windows/desktop/ADSchema/c-domaindns) object.</span></span> <span data-ttu-id="5894a-116">預先建立的 **交叉引用** 物件必須具有下表所示的屬性值，否則資料分割建立將會失敗。</span><span class="sxs-lookup"><span data-stu-id="5894a-116">The pre-created **crossRef** object must have the attribute values shown in the following table or the partition creation will fail.</span></span> <span data-ttu-id="5894a-117">如果 **交叉引用** 物件不存在，則在建立應用程式目錄分割時，Active Directory 伺服器會建立一個。</span><span class="sxs-lookup"><span data-stu-id="5894a-117">If the **crossRef** object does not exist, the Active Directory server will create one when the application directory partition is created.</span></span>

| <span data-ttu-id="5894a-118">屬性</span><span class="sxs-lookup"><span data-stu-id="5894a-118">Attribute</span></span>                          | <span data-ttu-id="5894a-119">描述</span><span class="sxs-lookup"><span data-stu-id="5894a-119">Description</span></span>                                                                                                                               |
|------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="5894a-120">**dnsRoot**</span><span class="sxs-lookup"><span data-stu-id="5894a-120">**dnsRoot**</span></span>](/windows/desktop/ADSchema/a-dnsroot) | <span data-ttu-id="5894a-121">包含將建立應用程式目錄分割之網域控制站的 DNS 路徑。</span><span class="sxs-lookup"><span data-stu-id="5894a-121">Contains the DNS path of the domain controller that the application directory partition will be created on.</span></span>                               |
| [<span data-ttu-id="5894a-122">**啟用**</span><span class="sxs-lookup"><span data-stu-id="5894a-122">**Enabled**</span></span>](/windows/desktop/ADSchema/a-enabled) | <span data-ttu-id="5894a-123">包含 **FALSE**。</span><span class="sxs-lookup"><span data-stu-id="5894a-123">Contains **FALSE**.</span></span>                                                                                                                       |
| [<span data-ttu-id="5894a-124">**nCName**</span><span class="sxs-lookup"><span data-stu-id="5894a-124">**nCName**</span></span>](/windows/desktop/ADSchema/a-ncname)   | <span data-ttu-id="5894a-125">包含分割區的分辨名稱。</span><span class="sxs-lookup"><span data-stu-id="5894a-125">Contains the distinguished name of the partition.</span></span> <span data-ttu-id="5894a-126">在上述範例中，此屬性會包含 "DC = dynamicdata，DC = mydomain，DC = com"。</span><span class="sxs-lookup"><span data-stu-id="5894a-126">In the example above, this attribute would contain "DC=dynamicdata,DC=mydomain,DC=com".</span></span> |



 

<span data-ttu-id="5894a-127">**若要使用其第一個複本建立新的應用程式目錄分割，請執行下列步驟**</span><span class="sxs-lookup"><span data-stu-id="5894a-127">**To create a new application directory partition with its first replica, perform the following steps**</span></span>

1.  <span data-ttu-id="5894a-128">系結至新磁碟分割的命名空間，並指定將在 ADsPath 中裝載應用程式目錄分割的網域控制站。</span><span class="sxs-lookup"><span data-stu-id="5894a-128">Bind to the namespace for the new partition, specifying the domain controller that will host the application directory partition in the ADsPath.</span></span> <span data-ttu-id="5894a-129">例如，若要建立具有 ADsPath "DC = dynamicdata，DC = mydomain，DC = com" 的分割區，系結 ADsPath 會是 "LDAP:// <domain controller> /DC = mydomain，dc = com"，其中 " &lt; domain controller &gt; " 是將裝載分割區之網域控制站的 DNS 名稱。</span><span class="sxs-lookup"><span data-stu-id="5894a-129">For example, to create a partition with an ADsPath of "DC=dynamicdata,DC=mydomain,DC=com", the binding ADsPath would be "LDAP://<domain controller>/DC=mydomain,DC=com", where "&lt;domain controller&gt;" is the DNS name of the domain controller that will host the partition.</span></span>

    <span data-ttu-id="5894a-130">系結作業必須指定 [快速] 和 [委派] 選項。</span><span class="sxs-lookup"><span data-stu-id="5894a-130">The bind operation must specify the fast and delegation options.</span></span> <span data-ttu-id="5894a-131">[快速] 選項可讓系結成功，即使命名空間不存在也一樣。</span><span class="sxs-lookup"><span data-stu-id="5894a-131">The fast option allows the bind to succeed even if the namespace does not exist.</span></span> <span data-ttu-id="5894a-132">需要委派選項，才能讓網域控制站使用相同的認證來與 Domain-Naming FSMO 角色持有者聯繫。</span><span class="sxs-lookup"><span data-stu-id="5894a-132">The delegation option is required to allow the domain controller to contact the Domain-Naming FSMO role holder using the same credentials.</span></span>

    <span data-ttu-id="5894a-133">網域控制站的系統版本必須是 Windows Server 2003 作業系統和更新版本。</span><span class="sxs-lookup"><span data-stu-id="5894a-133">The system version of the domain controller must be Windows Server 2003 operating system and later.</span></span>

2.  <span data-ttu-id="5894a-134">使用適當的資料分割名稱建立 [**domainDNS**](/windows/desktop/ADSchema/c-domaindns) 物件，例如 "DC = dynamicdata"，以代表新分割區的命名內容標頭。</span><span class="sxs-lookup"><span data-stu-id="5894a-134">Create a [**domainDNS**](/windows/desktop/ADSchema/c-domaindns) object with an appropriate name for the partition, for example, "DC=dynamicdata", to represent the naming context head for the new partition.</span></span> <span data-ttu-id="5894a-135">**DomainDNS** 物件必須具有值為5的 [**instanceType**](/windows/desktop/ADSchema/a-instancetype)屬性 (**DS \_ instanceType \_ 是 \_ nc \_** 前端 \| **ds \_ instanceType \_ nc \_ 是可 \_ 寫入的**) 。</span><span class="sxs-lookup"><span data-stu-id="5894a-135">The **domainDNS** object must have an [**instanceType**](/windows/desktop/ADSchema/a-instancetype) attribute with a value of 5 (**DS\_INSTANCETYPE\_IS\_NC\_HEAD** \| **DS\_INSTANCETYPE\_NC\_IS\_WRITEABLE**).</span></span> <span data-ttu-id="5894a-136">**InstanceType** 屬性只能在建立時設定，因為它是僅限系統的屬性。</span><span class="sxs-lookup"><span data-stu-id="5894a-136">The **instanceType** attribute can only be set at creation time because it is a system-only attribute.</span></span>

<span data-ttu-id="5894a-137">建立 [**domainDNS**](/windows/desktop/ADSchema/c-domaindns) 物件時，Active Directory 伺服器將執行下列步驟：</span><span class="sxs-lookup"><span data-stu-id="5894a-137">When the [**domainDNS**](/windows/desktop/ADSchema/c-domaindns) object is created, the Active Directory server will perform the following steps:</span></span>

1.  <span data-ttu-id="5894a-138">搜尋分割區容器中具有與分割區辨別名稱相符的 [**nCName**](/windows/desktop/ADSchema/a-ncname)屬性值的 [**交叉引用**](/windows/desktop/ADSchema/c-crossref)物件，如果找到相符的專案，則修改 **交叉引用** 物件以代表應用程式目錄分割。</span><span class="sxs-lookup"><span data-stu-id="5894a-138">Searches for a [**crossRef**](/windows/desktop/ADSchema/c-crossref) object in the Partitions container that has an [**nCName**](/windows/desktop/ADSchema/a-ncname) attribute value that matches the distinguished name of the partition and, if a match is found, modifies the **crossRef** object to represent the application directory partition.</span></span> <span data-ttu-id="5894a-139">如果找不到相符的 **交叉引用** 物件，Active Directory 伺服器會建立新的 **交叉引用** 物件，以代表應用程式目錄分割。</span><span class="sxs-lookup"><span data-stu-id="5894a-139">If a matching **crossRef** object is not found, the Active Directory server creates a new **crossRef** object to represent the application directory partition.</span></span>

    <span data-ttu-id="5894a-140">下表列出 [**交叉引用**](/windows/desktop/ADSchema/c-crossref) 物件的重要屬性。</span><span class="sxs-lookup"><span data-stu-id="5894a-140">The following table lists important attributes of the [**crossRef**](/windows/desktop/ADSchema/c-crossref) object.</span></span>

    | <span data-ttu-id="5894a-141">屬性</span><span class="sxs-lookup"><span data-stu-id="5894a-141">Attribute</span></span>                                                              | <span data-ttu-id="5894a-142">描述</span><span class="sxs-lookup"><span data-stu-id="5894a-142">Description</span></span>                                                                                                                                        |
    |------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------|
    | [<span data-ttu-id="5894a-143">**nCName**</span><span class="sxs-lookup"><span data-stu-id="5894a-143">**nCName**</span></span>](/windows/desktop/ADSchema/a-ncname)                                       | <span data-ttu-id="5894a-144">包含分割區的分辨名稱。</span><span class="sxs-lookup"><span data-stu-id="5894a-144">Contains the distinguished name of the partition.</span></span>                                                                                                  |
    | [<span data-ttu-id="5894a-145">**dnsRoot**</span><span class="sxs-lookup"><span data-stu-id="5894a-145">**dnsRoot**</span></span>](/windows/desktop/ADSchema/a-dnsroot)                                     | <span data-ttu-id="5894a-146">包含資料分割的 DNS 名稱。</span><span class="sxs-lookup"><span data-stu-id="5894a-146">Contains the DNS name of the partition.</span></span>                                                                                                            |
    | [<span data-ttu-id="5894a-147">**高階 NC-複本-位置**</span><span class="sxs-lookup"><span data-stu-id="5894a-147">**msDS-NC-Replica-Locations**</span></span>](/windows/desktop/ADSchema/a-msds-nc-replica-locations) | <span data-ttu-id="5894a-148">第一個複本之網域控制站的 [**nTDSDSA**](/windows/desktop/ADSchema/c-ntdsdsa) 物件的辨別名稱會新增至此屬性。</span><span class="sxs-lookup"><span data-stu-id="5894a-148">The distinguished name of the [**nTDSDSA**](/windows/desktop/ADSchema/c-ntdsdsa) object of the domain controller for the first replica is added to this attribute.</span></span> |

    

     

2.  <span data-ttu-id="5894a-149">起始設定分割區的同步處理，並等候完成。</span><span class="sxs-lookup"><span data-stu-id="5894a-149">Initiate a synchronization of the configuration partition and wait for completion.</span></span> <span data-ttu-id="5894a-150">這可讓用戶端應用程式在系結至用來建立應用程式目錄分割的相同網域控制站時，修改新建立的應用程式目錄分割的設定參數。</span><span class="sxs-lookup"><span data-stu-id="5894a-150">This enables the client application to modify configuration parameters for the newly created application directory partition while bound to the same domain controller used for creating the application directory partition.</span></span>
3.  <span data-ttu-id="5894a-151">使用 DS INSTANCETYPE 建立 [**domainDNS**](/windows/desktop/ADSchema/c-domaindns) 物件 **\_ \_ 是 \_ NC \_ HEAD** ， **ds \_ INSTANCETYPE \_ NC 是 \_ \_** [**INSTANCETYPE**](/windows/desktop/ADSchema/a-instancetype) 屬性上設定的可寫入旗標。</span><span class="sxs-lookup"><span data-stu-id="5894a-151">Create the [**domainDNS**](/windows/desktop/ADSchema/c-domaindns) object with the **DS\_INSTANCETYPE\_IS\_NC\_HEAD** and **DS\_INSTANCETYPE\_NC\_IS\_WRITEABLE** flags set on the [**instanceType**](/windows/desktop/ADSchema/a-instancetype) property.</span></span> <span data-ttu-id="5894a-152">**InstanceType** 屬性也可以包含其他私用旗標。</span><span class="sxs-lookup"><span data-stu-id="5894a-152">The **instanceType** property may contain other, private flags as well.</span></span>
4.  <span data-ttu-id="5894a-153">使用新建立的應用程式目錄分割的辨別名稱，在目標網域控制站的 [**nTDSDSA**](/windows/desktop/ADSchema/c-ntdsdsa)物件中填入 [**nc 的 ms-chap**](/windows/desktop/ADSchema/a-msds-hasmasterncs)屬性。</span><span class="sxs-lookup"><span data-stu-id="5894a-153">Populate the [**ms-DS-Has-Master-NCs**](/windows/desktop/ADSchema/a-msds-hasmasterncs) attribute of the [**nTDSDSA**](/windows/desktop/ADSchema/c-ntdsdsa) object for the target domain controller with the distinguished name of the newly created application directory partition.</span></span>

<span data-ttu-id="5894a-154">當您建立應用程式目錄分割，或是新增並完全同步處理應用程式目錄分割的新複本時，Active Directory 伺服器會正確地向 NetLogon 和 DNS 註冊複本。</span><span class="sxs-lookup"><span data-stu-id="5894a-154">When the application directory partition is created, or when a new replica of the application directory partition is added and fully synchronized, the Active Directory server correctly registers the replica with NetLogon and DNS.</span></span> <span data-ttu-id="5894a-155">如需詳細資訊和已註冊的 SRV 記錄清單，請參閱 [尋找應用程式目錄磁碟分割主機伺服器](locating-an-application-directory-partition-host-server.md)。</span><span class="sxs-lookup"><span data-stu-id="5894a-155">For more information, and a list of the registered SRV records, see [Locating an Application Directory Partition Host Server](locating-an-application-directory-partition-host-server.md).</span></span>

<span data-ttu-id="5894a-156">如需建立應用程式目錄分割的詳細資訊，請參閱 [建立應用程式目錄分割的範例程式碼](example-code-for-creating-an-application-directory-partition.md)。</span><span class="sxs-lookup"><span data-stu-id="5894a-156">For more information about creating an application directory partition, see [Example Code for Creating an Application Directory Partition](example-code-for-creating-an-application-directory-partition.md).</span></span>

## <a name="locating-the-partitions-container"></a><span data-ttu-id="5894a-157">尋找磁碟分割容器</span><span class="sxs-lookup"><span data-stu-id="5894a-157">Locating the Partitions Container</span></span>

<span data-ttu-id="5894a-158">您可以透過下列兩種方式之一來找到分割區容器的分辨名稱。</span><span class="sxs-lookup"><span data-stu-id="5894a-158">The distinguished name of the Partitions container can be found in one of two ways.</span></span> <span data-ttu-id="5894a-159">第一個是更複雜的執行，但一律會提供精確的結果：</span><span class="sxs-lookup"><span data-stu-id="5894a-159">The first is more complicated to perform, but will always provide an accurate result:</span></span>

1.  <span data-ttu-id="5894a-160">系結至 RootDSE 並取得 **configurationNamingCoNtext** 屬性。</span><span class="sxs-lookup"><span data-stu-id="5894a-160">Bind to RootDSE and obtain the **configurationNamingContext** attribute.</span></span>
2.  <span data-ttu-id="5894a-161">使用 **configurationNamingCoNtext** 屬性系結至設定容器。</span><span class="sxs-lookup"><span data-stu-id="5894a-161">Use the **configurationNamingContext** attribute to bind to the configuration container.</span></span>
3.  <span data-ttu-id="5894a-162">在 configuration 容器中搜尋屬於 [**crossRefContainer**](/windows/desktop/ADSchema/c-crossrefcontainer) 類型的物件。</span><span class="sxs-lookup"><span data-stu-id="5894a-162">Search in the configuration container for an object that is of the [**crossRefContainer**](/windows/desktop/ADSchema/c-crossrefcontainer) type.</span></span>
4.  <span data-ttu-id="5894a-163">取得 [**crossRefContainer**](/windows/desktop/ADSchema/c-crossrefcontainer)物件的 **distinguishedName** 屬性值。</span><span class="sxs-lookup"><span data-stu-id="5894a-163">Obtain the **distinguishedName** attribute value of the [**crossRefContainer**](/windows/desktop/ADSchema/c-crossrefcontainer) object.</span></span> <span data-ttu-id="5894a-164">這會是分割區容器的分辨名稱。</span><span class="sxs-lookup"><span data-stu-id="5894a-164">This will be the distinguished name of the Partitions container.</span></span>

<span data-ttu-id="5894a-165">如需詳細資訊和示範此方法來尋找分割區容器的程式碼範例，請參閱尋找分割區 [容器的範例程式碼](example-code-for-locating-the-partitions-container.md)中的 **GetPartitionsDNSearch** 函數。</span><span class="sxs-lookup"><span data-stu-id="5894a-165">For more information and a code example that shows this method for locating the Partitions container, see the **GetPartitionsDNSearch** function in [Example Code for Locating the Partitions Container](example-code-for-locating-the-partitions-container.md).</span></span>

<span data-ttu-id="5894a-166">第二個方法比較簡單，但依賴具有特定相對辨別名稱的分割區容器。</span><span class="sxs-lookup"><span data-stu-id="5894a-166">The second method is easier to implement, but relies on the Partitions container having a particular relative distinguished name.</span></span> <span data-ttu-id="5894a-167">目前不可能變更分割區容器的名稱，但如果未來加入這項功能，如果已重新命名分割區容器，則下列程式將無法正確運作。</span><span class="sxs-lookup"><span data-stu-id="5894a-167">It is not currently possible to change the name of the Partitions container, but if this capability is added in the future, the procedure below will not work correctly if the Partitions container has been renamed.</span></span>

1.  <span data-ttu-id="5894a-168">系結至 RootDSE 並取得 **configurationNamingCoNtext** 屬性。</span><span class="sxs-lookup"><span data-stu-id="5894a-168">Bind to RootDSE and obtain the **configurationNamingContext** attribute.</span></span>
2.  <span data-ttu-id="5894a-169">合併字串 "CN = 分割區"，後面接著 **configurationNamingCoNtext** 屬性，以形成分割區容器的分辨名稱。</span><span class="sxs-lookup"><span data-stu-id="5894a-169">Combine the string "CN=Partitions," followed by the **configurationNamingContext** attribute to form the distinguished name of the Partitions container.</span></span> <span data-ttu-id="5894a-170">辨別名稱的格式會是 "CN = 磁碟分割" <configuration DN> 。</span><span class="sxs-lookup"><span data-stu-id="5894a-170">The distinguished name will be in the form "CN=Partitions,<configuration DN>".</span></span>

<span data-ttu-id="5894a-171">如需詳細資訊和示範此方法來尋找分割區容器的程式碼範例，請參閱尋找分割區 [容器的範例程式碼](example-code-for-locating-the-partitions-container.md)中的 **GetPartitionsDNManual** 函數。</span><span class="sxs-lookup"><span data-stu-id="5894a-171">For more information and a code example that shows this method for locating the Partitions container, see the **GetPartitionsDNManual** function in [Example Code for Locating the Partitions Container](example-code-for-locating-the-partitions-container.md).</span></span>

 

 