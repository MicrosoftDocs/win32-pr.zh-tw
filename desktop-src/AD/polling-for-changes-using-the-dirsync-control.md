---
title: 使用 DirSync 控制項輪詢變更
description: Active Directory 目錄同步作業 (DirSync) control 是一種 LDAP 伺服器延伸，可讓應用程式在目錄磁碟分割中搜尋自從先前狀態以來已變更的物件。
ms.assetid: f77caeb3-bfc9-4ae6-8d1d-73f4ee554336
ms.tgt_platform: multiple
keywords:
- 使用 DirSync Control AD 輪詢變更
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8c3d105757d39bc25bd10df21ab68c4d1d1202be
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/17/2020
ms.locfileid: "103681650"
---
# <a name="polling-for-changes-using-the-dirsync-control"></a><span data-ttu-id="db92c-104">使用 DirSync 控制項輪詢變更</span><span class="sxs-lookup"><span data-stu-id="db92c-104">Polling for Changes Using the DirSync Control</span></span>

<span data-ttu-id="db92c-105">Active Directory 目錄同步作業 (DirSync) control 是一種 LDAP 伺服器延伸，可讓應用程式在目錄磁碟分割中搜尋自從先前狀態以來已變更的物件。</span><span class="sxs-lookup"><span data-stu-id="db92c-105">Active Directory directory synchronization (DirSync) control is an LDAP server extension that enables an application to search an directory partition for objects that have changed since a previous state.</span></span>

<span data-ttu-id="db92c-106">使用 [**>idirectorysearch**](/windows/desktop/api/iads/nn-iads-idirectorysearch)時，藉由指定 **ADS \_ SEARCHPREF \_ dirsync** 搜尋喜好設定，在 ADSI 中使用 dirsync 控制項。</span><span class="sxs-lookup"><span data-stu-id="db92c-106">Use the DirSync control through ADSI by specifying the **ADS\_SEARCHPREF\_DIRSYNC** search preference when using [**IDirectorySearch**](/windows/desktop/api/iads/nn-iads-idirectorysearch).</span></span> <span data-ttu-id="db92c-107">如需詳細資訊和程式碼範例，請參閱 [使用 ADS \_ SEARCHPREF \_ DIRSYNC 的範例程式碼](example-code-using-ads-searchpref-dirsync.md)。</span><span class="sxs-lookup"><span data-stu-id="db92c-107">For more information and a code example, see [Example Code Using ADS\_SEARCHPREF\_DIRSYNC](example-code-using-ads-searchpref-dirsync.md).</span></span> <span data-ttu-id="db92c-108">您也可以使用 LDAP API 來執行 DirSync 搜尋。</span><span class="sxs-lookup"><span data-stu-id="db92c-108">You can also perform a DirSync search using the LDAP API.</span></span> <span data-ttu-id="db92c-109">以下描述 ADSI 的執行，其中大部分也適用于直接使用 LDAP，但本主題結尾所討論的除外。</span><span class="sxs-lookup"><span data-stu-id="db92c-109">The following describes the ADSI implementation, most of which also applies to using LDAP directly, except as discussed at the end of this topic.</span></span>

<span data-ttu-id="db92c-110">當您執行 DirSync 搜尋時，會將提供者特定的資料元素傳入 (cookie) ，以識別先前的 DirSync 搜尋時的目錄狀態。</span><span class="sxs-lookup"><span data-stu-id="db92c-110">When you perform a DirSync search, you pass in a provider-specific data element (cookie) that identifies the directory state at the time of the previous DirSync search.</span></span> <span data-ttu-id="db92c-111">在第一次搜尋時，您會傳入 null cookie，且搜尋會傳回符合篩選準則的所有物件。</span><span class="sxs-lookup"><span data-stu-id="db92c-111">For the first search, you pass in a null cookie, and the search returns all objects that match the filter.</span></span> <span data-ttu-id="db92c-112">搜尋也會傳回有效的 cookie。</span><span class="sxs-lookup"><span data-stu-id="db92c-112">The search also returns a valid cookie.</span></span> <span data-ttu-id="db92c-113">將 cookie 儲存在與 Active Directory 伺服器同步處理的相同儲存體中。</span><span class="sxs-lookup"><span data-stu-id="db92c-113">Store the cookie in the same storage that you are synchronizing with the Active Directory server.</span></span> <span data-ttu-id="db92c-114">在後續的搜尋中，從儲存體取得 cookie，並將其傳遞至搜尋要求。</span><span class="sxs-lookup"><span data-stu-id="db92c-114">On subsequent searches, get the cookie from storage and pass it with the search request.</span></span> <span data-ttu-id="db92c-115">搜尋結果現在只會包含在 cookie 所識別的先前狀態之後變更的物件和屬性。</span><span class="sxs-lookup"><span data-stu-id="db92c-115">The search results now include only the objects and attributes that have changed since the previous state identified by the cookie.</span></span> <span data-ttu-id="db92c-116">搜尋也會傳回新的 cookie 來儲存，以供下一個搜尋之用。</span><span class="sxs-lookup"><span data-stu-id="db92c-116">The search also returns a new cookie to store for the next search.</span></span>

<span data-ttu-id="db92c-117">下表列出用戶端搜尋要求可以指定的搜尋參數。</span><span class="sxs-lookup"><span data-stu-id="db92c-117">The following table lists search parameters that the client search request can specify.</span></span>



| <span data-ttu-id="db92c-118">參數</span><span class="sxs-lookup"><span data-stu-id="db92c-118">Parameter</span></span>          | <span data-ttu-id="db92c-119">Description</span><span class="sxs-lookup"><span data-stu-id="db92c-119">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|--------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="db92c-120">搜尋的基底</span><span class="sxs-lookup"><span data-stu-id="db92c-120">Base of the search</span></span> | <span data-ttu-id="db92c-121">DirSync 搜尋的基底必須是目錄分割的根目錄（可以是網域磁碟分割、設定磁碟分割或架構磁碟分割）。</span><span class="sxs-lookup"><span data-stu-id="db92c-121">The base of a DirSync search must be the root of a directory partition, which can be a domain partition, the configuration partition, or the schema partition.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| <span data-ttu-id="db92c-122">影響範圍</span><span class="sxs-lookup"><span data-stu-id="db92c-122">Scope</span></span>              | <span data-ttu-id="db92c-123">DirSync 搜尋的範圍必須是 **ADS \_ 範圍 \_ 子樹**，也就是資料分割的整個子樹。</span><span class="sxs-lookup"><span data-stu-id="db92c-123">The scope of a DirSync search must be **ADS\_SCOPE\_SUBTREE**, that is, the entire subtree of the partition.</span></span> <span data-ttu-id="db92c-124">請注意，若要搜尋網域分割區，子樹包含設定和架構分割區的標頭，但不包含內容。</span><span class="sxs-lookup"><span data-stu-id="db92c-124">Be aware that for a search of a domain partition, the subtree includes the heads, but not the contents, of the configuration and schema partitions.</span></span> <span data-ttu-id="db92c-125">若要輪詢較小範圍中的變更，請使用 **USNChanged** 技術，而不是 DirSync。</span><span class="sxs-lookup"><span data-stu-id="db92c-125">To poll for changes in a smaller scope, use the **USNChanged** technique instead of DirSync.</span></span>                                                                                                                                                                                                                                                                                                                                                                                 |
| <span data-ttu-id="db92c-126">篩選</span><span class="sxs-lookup"><span data-stu-id="db92c-126">Filter</span></span>             | <span data-ttu-id="db92c-127">您可以指定任何有效的搜尋篩選準則。</span><span class="sxs-lookup"><span data-stu-id="db92c-127">You can specify any valid search filter.</span></span> <span data-ttu-id="db92c-128">對於具有 null cookie 的初始搜尋，結果會包含符合篩選準則的所有物件。</span><span class="sxs-lookup"><span data-stu-id="db92c-128">For an initial search with a null cookie, the results include all objects that match the filter.</span></span> <span data-ttu-id="db92c-129">針對使用有效 cookie 的後續搜尋，搜尋結果只會包含符合篩選準則的物件資料，並在 cookie 所指示的狀態之後變更。</span><span class="sxs-lookup"><span data-stu-id="db92c-129">For subsequent searches with a valid cookie, the search results include data only for objects that match the filter and have changed since the state indicated by the cookie.</span></span> <span data-ttu-id="db92c-130">如需搜尋篩選準則的詳細資訊，請參閱 [建立查詢篩選器](creating-a-query-filter.md)。</span><span class="sxs-lookup"><span data-stu-id="db92c-130">For more information about search filters, see [Creating a Query Filter](creating-a-query-filter.md).</span></span>                                                                                                                                                                                                                                                                                                                |
| <span data-ttu-id="db92c-131">屬性</span><span class="sxs-lookup"><span data-stu-id="db92c-131">Attributes</span></span>         | <span data-ttu-id="db92c-132">您可以指定在發生變更時要傳回的屬性清單。</span><span class="sxs-lookup"><span data-stu-id="db92c-132">You can specify a list of attributes to be returned when a change occurs.</span></span> <span data-ttu-id="db92c-133">針對每個物件，初始結果會包含在物件上設定的所有要求屬性。</span><span class="sxs-lookup"><span data-stu-id="db92c-133">For each object, the initial results include all the requested attributes set on the object.</span></span> <span data-ttu-id="db92c-134">後續搜尋結果只會包含已變更的指定屬性。</span><span class="sxs-lookup"><span data-stu-id="db92c-134">Subsequent search results include only the specified attributes that have changed.</span></span> <span data-ttu-id="db92c-135">未變更的屬性不會包含在搜尋結果中。</span><span class="sxs-lookup"><span data-stu-id="db92c-135">Unchanged attributes are not included in the search results.</span></span> <span data-ttu-id="db92c-136">在 ADSI 的執行中，搜尋結果一律包含每個物件的 **objectGUID** 和 **instanceType** 。</span><span class="sxs-lookup"><span data-stu-id="db92c-136">In the ADSI implementation, the search results always include the **objectGUID** and **instanceType** of each object.</span></span> <span data-ttu-id="db92c-137">此外，指定的屬性清單也可做為額外的篩選：初始搜尋結果只會包含至少有一個指定屬性集的物件。後續的搜尋只會包含一或多個屬性已變更 (值) 新增或刪除的物件。</span><span class="sxs-lookup"><span data-stu-id="db92c-137">Also, the specified attribute list acts as an additional filter: the initial search results include only objects that have at least one of the specified attributes set; subsequent searches include only objects on which one or more of the attributes have changed (values added or deleted).</span></span> |



 

<span data-ttu-id="db92c-138">此外，請注意：</span><span class="sxs-lookup"><span data-stu-id="db92c-138">Also, be aware that:</span></span>

-   <span data-ttu-id="db92c-139">針對漸進式搜尋，最佳做法是系結至先前搜尋中使用的相同網域控制站 (DC) ，也就是產生 cookie 的 DC。</span><span class="sxs-lookup"><span data-stu-id="db92c-139">For incremental searches, the best practice is to bind to the same domain controller (DC) used in the previous search, that is, the DC that generated the cookie.</span></span> <span data-ttu-id="db92c-140">如果無法使用相同的 DC，請等候它，或系結至新的 DC，然後執行完整的同步處理。</span><span class="sxs-lookup"><span data-stu-id="db92c-140">If the same DC is unavailable, either wait until it is, or bind to a new DC and perform a full synchronization.</span></span> <span data-ttu-id="db92c-141">使用 cookie 在次要儲存體中儲存 DC 的 DNS 名稱。</span><span class="sxs-lookup"><span data-stu-id="db92c-141">Store the DNS name of the DC in the secondary storage with the cookie.</span></span>

    <span data-ttu-id="db92c-142">您可以將一個 DC 所產生的 cookie 傳遞給裝載相同目錄分割複本的不同 DC。</span><span class="sxs-lookup"><span data-stu-id="db92c-142">You can pass a cookie generated by one DC to a different DC hosting a replica of the same directory partition.</span></span> <span data-ttu-id="db92c-143">用戶端不可能會在另一個 DC 上使用某個 DC 的 cookie 來遺漏變更。</span><span class="sxs-lookup"><span data-stu-id="db92c-143">There is no chance that a client will miss changes by using a cookie from one DC on another DC.</span></span> <span data-ttu-id="db92c-144">不過，來自新 DC 的搜尋結果可能會包含舊 DC 所報告的變更;在某些情況下，新的 DC 可能會傳回所有物件和屬性，就像完整的同步處理一樣。</span><span class="sxs-lookup"><span data-stu-id="db92c-144">However, it is possible that the search results from the new DC may include reported changes by the old DC; in some cases, the new DC may return all objects and attributes, as with a full synchronization.</span></span> <span data-ttu-id="db92c-145">用戶端應該只讓其資料庫與針對任何指定 DirSync 呼叫所報告的搜尋結果保持一致，也就是處理所有增量結果，就好像它們是最新的狀態一樣。</span><span class="sxs-lookup"><span data-stu-id="db92c-145">The client should just make its database consistent with reported search results for any given DirSync call, that is, handle all incremental results as if they were the latest state.</span></span> <span data-ttu-id="db92c-146">無論您是否已經看到先前的變更，或甚至回到先前的狀態，因為重複的累加式同步處理將會一致。</span><span class="sxs-lookup"><span data-stu-id="db92c-146">It does not matter whether you have seen the change before or are even going back to a previous state because repeated incremental synchronizations will converge on consistency.</span></span>

-   <span data-ttu-id="db92c-147">當物件重新命名或移動時，其子物件（如果有的話）不會包含在搜尋結果中，即使子物件的辨別名稱已變更也一樣。</span><span class="sxs-lookup"><span data-stu-id="db92c-147">When an object is renamed or moved, its child objects, if any, are not included in the search results, even though the distinguished names of the child objects have changed.</span></span> <span data-ttu-id="db92c-148">同樣地，當物件安全性描述項中的可繼承 ACE 遭到修改時，該物件的子物件不會包含在搜尋結果中，即使子物件的安全性描述項已經變更也一樣。</span><span class="sxs-lookup"><span data-stu-id="db92c-148">Similarly, when an inheritable ACE is modified in an object security-descriptor, the child objects of the object are not included in the search results, even though the security-descriptors of the child objects have changed.</span></span>
-   <span data-ttu-id="db92c-149">使用 **objectGUID** 屬性來識別追蹤的物件。</span><span class="sxs-lookup"><span data-stu-id="db92c-149">Use the **objectGUID** attribute to identify the tracked objects.</span></span> <span data-ttu-id="db92c-150">無論在樹系中移動物件的位置為何，每個物件的 **objectGUID** 都會保持不變。</span><span class="sxs-lookup"><span data-stu-id="db92c-150">The **objectGUID** of each object remains unchanged regardless of where the object is moved within the forest.</span></span>
-   <span data-ttu-id="db92c-151">請注意，DirSync 搜尋的搜尋結果會指出搜尋時目錄分割複本上的物件狀態。</span><span class="sxs-lookup"><span data-stu-id="db92c-151">Be aware that the search results of a DirSync search indicate the state of the objects on a replica of the directory partition at the time of the search.</span></span> <span data-ttu-id="db92c-152">這表示，如果在其他 Dc 上所做的變更尚未複寫到目標 DC，將不會包含這些變更。</span><span class="sxs-lookup"><span data-stu-id="db92c-152">This means that changes made on other DCs will not be included if they have not been replicated to the target DC.</span></span> <span data-ttu-id="db92c-153">這也表示物件的屬性可能會在先前的 DirSync 搜尋之後變更數次，但是搜尋只會顯示最後的狀態，而不會顯示變更的順序。</span><span class="sxs-lookup"><span data-stu-id="db92c-153">It also means that an object's attributes may have changed several times since the previous DirSync search, but the search will show only the final state, not the sequence of changes.</span></span>
-   <span data-ttu-id="db92c-154">在 ADSI 的執行中，應用程式必須將 cookie 處理為不透明，而不會對其內部組織或值做出任何假設。</span><span class="sxs-lookup"><span data-stu-id="db92c-154">In the ADSI implementation, the application must handle the cookie as opaque and not make any assumptions about its internal organization or value.</span></span>
-   <span data-ttu-id="db92c-155">請注意，用戶端會將 DC 的 cookie、cookie 長度和 DNS 名稱儲存在包含已同步處理物件資料的相同儲存體中。</span><span class="sxs-lookup"><span data-stu-id="db92c-155">Be aware that the client stores the cookie, cookie length, and DNS name of the DC in the same storage that contains the synchronized object data.</span></span> <span data-ttu-id="db92c-156">這可確保當儲存體從備份還原時，cookie 和其他參數會保持與物件資料同步。</span><span class="sxs-lookup"><span data-stu-id="db92c-156">This ensures that the cookie and other parameters remain in sync with the object data if the storage is ever restored from a backup.</span></span>
-   <span data-ttu-id="db92c-157">若要取出針對 DirSync 控制項所建立的 [**parentGUID**](/windows/desktop/ADSchema/a-parentguid) 屬性，也需要要求 [**name**](/windows/desktop/ADSchema/a-name) 屬性。</span><span class="sxs-lookup"><span data-stu-id="db92c-157">To retrieve the [**parentGUID**](/windows/desktop/ADSchema/a-parentguid) attribute, which is constructed for the DirSync control, it is also necessary to request the [**name**](/windows/desktop/ADSchema/a-name) attribute.</span></span>

<span data-ttu-id="db92c-158">若要使用 DirSync 控制項，呼叫端必須在受監視的磁碟分割根目錄上指派「目錄取得變更」許可權。</span><span class="sxs-lookup"><span data-stu-id="db92c-158">To use the DirSync control, caller must have the "directory get changes" right assigned on the root of the partition being monitored.</span></span> <span data-ttu-id="db92c-159">依預設，此許可權會指派給網域控制站上的系統管理員和 LocalSystem 帳戶。</span><span class="sxs-lookup"><span data-stu-id="db92c-159">By default, this right is assigned to the Administrator and LocalSystem accounts on domain controllers.</span></span> <span data-ttu-id="db92c-160">呼叫端也必須具有「 [**DS-複寫-取得-變更**](/windows/desktop/ADSchema/r-ds-replication-get-changes) 」擴充控制許可權。</span><span class="sxs-lookup"><span data-stu-id="db92c-160">The caller must also have the [**DS-Replication-Get-Changes**](/windows/desktop/ADSchema/r-ds-replication-get-changes) extended control access right.</span></span> <span data-ttu-id="db92c-161">如需針對必須在沒有此許可權的帳戶下執行的應用程式，執行變更追蹤機制的詳細資訊，請參閱 [使用 USNChanged 輪詢變更](polling-for-changes-using-usnchanged.md)。</span><span class="sxs-lookup"><span data-stu-id="db92c-161">For more information about implementing a change-tracking mechanism for applications that must run under an account that does not have this right, see [Polling for Changes Using USNChanged](polling-for-changes-using-usnchanged.md).</span></span> <span data-ttu-id="db92c-162">如需有關許可權的詳細資訊，請參閱 [許可權](/windows/desktop/SecAuthZ/privileges)。</span><span class="sxs-lookup"><span data-stu-id="db92c-162">For more information about privileges, see [Privileges](/windows/desktop/SecAuthZ/privileges).</span></span>

## <a name="retrieving-deleted-objects-with-a-dirsync-search"></a><span data-ttu-id="db92c-163">使用 DirSync 搜尋來抓取已刪除的物件</span><span class="sxs-lookup"><span data-stu-id="db92c-163">Retrieving Deleted Objects With a DirSync Search</span></span>

<span data-ttu-id="db92c-164">**ADS \_ SEARCHPREF \_ DIRSYNC** 搜尋結果會自動將已刪除的物件包含 (的標記) 符合指定的搜尋篩選準則。</span><span class="sxs-lookup"><span data-stu-id="db92c-164">The **ADS\_SEARCHPREF\_DIRSYNC** search results automatically include deleted objects (tombstones) that match the specified search filter.</span></span> <span data-ttu-id="db92c-165">但是，當物件存留時，將符合該物件的搜尋篩選可能不會在物件被刪除後與物件相符。</span><span class="sxs-lookup"><span data-stu-id="db92c-165">However, a search filter that will match an object when it is live may not match the object after it is deleted.</span></span> <span data-ttu-id="db92c-166">這是因為只會在原始物件上保留一組存在的屬性子集。</span><span class="sxs-lookup"><span data-stu-id="db92c-166">This is because tombstones retain only a subset of the attributes present on the original object.</span></span> <span data-ttu-id="db92c-167">例如，您通常會針對使用者物件使用下列篩選。</span><span class="sxs-lookup"><span data-stu-id="db92c-167">For example, you would typically use the following filter for user objects.</span></span>


```C++
(&(objectClass=user)(objectCategory=person))
```



<span data-ttu-id="db92c-168">刪除物件時，會移除 **objectCategory** 屬性，因此上述篩選不會符合任何標記物件。</span><span class="sxs-lookup"><span data-stu-id="db92c-168">The **objectCategory** attribute is removed when an object is deleted, so the filter above would not match any tombstone objects.</span></span> <span data-ttu-id="db92c-169">相反地， **objectClass** 屬性會保留在標記物件上，因此 " (objectclass = user) " 的篩選準則會符合已刪除的使用者物件。</span><span class="sxs-lookup"><span data-stu-id="db92c-169">Conversely, the **objectClass** attribute is retained on tombstone objects, so a filter of "(objectClass=user)" would match deleted user objects.</span></span>

<span data-ttu-id="db92c-170">您使用 DirSync 搜尋指定的屬性清單也可做為篩選準則;搜尋結果只會包含一或多個指定的屬性在上一次 DirSync 搜尋之後已經變更的物件。</span><span class="sxs-lookup"><span data-stu-id="db92c-170">The attribute list that you specify with a DirSync search also acts as a filter; search results include only objects on which one or more of the specified attributes have changed since the previous DirSync search.</span></span> <span data-ttu-id="db92c-171">如果屬性清單未包含任何在標記時保留的屬性，搜尋結果就不會包含標記。</span><span class="sxs-lookup"><span data-stu-id="db92c-171">If the attribute list does not include any attributes that are retained on tombstones, the search results will not include tombstones.</span></span> <span data-ttu-id="db92c-172">若要處理這個情況，請指定 null 屬性清單來要求所有屬性;或者，您可以要求 **isDeleted** 屬性，在所有的標記上設定為 **TRUE** 。</span><span class="sxs-lookup"><span data-stu-id="db92c-172">To handle this, request all attributes by specifying a null attribute list; or you can request the **isDeleted** attribute, set to **TRUE** on all tombstones.</span></span> <span data-ttu-id="db92c-173">標記屬性在 **attributeSchema** 定義的 **searchFlags** 屬性中設定了0x8 位。</span><span class="sxs-lookup"><span data-stu-id="db92c-173">Tombstone attributes have the 0x8 bit set in the **searchFlags** attribute of the **attributeSchema** definition.</span></span>

<span data-ttu-id="db92c-174">如需詳細資訊，請參閱 [取出已刪除的物件](retrieving-deleted-objects.md)。</span><span class="sxs-lookup"><span data-stu-id="db92c-174">For more information, see [Retrieving Deleted Objects](retrieving-deleted-objects.md).</span></span>

## <a name="ldap-implementation-of-the-dirsync-control"></a><span data-ttu-id="db92c-175">DirSync 控制項的 LDAP 執行</span><span class="sxs-lookup"><span data-stu-id="db92c-175">LDAP Implementation of the DirSync Control</span></span>

<span data-ttu-id="db92c-176">您也可以使用 LDAP API 搭配 [ldap \_ 伺服器 \_ dirsync \_ OID](/previous-versions/windows/desktop/ldap/ldap-server-dirsync-oid) 控制項來執行 DirSync 搜尋。</span><span class="sxs-lookup"><span data-stu-id="db92c-176">You can also perform a DirSync search by using the LDAP API with the [LDAP\_SERVER\_DIRSYNC\_OID](/previous-versions/windows/desktop/ldap/ldap-server-dirsync-oid) control.</span></span> <span data-ttu-id="db92c-177">如果您使用 LDAP API，也請指定 [ldap \_ 伺服器 \_ 擴充 \_ DN \_ OID](/previous-versions/windows/desktop/ldap/ldap-server-extended-dn-oid) ，而 [ldap \_ 伺服器會 \_ 顯示 \_ 已刪除的 \_ OID](/previous-versions/windows/desktop/ldap/ldap-server-show-deleted-oid) 控制項。</span><span class="sxs-lookup"><span data-stu-id="db92c-177">If you use the LDAP API, also specify the [LDAP\_SERVER\_EXTENDED\_DN\_OID](/previous-versions/windows/desktop/ldap/ldap-server-extended-dn-oid) and [LDAP\_SERVER\_SHOW\_DELETED\_OID](/previous-versions/windows/desktop/ldap/ldap-server-show-deleted-oid) controls.</span></span> <span data-ttu-id="db92c-178">LDAP \_ 伺服器 \_ 擴充的 \_ DN \_ OID 控制項會使 ldap 搜尋傳回包含安全性主體物件（例如使用者、群組和電腦）之 **objectGUID** 和 **objectSID** 的辨別名稱的擴充形式。</span><span class="sxs-lookup"><span data-stu-id="db92c-178">The LDAP\_SERVER\_EXTENDED\_DN\_OID control causes an LDAP search to return an extended form of the distinguished name that includes the **objectGUID** and **objectSID** for security principal objects such as users, groups, and computers.</span></span> <span data-ttu-id="db92c-179">LDAP \_ 伺服器 \_ 顯示 \_ 已刪除的 \_ OID 控制項會導致搜尋結果包含已刪除物件的資料。</span><span class="sxs-lookup"><span data-stu-id="db92c-179">The LDAP\_SERVER\_SHOW\_DELETED\_OID control causes the search results to include data for deleted objects.</span></span> <span data-ttu-id="db92c-180">請注意，這些控制項會自動包含在 ADSI 的執行中。</span><span class="sxs-lookup"><span data-stu-id="db92c-180">Be aware that these controls are automatically included in the ADSI implementation.</span></span>

 

 