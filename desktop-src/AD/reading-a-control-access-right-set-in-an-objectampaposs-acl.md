---
title: 讀取物件 ACL 中的 Control 存取權限集合
description: IADsAccessControlEntry 介面的屬性是用來授與或拒絕 control 存取權限。
ms.assetid: 2c6fef91-990e-4954-9aff-c9ec72d13972
ms.tgt_platform: multiple
keywords:
- 讀取物件 ACL 中的 Control 存取權限集 Active Directory
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4877c96a95fc94095c79ad129e8a07b1c786abe1
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/17/2020
ms.locfileid: "104023227"
---
# <a name="reading-a-control-access-right-set-in-an-objects-acl"></a><span data-ttu-id="b98fc-104">讀取物件 ACL 中的 Control 存取權限集合</span><span class="sxs-lookup"><span data-stu-id="b98fc-104">Reading a Control Access Right Set in an Object's ACL</span></span>

<span data-ttu-id="b98fc-105">您可以使用 ADSI 來讀取 control access right ACE，就像您在 ACL 中的任何其他 ACE 一樣。</span><span class="sxs-lookup"><span data-stu-id="b98fc-105">Using ADSI, you read a control access right ACE just as you would any other ACE in an ACL.</span></span> <span data-ttu-id="b98fc-106">請注意，您也可以使用 Win32 安全性 Api 來讀取目錄物件上的 Acl。</span><span class="sxs-lookup"><span data-stu-id="b98fc-106">Be aware that you can also use the Win32 security APIs to read ACLs on directory objects.</span></span> <span data-ttu-id="b98fc-107">不過，control 存取權限會以授與和拒絕 control 存取權限的特定方式使用 [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) 介面的屬性：</span><span class="sxs-lookup"><span data-stu-id="b98fc-107">However, control access rights use the properties of the [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) interface in a manner that is specific to granting and denying control access rights:</span></span>

-   <span data-ttu-id="b98fc-108">[**AccessMask**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) 必須包含 **ADS \_ 正確的 \_ DS \_ 控制 \_ 存取權**。</span><span class="sxs-lookup"><span data-stu-id="b98fc-108">[**AccessMask**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) must contain **ADS\_RIGHT\_DS\_CONTROL\_ACCESS**.</span></span>
-   <span data-ttu-id="b98fc-109">[**旗標**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) 值為 **ADS \_ 旗標 \_ 物件 \_ 類型 \_ 存在**。</span><span class="sxs-lookup"><span data-stu-id="b98fc-109">[**Flags**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) value is **ADS\_FLAG\_OBJECT\_TYPE\_PRESENT**.</span></span>
-   <span data-ttu-id="b98fc-110">[**ObjectType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) 是 control 存取權限的 **rightsGUID** 屬性字串形式。</span><span class="sxs-lookup"><span data-stu-id="b98fc-110">[**ObjectType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) is the string form of the **rightsGUID** attribute of the control access right.</span></span> <span data-ttu-id="b98fc-111">GUID 的字串格式與 [**StringFromGUID2**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2) COM 程式庫函數具有相同的字串格式。</span><span class="sxs-lookup"><span data-stu-id="b98fc-111">The string format of the GUID is the same string format as the [**StringFromGUID2**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2) COM Library function.</span></span>
-   <span data-ttu-id="b98fc-112">[**AceType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) 是 **ADS \_ AceType \_ access 允許的 \_ \_ 物件** ，可授與受信任者控制項存取權或 **ADS AceType 拒絕存取的 \_ \_ \_ \_ 物件** ，以拒絕受信任者控制存取權限。</span><span class="sxs-lookup"><span data-stu-id="b98fc-112">[**AceType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) is either **ADS\_ACETYPE\_ACCESS\_ALLOWED\_OBJECT** to grant the trustee the control access right or **ADS\_ACETYPE\_ACCESS\_DENIED\_OBJECT** to deny the trustee the control access right.</span></span>
-   <span data-ttu-id="b98fc-113">[**信任者**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) 為安全性主體;亦即套用 ACE 的使用者、群組、電腦等等。</span><span class="sxs-lookup"><span data-stu-id="b98fc-113">[**Trustee**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) is the security principal; that is the user, group, computer, and so on, to which the ACE applies.</span></span>

<span data-ttu-id="b98fc-114">使用下列程式讀取 ADSI 物件的 ACE。</span><span class="sxs-lookup"><span data-stu-id="b98fc-114">Use the following procedure to read an ACE for an ADSI object.</span></span> <span data-ttu-id="b98fc-115">下列程式適用于 C 和 c + + 應用程式。</span><span class="sxs-lookup"><span data-stu-id="b98fc-115">The following procedure applies to C and C++ applications.</span></span>

<span data-ttu-id="b98fc-116">**若要讀取 ADSI 物件的 ACE**</span><span class="sxs-lookup"><span data-stu-id="b98fc-116">**To read an ACE for an ADSI object**</span></span>

1.  <span data-ttu-id="b98fc-117">取得物件的 [**IADs**](/windows/desktop/api/iads/nn-iads-iads) 介面指標。</span><span class="sxs-lookup"><span data-stu-id="b98fc-117">Get an [**IADs**](/windows/desktop/api/iads/nn-iads-iads) interface pointer to the object.</span></span>
2.  <span data-ttu-id="b98fc-118">您可以使用 [**IADs：： get**](/windows/desktop/api/iads/nf-iads-iads-get) 方法來取得物件的安全描述項。</span><span class="sxs-lookup"><span data-stu-id="b98fc-118">Use the [**IADs::Get**](/windows/desktop/api/iads/nf-iads-iads-get) method to get the security descriptor of the object.</span></span> <span data-ttu-id="b98fc-119">包含安全描述項的屬性名稱為 "nTSecurityDescriptor"。</span><span class="sxs-lookup"><span data-stu-id="b98fc-119">The name of the property that contains the security descriptor is "nTSecurityDescriptor".</span></span> <span data-ttu-id="b98fc-120">屬性將會以包含 [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch)指標的 **VARIANT** 傳回。</span><span class="sxs-lookup"><span data-stu-id="b98fc-120">The property will be returned as a **VARIANT** that contains an [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) pointer.</span></span> <span data-ttu-id="b98fc-121">請注意， **vt** 成員是 **vt \_ 分派**。</span><span class="sxs-lookup"><span data-stu-id="b98fc-121">Be aware that the **vt** member is **VT\_DISPATCH**.</span></span> <span data-ttu-id="b98fc-122">在該 **IDispatch** 指標上呼叫 **QueryInterface** 來取得 [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor)介面，以便使用該介面上的方法來存取安全描述項 ACL。</span><span class="sxs-lookup"><span data-stu-id="b98fc-122">Call **QueryInterface** on that **IDispatch** pointer to get an [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) interface to use the methods on that interface to access the security descriptor ACL.</span></span>
3.  <span data-ttu-id="b98fc-123">使用 [**IADsSecurityDescriptor：： get \_ objdescriptor.discretionaryacl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) 方法來取得 ACL。</span><span class="sxs-lookup"><span data-stu-id="b98fc-123">Use the [**IADsSecurityDescriptor::get\_DiscretionaryAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) method to get the ACL.</span></span> <span data-ttu-id="b98fc-124">方法會傳回 [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) 指標。</span><span class="sxs-lookup"><span data-stu-id="b98fc-124">The method returns an [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) pointer.</span></span> <span data-ttu-id="b98fc-125">在該 **IDispatch** 指標上呼叫 **QueryInterface** 來取得 [**IADsAccessControlList**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrollist)介面，以便使用該介面上的方法來存取 ACL 中的個別 ace。</span><span class="sxs-lookup"><span data-stu-id="b98fc-125">Call **QueryInterface** on that **IDispatch** pointer to get an [**IADsAccessControlList**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrollist) interface to use the methods on that interface to access the individual ACEs in the ACL.</span></span>
4.  <span data-ttu-id="b98fc-126">使用 [**IADsAccessControlList：： get \_ \_ NewEnum**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-get__newenum)方法來列舉 ace。</span><span class="sxs-lookup"><span data-stu-id="b98fc-126">Use the [**IADsAccessControlList::get\_\_NewEnum**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-get__newenum) method to enumerate the ACEs.</span></span> <span data-ttu-id="b98fc-127">方法會傳回 [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) 指標。</span><span class="sxs-lookup"><span data-stu-id="b98fc-127">The method returns an [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) pointer.</span></span> <span data-ttu-id="b98fc-128">呼叫該 **IUnknown** 指標上的 **QueryInterface** 來取得 [**IEnumVARIANT**](/windows/win32/api/oaidl/nn-oaidl-ienumvariant)介面。</span><span class="sxs-lookup"><span data-stu-id="b98fc-128">Call **QueryInterface** on that **IUnknown** pointer to get an [**IEnumVARIANT**](/windows/win32/api/oaidl/nn-oaidl-ienumvariant) interface.</span></span>
5.  <span data-ttu-id="b98fc-129">使用 [**IEnumVARIANT：： Next**](/windows/win32/api/oaidl/nf-oaidl-ienumvariant-next) 方法來列舉 ACL 中的 ace。</span><span class="sxs-lookup"><span data-stu-id="b98fc-129">Use the [**IEnumVARIANT::Next**](/windows/win32/api/oaidl/nf-oaidl-ienumvariant-next) method to enumerate the ACEs in the ACL.</span></span> <span data-ttu-id="b98fc-130">屬性會以包含 [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch)指標的 **變異** 形式傳回。</span><span class="sxs-lookup"><span data-stu-id="b98fc-130">The property is returned as a **VARIANT** that contains an [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) pointer.</span></span> <span data-ttu-id="b98fc-131">請注意， **vt** 成員是 **vt \_ 分派**。</span><span class="sxs-lookup"><span data-stu-id="b98fc-131">Be aware that the **vt** member is **VT\_DISPATCH**.</span></span> <span data-ttu-id="b98fc-132">在該 **IDispatch** 指標上呼叫 **QueryInterface** 來取得 [**IADSACCESSCONTROLENTRY**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry)介面，以讀取 ACE。</span><span class="sxs-lookup"><span data-stu-id="b98fc-132">Call **QueryInterface** on that **IDispatch** pointer to get an [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) interface to read the ACE.</span></span>
6.  <span data-ttu-id="b98fc-133">呼叫 [**IADsAccessControlEntry：： get \_ AccessMask**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods)方法來取得 **AccessMask** ，並確認 **ADS \_ RIGHT \_ DS \_ CONTROL \_ 存取** 旗標的 **AccessMask** 值。</span><span class="sxs-lookup"><span data-stu-id="b98fc-133">Call the [**IADsAccessControlEntry::get\_AccessMask**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) method to get the **AccessMask** and verify that the **AccessMask** value for the **ADS\_RIGHT\_DS\_CONTROL\_ACCESS** flag.</span></span> <span data-ttu-id="b98fc-134">如果有此旗標，ACE 就會包含 control 存取權限。</span><span class="sxs-lookup"><span data-stu-id="b98fc-134">If it has this flag, the ACE contains a control access right.</span></span>
7.  <span data-ttu-id="b98fc-135">呼叫 [**IADsAccessControlEntry：： get \_ Flags**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) 方法來取得物件類型的旗標。</span><span class="sxs-lookup"><span data-stu-id="b98fc-135">Call the [**IADsAccessControlEntry::get\_Flags**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) method to get the flag for the object type.</span></span>
8.  <span data-ttu-id="b98fc-136">檢查 **ADS \_ 旗標 \_ 物件 \_ 類型 \_ 目前** 旗 [**標的旗標**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods)值。</span><span class="sxs-lookup"><span data-stu-id="b98fc-136">Check [**Flags**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) value for **ADS\_FLAG\_OBJECT\_TYPE\_PRESENT** flag.</span></span> <span data-ttu-id="b98fc-137">如果 [ **旗標** ] 設定為 [ **ADS \_ 旗標 \_ 物件 \_ 類型 \_**]，請呼叫 **IADSACCESSCONTROLENTRY：： get \_ ObjectType** 方法，取得包含 ACE 套用之控制項存取權 rightsGUID 的字串。</span><span class="sxs-lookup"><span data-stu-id="b98fc-137">If **Flags** is set to **ADS\_FLAG\_OBJECT\_TYPE\_PRESENT**, call the **IADsAccessControlEntry::get\_ObjectType** method to get a string that contains the rightsGUID of the control access right that the ACE applies to.</span></span>
9.  <span data-ttu-id="b98fc-138">呼叫 [**IADsAccessControlEntry：： get \_ AceType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) 方法以取得 ACE 類型。</span><span class="sxs-lookup"><span data-stu-id="b98fc-138">Call the [**IADsAccessControlEntry::get\_AceType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) method to get the ACE type.</span></span> <span data-ttu-id="b98fc-139">此類型會是 **ADS \_ ACETYPE \_ access 允許的 \_ \_ 物件** 授與受信任者存取權限，或 **ADS \_ ACETYPE 拒絕存取的 \_ \_ \_ 物件** 拒絕控制存取權。</span><span class="sxs-lookup"><span data-stu-id="b98fc-139">The type will be an **ADS\_ACETYPE\_ACCESS\_ALLOWED\_OBJECT** to grant the trustee the control access right or **ADS\_ACETYPE\_ACCESS\_DENIED\_OBJECT** to deny the control access right.</span></span>
10. <span data-ttu-id="b98fc-140">呼叫 [**IADsAccessControlEntry：： get \_ 信任**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) 程式方法以取得安全性主體，也就是套用 ACE 的使用者、群組、電腦等等。</span><span class="sxs-lookup"><span data-stu-id="b98fc-140">Call the [**IADsAccessControlEntry::get\_Trustee**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) method to get the security principal; that is user, group, computer, and so on to which the ACE applies.</span></span>
11. <span data-ttu-id="b98fc-141">當 [**ObjectType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) 和 **信任** 字串完成時，請使用 [**SysFreeString**](/windows/win32/api/oleauto/nf-oleauto-sysfreestring) 釋放這些字串的記憶體。</span><span class="sxs-lookup"><span data-stu-id="b98fc-141">When finished with the [**ObjectType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) and **Trustee** strings, use [**SysFreeString**](/windows/win32/api/oleauto/nf-oleauto-sysfreestring) to free the memory for those strings.</span></span>
12. <span data-ttu-id="b98fc-142">完成介面之後，呼叫 **release** 以遞減或釋放所有介面參考。</span><span class="sxs-lookup"><span data-stu-id="b98fc-142">When finished with the interfaces, call **Release** to decrement or release all the interface references.</span></span>

 

 