---
title: 適用于設定服務的藍牙和 WSAQUERYSET
description: 使用 WSAQUERYSET 結構搭配 WSASetService 函式來註冊或移除藍牙命名空間中的服務實例 (NS \_ BTH) 。
ms.assetid: e582156d-a298-4d9b-8ed1-4c558fa4f203
keywords:
- 適用于設定服務藍牙的藍牙和 WSAQUERYSET
- WSAQUERYSET 藍牙，適用于設定服務
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 64a632cad2c813856367d4565bc69e0d4baf2eba
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/20/2020
ms.locfileid: "103933323"
---
# <a name="bluetooth-and-wsaqueryset-for-set-service"></a><span data-ttu-id="660b3-105">適用于設定服務的藍牙和 WSAQUERYSET</span><span class="sxs-lookup"><span data-stu-id="660b3-105">Bluetooth and WSAQUERYSET for Set Service</span></span>

<span data-ttu-id="660b3-106">藍牙使用 [**WSAQUERYSET**](/windows/desktop/api/winsock2/ns-winsock2-wsaquerysetw) 結構來協助探索藍牙命名空間 NS BTH 中的裝置和服務 \_ 。</span><span class="sxs-lookup"><span data-stu-id="660b3-106">Bluetooth uses the [**WSAQUERYSET**](/windows/desktop/api/winsock2/ns-winsock2-wsaquerysetw) structure to facilitate the discovery of devices and services in the Bluetooth namespace, NS\_BTH.</span></span>

<span data-ttu-id="660b3-107">[**WSASetService**](/windows/desktop/api/winsock2/nf-winsock2-wsasetservicea)函式會使用 [**WSAQUERYSET**](/windows/desktop/api/winsock2/ns-winsock2-wsaquerysetw)結構來註冊或移除 Bluetooth 命名空間中的服務實例。</span><span class="sxs-lookup"><span data-stu-id="660b3-107">The [**WSASetService**](/windows/desktop/api/winsock2/nf-winsock2-wsasetservicea) function uses the [**WSAQUERYSET**](/windows/desktop/api/winsock2/ns-winsock2-wsaquerysetw) structure to register or remove service instances in the Bluetooth namespace.</span></span> <span data-ttu-id="660b3-108">下表列出 **WSAQUERYSET** 結構中的成員值。</span><span class="sxs-lookup"><span data-stu-id="660b3-108">The following table lists member values in the **WSAQUERYSET** structure.</span></span>

| <span data-ttu-id="660b3-109">成員</span><span class="sxs-lookup"><span data-stu-id="660b3-109">Member</span></span>                      | <span data-ttu-id="660b3-110">必要值 (輸入) </span><span class="sxs-lookup"><span data-stu-id="660b3-110">Required value (input)</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | <span data-ttu-id="660b3-111">輸出</span><span class="sxs-lookup"><span data-stu-id="660b3-111">Output</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                           |
|-----------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="660b3-112">**dwSize**</span><span class="sxs-lookup"><span data-stu-id="660b3-112">**dwSize**</span></span>                  | <span data-ttu-id="660b3-113">必須設定為 **sizeof** ([**WSAQUERYSET**](/windows/desktop/api/winsock2/ns-winsock2-wsaquerysetw)) 。</span><span class="sxs-lookup"><span data-stu-id="660b3-113">Must be set to **sizeof**([**WSAQUERYSET**](/windows/desktop/api/winsock2/ns-winsock2-wsaquerysetw)).</span></span> <span data-ttu-id="660b3-114">當做版本控制機制使用。</span><span class="sxs-lookup"><span data-stu-id="660b3-114">Used as a versioning mechanism.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | <span data-ttu-id="660b3-115">無。</span><span class="sxs-lookup"><span data-stu-id="660b3-115">None.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                            |
| <span data-ttu-id="660b3-116">**dwOutputFlags**</span><span class="sxs-lookup"><span data-stu-id="660b3-116">**dwOutputFlags**</span></span>           | <span data-ttu-id="660b3-117">未使用。</span><span class="sxs-lookup"><span data-stu-id="660b3-117">Not used.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | <span data-ttu-id="660b3-118">無。</span><span class="sxs-lookup"><span data-stu-id="660b3-118">None.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                            |
| <span data-ttu-id="660b3-119">**lpszServiceInstanceName**</span><span class="sxs-lookup"><span data-stu-id="660b3-119">**lpszServiceInstanceName**</span></span> | <span data-ttu-id="660b3-120">此為選用步驟，但建議執行。</span><span class="sxs-lookup"><span data-stu-id="660b3-120">Optional, but recommended.</span></span> <span data-ttu-id="660b3-121">用來建立藍牙 ServiceName 屬性。</span><span class="sxs-lookup"><span data-stu-id="660b3-121">Used to construct the Bluetooth ServiceName attribute.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | <span data-ttu-id="660b3-122">無。</span><span class="sxs-lookup"><span data-stu-id="660b3-122">None.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                            |
| <span data-ttu-id="660b3-123">**lpServiceClassId**</span><span class="sxs-lookup"><span data-stu-id="660b3-123">**lpServiceClassId**</span></span>        | <span data-ttu-id="660b3-124">必要。</span><span class="sxs-lookup"><span data-stu-id="660b3-124">Required.</span></span> <span data-ttu-id="660b3-125">對應至服務類別的 GUID。</span><span class="sxs-lookup"><span data-stu-id="660b3-125">GUID corresponding to the service class.</span></span> <span data-ttu-id="660b3-126">此值應該對應至已知設定檔的藍牙指派數位檔中的 GUID，或針對不是以設定檔為基礎的應用程式，對應到應用程式產生的唯一 UUID。</span><span class="sxs-lookup"><span data-stu-id="660b3-126">This value should correspond to a GUID from the Bluetooth Assigned Numbers document for known profiles, or a unique application-generated UUID for applications that are not profile based.</span></span> <span data-ttu-id="660b3-127">用來建立 ServiceClassIdList 屬性序列，其為其唯一的成員。</span><span class="sxs-lookup"><span data-stu-id="660b3-127">Used to construct a ServiceClassIdList attribute sequence with this as its only member.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | <span data-ttu-id="660b3-128">無。</span><span class="sxs-lookup"><span data-stu-id="660b3-128">None.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                            |
| <span data-ttu-id="660b3-129">**lpVersion**</span><span class="sxs-lookup"><span data-stu-id="660b3-129">**lpVersion**</span></span>               | <span data-ttu-id="660b3-130">未使用。</span><span class="sxs-lookup"><span data-stu-id="660b3-130">Not used.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | <span data-ttu-id="660b3-131">無。</span><span class="sxs-lookup"><span data-stu-id="660b3-131">None.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                            |
| <span data-ttu-id="660b3-132">**lpszComment**</span><span class="sxs-lookup"><span data-stu-id="660b3-132">**lpszComment**</span></span>             | <span data-ttu-id="660b3-133">選擇性。</span><span class="sxs-lookup"><span data-stu-id="660b3-133">Optional.</span></span> <span data-ttu-id="660b3-134">用來建立藍牙 ServiceDescription 屬性。</span><span class="sxs-lookup"><span data-stu-id="660b3-134">Used to construct the Bluetooth ServiceDescription attribute.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | <span data-ttu-id="660b3-135">無。</span><span class="sxs-lookup"><span data-stu-id="660b3-135">None.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                            |
| <span data-ttu-id="660b3-136">**dwNameSpace**</span><span class="sxs-lookup"><span data-stu-id="660b3-136">**dwNameSpace**</span></span>             | <span data-ttu-id="660b3-137">要在其中限制服務的命名空間。</span><span class="sxs-lookup"><span data-stu-id="660b3-137">Namespace in which to constrain the service.</span></span> <span data-ttu-id="660b3-138">必須是 NS \_ BTH。</span><span class="sxs-lookup"><span data-stu-id="660b3-138">Must be NS\_BTH.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | <span data-ttu-id="660b3-139">無。</span><span class="sxs-lookup"><span data-stu-id="660b3-139">None.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                            |
| <span data-ttu-id="660b3-140">**lpNSProviderId**</span><span class="sxs-lookup"><span data-stu-id="660b3-140">**lpNSProviderId**</span></span>          | <span data-ttu-id="660b3-141">不需要。</span><span class="sxs-lookup"><span data-stu-id="660b3-141">Not required.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | <span data-ttu-id="660b3-142">無。</span><span class="sxs-lookup"><span data-stu-id="660b3-142">None.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                            |
| <span data-ttu-id="660b3-143">**lpszCoNtext**</span><span class="sxs-lookup"><span data-stu-id="660b3-143">**lpszContext**</span></span>             | <span data-ttu-id="660b3-144">未使用。</span><span class="sxs-lookup"><span data-stu-id="660b3-144">Not used.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | <span data-ttu-id="660b3-145">無。</span><span class="sxs-lookup"><span data-stu-id="660b3-145">None.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                            |
| <span data-ttu-id="660b3-146">**dwNumberOfProtocols**</span><span class="sxs-lookup"><span data-stu-id="660b3-146">**dwNumberOfProtocols**</span></span>     | <span data-ttu-id="660b3-147">未使用。</span><span class="sxs-lookup"><span data-stu-id="660b3-147">Not used.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | <span data-ttu-id="660b3-148">無。</span><span class="sxs-lookup"><span data-stu-id="660b3-148">None.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                            |
| <span data-ttu-id="660b3-149">**lpafpProtocols**</span><span class="sxs-lookup"><span data-stu-id="660b3-149">**lpafpProtocols**</span></span>          | <span data-ttu-id="660b3-150">未使用。</span><span class="sxs-lookup"><span data-stu-id="660b3-150">Not used.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | <span data-ttu-id="660b3-151">無。</span><span class="sxs-lookup"><span data-stu-id="660b3-151">None.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                            |
| <span data-ttu-id="660b3-152">**lpszQueryString**</span><span class="sxs-lookup"><span data-stu-id="660b3-152">**lpszQueryString**</span></span>         | <span data-ttu-id="660b3-153">未使用。</span><span class="sxs-lookup"><span data-stu-id="660b3-153">Not used.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | <span data-ttu-id="660b3-154">無。</span><span class="sxs-lookup"><span data-stu-id="660b3-154">None.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                            |
| <span data-ttu-id="660b3-155">**dwNumberOfCsAddrs**</span><span class="sxs-lookup"><span data-stu-id="660b3-155">**dwNumberOfCsAddrs**</span></span>       | <span data-ttu-id="660b3-156">要註冊的位址數目。</span><span class="sxs-lookup"><span data-stu-id="660b3-156">Number of addresses to register.</span></span> <span data-ttu-id="660b3-157">必須是 1。</span><span class="sxs-lookup"><span data-stu-id="660b3-157">Must be 1.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | <span data-ttu-id="660b3-158">無。</span><span class="sxs-lookup"><span data-stu-id="660b3-158">None.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                            |
| <span data-ttu-id="660b3-159">**lpcsaBuffer**</span><span class="sxs-lookup"><span data-stu-id="660b3-159">**lpcsaBuffer**</span></span>             | <span data-ttu-id="660b3-160">如果 **lpBlob** 尚未填入原始的 SDP 資料流程，則為必要。</span><span class="sxs-lookup"><span data-stu-id="660b3-160">Required if **lpBlob** has not been populated with a raw SDP stream.</span></span> <span data-ttu-id="660b3-161">[**CSADDR \_ 資訊**](/windows/desktop/api/nspapi/ns-nspapi-csaddr_info)結構的指標，其 **LocalAddr. lpSockaddr** 成員指向伺服器正在接聽連接的 [**SOCKADDR \_ BTH**](/windows/desktop/api/Ws2bth/ns-ws2bth-sockaddr_bth) 。</span><span class="sxs-lookup"><span data-stu-id="660b3-161">Pointer to a [**CSADDR\_INFO**](/windows/desktop/api/nspapi/ns-nspapi-csaddr_info) structure with its **LocalAddr.lpSockaddr** member pointing to the [**SOCKADDR\_BTH**](/windows/desktop/api/Ws2bth/ns-ws2bth-sockaddr_bth) where the server is listening for connections.</span></span> <span data-ttu-id="660b3-162">[**Getsockname**](/windows/desktop/api/winsock/nf-winsock-getsockname)函數可以用來傳回系結通訊端的 **SOCKADDR \_ BTH** 結構。</span><span class="sxs-lookup"><span data-stu-id="660b3-162">The [**getsockname**](/windows/desktop/api/winsock/nf-winsock-getsockname) function can be used to return the **SOCKADDR\_BTH** structure for a bound socket.</span></span> <span data-ttu-id="660b3-163">系統會使用 **lpcsaBuffer** 成員中的資訊來建立藍牙 ProtocolDescriptorList SDP 屬性。</span><span class="sxs-lookup"><span data-stu-id="660b3-163">Information in the **lpcsaBuffer** member is used by the system to construct the Bluetooth ProtocolDescriptorList SDP attribute.</span></span> <span data-ttu-id="660b3-164">**LpcsaBuffer** 中提供的通訊協定和埠必須是唯一的 (先前未) 註冊，而且會用來為後續呼叫刪除的記錄編制索引。</span><span class="sxs-lookup"><span data-stu-id="660b3-164">The protocol and port provided in **lpcsaBuffer** must be unique (not previously registered), and are used to index the record for subsequent calls to delete.</span></span> <span data-ttu-id="660b3-165">用來建立 SDP 記錄的藍牙 ProtocolDescriptorList 屬性。</span><span class="sxs-lookup"><span data-stu-id="660b3-165">Used to construct the Bluetooth ProtocolDescriptorList attribute of the SDP record.</span></span> | <span data-ttu-id="660b3-166">無。</span><span class="sxs-lookup"><span data-stu-id="660b3-166">None.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                            |
| <span data-ttu-id="660b3-167">**lpBlob**</span><span class="sxs-lookup"><span data-stu-id="660b3-167">**lpBlob**</span></span>                  | <span data-ttu-id="660b3-168">選擇性。</span><span class="sxs-lookup"><span data-stu-id="660b3-168">Optional.</span></span> <span data-ttu-id="660b3-169">指向 [**BTH \_ 集 \_ 服務**](/windows/desktop/api/Ws2bth/ns-ws2bth-bth_set_service)結構之 [**BLOB**](/windows/desktop/api/nspapi/ns-nspapi-blob)結構的指標，可讓用戶端提供包含應用程式所建立之二進位 SDP 記錄的藍牙特定結構。</span><span class="sxs-lookup"><span data-stu-id="660b3-169">Pointer to a [**BLOB**](/windows/desktop/api/nspapi/ns-nspapi-blob) structure that points to a [**BTH\_SET\_SERVICE**](/windows/desktop/api/Ws2bth/ns-ws2bth-bth_set_service) structure, enabling the client to provide a Bluetooth-specific structure containing a binary SDP record constructed by the application.</span></span> <span data-ttu-id="660b3-170">如果將 **lpBlob** 提供給 [**WSASetService**](/windows/desktop/api/winsock2/nf-winsock2-wsasetservicea) 函式，則會忽略 [**WSAQUERYSET**](/windows/desktop/api/winsock2/ns-winsock2-wsaquerysetw) 結構的所有其他成員（ **dwSize** 和 **dwNameSpace** 除外）。</span><span class="sxs-lookup"><span data-stu-id="660b3-170">If **lpBlob** is provided to the [**WSASetService**](/windows/desktop/api/winsock2/nf-winsock2-wsasetservicea) function, all other members of the [**WSAQUERYSET**](/windows/desktop/api/winsock2/ns-winsock2-wsaquerysetw) structure except **dwSize** and **dwNameSpace** are ignored.</span></span> <span data-ttu-id="660b3-171">如需詳細資訊，請參閱 [藍牙和 BLOB](bluetooth-and-blob.md) 。</span><span class="sxs-lookup"><span data-stu-id="660b3-171">See [Bluetooth and BLOB](bluetooth-and-blob.md) for more information.</span></span> <span data-ttu-id="660b3-172">在許多情況下都需要提交二進位的 SDP 記錄，因為可以從 **WSAQUERYSET** 結構轉換有限數量的 sdp 屬性，並將字串轉換為預設的語言 utf-8 編碼。</span><span class="sxs-lookup"><span data-stu-id="660b3-172">Submitting a binary SDP record is necessary in many cases, because a limited number of SDP attributes can be converted from the **WSAQUERYSET** structure, and strings are converted only to default language UTF-8 encoding.</span></span>           | <span data-ttu-id="660b3-173">如果在輸入上提供了選擇性的 [**BLOB**](/windows/desktop/api/nspapi/ns-nspapi-blob) 和 [**BTH \_ SET \_ 服務**](/windows/desktop/api/Ws2bth/ns-ws2bth-bth_set_service) 結構，以及 ULONG 版本並處理 **BTH \_ SET \_ SERVICE** 必須指向的值，則版本會更新為包含 \_ \_ 藍牙 Windows 通訊端提供者的 BTH SDP 版本值，而且會提供控制碼，之後才能刪除記錄。</span><span class="sxs-lookup"><span data-stu-id="660b3-173">If the optional [**BLOB**](/windows/desktop/api/nspapi/ns-nspapi-blob) and [**BTH\_SET\_SERVICE**](/windows/desktop/api/Ws2bth/ns-ws2bth-bth_set_service) structures have been provided on input, along with the ULONG version and HANDLE values which must be pointed to by **BTH\_SET\_SERVICE**, the version is updated to contain the BTH\_SDP\_VERSION value for the Bluetooth Windows Sockets provider, and the handle is provided, which is required to subsequently delete the record.</span></span> |



 

> [!Note]  
> <span data-ttu-id="660b3-174">若要移除服務， [**BTH \_ SET \_ 服務**](/windows/desktop/api/Ws2bth/ns-ws2bth-bth_set_service) 結構中唯一需要的成員是 **pSdpVersion** 和 **pRecordHandle** 成員。</span><span class="sxs-lookup"><span data-stu-id="660b3-174">To remove a service, the only required members in the [**BTH\_SET\_SERVICE**](/windows/desktop/api/Ws2bth/ns-ws2bth-bth_set_service) structure are the **pSdpVersion** and **pRecordHandle** members.</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="660b3-175">相關主題</span><span class="sxs-lookup"><span data-stu-id="660b3-175">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="660b3-176">適用于裝置查詢的藍牙和 WSAQUERYSET</span><span class="sxs-lookup"><span data-stu-id="660b3-176">Bluetooth and WSAQUERYSET for Device Inquiry</span></span>](bluetooth-and-wsaqueryset-for-device-inquiry.md)
</dt> <dt>

[<span data-ttu-id="660b3-177">用於服務查詢的藍牙和 WSAQUERYSET</span><span class="sxs-lookup"><span data-stu-id="660b3-177">Bluetooth and WSAQUERYSET for Service Inquiry</span></span>](bluetooth-and-wsaqueryset-for-service-inquiry.md)
</dt> <dt>

[<span data-ttu-id="660b3-178">藍牙和 BLOB</span><span class="sxs-lookup"><span data-stu-id="660b3-178">Bluetooth and BLOB</span></span>](bluetooth-and-blob.md)
</dt> <dt>

[<span data-ttu-id="660b3-179">藍牙和 WSASetService</span><span class="sxs-lookup"><span data-stu-id="660b3-179">Bluetooth and WSASetService</span></span>](bluetooth-and-wsasetservice.md)
</dt> <dt>

[<span data-ttu-id="660b3-180">**Blob**</span><span class="sxs-lookup"><span data-stu-id="660b3-180">**BLOB**</span></span>](/windows/desktop/api/nspapi/ns-nspapi-blob)
</dt> <dt>

[<span data-ttu-id="660b3-181">**BTH \_ 設定 \_ 服務**</span><span class="sxs-lookup"><span data-stu-id="660b3-181">**BTH\_SET\_SERVICE**</span></span>](/windows/desktop/api/Ws2bth/ns-ws2bth-bth_set_service)
</dt> <dt>

[<span data-ttu-id="660b3-182">**CSADDR \_ 資訊**</span><span class="sxs-lookup"><span data-stu-id="660b3-182">**CSADDR\_INFO**</span></span>](/windows/desktop/api/nspapi/ns-nspapi-csaddr_info)
</dt> <dt>

[<span data-ttu-id="660b3-183">**getsockname**</span><span class="sxs-lookup"><span data-stu-id="660b3-183">**getsockname**</span></span>](/windows/desktop/api/winsock/nf-winsock-getsockname)
</dt> <dt>

[<span data-ttu-id="660b3-184">**SOCKADDR \_ BTH**</span><span class="sxs-lookup"><span data-stu-id="660b3-184">**SOCKADDR\_BTH**</span></span>](/windows/desktop/api/Ws2bth/ns-ws2bth-sockaddr_bth)
</dt> <dt>

[<span data-ttu-id="660b3-185">**WSAQUERYSET**</span><span class="sxs-lookup"><span data-stu-id="660b3-185">**WSAQUERYSET**</span></span>](/windows/desktop/api/winsock2/ns-winsock2-wsaquerysetw)
</dt> <dt>

[<span data-ttu-id="660b3-186">Windows Sockets</span><span class="sxs-lookup"><span data-stu-id="660b3-186">Windows Sockets</span></span>](/windows/desktop/WinSock/windows-sockets-start-page-2)
</dt> </dl>

 

 