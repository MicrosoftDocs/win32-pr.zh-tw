---
description: 當資源管理員開始參與該特定交易時，會在交易中登記。
ms.assetid: 9c201699-c00b-4efe-9f30-8d4e182de785
title: 登記
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 52820af2a7b280bc4740d0309fb627725e648685
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "104194952"
---
# <a name="enlistments"></a><span data-ttu-id="0a2f9-103">登記</span><span class="sxs-lookup"><span data-stu-id="0a2f9-103">Enlistments</span></span>

<span data-ttu-id="0a2f9-104">當資源管理員開始參與該特定交易時，會在交易中登記。</span><span class="sxs-lookup"><span data-stu-id="0a2f9-104">A resource manager enlists in a transaction when it begins participation in that particular transaction.</span></span> <span data-ttu-id="0a2f9-105">登記會定義資源管理員所接受的通知。</span><span class="sxs-lookup"><span data-stu-id="0a2f9-105">The enlistment defines which notifications the resource manager accepts.</span></span> <span data-ttu-id="0a2f9-106">當資源管理員在交易中登記時，會建立一個登錄物件。</span><span class="sxs-lookup"><span data-stu-id="0a2f9-106">A resource manager creates an enlistment object when it enlists in a transaction.</span></span> <span data-ttu-id="0a2f9-107">此物件會向 KTM 指出資源管理員 (RM) 正在要求有關指定交易的通知。</span><span class="sxs-lookup"><span data-stu-id="0a2f9-107">This object signals to KTM that the resource manager (RM) is requesting notifications about the specified transaction.</span></span>

<span data-ttu-id="0a2f9-108">RM 會提供 [**通知 \_ 遮罩**](notification-mask.md) 結構，以詳細說明其要求的通知。</span><span class="sxs-lookup"><span data-stu-id="0a2f9-108">The RM provides a [**NOTIFICATION\_MASK**](notification-mask.md) structure that details which notifications it is requesting.</span></span>

## <a name="enlistment-functions"></a><span data-ttu-id="0a2f9-109">登記函數</span><span class="sxs-lookup"><span data-stu-id="0a2f9-109">Enlistment Functions</span></span>

<span data-ttu-id="0a2f9-110">下列函式可用於登記。</span><span class="sxs-lookup"><span data-stu-id="0a2f9-110">The following functions are used with enlistments.</span></span>



| <span data-ttu-id="0a2f9-111">函式</span><span class="sxs-lookup"><span data-stu-id="0a2f9-111">Function</span></span>                                                                          | <span data-ttu-id="0a2f9-112">描述</span><span class="sxs-lookup"><span data-stu-id="0a2f9-112">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                             |
|-----------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="0a2f9-113">**CommitComplete**</span><span class="sxs-lookup"><span data-stu-id="0a2f9-113">**CommitComplete**</span></span>](/windows/desktop/api/Ktmw32/nf-ktmw32-commitcomplete)                                          | <span data-ttu-id="0a2f9-114">指出資源管理員 (RM) 已完成認可交易管理員 (TM) 所要求的交易。</span><span class="sxs-lookup"><span data-stu-id="0a2f9-114">Indicates that a resource manager (RM) has finished committing a transaction that was requested by the transaction manager (TM).</span></span>                                                                                                                                                                                                                                                                        |
| [<span data-ttu-id="0a2f9-115">**CreateEnlistment**</span><span class="sxs-lookup"><span data-stu-id="0a2f9-115">**CreateEnlistment**</span></span>](/windows/desktop/api/KtmW32/nf-ktmw32-createenlistment)                                      | <span data-ttu-id="0a2f9-116">建立登記、設定其初始狀態，並使用指定的存取權開啟登記的控制碼。</span><span class="sxs-lookup"><span data-stu-id="0a2f9-116">Creates an enlistment, sets its initial state, and opens a handle to the enlistment with the specified access.</span></span>                                                                                                                                                                                                                                                                                          |
| [<span data-ttu-id="0a2f9-117">**GetEnlistmentRecoveryInformation**</span><span class="sxs-lookup"><span data-stu-id="0a2f9-117">**GetEnlistmentRecoveryInformation**</span></span>](/windows/desktop/api/Ktmw32/nf-ktmw32-getenlistmentrecoveryinformation) | <span data-ttu-id="0a2f9-118">從 KTM 抓取修復資料的不透明結構。</span><span class="sxs-lookup"><span data-stu-id="0a2f9-118">Retrieves an opaque structure of recovery data from KTM.</span></span> <span data-ttu-id="0a2f9-119">藉由呼叫 [**SetEnlistmentRecoveryInformation**](/windows/desktop/api/Ktmw32/nf-ktmw32-setenlistmentrecoveryinformation) 函式，可代表資源管理員將復原資訊儲存在記錄檔中， (RM) 。</span><span class="sxs-lookup"><span data-stu-id="0a2f9-119">Recovery information is stored in a log on behalf of a resource manager (RM) by calling the [**SetEnlistmentRecoveryInformation**](/windows/desktop/api/Ktmw32/nf-ktmw32-setenlistmentrecoveryinformation) function.</span></span> <span data-ttu-id="0a2f9-120">失敗之後，RM 可以使用 [**GetEnlistmentRecoveryInformation**](/windows/desktop/api/Ktmw32/nf-ktmw32-getenlistmentrecoveryinformation) 函式來取得資訊。</span><span class="sxs-lookup"><span data-stu-id="0a2f9-120">After a failure, the RM can use the [**GetEnlistmentRecoveryInformation**](/windows/desktop/api/Ktmw32/nf-ktmw32-getenlistmentrecoveryinformation) function to retrieve the information.</span></span> |
| [<span data-ttu-id="0a2f9-121">**OpenEnlistment**</span><span class="sxs-lookup"><span data-stu-id="0a2f9-121">**OpenEnlistment**</span></span>](/windows/desktop/api/Ktmw32/nf-ktmw32-openenlistment)                                          | <span data-ttu-id="0a2f9-122">開啟現有的登錄物件，並將控制碼傳回給登記。</span><span class="sxs-lookup"><span data-stu-id="0a2f9-122">Opens an existing enlistment object, and returns a handle to the enlistment.</span></span>                                                                                                                                                                                                                                                                                                                            |
| [<span data-ttu-id="0a2f9-123">**ReadOnlyEnlistment**</span><span class="sxs-lookup"><span data-stu-id="0a2f9-123">**ReadOnlyEnlistment**</span></span>](/windows/desktop/api/Ktmw32/nf-ktmw32-readonlyenlistment)                                  | <span data-ttu-id="0a2f9-124">要求將指定的登記轉換成隻讀登記。</span><span class="sxs-lookup"><span data-stu-id="0a2f9-124">Requests that the specified enlistment be converted to a read-only enlistment.</span></span> <span data-ttu-id="0a2f9-125">唯讀登記無法參與交易的結果，也不會永久記錄以進行復原。</span><span class="sxs-lookup"><span data-stu-id="0a2f9-125">A read-only enlistment cannot participate in the outcome of the transaction and is not durably recorded for recovery.</span></span>                                                                                                                                                                                                    |
| [<span data-ttu-id="0a2f9-126">**RollbackEnlistment**</span><span class="sxs-lookup"><span data-stu-id="0a2f9-126">**RollbackEnlistment**</span></span>](/windows/desktop/api/Ktmw32/nf-ktmw32-rollbackenlistment)                                  | <span data-ttu-id="0a2f9-127">復原與登記相關聯的指定交易。</span><span class="sxs-lookup"><span data-stu-id="0a2f9-127">Rolls back the specified transaction that is associated with an enlistment.</span></span> <span data-ttu-id="0a2f9-128">無法針對唯讀登記呼叫此函數。</span><span class="sxs-lookup"><span data-stu-id="0a2f9-128">This function cannot be called for read-only enlistments.</span></span>                                                                                                                                                                                                                                                                   |
| [<span data-ttu-id="0a2f9-129">**SetEnlistmentRecoveryInformation**</span><span class="sxs-lookup"><span data-stu-id="0a2f9-129">**SetEnlistmentRecoveryInformation**</span></span>](/windows/desktop/api/Ktmw32/nf-ktmw32-setenlistmentrecoveryinformation)      | <span data-ttu-id="0a2f9-130">從 KTM 設定不透明、使用者定義的修復資料結構。</span><span class="sxs-lookup"><span data-stu-id="0a2f9-130">Sets an opaque, user-defined structure of recovery data from KTM.</span></span> <span data-ttu-id="0a2f9-131">藉由呼叫 [**SetEnlistmentRecoveryInformation**](/windows/desktop/api/Ktmw32/nf-ktmw32-setenlistmentrecoveryinformation)，可代表資源管理員將復原資訊儲存在記錄檔中， (RM) 。</span><span class="sxs-lookup"><span data-stu-id="0a2f9-131">Recovery information is stored in a log on behalf of a resource manager (RM) by calling [**SetEnlistmentRecoveryInformation**](/windows/desktop/api/Ktmw32/nf-ktmw32-setenlistmentrecoveryinformation).</span></span> <span data-ttu-id="0a2f9-132">失敗之後，RM 可以使用 [**GetEnlistmentRecoveryInformation**](/windows/desktop/api/Ktmw32/nf-ktmw32-getenlistmentrecoveryinformation) 來取得資訊。</span><span class="sxs-lookup"><span data-stu-id="0a2f9-132">After a failure, the RM can use [**GetEnlistmentRecoveryInformation**](/windows/desktop/api/Ktmw32/nf-ktmw32-getenlistmentrecoveryinformation) to retrieve the information.</span></span>                  |
| [<span data-ttu-id="0a2f9-133">**SinglePhaseReject**</span><span class="sxs-lookup"><span data-stu-id="0a2f9-133">**SinglePhaseReject**</span></span>](/windows/desktop/api/Ktmw32/nf-ktmw32-singlephasereject)                                    | <span data-ttu-id="0a2f9-134">指出資源管理員 (RM) 拒絕單一階段要求。</span><span class="sxs-lookup"><span data-stu-id="0a2f9-134">Indicates that the resource manager (RM) is refusing a single-phase request.</span></span> <span data-ttu-id="0a2f9-135">當交易管理員 (TM) 收到此呼叫時，它會起始兩階段認可，並將準備要求傳送到所有已登錄的 RMs。</span><span class="sxs-lookup"><span data-stu-id="0a2f9-135">When a transaction manager (TM) receives this call, it initiates a two-phase commit and sends a prepare request to all enlisted RMs.</span></span>                                                                                                                                                                                       |



 

 

 



