---
title: " (RPC) 處理錯誤"
description: 在同步 RPC 中，用戶端會進行遠端呼叫，以成功或失敗的程式碼傳回。
ms.assetid: 7dfc9f84-ce3c-49f3-8f72-b212095133fd
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 017892b94438cc73f88cbfe60c03c088bf3ebcc9
ms.sourcegitcommit: 8fa6614b715bddf14648cce36d2df22e5232801a
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 12/10/2020
ms.locfileid: "104024500"
---
# <a name="error-handling-rpc"></a> (RPC) 處理錯誤

在同步 RPC 中，用戶端會進行遠端呼叫，以成功或失敗的程式碼傳回。 非同步 RPC 會提供更多機會讓呼叫失敗，而這些失敗會以不同的方式處理，取決於發生的位置和時間。 下表說明呼叫可能失敗的方式，以及處理方式。

## <a name="client-side-cleanup"></a>用戶端清除



| 失敗徵兆                                                                                                                                  | 清除                                                                                                                         |
|--------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------|
| 用戶端在呼叫遠端程式時攔截到例外狀況。                                                                                  | 不需要 RPC API 呼叫。 所有 RPC 狀態都已清除。                                                              |
| 用戶端會收到呼叫完成通知，但是當它呼叫 [**RpcAsyncCompleteCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall)時，它會收到錯誤碼。 | 不需要 RPC API 呼叫。 所有 RPC 狀態都已清除。                                                              |
| 用戶端問題：非 abortive 或 abortive 取消。                                                                                                   | 用戶端必須等待通知，並在通知抵達時呼叫 [**RpcAsyncCompleteCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall) 。 |



 

在伺服器端清除中，重要的概念是現成的概念。 在非同步呼叫的伺服器端處理期間，某些處理通常會在收到呼叫 (也稱為 *發送器執行緒*) 的執行緒上執行，然後選擇性地讓發送器執行緒將足夠的狀態放入記憶體區塊中，並表示另一個執行緒 (又稱為 *工作者執行緒*) 繼續處理呼叫。 發送器執行緒成功發出通知的時間，就是 *所謂的背景工作執行緒。*

## <a name="server-side-cleanup"></a>伺服器端清除



| 發生錯誤      | 清除                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 在手上開始之前。 | 擲回例外狀況。 不需要呼叫 [**RpcAsyncCompleteCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall) 。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 在手上的時候。  | 呼叫 [**RpcAsyncAbortCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasyncabortcall) ，或者，如果錯誤不是嚴重錯誤，而且仍可將結果傳回給用戶端 [**RpcAsyncCompleteCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall)。 如果 **RpcAsyncCompleteCall** 函式呼叫失敗，RPC 執行時間就會釋出參數。 使用者不得存取這些參數。 發送器執行緒不能執行任何可能在離開點之後失敗的大量處理，因為它不再可以安全地中止呼叫。 具體而言，它不一定會在離開點之後擲回例外狀況，否則伺服器可能會損毀。 |



 

## <a name="special-error-handling-cases-for-pipes"></a>管道的特殊錯誤處理案例

使用管道時，有一些特殊的錯誤處理案例。 下列清單說明失敗的來源，以及如何處理錯誤。



| 失敗的來源                                                                                                 | 處理方式                                                                                                |
|-------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------|
| 用戶端呼叫 push，呼叫會失敗。                                                                             | 不需要 RPC API 呼叫。 所有 RPC 狀態都已清除。                                         |
| 用戶端會呼叫 [**RpcAsyncCompleteCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall) ，然後才會清空管線 [**中**](/windows/desktop/Midl/in) 的。 | 呼叫失敗，並出現適當的管道填滿錯誤碼。                                                   |
| 用戶端呼叫提取，而呼叫失敗。                                                                             | 不需要 RPC API 呼叫。 所有 RPC 狀態都已清除。                                         |
| 用戶端或伺服器會以錯誤的順序來呼叫 push 或 pull。                                                    | 執行時間會傳回管道填滿錯誤狀態。                                                                |
| 伺服器呼叫 push 或 pull，呼叫失敗。                                                                     | Push 會傳回失敗碼。 不需要呼叫 [**RpcAsyncCompleteCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall) 。 |
| 在管道耗盡之前，伺服器會呼叫 **RpcAsyncCompleteCall** 。                                         | 管道呼叫會傳回管道填滿錯誤狀態。                                                         |
| 分派之後，接收作業會失敗。                                                                    | 下次伺服器呼叫 pull 來接收管道資料時，就會傳回錯誤。                            |



 

 

 
