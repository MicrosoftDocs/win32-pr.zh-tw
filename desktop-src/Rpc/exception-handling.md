---
title: " (RPC) 的例外狀況處理"
description: RPC 使用與 Windows API 相同的方法來處理例外狀況。
ms.assetid: 7133d3f4-ed84-4cde-bc77-88e73ced9073
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 25de594a648cddb70f26b42e8b0dbf1d6a9dd51d
ms.sourcegitcommit: 8fa6614b715bddf14648cce36d2df22e5232801a
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 12/10/2020
ms.locfileid: "104464132"
---
# <a name="exception-handling-rpc"></a><span data-ttu-id="fd18e-103"> (RPC) 的例外狀況處理</span><span class="sxs-lookup"><span data-stu-id="fd18e-103">Exception Handling (RPC)</span></span>

<span data-ttu-id="fd18e-104">RPC 使用與 Windows API 相同的方法來處理例外狀況。</span><span class="sxs-lookup"><span data-stu-id="fd18e-104">RPC uses the same approach to exception handling as the Windows API.</span></span>

<span data-ttu-id="fd18e-105">[**RpcTryFinally**](rpctryfinally.md)  /  [**RpcFinally**](/previous-versions/aa375699(v=vs.80))  /  [**RpcEndFinally**](/previous-versions/aa375634(v=vs.80))結構相當於 Windows **try-finally** 語句。</span><span class="sxs-lookup"><span data-stu-id="fd18e-105">The [**RpcTryFinally**](rpctryfinally.md) / [**RpcFinally**](/previous-versions/aa375699(v=vs.80)) / [**RpcEndFinally**](/previous-versions/aa375634(v=vs.80)) structure is equivalent to the Windows **try-finally** statement.</span></span> <span data-ttu-id="fd18e-106">RPC 例外狀況結構 [**RpcTryExcept**](rpctryexcept.md)  /  [**RpcExcept**](/windows/desktop/api/Rpc/nf-rpc-rpcexcept)  /  [**RpcEndExcept**](/previous-versions/aa375629(v=vs.80))相當於 Windows **try-except** 語句。</span><span class="sxs-lookup"><span data-stu-id="fd18e-106">The RPC exception construct [**RpcTryExcept**](rpctryexcept.md) / [**RpcExcept**](/windows/desktop/api/Rpc/nf-rpc-rpcexcept) / [**RpcEndExcept**](/previous-versions/aa375629(v=vs.80)) is equivalent to the Windows **try-except** statement.</span></span>

<span data-ttu-id="fd18e-107">當您使用 RPC 例外狀況處理常式時，您的用戶端原始程式碼是可移植的。</span><span class="sxs-lookup"><span data-stu-id="fd18e-107">When you use the RPC exception handlers, your client-side source code is portable.</span></span> <span data-ttu-id="fd18e-108">針對每個平臺提供的不同 RPC 標頭檔會解析每個平臺的 **RpcTry** 和 [**RpcExcept**](/windows/desktop/api/Rpc/nf-rpc-rpcexcept) 宏。</span><span class="sxs-lookup"><span data-stu-id="fd18e-108">The different RPC header files provided for each platform resolve the **RpcTry** and [**RpcExcept**](/windows/desktop/api/Rpc/nf-rpc-rpcexcept) macros for each platform.</span></span> <span data-ttu-id="fd18e-109">在 Windows 環境中，這些宏會直接對應至 Windows **try-finally** 和 **try 以外** 的語句。</span><span class="sxs-lookup"><span data-stu-id="fd18e-109">In the Windows environment, these macros map directly to the Windows **try-finally** and **try-except** statements.</span></span> <span data-ttu-id="fd18e-110">在其他環境中，這些宏會對應到其他平臺特定的例外狀況處理常式。</span><span class="sxs-lookup"><span data-stu-id="fd18e-110">In other environments, these macros map to other platform-specific implementations of exception handlers.</span></span>

<span data-ttu-id="fd18e-111">這些結構所引發的可能例外狀況包括 RPC 函式所傳回的一組錯誤碼，其中包含前置詞 RPC \_ S \_ 和 rpc \_ X，以及 Windows 所傳回的例外狀況集。</span><span class="sxs-lookup"><span data-stu-id="fd18e-111">Potential exceptions raised by these structures include the set of error codes returned by the RPC functions with the prefixes RPC\_S\_ and RPC\_X and the set of exceptions returned by Windows.</span></span> <span data-ttu-id="fd18e-112">如需詳細資訊，請參閱 [RPC 傳回值](rpc-return-values.md)。</span><span class="sxs-lookup"><span data-stu-id="fd18e-112">For details, see [RPC Return Values](rpc-return-values.md).</span></span>

<span data-ttu-id="fd18e-113">雖然 **RpcTry** 和 [**RpcExcept**](/windows/desktop/api/Rpc/nf-rpc-rpcexcept) 宏提供可自訂的平臺中立方式來處理例外狀況，但是在 windows Vista 和更新版本的 windows 中， [**RpcExceptionFilter**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcexceptionfilter) 是處理例外狀況的建議方式。</span><span class="sxs-lookup"><span data-stu-id="fd18e-113">While the **RpcTry** and [**RpcExcept**](/windows/desktop/api/Rpc/nf-rpc-rpcexcept) macros provide a customizable platform-agnostic way to handle exceptions, in Windows Vista and later versions of Windows, [**RpcExceptionFilter**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcexceptionfilter) is the recommended way of handling exceptions.</span></span> <span data-ttu-id="fd18e-114">不需要撰寫自訂篩選器來捕捉許多最常見的結構化例外狀況;不過，自訂例外狀況篩選準則仍然需要 **RpcExcept**。</span><span class="sxs-lookup"><span data-stu-id="fd18e-114">It does not require custom filters to be written to capture many of the most common structured exceptions; however, custom exception filters still require **RpcExcept**.</span></span>

<span data-ttu-id="fd18e-115">伺服器應用程式、伺服器 stub 和伺服器執行時間程式庫中所發生的例外狀況， (傳輸層) 會傳播至用戶端。</span><span class="sxs-lookup"><span data-stu-id="fd18e-115">Exceptions that occur in the server application, server stub, and server run-time library (above the transport layer) are propagated to the client.</span></span> <span data-ttu-id="fd18e-116">從伺服器傳輸層級不會傳播任何例外狀況。</span><span class="sxs-lookup"><span data-stu-id="fd18e-116">No exceptions are propagated from the server-transport level.</span></span> <span data-ttu-id="fd18e-117">伺服器常式將錯誤傳回至 RPC 執行時間的建議方法是擲回例外狀況。</span><span class="sxs-lookup"><span data-stu-id="fd18e-117">The recommended method for a server routine to return errors to the RPC run time is to throw an exception.</span></span> <span data-ttu-id="fd18e-118">伺服器常式可以使用任何適當的方法來傳達伺服器常式之間的錯誤，但如果它遇到防止它執行遠端程式的錯誤，則在清除和傳回 RPC 執行時間之前，應該會引發例外狀況，而不是只將值傳回至只有伺服器常式辨識為錯誤的 RPC。</span><span class="sxs-lookup"><span data-stu-id="fd18e-118">A server routine can use whatever methods is appropriate for communicating errors between server routines, but if it encounters an error that prevents it from executing the remote procedure, it should raise an exception after cleaning up and before returning to the RPC run time, rather than returning a value to RPC that only the server routine recognizes as an error.</span></span>

<span data-ttu-id="fd18e-119">下圖顯示如何將例外狀況從伺服器傳回至用戶端。</span><span class="sxs-lookup"><span data-stu-id="fd18e-119">The following figure shows how exceptions are returned from the server to the client.</span></span>

![例外狀況是透過每個元件的各自 rpc 執行時間，從伺服器傳回至用戶端。](images/prog-a20.png)

<span data-ttu-id="fd18e-121">RPC 例外狀況處理常式與開放式軟體 Foundation-Distributed 運算環境稍有不同， (憑證-DCE) 例外狀況處理宏 **TRY**、 **FINALLY** 和 **CATCH**。</span><span class="sxs-lookup"><span data-stu-id="fd18e-121">The RPC exception handlers differ slightly from the Open Software Foundation-Distributed Computing Environment (OSF-DCE) exception-handling macros **TRY**, **FINALLY**, and **CATCH**.</span></span> <span data-ttu-id="fd18e-122">各廠商提供將憑證-DCE rpc 函式對應至 Microsoft RPC 函數的 include 檔案，包括 **TRY**、 **catch**、 **catch** \_ **ALL** 和 **ENDTRY**。</span><span class="sxs-lookup"><span data-stu-id="fd18e-122">Various vendors provide include files that map the OSF-DCE RPC functions to the Microsoft RPC functions, including **TRY**, **CATCH**, **CATCH**\_**ALL**, and **ENDTRY**.</span></span> <span data-ttu-id="fd18e-123">這些標頭檔也會將 RPC \_ S 錯誤碼對應至 \_ \* 憑證-DCE 例外狀況對應項、rpc \_ s \_ \* ，然後將 rpc \_ x 錯誤碼對應 \_ \* 至 rpc \_ x \_ \* 。</span><span class="sxs-lookup"><span data-stu-id="fd18e-123">These header files also map the RPC\_S\_\* error codes onto the OSF-DCE exception counterparts, rpc\_s\_\*, and map RPC\_X\_\* error codes to rpc\_x\_\*.</span></span> <span data-ttu-id="fd18e-124">針對憑證-DCE 可攜性，請使用這些 include 檔案。</span><span class="sxs-lookup"><span data-stu-id="fd18e-124">For OSF-DCE portability, use these include files.</span></span> <span data-ttu-id="fd18e-125">如需 RPC 例外狀況處理常式的詳細資訊，請參閱 [**RpcExceptionFilter**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcexceptionfilter)、 [**RpcExcept**](/windows/desktop/api/Rpc/nf-rpc-rpcexcept)、 [**RpcFinally**](/previous-versions/aa375699(v=vs.80))。</span><span class="sxs-lookup"><span data-stu-id="fd18e-125">For more information about the RPC exception handlers, see [**RpcExceptionFilter**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcexceptionfilter), [**RpcExcept**](/windows/desktop/api/Rpc/nf-rpc-rpcexcept), [**RpcFinally**](/previous-versions/aa375699(v=vs.80)).</span></span> <span data-ttu-id="fd18e-126">如需 Windows 例外狀況處理常式的詳細資訊，請參閱 [結構化例外狀況處理](/windows/desktop/Debug/structured-exception-handling)。</span><span class="sxs-lookup"><span data-stu-id="fd18e-126">For more information about the Windows exception handlers, see [Structured Exception Handling](/windows/desktop/Debug/structured-exception-handling).</span></span>

 

 
