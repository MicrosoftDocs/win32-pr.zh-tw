---
title: 使用 MSMQ 做為 RPC 傳輸
description: RPC 子系統支援在同步和非同步模式中使用 MSMQ 做為傳輸。
ms.assetid: c3f96a91-b7bb-4c2a-8699-2100324af165
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a647fe4111e3ba4fc2ad0fe05fb7bcb48729a4c2
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/20/2020
ms.locfileid: "103682857"
---
# <a name="using-msmq-as-an-rpc-transport"></a><span data-ttu-id="b4901-103">使用 MSMQ 做為 RPC 傳輸</span><span class="sxs-lookup"><span data-stu-id="b4901-103">Using MSMQ as an RPC Transport</span></span>

<span data-ttu-id="b4901-104">RPC 子系統支援在同步和非同步模式中使用 MSMQ 做為傳輸。</span><span class="sxs-lookup"><span data-stu-id="b4901-104">The RPC subsystem supports using MSMQ as a transport in synchronous and asynchronous modes.</span></span>

<span data-ttu-id="b4901-105">同步模式使用傳統的遠端程序呼叫。</span><span class="sxs-lookup"><span data-stu-id="b4901-105">Synchronous mode uses conventional remote procedure calls.</span></span> <span data-ttu-id="b4901-106">這些呼叫會使用已知的端點和訊息佇列傳輸（ [ncadg \_ mq](/windows/desktop/Midl/ncadg-mq)）作為傳輸通訊協定。</span><span class="sxs-lookup"><span data-stu-id="b4901-106">These calls use well-known endpoints and the message queue transport, [ncadg\_mq](/windows/desktop/Midl/ncadg-mq), as the transport protocol.</span></span> <span data-ttu-id="b4901-107">在同步模式中，您的遠端程式可以有 \[ [in](/windows/desktop/Midl/in) \] 和 \[ [out](/windows/desktop/Midl/out-idl) \] 參數，並且可以使用標準的 RPC 安全性服務。</span><span class="sxs-lookup"><span data-stu-id="b4901-107">In synchronous mode, your remote procedures can have \[ [in](/windows/desktop/Midl/in)\] and \[ [out](/windows/desktop/Midl/out-idl)\] parameters and can use the standard RPC security services.</span></span> <span data-ttu-id="b4901-108">RPC 子系統會針對包含 **\[ out \]** 參數的遠端呼叫建立回復佇列。</span><span class="sxs-lookup"><span data-stu-id="b4901-108">The RPC subsystem creates a reply queue for remote calls containing **\[out\]** parameters.</span></span> <span data-ttu-id="b4901-109">同步模式對於用戶端需要從伺服器接收資料的應用程式很有用。</span><span class="sxs-lookup"><span data-stu-id="b4901-109">The synchronous mode is useful for applications where the client needs to receive data from the server.</span></span> <span data-ttu-id="b4901-110">這種模式的主要限制是，如同傳統的遠端程序呼叫，用戶端和伺服器都必須執行，而且在呼叫期間仍維持執行狀態。</span><span class="sxs-lookup"><span data-stu-id="b4901-110">The main limitation of this mode is that, as with conventional remote procedure calls, both the client and server must be running and remain running for the duration of the call.</span></span>

<span data-ttu-id="b4901-111">非同步模式可讓用戶端應用程式對伺服器進行呼叫，並立即傳回，無論伺服器應用程式或伺服器電腦的狀態為何。</span><span class="sxs-lookup"><span data-stu-id="b4901-111">Asynchronous mode lets client applications make calls to the server and return immediately, regardless of the state of the server application or the server computer.</span></span> <span data-ttu-id="b4901-112">它也會提供可用於管理訊息佇列和資訊流程的 MSMQ 功能子集。</span><span class="sxs-lookup"><span data-stu-id="b4901-112">It also makes a subset of MSMQ features available for managing message queues and information flow.</span></span> <span data-ttu-id="b4901-113">[**RpcBindingSetOption**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetoption)函式可讓您控制服務品質、呼叫優先順序、日誌、安全性，以及伺服器進程佇列的存留期。</span><span class="sxs-lookup"><span data-stu-id="b4901-113">The [**RpcBindingSetOption**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetoption) function lets you control quality of service, call priority, journaling, security, and the lifetime of the server process queue.</span></span> <span data-ttu-id="b4901-114">[**RpcServerUseProtseqEpEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqepex)函數可讓您指定伺服器進程佇列的屬性，例如佇列持續性、驗證和加密。</span><span class="sxs-lookup"><span data-stu-id="b4901-114">The [**RpcServerUseProtseqEpEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqepex) function lets you specify attributes of the server process queue, such as queue persistence, authentication, and encryption.</span></span>

<span data-ttu-id="b4901-115">您可以執行非同步 MSMQ，如同同步 MSMQ 一樣。</span><span class="sxs-lookup"><span data-stu-id="b4901-115">You implement asynchronous MSMQ as you would synchronous MSMQ.</span></span> <span data-ttu-id="b4901-116">您必須使用已知的端點，並定義要 [ncadg \_ mq](/windows/desktop/Midl/ncadg-mq)的傳輸通訊協定。</span><span class="sxs-lookup"><span data-stu-id="b4901-116">You must use well-known endpoints, and define the transport protocol to be [ncadg\_mq](/windows/desktop/Midl/ncadg-mq).</span></span> <span data-ttu-id="b4901-117">在 IDL 檔案中，將 [message](/windows/desktop/Midl/message) 屬性套用至使用非同步訊息佇列的函數。</span><span class="sxs-lookup"><span data-stu-id="b4901-117">In your IDL file, apply the [message](/windows/desktop/Midl/message) attribute to the functions that use asynchronous message queuing.</span></span> <span data-ttu-id="b4901-118">請注意，訊息函數 \[ 只能有 in \] 參數。</span><span class="sxs-lookup"><span data-stu-id="b4901-118">Note that message functions can have \[in\] parameters only.</span></span>

 

 