---
title: 設定負載平衡
description: 設定負載平衡
ms.assetid: c78ffde1-1811-4065-941f-c24692eb144c
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b82dbfc23e491d53a6687b50aa77b23878ce52ec
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/20/2020
ms.locfileid: "104316240"
---
# <a name="configuring-load-balancing"></a><span data-ttu-id="078e9-103">設定負載平衡</span><span class="sxs-lookup"><span data-stu-id="078e9-103">Configuring Load Balancing</span></span>

<span data-ttu-id="078e9-104">每個要作為負載平衡伺服器 (磅) 服務的 RPC Proxy 電腦都必須設定為具有伺服器陣列中伺服器知識的磅服務。</span><span class="sxs-lookup"><span data-stu-id="078e9-104">Each RPC Proxy machine that is to act as a Load Balancing Server (LBS) service must be configured as an LBS service with knowledge of the servers in the server farm.</span></span> <span data-ttu-id="078e9-105">（選擇性）您可以設定預設的資源，並將 Proxy 的安全性設為磅和磅，以設定可設定的 RPC 呼叫。</span><span class="sxs-lookup"><span data-stu-id="078e9-105">Optionally, the default resource can be set and the security of Proxy to LBS and LBS to LBS RPC calls can be set.</span></span> <span data-ttu-id="078e9-106">這些設定是由一組必要的登錄機 **碼** 和 **選用** 的登錄機碼所設定，如下所述。</span><span class="sxs-lookup"><span data-stu-id="078e9-106">These settings are configured by a set of **Required Registry Keys** and **Optional Registry Keys** as described below.</span></span>

## <a name="required-registry-keys"></a><span data-ttu-id="078e9-107">必要的登錄機碼</span><span class="sxs-lookup"><span data-stu-id="078e9-107">Required Registry Keys</span></span>

<span data-ttu-id="078e9-108">需要有數個登錄機碼和值，才能設定磅伺服器。</span><span class="sxs-lookup"><span data-stu-id="078e9-108">Several registry keys and values are required to configure an LBS server.</span></span> <span data-ttu-id="078e9-109">如果有任何索引鍵遺失或輸入錯誤，則會記錄 Windows 事件。</span><span class="sxs-lookup"><span data-stu-id="078e9-109">If any keys are missing or are entered in error, a Windows Event is logged.</span></span> <span data-ttu-id="078e9-110">請參閱每個索引鍵和值的描述，以取得所記錄事件的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="078e9-110">See the description of each key and value for information on the event logged.</span></span>

<span data-ttu-id="078e9-111">若要設定伺服器陣列，必須建立登錄機碼 **HKLM \\ SOFTWARE \\ Microsoft \\ Rpc \\ RpcProxy** ，稱為 **LBSConfiguration**。</span><span class="sxs-lookup"><span data-stu-id="078e9-111">To configure the server farm, a registry key must be created **HKLM\\SOFTWARE\\Microsoft\\Rpc\\RpcProxy** called **LBSConfiguration**.</span></span> <span data-ttu-id="078e9-112">在 **LBSConfiguration** 機碼下，會為伺服器陣列中的每個資源建立金鑰。</span><span class="sxs-lookup"><span data-stu-id="078e9-112">Under the **LBSConfiguration** key, a key is created for each resource in the server farm.</span></span> <span data-ttu-id="078e9-113">索引鍵名稱是資源之 GUID 的字串標記法。</span><span class="sxs-lookup"><span data-stu-id="078e9-113">The key name is the string representation of the GUID for the resource.</span></span> <span data-ttu-id="078e9-114">至少必須有一個資源金鑰存在，而且此資源與系結控制碼、RPC 系結控制碼上的用戶端所設定的 [**UUID**](./rpcdce/ns-rpcdce-uuid.md)相同，當它們建立 RPC/HTTP 系結時 (如需詳細資訊，請參閱 [**RpcBindingSetObject**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetobject)) 。 [**\_ \_**](rpc-binding-handle.md)</span><span class="sxs-lookup"><span data-stu-id="078e9-114">At least one resource key must exist, and this resource is identical to the [**UUID**](./rpcdce/ns-rpcdce-uuid.md) set by clients on the binding handle, [**RPC\_BINDING\_HANDLE**](rpc-binding-handle.md), when they create the RPC/HTTP binding (For more information please see [**RpcBindingSetObject**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetobject)).</span></span> <span data-ttu-id="078e9-115">在每個資源 UUID 索引鍵下，必須存在名為 **ConfigurationType** 的 DWORD 值，以描述所使用的設定。</span><span class="sxs-lookup"><span data-stu-id="078e9-115">Under each Resource UUID key, there must exist a DWORD value named **ConfigurationType** which describes the configuration used.</span></span> <span data-ttu-id="078e9-116">也必須有以分號分隔之伺服器識別碼的 **REG \_ SZ** （稱為 **ServerFarm**）。</span><span class="sxs-lookup"><span data-stu-id="078e9-116">There must also exist a **REG\_SZ** of semicolon delimited server identifiers called **ServerFarm**.</span></span> <span data-ttu-id="078e9-117">**ServerFarm** 機碼中識別的伺服器是負載平衡伺服器陣列成員的伺服器。</span><span class="sxs-lookup"><span data-stu-id="078e9-117">The servers identified in the **ServerFarm** key are the servers which are members of the load balancing server farm.</span></span>

<span data-ttu-id="078e9-118">以下是所需登錄機碼和值的詳細細目：</span><span class="sxs-lookup"><span data-stu-id="078e9-118">The following is a detailed breakdown of the required registry keys and values:</span></span>

<span data-ttu-id="078e9-119">**HKLM \\ SOFTWARE \\ Microsoft \\ Rpc \\ RpcProxy \\ LBSConfiguration**</span><span class="sxs-lookup"><span data-stu-id="078e9-119">**HKLM\\SOFTWARE\\Microsoft\\Rpc\\RpcProxy\\LBSConfiguration**</span></span>

<span data-ttu-id="078e9-120">登錄機碼。</span><span class="sxs-lookup"><span data-stu-id="078e9-120">Registry Key.</span></span> <span data-ttu-id="078e9-121">**LBSConfiguration** 機碼是持有磅設定的登錄機碼。</span><span class="sxs-lookup"><span data-stu-id="078e9-121">The **LBSConfiguration** key is the registry key that holds the LBS configuration.</span></span> <span data-ttu-id="078e9-122">這包括要平衡負載的資源 [**uuid**](./rpcdce/ns-rpcdce-uuid.md) 、每個資源的設定類型，以及伺服器陣列中參與負載平衡的伺服器。</span><span class="sxs-lookup"><span data-stu-id="078e9-122">This includes the Resource [**UUIDs**](./rpcdce/ns-rpcdce-uuid.md) that are to be load balanced, the configuration type for each resource and the servers in the server farms which participate in load balancing.</span></span> <span data-ttu-id="078e9-123">如果此金鑰遺失或無效，則不會將磅視為已設定，而且不會執行磅服務。</span><span class="sxs-lookup"><span data-stu-id="078e9-123">If this key is missing or invalid, LBS will not be considered to be configured and the LBS service will not run.</span></span>

\-

<span data-ttu-id="078e9-124">**HKLM \\ SOFTWARE \\ Microsoft \\ Rpc \\ RpcProxy \\ LBSConfiguration 的 \\ xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx**</span><span class="sxs-lookup"><span data-stu-id="078e9-124">**HKLM\\SOFTWARE\\Microsoft\\Rpc\\RpcProxy\\LBSConfiguration\\XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX**</span></span>

<span data-ttu-id="078e9-125">登錄機碼。</span><span class="sxs-lookup"><span data-stu-id="078e9-125">Registry Key.</span></span> <span data-ttu-id="078e9-126">**資源 uuid** 索引鍵會識別要進行負載平衡的資源 uuid。</span><span class="sxs-lookup"><span data-stu-id="078e9-126">The **Resource UUID** key identifies the resource UUID to be load balanced.</span></span> <span data-ttu-id="078e9-127">此資源 UUID 與用戶端在系結控制碼、RPC 系結 [**\_ \_ 控制碼**](rpc-binding-handle.md)上設定的 [**uuid**](./rpcdce/ns-rpcdce-uuid.md)相同。</span><span class="sxs-lookup"><span data-stu-id="078e9-127">This resource UUID is the same as the [**UUID**](./rpcdce/ns-rpcdce-uuid.md) that clients set on the binding handle, [**RPC\_BINDING\_HANDLE**](rpc-binding-handle.md).</span></span> <span data-ttu-id="078e9-128">至少必須要有一個資源 UUID 可進行負載平衡，可能有多個資源 Uuid。</span><span class="sxs-lookup"><span data-stu-id="078e9-128">There must be at least one resource UUID to be load balanced, there may be multiple resource UUIDs.</span></span> <span data-ttu-id="078e9-129">伺服器陣列中的所有伺服器都只能有一個伺服器陣列，而且所有端點都必須在伺服器陣列中的所有伺服器上。</span><span class="sxs-lookup"><span data-stu-id="078e9-129">There can be only one server farm and all endpoints must be on all servers within the server farm.</span></span> <span data-ttu-id="078e9-130">如果無法將此金鑰剖析為有效的 UUID，事件 **RPCPROXY \_ EVENTLOG \_ LB \_ \_ (0xC0000006)** 將會記錄到 Windows 事件記錄檔中。</span><span class="sxs-lookup"><span data-stu-id="078e9-130">If this key cannot be parsed to a valid UUID, the event **RPCPROXY\_EVENTLOG\_LB\_INVALID\_KEY (0xC0000006)** will be logged to the Windows Event Log.</span></span>

\-

<span data-ttu-id="078e9-131">**HKLM \\ SOFTWARE \\ Microsoft \\ Rpc \\ RpcProxy \\ LBSConfiguration \\ xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx 的 \\ ConfigurationType**</span><span class="sxs-lookup"><span data-stu-id="078e9-131">**HKLM\\SOFTWARE\\Microsoft\\Rpc\\RpcProxy\\LBSConfiguration\\XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\\ConfigurationType**</span></span>

<span data-ttu-id="078e9-132">DWORD。</span><span class="sxs-lookup"><span data-stu-id="078e9-132">DWORD.</span></span> <span data-ttu-id="078e9-133">**ConfigurationType** DWORD 會儲存在 **資源 UUID** 索引鍵下。</span><span class="sxs-lookup"><span data-stu-id="078e9-133">The **ConfigurationType** DWORD is stored under the **Resource UUID** key.</span></span> <span data-ttu-id="078e9-134">唯一允許的值為1。</span><span class="sxs-lookup"><span data-stu-id="078e9-134">The only allowed value is 1.</span></span> <span data-ttu-id="078e9-135">如果這個值是1以外的任何值，事件 **RPCPROXY \_ EVENTLOG \_ LB \_ \_ \_ (0XC0000007)** 將會記錄到 Windows 事件記錄檔中。</span><span class="sxs-lookup"><span data-stu-id="078e9-135">If this value is anything other than 1, the event **RPCPROXY\_EVENTLOG\_LB\_UNKNOWN\_CFG\_TYPE (0xC0000007)** will be logged to the Windows Event Log.</span></span>

\-

<span data-ttu-id="078e9-136">**HKLM \\ SOFTWARE \\ Microsoft \\ Rpc \\ RpcProxy \\ LBSConfiguration \\ xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx 的 \\ ServerFarm**</span><span class="sxs-lookup"><span data-stu-id="078e9-136">**HKLM\\SOFTWARE\\Microsoft\\Rpc\\RpcProxy\\LBSConfiguration\\XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\\ServerFarm**</span></span>

<span data-ttu-id="078e9-137">REG \_ SZ。</span><span class="sxs-lookup"><span data-stu-id="078e9-137">REG\_SZ.</span></span> <span data-ttu-id="078e9-138">**ServerFarm** 登錄值包含伺服器識別碼的分號 delimitated 清單。</span><span class="sxs-lookup"><span data-stu-id="078e9-138">The **ServerFarm** registry value contains a semicolon delimitated list of server identifiers.</span></span> <span data-ttu-id="078e9-139">伺服器識別碼的格式為：</span><span class="sxs-lookup"><span data-stu-id="078e9-139">The format for the server identifiers is:</span></span>

<span data-ttu-id="078e9-140">"ServerID1，ServerPort1，LBSPort1， \[ LBSPort2，.。。LBSPortN \] ; "</span><span class="sxs-lookup"><span data-stu-id="078e9-140">"ServerID1,ServerPort1,LBSPort1,\[LBSPort2, …LBSPortN\];"</span></span>

<span data-ttu-id="078e9-141">**ServerFarm** 登錄機碼中應該會列出多個伺服器識別碼。</span><span class="sxs-lookup"><span data-stu-id="078e9-141">Multiple server identifiers should be listed in the **ServerFarm** registry key.</span></span> <span data-ttu-id="078e9-142">它們必須以分號分隔。</span><span class="sxs-lookup"><span data-stu-id="078e9-142">They must be delimited by a semicolon.</span></span> <span data-ttu-id="078e9-143">下表說明屬於伺服器識別碼的欄位。</span><span class="sxs-lookup"><span data-stu-id="078e9-143">The fields which are part of the server identifier are described in the following table.</span></span> <span data-ttu-id="078e9-144">如果無法正確剖析此欄位，事件 **RPCPROXY \_ EVENTLOG \_ LB LB \_ \_ \_ (0XC0000008)** 將會記錄到 Windows 事件記錄檔中。</span><span class="sxs-lookup"><span data-stu-id="078e9-144">If this field cannot be parsed correctly, the event **RPCPROXY\_EVENTLOG\_LB\_BAD\_CONFIG\_ENTRY (0xC0000008)** will be logged to the Windows Event Log.</span></span>



| <span data-ttu-id="078e9-145">識別碼欄位</span><span class="sxs-lookup"><span data-stu-id="078e9-145">Identifier Field</span></span> | <span data-ttu-id="078e9-146">需求</span><span class="sxs-lookup"><span data-stu-id="078e9-146">Requirement</span></span> | <span data-ttu-id="078e9-147">描述</span><span class="sxs-lookup"><span data-stu-id="078e9-147">Description</span></span>                                                                                                                                                                                                                                                                        |
|------------------|-------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="078e9-148">ServerID</span><span class="sxs-lookup"><span data-stu-id="078e9-148">ServerID</span></span>         | <span data-ttu-id="078e9-149">必要</span><span class="sxs-lookup"><span data-stu-id="078e9-149">Required</span></span>    | <span data-ttu-id="078e9-150">伺服器的可解析網路名稱。</span><span class="sxs-lookup"><span data-stu-id="078e9-150">A resolvable network name for the server.</span></span> <span data-ttu-id="078e9-151">這可以是 DNS 名稱、netbios 名稱或 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="078e9-151">This can be a DNS name, a netbios name, or an IP address.</span></span>                                                                                                                                                                                |
| <span data-ttu-id="078e9-152">ServerPort</span><span class="sxs-lookup"><span data-stu-id="078e9-152">ServerPort</span></span>       | <span data-ttu-id="078e9-153">選擇性</span><span class="sxs-lookup"><span data-stu-id="078e9-153">Optional</span></span>    | <span data-ttu-id="078e9-154">如果指定的話，伺服器會在此埠上接聽 RPC/HTTP 連接。</span><span class="sxs-lookup"><span data-stu-id="078e9-154">If specified, the port on which the server listens for RPC/HTTP connections.</span></span> <span data-ttu-id="078e9-155">如果未指定，則會使用伺服器電腦上的結束點對應程式來尋找伺服器埠。</span><span class="sxs-lookup"><span data-stu-id="078e9-155">If not specified, the End point mapper on the server machine is used to find the server port.</span></span>                                                                                                         |
| <span data-ttu-id="078e9-156">LBSPort</span><span class="sxs-lookup"><span data-stu-id="078e9-156">LBSPort</span></span>          | <span data-ttu-id="078e9-157">選擇性</span><span class="sxs-lookup"><span data-stu-id="078e9-157">Optional</span></span>    | <span data-ttu-id="078e9-158">如果指定的話，則為伺服器在其上接聽磅的埠。</span><span class="sxs-lookup"><span data-stu-id="078e9-158">If specified, the port the on which the server listens for LBS.</span></span> <span data-ttu-id="078e9-159">若要使用此金鑰，您必須使用 netsh RPC firewall 命令將磅介面設定為靜態端點。</span><span class="sxs-lookup"><span data-stu-id="078e9-159">To use this key, the LBS interfaces must be set to a static endpoint using a netsh RPC firewall command.</span></span> <span data-ttu-id="078e9-160">如需 netsh 命令的範例，請參閱 [負載平衡最佳做法](load-balancing-best-practices.md) 。</span><span class="sxs-lookup"><span data-stu-id="078e9-160">See [Load Balancing Best Practices](load-balancing-best-practices.md) for examples of the netsh command.</span></span> |



 

## <a name="optional-registry-keys"></a><span data-ttu-id="078e9-161">選用的登錄機碼</span><span class="sxs-lookup"><span data-stu-id="078e9-161">Optional Registry Keys</span></span>

<span data-ttu-id="078e9-162">有三個選擇性的登錄值可設定磅伺服器。</span><span class="sxs-lookup"><span data-stu-id="078e9-162">There are three optional registry values to configure an LBS server.</span></span> <span data-ttu-id="078e9-163">金鑰主要是控制對磅服務進行呼叫的安全性層級，也會控制要使用的預設資源 UUID。</span><span class="sxs-lookup"><span data-stu-id="078e9-163">The keys primarily control the level of security for calls to and from the LBS service, and also control the default resource UUID to be used.</span></span> <span data-ttu-id="078e9-164">以下是選用值：</span><span class="sxs-lookup"><span data-stu-id="078e9-164">The following are optional values:</span></span>

<span data-ttu-id="078e9-165">以下是所需登錄機碼和值的詳細細目：</span><span class="sxs-lookup"><span data-stu-id="078e9-165">The following is a detailed breakdown of the required registry keys and values:</span></span>

<span data-ttu-id="078e9-166">**HKLM \\ SOFTWARE \\ Microsoft \\ Rpc \\ RpcProxy \\ LBSConfiguration \\ NoSecurity**</span><span class="sxs-lookup"><span data-stu-id="078e9-166">**HKLM\\SOFTWARE\\Microsoft\\Rpc\\RpcProxy\\LBSConfiguration\\NoSecurity**</span></span>

<span data-ttu-id="078e9-167">DWORD。</span><span class="sxs-lookup"><span data-stu-id="078e9-167">DWORD.</span></span> <span data-ttu-id="078e9-168">當 **NoSecurity** DWORD 不存在或設為0時，會拒絕對磅服務的傳入非安全呼叫。</span><span class="sxs-lookup"><span data-stu-id="078e9-168">When the **NoSecurity** DWORD is not present or set to 0, incoming non-secure calls to the LBS service are rejected.</span></span> <span data-ttu-id="078e9-169">如果存在且不是0，則不會拒絕對磅服務的連入非安全呼叫。</span><span class="sxs-lookup"><span data-stu-id="078e9-169">When present and not 0, incoming non-secure calls to the LBS service are not rejected.</span></span> <span data-ttu-id="078e9-170">此金鑰會在啟動磅服務時讀取一次。</span><span class="sxs-lookup"><span data-stu-id="078e9-170">This key is read once on startup of the LBS service.</span></span>

\-

<span data-ttu-id="078e9-171">**HKLM \\ SOFTWARE \\ Microsoft \\ Rpc \\ RpcProxy \\ LBSConfiguration \\ AssumeResourceUUID**</span><span class="sxs-lookup"><span data-stu-id="078e9-171">**HKLM\\SOFTWARE\\Microsoft\\Rpc\\RpcProxy\\LBSConfiguration\\AssumeResourceUUID**</span></span>

<span data-ttu-id="078e9-172">DWORD。</span><span class="sxs-lookup"><span data-stu-id="078e9-172">DWORD.</span></span> <span data-ttu-id="078e9-173">當 **AssumeResourceUUID** DWORD 不存在時，就不會發生任何變更。</span><span class="sxs-lookup"><span data-stu-id="078e9-173">When the **AssumeResourceUUID** DWORD is not present no change in the LBS service occurs.</span></span> <span data-ttu-id="078e9-174">當其存在時，必須使用有效的 [**UUID**](./rpcdce/ns-rpcdce-uuid.md)來設定。</span><span class="sxs-lookup"><span data-stu-id="078e9-174">When present, it must be set with a valid [**UUID**](./rpcdce/ns-rpcdce-uuid.md).</span></span> <span data-ttu-id="078e9-175">此 **UUID** 將作為未指定資源 uuid 之所有連接的資源 uuid。</span><span class="sxs-lookup"><span data-stu-id="078e9-175">This **UUID** will be used as the resource UUID for all connections which do not specify a resource UUID.</span></span> <span data-ttu-id="078e9-176">這通常用於用戶端建立 RPC/HTTP 系結時未指定資源 UUID 的情況，但系統管理員希望將 RPC/HTTP 流量負載平衡到伺服器陣列。</span><span class="sxs-lookup"><span data-stu-id="078e9-176">This is commonly used in cases where clients do not specify a Resource UUID when they create the RPC/HTTP binding, but an administrator wishes to load balance the RPC/HTTP traffic to a server farm.</span></span> <span data-ttu-id="078e9-177">如果無法將此索引鍵剖析為 UUID，則會 lodged 內部 RPC 錯誤，如果已啟用，則會產生 [**rpc \_ 擴充的 \_ 錯誤 \_ 資訊**](/windows/win32/api/rpcasync/ns-rpcasync-rpc_extended_error_info) 。</span><span class="sxs-lookup"><span data-stu-id="078e9-177">If this key cannot be parsed to a UUID, an internal RPC error is lodged, generating [**RPC\_EXTENDED\_ERROR\_INFO**](/windows/win32/api/rpcasync/ns-rpcasync-rpc_extended_error_info) if it is enabled.</span></span>

\-

<span data-ttu-id="078e9-178">**HKLM \\ Software \\ Microsoft \\ Rpc \\ RPCHTTPLBSServer \\ NoSecurity**</span><span class="sxs-lookup"><span data-stu-id="078e9-178">**HKLM\\Software\\Microsoft\\Rpc\\RPCHTTPLBSServer\\NoSecurity**</span></span>

<span data-ttu-id="078e9-179">DWORD。</span><span class="sxs-lookup"><span data-stu-id="078e9-179">DWORD.</span></span> <span data-ttu-id="078e9-180">當 **NoSecurity** DWORD 未呈現或設為0時，對磅服務發出的所有撥出電話都會有安全性。</span><span class="sxs-lookup"><span data-stu-id="078e9-180">When the **NoSecurity** DWORD is not presented or set to 0, all outgoing calls made to LBS services will have security.</span></span> <span data-ttu-id="078e9-181">如果存在且未設定為0，則對磅服務發出的所有撥出電話都不會有安全性。</span><span class="sxs-lookup"><span data-stu-id="078e9-181">If present and not set to 0, all outgoing calls made to LBS services will not have security.</span></span> <span data-ttu-id="078e9-182">請確定此設定符合 **HKLM \\ SOFTWARE \\ Microsoft \\ Rpc \\ RpcProxy \\ LBSConfiguration \\ NoSecurity** 設定。</span><span class="sxs-lookup"><span data-stu-id="078e9-182">Ensure this setting matches the **HKLM\\SOFTWARE\\Microsoft\\Rpc\\RpcProxy\\LBSConfiguration\\NoSecurity** setting.</span></span>

 

 