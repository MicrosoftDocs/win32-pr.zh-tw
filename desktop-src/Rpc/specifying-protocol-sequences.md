---
title: 指定通訊協定順序
description: 伺服器應用程式必須選取一或多個通訊協定順序，以在透過網路與用戶端進行通訊時使用。 通訊協定順序的選擇與網路相依。 請參閱解讀系結資訊和選取通訊協定順序。
ms.assetid: bde26a86-dc4f-4d18-ba51-c6536c62bb75
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a700299e3d2bd98fa5fb0aaebea25e907d85afb0
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/20/2020
ms.locfileid: "104315892"
---
# <a name="specifying-protocol-sequences"></a><span data-ttu-id="56aa4-105">指定通訊協定順序</span><span class="sxs-lookup"><span data-stu-id="56aa4-105">Specifying Protocol Sequences</span></span>

<span data-ttu-id="56aa4-106">伺服器應用程式必須選取一或多個通訊協定順序，以在透過網路與用戶端進行通訊時使用。</span><span class="sxs-lookup"><span data-stu-id="56aa4-106">Server applications must select one or more protocol sequences to use when communicating with the client over the network.</span></span> <span data-ttu-id="56aa4-107">通訊協定順序的選擇與網路相依。</span><span class="sxs-lookup"><span data-stu-id="56aa4-107">The choice of protocol sequences is network-dependent.</span></span> <span data-ttu-id="56aa4-108">請參閱解讀系結 [資訊](interpreting-binding-information.md) 和 [選取通訊協定順序](selecting-a-protocol-sequence.md)。</span><span class="sxs-lookup"><span data-stu-id="56aa4-108">See [Interpreting Binding Information](interpreting-binding-information.md) and [Selecting a Protocol Sequence](selecting-a-protocol-sequence.md).</span></span>

<span data-ttu-id="56aa4-109">您的伺服器程式可能會允許用戶端使用網路支援的任何通訊協定順序來進行連接。</span><span class="sxs-lookup"><span data-stu-id="56aa4-109">Your server program may allow clients to connect using any protocol sequence that the network supports.</span></span> <span data-ttu-id="56aa4-110">若要這樣做，請叫用 [**RpcServerUseAllProtseqs**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseallprotseqs) 並傳遞 RPC \_ C \_ PROTSEQ \_ MAX \_ 先決條件 \_ DEFAULT 作為第一個參數。</span><span class="sxs-lookup"><span data-stu-id="56aa4-110">To do this, invoke [**RpcServerUseAllProtseqs**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseallprotseqs) and pass RPC\_C\_PROTSEQ\_MAX\_REQS\_DEFAULT as the first parameter.</span></span> <span data-ttu-id="56aa4-111">不過，這不是建議的方法。</span><span class="sxs-lookup"><span data-stu-id="56aa4-111">However, that is not the recommended approach.</span></span> <span data-ttu-id="56aa4-112">相反地，針對遠端呼叫使用 **ncalrpc** 進行本機呼叫和 **ncacn \_ ip \_ tcp** 或 **ncacn \_ HTTP** 通常就已足夠。</span><span class="sxs-lookup"><span data-stu-id="56aa4-112">Rather, using **ncalrpc** for local calls and **ncacn\_ip\_tcp** or **ncacn\_http** for remote calls is usually sufficient.</span></span> <span data-ttu-id="56aa4-113">[不尋常的網路] 很罕見，而且幾乎所有網路都支援 TCP/IP。</span><span class="sxs-lookup"><span data-stu-id="56aa4-113">Heterogenous networks are uncommon, and virtually all networks support TCP/IP.</span></span>

<span data-ttu-id="56aa4-114">如果您想要讓用戶端將動態端點的埠配置限制為特定的埠範圍，請改為呼叫 [**RpcServerUseAllProtseqsEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseallprotseqsex) 。</span><span class="sxs-lookup"><span data-stu-id="56aa4-114">If you want your client to restrict port allocation for dynamic endpoints to a specific port range, call [**RpcServerUseAllProtseqsEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseallprotseqsex) instead.</span></span> <span data-ttu-id="56aa4-115">這是 Microsoft RPC 專用的函式，對於通過防火牆的遠端程序呼叫而言非常有用。</span><span class="sxs-lookup"><span data-stu-id="56aa4-115">This function is specific to Microsoft RPC, and is extremely useful for remote procedure calls that pass through a firewall.</span></span> <span data-ttu-id="56aa4-116">它會使用額外的參數將埠配置控制旗標傳遞給函式。</span><span class="sxs-lookup"><span data-stu-id="56aa4-116">It uses an extra parameter to pass port allocation control flags to the function.</span></span> <span data-ttu-id="56aa4-117">請參閱設定登錄 [的埠配置和選擇性](configuring-the-windows-xp-2000-nt-registry-for-port-allocations-and-selective-binding.md)系結。</span><span class="sxs-lookup"><span data-stu-id="56aa4-117">See [Configuring the Registry for Port Allocations and Selective Binding](configuring-the-windows-xp-2000-nt-registry-for-port-allocations-and-selective-binding.md).</span></span>

<span data-ttu-id="56aa4-118">您可以在開發伺服器的介面時，于 MIDL 檔案中指定通訊協定序列和端點資訊。</span><span class="sxs-lookup"><span data-stu-id="56aa4-118">You can specify protocol sequences and endpoint information in your MIDL file when you develop the server's interfaces.</span></span> <span data-ttu-id="56aa4-119">如果您這樣做，您的伺服器應該使用 [**RpcServerUseAllProtseqsIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseallprotseqsif) 來註冊 IDL 檔案中提供的所有通訊協定序列和相關聯的端點資訊。</span><span class="sxs-lookup"><span data-stu-id="56aa4-119">If you do, your server should use [**RpcServerUseAllProtseqsIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseallprotseqsif) to register all the protocol sequences and associated endpoint information provided in the IDL file.</span></span> <span data-ttu-id="56aa4-120">此外，也有一個對應的 [**RpcServerUseAllProtseqsIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseallprotseqsifex) 函式，也可讓伺服器傳遞通訊埠配置（控制旗標）。</span><span class="sxs-lookup"><span data-stu-id="56aa4-120">In addition, there is a corresponding [**RpcServerUseAllProtseqsIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseallprotseqsifex) function that also allows the server to pass port allocation–control flags.</span></span>

<span data-ttu-id="56aa4-121">如果您想要將用戶端和伺服器程式設定為與指定的通訊協定順序通訊，伺服器應用程式應該呼叫 [**RpcServerUseProtseq**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseq)。</span><span class="sxs-lookup"><span data-stu-id="56aa4-121">If you want to configure your client and server programs to communicate with a specified protocol sequence, the server application should call [**RpcServerUseProtseq**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseq).</span></span> <span data-ttu-id="56aa4-122">如需 Microsoft RPC 通訊協定順序的完整清單，請參閱 [通訊協定順序常數](protocol-sequence-constants.md)。</span><span class="sxs-lookup"><span data-stu-id="56aa4-122">For a complete list of Microsoft RPC protocol sequences, see [Protocol Sequence Constants](protocol-sequence-constants.md).</span></span>

<span data-ttu-id="56aa4-123">Microsoft RPC 也提供 [**RpcServerUseProtseqEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqex) ，讓應用程式可以選取特定的通訊協定順序，以及控制動態埠配置。</span><span class="sxs-lookup"><span data-stu-id="56aa4-123">Microsoft RPC also provides [**RpcServerUseProtseqEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqex) to enable applications to select specific protocol sequences and control dynamic port allocation.</span></span>

<span data-ttu-id="56aa4-124">除了連接導向的通訊協定以外，Microsoft RPC 也支援資料包 (無連線的) 通訊協定。</span><span class="sxs-lookup"><span data-stu-id="56aa4-124">In addition to connection-oriented protocols, Microsoft RPC supports datagram (connectionless) protocols as well.</span></span> <span data-ttu-id="56aa4-125">建議使用連線導向的通訊協定;資料包通訊協定與連接導向的通訊協定具有不同的功能集，只有在分散式系統開發人員需要的功能只適用于資料包通訊協定時，才會使用。</span><span class="sxs-lookup"><span data-stu-id="56aa4-125">Connection-oriented protocols are recommended; datagram protocols have different feature sets than connection-oriented protocols, and should only be used if a distributed system developer requires a feature available only in datagram protocols.</span></span> <span data-ttu-id="56aa4-126">使用資料包通訊協定時可用的部分功能包括：</span><span class="sxs-lookup"><span data-stu-id="56aa4-126">Some of the features available when using datagram protocols are:</span></span>

-   <span data-ttu-id="56aa4-127">資料包支援 UDP 和 IPX 無連接傳輸通訊協定。</span><span class="sxs-lookup"><span data-stu-id="56aa4-127">Datagrams support the UDP and IPX connectionless transport protocols.</span></span>
-   <span data-ttu-id="56aa4-128">因為不需要建立和維護連線，所以資料包 RPC 通訊協定需要較少的資源負擔。</span><span class="sxs-lookup"><span data-stu-id="56aa4-128">Because it is not necessary to establish and maintain a connection, the datagram RPC protocol requires less resource overhead.</span></span>
-   <span data-ttu-id="56aa4-129">資料包可加快系結的速度。</span><span class="sxs-lookup"><span data-stu-id="56aa4-129">Datagrams enable faster binding.</span></span>
-   <span data-ttu-id="56aa4-130">如同連接導向 RPC，資料包 RPC 呼叫預設為 *nonidempotent*。</span><span class="sxs-lookup"><span data-stu-id="56aa4-130">As with connection-oriented RPC, datagram RPC calls are by default *nonidempotent*.</span></span> <span data-ttu-id="56aa4-131">這表示不保證會執行一次以上的呼叫。</span><span class="sxs-lookup"><span data-stu-id="56aa4-131">This means the call is guaranteed not to be executed more than once.</span></span> <span data-ttu-id="56aa4-132">不過，函式可以在 IDL 檔案中標示為等冪，告知 RPC 在回應單一用戶端要求時，不會多次執行函數。</span><span class="sxs-lookup"><span data-stu-id="56aa4-132">However, a function can be marked as idempotent in the IDL file telling RPC that it is harmless to execute the function more than once in response to a single, client request.</span></span> <span data-ttu-id="56aa4-133">這可讓執行時間在伺服器上維持較少的狀態。</span><span class="sxs-lookup"><span data-stu-id="56aa4-133">This allows the run time to maintain less state on the server.</span></span> <span data-ttu-id="56aa4-134">請注意，等冪呼叫只會在不穩定網路上的罕見情況下重新執行。</span><span class="sxs-lookup"><span data-stu-id="56aa4-134">Note that an idempotent call would be re-executed only in rare circumstances on an unstable network.</span></span>
-   <span data-ttu-id="56aa4-135">資料包 RPC 支援 [廣播](/windows/desktop/Midl/broadcast) IDL 屬性。</span><span class="sxs-lookup"><span data-stu-id="56aa4-135">Datagram RPC supports the [broadcast](/windows/desktop/Midl/broadcast) IDL attribute.</span></span> <span data-ttu-id="56aa4-136">廣播可讓用戶端同時對多部伺服器發出訊息。</span><span class="sxs-lookup"><span data-stu-id="56aa4-136">Broadcast enables a client to issue messages to multiple servers at the same time.</span></span> <span data-ttu-id="56aa4-137">這可讓用戶端找到網路上數個可用伺服器的其中一個，或同時控制多部伺服器。</span><span class="sxs-lookup"><span data-stu-id="56aa4-137">This lets the client locate one of several available servers on the network, or control multiple servers simultaneously.</span></span> <span data-ttu-id="56aa4-138">請注意，資料包廣播只在本機連結內有效，且通常不會跨路由器。</span><span class="sxs-lookup"><span data-stu-id="56aa4-138">Note that the datagram broadcast is valid only within the local link, and usually does not cross routers.</span></span> <span data-ttu-id="56aa4-139">廣播呼叫是隱含等冪的。</span><span class="sxs-lookup"><span data-stu-id="56aa4-139">Broadcast calls are implicitly idempotent.</span></span> <span data-ttu-id="56aa4-140">如果呼叫包含 \[ **out** \] 參數，則只會傳回第一個伺服器回應。</span><span class="sxs-lookup"><span data-stu-id="56aa4-140">If the call contains \[**out**\] parameters, only the first server response is returned.</span></span> <span data-ttu-id="56aa4-141">一旦伺服器回應，所有未來對該系結控制碼的 Rpc 都只會傳送到該伺服器，包括具有廣播屬性的呼叫。</span><span class="sxs-lookup"><span data-stu-id="56aa4-141">Once a server responds, all future RPCs over that binding handle will be sent to that server only, including calls with the broadcast attribute.</span></span> <span data-ttu-id="56aa4-142">若要傳送另一個廣播，請建立新的系結控制碼，或在現有的控制碼上呼叫 [**RpcBindingReset**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingreset) 。</span><span class="sxs-lookup"><span data-stu-id="56aa4-142">To send another broadcast, create a new binding handle or call [**RpcBindingReset**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingreset) on the existing handle.</span></span>
-   <span data-ttu-id="56aa4-143">資料包 RPC 支援 [可能](/windows/desktop/Midl/maybe) 的 IDL 屬性。</span><span class="sxs-lookup"><span data-stu-id="56aa4-143">Datagram RPC supports the [maybe](/windows/desktop/Midl/maybe) IDL attribute.</span></span> <span data-ttu-id="56aa4-144">這可讓用戶端傳送呼叫給伺服器，而不需等待回應或確認。</span><span class="sxs-lookup"><span data-stu-id="56aa4-144">This lets the client send a call to the server without waiting for a response or confirmation.</span></span> <span data-ttu-id="56aa4-145">呼叫不能包含 \[ **out** \] 參數。</span><span class="sxs-lookup"><span data-stu-id="56aa4-145">The call cannot contain \[**out**\] parameters.</span></span> <span data-ttu-id="56aa4-146">使用的呼叫 **\[ 可能 \]** 會隱含等冪。</span><span class="sxs-lookup"><span data-stu-id="56aa4-146">Calls using the **\[maybe\]** calls are implicitly idempotent.</span></span>

 

 