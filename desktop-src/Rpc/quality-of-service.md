---
title: '服務品質 (RPC) '
description: 用戶端程式可以使用 RpcBindingSetAuthInfoEx 函式，而不是 RpcBindingSetAuthInfo 函式來建立已驗證的系結。
ms.assetid: bc3d47ba-3c1b-4aba-8fe3-b4501a621931
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ee93b1aa376c9d6f4e2b3eedab73c91471d42498
ms.sourcegitcommit: 8fa6614b715bddf14648cce36d2df22e5232801a
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 12/10/2020
ms.locfileid: "103842967"
---
# <a name="quality-of-service-rpc"></a><span data-ttu-id="d5064-103">服務品質 (RPC) </span><span class="sxs-lookup"><span data-stu-id="d5064-103">Quality of Service (RPC)</span></span>

<span data-ttu-id="d5064-104">用戶端程式可以使用 [**RpcBindingSetAuthInfoEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetauthinfoexa) 函式，而不是 [**RpcBindingSetAuthInfo**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetauthinfo) 函式來建立已驗證的系結。</span><span class="sxs-lookup"><span data-stu-id="d5064-104">Client programs can use the [**RpcBindingSetAuthInfoEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetauthinfoexa) function rather than the [**RpcBindingSetAuthInfo**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetauthinfo) function to create an authenticated binding.</span></span> <span data-ttu-id="d5064-105">如果有，則會將指向 [**RPC \_ 安全性 \_ QOS**](/windows/desktop/api/Rpcdce/ns-rpcdce-rpc_security_qos) 結構的指標傳遞為 **RpcBindingSetAuthInfoEx** 的最後一個參數。</span><span class="sxs-lookup"><span data-stu-id="d5064-105">If they do, they pass a pointer to an [**RPC\_SECURITY\_QOS**](/windows/desktop/api/Rpcdce/ns-rpcdce-rpc_security_qos) structure as the final parameter of **RpcBindingSetAuthInfoEx**.</span></span> <span data-ttu-id="d5064-106">此結構包含服務品質的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="d5064-106">This structure contains information about the quality of service.</span></span> <span data-ttu-id="d5064-107">用戶端程式也可以指定身分識別追蹤，然後選取模擬類型。</span><span class="sxs-lookup"><span data-stu-id="d5064-107">Client programs can also specify the identity tracking and select the impersonation type.</span></span>

<span data-ttu-id="d5064-108">使用 [**RPC \_ 安全性 \_ QOS**](/windows/desktop/api/Rpcdce/ns-rpcdce-rpc_security_qos)結構的 **功能** 成員，來設定用戶端/伺服器應用程式的哪些部分經過驗證。</span><span class="sxs-lookup"><span data-stu-id="d5064-108">Use the **Capabilities** member of the [**RPC\_SECURITY\_QOS**](/windows/desktop/api/Rpcdce/ns-rpcdce-rpc_security_qos) structure to set which portions of the client/server application are authenticated.</span></span> <span data-ttu-id="d5064-109">如果 \_ \_ 選取 [rpc C QOS 功能] \_ \_ 預設值，則 RPC 執行時間程式庫會根據 SSP 的預設值來驗證用戶端或伺服器。</span><span class="sxs-lookup"><span data-stu-id="d5064-109">If RPC\_C\_QOS\_CAPABILITIES\_DEFAULT is selected, the RPC run-time library authenticates the client or server according to the default for the SSP.</span></span> <span data-ttu-id="d5064-110">Kerberos 通訊協定 SSP 預設會驗證用戶端和伺服器。</span><span class="sxs-lookup"><span data-stu-id="d5064-110">By default, the Kerberos protocol SSP authenticates both the client and the server.</span></span> <span data-ttu-id="d5064-111">Microsoft 提供的所有其他 Ssp 預設為向伺服器驗證用戶端，但不會向用戶端驗證服務器。</span><span class="sxs-lookup"><span data-stu-id="d5064-111">The default for all other SSPs that Microsoft provides is to authenticate the client to the server, but not to authenticate the server to the client.</span></span>

<span data-ttu-id="d5064-112">如果用戶端和伺服器應該一律彼此驗證，請將 [**rpc \_ 安全性 \_ Qos**](/windows/desktop/api/Rpcdce/ns-rpcdce-rpc_security_qos)結構的 **功能** 成員設定為 rpc \_ C \_ qos \_ 功能的 \_ 相互 \_ 驗證。</span><span class="sxs-lookup"><span data-stu-id="d5064-112">If the client and the server should always authenticate to each other, set the **Capabilities** member of the [**RPC\_SECURITY\_QOS**](/windows/desktop/api/Rpcdce/ns-rpcdce-rpc_security_qos) structure to RPC\_C\_QOS\_CAPABILITIES\_MUTUAL\_AUTH.</span></span> <span data-ttu-id="d5064-113">某些安全性提供者可能不支援相互驗證。</span><span class="sxs-lookup"><span data-stu-id="d5064-113">Some security providers may not support mutual authentication.</span></span> <span data-ttu-id="d5064-114">如果對 \_ \_ \_ \_ 這類安全性提供者指定了 RPC C QOS 功能的相互 \_ 驗證，則會在進行遠端程序呼叫時傳回錯誤。</span><span class="sxs-lookup"><span data-stu-id="d5064-114">If RPC\_C\_QOS\_CAPABILITIES\_MUTUAL\_AUTH is specified for such security providers, an error is returned when a remote procedure call is made.</span></span> <span data-ttu-id="d5064-115">使用安全通道 SSP 時，也可以將 **功能** 成員設定為 RPC \_ C \_ QOS \_ 功能的 \_ 任何授權單位 \_ 。</span><span class="sxs-lookup"><span data-stu-id="d5064-115">When using the SCHANNEL SSP, it is possible to also set the **Capabilities** member to RPC\_C\_QOS\_CAPABILITIES\_ANY\_AUTHORITY.</span></span> <span data-ttu-id="d5064-116">這個常數會指定即使發出用戶端驗證憑證的憑證授權單位單位不在 SSP 的根憑證存放區中，SSP 仍應驗證遠端程序呼叫。</span><span class="sxs-lookup"><span data-stu-id="d5064-116">This constant specifies that the SSP shall validate the remote procedure call even if the certificate authority that issued the client's authentication certificate is not in the SSP's root certificate store.</span></span> <span data-ttu-id="d5064-117">如果 SSP 無法辨識憑證授權單位單位，則預設值為拒絕憑證。</span><span class="sxs-lookup"><span data-stu-id="d5064-117">The default is to reject the certificate if the SSP does not recognize the certificate authority.</span></span> <span data-ttu-id="d5064-118">憑證授權單位單位是一種獨立的公司或組織，例如 VeriSign，會發出驗證憑證。</span><span class="sxs-lookup"><span data-stu-id="d5064-118">The certificate authority is an independent company or organization, such as VeriSign, that issues authentication certificates.</span></span>

<span data-ttu-id="d5064-119">應用程式也可以設定 RPC 執行時間程式庫所使用的身分識別追蹤。</span><span class="sxs-lookup"><span data-stu-id="d5064-119">Applications can also set the identity tracking that the RPC run-time library uses.</span></span> <span data-ttu-id="d5064-120">程式通常會使用 [*靜態身分識別追蹤*](s-glos.md)。</span><span class="sxs-lookup"><span data-stu-id="d5064-120">Programs generally use [*static identity tracking*](s-glos.md).</span></span> <span data-ttu-id="d5064-121">使用靜態追蹤時，會在呼叫 [**RpcBindingSetAuthInfo**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetauthinfo) 函式時設定用戶端的認證。</span><span class="sxs-lookup"><span data-stu-id="d5064-121">With static tracking, the client's credentials are set when it calls the [**RpcBindingSetAuthInfo**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetauthinfo) function.</span></span> <span data-ttu-id="d5064-122">然後，RPC 執行時間程式庫會針對系結上的所有 RPC 呼叫使用這些認證，不論呼叫端執行緒的身分識別變更或呼叫進程為何。</span><span class="sxs-lookup"><span data-stu-id="d5064-122">The RPC run-time library then uses those credentials for all RPC calls on the binding, regardless of changes in the identity of the calling thread or the calling process.</span></span> <span data-ttu-id="d5064-123">應用程式也可以選取 [*動態身分識別追蹤*](d-glos.md)。</span><span class="sxs-lookup"><span data-stu-id="d5064-123">Applications can also select [*dynamic identity tracking*](d-glos.md).</span></span> <span data-ttu-id="d5064-124">動態身分識別追蹤會指示 RPC 執行時間程式庫在每次呼叫時使用呼叫執行緒的認證，而不是在系結控制碼中使用。</span><span class="sxs-lookup"><span data-stu-id="d5064-124">Dynamic identity tracking instructs the RPC run-time library to use the credentials of the calling thread at the time of each call, rather than the binding handle.</span></span> <span data-ttu-id="d5064-125">預設的身分識別追蹤是靜態的。</span><span class="sxs-lookup"><span data-stu-id="d5064-125">The default identity tracking is static.</span></span>

<span data-ttu-id="d5064-126">如果用戶端的身分識別不會變更，靜態身分識別追蹤可能會有較佳的效能特性，而且可以在每次呼叫執行緒上的身分識別是否與提供給安全性系統的身分識別相同時，儲存 RPC 執行時間檢查。</span><span class="sxs-lookup"><span data-stu-id="d5064-126">If the identity of the client is not going to change, static identity tracking can have better performance characteristics, and can save the RPC run time from checking each time whether the identity on the calling thread is the same as the identity given to the security system.</span></span> <span data-ttu-id="d5064-127">如果呼叫執行緒的身分識別在呼叫之間可能會變更，而且伺服器需要辨識這些變更，最好是指定動態身分識別追蹤，也就是讓 RPC 執行時間以安靜且有效率的方式追蹤身分識別，而如果身分識別變更的話，就代表您管理該變更。</span><span class="sxs-lookup"><span data-stu-id="d5064-127">If the identity of the calling thread may change between calls, and the server needs to recognize those changes, it is best to specify dynamic identity tracking—the RPC run time quietly and efficiently tracks the identity for you, and if the identity changes, manages that change on your behalf.</span></span>

> [!Note]  
> <span data-ttu-id="d5064-128">針對 **ncalrpc** 呼叫，靜態和動態身分識別追蹤具有不同的效能特性，而且視情況而定，可能會更快。</span><span class="sxs-lookup"><span data-stu-id="d5064-128">For **ncalrpc** calls, static and dynamic identity tracking have different performance characteristics, and depending on the circumstances, either may be faster.</span></span>

 

<span data-ttu-id="d5064-129">作為 QOS 規格的一部分，用戶端程式也可以設定伺服器程式可代表其執行的模擬類型。</span><span class="sxs-lookup"><span data-stu-id="d5064-129">As part of the QOS specification, the client program can also set the type of impersonation that a server program can perform on its behalf.</span></span> <span data-ttu-id="d5064-130">如需詳細資訊，請參閱 [用戶端](client-impersonation.md)模擬。</span><span class="sxs-lookup"><span data-stu-id="d5064-130">For more information, see [Client Impersonation](client-impersonation.md).</span></span>

<span data-ttu-id="d5064-131">[**Rpc \_ 安全性 \_ qos**](/windows/desktop/api/Rpcdce/ns-rpcdce-rpc_security_qos)結構的 [版本號碼] 欄位應一律設定為 [rpc \_ C \_ 安全性 \_ qos \_ 版本]。</span><span class="sxs-lookup"><span data-stu-id="d5064-131">The version number field of the [**RPC\_SECURITY\_QOS**](/windows/desktop/api/Rpcdce/ns-rpcdce-rpc_security_qos) structure should always be set to RPC\_C\_SECURITY\_QOS\_VERSION.</span></span>

 

 




