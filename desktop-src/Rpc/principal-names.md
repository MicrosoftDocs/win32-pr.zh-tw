---
title: 主體名稱
description: 若要讓用戶端使用伺服器程式建立相互驗證的會話，則必須提供伺服器的預期主體名稱。
ms.assetid: 4d9977f8-0efb-4559-977e-3eba4e277bc0
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 554ffecff6eb019b4712e6b2d9f5c6319db492e7
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/16/2019
ms.locfileid: "104462412"
---
# <a name="principal-names"></a><span data-ttu-id="2bfb9-103">主體名稱</span><span class="sxs-lookup"><span data-stu-id="2bfb9-103">Principal Names</span></span>

<span data-ttu-id="2bfb9-104">若要讓用戶端使用伺服器程式建立相互驗證的會話，則必須提供伺服器的預期主體名稱。</span><span class="sxs-lookup"><span data-stu-id="2bfb9-104">For a client to create a mutually authenticated session with a server program, it must provide the server's expected principal name.</span></span> <span data-ttu-id="2bfb9-105">某些通訊協定（例如 Kerberos）要求任何已驗證會話的伺服器主體名稱都是正確的。</span><span class="sxs-lookup"><span data-stu-id="2bfb9-105">Some protocols, such as Kerberos, require a correct server principal name for any authenticated session.</span></span> <span data-ttu-id="2bfb9-106">主體是安全性系統可辨識的實體。</span><span class="sxs-lookup"><span data-stu-id="2bfb9-106">A principal is an entity that the security system recognizes.</span></span> <span data-ttu-id="2bfb9-107">這包括人類使用者和系統服務。</span><span class="sxs-lookup"><span data-stu-id="2bfb9-107">This includes human users as well as system services.</span></span> <span data-ttu-id="2bfb9-108">針對指定的安全性支援提供者， (SSP) 的所有主體名稱都採用類似的格式。</span><span class="sxs-lookup"><span data-stu-id="2bfb9-108">All principal names take similar format for a given security support provider (SSP).</span></span> <span data-ttu-id="2bfb9-109">SSP 是執行安全性驗證的軟體模組。</span><span class="sxs-lookup"><span data-stu-id="2bfb9-109">An SSP is a software module that performs security validation.</span></span> <span data-ttu-id="2bfb9-110">如需詳細資訊，請參閱 [SSPI 架構總覽](sspi-architectural-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="2bfb9-110">For more information, see [SSPI Architectural Overview](sspi-architectural-overview.md).</span></span> <span data-ttu-id="2bfb9-111">為了維持一致性，安全性提供者通常會提供類似于使用者的系統服務名稱。</span><span class="sxs-lookup"><span data-stu-id="2bfb9-111">To maintain uniformity, a security provider usually gives system services similar names as users.</span></span> <span data-ttu-id="2bfb9-112">在某些安全性提供者下，系統服務可能沒有主體名稱。</span><span class="sxs-lookup"><span data-stu-id="2bfb9-112">Under some security providers, system services may not have a principal name.</span></span>

<span data-ttu-id="2bfb9-113">伺服器使用 [**RpcServerRegisterAuthInfo**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterauthinfo) 函式來註冊安全性提供者的主體名稱。</span><span class="sxs-lookup"><span data-stu-id="2bfb9-113">The server registers its principal name for the security provider using the [**RpcServerRegisterAuthInfo**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterauthinfo) function.</span></span> <span data-ttu-id="2bfb9-114">每個安全性提供者都只能使用一個伺服器主體名稱。</span><span class="sxs-lookup"><span data-stu-id="2bfb9-114">Only one server principal name can be used for each security provider.</span></span> <span data-ttu-id="2bfb9-115">如果註冊了多個名稱，則會隨機播放並使用一個名稱。</span><span class="sxs-lookup"><span data-stu-id="2bfb9-115">If more than one name is registered, one name is randomly chosen and used.</span></span> <span data-ttu-id="2bfb9-116">SSP 規定主體名稱的格式。</span><span class="sxs-lookup"><span data-stu-id="2bfb9-116">The SSP dictates the format of the principal name.</span></span> <span data-ttu-id="2bfb9-117">例如，系統服務的 Kerberos/Negotiate Ssp 看起來大約像下面這樣：機器 \_ 名稱 $ @childdomain.parentdomain1.parentdomain2.COM 。</span><span class="sxs-lookup"><span data-stu-id="2bfb9-117">For example, the Kerberos/Negotiate SSPs for a system service look approximately like the following: machine\_name$@childdomain.parentdomain1.parentdomain2.COM.</span></span>

<span data-ttu-id="2bfb9-118">產生主體名稱的建議程式是使用已記載的 Api (例如 **DsMakeSpn** 函式) ，而不是從字串將主體名稱 piecing 在一起。</span><span class="sxs-lookup"><span data-stu-id="2bfb9-118">The recommended procedure for generating principal names is to use documented APIs (such as the **DsMakeSpn** function), rather than piecing together the principal name from strings.</span></span> <span data-ttu-id="2bfb9-119">使用記載的 Api 可提高不同部署環境之間的可攜性，並消除錯誤的可能性。</span><span class="sxs-lookup"><span data-stu-id="2bfb9-119">Using documented APIs increases portability between different deployment environments and eliminates the possibility for errors.</span></span>

<span data-ttu-id="2bfb9-120">指定不正確的主體名稱，可能會讓用戶端和伺服器無法建立已驗證的會話。</span><span class="sxs-lookup"><span data-stu-id="2bfb9-120">Specifying an incorrect principal name may prevent the client and server from establishing an authenticated session.</span></span> <span data-ttu-id="2bfb9-121">安全通道 SSP 採用兩種形式的主體名稱：</span><span class="sxs-lookup"><span data-stu-id="2bfb9-121">The SCHANNEL SSP takes principal names in either of two forms:</span></span>

-   <span data-ttu-id="2bfb9-122">第一個 SCHANNEL 主體名稱表單是 [*msstd*](m-glos.md) 格式。</span><span class="sxs-lookup"><span data-stu-id="2bfb9-122">The first SCHANNEL principal name form is the [*msstd*](m-glos.md) form.</span></span> <span data-ttu-id="2bfb9-123">Msstd 表單中的名稱通常會遵循模式 msstd:servername@serverdomain.com 。</span><span class="sxs-lookup"><span data-stu-id="2bfb9-123">Names in msstd form generally follow the pattern msstd:servername@serverdomain.com.</span></span> <span data-ttu-id="2bfb9-124">這稱為 [電子郵件名稱] 屬性。</span><span class="sxs-lookup"><span data-stu-id="2bfb9-124">This is referred to as an email name property.</span></span> <span data-ttu-id="2bfb9-125">如果憑證包含 [電子郵件名稱] 屬性，而且它包含 @ ) 的 @ ( 符號，則主體名稱是 msstd： email name。</span><span class="sxs-lookup"><span data-stu-id="2bfb9-125">If the certificate contains an email name property, and it contains the at sign (@), the principal name is msstd:email name.</span></span> <span data-ttu-id="2bfb9-126">否則，它必須包含 [一般名稱] 屬性。</span><span class="sxs-lookup"><span data-stu-id="2bfb9-126">Otherwise it must contain the common name property.</span></span> <span data-ttu-id="2bfb9-127">內部反斜線是雙反斜線，就像在字串系結中一樣。</span><span class="sxs-lookup"><span data-stu-id="2bfb9-127">Internal backslashes are doubled, just as in string bindings.</span></span>
-   <span data-ttu-id="2bfb9-128">第二個 SCHANNEL 主體名稱表單是 [*fullsic*](f-glos.md) 格式。</span><span class="sxs-lookup"><span data-stu-id="2bfb9-128">The second SCHANNEL principal name form is the [*fullsic*](f-glos.md) form.</span></span> <span data-ttu-id="2bfb9-129">這是一系列 RFC1779 相容的名稱，以角括弧括住，並以反斜線分隔。</span><span class="sxs-lookup"><span data-stu-id="2bfb9-129">This is a series of RFC1779-compliant names bounded by angle brackets and separated by backslashes.</span></span> <span data-ttu-id="2bfb9-130">它通常會遵循模式 fullsic： \\ < \\ 授權單位 \\ SubAuthority \\ ... \\ 。Person> 或 fullsic： \\ < \\ 授權單位 \\ SubAuthority \\ ... \\ServerProgram>。</span><span class="sxs-lookup"><span data-stu-id="2bfb9-130">It typically follows the pattern fullsic:\\<\\Authority\\SubAuthority\\.....\\Person> or fullsic:\\<\\Authority\\SubAuthority\\.....\\ServerProgram>.</span></span>

<span data-ttu-id="2bfb9-131">如果名稱與憑證不符， \_ \_ 則會傳回拒絕存取錯誤。</span><span class="sxs-lookup"><span data-stu-id="2bfb9-131">If the name does not match the certificate, ERROR\_ACCESS\_DENIED is returned.</span></span> <span data-ttu-id="2bfb9-132">如果名稱格式無效，則 SCHANNEL SSP 會傳回程序代碼錯誤 \_ 不正確 \_ 參數。</span><span class="sxs-lookup"><span data-stu-id="2bfb9-132">If the name format is invalid, SCHANNEL SSP returns the code ERROR\_INVALID\_PARAMETER.</span></span>

<span data-ttu-id="2bfb9-133">若要查詢伺服器的主體名稱，應用程式可以呼叫 [**RpcMgmtInqServerPrincName**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcmgmtinqserverprincname)。</span><span class="sxs-lookup"><span data-stu-id="2bfb9-133">To query for the server's principal name, applications can call [**RpcMgmtInqServerPrincName**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcmgmtinqserverprincname).</span></span> <span data-ttu-id="2bfb9-134">這會配置以 null 終止的字串來保存主體名稱。</span><span class="sxs-lookup"><span data-stu-id="2bfb9-134">This allocates a null-terminated string to hold the principal name.</span></span> <span data-ttu-id="2bfb9-135">在結束之前，您的應用程式必須叫用 [**RpcStringFree**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcstringfree) 來釋放此字串所佔用的記憶體。</span><span class="sxs-lookup"><span data-stu-id="2bfb9-135">Before it terminates, your application must invoke [**RpcStringFree**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcstringfree) to release the memory this string occupies.</span></span>

<span data-ttu-id="2bfb9-136">以這種方式查詢伺服器名稱並不安全，應予以避免。</span><span class="sxs-lookup"><span data-stu-id="2bfb9-136">Querying for the server name in this manner is not secure and should be avoided.</span></span> <span data-ttu-id="2bfb9-137">針對伺服器驗證，用戶端程式應該知道它所連接的伺服器，而且應該從頭建立伺服器主體名稱。</span><span class="sxs-lookup"><span data-stu-id="2bfb9-137">For server authentication, the client program should know which server it is connecting to and should create the server principal name from scratch.</span></span>

 

 




