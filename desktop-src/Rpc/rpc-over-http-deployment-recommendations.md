---
title: RPC over HTTP 部署建議
description: 本節說明使用 RPC over HTTP 時，達到最高安全性和效能的最佳作法和建議的部署設定。
ms.assetid: 83938a7d-77d0-45e8-b0a3-7b32ef768d83
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8871686d1fc8b87bcd6fb7ac4314b1977252f23a
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/16/2019
ms.locfileid: "104021905"
---
# <a name="rpc-over-http-deployment-recommendations"></a><span data-ttu-id="3bbf4-103">RPC over HTTP 部署建議</span><span class="sxs-lookup"><span data-stu-id="3bbf4-103">RPC over HTTP Deployment Recommendations</span></span>

<span data-ttu-id="3bbf4-104">本節說明使用 RPC over HTTP 時，達到最高安全性和效能的最佳作法和建議的部署設定。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-104">This section documents best practices and recommended deployment configurations for achieving maximum security and performance when using RPC over HTTP.</span></span> <span data-ttu-id="3bbf4-105">此處所找到的各種設定適用于以各種大小、預算和安全性需求為基礎的不同組織。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-105">The various configurations found herein apply do different organizations based on various size, budget, and security requirements.</span></span> <span data-ttu-id="3bbf4-106">每個設定也會提供部署考慮，以協助判斷哪一個適用于特定案例。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-106">Each configuration also provides deployment considerations useful in determining which is best for a given scenario.</span></span>

<span data-ttu-id="3bbf4-107">如需有關高容量 RPC over HTTP 案例的詳細資訊，請參閱 [MICROSOFT RPC 負載平衡](rpc-load-balancing.md)。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-107">For information regarding high volume RPC over HTTP scenarios, please see [Microsoft RPC Load Balancing](rpc-load-balancing.md).</span></span>

<span data-ttu-id="3bbf4-108">下列建議適用于所有設定：</span><span class="sxs-lookup"><span data-stu-id="3bbf4-108">The following recommendations apply to all configurations:</span></span>

-   <span data-ttu-id="3bbf4-109">使用支援 RPC over HTTP v2 的 Windows 版本。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-109">Use versions of Windows that support RPC over HTTP v2.</span></span>
-   <span data-ttu-id="3bbf4-110">將 IIS 放在執行 RPC Proxy 的電腦上（IIS 6.0 模式）。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-110">Put IIS on the machine that runs the RPC Proxy in IIS 6.0 mode.</span></span>
-   <span data-ttu-id="3bbf4-111">不允許匿名存取 RPC Proxy 虛擬目錄。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-111">Disallow anonymous access to the RPC Proxy virtual directory.</span></span>
-   <span data-ttu-id="3bbf4-112">絕不啟用 AllowAnonymous 登錄機碼。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-112">Never enable the AllowAnonymous registry key.</span></span>
-   <span data-ttu-id="3bbf4-113">讓 RPC over HTTP 用戶端使用 **CertificateSubjectField** (如需詳細) 資訊，請參閱 [**RpcBindingSetAuthInfoEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetauthinfoexa) ，以確認您所連線的 rpc proxy 是您預期的 rpc proxy。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-113">Make your RPC over HTTP clients use the **CertificateSubjectField** (see [**RpcBindingSetAuthInfoEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetauthinfoexa) for more information) to verify that the RPC Proxy you connected to is the RPC Proxy you expect.</span></span>
-   <span data-ttu-id="3bbf4-114">將 **ValidPorts** 登錄機碼設定為僅包含 RPC over HTTP 用戶端將連接的電腦。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-114">Configure the **ValidPorts** registry key to contain only machines to which the RPC over HTTP clients will connect.</span></span>
-   <span data-ttu-id="3bbf4-115">請勿在 **ValidPorts** 索引鍵中使用萬用字元;這麼做可以節省時間，但完全未預期的電腦也可以容納萬用字元。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-115">Do not use wildcards in the **ValidPorts** key; doing so can save time, but a completely unexpected machine may fit the wildcard as well.</span></span>
-   <span data-ttu-id="3bbf4-116">在 RPC over HTTP 用戶端上使用 SSL。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-116">Use SSL on RPC over HTTP clients.</span></span> <span data-ttu-id="3bbf4-117">如果遵循這些章節中所述的指導方針，RPC over HTTP 用戶端將無法在不使用 SSL 的情況下連線。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-117">If the guidelines set forth in these sections are followed, the RPC over HTTP client will not be able to connect without using SSL.</span></span>
-   <span data-ttu-id="3bbf4-118">除了使用 SSL 之外，請將 RPC over HTTP 用戶端設定為使用 RPC 加密。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-118">Configure RPC over HTTP clients to use RPC Encryption in addition to using SSL.</span></span> <span data-ttu-id="3bbf4-119">如果 RPC over HTTP 用戶端無法連線到 KDC，則只能使用 Negotiate 和 NTLM。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-119">If the RPC over HTTP client cannot reach the KDC, it can use only Negotiate and NTLM.</span></span>
-   <span data-ttu-id="3bbf4-120">將用戶端電腦設定為使用 NTLMv2。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-120">Configure client machines to use NTLMv2.</span></span> <span data-ttu-id="3bbf4-121">將 **LMCompatibilityLevel** 登錄機碼設定為2或更高。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-121">Set the **LMCompatibilityLevel** registry key to 2 or higher.</span></span> <span data-ttu-id="3bbf4-122">如需 **LMCompatibilityLevel** 索引鍵的詳細資訊，請參閱 **msdn.microsoft.com** 。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-122">See **msdn.microsoft.com** for more information on the **LMCompatibilityLevel** key.</span></span>
-   <span data-ttu-id="3bbf4-123">使用上面所述的設定，執行 RPC Proxy 電腦的 web 伺服陣列。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-123">Run a web farm of RPC Proxy machines with the configuration outlined above.</span></span>
-   <span data-ttu-id="3bbf4-124">在網際網路與 RPC Proxy 之間部署防火牆。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-124">Deploy a firewall between the Internet and the RPC Proxy.</span></span>
-   <span data-ttu-id="3bbf4-125">為了達到最佳效能，請設定 IIS 以傳送簡短的回應給非成功的錯誤碼。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-125">For optimal performance, configure IIS to send a short response for non-success error codes.</span></span> <span data-ttu-id="3bbf4-126">因為 IIS 回應的取用者是自動化程式，所以不需要將使用者易記的說明傳送給用戶端;RPC over HTTP 用戶端只會略過它們。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-126">Because the consumer of the IIS response is an automated process, there is no need for user friendly explanations to be sent to the client; they will simply be ignored by the RPC over HTTP client.</span></span>

<span data-ttu-id="3bbf4-127">從安全性、效能及管理性的觀點來看，RPC Proxy 的基本目標如下：</span><span class="sxs-lookup"><span data-stu-id="3bbf4-127">The basic goals of the RPC Proxy from a security, performance and manageability perspective are the following:</span></span>

-   <span data-ttu-id="3bbf4-128">提供 RPC over HTTP 流量進入伺服器網路的單一進入點。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-128">Provide a single point of entry for RPC over HTTP traffic into the server network.</span></span> <span data-ttu-id="3bbf4-129">針對 RPC over HTTP 流量進入伺服器網路的單一進入點，有兩個主要優點。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-129">Having a single point of entry for RPC over HTTP traffic into a server network has two main benefits.</span></span> <span data-ttu-id="3bbf4-130">首先，由於 RPC Proxy 是面對網際網路，因此大部分的組織會將這類電腦隔離在稱為不受信任的周邊網路的特殊網路中，這與一般的組織網路不同。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-130">First, since the RPC Proxy is facing the Internet, most organizations isolate such machines in a special network called an untrusted perimeter network which is separate from the normal organizational network.</span></span> <span data-ttu-id="3bbf4-131">不受信任的周邊網路中的伺服器非常小心地管理、設定和監視，以便能夠承受來自網際網路的攻擊。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-131">Servers in an untrusted perimeter network are very carefully managed, configured and monitored to be able to withstand attacks from the Internet.</span></span> <span data-ttu-id="3bbf4-132">不受信任的周邊網路中的電腦越少，設定、管理、監視及保護它們的安全性就越容易。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-132">The fewer machines in an untrusted perimeter network, the easier it is to configure, manage, monitor and keep them secure.</span></span> <span data-ttu-id="3bbf4-133">第二，由於已安裝 RPC Proxy 的單一 Web 伺服陣列可以服務位於公司網路上的任何 RPC over HTTP 伺服器，因此將 RPC Proxy 與 RPC over HTTP 伺服器分開，並讓 RPC Proxy 位於不受信任的周邊網路中是很合理的。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-133">Second, since a single Web Farm with RPC Proxies installed can service any number of RPC over HTTP Servers residing on the corporate network, it makes a lot of sense to separate the RPC Proxy from the RPC over HTTP Server and have the RPC Proxy reside in an untrusted perimeter network.</span></span> <span data-ttu-id="3bbf4-134">如果 RPC Proxy 與 RPC over HTTP 伺服器位於同一部電腦上，則會強制組織將所有的後端伺服器放入不受信任的周邊網路中，這樣會讓不受信任的周邊網路保持在安全的情況下變得更困難。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-134">If the RPC Proxy was on the same machine as the RPC over HTTP Server, organizations would be forced to put all of their back end servers into an untrusted perimeter network, which would make it much harder to keep the untrusted perimeter network secure.</span></span> <span data-ttu-id="3bbf4-135">將 RPC Proxy 的角色與 RPC over HTTP 伺服器分開，可協助組織讓不受信任的周邊網路中的電腦數目保持可管理，因此更安全。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-135">Separating the role of the RPC Proxy and the RPC over HTTP server helps organizations keep the number of machines in an untrusted perimeter network manageable and therefore, more secure.</span></span>
-   <span data-ttu-id="3bbf4-136">作為伺服器網路的安全保險絲。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-136">Serve as a safety fuse for the server network.</span></span> <span data-ttu-id="3bbf4-137">RPC Proxy 是設計為伺服器網路的消耗保險絲-如果 RPC Proxy 發生問題，它就會消失，並藉此保護真正的 RPC over HTTP 伺服器。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-137">The RPC Proxy is designed as an expendable fuse for the server network – if something goes wrong on the RPC Proxy, it simply goes out and thus protects the real RPC over HTTP server.</span></span> <span data-ttu-id="3bbf4-138">如果截至目前為止已遵循本節所述的最佳做法，則除了 SSL 之外，RPC over HTTP 流量還會使用 RPC 加密來加密。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-138">If the outlined best practices outlined in this section have been followed thus far, the RPC over HTTP traffic is encrypted with RPC encryption in addition to SSL.</span></span> <span data-ttu-id="3bbf4-139">RPC 加密本身是在用戶端與伺服器之間，而不是在用戶端和 proxy 之間。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-139">The RPC Encryption itself is between the client and the server, not between the client and the proxy.</span></span> <span data-ttu-id="3bbf4-140">這表示 proxy 不了解，也無法將它所接收的 RPC 流量解密。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-140">This means the proxy does not understand and cannot decrypt the RPC traffic it receives.</span></span> <span data-ttu-id="3bbf4-141">它只會瞭解用戶端處理連接建立、流量控制和其他通道詳細資料時，傳送給它的一些控制順序。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-141">It only understands some control sequences sent to it by the client dealing with connection establishment, flow control and other tunneling details.</span></span> <span data-ttu-id="3bbf4-142">它無法存取 RPC over HTTP 用戶端傳送至伺服器的資料。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-142">It has no access to the data the RPC over HTTP client sends to the server.</span></span> <span data-ttu-id="3bbf4-143">此外，RPC over HTTP 用戶端必須獨立地對 RPC Proxy 和 RPC over HTTP 伺服器進行驗證。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-143">Furthermore, the RPC over HTTP client must independently authenticate to both the RPC Proxy and the RPC over HTTP server.</span></span> <span data-ttu-id="3bbf4-144">這可提供深層防禦。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-144">This provides defense in depth.</span></span> <span data-ttu-id="3bbf4-145">如果 RPC Proxy 電腦因為某些設定錯誤或某種安全性缺口而遭到入侵，通過它的資料仍會受到保護，而不會受到篡改。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-145">If the RPC Proxy machine becomes compromised, due to some configuration error or a security breach of some sort, the data that pass through it are still secure from tampering.</span></span> <span data-ttu-id="3bbf4-146">攻擊者若要獲得 RPC Proxy 的控制權，最多可以中斷流量，但無法讀取或篡改。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-146">An attacker that would gain control of the RPC Proxy can at most interrupt the traffic, but not read it or tamper with it.</span></span> <span data-ttu-id="3bbf4-147">這就是 RPC Proxy 的熔斷器角色進入 play 的地方，它是消耗，而不會危及 RPC over HTTP 流量的安全性。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-147">This is where the fuse role of the RPC Proxy comes into play – it is expendable without the security of the RPC over HTTP traffic being compromised.</span></span>
-   <span data-ttu-id="3bbf4-148">在 Web 伺服陣列中執行 RPC Proxy 的多部電腦之間散發一些存取檢查和解密工作。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-148">Distribute some of the access checks and decryption work among multiple machines running RPC Proxy in a Web Farm.</span></span> <span data-ttu-id="3bbf4-149">藉由在 Web 伺服陣列中運作良好，RPC Proxy 可讓組織卸載 SSL 解密和一些存取檢查，因此可在後端伺服器上釋出更多容量以進行處理。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-149">By functioning well in a Web Farm, the RPC Proxy enables organizations to offload SSL decryption and some of the access checks, thus freeing more capacity on the back end server for processing.</span></span> <span data-ttu-id="3bbf4-150">使用 RPC Proxy 電腦的 Web 伺服陣列，也可讓組織增加其前端伺服器上的容量，藉此提高其承受阻絕服務 (DoS) 攻擊的能力。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-150">Using a Web Farm of RPC Proxy machines also enables an organization to increase its ability to withstand Denial of Service (DoS) attacks by increasing the capacity on its front end servers.</span></span>

<span data-ttu-id="3bbf4-151">在截至目前為止所設定的指導方針中，組織仍有選擇。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-151">Within the guidelines set forth thus far, organizations still have choices.</span></span> <span data-ttu-id="3bbf4-152">每個組織都有使用者的不便、安全性和成本之間的選擇與折衷：</span><span class="sxs-lookup"><span data-stu-id="3bbf4-152">Each organization has choices and compromises between user inconvenience, security and cost:</span></span>

-   <span data-ttu-id="3bbf4-153">**使用基本驗證或 Windows 整合式驗證來驗證 RPC Proxy？**</span><span class="sxs-lookup"><span data-stu-id="3bbf4-153">**Use Basic Authentication or Windows Integrated Authentication to authenticate to the RPC Proxy?**</span></span> <span data-ttu-id="3bbf4-154">RPC over HTTP 目前僅支援 NTLM-它不支援 Kerberos。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-154">RPC over HTTP currently supports only NTLM – it doesn't support Kerberos.</span></span> <span data-ttu-id="3bbf4-155">此外，如果 RPC over HTTP 用戶端與在 HTTP 標頭中插入 *via* PRAGMA 的 rpc proxy 之間有 HTTP proxy 或防火牆，則 NTLM 驗證將無法運作。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-155">Also, if there is an HTTP Proxy or a firewall between the RPC over HTTP client and the RPC Proxy which inserts the *via* pragma in the HTTP header, NTLM authentication will not work.</span></span> <span data-ttu-id="3bbf4-156">如果不是這種情況，組織可以選擇基本和 NTLM 驗證。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-156">When that is not the case, organizations can choose between Basic and NTLM authentication.</span></span> <span data-ttu-id="3bbf4-157">基本驗證的優點是它的速度更快且更簡單，因此降低了拒絕服務攻擊的機會。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-157">The advantage of Basic authentication is that it is faster and simpler, and therefore offers less opportunity for denial of service attacks.</span></span> <span data-ttu-id="3bbf4-158">但是 NTLM 更為安全。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-158">But NTLM is more secure.</span></span> <span data-ttu-id="3bbf4-159">視組織的優先順序而定，它可以選擇 [基本]、[NTLM]，或允許其使用者在兩者之間進行選擇。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-159">Depending on an organization's priorities, it can choose Basic, NTLM, or allow its users to choose between the two.</span></span> <span data-ttu-id="3bbf4-160">如果只選擇一個，最好從 RPC Proxy 虛擬目錄關閉另一個，以降低攻擊的風險。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-160">If only one is chosen, it is best to turn off the other from the RPC Proxy virtual directory to reduce risk of attack.</span></span>
-   <span data-ttu-id="3bbf4-161">**RPC Proxy 和 RPC over HTTP 伺服器使用同一組認證，或針對每個憑證使用不同的認證？**</span><span class="sxs-lookup"><span data-stu-id="3bbf4-161">**Use the same set of credentials for both the RPC Proxy and the RPC over HTTP Server, or use different credentials for each?**</span></span> <span data-ttu-id="3bbf4-162">這項決策的取捨是在使用者的便利性與安全性之間。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-162">The tradeoff for this decision is between user's convenience and security.</span></span> <span data-ttu-id="3bbf4-163">少數使用者喜歡輸入多個認證。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-163">Few users like to enter multiple credentials.</span></span> <span data-ttu-id="3bbf4-164">但是，如果不受信任的周邊網路發生安全性缺口，則 RPC Proxy 和 RPC over HTTP 伺服器擁有個別的認證集，會提供額外的保護。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-164">However, if a security breach occurs in an untrusted perimeter network, having separate sets of credentials for the RPC Proxy and the RPC over HTTP Server provides additional protection.</span></span> <span data-ttu-id="3bbf4-165">請注意，如果使用個別的認證，而且其中一組認證是使用者的網域認證，建議您對 RPC over HTTP 伺服器使用使用者的網域認證，而不是使用 RPC Proxy。</span><span class="sxs-lookup"><span data-stu-id="3bbf4-165">Note that if separate credentials are used, and one set of credentials is the user's domain credentials, it is advisable to use the user's domain credentials for the RPC over HTTP Server and not for the RPC Proxy.</span></span>

 

 




