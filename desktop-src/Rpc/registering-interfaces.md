---
title: 註冊介面
description: " (RPC) 介面註冊遠端程序呼叫。"
ms.assetid: c22e3fa8-98be-461a-b06d-292d3f655ffc
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 30ea9e851e8c9663c8f66d983d3400b1ee398a9d
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/16/2019
ms.locfileid: "104182981"
---
# <a name="registering-interfaces"></a><span data-ttu-id="490ba-103">註冊介面</span><span class="sxs-lookup"><span data-stu-id="490ba-103">Registering Interfaces</span></span>

<span data-ttu-id="490ba-104">本節提供註冊 RPC 介面之程式的詳細討論。</span><span class="sxs-lookup"><span data-stu-id="490ba-104">This section presents a detailed discussion of the process of registering an RPC interface.</span></span>

<span data-ttu-id="490ba-105">本節中的資訊會顯示在下列主題中：</span><span class="sxs-lookup"><span data-stu-id="490ba-105">The information in this section is presented in the following topics:</span></span>

-   [<span data-ttu-id="490ba-106">介面註冊函式</span><span class="sxs-lookup"><span data-stu-id="490ba-106">Interface Registration Functions</span></span>](#interface-registration-functions)
-   [<span data-ttu-id="490ba-107">進入點向量</span><span class="sxs-lookup"><span data-stu-id="490ba-107">Entry-Point Vectors</span></span>](#entry-point-vectors)
-   [<span data-ttu-id="490ba-108">管理員 EPVs</span><span class="sxs-lookup"><span data-stu-id="490ba-108">Manager EPVs</span></span>](#manager-epvs)
-   [<span data-ttu-id="490ba-109">註冊介面的單一實作為</span><span class="sxs-lookup"><span data-stu-id="490ba-109">Registering a Single Implementation of an Interface</span></span>](#registering-a-single-implementation-of-an-interface)
-   [<span data-ttu-id="490ba-110">註冊介面的多個執行</span><span class="sxs-lookup"><span data-stu-id="490ba-110">Registering Multiple Implementations of an Interface</span></span>](#registering-multiple-implementations-of-an-interface)
-   [<span data-ttu-id="490ba-111">叫用管理員常式的規則</span><span class="sxs-lookup"><span data-stu-id="490ba-111">Rules for Invoking Manager Routines</span></span>](#rules-for-invoking-manager-routines)
-   [<span data-ttu-id="490ba-112">分派遠端程序呼叫至 Server-Manager 常式</span><span class="sxs-lookup"><span data-stu-id="490ba-112">Dispatching a Remote Procedure Call to a Server-Manager Routine</span></span>](#dispatching-a-remote-procedure-call-to-a-server-manager-routine)
-   [<span data-ttu-id="490ba-113">提供您自己的 Object-Inquiry 函數</span><span class="sxs-lookup"><span data-stu-id="490ba-113">Supplying Your Own Object-Inquiry Function</span></span>](#supplying-your-own-object-inquiry-function)

## <a name="interface-registration-functions"></a><span data-ttu-id="490ba-114">介面註冊函式</span><span class="sxs-lookup"><span data-stu-id="490ba-114">Interface Registration Functions</span></span>

<span data-ttu-id="490ba-115">伺服器會藉由呼叫 [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif) 函式來註冊其介面。</span><span class="sxs-lookup"><span data-stu-id="490ba-115">Servers register their interfaces by calling the [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif) function.</span></span> <span data-ttu-id="490ba-116">複雜的伺服器程式通常支援一個以上的介面。</span><span class="sxs-lookup"><span data-stu-id="490ba-116">Complex server programs often support more than one interface.</span></span> <span data-ttu-id="490ba-117">伺服器應用程式必須針對每個支援的介面呼叫此函式一次。</span><span class="sxs-lookup"><span data-stu-id="490ba-117">Server applications must call this function once for each interface they support.</span></span>

<span data-ttu-id="490ba-118">此外，伺服器可以支援相同介面的多個版本，每個版本都有自己的介面函式實作為。</span><span class="sxs-lookup"><span data-stu-id="490ba-118">Also, servers can support multiple versions of the same interface, each with its own implementation of the interface's functions.</span></span> <span data-ttu-id="490ba-119">如果您的伺服器程式執行這項工作，則必須提供一組進入點。</span><span class="sxs-lookup"><span data-stu-id="490ba-119">If your server program does this, it must provide a set of entry points.</span></span> <span data-ttu-id="490ba-120">進入點是管理員常式，可分派介面版本的呼叫。</span><span class="sxs-lookup"><span data-stu-id="490ba-120">An entry point is a manager routine that dispatches calls for a version of an interface.</span></span> <span data-ttu-id="490ba-121">每個版本的介面都必須有一個進入點。</span><span class="sxs-lookup"><span data-stu-id="490ba-121">There must be one entry point for each version of the interface.</span></span> <span data-ttu-id="490ba-122">進入點的群組稱為進入點向量。</span><span class="sxs-lookup"><span data-stu-id="490ba-122">The group of entry points is called an entry point vector.</span></span> <span data-ttu-id="490ba-123">如需詳細資訊，請參閱 [進入點向量](#entry-point-vectors)。</span><span class="sxs-lookup"><span data-stu-id="490ba-123">For details, see [Entry-Point Vectors](#entry-point-vectors).</span></span>

<span data-ttu-id="490ba-124">除了標準函式 [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif)之外，RPC 也支援其他介面註冊功能。</span><span class="sxs-lookup"><span data-stu-id="490ba-124">In addition to the standard function [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), RPC also supports other interface registration functions.</span></span> <span data-ttu-id="490ba-125">[**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2)函式可讓您指定一組註冊旗標，以擴充 **RpcServerRegisterIf** 的功能， (查看 [介面登錄旗標](interface-registration-flags.md)) 、伺服器可接受的並行遠端程序呼叫要求的最大數目，以及傳入資料區塊的大小上限（以位元組為單位）。</span><span class="sxs-lookup"><span data-stu-id="490ba-125">The [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) function extends the capabilities of **RpcServerRegisterIf** by enabling you to specify a set of registration flags (see [Interface Registration Flags](interface-registration-flags.md)), the maximum number of concurrent remote procedure call requests the server can accept, and the maximum size in bytes of incoming data blocks.</span></span>

<span data-ttu-id="490ba-126">RPC 程式庫也包含稱為 [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)的函式。</span><span class="sxs-lookup"><span data-stu-id="490ba-126">The RPC library also contains a function called [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex).</span></span> <span data-ttu-id="490ba-127">如同 [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif) 函式，此函式會註冊介面。</span><span class="sxs-lookup"><span data-stu-id="490ba-127">Like the [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif) function, this function registers an interface.</span></span> <span data-ttu-id="490ba-128">您的伺服器程式也可以使用此函式來指定一組註冊旗標 (請參閱 [介面登錄旗標](interface-registration-flags.md)) 、伺服器可接受之並行遠端程序呼叫要求的最大數目，以及安全性回呼函數。</span><span class="sxs-lookup"><span data-stu-id="490ba-128">Your server program can also use this function to specify a set of registration flags (see [Interface Registration Flags](interface-registration-flags.md)), the maximum number of concurrent remote procedure call requests the server can accept, and a security callback function.</span></span>

<span data-ttu-id="490ba-129">[**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif)、 [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)和 [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2)函數會設定內部介面登錄表中的值。</span><span class="sxs-lookup"><span data-stu-id="490ba-129">The [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex), and [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) functions set values in the internal interface registry table.</span></span> <span data-ttu-id="490ba-130">此資料表用來將介面 UUID 和物件 Uuid 對應到管理員 EPV。</span><span class="sxs-lookup"><span data-stu-id="490ba-130">This table is used to map the interface UUID and object UUIDs to a manager EPV.</span></span> <span data-ttu-id="490ba-131">管理員 EPV 是函式指標的陣列，在 IDL 檔案中指定的介面中，每個函式原型都只會包含一個函式指標。</span><span class="sxs-lookup"><span data-stu-id="490ba-131">The manager EPV is an array of function pointers that contains exactly one function pointer for each function prototype in the interface specified in the IDL file.</span></span>

<span data-ttu-id="490ba-132">如需提供多個 EPVs 以提供介面多個介面的詳細資訊，請參閱 [多個介面實現](#registering-multiple-implementations-of-an-interface)。</span><span class="sxs-lookup"><span data-stu-id="490ba-132">For information on supplying multiple EPVs to provide multiple implementations of the interface, see [Multiple Interface Implementations](#registering-multiple-implementations-of-an-interface).</span></span>

<span data-ttu-id="490ba-133">執行時間程式庫會使用介面登錄表 (透過呼叫函式 [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif)、 [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)或 [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2)) 和物件登錄表 (設定，方法是呼叫函式 [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype)) 將介面和物件 uuid 對應至函式指標。</span><span class="sxs-lookup"><span data-stu-id="490ba-133">The run-time library uses the interface registry table (set by calls to the function [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex), or [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2)) and the object registry table (set by calls to the function [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype)) to map interface and object UUIDs to the function pointer.</span></span>

<span data-ttu-id="490ba-134">當您想要讓伺服器程式從 RPC 執行時間程式庫登錄移除介面時，請呼叫 [**RpcServerUnregisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverunregisterif) 函數。</span><span class="sxs-lookup"><span data-stu-id="490ba-134">When you want your server program to remove an interface from the RPC run-time library registry, call the [**RpcServerUnregisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverunregisterif) function.</span></span> <span data-ttu-id="490ba-135">從登錄中移除介面之後，RPC 執行時間程式庫將不再接受該介面的新呼叫。</span><span class="sxs-lookup"><span data-stu-id="490ba-135">After the interface is removed from the registry, the RPC run-time library will no longer accept new calls for that interface.</span></span>

## <a name="entry-point-vectors"></a><span data-ttu-id="490ba-136">進入點向量</span><span class="sxs-lookup"><span data-stu-id="490ba-136">Entry-point Vectors</span></span>

<span data-ttu-id="490ba-137"> (EPV) 的管理員進入點向量是函式指標的陣列，可指向 IDL 檔案中指定的函式的實作為。</span><span class="sxs-lookup"><span data-stu-id="490ba-137">The manager entry-point vector (EPV) is an array of function pointers that point to implementations of the functions specified in the IDL file.</span></span> <span data-ttu-id="490ba-138">陣列中的元素數目對應到 IDL 檔案中指定的函式數目。</span><span class="sxs-lookup"><span data-stu-id="490ba-138">The number of elements in the array corresponds to the number of functions specified in the IDL file.</span></span> <span data-ttu-id="490ba-139">RPC 支援多個進入點向量，代表在介面中指定之函式的多個實作為。</span><span class="sxs-lookup"><span data-stu-id="490ba-139">RPC supports multiple entry-point vectors representing multiple implementations of the functions specified in the interface.</span></span>

<span data-ttu-id="490ba-140">MIDL 編譯器會自動產生用於建立管理員 EPVs 的管理員 EPV 資料類型。</span><span class="sxs-lookup"><span data-stu-id="490ba-140">The MIDL compiler automatically generates a manager EPV data type for use in constructing manager EPVs.</span></span> <span data-ttu-id="490ba-141">資料類型的名稱為 \* if-name \***\_ SERVER \_ EPV**，其中 *if-name* 指定 IDL 檔案中的介面識別碼。</span><span class="sxs-lookup"><span data-stu-id="490ba-141">The data type is named \*if-name\***\_SERVER\_EPV**, where *if-name* specifies the interface identifier in the IDL file.</span></span>

<span data-ttu-id="490ba-142">在假設介面中的每個程式都有相同名稱的管理員常式，並且在 IDL 檔案中指定時，MIDL 編譯器會自動建立並初始化預設的管理員 EPV。</span><span class="sxs-lookup"><span data-stu-id="490ba-142">The MIDL compiler automatically creates and initializes a default manager EPV on the assumption that a manager routine of the same name exists for each procedure in the interface and is specified in the IDL file.</span></span>

<span data-ttu-id="490ba-143">當伺服器提供相同介面的多個執行時，伺服器必須為每個執行建立一個額外的管理員 EPV。</span><span class="sxs-lookup"><span data-stu-id="490ba-143">When a server offers multiple implementations of the same interface, the server must create one additional manager EPV for each implementation.</span></span> <span data-ttu-id="490ba-144">每個 EPV 都必須只包含一個進入點， (IDL 檔案中定義之每個程式的函式) 位址。</span><span class="sxs-lookup"><span data-stu-id="490ba-144">Each EPV must contain exactly one entry point (address of a function) for each procedure defined in the IDL file.</span></span> <span data-ttu-id="490ba-145">伺服器應用程式會針對介面的每個額外執行，宣告並 *初始化類型為的 \_ 一個 \_* 管理員 EPV 變數。</span><span class="sxs-lookup"><span data-stu-id="490ba-145">The server application declares and initializes one manager EPV variable of type *if-name\*\*\*\_SERVER\_EPV*\* for each additional implementation of the interface.</span></span> <span data-ttu-id="490ba-146">為了註冊 EPVs，它會針對每個支援的物件類型呼叫 [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif)、 [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)或 [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) 一次。</span><span class="sxs-lookup"><span data-stu-id="490ba-146">To register the EPVs it calls [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex), or [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) once for each object type it supports.</span></span>

<span data-ttu-id="490ba-147">當用戶端對伺服器進行遠端程序呼叫時，會根據介面 UUID 和物件類型，選取包含函式指標的 EPV。</span><span class="sxs-lookup"><span data-stu-id="490ba-147">When the client makes a remote procedure call to the server, the EPV containing the function pointer is selected based on the interface UUID and the object type.</span></span> <span data-ttu-id="490ba-148">物件類型是由物件 UUID 衍生自物件（object）函數或由 [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype)控制的資料表驅動對應。</span><span class="sxs-lookup"><span data-stu-id="490ba-148">The object type is derived from the object UUID by the object-inquiry function or the table-driven mapping controlled by [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype).</span></span>

## <a name="manager-epvs"></a><span data-ttu-id="490ba-149">管理員 EPVs</span><span class="sxs-lookup"><span data-stu-id="490ba-149">Manager EPVs</span></span>

<span data-ttu-id="490ba-150">根據預設，MIDL 編譯器會使用介面 IDL 檔案中的程式名稱來產生管理員 EPV，而編譯器會直接放入伺服器 stub 中。</span><span class="sxs-lookup"><span data-stu-id="490ba-150">By default, the MIDL compiler uses the procedure names from an interface's IDL file to generate a manager EPV, which the compiler places directly into the server stub.</span></span> <span data-ttu-id="490ba-151">此預設 EPV 會使用在介面定義中宣告的程式名稱，以靜態方式初始化。</span><span class="sxs-lookup"><span data-stu-id="490ba-151">This default EPV is statically initialized using the procedure names declared in the interface definition.</span></span>

<span data-ttu-id="490ba-152">若要使用預設 EPV 註冊管理員，請在對 [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif)、 [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)或 [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2)函數的呼叫中，將 **Null** 指定為 *MgrEpv* 參數的值。</span><span class="sxs-lookup"><span data-stu-id="490ba-152">To register a manager using the default EPV, specify **NULL** as the value of the *MgrEpv* parameter in a call to either the [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex), or [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) function.</span></span> <span data-ttu-id="490ba-153">如果管理員所使用的常式名稱對應至介面定義的名稱，您可以使用 MIDL 編譯器所產生之介面的預設 EPV 來註冊這個管理員。</span><span class="sxs-lookup"><span data-stu-id="490ba-153">If the routine names used by a manager correspond to those of the interface definition, you can register this manager using the default EPV of the interface generated by the MIDL compiler.</span></span> <span data-ttu-id="490ba-154">您也可以使用伺服器應用程式提供的 EPV 來註冊管理員。</span><span class="sxs-lookup"><span data-stu-id="490ba-154">You can also register a manager using an EPV that the server application supplies.</span></span>

<span data-ttu-id="490ba-155">伺服器可以 (，有時候必須) 建立和註冊介面的非 **null** 管理員 EPV。</span><span class="sxs-lookup"><span data-stu-id="490ba-155">A server can (and sometimes must) create and register a non-**null** manager EPV for an interface.</span></span> <span data-ttu-id="490ba-156">若要選取伺服器應用程式提供的 EPV，請將其值已由伺服器宣告的 EPV 位址，傳遞為參數的 *MgrEpv* 值。</span><span class="sxs-lookup"><span data-stu-id="490ba-156">To select a server application–supplied EPV, pass the address of an EPV whose value has been declared by the server as the value of the *MgrEpv* a parameter.</span></span> <span data-ttu-id="490ba-157">*MgrEpv* 參數的非 **null** 值一律會覆寫伺服器 STUB 中的預設 EPV。</span><span class="sxs-lookup"><span data-stu-id="490ba-157">A non-**null** value for the *MgrEpv* a parameter always overrides a default EPV in the server stub.</span></span>

<span data-ttu-id="490ba-158">MIDL 編譯器會自動產生管理員 EPV 資料類型 (RPC \_ MGR \_ EPV) ，以便讓伺服器應用程式用於建立管理員 EPVs。</span><span class="sxs-lookup"><span data-stu-id="490ba-158">The MIDL compiler automatically generates a manager EPV data type (RPC\_MGR\_EPV) for a server application to use in constructing manager EPVs.</span></span> <span data-ttu-id="490ba-159">針對 IDL 檔案中定義的每個程式，管理員 EPV 必須只包含一個進入點 (函數位址) 。</span><span class="sxs-lookup"><span data-stu-id="490ba-159">A manager EPV must contain exactly one entry point (function address) for each procedure defined in the IDL file.</span></span>

<span data-ttu-id="490ba-160">在下列情況下，伺服器必須提供非 **null** 的 EPV：</span><span class="sxs-lookup"><span data-stu-id="490ba-160">A server must supply a non-**null** EPV in the following cases:</span></span>

-   <span data-ttu-id="490ba-161">當管理員常式的名稱與在介面定義中宣告的程式名稱不同時</span><span class="sxs-lookup"><span data-stu-id="490ba-161">When the names of manager routines differ from the procedure names declared in the interface definition</span></span>
-   <span data-ttu-id="490ba-162">當伺服器使用預設 EPV 來註冊另一個介面的執行時</span><span class="sxs-lookup"><span data-stu-id="490ba-162">When the server uses the default EPV for registering another implementation of the interface</span></span>

<span data-ttu-id="490ba-163">伺服器會宣告管理員 EPV，方法是在每次執行介面時，初始化類型為的變數（ \*如果-name \* \* \* \_ server \_ EPV *）*。</span><span class="sxs-lookup"><span data-stu-id="490ba-163">A server declares a manager EPV by initializing a variable of type *if-name\*\*\*\_SERVER\_EPV*\* for each implementation of the interface.</span></span>

## <a name="registering-a-single-implementation-of-an-interface"></a><span data-ttu-id="490ba-164">註冊介面的單一實作為</span><span class="sxs-lookup"><span data-stu-id="490ba-164">Registering a Single Implementation of an Interface</span></span>

<span data-ttu-id="490ba-165">當伺服器只提供一個介面的執行時，伺服器只會呼叫 [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif)、 [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)或 [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) 一次。</span><span class="sxs-lookup"><span data-stu-id="490ba-165">When a server offers only one implementation of an interface, the server calls [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex), or [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) only once.</span></span> <span data-ttu-id="490ba-166">在標準案例中，伺服器會使用預設的管理員 EPV。</span><span class="sxs-lookup"><span data-stu-id="490ba-166">In the standard case, the server uses the default manager EPV.</span></span> <span data-ttu-id="490ba-167"> (例外狀況是當管理員使用的常式名稱與介面中宣告的不同。 ) </span><span class="sxs-lookup"><span data-stu-id="490ba-167">(The exception is when the manager uses routine names that differ from those declared in the interface.)</span></span>

<span data-ttu-id="490ba-168">在標準案例中，您可以針對 [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif)、 [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)或 [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2)的呼叫提供下列值：</span><span class="sxs-lookup"><span data-stu-id="490ba-168">For the standard case, you supply the following values for calls to [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex), or [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2):</span></span>

-   <span data-ttu-id="490ba-169">管理員 EPVs</span><span class="sxs-lookup"><span data-stu-id="490ba-169">Manager EPVs</span></span>

    <span data-ttu-id="490ba-170">若要使用預設 EPV，請為 *MgrEpv* 參數指定 **null** 值。</span><span class="sxs-lookup"><span data-stu-id="490ba-170">To use the default EPV, specify a **null** value for the *MgrEpv* a parameter.</span></span>

-   <span data-ttu-id="490ba-171">管理員類型 UUID</span><span class="sxs-lookup"><span data-stu-id="490ba-171">Manager type UUID</span></span>

    <span data-ttu-id="490ba-172">使用預設 EPV 時，請提供 **null** 值或 *MgrTypeUuid* 參數的 nil UUID，以 nil 管理員類型 UUID 註冊介面。</span><span class="sxs-lookup"><span data-stu-id="490ba-172">When using the default EPV, register the interface with a nil manager type UUID by supplying either a **null** value or a nil UUID for the *MgrTypeUuid* a parameter.</span></span> <span data-ttu-id="490ba-173">在此情況下，所有遠端程序呼叫（不論其系結控制碼中的物件 UUID 為何）都會分派至預設 EPV （假設未進行任何 [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) 呼叫）。</span><span class="sxs-lookup"><span data-stu-id="490ba-173">In this case, all remote procedure calls, regardless of the object UUID in their binding handle, are dispatched to the default EPV, assuming no [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) calls have been made.</span></span>

    <span data-ttu-id="490ba-174">您也可以提供非 nil 管理員類型 UUID。</span><span class="sxs-lookup"><span data-stu-id="490ba-174">You can also provide a non-nil manager type UUID.</span></span> <span data-ttu-id="490ba-175">在此情況下，您也必須呼叫 [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) 常式。</span><span class="sxs-lookup"><span data-stu-id="490ba-175">In this case, you must also call the [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) routine.</span></span>

## <a name="registering-multiple-implementations-of-an-interface"></a><span data-ttu-id="490ba-176">註冊介面的多個執行</span><span class="sxs-lookup"><span data-stu-id="490ba-176">Registering Multiple Implementations of an Interface</span></span>

<span data-ttu-id="490ba-177">您可以為 IDL 檔案中指定的 () ，提供一個以上的遠端程式執行。</span><span class="sxs-lookup"><span data-stu-id="490ba-177">You can supply more than one implementation of the remote procedure(s) specified in the IDL file.</span></span> <span data-ttu-id="490ba-178">伺服器應用程式會呼叫 [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) ，將物件 uuid 對應至類型 uuid，並呼叫 [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif)、 [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)或 [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) ，以將 manager EPVs 與類型 uuid 產生關聯。</span><span class="sxs-lookup"><span data-stu-id="490ba-178">The server application calls [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) to map object UUIDs to type UUIDs and calls [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex), or [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) to associate manager EPVs with a type UUID.</span></span> <span data-ttu-id="490ba-179">當遠端程序呼叫以其物件 UUID 抵達時，RPC 伺服器執行時間程式庫會將物件 UUID 對應至類型 UUID。</span><span class="sxs-lookup"><span data-stu-id="490ba-179">When a remote procedure call arrives with its object UUID, the RPC server run-time library maps the object UUID to a type UUID.</span></span> <span data-ttu-id="490ba-180">然後，伺服器應用程式會使用類型 UUID 和介面 UUID 來選取管理員 EPV。</span><span class="sxs-lookup"><span data-stu-id="490ba-180">The server application then uses the type UUID and the interface UUID to select the manager EPV.</span></span>

<span data-ttu-id="490ba-181">您也可以指定自己的函式，將物件 UUID 的對應解析為管理員類型 UUID。</span><span class="sxs-lookup"><span data-stu-id="490ba-181">You can also specify your own function to resolve the mapping from object UUID to manager type UUID.</span></span> <span data-ttu-id="490ba-182">當您呼叫 [**RpcObjectSetInqFn**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsetinqfn)時，可以指定對應函式。</span><span class="sxs-lookup"><span data-stu-id="490ba-182">You specify the mapping function when you call [**RpcObjectSetInqFn**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsetinqfn).</span></span>

<span data-ttu-id="490ba-183">若要提供介面的多個介面，伺服器必須個別呼叫 [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif)、 [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex) 或 [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) 來註冊每個執行。</span><span class="sxs-lookup"><span data-stu-id="490ba-183">To offer multiple implementations of an interface, a server must register each implementation by calling [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex) or [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) separately.</span></span> <span data-ttu-id="490ba-184">針對伺服器所註冊的每個執行，它會提供相同的 *IfSpec* 參數，但會提供一組不同的 *MgrTypeUuid* 和 *MgrEpv* 參數。</span><span class="sxs-lookup"><span data-stu-id="490ba-184">For each implementation a server registers, it supplies the same *IfSpec* a parameter, but a different pair of *MgrTypeUuid* and *MgrEpv* a parameters.</span></span>

<span data-ttu-id="490ba-185">如果是多個管理員，請使用 [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif)、 [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex) 或 [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) ，如下所示：</span><span class="sxs-lookup"><span data-stu-id="490ba-185">In the case of multiple managers, use [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex) or [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) as follows:</span></span>

-   <span data-ttu-id="490ba-186">管理員 EPVs</span><span class="sxs-lookup"><span data-stu-id="490ba-186">Manager EPVs</span></span>

    <span data-ttu-id="490ba-187">若要提供介面的多個介面，伺服器必須：</span><span class="sxs-lookup"><span data-stu-id="490ba-187">To offer multiple implementations of an interface, a server must:</span></span>

    -   <span data-ttu-id="490ba-188">為每個額外的執行建立非 **null** 的管理員 EPV。</span><span class="sxs-lookup"><span data-stu-id="490ba-188">Create a non-**null** manager EPV for each additional implementation.</span></span>
    -   <span data-ttu-id="490ba-189">在 [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif)、 [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)或 [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2)中，為 *MgrEpv* 的參數指定非 **null** 的值。</span><span class="sxs-lookup"><span data-stu-id="490ba-189">Specify a non-**null** value for the *MgrEpv* a parameter in [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex), or [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2).</span></span>

    <span data-ttu-id="490ba-190">請注意，伺服器也可以使用預設的管理員 EPV 進行註冊。</span><span class="sxs-lookup"><span data-stu-id="490ba-190">Please note that the server can also register with the default manager EPV.</span></span>

-   <span data-ttu-id="490ba-191">管理員類型 UUID</span><span class="sxs-lookup"><span data-stu-id="490ba-191">Manager type UUID</span></span>

    <span data-ttu-id="490ba-192">為介面的每個 EPV 提供管理員類型 UUID。</span><span class="sxs-lookup"><span data-stu-id="490ba-192">Provide a manager type UUID for each EPV of the interface.</span></span> <span data-ttu-id="490ba-193">您可以針對 MgrTypeUuid 的其中一個管理員 EPVs，指定 nil 類型 UUID (或 **null** 值) 參數。</span><span class="sxs-lookup"><span data-stu-id="490ba-193">The nil type UUID (or **null** value) for the *MgrTypeUuid* a parameter can be specified for one of the manager EPVs.</span></span> <span data-ttu-id="490ba-194">每個類型的 UUID 都必須不同。</span><span class="sxs-lookup"><span data-stu-id="490ba-194">Each type UUID must be different.</span></span>

## <a name="rules-for-invoking-manager-routines"></a><span data-ttu-id="490ba-195">叫用管理員常式的規則</span><span class="sxs-lookup"><span data-stu-id="490ba-195">Rules for Invoking Manager Routines</span></span>

<span data-ttu-id="490ba-196">RPC 執行時間程式庫會將傳入的遠端程序呼叫分派給提供所要求 RPC 介面的管理員。</span><span class="sxs-lookup"><span data-stu-id="490ba-196">The RPC run-time library dispatches an incoming remote procedure call to a manager that offers the requested RPC interface.</span></span> <span data-ttu-id="490ba-197">針對某個介面註冊多個管理員時，RPC 執行時間程式庫必須選取其中一個。</span><span class="sxs-lookup"><span data-stu-id="490ba-197">When multiple managers are registered for an interface, the RPC run-time library must select one of them.</span></span> <span data-ttu-id="490ba-198">為了選取管理員，RPC 執行時間程式庫會使用呼叫的系結控制碼所指定的物件 UUID。</span><span class="sxs-lookup"><span data-stu-id="490ba-198">To select a manager, the RPC run-time library uses the object UUID specified by the call's binding handle.</span></span>

<span data-ttu-id="490ba-199">在解讀遠端程序呼叫的物件 UUID 時，執行時間程式庫會套用下列規則：</span><span class="sxs-lookup"><span data-stu-id="490ba-199">The run-time library applies the following rules when interpreting the object UUID of a remote procedure call:</span></span>

-   <span data-ttu-id="490ba-200">Nil 物件 Uuid</span><span class="sxs-lookup"><span data-stu-id="490ba-200">Nil object UUIDs</span></span>

    <span data-ttu-id="490ba-201">Nil 物件 UUID 會自動指派給 nil 類型 UUID (不合法，無法在 [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) 常式) 中指定 NIL 物件 uuid。</span><span class="sxs-lookup"><span data-stu-id="490ba-201">A nil object UUID is automatically assigned the nil type UUID (it is illegal to specify a nil object UUID in the [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) routine).</span></span> <span data-ttu-id="490ba-202">因此，其系結控制碼包含 nil 物件 UUID 的遠端程序呼叫會自動分派給以 nil 類型 UUID 註冊的管理員（如果有的話）。</span><span class="sxs-lookup"><span data-stu-id="490ba-202">Therefore, a remote procedure call whose binding handle contains a nil object UUID is automatically dispatched to the manager registered with the nil type UUID, if any.</span></span>

-   <span data-ttu-id="490ba-203">非 nil 物件 Uuid</span><span class="sxs-lookup"><span data-stu-id="490ba-203">Non-nil object UUIDs</span></span>

    <span data-ttu-id="490ba-204">在主體中，其系結控制碼包含非 nil 物件 UUID 的遠端程序呼叫，應該由其類型 UUID 符合物件 UUID 類型的管理員來處理。</span><span class="sxs-lookup"><span data-stu-id="490ba-204">In principle, a remote procedure call whose binding handle contains a non-nil object UUID should be processed by a manager whose type UUID matches the type of the object UUID.</span></span> <span data-ttu-id="490ba-205">不過，識別正確的管理員需要伺服器透過呼叫 [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) 常式來指定該物件 UUID 的型別。</span><span class="sxs-lookup"><span data-stu-id="490ba-205">However, identifying the correct manager requires that the server has specified the type of that object UUID by calling the [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) routine.</span></span>

    <span data-ttu-id="490ba-206">如果伺服器無法呼叫非 nil 物件 UUID 的 [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) 常式，該物件 uuid 的遠端程序呼叫將會移至服務遠端程序呼叫具有 NIL 物件 uuid 的管理員 EPV， (也就是 NIL 類型 uuid) 。</span><span class="sxs-lookup"><span data-stu-id="490ba-206">If a server fails to call the [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) routine for a non-nil object UUID, a remote procedure call for that object UUID goes to the manager EPV that services remote procedure calls with a nil object UUID (that is, the nil type UUID).</span></span>

    <span data-ttu-id="490ba-207">如果伺服器指派了非 nil 物件 uuid 的類型 UUID （藉由呼叫 [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) 常式來 UUID 類型 uuid），但尚未藉由呼叫 [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif)、 [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex) 或 [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2)來註冊該類型 uuid 的管理員 EPV，就無法執行在系結控制碼中具有非 nil 物件 uuid 的遠端程序呼叫。</span><span class="sxs-lookup"><span data-stu-id="490ba-207">Remote procedure calls with a non-nil object UUID in the binding handle cannot be executed if the server assigned that non-nil object UUID a type UUID by calling the [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) routine, but did not also register a manager EPV for that type UUID by calling [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex) or [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2).</span></span>

<span data-ttu-id="490ba-208">下表摘要說明執行時間程式庫用來選取管理員常式的動作。</span><span class="sxs-lookup"><span data-stu-id="490ba-208">The following table summarizes the actions that the run-time library uses to select the manager routine.</span></span>



| <span data-ttu-id="490ba-209">呼叫的物件 UUID</span><span class="sxs-lookup"><span data-stu-id="490ba-209">Object UUID of call</span></span> | <span data-ttu-id="490ba-210">物件 UUID 的伺服器組類型？</span><span class="sxs-lookup"><span data-stu-id="490ba-210">Server set type for object UUID?</span></span> | <span data-ttu-id="490ba-211">伺服器已註冊的 EPV 類型？</span><span class="sxs-lookup"><span data-stu-id="490ba-211">Server registered EPV type?</span></span> | <span data-ttu-id="490ba-212">分派動作</span><span class="sxs-lookup"><span data-stu-id="490ba-212">Dispatching action</span></span>                                                                                                                                 |
|---------------------|----------------------------------|-----------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="490ba-213">零</span><span class="sxs-lookup"><span data-stu-id="490ba-213">Nil</span></span>                 | <span data-ttu-id="490ba-214">不適用</span><span class="sxs-lookup"><span data-stu-id="490ba-214">Not applicable</span></span>                   | <span data-ttu-id="490ba-215">是</span><span class="sxs-lookup"><span data-stu-id="490ba-215">Yes</span></span>                         | <span data-ttu-id="490ba-216">使用具有 nil 類型 UUID 的管理員。</span><span class="sxs-lookup"><span data-stu-id="490ba-216">Uses the manager with the nil type UUID.</span></span>                                                                                                           |
| <span data-ttu-id="490ba-217">零</span><span class="sxs-lookup"><span data-stu-id="490ba-217">Nil</span></span>                 | <span data-ttu-id="490ba-218">不適用</span><span class="sxs-lookup"><span data-stu-id="490ba-218">Not applicable</span></span>                   | <span data-ttu-id="490ba-219">否</span><span class="sxs-lookup"><span data-stu-id="490ba-219">No</span></span>                          | <span data-ttu-id="490ba-220">錯誤 (RPC \_ S \_ 不支援 \_ 的類型) ; 拒絕遠端程序呼叫。</span><span class="sxs-lookup"><span data-stu-id="490ba-220">Error (RPC\_S\_UNSUPPORTED\_TYPE); rejects the remote procedure call.</span></span>                                                                              |
| <span data-ttu-id="490ba-221">非 nil</span><span class="sxs-lookup"><span data-stu-id="490ba-221">Non-nil</span></span>             | <span data-ttu-id="490ba-222">是</span><span class="sxs-lookup"><span data-stu-id="490ba-222">Yes</span></span>                              | <span data-ttu-id="490ba-223">是</span><span class="sxs-lookup"><span data-stu-id="490ba-223">Yes</span></span>                         | <span data-ttu-id="490ba-224">使用具有相同類型 UUID 的管理員。</span><span class="sxs-lookup"><span data-stu-id="490ba-224">Uses the manager with the same type UUID.</span></span>                                                                                                          |
| <span data-ttu-id="490ba-225">非 nil</span><span class="sxs-lookup"><span data-stu-id="490ba-225">Non-nil</span></span>             | <span data-ttu-id="490ba-226">否</span><span class="sxs-lookup"><span data-stu-id="490ba-226">No</span></span>                               | <span data-ttu-id="490ba-227">忽略</span><span class="sxs-lookup"><span data-stu-id="490ba-227">Ignored</span></span>                     | <span data-ttu-id="490ba-228">使用具有 nil 類型 UUID 的管理員。</span><span class="sxs-lookup"><span data-stu-id="490ba-228">Uses the manager with the nil type UUID.</span></span> <span data-ttu-id="490ba-229">如果沒有具有 nil 類型 UUID 的管理員，錯誤 (RPC \_ S \_ UNSUPPORTEDTYPE) ; 會拒絕遠端程序呼叫。</span><span class="sxs-lookup"><span data-stu-id="490ba-229">If no manager with the nil type UUID, error (RPC\_S\_UNSUPPORTEDTYPE); rejects the remote procedure call.</span></span> |
| <span data-ttu-id="490ba-230">非 nil</span><span class="sxs-lookup"><span data-stu-id="490ba-230">Non-nil</span></span>             | <span data-ttu-id="490ba-231">是</span><span class="sxs-lookup"><span data-stu-id="490ba-231">Yes</span></span>                              | <span data-ttu-id="490ba-232">否</span><span class="sxs-lookup"><span data-stu-id="490ba-232">No</span></span>                          | <span data-ttu-id="490ba-233"> (RPC \_ S \_ UNSUPPORTEDTYPE) 時發生錯誤; 拒絕遠端程序呼叫。</span><span class="sxs-lookup"><span data-stu-id="490ba-233">Error (RPC\_S\_UNSUPPORTEDTYPE); rejects the remote procedure call.</span></span>                                                                                |



 

<span data-ttu-id="490ba-234">呼叫的物件 UUID 是在遠端程序呼叫的系結控制碼中找到的物件 UUID。</span><span class="sxs-lookup"><span data-stu-id="490ba-234">The object UUID of the call is the object UUID found in a binding handle for a remote procedure call.</span></span>

<span data-ttu-id="490ba-235">伺服器會藉由呼叫 [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) 來指定物件的類型 uuid，藉以設定物件 uuid 的型別。</span><span class="sxs-lookup"><span data-stu-id="490ba-235">The server sets the type of the object UUID by calling [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) to specify the type UUID for an object.</span></span>

<span data-ttu-id="490ba-236">伺服器會使用相同的類型 UUID 來呼叫 [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif)、 [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex) 或 [**RPCSERVERREGISTERIF2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) ，以註冊管理員 EPV 的類型。</span><span class="sxs-lookup"><span data-stu-id="490ba-236">The server registers the type for the manager EPV by calling [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex) or [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) using the same type UUID.</span></span>

> [!Note]  
> <span data-ttu-id="490ba-237">Nil 物件 UUID 一律會自動指派 nil 類型 UUID。</span><span class="sxs-lookup"><span data-stu-id="490ba-237">The nil object UUID is always automatically assigned the nil type UUID.</span></span> <span data-ttu-id="490ba-238">在 [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) 常式中指定 NIL 物件 UUID 是不合法的。</span><span class="sxs-lookup"><span data-stu-id="490ba-238">It is illegal to specify a nil object UUID in the [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) routine.</span></span>

 

## <a name="dispatching-a-remote-procedure-call-to-a-server-manager-routine"></a><span data-ttu-id="490ba-239">分派遠端程序呼叫至伺服器管理員常式</span><span class="sxs-lookup"><span data-stu-id="490ba-239">Dispatching a Remote Procedure Call to a Server-manager Routine</span></span>

<span data-ttu-id="490ba-240">下表顯示 RPC 執行時間程式庫將遠端程序呼叫分派至伺服器管理員常式所需的步驟。</span><span class="sxs-lookup"><span data-stu-id="490ba-240">The following tables show the steps that the RPC run-time library takes to dispatch a remote procedure call to a server-manager routine.</span></span>

<span data-ttu-id="490ba-241">下表說明伺服器註冊預設管理者 EPV 的簡單案例。</span><span class="sxs-lookup"><span data-stu-id="490ba-241">A simple case where the server registers the default manager EPV, is described in the following tables.</span></span>

<span data-ttu-id="490ba-242">**介面登錄表**</span><span class="sxs-lookup"><span data-stu-id="490ba-242">**Interface Registry Table**</span></span>



| <span data-ttu-id="490ba-243">介面 UUID</span><span class="sxs-lookup"><span data-stu-id="490ba-243">Interface UUID</span></span> | <span data-ttu-id="490ba-244">管理員類型 UUID</span><span class="sxs-lookup"><span data-stu-id="490ba-244">Manager type UUID</span></span> | <span data-ttu-id="490ba-245">進入點向量</span><span class="sxs-lookup"><span data-stu-id="490ba-245">Entry-point vector</span></span> |
|----------------|-------------------|--------------------|
| <span data-ttu-id="490ba-246">*uuid1*</span><span class="sxs-lookup"><span data-stu-id="490ba-246">*uuid1*</span></span>        | <span data-ttu-id="490ba-247">零</span><span class="sxs-lookup"><span data-stu-id="490ba-247">Nil</span></span>               | <span data-ttu-id="490ba-248">預設 EPV</span><span class="sxs-lookup"><span data-stu-id="490ba-248">Default EPV</span></span>        |



 

<span data-ttu-id="490ba-249">**物件登錄資料表**</span><span class="sxs-lookup"><span data-stu-id="490ba-249">**Object Registry Table**</span></span>



| <span data-ttu-id="490ba-250">物件 UUID</span><span class="sxs-lookup"><span data-stu-id="490ba-250">Object UUID</span></span>             | <span data-ttu-id="490ba-251">物件型別</span><span class="sxs-lookup"><span data-stu-id="490ba-251">Object type</span></span> |
|-------------------------|-------------|
| <span data-ttu-id="490ba-252">零</span><span class="sxs-lookup"><span data-stu-id="490ba-252">Nil</span></span>                     | <span data-ttu-id="490ba-253">零</span><span class="sxs-lookup"><span data-stu-id="490ba-253">Nil</span></span>         |
| <span data-ttu-id="490ba-254"> (任何其他物件 UUID) </span><span class="sxs-lookup"><span data-stu-id="490ba-254">(Any other object UUID)</span></span> | <span data-ttu-id="490ba-255">零</span><span class="sxs-lookup"><span data-stu-id="490ba-255">Nil</span></span>         |



 

<span data-ttu-id="490ba-256">**將系結控制碼對應至進入點向量 (EPV)**</span><span class="sxs-lookup"><span data-stu-id="490ba-256">**Mapping the Binding Handle to an Entry-point Vector (EPV)**</span></span>



| <span data-ttu-id="490ba-257">從用戶端系結控制碼 (介面 UUID) </span><span class="sxs-lookup"><span data-stu-id="490ba-257">Interface UUID (from client binding handle)</span></span> | <span data-ttu-id="490ba-258">從用戶端系結控制碼 (的物件 UUID) </span><span class="sxs-lookup"><span data-stu-id="490ba-258">Object UUID (from client binding handle)</span></span> | <span data-ttu-id="490ba-259">從物件登錄表 (的物件類型) </span><span class="sxs-lookup"><span data-stu-id="490ba-259">Object type (from object registry table)</span></span> | <span data-ttu-id="490ba-260">來自介面登錄表的管理員 EPV () </span><span class="sxs-lookup"><span data-stu-id="490ba-260">Manager EPV (from interface registry table)</span></span> |
|---------------------------------------------|------------------------------------------|------------------------------------------|---------------------------------------------|
| <span data-ttu-id="490ba-261">*uuid1*</span><span class="sxs-lookup"><span data-stu-id="490ba-261">*uuid1*</span></span>                                     | <span data-ttu-id="490ba-262">零</span><span class="sxs-lookup"><span data-stu-id="490ba-262">Nil</span></span>                                      | <span data-ttu-id="490ba-263">零</span><span class="sxs-lookup"><span data-stu-id="490ba-263">Nil</span></span>                                      | <span data-ttu-id="490ba-264">預設 EPV</span><span class="sxs-lookup"><span data-stu-id="490ba-264">Default EPV</span></span>                                 |
| <span data-ttu-id="490ba-265">同上</span><span class="sxs-lookup"><span data-stu-id="490ba-265">Same as above</span></span>                               | <span data-ttu-id="490ba-266">*uuidA*</span><span class="sxs-lookup"><span data-stu-id="490ba-266">*uuidA*</span></span>                                  | <span data-ttu-id="490ba-267">零</span><span class="sxs-lookup"><span data-stu-id="490ba-267">Nil</span></span>                                      | <span data-ttu-id="490ba-268">預設 EPV</span><span class="sxs-lookup"><span data-stu-id="490ba-268">Default EPV</span></span>                                 |



 

<span data-ttu-id="490ba-269">下列步驟描述當具有介面 UUID 的用戶端呼叫 *uuid1* 時，RPC 伺服器執行時間程式庫所執行的動作（如上表所示）。</span><span class="sxs-lookup"><span data-stu-id="490ba-269">The following steps describe the actions that the RPC server's run-time library take, as shown in the preceding tables, when a client with interface UUID *uuid1* calls it.</span></span>

1.  <span data-ttu-id="490ba-270">伺服器會呼叫 [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif)、 [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)或 [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) ，將它所提供的介面與 nil 管理員類型 UUID 和 MIDL 產生的預設管理者 EPV 相關聯。</span><span class="sxs-lookup"><span data-stu-id="490ba-270">The server calls [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex), or [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) to associate an interface it offers with the nil manager type UUID and with the MIDL-generated default manager EPV.</span></span> <span data-ttu-id="490ba-271">此呼叫會在介面登錄表中新增專案。</span><span class="sxs-lookup"><span data-stu-id="490ba-271">This call adds an entry in the interface registry table.</span></span> <span data-ttu-id="490ba-272">介面 UUID 包含在 *IfSpec* 參數中。</span><span class="sxs-lookup"><span data-stu-id="490ba-272">The interface UUID is contained in the *IfSpec* a parameter.</span></span>
2.  <span data-ttu-id="490ba-273">依預設，物件登錄表會將所有物件 Uuid 與 nil 類型 UUID 產生關聯。</span><span class="sxs-lookup"><span data-stu-id="490ba-273">By default, the object registry table associates all object UUIDs with the nil type UUID.</span></span> <span data-ttu-id="490ba-274">在此範例中，伺服器不會呼叫 [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype)。</span><span class="sxs-lookup"><span data-stu-id="490ba-274">In this example, the server does not call [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype).</span></span>
3.  <span data-ttu-id="490ba-275">伺服器執行時間程式庫會接收遠端程式程式碼，其中包含呼叫所屬的介面 UUID，以及來自呼叫系結控制碼的物件 UUID。</span><span class="sxs-lookup"><span data-stu-id="490ba-275">The server run-time library receives a remote procedure code containing the interface UUID that the call belongs to and the object UUID from the call's binding handle.</span></span>

    <span data-ttu-id="490ba-276">如需如何將物件 UUID 設定為系結控制碼的討論，請參閱下列函式參考專案：</span><span class="sxs-lookup"><span data-stu-id="490ba-276">See the following function reference entries for discussions of how an object UUID is set into a binding handle:</span></span>

    -   [<span data-ttu-id="490ba-277">**RpcNsBindingImportBegin**</span><span class="sxs-lookup"><span data-stu-id="490ba-277">**RpcNsBindingImportBegin**</span></span>](/windows/desktop/api/Rpcnsi/nf-rpcnsi-rpcnsbindingimportbegina)
    -   [<span data-ttu-id="490ba-278">**RpcNsBindingLookupBegin**</span><span class="sxs-lookup"><span data-stu-id="490ba-278">**RpcNsBindingLookupBegin**</span></span>](/windows/desktop/api/Rpcnsi/nf-rpcnsi-rpcnsbindinglookupbegina)
    -   [<span data-ttu-id="490ba-279">**RpcBindingFromStringBinding**</span><span class="sxs-lookup"><span data-stu-id="490ba-279">**RpcBindingFromStringBinding**</span></span>](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingfromstringbinding)
    -   [<span data-ttu-id="490ba-280">**RpcBindingSetObject**</span><span class="sxs-lookup"><span data-stu-id="490ba-280">**RpcBindingSetObject**</span></span>](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetobject)

4.  <span data-ttu-id="490ba-281">使用遠端程序呼叫中的介面 UUID 時，伺服器的執行時間程式庫會在介面登錄表中尋找該介面 UUID。</span><span class="sxs-lookup"><span data-stu-id="490ba-281">Using the interface UUID from the remote procedure call, the server's run-time library locates that interface UUID in the interface registry table.</span></span>

    <span data-ttu-id="490ba-282">如果伺服器未使用 [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif)、 [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)或 [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2)註冊介面，則遠端程序呼叫會傳回至呼叫端，且 \_ \_ 如果狀態碼為 UNKNOWN，則會傳回給呼叫端 \_ 。</span><span class="sxs-lookup"><span data-stu-id="490ba-282">If the server did not register the interface using [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex), or [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2), then the remote procedure call returns to the caller with an RPC\_S\_UNKNOWN\_IF status code.</span></span>

5.  <span data-ttu-id="490ba-283">從系結控制碼使用物件 UUID 時，伺服器的執行時間程式庫會在物件登錄表中找出該物件 UUID。</span><span class="sxs-lookup"><span data-stu-id="490ba-283">Using the object UUID from the binding handle, the server's run-time library locates that object UUID in the object registry table.</span></span> <span data-ttu-id="490ba-284">在此範例中，所有物件 Uuid 都會對應到 nil 物件類型。</span><span class="sxs-lookup"><span data-stu-id="490ba-284">In this example, all object UUIDs map to the nil object type.</span></span>
6.  <span data-ttu-id="490ba-285">伺服器的執行時間程式庫會在介面登錄表中找出「nil 管理員」類型。</span><span class="sxs-lookup"><span data-stu-id="490ba-285">The server's run-time library locates the nil manager type in the interface registry table.</span></span>
7.  <span data-ttu-id="490ba-286">將介面登錄表中的介面 UUID 和 nil 類型合併，會解析為預設 EPV，其中包含要針對遠端程序呼叫中找到的介面 UUID 執行的伺服器管理員常式。</span><span class="sxs-lookup"><span data-stu-id="490ba-286">Combining the interface UUID and nil type in the interface registry table resolves to the default EPV, which contains the server-manager routines to be executed for the interface UUID found in the remote procedure call.</span></span>

<span data-ttu-id="490ba-287">假設伺服器會為每個介面提供多個介面和多個執行，如下表所述。</span><span class="sxs-lookup"><span data-stu-id="490ba-287">Assume that the server offers multiple interfaces and multiple implementations of each interface, as described in the following tables.</span></span>

<span data-ttu-id="490ba-288">**介面登錄表**</span><span class="sxs-lookup"><span data-stu-id="490ba-288">**Interface Registry Table**</span></span>



| <span data-ttu-id="490ba-289">介面 UUID</span><span class="sxs-lookup"><span data-stu-id="490ba-289">Interface UUID</span></span> | <span data-ttu-id="490ba-290">管理員類型 UUID</span><span class="sxs-lookup"><span data-stu-id="490ba-290">Manager-type UUID</span></span> | <span data-ttu-id="490ba-291">進入點向量</span><span class="sxs-lookup"><span data-stu-id="490ba-291">Entry-point vector</span></span> |
|----------------|-------------------|--------------------|
| <span data-ttu-id="490ba-292">*uuid1*</span><span class="sxs-lookup"><span data-stu-id="490ba-292">*uuid1*</span></span>        | <span data-ttu-id="490ba-293">零</span><span class="sxs-lookup"><span data-stu-id="490ba-293">Nil</span></span>               | <span data-ttu-id="490ba-294">*epv1*</span><span class="sxs-lookup"><span data-stu-id="490ba-294">*epv1*</span></span>             |
| <span data-ttu-id="490ba-295">*uuid1*</span><span class="sxs-lookup"><span data-stu-id="490ba-295">*uuid1*</span></span>        | <span data-ttu-id="490ba-296">*uuid3*</span><span class="sxs-lookup"><span data-stu-id="490ba-296">*uuid3*</span></span>           | <span data-ttu-id="490ba-297">*epv4*</span><span class="sxs-lookup"><span data-stu-id="490ba-297">*epv4*</span></span>             |
| <span data-ttu-id="490ba-298">*uuid2*</span><span class="sxs-lookup"><span data-stu-id="490ba-298">*uuid2*</span></span>        | <span data-ttu-id="490ba-299">*uuid4*</span><span class="sxs-lookup"><span data-stu-id="490ba-299">*uuid4*</span></span>           | <span data-ttu-id="490ba-300">*epv2*</span><span class="sxs-lookup"><span data-stu-id="490ba-300">*epv2*</span></span>             |
| <span data-ttu-id="490ba-301">*uuid2*</span><span class="sxs-lookup"><span data-stu-id="490ba-301">*uuid2*</span></span>        | <span data-ttu-id="490ba-302">*uuid7*</span><span class="sxs-lookup"><span data-stu-id="490ba-302">*uuid7*</span></span>           | <span data-ttu-id="490ba-303">*epv3*</span><span class="sxs-lookup"><span data-stu-id="490ba-303">*epv3*</span></span>             |



 

<span data-ttu-id="490ba-304">**物件登錄資料表**</span><span class="sxs-lookup"><span data-stu-id="490ba-304">**Object Registry Table**</span></span>



| <span data-ttu-id="490ba-305">物件 UUID</span><span class="sxs-lookup"><span data-stu-id="490ba-305">Object UUID</span></span>      | <span data-ttu-id="490ba-306">物件型別</span><span class="sxs-lookup"><span data-stu-id="490ba-306">Object type</span></span> |
|------------------|-------------|
| <span data-ttu-id="490ba-307">*uuidA*</span><span class="sxs-lookup"><span data-stu-id="490ba-307">*uuidA*</span></span>          | <span data-ttu-id="490ba-308">*uuid3*</span><span class="sxs-lookup"><span data-stu-id="490ba-308">*uuid3*</span></span>     |
| <span data-ttu-id="490ba-309">*uuidB*</span><span class="sxs-lookup"><span data-stu-id="490ba-309">*uuidB*</span></span>          | <span data-ttu-id="490ba-310">*uuid7*</span><span class="sxs-lookup"><span data-stu-id="490ba-310">*uuid7*</span></span>     |
| <span data-ttu-id="490ba-311">*uuidC*</span><span class="sxs-lookup"><span data-stu-id="490ba-311">*uuidC*</span></span>          | <span data-ttu-id="490ba-312">*uuid7*</span><span class="sxs-lookup"><span data-stu-id="490ba-312">*uuid7*</span></span>     |
| <span data-ttu-id="490ba-313">*uuidD*</span><span class="sxs-lookup"><span data-stu-id="490ba-313">*uuidD*</span></span>          | <span data-ttu-id="490ba-314">*uuid3*</span><span class="sxs-lookup"><span data-stu-id="490ba-314">*uuid3*</span></span>     |
| <span data-ttu-id="490ba-315">*uuidE*</span><span class="sxs-lookup"><span data-stu-id="490ba-315">*uuidE*</span></span>          | <span data-ttu-id="490ba-316">*uuid3*</span><span class="sxs-lookup"><span data-stu-id="490ba-316">*uuid3*</span></span>     |
| <span data-ttu-id="490ba-317">*uuidF*</span><span class="sxs-lookup"><span data-stu-id="490ba-317">*uuidF*</span></span>          | <span data-ttu-id="490ba-318">*uuid8*</span><span class="sxs-lookup"><span data-stu-id="490ba-318">*uuid8*</span></span>     |
| <span data-ttu-id="490ba-319">零</span><span class="sxs-lookup"><span data-stu-id="490ba-319">Nil</span></span>              | <span data-ttu-id="490ba-320">零</span><span class="sxs-lookup"><span data-stu-id="490ba-320">Nil</span></span>         |
| <span data-ttu-id="490ba-321"> (任何其他 UUID) </span><span class="sxs-lookup"><span data-stu-id="490ba-321">(Any other UUID)</span></span> | <span data-ttu-id="490ba-322">零</span><span class="sxs-lookup"><span data-stu-id="490ba-322">Nil</span></span>         |



 

<span data-ttu-id="490ba-323">**將系結控制碼對應至進入點向量**</span><span class="sxs-lookup"><span data-stu-id="490ba-323">**Mapping the Binding Handle to an Entry-point Vector**</span></span>



| <span data-ttu-id="490ba-324">從用戶端系結控制碼 (介面 UUID) </span><span class="sxs-lookup"><span data-stu-id="490ba-324">Interface UUID (from client binding handle)</span></span> | <span data-ttu-id="490ba-325">從用戶端系結控制碼 (的物件 UUID) </span><span class="sxs-lookup"><span data-stu-id="490ba-325">Object UUID (from client binding handle)</span></span> | <span data-ttu-id="490ba-326">從物件登錄表 (的物件類型) </span><span class="sxs-lookup"><span data-stu-id="490ba-326">Object type (from object registry table)</span></span> | <span data-ttu-id="490ba-327">來自介面登錄表的管理員 EPV () </span><span class="sxs-lookup"><span data-stu-id="490ba-327">Manager EPV (from interface registry table)</span></span> |
|---------------------------------------------|------------------------------------------|------------------------------------------|---------------------------------------------|
| <span data-ttu-id="490ba-328">*uuid1*</span><span class="sxs-lookup"><span data-stu-id="490ba-328">*uuid1*</span></span>                                     | <span data-ttu-id="490ba-329">零</span><span class="sxs-lookup"><span data-stu-id="490ba-329">Nil</span></span>                                      | <span data-ttu-id="490ba-330">零</span><span class="sxs-lookup"><span data-stu-id="490ba-330">Nil</span></span>                                      | <span data-ttu-id="490ba-331">*epv1*</span><span class="sxs-lookup"><span data-stu-id="490ba-331">*epv1*</span></span>                                      |
| <span data-ttu-id="490ba-332">*uuid1*</span><span class="sxs-lookup"><span data-stu-id="490ba-332">*uuid1*</span></span>                                     | <span data-ttu-id="490ba-333">*uuidA*</span><span class="sxs-lookup"><span data-stu-id="490ba-333">*uuidA*</span></span>                                  | <span data-ttu-id="490ba-334">*uuid3*</span><span class="sxs-lookup"><span data-stu-id="490ba-334">*uuid3*</span></span>                                  | <span data-ttu-id="490ba-335">*epv4*</span><span class="sxs-lookup"><span data-stu-id="490ba-335">*epv4*</span></span>                                      |
| <span data-ttu-id="490ba-336">*uuid1*</span><span class="sxs-lookup"><span data-stu-id="490ba-336">*uuid1*</span></span>                                     | <span data-ttu-id="490ba-337">*uuidD*</span><span class="sxs-lookup"><span data-stu-id="490ba-337">*uuidD*</span></span>                                  | <span data-ttu-id="490ba-338">*uuid3*</span><span class="sxs-lookup"><span data-stu-id="490ba-338">*uuid3*</span></span>                                  | <span data-ttu-id="490ba-339">*epv4*</span><span class="sxs-lookup"><span data-stu-id="490ba-339">*epv4*</span></span>                                      |
| <span data-ttu-id="490ba-340">*uuid1*</span><span class="sxs-lookup"><span data-stu-id="490ba-340">*uuid1*</span></span>                                     | <span data-ttu-id="490ba-341">*uuidE*</span><span class="sxs-lookup"><span data-stu-id="490ba-341">*uuidE*</span></span>                                  | <span data-ttu-id="490ba-342">*uuid3*</span><span class="sxs-lookup"><span data-stu-id="490ba-342">*uuid3*</span></span>                                  | <span data-ttu-id="490ba-343">*epv4*</span><span class="sxs-lookup"><span data-stu-id="490ba-343">*epv4*</span></span>                                      |
| <span data-ttu-id="490ba-344">*uuid2*</span><span class="sxs-lookup"><span data-stu-id="490ba-344">*uuid2*</span></span>                                     | <span data-ttu-id="490ba-345">*uuidB*</span><span class="sxs-lookup"><span data-stu-id="490ba-345">*uuidB*</span></span>                                  | <span data-ttu-id="490ba-346">*uuid7*</span><span class="sxs-lookup"><span data-stu-id="490ba-346">*uuid7*</span></span>                                  | <span data-ttu-id="490ba-347">*epv3*</span><span class="sxs-lookup"><span data-stu-id="490ba-347">*epv3*</span></span>                                      |
| <span data-ttu-id="490ba-348">*uuid2*</span><span class="sxs-lookup"><span data-stu-id="490ba-348">*uuid2*</span></span>                                     | <span data-ttu-id="490ba-349">*uuidC*</span><span class="sxs-lookup"><span data-stu-id="490ba-349">*uuidC*</span></span>                                  | <span data-ttu-id="490ba-350">*uuid7*</span><span class="sxs-lookup"><span data-stu-id="490ba-350">*uuid7*</span></span>                                  | <span data-ttu-id="490ba-351">*epv3*</span><span class="sxs-lookup"><span data-stu-id="490ba-351">*epv3*</span></span>                                      |



 

<span data-ttu-id="490ba-352">下列步驟描述伺服器執行時間程式庫所採取的動作，如上表所示，當具有介面 UUID *uuid2* 和物件 uuid *uuidC* 的用戶端呼叫它時。</span><span class="sxs-lookup"><span data-stu-id="490ba-352">The following steps describe the actions that the server's run-time library take, as shown in the preceding tables when a client with interface UUID *uuid2* and object UUID *uuidC* calls it.</span></span>

1.  <span data-ttu-id="490ba-353">伺服器會呼叫 [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif)、 [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)或 [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) ，將它所提供的介面與不同的管理員 EPVs 產生關聯。</span><span class="sxs-lookup"><span data-stu-id="490ba-353">The server calls [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex), or [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) to associate the interfaces it offers with the different manager EPVs.</span></span> <span data-ttu-id="490ba-354">介面登錄表中的專案會反映 [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif)、 [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)或 [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) 的四個呼叫，以提供兩個介面，並針對每個介面 (EPVs) 。</span><span class="sxs-lookup"><span data-stu-id="490ba-354">The entries in the interface registry table reflect four calls of [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex), or [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) to offer two interfaces, with two implementations (EPVs) for each interface.</span></span>
2.  <span data-ttu-id="490ba-355">伺服器會呼叫 [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) 來建立它所提供之每個物件的型別。</span><span class="sxs-lookup"><span data-stu-id="490ba-355">The server calls [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) to establish the type of each object it offers.</span></span> <span data-ttu-id="490ba-356">除了 nil 物件與 nil 型別的預設關聯以外，在物件登錄表中未明確找到的所有其他物件 Uuid 也會對應到 nil 類型 UUID。</span><span class="sxs-lookup"><span data-stu-id="490ba-356">In addition to the default association of the nil object to a nil type, all other object UUIDs not explicitly found in the object registry table also map to the nil type UUID.</span></span>

    <span data-ttu-id="490ba-357">在此範例中，伺服器會呼叫 [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) 常式六次。</span><span class="sxs-lookup"><span data-stu-id="490ba-357">In this example, the server calls the [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) routine six times.</span></span>

3.  <span data-ttu-id="490ba-358">伺服器執行時間程式庫會接收遠端程序呼叫，其中包含呼叫所屬的介面 UUID，以及來自呼叫系結控制碼的物件 UUID。</span><span class="sxs-lookup"><span data-stu-id="490ba-358">The server run-time library receives a remote procedure call containing the interface UUID that the call belongs to and an object UUID from the call's binding handle.</span></span>
4.  <span data-ttu-id="490ba-359">使用遠端程序呼叫中的介面 UUID，伺服器的執行時間程式庫會找出介面登錄表中的介面 UUID。</span><span class="sxs-lookup"><span data-stu-id="490ba-359">Using the interface UUID from the remote procedure call, the server's run-time library locates the interface UUID in the interface registry table.</span></span>
5.  <span data-ttu-id="490ba-360">從系結控制碼使用 *uuidC* 物件 uuid 時，伺服器的執行時間程式庫會在物件登錄表中找出物件 uuid，併發現它會對應到類型 *uuid7*。</span><span class="sxs-lookup"><span data-stu-id="490ba-360">Using the *uuidC* object UUID from the binding handle, the server's run-time library locates the object UUID in the object registry table and finds that it maps to type *uuid7*.</span></span>
6.  <span data-ttu-id="490ba-361">為了找出管理員類型，伺服器的執行時間程式庫會合並介面登錄表中的介面 UUID、 *uuid2* 和類型 *uuid7* 。</span><span class="sxs-lookup"><span data-stu-id="490ba-361">To locate the manager type, the server's run-time library combines the interface UUID, *uuid2*, and type *uuid7* in the interface registry table.</span></span> <span data-ttu-id="490ba-362">這會解析為 *epv3*，其中包含要針對遠端程序呼叫執行的伺服器管理員常式。</span><span class="sxs-lookup"><span data-stu-id="490ba-362">This resolves to *epv3*, which contains the server manager routine to be executed for the remote procedure call.</span></span>

<span data-ttu-id="490ba-363">*Epv2* 中的常式永遠不會執行，因為伺服器尚未呼叫 [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype)常式，以將類型 UUID 為 *uuid4* 的任何物件加入至物件登錄表。</span><span class="sxs-lookup"><span data-stu-id="490ba-363">The routines in *epv2* will never be executed because the server has not called the [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) routine to add any objects with a type UUID of *uuid4* to the object registry table.</span></span>

<span data-ttu-id="490ba-364">具有介面 UUID *uuid2* 和物件 UUID *uuidF* 的遠端程序呼叫會傳回具有 RPC \_ \_ 未知 \_ MGR 類型狀態碼的呼叫端 \_ ，因為伺服器未呼叫 [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif)、 [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)或 [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) 來註冊管理員類型 *uuid8* 的介面。</span><span class="sxs-lookup"><span data-stu-id="490ba-364">A remote procedure call with interface UUID *uuid2* and object UUID *uuidF* returns to the caller with an RPC\_S\_UNKNOWN\_MGR\_TYPE status code because the server did not call [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex), or [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) to register the interface with a manager type of *uuid8*.</span></span>

## <a name="return-values"></a><span data-ttu-id="490ba-365">傳回值</span><span class="sxs-lookup"><span data-stu-id="490ba-365">Return Values</span></span>

<span data-ttu-id="490ba-366">此函數會傳回下列其中一個值。</span><span class="sxs-lookup"><span data-stu-id="490ba-366">This function returns one of the following values.</span></span>



| <span data-ttu-id="490ba-367">值</span><span class="sxs-lookup"><span data-stu-id="490ba-367">Value</span></span>                             | <span data-ttu-id="490ba-368">意義</span><span class="sxs-lookup"><span data-stu-id="490ba-368">Meaning</span></span>                      |
|-----------------------------------|------------------------------|
| <span data-ttu-id="490ba-369">RPC \_ S \_ 確定</span><span class="sxs-lookup"><span data-stu-id="490ba-369">RPC\_S\_OK</span></span>                        | <span data-ttu-id="490ba-370">Success</span><span class="sxs-lookup"><span data-stu-id="490ba-370">Success</span></span>                      |
| <span data-ttu-id="490ba-371">\_ \_ \_ 已註冊 RPC S \_ 類型</span><span class="sxs-lookup"><span data-stu-id="490ba-371">RPC\_S\_TYPE\_ALREADY\_REGISTERED</span></span> | <span data-ttu-id="490ba-372">類型 UUID 已經註冊</span><span class="sxs-lookup"><span data-stu-id="490ba-372">Type UUID already registered</span></span> |



 

## <a name="supplying-your-own-object-inquiry-function"></a><span data-ttu-id="490ba-373">提供您自己的物件查詢函式</span><span class="sxs-lookup"><span data-stu-id="490ba-373">Supplying Your Own Object-inquiry Function</span></span>

<span data-ttu-id="490ba-374">請考慮管理許多不同類型之物件的伺服器。</span><span class="sxs-lookup"><span data-stu-id="490ba-374">Consider a server that manages thousands of objects of many different types.</span></span> <span data-ttu-id="490ba-375">當伺服器啟動時，伺服器應用程式必須針對每個物件呼叫函式 [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) ，即使用戶端可能只參考其中幾個物件 (或花很長的時間來參考它們) 。</span><span class="sxs-lookup"><span data-stu-id="490ba-375">Whenever the server started, the server application would have to call the function [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) for every one of the objects, even though clients might refer to only a few of them (or take a long time to refer to them).</span></span> <span data-ttu-id="490ba-376">這上千個物件可能會在磁片上，因此抓取其類型會相當耗時。</span><span class="sxs-lookup"><span data-stu-id="490ba-376">These thousands of objects are likely to be on disk, so retrieving their types would be time consuming.</span></span> <span data-ttu-id="490ba-377">此外，將物件 UUID 對應到管理員類型 UUID 的內部資料表基本上會複製與物件本身維護的對應。</span><span class="sxs-lookup"><span data-stu-id="490ba-377">Also, the internal table that is mapping the object UUID to the manager type UUID would essentially duplicate the mapping maintained with the objects themselves.</span></span>

<span data-ttu-id="490ba-378">為了方便起見，RPC 函數集包含函式 [**RpcObjectSetInqFn**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsetinqfn)。</span><span class="sxs-lookup"><span data-stu-id="490ba-378">For convenience, the RPC function set includes the function [**RpcObjectSetInqFn**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsetinqfn).</span></span> <span data-ttu-id="490ba-379">使用此函式，您可以提供自己的物件查詢函式。</span><span class="sxs-lookup"><span data-stu-id="490ba-379">With this function, you provide your own object-inquiry function.</span></span>

<span data-ttu-id="490ba-380">例如，您可以在將物件100–199對應至類型1、200–299至類型第2個時，提供您自己的物件查詢函式，依此類推。</span><span class="sxs-lookup"><span data-stu-id="490ba-380">As an example, you can supply your own object-inquiry function when you map objects 100–199 to type number 1, 200–299 to type number 2, and so on.</span></span> <span data-ttu-id="490ba-381">物件查詢函式也可以延伸至分散式檔案系統，其中伺服器應用程式沒有 (物件 Uuid) 可用的所有檔案清單，或檔案系統中的物件 Uuid 名稱檔案，而且您不想預先載入物件 Uuid 和類型 Uuid 之間的所有對應。</span><span class="sxs-lookup"><span data-stu-id="490ba-381">The object inquiry function can also be extended to a distributed file system, where the server application does not have a list of all the files (object UUIDs) available, or when object UUIDs name files in the file system and you do not want to preload all of the mappings between object UUIDs and type UUIDs.</span></span>

## <a name="related-topics"></a><span data-ttu-id="490ba-382">相關主題</span><span class="sxs-lookup"><span data-stu-id="490ba-382">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="490ba-383">**RpcBindingFromStringBinding**</span><span class="sxs-lookup"><span data-stu-id="490ba-383">**RpcBindingFromStringBinding**</span></span>](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingfromstringbinding)
</dt> <dt>

[<span data-ttu-id="490ba-384">**RpcBindingSetObject**</span><span class="sxs-lookup"><span data-stu-id="490ba-384">**RpcBindingSetObject**</span></span>](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetobject)
</dt> <dt>

[<span data-ttu-id="490ba-385">**RpcNsBindingExport**</span><span class="sxs-lookup"><span data-stu-id="490ba-385">**RpcNsBindingExport**</span></span>](/windows/desktop/api/Rpcnsi/nf-rpcnsi-rpcnsbindingexporta)
</dt> <dt>

[<span data-ttu-id="490ba-386">**RpcNsBindingImportBegin**</span><span class="sxs-lookup"><span data-stu-id="490ba-386">**RpcNsBindingImportBegin**</span></span>](/windows/desktop/api/Rpcnsi/nf-rpcnsi-rpcnsbindingimportbegina)
</dt> <dt>

[<span data-ttu-id="490ba-387">**RpcNsBindingLookupBegin**</span><span class="sxs-lookup"><span data-stu-id="490ba-387">**RpcNsBindingLookupBegin**</span></span>](/windows/desktop/api/Rpcnsi/nf-rpcnsi-rpcnsbindinglookupbegina)
</dt> <dt>

[<span data-ttu-id="490ba-388">**RpcObjectSetType**</span><span class="sxs-lookup"><span data-stu-id="490ba-388">**RpcObjectSetType**</span></span>](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype)
</dt> <dt>

[<span data-ttu-id="490ba-389">**RpcServerRegisterIf**</span><span class="sxs-lookup"><span data-stu-id="490ba-389">**RpcServerRegisterIf**</span></span>](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif)
</dt> <dt>

[<span data-ttu-id="490ba-390">**RpcServerRegisterIf2**</span><span class="sxs-lookup"><span data-stu-id="490ba-390">**RpcServerRegisterIf2**</span></span>](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2)
</dt> <dt>

[<span data-ttu-id="490ba-391">**RpcServerRegisterIfEx**</span><span class="sxs-lookup"><span data-stu-id="490ba-391">**RpcServerRegisterIfEx**</span></span>](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)
</dt> <dt>

[<span data-ttu-id="490ba-392">**RpcServerUnregisterIf**</span><span class="sxs-lookup"><span data-stu-id="490ba-392">**RpcServerUnregisterIf**</span></span>](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverunregisterif)
</dt> <dt>

[<span data-ttu-id="490ba-393">**RpcServerUnregisterIfEx**</span><span class="sxs-lookup"><span data-stu-id="490ba-393">**RpcServerUnregisterIfEx**</span></span>](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverunregisterifex)
</dt> </dl>

 

 




