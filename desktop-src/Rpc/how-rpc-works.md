---
title: RPC 的運作方式
description: RPC 工具會讓使用者看起來像用戶端直接呼叫位於遠端伺服器程式中的程式一樣。
ms.assetid: 265f31b8-9a41-4255-b070-fd50b00b935b
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 12832d0de4eb972bb1d9d51df0c871191d4d079a
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/16/2019
ms.locfileid: "103674088"
---
# <a name="how-rpc-works"></a>RPC 的運作方式

RPC 工具會讓使用者看起來像用戶端直接呼叫位於遠端伺服器程式中的程式一樣。 用戶端和伺服器都有自己的位址空間;也就是說，每個都有自己的記憶體資源，配置給程式所使用的資料。 下圖說明 RPC 架構。

![rpc 架構](images/prog-a11.png)

如圖所示，用戶端應用程式會呼叫本機存根程式，而不是實際執行程式的程式碼。 系統會使用用戶端應用程式來編譯和連結存根。 用戶端 stub 程式碼，而不是包含實際執行遠端程式的程式碼：

-   從用戶端位址空間抓取必要的參數。
-   視需要將參數轉譯成標準的 NDR 格式，以便透過網路傳輸。
-   呼叫 RPC 用戶端執行時間程式庫中的函式，以將要求和其參數傳送至伺服器。

伺服器會執行下列步驟來呼叫遠端程式。

1.  Server RPC 執行時間程式庫函式會接受要求並呼叫伺服器 stub 程式。
2.  伺服器 stub 會從網路緩衝區取出參數，並將它們從網路傳輸格式轉換成伺服器所需的格式。
3.  伺服器 stub 會呼叫伺服器上的實際程式。

接著會執行遠端程式，可能產生輸出參數和傳回值。 當遠端程式完成時，類似的步驟順序會將資料傳回給用戶端。

1.  遠端過程會將其資料傳回到伺服器 stub。
2.  伺服器 stub 會將輸出參數轉換成透過網路傳輸所需的格式，並將它們傳回至 RPC 執行時間程式庫函式。
3.  伺服器 RPC 執行時間程式庫函式會將網路上的資料傳輸至用戶端電腦。

用戶端會透過網路接受資料，並將它傳回給呼叫的函式，來完成此程式。

1.  用戶端 RPC 執行時間程式庫會接收遠端過程的傳回值，並將它們傳回至用戶端存根。
2.  用戶端 stub 會將資料從其 NDR 轉換成用戶端電腦所使用的格式。 存根會將資料寫入至用戶端記憶體，並將結果傳回用戶端上的呼叫程式。
3.  呼叫程式會繼續執行，就像是在同一部電腦上呼叫程式一樣。

執行時間程式庫提供兩個部分：與應用程式連結的匯入程式庫，以及會實作為動態連結程式庫 (DLL) 的 RPC 執行時間程式庫。

伺服器應用程式包含伺服器執行時間程式庫函式的呼叫，這些函數會註冊伺服器的介面，並允許伺服器接受遠端程序呼叫。 伺服器應用程式也包含用戶端應用程式所呼叫的應用程式特定的遠端程式。

 

 




