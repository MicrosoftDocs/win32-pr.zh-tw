---
title: 三種指標類型
description: MIDL 支援三種類型的指標以容納各種應用程式。
ms.assetid: 6684c252-6fbe-49ca-9967-6d4baf5dc298
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: efdcc9548568c8fca24d8abb40bf0eaa8b6e7da3
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/20/2020
ms.locfileid: "103933282"
---
# <a name="three-pointer-types"></a><span data-ttu-id="b6390-103">三種指標類型</span><span class="sxs-lookup"><span data-stu-id="b6390-103">Three Pointer Types</span></span>

<span data-ttu-id="b6390-104">MIDL 支援三種類型的指標以容納各種應用程式。</span><span class="sxs-lookup"><span data-stu-id="b6390-104">MIDL supports three types of pointers to accommodate a wide range of applications.</span></span> <span data-ttu-id="b6390-105">三個不同的層級稱為參考、唯一和完整指標，分別由屬性 **\[** [**ref**](/windows/desktop/Midl/ref) **\]** 、 **\[** [**unique**](/windows/desktop/Midl/unique)和 **\]** **\[** [**ptr**](/windows/desktop/Midl/ptr)表示 **\]** 。</span><span class="sxs-lookup"><span data-stu-id="b6390-105">The three different levels are called reference, unique, and full pointers, and are indicated by the attributes **\[**[**ref**](/windows/desktop/Midl/ref)**\]**, **\[**[**unique**](/windows/desktop/Midl/unique)**\]**, and **\[**[**ptr**](/windows/desktop/Midl/ptr)**\]**, respectively.</span></span> <span data-ttu-id="b6390-106">這些屬性所描述的指標類別都是互斥的。</span><span class="sxs-lookup"><span data-stu-id="b6390-106">The pointer classes described by these attributes are mutually exclusive.</span></span> <span data-ttu-id="b6390-107">指標屬性可以套用至類型定義、函數傳回類型、函式參數、結構或等位成員或陣列元素的指標。</span><span class="sxs-lookup"><span data-stu-id="b6390-107">Pointer attributes can be applied to pointers in type definitions, function return types, function parameters, members of structures or unions, or array elements.</span></span>

<span data-ttu-id="b6390-108">內嵌指標是結構或等位成員的指標。</span><span class="sxs-lookup"><span data-stu-id="b6390-108">Embedded pointers are pointers that are members of structures or unions.</span></span> <span data-ttu-id="b6390-109">它們也可以是陣列的元素。</span><span class="sxs-lookup"><span data-stu-id="b6390-109">They can also be elements of arrays.</span></span> <span data-ttu-id="b6390-110">在 **\[** [**中**](/windows/desktop/Midl/in) **\]** ，會假設內嵌 **\[ ref \]** 指標指向有效的儲存區，而且不得為 null。</span><span class="sxs-lookup"><span data-stu-id="b6390-110">In the **\[**[**in**](/windows/desktop/Midl/in)**\]** direction, embedded **\[ref\]** pointers are assumed to be pointing to valid storage and must not be null.</span></span> <span data-ttu-id="b6390-111">這種情況會以遞迴方式適用于它們所指向的所有 **\[ ref \]** 指標。</span><span class="sxs-lookup"><span data-stu-id="b6390-111">This situation is recursively applicable to any **\[ref\]** pointers they are pointing to.</span></span> <span data-ttu-id="b6390-112">在 **\[ 中 \]** ，內嵌的 **\[ unique \]** 和 full 指標 (具有 **\[ ptr \]** 屬性的指標) 不一定是 null。</span><span class="sxs-lookup"><span data-stu-id="b6390-112">In the **\[in\]** direction, embedded **\[unique\]** and full pointers (pointers with the **\[ptr\]** attribute) may or may not be null.</span></span>

<span data-ttu-id="b6390-113">在函式宣告的語法中放置於參數上的任何指標屬性，只會影響該參數最右邊的指標宣告子。</span><span class="sxs-lookup"><span data-stu-id="b6390-113">Any pointer attribute placed on a parameter in the syntax of a function declaration affects only the rightmost pointer declarator for that parameter.</span></span> <span data-ttu-id="b6390-114">若要影響其他指標宣告子，必須使用中繼命名類型。</span><span class="sxs-lookup"><span data-stu-id="b6390-114">To affect other pointer declarators, intermediate named types must be used.</span></span>

<span data-ttu-id="b6390-115">傳回指標的函式可以將指標屬性作為函式屬性。</span><span class="sxs-lookup"><span data-stu-id="b6390-115">Functions that return a pointer can have a pointer attribute as a function attribute.</span></span> <span data-ttu-id="b6390-116">**\[ Unique \]** 和 **\[ ptr \]** 屬性必須套用至函數傳回型別。</span><span class="sxs-lookup"><span data-stu-id="b6390-116">The **\[unique\]** and **\[ptr\]** attributes must be applied to function return types.</span></span> <span data-ttu-id="b6390-117">指標成員宣告可將指標屬性指定為欄位屬性。</span><span class="sxs-lookup"><span data-stu-id="b6390-117">Member declarations that are pointers can specify a pointer attribute as a field attribute.</span></span> <span data-ttu-id="b6390-118">指標屬性也可以套用為 [**typedef**](/windows/desktop/Midl/typedef) 結構中的型別屬性。</span><span class="sxs-lookup"><span data-stu-id="b6390-118">A pointer attribute can also be applied as a type attribute in [**typedef**](/windows/desktop/Midl/typedef) constructs.</span></span>

<span data-ttu-id="b6390-119">當沒有將指標屬性指定為欄位或類型屬性時，會根據未歸屬指標宣告的規則來套用指標屬性，如下所示。</span><span class="sxs-lookup"><span data-stu-id="b6390-119">When no pointer attribute is specified as a field or type attribute, pointer attributes are applied according to the rules for an unattributed pointer declaration as follows.</span></span>

<span data-ttu-id="b6390-120">在 DCE 相容性模式中，指標屬性是在定義 IDL 檔案中決定。</span><span class="sxs-lookup"><span data-stu-id="b6390-120">In DCE-compatibility mode, pointer attributes are determined in the defining IDL file.</span></span> <span data-ttu-id="b6390-121">如果 **\[** 定義介面中指定了 [**指標 \_ 預設**](/windows/desktop/Midl/pointer-default) **\]** 屬性，則會使用該屬性。</span><span class="sxs-lookup"><span data-stu-id="b6390-121">If there is a **\[**[**pointer\_default**](/windows/desktop/Midl/pointer-default)**\]** attribute specified in the defining interface, that attribute is used.</span></span> <span data-ttu-id="b6390-122">如果沒有 **\[ 指標 \_ 預設 \]** 屬性，所有未歸屬指標都會是完整指標。</span><span class="sxs-lookup"><span data-stu-id="b6390-122">If no **\[pointer\_default\]** attribute is present, all unattributed pointers are full pointers.</span></span>

<span data-ttu-id="b6390-123">在 Microsoft 擴充模式中，指標屬性可以藉由匯入 IDL 檔案來判斷，並依下列順序套用：</span><span class="sxs-lookup"><span data-stu-id="b6390-123">In Microsoft-extensions mode, pointer attributes can be determined by importing IDL files and are applied in the following order:</span></span>

1.  <span data-ttu-id="b6390-124">在 use 網站套用的明確指標屬性。</span><span class="sxs-lookup"><span data-stu-id="b6390-124">An explicit pointer attribute applied at the use site.</span></span>
2.  <span data-ttu-id="b6390-125">當未歸屬指標為最上層指標參數時，即為 **\[ ref \]** 屬性。</span><span class="sxs-lookup"><span data-stu-id="b6390-125">The **\[ref\]** attribute, when the unattributed pointer is a top-level pointer parameter.</span></span>
3.  <span data-ttu-id="b6390-126">在定義介面中指定的 **\[ 指標 \_ 預設 \]** 屬性。</span><span class="sxs-lookup"><span data-stu-id="b6390-126">A **\[pointer\_default\]** attribute specified in the defining interface.</span></span>
4.  <span data-ttu-id="b6390-127">基底介面中指定的 **\[ 指標 \_ 預設 \]** 屬性。</span><span class="sxs-lookup"><span data-stu-id="b6390-127">A **\[pointer\_default\]** attribute specified in the base interface.</span></span>
5.  <span data-ttu-id="b6390-128">**\[ 唯一 \]** 屬性。</span><span class="sxs-lookup"><span data-stu-id="b6390-128">The **\[unique\]** attribute.</span></span>

<span data-ttu-id="b6390-129">**\[** 當宣告未套用明確的指標屬性時，[**指標 \_ 預設**](/windows/desktop/Midl/pointer-default) **\]** 介面屬性會指定要套用至類型、參數或傳回類型宣告中指標宣告子的預設指標屬性。</span><span class="sxs-lookup"><span data-stu-id="b6390-129">The **\[**[**pointer\_default**](/windows/desktop/Midl/pointer-default)**\]** interface attribute specifies the default pointer attributes to be applied to a pointer declarator in a type, parameter, or return type declaration when that declaration does not have an explicit pointer attribute applied to it.</span></span> <span data-ttu-id="b6390-130">**\[ 指標 \_ 預設 \]** 介面屬性不會套用到參數的未歸屬最上層指標，而是假設為 **\[ ref \]**。</span><span class="sxs-lookup"><span data-stu-id="b6390-130">The **\[pointer\_default\]** interface attribute does not apply to an unattributed top-level pointer of a parameter, which is assumed to be **\[ref\]**.</span></span>

 

 