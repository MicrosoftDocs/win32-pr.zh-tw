---
title: 在 IDL 檔案中定義管道
description: 當在 IDL 檔案中定義管道時，MIDL 編譯器會產生一個管道控制項結構，其成員是推送、提取和配置程式的指標，以及協調這些程式的狀態變數。
ms.assetid: f6c282e4-3056-48c4-bd12-dfcae6d238d7
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bbd237690f45fd6ca73d62f54a5dccf0409f4424e1e96407c116b39ef5d882a7
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/11/2021
ms.locfileid: "120022068"
---
# <a name="defining-pipes-in-idl-files"></a>在 IDL 檔案中定義管道

當在 IDL 檔案中定義管道時，MIDL 編譯器會產生一個管道控制項結構，其成員是推送、提取和配置程式的指標，以及協調這些程式的狀態變數。 用戶端應用程式會初始化管道控制結構中的欄位、維護其狀態變數，並使用自己的發送、提取和配置函數來管理資料傳輸。 用戶端 stub 程式碼會在資料傳輸期間，于迴圈中呼叫這些應用程式函數。 針對輸入管道，用戶端 stub 會封送處理傳送資料，並將其傳輸至伺服器 stub。 針對輸出管道，用戶端存根會將資料拆收至緩衝區，並將該緩衝區的指標傳遞回用戶端應用程式。

伺服器 stub 程式碼會將管道控制項結構的欄位初始化為狀態變數，以及推送和提取常式的指標。 伺服器 stub 會維護狀態，並管理其私用儲存區來傳送資料。 伺服器應用程式會在遠端程序呼叫期間，在從用戶端 stub 接收和拆收資料時，于迴圈中呼叫提取和推送常式，或是將資料封送處理並傳送至用戶端存根。

下列範例 IDL 檔案定義了管道類型長線 \_ ，其元素大小定義為 **long**。 它也會宣告遠端程序呼叫 InPipe 和 OutPipe 的函式原型，分別用來傳送和接收資料。 當 MIDL 編譯器處理 IDL 檔案時，它會產生範例中所示的標頭檔。

## <a name="example"></a>範例

``` syntax
// File: pipedemo.idl
typedef pipe long LONG_PIPE;
void InPipe( [in] LONG_PIPE pipe_data );
void OutPipe( [out] LONG_PIPE *pipe_data ); 
//end pipedemo.idl
 
// File: pipedemo.h (fragment)
// Generated by the MIDL compiler from pipedemo.idl
typedef struct pipe_LONG_PIPE
{
    void (__RPC_FAR * pull) (
        char __RPC_FAR * state,
        long __RPC_FAR * buf,
        unsigned long esize,
        unsigned long __RPC_FAR * ecount );
    void (__RPC_FAR * push) (
        char __RPC_FAR * state,
        long __RPC_FAR * buf,
        unsigned long ecount );
    void (__RPC_FAR * alloc) (
        char __RPC_FAR * state,
        unsigned long bsize,
        long __RPC_FAR * __RPC_FAR * buf,
        unsigned long __RPC_FAR * bcount );
    char __RPC_FAR * state;
} LONG_PIPE;
 
void InPipe( 
    /* [in] */ LONG_PIPE pipe_data);
void OutPipe( 
    /* [out] */ LONG_PIPE __RPC_FAR *pipe_data);
//end pipedemo.h
```

## <a name="related-topics"></a>相關主題

<dl> <dt>

[管道](/windows/desktop/Midl/pipe)
</dt> <dt>

[**/Oi**](/windows/desktop/Midl/-oi)
</dt> </dl>

 

 