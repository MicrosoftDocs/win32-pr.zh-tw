---
title: 在 IDL 檔案中定義管道
description: 當在 IDL 檔案中定義管道時，MIDL 編譯器會產生一個管道控制項結構，其成員是推送、提取和配置程式的指標，以及協調這些程式的狀態變數。
ms.assetid: f6c282e4-3056-48c4-bd12-dfcae6d238d7
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 115be7fc5d00458d13df102afebe9ba5b55de070
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/20/2020
ms.locfileid: "104376053"
---
# <a name="defining-pipes-in-idl-files"></a><span data-ttu-id="cf541-103">在 IDL 檔案中定義管道</span><span class="sxs-lookup"><span data-stu-id="cf541-103">Defining Pipes in IDL Files</span></span>

<span data-ttu-id="cf541-104">當在 IDL 檔案中定義管道時，MIDL 編譯器會產生一個管道控制項結構，其成員是推送、提取和配置程式的指標，以及協調這些程式的狀態變數。</span><span class="sxs-lookup"><span data-stu-id="cf541-104">When a pipe is defined in an IDL file, the MIDL compiler generates a pipe control structure whose members are pointers to push, pull, and alloc procedures as well as a state variable that coordinates these procedures.</span></span> <span data-ttu-id="cf541-105">用戶端應用程式會初始化管道控制結構中的欄位、維護其狀態變數，並使用自己的發送、提取和配置函數來管理資料傳輸。</span><span class="sxs-lookup"><span data-stu-id="cf541-105">The client application initializes the fields in the pipe control structure, maintains its state variable, and manages the data transfer with its own push, pull, and alloc functions.</span></span> <span data-ttu-id="cf541-106">用戶端 stub 程式碼會在資料傳輸期間，于迴圈中呼叫這些應用程式函數。</span><span class="sxs-lookup"><span data-stu-id="cf541-106">The client stub code calls these application functions in loops during data transfer.</span></span> <span data-ttu-id="cf541-107">針對輸入管道，用戶端 stub 會封送處理傳送資料，並將其傳輸至伺服器 stub。</span><span class="sxs-lookup"><span data-stu-id="cf541-107">For an input pipe, the client stub marshals the transfer data and transmits it to the server stub.</span></span> <span data-ttu-id="cf541-108">針對輸出管道，用戶端存根會將資料拆收至緩衝區，並將該緩衝區的指標傳遞回用戶端應用程式。</span><span class="sxs-lookup"><span data-stu-id="cf541-108">For an output pipe, the client stub unmarshals the data into a buffer and passes a pointer to that buffer back to the client application.</span></span>

<span data-ttu-id="cf541-109">伺服器 stub 程式碼會將管道控制項結構的欄位初始化為狀態變數，以及推送和提取常式的指標。</span><span class="sxs-lookup"><span data-stu-id="cf541-109">The server stub code initializes the fields of the pipe control structure to a state variable, as well as pointers to push and pull routines.</span></span> <span data-ttu-id="cf541-110">伺服器 stub 會維護狀態，並管理其私用儲存區來傳送資料。</span><span class="sxs-lookup"><span data-stu-id="cf541-110">The server stub maintains the state and manages its private storage for the transfer data.</span></span> <span data-ttu-id="cf541-111">伺服器應用程式會在遠端程序呼叫期間，在從用戶端 stub 接收和拆收資料時，于迴圈中呼叫提取和推送常式，或是將資料封送處理並傳送至用戶端存根。</span><span class="sxs-lookup"><span data-stu-id="cf541-111">The server application calls the pull and push routines in loops during the remote procedure call as it receives and unmarshals data from the client stub, or marshals and transmits data to the client stub.</span></span>

<span data-ttu-id="cf541-112">下列範例 IDL 檔案定義了管道類型長線 \_ ，其元素大小定義為 **long**。</span><span class="sxs-lookup"><span data-stu-id="cf541-112">The following example IDL file defines a pipe type LONG\_PIPE, whose element size is defined as **long**.</span></span> <span data-ttu-id="cf541-113">它也會宣告遠端程序呼叫 InPipe 和 OutPipe 的函式原型，分別用來傳送和接收資料。</span><span class="sxs-lookup"><span data-stu-id="cf541-113">It also declares function prototypes for the remote procedure calls InPipe and OutPipe, to send and receive data, respectively.</span></span> <span data-ttu-id="cf541-114">當 MIDL 編譯器處理 IDL 檔案時，它會產生範例中所示的標頭檔。</span><span class="sxs-lookup"><span data-stu-id="cf541-114">When the MIDL compiler processes the IDL file, it generates the header file shown in the example.</span></span>

## <a name="example"></a><span data-ttu-id="cf541-115">範例</span><span class="sxs-lookup"><span data-stu-id="cf541-115">Example</span></span>

``` syntax
// File: pipedemo.idl
typedef pipe long LONG_PIPE;
void InPipe( [in] LONG_PIPE pipe_data );
void OutPipe( [out] LONG_PIPE *pipe_data ); 
//end pipedemo.idl
 
// File: pipedemo.h (fragment)
// Generated by the MIDL compiler from pipedemo.idl
typedef struct pipe_LONG_PIPE
{
    void (__RPC_FAR * pull) (
        char __RPC_FAR * state,
        long __RPC_FAR * buf,
        unsigned long esize,
        unsigned long __RPC_FAR * ecount );
    void (__RPC_FAR * push) (
        char __RPC_FAR * state,
        long __RPC_FAR * buf,
        unsigned long ecount );
    void (__RPC_FAR * alloc) (
        char __RPC_FAR * state,
        unsigned long bsize,
        long __RPC_FAR * __RPC_FAR * buf,
        unsigned long __RPC_FAR * bcount );
    char __RPC_FAR * state;
} LONG_PIPE;
 
void InPipe( 
    /* [in] */ LONG_PIPE pipe_data);
void OutPipe( 
    /* [out] */ LONG_PIPE __RPC_FAR *pipe_data);
//end pipedemo.h
```

## <a name="related-topics"></a><span data-ttu-id="cf541-116">相關主題</span><span class="sxs-lookup"><span data-stu-id="cf541-116">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="cf541-117">管道</span><span class="sxs-lookup"><span data-stu-id="cf541-117">pipe</span></span>](/windows/desktop/Midl/pipe)
</dt> <dt>

[<span data-ttu-id="cf541-118">**/Oi**</span><span class="sxs-lookup"><span data-stu-id="cf541-118">**/Oi**</span></span>](/windows/desktop/Midl/-oi)
</dt> </dl>

 

 