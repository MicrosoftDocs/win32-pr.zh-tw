---
description: XAudio 2.9 的可轉散發版本開發人員指南
ms.assetid: ''
title: XAudio 2.9 的可轉散發版本開發人員指南
ms.topic: article
ms.date: 10/17/2019
ms.openlocfilehash: 2b83f2811ada9a41591b4b556a34aa585002c83e
ms.sourcegitcommit: b61ef7cdd575b086e96db4d4cf37b9fbeb388a47
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/17/2021
ms.locfileid: "107583819"
---
# <a name="developer-guide-for-redistributable-version-of-xaudio-29"></a><span data-ttu-id="3654e-103">XAudio 2.9 的可轉散發版本開發人員指南</span><span class="sxs-lookup"><span data-stu-id="3654e-103">Developer guide for redistributable version of XAudio 2.9</span></span>

<span data-ttu-id="3654e-104">XAudio 2.9 的版本是以 [NuGet 套件](/nuget/what-is-nuget)的形式提供。</span><span class="sxs-lookup"><span data-stu-id="3654e-104">A version of XAudio 2.9 is available as a [NuGet package](/nuget/what-is-nuget).</span></span> <span data-ttu-id="3654e-105">開發人員可以將此版本的 XAudio 2.9 與其應用程式一起轉散發。</span><span class="sxs-lookup"><span data-stu-id="3654e-105">Developers can redistribute this version of XAudio 2.9 with their apps.</span></span> <span data-ttu-id="3654e-106">這可讓應用程式在較舊版本的 Windows 上使用 XAudio 2.9，這些版本不包含 XAudio 2.9 作為作業系統映射的一部分。</span><span class="sxs-lookup"><span data-stu-id="3654e-106">This allows an app to use XAudio 2.9 on older versions of Windows that do no not include XAudio 2.9 as part of the operating system image.</span></span> <span data-ttu-id="3654e-107">因為 XAudio 2.7 自2010起尚未更新，所以最好使用此可轉散發套件，因為從 DirectX SDK 轉散發 XAudio 2.7。</span><span class="sxs-lookup"><span data-stu-id="3654e-107">Use of this redistributable is preferred over redistributing XAudio 2.7 from the DirectX SDK, as XAudio 2.7 has not been updated since 2010.</span></span>

## <a name="supported-platforms"></a><span data-ttu-id="3654e-108">支援的平台</span><span class="sxs-lookup"><span data-stu-id="3654e-108">Supported platforms</span></span>

<span data-ttu-id="3654e-109">XAudio 2.9 NuGet 套件 (*Microsoft. XAudio2 可轉散發套件。 \*nupkg*) 包含32位和64位版本的 DLL，可執行 XAudio 2.9 API。</span><span class="sxs-lookup"><span data-stu-id="3654e-109">The XAudio 2.9 NuGet package (*Microsoft.XAudio2.Redist.\*.nupkg*) includes a 32-bit and a 64-bit version of a DLL that implements the XAudio 2.9 API.</span></span> <span data-ttu-id="3654e-110">DLL 稱為 XAUDIO2 \_9REDIST.DLL。</span><span class="sxs-lookup"><span data-stu-id="3654e-110">The DLL is called XAUDIO2\_9REDIST.DLL.</span></span> <span data-ttu-id="3654e-111">此 DLL 可在 Windows 7 SP1、Windows 8、Windows 8.1 和 Windows 10 上運作。</span><span class="sxs-lookup"><span data-stu-id="3654e-111">This DLL will work on Windows 7 SP1, Windows 8, Windows 8.1 and Windows 10.</span></span>

<span data-ttu-id="3654e-112">當 DLL 在 Windows 10 系統上使用時，它會檢查屬於作業系統的 XAUDIO29.DLL 的版本號碼 \_ ，如果作業系統較新，它就會將所有 API 呼叫委派給 \_ 作業系統中的 XAUDIO29.DLL。</span><span class="sxs-lookup"><span data-stu-id="3654e-112">When the DLL is used on a Windows 10 system, it checks the version number of the XAUDIO2\_9.DLL that is part of the operating system, and if the operating system is newer, it will delegate all API calls to XAUDIO2\_9.DLL in the operating system.</span></span> <span data-ttu-id="3654e-113">這可確保應用程式一律使用目前平臺上可用的最新 XAudio 2.9 版本。</span><span class="sxs-lookup"><span data-stu-id="3654e-113">This ensures that apps always use the latest version of XAudio 2.9 that is available on the current platform.</span></span>

<span data-ttu-id="3654e-114">DLL 不適合 Xbox One。</span><span class="sxs-lookup"><span data-stu-id="3654e-114">The DLL is not intended for Xbox One.</span></span> <span data-ttu-id="3654e-115">如果用於 Xbox One，則 DLL 一律會將所有 API 呼叫委派給 \_ Xbox One 作業系統中的 XAUDIO29.DLL。</span><span class="sxs-lookup"><span data-stu-id="3654e-115">If used on Xbox One, the DLL will always delegate all API calls to XAUDIO2\_9.DLL in the Xbox One operating system.</span></span>

<span data-ttu-id="3654e-116">DLL 並非適用于 UWP 應用程式。</span><span class="sxs-lookup"><span data-stu-id="3654e-116">The DLL is not intended for UWP apps.</span></span> <span data-ttu-id="3654e-117">UWP 應用程式應該使用屬於 \_ 作業系統一部分的 XAUDIO29.DLL。</span><span class="sxs-lookup"><span data-stu-id="3654e-117">UWP apps should use the XAUDIO2\_9.DLL that is part of the operating system.</span></span>

## <a name="installing-the-nuget-package"></a><span data-ttu-id="3654e-118">安裝 NuGet 封裝</span><span class="sxs-lookup"><span data-stu-id="3654e-118">Installing the NuGet package</span></span>

<span data-ttu-id="3654e-119">安裝 NuGet 套件最簡單的方式，就是在 Microsoft Visual Studio 中使用 [nuget 封裝管理員](/nuget/consume-packages/install-use-packages-visual-studio) 。</span><span class="sxs-lookup"><span data-stu-id="3654e-119">The easiest way to install the NuGet package is to use the [NuGet Package Manager](/nuget/consume-packages/install-use-packages-visual-studio) in Microsoft Visual Studio.</span></span> <span data-ttu-id="3654e-120">如果您這樣做，您的 Visual Studio 專案檔將會自動更新，以包含 *XAudio2*。</span><span class="sxs-lookup"><span data-stu-id="3654e-120">If you do this, your Visual Studio project file will be automatically updated to include *Microsoft.XAudio2.Redist.targets*.</span></span> <span data-ttu-id="3654e-121">*.Targets* 檔案會將包含 XAudio2 標頭檔的 include 資料夾，新增至專案包含路徑的集合。</span><span class="sxs-lookup"><span data-stu-id="3654e-121">The *.targets* file adds the Include folder with the header files for the XAudio2 to your collection of project include paths.</span></span> <span data-ttu-id="3654e-122">*.Targets* 檔案也會建立您的。DLL 或。EXE 與 XAUDIO2REDIST 連結。LIB 和 XAPOBASEREDIST。自由。</span><span class="sxs-lookup"><span data-stu-id="3654e-122">The *.targets* file will also make your .DLL or .EXE link with XAUDIO2REDIST.LIB and XAPOBASEREDIST.LIB.</span></span>

<span data-ttu-id="3654e-123">程式庫 XAPOBASEREDIST。只有當您想要 impement 自訂 XAudio 處理物件 (XAPO) ，而且如果未使用，也可以將它從 *XAudio2* 的可轉散發套件中移除時，才需要 LIB。</span><span class="sxs-lookup"><span data-stu-id="3654e-123">The library XAPOBASEREDIST.LIB is only needed if you intend to impement a custom XAudio Processing Object (XAPO) and you can remove it from the *Microsoft.XAudio2.Redist.targets* if it is unused.</span></span>

<span data-ttu-id="3654e-124">您也可以使用其他工具來解壓縮 NuGet 套件的內容，甚至將副檔名重新命名為 .zip，並使用任何 ZIP 解壓縮程式工具將檔案解壓縮。</span><span class="sxs-lookup"><span data-stu-id="3654e-124">You can also use other tools to extract the contents of the NuGet package, or even rename the file extension to .zip and extract the files with any ZIP extractor tool.</span></span>

> <span data-ttu-id="3654e-125">另外還有一個 ``xaudio2redist`` 可供 [VC + + 封裝管理員](https://github.com/microsoft/vcpkg)使用的埠。</span><span class="sxs-lookup"><span data-stu-id="3654e-125">There is also an ``xaudio2redist`` port available for the [VC++ Package Manager](https://github.com/microsoft/vcpkg).</span></span>

## <a name="compiling-your-app"></a><span data-ttu-id="3654e-126">編譯您的應用程式</span><span class="sxs-lookup"><span data-stu-id="3654e-126">Compiling your app</span></span>

### <a name="choosing-which-headers-to-include"></a><span data-ttu-id="3654e-127">選擇要包含的標頭</span><span class="sxs-lookup"><span data-stu-id="3654e-127">Choosing which headers to include</span></span>

<span data-ttu-id="3654e-128">XAudio 2.9 NuGet 套件包含 Windows 10 SDK 中所含的相同 XAudio2 標頭檔。</span><span class="sxs-lookup"><span data-stu-id="3654e-128">The XAudio 2.9 NuGet package includes the same XAudio2 header files that are included in the Windows 10 SDK.</span></span> <span data-ttu-id="3654e-129">不過，標頭檔已對它們進行一些調整，以確保您可以使用它們，同時明確地以所有 [支援的平臺](#supported-platforms)為目標，包括舊版的 Windows。</span><span class="sxs-lookup"><span data-stu-id="3654e-129">However, the header files have had some adjustments to them to make sure that you can use them while explicitly targeting all [supported platforms](#supported-platforms), including older versions of Windows.</span></span>

<span data-ttu-id="3654e-130">如果您在 Microsoft Visual Studio 中使用 NuGet 封裝管理員 [安裝 nuget 套件](#installing-the-nuget-package) ，則標頭檔的路徑會放置在 Windows SDK 標頭檔的路徑前面。</span><span class="sxs-lookup"><span data-stu-id="3654e-130">If you [install the NuGet package](#installing-the-nuget-package) using the NuGet Package Manager in Microsoft Visual Studio then the path to the header files is placed in front of the path to the Windows SDK header files.</span></span> <span data-ttu-id="3654e-131">這表示，如果專案中的程式碼包含 XAUDIO2。H 標頭，它會從 NuGet 套件中挑選跨平臺的標頭。</span><span class="sxs-lookup"><span data-stu-id="3654e-131">That means that if code in your project includes the XAUDIO2.H header, it will pick up the cross-platform header from the NuGet package.</span></span> <span data-ttu-id="3654e-132">這通常是所需的行為。</span><span class="sxs-lookup"><span data-stu-id="3654e-132">This is normally the desired behavior.</span></span>

<span data-ttu-id="3654e-133">如果您手動將 include 標頭的路徑新增至專案，請務必小心，因為以錯誤順序指定這些標頭可能會導致作業系統版本的特定 [XAUDIO2。](/windows/win32/api/xaudio2/) 要包含在 Windows SDK 中的 H，而不是 XAUDIO2 的跨平臺版本。</span><span class="sxs-lookup"><span data-stu-id="3654e-133">You should be careful if adding the path to the include headers manually to the project, as specifying them in the wrong order can cause the OS-version specific [XAUDIO2.H](/windows/win32/api/xaudio2/) to be included from the Windows SDK, rather than the cross-platform version of XAUDIO2.H.</span></span>

<span data-ttu-id="3654e-134">為了使標頭包含較不容易出錯的標頭，NuGet 套件包含每個標頭的版本，並附加「可轉散發套件」。</span><span class="sxs-lookup"><span data-stu-id="3654e-134">To make the inclusion of headers less error-prone, the NuGet package contains a version of each header with "REDIST" appended to it.</span></span> <span data-ttu-id="3654e-135">例如，除了 XAUDIO2 之外。H，NuGet 套件也包含 XAUDIO2REDIST。</span><span class="sxs-lookup"><span data-stu-id="3654e-135">For example, in addition to XAUDIO2.H, the NuGet package also includes XAUDIO2REDIST.H.</span></span> <span data-ttu-id="3654e-136">如果您想要的話，您的程式碼可以直接包含 XAUDIO2REDIST。H 以消除所使用的標頭檔的任何混淆。</span><span class="sxs-lookup"><span data-stu-id="3654e-136">If you prefer, your code can directly include XAUDIO2REDIST.H to eliminate any ambiguity about which header file is being used.</span></span> <span data-ttu-id="3654e-137">包含-可轉散發套件。H 版本的標頭檔，包含檔案目錄在專案檔中所列的順序並不重要。</span><span class="sxs-lookup"><span data-stu-id="3654e-137">When including the -REDIST.H version of a header file, the order in which the include file directories are listed in the project file do not matter.</span></span>

<span data-ttu-id="3654e-138">請注意，如果您的應用程式也是針對 Xbox One 進行編譯，您應該繼續包含 XAUDIO2。H 針對 Xbox One 進行編譯時，會從 XAUDIO2REDIST 中排除某些特定 Xbox One 的 Api。</span><span class="sxs-lookup"><span data-stu-id="3654e-138">Note that if your app is also being compiled for Xbox One, you should continue to include XAUDIO2.H when compiling for Xbox One, as some Xbox One-specific APIs are excluded from XAUDIO2REDIST.H.</span></span> <span data-ttu-id="3654e-139">此 NuGet 套件不適合 Xbox One。</span><span class="sxs-lookup"><span data-stu-id="3654e-139">This NuGet package is not intended for Xbox One.</span></span>

### <a name="loading-the-dll"></a><span data-ttu-id="3654e-140">載入 DLL</span><span class="sxs-lookup"><span data-stu-id="3654e-140">Loading the DLL</span></span>

<span data-ttu-id="3654e-141">建議您將應用程式與 XAUDIO2REDIST 連結。LIB，並 \_ 將 XAUDIO29REDIST.DLL 安裝在與您應用程式可執行檔相同的資料夾中。</span><span class="sxs-lookup"><span data-stu-id="3654e-141">We recommend that you link your app with XAUDIO2REDIST.LIB and install XAUDIO2\_9REDIST.DLL in the same folder as your app's executable.</span></span> <span data-ttu-id="3654e-142">這會導致 \_ 在您的可執行檔啟動時，立即載入 XAUDIO29REDIST.DLL。</span><span class="sxs-lookup"><span data-stu-id="3654e-142">This will cause XAUDIO2\_9REDIST.DLL to be loaded as soon as your executable is launched.</span></span> <span data-ttu-id="3654e-143">但是，如果您想要的話，也可以使用 [**LoadLibraryEx**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibraryexw) 和 [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress) 來 \_ 視需要載入 XAUDIO29REDIST.DLL。</span><span class="sxs-lookup"><span data-stu-id="3654e-143">However, if you prefer, you may use [**LoadLibraryEx**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibraryexw) and [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress) to load XAUDIO2\_9REDIST.DLL on demand.</span></span> <span data-ttu-id="3654e-144">如果您的應用程式不一定需要使用 XAudio2 Api，這是很好的解決方案。</span><span class="sxs-lookup"><span data-stu-id="3654e-144">This is a good solution if your app does not always need to use the XAudio2 APIs.</span></span> <span data-ttu-id="3654e-145">但是如果您這樣做，您應該在 \_ 應用程式結束之前讓 XAUDIO29REDIST.DLL 載入，因為嘗試卸載 dll 可能會在背景執行緒仍在 DLL 中執行程式碼時造成當機。</span><span class="sxs-lookup"><span data-stu-id="3654e-145">But if you do this, you should keep the XAUDIO2\_9REDIST.DLL loaded until the app exits, as attempting to unload the DLL can cause a crash if a background thread is still executing code in the DLL.</span></span>

<span data-ttu-id="3654e-146">不同于較舊的 XAudio 2.7，無法使用 CoCreateInstance 載入 DLL。</span><span class="sxs-lookup"><span data-stu-id="3654e-146">Unlike the older XAudio 2.7, it is not possible to use CoCreateInstance to load the DLL.</span></span>

### <a name="verifying-the-dll-signature"></a><span data-ttu-id="3654e-147">確認 DLL 簽章</span><span class="sxs-lookup"><span data-stu-id="3654e-147">Verifying the DLL signature</span></span>

<span data-ttu-id="3654e-148">XAUDIO2 \_9REDIST.DLL 二進位檔是由 Microsoft 使用 sha-1 簽章簽署。</span><span class="sxs-lookup"><span data-stu-id="3654e-148">The XAUDIO2\_9REDIST.DLL binary is signed by Microsoft using a SHA-2 signature.</span></span> <span data-ttu-id="3654e-149">嘗試驗證簽章的任何程式碼（例如遊戲的防鋸齒模組）都必須支援 SHA-1。</span><span class="sxs-lookup"><span data-stu-id="3654e-149">Any code that attempts to validate the signature, e.g., anti-cheat modules for games, therefore needs to support SHA-2.</span></span> <span data-ttu-id="3654e-150">請注意，Windows 7 SP1 原本並不支援 SHA-2，需要更新才能新增該功能。</span><span class="sxs-lookup"><span data-stu-id="3654e-150">Note that Windows 7 SP1 did not originally support SHA-2 and requires an update to add that functionality.</span></span> <span data-ttu-id="3654e-151">更新會以 [KB4474419](https://support.microsoft.com/help/4474419/sha-2-code-signing-support-update)的形式提供。</span><span class="sxs-lookup"><span data-stu-id="3654e-151">The update is available as [KB4474419](https://support.microsoft.com/help/4474419/sha-2-code-signing-support-update).</span></span>

## <a name="testing"></a><span data-ttu-id="3654e-152">測試</span><span class="sxs-lookup"><span data-stu-id="3654e-152">Testing</span></span>

### <a name="spatial-sound-in-newer-versions-of-windows-10"></a><span data-ttu-id="3654e-153">較新版本的 Windows 10 中的空間音效</span><span class="sxs-lookup"><span data-stu-id="3654e-153">Spatial sound in newer versions of Windows 10</span></span>

<span data-ttu-id="3654e-154">從 Windows 10 1903 更新開始，如果滿足特定條件，XAudio 2.9 會自動使用 [虛擬環繞音效](#spatial-sound-and-virtual-surround)。</span><span class="sxs-lookup"><span data-stu-id="3654e-154">Starting with the Windows 10 1903 update, XAudio 2.9 automatically uses [virtual surround sound](#spatial-sound-and-virtual-surround), if certain conditions are satisfied.</span></span> <span data-ttu-id="3654e-155">我們建議在 Windows 10 1903 (或較新的) 上產生多聲道音效的測試遊戲，以驗證遊戲是否如預期般運作。</span><span class="sxs-lookup"><span data-stu-id="3654e-155">We recommend testing game that generate multi-channel sound on Windows 10 1903 (or newer) to verify that the game sounds as expected.</span></span>

#### <a name="enabling-spatial-sound"></a><span data-ttu-id="3654e-156">啟用空間音效</span><span class="sxs-lookup"><span data-stu-id="3654e-156">Enabling spatial sound</span></span>

<span data-ttu-id="3654e-157">使用者可以在 Windows 系統匣中，以滑鼠右鍵按一下喇叭圖示來啟用空間音效格式。</span><span class="sxs-lookup"><span data-stu-id="3654e-157">The user can enable a spatial sound format by right-clicking on the speaker icon in the Windows system tray.</span></span> 

<span data-ttu-id="3654e-158">如果使用 XAudio2 API 的進程被 Windows Game Bar 辨識為遊戲，XAudio 2.9 將只會使用使用者所選取的空間音效格式。</span><span class="sxs-lookup"><span data-stu-id="3654e-158">XAudio 2.9 will only use the user's selected spatial sound format if the process that is using the XAudio2 API is recognized as a game by the Windows Game Bar.</span></span> <span data-ttu-id="3654e-159">在開發期間，Game Bar 可能尚未將進程辨識為遊戲。</span><span class="sxs-lookup"><span data-stu-id="3654e-159">During development, it is possible that the process is not yet recognized as a game by the Game Bar.</span></span> <span data-ttu-id="3654e-160">若要變更此設定，請使用 Win + G 鍵盤短暫剪下，以在遊戲執行時帶出 Game Bar。</span><span class="sxs-lookup"><span data-stu-id="3654e-160">To change this, use the Win+G keyboard short-cut to bring up the Game Bar while the game is running.</span></span> <span data-ttu-id="3654e-161">然後按一下 [設定] 圖示，並選取 [記住這是遊戲] 核取方塊。</span><span class="sxs-lookup"><span data-stu-id="3654e-161">Then click on the "Settings" icon and check the checkbox that says, "Remember that this is a game".</span></span>

#### <a name="opting-out-from-spatial-sound"></a><span data-ttu-id="3654e-162">退出空間音效</span><span class="sxs-lookup"><span data-stu-id="3654e-162">Opting out from spatial sound</span></span>

<span data-ttu-id="3654e-163">有一種方法可以在 [**IXAudio2：： CreateMasteringVoice**](/windows/win32/api/xaudio2/nf-xaudio2-ixaudio2-createmasteringvoice)中指定 [**AUDIO_STREAM_CATEGORY**](/windows/win32/api/audiosessiontypes/ne-audiosessiontypes-audio_stream_category)參數的特定值，以選擇不要讓 XAudio2 使用空間音效編碼器。</span><span class="sxs-lookup"><span data-stu-id="3654e-163">There is a way to opt out from having XAudio2 use the spatial sound encoder by specifying certain values for the [**AUDIO_STREAM_CATEGORY**](/windows/win32/api/audiosessiontypes/ne-audiosessiontypes-audio_stream_category) parameter in [**IXAudio2::CreateMasteringVoice**](/windows/win32/api/xaudio2/nf-xaudio2-ixaudio2-createmasteringvoice).</span></span> 

<span data-ttu-id="3654e-164">這些類別的空間音效已啟用：</span><span class="sxs-lookup"><span data-stu-id="3654e-164">Spatial sound is enabled for these categories:</span></span>

* <span data-ttu-id="3654e-165">AudioCategory_ForegroundOnlyMedia</span><span class="sxs-lookup"><span data-stu-id="3654e-165">AudioCategory_ForegroundOnlyMedia</span></span>
* <span data-ttu-id="3654e-166">AudioCategory_GameEffects</span><span class="sxs-lookup"><span data-stu-id="3654e-166">AudioCategory_GameEffects</span></span>
* <span data-ttu-id="3654e-167">AudioCategory_GameMedia</span><span class="sxs-lookup"><span data-stu-id="3654e-167">AudioCategory_GameMedia</span></span>
* <span data-ttu-id="3654e-168">AudioCategory_Movie</span><span class="sxs-lookup"><span data-stu-id="3654e-168">AudioCategory_Movie</span></span>
* <span data-ttu-id="3654e-169">AudioCategory_Media</span><span class="sxs-lookup"><span data-stu-id="3654e-169">AudioCategory_Media</span></span>

<span data-ttu-id="3654e-170">如果指定了下列任何類別，則不會啟用空間音效：</span><span class="sxs-lookup"><span data-stu-id="3654e-170">Spatial sound is not enabled if any of the following categories are specified:</span></span>

* <span data-ttu-id="3654e-171">AudioCategory_Other</span><span class="sxs-lookup"><span data-stu-id="3654e-171">AudioCategory_Other</span></span>
* <span data-ttu-id="3654e-172">AudioCategory_Communications</span><span class="sxs-lookup"><span data-stu-id="3654e-172">AudioCategory_Communications</span></span>
* <span data-ttu-id="3654e-173">AudioCategory_Alerts</span><span class="sxs-lookup"><span data-stu-id="3654e-173">AudioCategory_Alerts</span></span>
* <span data-ttu-id="3654e-174">AudioCategory_SoundEffects</span><span class="sxs-lookup"><span data-stu-id="3654e-174">AudioCategory_SoundEffects</span></span>
* <span data-ttu-id="3654e-175">AudioCategory_GameChat</span><span class="sxs-lookup"><span data-stu-id="3654e-175">AudioCategory_GameChat</span></span>
* <span data-ttu-id="3654e-176">AudioCategory_Speech</span><span class="sxs-lookup"><span data-stu-id="3654e-176">AudioCategory_Speech</span></span>

### <a name="error-handling"></a><span data-ttu-id="3654e-177">錯誤處理</span><span class="sxs-lookup"><span data-stu-id="3654e-177">Error handling</span></span>

<span data-ttu-id="3654e-178">請務必測試您的遊戲是否可以處理音訊裝置的變更，例如，當耳機插上或拔下時。</span><span class="sxs-lookup"><span data-stu-id="3654e-178">It is important to test that you game can handle a change in audio device, for example, when headphones are plugged in, or unplugged.</span></span> <span data-ttu-id="3654e-179">這應該使用只支援 44.1 kHz 取樣率的耳機進行測試。</span><span class="sxs-lookup"><span data-stu-id="3654e-179">This should be tested with headphones that only support 44.1 kHz sampling rate.</span></span> <span data-ttu-id="3654e-180">許多低終端 USB 耳機和藍牙耳機僅支援 44.1 kHz。</span><span class="sxs-lookup"><span data-stu-id="3654e-180">Many low-end USB headphones and Bluetooth headsets only support 44.1 kHz.</span></span> <span data-ttu-id="3654e-181">48 kHz 取樣率和 44.1 kHz 取樣率之間的轉換可能會造成錯誤，即使使用 [虛擬音訊端點](#virtual-audio-endpoint) 功能也是一樣。</span><span class="sxs-lookup"><span data-stu-id="3654e-181">The transition between 48 kHz sampling rate and 44.1 kHz sampling rate can cause an error even when the [virtual audio endpoint](#virtual-audio-endpoint) feature is used.</span></span> <span data-ttu-id="3654e-182">如果耳機也支援 48 kHz，就不會發生此錯誤。</span><span class="sxs-lookup"><span data-stu-id="3654e-182">The error will not happen if the headphones also support 48 kHz.</span></span> <span data-ttu-id="3654e-183">請注意，Windows 7 SP1 上無法使用虛擬音訊端點功能。</span><span class="sxs-lookup"><span data-stu-id="3654e-183">Note that the virtual audio endpoint feature is not available on Windows 7 SP1.</span></span>

<span data-ttu-id="3654e-184">XAudio 2.9 在無法從音訊端點的變更中自動復原時傳回的錯誤碼是 [XAUDIO2 \_ E \_ 裝置 \_ 失效](xaudio2-error-codes.md)。</span><span class="sxs-lookup"><span data-stu-id="3654e-184">The error code returned by XAudio 2.9 when it cannot automatically recover from a change in audio endpoint is [XAUDIO2\_E\_DEVICE\_INVALIDATED](xaudio2-error-codes.md).</span></span> <span data-ttu-id="3654e-185">不過，我們建議應用程式不要對錯誤碼具有特定值的相依性進行硬式編碼。</span><span class="sxs-lookup"><span data-stu-id="3654e-185">However, we recommend that apps do not hard-code a dependency on the error code having a specific value.</span></span>

<span data-ttu-id="3654e-186">若要收到錯誤的通知，應用程式應該執行 [**IXAudio2EngineCallback**](/windows/desktop/api/xaudio2/nn-xaudio2-ixaudio2enginecallback) 介面，並叫用 [**IXAudio2：： RegisterForCallbacks**](xaudio2-callbacks.md) 方法，以提供該介面的指標。</span><span class="sxs-lookup"><span data-stu-id="3654e-186">To be notified of the error, the app should implement the [**IXAudio2EngineCallback**](/windows/desktop/api/xaudio2/nn-xaudio2-ixaudio2enginecallback) interface and provide a pointer to that interface by invoking the [**IXAudio2::RegisterForCallbacks**](xaudio2-callbacks.md) method.</span></span> <span data-ttu-id="3654e-187">如果播放期間發生錯誤，XAudio2 API 將會叫用應用程式的 [**IXAudio2EngineCallback：： OnCriticalError**](/windows/win32/api/xaudio2/nf-xaudio2-ixaudio2enginecallback-oncriticalerror) 的執行。</span><span class="sxs-lookup"><span data-stu-id="3654e-187">The app's implementation of the [**IXAudio2EngineCallback::OnCriticalError**](/windows/win32/api/xaudio2/nf-xaudio2-ixaudio2enginecallback-oncriticalerror) will be invoked by the XAudio2 API if an error occurs during playback.</span></span>

<span data-ttu-id="3654e-188">請注意，如果音訊管線已暫停，則不一定會叫用 [**IXAudio2EngineCallback：： OnCriticalError**](/windows/win32/api/xaudio2/nf-xaudio2-ixaudio2enginecallback-oncriticalerror) 。</span><span class="sxs-lookup"><span data-stu-id="3654e-188">Note that [**IXAudio2EngineCallback::OnCriticalError**](/windows/win32/api/xaudio2/nf-xaudio2-ixaudio2enginecallback-oncriticalerror) is not necessarily invoked if the audio pipeline is paused.</span></span> <span data-ttu-id="3654e-189">例如，如果使用者將應用程式最小化，或因為任何原因而暫停應用程式，則可能會暫停播放音訊。</span><span class="sxs-lookup"><span data-stu-id="3654e-189">For example, if the user minimizes the app, or the app gets suspended for any reason, audio playback might be paused.</span></span> <span data-ttu-id="3654e-190">如果音訊裝置在這段時間內發生變更，則只有當應用程式叫用 [**IXAudio2：： StartEngine**](/windows/desktop/api/xaudio2/nf-xaudio2-ixaudio2-startengine) 和/或叫用 [**IXAudio2SourceVoice：： Start**](/windows/desktop/api/xaudio2/nf-xaudio2-ixaudio2sourcevoice-start)時，才會傳回此錯誤。</span><span class="sxs-lookup"><span data-stu-id="3654e-190">If the change in audio device happens during this time, the error is only returned when the app invokes [**IXAudio2::StartEngine**](/windows/desktop/api/xaudio2/nf-xaudio2-ixaudio2-startengine) and/or invokes [**IXAudio2SourceVoice::Start**](/windows/desktop/api/xaudio2/nf-xaudio2-ixaudio2sourcevoice-start).</span></span> <span data-ttu-id="3654e-191">如果您的應用程式可以暫停播放，則應該在播放暫停時測試變更音訊裝置，以確認應用程式仍然可以從這種情況復原。</span><span class="sxs-lookup"><span data-stu-id="3654e-191">If playback can be paused with your app, you should test changing the audio device while the playback is paused, to verify that the app still can recover from this situation.</span></span>

## <a name="xaudio-29-api-differences-compared-to-xaudio-27"></a><span data-ttu-id="3654e-192">相較于 XAudio 2.7，XAudio 2.9 API 差異</span><span class="sxs-lookup"><span data-stu-id="3654e-192">XAudio 2.9 API differences compared to XAudio 2.7</span></span>

<span data-ttu-id="3654e-193">本節提供 XAudio 2.7 與可轉散發版本的 XAudio 2.9 之間的一些 API 差異摘要。</span><span class="sxs-lookup"><span data-stu-id="3654e-193">This section provides a summary of some of the API differences between XAudio 2.7 and the redistributable version of XAudio 2.9.</span></span>

### <a name="supported-formats"></a><span data-ttu-id="3654e-194">支援的格式</span><span class="sxs-lookup"><span data-stu-id="3654e-194">Supported formats</span></span>

<span data-ttu-id="3654e-195">XAudio 2.9 在電腦上支援下列輸入格式：</span><span class="sxs-lookup"><span data-stu-id="3654e-195">XAudio 2.9 supports these input formats on PC:</span></span>

* <span data-ttu-id="3654e-196">線性16位 PCM</span><span class="sxs-lookup"><span data-stu-id="3654e-196">Linear 16-bit PCM</span></span>
* <span data-ttu-id="3654e-197">線性 32-位浮點數 PCM</span><span class="sxs-lookup"><span data-stu-id="3654e-197">Linear 32-bit Float PCM</span></span>
* <span data-ttu-id="3654e-198">16位 ADPCM</span><span class="sxs-lookup"><span data-stu-id="3654e-198">16-bit ADPCM</span></span>
* <span data-ttu-id="3654e-199">xWMA</span><span class="sxs-lookup"><span data-stu-id="3654e-199">xWMA</span></span>

<span data-ttu-id="3654e-200">只有 Xbox One 才支援 XMA 格式。</span><span class="sxs-lookup"><span data-stu-id="3654e-200">The XMA format is only supported on Xbox One.</span></span>

### <a name="preferred-cpu-core"></a><span data-ttu-id="3654e-201">慣用 CPU 核心</span><span class="sxs-lookup"><span data-stu-id="3654e-201">Preferred CPU core</span></span>

<span data-ttu-id="3654e-202">您可以指定哪個 CPU 核心 XAudio 2.9 應該用於其音訊處理執行緒。</span><span class="sxs-lookup"><span data-stu-id="3654e-202">It is possible to specify which CPU core XAudio 2.9 should use for its audio processing thread.</span></span> <span data-ttu-id="3654e-203">不過，通常偏好讓 XAudio 2.9 自行選擇此值。</span><span class="sxs-lookup"><span data-stu-id="3654e-203">However, it is usually preferred to let XAudio 2.9 choose this value by itself.</span></span> <span data-ttu-id="3654e-204">這是藉由將 [**XAudio2Create**](/windows/desktop/api/xaudio2/nf-xaudio2-xaudio2create)呼叫中的 **XAudio2Processor** 參數設定為 XAUDIO2 \_ 使用 \_ 預設 \_ 處理器來完成。</span><span class="sxs-lookup"><span data-stu-id="3654e-204">This is done by setting the **XAudio2Processor** parameter in the call to [**XAudio2Create**](/windows/desktop/api/xaudio2/nf-xaudio2-xaudio2create) to XAUDIO2\_USE\_DEFAULT\_PROCESSOR.</span></span> 

<span data-ttu-id="3654e-205">XAudio 2.9 會在 Xbox One 上選擇與電腦上不同的 CPU 核心。</span><span class="sxs-lookup"><span data-stu-id="3654e-205">XAudio 2.9 will choose a different CPU core on Xbox One than on PC.</span></span> <span data-ttu-id="3654e-206">IXAudio2Extension：： GetProcessor 方法可以用來判斷已選擇的 CPU 核心 XAudio2。</span><span class="sxs-lookup"><span data-stu-id="3654e-206">The IXAudio2Extension::GetProcessor method can be used to determine which CPU core XAudio2 has chosen.</span></span>

### <a name="virtual-audio-endpoint"></a><span data-ttu-id="3654e-207">虛擬音訊端點</span><span class="sxs-lookup"><span data-stu-id="3654e-207">Virtual audio endpoint</span></span>

<span data-ttu-id="3654e-208">XAudio 2.9 在 Windows 8 或更新版本上執行時，預設會使用虛擬音訊端點。</span><span class="sxs-lookup"><span data-stu-id="3654e-208">XAudio 2.9 will use a virtual audio endpoint by default, when running on Windows 8 or later.</span></span> <span data-ttu-id="3654e-209">這表示，如果使用 XAudio 2.9 時的預設音訊端點變更，它會嘗試自動切換至新的音訊端點。</span><span class="sxs-lookup"><span data-stu-id="3654e-209">This means that if the default audio endpoint changes while XAudio 2.9 is used, it will attempt to automatically switch to the new audio endpoint.</span></span> <span data-ttu-id="3654e-210">當預設音訊端點是透過 USB 連接的一對耳機，然後使用者拔除耳機時，會發生這種情況的範例。</span><span class="sxs-lookup"><span data-stu-id="3654e-210">An example of when this can happen when the default audio endpoint is a pair of headphones that are connected over USB, and then the user unplugs the headphones.</span></span> <span data-ttu-id="3654e-211">這會導致喇叭成為新的預設音訊端點。</span><span class="sxs-lookup"><span data-stu-id="3654e-211">This will cause the speakers to be the new default audio endpoint.</span></span>

<span data-ttu-id="3654e-212">如果應用程式在叫用 [**IXAudio2：： CreateMasteringVoice**](/windows/win32/api/xaudio2/nf-xaudio2-ixaudio2-createmasteringvoice)時指定特定的音訊格式，XAudio 2.9 可能無法執行此參數。</span><span class="sxs-lookup"><span data-stu-id="3654e-212">If the app specifies a specific audio format when invoking [**IXAudio2::CreateMasteringVoice**](/windows/win32/api/xaudio2/nf-xaudio2-ixaudio2-createmasteringvoice), it may not be possible for XAudio 2.9 to perform this switch.</span></span> <span data-ttu-id="3654e-213">例如，如果應用程式指定使用 48 kHz 取樣率，而新的音訊裝置只支援 44.1 kHz，則自動切換將會失敗，而 XAudio 2.9 會回報 [XAUDIO2 \_ E \_ 裝置 \_ 失效](xaudio2-error-codes.md) 錯誤。</span><span class="sxs-lookup"><span data-stu-id="3654e-213">For example, if the app specified that the Mastering Voice shall use a 48 kHz sampling rate and the new audio device only supports 44.1 kHz, then the automatic switch will fail, and XAudio 2.9 will report the [XAUDIO2\_E\_DEVICE\_INVALIDATED](xaudio2-error-codes.md) error.</span></span>

<span data-ttu-id="3654e-214">藉由將 [**XAUDIO2 \_ NO \_ 虛擬 \_ 音訊 \_ 用戶端**](xaudio2-boundary-values-and-flags.md) 旗標傳入 [**IXAudio2：： CreateMasteringVoice**](/windows/win32/api/xaudio2/nf-xaudio2-ixaudio2-createmasteringvoice)，應用程式可以選擇不使用虛擬音訊端點。</span><span class="sxs-lookup"><span data-stu-id="3654e-214">It is possible for the app to opt out of using the virtual audio endpoint by passing in the [**XAUDIO2\_NO\_VIRTUAL\_AUDIO\_CLIENT**](xaudio2-boundary-values-and-flags.md) flag to [**IXAudio2::CreateMasteringVoice**](/windows/win32/api/xaudio2/nf-xaudio2-ixaudio2-createmasteringvoice).</span></span>

<span data-ttu-id="3654e-215">在 Windows 7 SP1 上無法使用虛擬音訊端點。</span><span class="sxs-lookup"><span data-stu-id="3654e-215">Virtual audio endpoints are not available on Windows 7 SP1.</span></span> <span data-ttu-id="3654e-216">**XAUDIO2 \_ no \_ VIRTUAL \_ AUDIO \_ CLIENT** 旗標不會影響 Windows 7 SP1。</span><span class="sxs-lookup"><span data-stu-id="3654e-216">The **XAUDIO2\_NO\_VIRTUAL\_AUDIO\_CLIENT** flag has no effect on Windows 7 SP1.</span></span>

### <a name="audio-categories"></a><span data-ttu-id="3654e-217">音訊分類</span><span class="sxs-lookup"><span data-stu-id="3654e-217">Audio categories</span></span>

<span data-ttu-id="3654e-218">應用程式應指定其音訊串流的類別。</span><span class="sxs-lookup"><span data-stu-id="3654e-218">The app should specify a category for its audio stream.</span></span> <span data-ttu-id="3654e-219">這是藉由在叫用 [**IXAudio2：： CreateMasteringVoice**](/windows/win32/api/xaudio2/nf-xaudio2-ixaudio2-createmasteringvoice) 方法時，提供來自 AudioCategory 列舉的值來完成。</span><span class="sxs-lookup"><span data-stu-id="3654e-219">This is done by providing a value from the AudioCategory enumeration when invoking the [**IXAudio2::CreateMasteringVoice**](/windows/win32/api/xaudio2/nf-xaudio2-ixaudio2-createmasteringvoice) method.</span></span> <span data-ttu-id="3654e-220">例如，AudioCategory_GameEffects。</span><span class="sxs-lookup"><span data-stu-id="3654e-220">For example, AudioCategory_GameEffects.</span></span> <span data-ttu-id="3654e-221">音訊類別會影響 Windows 處理音效的方式，或在音量控制台中代表音訊串流的方式。</span><span class="sxs-lookup"><span data-stu-id="3654e-221">The audio category can affect how Windows processes the sound or how it represents the audio stream in the volume control panel.</span></span> <span data-ttu-id="3654e-222">如果自動啟用 [虛擬環繞音效](#spatial-sound-and-virtual-surround) ，音訊類別也會受到影響。</span><span class="sxs-lookup"><span data-stu-id="3654e-222">The audio category also affects if [virtual surround sound](#spatial-sound-and-virtual-surround) is automatically enabled.</span></span>

### <a name="duration-of-audio-processing-quantum"></a><span data-ttu-id="3654e-223">音訊處理量子的持續時間</span><span class="sxs-lookup"><span data-stu-id="3654e-223">Duration of audio processing quantum</span></span>

<span data-ttu-id="3654e-224">在大部分的電腦上，XAudio 2.9 會以10毫秒的區塊處理音訊。</span><span class="sxs-lookup"><span data-stu-id="3654e-224">On most PCs, XAudio 2.9 processes audio in 10 millisecond chunks.</span></span> <span data-ttu-id="3654e-225">這稱為處理量子。</span><span class="sxs-lookup"><span data-stu-id="3654e-225">This is called the processing quantum.</span></span> <span data-ttu-id="3654e-226">不過，在某些硬體上，此量子的持續時間可能會不同于10毫秒。</span><span class="sxs-lookup"><span data-stu-id="3654e-226">However, the duration of this quantum may be different than 10 milliseconds on some hardware.</span></span> <span data-ttu-id="3654e-227">需要知道確切量子的應用程式可以叫用 IXAudio2Extension：： GetProcessingQuantum 方法來取得值。</span><span class="sxs-lookup"><span data-stu-id="3654e-227">Apps that need to know the exact quantum can invoke the IXAudio2Extension::GetProcessingQuantum method to retrieve the value.</span></span>

### <a name="spatial-sound-and-virtual-surround"></a><span data-ttu-id="3654e-228">空間音效和虛擬環繞</span><span class="sxs-lookup"><span data-stu-id="3654e-228">Spatial sound and virtual surround</span></span>

<span data-ttu-id="3654e-229">從 Windows 10 1903 更新開始，如果滿足特定條件，XAudio 2.9 會自動使用虛擬環繞音效。</span><span class="sxs-lookup"><span data-stu-id="3654e-229">Starting with the Windows 10 1903 update, XAudio 2.9 automatically uses virtual surround sound, if certain conditions are satisfied.</span></span> <span data-ttu-id="3654e-230">我們建議在 Windows 10 1903 (或較新的) 上產生多聲道音效的測試遊戲，以驗證遊戲是否如預期般運作。</span><span class="sxs-lookup"><span data-stu-id="3654e-230">We recommend testing game that generate multi-channel sound on Windows 10 1903 (or newer) to verify that the game sounds as expected.</span></span> <span data-ttu-id="3654e-231">如需如何測試這項功能的討論，請參閱「 [測試空間音效](#spatial-sound-in-newer-versions-of-windows-10) 」一節。</span><span class="sxs-lookup"><span data-stu-id="3654e-231">See the [testing spatial sound](#spatial-sound-in-newer-versions-of-windows-10) section for a discussion about how to test this feature.</span></span>

<span data-ttu-id="3654e-232">一般來說，XAudio 2.9 會折迭任何多頻道音訊，以符合音訊端點所支援的「實體」音訊聲道數目。</span><span class="sxs-lookup"><span data-stu-id="3654e-232">Normally, XAudio 2.9 performs a folds down any multi-channel audio to match the "physical" number of audio channels that are supported by the audio endpoint.</span></span> <span data-ttu-id="3654e-233">例如，如果遊戲提供7.1 聲道音訊來源，但音效是在耳機上播放，則 XAudio 2.9 會使用業界標準的折迭矩陣，將7.1 頻道音訊折迭為身歷聲。</span><span class="sxs-lookup"><span data-stu-id="3654e-233">For example, if the game provides a 7.1 channel audio source, but the sound is played on headphones, XAudio 2.9 will fold down the 7.1 channel audio into stereo, using an industry standard fold-down matrix.</span></span> <span data-ttu-id="3654e-234">如果電腦連線到 HDMI 音訊端點，則7.1 通道音訊將會透過 HDMI 連線以現狀傳輸。</span><span class="sxs-lookup"><span data-stu-id="3654e-234">If the PC is connected to a HDMI audio endpoint, then the 7.1 channel audio will be transmitted as-is over the HDMI connection.</span></span>

<span data-ttu-id="3654e-235">Windows 10 使用集中式編碼器將音訊編碼為使用者選取的 [空間音效](../coreaudio/spatial-sound.md) 格式，以新增空間音訊的支援。</span><span class="sxs-lookup"><span data-stu-id="3654e-235">Windows 10 adds support for spatial audio, using a centralized encoder that encodes audio into a user-selected [spatial sound](../coreaudio/spatial-sound.md) format.</span></span> <span data-ttu-id="3654e-236">Windows 10 隨附于名為 Windows Sonic 的空間音效格式。</span><span class="sxs-lookup"><span data-stu-id="3654e-236">Windows 10 comes included with a spatial sound format called Windows Sonic.</span></span> <span data-ttu-id="3654e-237">您可以從 Microsoft Store 下載其他格式，例如 Dolby Atmos for Headphones。</span><span class="sxs-lookup"><span data-stu-id="3654e-237">Other formats, such as Dolby Atmos for Headphones, can be downloaded from the Microsoft Store.</span></span> <span data-ttu-id="3654e-238">某些空間音效格式（例如 Windows Sonic 和 Dolby Atmos for Headphones）是設計用於身歷聲音訊端點。</span><span class="sxs-lookup"><span data-stu-id="3654e-238">Some of the spatial sound formats, such as Windows Sonic and Dolby Atmos for Headphones, are designed to be used on stereo audio endpoints.</span></span> <span data-ttu-id="3654e-239">這些格式會使用可達成「虛擬」環繞音效效果的專屬演算法，將「環繞音效」折迭到身歷聲。</span><span class="sxs-lookup"><span data-stu-id="3654e-239">These formats fold down surround sound to stereo using proprietary algorithms that achieve a "virtual" surround sound effect.</span></span> <span data-ttu-id="3654e-240">換句話說，接聽程式可以觀察3D 空間中不同位置的音效，即使只是戴耳機，或是聆聽一對身歷聲喇叭也一樣。</span><span class="sxs-lookup"><span data-stu-id="3654e-240">In other words, the listener can perceive sound appearing from different positions in 3D space even while only wearing headphones, or while listening on a single pair of stereo speakers.</span></span>

<span data-ttu-id="3654e-241">您可以使用 XAudio 2.9 隨附的 [X3DAudio](x3daudio.md) api 來達成類似效果。</span><span class="sxs-lookup"><span data-stu-id="3654e-241">Similar effects can be achieved using the [X3DAudio](x3daudio.md) APIs that are included with XAudio 2.9.</span></span> <span data-ttu-id="3654e-242">主要差異在於 X3DAudio 需要應用程式開發人員明確地為3D 音訊進行程式設計，而虛擬環繞音效則會自動套用到任何以 tradional 通道為基礎的音效來源。</span><span class="sxs-lookup"><span data-stu-id="3654e-242">The main difference is that X3DAudio requires the app developer to explicitly program for 3D audio, whereas virtual surround sound is applied automatically to any tradional channel-based sound source.</span></span>

<span data-ttu-id="3654e-243">在 Windows 10 1903 和更新版本的遊戲中，使用 XAudio 2.9 的遊戲將會使用使用者已在音訊端點上啟用的全系統空間音效格式（如果有的話）。</span><span class="sxs-lookup"><span data-stu-id="3654e-243">On Windows 10 1903, and newer, games that use XAudio 2.9 will use the system-wide spatial sound format that the user has enabled on the audio endpoint, if any.</span></span> <span data-ttu-id="3654e-244">這表示，XAudio 2.9 不會將環繞音效的一般折迭執行至身歷聲。</span><span class="sxs-lookup"><span data-stu-id="3654e-244">This means that XAudio 2.9 will not perform the usual fold-down of surround sound to stereo.</span></span> <span data-ttu-id="3654e-245">相反地，環繞音效將會傳遞給空間音效編碼器 (例如，Windows Sonic) ，以達到虛擬環繞音效的效果。</span><span class="sxs-lookup"><span data-stu-id="3654e-245">Instead, the surround sound signal will be delivered to the spatial sound encoder (e.g., Windows Sonic) to achieve a virtual surround sound effect.</span></span>

### <a name="createhrtfapo"></a><span data-ttu-id="3654e-246">CreateHrtfApo</span><span class="sxs-lookup"><span data-stu-id="3654e-246">CreateHrtfApo</span></span>

<span data-ttu-id="3654e-247">[**CreateHrtfApo**](/windows/desktop/api/HrtfApoApi/nf-hrtfapoapi-createhrtfapo)函數僅適用于 Windows 10。</span><span class="sxs-lookup"><span data-stu-id="3654e-247">The [**CreateHrtfApo**](/windows/desktop/api/HrtfApoApi/nf-hrtfapoapi-createhrtfapo) function is only available on Windows 10.</span></span> <span data-ttu-id="3654e-248">它不會在 XAudio 2.9 可轉散發套件中執行。</span><span class="sxs-lookup"><span data-stu-id="3654e-248">It is not implemented in the XAudio 2.9 redistributable.</span></span>
