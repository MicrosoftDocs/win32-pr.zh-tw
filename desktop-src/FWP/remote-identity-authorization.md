---
title: 遠端身分識別授權
description: 遠端身分識別授權 IPsec 原則案例要求輸入連線來自一組特定的遠端安全性主體，在 Windows 的安全描述項 (SD) 存取控制清單 (ACL) 中指定。
ms.assetid: 4d9f83d6-6f56-4416-8c35-d0260f9e888c
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c426f0d153d45d3699020bb723b15d75d84df4662fd0bb61d66513c2af24fe31
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/11/2021
ms.locfileid: "120075378"
---
# <a name="remote-identity-authorization"></a>遠端身分識別授權

遠端身分識別授權 IPsec 原則案例要求輸入連線來自一組特定的遠端安全性主體，在 Windows 的安全描述項 (SD) 存取控制清單 (ACL) 中指定。 如果遠端身分識別 (由 IPsec 所決定) 不符合允許的身分識別集合，則連線將會中斷。 此原則必須與其中一個傳輸模式原則選項一起指定。

如果已啟用 AuthIP，則可以指定兩個安全描述項，一個對應至 AuthIP 主要模式，另一個對應至 AuthIP 擴充模式。

可能的協商探索傳輸模式案例的其中一個範例是「使用 IPsec 傳輸模式來保護所有的單播資料流量（ICMP 除外）、啟用協調探索，以及根據安全性描述項來限制允許的遠端身分識別的輸入存取權 SD1)  (對應到 SD2 的)  (的所有單點傳送流量，以對應至 TCP 本機埠5555。

若要以程式設計方式執行此範例，請使用下列 WFP 設定。

<dl>

**在 FWPM \_ LAYER \_ IKEEXT \_ V {4 \| 6} 安裝程式 MM 的協商原則**  

1.  新增下列一或兩個 MM 原則提供者內容。  
    -   針對 IKE， **FWPM \_ IPSEC \_ IKE \_ MM \_ coNtext** 型別的原則提供者內容。
    -   針對 AuthIP， **FWPM \_ IPSEC \_ AuthIP \_ MM \_ coNtext** 型別的原則提供者內容。

    > [!Note]  
    > 系統將會協商一般的加密模組，並套用對應的 MM 原則。 如果支援 IKE 和 AuthIP，則 AuthIP 是慣用的金鑰模組。

     

2.  針對步驟1中新增的每個內容，新增具有下列屬性的篩選準則。 

    | 篩選屬性        | 值                                            |
    |------------------------|--------------------------------------------------|
    | 篩選準則   | 空白。 所有流量都會符合篩選。        |
    | **providerCoNtextKey** | 在步驟1中新增的 MM 提供者內容的 GUID。 |

        

**在 FWPM \_ 層 \_ \_ ，IPSEC V {4 \| 6} 安裝 QM 和 EM 協商原則**  

1.  新增下列一或兩個 QM 傳輸模式原則提供者內容，並設定 [**IPSEC \_ 原則 \_ 旗標 \_ ND \_ 安全**](/windows/desktop/api/Ipsectypes/ns-ipsectypes-ipsec_transport_policy0) 旗標。  
    -   針對 IKE， **FWPM \_ IPSEC \_ IKE \_ QM \_ 傳輸 \_ 內容** 類型的原則提供者內容。
    -   針對 AuthIP，FWPM IPSEC AuthIP 類型的原則提供者內容會 **\_ \_ \_ QM \_ 傳輸 \_ 內容** ，其中包含 AuthIP 延伸模式 (EM) 的協商原則。

    > [!Note]  
    > 系統將會協商一般的加密模組，並套用對應的 QM 原則。 如果支援 IKE 和 AuthIP，則 AuthIP 是慣用的金鑰模組。

     

2.  針對步驟1中新增的每個內容，新增具有下列屬性的篩選準則。 

    | 篩選屬性        | 值                                            |
    |------------------------|--------------------------------------------------|
    | 篩選準則   | 空白。 所有流量都會符合篩選。        |
    | **providerCoNtextKey** | 在步驟1中新增的 QM 提供者內容的 GUID。 |

        

**在 FWPM \_ 層 \_ 輸入 \_ 傳輸 \_ V {4 \| 6} 設定輸入每個封包篩選規則**  

1.  新增具有下列屬性的篩選準則。 

    | 篩選屬性                                                   | 值                                                                                              |
    |-------------------------------------------------------------------|----------------------------------------------------------------------------------------------------|
    | **FWPM \_條件 \_ IP \_ 本機 \_ 位址 \_ 類型** 篩選準則 | [NlatUnicast](/windows/win32/api/nldef/ne-nldef-nl_address_type)                                      |
    | **動作。類型**                                                   | **已 \_ 終止的 .FWP 動作 \_ 標注 \_**                                                              |
    | **calloutKey**                                             | **FWPM \_ 標注 \_ IPSEC \_ 輸入 \_ 傳輸 \_ V {4 \| 6}**                                              |
    | **rawCoNtext**                                                    | [**FWPM \_ 內容 \_ IPSEC \_ 輸入 \_ 保存 \_ 連接 \_ 安全性**](filter-context-identifiers.md) |

        
2.  藉由新增具有下列屬性的篩選準則，從 IPsec 豁免 ICMP 流量。 

    | 篩選屬性                                                   | 值                                                                      |
    |-------------------------------------------------------------------|----------------------------------------------------------------------------|
    | **FWPM \_條件 \_ IP \_ 本機 \_ 位址 \_ 類型** 篩選準則 | NlatUnicast                                                                |
    | **FWPM \_條件 \_ IP \_ 通訊協定** 篩選準則             | **IPPROTO \_ICMP {V6}** 這些常數定義于 winsock2. h 中。<br/> |
    | **動作。類型**                                                   | 已 \_ 允許的 .FWP 動作 \_                                                        |
    | **weight**                                                        | [**FWPM \_ 權數 \_ 範圍 \_ IKE \_ 豁免**](filter-weight-identifiers.md)  |

        

**在 FWPM \_ 層 \_ 輸出 \_ 傳輸 \_ V {4 \| 6} 上，設定每個封包篩選規則的輸出**  

1.  新增具有下列屬性的篩選準則。 

    | 篩選屬性                                                   | 值                                                                                     |
    |-------------------------------------------------------------------|-------------------------------------------------------------------------------------------|
    | **FWPM \_條件 \_ IP \_ 本機 \_ 位址 \_ 類型** 篩選準則 | NlatUnicast                                                                               |
    | **動作。類型**                                                   | **已 \_ 終止的 .FWP 動作 \_ 標注 \_**                                                     |
    | **calloutKey**                                             | **FWPM \_ 標注 \_ IPSEC \_ 輸出 \_ 傳輸 \_ V {4 \| 6}**                                    |
    | **rawCoNtext**                                                    | [**FWPM \_ 內容 \_ IPSEC \_ 輸出 \_ 協商 \_ 探索**](filter-context-identifiers.md) |

        
2.  藉由新增具有下列屬性的篩選準則，從 IPsec 豁免 ICMP 流量。 

    | 篩選屬性                                                   | 值                                                                  |
    |-------------------------------------------------------------------|------------------------------------------------------------------------|
    | **FWPM \_條件 \_ IP \_ 本機 \_ 位址 \_ 類型** 篩選準則 | NlatUnicast                                                            |
    | **FWPM \_條件 \_ IP \_ 通訊協定** 篩選準則             | IPPROTO \_ ICMP {V6} 這些常數定義于 winsock2. h 中。<br/> |
    | **動作。類型**                                                   | **已 \_ 允許的 .FWP 動作 \_**                                                |
    | **weight**                                                        | **FWPM \_ 權數 \_ 範圍 \_ IKE \_ 豁免**                               |

        

**在 FWPM \_ 層的 \_ ALE \_ 驗證 \_ 接收 \_ 接受 \_ V {4 \| 6} 安裝輸入的每個連線篩選規則**  

1.  新增具有下列屬性的篩選準則。 此篩選器只允許透過 IPsec 保護的輸入連接嘗試。 

    | 篩選屬性                                                   | 值                                                        |
    |-------------------------------------------------------------------|--------------------------------------------------------------|
    | **FWPM \_條件 \_ IP \_ 本機 \_ 位址 \_ 類型** 篩選準則 | NlatUnicast                                                  |
    | **動作。類型**                                                   | **已 \_ 終止的 .FWP 動作 \_ 標注 \_**                        |
    | **calloutKey**                                             | **FWPM \_ 標注 \_ IPSEC \_ 輸入 \_ 起始 \_ 安全 \_ V {4 \| 6}** |

        
2.  藉由新增具有下列屬性的篩選準則，從 IPsec 豁免 ICMP 流量。 

    | 篩選屬性                                                   | 值                                                                      |
    |-------------------------------------------------------------------|----------------------------------------------------------------------------|
    | **FWPM \_條件 \_ IP \_ 本機 \_ 位址 \_ 類型** 篩選準則 | NlatUnicast                                                                |
    | **FWPM \_條件 \_ IP \_ 通訊協定** 篩選準則             | **IPPROTO \_ICMP {V6}** 這些常數定義于 winsock2. h 中。<br/> |
    | **動作。類型**                                                   | **已 \_ 允許的 .FWP 動作 \_**                                                    |
    | **weight**                                                        | **FWPM \_ 權數 \_ 範圍 \_ IKE \_ 豁免**                                   |

        
3.  新增具有下列屬性的篩選準則。 如果 SD1 和 SD2 允許對應的遠端識別，此篩選準則將允許 TCP 埠5555的輸入連接。 

    | 篩選屬性                                                   | 值                                                              |
    |-------------------------------------------------------------------|--------------------------------------------------------------------|
    | **FWPM \_條件 \_ IP \_ 本機 \_ 位址 \_ 類型** 篩選準則 | NlatUnicast                                                        |
    | **FWPM \_條件 \_ IP \_ 通訊協定** 篩選準則             | **IPPROTO \_TCP** 此常數定義于 winsock2. h 中。<br/> |
    | **FWPM \_條件 \_ IP \_ 本機 \_ 埠** 篩選準則          | 5555                                                               |
    | **FWPM \_ 條件 \_ ALE \_ 遠端 \_ 電腦 \_ 識別碼**                     | SD1                                                                |
    | **FWPM \_ 條件 \_ ALE \_ 遠端 \_ 使用者 \_ 識別碼**                        | SD2                                                                |
    | **動作。類型**                                                   | **已 \_ 終止的 .FWP 動作 \_ 標注 \_**                              |
    | **calloutKey**                                             | **FWPM \_ 標注 \_ IPSEC \_ 輸入 \_ 起始 \_ 安全 \_ V {4 \| 6}**       |

        
4.  新增具有下列屬性的篩選準則。 此篩選準則會封鎖與先前篩選準則不相符的任何 TCP 埠5555的任何輸入連接。 

    | 篩選屬性                                                   | 值                                                              |
    |-------------------------------------------------------------------|--------------------------------------------------------------------|
    | **FWPM \_條件 \_ IP \_ 本機 \_ 位址 \_ 類型** 篩選準則 | NlatUnicast                                                        |
    | **FWPM \_條件 \_ IP \_ 通訊協定** 篩選準則             | **IPPROTO \_TCP** 此常數定義于 winsock2. h 中。<br/> |
    | **FWPM \_條件 \_ IP \_ 本機 \_ 埠** 篩選準則          | 5555                                                               |
    | **動作。類型**                                                   | **.FWP \_ 動作 \_ 區塊**                                             |

        

</dl>

## <a name="related-topics"></a>相關主題

<dl> <dt>

[範例程式碼：使用傳輸模式](using-transport-mode.md)
</dt> <dt>

[ALE 層](ale-layers.md)
</dt> <dt>

[**內建的標注識別碼**](built-in-callout-identifiers.md)
</dt> <dt>

[篩選準則](filtering-conditions.md)
</dt> <dt>

[**篩選層識別碼**](management-filtering-layer-identifiers-.md)
</dt> <dt>

[**FWPM \_ ACTION0**](/windows/desktop/api/Fwpmtypes/ns-fwpmtypes-fwpm_action0)
</dt> <dt>

[**FWPM \_ 提供者 \_ 內容 \_ 類型**](/windows/desktop/api/Fwpmtypes/ne-fwpmtypes-fwpm_provider_context_type)
</dt> </dl>

 

