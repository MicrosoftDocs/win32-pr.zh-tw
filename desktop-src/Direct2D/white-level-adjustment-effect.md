---
title: 白色色調地圖效果
description: 此效果可讓影像的白色層級以線性方式調整。 當您在顯示參考的亮度空間和場景參考的亮度空間之間轉換時，這會特別有用，反之亦然。
ms.topic: article
ms.date: 02/01/2019
ms.openlocfilehash: 70a38f37f5a5461b968099bebe4be120a727c053
ms.sourcegitcommit: a1494c819bc5200050696e66057f1020f5b142cb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 12/12/2020
ms.locfileid: "103934614"
---
# <a name="white-level-adjustment-effect"></a><span data-ttu-id="3b7e9-104">白色層級調整效果</span><span class="sxs-lookup"><span data-stu-id="3b7e9-104">White level adjustment effect</span></span>

<span data-ttu-id="3b7e9-105">此效果可讓影像的白色層級以線性方式調整。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-105">This effect allows the white level of an image to be linearly scaled.</span></span> <span data-ttu-id="3b7e9-106">當您在顯示參考的亮度空間和場景參考的亮度空間之間轉換時，這會特別有用，反之亦然。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-106">This is especially helpful when you convert between display-referred luminance space and scene-referred luminance space, or vice versa.</span></span>

<span data-ttu-id="3b7e9-107">這項效果的屬性是由 [**D2D1_WHITELEVELADJUSTMENT_PROP 列舉**](/windows/desktop/api/d2d1effects_2/ne-d2d1effects_2-d2d1_whiteleveladjustment_prop)識別，而 CLSID 是 **CLSID_D2D1WhiteLevelAdjustment**。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-107">The properties for this effect are identified by the [**D2D1_WHITELEVELADJUSTMENT_PROP enumeration**](/windows/desktop/api/d2d1effects_2/ne-d2d1effects_2-d2d1_whiteleveladjustment_prop), and the CLSID is **CLSID_D2D1WhiteLevelAdjustment**.</span></span>

## <a name="effect-properties"></a><span data-ttu-id="3b7e9-108">效果屬性</span><span class="sxs-lookup"><span data-stu-id="3b7e9-108">Effect properties</span></span>

| <span data-ttu-id="3b7e9-109">顯示名稱和索引列舉</span><span class="sxs-lookup"><span data-stu-id="3b7e9-109">Display name and index enumeration</span></span> | <span data-ttu-id="3b7e9-110">類型和預設值</span><span class="sxs-lookup"><span data-stu-id="3b7e9-110">Type and default value</span></span> | <span data-ttu-id="3b7e9-111">Description</span><span class="sxs-lookup"><span data-stu-id="3b7e9-111">Description</span></span> |
|-|-|-|
| <span data-ttu-id="3b7e9-112">InputWhiteLevel、D2D1_WHITELEVELADJUSTMENT_PROP_INPUT_WHITE_LEVEL</span><span class="sxs-lookup"><span data-stu-id="3b7e9-112">InputWhiteLevel, D2D1_WHITELEVELADJUSTMENT_PROP_INPUT_WHITE_LEVEL</span></span> | <span data-ttu-id="3b7e9-113">FLOAT</span><span class="sxs-lookup"><span data-stu-id="3b7e9-113">FLOAT</span></span> | <span data-ttu-id="3b7e9-114">輸入影像的白色層級，以 nits。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-114">The white level of the input image, in nits.</span></span> |
| <span data-ttu-id="3b7e9-115">OutputWhiteLevel、D2D1_WHITELEVELADJUSTMENT_PROP_OUTPUT_WHITE_LEVEL</span><span class="sxs-lookup"><span data-stu-id="3b7e9-115">OutputWhiteLevel, D2D1_WHITELEVELADJUSTMENT_PROP_OUTPUT_WHITE_LEVEL</span></span> | <span data-ttu-id="3b7e9-116">FLOAT</span><span class="sxs-lookup"><span data-stu-id="3b7e9-116">FLOAT</span></span> | <span data-ttu-id="3b7e9-117">輸出影像的白色層級（nits）。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-117">The white level of the output image, in nits.</span></span> |

## <a name="remarks"></a><span data-ttu-id="3b7e9-118">備註</span><span class="sxs-lookup"><span data-stu-id="3b7e9-118">Remarks</span></span>
<span data-ttu-id="3b7e9-119">這項效果的目的是要結合 [HDR 語氣地圖效果](hdr-tone-map-effect.md) ，讓您在 Direct2D 中使用適當的色彩管理和色調對應來轉譯 HDR 影像。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-119">This effect is intended to be combined with the [HDR tone map effect](hdr-tone-map-effect.md) to allow you to render HDR images in Direct2D with proper color management and tone mapping.</span></span> <span data-ttu-id="3b7e9-120">如需詳細資訊，請參閱該主題的 **備註** 。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-120">See that topic's **Remarks** for more details.</span></span> <span data-ttu-id="3b7e9-121">這些效果的目標是想要提供最多功能的 HDR 影像觀賞體驗，以處理所有的 Windows HDR 影像格式，並適應顯示 (無論是 HDR 或 WCG/SDR) 的架構。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-121">The effects are aimed at any framework that wants to provide a best-in-class HDR image viewing experience that handles all of the Windows HDR image formats, and adapts to the capabilities of the display (whether that's HDR or WCG/SDR).</span></span>

<span data-ttu-id="3b7e9-122">在 Windows 上，所有的 SDR/WCG 內容都假設在顯示參考的亮度空間中，表示內容的白色層級應該在最後呈現之前，向上擴充至顯示器的白色層級。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-122">On Windows, all SDR/WCG content is assumed to be in a display-referred luminance space, meaning that the white level of the content should be scaled up to the display's white level before it is ultimately presented.</span></span> <span data-ttu-id="3b7e9-123">不過，這不一定會讓您的應用程式負責進行此作業。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-123">However, it's not always your application's responsibility to do this.</span></span> <span data-ttu-id="3b7e9-124">相反地，HDR 內容會假設在場景參考的亮度空間中，這表示它最後不應調整以符合顯示器的白色層級。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-124">In contrast, HDR content is assumed to be in a scene-referred luminance space, meaning that it shouldn't ultimately be scaled to match the display's white level.</span></span> <span data-ttu-id="3b7e9-125">也就是說，在某些情況下，您的應用程式可能需要在轉譯 HDR 內容時執行調整，以確保這是淨結果。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-125">That said, your application may need to perform scaling in some circumstances when rendering HDR content to ensure that this is the net result.</span></span>

<span data-ttu-id="3b7e9-126">當 Windows 桌面處於 SDR 或 WCG 模式時，桌面會以顯示參考的亮度空間組成。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-126">When the Windows desktop is in SDR or WCG mode, the desktop is composed in a display-referred luminance space.</span></span> <span data-ttu-id="3b7e9-127">但是，如果 Windows 桌面處於 HDR 模式，則桌面電腦群組合會在場景參考的亮度空間中進行。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-127">But if the Windows desktop is in HDR mode, then desktop composition happens in scene-referred luminance space.</span></span> <span data-ttu-id="3b7e9-128">話雖如此，桌面視窗管理員 (DWM) 本身會執行亮度調整， (通常稱為8位組合表面的 SDRBoost) ，可簡化應用程式的情況。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-128">That said, the Desktop Window Manager (DWM) itself performs luminance adjustments (often called SDRBoost) for 8-bit composition surfaces, and that simplifies your application for that case.</span></span> <span data-ttu-id="3b7e9-129">即使是這樣，自動提升也表示您的應用程式從一個亮度空間轉換到另一個亮度空間的角色，取決於您的應用程式用來呈現其內容的組合格式。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-129">Even so, the automatic boost means that your application's role in converting from one luminance space to another is dependent upon the composition format that your application is using to present its content.</span></span>

<span data-ttu-id="3b7e9-130">下表描述您的應用程式應該和不應執行白色層級調整的案例，以及該調整的大小。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-130">The table below describes the cases when your application should and should not perform a white level adjustment, as well as what that adjustment should be.</span></span> <span data-ttu-id="3b7e9-131">一般而言，調整取決於三個因素。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-131">In general, the adjustment depends on three factors.</span></span>

1. <span data-ttu-id="3b7e9-132">輸入內容 colorspace。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-132">Input content colorspace.</span></span> <span data-ttu-id="3b7e9-133">您的輸入內容是否包含高動態範圍 (HDR) 亮度值。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-133">Whether your input content contains high dynamic range (HDR) luminance values or not.</span></span> <span data-ttu-id="3b7e9-134">WCG 內容的行為與 SDR 相同，適用于亮度行為。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-134">WCG content behaves the same as SDR for luminance behavior.</span></span>
2. <span data-ttu-id="3b7e9-135">組合格式。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-135">Composition format.</span></span> <span data-ttu-id="3b7e9-136">呈現給 DWM 的目標介面的像素格式 &mdash; ，例如 [交換鏈](/windows/desktop/api/dxgi/nn-dxgi-idxgiswapchain) 或 [複合表面](/uwp/api/Windows.UI.Composition.ICompositionSurface)。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-136">The pixel format of the target surface that is presented to the DWM&mdash;for example, a [swap chain](/windows/desktop/api/dxgi/nn-dxgi-idxgiswapchain) or a [composition surface](/uwp/api/Windows.UI.Composition.ICompositionSurface).</span></span> <span data-ttu-id="3b7e9-137">使用 Direct2D 轉譯時，這可能是 **UINT8** 或 **FP16**。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-137">When rendering using Direct2D, this is either **UINT8** or **FP16**.</span></span>
3. <span data-ttu-id="3b7e9-138">桌面 advanced 色彩模式。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-138">Desktop advanced color mode.</span></span> <span data-ttu-id="3b7e9-139">DWM 是在目前顯示的 SDR、WCG 或 HDR 模式中執行。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-139">Whether the DWM is running in SDR, WCG, or HDR mode for the current display.</span></span> <span data-ttu-id="3b7e9-140">透過 [**DXGI_OUTPUT_DESC1：： ColorSpace**](/windows/desktop/api/dxgi1_6/ns-dxgi1_6-dxgi_output_desc1) 或 [**AdvancedColorInfo. CurrentAdvancedColorKind**](/uwp/api/windows.graphics.display.advancedcolorinfo.currentadvancedcolorkind)取得此資訊。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-140">Obtain this information via [**DXGI_OUTPUT_DESC1::ColorSpace**](/windows/desktop/api/dxgi1_6/ns-dxgi1_6-dxgi_output_desc1) or [**AdvancedColorInfo.CurrentAdvancedColorKind**](/uwp/api/windows.graphics.display.advancedcolorinfo.currentadvancedcolorkind).</span></span>

<span data-ttu-id="3b7e9-141">根據這三個因素，您應該針對和屬性設定適當的 `InputWhiteLevel` 值 `OutputWhiteLevel` 。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-141">Based on these three factors, you should set the appropriate values for the `InputWhiteLevel` and `OutputWhiteLevel` properties.</span></span>

|<span data-ttu-id="3b7e9-142">輸入內容</span><span class="sxs-lookup"><span data-stu-id="3b7e9-142">Input content</span></span>|<span data-ttu-id="3b7e9-143">組合格式</span><span class="sxs-lookup"><span data-stu-id="3b7e9-143">Composition format</span></span>|<span data-ttu-id="3b7e9-144">Advanced color 模式</span><span class="sxs-lookup"><span data-stu-id="3b7e9-144">Advanced color mode</span></span>|<span data-ttu-id="3b7e9-145">InputWhiteLevel</span><span class="sxs-lookup"><span data-stu-id="3b7e9-145">InputWhiteLevel</span></span>|<span data-ttu-id="3b7e9-146">OutputWhiteLevel</span><span class="sxs-lookup"><span data-stu-id="3b7e9-146">OutputWhiteLevel</span></span>|
|-|-|-|-|-|
|<span data-ttu-id="3b7e9-147">SDR/WCG</span><span class="sxs-lookup"><span data-stu-id="3b7e9-147">SDR/WCG</span></span>|<span data-ttu-id="3b7e9-148">**UINT8**</span><span class="sxs-lookup"><span data-stu-id="3b7e9-148">**UINT8**</span></span>|<span data-ttu-id="3b7e9-149">任意</span><span class="sxs-lookup"><span data-stu-id="3b7e9-149">Any</span></span>|<span data-ttu-id="3b7e9-150">N/A</span><span class="sxs-lookup"><span data-stu-id="3b7e9-150">N/A</span></span>|<span data-ttu-id="3b7e9-151">N/A</span><span class="sxs-lookup"><span data-stu-id="3b7e9-151">N/A</span></span>|
|<span data-ttu-id="3b7e9-152">SDR/WCG</span><span class="sxs-lookup"><span data-stu-id="3b7e9-152">SDR/WCG</span></span>|<span data-ttu-id="3b7e9-153">**FP16**</span><span class="sxs-lookup"><span data-stu-id="3b7e9-153">**FP16**</span></span>|<span data-ttu-id="3b7e9-154">SDR/WCG</span><span class="sxs-lookup"><span data-stu-id="3b7e9-154">SDR/WCG</span></span>|<span data-ttu-id="3b7e9-155">N/A</span><span class="sxs-lookup"><span data-stu-id="3b7e9-155">N/A</span></span>|<span data-ttu-id="3b7e9-156">N/A</span><span class="sxs-lookup"><span data-stu-id="3b7e9-156">N/A</span></span>|
|<span data-ttu-id="3b7e9-157">SDR/WCG</span><span class="sxs-lookup"><span data-stu-id="3b7e9-157">SDR/WCG</span></span>|<span data-ttu-id="3b7e9-158">**FP16**</span><span class="sxs-lookup"><span data-stu-id="3b7e9-158">**FP16**</span></span>|<span data-ttu-id="3b7e9-159">HDR</span><span class="sxs-lookup"><span data-stu-id="3b7e9-159">HDR</span></span>|<span data-ttu-id="3b7e9-160">SDRWhite</span><span class="sxs-lookup"><span data-stu-id="3b7e9-160">SDRWhite</span></span>|<span data-ttu-id="3b7e9-161">80</span><span class="sxs-lookup"><span data-stu-id="3b7e9-161">80</span></span>|
|<span data-ttu-id="3b7e9-162">HDR</span><span class="sxs-lookup"><span data-stu-id="3b7e9-162">HDR</span></span>|<span data-ttu-id="3b7e9-163">任意</span><span class="sxs-lookup"><span data-stu-id="3b7e9-163">Any</span></span>|<span data-ttu-id="3b7e9-164">SDR/WCG</span><span class="sxs-lookup"><span data-stu-id="3b7e9-164">SDR/WCG</span></span>|<span data-ttu-id="3b7e9-165">80</span><span class="sxs-lookup"><span data-stu-id="3b7e9-165">80</span></span>|[<span data-ttu-id="3b7e9-166">**DXGI_OUTPUT_DESC1：： MaxLuminance**</span><span class="sxs-lookup"><span data-stu-id="3b7e9-166">**DXGI_OUTPUT_DESC1::MaxLuminance**</span></span>](/windows/desktop/api/dxgi1_6/ns-dxgi1_6-dxgi_output_desc1)|
|<span data-ttu-id="3b7e9-167">HDR</span><span class="sxs-lookup"><span data-stu-id="3b7e9-167">HDR</span></span>|<span data-ttu-id="3b7e9-168">**UINT8**</span><span class="sxs-lookup"><span data-stu-id="3b7e9-168">**UINT8**</span></span>|<span data-ttu-id="3b7e9-169">HDR</span><span class="sxs-lookup"><span data-stu-id="3b7e9-169">HDR</span></span>|<span data-ttu-id="3b7e9-170">80</span><span class="sxs-lookup"><span data-stu-id="3b7e9-170">80</span></span>|<span data-ttu-id="3b7e9-171">SDRWhite</span><span class="sxs-lookup"><span data-stu-id="3b7e9-171">SDRWhite</span></span>|
|<span data-ttu-id="3b7e9-172">HDR</span><span class="sxs-lookup"><span data-stu-id="3b7e9-172">HDR</span></span>|<span data-ttu-id="3b7e9-173">**FP16**</span><span class="sxs-lookup"><span data-stu-id="3b7e9-173">**FP16**</span></span>|<span data-ttu-id="3b7e9-174">HDR</span><span class="sxs-lookup"><span data-stu-id="3b7e9-174">HDR</span></span>|<span data-ttu-id="3b7e9-175">N/A</span><span class="sxs-lookup"><span data-stu-id="3b7e9-175">N/A</span></span>|<span data-ttu-id="3b7e9-176">N/A</span><span class="sxs-lookup"><span data-stu-id="3b7e9-176">N/A</span></span>|

<span data-ttu-id="3b7e9-177">在資料表中，值80是適用于 sRGB 或 scRGB 內容的參考白色層級（以 nits）。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-177">In the table, the value 80 is the reference white level, in nits, for sRGB or scRGB content.</span></span> <span data-ttu-id="3b7e9-178">若要這樣做，您可以使用[](/windows/desktop/direct2d/direct2d-constants)在中定義的常數 D2D1_SCENE_REFERRED_SDR_WHITE_LEVEL `d2d1effects_2.h` 。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-178">For this, you can use the constant [**D2D1_SCENE_REFERRED_SDR_WHITE_LEVEL**](/windows/desktop/direct2d/direct2d-constants), which is defined in `d2d1effects_2.h`.</span></span> <span data-ttu-id="3b7e9-179">此值 `SDRWhite` 是顯示器應用來顯示白色 sRGB 內容的 nits 數目。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-179">The value `SDRWhite` is the number of nits that the display should use to display white sRGB content.</span></span> <span data-ttu-id="3b7e9-180">您可以藉由存取 [**AdvancedColorInfo. SdrWhiteLevelInNits**](/uwp/api/windows.graphics.display.advancedcolorinfo.sdrwhitelevelinnits) 屬性來取得此值。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-180">You can retrieve this value by accessing the [**AdvancedColorInfo.SdrWhiteLevelInNits**](/uwp/api/windows.graphics.display.advancedcolorinfo.sdrwhitelevelinnits) property.</span></span> <span data-ttu-id="3b7e9-181">值 N/A 表示此案例中不會使用白色層級調整;您可以從圖形中移除效果，或設定無作業的值。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-181">The value N/A means that white level adjustment is not used in this scenario; you can either remove the effect from your graph, or set values for a no-op.</span></span>

<span data-ttu-id="3b7e9-182">請注意，在應用程式不需要白色層級調整的情況下，DWM 或顯示可能會處理從顯示參考的亮度空間轉換成場景參考的亮度空間的轉換。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-182">Note that, in cases where a white level adjustment is not needed by the application, the DWM or the display may be handling the conversion from display-referred luminance space to scene-referred luminance space.</span></span>

- <span data-ttu-id="3b7e9-183">在 SDR/WCG 模式中，轉換會在 DWM 組合之後進行，並套用至顯示的所有內容。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-183">In SDR/WCG mode, the conversion happens after DWM composition, and applies to all content presented to that display.</span></span> <span data-ttu-id="3b7e9-184">顯示會以隱含方式執行這種轉換。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-184">The display implicitly performs this conversion.</span></span>
- <span data-ttu-id="3b7e9-185">在 HDR 模式中，在撰寫之前，DWM 會自動執行轉換，只要您的應用程式組合介面為 SDR 即可。</span><span class="sxs-lookup"><span data-stu-id="3b7e9-185">In HDR mode, the conversion is performed automatically by the DWM before composition, so long as your application's composition surface is SDR.</span></span>

## <a name="requirements"></a><span data-ttu-id="3b7e9-186">規格需求</span><span class="sxs-lookup"><span data-stu-id="3b7e9-186">Requirements</span></span>

| <span data-ttu-id="3b7e9-187">需求</span><span class="sxs-lookup"><span data-stu-id="3b7e9-187">Requirement</span></span> | <span data-ttu-id="3b7e9-188">值</span><span class="sxs-lookup"><span data-stu-id="3b7e9-188">Value</span></span> |
|-|-|
| <span data-ttu-id="3b7e9-189">最低支援的用戶端</span><span class="sxs-lookup"><span data-stu-id="3b7e9-189">Minimum supported client</span></span> | <span data-ttu-id="3b7e9-190">Windows 10 版本 1809 (10.0;組建 17763) \[ 桌面應用程式 \| UWP 應用程式\]</span><span class="sxs-lookup"><span data-stu-id="3b7e9-190">Windows 10, version 1809 (10.0; Build 17763) \[desktop apps \| UWP apps\]</span></span> |
| <span data-ttu-id="3b7e9-191">標頭</span><span class="sxs-lookup"><span data-stu-id="3b7e9-191">Header</span></span> | <span data-ttu-id="3b7e9-192">d2d1effects \_ 2。h</span><span class="sxs-lookup"><span data-stu-id="3b7e9-192">d2d1effects\_2.h</span></span> |
| <span data-ttu-id="3b7e9-193">程式庫</span><span class="sxs-lookup"><span data-stu-id="3b7e9-193">Library</span></span> | <span data-ttu-id="3b7e9-194">d2d1 .lib，dxguid .lib</span><span class="sxs-lookup"><span data-stu-id="3b7e9-194">d2d1.lib, dxguid.lib</span></span> |

## <a name="related-topics"></a><span data-ttu-id="3b7e9-195">相關主題</span><span class="sxs-lookup"><span data-stu-id="3b7e9-195">Related topics</span></span>

* [<span data-ttu-id="3b7e9-196">ID2D1Effect 介面</span><span class="sxs-lookup"><span data-stu-id="3b7e9-196">ID2D1Effect interface</span></span>](/windows/desktop/api/d2d1_1/nn-d2d1_1-id2d1effect)
* [<span data-ttu-id="3b7e9-197">D2D1_WHITELEVELADJUSTMENT_PROP 列舉</span><span class="sxs-lookup"><span data-stu-id="3b7e9-197">D2D1_WHITELEVELADJUSTMENT_PROP enumeration</span></span>](/windows/desktop/api/d2d1effects_2/ne-d2d1effects_2-d2d1_whiteleveladjustment_prop)
