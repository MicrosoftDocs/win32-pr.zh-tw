---
title: 使用 Direct2D 和 DirectWrite 的文字轉譯
description: 與其他 Api （例如 GDI、GDI + 或 WPF）不同的是，Direct2D 可與另一個 API （DirectWrite）交互操作，以操作和轉譯文字。 本主題說明這些個別元件的優點和互通性。
ms.assetid: 1d5b8deb-34e2-433c-8de3-4ef66fb4e49d
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e2c49a8f341377bcf78a9a99699a3bd4852411dd
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/20/2020
ms.locfileid: "104564845"
---
# <a name="text-rendering-with-direct2d-and-directwrite"></a><span data-ttu-id="4e30a-104">使用 Direct2D 和 DirectWrite 的文字轉譯</span><span class="sxs-lookup"><span data-stu-id="4e30a-104">Text Rendering with Direct2D and DirectWrite</span></span>

<span data-ttu-id="4e30a-105">與其他 Api （例如 [gdi](/windows/desktop/gdi/windows-gdi)、gdi + 或 WPF）不同的是， [Direct2D](./direct2d-portal.md) 可與另一個 api （ [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal)）交互操作，以操作和轉譯文字。</span><span class="sxs-lookup"><span data-stu-id="4e30a-105">Unlike other APIs, such as [GDI](/windows/desktop/gdi/windows-gdi), GDI+ or WPF, [Direct2D](./direct2d-portal.md) interoperates with another API, [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal), to manipulate and render text.</span></span> <span data-ttu-id="4e30a-106">本主題說明這些個別元件的優點和互通性。</span><span class="sxs-lookup"><span data-stu-id="4e30a-106">This topic describes the benefits and interoperation of these separate components.</span></span>

<span data-ttu-id="4e30a-107">本主題包含下列各節。</span><span class="sxs-lookup"><span data-stu-id="4e30a-107">This topic contains the following sections.</span></span>

-   [<span data-ttu-id="4e30a-108">Direct2D 可進行累加式採用</span><span class="sxs-lookup"><span data-stu-id="4e30a-108">Direct2D Enables Incremental Adoption</span></span>](#direct2d-enables-incremental-adoption)
-   [<span data-ttu-id="4e30a-109">文字服務與文字轉譯</span><span class="sxs-lookup"><span data-stu-id="4e30a-109">Text Services versus Text Rendering</span></span>](#text-services-versus-text-rendering)
-   [<span data-ttu-id="4e30a-110">字型與文字</span><span class="sxs-lookup"><span data-stu-id="4e30a-110">Glyphs versus Text</span></span>](#glyphs-versus-text)
-   [<span data-ttu-id="4e30a-111">DirectWrite 和 Direct2D</span><span class="sxs-lookup"><span data-stu-id="4e30a-111">DirectWrite and Direct2D</span></span>](#directwrite-and-direct2d)
    -   [<span data-ttu-id="4e30a-112">DrawText</span><span class="sxs-lookup"><span data-stu-id="4e30a-112">DrawText</span></span>](#drawtextlayout)
    -   [<span data-ttu-id="4e30a-113">DrawTextLayout</span><span class="sxs-lookup"><span data-stu-id="4e30a-113">DrawTextLayout</span></span>](#drawtextlayout)
    -   [<span data-ttu-id="4e30a-114">DrawGlyphRun</span><span class="sxs-lookup"><span data-stu-id="4e30a-114">DrawGlyphRun</span></span>](#drawglyphrun)
-   [<span data-ttu-id="4e30a-115">圖像呈現</span><span class="sxs-lookup"><span data-stu-id="4e30a-115">Glyph Rendering</span></span>](#glyph-rendering)
-   [<span data-ttu-id="4e30a-116">結論</span><span class="sxs-lookup"><span data-stu-id="4e30a-116">Conclusion</span></span>](#conclusion)

## <a name="direct2d-enables-incremental-adoption"></a><span data-ttu-id="4e30a-117">Direct2D 可進行累加式採用</span><span class="sxs-lookup"><span data-stu-id="4e30a-117">Direct2D Enables Incremental Adoption</span></span>

<span data-ttu-id="4e30a-118">將應用程式從一個圖形 API 移至另一個圖形 API 可能會很困難或不是您想要的各種原因。</span><span class="sxs-lookup"><span data-stu-id="4e30a-118">Moving an application from one graphics API to another can be difficult or not what you want for various reasons.</span></span> <span data-ttu-id="4e30a-119">這可能是因為您必須支援仍然採用較舊介面的外掛程式，因為應用程式本身太大而無法在一個版本中移植到新的 API，或因為較新 api 的某些部分是理想的，但較舊的 API 在應用程式的其他部分中運作良好。</span><span class="sxs-lookup"><span data-stu-id="4e30a-119">This might be because you have to support plug-ins that still take the older interfaces, because the application itself is too large to port over to a new API in one release or because some part of the newer API is desirable but the older API is working well enough for other parts of the application.</span></span>

<span data-ttu-id="4e30a-120">因為 [Direct2D](./direct2d-portal.md) 和 [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) 會實作為個別的元件，所以您可以升級整個2d 圖形系統，或只升級其文字部分。</span><span class="sxs-lookup"><span data-stu-id="4e30a-120">Because [Direct2D](./direct2d-portal.md) and [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) are implemented as separate components, you can upgrade your whole 2D graphics system or just the text part of it.</span></span> <span data-ttu-id="4e30a-121">例如，您可以將應用程式更新為使用 DirectWrite 做為文字，但仍使用 [gdi](/windows/desktop/gdi/windows-gdi) 或 gdi + 來呈現。</span><span class="sxs-lookup"><span data-stu-id="4e30a-121">For example, you could update an application to use DirectWrite for text but still use [GDI](/windows/desktop/gdi/windows-gdi) or GDI+ for rendering.</span></span>

## <a name="text-services-versus-text-rendering"></a><span data-ttu-id="4e30a-122">文字服務與文字轉譯</span><span class="sxs-lookup"><span data-stu-id="4e30a-122">Text Services versus Text Rendering</span></span>

<span data-ttu-id="4e30a-123">隨著應用程式的發展，其文字處理需求日益增加。</span><span class="sxs-lookup"><span data-stu-id="4e30a-123">As applications have evolved, their text processing requirements have grown increasingly complex.</span></span> <span data-ttu-id="4e30a-124">一開始，文字通常局限于靜態配置的 UI，而且文字是在定義完善的方塊中轉譯，例如按鈕。</span><span class="sxs-lookup"><span data-stu-id="4e30a-124">At first, text was generally confined to statically laid-out UI, and the text was rendered in a well-defined box, such as a button.</span></span> <span data-ttu-id="4e30a-125">當應用程式開始提供大量的語言時，此方法變得更困難，因為翻譯文字的寬度和高度在不同語言之間可能會有很大的差異。</span><span class="sxs-lookup"><span data-stu-id="4e30a-125">As applications began to be available in a growing number of languages, this approach became more difficult to sustain because both the width and height of the translated text can vary significantly between languages.</span></span> <span data-ttu-id="4e30a-126">為了進行調整，應用程式開始動態配置 UI 的方式，取決於實際轉譯的文字大小，而不是相反的。</span><span class="sxs-lookup"><span data-stu-id="4e30a-126">To adapt, applications started to dynamically lay out their UI to depend on the actual rendered size of the text, instead of the other way around.</span></span>

<span data-ttu-id="4e30a-127">為了協助應用程式完成這項工作， [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) 會提供 [**IDWriteTextLayout**](/windows/desktop/api/dwrite/nn-dwrite-idwritetextlayout) 介面。</span><span class="sxs-lookup"><span data-stu-id="4e30a-127">To help applications complete this task, [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) provides the [**IDWriteTextLayout**](/windows/desktop/api/dwrite/nn-dwrite-idwritetextlayout) interface.</span></span> <span data-ttu-id="4e30a-128">此 API 可讓應用程式指定具有複雜特性的文字片段，例如不同的字型和字型大小、底線、strikethroughs、雙向文字、效果、省略號，甚至是內嵌的非字元字元 (例如點陣圖圖釋或圖示) 。</span><span class="sxs-lookup"><span data-stu-id="4e30a-128">This API enables an application to specify a piece of text with complex characteristics such as different fonts and font sizes, underlines, strikethroughs, bi-directional text, effects, ellipsis and even embedded non-glyph characters (such as a bitmap emoticon or an icon).</span></span> <span data-ttu-id="4e30a-129">然後，應用程式可以變更文字的各種特性，因為它會反復地判斷其 UI 版面配置。</span><span class="sxs-lookup"><span data-stu-id="4e30a-129">The application can then change various characteristics of the text as it iteratively determines its UI layout.</span></span> <span data-ttu-id="4e30a-130">[DirectWrite Hello World 範例](/samples/browse/?redirectedfrom=MSDN-samples)（如下圖所示）和[教學課程：開始使用 with DirectWrite](/windows/desktop/DirectWrite/getting-started-with-directwrite)主題中顯示許多效果。</span><span class="sxs-lookup"><span data-stu-id="4e30a-130">The [DirectWrite Hello World Sample](/samples/browse/?redirectedfrom=MSDN-samples), which is shown in the following illustration and in the [Tutorial: Getting Started with DirectWrite](/windows/desktop/DirectWrite/getting-started-with-directwrite) topic, shows many of these effects.</span></span>

!["hello world" 範例的螢幕擷取畫面。](images/dwrite-hello-world.png)

<span data-ttu-id="4e30a-132">版面配置可以根據) WPF 的 (寬度，將字元放在理想的寬度，也可以將字元對齊到最接近的圖元位置 (，因為 [GDI](/windows/desktop/gdi/windows-gdi) 會) 。</span><span class="sxs-lookup"><span data-stu-id="4e30a-132">The layout can either position the glyphs ideally based on their widths (as WPF does), or it can snap the glyphs to the nearest pixel positions (as [GDI](/windows/desktop/gdi/windows-gdi) does).</span></span>

<span data-ttu-id="4e30a-133">除了取得文字度量之外，應用程式也可以點擊測試各部分的文字。</span><span class="sxs-lookup"><span data-stu-id="4e30a-133">In addition to obtaining text measurements, the application can hit test various parts of the text.</span></span> <span data-ttu-id="4e30a-134">例如，它可能會想要知道文字中的超連結已按一下。</span><span class="sxs-lookup"><span data-stu-id="4e30a-134">For example, it might want to know that a hyperlink in the text is clicked.</span></span> <span data-ttu-id="4e30a-135"> (如需點擊測試的詳細資訊，請參閱 [如何在文字版面配置上執行點擊測試](/windows/desktop/DirectWrite/how-to-perform-hit-testing-on-a-text-layout) 主題。 ) </span><span class="sxs-lookup"><span data-stu-id="4e30a-135">(For more information about hit testing, see the [How to Perform Hit Testing on a Text Layout](/windows/desktop/DirectWrite/how-to-perform-hit-testing-on-a-text-layout) topic.)</span></span>

<span data-ttu-id="4e30a-136">文字版面配置介面會與應用程式所使用的轉譯 API 分離，如下圖所示：</span><span class="sxs-lookup"><span data-stu-id="4e30a-136">The text layout interface is decoupled from the rendering API that the application uses, as the following diagram shows:</span></span>

![文字版面配置和圖形 api 圖表。](images/direct2d-directwrite1.png)

<span data-ttu-id="4e30a-138">這是可能的分隔，因為 DirectWrite 提供轉譯介面 ([**IDWriteTextRenderer**](/windows/desktop/api/dwrite/nn-dwrite-idwritetextrenderer)) ，應用程式可以使用您想要的任何圖形 API 來執行這些轉譯，以呈現文字。</span><span class="sxs-lookup"><span data-stu-id="4e30a-138">This separation is possible because DirectWrite provides a rendering interface ([**IDWriteTextRenderer**](/windows/desktop/api/dwrite/nn-dwrite-idwritetextrenderer)) that applications can implement to render text by using whatever graphics API you want.</span></span> <span data-ttu-id="4e30a-139">當轉譯文字配置時，DirectWrite 會呼叫 [**IDWriteTextRenderer：:D rawglyphrun**](/windows/desktop/api/dwrite/nf-dwrite-idwritetextrenderer-drawglyphrun) 回呼方法所執行的應用程式。</span><span class="sxs-lookup"><span data-stu-id="4e30a-139">The application implemented [**IDWriteTextRenderer::DrawGlyphRun**](/windows/desktop/api/dwrite/nf-dwrite-idwritetextrenderer-drawglyphrun) callback method is called by DirectWrite when rendering a text layout.</span></span> <span data-ttu-id="4e30a-140">這種方法必須負責執行繪圖作業或傳遞它們。</span><span class="sxs-lookup"><span data-stu-id="4e30a-140">It is the responsibility of this method to perform the drawing operations or pass them along.</span></span>

<span data-ttu-id="4e30a-141">針對繪圖字元， [Direct2D](./direct2d-portal.md) 提供了 [**ID2D1RenderTarget：:D rawglyphrun**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawglyphrun) 來繪製至 Direct2D 介面， [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) 則提供 [**IDWRITEBITMAPRENDERTARGET：:D rawglyphrun**](/windows/desktop/api/dwrite/nf-dwrite-idwritebitmaprendertarget-drawglyphrun) 來繪製至 gdi 介面，然後使用 gdi 將其傳送至視窗。</span><span class="sxs-lookup"><span data-stu-id="4e30a-141">For drawing glyphs, [Direct2D](./direct2d-portal.md) provides [**ID2D1RenderTarget::DrawGlyphRun**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawglyphrun) for drawing to a Direct2D surface and [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) provides [**IDWriteBitmapRenderTarget::DrawGlyphRun**](/windows/desktop/api/dwrite/nf-dwrite-idwritebitmaprendertarget-drawglyphrun) for drawing to a GDI surface that can then be transferred to a window by using GDI.</span></span> <span data-ttu-id="4e30a-142">簡單地來說，Direct2D 和 DirectWrite 中的 **DrawGlyphRun** 與應用程式在 [**IDWriteTextRenderer**](/windows/desktop/api/dwrite/nn-dwrite-idwritetextrenderer)上執行的 [**DrawGlyphRun**](/windows/desktop/api/dwrite/nf-dwrite-idwritetextrenderer-drawglyphrun)方法都有完全相容的參數。</span><span class="sxs-lookup"><span data-stu-id="4e30a-142">Conveniently, **DrawGlyphRun** in both Direct2D and DirectWrite have exactly compatible parameters to the [**DrawGlyphRun**](/windows/desktop/api/dwrite/nf-dwrite-idwritetextrenderer-drawglyphrun) method that the application implements on [**IDWriteTextRenderer**](/windows/desktop/api/dwrite/nn-dwrite-idwritetextrenderer).</span></span>

<span data-ttu-id="4e30a-143">遵循類似的分隔、文字特定功能 (例如，字型列舉和管理、圖像分析等等) 是由 [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) 處理，而不是 [Direct2D](./direct2d-portal.md)。</span><span class="sxs-lookup"><span data-stu-id="4e30a-143">Following a similar separation, text-specific features (such as font enumeration and management, glyph analysis, and so on) are handled by [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) instead of [Direct2D](./direct2d-portal.md).</span></span> <span data-ttu-id="4e30a-144">Direct2D 會直接接受 DirectWrite 物件。</span><span class="sxs-lookup"><span data-stu-id="4e30a-144">The DirectWrite objects are accepted directly by Direct2D.</span></span> <span data-ttu-id="4e30a-145">為了協助現有的 GDI 應用程式利用 DirectWrite，它提供了 [**IDWriteGdiInterop**](/windows/desktop/api/dwrite/nn-dwrite-idwritegdiinterop) 方法介面和方法來執行下列作業：</span><span class="sxs-lookup"><span data-stu-id="4e30a-145">To help existing GDI applications to take advantage of DirectWrite, it provides the [**IDWriteGdiInterop**](/windows/desktop/api/dwrite/nn-dwrite-idwritegdiinterop) method interface with methods to do the following:</span></span>

-   <span data-ttu-id="4e30a-146">從 [GDI](/windows/desktop/gdi/windows-gdi)邏輯字型建立 [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal)字型， ([**CreateFontFromLOGFONT**](/windows/desktop/api/dwrite/nf-dwrite-idwritegdiinterop-createfontfromlogfont)) 。</span><span class="sxs-lookup"><span data-stu-id="4e30a-146">Create a [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) Font from a [GDI](/windows/desktop/gdi/windows-gdi) Logical Font ([**CreateFontFromLOGFONT**](/windows/desktop/api/dwrite/nf-dwrite-idwritegdiinterop-createfontfromlogfont)).</span></span>
-   <span data-ttu-id="4e30a-147">從 [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) 字型字型轉換成 [GDI](/windows/desktop/gdi/windows-gdi) 邏輯字型 ([**ConvertFontFaceToLOGFONT**](/windows/desktop/api/dwrite/nf-dwrite-idwritegdiinterop-convertfontfacetologfont)) 。</span><span class="sxs-lookup"><span data-stu-id="4e30a-147">Convert from a [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) Font Face to a [GDI](/windows/desktop/gdi/windows-gdi) Logical Font ([**ConvertFontFaceToLOGFONT**](/windows/desktop/api/dwrite/nf-dwrite-idwritegdiinterop-convertfontfacetologfont)).</span></span>
-   <span data-ttu-id="4e30a-148">從選取至 HDC 的字型中取出 [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) 字型。</span><span class="sxs-lookup"><span data-stu-id="4e30a-148">Retrieve the [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) Font Face from the one that is selected into an HDC.</span></span> <span data-ttu-id="4e30a-149"> ([**CreateFontFaceFromHdc**](/windows/desktop/api/dwrite/nf-dwrite-idwritegdiinterop-createfontfacefromhdc)) </span><span class="sxs-lookup"><span data-stu-id="4e30a-149">([**CreateFontFaceFromHdc**](/windows/desktop/api/dwrite/nf-dwrite-idwritegdiinterop-createfontfacefromhdc))</span></span>
-   <span data-ttu-id="4e30a-150">在 system memory ([**CreateBitmapRenderTarget**](/windows/desktop/api/dwrite/nf-dwrite-idwritegdiinterop-createbitmaprendertarget)) 中建立 [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) [**點陣圖呈現目標**](/windows/desktop/api/dwrite/nn-dwrite-idwritebitmaprendertarget)。</span><span class="sxs-lookup"><span data-stu-id="4e30a-150">Create a [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) [**bitmap render target**](/windows/desktop/api/dwrite/nn-dwrite-idwritebitmaprendertarget) in system memory ([**CreateBitmapRenderTarget**](/windows/desktop/api/dwrite/nf-dwrite-idwritegdiinterop-createbitmaprendertarget)).</span></span>

## <a name="glyphs-versus-text"></a><span data-ttu-id="4e30a-151">字型與文字</span><span class="sxs-lookup"><span data-stu-id="4e30a-151">Glyphs versus Text</span></span>

<span data-ttu-id="4e30a-152">文字是一組 Unicode 程式碼點 (字元) ，其中包含各種樣式修飾詞 (字型、權數、底線、strikethroughs，以及在矩形中配置的) 。</span><span class="sxs-lookup"><span data-stu-id="4e30a-152">Text is a set of Unicode code points (characters), with various stylistic modifiers (fonts, weights, underlines, strikethroughs, and so on) that is laid out in a rectangle.</span></span> <span data-ttu-id="4e30a-153">相反地，字型是特定字型檔案的特定索引。</span><span class="sxs-lookup"><span data-stu-id="4e30a-153">A glyph, in contrast, is a particular index into a particular font file.</span></span> <span data-ttu-id="4e30a-154">圖像會定義一組可以呈現的曲線，但它沒有任何文字意義。</span><span class="sxs-lookup"><span data-stu-id="4e30a-154">A glyph defines a set of curves which can be rendered, but, it doesn't have any textual meaning.</span></span> <span data-ttu-id="4e30a-155">字元和字元之間可能有多對多對應。</span><span class="sxs-lookup"><span data-stu-id="4e30a-155">There is potentially a many-to-many mapping between glyphs and characters.</span></span> <span data-ttu-id="4e30a-156">來自相同字型且在基準上依序排列的字元序列，稱為 [GlyphRun](/windows/desktop/DirectWrite/glyphs-and-glyph-runs)。</span><span class="sxs-lookup"><span data-stu-id="4e30a-156">A sequence of glyphs that come from the same Font Face and that are laid-out sequentially on a baseline is called a [GlyphRun](/windows/desktop/DirectWrite/glyphs-and-glyph-runs).</span></span> <span data-ttu-id="4e30a-157">[DirectWrite](/windows/desktop/DirectWrite/direct-write-portal)和 [Direct2D](./direct2d-portal.md)都會呼叫其最精確的圖像轉譯 API [**DrawGlyphRun**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawglyphrun) ，而且其簽章非常類似。</span><span class="sxs-lookup"><span data-stu-id="4e30a-157">Both [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) and [Direct2D](./direct2d-portal.md) call their most precise glyph rendering API [**DrawGlyphRun**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawglyphrun) and they have very similar signatures.</span></span> <span data-ttu-id="4e30a-158">以下是來自 Direct2D 的 [**ID2D1RenderTarget**](/windows/win32/api/d2d1/nn-d2d1-id2d1rendertarget) ：</span><span class="sxs-lookup"><span data-stu-id="4e30a-158">The following is from [**ID2D1RenderTarget**](/windows/win32/api/d2d1/nn-d2d1-id2d1rendertarget) in Direct2D:</span></span>


```
STDMETHOD_(void, DrawGlyphRun)(
        D2D1_POINT_2F baselineOrigin,
        __in CONST DWRITE_GLYPH_RUN *glyphRun,
        __in ID2D1Brush *foregroundBrush,
        DWRITE_MEASURING_MODE measuringMode = DWRITE_MEASURING_MODE_NATURAL 
        ) PURE;
```



<span data-ttu-id="4e30a-159">而這個方法來自 [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal)中的 [**IDWriteBitmapRenderTarget**](/windows/desktop/api/dwrite/nn-dwrite-idwritebitmaprendertarget) ：</span><span class="sxs-lookup"><span data-stu-id="4e30a-159">And this method is from [**IDWriteBitmapRenderTarget**](/windows/desktop/api/dwrite/nn-dwrite-idwritebitmaprendertarget) in [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal):</span></span>


```
STDMETHOD(DrawGlyphRun)(
        FLOAT baselineOriginX,
        FLOAT baselineOriginY,
        DWRITE_MEASURING_MODE measuringMode,
        __in DWRITE_GLYPH_RUN const* glyphRun,
        IDWriteRenderingParams* renderingParams,
        COLORREF textColor,
        __out_opt RECT* blackBoxRect = NULL
        ) PURE;
```



<span data-ttu-id="4e30a-160">[DirectWrite](/windows/desktop/DirectWrite/direct-write-portal)版本會保留基準來源、測量模式和圖像執行參數，並包含額外的參數。</span><span class="sxs-lookup"><span data-stu-id="4e30a-160">The [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) version keeps the baseline origin, measuring mode and the glyph run parameters and includes additional parameters.</span></span>

<span data-ttu-id="4e30a-161">[DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) 也可讓您藉由執行 [**IDWriteTextRenderer**](/windows/desktop/api/dwrite/nn-dwrite-idwritetextrenderer) 介面，為圖像使用自訂轉譯器。</span><span class="sxs-lookup"><span data-stu-id="4e30a-161">[DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) also enables you to use a custom renderer for glyphs by implementing the [**IDWriteTextRenderer**](/windows/desktop/api/dwrite/nn-dwrite-idwritetextrenderer) interface.</span></span> <span data-ttu-id="4e30a-162">此介面也有 **DrawGlyphRun** 方法，如下列程式碼範例所示。</span><span class="sxs-lookup"><span data-stu-id="4e30a-162">This interface also has a **DrawGlyphRun** method, as the following code example shows.</span></span>


```
STDMETHOD(DrawGlyphRun)(
        __maybenull void* clientDrawingContext,
        FLOAT baselineOriginX,
        FLOAT baselineOriginY,
        DWRITE_MEASURING_MODE measuringMode,
        __in DWRITE_GLYPH_RUN const* glyphRun,
        __in DWRITE_GLYPH_RUN_DESCRIPTION const* glyphRunDescription,
        __maybenull IUnknown* clientDrawingEffect
        ) PURE;
```



<span data-ttu-id="4e30a-163">此版本包含更多在您執行 [自訂文字](/windows/desktop/DirectWrite/how-to-implement-a-custom-text-renderer)轉譯器時很有用的參數。</span><span class="sxs-lookup"><span data-stu-id="4e30a-163">This version includes more parameters that are useful when you implement a [custom text renderer](/windows/desktop/DirectWrite/how-to-implement-a-custom-text-renderer).</span></span> <span data-ttu-id="4e30a-164">最後一個參數會用於應用程式所執行的自訂繪製效果。</span><span class="sxs-lookup"><span data-stu-id="4e30a-164">The final parameter is used for application-implemented custom drawing effects.</span></span> <span data-ttu-id="4e30a-165"> (如需有關用戶端繪製效果的詳細資訊，請參閱 [如何將用戶端繪製效果新增至文字版面](/windows/desktop/DirectWrite/how-to-add-custom-drawing-efffects-to-a-text-layout)配置。</span><span class="sxs-lookup"><span data-stu-id="4e30a-165">(For more information about client drawing effects see [How to Add Client Drawing Effects to a Text Layout](/windows/desktop/DirectWrite/how-to-add-custom-drawing-efffects-to-a-text-layout).</span></span>

<span data-ttu-id="4e30a-166">每個圖像執行會從原點開始，並放在從這個原點開始的行。</span><span class="sxs-lookup"><span data-stu-id="4e30a-166">Each glyph run starts at an origin and is put on a line starting from this origin.</span></span> <span data-ttu-id="4e30a-167">圖像會由目前的世界轉換以及相關聯轉譯目標上選取的文字轉譯設定進行變更。</span><span class="sxs-lookup"><span data-stu-id="4e30a-167">The glyphs are changed by the current world transform and the selected text rendering settings on the associated render target.</span></span> <span data-ttu-id="4e30a-168">此 API 通常只會由執行其專屬配置的應用程式直接呼叫 (例如，字處理器) 或已執行 [**IDWriteTextRenderer**](/windows/desktop/api/dwrite/nn-dwrite-idwritetextrenderer) 介面的應用程式。</span><span class="sxs-lookup"><span data-stu-id="4e30a-168">This API is generally called directly only by applications that do their own layout (For example a Word Processor) or by an application that has implemented the [**IDWriteTextRenderer**](/windows/desktop/api/dwrite/nn-dwrite-idwritetextrenderer) interface.</span></span>

## <a name="directwrite-and-direct2d"></a><span data-ttu-id="4e30a-169">DirectWrite 和 Direct2D</span><span class="sxs-lookup"><span data-stu-id="4e30a-169">DirectWrite and Direct2D</span></span>

<span data-ttu-id="4e30a-170">[Direct2D](./direct2d-portal.md) 透過 [**DrawGlyphRun**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawglyphrun)提供圖像層級轉譯服務。</span><span class="sxs-lookup"><span data-stu-id="4e30a-170">[Direct2D](./direct2d-portal.md) provides glyph level rendering services through [**DrawGlyphRun**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawglyphrun).</span></span> <span data-ttu-id="4e30a-171">不過，這需要應用程式執行轉譯的詳細資料，這基本上會從 GDI 自行重現 [**DrawText**](/windows/desktop/api/winuser/nf-winuser-drawtext) API 的功能。</span><span class="sxs-lookup"><span data-stu-id="4e30a-171">However, this requires the application to implement the details of rendering, which basically reproduces the functionality of the [**DrawText**](/windows/desktop/api/winuser/nf-winuser-drawtext) API from GDI on its own.</span></span>

<span data-ttu-id="4e30a-172">因此， [Direct2D](./direct2d-portal.md) 會提供接受文字而非字元的 Api： [**ID2D1RenderTarget：:D rawtextlayout**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtextlayout) 和 [**ID2D1RenderTarget：:D rawtext**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtext(constwchar_uint32_idwritetextformat_constd2d1_rect_f__id2d1brush_d2d1_draw_text_options_dwrite_measuring_mode))。</span><span class="sxs-lookup"><span data-stu-id="4e30a-172">Therefore, [Direct2D](./direct2d-portal.md) provides APIs that accept text instead of glyphs: [**ID2D1RenderTarget::DrawTextLayout**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtextlayout) and [**ID2D1RenderTarget::DrawText**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtext(constwchar_uint32_idwritetextformat_constd2d1_rect_f__id2d1brush_d2d1_draw_text_options_dwrite_measuring_mode)).</span></span> <span data-ttu-id="4e30a-173">這兩種方法都會轉譯為 Direct2D 介面。</span><span class="sxs-lookup"><span data-stu-id="4e30a-173">Both methods render to a Direct2D surface.</span></span> <span data-ttu-id="4e30a-174">若要轉譯成 GDI 介面，請 [**IDWriteBitmapRenderTarget：提供:D rawglyphrun**](/windows/desktop/api/dwrite/nf-dwrite-idwritebitmaprendertarget-drawglyphrun) 。</span><span class="sxs-lookup"><span data-stu-id="4e30a-174">To render to a GDI surface, [**IDWriteBitmapRenderTarget::DrawGlyphRun**](/windows/desktop/api/dwrite/nf-dwrite-idwritebitmaprendertarget-drawglyphrun) is provided.</span></span> <span data-ttu-id="4e30a-175">但是，這個方法需要應用程式執行自訂文字轉譯器。</span><span class="sxs-lookup"><span data-stu-id="4e30a-175">But this method requires a custom text renderer to be implemented by the application.</span></span> <span data-ttu-id="4e30a-176"> (需詳細資訊，請參閱轉譯 [為 GDI 介面](/windows/desktop/DirectWrite/render-to-a-gdi-surface) 主題。 ) </span><span class="sxs-lookup"><span data-stu-id="4e30a-176">(For more information, see the [Render to a GDI Surface](/windows/desktop/DirectWrite/render-to-a-gdi-surface) topic.)</span></span>

<span data-ttu-id="4e30a-177">應用程式的文字使用方式通常會啟動簡單：例如，在固定配置按鈕上放置 **[確定] 或 [** **取消** ]。</span><span class="sxs-lookup"><span data-stu-id="4e30a-177">An application's usage of text typically starts simple: put **OK** or **Cancel** on a fixed-layout button, for example.</span></span> <span data-ttu-id="4e30a-178">不過，隨著時間的增加，隨著國際化和其他功能的新增，它會變得更複雜。</span><span class="sxs-lookup"><span data-stu-id="4e30a-178">However, over time, it becomes more complex as internationalization and other features are added.</span></span> <span data-ttu-id="4e30a-179">最後，許多應用程式都必須使用 [DirectWrite 的](/windows/desktop/DirectWrite/direct-write-portal) 文字版面設定物件並執行文字轉譯器。</span><span class="sxs-lookup"><span data-stu-id="4e30a-179">Eventually many applications will have to use [DirectWrite's](/windows/desktop/DirectWrite/direct-write-portal) text layout objects and implement the text renderer.</span></span>

<span data-ttu-id="4e30a-180">因此， [Direct2D](./direct2d-portal.md) 提供多層式 api，可讓應用程式輕鬆啟動，而不需要再追蹤或放棄其工作程式碼。</span><span class="sxs-lookup"><span data-stu-id="4e30a-180">Therefore, [Direct2D](./direct2d-portal.md) provides layered APIs that enable an application to start simply and grow more sophisticated without having to back-track or abandon their working code.</span></span> <span data-ttu-id="4e30a-181">簡化的視圖如下圖所示：</span><span class="sxs-lookup"><span data-stu-id="4e30a-181">A simplified view is shown in the following diagram:</span></span>

![directwrite 和 direct2d 應用程式圖表。](images/direct2d-directwrite2.png)

### <a name="drawtext"></a><span data-ttu-id="4e30a-183">DrawText</span><span class="sxs-lookup"><span data-stu-id="4e30a-183">DrawText</span></span>

<span data-ttu-id="4e30a-184">[**DrawText**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtext(constwchar_uint32_idwritetextformat_constd2d1_rect_f__id2d1brush_d2d1_draw_text_options_dwrite_measuring_mode)) 是最簡單的 api 使用方式。</span><span class="sxs-lookup"><span data-stu-id="4e30a-184">[**DrawText**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtext(constwchar_uint32_idwritetextformat_constd2d1_rect_f__id2d1brush_d2d1_draw_text_options_dwrite_measuring_mode)) is the simplest of the APIs to use.</span></span> <span data-ttu-id="4e30a-185">它會採用 Unicode 字串、前景筆刷、單一格式物件和目的地矩形。</span><span class="sxs-lookup"><span data-stu-id="4e30a-185">It takes a Unicode string, a foreground brush, a single format object and a destination rectangle.</span></span> <span data-ttu-id="4e30a-186">它會在版面配置矩形內配置並轉譯整個字串，並選擇性地將其裁剪。</span><span class="sxs-lookup"><span data-stu-id="4e30a-186">It will lay out and render the whole string within the layout rectangle, and optionally clip it.</span></span> <span data-ttu-id="4e30a-187">當您在固定配置 UI 中放入一段簡單的文字時，這會很有用。</span><span class="sxs-lookup"><span data-stu-id="4e30a-187">This is useful when you put a simple piece of text in a piece of fixed-layout UI.</span></span>

### <a name="drawtextlayout"></a><span data-ttu-id="4e30a-188">DrawTextLayout</span><span class="sxs-lookup"><span data-stu-id="4e30a-188">DrawTextLayout</span></span>

<span data-ttu-id="4e30a-189">藉由建立 [**IDWriteTextLayout**](/windows/desktop/api/dwrite/nn-dwrite-idwritetextlayout) 物件，應用程式就可以開始測量和排列文字和其他 UI 專案，並支援多個字型、樣式、底線和 strikethroughs。</span><span class="sxs-lookup"><span data-stu-id="4e30a-189">By creating an [**IDWriteTextLayout**](/windows/desktop/api/dwrite/nn-dwrite-idwritetextlayout) object, an application can start measuring and arranging the text and other UI elements, and support multiple fonts, styles, underlines and strikethroughs.</span></span> <span data-ttu-id="4e30a-190">[Direct2D](./direct2d-portal.md) 提供的 [**DrawTextLayout**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtextlayout) API 可直接接受此物件，並在指定的點轉譯文字。</span><span class="sxs-lookup"><span data-stu-id="4e30a-190">[Direct2D](./direct2d-portal.md) provides the [**DrawTextLayout**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtextlayout) API that directly accepts this object and renders the text at a given point.</span></span> <span data-ttu-id="4e30a-191"> (寬度和高度是由版面設定物件) 所提供。</span><span class="sxs-lookup"><span data-stu-id="4e30a-191">(The width and height are provided by the layout object).</span></span> <span data-ttu-id="4e30a-192">除了執行所有預期的文字版面配置功能之外，Direct2D 還會將任何效果物件轉譯為筆刷，並將該筆刷套用至選取的字元範圍。</span><span class="sxs-lookup"><span data-stu-id="4e30a-192">In addition to implementing all the expected text layout features, Direct2D will interpret any effect object as a brush and apply that brush to the selected range of glyphs.</span></span> <span data-ttu-id="4e30a-193">它也會呼叫任何内嵌物件。</span><span class="sxs-lookup"><span data-stu-id="4e30a-193">It will also call any inline objects.</span></span> <span data-ttu-id="4e30a-194">然後，應用程式就可以將非字元字元插入 (圖示，並) 到文字中。</span><span class="sxs-lookup"><span data-stu-id="4e30a-194">An application can then insert non-glyph characters (icons) into the text if it wishes.</span></span> <span data-ttu-id="4e30a-195">使用文字版面設定物件的另一個優點是，圖像位置會快取在其中。</span><span class="sxs-lookup"><span data-stu-id="4e30a-195">Another advantage of using a text layout object is that the glyph positions are cached in it.</span></span> <span data-ttu-id="4e30a-196">因此，您可以針對多個繪製呼叫重複使用相同的版面設定物件，以避免重新計算每個呼叫的圖像位置，以大幅提升效能。</span><span class="sxs-lookup"><span data-stu-id="4e30a-196">Therefore, a large performance gain is possible by reusing the same layout object for multiple draw calls and avoiding recalculating the glyph positions for each call.</span></span> <span data-ttu-id="4e30a-197">這項功能不會出現在 GDI 的 [**DrawText**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtext(constwchar_uint32_idwritetextformat_constd2d1_rect_f__id2d1brush_d2d1_draw_text_options_dwrite_measuring_mode))中。</span><span class="sxs-lookup"><span data-stu-id="4e30a-197">This capability is not present for GDI's [**DrawText**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtext(constwchar_uint32_idwritetextformat_constd2d1_rect_f__id2d1brush_d2d1_draw_text_options_dwrite_measuring_mode)).</span></span>

### <a name="drawglyphrun"></a><span data-ttu-id="4e30a-198">DrawGlyphRun</span><span class="sxs-lookup"><span data-stu-id="4e30a-198">DrawGlyphRun</span></span>

<span data-ttu-id="4e30a-199">最後，應用程式可以執行 [**IDWriteTextRenderer**](/windows/desktop/api/dwrite/nn-dwrite-idwritetextrenderer) 介面本身，並呼叫 [**DrawGlyphRun**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawglyphrun) 和 [**graphicswindow.fillrectangle**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-fillrectangle(constd2d1_rect_f_id2d1brush)) 本身，或任何其他轉譯 API。</span><span class="sxs-lookup"><span data-stu-id="4e30a-199">Finally, the application can implement the [**IDWriteTextRenderer**](/windows/desktop/api/dwrite/nn-dwrite-idwritetextrenderer) interface itself and call [**DrawGlyphRun**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawglyphrun) and [**FillRectangle**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-fillrectangle(constd2d1_rect_f_id2d1brush)) itself, or any other rendering API.</span></span> <span data-ttu-id="4e30a-200">所有與文字版面設定物件的現有互動都會保持不變。</span><span class="sxs-lookup"><span data-stu-id="4e30a-200">All the existing interaction with the Text Layout object will remain unchanged.</span></span>

<span data-ttu-id="4e30a-201">如需如何執行自訂文字轉譯器的範例，請參閱 [使用自訂文字](/windows/desktop/DirectWrite/how-to-implement-a-custom-text-renderer) 轉譯器的轉譯主題。</span><span class="sxs-lookup"><span data-stu-id="4e30a-201">For an example of how to implement a custom text renderer see the [Render Using a Custom Text Renderer](/windows/desktop/DirectWrite/how-to-implement-a-custom-text-renderer) topic.</span></span>

## <a name="glyph-rendering"></a><span data-ttu-id="4e30a-202">圖像呈現</span><span class="sxs-lookup"><span data-stu-id="4e30a-202">Glyph Rendering</span></span>

<span data-ttu-id="4e30a-203">將 [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) 新增至現有的 GDI 應用程式，可讓應用程式使用 [**IDWriteBitmapRenderTarget**](/windows/desktop/api/dwrite/nn-dwrite-idwritebitmaprendertarget) API 來轉譯圖像。</span><span class="sxs-lookup"><span data-stu-id="4e30a-203">Adding [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) to an existing GDI application enables the application to use the [**IDWriteBitmapRenderTarget**](/windows/desktop/api/dwrite/nn-dwrite-idwritebitmaprendertarget) API to render glyphs.</span></span> <span data-ttu-id="4e30a-204">DirectWrite 提供的 [**IDWriteBitmapRenderTarget：:D rawglyphrun**](/windows/desktop/api/dwrite/nf-dwrite-idwritebitmaprendertarget-drawglyphrun) 方法將以純色呈現給記憶體 DC，而不需要任何額外的 api，例如 [Direct2D](./direct2d-portal.md)。</span><span class="sxs-lookup"><span data-stu-id="4e30a-204">The [**IDWriteBitmapRenderTarget::DrawGlyphRun**](/windows/desktop/api/dwrite/nf-dwrite-idwritebitmaprendertarget-drawglyphrun) method that DirectWrite provides will render in solid color to a memory DC without requiring any additional APIs, such as [Direct2D](./direct2d-portal.md).</span></span>

<span data-ttu-id="4e30a-205">這可讓應用程式取得 advanced text 轉譯功能，如下所示：</span><span class="sxs-lookup"><span data-stu-id="4e30a-205">This enables the application to obtain advanced text rendering features such as the following:</span></span>

-   <span data-ttu-id="4e30a-206">子圖元 ClearType 可讓應用程式將字元放在子圖元位置，以允許清晰的圖像呈現和圖像版面配置。</span><span class="sxs-lookup"><span data-stu-id="4e30a-206">Sub-pixel ClearType enables an application to put glyphs on sub-pixel positions to allow for both sharp glyph rendering and glyph layout.</span></span>
-   <span data-ttu-id="4e30a-207">Y 方向消除鋸齒讓在較大的圖像上呈現曲線更為順暢。</span><span class="sxs-lookup"><span data-stu-id="4e30a-207">Y-direction antialiasing enables smoother rendering of curves on larger glyphs.</span></span>

<span data-ttu-id="4e30a-208">移至 [Direct2D](./direct2d-portal.md) 的應用程式也會取得下列功能：</span><span class="sxs-lookup"><span data-stu-id="4e30a-208">An application moving to [Direct2D](./direct2d-portal.md) will also obtain the following features:</span></span>

-   <span data-ttu-id="4e30a-209">硬體加速：</span><span class="sxs-lookup"><span data-stu-id="4e30a-209">Hardware acceleration.</span></span>
-   <span data-ttu-id="4e30a-210">使用任意 [Direct2D](./direct2d-portal.md) 筆刷（例如星形漸層、線性漸層和點陣圖）填滿文字的功能。</span><span class="sxs-lookup"><span data-stu-id="4e30a-210">The ability to fill text with an arbitrary [Direct2D](./direct2d-portal.md) brush, such as radial gradients, linear gradients, and bitmaps.</span></span>
-   <span data-ttu-id="4e30a-211">更多支援透過 [**PushAxisAlignedClip**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-pushaxisalignedclip(constd2d1_rect_f__d2d1_antialias_mode))、 [**PushLayer**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-pushlayer(constd2d1_layer_parameters__id2d1layer)) 和 [**CreateCompatibleRenderTarget**](/windows/desktop/api/d2d1/nf-d2d1-id2d1rendertarget-createcompatiblerendertarget(id2d1bitmaprendertarget)) api 進行分層和裁剪。</span><span class="sxs-lookup"><span data-stu-id="4e30a-211">More support for layering and clipping through the [**PushAxisAlignedClip**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-pushaxisalignedclip(constd2d1_rect_f__d2d1_antialias_mode)), [**PushLayer**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-pushlayer(constd2d1_layer_parameters__id2d1layer)) and [**CreateCompatibleRenderTarget**](/windows/desktop/api/d2d1/nf-d2d1-id2d1rendertarget-createcompatiblerendertarget(id2d1bitmaprendertarget)) APIs.</span></span>
-   <span data-ttu-id="4e30a-212">支援灰階文字轉譯的能力。</span><span class="sxs-lookup"><span data-stu-id="4e30a-212">The ability to support Grayscale text rendering.</span></span> <span data-ttu-id="4e30a-213">這會根據文字筆刷的不透明度和文字的消除鋸齒，正確地填入目的地 Alpha 通道。</span><span class="sxs-lookup"><span data-stu-id="4e30a-213">This correctly populates the destination alpha channel according to both the text brush opacity and the antialiasing of the text.</span></span>

<span data-ttu-id="4e30a-214">為了有效率地支援硬體加速， [Direct2D](./direct2d-portal.md) 會使用稍微不同的近似值來進行 Gamma 更正，稱為「 *Alpha 更正*」。</span><span class="sxs-lookup"><span data-stu-id="4e30a-214">To efficiently support hardware acceleration, [Direct2D](./direct2d-portal.md) uses a slightly different approximation to Gamma correction called *alpha correction*.</span></span> <span data-ttu-id="4e30a-215">這並不需要 Direct2D，就能在轉譯文字時檢查呈現目標色彩圖元。</span><span class="sxs-lookup"><span data-stu-id="4e30a-215">This does not require Direct2D to inspect the render target color pixel when rendering text.</span></span>

## <a name="conclusion"></a><span data-ttu-id="4e30a-216">結論</span><span class="sxs-lookup"><span data-stu-id="4e30a-216">Conclusion</span></span>

<span data-ttu-id="4e30a-217">本主題說明 [Direct2D](./direct2d-portal.md) 與 [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) 之間的差異和相似性，以及提供它們作為個別合作 api 的架構動機。</span><span class="sxs-lookup"><span data-stu-id="4e30a-217">This topic explains the differences and similarities between [Direct2D](./direct2d-portal.md) and [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) and the architectural motivations for providing them as separate, cooperative APIs.</span></span>

 

 