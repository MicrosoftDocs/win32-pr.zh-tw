---
description: 為了提供文字對齊，應用程式可以使用兩種方法的其中一種。
ms.assetid: 1190baed-5959-4f7a-8946-ac3b3da85821
title: 處理複雜的腳本
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 87bea5b75e87afc4177b03c03f4263ba2592a0e0
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104026179"
---
# <a name="processing-complex-scripts"></a><span data-ttu-id="1996c-103">處理複雜的腳本</span><span class="sxs-lookup"><span data-stu-id="1996c-103">Processing Complex Scripts</span></span>

<span data-ttu-id="1996c-104">為了提供文字對齊，應用程式可以使用兩種方法的其中一種。</span><span class="sxs-lookup"><span data-stu-id="1996c-104">To provide text justification, an application can use one of two methods.</span></span> <span data-ttu-id="1996c-105">為了簡單執行多語系的理由，應用程式應該呼叫 [**ScriptJustify**](/windows/desktop/api/Usp10/nf-usp10-scriptjustify)。</span><span class="sxs-lookup"><span data-stu-id="1996c-105">For a simple implementation of multilingual justification, the application should call [**ScriptJustify**](/windows/desktop/api/Usp10/nf-usp10-scriptjustify).</span></span> <span data-ttu-id="1996c-106">它會藉由考慮 kashida、interword 間距及 intercharacter 間距來產生 delta dx 陣列。</span><span class="sxs-lookup"><span data-stu-id="1996c-106">It generates the delta dx array by considering kashida, then interword spacing, and then intercharacter spacing.</span></span> <span data-ttu-id="1996c-107">為了更精密的理由，應用程式可以使用自己的語言知識，以及 [**腳本 \_ VISATTR**](/windows/win32/api/usp10/ns-usp10-script_visattr)陣列中 [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape)抓取的資訊，來產生更新的 delta dx 陣列。</span><span class="sxs-lookup"><span data-stu-id="1996c-107">For more sophisticated justification, the application can generate an updated delta dx array using its own language knowledge and the information retrieved by [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) in the [**SCRIPT\_VISATTR**](/windows/win32/api/usp10/ns-usp10-script_visattr) array.</span></span>

<span data-ttu-id="1996c-108">應該插入對齊空間或 kashida，在 [**腳本 \_ VISATTR**](/windows/win32/api/usp10/ns-usp10-script_visattr)的 **uJustification** 成員所識別的位置。</span><span class="sxs-lookup"><span data-stu-id="1996c-108">Justification space or kashida should be inserted where identified by the **uJustification** member of [**SCRIPT\_VISATTR**](/windows/win32/api/usp10/ns-usp10-script_visattr).</span></span> <span data-ttu-id="1996c-109">執行字元間對齊時，應用程式應該只在標記有腳本對齊字元的字元之後插入額外的空間 \_ \_ 。</span><span class="sxs-lookup"><span data-stu-id="1996c-109">When performing inter-character justification, the application should insert extra space only after glyphs marked with SCRIPT\_JUSTIFY\_CHARACTER.</span></span>

<span data-ttu-id="1996c-110">應用程式會使用 [**ScriptXtoCP**](/windows/desktop/api/Usp10/nf-usp10-scriptxtocp) 和 [**ScriptCPtoX**](/windows/desktop/api/Usp10/nf-usp10-scriptcptox)進行插入號放置和點擊測試。</span><span class="sxs-lookup"><span data-stu-id="1996c-110">The application does caret placement and hit testing by using [**ScriptXtoCP**](/windows/desktop/api/Usp10/nf-usp10-scriptxtocp) and [**ScriptCPtoX**](/windows/desktop/api/Usp10/nf-usp10-scriptcptox).</span></span> <span data-ttu-id="1996c-111">如需詳細資訊，請參閱 [管理插入點放置和點擊測試](managing-caret-placement-and-hit-testing.md)。</span><span class="sxs-lookup"><span data-stu-id="1996c-111">For more information, see [Managing Caret Placement and Hit Testing](managing-caret-placement-and-hit-testing.md).</span></span>

<span data-ttu-id="1996c-112">若要以與字型無關的方式取得寬度，應用程式會呼叫 [**ScriptGetLogicalWidths**](/windows/desktop/api/Usp10/nf-usp10-scriptgetlogicalwidths)。</span><span class="sxs-lookup"><span data-stu-id="1996c-112">To get widths in a font-independent manner, the application calls [**ScriptGetLogicalWidths**](/windows/desktop/api/Usp10/nf-usp10-scriptgetlogicalwidths).</span></span> <span data-ttu-id="1996c-113">藉由將邏輯寬度傳遞給 [**ScriptApplyLogicalWidth**](/windows/desktop/api/Usp10/nf-usp10-scriptapplylogicalwidth)，即使原始字型無法使用，也可以在相同的界限內重新顯示一段文字，但仍可接受品質的損失。</span><span class="sxs-lookup"><span data-stu-id="1996c-113">By passing the logical widths to [**ScriptApplyLogicalWidth**](/windows/desktop/api/Usp10/nf-usp10-scriptapplylogicalwidth), a block of text can be redisplayed in the same boundaries with acceptable loss of quality even when the original font is not available.</span></span> <span data-ttu-id="1996c-114">它會產生字元寬度的陣列 ([進寬度](uniscribe-glossary.md)) 適合傳遞至 [**ScriptTextOut**](/windows/desktop/api/Usp10/nf-usp10-scripttextout)。</span><span class="sxs-lookup"><span data-stu-id="1996c-114">It generates an array of glyph widths ([advance widths](uniscribe-glossary.md)) suitable for passing to [**ScriptTextOut**](/windows/desktop/api/Usp10/nf-usp10-scripttextout).</span></span> <span data-ttu-id="1996c-115">以與字型無關的方式錄製和重新套用前進寬度資訊，會在以應用程式定義格式 metafiling 的情況下很有用。</span><span class="sxs-lookup"><span data-stu-id="1996c-115">Such recording and reapplying of advance width information in a font-independent manner can be useful in situations such as metafiling in an application defined format.</span></span>

> [!Note]  
> <span data-ttu-id="1996c-116">中繼檔不支援圖像索引。</span><span class="sxs-lookup"><span data-stu-id="1996c-116">Metafiles do not support glyph indexes.</span></span> <span data-ttu-id="1996c-117">若要寫入至增強型中繼檔，應用程式應該使用 [**ExtTextOut**](/windows/win32/api/wingdi/nf-wingdi-exttextouta) 並直接寫入邏輯字元。</span><span class="sxs-lookup"><span data-stu-id="1996c-117">To write to an enhanced metafile, the application should use [**ExtTextOut**](/windows/win32/api/wingdi/nf-wingdi-exttextouta) and write the logical characters directly.</span></span> <span data-ttu-id="1996c-118">使用這種機制，在播放文字之前，不會發生圖像產生和放置。</span><span class="sxs-lookup"><span data-stu-id="1996c-118">Using this mechanism, the glyph generation and placement does not occur until the text is played back.</span></span>

 

<span data-ttu-id="1996c-119">若要針對目前的字型取出預設、空白、kashida 等所使用的特定圖像，應用程式應該呼叫 [**ScriptGetFontProperties**](/windows/desktop/api/Usp10/nf-usp10-scriptgetfontproperties)。</span><span class="sxs-lookup"><span data-stu-id="1996c-119">To retrieve the specific glyphs that are used for the default, blanks, kashida, and so forth, for the current font, the application should call [**ScriptGetFontProperties**](/windows/desktop/api/Usp10/nf-usp10-scriptgetfontproperties).</span></span> <span data-ttu-id="1996c-120">為了判斷選取的字型支援執行中的哪些字元，應用程式會呼叫 [**ScriptGetCMap**](/windows/desktop/api/Usp10/nf-usp10-scriptgetcmap)。</span><span class="sxs-lookup"><span data-stu-id="1996c-120">To determine which characters in a run are supported by the selected font, the application calls [**ScriptGetCMap**](/windows/desktop/api/Usp10/nf-usp10-scriptgetcmap).</span></span> <span data-ttu-id="1996c-121">無法使用的字元在圖像緩衝區中會有預設的圖像。</span><span class="sxs-lookup"><span data-stu-id="1996c-121">Characters that are not available have the default glyph in the glyph buffer.</span></span> <span data-ttu-id="1996c-122">請注意，如果字型轉譯的字元是使用字元的組合而非單一圖像，則這個方法會失敗。</span><span class="sxs-lookup"><span data-stu-id="1996c-122">Note that this method fails if a font renders a character using a combination of glyphs instead of a single glyph.</span></span> <span data-ttu-id="1996c-123">例如，00C9;您可以使用大寫 E 字元和銳角圖像來轉譯具有銳角的拉丁大寫字母 E。</span><span class="sxs-lookup"><span data-stu-id="1996c-123">For example, 00C9; LATIN CAPITAL LETTER E WITH ACUTE can be rendered using a capital E glyph and an acute glyph.</span></span> <span data-ttu-id="1996c-124">若要判斷包含這類程式碼點之字串的字型支援，應用程式可以呼叫 [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape)。</span><span class="sxs-lookup"><span data-stu-id="1996c-124">To determine the font support for a string that contains these kinds of code points, the application can call [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape).</span></span> <span data-ttu-id="1996c-125">如需詳細資訊，請參閱 [使用成形引擎](using-shaping-engines.md)。</span><span class="sxs-lookup"><span data-stu-id="1996c-125">For more information, see [Using Shaping Engines](using-shaping-engines.md).</span></span>

<span data-ttu-id="1996c-126">[**ScriptCacheGetHeight**](/windows/desktop/api/Usp10/nf-usp10-scriptcachegetheight)函式會從字型快取傳回字型的高度。</span><span class="sxs-lookup"><span data-stu-id="1996c-126">The [**ScriptCacheGetHeight**](/windows/desktop/api/Usp10/nf-usp10-scriptcachegetheight) function returns the height of the font from the font cache.</span></span> <span data-ttu-id="1996c-127">[**ScriptGetProperties**](/windows/desktop/api/Usp10/nf-usp10-scriptgetproperties) 提供所有腳本所需之特殊處理的相關資訊，以腳本編制索引。</span><span class="sxs-lookup"><span data-stu-id="1996c-127">[**ScriptGetProperties**](/windows/desktop/api/Usp10/nf-usp10-scriptgetproperties) provides information on the special processing required for all the scripts, indexed by script.</span></span> <span data-ttu-id="1996c-128">例如，它包含與腳本相關聯的主要語言、指出腳本是否為數值的資料，以及指出腳本是否為複雜字集的資料。</span><span class="sxs-lookup"><span data-stu-id="1996c-128">For example, it includes the primary language associated with the script, data indicating if the script is numeric, and data indicating if the script is a complex script.</span></span>

<span data-ttu-id="1996c-129">[**ScriptGetGlyphABCWidth**](/windows/desktop/api/Usp10/nf-usp10-scriptgetglyphabcwidth) 會傳回指定圖像的 [ABC 寬度](uniscribe-glossary.md) ，這對繪製圖像圖表可能很有用。</span><span class="sxs-lookup"><span data-stu-id="1996c-129">[**ScriptGetGlyphABCWidth**](/windows/desktop/api/Usp10/nf-usp10-scriptgetglyphabcwidth) returns the [ABC width](uniscribe-glossary.md) of a given glyph, which might be useful for drawing glyph charts.</span></span> <span data-ttu-id="1996c-130">不過，它不應該用於一般複雜的腳本文字格式。</span><span class="sxs-lookup"><span data-stu-id="1996c-130">However, it should not be used for normal complex script text formatting.</span></span>

## <a name="related-topics"></a><span data-ttu-id="1996c-131">[相關主題]</span><span class="sxs-lookup"><span data-stu-id="1996c-131">Related Topics</span></span>

[<span data-ttu-id="1996c-132">使用 Uniscribe</span><span class="sxs-lookup"><span data-stu-id="1996c-132">Using Uniscribe</span></span>](using-uniscribe.md)


 

 
