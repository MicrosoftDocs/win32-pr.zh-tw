---
description: 本主題提供與國際支援功能相關之安全性考慮的相關資訊。
ms.assetid: 4034f479-ad29-4c6f-82c6-977f420c4d4d
title: 安全性考慮：國際功能
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: aeb9f8b849e9fb1a07f01031832449b9c9027ae5
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "104195293"
---
# <a name="security-considerations-international-features"></a><span data-ttu-id="3aec6-103">安全性考慮：國際功能</span><span class="sxs-lookup"><span data-stu-id="3aec6-103">Security Considerations: International Features</span></span>

<span data-ttu-id="3aec6-104">本主題提供與國際支援功能相關之安全性考慮的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="3aec6-104">This topic provides information about security considerations related to International Support features.</span></span> <span data-ttu-id="3aec6-105">您可以使用它做為起點，然後針對特定技術的安全性考慮，查看相關國際技術的檔。</span><span class="sxs-lookup"><span data-stu-id="3aec6-105">You can use it as a starting point and then see the documentation for the international technology of interest for technology-specific security considerations.</span></span>

<span data-ttu-id="3aec6-106">本主題包含下列各節。</span><span class="sxs-lookup"><span data-stu-id="3aec6-106">This topic contains the following sections.</span></span>

-   [<span data-ttu-id="3aec6-107">字元轉換函式的安全性考慮</span><span class="sxs-lookup"><span data-stu-id="3aec6-107">Security Considerations for Character Conversion Functions</span></span>](#security-considerations-for-character-conversion-functions)
-   [<span data-ttu-id="3aec6-108">比較函數的安全性考慮</span><span class="sxs-lookup"><span data-stu-id="3aec6-108">Security Considerations for Comparison Functions</span></span>](#security-considerations-for-comparison-functions)
-   [<span data-ttu-id="3aec6-109">檔案名中字元集的安全性考慮</span><span class="sxs-lookup"><span data-stu-id="3aec6-109">Security Considerations for Character Sets in File Names</span></span>](#security-considerations-for-character-sets-in-file-names)
-   [<span data-ttu-id="3aec6-110">國際化功能變數名稱的安全性考慮</span><span class="sxs-lookup"><span data-stu-id="3aec6-110">Security Considerations for Internationalized Domain Names</span></span>](#security-considerations-for-internationalized-domain-names)
-   [<span data-ttu-id="3aec6-111">ANSI 函數的安全性考慮</span><span class="sxs-lookup"><span data-stu-id="3aec6-111">Security Considerations for ANSI Functions</span></span>](#security-considerations-for-ansi-functions)
-   [<span data-ttu-id="3aec6-112">Unicode 正規化的安全性考慮</span><span class="sxs-lookup"><span data-stu-id="3aec6-112">Security Considerations for Unicode Normalization</span></span>](#security-considerations-for-unicode-normalization)

## <a name="security-considerations-for-character-conversion-functions"></a><span data-ttu-id="3aec6-113">字元轉換函式的安全性考慮</span><span class="sxs-lookup"><span data-stu-id="3aec6-113">Security Considerations for Character Conversion Functions</span></span>

<span data-ttu-id="3aec6-114">[**MultiByteToWideChar**](/windows/desktop/api/Stringapiset/nf-stringapiset-multibytetowidechar) 和 [**WideCharToMultiByte**](/windows/desktop/api/Stringapiset/nf-stringapiset-widechartomultibyte) 是 Unicode 和字元集函數，最常用來轉換 ANSI 和 Unicode 之間的字元。</span><span class="sxs-lookup"><span data-stu-id="3aec6-114">[**MultiByteToWideChar**](/windows/desktop/api/Stringapiset/nf-stringapiset-multibytetowidechar) and [**WideCharToMultiByte**](/windows/desktop/api/Stringapiset/nf-stringapiset-widechartomultibyte) are the Unicode and character set functions most commonly used to convert characters between ANSI and Unicode.</span></span> <span data-ttu-id="3aec6-115">這些函式有可能會造成安全性風險，因為它們會以不同的方式計算輸入和輸出緩衝區的元素數目。</span><span class="sxs-lookup"><span data-stu-id="3aec6-115">These functions have the potential of causing security risks because they count the elements of the input and output buffers differently.</span></span> <span data-ttu-id="3aec6-116">例如， [**MultiByteToWideChar**](/windows/desktop/api/Stringapiset/nf-stringapiset-multibytetowidechar) 會採用以位元組計算的輸入緩衝區，並將轉換後的字元放入以 Unicode 字元調整大小的緩衝區。</span><span class="sxs-lookup"><span data-stu-id="3aec6-116">For example, [**MultiByteToWideChar**](/windows/desktop/api/Stringapiset/nf-stringapiset-multibytetowidechar) takes an input buffer counted in bytes and puts the converted characters into a buffer sized in Unicode characters.</span></span> <span data-ttu-id="3aec6-117">當您的應用程式使用這個函式時，必須正確地調整緩衝區大小，以避免緩衝區溢位。</span><span class="sxs-lookup"><span data-stu-id="3aec6-117">When your application uses this function, it must size the buffers correctly to avoid a buffer overrun.</span></span>

<span data-ttu-id="3aec6-118">針對字碼頁， [**WideCharToMultiByte**](/windows/desktop/api/Stringapiset/nf-stringapiset-widechartomultibyte)預設為「最適合」的對應，例如1252。</span><span class="sxs-lookup"><span data-stu-id="3aec6-118">[**WideCharToMultiByte**](/windows/desktop/api/Stringapiset/nf-stringapiset-widechartomultibyte) defaults to "best fit" mapping for code pages, such as 1252.</span></span> <span data-ttu-id="3aec6-119">不過，這種類型的對應允許相同字串的多個表示，可能會讓您的應用程式容易受到攻擊。</span><span class="sxs-lookup"><span data-stu-id="3aec6-119">However, this type of mapping allows multiple representations of the same string, potentially leaving your application vulnerable to attack.</span></span> <span data-ttu-id="3aec6-120">例如，以分音符號 ( "Ä" 的拉丁文大寫字母 A ) 可能會對應到拉丁大寫字母 A ( "A" ) ;亞洲語言的 Unicode 字元可能會對應到斜線 ( "/" ) 。</span><span class="sxs-lookup"><span data-stu-id="3aec6-120">For example, Latin capital letter A with dieresis ("Ä") might map to Latin capital letter A ("A"); a Unicode character in an Asian language might map to a slash ("/").</span></span> <span data-ttu-id="3aec6-121">\_從安全性的觀點來看，最好不要使用 WC 的 \_ 最 \_ 適合 \_ 字元旗標。</span><span class="sxs-lookup"><span data-stu-id="3aec6-121">The use of the WC\_NO\_BEST\_FIT\_CHARS flag is preferred from a security perspective.</span></span>

<span data-ttu-id="3aec6-122">某些字碼頁（例如，5022x (iso-2022-x) 字碼頁）本質上是不安全的，因為它們允許相同字串的多個標記法。</span><span class="sxs-lookup"><span data-stu-id="3aec6-122">Some code pages, for example, the 5022x (iso-2022-x) code pages, are inherently insecure because they allow multiple representations of the same string.</span></span> <span data-ttu-id="3aec6-123">正確撰寫的程式碼會以 Unicode 格式執行安全性檢查，但是這些類型的字碼頁會擴充您應用程式的攻擊風險，應該盡可能避免。</span><span class="sxs-lookup"><span data-stu-id="3aec6-123">Properly written code performs security checks in the Unicode form, but these types of code pages expand the attack susceptibility of your applications and should be avoided if possible.</span></span>

## <a name="security-considerations-for-comparison-functions"></a><span data-ttu-id="3aec6-124">比較函數的安全性考慮</span><span class="sxs-lookup"><span data-stu-id="3aec6-124">Security Considerations for Comparison Functions</span></span>

<span data-ttu-id="3aec6-125">字串比較可能存在安全性問題。</span><span class="sxs-lookup"><span data-stu-id="3aec6-125">String comparisons can potentially present security issues.</span></span> <span data-ttu-id="3aec6-126">因為所有的比較函數都稍微不同，所以一個函式可能會將兩個字串回報為相等，而另一個函式可能會將它們視為相異。</span><span class="sxs-lookup"><span data-stu-id="3aec6-126">Because all comparison functions are slightly different, one function might report two strings as equal, while another function might consider them distinct.</span></span> <span data-ttu-id="3aec6-127">以下是您的應用程式可以用來比較字串的數個函數：</span><span class="sxs-lookup"><span data-stu-id="3aec6-127">The following are several functions your applications can use to compare strings:</span></span>

-   <span data-ttu-id="3aec6-128">[lstrcmpi](/windows/win32/api/winbase/nf-winbase-lstrcmpia)。</span><span class="sxs-lookup"><span data-stu-id="3aec6-128">[lstrcmpi](/windows/win32/api/winbase/nf-winbase-lstrcmpia).</span></span> <span data-ttu-id="3aec6-129">根據地區設定的規則（不區分大小寫）比較兩個字元字串。</span><span class="sxs-lookup"><span data-stu-id="3aec6-129">Compares two character strings according to the rules of the locale, without case-sensitivity.</span></span> <span data-ttu-id="3aec6-130">此函式會比較字串，方法是檢查第一個字元彼此、第二個字元互相對應，依此類推，直到找到不相等或到達字串的結尾為止。</span><span class="sxs-lookup"><span data-stu-id="3aec6-130">The function compares the strings by checking the first characters against each other, the second characters against each other, and so on, until it finds an inequality or reaches the ends of the strings.</span></span>
-   <span data-ttu-id="3aec6-131">[lstrcmp](/windows/win32/api/winbase/nf-winbase-lstrcmpa)。</span><span class="sxs-lookup"><span data-stu-id="3aec6-131">[lstrcmp](/windows/win32/api/winbase/nf-winbase-lstrcmpa).</span></span> <span data-ttu-id="3aec6-132">使用與 [lstrcmpi](/windows/win32/api/winbase/nf-winbase-lstrcmpia)類似的技術來比較字串。</span><span class="sxs-lookup"><span data-stu-id="3aec6-132">Compares strings using techniques similar to those of [lstrcmpi](/windows/win32/api/winbase/nf-winbase-lstrcmpia).</span></span> <span data-ttu-id="3aec6-133">唯一的差別在於 [lstrcmp](/windows/win32/api/winbase/nf-winbase-lstrcmpa) 會執行區分大小寫的字串比較。</span><span class="sxs-lookup"><span data-stu-id="3aec6-133">The only difference is that [lstrcmp](/windows/win32/api/winbase/nf-winbase-lstrcmpa) performs a case-sensitive string comparison.</span></span>
-   <span data-ttu-id="3aec6-134">[**CompareString**](/windows/win32/api/stringapiset/nf-stringapiset-comparestringw)、 [**CompareStringEx**](/windows/desktop/api/Stringapiset/nf-stringapiset-comparestringex) (Windows Vista 和更新版本的) 。</span><span class="sxs-lookup"><span data-stu-id="3aec6-134">[**CompareString**](/windows/win32/api/stringapiset/nf-stringapiset-comparestringw), [**CompareStringEx**](/windows/desktop/api/Stringapiset/nf-stringapiset-comparestringex) (Windows Vista and later).</span></span> <span data-ttu-id="3aec6-135">在應用程式提供的地區設定上執行字串比較。</span><span class="sxs-lookup"><span data-stu-id="3aec6-135">Perform a string comparison on an application-supplied locale.</span></span> <span data-ttu-id="3aec6-136">[**CompareStringEx**](/windows/desktop/api/Stringapiset/nf-stringapiset-comparestringex) 與 [**CompareString**](/windows/win32/api/stringapiset/nf-stringapiset-comparestringw)類似，但它會依 [地區設定名稱](locale-names.md) （而非 [地區設定識別碼](locale-identifiers.md)）來識別地區設定。</span><span class="sxs-lookup"><span data-stu-id="3aec6-136">[**CompareStringEx**](/windows/desktop/api/Stringapiset/nf-stringapiset-comparestringex) is similar to [**CompareString**](/windows/win32/api/stringapiset/nf-stringapiset-comparestringw), but it identifies a locale by [locale name](locale-names.md) instead of [locale identifier](locale-identifiers.md).</span></span> <span data-ttu-id="3aec6-137">這些函式類似于 [lstrcmpi](/windows/win32/api/winbase/nf-winbase-lstrcmpia) 和 [lstrcmp](/windows/win32/api/winbase/nf-winbase-lstrcmpa) ，不同之處在于它們會在特定地區設定上運作，而不是在使用者選取的地區設定上運作。</span><span class="sxs-lookup"><span data-stu-id="3aec6-137">These functions are similar to [lstrcmpi](/windows/win32/api/winbase/nf-winbase-lstrcmpia) and [lstrcmp](/windows/win32/api/winbase/nf-winbase-lstrcmpa) except that they operate on a specific locale instead of a user-selected locale.</span></span>
-   <span data-ttu-id="3aec6-138">[**CompareStringOrdinal**](/windows/desktop/api/Stringapiset/nf-stringapiset-comparestringordinal) (Windows Vista 和更新版本的) 。</span><span class="sxs-lookup"><span data-stu-id="3aec6-138">[**CompareStringOrdinal**](/windows/desktop/api/Stringapiset/nf-stringapiset-comparestringordinal) (Windows Vista and later).</span></span> <span data-ttu-id="3aec6-139">比較兩個 Unicode 字串來測試二進位相等。</span><span class="sxs-lookup"><span data-stu-id="3aec6-139">Compares two Unicode strings to test binary equivalence.</span></span> <span data-ttu-id="3aec6-140">除了不區分大小寫的選項之外，此函式會忽略所有非二進位 equivalences，並測試所有的程式碼點是否相等，包括未在語言 [排序](sorting.md) 配置中提供任何權數的程式碼點。</span><span class="sxs-lookup"><span data-stu-id="3aec6-140">Except for the option of being case-insensitive, this function disregards all non-binary equivalences, and tests all code points for equality, including code points that are not given any weight in linguistic [sorting](sorting.md) schemes.</span></span> <span data-ttu-id="3aec6-141">請注意，本主題中提及的其他比較函數不會測試所有程式碼點是否相等。</span><span class="sxs-lookup"><span data-stu-id="3aec6-141">Note that the other comparison functions mentioned in this topic do not test all code points for equality.</span></span>
-   <span data-ttu-id="3aec6-142">[**FindNLSString**](/windows/desktop/api/Winnls/nf-winnls-findnlsstring)、 [**FindNLSStringEx**](/windows/desktop/api/Winnls/nf-winnls-findnlsstringex) (Windows Vista 和更新版本的) 。</span><span class="sxs-lookup"><span data-stu-id="3aec6-142">[**FindNLSString**](/windows/desktop/api/Winnls/nf-winnls-findnlsstring), [**FindNLSStringEx**](/windows/desktop/api/Winnls/nf-winnls-findnlsstringex) (Windows Vista and later).</span></span> <span data-ttu-id="3aec6-143">在另一個 Unicode 字串中找出 Unicode 字串。</span><span class="sxs-lookup"><span data-stu-id="3aec6-143">Locate a Unicode string in another Unicode string.</span></span> <span data-ttu-id="3aec6-144">[**FindNLSStringEx**](/windows/desktop/api/Winnls/nf-winnls-findnlsstringex) 與 [**FindNLSString**](/windows/desktop/api/Winnls/nf-winnls-findnlsstring)類似，不同之處在于它會依地區設定名稱（而非地區設定識別碼）識別地區設定。</span><span class="sxs-lookup"><span data-stu-id="3aec6-144">[**FindNLSStringEx**](/windows/desktop/api/Winnls/nf-winnls-findnlsstringex) is similar to [**FindNLSString**](/windows/desktop/api/Winnls/nf-winnls-findnlsstring), except that it identifies a locale by locale name instead of locale identifier.</span></span>
-   <span data-ttu-id="3aec6-145">[**FindStringOrdinal**](/windows/desktop/api/Libloaderapi/nf-libloaderapi-findstringordinal) (Windows 7 和更新版本的) 。</span><span class="sxs-lookup"><span data-stu-id="3aec6-145">[**FindStringOrdinal**](/windows/desktop/api/Libloaderapi/nf-libloaderapi-findstringordinal) (Windows 7 and later).</span></span> <span data-ttu-id="3aec6-146">在另一個 Unicode 字串中尋找一個 Unicode 字串。</span><span class="sxs-lookup"><span data-stu-id="3aec6-146">Locates one Unicode string in another Unicode string.</span></span> <span data-ttu-id="3aec6-147">應用程式應該使用此函式，而不是 [**FindNLSString**](/windows/desktop/api/Winnls/nf-winnls-findnlsstring) 進行所有的非語言比較。</span><span class="sxs-lookup"><span data-stu-id="3aec6-147">The application should use this function instead of [**FindNLSString**](/windows/desktop/api/Winnls/nf-winnls-findnlsstring) for all non-linguistic comparisons.</span></span>

<span data-ttu-id="3aec6-148">如同 [lstrcmpi](/windows/win32/api/winbase/nf-winbase-lstrcmpia) 和 [lstrcmp](/windows/win32/api/winbase/nf-winbase-lstrcmpa)， [**CompareString**](/windows/win32/api/stringapiset/nf-stringapiset-comparestringw) 會依字元評估字串字元。</span><span class="sxs-lookup"><span data-stu-id="3aec6-148">Like [lstrcmpi](/windows/win32/api/winbase/nf-winbase-lstrcmpia) and [lstrcmp](/windows/win32/api/winbase/nf-winbase-lstrcmpa), [**CompareString**](/windows/win32/api/stringapiset/nf-stringapiset-comparestringw) evaluates strings character by character.</span></span> <span data-ttu-id="3aec6-149">不過，許多語言都有多個字元的元素，例如傳統西班牙文中的兩個字元元素 "CH"。</span><span class="sxs-lookup"><span data-stu-id="3aec6-149">However, many languages have multiple-character elements, for example, the two-character element "CH" in traditional Spanish.</span></span> <span data-ttu-id="3aec6-150">由於 [**CompareString**](/windows/win32/api/stringapiset/nf-stringapiset-comparestringw) 會使用應用程式所提供的地區設定來識別多個字元的元素，而 [lstrcmpi](/windows/win32/api/winbase/nf-winbase-lstrcmpia) 和 [lstrcmp](/windows/win32/api/winbase/nf-winbase-lstrcmpa) 會使用執行緒地區設定，因此相同的字串可能不會比較相等。</span><span class="sxs-lookup"><span data-stu-id="3aec6-150">Because [**CompareString**](/windows/win32/api/stringapiset/nf-stringapiset-comparestringw) uses the locale furnished by the application to identify multiple-character elements and [lstrcmpi](/windows/win32/api/winbase/nf-winbase-lstrcmpia) and [lstrcmp](/windows/win32/api/winbase/nf-winbase-lstrcmpa) use the thread locale, identical strings might not compare as equal.</span></span>

<span data-ttu-id="3aec6-151">[**CompareString**](/windows/win32/api/stringapiset/nf-stringapiset-comparestringw) 會忽略未定義的字元，因此會傳回零 (，表示對許多非常相異的字串組) 的相等字串。</span><span class="sxs-lookup"><span data-stu-id="3aec6-151">[**CompareString**](/windows/win32/api/stringapiset/nf-stringapiset-comparestringw) ignores undefined characters, and thus returns zero (indicating equal strings) for many string pairs that are quite distinct.</span></span> <span data-ttu-id="3aec6-152">字串可能包含未對應到任何字元的值，或者可能包含在應用程式網域以外的字元（例如 URL 中的控制字元）。</span><span class="sxs-lookup"><span data-stu-id="3aec6-152">A string might contain values that do not map to any character or it might contain characters with semantics outside the domain of the application, such as control characters in a URL.</span></span> <span data-ttu-id="3aec6-153">使用此函式的應用程式應該提供錯誤處理常式和測試字串，以確保它們在使用之前都是有效的。</span><span class="sxs-lookup"><span data-stu-id="3aec6-153">Applications using this function should provide error handlers and test strings to make sure that they are valid before using them.</span></span>

> [!Note]  
> <span data-ttu-id="3aec6-154">針對 Windows Vista 和更新版本， [**CompareStringEx**](/windows/desktop/api/Stringapiset/nf-stringapiset-comparestringex) 類似于 [**CompareString**](/windows/win32/api/stringapiset/nf-stringapiset-comparestringw)。</span><span class="sxs-lookup"><span data-stu-id="3aec6-154">For Windows Vista and later, [**CompareStringEx**](/windows/desktop/api/Stringapiset/nf-stringapiset-comparestringex) is similar to [**CompareString**](/windows/win32/api/stringapiset/nf-stringapiset-comparestringw).</span></span> <span data-ttu-id="3aec6-155">這些功能的安全性問題都相同。</span><span class="sxs-lookup"><span data-stu-id="3aec6-155">The security issues are identical for these functions.</span></span>

 

<span data-ttu-id="3aec6-156">類似的安全性問題適用于進行隱含比較的函數（例如 [**FindNLSString**](/windows/desktop/api/Winnls/nf-winnls-findnlsstring)）。</span><span class="sxs-lookup"><span data-stu-id="3aec6-156">Similar security issues apply to functions, such as [**FindNLSString**](/windows/desktop/api/Winnls/nf-winnls-findnlsstring), that make implicit comparisons.</span></span> <span data-ttu-id="3aec6-157">視所設定的旗標而定，呼叫 [**FindNLSString**](/windows/desktop/api/Winnls/nf-winnls-findnlsstring) 以搜尋另一個字串中某個字串的結果可能會有很大的差異。</span><span class="sxs-lookup"><span data-stu-id="3aec6-157">Depending on the flags that are set, the results of calling [**FindNLSString**](/windows/desktop/api/Winnls/nf-winnls-findnlsstring) to search for one string within another string can differ considerably.</span></span>

> [!Note]  
> <span data-ttu-id="3aec6-158">針對 Windows Vista 和更新版本， [**FindNLSStringEx**](/windows/desktop/api/Winnls/nf-winnls-findnlsstringex) 類似于 [**FindNLSString**](/windows/desktop/api/Winnls/nf-winnls-findnlsstring)。</span><span class="sxs-lookup"><span data-stu-id="3aec6-158">For Windows Vista and later, [**FindNLSStringEx**](/windows/desktop/api/Winnls/nf-winnls-findnlsstringex) is similar to [**FindNLSString**](/windows/desktop/api/Winnls/nf-winnls-findnlsstring).</span></span> <span data-ttu-id="3aec6-159">這些功能的安全性問題都相同。</span><span class="sxs-lookup"><span data-stu-id="3aec6-159">The security issues are identical for these functions.</span></span>

 

## <a name="security-considerations-for-character-sets-in-file-names"></a><span data-ttu-id="3aec6-160">檔案名中字元集的安全性考慮</span><span class="sxs-lookup"><span data-stu-id="3aec6-160">Security Considerations for Character Sets in File Names</span></span>

<span data-ttu-id="3aec6-161">日文語言系統上使用的 Windows 字碼頁和 OEM 字元集包含日元符號 (¥) ，而不是反斜線 (\\) 。</span><span class="sxs-lookup"><span data-stu-id="3aec6-161">Windows code page and OEM character sets used on Japanese-language systems contain the Yen symbol (¥) instead of a backslash (\\).</span></span> <span data-ttu-id="3aec6-162">因此，不允許使用日元字元作為 NTFS 和 FAT 檔案系統。</span><span class="sxs-lookup"><span data-stu-id="3aec6-162">Thus, the Yen character is a prohibited character for NTFS and FAT file systems.</span></span> <span data-ttu-id="3aec6-163">當將 Unicode 對應至日文語言字碼頁時，轉換函式會將反斜線 (U + 005C) 和一般 Unicode 日元符號 (U + 00A5) 轉換成這個相同的字元。</span><span class="sxs-lookup"><span data-stu-id="3aec6-163">When mapping Unicode to a Japanese-language code page, conversion functions map both backslash (U+005C) and the normal Unicode Yen symbol (U+00A5) to this same character.</span></span> <span data-ttu-id="3aec6-164">基於安全性理由，您的應用程式通常不應該在可能轉換的 Unicode 字串中允許字元 U + 00A5，以做為 FAT 的檔案名。</span><span class="sxs-lookup"><span data-stu-id="3aec6-164">For security reasons, your applications should not typically allow the character U+00A5 in a Unicode string that might be converted for use as a FAT file name.</span></span>

## <a name="security-considerations-for-internationalized-domain-names"></a><span data-ttu-id="3aec6-165">國際化功能變數名稱的安全性考慮</span><span class="sxs-lookup"><span data-stu-id="3aec6-165">Security Considerations for Internationalized Domain Names</span></span>

<span data-ttu-id="3aec6-166"> (IDNs) 的國際化功能變數名稱是由網路工作群組 [RFC 3490：在應用程式中將功能變數名稱國際化 (IDNA) ](http://www.faqs.org/rfcs/rfc3490.html)。</span><span class="sxs-lookup"><span data-stu-id="3aec6-166">Internationalized Domain Names (IDNs) are specified by Network Working Group [RFC 3490: Internationalizing Domain Names in Applications (IDNA)](http://www.faqs.org/rfcs/rfc3490.html).</span></span> <span data-ttu-id="3aec6-167">標準引進了許多安全性問題。</span><span class="sxs-lookup"><span data-stu-id="3aec6-167">The standard introduces a number of security issues.</span></span>

<span data-ttu-id="3aec6-168">代表不同腳本某些字元的字元可能會類似或甚至相同。</span><span class="sxs-lookup"><span data-stu-id="3aec6-168">Glyphs representing certain characters from different scripts might appear similar or even identical.</span></span> <span data-ttu-id="3aec6-169">例如，在許多字型中，斯拉夫小寫 A ( "a" ) 與拉丁小寫 A ( "a" ) 不區分。</span><span class="sxs-lookup"><span data-stu-id="3aec6-169">For example, in many fonts, Cyrillic lowercase A ("a") is indistinguishable from Latin lowercase A ("a").</span></span> <span data-ttu-id="3aec6-170">無法以視覺化的方式告訴 "example.com" 和 "example.com" 兩個不同的功能變數名稱，一個名稱中有一個拉丁文小寫 A，另一個則具有斯拉夫小寫 A。不道德的主機網站可使用此視覺效果，偽裝為詐騙攻擊中的另一個網站。</span><span class="sxs-lookup"><span data-stu-id="3aec6-170">There is no way to tell visually that "example.com" and "example.com" are two different domain names,one with a Latin lowercase A in the name, the other with a Cyrillic lowercase A. An unscrupulous host site can use this visual ambiguity to pretend to be another site in a spoofing attack.</span></span>

<span data-ttu-id="3aec6-171">IDNA 允許 IDNs 的擴充字元集在特定腳本內也有詐騙潛力。</span><span class="sxs-lookup"><span data-stu-id="3aec6-171">The extended character set that IDNA allows for IDNs also has spoofing potential within a particular script.</span></span> <span data-ttu-id="3aec6-172">例如，連字號之間有強式非常相似-減號 ( "-" U + 002D) ，連字號 ( "—" U + 2010) 、非斷字元 ( "-" U + 2011) 、"\u2012" U + 2012 (、en 虛線) "–" U + 2013 ( 和減號) "−" U + 2212 (。</span><span class="sxs-lookup"><span data-stu-id="3aec6-172">For example, there is a strong resemblance among the hyphen-minus ("-" U+002D), the hyphen ("—" U+2010), the non-breaking hyphen ("‑" U+2011), the figure dash ("‒" U+2012), the en dash ("–" U+2013), and the minus sign ("−" U+2212).</span></span>

<span data-ttu-id="3aec6-173">某些相容性組合會產生類似的問題。</span><span class="sxs-lookup"><span data-stu-id="3aec6-173">Similar issues arise from certain compatibility compositions.</span></span> <span data-ttu-id="3aec6-174">例如，單一 Unicode 字元號碼二十 FULL STOP ( "20."、U + 249B) 轉換為 "20"。</span><span class="sxs-lookup"><span data-stu-id="3aec6-174">For example, the single Unicode character NUMBER TWENTY FULL STOP ("⒛", U+249B) is converted to "20."</span></span> <span data-ttu-id="3aec6-175">在轉換成 Punycode 之前， (U + 0032 U + 0030 U + 002E) 于 NamePrep 步驟中。</span><span class="sxs-lookup"><span data-stu-id="3aec6-175">(U+0032 U+0030 U+002E) in a NamePrep step, prior to conversion to Punycode.</span></span> <span data-ttu-id="3aec6-176">換句話說，此組合會將句點插入句號 (full stop) 。</span><span class="sxs-lookup"><span data-stu-id="3aec6-176">In other words, this composition inserts a period (full stop).</span></span> <span data-ttu-id="3aec6-177">這類組合具有詐騙潛力。</span><span class="sxs-lookup"><span data-stu-id="3aec6-177">Such compositions have spoofing potential.</span></span>

<span data-ttu-id="3aec6-178">在 IDN 中混合不同的腳本並不一定表示詐騙或欺騙意圖。</span><span class="sxs-lookup"><span data-stu-id="3aec6-178">Mixing of different scripts in an IDN does not necessarily indicate spoofing or deceptive intent.</span></span> <span data-ttu-id="3aec6-179">[技術報表 \# 36： Unicode 安全性考慮](https://www.unicode.org/reports/tr36/#international_domain_names) 提供數個合理 IDNs 的範例，其中包含混合的腳本，例如 XML-Документы .Com ( "Документы" 是 [檔] ) 的俄文。</span><span class="sxs-lookup"><span data-stu-id="3aec6-179">[Technical Report \#36: Unicode Security Considerations](https://www.unicode.org/reports/tr36/#international_domain_names) gives several examples of reasonable IDNs that contain a mix of scripts, such as XML-Документы.com ("Документы" is Russian for "documents").</span></span>

<span data-ttu-id="3aec6-180">詐騙攻擊不限於 IDNs。</span><span class="sxs-lookup"><span data-stu-id="3aec6-180">Spoofing attacks are not restricted to IDNs.</span></span> <span data-ttu-id="3aec6-181">例如，"rnicrosoft.com" 看起來很像「microsoft.com」，但它是 ASCII 名稱。</span><span class="sxs-lookup"><span data-stu-id="3aec6-181">For example, "rnicrosoft.com" looks much like "microsoft.com", yet it is an ASCII name.</span></span> <span data-ttu-id="3aec6-182">此外，可能會因為名稱損毀而發出詐騙攻擊。</span><span class="sxs-lookup"><span data-stu-id="3aec6-182">Additionally, a spoofing attack can be made by corruption of a name.</span></span> <span data-ttu-id="3aec6-183">在已知的品牌名稱之後新增額外的標籤，或在標示為安全的 URL 路徑中包含品牌名稱，可能會混淆新手使用者，不論是否使用 IDN。</span><span class="sxs-lookup"><span data-stu-id="3aec6-183">Adding extra labels after a well-known brand name, or including the brand name in the path of a URL labeled as secure, can confuse novice users, regardless of the use of the IDN.</span></span> <span data-ttu-id="3aec6-184">在某些地區設定中，IDNs 是必要的，而且這些名稱的 Punycode 格式無法接受，因為它會讓名稱看起來像是很雜亂的名稱。</span><span class="sxs-lookup"><span data-stu-id="3aec6-184">For some locales, IDNs are required and the Punycode form of these names is unacceptable, since it makes the names look like gibberish.</span></span>

<span data-ttu-id="3aec6-185">如需有關此處所述安全性問題的詳細資訊，以及與 IDNA 相關的許多其他問題，請參閱 [技術報表 \# 36： Unicode 安全性考慮](https://www.unicode.org/reports/tr36/#international_domain_names)。</span><span class="sxs-lookup"><span data-stu-id="3aec6-185">For more information about the security issues mentioned here, plus a large number of other issues relevant to IDNA, see [Technical Report \#36: Unicode Security Considerations](https://www.unicode.org/reports/tr36/#international_domain_names).</span></span> <span data-ttu-id="3aec6-186">除了詳細討論與 IDNA 相關的安全性問題之外，這份報告還提供在應用程式中處理可疑 IDNs 的建議。</span><span class="sxs-lookup"><span data-stu-id="3aec6-186">Along with detailed discussions of IDNA-related security issues, this report offers suggestions for dealing with suspect IDNs in your applications.</span></span>

## <a name="security-considerations-for-ansi-functions"></a><span data-ttu-id="3aec6-187">ANSI 函數的安全性考慮</span><span class="sxs-lookup"><span data-stu-id="3aec6-187">Security Considerations for ANSI Functions</span></span>

> [!Note]  
> <span data-ttu-id="3aec6-188">建議您在全球化應用程式中使用 Unicode，尤其是新的應用程式（如果有的話）。</span><span class="sxs-lookup"><span data-stu-id="3aec6-188">You are recommended to use Unicode in your globalized applications, particularly new ones, if at all possible.</span></span> <span data-ttu-id="3aec6-189">如果您有覆寫不使用 Unicode 的原因（例如，符合不支援 Unicode 的舊版通訊協定），則應該使用 ANSI 函數。</span><span class="sxs-lookup"><span data-stu-id="3aec6-189">You should use ANSI functions only if you have overriding reasons for not using Unicode, for example, conformance to an older protocol that does not support Unicode.</span></span>

 

<span data-ttu-id="3aec6-190"> (NLS) 函式（例如 [**GetLocaleInfo**](/windows/desktop/api/Winnls/nf-winnls-getlocaleinfoa) 和 [**GetCalendarInfo**](/windows/desktop/api/Winnls/nf-winnls-getcalendarinfoa)）的許多國家語言支援都有特定的 ANSI 版本，在此情況下，會分別為 **GetLocaleInfoA** 和 **GetCalendarInfoA**。</span><span class="sxs-lookup"><span data-stu-id="3aec6-190">Many National Language Support (NLS) functions, such as [**GetLocaleInfo**](/windows/desktop/api/Winnls/nf-winnls-getlocaleinfoa) and [**GetCalendarInfo**](/windows/desktop/api/Winnls/nf-winnls-getcalendarinfoa), have specific ANSI versions, in this case, **GetLocaleInfoA** and **GetCalendarInfoA**, respectively.</span></span> <span data-ttu-id="3aec6-191">當您的應用程式使用 ANSI 版本的函式搭配 Unicode 作業系統（例如 Windows NT、Windows 2000、Windows XP 或 Windows Vista）時，此函式可能會失敗或產生未定義的結果。</span><span class="sxs-lookup"><span data-stu-id="3aec6-191">When your application uses the ANSI version of a function with a Unicode-based operating system, such as Windows NT, Windows 2000, Windows XP, or Windows Vista, the function can fail or produce undefined results.</span></span> <span data-ttu-id="3aec6-192">如果您有充分的理由要搭配使用 ANSI 函數與這類作業系統，請確定您的應用程式所傳遞的資料對 ANSI 而言是有效的。</span><span class="sxs-lookup"><span data-stu-id="3aec6-192">If you have a compelling reason to use ANSI functions with such an operating system, ensure that the data passed by your application is valid for ANSI.</span></span>

## <a name="security-considerations-for-unicode-normalization"></a><span data-ttu-id="3aec6-193">Unicode 正規化的安全性考慮</span><span class="sxs-lookup"><span data-stu-id="3aec6-193">Security Considerations for Unicode Normalization</span></span>

<span data-ttu-id="3aec6-194">由於 Unicode 正規化可能會變更字串的形式，因此安全性機制或字元驗證演算法通常應該在正規化之後執行。</span><span class="sxs-lookup"><span data-stu-id="3aec6-194">Since Unicode normalization can change the form of a string, security mechanisms or character validation algorithms should usually be implemented after normalization.</span></span> <span data-ttu-id="3aec6-195">例如，假設應用程式具有接受檔案名的 Web 介面，但不接受路徑名稱。</span><span class="sxs-lookup"><span data-stu-id="3aec6-195">For example, consider an application with a Web interface that accepts a file name, but does not accept a path name.</span></span> <span data-ttu-id="3aec6-196">全形 U + FF43 U + FF1A U + FF3C U + FF57 U + FF49 U + FF4E U + FF44 U + FF4F U + FF57 U + FF53 `(c : \ w i n d o w s)` 變更為 U + 0063 u + 001A u + 003C u + 0077 u + 0069 u + 006E u + 0064 u + 006F u + 0077 u + 0073 `(c:\windows)` WITH form KC 正規化。</span><span class="sxs-lookup"><span data-stu-id="3aec6-196">A full-width U+FF43 U+FF1A U+FF3C U+FF57 U+FF49 U+FF4E U+FF44 U+FF4F U+FF57 U+FF53 `(c : \ w i n d o w s)` changes to U+0063 U+001A U+003C U+0077 U+0069 U+006E U+0064 U+006F U+0077 U+0073 `(c:\windows)` with form KC normalization.</span></span> <span data-ttu-id="3aec6-197">如果應用程式在執行正規化之前測試是否存在冒號和反斜線字元，則結果可能是不小心的檔案存取。</span><span class="sxs-lookup"><span data-stu-id="3aec6-197">If an application tests for the presence of the colon and backslash characters before it implements normalization, the result can be unintentional file access.</span></span>

<span data-ttu-id="3aec6-198">雖然 Unicode 正規化是讓作業系統安全的元素，但請記住，正規化不是完整安全性原則的取代專案。</span><span class="sxs-lookup"><span data-stu-id="3aec6-198">While Unicode normalization is an element in making operating systems secure, remember that normalization is not a replacement for a comprehensive security policy.</span></span>

## <a name="related-topics"></a><span data-ttu-id="3aec6-199">相關主題</span><span class="sxs-lookup"><span data-stu-id="3aec6-199">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="3aec6-200">檔案名中使用的字元集</span><span class="sxs-lookup"><span data-stu-id="3aec6-200">Character Sets Used in File Names</span></span>](character-sets-used-in-file-names.md)
</dt> <dt>

[<span data-ttu-id="3aec6-201">函數原型的慣例</span><span class="sxs-lookup"><span data-stu-id="3aec6-201">Conventions for Function Prototypes</span></span>](conventions-for-function-prototypes.md)
</dt> <dt>

[<span data-ttu-id="3aec6-202">處理應用程式中的排序</span><span class="sxs-lookup"><span data-stu-id="3aec6-202">Handling Sorting in Your Applications</span></span>](handling-sorting-in-your-applications.md)
</dt> <dt>

[<span data-ttu-id="3aec6-203">處理國際化功能變數名稱 (IDNs) </span><span class="sxs-lookup"><span data-stu-id="3aec6-203">Handling Internationalized Domain Names (IDNs)</span></span>](handling-internationalized-domain-names--idns.md)
</dt> <dt>

[<span data-ttu-id="3aec6-204">Unicode</span><span class="sxs-lookup"><span data-stu-id="3aec6-204">Unicode</span></span>](unicode.md)
</dt> </dl>

 

 
