---
description: 組合字元串是撰寫視窗中的目前文字。
ms.assetid: ab226567-f68d-4fa4-9ead-e9bfabde927e
title: 組合字元串
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5e5cb63163ca9a8076edc4d01053e4baeffc619c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "103944371"
---
# <a name="composition-string"></a><span data-ttu-id="2b39a-103">組合字元串</span><span class="sxs-lookup"><span data-stu-id="2b39a-103">Composition String</span></span>

<span data-ttu-id="2b39a-104">組合字元串是撰寫視窗中的目前文字。</span><span class="sxs-lookup"><span data-stu-id="2b39a-104">The composition string is the current text in the composition window.</span></span> <span data-ttu-id="2b39a-105">這是 IME 轉換成最後字元的文字。</span><span class="sxs-lookup"><span data-stu-id="2b39a-105">This is the text that the IME converts to final characters.</span></span> <span data-ttu-id="2b39a-106">每個組合字元串都包含一個或多個「子句」。</span><span class="sxs-lookup"><span data-stu-id="2b39a-106">Each composition string consists of one or more "clauses".</span></span> <span data-ttu-id="2b39a-107">子句是 IME 可以轉換成最後一個字元的最小字元組合。</span><span class="sxs-lookup"><span data-stu-id="2b39a-107">A clause is the smallest combination of characters that the IME can convert to a final character.</span></span> <span data-ttu-id="2b39a-108">為了取得並設定組合字元串，應用程式會分別呼叫 [**ImmGetCompositionString**](/windows/desktop/api/Imm/nf-imm-immgetcompositionstringa) 和 [**ImmSetCompositionString**](/windows/desktop/api/Imm/nf-imm-immsetcompositionstringa) 函數。</span><span class="sxs-lookup"><span data-stu-id="2b39a-108">To get and set the composition string, the application calls the [**ImmGetCompositionString**](/windows/desktop/api/Imm/nf-imm-immgetcompositionstringa) and [**ImmSetCompositionString**](/windows/desktop/api/Imm/nf-imm-immsetcompositionstringa) functions, respectively.</span></span>

<span data-ttu-id="2b39a-109">當使用者在撰寫視窗中輸入文字時，IME 會追蹤組合字元串的狀態。</span><span class="sxs-lookup"><span data-stu-id="2b39a-109">As the user enters text in the composition window, the IME tracks the status of the composition string.</span></span> <span data-ttu-id="2b39a-110">此狀態包括屬性資訊、子句資訊、輸入資訊和游標位置。</span><span class="sxs-lookup"><span data-stu-id="2b39a-110">This status includes attribute information, clause information, typing information, and cursor position.</span></span> <span data-ttu-id="2b39a-111">應用程式可以使用 [**ImmGetCompositionString**](/windows/desktop/api/Imm/nf-imm-immgetcompositionstringa) 函數來取得撰寫狀態。</span><span class="sxs-lookup"><span data-stu-id="2b39a-111">The application can retrieve the composition status by using the [**ImmGetCompositionString**](/windows/desktop/api/Imm/nf-imm-immgetcompositionstringa) function.</span></span>

<span data-ttu-id="2b39a-112">屬性資訊會轉譯成8位值的陣列，這些值會指定組合字元串中的字元狀態。</span><span class="sxs-lookup"><span data-stu-id="2b39a-112">Attribute information is rendered in an array of 8-bit values that specifies the status of characters in the composition string.</span></span> <span data-ttu-id="2b39a-113">一個子句的所有字元都必須具有相同的屬性。</span><span class="sxs-lookup"><span data-stu-id="2b39a-113">All characters of one clause must have the same attribute.</span></span> <span data-ttu-id="2b39a-114">陣列中的每個位元組都包含一個值，其中每個位元組都包含一個位元組，而字串中任何雙位元組字元的第二個位元組。</span><span class="sxs-lookup"><span data-stu-id="2b39a-114">The array includes one value for each byte in the string, including one byte each for the lead and second bytes of any double-byte characters in the string.</span></span> <span data-ttu-id="2b39a-115">針對陣列中的每個值，位0至3可以是下列值的其中一個組合。</span><span class="sxs-lookup"><span data-stu-id="2b39a-115">For each value in the array, bits 0 through 3 can be one combination of the following values.</span></span>



| <span data-ttu-id="2b39a-116">值</span><span class="sxs-lookup"><span data-stu-id="2b39a-116">Value</span></span>                      | <span data-ttu-id="2b39a-117">意義</span><span class="sxs-lookup"><span data-stu-id="2b39a-117">Meaning</span></span>                                                                                                   |
|----------------------------|-----------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="2b39a-118">ATTR \_ 輸入</span><span class="sxs-lookup"><span data-stu-id="2b39a-118">ATTR\_INPUT</span></span>                | <span data-ttu-id="2b39a-119">使用者輸入的字元。</span><span class="sxs-lookup"><span data-stu-id="2b39a-119">Character being entered by the user.</span></span> <span data-ttu-id="2b39a-120">輸入法尚未轉換此字元。</span><span class="sxs-lookup"><span data-stu-id="2b39a-120">The IME has yet to convert this character.</span></span>                           |
| <span data-ttu-id="2b39a-121">ATTR \_ 輸入 \_ 錯誤</span><span class="sxs-lookup"><span data-stu-id="2b39a-121">ATTR\_INPUT\_ERROR</span></span>         | <span data-ttu-id="2b39a-122">IME 無法轉換的錯誤字元。</span><span class="sxs-lookup"><span data-stu-id="2b39a-122">An error character that the IME cannot convert.</span></span> <span data-ttu-id="2b39a-123">例如，輸入法不能將部分子音放在一起。</span><span class="sxs-lookup"><span data-stu-id="2b39a-123">For example, the IME cannot put together some consonants.</span></span> |
| <span data-ttu-id="2b39a-124">已 \_ 轉換 ATTR 目標 \_</span><span class="sxs-lookup"><span data-stu-id="2b39a-124">ATTR\_TARGET\_CONVERTED</span></span>    | <span data-ttu-id="2b39a-125">使用者選取的字元，然後由 IME 進行轉換。</span><span class="sxs-lookup"><span data-stu-id="2b39a-125">Character selected by the user and then converted by the IME.</span></span>                                             |
| <span data-ttu-id="2b39a-126">已 \_ 轉換 ATTR</span><span class="sxs-lookup"><span data-stu-id="2b39a-126">ATTR\_CONVERTED</span></span>            | <span data-ttu-id="2b39a-127">IME 已轉換的字元。</span><span class="sxs-lookup"><span data-stu-id="2b39a-127">Character that the IME has already converted.</span></span>                                                             |
| <span data-ttu-id="2b39a-128">ATTR \_ 目標 \_ NOTCONVERTED</span><span class="sxs-lookup"><span data-stu-id="2b39a-128">ATTR\_TARGET\_NOTCONVERTED</span></span> | <span data-ttu-id="2b39a-129">要轉換的字元。</span><span class="sxs-lookup"><span data-stu-id="2b39a-129">Character being converted.</span></span> <span data-ttu-id="2b39a-130">使用者已選取此字元，但輸入法尚未轉換。</span><span class="sxs-lookup"><span data-stu-id="2b39a-130">The user has selected this character but the IME has not yet converted it.</span></span>     |
| <span data-ttu-id="2b39a-131">ATTR \_ FIXEDCONVERTED</span><span class="sxs-lookup"><span data-stu-id="2b39a-131">ATTR\_FIXEDCONVERTED</span></span>       | <span data-ttu-id="2b39a-132">輸入法將不再轉換的字元。</span><span class="sxs-lookup"><span data-stu-id="2b39a-132">Characters that the IME will no longer convert.</span></span>                                                           |



 

<span data-ttu-id="2b39a-133">所有其他值都是保留的。</span><span class="sxs-lookup"><span data-stu-id="2b39a-133">All other values are reserved.</span></span> <span data-ttu-id="2b39a-134">在日文中，任何具有 ATTR \_ 輸入屬性的未轉換字元都是平假名、片假名或英數位元。</span><span class="sxs-lookup"><span data-stu-id="2b39a-134">In Japanese, any unconverted character having the ATTR\_INPUT attribute is a hiragana, katakana, or alphanumeric character.</span></span> <span data-ttu-id="2b39a-135">在韓文中，這個屬性代表 IME 尚未轉換的韓文字元。</span><span class="sxs-lookup"><span data-stu-id="2b39a-135">In Korean, this attribute represents a Hangul character that the IME has not yet converted.</span></span> <span data-ttu-id="2b39a-136">在繁體中文和簡體中文中，每個 IME 都可以限制其在某個範圍內的字元。</span><span class="sxs-lookup"><span data-stu-id="2b39a-136">In Traditional Chinese and Simplified Chinese, each IME can limit its character within some range.</span></span>

<span data-ttu-id="2b39a-137">組合字元串狀態中包含的子句資訊是32位值的陣列，可指定子句在組合字元串中的位置。</span><span class="sxs-lookup"><span data-stu-id="2b39a-137">The clause information included in the composition string status is an array of 32-bit values that specifies the positions of the clauses in the composition string.</span></span> <span data-ttu-id="2b39a-138">陣列包含每個子句的一個值，以及指定完整字串長度的最後一個值。</span><span class="sxs-lookup"><span data-stu-id="2b39a-138">The array includes one value for each clause and a final value that specifies the length of the full string.</span></span> <span data-ttu-id="2b39a-139">陣列中的每個值都會指定從字串開頭到子句的位移（以位元組為單位）。</span><span class="sxs-lookup"><span data-stu-id="2b39a-139">Each value in the array specifies the offset, in bytes, from the beginning of the string to the clause.</span></span> <span data-ttu-id="2b39a-140">第一個值一律為0，因為第一個子句一律會從字串的開頭開始。</span><span class="sxs-lookup"><span data-stu-id="2b39a-140">The first value is always 0 because the first clause always starts at the beginning of the string.</span></span> <span data-ttu-id="2b39a-141">例如，如果字串有兩個子句，子句資訊會有三個值：第一個值是0，第二個值是第二個子句的位移，而第三個值是字串的長度。</span><span class="sxs-lookup"><span data-stu-id="2b39a-141">For example, if a string has two clauses, the clause information has three values: the first value is 0, the second value is the offset of the second clause, and the third value is the length of the string.</span></span> <span data-ttu-id="2b39a-142">若為 Unicode，子句的位置會以 Unicode 字元計算，而字串的長度則為 Unicode 字元的大小。</span><span class="sxs-lookup"><span data-stu-id="2b39a-142">For Unicode, the position of a clause is counted in Unicode characters, and the length of a string is the size in Unicode characters.</span></span>

<span data-ttu-id="2b39a-143">組合字元串狀態中包含的輸入資訊是以 null 結束的字元字串，代表使用者在鍵盤上輸入的字元。</span><span class="sxs-lookup"><span data-stu-id="2b39a-143">The typing information included in the composition string status is a null-terminated character string representing the characters that the user enters at the keyboard.</span></span>

<span data-ttu-id="2b39a-144">組合字元串狀態中包含的資料指標位置是一個值，表示游標相對於組合字元串中字元的位置。</span><span class="sxs-lookup"><span data-stu-id="2b39a-144">The cursor position included in the composition string status is a value indicating the position of the cursor relative to the characters in the composition string.</span></span> <span data-ttu-id="2b39a-145">值是從字串開頭算起的位移（以位元組為單位）。</span><span class="sxs-lookup"><span data-stu-id="2b39a-145">The value is the offset, in bytes, from the beginning of the string.</span></span> <span data-ttu-id="2b39a-146">如果這個值為0，則資料指標緊接在字串中的第一個字元之前。</span><span class="sxs-lookup"><span data-stu-id="2b39a-146">If this value is 0, the cursor is immediately before the first character in the string.</span></span> <span data-ttu-id="2b39a-147">如果值等於字串的長度，則資料指標緊接在最後一個字元之後。</span><span class="sxs-lookup"><span data-stu-id="2b39a-147">If the value is equal to the length of the string, the cursor is immediately after the last character.</span></span> <span data-ttu-id="2b39a-148">如果值為1，表示資料指標不存在。</span><span class="sxs-lookup"><span data-stu-id="2b39a-148">If the value is 1, the cursor is not present.</span></span> <span data-ttu-id="2b39a-149">若為 Unicode，則會以 Unicode 字元來測量位置和長度。</span><span class="sxs-lookup"><span data-stu-id="2b39a-149">For Unicode, both position and length are measured in Unicode characters.</span></span>

<span data-ttu-id="2b39a-150">您的應用程式可以使用 [**ImmSetCompositionString**](/windows/desktop/api/Imm/nf-imm-immsetcompositionstringa) 函式，設定組合字元串或組合狀態的元素。</span><span class="sxs-lookup"><span data-stu-id="2b39a-150">Your application can set the composition string or elements of the composition status by using the [**ImmSetCompositionString**](/windows/desktop/api/Imm/nf-imm-immsetcompositionstringa) function.</span></span> <span data-ttu-id="2b39a-151">為了確保撰寫視窗根據這些變更來更新其外觀，此函式可讓應用程式將通知訊息傳送至視窗。</span><span class="sxs-lookup"><span data-stu-id="2b39a-151">To ensure that the composition window updates its appearance based on these changes, the function allows the application to send a notification message to the window.</span></span> <span data-ttu-id="2b39a-152">設定組合狀態專案組合的應用程式通常會停用此函式的所有通知（除了最後一次呼叫此函式），如此一來，撰寫視窗只會產生一個通知訊息。</span><span class="sxs-lookup"><span data-stu-id="2b39a-152">Applications that set a combination of composition status elements typically disable notifications for all but the last call to this function so that only one notification message is generated for the composition window.</span></span>

<span data-ttu-id="2b39a-153">最後，編輯控制項支援兩個訊息來變更輸入法的組合字元串處理。</span><span class="sxs-lookup"><span data-stu-id="2b39a-153">Finally, the edit control supports two messages for changing the handling of composition strings by the IME.</span></span> <span data-ttu-id="2b39a-154">如需詳細資訊，請參閱 [**em \_ GETIMESTATUS**](../controls/em-getimestatus.md) 和 [**em \_ SETIMESTATUS**](../controls/em-setimestatus.md)。</span><span class="sxs-lookup"><span data-stu-id="2b39a-154">For more information, see [**EM\_GETIMESTATUS**](../controls/em-getimestatus.md) and [**EM\_SETIMESTATUS**](../controls/em-setimestatus.md).</span></span> <span data-ttu-id="2b39a-155">如需編輯控制項的詳細資訊，請參閱 [編輯控制項](../controls/edit-controls.md)。</span><span class="sxs-lookup"><span data-stu-id="2b39a-155">For more information on the edit control, see [Edit Control](../controls/edit-controls.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="2b39a-156">相關主題</span><span class="sxs-lookup"><span data-stu-id="2b39a-156">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="2b39a-157">關於輸入方法管理員</span><span class="sxs-lookup"><span data-stu-id="2b39a-157">About Input Method Manager</span></span>](about-input-method-manager.md)
</dt> </dl>

 

 
