---
description: 下表摘要說明 Windows Vista 和 Windows XP 關機之間的差異。
ms.assetid: da7985d2-85c8-47e1-a172-c9e92f450e24
title: Windows Vista 的關機變更
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6e04bb20099349ce378384cf01c39e53ca03a896
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "104026801"
---
# <a name="shutdown-changes-for-windows-vista"></a><span data-ttu-id="650d7-103">Windows Vista 的關機變更</span><span class="sxs-lookup"><span data-stu-id="650d7-103">Shutdown Changes for Windows Vista</span></span>

<span data-ttu-id="650d7-104">下表摘要說明 Windows Vista 和 Windows XP 關機之間的差異。</span><span class="sxs-lookup"><span data-stu-id="650d7-104">The following table summarizes the differences between shutdown on Windows Vista and Windows XP.</span></span>



| <span data-ttu-id="650d7-105">功能</span><span class="sxs-lookup"><span data-stu-id="650d7-105">Feature</span></span>                 | <span data-ttu-id="650d7-106">Windows XP</span><span class="sxs-lookup"><span data-stu-id="650d7-106">Windows XP</span></span>                                                                                                                                                                                                                                                                                                                                                                                | <span data-ttu-id="650d7-107">Windows Vista</span><span class="sxs-lookup"><span data-stu-id="650d7-107">Windows Vista</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|-------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="650d7-108">封鎖關機</span><span class="sxs-lookup"><span data-stu-id="650d7-108">Blocking shutdown</span></span>       | <span data-ttu-id="650d7-109">應用程式可能會延遲5秒回應 [**WM \_ QUERYENDSESSION**](wm-queryendsession.md) ，然後系統可讓使用者終止應用程式。</span><span class="sxs-lookup"><span data-stu-id="650d7-109">Applications can delay responding to [**WM\_QUERYENDSESSION**](wm-queryendsession.md) for 5 seconds, then the system allows the user to terminate the application.</span></span> <span data-ttu-id="650d7-110">傳回 **TRUE** 以回應 **wm \_ QUERYENDSESSION** 的應用程式，可能會延遲5秒回應 [**wm \_ ENDSESSION**](wm-endsession.md) ，然後系統可讓使用者終止應用程式。</span><span class="sxs-lookup"><span data-stu-id="650d7-110">Applications that return **TRUE** in response to **WM\_QUERYENDSESSION** can delay responding to [**WM\_ENDSESSION**](wm-endsession.md) for 5 seconds, then the system allows the user to terminate the application.</span></span> | <span data-ttu-id="650d7-111">應用程式可能會延遲5秒回應 [**WM \_ QUERYENDSESSION**](wm-queryendsession.md) ，然後系統可讓使用者繼續或取消關機。</span><span class="sxs-lookup"><span data-stu-id="650d7-111">Applications can delay responding to [**WM\_QUERYENDSESSION**](wm-queryendsession.md) for 5 seconds, then the system allows the user to continue or cancel shutdown.</span></span> <span data-ttu-id="650d7-112">傳回 **TRUE** 以回應 **wm \_ QUERYENDSESSION** 的應用程式，可能會延遲5秒回應 [**wm \_ ENDSESSION**](wm-endsession.md) ，然後系統可讓使用者繼續或取消關機。</span><span class="sxs-lookup"><span data-stu-id="650d7-112">Applications that return **TRUE** in response to **WM\_QUERYENDSESSION** can delay responding to [**WM\_ENDSESSION**](wm-endsession.md) for 5 seconds, then the system allows the user to continue or cancel shutdown.</span></span>                                                                                                      |
| <span data-ttu-id="650d7-113">取消關機</span><span class="sxs-lookup"><span data-stu-id="650d7-113">Canceling shutdown</span></span>      | <span data-ttu-id="650d7-114">如果應用程式在回應 [**WM \_ QUERYENDSESSION**](wm-queryendsession.md)時傳回 **FALSE** ，在大部分情況下都會取消關閉。</span><span class="sxs-lookup"><span data-stu-id="650d7-114">If an application returns **FALSE** in response to [**WM\_QUERYENDSESSION**](wm-queryendsession.md), shutdown is canceled in most cases.</span></span> <span data-ttu-id="650d7-115">但是，不會顯示任何 UI，因此使用者可能不會察覺到關機已取消。</span><span class="sxs-lookup"><span data-stu-id="650d7-115">However, no UI is displayed, so the user may not be aware that shutdown has been canceled.</span></span>                                                                                                                                                      | <span data-ttu-id="650d7-116">如果應用程式傳回 **FALSE** 以回應 [**WM \_ QUERYENDSESSION**](wm-queryendsession.md)，它仍然會出現在關機 UI 中。</span><span class="sxs-lookup"><span data-stu-id="650d7-116">If an application returns **FALSE** in response to [**WM\_QUERYENDSESSION**](wm-queryendsession.md), it still appears in the shutdown UI.</span></span> <span data-ttu-id="650d7-117">請注意，系統不允許沒有可見視窗的主控台應用程式或應用程式取消關閉。</span><span class="sxs-lookup"><span data-stu-id="650d7-117">Note that the system does not allow console applications or applications without a visible window to cancel shutdown.</span></span> <span data-ttu-id="650d7-118">如果這些應用程式不會在5秒內回應 **wm \_ QUERYENDSESSION** 或 [**WM \_ ENDSESSION**](wm-endsession.md) ，或在回應 **wm \_ QUERYENDSESSION** 時傳回 **FALSE** ，則會自動終止這些應用程式。</span><span class="sxs-lookup"><span data-stu-id="650d7-118">These applications are automatically terminated if they do not respond to **WM\_QUERYENDSESSION** or [**WM\_ENDSESSION**](wm-endsession.md) within 5 seconds or if they return **FALSE** in response to **WM\_QUERYENDSESSION**.</span></span> |
| <span data-ttu-id="650d7-119">關機使用者介面</span><span class="sxs-lookup"><span data-stu-id="650d7-119">Shutdown user interface</span></span> | <span data-ttu-id="650d7-120">系統會顯示每個應用程式封鎖關機的對話方塊。</span><span class="sxs-lookup"><span data-stu-id="650d7-120">The system displays a dialog box for each application blocking shutdown.</span></span> <span data-ttu-id="650d7-121">如果使用者按一下 [ **立即結束** ] 按鈕，就會終止應用程式。</span><span class="sxs-lookup"><span data-stu-id="650d7-121">If the user click the **End Now** button, the application is terminated.</span></span> <span data-ttu-id="650d7-122">如果使用者按一下 [ **取消** ] 按鈕，就會取消關機，而應用程式會繼續執行。</span><span class="sxs-lookup"><span data-stu-id="650d7-122">If the user clicks the **Cancel** button, shutdown is canceled and the application continues to run.</span></span>                                                                                                                                    | <span data-ttu-id="650d7-123">系統會顯示全螢幕 UI，可識別封鎖關機的所有應用程式，以及其在使用 [**ShutdownBlockReasonCreate**](/windows/desktop/api/Winuser/nf-winuser-shutdownblockreasoncreate)) 註冊原因時 (的原因。</span><span class="sxs-lookup"><span data-stu-id="650d7-123">The system displays a full-screen UI that identifies all applications blocking shutdown and their reasons for doing so (if they have registered a reason using [**ShutdownBlockReasonCreate**](/windows/desktop/api/Winuser/nf-winuser-shutdownblockreasoncreate)).</span></span>                                                                                                                                                                                                                                                                    |



 

## <a name="best-practices"></a><span data-ttu-id="650d7-124">最佳做法</span><span class="sxs-lookup"><span data-stu-id="650d7-124">Best Practices</span></span>

-   <span data-ttu-id="650d7-125">應用程式不應封鎖關機。</span><span class="sxs-lookup"><span data-stu-id="650d7-125">Applications should not block shutdown.</span></span> <span data-ttu-id="650d7-126">儘快回應 [**wm \_ QUERYENDSESSION**](wm-queryendsession.md) ，並延後清除活動，直到處理 [**WM \_ ENDSESSION**](wm-endsession.md) 訊息為止。</span><span class="sxs-lookup"><span data-stu-id="650d7-126">Respond to [**WM\_QUERYENDSESSION**](wm-queryendsession.md) as quickly as possible and postpone cleanup activities until processing the [**WM\_ENDSESSION**](wm-endsession.md) message.</span></span>
-   <span data-ttu-id="650d7-127">必須封鎖關機的應用程式應該使用新的 [**ShutdownBlockReasonCreate**](/windows/desktop/api/Winuser/nf-winuser-shutdownblockreasoncreate) 函式來註冊說明使用者原因的字串。</span><span class="sxs-lookup"><span data-stu-id="650d7-127">Applications that must block shutdown should use the new [**ShutdownBlockReasonCreate**](/windows/desktop/api/Winuser/nf-winuser-shutdownblockreasoncreate) function to register a string that explains the reason to the user.</span></span> <span data-ttu-id="650d7-128">使用者可以決定是要繼續還是取消關機。</span><span class="sxs-lookup"><span data-stu-id="650d7-128">The user can decide whether to continue or cancel shutdown.</span></span>
-   <span data-ttu-id="650d7-129">應用程式無法依賴無法封鎖關機。</span><span class="sxs-lookup"><span data-stu-id="650d7-129">Applications cannot rely on being able to block shutdown.</span></span>

 

 



