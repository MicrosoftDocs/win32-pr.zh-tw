---
title: 資料通知
description: 當來源中的資料變更時，使用來自外部來源之資料的物件有時需要獲得通知。
ms.assetid: 286a1ecf-5255-4443-a17d-5ffa55ed0be1
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 49df9e6bb7d9b15192473b18114fe7fcd69ecedf
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/21/2020
ms.locfileid: "106990898"
---
# <a name="data-notification"></a><span data-ttu-id="d67e9-103">資料通知</span><span class="sxs-lookup"><span data-stu-id="d67e9-103">Data Notification</span></span>

<span data-ttu-id="d67e9-104">當來源中的資料變更時，使用來自外部來源之資料的物件有時需要獲得通知。</span><span class="sxs-lookup"><span data-stu-id="d67e9-104">Objects that consume data from an external source sometimes need to be informed when data in that source changes.</span></span> <span data-ttu-id="d67e9-105">例如，以某些試算表中資料為依據的股票行情，需要在資料變更時收到通知，讓它可以更新其顯示。</span><span class="sxs-lookup"><span data-stu-id="d67e9-105">For example, a stock ticker tape viewer that relies on data in some spreadsheet needs to be notified when that data changes so it can update its display.</span></span> <span data-ttu-id="d67e9-106">同樣地，複合檔案需要其内嵌物件中資料變更的相關資訊，使其可以更新其資料快取。</span><span class="sxs-lookup"><span data-stu-id="d67e9-106">Similarly, a compound document needs information about data changes in its embedded objects so that it can update its data caches.</span></span> <span data-ttu-id="d67e9-107">在這種情況下，需要動態更新資料的情況下，資料來源需要一些機制來通知資料取用者發生變更，而不強制取用者來捨棄所有專案，以便更新其資料。</span><span class="sxs-lookup"><span data-stu-id="d67e9-107">In cases such as this, where dynamic updating of data is desirable, sources of data require some mechanism of notifying data consumers of changes as they occur without obligating the consumers to drop everything in order to update their data.</span></span> <span data-ttu-id="d67e9-108">在理想的情況下，會在資料來源中收到變更的通知，取用的物件可在其休閒時要求更新的複本。</span><span class="sxs-lookup"><span data-stu-id="d67e9-108">Ideally, having been notified that a change has occurred in the data source, a consuming object can ask for an updated copy at its leisure.</span></span>

<span data-ttu-id="d67e9-109">用來處理這種類型之非同步通知的 COM 機制，就是稱為「建議接收」的物件，它只是任何會實 [**IAdviseSink**](/windows/desktop/api/ObjIdl/nn-objidl-iadvisesink)介面的 com 物件。</span><span class="sxs-lookup"><span data-stu-id="d67e9-109">COM's mechanism for handling asynchronous notifications of this type is an object called an advise sink, which is simply any COM object that implements an interface called [**IAdviseSink**](/windows/desktop/api/ObjIdl/nn-objidl-iadvisesink).</span></span> <span data-ttu-id="d67e9-110">資料的取用者會執行 **IAdviseSink**。</span><span class="sxs-lookup"><span data-stu-id="d67e9-110">Consumers of data implement the **IAdviseSink**.</span></span> <span data-ttu-id="d67e9-111">他們會藉由將指標傳給感興趣的資料物件來進行註冊，以接收通知。</span><span class="sxs-lookup"><span data-stu-id="d67e9-111">They register to receive notifications by handing a pointer to the data object of interest.</span></span>

<span data-ttu-id="d67e9-112">[**IAdviseSink**](/windows/desktop/api/ObjIdl/nn-objidl-iadvisesink)介面會公開下列用來接收非同步通知的方法：</span><span class="sxs-lookup"><span data-stu-id="d67e9-112">The [**IAdviseSink**](/windows/desktop/api/ObjIdl/nn-objidl-iadvisesink) interfaces exposes the following methods for receiving asynchronous notifications:</span></span>



| <span data-ttu-id="d67e9-113">方法</span><span class="sxs-lookup"><span data-stu-id="d67e9-113">Method</span></span>                                                      | <span data-ttu-id="d67e9-114">通知通知接收</span><span class="sxs-lookup"><span data-stu-id="d67e9-114">Notifies the advise sink that</span></span>                                            |
|-------------------------------------------------------------|--------------------------------------------------------------------------|
| [<span data-ttu-id="d67e9-115">**OnDataChange**</span><span class="sxs-lookup"><span data-stu-id="d67e9-115">**OnDataChange**</span></span>](/windows/desktop/api/ObjIdl/nf-objidl-iadvisesink-ondatachange)<br/> | <span data-ttu-id="d67e9-116">呼叫物件的資料已經變更。</span><span class="sxs-lookup"><span data-stu-id="d67e9-116">The calling object's data has changed.</span></span><br/>                        |
| [<span data-ttu-id="d67e9-117">**OnViewChange**</span><span class="sxs-lookup"><span data-stu-id="d67e9-117">**OnViewChange**</span></span>](/windows/desktop/api/ObjIdl/nf-objidl-iadvisesink-onviewchange)<br/> | <span data-ttu-id="d67e9-118">繪製呼叫物件的指示已經變更。</span><span class="sxs-lookup"><span data-stu-id="d67e9-118">The instructions for drawing the calling object have changed.</span></span><br/> |
| [<span data-ttu-id="d67e9-119">**OnRename**</span><span class="sxs-lookup"><span data-stu-id="d67e9-119">**OnRename**</span></span>](/windows/desktop/api/ObjIdl/nf-objidl-iadvisesink-onrename)<br/>         | <span data-ttu-id="d67e9-120">呼叫物件的標記已變更。</span><span class="sxs-lookup"><span data-stu-id="d67e9-120">The calling object's moniker has changed.</span></span><br/>                     |
| [<span data-ttu-id="d67e9-121">**OnSave**</span><span class="sxs-lookup"><span data-stu-id="d67e9-121">**OnSave**</span></span>](/windows/desktop/api/ObjIdl/nf-objidl-iadvisesink-onsave)<br/>             | <span data-ttu-id="d67e9-122">呼叫物件已儲存至持續性儲存體。</span><span class="sxs-lookup"><span data-stu-id="d67e9-122">The calling object has been saved to persistent storage.</span></span><br/>      |
| [<span data-ttu-id="d67e9-123">**OnClose**</span><span class="sxs-lookup"><span data-stu-id="d67e9-123">**OnClose**</span></span>](/windows/desktop/api/ObjIdl/nf-objidl-iadvisesink-onclose)<br/>           | <span data-ttu-id="d67e9-124">呼叫物件已關閉。</span><span class="sxs-lookup"><span data-stu-id="d67e9-124">The calling object has been closed.</span></span><br/>                           |



 

<span data-ttu-id="d67e9-125">如資料表所示， [**IAdviseSink**](/windows/desktop/api/ObjIdl/nn-objidl-iadvisesink) 介面會公開方法，以在呼叫物件資料中的變更以外，通知通知接收的事件。</span><span class="sxs-lookup"><span data-stu-id="d67e9-125">As the table indicates, the [**IAdviseSink**](/windows/desktop/api/ObjIdl/nn-objidl-iadvisesink) interface exposes methods for notifying the advise sink of events other than changes in the calling object's data.</span></span> <span data-ttu-id="d67e9-126">呼叫物件也可以在其繪製本身變更的方式中通知接收，或是重新命名、儲存或關閉。</span><span class="sxs-lookup"><span data-stu-id="d67e9-126">The calling object can also notify the sink when the way in which it draws itself changes, or it is renamed, saved, or closed.</span></span> <span data-ttu-id="d67e9-127">這些其他通知主要是在複合檔案的內容中使用，雖然通知機制相同。</span><span class="sxs-lookup"><span data-stu-id="d67e9-127">These other notifications are used mainly or entirely in the context of compound documents, although the notification mechanism is identical.</span></span> <span data-ttu-id="d67e9-128">如需複合檔案通知的詳細資訊，請參閱「複合檔案」。</span><span class="sxs-lookup"><span data-stu-id="d67e9-128">For more information on compound-document notifications, see "Compound Documents."</span></span>

<span data-ttu-id="d67e9-129">為了充分利用「建議」接收，資料來源必須執行 [**IDataObject：:D 的建議**](/windows/desktop/api/ObjIdl/nf-objidl-idataobject-dadvise)、 [**IDataObject：:D unadvise**](/windows/desktop/api/ObjIdl/nf-objidl-idataobject-dunadvise)和 [**IDataObject：： EnumDAdvise**](/windows/desktop/api/ObjIdl/nf-objidl-idataobject-enumdadvise)。</span><span class="sxs-lookup"><span data-stu-id="d67e9-129">In order to take advantage of the advise sink, a data source must implement [**IDataObject::DAdvise**](/windows/desktop/api/ObjIdl/nf-objidl-idataobject-dadvise), [**IDataObject::DUnadvise**](/windows/desktop/api/ObjIdl/nf-objidl-idataobject-dunadvise), and [**IDataObject::EnumDAdvise**](/windows/desktop/api/ObjIdl/nf-objidl-idataobject-enumdadvise).</span></span> <span data-ttu-id="d67e9-130">資料取用者會呼叫 **DAdvise** mothod 來通知資料物件，以便在物件的資料變更時收到通知。</span><span class="sxs-lookup"><span data-stu-id="d67e9-130">A data consumer calls the **DAdvise** mothod to notify a data object that it wishes to be notified when the object's data changes.</span></span> <span data-ttu-id="d67e9-131">取用物件會呼叫 **DUnadvise** 方法來卸載此連接。</span><span class="sxs-lookup"><span data-stu-id="d67e9-131">The consuming object calls the **DUnadvise** method to tear down this connection.</span></span> <span data-ttu-id="d67e9-132">任何有興趣的合作物件都可以呼叫 **EnumDAdvise** 方法，以瞭解具有資料物件之諮詢連接的物件數目。</span><span class="sxs-lookup"><span data-stu-id="d67e9-132">Any interested party can call the **EnumDAdvise** method to learn the number of objects having an advisory connection with a data object.</span></span>

<span data-ttu-id="d67e9-133">當資料在來源上變更時，資料物件會在已註冊要接收通知的所有資料取用者上呼叫 [**IAdviseSink：： OnDataChange**](/windows/desktop/api/ObjIdl/nf-objidl-iadvisesink-ondatachange) 。</span><span class="sxs-lookup"><span data-stu-id="d67e9-133">When data changes at the source, the data object calls [**IAdviseSink::OnDataChange**](/windows/desktop/api/ObjIdl/nf-objidl-iadvisesink-ondatachange) on all data consumers that have registered to receive notifications.</span></span> <span data-ttu-id="d67e9-134">為了追蹤諮詢連接，以及管理通知分派，資料來源會依賴稱為 *資料建議者* 的物件。</span><span class="sxs-lookup"><span data-stu-id="d67e9-134">To keep track of advisory connections and manage the dispatch of notifications, data sources rely on an object called a *data advise holder*.</span></span> <span data-ttu-id="d67e9-135">您可以藉由執行 [**IDataAdviseHolder**](/windows/desktop/api/ObjIdl/nn-objidl-idataadviseholder) 介面來建立您自己的資料建議者。</span><span class="sxs-lookup"><span data-stu-id="d67e9-135">You can create your own data advise holder by implementing the [**IDataAdviseHolder**](/windows/desktop/api/ObjIdl/nn-objidl-idataadviseholder) interface.</span></span> <span data-ttu-id="d67e9-136">或者，您可以藉由呼叫 helper 函數 [**CreateDataAdviseHolder**](/windows/win32/api/ole2/nf-ole2-createdataadviseholder)，讓 COM 為您完成。</span><span class="sxs-lookup"><span data-stu-id="d67e9-136">Or, you can let COM do it for you by calling the helper function [**CreateDataAdviseHolder**](/windows/win32/api/ole2/nf-ole2-createdataadviseholder).</span></span>

## <a name="related-topics"></a><span data-ttu-id="d67e9-137">相關主題</span><span class="sxs-lookup"><span data-stu-id="d67e9-137">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="d67e9-138">資料轉送</span><span class="sxs-lookup"><span data-stu-id="d67e9-138">Data Transfer</span></span>](data-transfer.md)
</dt> </dl>

 

