---
title: 持續性
description: 持續性
ms.assetid: 4916ea52-a21c-4938-81cb-392b5ca1f6c1
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c6cffab1c9a0f2746e57e356a90698caf9903deb
ms.sourcegitcommit: f848119a8faa29b27585f4df53f6e50ee9666684
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 05/27/2021
ms.locfileid: "110549283"
---
# <a name="persistence"></a><span data-ttu-id="e201d-103">持續性</span><span class="sxs-lookup"><span data-stu-id="e201d-103">Persistence</span></span>

<span data-ttu-id="e201d-104">控制項會執行多個持續性介面中的一或多個，以支援其狀態的持續性。</span><span class="sxs-lookup"><span data-stu-id="e201d-104">A control implements one or more of several persistence interfaces to support persistence of its state.</span></span> <span data-ttu-id="e201d-105">例如， [**IPersistStreamInit**](/windows/desktop/api/OCIdl/nn-ocidl-ipersiststreaminit) 介面支援以資料流程為基礎的控制項狀態持續性。</span><span class="sxs-lookup"><span data-stu-id="e201d-105">For example, the [**IPersistStreamInit**](/windows/desktop/api/OCIdl/nn-ocidl-ipersiststreaminit) interface supports stream-based persistence of the control's state.</span></span> <span data-ttu-id="e201d-106">**IPersistStreamInit** 是 [**IPersistStream**](/windows/desktop/api/ObjIdl/nn-objidl-ipersiststream) 的取代，並新增 [**InitNew**](/windows/desktop/api/OCIdl/nf-ocidl-ipersiststreaminit-initnew)的初始化方法。</span><span class="sxs-lookup"><span data-stu-id="e201d-106">**IPersistStreamInit** is a replacement for [**IPersistStream**](/windows/desktop/api/ObjIdl/nn-objidl-ipersiststream) and adds an initialization method, [**InitNew**](/windows/desktop/api/OCIdl/nf-ocidl-ipersiststreaminit-initnew).</span></span> <span data-ttu-id="e201d-107">這兩個介面中的其他方法都相同。</span><span class="sxs-lookup"><span data-stu-id="e201d-107">The other methods are the same in both interfaces.</span></span> <span data-ttu-id="e201d-108">**IPersistStreamInit** 並非衍生自 **IPersistStream**;物件只支援兩個介面的其中一個，根據是否需要能夠初始化本身的新實例。</span><span class="sxs-lookup"><span data-stu-id="e201d-108">**IPersistStreamInit** is not derived from **IPersistStream**; an object supports only one of the two interfaces based on whether it requires the ability to initialize new instances of itself.</span></span>

<span data-ttu-id="e201d-109">控制項可提供的其他持續性介面包括： [**IPersistStorage**](/windows/desktop/api/ObjIdl/nn-objidl-ipersiststorage)、 [**IPersistMemory**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa768210(v=vs.85))、 [**IPersistPropertyBag**](/windows/win32/api/ocidl/nn-ocidl-ipersistpropertybag)、 [**IPersistMoniker**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775042(v=vs.85))。</span><span class="sxs-lookup"><span data-stu-id="e201d-109">Other persistence interfaces that a control can offer include: [**IPersistStorage**](/windows/desktop/api/ObjIdl/nn-objidl-ipersiststorage), [**IPersistMemory**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa768210(v=vs.85)), [**IPersistPropertyBag**](/windows/win32/api/ocidl/nn-ocidl-ipersistpropertybag), [**IPersistMoniker**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775042(v=vs.85)).</span></span> <span data-ttu-id="e201d-110">控制項實施者必須決定哪些類型的持續性最重要，並執行適當的持續性介面。</span><span class="sxs-lookup"><span data-stu-id="e201d-110">The control implementer must decide what kinds of persistence are most important and implement the appropriate persistence interfaces.</span></span> <span data-ttu-id="e201d-111">控制項實施者也會決定要儲存的內容。</span><span class="sxs-lookup"><span data-stu-id="e201d-111">The control implementer also decides what to save.</span></span> <span data-ttu-id="e201d-112">例如，控制項可以儲存其屬性的目前值，或其在其容器內的位置和大小。</span><span class="sxs-lookup"><span data-stu-id="e201d-112">For example, a control can save the current values of its properties or its location and size within its container.</span></span> <span data-ttu-id="e201d-113">用戶端會決定要使用的介面。</span><span class="sxs-lookup"><span data-stu-id="e201d-113">The client decides which interface it prefers to use.</span></span>

<span data-ttu-id="e201d-114">從持續性狀態載入控制項之前，用戶端可以檢查 OLEMISC \_ SETCLIENTSITEFIRST 旗標，以判斷控制項是否支援在載入其持續狀態之前取得其用戶端網站和環境屬性。</span><span class="sxs-lookup"><span data-stu-id="e201d-114">Before loading a control from its persistent state, a client can check the OLEMISC\_SETCLIENTSITEFIRST flag to determine if the control supports getting its client site and ambient properties before loading its persistent state.</span></span> <span data-ttu-id="e201d-115">這項優化可以節省具現化控制項的時間，因為控制項接著可以自由忽略其持續性值，而不是只載入它們，讓用戶端所提供的環境屬性覆寫這些值。</span><span class="sxs-lookup"><span data-stu-id="e201d-115">This optimization can save time when instantiating a control since the control is then free to ignore its persistent values rather than loading them only to have them overridden by ambient properties supplied by the client.</span></span>

<span data-ttu-id="e201d-116">控制項也可以支援在 OLE 屬性集中儲存和還原其狀態，也就是指定格式的一組識別碼和值。</span><span class="sxs-lookup"><span data-stu-id="e201d-116">A control can also support saving and restoring its state in an OLE property set, a set of identifiers and values in a specified format.</span></span> <span data-ttu-id="e201d-117">這項功能對容器（例如 Visual Basic）很有用，可將其程式儲存為文字形式。</span><span class="sxs-lookup"><span data-stu-id="e201d-117">This feature can be useful with containers such as Visual Basic, which saves its programs in a textual form.</span></span> <span data-ttu-id="e201d-118">想要支援這項功能的控制項會實 [**IDataObject：：**](/windows/desktop/api/ObjIdl/nf-objidl-idataobject-getdata) IDataObject [**：： SetData**](/windows/desktop/api/ObjIdl/nf-objidl-idataobject-setdata) ，以將其屬性值分別傳遞至容器。</span><span class="sxs-lookup"><span data-stu-id="e201d-118">A control that wants to support this feature implements [**IDataObject::GetData**](/windows/desktop/api/ObjIdl/nf-objidl-idataobject-getdata) and [**IDataObject::SetData**](/windows/desktop/api/ObjIdl/nf-objidl-idataobject-setdata) to pass its property values to and from the container, respectively.</span></span> <span data-ttu-id="e201d-119">它是將此資訊轉換成文字並加以儲存的容器作業。</span><span class="sxs-lookup"><span data-stu-id="e201d-119">It is the container's job to convert this information to text and save it.</span></span> <span data-ttu-id="e201d-120">控制項使用的識別碼會對應至控制項的屬性名稱和值。</span><span class="sxs-lookup"><span data-stu-id="e201d-120">The identifiers used by the control correspond to the control's property names and the values.</span></span> <span data-ttu-id="e201d-121">請參閱 OLE CDK 以取得這個屬性集的定義。</span><span class="sxs-lookup"><span data-stu-id="e201d-121">See the OLE CDK for the definition of this property set.</span></span>

## <a name="related-topics"></a><span data-ttu-id="e201d-122">相關主題</span><span class="sxs-lookup"><span data-stu-id="e201d-122">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="e201d-123">ActiveX 控制項</span><span class="sxs-lookup"><span data-stu-id="e201d-123">ActiveX Controls</span></span>](activex-controls.md)
</dt> </dl>

 

 