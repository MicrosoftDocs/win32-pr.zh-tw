---
title: 持續性介面
description: 持續性介面
ms.assetid: a93582b3-bdbf-430d-b4a6-c0df7bc35dc0
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e72ef5f7381c6d58b9025f983ecd852b83661030
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/21/2020
ms.locfileid: "104093411"
---
# <a name="persistence-interfaces"></a><span data-ttu-id="f0135-103">持續性介面</span><span class="sxs-lookup"><span data-stu-id="f0135-103">Persistence Interfaces</span></span>

<span data-ttu-id="f0135-104">具有任何類型之持續性狀態的物件必須至少執行一個 IPersist \* 介面（最好是多個介面），才能為容器提供最具彈性的選擇來儲存控制項的狀態。</span><span class="sxs-lookup"><span data-stu-id="f0135-104">Objects that have a persistent state of any kind must implement at least one IPersist\* interface, and preferably multiple interfaces, in order to provide the container with the most flexible choice of how it wishes to save a control's state.</span></span>

<span data-ttu-id="f0135-105">如果控制項有任何持續性狀態，則至少必須執行 [**IPersistStream**](/windows/desktop/api/ObjIdl/nn-objidl-ipersiststream) 或 [**IPersistStreamInit**](/windows/desktop/api/OCIdl/nn-ocidl-ipersiststreaminit) (這兩個互斥，而且不應該同時針對大部分的) 來執行。</span><span class="sxs-lookup"><span data-stu-id="f0135-105">If a control has any persistent state whatsoever, it must, as a minimum, implement either [**IPersistStream**](/windows/desktop/api/ObjIdl/nn-objidl-ipersiststream) or [**IPersistStreamInit**](/windows/desktop/api/OCIdl/nn-ocidl-ipersiststreaminit) (the two are mutually exclusive and shouldn't be implemented together for the most part).</span></span> <span data-ttu-id="f0135-106">當控制項想要知道何時建立新的，而不是從現有的持續狀態重載時，會使用後者， (**IPersistStream** 沒有建立的新功能) 。</span><span class="sxs-lookup"><span data-stu-id="f0135-106">The latter is used when a control wishes to know when it is created new as opposed to reloaded from an existing persistent state (**IPersistStream** does not have the created new capability).</span></span> <span data-ttu-id="f0135-107">其中一個介面存在表示控制項可以將其持續狀態儲存並載入至資料流程，也就是 [**IStream**](/windows/desktop/api/objidl/nn-objidl-istream)的實例。</span><span class="sxs-lookup"><span data-stu-id="f0135-107">The existence of either interface indicates that the control can save and load its persistent state into a stream, that is, an instance of [**IStream**](/windows/desktop/api/objidl/nn-objidl-istream).</span></span>

<span data-ttu-id="f0135-108">除了這兩個以資料流程為基礎的介面之外， \* 下表所列的 IPersist 介面也可以選擇性地提供，以支援擴充 [**IStream**](/windows/desktop/api/objidl/nn-objidl-istream)以外位置的持續性。</span><span class="sxs-lookup"><span data-stu-id="f0135-108">Beyond these two stream-based interfaces, the IPersist\* interfaces listed in the following table can be optionally provided in order to support persistence to locations other than an expandable [**IStream**](/windows/desktop/api/objidl/nn-objidl-istream).</span></span>

<span data-ttu-id="f0135-109">識別出一組元件類別，以涵蓋持續性介面的支援，請參閱 [元件類別](component-categories.md)。</span><span class="sxs-lookup"><span data-stu-id="f0135-109">A set of component categories is identified to cover the support for persistency interfaces see [Component Categories](component-categories.md).</span></span>



| <span data-ttu-id="f0135-110">介面</span><span class="sxs-lookup"><span data-stu-id="f0135-110">Interface</span></span>                                                              | <span data-ttu-id="f0135-111">使用方式</span><span class="sxs-lookup"><span data-stu-id="f0135-111">Usage</span></span>                                                                                                                                                                                                                                                                                                                                                       |
|------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="f0135-112">[**IPersistMemory**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa768210(v=vs.85))</span><span class="sxs-lookup"><span data-stu-id="f0135-112">[**IPersistMemory**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa768210(v=vs.85))</span></span><br/>           | <span data-ttu-id="f0135-113">物件可以將其狀態儲存並載入固定長度的連續位元組陣列 (記憶體) 。</span><span class="sxs-lookup"><span data-stu-id="f0135-113">The object can save and load its state into a fixed-length sequential byte array (in memory).</span></span><br/>                                                                                                                                                                                                                                                    |
| [<span data-ttu-id="f0135-114">**IPersistStorage**</span><span class="sxs-lookup"><span data-stu-id="f0135-114">**IPersistStorage**</span></span>](/windows/desktop/api/ObjIdl/nn-objidl-ipersiststorage)<br/>                  | <span data-ttu-id="f0135-115">物件可將其狀態儲存並載入至 [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage) 實例。</span><span class="sxs-lookup"><span data-stu-id="f0135-115">The object can save and load its state into an [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage) instance.</span></span> <span data-ttu-id="f0135-116">希望將可插入的控制項標示為其他複合檔案物件 (插入非控制項感知容器中) 必須支援此介面。</span><span class="sxs-lookup"><span data-stu-id="f0135-116">Controls that wish to be marked Insertable as other compound document objects (for insertion into non-control aware containers) must support this interface.</span></span><br/>                                                                                               |
| <span data-ttu-id="f0135-117">[**IPersistPropertyBag**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa768205(v=vs.85))</span><span class="sxs-lookup"><span data-stu-id="f0135-117">[**IPersistPropertyBag**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa768205(v=vs.85))</span></span><br/> | <span data-ttu-id="f0135-118">物件可以將其狀態儲存並載入至容器所執行之 IPropertyBag 的個別屬性。</span><span class="sxs-lookup"><span data-stu-id="f0135-118">The object can save and load its state as individual properties written to IPropertyBag which the container implements.</span></span> <span data-ttu-id="f0135-119">這是用來在某些容器中以文字功能的形式儲存。</span><span class="sxs-lookup"><span data-stu-id="f0135-119">This is used for Save As Text functionality in some containers.</span></span><br/>                                                                                                                                                          |
| <span data-ttu-id="f0135-120">[**IPersistMoniker**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775042(v=vs.85))</span><span class="sxs-lookup"><span data-stu-id="f0135-120">[**IPersistMoniker**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775042(v=vs.85))</span></span><br/>  | <span data-ttu-id="f0135-121">物件可以儲存其狀態，並將其載入至以標記命名的位置。</span><span class="sxs-lookup"><span data-stu-id="f0135-121">The object can save and load its state to a location named by a moniker.</span></span> <span data-ttu-id="f0135-122">此控制項會呼叫 [**IMoniker：： BindToStorage**](/windows/desktop/api/ObjIdl/nf-objidl-imoniker-bindtostorage) ，以抓取其所需的儲存介面，例如 [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage)、 [**IStream**](/windows/desktop/api/objidl/nn-objidl-istream)、 [**ILockBytes**](/windows/desktop/api/objidl/nn-objidl-ilockbytes)、 [**IDataObject**](/windows/desktop/api/ObjIdl/nn-objidl-idataobject)等。</span><span class="sxs-lookup"><span data-stu-id="f0135-122">The control calls [**IMoniker::BindToStorage**](/windows/desktop/api/ObjIdl/nf-objidl-imoniker-bindtostorage) to retrieve the storage interface it requires, such as [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage), [**IStream**](/windows/desktop/api/objidl/nn-objidl-istream), [**ILockBytes**](/windows/desktop/api/objidl/nn-objidl-ilockbytes), [**IDataObject**](/windows/desktop/api/ObjIdl/nn-objidl-idataobject), etc.</span></span><br/> |



 

<span data-ttu-id="f0135-123">雖然 [**IPersistPropertyBag**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa768205(v=vs.85)) 的支援是選擇性的，但強烈建議使用「儲存為文字」功能的容器做為優化，例如 Visual Basic。</span><span class="sxs-lookup"><span data-stu-id="f0135-123">While support for [**IPersistPropertyBag**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa768205(v=vs.85)) is optional, it is strongly recommended as an optimization for containers with Save As Text features, such as Visual Basic.</span></span>

<span data-ttu-id="f0135-124">除了 [**IPersistStream：： GetSizeMax**](/windows/desktop/api/ObjIdl/nf-objidl-ipersiststream-getsizemax)、 [**IPersistStreamInit：： GetSizeMax**](/windows/desktop/api/OCIdl/nf-ocidl-ipersiststreaminit-getsizemax)和 [**IPersistMemory：： GetSizeMax**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa768208(v=vs.85))之外，每個介面的所有方法都必須完全實作為。</span><span class="sxs-lookup"><span data-stu-id="f0135-124">With the exception of [**IPersistStream::GetSizeMax**](/windows/desktop/api/ObjIdl/nf-objidl-ipersiststream-getsizemax), [**IPersistStreamInit::GetSizeMax**](/windows/desktop/api/OCIdl/nf-ocidl-ipersiststreaminit-getsizemax), and [**IPersistMemory::GetSizeMax**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa768208(v=vs.85)), all methods of each interface must be fully implemented.</span></span>

## <a name="related-topics"></a><span data-ttu-id="f0135-125">相關主題</span><span class="sxs-lookup"><span data-stu-id="f0135-125">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="f0135-126">控制項</span><span class="sxs-lookup"><span data-stu-id="f0135-126">Controls</span></span>](controls.md)
</dt> </dl>

 

