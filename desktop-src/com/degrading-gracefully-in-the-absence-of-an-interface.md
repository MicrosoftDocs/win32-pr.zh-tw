---
title: 在沒有介面時正常降級
description: 由於控制項可能不支援 IUnknown 以外的任何介面，因此當容器遇到任何特定的介面時，就必須正常地降級。
ms.assetid: 1b833900-2357-4b39-b88d-5ee6321f488e
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 26618e00f2d959cccfd7ab4d2948fac9c1a3f020
ms.sourcegitcommit: 85688bbfbe5b121bc05ddf112d54c23a469dfbc0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/29/2020
ms.locfileid: "106967877"
---
# <a name="degrading-gracefully-in-the-absence-of-an-interface"></a><span data-ttu-id="d3e46-103">在沒有介面時正常降級</span><span class="sxs-lookup"><span data-stu-id="d3e46-103">Degrading Gracefully in the Absence of an Interface</span></span>

<span data-ttu-id="d3e46-104">由於控制項可能不支援 [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown)以外的任何介面，因此當容器遇到任何特定的介面時，就必須正常地降級。</span><span class="sxs-lookup"><span data-stu-id="d3e46-104">Because a control may not support any interface other than [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown), a container has to degrade gracefully when it encounters the absence of any particular interface.</span></span>

<span data-ttu-id="d3e46-105">其中一個問題可能就是控制項的實用性，不只是 [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown)。</span><span class="sxs-lookup"><span data-stu-id="d3e46-105">One might question the usefulness of a control with nothing more than [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown).</span></span> <span data-ttu-id="d3e46-106">但是，請考慮控制項從容器的視覺化程式設計環境接收的優點 (例如，當容器將物件辨識為控制項時，VB) ：</span><span class="sxs-lookup"><span data-stu-id="d3e46-106">But consider the advantages that a control receives from a container's visual programming environment (such as VB) when the container recognizes the object as a control:</span></span>

-   <span data-ttu-id="d3e46-107">物件的按鈕會出現在 [工具箱] 中。</span><span class="sxs-lookup"><span data-stu-id="d3e46-107">A button for the object appears in a toolbox.</span></span>
-   <span data-ttu-id="d3e46-108">您可以將物件從 [工具箱] 拖曳到表單上，以建立物件。</span><span class="sxs-lookup"><span data-stu-id="d3e46-108">One can create an object by dragging it from the toolbox onto a form.</span></span>
-   <span data-ttu-id="d3e46-109">您可以為物件提供一個可在視覺化程式設計環境中辨識的名稱。</span><span class="sxs-lookup"><span data-stu-id="d3e46-109">One can give the object a name that is recognized in the visual programming environment.</span></span>
-   <span data-ttu-id="d3e46-110">上述 (3) 中的相同名稱可以立即用於撰寫相同表單上控制項的任何其他程式碼， (或甚至不同的表單) 。</span><span class="sxs-lookup"><span data-stu-id="d3e46-110">The same name in (3) above can be used immediately in writing any other code for controls on the same form (or even a different form).</span></span>
-   <span data-ttu-id="d3e46-111">容器可以自動提供該物件所提供之任何事件的程式碼進入點。</span><span class="sxs-lookup"><span data-stu-id="d3e46-111">The container can automatically provide code entry points for any events available from that object.</span></span>
-   <span data-ttu-id="d3e46-112">容器會為任何可用的屬性提供自己的屬性流覽 UI。</span><span class="sxs-lookup"><span data-stu-id="d3e46-112">The container provides its own property browsing UI for any available properties.</span></span>

<span data-ttu-id="d3e46-113">當物件無法辨識為控制項時，它可能會失去這些功能強大且有用的整合功能。</span><span class="sxs-lookup"><span data-stu-id="d3e46-113">When an object isn't recognized as a control, then it potentially loses all of these very powerful and beneficial integration features.</span></span> <span data-ttu-id="d3e46-114">例如，在 Visual Basic 4.0 中，很難真正地整合某個不是完整意義之控制項的隨機物件，但可能仍有屬性和事件。</span><span class="sxs-lookup"><span data-stu-id="d3e46-114">For example, in Visual Basic 4.0 it is very difficult to really integrate some random object that is not a control in the complete sense, but may still have properties and events.</span></span> <span data-ttu-id="d3e46-115">因為 Visual Basic 4 對控制項的概念非常嚴格，所以物件不會得到上述任何整合功能。</span><span class="sxs-lookup"><span data-stu-id="d3e46-115">Because Visual Basic 4's idea of a control is very restrictive, the object does not gain any of the integration features above.</span></span> <span data-ttu-id="d3e46-116">但即使是具有 [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown)的控制項（控制項的單純存留期決定了某些資源的存在），也應該能夠獲得上述的整合功能。</span><span class="sxs-lookup"><span data-stu-id="d3e46-116">But even a control with [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown), where the mere lifetime of the control determines the existence of some resource, should be able to gain the integration capabilities described above.</span></span>

<span data-ttu-id="d3e46-117">由於目前的工具需要大量的控制介面才能獲得任何優點，因此控制項通常會導致過度實行，使其包含的程式碼比真正需要的還要多。</span><span class="sxs-lookup"><span data-stu-id="d3e46-117">As current tools require a large set of control interfaces to gain any advantage, controls are generally led to over-implementation, such that they contain more code than they really need.</span></span> <span data-ttu-id="d3e46-118">可能會7K 的控制項可能會被25K，這是網際網路等區域中的重大效能問題。</span><span class="sxs-lookup"><span data-stu-id="d3e46-118">Controls that could be 7K might end up being 25K, which is a big performance problem in areas such as the Internet.</span></span> <span data-ttu-id="d3e46-119">這也表示，因為執行所有介面的複雜度，所以只能使用 CDK 之類的工具來執行控制項，而這對於這類控制項需要大型 DLL （例如 OC30.DLL）的影響，因而增加了工作集。</span><span class="sxs-lookup"><span data-stu-id="d3e46-119">This has also led to the perception that one can only implement a control with one tool like the CDK because of the complexity of implementing all the interfaces, and this has implications when a large DLL like OC30.DLL is required for such a control, increasing the working set.</span></span> <span data-ttu-id="d3e46-120">如果並非所有介面都是必要的，則會開啟許多開發人員，以使用直接的 OLE 或其他工具來撰寫非常小的控制項，並將每個控制項的額外負荷降到最低。</span><span class="sxs-lookup"><span data-stu-id="d3e46-120">If not all interfaces are required, then this opens up many developers to writing very small and light controls with straight OLE or with other tools as well, minimizing the overhead for each control.</span></span>

<span data-ttu-id="d3e46-121">這就是為什麼此附錄會將控制項辨識為具有 CLSID 和 [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) 介面的任何物件。</span><span class="sxs-lookup"><span data-stu-id="d3e46-121">This is why this appendix recognizes a control as any object with a CLSID and an [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) interface.</span></span> <span data-ttu-id="d3e46-122">即使沒有 IUnknown，具有程式設計環境的容器應該至少能提供功能 \# 3 和 ) 登錄專案，它會取得 \# 1 和 \# 2。</span><span class="sxs-lookup"><span data-stu-id="d3e46-122">Even with nothing more than IUnknown, a container with a programming environment should be able to provide at least features \#3 and ) registry entry, it gains \#1 and \#2.</span></span> <span data-ttu-id="d3e46-123">如果物件提供 [**IConnectionPointContainer**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpointcontainer) (，而 [**IProvideClassInfo**](/windows/desktop/api/OCIdl/nn-ocidl-iprovideclassinfo) 通常是某些事件集的) ，則會取得 \# 5，如果它支援屬性和方法的 **IDispatch** ，則會獲得 \# 6，以及容器中更好的程式碼整合。</span><span class="sxs-lookup"><span data-stu-id="d3e46-123">If the object supplies [**IConnectionPointContainer**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpointcontainer) (and [**IProvideClassInfo**](/windows/desktop/api/OCIdl/nn-ocidl-iprovideclassinfo) generally) for some event set, it gains \#5, and if it supports **IDispatch** for properties and methods, it gains \#6, as well as better code integration in the container.</span></span>

<span data-ttu-id="d3e46-124">簡單地說，物件應該可以實作為 **IDispatch** ，以及透過 [**IConnectionPointContainer**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpointcontainer) 公開的一個事件集，以獲得上述所有的視覺功能。</span><span class="sxs-lookup"><span data-stu-id="d3e46-124">In short, an object should be able to implement as little as **IDispatch** and one event set exposed through [**IConnectionPointContainer**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpointcontainer) to gain all of those visual features above.</span></span>

<span data-ttu-id="d3e46-125">請記住，下表說明容器在沒有任何可能的介面時，可能會執行的動作。</span><span class="sxs-lookup"><span data-stu-id="d3e46-125">With this in mind, the following table describes what a container might do in the absence of any possible interface.</span></span> <span data-ttu-id="d3e46-126">請注意，只會列出這些介面，容器將直接透過 [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q))取得這些介面。</span><span class="sxs-lookup"><span data-stu-id="d3e46-126">Note that only those interfaces are listed that the container will directly obtain through [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)).</span></span> <span data-ttu-id="d3e46-127">其他介面（例如 [**IOleInPlaceActiveObject**](/windows/desktop/api/OleIdl/nn-oleidl-ioleinplaceactiveobject)）則是透過其他方式取得。</span><span class="sxs-lookup"><span data-stu-id="d3e46-127">Other interfaces, like [**IOleInPlaceActiveObject**](/windows/desktop/api/OleIdl/nn-oleidl-ioleinplaceactiveobject), are obtained through other means.</span></span>



| <span data-ttu-id="d3e46-128">介面</span><span class="sxs-lookup"><span data-stu-id="d3e46-128">Interface</span></span>                                                                                                             | <span data-ttu-id="d3e46-129">介面缺少的意義</span><span class="sxs-lookup"><span data-stu-id="d3e46-129">Meaning of Interface Absence</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|-----------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="d3e46-130">**IViewObject2**</span><span class="sxs-lookup"><span data-stu-id="d3e46-130">**IViewObject2**</span></span>](/windows/desktop/api/OleIdl/nn-oleidl-iviewobject2)<br/>                                                                       | <span data-ttu-id="d3e46-131">控制項沒有視覺效果，因此它本身不會有任何視覺效果，因此沒有可提供的明確範圍。</span><span class="sxs-lookup"><span data-stu-id="d3e46-131">The control has no visuals that it will draw itself, so has no definite extents to provide.</span></span> <span data-ttu-id="d3e46-132">在執行時間中，容器不會在此介面不存在時嘗試繪製任何程式。</span><span class="sxs-lookup"><span data-stu-id="d3e46-132">In run-time, the container simply doesn't attempt to draw anything when this interface is absent.</span></span> <span data-ttu-id="d3e46-133">在設計階段中，容器必須至少繪製某種類型的預設矩形，以用於這類控制項，因此視覺化程式設計環境中的使用者可以選取物件，並簽出其屬性、方法和現有的事件。</span><span class="sxs-lookup"><span data-stu-id="d3e46-133">In design time, the container must at least draw some kind of default rectangle with a name in it for such a control, so a user in a visual programming environment can select the object and check out its properties, methods, and events that exist.</span></span> <span data-ttu-id="d3e46-134">處理不 [**IViewObject2**](/windows/desktop/api/OleIdl/nn-oleidl-iviewobject2) 的問題，對於良好的視覺化程式設計支援非常重要。</span><span class="sxs-lookup"><span data-stu-id="d3e46-134">Handling the absence of [**IViewObject2**](/windows/desktop/api/OleIdl/nn-oleidl-iviewobject2) is critical for good visual programming support.</span></span><br/> |
| [<span data-ttu-id="d3e46-135">**IOleObject**</span><span class="sxs-lookup"><span data-stu-id="d3e46-135">**IOleObject**</span></span>](/windows/desktop/api/OleIdl/nn-oleidl-ioleobject)<br/>                                                                           | <span data-ttu-id="d3e46-136">控制項不需要網站，也不會參與任何內嵌的物件版面配置協商。</span><span class="sxs-lookup"><span data-stu-id="d3e46-136">The control doesn't need the site whatsoever, nor does it take part in any embedded object layout negotiation.</span></span> <span data-ttu-id="d3e46-137">任何 (如控制範圍的資訊，都應該使用容器提供的預設值來填入容器可能預期來自此介面的) 。</span><span class="sxs-lookup"><span data-stu-id="d3e46-137">Any information (like control extents) that a container might expect from this interface should be filled in with container-provided defaults.</span></span><br/>                                                                                                                                                                                                                                                                                                       |
| [<span data-ttu-id="d3e46-138">**IOleInPlaceObject**</span><span class="sxs-lookup"><span data-stu-id="d3e46-138">**IOleInPlaceObject**</span></span>](/windows/desktop/api/OleIdl/nn-oleidl-ioleinplaceobject)<br/>                                                             | <span data-ttu-id="d3e46-139">控制項不會就地使用 (例如標籤) ，因此永遠不會嘗試以這種方式啟動。</span><span class="sxs-lookup"><span data-stu-id="d3e46-139">The control doesn't go in-place active (like a label) and thus never attempts to activate in this manner.</span></span> <span data-ttu-id="d3e46-140">它的唯一啟用可能是其屬性頁。</span><span class="sxs-lookup"><span data-stu-id="d3e46-140">Its only activation may be its property pages.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                            |
| [<span data-ttu-id="d3e46-141">**IOleControl**</span><span class="sxs-lookup"><span data-stu-id="d3e46-141">**IOleControl**</span></span>](/windows/desktop/api/OCIdl/nn-ocidl-iolecontrol)<br/>                                                                         | <span data-ttu-id="d3e46-142">控制項沒有助憶鍵，且不會使用環境屬性，也不會在意容器是否會忽略事件。</span><span class="sxs-lookup"><span data-stu-id="d3e46-142">Control has no mnemonics and no use of ambient properties, and doesn't care if the container ignores events.</span></span> <span data-ttu-id="d3e46-143">如果沒有這個介面，容器就不會呼叫其方法。</span><span class="sxs-lookup"><span data-stu-id="d3e46-143">In the absence of this interface, the container just doesn't call its methods.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                         |
| [<span data-ttu-id="d3e46-144">**IDataObject**</span><span class="sxs-lookup"><span data-stu-id="d3e46-144">**IDataObject**</span></span>](/windows/desktop/api/ObjIdl/nn-objidl-idataobject)<br/>                                                                         | <span data-ttu-id="d3e46-145">此控制項不提供任何可以快取的屬性集，也不會提供任何視覺轉譯，因此容器會選擇在缺少此介面的情況下快取一些預設呈現 (CF METAFILEPICT 的支援 \_ ，特別是) 並停用任何屬性集相關功能。</span><span class="sxs-lookup"><span data-stu-id="d3e46-145">The control provides no property sets nor any visual renderings that could be cached, so the container would choose to cache some default presentation in the absence of this interface (support for CF\_METAFILEPICT, specifically) and disable any property-set related functionality.</span></span><br/>                                                                                                                                                                                                                                                                            |
| <span data-ttu-id="d3e46-146">**IDispatch**</span><span class="sxs-lookup"><span data-stu-id="d3e46-146">**IDispatch**</span></span><br/>                                                                                              | <span data-ttu-id="d3e46-147">控制項沒有任何自訂屬性或方法。</span><span class="sxs-lookup"><span data-stu-id="d3e46-147">The control has no custom properties or methods.</span></span> <span data-ttu-id="d3e46-148">在此情況下，容器不需要嘗試顯示任何控制項屬性，而且應該不允許容器無法辨識為屬於自己擴充控制項的任何自訂方法呼叫， (可支援) 的方法和屬性。</span><span class="sxs-lookup"><span data-stu-id="d3e46-148">The container does not need to try to show any control properties in this case, and should disallow any custom method calls that the container doesn't recognize as belonging to its own extended controls (that may support methods and properties).</span></span> <span data-ttu-id="d3e46-149">由於延伸控制項通常會將某些 **IDispatch** 呼叫委派給控制項，因此擴充的控制項不應預期控制項完全具有 **IDispatch** 。</span><span class="sxs-lookup"><span data-stu-id="d3e46-149">As extended controls generally delegate certain **IDispatch** calls to the control, an extended control should not expect the control to have **IDispatch** at all.</span></span><br/>                                                                                          |
| [<span data-ttu-id="d3e46-150">**IConnectionPointContainer**</span><span class="sxs-lookup"><span data-stu-id="d3e46-150">**IConnectionPointContainer**</span></span>](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpointcontainer)<br/>                                             | <span data-ttu-id="d3e46-151">控制項沒有事件，因此容器不需要考慮處理任何事件。</span><span class="sxs-lookup"><span data-stu-id="d3e46-151">The control has no events, so the container doesn't have to think about handling any.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| [<span data-ttu-id="d3e46-152">**IProvideClassInfo**</span><span class="sxs-lookup"><span data-stu-id="d3e46-152">**IProvideClassInfo**</span></span>](/windows/desktop/api/OCIdl/nn-ocidl-iprovideclassinfo)<br/> [<span data-ttu-id="d3e46-153">**Iprovideclassinfo2.getguid**</span><span class="sxs-lookup"><span data-stu-id="d3e46-153">**IProvideClassInfo2**</span></span>](/windows/desktop/api/OCIdl/nn-ocidl-iprovideclassinfo2)<br/> | <span data-ttu-id="d3e46-154">控制項可能沒有類型資訊或事件，或容器必須透過控制項的登錄專案進入控制項的類型資訊。</span><span class="sxs-lookup"><span data-stu-id="d3e46-154">The control either doesn't have type information or events, or the container needs to go into the control's type information through the control's registry entries.</span></span> <span data-ttu-id="d3e46-155">這個介面的存在是優化的。</span><span class="sxs-lookup"><span data-stu-id="d3e46-155">The existence of this interface is an optimization.</span></span><br/>                                                                                                                                                                                                                                                                                                                                            |
| [<span data-ttu-id="d3e46-156">**ISpecifyPropertyPages**</span><span class="sxs-lookup"><span data-stu-id="d3e46-156">**ISpecifyPropertyPages**</span></span>](/windows/desktop/api/OCIdl/nn-ocidl-ispecifypropertypages)<br/>                                                     | <span data-ttu-id="d3e46-157">控制項沒有屬性頁，因此如果容器具有任何可叫用它們的 UI，容器應該停用該 UI。</span><span class="sxs-lookup"><span data-stu-id="d3e46-157">The control has no property pages, so if the container has any UI that would invoke them, the container should disable that UI.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| [<span data-ttu-id="d3e46-158">**IPerPropertyBrowsing**</span><span class="sxs-lookup"><span data-stu-id="d3e46-158">**IPerPropertyBrowsing**</span></span>](/windows/desktop/api/OCIdl/nn-ocidl-iperpropertybrowsing)<br/>                                                       | <span data-ttu-id="d3e46-159">控制項沒有顯示名稱本身、沒有預先決定的字串和值，也沒有頁面對應的屬性。</span><span class="sxs-lookup"><span data-stu-id="d3e46-159">The control has no display name itself, no predetermined strings and values, and no property to page mapping.</span></span> <span data-ttu-id="d3e46-160">這個介面幾乎一律用來產生容器使用者介面，因此在沒有此介面的情況下，將會停用這類 UI 元素。</span><span class="sxs-lookup"><span data-stu-id="d3e46-160">This interface is nearly always used for generating container user interface, so such UI elements would be disabled in the absence of this interface.</span></span><br/>                                                                                                                                                                                                                                                                                                 |
| <span data-ttu-id="d3e46-161">IPersist\*</span><span class="sxs-lookup"><span data-stu-id="d3e46-161">IPersist\*</span></span><br/>                                                                                                 | <span data-ttu-id="d3e46-162">控制項沒有任何持續性的狀態，因此容器不需要擔心儲存任何控制項特定資料。</span><span class="sxs-lookup"><span data-stu-id="d3e46-162">The control has no persistent state to speak of, so the container doesn't have to worry about saving any control-specific data.</span></span> <span data-ttu-id="d3e46-163">當然，容器也會將控制項的相關資訊儲存在本身的表單或檔中，但是控制項本身並沒有任何專案可參與該資訊。</span><span class="sxs-lookup"><span data-stu-id="d3e46-163">The container will, of course, save its own information about the control in its own form or document, but the control itself has nothing to contribute to that information.</span></span><br/>                                                                                                                                                                                                                                                        |
| [<span data-ttu-id="d3e46-164">**IOleCache**</span><span class="sxs-lookup"><span data-stu-id="d3e46-164">**IOleCache**</span></span>](/windows/desktop/api/OleIdl/nn-oleidl-iolecache)<br/> [<span data-ttu-id="d3e46-165">**IOleCache2**</span><span class="sxs-lookup"><span data-stu-id="d3e46-165">**IOleCache2**</span></span>](/windows/desktop/api/OleIdl/nn-oleidl-iolecache2)<br/>                                 | <span data-ttu-id="d3e46-166">物件不支援快取。</span><span class="sxs-lookup"><span data-stu-id="d3e46-166">The object doesn't support caching.</span></span> <span data-ttu-id="d3e46-167">容器仍可支援快取，只要使用 [**CreateDataCache**](/windows/desktop/api/ObjBase/nf-objbase-createdatacache)建立資料快取本身即可。</span><span class="sxs-lookup"><span data-stu-id="d3e46-167">A container can still support caching by just creating a data cache itself using [**CreateDataCache**](/windows/desktop/api/ObjBase/nf-objbase-createdatacache).</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                    |



 

## <a name="related-topics"></a><span data-ttu-id="d3e46-168">相關主題</span><span class="sxs-lookup"><span data-stu-id="d3e46-168">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="d3e46-169">容器</span><span class="sxs-lookup"><span data-stu-id="d3e46-169">Containers</span></span>](containers.md)
</dt> </dl>

 

 





