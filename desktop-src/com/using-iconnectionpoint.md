---
title: 使用 IConnectionPoint
description: 使用 IConnectionPoint
ms.assetid: afd50b84-1fd6-47ad-a3ef-e8b4a725b72b
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: fe7aa758ec1bd40233b1cc41a6c375ed296fc167
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/21/2020
ms.locfileid: "104024119"
---
# <a name="using-iconnectionpoint"></a><span data-ttu-id="5a4ba-103">使用 IConnectionPoint</span><span class="sxs-lookup"><span data-stu-id="5a4ba-103">Using IConnectionPoint</span></span>

<span data-ttu-id="5a4ba-104">當用戶端有指向連接點的指標時，可以執行下列作業，以透過 [**IConnectionPoint**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpoint)表示：</span><span class="sxs-lookup"><span data-stu-id="5a4ba-104">When the client has a pointer to a connection point, it can perform the following operations as expressed through [**IConnectionPoint**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpoint):</span></span>

-   <span data-ttu-id="5a4ba-105">首先， [**IConnectionPoint：： GetConnectionInterface**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpoint-getconnectioninterface) 會抓取連接點所支援的連出介面 IID。</span><span class="sxs-lookup"><span data-stu-id="5a4ba-105">First, [**IConnectionPoint::GetConnectionInterface**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpoint-getconnectioninterface) retrieves the outgoing interface IID supported by the connection point.</span></span> <span data-ttu-id="5a4ba-106">當與 [**IEnumConnectionPoints**](/windows/desktop/api/ocidl/nn-ocidl-ienumconnectionpoints)搭配使用時，此方法可讓用戶端檢查可連線物件上支援的所有傳出介面 iid。</span><span class="sxs-lookup"><span data-stu-id="5a4ba-106">When used in conjunction with [**IEnumConnectionPoints**](/windows/desktop/api/ocidl/nn-ocidl-ienumconnectionpoints), this method allows the client to examine the IIDs of all outgoing interfaces supported on the connectable object.</span></span>
-   <span data-ttu-id="5a4ba-107">其次，用戶端可以透過 [**IConnectionPoint：： GetConnectionPointContainer**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpoint-getconnectionpointcontainer)方法，從連接點流覽回到可連線物件的 [**IConnectionPointContainer**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpointcontainer)介面。</span><span class="sxs-lookup"><span data-stu-id="5a4ba-107">Second, a client can navigate from the connection point back to the connectable object's [**IConnectionPointContainer**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpointcontainer) interface through the [**IConnectionPoint::GetConnectionPointContainer**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpoint-getconnectionpointcontainer) method.</span></span>
-   <span data-ttu-id="5a4ba-108">第三，用戶端最感興趣的方法是 [**IConnectionPoint：： Advise**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpoint-advise) 和 [**IConnectionPoint：： Unadvise**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpoint-unadvise)。</span><span class="sxs-lookup"><span data-stu-id="5a4ba-108">Third, the most interesting methods for the client are [**IConnectionPoint::Advise**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpoint-advise) and [**IConnectionPoint::Unadvise**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpoint-unadvise).</span></span> <span data-ttu-id="5a4ba-109">當用戶端想要將本身的接收物件連接至可連線物件時，用戶端會將接收器的 [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) 指標 (或相同物件上的任何其他介面指標，) 為 **建議**。</span><span class="sxs-lookup"><span data-stu-id="5a4ba-109">When a client wishes to connect its own sink object to the connectable object, the client passes the sink's [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) pointer (or any other interface pointer on the same object) to **Advise**.</span></span> <span data-ttu-id="5a4ba-110">連接點會查詢預期之特定輸出介面的接收。</span><span class="sxs-lookup"><span data-stu-id="5a4ba-110">The connection point queries the sink for the specific outgoing interface that is expected.</span></span> <span data-ttu-id="5a4ba-111">如果接收上有該介面，則連接點會儲存介面指標。</span><span class="sxs-lookup"><span data-stu-id="5a4ba-111">If that interface is available on the sink, the connection point then stores the interface pointer.</span></span> <span data-ttu-id="5a4ba-112">從這個點一直到呼叫 **Unadvise** 為止，可連接的物件會在事件發生時，透過這個介面呼叫接收器。</span><span class="sxs-lookup"><span data-stu-id="5a4ba-112">From this point until **Unadvise** is called, the connectable object will make calls to the sink through this interface when events occur.</span></span> <span data-ttu-id="5a4ba-113">若要中斷連接連接點的接收，用戶端會將從「 **建議** 」傳回的金鑰傳遞給 **Unadvise** 方法。</span><span class="sxs-lookup"><span data-stu-id="5a4ba-113">To disconnect the sink from the connection point, the client passes a key returned from **Advise** to the **Unadvise** method.</span></span> <span data-ttu-id="5a4ba-114">**Unadvise** 必須在接收器介面上呼叫 [**Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release) 。</span><span class="sxs-lookup"><span data-stu-id="5a4ba-114">**Unadvise** must call [**Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release) on the sink interface.</span></span>
-   <span data-ttu-id="5a4ba-115">最後，用戶端可以要求連接點透過 [**IConnectionPoint：： EnumConnections**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpoint-enumconnections)列舉存在的所有連接。</span><span class="sxs-lookup"><span data-stu-id="5a4ba-115">Finally, a client can ask a connection point to enumerate all the connections to it that exist through [**IConnectionPoint::EnumConnections**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpoint-enumconnections).</span></span> <span data-ttu-id="5a4ba-116">這個方法會使用不同的參考計數來建立列舉值物件 () 傳回 [**IEnumConnections**](/windows/desktop/api/ocidl/nn-ocidl-ienumconnections) 指標。</span><span class="sxs-lookup"><span data-stu-id="5a4ba-116">This method creates an enumerator object (with a separate reference count) returning an [**IEnumConnections**](/windows/desktop/api/ocidl/nn-ocidl-ienumconnections) pointer to it.</span></span> <span data-ttu-id="5a4ba-117">當不再需要列舉值時，用戶端必須呼叫 [**Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release) 。</span><span class="sxs-lookup"><span data-stu-id="5a4ba-117">The client must call [**Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release) when the enumerator is no longer needed.</span></span> <span data-ttu-id="5a4ba-118">此外，列舉值會傳回一系列的 [**CONNECTDATA**](/windows/win32/api/ocidl/ns-ocidl-connectdata) 結構，每個連接各一。</span><span class="sxs-lookup"><span data-stu-id="5a4ba-118">Additionally, the enumerator returns a series of [**CONNECTDATA**](/windows/win32/api/ocidl/ns-ocidl-connectdata) structures, one for each connection.</span></span> <span data-ttu-id="5a4ba-119">每個結構會使用接收的 [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) 指標以及原先從「 [**建議**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpoint-advise)」傳回的連接金鑰來描述一個連接。</span><span class="sxs-lookup"><span data-stu-id="5a4ba-119">Each structure describes one connection using the [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) pointer of the sink as well as the connection key originally returned from [**Advise**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpoint-advise).</span></span> <span data-ttu-id="5a4ba-120">使用這些接收介面指標完成時，用戶端必須在 **CONNECTDATA** 結構中傳回的每個指標上呼叫 **Release** 。</span><span class="sxs-lookup"><span data-stu-id="5a4ba-120">When done with these sink interface pointers, the client must call **Release** on each pointer returned in a **CONNECTDATA** structure.</span></span>

## <a name="related-topics"></a><span data-ttu-id="5a4ba-121">相關主題</span><span class="sxs-lookup"><span data-stu-id="5a4ba-121">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="5a4ba-122">可連線物件介面</span><span class="sxs-lookup"><span data-stu-id="5a4ba-122">Connectable Object Interfaces</span></span>](connectable-object-interfaces.md)
</dt> </dl>

 

 