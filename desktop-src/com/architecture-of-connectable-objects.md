---
title: 可連線物件的架構
description: 可連線物件的架構
ms.assetid: 69949a3b-3ab8-4054-84d8-9256fbf39c7b
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1e9d8d2909942d1c04aed972e7891a6f4ae3f730
ms.sourcegitcommit: d39e82e232f6510f843fdb8d55d25b4e9e02e880
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 02/03/2021
ms.locfileid: "106989100"
---
# <a name="architecture-of-connectable-objects"></a><span data-ttu-id="880cf-103">可連線物件的架構</span><span class="sxs-lookup"><span data-stu-id="880cf-103">Architecture of Connectable Objects</span></span>

<span data-ttu-id="880cf-104">可連線物件是可連線物件之整體架構的其中一個部分。</span><span class="sxs-lookup"><span data-stu-id="880cf-104">The connectable object is only one piece of the overall architecture of connectable objects.</span></span> <span data-ttu-id="880cf-105">這項技術包含下列元素：</span><span class="sxs-lookup"><span data-stu-id="880cf-105">This technology includes the following elements:</span></span>

-   <span data-ttu-id="880cf-106">**可連線物件。**</span><span class="sxs-lookup"><span data-stu-id="880cf-106">**Connectable object.**</span></span> <span data-ttu-id="880cf-107">會實 [**IConnectionPointContainer**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpointcontainer) 介面;至少建立一個連接點物件;定義用戶端的輸出介面。</span><span class="sxs-lookup"><span data-stu-id="880cf-107">Implements the [**IConnectionPointContainer**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpointcontainer) interface; creates at least one connection point object; defines an outgoing interface for the client.</span></span>
-   <span data-ttu-id="880cf-108">**客戶。**</span><span class="sxs-lookup"><span data-stu-id="880cf-108">**Client.**</span></span> <span data-ttu-id="880cf-109">查詢物件以進行 [**IConnectionPointContainer**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpointcontainer) ，以判斷物件是否可連接;建立接收物件，以執行可連線物件所定義的連出介面。</span><span class="sxs-lookup"><span data-stu-id="880cf-109">Queries the object for [**IConnectionPointContainer**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpointcontainer) to determine whether the object is connectable; creates a sink object to implement the outgoing interface defined by the connectable object.</span></span>
-   <span data-ttu-id="880cf-110">**接收物件。**</span><span class="sxs-lookup"><span data-stu-id="880cf-110">**Sink object.**</span></span> <span data-ttu-id="880cf-111">會實作為輸出介面;用來建立連線物件的連接。</span><span class="sxs-lookup"><span data-stu-id="880cf-111">Implements the outgoing interface; used to establish a connection to the connectable object.</span></span>
-   <span data-ttu-id="880cf-112">**連接點物件。**</span><span class="sxs-lookup"><span data-stu-id="880cf-112">**Connection point object.**</span></span> <span data-ttu-id="880cf-113">會執行 [**IConnectionPoint**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpoint) 介面並管理與用戶端接收的連接。</span><span class="sxs-lookup"><span data-stu-id="880cf-113">Implements the [**IConnectionPoint**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpoint) interface and manages connection with the client's sink.</span></span>

<span data-ttu-id="880cf-114">下圖說明用戶端、可連線物件、連接點和接收器之間的關聯性：</span><span class="sxs-lookup"><span data-stu-id="880cf-114">The relationships between client, connectable object, a connection point, and a sink are illustrated in the following diagram:</span></span>

![此圖表顯示用戶端與可連線物件之間的連接點。](images/1cd44fec-5d2c-4427-846b-ccab7ec0b08a.png)

<span data-ttu-id="880cf-116">在連接點物件于上圖中的步驟3中呼叫接收器介面內的方法之前，它必須是所需的特定介面的 [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)) ，即使指標已在「 [**建議**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpoint-advise) 」方法的步驟2呼叫中傳遞。</span><span class="sxs-lookup"><span data-stu-id="880cf-116">Before the connection point object calls methods in the sink interface in step 3 in the preceding diagram, it must [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)) for the specific interface required, even if the pointer was already passed in the step 2 call to the [**Advise**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpoint-advise) method.</span></span>

<span data-ttu-id="880cf-117">這兩個列舉值物件也會包含在此架構中，但不會顯示于圖例中。</span><span class="sxs-lookup"><span data-stu-id="880cf-117">Two enumerator objects are also involved in this architecture though not shown in the illustration.</span></span> <span data-ttu-id="880cf-118">其中一個是由 [**IConnectionPointContainer**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpointcontainer) 中的方法所建立，用來列舉可連線物件內的連接點。</span><span class="sxs-lookup"><span data-stu-id="880cf-118">One is created by a method in [**IConnectionPointContainer**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpointcontainer) to enumerate the connection points within the connectable object.</span></span> <span data-ttu-id="880cf-119">另一個是透過 [**IConnectionPoint**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpoint) 中的方法來建立，以列舉目前為該連接點建立的連接。</span><span class="sxs-lookup"><span data-stu-id="880cf-119">The other is created by a method in [**IConnectionPoint**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpoint) to enumerate the connections currently established to that connection point.</span></span> <span data-ttu-id="880cf-120">一個連接點可以支援多個連接的接收介面，而且每次在該介面上進行方法呼叫時，都應該逐一查看連接清單。</span><span class="sxs-lookup"><span data-stu-id="880cf-120">One connection point can support multiple connected sink interfaces, and it should iterate through the list of connections each time it makes a method call on that interface.</span></span> <span data-ttu-id="880cf-121">此進程稱為多播。</span><span class="sxs-lookup"><span data-stu-id="880cf-121">This process is known as multicasting.</span></span>

<span data-ttu-id="880cf-122">使用可連線物件時，請務必瞭解可連接的物件、每個連接點、每個接收和所有列舉值都是個別的物件，具有個別的 [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) 實值、個別的參考計數和個別的存留期。</span><span class="sxs-lookup"><span data-stu-id="880cf-122">When working with connectable objects, it is important to understand that the connectable object, each connection point, each sink, and all enumerators are separate objects with separate [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) implementations, separate reference counts, and separate lifetimes.</span></span> <span data-ttu-id="880cf-123">使用這些物件的用戶端一律負責釋放它擁有的所有參考計數。</span><span class="sxs-lookup"><span data-stu-id="880cf-123">A client using these objects is always responsible for releasing all reference counts it owns.</span></span>

> [!Note]  
> <span data-ttu-id="880cf-124">可連線物件可支援一個以上的用戶端，而且可以支援用戶端內的多個接收器。</span><span class="sxs-lookup"><span data-stu-id="880cf-124">A connectable object can support more than one client and can support multiple sinks within a client.</span></span> <span data-ttu-id="880cf-125">同樣地，接收也可以連接到多個可連接的物件。</span><span class="sxs-lookup"><span data-stu-id="880cf-125">Likewise, a sink can be connected to more than one connectable object.</span></span>

 

<span data-ttu-id="880cf-126">在用戶端與可連線物件之間建立連接的步驟如下：</span><span class="sxs-lookup"><span data-stu-id="880cf-126">The steps for establishing a connection between a client and a connectable object are as follows:</span></span>

1.  <span data-ttu-id="880cf-127">用戶端會查詢物件上的 [**IConnectionPointContainer**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpointcontainer) ，以判斷物件是否為可連接的。</span><span class="sxs-lookup"><span data-stu-id="880cf-127">The client queries for [**IConnectionPointContainer**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpointcontainer) on the object to determine whether the object is connectable.</span></span> <span data-ttu-id="880cf-128">如果成功呼叫，用戶端會在可連線物件上保存 **IConnectionPointContainer** 介面的指標，且可連接的物件參考計數器已遞增。</span><span class="sxs-lookup"><span data-stu-id="880cf-128">If this call is successful, the client holds a pointer to the **IConnectionPointContainer** interface on the connectable object and the connectable object reference counter has been incremented.</span></span> <span data-ttu-id="880cf-129">否則，物件是無法連接的，且不支援輸出介面。</span><span class="sxs-lookup"><span data-stu-id="880cf-129">Otherwise, the object is not connectable and does not support outgoing interfaces.</span></span>
2.  <span data-ttu-id="880cf-130">如果物件是可連接的，則用戶端接著會嘗試取得可連線物件內連接點上 [**IConnectionPoint**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpoint) 介面的指標。</span><span class="sxs-lookup"><span data-stu-id="880cf-130">If the object is connectable, the client next tries to obtain a pointer to the [**IConnectionPoint**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpoint) interface on a connection point within the connectable object.</span></span> <span data-ttu-id="880cf-131">在 [**IConnectionPointContainer：： FindConnectionPoint**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpointcontainer-findconnectionpoint) 和 [**IConnectionPointContainer：： EnumConnectionPoints**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpointcontainer-enumconnectionpoints)中，有兩種方法可以取得此指標。</span><span class="sxs-lookup"><span data-stu-id="880cf-131">There are two methods for obtaining this pointer, both in [**IConnectionPointContainer::FindConnectionPoint**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpointcontainer-findconnectionpoint) and in [**IConnectionPointContainer::EnumConnectionPoints**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpointcontainer-enumconnectionpoints).</span></span> <span data-ttu-id="880cf-132">如果使用 **EnumConnectionPoints** ，則需要一些額外的步驟。</span><span class="sxs-lookup"><span data-stu-id="880cf-132">There are a few additional steps needed if **EnumConnectionPoints** is used.</span></span> <span data-ttu-id="880cf-133"> (如需詳細資訊，請參閱 [使用 IConnectionPointContainer](using-iconnectionpointcontainer.md) 。 ) 如果成功，可連接的物件和用戶端都支援相同的輸出介面。</span><span class="sxs-lookup"><span data-stu-id="880cf-133">(See [Using IConnectionPointContainer](using-iconnectionpointcontainer.md) for more information.) If successful, the connectable object and the client both support the same outgoing interface.</span></span> <span data-ttu-id="880cf-134">可連線物件會定義它並呼叫它，而用戶端會執行它。</span><span class="sxs-lookup"><span data-stu-id="880cf-134">The connectable object defines it and calls it, and the client implements it.</span></span> <span data-ttu-id="880cf-135">然後，用戶端可以透過可連線物件內的連接點進行通訊。</span><span class="sxs-lookup"><span data-stu-id="880cf-135">The client can then communicate through the connection point within the connectable object.</span></span>
3.  <span data-ttu-id="880cf-136">然後，用戶端會呼叫連接點上的 [**建議**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpoint-advise) ，以建立其接收介面與物件連接點之間的連接。</span><span class="sxs-lookup"><span data-stu-id="880cf-136">The client then calls [**Advise**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpoint-advise) on the connection point to establish a connection between its sink interface and the object's connection point.</span></span> <span data-ttu-id="880cf-137">在這個呼叫之後，物件的連接點會保存接收器上連出介面的指標。</span><span class="sxs-lookup"><span data-stu-id="880cf-137">After this call, the object's connection point holds a pointer to the outgoing interface on the sink.</span></span>
4.  <span data-ttu-id="880cf-138">「 [**建議**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpoint-advise) 」內的程式碼會在傳入的介面指標上呼叫 [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)) ，要求它所連接的特定介面識別碼。</span><span class="sxs-lookup"><span data-stu-id="880cf-138">The code inside [**Advise**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpoint-advise) calls [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)) on the interface pointer that is passed in, asking for the specific interface identifier to which it connects.</span></span>
5.  <span data-ttu-id="880cf-139">物件會視需要呼叫接收器介面上的方法，並使用其連接點所持有的指標。</span><span class="sxs-lookup"><span data-stu-id="880cf-139">The object calls methods on the sink's interface as needed, using the pointer held by its connection point.</span></span>
6.  <span data-ttu-id="880cf-140">用戶端會呼叫 [**Unadvise**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpoint-unadvise) 來終止連接。</span><span class="sxs-lookup"><span data-stu-id="880cf-140">The client calls [**Unadvise**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpoint-unadvise) to terminate the connection.</span></span> <span data-ttu-id="880cf-141">然後，用戶端會呼叫 **IConnectionPoint：： Release** 以釋放其在連接點上的保留，因此也可以連接到主要的可連線物件。</span><span class="sxs-lookup"><span data-stu-id="880cf-141">Then the client calls **IConnectionPoint::Release** to free its hold on the connection point and, therefore, the main connectable object also.</span></span> <span data-ttu-id="880cf-142">用戶端也必須呼叫 **IConnectionPointContainer：： Release** ，才能在主要可連線物件上釋放其保存。</span><span class="sxs-lookup"><span data-stu-id="880cf-142">The client must also call **IConnectionPointContainer::Release** to free its hold on the main connectable object.</span></span>

## <a name="related-topics"></a><span data-ttu-id="880cf-143">相關主題</span><span class="sxs-lookup"><span data-stu-id="880cf-143">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="880cf-144">可連線物件介面</span><span class="sxs-lookup"><span data-stu-id="880cf-144">Connectable Object Interfaces</span></span>](connectable-object-interfaces.md)
</dt> </dl>

 

 




