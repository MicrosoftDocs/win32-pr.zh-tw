---
title: 使用無線託管網路、網際網路連線共用
description: 使用無線託管網路和網際網路連線共用
ms.assetid: 56e86ef8-f759-4e56-a591-74e03430125a
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 972774e921199e32eb70841c74c7478e2178cda9
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "103944146"
---
# <a name="use-wireless-hosted-network-internet-connection-sharing"></a><span data-ttu-id="64a6f-103">使用無線託管網路、網際網路連線共用</span><span class="sxs-lookup"><span data-stu-id="64a6f-103">Use Wireless Hosted Network, Internet Connection Sharing</span></span>

<span data-ttu-id="64a6f-104">無線託管網路是 Windows 7 和 Windows 8 支援的新 WLAN 功能。</span><span class="sxs-lookup"><span data-stu-id="64a6f-104">The Wireless Hosted Network is a new WLAN feature supported on Windows 7 and Windows 8.</span></span> <span data-ttu-id="64a6f-105">在安裝了無線局域網路服務的 Windows Server 2012 和 Windows Server 2008 R2 上也支援此功能。</span><span class="sxs-lookup"><span data-stu-id="64a6f-105">It is also supported on Windows Server 2012 and Windows Server 2008 R2 with the Wireless LAN Service installed.</span></span> <span data-ttu-id="64a6f-106">這項功能會實現兩個主要功能：</span><span class="sxs-lookup"><span data-stu-id="64a6f-106">This feature implements two major functions:</span></span>

-   <span data-ttu-id="64a6f-107">將實體無線介面卡虛擬化為一個以上的虛擬無線介面卡，有時又稱為虛擬 Wi-fi。</span><span class="sxs-lookup"><span data-stu-id="64a6f-107">The virtualization of a physical wireless adapter into more than one virtual wireless adapter sometimes referred to as Virtual Wi-Fi.</span></span>
-   <span data-ttu-id="64a6f-108">以軟體為基礎的無線存取點 (AP) 有時稱為 SoftAP，使用指定的虛擬無線介面卡。</span><span class="sxs-lookup"><span data-stu-id="64a6f-108">A software-based wireless access point (AP) sometimes referred to as a SoftAP that uses a designated virtual wireless adapter.</span></span>

<span data-ttu-id="64a6f-109">網際網路連線共用 (ICS) 是 Windows 中透過 Win2k3 sharedaccess 服務所提供的一項功能。</span><span class="sxs-lookup"><span data-stu-id="64a6f-109">Internet Connection Sharing (ICS) is a feature in Windows provided through the SharedAccess Service.</span></span> <span data-ttu-id="64a6f-110">嚴格來說，Win2k3 sharedaccess 透過共用網路存取不一定提供網際網路存取權的電腦，來啟用網路共用。</span><span class="sxs-lookup"><span data-stu-id="64a6f-110">Strictly speaking, SharedAccess enables network sharing through a computer where the shared network access does not necessarily provide access to the Internet.</span></span> <span data-ttu-id="64a6f-111">因為網際網路連線共用是無線裝載網路的主要案例，且使用者群體更知道 ICS 詞彙，所以我們會在本節中交替使用「ICS」和「Win2k3 sharedaccess」一詞。</span><span class="sxs-lookup"><span data-stu-id="64a6f-111">We use the term ICS and SharedAccess interchangeably in this section, since Internet Connection Sharing is a major scenario for the wireless Hosted Network and the ICS term is better known to the user community.</span></span>

<span data-ttu-id="64a6f-112">無線裝載的網路緊密地系結至 ICS，讓無線個人區域網路 (平移) 和網際網路共用案例。</span><span class="sxs-lookup"><span data-stu-id="64a6f-112">Wireless Hosted Network is closely tied to ICS to enable both the wireless personal area network (PAN) and the Internet sharing scenarios.</span></span> <span data-ttu-id="64a6f-113">本節提供應用程式開發人員的一般建議，說明如何使用公用無線裝載網路和 ICS Api 來整合無線裝載的網路和 ICS。</span><span class="sxs-lookup"><span data-stu-id="64a6f-113">This section provides general recommendations to application developers on how to integrate wireless Hosted Network and ICS using the public wireless Hosted Network and ICS APIs.</span></span>

## <a name="internet-connection-sharing"></a><span data-ttu-id="64a6f-114">網際網路連線共用</span><span class="sxs-lookup"><span data-stu-id="64a6f-114">Internet Connection Sharing</span></span>

<span data-ttu-id="64a6f-115">ICS 服務可在兩種可能的模式下運作：</span><span class="sxs-lookup"><span data-stu-id="64a6f-115">The ICS Service operates in one of the two possible modes:</span></span>

-   <span data-ttu-id="64a6f-116">獨立模式</span><span class="sxs-lookup"><span data-stu-id="64a6f-116">Standalone mode</span></span>

    <span data-ttu-id="64a6f-117">只有當叫用 ICS 服務時，才會操作 DHCPv4 伺服器功能。</span><span class="sxs-lookup"><span data-stu-id="64a6f-117">Only the DHCPv4 server function is operating when the ICS service is invoked.</span></span> <span data-ttu-id="64a6f-118">這是適用于 ICS 的特殊操作模式，只能透過無線裝載的網路使用。</span><span class="sxs-lookup"><span data-stu-id="64a6f-118">This is a special operation mode for ICS and is only made available through the wireless Hosted Network.</span></span> <span data-ttu-id="64a6f-119">使用者或應用程式無法透過公用 ICS Api 或 **netsh** 命令直接啟動及停止獨立 ics。</span><span class="sxs-lookup"><span data-stu-id="64a6f-119">A user or application is not able to directly start and stop standalone ICS through public ICS APIs or **netsh** commands.</span></span> <span data-ttu-id="64a6f-120">啟動無線裝載的網路通常牽涉到以獨立模式啟動 ICS，以使用 DHCPv4 伺服器功能為連線的裝置提供私人 IPv4 位址。</span><span class="sxs-lookup"><span data-stu-id="64a6f-120">Starting the wireless Hosted Network typically involves starting ICS in standalone mode to use the DHCPv4 server function to provide private IPv4 addresses for connected devices.</span></span> <span data-ttu-id="64a6f-121">連線裝置的網路通訊限制為在連線的裝置與裝載無線裝載網路的本機電腦之間，以及連線裝置本身之間傳送和接收網路封包。</span><span class="sxs-lookup"><span data-stu-id="64a6f-121">Network communication for the connected devices is limited to sending and receiving network packets between a connected device and the local computer hosting the wireless Hosted Network and among the connected devices themselves.</span></span> <span data-ttu-id="64a6f-122">這可有效地啟用無線裝載網路的無線個人區域網路案例。</span><span class="sxs-lookup"><span data-stu-id="64a6f-122">This effectively enables the wireless personal area network scenario for the wireless Hosted Network.</span></span>

-   <span data-ttu-id="64a6f-123">完整模式</span><span class="sxs-lookup"><span data-stu-id="64a6f-123">Full mode</span></span>

    <span data-ttu-id="64a6f-124">當叫用服務時，ICS 的所有功能都是運作中的，例如 IPv4 與 IPv6 的網路位址轉譯和 DHCP 伺服器功能。</span><span class="sxs-lookup"><span data-stu-id="64a6f-124">All the features of ICS are operating when the service is invoked, such as network address translation and DHCP server functions for both IPv4 and IPv6.</span></span> <span data-ttu-id="64a6f-125">這是適用于 ICS 的正常操作模式。</span><span class="sxs-lookup"><span data-stu-id="64a6f-125">This is the normal mode of operation for ICS.</span></span> <span data-ttu-id="64a6f-126">使用者或應用程式可以透過公用 Api 或 netshell 命令來啟動和停止完整的 ICS 模式。</span><span class="sxs-lookup"><span data-stu-id="64a6f-126">A user or application may start and stop full ICS mode through public APIs or netshell commands.</span></span> <span data-ttu-id="64a6f-127">例如，您可以從提升許可權的命令提示字元使用 net stop win2k3 sharedaccess 來停止此服務。</span><span class="sxs-lookup"><span data-stu-id="64a6f-127">For example, this service can be stopped using net stop sharedaccess from an elevated command prompt.</span></span> <span data-ttu-id="64a6f-128">將無線裝載的網路與完整的 ICS 結合，連接裝置的網路通訊不限於無線 PAN。</span><span class="sxs-lookup"><span data-stu-id="64a6f-128">Combining wireless Hosted Network with full ICS, Network communication for the connected devices is not limited to the wireless PAN.</span></span> <span data-ttu-id="64a6f-129">任何連線的裝置都可以存取網路 (例如，從執行無線裝載網路的電腦透過共用網路連線來) 網際網路。</span><span class="sxs-lookup"><span data-stu-id="64a6f-129">Any connected device has access to network (such as the Internet) through the shared network connection from the computer running the wireless Hosted Network.</span></span> <span data-ttu-id="64a6f-130">這可有效地啟用無線託管網路的網路共用案例。</span><span class="sxs-lookup"><span data-stu-id="64a6f-130">This effectively enables the Network sharing scenario for the wireless Hosted Network.</span></span>

<span data-ttu-id="64a6f-131">在本節中，我們會使用「完整 ICS」一詞來表示在 ICS 服務中叫用所有 ICS 功能的情況，以提供無線託管網路的所有完整 ICS 功能存取權。</span><span class="sxs-lookup"><span data-stu-id="64a6f-131">In this section, we use the term full ICS to mean the case where all the ICS functions are invoked in ICS Service to provide access to all the full ICS features with the wireless Hosted Network.</span></span>

<span data-ttu-id="64a6f-132">這兩個 ICS 作業模式與具有較高優先順序的完整 ICS 相互排斥。</span><span class="sxs-lookup"><span data-stu-id="64a6f-132">The two ICS operation modes are mutually exclusive with full ICS taking higher precedence.</span></span> <span data-ttu-id="64a6f-133">ICS 服務可以從獨立模式轉換為完整模式，但無法從完整模式轉換成獨立模式。</span><span class="sxs-lookup"><span data-stu-id="64a6f-133">The ICS Service may transition from standalone mode to full mode, but not from full mode to standalone mode.</span></span> <span data-ttu-id="64a6f-134">在 Windows 7 和 Windows Server 2008 R2 上引進了 ICS 獨立模式，並將無線局域網路服務與無線裝載的網路功能一起安裝。</span><span class="sxs-lookup"><span data-stu-id="64a6f-134">The ICS standalone mode was introduced in Windows 7 and on Windows Server 2008 R2 with the Wireless LAN Service installed in conjunction with the wireless Hosted Network feature.</span></span> <span data-ttu-id="64a6f-135">在舊版的 Windows 中無法使用。</span><span class="sxs-lookup"><span data-stu-id="64a6f-135">It is not available in previous versions of Windows.</span></span>

<span data-ttu-id="64a6f-136">任何完整的 ICS 操作都牽涉到系統中的兩個不同網路介面卡：</span><span class="sxs-lookup"><span data-stu-id="64a6f-136">Any full ICS operation involves two different network adapters in the system:</span></span>

-   <span data-ttu-id="64a6f-137">公用介面。</span><span class="sxs-lookup"><span data-stu-id="64a6f-137">The public interface.</span></span> <span data-ttu-id="64a6f-138">這是可存取網際網路的網路介面。</span><span class="sxs-lookup"><span data-stu-id="64a6f-138">This is the network interface with access to the Internet.</span></span> <span data-ttu-id="64a6f-139">這是執行 ICS 的本機電腦用來與透過 SoftAP 連接到它的用戶端和裝置共用網際網路的介面。</span><span class="sxs-lookup"><span data-stu-id="64a6f-139">It is this interface that the local computer running ICS uses to share the Internet with clients and devices connecting to it via SoftAP.</span></span>
-   <span data-ttu-id="64a6f-140">私用介面。</span><span class="sxs-lookup"><span data-stu-id="64a6f-140">The private interface.</span></span> <span data-ttu-id="64a6f-141">這是其他裝置用來連接到執行 ICS 之本機電腦的網路介面。</span><span class="sxs-lookup"><span data-stu-id="64a6f-141">This is the network interface that other devices use to connect to the local computer that is running ICS.</span></span> <span data-ttu-id="64a6f-142">在此私人介面上執行的 DHCPv4 伺服器，可將私人本機 IP 位址提供給其他遠端電腦。</span><span class="sxs-lookup"><span data-stu-id="64a6f-142">A DHCPv4 server is running on this private interface to provide private local IP addresses to the other remote computers.</span></span>

<span data-ttu-id="64a6f-143">當公用介面沒有網際網路存取權時，私人介面上的 DHCP 伺服器會繼續提供本機 IP 位址給連線的裝置。</span><span class="sxs-lookup"><span data-stu-id="64a6f-143">When the public interface does not have Internet access, the DHCP server on the private interface continues to provide local IP addresses to the connected devices.</span></span> <span data-ttu-id="64a6f-144">獨立 ICS 只牽涉到 SoftAP 執行所在的私用介面;它不包含任何公用介面。</span><span class="sxs-lookup"><span data-stu-id="64a6f-144">Standalone ICS only involves the private interface on which SoftAP is running; it does not involve any public interface.</span></span>

<span data-ttu-id="64a6f-145">在本機電腦上，最多隻會執行一個完整的 ICS 實例。</span><span class="sxs-lookup"><span data-stu-id="64a6f-145">At any time, there is at most one instance of full ICS running on the local computer.</span></span> <span data-ttu-id="64a6f-146">如果本機電腦上已有完整的 ICS 正在執行，則啟動另一個完整的 ICS 會出現下列功能行為：</span><span class="sxs-lookup"><span data-stu-id="64a6f-146">If full ICS is already running on the local computer, starting another full ICS exhibits the following functional behaviors:</span></span>

-   <span data-ttu-id="64a6f-147">如果新的完整 ICS 的公用和私用介面與現有的完整 ics 相同，則啟動第二個完整的 ICS 相當於無作業。</span><span class="sxs-lookup"><span data-stu-id="64a6f-147">If the public and private interfaces of the new full ICS are the same as the existing full ICS, starting the second full ICS is equivalent to a no-op.</span></span>
-   <span data-ttu-id="64a6f-148">如果新的公用介面與舊的公用介面不同，但新的私用介面與舊的私用介面相同，則啟動第二個完整的 ICS 對相同私用介面上的連線裝置不會有很大的影響。</span><span class="sxs-lookup"><span data-stu-id="64a6f-148">If the new public interface is different from the old public interface, but the new private interface is the same as the old private interface, starting a second full ICS has little impact on the connected devices on the same private interface.</span></span> <span data-ttu-id="64a6f-149">存取網際網路的能力可能會隨著新的公用介面而改變。</span><span class="sxs-lookup"><span data-stu-id="64a6f-149">The ability to access the Internet may change with the new public interface.</span></span>
-   <span data-ttu-id="64a6f-150">如果新的私用介面與舊的私用介面不同，ICS 函式將會停止使用舊的私用介面，並開始套用至新的私用介面。</span><span class="sxs-lookup"><span data-stu-id="64a6f-150">If the new private interface is different than the old private interface, ICS functions will stop working on the old private interface and start applying to the new private interface.</span></span> <span data-ttu-id="64a6f-151">使用舊的私人介面連接到本機電腦的任何遠端裝置，將會失去與本機電腦的 IP 連線能力。</span><span class="sxs-lookup"><span data-stu-id="64a6f-151">Any remote device connecting to the local computer using the old private interface will lose IP connectivity to the local computer.</span></span>

<span data-ttu-id="64a6f-152">當完整的 ICS 已在執行時，只要第二個 ICS 整合使用不同的新私用介面，叫用第二個完整的 ICS 將會干擾使用舊私用介面從遠端連線的裝置。</span><span class="sxs-lookup"><span data-stu-id="64a6f-152">When full ICS is already running, invoking a second full ICS is disruptive to remotely connected devices using the old private interface as long as the second ICS integration uses a different new private interface.</span></span>

<span data-ttu-id="64a6f-153">若要管理和使用 ICS 服務以支援與無線託管網路的 ICS 整合，軟體應用程式必須先取得 [**INetSharingManager**](/windows/win32/api/netcon/nn-netcon-inetsharingmanager) 介面。</span><span class="sxs-lookup"><span data-stu-id="64a6f-153">To manage and use the ICS service to support ICS integration with wireless Hosted Network, a software application must first obtain an [**INetSharingManager**](/windows/win32/api/netcon/nn-netcon-inetsharingmanager) interface.</span></span> <span data-ttu-id="64a6f-154">**INetSharingManager** 介面可讓您直接或間接存取 ICS API 中的所有其他 COM 介面。</span><span class="sxs-lookup"><span data-stu-id="64a6f-154">The **INetSharingManager** interface provides access directly or indirectly to all the other COM interfaces in the ICS API.</span></span> <span data-ttu-id="64a6f-155">**INetSharingManager** 介面上的 [**get \_ SharingInstalled**](/windows/win32/api/netcon/nf-netcon-inetsharingmanager-get_sharinginstalled)方法會報告本機電腦是否支援連接共用。</span><span class="sxs-lookup"><span data-stu-id="64a6f-155">The [**get\_SharingInstalled**](/windows/win32/api/netcon/nf-netcon-inetsharingmanager-get_sharinginstalled) method on the **INetSharingManager** interface reports whether the local computer supports connection sharing.</span></span> <span data-ttu-id="64a6f-156">**INetSharingManager** 介面上的 [**get \_ EnumEveryConnection**](/windows/win32/api/netcon/nf-netcon-inetsharingmanager-get_enumeveryconnection)方法會抓取連接資料夾中所有連接的列舉介面。</span><span class="sxs-lookup"><span data-stu-id="64a6f-156">The [**get\_EnumEveryConnection**](/windows/win32/api/netcon/nf-netcon-inetsharingmanager-get_enumeveryconnection) method on the **INetSharingManager** interface retrieves an enumeration interface for all connections in the connections folder.</span></span> <span data-ttu-id="64a6f-157">[**Get \_ INetSharingConfigurationForINetConnection**](/windows/win32/api/netcon/nf-netcon-inetsharingmanager-get_inetsharingconfigurationforinetconnection)方法會抓取指定連接的 [**INetSharingConfiguration**](/windows/win32/api/netcon/nn-netcon-inetsharingconfiguration)介面。</span><span class="sxs-lookup"><span data-stu-id="64a6f-157">The [**get\_INetSharingConfigurationForINetConnection**](/windows/win32/api/netcon/nf-netcon-inetsharingmanager-get_inetsharingconfigurationforinetconnection) method retrieves an [**INetSharingConfiguration**](/windows/win32/api/netcon/nn-netcon-inetsharingconfiguration) interface for the specified connection.</span></span> <span data-ttu-id="64a6f-158">**INetSharingConfiguration** 介面上的方法可以用來查詢和變更 ICS 設定。</span><span class="sxs-lookup"><span data-stu-id="64a6f-158">Methods on the **INetSharingConfiguration** interface can be used to query and change ICS settings.</span></span>

<span data-ttu-id="64a6f-159">在呼叫 [**INetSharingManager**](/windows/win32/api/netcon/nn-netcon-inetsharingmanager)介面上的 [**get \_ EnumEveryConnection**](/windows/win32/api/netcon/nf-netcon-inetsharingmanager-get_enumeveryconnection)方法之前，必須先啟動無線裝載的網路，以列舉 [連接] 資料夾中的所有連接。</span><span class="sxs-lookup"><span data-stu-id="64a6f-159">The wireless Hosted Network must be started before calling the [**get\_EnumEveryConnection**](/windows/win32/api/netcon/nf-netcon-inetsharingmanager-get_enumeveryconnection) method on the [**INetSharingManager**](/windows/win32/api/netcon/nn-netcon-inetsharingmanager) interface to enumerate all connections in the connections folder.</span></span>

<span data-ttu-id="64a6f-160">如需有關可用來查詢及變更 ICS 設定之 ICS 和公用介面和方法的詳細資訊，請參閱 [有關網際網路連線共用和網際網路連線防火牆](/previous-versions/windows/desktop/ics/about-internet-connection-sharing-and-internet-connection-firewall)的檔。</span><span class="sxs-lookup"><span data-stu-id="64a6f-160">For information on ICS and the public interfaces and methods that can be used to query and change ICS settings, please see the documentation on [About Internet Connection Sharing and Internet Connection Firewall](/previous-versions/windows/desktop/ics/about-internet-connection-sharing-and-internet-connection-firewall).</span></span>

## <a name="hosted-network-and-ics-integration"></a><span data-ttu-id="64a6f-161">Hosted Network and ICS 整合</span><span class="sxs-lookup"><span data-stu-id="64a6f-161">Hosted Network and ICS Integration</span></span>

<span data-ttu-id="64a6f-162">當完整 ICS 未執行時，啟動無線裝載的網路也會在內部以獨立模式啟動 ICS 服務，只使用 DHCPv4 伺服器函式，為無線裝載網路介面上的連線裝置配置 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="64a6f-162">When full ICS is not running, starting a wireless Hosted Network also internally starts the ICS Service in standalone mode with only the DHCPv4 server function to allocate IP addresses for the connected devices on the wireless Hosted Network interface.</span></span> <span data-ttu-id="64a6f-163">獨立的 DHCPv4 伺服器的子網位址範圍是 192.168.173.0/24。</span><span class="sxs-lookup"><span data-stu-id="64a6f-163">The subnet address range for the standalone DHCPv4 server is 192.168.173.0/24.</span></span> <span data-ttu-id="64a6f-164">這與搭配 full ICS 使用的 192.168.137.0/24 子網範圍不同。</span><span class="sxs-lookup"><span data-stu-id="64a6f-164">This is different from the subnet range of 192.168.137.0/24 that is used with full ICS.</span></span>

<span data-ttu-id="64a6f-165">使用 full ICS 啟動無線裝載的網路時，會採用下列邏輯：</span><span class="sxs-lookup"><span data-stu-id="64a6f-165">Starting a wireless Hosted Network with full ICS employs the following logic:</span></span>

-   <span data-ttu-id="64a6f-166">如果完整的 ICS 尚未執行，則啟動無線裝載的網路也會啟動具有獨立 DHCPv4 伺服器的 ICS 服務。</span><span class="sxs-lookup"><span data-stu-id="64a6f-166">If full ICS is not already running, starting a wireless Hosted Network also starts the ICS Service with standalone DHCPv4 server.</span></span>
-   <span data-ttu-id="64a6f-167">如果完整的 ICS 已經在執行，而且私用介面是無線裝載的網路介面，只要啟動無線裝載的網路即可。</span><span class="sxs-lookup"><span data-stu-id="64a6f-167">If full ICS is already running and the private interface is the wireless Hosted Network interface, just start the wireless Hosted Network.</span></span>
-   <span data-ttu-id="64a6f-168">如果完整的 ICS 已經在執行，但私用介面不是無線裝載的網路介面，則無線裝載的網路將會啟動，而不需要在無線裝載的網路介面上執行 DHCPv4 伺服器功能。</span><span class="sxs-lookup"><span data-stu-id="64a6f-168">If full ICS is already running but the private interface is not the wireless Hosted Network interface, the wireless Hosted Network will be started without the DHCPv4 server function on the wireless Hosted Network interface.</span></span>

<span data-ttu-id="64a6f-169">上述邏輯的影響反白顯示下列事實：</span><span class="sxs-lookup"><span data-stu-id="64a6f-169">The impact of the logic above highlights the following facts:</span></span>

-   <span data-ttu-id="64a6f-170">ICS 不會從完整模式轉換成獨立模式。</span><span class="sxs-lookup"><span data-stu-id="64a6f-170">ICS does not transition from full mode to standalone mode.</span></span>
-   <span data-ttu-id="64a6f-171">只有當 ICS 未以完整模式執行時，無線裝載的網路才能叫用獨立模式。</span><span class="sxs-lookup"><span data-stu-id="64a6f-171">Standalone mode can only be invoked by the wireless Hosted Network when ICS is not running in full mode.</span></span>
-   <span data-ttu-id="64a6f-172">如果 ICS 以獨立模式執行，則如果使用者或應用程式以完整模式啟動 ICS，它就會被搶先成為完整模式。</span><span class="sxs-lookup"><span data-stu-id="64a6f-172">If ICS is running in standalone mode, it will be preempted into full mode if a user or application starts ICS in full mode.</span></span>
-   <span data-ttu-id="64a6f-173">如果完整 ICS 的私用介面與 SoftAP 的私用介面不同，則在 ICS 中從獨立模式轉換成完整模式將會干擾無線 PAN 中的連線裝置。</span><span class="sxs-lookup"><span data-stu-id="64a6f-173">Transitioning from standalone mode to full mode in ICS will be disruptive to connected devices in the wireless PAN if the private interface of full ICS is not the same as the one for SoftAP.</span></span>

<span data-ttu-id="64a6f-174">在本機電腦上以完整或獨立模式啟動或停止 ICS 服務需要一些時間。</span><span class="sxs-lookup"><span data-stu-id="64a6f-174">It takes time to start or stop the ICS Service on the local computer in either full or standalone mode.</span></span> <span data-ttu-id="64a6f-175">應用程式應該使用 **NotifyServiceStatusChange** 函式來檢查 ics 服務的狀態，以確定 ics 服務不是處於啟動/停止擱置狀態，然後才啟動或停止無線託管網路以與 ICS 整合搭配使用。</span><span class="sxs-lookup"><span data-stu-id="64a6f-175">An application should check the state of ICS Service using the **NotifyServiceStatusChange** function to make sure that the ICS Service is not in the start/stop pending state before starting or stopping the wireless Hosted Network for use with ICS integration.</span></span>

## <a name="starting-and-stopping-the-wireless-hosted-network"></a><span data-ttu-id="64a6f-176">啟動和停止無線託管網路</span><span class="sxs-lookup"><span data-stu-id="64a6f-176">Starting and Stopping the Wireless Hosted Network</span></span>

<span data-ttu-id="64a6f-177">Windows 所提供的平臺，可以讓多個並行應用程式同時管理無線裝載的網路。</span><span class="sxs-lookup"><span data-stu-id="64a6f-177">Windows provides a platform where more than one concurrent application is allowed to manage a wireless Hosted Network at the same time.</span></span> <span data-ttu-id="64a6f-178">具體而言，每個應用程式都可以自行啟動及停止無線裝載的網路，而不需要事先瞭解其他應用程式。</span><span class="sxs-lookup"><span data-stu-id="64a6f-178">Specifically each application can start and stop the wireless Hosted Network on its own, without prior knowledge about other applications.</span></span>

<span data-ttu-id="64a6f-179">有兩組函式可以啟動和停止託管網路。</span><span class="sxs-lookup"><span data-stu-id="64a6f-179">There are two sets of functions to start and stop a Hosted Network.</span></span>

<span data-ttu-id="64a6f-180">多個應用程式可能需要使用無線託管網路。</span><span class="sxs-lookup"><span data-stu-id="64a6f-180">Multiple applications may require the use of the wireless Hosted Network.</span></span> <span data-ttu-id="64a6f-181">[**WlanHostedNetworkStartUsing**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstartusing)和 [**WlanHostedNetworkStopUsing**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstopusing)函式會啟動和停止無線裝載網路輸入與其他並行應用程式相容的方式。</span><span class="sxs-lookup"><span data-stu-id="64a6f-181">The [**WlanHostedNetworkStartUsing**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstartusing) and [**WlanHostedNetworkStopUsing**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstopusing) functions start and stop a wireless Hosted Network in a way that is compatible with other concurrent applications.</span></span> <span data-ttu-id="64a6f-182">**WlanHostedNetworkStartUsing** 和 **WlanHostedNetworkStopUsing** 函式可讓應用程式擁有無線託管網路的參考。</span><span class="sxs-lookup"><span data-stu-id="64a6f-182">The **WlanHostedNetworkStartUsing** and **WlanHostedNetworkStopUsing** functions allow an application to have a reference to the wireless Hosted Network.</span></span> <span data-ttu-id="64a6f-183">這項機制會讓無線裝載的網路維持執行狀態，前提是至少有一個其他應用程式具有無線裝載網路的目前參考。</span><span class="sxs-lookup"><span data-stu-id="64a6f-183">This mechanism keeps the wireless Hosted Network running provided that at least one other application has a current reference to the wireless Hosted Network.</span></span> <span data-ttu-id="64a6f-184">任何使用者都可以呼叫這些函式。</span><span class="sxs-lookup"><span data-stu-id="64a6f-184">Any user can call these functions.</span></span> <span data-ttu-id="64a6f-185">成功呼叫 **WlanHostedNetworkStartUsing** 必須透過呼叫 **WlanHostedNetworkStopUsing** 函式來進行比對。</span><span class="sxs-lookup"><span data-stu-id="64a6f-185">Successful calls to **WlanHostedNetworkStartUsing** must be matched by calls to the **WlanHostedNetworkStopUsing** function.</span></span> <span data-ttu-id="64a6f-186">**WlanHostedNetworkStartUsing** 函式所造成的任何裝載網路狀態變更都會自動復原，因為呼叫端應用程式會使用傳遞至 **WlanHostedNetworkStartUsing**) 的相同 *hClientHandle* 參數來呼叫 WlanCloseHandle，或在進程結束時呼叫 [](/windows/desktop/api/wlanapi/nf-wlanapi-wlanclosehandle) ，藉以關閉其呼叫控制碼 (。</span><span class="sxs-lookup"><span data-stu-id="64a6f-186">Any Hosted Network state change caused by the **WlanHostedNetworkStartUsing** function would be automatically undone if the calling application closes its calling handle (by calling [**WlanCloseHandle**](/windows/desktop/api/wlanapi/nf-wlanapi-wlanclosehandle) with the same *hClientHandle* parameter passed to **WlanHostedNetworkStartUsing**) or if the process ends.</span></span>

<span data-ttu-id="64a6f-187">[**WlanHostedNetworkForceStart**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestart)和 [**WlanHostedNetworkForceStop**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestop)函式會強制啟動及停止無線裝載的網路。</span><span class="sxs-lookup"><span data-stu-id="64a6f-187">The [**WlanHostedNetworkForceStart**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestart) and [**WlanHostedNetworkForceStop**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestop) functions force start and stop a wireless Hosted Network.</span></span> <span data-ttu-id="64a6f-188">只有當使用者具有適當的提高許可權時，才可以呼叫這些函式。</span><span class="sxs-lookup"><span data-stu-id="64a6f-188">These functions can only be called if the user has the appropriate elevated privilege.</span></span> <span data-ttu-id="64a6f-189">**WlanHostedNetworkForceStart** 的成功呼叫最後可能會透過呼叫 **WlanHostedNetworkForceStop** 函式來比對，視應用程式設計而定。</span><span class="sxs-lookup"><span data-stu-id="64a6f-189">Successful calls to **WlanHostedNetworkForceStart** may eventually be matched by a call to the **WlanHostedNetworkForceStop** function, depending on the application design.</span></span> <span data-ttu-id="64a6f-190">這些函式會轉換無線裝載的網路狀態，而不會將要求與應用程式的呼叫控制碼產生關聯。</span><span class="sxs-lookup"><span data-stu-id="64a6f-190">These functions transition the wireless Hosted Network state without associating the request with the application's calling handle.</span></span> <span data-ttu-id="64a6f-191">**WlanHostedNetworkForceStart** 函式所造成的任何裝載網路狀態變更將不會自動復原，因為呼叫端應用程式會使用傳遞至 [**WlanHostedNetworkStartUsing**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstartusing)) 的相同 *hClientHandle* 參數來呼叫 WlanCloseHandle，或在進程結束時呼叫 [](/windows/desktop/api/wlanapi/nf-wlanapi-wlanclosehandle) ，以關閉其呼叫控制碼 (。</span><span class="sxs-lookup"><span data-stu-id="64a6f-191">Any Hosted Network state change caused by the **WlanHostedNetworkForceStart** function would not be automatically undone if the calling application closes its calling handle (by calling [**WlanCloseHandle**](/windows/desktop/api/wlanapi/nf-wlanapi-wlanclosehandle) with the same *hClientHandle* parameter passed to [**WlanHostedNetworkStartUsing**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstartusing)) or if the process ends.</span></span> <span data-ttu-id="64a6f-192">如果呼叫 **WlanHostedNetworkForceStart** 函式的應用程式在未呼叫其中一個函式的情況下關閉，以停止無線裝載的網路，則裝載的網路會保持執行狀態。</span><span class="sxs-lookup"><span data-stu-id="64a6f-192">If the application that called the **WlanHostedNetworkForceStart** function closes without calling one of the functions to stop the wireless Hosted Network, then Hosted Network is left running.</span></span> <span data-ttu-id="64a6f-193">應用程式可能會在確定較高的系統使用者接受執行無線裝載網路所需的增加電源需求時，呼叫 **WlanHostedNetworkForceStart** 函式的時間延長一段時間。</span><span class="sxs-lookup"><span data-stu-id="64a6f-193">An application might call the **WlanHostedNetworkForceStart** function after ensuring that an elevated system user accepts the increased power requirements involved in running the wireless Hosted Network for extended periods of time.</span></span>

<span data-ttu-id="64a6f-194">要呼叫哪些函式來啟動及停止無線裝載網路的一般建議如下：</span><span class="sxs-lookup"><span data-stu-id="64a6f-194">The general recommendations on which functions to call to start and stop a wireless Hosted Network are as follows:</span></span>

-   <span data-ttu-id="64a6f-195">使用應用程式內的 [**WlanHostedNetworkStartUsing**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstartusing) 和 [**WlanHostedNetworkStopUsing**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstopusing) 函式來啟動及停止無線裝載的網路。</span><span class="sxs-lookup"><span data-stu-id="64a6f-195">Use the [**WlanHostedNetworkStartUsing**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstartusing) and [**WlanHostedNetworkStopUsing**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstopusing) functions within an application to start and stop a wireless Hosted Network.</span></span>
-   <span data-ttu-id="64a6f-196">除非應用程式絕對需要，否則請勿使用 [**WlanHostedNetworkForceStart**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestart) 函式來啟動無線裝載網路。</span><span class="sxs-lookup"><span data-stu-id="64a6f-196">Do not use the [**WlanHostedNetworkForceStart**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestart) function to start a wireless Hosted Network unless it is absolutely required by the application.</span></span> <span data-ttu-id="64a6f-197">**WlanHostedNetworkForceStart** 函式也需要較高的許可權。</span><span class="sxs-lookup"><span data-stu-id="64a6f-197">The **WlanHostedNetworkForceStart** function also requires elevated privileges.</span></span>
-   <span data-ttu-id="64a6f-198">只使用 [**WlanHostedNetworkForceStop**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestop) 函式做為修復方法。</span><span class="sxs-lookup"><span data-stu-id="64a6f-198">Only use the [**WlanHostedNetworkForceStop**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestop) function as a recovery method.</span></span> <span data-ttu-id="64a6f-199">**WlanHostedNetworkForceStop** 函式會導致無線託管網路立即停止。</span><span class="sxs-lookup"><span data-stu-id="64a6f-199">The **WlanHostedNetworkForceStop** function causes a wireless Hosted Network to stop immediately.</span></span> <span data-ttu-id="64a6f-200">其他接聽無線託管網路通知的應用程式可能需要採取修復動作。</span><span class="sxs-lookup"><span data-stu-id="64a6f-200">Other applications that listen for wireless Hosted Network notifications may need to take recovery actions.</span></span> <span data-ttu-id="64a6f-201">如需詳細資訊，請參閱下面的討論，以瞭解無線託管網路的復原順序。</span><span class="sxs-lookup"><span data-stu-id="64a6f-201">For more information, see the discussion below on the recovery sequence for wireless Hosted Network.</span></span>

## <a name="start-sequence-for-wireless-hosted-network"></a><span data-ttu-id="64a6f-202">無線託管網路的開始順序</span><span class="sxs-lookup"><span data-stu-id="64a6f-202">Start Sequence for Wireless Hosted Network</span></span>

<span data-ttu-id="64a6f-203">對於使用完整 ICS 啟動無線裝載網路的應用程式，建議您啟動無線裝載的網路，然後啟動完整的 ICS。</span><span class="sxs-lookup"><span data-stu-id="64a6f-203">For an application that starts a wireless Hosted Network with full ICS, the recommendation is to start the wireless Hosted Network, then start full ICS.</span></span> <span data-ttu-id="64a6f-204">如果無線裝載的網路已在執行中，應用程式應該使用 [**WlanHostedNetworkForceStop**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestop) 函式，只有在需要完整 ICS 但未在啟動託管網路之前啟用時，才能使用函式來停止無線託管網路。</span><span class="sxs-lookup"><span data-stu-id="64a6f-204">If a wireless Hosted Network is already running, an application should use the [**WlanHostedNetworkForceStop**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestop) function to stop the wireless Hosted Network only if full ICS is required but has not been enabled before the Hosted Network was started.</span></span> <span data-ttu-id="64a6f-205">這可讓其他應用程式從完整 ICS 啟動所造成的潛在中斷中復原。</span><span class="sxs-lookup"><span data-stu-id="64a6f-205">This will allow other applications to recover from potential disruptions caused by the start of full ICS.</span></span> <span data-ttu-id="64a6f-206">如需詳細資訊，請參閱下面的討論，以瞭解無線託管網路的復原順序。</span><span class="sxs-lookup"><span data-stu-id="64a6f-206">For more information, see the discussion below on the recovery sequence for wireless Hosted Network.</span></span> <span data-ttu-id="64a6f-207">合併作業應該會成功，並整體失敗。</span><span class="sxs-lookup"><span data-stu-id="64a6f-207">The combined operation should succeed and fail as a whole.</span></span>

> [!Note]  
> <span data-ttu-id="64a6f-208">在嘗試使用 [**IEnumNetSharingEveryConnection**](/windows/win32/api/netcon/nn-netcon-ienumnetsharingeveryconnection) 介面列舉對應的介面卡之前，必須先啟動無線託管網路。</span><span class="sxs-lookup"><span data-stu-id="64a6f-208">The wireless Hosted Network must be started before attempting to enumerate the corresponding adapter using the [**IEnumNetSharingEveryConnection**](/windows/win32/api/netcon/nn-netcon-ienumnetsharingeveryconnection) interface.</span></span>

 

<span data-ttu-id="64a6f-209">以下是在使用具有完整 ICS 的無線託管網路的應用程式中，建議的起始順序：</span><span class="sxs-lookup"><span data-stu-id="64a6f-209">The following ordered steps are the recommended start sequence in an application using wireless Hosted Network with full ICS:</span></span>

-   <span data-ttu-id="64a6f-210">呼叫 [**WlanHostedNetworkInitSettings**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkinitsettings) 函式，以確定無線裝載的網路已設定且可供使用。</span><span class="sxs-lookup"><span data-stu-id="64a6f-210">Call the [**WlanHostedNetworkInitSettings**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkinitsettings) function to make sure wireless Hosted Network is configured and ready to be used.</span></span>
-   <span data-ttu-id="64a6f-211">呼叫 [**WlanHostedNetworkQueryStatus**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkquerystatus) 和 [**WlanHostedNetworkQueryProperty**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkqueryproperty) 函式，以判斷是否允許和提供無線裝載的網路。</span><span class="sxs-lookup"><span data-stu-id="64a6f-211">Call the [**WlanHostedNetworkQueryStatus**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkquerystatus) and [**WlanHostedNetworkQueryProperty**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkqueryproperty) functions to determine if the wireless Hosted Network is allowed and available.</span></span> <span data-ttu-id="64a6f-212">如果不允許無線裝載的網路且無法使用，則會傳回錯誤。</span><span class="sxs-lookup"><span data-stu-id="64a6f-212">If the wireless Hosted Network is not allowed and not available, return an error.</span></span>
-   <span data-ttu-id="64a6f-213">測試以查看是否允許針對完整 ICS 使用的 ICS 服務。</span><span class="sxs-lookup"><span data-stu-id="64a6f-213">Test to see if the ICS Service used for full ICS is allowed.</span></span> <span data-ttu-id="64a6f-214">如果無法啟動 ICS 服務，則傳回錯誤。</span><span class="sxs-lookup"><span data-stu-id="64a6f-214">If the ICS service cannot be started, return an error.</span></span>
-   <span data-ttu-id="64a6f-215">呼叫 [**WlanHostedNetworkForceStop**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestop) 函式來強制停止無線裝載的網路。</span><span class="sxs-lookup"><span data-stu-id="64a6f-215">Call the [**WlanHostedNetworkForceStop**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestop) function to force a stop of the wireless Hosted Network.</span></span>
-   <span data-ttu-id="64a6f-216">呼叫 [**WlanHostedNetworkStartUsing**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstartusing) 函式以啟動無線裝載的網路。</span><span class="sxs-lookup"><span data-stu-id="64a6f-216">Call the [**WlanHostedNetworkStartUsing**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstartusing) function to start the wireless Hosted Network.</span></span>
-   <span data-ttu-id="64a6f-217">如果無線裝載的網路無法啟動，則會傳回錯誤。</span><span class="sxs-lookup"><span data-stu-id="64a6f-217">If the wireless Hosted Network fails to start, return an error.</span></span>
-   <span data-ttu-id="64a6f-218">如果完整的 ICS 已經在執行，而且目前的公用或私用介面與要使用的新介面不同，請快取目前的公用和私用介面。</span><span class="sxs-lookup"><span data-stu-id="64a6f-218">If full ICS is already running and the current public or private interface is different from the new interface to be used, cache the current public and private interfaces.</span></span> <span data-ttu-id="64a6f-219">如果已在執行 ICS 整合，應用程式也可以選擇傳回錯誤或提示使用者。</span><span class="sxs-lookup"><span data-stu-id="64a6f-219">An application may also choose to return an error or prompt the user if ICS integration is already running.</span></span>
-   <span data-ttu-id="64a6f-220">使用公用和私用介面的新設定來啟動完整的 ICS。</span><span class="sxs-lookup"><span data-stu-id="64a6f-220">Start full ICS with the new settings for the public and private interfaces.</span></span>
-   <span data-ttu-id="64a6f-221">如果完整 ICS 無法以這些設定啟動，請嘗試使用快取的公用和私用介面啟動完整的 ICS 服務（如果已有完整的 ICS）。</span><span class="sxs-lookup"><span data-stu-id="64a6f-221">If full ICS fails to start with these settings, try to start full ICS service with the cached public and private interfaces if full ICS was running before.</span></span> <span data-ttu-id="64a6f-222">呼叫 [**WlanHostedNetworkForceStop**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestop) 函式來停止無線裝載的網路，並傳回錯誤。</span><span class="sxs-lookup"><span data-stu-id="64a6f-222">Call the [**WlanHostedNetworkForceStop**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestop) function to stop the wireless Hosted Network and return an error.</span></span>
-   <span data-ttu-id="64a6f-223">傳回無線裝載的網路與完整 ICS 成功的成功。</span><span class="sxs-lookup"><span data-stu-id="64a6f-223">Return success that the wireless Hosted Network and full ICS succeed.</span></span>

## <a name="stop-sequence-for-wireless-hosted-network"></a><span data-ttu-id="64a6f-224">無線託管網路的停止順序</span><span class="sxs-lookup"><span data-stu-id="64a6f-224">Stop Sequence for Wireless Hosted Network</span></span>

<span data-ttu-id="64a6f-225">使用具有完整 ICS 的無線託管網路時，已完成其工作的應用程式可能會想要停止無線裝載的網路，以及用於完整 ICS 的 ICS 服務。</span><span class="sxs-lookup"><span data-stu-id="64a6f-225">When using wireless Hosted Network with full ICS, an application that has finished its work may want to stop the wireless Hosted Network and the ICS service used for full ICS.</span></span> <span data-ttu-id="64a6f-226">在此情況下，建議呼叫 [**WlanHostedNetworkForceStop**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestop) 函式來停止裝載的網路，而不是呼叫 [**WlanHostedNetworkStopUsing**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstopusing) 函數。</span><span class="sxs-lookup"><span data-stu-id="64a6f-226">In this case, it is recommended that the [**WlanHostedNetworkForceStop**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestop) function be called to stop the Hosted Network rather than calling the [**WlanHostedNetworkStopUsing**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstopusing) function.</span></span> <span data-ttu-id="64a6f-227">**WlanHostedNetworkForceStop** 函式會停止無線裝載的網路，也可讓其他應用程式復原。</span><span class="sxs-lookup"><span data-stu-id="64a6f-227">The **WlanHostedNetworkForceStop** function stops the wireless Hosted Network and also serves to allow other applications to recover.</span></span> <span data-ttu-id="64a6f-228">如需詳細資訊，請參閱下面的討論，以瞭解無線託管網路的復原順序。</span><span class="sxs-lookup"><span data-stu-id="64a6f-228">For more information, see the discussion below on the recovery sequence for wireless Hosted Network.</span></span>

<span data-ttu-id="64a6f-229">下列已排序的步驟是在使用無線裝載網路和完整 ICS 的應用程式中建議的停止順序：</span><span class="sxs-lookup"><span data-stu-id="64a6f-229">The following ordered steps are the recommended stop sequence in an application using wireless Hosted Network and full ICS:</span></span>

-   <span data-ttu-id="64a6f-230">停止完整 ICS。</span><span class="sxs-lookup"><span data-stu-id="64a6f-230">Stop full ICS.</span></span>
-   <span data-ttu-id="64a6f-231">呼叫 [**WlanHostedNetworkForceStop**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestop) 函式以停止無線裝載的網路。</span><span class="sxs-lookup"><span data-stu-id="64a6f-231">Call the [**WlanHostedNetworkForceStop**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestop) function to stop the wireless Hosted Network.</span></span>

<span data-ttu-id="64a6f-232">使用無線裝載網路的應用程式（沒有完整的 ICS）已完成其工作，只需要呼叫 [**WlanHostedNetworkStopUsing**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstopusing) 或 [**WlanHostedNetworkForceStop**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestop) 函式來停止無線裝載的網路。</span><span class="sxs-lookup"><span data-stu-id="64a6f-232">An application using wireless Hosted Network without full ICS that is finished with its work just needs to call the [**WlanHostedNetworkStopUsing**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstopusing) or [**WlanHostedNetworkForceStop**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestop) function to stop the wireless Hosted Network.</span></span> <span data-ttu-id="64a6f-233">如果呼叫 [**WlanHostedNetworkStartUsing**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstartusing) 函式來啟動無線裝載的網路，則應用程式應該呼叫 **WlanHostedNetworkStopUsing** 函式來停止無線裝載的網路。</span><span class="sxs-lookup"><span data-stu-id="64a6f-233">If the [**WlanHostedNetworkStartUsing**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstartusing) function was called to start the wireless Hosted Network, then the application should call the **WlanHostedNetworkStopUsing** function to stop the wireless Hosted Network.</span></span> <span data-ttu-id="64a6f-234">如果無線裝載的網路在應用程式或呼叫 [**WlanHostedNetworkForceStart**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestart) 函式來強制啟動無線裝載網路之前已啟動，則應用程式可以呼叫 **WlanHostedNetworkForceStop** 函式來停止無線裝載的網路，或不執行任何動作 (讓無線裝載的網路) 啟動，視案例而定。</span><span class="sxs-lookup"><span data-stu-id="64a6f-234">If the wireless Hosted Network was was already started before the application or the application called the [**WlanHostedNetworkForceStart**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestart) function to force start the wireless Hosted Network, then the application can call the **WlanHostedNetworkForceStop** function to stop the wireless Hosted Network or do nothing (leave wireless Hosted Network started) depending on the scenario.</span></span>

## <a name="recovery-sequence-for-wireless-hosted-network"></a><span data-ttu-id="64a6f-235">無線託管網路的復原順序</span><span class="sxs-lookup"><span data-stu-id="64a6f-235">Recovery Sequence for Wireless Hosted Network</span></span>

<span data-ttu-id="64a6f-236">使用無線託管網路的應用程式可能會受到其他應用程式的動作影響。</span><span class="sxs-lookup"><span data-stu-id="64a6f-236">An application using the wireless Hosted Network may be affected by the actions of other applications.</span></span> <span data-ttu-id="64a6f-237">ICS 服務和用於管理 ICS 的介面不提供任何方法讓應用程式註冊 ICS 變更通知。</span><span class="sxs-lookup"><span data-stu-id="64a6f-237">The ICS service and the interfaces for managing ICS provide no method for an application to register for ICS change notifications.</span></span> <span data-ttu-id="64a6f-238">如果另一個應用程式呼叫 [**INetSharingConfiguration**](/windows/win32/api/netcon/nn-netcon-inetsharingconfiguration)介面上的 [**EnableSharing**](/windows/win32/api/netcon/nf-netcon-inetsharingconfiguration-enablesharing)或 [**DisableSharing**](/windows/win32/api/netcon/nf-netcon-inetsharingconfiguration-disablesharing)方法來啟用或停用連接上的共用，則會將訊息傳送至使用者介面， (本機電腦上的螢幕) 不是其他應用程式。</span><span class="sxs-lookup"><span data-stu-id="64a6f-238">If another application calls the [**EnableSharing**](/windows/win32/api/netcon/nf-netcon-inetsharingconfiguration-enablesharing) or the [**DisableSharing**](/windows/win32/api/netcon/nf-netcon-inetsharingconfiguration-disablesharing) methods on the [**INetSharingConfiguration**](/windows/win32/api/netcon/nn-netcon-inetsharingconfiguration) interface to enable or disable sharing on a connection, a message is sent to the user interface (the screen) on the local computer not to other applications.</span></span> <span data-ttu-id="64a6f-239">如此一來，應用程式就必須依賴無線裝載的網路通知，以在發生 ICS 或無線裝載的網路變更時執行修復動作。</span><span class="sxs-lookup"><span data-stu-id="64a6f-239">So an application needs to rely on the wireless Hosted Network notifications to perform recovery actions when ICS or wireless Hosted Network changes occur.</span></span>

<span data-ttu-id="64a6f-240">使用無線裝載網路的應用程式應該呼叫 [**WlanRegisterNotification**](/windows/desktop/api/wlanapi/nf-wlanapi-wlanregisternotification)，以註冊無線裝載的網路通知。</span><span class="sxs-lookup"><span data-stu-id="64a6f-240">An application using the wireless Hosted Network should register for wireless Hosted Network notifications by calling the [**WlanRegisterNotification**](/windows/desktop/api/wlanapi/nf-wlanapi-wlanregisternotification).</span></span> <span data-ttu-id="64a6f-241">如果只需要無線裝載網路的通知，應用程式應該在傳遞至 **WlanRegisterNotification** 的 *dwNotifSource* 參數中傳遞 **WLAN \_ 通知 \_ 來源 \_ HNWK** 。</span><span class="sxs-lookup"><span data-stu-id="64a6f-241">If notifications for only wireless Hosted Network are needed, then the application should pass **WLAN\_NOTIFICATION\_SOURCE\_HNWK** in the *dwNotifSource* parameter passed to the **WlanRegisterNotification**.</span></span> <span data-ttu-id="64a6f-242">如果也需要其他無線 gcm，則應該將 [ **WLAN \_ 通知 \_ 來源 \_ HNWK** ] 與其他所需的無線通知類型的通知來源常數結合，並在 *dwNotifSource* 參數中傳遞此值。</span><span class="sxs-lookup"><span data-stu-id="64a6f-242">If other wireless notications are also needed, then **WLAN\_NOTIFICATION\_SOURCE\_HNWK** should be combined with the notification source constants for other types of wireless notifications desired and pass this value in the *dwNotifSource* parameter.</span></span>

<span data-ttu-id="64a6f-243">如果應用程式不想再次啟動 ICS 服務，則具有或不含完整 ICS 的應用程式復原順序會相同。</span><span class="sxs-lookup"><span data-stu-id="64a6f-243">The recovery sequence is the same for applications with or without full ICS, assuming that applications don’t want to start ICS service again.</span></span> <span data-ttu-id="64a6f-244">收到託管網路已停止的無線託管網路通知時，請執行下列動作：</span><span class="sxs-lookup"><span data-stu-id="64a6f-244">Upon receiving a wireless Hosted Network notification that the Hosted Network has stopped, do the following:</span></span>

-   <span data-ttu-id="64a6f-245">如果名為 [**WlanHostedNetworkForceStart**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestart) 的應用程式啟動無線裝載的網路，則呼叫 **WlanHostedNetworkForceStart** 以重新開機託管的網路。</span><span class="sxs-lookup"><span data-stu-id="64a6f-245">If the application called [**WlanHostedNetworkForceStart**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestart) to start the wireless Hosted Network, then restart the Hosted Network by calling **WlanHostedNetworkForceStart**.</span></span> <span data-ttu-id="64a6f-246">否則，請呼叫 [**WlanHostedNetworkStartUsing**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstartusing) 以重新開機無線裝載的網路。</span><span class="sxs-lookup"><span data-stu-id="64a6f-246">Otherwise, call [**WlanHostedNetworkStartUsing**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstartusing) to restart the wireless Hosted Network.</span></span>

## <a name="recovery-sequence-for-connected-devices"></a><span data-ttu-id="64a6f-247">已連線裝置的復原順序</span><span class="sxs-lookup"><span data-stu-id="64a6f-247">Recovery Sequence for Connected Devices</span></span>

<span data-ttu-id="64a6f-248">遠端裝置或連線到無線裝載網路的電腦，可能會受到影響 ICS 和無線裝載網路之其他應用程式的動作所影響。</span><span class="sxs-lookup"><span data-stu-id="64a6f-248">Remote devices or computers connected to the wireless Hosted Network may be affected by the actions of other applications that impact ICS and the wireless Hosted Network.</span></span> <span data-ttu-id="64a6f-249">幸運的是，大部分的裝置在裝置應用程式中都有內建的重試邏輯，以處理暫時遺失的信號或漫遊。</span><span class="sxs-lookup"><span data-stu-id="64a6f-249">Fortunately, most devices have built in retry logic in the device application to deal with a temporary loss of signal or roaming.</span></span>

<span data-ttu-id="64a6f-250">如果裝置或電腦連線到無線裝載網路而失去聯繫，則可能的復原順序如下所示：</span><span class="sxs-lookup"><span data-stu-id="64a6f-250">A possible recovery sequence for devices or computers connected to the wireless Hosted Network that lose contact is the following:</span></span>

-   <span data-ttu-id="64a6f-251">無線設備磁碟機表示媒體中斷連線至裝置上網路堆疊的上層。</span><span class="sxs-lookup"><span data-stu-id="64a6f-251">The wireless device driver indicates a media disconnect to the upper layers of the network stack on the device.</span></span>
-   <span data-ttu-id="64a6f-252">裝置應用程式會定期檢查無線託管網路的可用性。</span><span class="sxs-lookup"><span data-stu-id="64a6f-252">The device application starts periodic checks for the availability of the wireless Hosted Network.</span></span>
-   <span data-ttu-id="64a6f-253">一旦裝置應用程式再次偵測到無線裝載的網路，裝置就會起始無線連線。</span><span class="sxs-lookup"><span data-stu-id="64a6f-253">Once the device application again detects the wireless Hosted Network, the device initiates a wireless connection.</span></span>
-   <span data-ttu-id="64a6f-254">成功連線到無線託管網路時，裝置應用程式會據以更新其 IP 設定。</span><span class="sxs-lookup"><span data-stu-id="64a6f-254">Upon a successful connection with the wireless Hosted Network, the device application updates its IP settings accordingly.</span></span>

## <a name="related-topics"></a><span data-ttu-id="64a6f-255">相關主題</span><span class="sxs-lookup"><span data-stu-id="64a6f-255">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="64a6f-256">關於無線託管網路</span><span class="sxs-lookup"><span data-stu-id="64a6f-256">About the Wireless Hosted Network</span></span>](about-the-wireless-hosted-network.md)
</dt> <dt>

[<span data-ttu-id="64a6f-257">無線託管網路範例</span><span class="sxs-lookup"><span data-stu-id="64a6f-257">Wireless Hosted Network Sample</span></span>](wireless-hosted-network-sample.md)
</dt> <dt>

[<span data-ttu-id="64a6f-258">**WlanHostedNetworkForceStart**</span><span class="sxs-lookup"><span data-stu-id="64a6f-258">**WlanHostedNetworkForceStart**</span></span>](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestart)
</dt> <dt>

[<span data-ttu-id="64a6f-259">**WlanHostedNetworkInitSettings**</span><span class="sxs-lookup"><span data-stu-id="64a6f-259">**WlanHostedNetworkInitSettings**</span></span>](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkinitsettings)
</dt> <dt>

[<span data-ttu-id="64a6f-260">**WlanHostedNetworkQueryProperty**</span><span class="sxs-lookup"><span data-stu-id="64a6f-260">**WlanHostedNetworkQueryProperty**</span></span>](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkqueryproperty)
</dt> <dt>

[<span data-ttu-id="64a6f-261">**WlanHostedNetworkQuerySecondaryKey**</span><span class="sxs-lookup"><span data-stu-id="64a6f-261">**WlanHostedNetworkQuerySecondaryKey**</span></span>](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkquerysecondarykey)
</dt> <dt>

[<span data-ttu-id="64a6f-262">**WlanHostedNetworkQueryStatus**</span><span class="sxs-lookup"><span data-stu-id="64a6f-262">**WlanHostedNetworkQueryStatus**</span></span>](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkquerystatus)
</dt> <dt>

[<span data-ttu-id="64a6f-263">**WlanHostedNetworkRefreshSecuritySettings**</span><span class="sxs-lookup"><span data-stu-id="64a6f-263">**WlanHostedNetworkRefreshSecuritySettings**</span></span>](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkrefreshsecuritysettings)
</dt> <dt>

[<span data-ttu-id="64a6f-264">**WlanHostedNetworkSetProperty**</span><span class="sxs-lookup"><span data-stu-id="64a6f-264">**WlanHostedNetworkSetProperty**</span></span>](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworksetproperty)
</dt> <dt>

[<span data-ttu-id="64a6f-265">**WlanHostedNetworkSetSecondaryKey**</span><span class="sxs-lookup"><span data-stu-id="64a6f-265">**WlanHostedNetworkSetSecondaryKey**</span></span>](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworksetsecondarykey)
</dt> <dt>

[<span data-ttu-id="64a6f-266">**WlanHostedNetworkStartUsing**</span><span class="sxs-lookup"><span data-stu-id="64a6f-266">**WlanHostedNetworkStartUsing**</span></span>](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstartusing)
</dt> <dt>

[<span data-ttu-id="64a6f-267">**WlanHostedNetworkStopUsing**</span><span class="sxs-lookup"><span data-stu-id="64a6f-267">**WlanHostedNetworkStopUsing**</span></span>](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstopusing)
</dt> <dt>

[<span data-ttu-id="64a6f-268">**WlanRegisterVirtualStationNotification**</span><span class="sxs-lookup"><span data-stu-id="64a6f-268">**WlanRegisterVirtualStationNotification**</span></span>](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanregistervirtualstationnotification)
</dt> </dl>

 

 
