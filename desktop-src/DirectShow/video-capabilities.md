---
description: 影片功能
ms.assetid: 305bd009-f58e-4dcc-9b70-252de87dc86d
title: 影片功能
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6287839b75bd5044644480c3abcc8248cc46dc0a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "104550900"
---
# <a name="video-capabilities"></a><span data-ttu-id="fbb36-103">影片功能</span><span class="sxs-lookup"><span data-stu-id="fbb36-103">Video Capabilities</span></span>

<span data-ttu-id="fbb36-104">[**IAMStreamConfig：： GetStreamCaps**](/windows/desktop/api/Strmif/nf-strmif-iamstreamconfig-getstreamcaps)方法會以 [**AM \_ 媒體 \_ 類型**](/windows/win32/api/strmif/ns-strmif-am_media_type)和 [**影片 \_ 串流設定 \_ \_ 帽**](/windows/win32/api/strmif/ns-strmif-video_stream_config_caps)結構的配對陣列來呈現影片功能。</span><span class="sxs-lookup"><span data-stu-id="fbb36-104">The [**IAMStreamConfig::GetStreamCaps**](/windows/desktop/api/Strmif/nf-strmif-iamstreamconfig-getstreamcaps) method presents video capabilities in an array of pairs of [**AM\_MEDIA\_TYPE**](/windows/win32/api/strmif/ns-strmif-am_media_type) and [**VIDEO\_STREAM\_CONFIG\_CAPS**](/windows/win32/api/strmif/ns-strmif-video_stream_config_caps) structures.</span></span> <span data-ttu-id="fbb36-105">您可以使用此方法來公開 pin 所支援的所有格式和解析度，如下所述。</span><span class="sxs-lookup"><span data-stu-id="fbb36-105">You can use this to expose all the formats and resolutions supported on a pin as discussed below.</span></span>

<span data-ttu-id="fbb36-106">如需 **GetStreamCaps** 的音訊相關範例，請參閱 [音訊功能](audio-capabilities.md)。</span><span class="sxs-lookup"><span data-stu-id="fbb36-106">For audio-related examples of **GetStreamCaps**, see [Audio Capabilities](audio-capabilities.md).</span></span>

<span data-ttu-id="fbb36-107">假設您的捕獲卡支援 JPEG 格式，其解析度介於 160 x 120 圖元與 320 x 240 圖元（含）之間。</span><span class="sxs-lookup"><span data-stu-id="fbb36-107">Suppose your capture card supports JPEG format at all resolutions between 160 x 120 pixels and 320 x 240 pixels, inclusive.</span></span> <span data-ttu-id="fbb36-108">在此情況下，支援的解析度之間的差異在於，這是因為您在每個支援的解析度中新增或減少一個圖元以取得下一個支援的解析度。</span><span class="sxs-lookup"><span data-stu-id="fbb36-108">The difference between supported resolutions is one in this case because you add or subtract one pixel from each supported resolution to get the next supported resolution.</span></span> <span data-ttu-id="fbb36-109">在支援的解決方案中，這項差異稱為資料細微性。</span><span class="sxs-lookup"><span data-stu-id="fbb36-109">This difference in supported resolutions is called granularity.</span></span>

<span data-ttu-id="fbb36-110">假設您的卡片也支援 640 x 480 的大小。</span><span class="sxs-lookup"><span data-stu-id="fbb36-110">Suppose your card also supports the size 640 x 480.</span></span> <span data-ttu-id="fbb36-111">以下說明此單一解析度，以及上述的解析度範圍 (在 160 x 120 圖元與 320 x 240 圖元) 之間的大小。</span><span class="sxs-lookup"><span data-stu-id="fbb36-111">The following illustrates this single resolution and the above range of resolutions (all sizes between 160 x 120 pixels and 320 x 240 pixels).</span></span>

![從 160 x 120 到 320 x 240 圖元的解析度，加上 640 x 480](images/strmcap1.png)

<span data-ttu-id="fbb36-113">此外，假設它支援 160 x 120 與 320 x 240 之間的24位色彩 RGB 格式，但資料細微性為8。</span><span class="sxs-lookup"><span data-stu-id="fbb36-113">Also, suppose it supports 24-bit color RGB format at resolutions between 160 x 120 and 320 x 240, but with a granularity of 8.</span></span> <span data-ttu-id="fbb36-114">下圖顯示此案例中的一些有效大小。</span><span class="sxs-lookup"><span data-stu-id="fbb36-114">The following illustration shows some of the valid sizes in this case.</span></span>

![從 160 x 120 到320至240的解析度，資料細微性 = 8](images/strmcap3.png)

<span data-ttu-id="fbb36-116">若要以另一種方式，並列出更多的解決方式，請在有效的解決方式清單中輸入下列各項。</span><span class="sxs-lookup"><span data-stu-id="fbb36-116">To put it another way, and listing more resolutions, the following are all among the list of valid resolutions.</span></span>

-   <span data-ttu-id="fbb36-117">160 x 120</span><span class="sxs-lookup"><span data-stu-id="fbb36-117">160 x 120</span></span>
-   <span data-ttu-id="fbb36-118">168 x 120</span><span class="sxs-lookup"><span data-stu-id="fbb36-118">168 x 120</span></span>
-   <span data-ttu-id="fbb36-119">168 x 128</span><span class="sxs-lookup"><span data-stu-id="fbb36-119">168 x 128</span></span>
-   <span data-ttu-id="fbb36-120">176 x 128</span><span class="sxs-lookup"><span data-stu-id="fbb36-120">176 x 128</span></span>
-   <span data-ttu-id="fbb36-121">176 x 136</span><span class="sxs-lookup"><span data-stu-id="fbb36-121">176 x 136</span></span>
-   <span data-ttu-id="fbb36-122">...其他解決方案 .。。</span><span class="sxs-lookup"><span data-stu-id="fbb36-122">... additional resolutions ...</span></span>
-   <span data-ttu-id="fbb36-123">312 x 232</span><span class="sxs-lookup"><span data-stu-id="fbb36-123">312 x 232</span></span>
-   <span data-ttu-id="fbb36-124">320 x 240</span><span class="sxs-lookup"><span data-stu-id="fbb36-124">320 x 240</span></span>

<span data-ttu-id="fbb36-125">使用 **GetStreamCaps** 來公開這些色彩格式和維度功能，方法是提供媒體類型 320 x 240 JPEG (如果這是您的預設或慣用大小) 結合 160 x 120 的最小功能、320 x 240 的最大功能，以及1的資料細微性。</span><span class="sxs-lookup"><span data-stu-id="fbb36-125">Use **GetStreamCaps** to expose these color format and dimension capabilities by offering a media type of 320 x 240 JPEG (if that is your default or preferred size) coupled with minimum capabilities of 160 x 120, maximum capabilities of 320 x 240, and a granularity of 1.</span></span> <span data-ttu-id="fbb36-126">您使用 **GetStreamCaps** 所公開的下一組是 640 x 480 JPEG 的媒體類型，結合最少 640 x 480 和最大 640 x 480 以及0的資料細微性。</span><span class="sxs-lookup"><span data-stu-id="fbb36-126">The next pair you expose by using **GetStreamCaps** is a media type of 640 x 480 JPEG coupled with a minimum of 640 x 480 and a maximum of 640 x 480 and a granularity of 0.</span></span> <span data-ttu-id="fbb36-127">第三組包含 320 x 240、24位 RGB 的媒體類型，具有 160 x 120 的最小功能、320 x 240 的最大功能，以及8的資料細微性。</span><span class="sxs-lookup"><span data-stu-id="fbb36-127">The third pair includes a media type of 320 x 240, 24-bit RGB with minimum capabilities of 160 x 120, maximum capabilities of 320 x 240, and a granularity of 8.</span></span> <span data-ttu-id="fbb36-128">如此一來，您幾乎可以發佈卡片可能支援的所有格式和功能。</span><span class="sxs-lookup"><span data-stu-id="fbb36-128">In this way you can publish almost every format and capability your card might support.</span></span> <span data-ttu-id="fbb36-129">必須知道您所提供之壓縮格式的應用程式，可以取得所有配對，並建立媒體類型的所有唯一子類型清單。</span><span class="sxs-lookup"><span data-stu-id="fbb36-129">An application that must know what compression formats you provide can get all the pairs and make a list of all the unique subtypes of the media types.</span></span>

<span data-ttu-id="fbb36-130">篩選器會分別從 [**VIDEOINFOHEADER**](/previous-versions/windows/desktop/api/amvideo/ns-amvideo-videoinfoheader) 結構的 **rcSource** 和 **rcTarget** 成員取得其媒體類型來源和目標矩形。</span><span class="sxs-lookup"><span data-stu-id="fbb36-130">A filter obtains its media type source and target rectangles from the [**VIDEOINFOHEADER**](/previous-versions/windows/desktop/api/amvideo/ns-amvideo-videoinfoheader) structure's **rcSource** and **rcTarget** members, respectively.</span></span> <span data-ttu-id="fbb36-131">篩選準則不需要支援來源和目標矩形。</span><span class="sxs-lookup"><span data-stu-id="fbb36-131">Filters do not have to support source and target rectangles.</span></span>

<span data-ttu-id="fbb36-132">整個 [**IAMStreamConfig**](/windows/desktop/api/Strmif/nn-strmif-iamstreamconfig) 檔中所描述的裁剪矩形，與輸出圖釘的 **VIDEOINFOHEADER** 結構 **rcSource** 矩形相同。</span><span class="sxs-lookup"><span data-stu-id="fbb36-132">The cropping rectangle described throughout the [**IAMStreamConfig**](/windows/desktop/api/Strmif/nn-strmif-iamstreamconfig) documentation is the same as the **VIDEOINFOHEADER** structure's **rcSource** rectangle for the output pin.</span></span>

<span data-ttu-id="fbb36-133">整個 **IAMStreamConfig** 檔中所描述的輸出矩形，與輸出釘選 **BITMAPINFOHEADER** 結構的 **biWidth** 和 **BiHeight** 成員相同 (查看 [AVI 檔案格式的 DV 資料](dv-data-in-the-avi-file-format.md)。 ) 。</span><span class="sxs-lookup"><span data-stu-id="fbb36-133">The output rectangle described throughout the **IAMStreamConfig** documentation is the same as the **biWidth** and **biHeight** members of the output pin's **BITMAPINFOHEADER** structure (see [DV Data in the AVI File Format](dv-data-in-the-avi-file-format.md).).</span></span>

<span data-ttu-id="fbb36-134">如果篩選的輸出圖釘連接到具有非空白來源和目標矩形的媒體類型，則需要您的篩選，將輸入格式的來源 subrectangle 延伸至輸出格式的目標 subrectangle。</span><span class="sxs-lookup"><span data-stu-id="fbb36-134">If a filter's output pin is connected to a media type with nonempty source and target rectangles, then your filter is required to stretch the input format's source subrectangle into the output format's target subrectangle.</span></span> <span data-ttu-id="fbb36-135">來源 subrectangle 會儲存在 [**影片串流設定 \_ \_ \_ CAPS**](/windows/win32/api/strmif/ns-strmif-video_stream_config_caps) 結構的 **InputSize** 成員中。</span><span class="sxs-lookup"><span data-stu-id="fbb36-135">The source subrectangle is stored in the [**VIDEO\_STREAM\_CONFIG\_CAPS**](/windows/win32/api/strmif/ns-strmif-video_stream_config_caps) structure's **InputSize** member.</span></span>

<span data-ttu-id="fbb36-136">例如，請考慮下列影片壓縮程式案例：輸入影像為 RGB 格式，且大小為 160 x 120 圖元。</span><span class="sxs-lookup"><span data-stu-id="fbb36-136">For example, consider the following video compressor scenario: The input image is in RGB format and has a size of 160 x 120 pixels.</span></span> <span data-ttu-id="fbb36-137">來源矩形的左上角位於座標 (20、20) ，而其右下角為 (30，30) 。</span><span class="sxs-lookup"><span data-stu-id="fbb36-137">The source rectangle's upper-left corner is at coordinate (20,20), and its lower-right corner is at (30,30).</span></span> <span data-ttu-id="fbb36-138">輸出影像採用 MPEG 格式，大小為 320 x 240。</span><span class="sxs-lookup"><span data-stu-id="fbb36-138">The output image is in MPEG format with a size of 320 x 240.</span></span> <span data-ttu-id="fbb36-139">目標矩形的左上角位於 (0、0) ，其右下角為 (100100) 。</span><span class="sxs-lookup"><span data-stu-id="fbb36-139">The target rectangle's upper-left corner is at (0,0) and its lower-right corner is at (100,100).</span></span> <span data-ttu-id="fbb36-140">在此情況下，篩選器應該採用 160 x 120 RGB 來源點陣圖的 10 x 10 段，使其填滿 320 x 240 點陣圖的前 100 x 100 區域，讓其餘的 320 x 240 點陣圖保持不變。</span><span class="sxs-lookup"><span data-stu-id="fbb36-140">In this case, the filter should take a 10 x 10 piece of the 160 x 120 RGB source bitmap, and make it fill the top 100 x 100 area of a 320 x 240 bitmap, leaving the rest of the 320 x 240 bitmap untouched.</span></span> <span data-ttu-id="fbb36-141">下圖顯示此案例。</span><span class="sxs-lookup"><span data-stu-id="fbb36-141">The following illustration shows this scenario.</span></span>

![subrectangle 延展](images/strmcap4.png)

<span data-ttu-id="fbb36-143">篩選可能不支援這種情況，而且可能無法使用 **rcSource** 和 **rcTarget** 不是空的媒體類型進行連接。</span><span class="sxs-lookup"><span data-stu-id="fbb36-143">A filter might not support this and can fail to connect with a media type where **rcSource** and **rcTarget** are not empty.</span></span>

<span data-ttu-id="fbb36-144">**VIDEOINFOHEADER** 結構會公開篩選資料速率功能的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="fbb36-144">The **VIDEOINFOHEADER** structure exposes information about a filter's data rate capabilities.</span></span> <span data-ttu-id="fbb36-145">例如，假設您已將輸出圖釘連接至具有特定媒體類型的下一個篩選器 (直接或使用 [**CMediaType：： SetFormat**](cmediatype-setformat.md) 函式所傳遞的媒體類型) 。</span><span class="sxs-lookup"><span data-stu-id="fbb36-145">For example, suppose you connected your output pin to the next filter with a certain media type (either directly or by using the media type passed by the [**CMediaType::SetFormat**](cmediatype-setformat.md) function).</span></span> <span data-ttu-id="fbb36-146">查看該媒體類型之 **VIDEOINFOHEADER** 格式結構的 **dwBitRate** 成員，以查看您應該壓縮影片的資料速率。</span><span class="sxs-lookup"><span data-stu-id="fbb36-146">Look at the **dwBitRate** member of that media type's **VIDEOINFOHEADER** format structure to see what data rate you should compress the video to.</span></span> <span data-ttu-id="fbb36-147">如果您將 **VIDEOINFOHEADER** 結構的 **AvgTimePerFrame** 成員中每個畫面格的時間單位乘以 **dwBitRate** 成員中的資料速率，並除以 10000000 (每秒的單位數) ，您就可以找出每個畫面格的位元組數目。</span><span class="sxs-lookup"><span data-stu-id="fbb36-147">If you multiply the number of units of time per frame in the **VIDEOINFOHEADER** structure's **AvgTimePerFrame** member by the data rate in the **dwBitRate** member and divide by 10,000,000 (the number of units per second), you can figure out how many bytes each frame should be.</span></span> <span data-ttu-id="fbb36-148">您可以產生較小的大小框架，但永遠不會有一個較大的框架。</span><span class="sxs-lookup"><span data-stu-id="fbb36-148">You can produce a smaller sized frame, but never a larger one.</span></span> <span data-ttu-id="fbb36-149">若要判斷影片壓縮程式或取得篩選器的畫面播放速率，請使用輸出釘選媒體類型的 **AvgTimePerFrame** 。</span><span class="sxs-lookup"><span data-stu-id="fbb36-149">To determine the frame rate for a video compressor or for a capture filter, use **AvgTimePerFrame** from your output pin's media type.</span></span>

 

 



