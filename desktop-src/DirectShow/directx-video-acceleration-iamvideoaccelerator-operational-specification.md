---
description: DirectX Video 加速 IAMVideoAccelerator 操作規格
ms.assetid: 25ee05d5-8554-4739-9122-e3c0255bf965
title: DirectX Video 加速 IAMVideoAccelerator 操作規格
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3360e18e91197f2a15a36fb112f0419b6382e915
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/06/2021
ms.locfileid: "103935637"
---
# <a name="directx-video-acceleration-iamvideoaccelerator-operational-specification"></a><span data-ttu-id="6adfb-103">DirectX Video 加速 IAMVideoAccelerator 操作規格</span><span class="sxs-lookup"><span data-stu-id="6adfb-103">DirectX Video Acceleration IAMVideoAccelerator Operational Specification</span></span>

<span data-ttu-id="6adfb-104">操作的精確機制如下：</span><span class="sxs-lookup"><span data-stu-id="6adfb-104">The precise mechanism of operation is as follows:</span></span>

1.  <span data-ttu-id="6adfb-105">此處所定義的每個受限模式設定檔都有相關聯的 DirectX VA GUID，可由下游輸入 pin 的 [**IPin：： QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) 和 [**IPin：： ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) 支援，並列于 [**IAMVideoAccelerator：： GetVideoAcceleratorGUIDs**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-getvideoacceleratorguids)中。</span><span class="sxs-lookup"><span data-stu-id="6adfb-105">Each restricted mode profile defined herein has an associated DirectX VA GUID which can be supported by a downstream input pin's [**IPin::QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) and [**IPin::ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) and listed in [**IAMVideoAccelerator::GetVideoAcceleratorGUIDs**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-getvideoacceleratorguids).</span></span>
2.  <span data-ttu-id="6adfb-106">同樣地，搭配 DirectX VA 使用的每一種加密通訊協定類型，都應該有相關聯的加密通訊協定類型 GUID，可由下游輸入 pin 的 [**IPin：： QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) 和 [**IPin：： ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) 所支援，並且列在 **IAMVideoAccelerator：： GetVideoAcceleratorGUIDs** 中。</span><span class="sxs-lookup"><span data-stu-id="6adfb-106">Similarly, each encryption protocol type for use with DirectX VA shall have an associated encryption protocol type GUID which can be supported by a downstream input pin's [**IPin::QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) and [**IPin::ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) and listed in **IAMVideoAccelerator::GetVideoAcceleratorGUIDs**.</span></span> <span data-ttu-id="6adfb-107">\_無法在此清單中傳送 "no encryption" GUID DXVA NoEncrypt，因為它的支援是必要的，因此是隱含的。</span><span class="sxs-lookup"><span data-stu-id="6adfb-107">The "no encryption" GUID DXVA\_NoEncrypt shall not be sent in this list, as support for it is required and therefore implicit.</span></span>
3.  <span data-ttu-id="6adfb-108">在呼叫 [**IPin：： ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) 來嘗試連接到下游輸入的 pin 碼之後，解碼器的 [**IAMVideoAcceleratorNotify：： GETCREATEVIDEOACCELERATORDATA**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoacceleratornotify-getcreatevideoacceleratordata) 應傳回 DXVA \_ ConnectMode 資料結構的指標，其中包含連接的連接模式資訊。</span><span class="sxs-lookup"><span data-stu-id="6adfb-108">After calling [**IPin::ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) to attempt a connection to the downstream input pin, the decoder's [**IAMVideoAcceleratorNotify::GetCreateVideoAcceleratorData**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoacceleratornotify-getcreatevideoacceleratordata) shall return a pointer to a DXVA\_ConnectMode data structure containing the connection mode information for the connection.</span></span> <span data-ttu-id="6adfb-109">[**IAMVideoAccelerator：： GetCompBufferInfo**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-getcompbufferinfo) 應該使用 \* pdwNumTypesCompBuffers = 16 來呼叫，並且根據慣例，傳回壓縮的緩衝區資訊，而這是根據 DirectX VA 規格的3.4 節中所定義的每個緩衝區 (的類型編號) 可直接當做以零為基底的索引，在傳回的 **AMVACompBufferInfo** 資料結構陣列中使用。</span><span class="sxs-lookup"><span data-stu-id="6adfb-109">[**IAMVideoAccelerator::GetCompBufferInfo**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-getcompbufferinfo) shall be called with \*pdwNumTypesCompBuffers = 16 and shall return compressed buffer information based on the convention that the type number of each buffer (as defined in Section 3.4 of the DirectX VA specification) can be used directly as the zero-based index into the array of **AMVACompBufferInfo** data structures that is returned.</span></span> <span data-ttu-id="6adfb-110">這需要針對將不會使用的任何緩衝區類型 (包括緩衝區類型0在內，因為未定義該緩衝區類型的使用) ，加速器驅動程式將會提供某種形式的 "虛設" 參數值的 AMVACompBufferInfo 資料結構 (例如 dwNumCompBuffers = 0、dwWidthToCreate = 0、dwHeightToCreate = 0 和 dwBytesToAllocate = 0) 。</span><span class="sxs-lookup"><span data-stu-id="6adfb-110">This requires that for any buffer types that will not be used (including buffer type 0, since there is no defined use of that buffer type), the accelerator driver will provide AMVACompBufferInfo data structures with some form of "dummy" parameter values (such as dwNumCompBuffers=0, dwWidthToCreate=0, dwHeightToCreate=0, and dwBytesToAllocate=0).</span></span>
4.  <span data-ttu-id="6adfb-111">DXVA 函式指示和相關聯的資料緩衝區會使用 [**IAMVideoAccelerator：： Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute)來傳送。</span><span class="sxs-lookup"><span data-stu-id="6adfb-111">DXVA function indications and associated data buffers are sent using [**IAMVideoAccelerator::Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute).</span></span> <span data-ttu-id="6adfb-112">DXVA 函數會在呼叫的 dwFunction 參數中指出。</span><span class="sxs-lookup"><span data-stu-id="6adfb-112">The DXVA function is indicated in the dwFunction parameter of the call.</span></span> <span data-ttu-id="6adfb-113">唯一與初始化相關的 DXVA 函數是 DXVA \_ ConfigQueryOrReplyFunc 和 DXVA \_ EncryptProtocolFunc。</span><span class="sxs-lookup"><span data-stu-id="6adfb-113">The only DXVA functions that are relevant for initialization are DXVA\_ConfigQueryOrReplyFunc and DXVA\_EncryptProtocolFunc.</span></span>
    -   <span data-ttu-id="6adfb-114">如果 dwFunction 包含 DXVA \_ ConfigQueryOrReplyFunc，在此呼叫中將資料傳遞給快速鍵的 lpPrivateInputData 指標應指向設定資料結構，從快速鍵接收資訊的 lpPrivateOutputData 指標應指向可放置替代或重複設定資料結構的區域、pamvaBufferInfo 陣列的 AMVABUFFERINFO 指標應為 **Null**，而 dwNumBuffers 則應為零。</span><span class="sxs-lookup"><span data-stu-id="6adfb-114">If dwFunction contains a DXVA\_ConfigQueryOrReplyFunc, the lpPrivateInputData pointer for passing data to the accelerator in this call shall point to a configuration data structure, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area where an alternative or duplicate configuration data structure can be placed, the pamvaBufferInfo pointer for an array of AMVABUFFERINFO shall be **NULL**, and dwNumBuffers shall be zero.</span></span> <span data-ttu-id="6adfb-115">傳回的 HRESULT 包含「 \_ 確定」或「 \_ 錯誤」標記法，或 \_ \_ 在通訊協定執行 (（例如不正確設定參數) ）發生嚴重問題時，出現 E 失敗或電子 INVALIDARG 或其他錯誤指示 HRESULT。</span><span class="sxs-lookup"><span data-stu-id="6adfb-115">The returned HRESULT contains the S\_OK or S\_FALSE indication, or E\_FAIL or E\_INVALIDARG or some other error indication HRESULT in the event of a severe problem in protocol execution (such as an invalid configuration parameter).</span></span> <span data-ttu-id="6adfb-116">對於 DXVA ConfigQueryOrReplyFunc 的所有使用， **IAMVideoAccelerator：： execute** 的所有呼叫都 \_ 必須在 **IAMVideoAccelerator：： execute** 的所有其他呼叫之前。</span><span class="sxs-lookup"><span data-stu-id="6adfb-116">All calls to **IAMVideoAccelerator::Execute** for all uses of DXVA\_ConfigQueryOrReplyFunc shall precede all other calls to **IAMVideoAccelerator::Execute**.</span></span>
    -   <span data-ttu-id="6adfb-117">如果 dwFunction 包含 DXVA \_ EncryptProtocolFunc，在此呼叫中將資料傳遞給快速鍵的 lpPrivateInputData 指標應指向以 DXVA EncryptProtocolHeader 開頭的加密通訊協定資料結構 \_ ，從快速鍵接收資訊的 lpPrivateOutputData 指標應指向要傳回資料的區域 (例如，加密通訊協定) 的憑證 (\_ 可放置 ENCRYPTPROTOCOLHEADER) ，AMVABUFFERINFO 陣列的 pamvaBufferInfo 指標應為 **Null**，而 dwNumBuffers 則應為零。</span><span class="sxs-lookup"><span data-stu-id="6adfb-117">If dwFunction contains a DXVA\_EncryptProtocolFunc, the lpPrivateInputData pointer for passing data to the accelerator in this call shall point to an encryption protocol data structure that begins with DXVA\_EncryptProtocolHeader, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area where the data to be returned (such as a certificate) by the encryption protocol (which will begin with DXVA\_EncryptProtocolHeader) can be placed, the pamvaBufferInfo pointer for an array of AMVABUFFERINFO shall be **NULL**, and dwNumBuffers shall be zero.</span></span> <span data-ttu-id="6adfb-118">\_只要加密通訊協定正常運作，傳回的 HRESULT 就會包含 [確定]，而且當 \_ 通訊協定執行發生嚴重問題時，會包含電子失敗或電子 \_ INVALIDARG 或其他錯誤指示 HRESULT。</span><span class="sxs-lookup"><span data-stu-id="6adfb-118">The returned HRESULT contains S\_OK as long as the encryption protocol is functioning normally and contains E\_FAIL or E\_INVALIDARG or some other error indication HRESULT in the event of a severe problem in protocol execution.</span></span>

        <span data-ttu-id="6adfb-119">在以上述方式初始化作業之後，該解碼器的實際作業會依照下列方式繼續進行：</span><span class="sxs-lookup"><span data-stu-id="6adfb-119">After initialization of operation in the above fashion, the actual operation of the decoder proceeds as follows:</span></span>

5.  <span data-ttu-id="6adfb-120">**IAMVideoAccelerator：： BeginFrame** 應該在使用壓縮的緩衝區參數傳送任何 bDXVA Func 之前呼叫， \_ 這會導致寫入未壓縮的目的地介面。</span><span class="sxs-lookup"><span data-stu-id="6adfb-120">**IAMVideoAccelerator::BeginFrame** shall be called prior to sending any bDXVA\_Func with compressed buffer parameters which cause writes to an uncompressed destination surface.</span></span> <span data-ttu-id="6adfb-121">DirectX VA 中的 [**IAMVideoAccelerator：： BeginFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-beginframe) 用途是將目的地介面與索引值產生關聯，並通知影片加速器驅動程式，以起始寫入介面，讓驅動程式可以回應是否已準備好要覆寫介面。</span><span class="sxs-lookup"><span data-stu-id="6adfb-121">The purpose of [**IAMVideoAccelerator::BeginFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-beginframe) in DirectX VA is to associate destination surfaces with index values and to notify the video accelerator driver of the intent to initiate writes a surface so that the driver can respond with an indication of whether the surface is ready to be overwritten.</span></span> <span data-ttu-id="6adfb-122">在 **IAMVideoAccelerator：： BeginFrame** 中傳遞的 **AMVABeginFrameInfo** 結構，應該包含單一單字 wBeginPictureIndex 參數的 pInputData 指標，該參數符合傳遞至 **IAMVideoAccelerator：： BeginFrame** (的框架索引，dwSizeInputData 應為 2) 。</span><span class="sxs-lookup"><span data-stu-id="6adfb-122">The **AMVABeginFrameInfo** structure passed in **IAMVideoAccelerator::BeginFrame** shall contain a pInputData pointer to single WORD wBeginPictureIndex parameter matching the frame index passed into **IAMVideoAccelerator::BeginFrame** (and dwSizeInputData shall be 2).</span></span> <span data-ttu-id="6adfb-123">這是要在壓縮的緩衝區中用來對介面進行寫入命令 (例如，用來做為 wDecodedPictureIndex、wDeblockedPictureIndex、wBlendedDestinationIndex 或 wPicResampleDestPicIndex) 的索引。</span><span class="sxs-lookup"><span data-stu-id="6adfb-123">This is the index to be used in a compressed buffer to command a write to the surface (for example, to be used as wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex).</span></span> <span data-ttu-id="6adfb-124">**IAMVideoAccelerator：： BeginFrame** 的每個呼叫都應與 [**IAMVideoAccelerator：： EndFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-endframe)的對應呼叫配對，如下所述。</span><span class="sxs-lookup"><span data-stu-id="6adfb-124">Each call to **IAMVideoAccelerator::BeginFrame** shall be paired with a corresponding call to [**IAMVideoAccelerator::EndFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-endframe) as described below.</span></span> <span data-ttu-id="6adfb-125">例如，若要將壓縮的圖片解碼，然後使用前端緩衝區對緩衝區來與圖形影像混合，則在將壓縮圖片解碼為 wDecodedPictureIndex 中指定的介面之前，會先呼叫 **IAMVideoAccelerator：： BeginFrame：** 接著呼叫 **IAMVideoAccelerator：： EndFrame** 之後，在傳遞用來解碼圖片的所有壓縮緩衝區之後，再呼叫 **IAMVideoAccelerator：： BeginFrame** ，然後再將圖形來源中的圖形來源與已解碼的圖片結合到 wBlendedDestinationIndex 中指定的介面，然後在 Alpha blend 組合作業之後第二次呼叫 **IAMVideoAccelerator：： EndFrame** 。AMVABeginFrameInfo 中的指標 pOutputData 應該是 **Null** (而且 dwSizeOutputData 應該是 "0" ) 。</span><span class="sxs-lookup"><span data-stu-id="6adfb-125">For example, if a compressed picture is to be decoded and then alpha blended using front-end buffer-to-buffer blending with a graphic image, there would be a call to **IAMVideoAccelerator::BeginFrame** prior to decoding the compressed picture into a surface specified in wDecodedPictureIndex, then a call to **IAMVideoAccelerator::EndFrame** after passing all compressed buffers used to decode the picture, then a second call to **IAMVideoAccelerator::BeginFrame** prior to commanding alpha blending combination of the graphic source with the decoded picture into a surface specified in wBlendedDestinationIndex, and then a second call to **IAMVideoAccelerator::EndFrame** after the alpha blend combination operation.The pointer pOutputData in AMVABeginFrameInfo shall be **NULL** (and dwSizeOutputData shall be "0").</span></span> <span data-ttu-id="6adfb-126">**IAMVideoAccelerator：： BeginFrame** 所傳回的 HRESULT 應為：</span><span class="sxs-lookup"><span data-stu-id="6adfb-126">The HRESULT that is returned by **IAMVideoAccelerator::BeginFrame** shall be:</span></span>
    -   <span data-ttu-id="6adfb-127">\_如果未壓縮的介面可用且已備妥可供使用，則為 [正常]。</span><span class="sxs-lookup"><span data-stu-id="6adfb-127">S\_OK if the uncompressed surface is available and ready for use.</span></span>
    -   <span data-ttu-id="6adfb-128">E \_ 暫止如果未壓縮的表面尚未可用，但很快就會變成可用狀態 (如果正在讀取未壓縮的介面以供顯示，且表面的讀取/顯示尚未完成) 。</span><span class="sxs-lookup"><span data-stu-id="6adfb-128">E\_PENDING if the uncompressed surface is not yet available for use but will become available soon (if the uncompressed surface is being read for display and the reading/display of the surface has not yet been completed).</span></span>
    -   <span data-ttu-id="6adfb-129">\_ \_ 只有在偵測到資料格式或通訊協定錯誤 (例如 dwSizeInputData 的錯誤值或非 **Null** 的 pOutputData) 時，才會讓 e 失敗或 e INVALIDARG 其他錯誤指示。</span><span class="sxs-lookup"><span data-stu-id="6adfb-129">E\_FAIL or E\_INVALIDARG some other error indication only if a data format or protocol error is detected (such as an incorrect value of dwSizeInputData or a non-**NULL** pOutputData).</span></span>
6.  <span data-ttu-id="6adfb-130">DXVA 函式指示和相關聯的資料緩衝區會使用 **IAMVideoAccelerator：： Execute** 來傳送。</span><span class="sxs-lookup"><span data-stu-id="6adfb-130">DXVA function indications and associated data buffers are sent using **IAMVideoAccelerator::Execute**.</span></span> <span data-ttu-id="6adfb-131">\_在 [**IAMVideoAccelerator：： Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute)的相同呼叫中，可能會指出一個以上的 bDXVA Func 值。</span><span class="sxs-lookup"><span data-stu-id="6adfb-131">More than one bDXVA\_Func value may be indicated in the same call to [**IAMVideoAccelerator::Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute).</span></span> <span data-ttu-id="6adfb-132">BDXVA \_ Func 值應封裝至呼叫的 dwFunction 參數中，並在八個 MSBs 中使用第一個函式命令、接下來八位中的下一個命令，依此類推，並以零填補任何剩餘的位。</span><span class="sxs-lookup"><span data-stu-id="6adfb-132">The bDXVA\_Func values shall be packed into the dwFunction parameter of the call, with the first function command in the eight MSBs, the next command in the next eight bits, and so on, with any remaining bits padded out with zeros.</span></span> <span data-ttu-id="6adfb-133">BDXVA func 的值 0xFF \_ 表示 bDXVA \_ func 已擴充為二或四個位元組。</span><span class="sxs-lookup"><span data-stu-id="6adfb-133">The value 0xFF for bDXVA\_Func indicates that the bDXVA\_Func is extended to two or four bytes.</span></span> <span data-ttu-id="6adfb-134">如果第二個位元組也是0xFF，這表示 bDXVA \_ Func 延伸至四個位元組。</span><span class="sxs-lookup"><span data-stu-id="6adfb-134">If the second byte is also 0xFF, this indicates that bDXVA\_Func is extended to four bytes.</span></span> <span data-ttu-id="6adfb-135">如果第三個位元組的前四個位是0xF 或0x0，這表示 bDXVA \_ Func 包含 DXVA \_ CONFIGQUERYORREPLYFUNC 或 DXVA \_ EncryptProtocolFunc。</span><span class="sxs-lookup"><span data-stu-id="6adfb-135">If the upper four bits of the third byte are 0xF or 0x0, this indicates that bDXVA\_Func contains a DXVA\_ConfigQueryOrReplyFunc or DXVA\_EncryptProtocolFunc.</span></span> <span data-ttu-id="6adfb-136">多位元組命令不應指出 dwFunction 結尾之後的接續。</span><span class="sxs-lookup"><span data-stu-id="6adfb-136">Multi-byte commands shall not indicate continuation past the end of dwFunction.</span></span> <span data-ttu-id="6adfb-137">請小心使用，以確保在相同的 IAMVideoAccelerator 呼叫中指定的不同 bDXVA Func 值之間，不會有任何順序相依性存在：在 \_ 後續呼叫 **IAMVideoAccelerator：： Execute** 之前，**執行** 和所有可能的競爭條件 (例如在圖片解碼和子圖片混色之間，在子圖片載入和子圖片混色之間，以及在下一次呼叫 IAMVideoAccelerator **：： BeginFrame 和** IAMVideoAccelerator [**：： QueryRenderStatus 的**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus)情況下，) 會導致無法正常呼叫。</span><span class="sxs-lookup"><span data-stu-id="6adfb-137">Care must be taken by the decoder to ensure that no sequential dependencies are present between different bDXVA\_Func values specified in the same call to **IAMVideoAccelerator::Execute** and that all potential race conditions (such as between picture decoding and sub-picture blending, between sub-picture loading and sub-picture blending, and so on) are prevented by appropriate calls to **IAMVideoAccelerator::BeginFrame** and [**IAMVideoAccelerator::QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus) before subsequent calls to **IAMVideoAccelerator::Execute**.</span></span>
    -   <span data-ttu-id="6adfb-138">如果 dwFunction 包含 DXVA \_ ConfigQueryOrReplyFunc，在此呼叫中將資料傳遞給快速鍵的 lpPrivateInputData 指標應指向設定資料結構，從快速鍵接收資訊的 lpPrivateOutputData 指標應指向可放置替代或重複設定資料結構的區域、pamvaBufferInfo 陣列的 AMVABUFFERINFO 指標應為 **Null**，而 dwNumBuffers 則應為零。</span><span class="sxs-lookup"><span data-stu-id="6adfb-138">If dwFunction contains a DXVA\_ConfigQueryOrReplyFunc, the lpPrivateInputData pointer for passing data to the accelerator in this call shall point to a configuration data structure, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area where an alternative or duplicate configuration data structure can be placed, the pamvaBufferInfo pointer for an array of AMVABUFFERINFO shall be **NULL**, and dwNumBuffers shall be zero.</span></span> <span data-ttu-id="6adfb-139">傳回的 HRESULT 包含「 \_ 確定」或「 \_ FALSE」指示以回應查詢，或是 \_ \_ 當通訊協定執行 (（例如 invalid.configuration 參數) ）發生嚴重問題時，e 失敗或 e INVALIDARG 其他錯誤指示 HRESULT。</span><span class="sxs-lookup"><span data-stu-id="6adfb-139">The returned HRESULT contains the S\_OK or S\_FALSE indication in response to the query, or E\_FAIL or E\_INVALIDARG some other error indication HRESULT in the event of a severe problem in protocol execution (such as an invalid.configuration parameter).</span></span> <span data-ttu-id="6adfb-140">對於 DXVA ConfigQueryOrReplyFunc 的所有使用， **IAMVideoAccelerator：： execute** 的所有呼叫都 \_ 必須在 **IAMVideoAccelerator：： execute** 的所有其他呼叫之前。</span><span class="sxs-lookup"><span data-stu-id="6adfb-140">All calls to **IAMVideoAccelerator::Execute** for all uses of DXVA\_ConfigQueryOrReplyFunc shall precede all other calls to **IAMVideoAccelerator::Execute**.</span></span>
    -   <span data-ttu-id="6adfb-141">如果 dwFunction 包含 DXVA \_ EncryptProtocolFunc，在此呼叫中將資料傳遞給快速鍵的 lpPrivateInputData 指標應指向以 DXVA EncryptProtocolHeader 開頭的加密通訊協定資料結構 \_ ，從快速鍵接收資訊的 lpPrivateOutputData 指標應指向要傳回資料的區域 (例如，加密通訊協定) 的憑證 (\_ 可放置 ENCRYPTPROTOCOLHEADER) ，AMVABUFFERINFO 陣列的 pamvaBufferInfo 指標應為 **Null**，而 dwNumBuffers 則應為零。</span><span class="sxs-lookup"><span data-stu-id="6adfb-141">If dwFunction contains a DXVA\_EncryptProtocolFunc, the lpPrivateInputData pointer for passing data to the accelerator in this call shall point to an encryption protocol data structure that begins with DXVA\_EncryptProtocolHeader, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area where the data to be returned (such as a certificate) by the encryption protocol (which will begin with DXVA\_EncryptProtocolHeader) can be placed, the pamvaBufferInfo pointer for an array of AMVABUFFERINFO shall be **NULL**, and dwNumBuffers shall be zero.</span></span> <span data-ttu-id="6adfb-142">\_只要加密通訊協定正常運作，傳回的 HRESULT 就會包含 [確定]，而且當 \_ 通訊協定執行發生嚴重問題時，會包含電子失敗或電子 \_ INVALIDARG 或其他錯誤指示 HRESULT。</span><span class="sxs-lookup"><span data-stu-id="6adfb-142">The returned HRESULT contains S\_OK as long as the encryption protocol is functioning normally and contains E\_FAIL or E\_INVALIDARG or some other error indication HRESULT in the event of a severe problem in protocol execution.</span></span>
    -   <span data-ttu-id="6adfb-143">如果 dwFunction 不包含 DXVA \_ ConfigQueryOrReplyFunc 或 DXVA \_ EncryptProtocolFunc，則將資料傳遞至快速鍵的 lpPrivateInputData 指標應指向緩衝區描述清單。</span><span class="sxs-lookup"><span data-stu-id="6adfb-143">If dwFunction does not contain a DXVA\_ConfigQueryOrReplyFunc or DXVA\_EncryptProtocolFunc, the lpPrivateInputData pointer for passing data to the accelerator shall point to a buffer description list.</span></span> <span data-ttu-id="6adfb-144">每個緩衝區的緩衝區描述清單結構中的前四個專案 (dwTypeIndex、dwBufferIndex、dwDataOffset 和 dwDataSize) 應該等於相同緩衝區之 AMVABUFFERINFO 資料結構中的專案。</span><span class="sxs-lookup"><span data-stu-id="6adfb-144">The first four entries in the buffer description list structure for each buffer (dwTypeIndex, dwBufferIndex, dwDataOffset, and dwDataSize) shall be equal to those in the AMVABUFFERINFO data structure for the same buffer.</span></span> <span data-ttu-id="6adfb-145">如果 \_ 在 dwFunction 中指定 bDXVA Func 等於 "1"，且 bPicReadbackRequests 為 "1"，從快速鍵接收資訊的 lpPrivateOutputData 指標應指向持續性記憶體的區域 (例如，) 要使用加速器中的讀回巨大區塊資料來填入， (這類資料，直到 **IAMVideoAccelerator：： QueryRenderStatus** 寫入相同的圖片參數緩衝區為止， \_ 如以下的專案10所述) 。</span><span class="sxs-lookup"><span data-stu-id="6adfb-145">If bDXVA\_Func is equal to "1" is specified within dwFunction and bPicReadbackRequests is "1", the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area of persistent memory (for example heap) to be filled in with read-back macroblock data from the accelerator (such data not guaranteed to be present until **IAMVideoAccelerator::QueryRenderStatus** for writing to the same picture parameters buffer indicates S\_OK as described in item 10 below).</span></span> <span data-ttu-id="6adfb-146">否則，從快速鍵接收資訊的 lpPrivateOutputData 指標應指向要設定為下列其中一個指示值的單一 DWORD (特別適用于報告非主控制項 VLD 操作) 中的位流錯誤。</span><span class="sxs-lookup"><span data-stu-id="6adfb-146">Otherwise, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to a single DWORD to be set to one of the following indication values (particularly useful for reporting bitstream errors in off-host VLD operation).</span></span>

        | <span data-ttu-id="6adfb-147">值</span><span class="sxs-lookup"><span data-stu-id="6adfb-147">Value</span></span> | <span data-ttu-id="6adfb-148">描述</span><span class="sxs-lookup"><span data-stu-id="6adfb-148">Description</span></span>                                     |
        |-------|-------------------------------------------------|
        | <span data-ttu-id="6adfb-149">0</span><span class="sxs-lookup"><span data-stu-id="6adfb-149">0</span></span>     | <span data-ttu-id="6adfb-150">執行正常。</span><span class="sxs-lookup"><span data-stu-id="6adfb-150">Execution OK.</span></span>                                   |
        | <span data-ttu-id="6adfb-151">1</span><span class="sxs-lookup"><span data-stu-id="6adfb-151">1</span></span>     | <span data-ttu-id="6adfb-152">遇到資料格式的次要問題。</span><span class="sxs-lookup"><span data-stu-id="6adfb-152">Minor problem in data format encountered.</span></span>       |
        | <span data-ttu-id="6adfb-153">2</span><span class="sxs-lookup"><span data-stu-id="6adfb-153">2</span></span>     | <span data-ttu-id="6adfb-154">遇到資料格式的重大問題。</span><span class="sxs-lookup"><span data-stu-id="6adfb-154">Significant problem in data format encountered.</span></span> |
        | <span data-ttu-id="6adfb-155">3</span><span class="sxs-lookup"><span data-stu-id="6adfb-155">3</span></span>     | <span data-ttu-id="6adfb-156">遇到資料格式的嚴重問題。</span><span class="sxs-lookup"><span data-stu-id="6adfb-156">Severe problem in data format encountered.</span></span>      |
        | <span data-ttu-id="6adfb-157">4</span><span class="sxs-lookup"><span data-stu-id="6adfb-157">4</span></span>     | <span data-ttu-id="6adfb-158">遇到其他嚴重問題。</span><span class="sxs-lookup"><span data-stu-id="6adfb-158">Other severe problem encountered.</span></span>               |

        

         

        <span data-ttu-id="6adfb-159">如果指出任一類型的「嚴重」問題，則除非可以採取矯正措施，否則軟體解碼器應該會停止 (的函式運作) 。</span><span class="sxs-lookup"><span data-stu-id="6adfb-159">If either type of "severe" problem is indicated, the software decoder should cease to operate the function(s) unless corrective action can be taken.</span></span> <span data-ttu-id="6adfb-160">在圖片的緩衝區轉譯完成之前，主控制項所傳回的這項資料將無法讀取，因為可以透過 [**IAMVideoAccelerator：： QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus)進行測試。</span><span class="sxs-lookup"><span data-stu-id="6adfb-160">This data returned from the accelerator shall not be read by the host until after the buffer rendering for the picture has completed, as can be tested by [**IAMVideoAccelerator::QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus).</span></span> <span data-ttu-id="6adfb-161">只要介面作業正常運作，傳回的 HRESULT 就 \_ 會包含 [確定]，而且可能會 \_ 在發生嚴重問題時傳回 e FAIL 或 e \_ INVALIDARG 或其他錯誤指示 HRESULT。</span><span class="sxs-lookup"><span data-stu-id="6adfb-161">The returned HRESULT contains S\_OK as long as the interface operation is functioning normally and may return E\_FAIL or E\_INVALIDARG or some other error indication HRESULT in the event of a severe problem.</span></span>

7.  <span data-ttu-id="6adfb-162">當使用 [**IAMVideoAccelerator：： Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute) with bDXVA Func 等於 "1" 時，針對每一張圖片的解碼傳送的第一個緩衝區 \_ ，以及在位流中解碼圖片的所有緩衝區都必須在任何用來解碼後續圖片的緩衝區之前傳送。</span><span class="sxs-lookup"><span data-stu-id="6adfb-162">The picture decoding parameters buffer shall be among the first buffers sent for the decoding of each picture when using [**IAMVideoAccelerator::Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute) with bDXVA\_Func equal to "1", and all the buffers for decoding a picture in a bitstream shall be sent before any buffers for decoding subsequent pictures.</span></span> <span data-ttu-id="6adfb-163">如果傳送了巨大區塊控制命令緩衝區，則應該傳送對應的剩餘差異資料緩衝區， (包含相同巨大區塊) 的資料，但具有相同的 **IAMVideoAccelerator：： Execute** 呼叫。</span><span class="sxs-lookup"><span data-stu-id="6adfb-163">If a macroblock control command buffer is sent, a corresponding residual difference data buffer shall be sent (containing data for the same macroblocks) with the same **IAMVideoAccelerator::Execute** call.</span></span>
8.  <span data-ttu-id="6adfb-164">在傳送所有壓縮的緩衝區之後，應該會呼叫 [**IAMVideoAccelerator：： EndFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-endframe) ，這會導致在指定的未壓縮介面中建立輸出內容 (針對 WDecodedPictureIndex、WDeblockedPictureIndex、WBlendedDestinationIndex 或 wPicResampleDestPicIndex) 指定的作業結果。</span><span class="sxs-lookup"><span data-stu-id="6adfb-164">[**IAMVideoAccelerator::EndFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-endframe) shall be called after all compressed buffers have been sent that will cause the creation of the output content in a specified uncompressed surface (a result of operations specified for wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex).</span></span> <span data-ttu-id="6adfb-165">此呼叫 **IAMVideoAccelerator：： EndFrame** 的目的是要通知影片加速器硬體已傳送指定作業所需的所有資料。</span><span class="sxs-lookup"><span data-stu-id="6adfb-165">The purpose of this call to **IAMVideoAccelerator::EndFrame** is to notify the video accelerator hardware that all data needed for the specified operation has been sent.</span></span> <span data-ttu-id="6adfb-166">透過 **IAMVideoAccelerator：： EndFrame** 傳送下游的資料指標應指向包含即將結束之框架索引的單一單字 wEndPictureIndex。</span><span class="sxs-lookup"><span data-stu-id="6adfb-166">The pointer to data to send downstream through **IAMVideoAccelerator::EndFrame** shall point to a single WORD wEndPictureIndex containing the index of the frame that is ending.</span></span> <span data-ttu-id="6adfb-167">在傳送相關的壓縮緩衝區之前，此參數必須符合先前呼叫 [**IAMVideoAccelerator：： BeginFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-beginframe) 所指定的 wBeginPictureIndex 值。</span><span class="sxs-lookup"><span data-stu-id="6adfb-167">This parameter shall match the wBeginPictureIndex value specified in the prior call to [**IAMVideoAccelerator::BeginFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-beginframe) before the sending of the relevant compressed buffers.</span></span> <span data-ttu-id="6adfb-168">在呼叫 **IAMVideoAccelerator：： EndFrame** 之後，在任何圖片的 WDecodedPictureIndex、WDeblockedPictureIndex、WBlendedDestinationIndex 或 wPicResampleDestPicIndex 中都找不到具有索引 wEndPictureIndex 的未壓縮介面，直到發出另一個 **IAMVideoAccelerator：： BeginFrame** 的呼叫時，才會發出，以宣告將會發生這種情況，且會 \_ 傳回 a OK。</span><span class="sxs-lookup"><span data-stu-id="6adfb-168">Subsequent to a call to **IAMVideoAccelerator::EndFrame**, the uncompressed surface with index wEndPictureIndex shall not be found in any picture's wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex until after another call to **IAMVideoAccelerator::BeginFrame** is issued to announce that this will occur and an S\_OK has been returned as a result.</span></span> <span data-ttu-id="6adfb-169">不過，後續的讀取存取命令可能會發生目的地介面索引，例如 wForwardRefPictureIndex、wBackwardRefPictureIndex、wPicResampleSourcePicIndex 或 bRefPicSelect \[ i \] 。</span><span class="sxs-lookup"><span data-stu-id="6adfb-169">However, that destination surface index may occur in subsequent read access commands such as wForwardRefPictureIndex, wBackwardRefPictureIndex, wPicResampleSourcePicIndex, or bRefPicSelect\[i\].</span></span> <span data-ttu-id="6adfb-170">**IAMVideoAccelerator：： EndFrame** 所傳回的 HRESULT 應為 S \_ OK，除非有某種類型的資料格式或通訊協定錯誤，在此情況下，它可能是 E \_ 失敗或 e \_ INVALIDARG 或其他錯誤指示。</span><span class="sxs-lookup"><span data-stu-id="6adfb-170">The HRESULT returned by **IAMVideoAccelerator::EndFrame** shall be S\_OK unless there is some kind of data format or protocol error, in which case it can be E\_FAIL or E\_INVALIDARG or some other error indication.</span></span>
9.  <span data-ttu-id="6adfb-171">如果是以欄位為基礎的解碼 (例如，在 MPEG-2 bitstreams 中) 位流中的功能圖片將不會有一對一的對應，無法在加速器介面中的未壓縮表面。</span><span class="sxs-lookup"><span data-stu-id="6adfb-171">In the case of field based decoding (for example, in MPEG-2 bitstreams) there will not be a one-to-one mapping of functional pictures in the bitstream to uncompressed surfaces in the accelerator interface.</span></span> <span data-ttu-id="6adfb-172">在 MPEG-2 位流中解碼欄位圖片時，將會有兩個「圖片」解碼，以產生一個完整的輸出未壓縮表面。</span><span class="sxs-lookup"><span data-stu-id="6adfb-172">When decoding field pictures in an MPEG-2 bitstream, there will be two "pictures" decoded to produce one complete output uncompressed surface.</span></span> <span data-ttu-id="6adfb-173">在 DirectX VA 介面定義中，每個框架都會對應到每個使用的 wDecodedPictureIndex、wDeblockedPictureIndex、wBlendedDestinationIndex 或 wPicResampleDestPicIndex。</span><span class="sxs-lookup"><span data-stu-id="6adfb-173">In the DirectX VA interface definition, each frame corresponds to each use of wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex.</span></span> <span data-ttu-id="6adfb-174">因此，需要對 **IAMVideoAccelerator：： BeginFrame** 和 **IAMVideoAccelerator：： EndFrame** 進行兩組呼叫，才能將欄位圖片解碼成輸出未壓縮表面。</span><span class="sxs-lookup"><span data-stu-id="6adfb-174">Thus two pairs of calls to **IAMVideoAccelerator::BeginFrame** and **IAMVideoAccelerator::EndFrame** are required for the decoding of field pictures into output uncompressed surfaces.</span></span>
10. <span data-ttu-id="6adfb-175">呼叫 [**IAMVideoAccelerator：： QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus) ，dwFlags 等於零，這會在呼叫 **IAMVideoAccelerator：： EndFrame** 具有特定的 wEndPictureIndex，並檢查在 WDecodedPictureIndex、WDeblockedPictureIndex、wBlendedDestinationIndex 或 wPicResampleDestPicIndex 中包含 wEndPictureIndex 之傳送的緩衝區狀態， \_ 如果將資料寫入未壓縮表面的所有作業都已完成，而且如果作業尚未完成，將會傳回 E \_ 暫止。</span><span class="sxs-lookup"><span data-stu-id="6adfb-175">A call to [**IAMVideoAccelerator::QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus) with dwFlags equal to zero which occurs sometime after a call to **IAMVideoAccelerator::EndFrame** with a particular wEndPictureIndex and checks the status of a buffer that was sent that contained the wEndPictureIndex in wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex will return an S\_OK indication if all of the operations to write the data to the uncompressed surface have completed and will return E\_PENDING if the operation has not yet completed.</span></span> <span data-ttu-id="6adfb-176">如果 \_ \_ 發生通訊協定錯誤，可能會傳回 E 或 e INVALIDARG 或其他錯誤指示。</span><span class="sxs-lookup"><span data-stu-id="6adfb-176">E\_FAIL or E\_INVALIDARG or some other error indication may be returned in the event of a protocol error.</span></span>

## <a name="related-topics"></a><span data-ttu-id="6adfb-177">相關主題</span><span class="sxs-lookup"><span data-stu-id="6adfb-177">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="6adfb-178">將 DirectX Video 加速對應至 IAMVideoAccelerator</span><span class="sxs-lookup"><span data-stu-id="6adfb-178">Mapping DirectX Video Acceleration to IAMVideoAccelerator</span></span>](mapping-directx-video-acceleration-to-iamvideoaccelerator.md)
</dt> </dl>

 

 



