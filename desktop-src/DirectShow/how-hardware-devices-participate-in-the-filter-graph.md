---
description: 硬體裝置參與篩選圖形的方式
ms.assetid: 27e1c097-9bb4-4f9c-b9f9-0d4225c0d290
title: 硬體裝置參與篩選圖形的方式
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 68794bbc046e633e9a435b2628a20b8ea8aab174
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/06/2021
ms.locfileid: "104467446"
---
# <a name="how-hardware-devices-participate-in-the-filter-graph"></a><span data-ttu-id="39cb0-103">硬體裝置參與篩選圖形的方式</span><span class="sxs-lookup"><span data-stu-id="39cb0-103">How Hardware Devices Participate in the Filter Graph</span></span>

<span data-ttu-id="39cb0-104">本文說明 DirectShow 如何與音訊和影片硬體互動。</span><span class="sxs-lookup"><span data-stu-id="39cb0-104">This article describes how DirectShow interacts with audio and video hardware.</span></span>

<span data-ttu-id="39cb0-105">**包裝函式篩選**</span><span class="sxs-lookup"><span data-stu-id="39cb0-105">**Wrapper Filters**</span></span>

<span data-ttu-id="39cb0-106">所有的 DirectShow 篩選都是使用者模式的軟體元件。</span><span class="sxs-lookup"><span data-stu-id="39cb0-106">All DirectShow filters are user mode software components.</span></span> <span data-ttu-id="39cb0-107">為了讓核心模式硬體裝置（例如影片捕獲卡）加入 DirectShow 濾波器圖，裝置必須以使用者模式篩選表示。</span><span class="sxs-lookup"><span data-stu-id="39cb0-107">In order for a kernel mode hardware device, such as a video capture card, to join a DirectShow filter graph, the device must be represented as a user-mode filter.</span></span> <span data-ttu-id="39cb0-108">此函式是由 DirectShow 提供的特製化「包裝函式」篩選準則所執行。</span><span class="sxs-lookup"><span data-stu-id="39cb0-108">This function is performed by specialized "wrapper" filters provided with DirectShow.</span></span> <span data-ttu-id="39cb0-109">這些篩選器包括 [音訊捕獲](audio-capture.md) 篩選器、 [VFW Capture](vfw-capture-filter.md) 篩選器、 [電視調諧器](tv-tuner-filter.md) 篩選器、 [電視音訊](tv-audio-filter.md) 篩選器，以及 [類比視頻縱橫](analog-video-crossbar-filter.md) 比對。</span><span class="sxs-lookup"><span data-stu-id="39cb0-109">These filters include the [Audio Capture](audio-capture.md) filter, the [VFW Capture](vfw-capture-filter.md) filter, the [TV Tuner](tv-tuner-filter.md) filter, the [TV Audio](tv-audio-filter.md) filter, and the [Analog Video Crossbar](analog-video-crossbar-filter.md) filter.</span></span> <span data-ttu-id="39cb0-110">DirectShow 也提供稱為 KsProxy 的篩選器，可代表任何類型的 Windows Driver Model (WDM) 串流裝置。</span><span class="sxs-lookup"><span data-stu-id="39cb0-110">DirectShow also provides a filter called KsProxy, which can represent any type of Windows Driver Model (WDM) streaming device.</span></span> <span data-ttu-id="39cb0-111">硬體廠商可提供 *KsProxy 外掛程式*（由 KsProxy 匯總的 COM 物件），藉此擴充 KsProxy 以支援自訂功能。</span><span class="sxs-lookup"><span data-stu-id="39cb0-111">Hardware vendors can extend KsProxy to support custom functionality, by providing a *Ksproxy plug-in*, which is a COM object aggregated by KsProxy.</span></span>

<span data-ttu-id="39cb0-112">包裝函式篩選會公開代表裝置功能的 COM 介面。</span><span class="sxs-lookup"><span data-stu-id="39cb0-112">The wrapper filters expose COM interfaces that represent the capabilities of the device.</span></span> <span data-ttu-id="39cb0-113">應用程式會使用這些介面，在篩選準則之間傳遞資訊。</span><span class="sxs-lookup"><span data-stu-id="39cb0-113">The application uses these interfaces to pass information to and from the filter.</span></span> <span data-ttu-id="39cb0-114">篩選準則會將 COM 方法呼叫轉譯為設備磁碟機呼叫、以核心模式將該資訊傳遞至驅動程式，然後將結果轉譯回應用程式。</span><span class="sxs-lookup"><span data-stu-id="39cb0-114">The filter translates the COM method calls into device driver calls, passes that information to the driver in kernel mode, and then translates the result back to the application.</span></span> <span data-ttu-id="39cb0-115">電視調諧器、電視音訊、類比視頻縱橫比對和 KsProxy 濾波器透過 [**IKsPropertySet**](ikspropertyset.md) 介面支援自訂驅動程式屬性。</span><span class="sxs-lookup"><span data-stu-id="39cb0-115">The TV Tuner, TV Audio, Analog Video Crossbar, and KsProxy filters support custom driver properties through the [**IKsPropertySet**](ikspropertyset.md) interface.</span></span> <span data-ttu-id="39cb0-116">VFW Capture 篩選器和音訊捕獲篩選器無法以這種方式擴充。</span><span class="sxs-lookup"><span data-stu-id="39cb0-116">The VFW Capture filter and the Audio Capture filter are not extensible in this way.</span></span>

<span data-ttu-id="39cb0-117">針對應用程式開發人員，包裝函式篩選器可讓應用程式控制裝置，就像控制任何其他的 DirectShow 篩選器一樣。</span><span class="sxs-lookup"><span data-stu-id="39cb0-117">For application developers, wrapper filters enable the application to control devices just as they control any other DirectShow filter.</span></span> <span data-ttu-id="39cb0-118">不需要進行任何特殊的程式設計;與核心模式裝置通訊的詳細資料會封裝在篩選器中。</span><span class="sxs-lookup"><span data-stu-id="39cb0-118">No special programming is required; the details of communicating with the kernel-mode device are encapsulated within the filter.</span></span>

<span data-ttu-id="39cb0-119">**適用于 Windows 裝置的影片**</span><span class="sxs-lookup"><span data-stu-id="39cb0-119">**Video for Windows Devices**</span></span>

<span data-ttu-id="39cb0-120">VFW Capture 篩選器針對 Windows (VfW) Capture 卡支援較早的影片。</span><span class="sxs-lookup"><span data-stu-id="39cb0-120">The VFW Capture filter supports earlier Video for Windows (VfW) capture cards.</span></span> <span data-ttu-id="39cb0-121">當目標系統上有 VfW 卡時，您可以使用 DirectShow [系統裝置列舉](system-device-enumerator.md)值來探索並新增至篩選圖形。</span><span class="sxs-lookup"><span data-stu-id="39cb0-121">When a VfW card is present on the target system, it can be discovered and added to the filter graph using the DirectShow [System Device Enumerator](system-device-enumerator.md).</span></span> <span data-ttu-id="39cb0-122">如需詳細資訊，請參閱 [列舉裝置和篩選器](enumerating-devices-and-filters.md)。</span><span class="sxs-lookup"><span data-stu-id="39cb0-122">For details, see [Enumerating Devices and Filters](enumerating-devices-and-filters.md).</span></span>

<span data-ttu-id="39cb0-123">**音訊捕捉和混合裝置 (音效卡)**</span><span class="sxs-lookup"><span data-stu-id="39cb0-123">**Audio Capture and Mixing Devices (Sound Cards)**</span></span>

<span data-ttu-id="39cb0-124">較新的音效卡具有麥克風和其他類型裝置的輸入插孔。</span><span class="sxs-lookup"><span data-stu-id="39cb0-124">Newer sound cards have input jacks for microphones and other types of devices.</span></span> <span data-ttu-id="39cb0-125">這些卡片通常也有現成的混合功能，可控制每個個別輸入的音量、高音和低音。</span><span class="sxs-lookup"><span data-stu-id="39cb0-125">Typically these cards also have on-board mixing capabilities for controlling the volume, treble, and bass of each individual input.</span></span> <span data-ttu-id="39cb0-126">在 DirectShow 中，音訊捕獲篩選器會包裝音效卡的輸入和混音器。</span><span class="sxs-lookup"><span data-stu-id="39cb0-126">In DirectShow, the sound card's inputs and mixer are wrapped by the Audio Capture filter.</span></span> <span data-ttu-id="39cb0-127">每張音效卡都可以使用系統裝置列舉值來探索。</span><span class="sxs-lookup"><span data-stu-id="39cb0-127">Each sound card can be discovered with the System Device Enumerator.</span></span> <span data-ttu-id="39cb0-128">若要查看系統中的音效卡，請執行 GraphEdit，然後從 [音訊捕獲來源] 類別中選取。</span><span class="sxs-lookup"><span data-stu-id="39cb0-128">To view the sound cards in your system, run GraphEdit and select from the Audio Capture Sources category.</span></span> <span data-ttu-id="39cb0-129">該類別中的每個篩選器都是音訊捕獲篩選準則的個別實例。</span><span class="sxs-lookup"><span data-stu-id="39cb0-129">Each filter in that category is a separate instance of the Audio Capture filter.</span></span> <span data-ttu-id="39cb0-130"> (參閱 [使用 GraphEdit](using-graphedit.md)。 ) </span><span class="sxs-lookup"><span data-stu-id="39cb0-130">(See [Using GraphEdit](using-graphedit.md).)</span></span>

<span data-ttu-id="39cb0-131">**WDM 串流裝置**</span><span class="sxs-lookup"><span data-stu-id="39cb0-131">**WDM Streaming Devices**</span></span>

<span data-ttu-id="39cb0-132">較新的硬體解碼器和捕捉卡符合 Windows Driver Model (WDM) 規格。</span><span class="sxs-lookup"><span data-stu-id="39cb0-132">Newer hardware decoders and capture cards conform to the Windows Driver Model (WDM) specification.</span></span> <span data-ttu-id="39cb0-133">這些裝置的功能比 VfW 裝置更大。</span><span class="sxs-lookup"><span data-stu-id="39cb0-133">These devices have greater functionality than VfW devices.</span></span> <span data-ttu-id="39cb0-134">WDM 視頻捕捉卡可支援 VfW 下未提供的功能，包括取得格式的列舉、以程式設計方式控制影片參數，例如色調和亮度、程式設計輸入選擇，以及 TV 調諧器支援。</span><span class="sxs-lookup"><span data-stu-id="39cb0-134">WDM video capture cards can support features that are not available under VfW, including the enumeration of capture formats, programmatic control of video parameters such as hue and brightness, programmatic input selection, and TV Tuner support.</span></span>

<span data-ttu-id="39cb0-135">為了支援 WDM 串流裝置，DirectShow 提供 KsProxy 濾波器 (ksproxy.ax) 。</span><span class="sxs-lookup"><span data-stu-id="39cb0-135">To support WDM streaming devices, DirectShow provides the KsProxy filter (ksproxy.ax).</span></span> <span data-ttu-id="39cb0-136">KsProxy 已被稱為「瑞士軍隊刀篩選」，因為它有許多不同的專案。</span><span class="sxs-lookup"><span data-stu-id="39cb0-136">KsProxy has been called the "Swiss Army Knife filter" because it does so many different things.</span></span> <span data-ttu-id="39cb0-137">篩選器上的釘選數目，以及篩選器所公開的 COM 介面數目，取決於基礎驅動程式的功能。</span><span class="sxs-lookup"><span data-stu-id="39cb0-137">The number of pins on the filter, and the number of COM interfaces exposed by the filter, depend on the capabilities of the underlying driver.</span></span> <span data-ttu-id="39cb0-138">KsProxy 不會出現在篩選圖形的 "KsProxy" 名稱下方。</span><span class="sxs-lookup"><span data-stu-id="39cb0-138">KsProxy does not appear in the filter graph under the name "KsProxy."</span></span> <span data-ttu-id="39cb0-139">它一律會採用在登錄中找到之裝置的易記名稱。</span><span class="sxs-lookup"><span data-stu-id="39cb0-139">It always takes the friendly name of the device, which is found in the registry.</span></span> <span data-ttu-id="39cb0-140">若要查看您系統上的 WDM 裝置，請執行 GraphEdit，然後從 WDM 串流類別目錄中選取。</span><span class="sxs-lookup"><span data-stu-id="39cb0-140">To view the WDM devices on your system, run GraphEdit and select from the WDM Streaming categories.</span></span> <span data-ttu-id="39cb0-141">即使您的系統上只有一個 WDM 卡，該卡片可能包含多個裝置。</span><span class="sxs-lookup"><span data-stu-id="39cb0-141">Even if you have only one WDM card on your system, that card might contain more than one device.</span></span> <span data-ttu-id="39cb0-142">每個裝置都會以個別的篩選表示，而這些篩選器會實際 KsProxy。</span><span class="sxs-lookup"><span data-stu-id="39cb0-142">Each device is represented as a separate filter, and each of these filters is actually KsProxy.</span></span>

<span data-ttu-id="39cb0-143">應用程式會使用系統裝置列舉值，在系統上尋找 WDM 裝置的名字標記。</span><span class="sxs-lookup"><span data-stu-id="39cb0-143">An application uses the System Device Enumerator to find WDM device monikers on the system.</span></span> <span data-ttu-id="39cb0-144">KsProxy 是藉由在標記上呼叫 **BindToObject** 來具現化。</span><span class="sxs-lookup"><span data-stu-id="39cb0-144">KsProxy is instantiated by calling **BindToObject** on the moniker.</span></span> <span data-ttu-id="39cb0-145">由於 KsProxy 可代表所有種類的 WDM 裝置，因此它必須查詢驅動程式來判斷驅動程式支援的屬性集。</span><span class="sxs-lookup"><span data-stu-id="39cb0-145">Because KsProxy can represent all kinds of WDM devices, it must query the driver to determine which property sets the driver supports.</span></span> <span data-ttu-id="39cb0-146">屬性集是由 WDM 驅動程式所使用的資料結構集合，也是由某些使用者模式篩選器所使用，例如 MPEG 2 軟體的解碼器。</span><span class="sxs-lookup"><span data-stu-id="39cb0-146">Property sets are collections of data structures used by WDM drivers, and also by some user mode filters, such as MPEG-2 software decoders.</span></span> <span data-ttu-id="39cb0-147">KsProxy 會自行設定，以公開對應至這些屬性集的 COM 介面。</span><span class="sxs-lookup"><span data-stu-id="39cb0-147">KsProxy configures itself to expose the COM interfaces that correspond to those property sets.</span></span> <span data-ttu-id="39cb0-148">KsProxy 會將 COM 方法呼叫轉譯為屬性集，並將這些呼叫傳送至驅動程式。</span><span class="sxs-lookup"><span data-stu-id="39cb0-148">KsProxy translates the COM method calls into property sets and sends these to the driver.</span></span> <span data-ttu-id="39cb0-149">硬體廠商可以藉由提供外掛程式來擴充 KsProxy，這是可公開裝置特殊功能的廠商特定介面。</span><span class="sxs-lookup"><span data-stu-id="39cb0-149">Hardware vendors can extend KsProxy by supplying plug-ins, which are vendor-specific interfaces that expose the special capabilities of a device.</span></span> <span data-ttu-id="39cb0-150">這些詳細資料會在應用程式中隱藏。</span><span class="sxs-lookup"><span data-stu-id="39cb0-150">All these details are hidden from application.</span></span> <span data-ttu-id="39cb0-151">應用程式會以 KsProxy 的方式控制裝置，方法與任何其他的 DirectShow 篩選器相同。</span><span class="sxs-lookup"><span data-stu-id="39cb0-151">The application controls the device by way of KsProxy, in the same way as any other DirectShow filter.</span></span>

<span data-ttu-id="39cb0-152">**核心串流**</span><span class="sxs-lookup"><span data-stu-id="39cb0-152">**Kernel Streaming**</span></span>

<span data-ttu-id="39cb0-153">WDM 裝置支援核心串流，其中的資料會完全以核心模式串流處理，而不會切換至使用者模式。</span><span class="sxs-lookup"><span data-stu-id="39cb0-153">WDM devices support kernel streaming, in which data is streamed entirely in kernel mode without ever switching to user mode.</span></span> <span data-ttu-id="39cb0-154">在核心模式和使用者模式之間切換需要耗費大量的計算成本;核心串流允許高位費率，而不會讓主機 CPU 負擔。</span><span class="sxs-lookup"><span data-stu-id="39cb0-154">Switching between kernel mode and user mode is computationally expensive; kernel streaming allows for high bit rates without burdening the host CPU.</span></span> <span data-ttu-id="39cb0-155">以 WDM 為基礎的篩選器可以使用核心串流，直接從一個硬體裝置將多媒體資料傳遞到另一個硬體裝置，不論是在相同的卡片或不同的卡片上，不需要將資料複製到系統的主要記憶體中。</span><span class="sxs-lookup"><span data-stu-id="39cb0-155">WDM-based filters can use kernel streaming to pass multimedia data directly from one hardware device to another, either on the same card or on a different card, without copying the data into the system's main memory.</span></span>

<span data-ttu-id="39cb0-156">從應用程式的觀點來看，它看起來就像是資料從某個使用者模式篩選移到下一個。</span><span class="sxs-lookup"><span data-stu-id="39cb0-156">From an application's point of view, it appears as if the data moves from one user-mode filter to the next.</span></span> <span data-ttu-id="39cb0-157">在現實情況下，資料可能永遠不會傳入使用者模式，而是會直接從某個核心模式裝置串流至另一個，直到它在視頻圖形配接器上轉譯為止。</span><span class="sxs-lookup"><span data-stu-id="39cb0-157">In reality, the data might never pass into user mode at all, but instead might be streamed directly from one kernel-mode device to another until it is rendered on the video graphics card.</span></span> <span data-ttu-id="39cb0-158">某些案例（例如 capture 至檔案）要求資料在某個時間點從核心模式傳遞到使用者模式。</span><span class="sxs-lookup"><span data-stu-id="39cb0-158">Some scenarios, such as capture to a file, require that the data pass from kernel mode to user mode at some point.</span></span> <span data-ttu-id="39cb0-159">不過，此參數不一定需要將資料複製到記憶體中的新位置。</span><span class="sxs-lookup"><span data-stu-id="39cb0-159">However, this switch does not necessarily require the data to be copied to a new location in memory.</span></span>

<span data-ttu-id="39cb0-160">應用程式開發人員通常不需要擔心核心資料流程的詳細資料，但背景資訊除外。</span><span class="sxs-lookup"><span data-stu-id="39cb0-160">Application developers generally do not need to be concerned with the details of kernel streaming, except as background information.</span></span> <span data-ttu-id="39cb0-161">如需有關 WDM、核心串流、KsProxy 和相關主題的詳細資訊，請參閱 Microsoft DDK。</span><span class="sxs-lookup"><span data-stu-id="39cb0-161">See the Microsoft DDK for more detailed information about WDM, kernel streaming, KsProxy, and related topics.</span></span>

## <a name="related-topics"></a><span data-ttu-id="39cb0-162">相關主題</span><span class="sxs-lookup"><span data-stu-id="39cb0-162">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="39cb0-163">篩選圖形及其元件</span><span class="sxs-lookup"><span data-stu-id="39cb0-163">The Filter Graph and Its Components</span></span>](the-filter-graph-and-its-components.md)
</dt> </dl>

 

 



