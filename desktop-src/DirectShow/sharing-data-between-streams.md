---
description: 在資料流程之間共用資料
ms.assetid: e18eecf8-9475-420a-9a60-4b1b5f8fd43a
title: 在資料流程之間共用資料
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ee0b2f53fe1952bbc16711f7c7e39c3182ba94a7
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/06/2021
ms.locfileid: "104467755"
---
# <a name="sharing-data-between-streams"></a><span data-ttu-id="8647a-103">在資料流程之間共用資料</span><span class="sxs-lookup"><span data-stu-id="8647a-103">Sharing Data Between Streams</span></span>

> [!Note]  
> <span data-ttu-id="8647a-104">這些 Api 已被取代。</span><span class="sxs-lookup"><span data-stu-id="8647a-104">These APIs are deprecated.</span></span> <span data-ttu-id="8647a-105">應用程式應該使用 [**範例捕獲**](sample-grabber-filter.md) 篩選器或執行自訂篩選，以從 DirectShow 篩選圖形取得資料。</span><span class="sxs-lookup"><span data-stu-id="8647a-105">Applications should use the [**Sample Grabber**](sample-grabber-filter.md) filter or implement a custom filter to get data from a DirectShow filter graph.</span></span>

 

<span data-ttu-id="8647a-106">處理多媒體資料通常需要大量的系統資源;因此，您應該盡可能避免複製資料。</span><span class="sxs-lookup"><span data-stu-id="8647a-106">Processing multimedia data typically requires a great deal of system resources; therefore, you should avoid copying data whenever possible.</span></span> <span data-ttu-id="8647a-107">串流架構支援共用的資料流程範例，這是一種機制，可將資料從某個資料流程移至另一個資料流程，而不需要複製它。</span><span class="sxs-lookup"><span data-stu-id="8647a-107">The streaming architecture supports shared stream samples, a mechanism that moves data from one stream to another without copying it.</span></span> <span data-ttu-id="8647a-108">即使目的地資料流程未特別支援基礎資料格式，這個緩衝區仍能在兩個數據流之間有效率地傳輸資料。</span><span class="sxs-lookup"><span data-stu-id="8647a-108">This buffer enables the efficient transportation of data between two streams even if the destination stream doesn't specifically support the underlying data format.</span></span>

<span data-ttu-id="8647a-109">例如，假設您有一個具有三個數據流的多媒體資料流程：影片和音訊，以及 URL 資料的時間戳記，以符合影片內容。</span><span class="sxs-lookup"><span data-stu-id="8647a-109">For example, assume that you have a multimedia stream with three data streams: video and audio, and URL data time-stamped to match the video content.</span></span> <span data-ttu-id="8647a-110">您想要撰寫一個應用程式，以在每個影片畫面上新增著作權注意事項，並將資料寫入另一個串流以進行儲存，但您的應用程式不了解影片串流以外的任何資料格式。</span><span class="sxs-lookup"><span data-stu-id="8647a-110">You want to write an application that adds a copyright notice on every video frame and writes the data to another stream for storage, but your application doesn't understand any data formats except the video stream.</span></span> <span data-ttu-id="8647a-111">針對影片串流，您可以建立附加至所需 DirectDraw 表面的範例。</span><span class="sxs-lookup"><span data-stu-id="8647a-111">For the video stream, you create a sample attached to the desired DirectDraw surface.</span></span> <span data-ttu-id="8647a-112">然後，您可以呼叫 [**IDirectDrawMediaStream：： CreateSample**](/previous-versions/windows/desktop/api/ddstream/nf-ddstream-idirectdrawmediastream-createsample) 方法，並將該指標指向相同的介面，或 [**IMediaStream：： CreateSharedSample**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-createsharedsample)，以建立輸出資料流程。</span><span class="sxs-lookup"><span data-stu-id="8647a-112">You can then create an output stream by calling either the [**IDirectDrawMediaStream::CreateSample**](/previous-versions/windows/desktop/api/ddstream/nf-ddstream-idirectdrawmediastream-createsample) method with that pointer to the same surface, or [**IMediaStream::CreateSharedSample**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-createsharedsample).</span></span> <span data-ttu-id="8647a-113">在這兩種情況下，輸入和輸出資料流程都會共用 DirectDraw 表面。</span><span class="sxs-lookup"><span data-stu-id="8647a-113">In both cases, the input and output streams share the DirectDraw surface.</span></span> <span data-ttu-id="8647a-114">因為您瞭解影片格式，所以您可以視需要存取這個介面。</span><span class="sxs-lookup"><span data-stu-id="8647a-114">Because you understand the video format, you can access this surface as needed.</span></span>

<span data-ttu-id="8647a-115">若要抓取其他來來源資料流指標 (音訊和 URL) ，請列舉來源容器資料流程並抓取 nonvideo 資料流程的指標。</span><span class="sxs-lookup"><span data-stu-id="8647a-115">To retrieve the other source stream pointers (audio and URL), enumerate the source container stream and grab pointers to the nonvideo streams.</span></span> <span data-ttu-id="8647a-116">每個來來源資料流在輸出資料流程容器中都有相關聯的輸出資料流程。</span><span class="sxs-lookup"><span data-stu-id="8647a-116">Each of these source streams has an associated output stream in the output stream container.</span></span> <span data-ttu-id="8647a-117">藉由呼叫輸出容器上的 [**IMultiMediaStream：： GetMediaStream**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-getmediastream) 方法和每個來來源資料流指標，來取出這些輸出指標。</span><span class="sxs-lookup"><span data-stu-id="8647a-117">Retrieve these output pointers by calling the [**IMultiMediaStream::GetMediaStream**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-getmediastream) method on the output container with each of the source stream pointers.</span></span> <span data-ttu-id="8647a-118">下列步驟說明這個程序。</span><span class="sxs-lookup"><span data-stu-id="8647a-118">The following steps describe this process.</span></span>

1.  <span data-ttu-id="8647a-119">呼叫 [**IMultiMediaStream：： EnumMediaStreams**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-enummediastreams) 來取得來來源資料流的指標。</span><span class="sxs-lookup"><span data-stu-id="8647a-119">Call [**IMultiMediaStream::EnumMediaStreams**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-enummediastreams) to retrieve a pointer to a source stream.</span></span> <span data-ttu-id="8647a-120">請確定它不是影片串流，因為您的應用程式已經瞭解其格式。</span><span class="sxs-lookup"><span data-stu-id="8647a-120">Make sure that it's not the video stream, because your application already understands its format.</span></span>
2.  <span data-ttu-id="8647a-121">使用步驟1中的指標，在輸出容器資料流程上呼叫 [**IMultiMediaStream：： GetMediaStream**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-getmediastream) 。</span><span class="sxs-lookup"><span data-stu-id="8647a-121">Call [**IMultiMediaStream::GetMediaStream**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-getmediastream) on the output container stream with the pointer from step 1.</span></span> <span data-ttu-id="8647a-122">這會傳回所要輸出資料流程的指標。</span><span class="sxs-lookup"><span data-stu-id="8647a-122">This returns a pointer to the desired output stream.</span></span>
3.  <span data-ttu-id="8647a-123">在來來源資料流上呼叫 [**AllocateSample**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-allocatesample) 。</span><span class="sxs-lookup"><span data-stu-id="8647a-123">Call [**AllocateSample**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-allocatesample) on the source stream.</span></span>
4.  <span data-ttu-id="8647a-124">在輸出資料流程上呼叫 [**CreateSharedSample**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-createsharedsample) 。</span><span class="sxs-lookup"><span data-stu-id="8647a-124">Call [**CreateSharedSample**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-createsharedsample) on the output stream.</span></span>
5.  <span data-ttu-id="8647a-125">呼叫來來源資料流上的 [**Update**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-istreamsample-update) ，以讀取資料。</span><span class="sxs-lookup"><span data-stu-id="8647a-125">Call [**Update**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-istreamsample-update) on the source stream to read the data.</span></span>
6.  <span data-ttu-id="8647a-126">呼叫輸出資料流程上的 [**Update**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-istreamsample-update) 來寫入資料。</span><span class="sxs-lookup"><span data-stu-id="8647a-126">Call [**Update**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-istreamsample-update) on the output stream to write the data.</span></span>

<span data-ttu-id="8647a-127">針對您不支援其格式的每個資料流程重複這些步驟。</span><span class="sxs-lookup"><span data-stu-id="8647a-127">Repeat these steps for each stream whose format you don't support.</span></span> <span data-ttu-id="8647a-128">當兩個範例都完成更新時，輸出資料流程會有來自來來源資料流的所有資料，而且您已完成。</span><span class="sxs-lookup"><span data-stu-id="8647a-128">When both samples finish updating, the output stream has all data from the source stream and you are done.</span></span>

 

 



