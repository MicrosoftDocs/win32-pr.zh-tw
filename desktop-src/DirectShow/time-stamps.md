---
description: 時間戳記
ms.assetid: 445fe6b9-9d5b-45fd-9c9e-8c632c5228ae
title: 時間戳記
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 855d2c472d7964ccad6ec8bbc87efd39b1c4cdd6
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "107000337"
---
# <a name="time-stamps"></a><span data-ttu-id="c28a6-103">時間戳記</span><span class="sxs-lookup"><span data-stu-id="c28a6-103">Time Stamps</span></span>

<span data-ttu-id="c28a6-104">*時間戳記* 會定義媒體範例的開始和完成時間，以資料流程時間來測量。</span><span class="sxs-lookup"><span data-stu-id="c28a6-104">The *time stamp* defines a media sample's start and finish times, measured in stream time.</span></span> <span data-ttu-id="c28a6-105">時間戳記有時稱為 *呈現時間*。</span><span class="sxs-lookup"><span data-stu-id="c28a6-105">The time stamp is sometimes called the *presentation time*.</span></span> <span data-ttu-id="c28a6-106">閱讀本文的其餘部分時，請務必記住，並非所有格式都會以相同的方式使用時間戳。</span><span class="sxs-lookup"><span data-stu-id="c28a6-106">When reading the rest of this article, it is important to remember that not all formats use time stamps in the same way.</span></span> <span data-ttu-id="c28a6-107">例如，並非所有 MPEG 範例都會加上時間戳記。</span><span class="sxs-lookup"><span data-stu-id="c28a6-107">For example, not all MPEG samples are time stamped.</span></span> <span data-ttu-id="c28a6-108">在 MPEG 篩選圖形中，時間戳記不會套用至每個框架，直到它們從解碼器輸出為止。</span><span class="sxs-lookup"><span data-stu-id="c28a6-108">In MPEG filter graphs, the time stamp is not applied to each frame until they are output from the decoder.</span></span>

<span data-ttu-id="c28a6-109">當轉譯器篩選器收到範例時，它會根據時間戳記排定轉譯。</span><span class="sxs-lookup"><span data-stu-id="c28a6-109">When a renderer filter receives a sample, it schedules rendering based on the time stamp.</span></span> <span data-ttu-id="c28a6-110">如果範例遲到或沒有時間戳記，則篩選會立即轉譯範例。</span><span class="sxs-lookup"><span data-stu-id="c28a6-110">If the sample arrives late, or has no time stamp, the filter renders the sample immediately.</span></span> <span data-ttu-id="c28a6-111">否則，篩選準則會等到範例的開始時間轉譯樣本為止。</span><span class="sxs-lookup"><span data-stu-id="c28a6-111">Otherwise, the filter waits until the sample's start time before it renders the sample.</span></span> <span data-ttu-id="c28a6-112"> (它會藉由呼叫 [**IReferenceClock：： AdviseTime**](/windows/desktop/api/Strmif/nf-strmif-ireferenceclock-advisetime) 方法來等候開始時間。 ) </span><span class="sxs-lookup"><span data-stu-id="c28a6-112">(It waits for the start time by calling the [**IReferenceClock::AdviseTime**](/windows/desktop/api/Strmif/nf-strmif-ireferenceclock-advisetime) method.)</span></span>

<span data-ttu-id="c28a6-113">來源篩選器和剖析器篩選器負責在其處理的範例上設定正確的時間戳記。</span><span class="sxs-lookup"><span data-stu-id="c28a6-113">Source filters and parser filters are responsible for setting the correct time stamps on the samples they process.</span></span> <span data-ttu-id="c28a6-114">使用下列指導方針。</span><span class="sxs-lookup"><span data-stu-id="c28a6-114">Use the following guidelines.</span></span>

-   <span data-ttu-id="c28a6-115">檔案播放：第一個範例是以零為起始時間的時間戳記。</span><span class="sxs-lookup"><span data-stu-id="c28a6-115">File playback: The first sample is time stamped with a start time of zero.</span></span> <span data-ttu-id="c28a6-116">後續的時間戳記取決於樣本長度和播放速率，也就是由檔案格式決定。</span><span class="sxs-lookup"><span data-stu-id="c28a6-116">Subsequent time stamps are determined by the sample length and the playback rate, which itself is determined by the file format.</span></span> <span data-ttu-id="c28a6-117">剖析檔案的篩選準則負責計算正確的時間戳記 (例如， [AVI 分隔器](avi-splitter-filter.md)) 。</span><span class="sxs-lookup"><span data-stu-id="c28a6-117">The filter that parses the file is responsible for calculating the correct time stamps (for example, the [AVI Splitter](avi-splitter-filter.md)).</span></span>
-   <span data-ttu-id="c28a6-118">影片和音訊捕獲：每個範例都是時間戳記，其開始時間等於捕捉的資料流程時間，但有下列注意事項：</span><span class="sxs-lookup"><span data-stu-id="c28a6-118">Video and audio capture: Every sample is time stamped with a start time equal to the stream time when it was captured, with the following caveats:</span></span>
    -   <span data-ttu-id="c28a6-119">預覽 pin 的影片框架 (與捕捉 pin) 不會加上時間戳記。</span><span class="sxs-lookup"><span data-stu-id="c28a6-119">Video frames from a preview pin (as opposed to a capture pin) are not time stamped.</span></span> <span data-ttu-id="c28a6-120">由於圖表的延遲，以拍攝時間加上戳記的影片畫面，將一律在影片轉譯器遲到。</span><span class="sxs-lookup"><span data-stu-id="c28a6-120">Because of graph latency, a video frame that is stamped with the capture time will always arrive late at the video renderer.</span></span> <span data-ttu-id="c28a6-121">這可能會導致轉譯器卸載框架，以嘗試品質控制。</span><span class="sxs-lookup"><span data-stu-id="c28a6-121">This may cause the renderer to drop frames, in an attempt at quality control.</span></span> <span data-ttu-id="c28a6-122">如需品質控制的詳細資訊，請參閱 [品質控制管理](quality-control-management.md)。</span><span class="sxs-lookup"><span data-stu-id="c28a6-122">For information about quality control, see [Quality-Control Management](quality-control-management.md).</span></span>
    -   <span data-ttu-id="c28a6-123">音訊捕獲：音訊捕獲篩選器會使用自己的緩衝區集，這些緩衝區與音訊驅動程式所使用的不同。</span><span class="sxs-lookup"><span data-stu-id="c28a6-123">Audio capture: The audio capture filter uses its own set of buffers, which are separate from those used by the audio driver.</span></span> <span data-ttu-id="c28a6-124">音訊驅動程式會以固定的間隔填入捕獲篩選器的緩衝區。</span><span class="sxs-lookup"><span data-stu-id="c28a6-124">The audio driver fills the capture filter's buffers at fixed intervals.</span></span> <span data-ttu-id="c28a6-125">間隔取決於驅動程式，但通常不會超過10毫秒。</span><span class="sxs-lookup"><span data-stu-id="c28a6-125">The interval depends on the driver, but generally is not more than 10 milliseconds.</span></span> <span data-ttu-id="c28a6-126">音訊樣本上的時間戳記會反映驅動程式填滿音訊捕獲篩選器緩衝區的時間。</span><span class="sxs-lookup"><span data-stu-id="c28a6-126">The time stamps on the audio samples reflect the time when the driver filled the audio capture filter's buffers.</span></span> <span data-ttu-id="c28a6-127">這些時間可能稍微不正確，特別是當應用程式使用極小的緩衝區大小時。</span><span class="sxs-lookup"><span data-stu-id="c28a6-127">These times can be slightly inaccurate, especially if the application is using a very small buffer size.</span></span> <span data-ttu-id="c28a6-128">不過，媒體時間會精確地反映緩衝區中的數位音訊樣本。</span><span class="sxs-lookup"><span data-stu-id="c28a6-128">However, the media times will accurately reflect the number audio samples in the buffer.</span></span>
-   <span data-ttu-id="c28a6-129">Mux 篩選器：根據輸出格式，mux 篩選可能需要產生時間戳記，否則可能不會。</span><span class="sxs-lookup"><span data-stu-id="c28a6-129">Mux filters: Depending on the output format, a mux filter may need to generate time stamps, or it may not.</span></span> <span data-ttu-id="c28a6-130">例如，AVI 檔案格式所使用的固定畫面播放速率沒有時間戳記，因此 [AVI Mux](avi-mux-filter.md) 篩選器會假設樣本抵達的時間大約是正確的時間。</span><span class="sxs-lookup"><span data-stu-id="c28a6-130">For example, the AVI file format uses a fixed frame rate with no time stamps, so the [AVI Mux](avi-mux-filter.md) filter assumes that samples are arriving at approximately the right time.</span></span> <span data-ttu-id="c28a6-131">但是，如果傳入的時間戳記顯示大於一框架的間隙，則 AVI Mux 會寫入大小為零的索引項目目，以表示已卸載的框架。</span><span class="sxs-lookup"><span data-stu-id="c28a6-131">If the incoming time stamps show a gap larger than one frame, however, the AVI Mux writes an index entry with size zero, to indicate a dropped frame.</span></span> <span data-ttu-id="c28a6-132">在檔案播放時，會在執行時間產生新的時間戳記，如先前所述。</span><span class="sxs-lookup"><span data-stu-id="c28a6-132">On file playback, new time stamps are generated at run time, as described previously.</span></span>

<span data-ttu-id="c28a6-133">若要設定範例的時間戳記，請呼叫 [**IMediaSample：： SetTime**](/windows/desktop/api/Strmif/nf-strmif-imediasample-settime) 方法。</span><span class="sxs-lookup"><span data-stu-id="c28a6-133">To set the time stamp on a sample, call the [**IMediaSample::SetTime**](/windows/desktop/api/Strmif/nf-strmif-imediasample-settime) method.</span></span>

<span data-ttu-id="c28a6-134">**媒體時間**</span><span class="sxs-lookup"><span data-stu-id="c28a6-134">**Media Times**</span></span>

<span data-ttu-id="c28a6-135">篩選也可以選擇性地指定範例的 *媒體時間* 。</span><span class="sxs-lookup"><span data-stu-id="c28a6-135">Optionally, the filter can also specify a *media time* for the sample.</span></span> <span data-ttu-id="c28a6-136">在影片串流中，媒體時間代表畫面格編號。</span><span class="sxs-lookup"><span data-stu-id="c28a6-136">In a video stream, media time represents the frame number.</span></span> <span data-ttu-id="c28a6-137">在音訊串流中，媒體時間代表封包中的範例數目。</span><span class="sxs-lookup"><span data-stu-id="c28a6-137">In an audio stream, media time represents the sample number in the packet.</span></span> <span data-ttu-id="c28a6-138">例如，如果每個封包都包含44.1 千赫茲 (kHz) 音訊的1秒，則第一個封包的媒體開始時間為零，而媒體停止時間為44100。</span><span class="sxs-lookup"><span data-stu-id="c28a6-138">For example, if each packet contains one second of 44.1 kilohertz (kHz) audio, the first packet has a media start time of zero and a media stop time of 44100.</span></span> <span data-ttu-id="c28a6-139">在可搜尋的資料流程中，媒體時間一律相對於資料流程的開始時間。</span><span class="sxs-lookup"><span data-stu-id="c28a6-139">In a seekable stream, the media time is always relative to the start time of the stream.</span></span> <span data-ttu-id="c28a6-140">例如，假設您從 15 fps video 串流的開頭到2秒。</span><span class="sxs-lookup"><span data-stu-id="c28a6-140">For example, suppose you seek to 2 seconds from the start of a 15-fps video stream.</span></span> <span data-ttu-id="c28a6-141">搜尋之後的第一個媒體範例的時間戳記為零，而媒體時間為30。</span><span class="sxs-lookup"><span data-stu-id="c28a6-141">The first media sample after the seek has a time stamp of zero but a media time of 30.</span></span>

<span data-ttu-id="c28a6-142">轉譯器和 mux 篩選器可以透過檢查間距，以使用媒體時間來判斷是否已卸載框架或樣本。</span><span class="sxs-lookup"><span data-stu-id="c28a6-142">Renderer and mux filters can use the media time to determine whether frames or samples have been dropped, by checking for gaps.</span></span> <span data-ttu-id="c28a6-143">但是，不需要篩選來設定媒體時間。</span><span class="sxs-lookup"><span data-stu-id="c28a6-143">However, filters are not required to set the media time.</span></span> <span data-ttu-id="c28a6-144">若要設定範例的媒體時間，請呼叫 [**IMediaSample：： SetMediaTime**](/windows/desktop/api/Strmif/nf-strmif-imediasample-setmediatime) 方法。</span><span class="sxs-lookup"><span data-stu-id="c28a6-144">To set the media time on a sample, call the [**IMediaSample::SetMediaTime**](/windows/desktop/api/Strmif/nf-strmif-imediasample-setmediatime) method.</span></span>

## <a name="related-topics"></a><span data-ttu-id="c28a6-145">相關主題</span><span class="sxs-lookup"><span data-stu-id="c28a6-145">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="c28a6-146">DirectShow 中的時間和時鐘</span><span class="sxs-lookup"><span data-stu-id="c28a6-146">Time and Clocks in DirectShow</span></span>](time-and-clocks-in-directshow.md)
</dt> </dl>

 

 



