---
description: 即時來源
ms.assetid: 571fe5e5-9616-463b-837c-f8dbb8adf1be
title: 即時來源
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 43486cf3db797f493c9446bf782989b8beaae829
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/06/2021
ms.locfileid: "104467699"
---
# <a name="live-sources"></a><span data-ttu-id="bb782-103">即時來源</span><span class="sxs-lookup"><span data-stu-id="bb782-103">Live Sources</span></span>

<span data-ttu-id="bb782-104">即時來源也稱為 *推送來源*，會即時接收資料。</span><span class="sxs-lookup"><span data-stu-id="bb782-104">A live source, also called a *push source*, receives data in real time.</span></span> <span data-ttu-id="bb782-105">範例包括影片捕獲和網路廣播。</span><span class="sxs-lookup"><span data-stu-id="bb782-105">Examples include video capture and network broadcasts.</span></span> <span data-ttu-id="bb782-106">一般情況下，即時來源無法控制資料抵達的速率。</span><span class="sxs-lookup"><span data-stu-id="bb782-106">In general, a live source cannot control the rate at which data arrives.</span></span>

<span data-ttu-id="bb782-107">如果下列任一條件成立，則會將篩選視為即時來源：</span><span class="sxs-lookup"><span data-stu-id="bb782-107">A filter is considered to be a live source if either of the following are true:</span></span>

-   <span data-ttu-id="bb782-108">篩選準則 \_ \_ \_ \_ 會 \_ 從 [**IAMFILTERMISCFLAGS：： GetMiscFlags**](/windows/desktop/api/Strmif/nf-strmif-iamfiltermiscflags-getmiscflags) 方法傳回 AM 篩選其他旗標為來源旗標，且至少其中一個輸出圖釘會公開 [**IAMPushSource**](/windows/desktop/api/Strmif/nn-strmif-iampushsource) 介面。</span><span class="sxs-lookup"><span data-stu-id="bb782-108">The filter returns the AM\_FILTER\_MISC\_FLAGS\_IS\_SOURCE flag from the [**IAMFilterMiscFlags::GetMiscFlags**](/windows/desktop/api/Strmif/nf-strmif-iamfiltermiscflags-getmiscflags) method, AND at least one of its output pins exposes the [**IAMPushSource**](/windows/desktop/api/Strmif/nn-strmif-iampushsource) interface.</span></span>
-   <span data-ttu-id="bb782-109">此篩選器會公開 [**IKsPropertySet**](ikspropertyset.md) 介面，並有 (釘選 \_ 類別 \_ 捕獲) 的捕獲 pin。</span><span class="sxs-lookup"><span data-stu-id="bb782-109">The filter exposes the [**IKsPropertySet**](ikspropertyset.md) interface and has a capture pin (PIN\_CATEGORY\_CAPTURE).</span></span> <span data-ttu-id="bb782-110">如需詳細資訊，請參閱 [釘選屬性集](pin-property-set.md) 。</span><span class="sxs-lookup"><span data-stu-id="bb782-110">See [Pin Property Set](pin-property-set.md) for more information.</span></span>

<span data-ttu-id="bb782-111">如果即時來源篩選器提供時鐘，則篩選圖形管理員會偏好在選擇 Graph 參考時鐘時使用時鐘。</span><span class="sxs-lookup"><span data-stu-id="bb782-111">If a live source filter provides a clock, the Filter Graph Manager will prefer that clock when it chooses the graph reference clock.</span></span> <span data-ttu-id="bb782-112">如需詳細資訊，請參閱 [參考時鐘](reference-clocks.md) 。</span><span class="sxs-lookup"><span data-stu-id="bb782-112">See [Reference Clocks](reference-clocks.md) for more information.</span></span>

<span data-ttu-id="bb782-113">**延遲**</span><span class="sxs-lookup"><span data-stu-id="bb782-113">**Latency**</span></span>

<span data-ttu-id="bb782-114">篩選器的延遲是篩選器處理範例所需的時間量。</span><span class="sxs-lookup"><span data-stu-id="bb782-114">A filter's latency is the amount of time it takes the filter to process a sample.</span></span> <span data-ttu-id="bb782-115">針對即時來源，延遲是由用來保存範例的緩衝區大小所決定。</span><span class="sxs-lookup"><span data-stu-id="bb782-115">For live sources, the latency is determined by the size of the buffer used to hold samples.</span></span> <span data-ttu-id="bb782-116">例如，假設篩選圖形的影片來源的延遲為33毫秒 (ms) ，而音訊來源的延遲為500毫秒。</span><span class="sxs-lookup"><span data-stu-id="bb782-116">For example, suppose the filter graph has a video source with a latency of 33 milliseconds (ms) and an audio source with a latency of 500 ms.</span></span> <span data-ttu-id="bb782-117">在比對音訊範例到達音訊轉譯器之前，每個影片框架都會抵達影片轉譯器大約470毫秒。</span><span class="sxs-lookup"><span data-stu-id="bb782-117">Each video frame arrives at the video renderer about 470 ms before the matching audio sample reaches the audio renderer.</span></span> <span data-ttu-id="bb782-118">除非圖形針對差異進行補償，否則音訊和影片將不會同步處理。</span><span class="sxs-lookup"><span data-stu-id="bb782-118">Unless the graph compensates for the difference, the audio and video will not be synchronized.</span></span>

<span data-ttu-id="bb782-119">即時來源可以透過 [**IAMPushSource**](/windows/desktop/api/Strmif/nn-strmif-iampushsource) 介面進行同步處理。</span><span class="sxs-lookup"><span data-stu-id="bb782-119">Live sources can be synchronized through the [**IAMPushSource**](/windows/desktop/api/Strmif/nn-strmif-iampushsource) interface.</span></span> <span data-ttu-id="bb782-120">除非應用程式藉由呼叫 [**IAMGraphStreams：： SyncUsingStreamOffset**](/windows/desktop/api/Strmif/nf-strmif-iamgraphstreams-syncusingstreamoffset) 方法來啟用同步處理，否則篩選圖形管理員不會同步處理即時來源。</span><span class="sxs-lookup"><span data-stu-id="bb782-120">The Filter Graph Manager does not synchronize live sources unless the application enables synchronization by calling the [**IAMGraphStreams::SyncUsingStreamOffset**](/windows/desktop/api/Strmif/nf-strmif-iamgraphstreams-syncusingstreamoffset) method.</span></span> <span data-ttu-id="bb782-121">如果同步處理已啟用，則篩選圖形管理員會查詢每個來源篩選以進行 **IAMPushSource**。</span><span class="sxs-lookup"><span data-stu-id="bb782-121">If synchronization is enabled, the Filter Graph Manager queries each source filter for **IAMPushSource**.</span></span> <span data-ttu-id="bb782-122">如果篩選準則支援 **IAMPushSource**，則篩選圖形管理員會呼叫 [**IAMLatency：： GetLatency**](/windows/desktop/api/Strmif/nf-strmif-iamlatency-getlatency) 來取得篩選準則的預期延遲。</span><span class="sxs-lookup"><span data-stu-id="bb782-122">If the filter supports **IAMPushSource**, the Filter Graph Manager calls [**IAMLatency::GetLatency**](/windows/desktop/api/Strmif/nf-strmif-iamlatency-getlatency) to retrieve the filter's expected latency.</span></span> <span data-ttu-id="bb782-123">**IAMPushSource** 介面 (繼承 [**IAMLatency**](/windows/desktop/api/Strmif/nn-strmif-iamlatency)) 。從結合的延遲值，篩選圖形管理員會決定圖形中預期的最大延遲。</span><span class="sxs-lookup"><span data-stu-id="bb782-123">(The **IAMPushSource** interface inherits [**IAMLatency**](/windows/desktop/api/Strmif/nn-strmif-iamlatency).) From the combined latency values, the Filter Graph Manager determines the maximum expected latency in the graph.</span></span> <span data-ttu-id="bb782-124">然後，它會呼叫 [**IAMPushSource：： SetStreamOffset**](/windows/desktop/api/Strmif/nf-strmif-iampushsource-setstreamoffset) 來提供每個來源篩選一個資料流程位移，該篩選會將它新增至它所產生的時間戳記。</span><span class="sxs-lookup"><span data-stu-id="bb782-124">It then calls [**IAMPushSource::SetStreamOffset**](/windows/desktop/api/Strmif/nf-strmif-iampushsource-setstreamoffset) to give each source filter a stream offset, which that filter adds to the time stamps that it generates.</span></span>

<span data-ttu-id="bb782-125">這個方法主要是供即時預覽之用。</span><span class="sxs-lookup"><span data-stu-id="bb782-125">This method is intended primarily for live preview.</span></span> <span data-ttu-id="bb782-126">不過，請注意，即時捕獲裝置上的預覽 pin (例如相機) 不會在其所提供的範例上設定時間戳記。</span><span class="sxs-lookup"><span data-stu-id="bb782-126">However, note that a preview pin on a live capture device (such as a camera) does not set time stamps on the samples it delivers.</span></span> <span data-ttu-id="bb782-127">因此，若要將此方法與 live capture 裝置搭配使用，您必須從 capture pin 進行預覽。</span><span class="sxs-lookup"><span data-stu-id="bb782-127">Therefore, to use this method with a live capture device, you must preview from the capture pin.</span></span> <span data-ttu-id="bb782-128">如需詳細資訊，請參閱 [DirectShow 影片捕獲篩選](directshow-video-capture-filters.md)。</span><span class="sxs-lookup"><span data-stu-id="bb782-128">For more information, see [DirectShow Video Capture Filters](directshow-video-capture-filters.md).</span></span>

<span data-ttu-id="bb782-129">[VFW Capture](vfw-capture-filter.md)篩選器和 [音訊捕獲](audio-capture-filter.md)篩選器目前支援 [**IAMPushSource**](/windows/desktop/api/Strmif/nn-strmif-iampushsource)介面。</span><span class="sxs-lookup"><span data-stu-id="bb782-129">Currently the [**IAMPushSource**](/windows/desktop/api/Strmif/nn-strmif-iampushsource) interface is supported by the [VFW Capture](vfw-capture-filter.md) filter and the [Audio Capture](audio-capture-filter.md) filter.</span></span>

<span data-ttu-id="bb782-130">**速率比對**</span><span class="sxs-lookup"><span data-stu-id="bb782-130">**Rate Matching**</span></span>

<span data-ttu-id="bb782-131">如果轉譯器篩選使用一個參考時鐘來排程範例，但來源篩選器使用不同的時鐘來產生這些樣本，則可能會在播放時發生問題。</span><span class="sxs-lookup"><span data-stu-id="bb782-131">If a renderer filter schedules samples using one reference clock, but the source filter produces them using a different clock, glitches can occur in playback.</span></span> <span data-ttu-id="bb782-132">轉譯器的執行速度可能會比來源還快，導致資料中的間距。</span><span class="sxs-lookup"><span data-stu-id="bb782-132">The renderer might run faster than the source, causing gaps in the data.</span></span> <span data-ttu-id="bb782-133">或者，它的執行速度可能會比來源還慢，導致範例「變大」，直到某個時間點，圖形才會捨棄範例。</span><span class="sxs-lookup"><span data-stu-id="bb782-133">Or it might run slower than the source, causing samples to "bunch up," until at some point the graph will drop samples.</span></span> <span data-ttu-id="bb782-134">一般情況下，即時來源無法控制其生產費率，因此轉譯器應該會比對來源的速率。</span><span class="sxs-lookup"><span data-stu-id="bb782-134">Typically, a live source cannot control its production rate, so instead the renderer should match rates with the source.</span></span>

<span data-ttu-id="bb782-135">目前，只有音訊轉譯器會執行速率比對，因為音訊播放的問題比影片中的問題更明顯。</span><span class="sxs-lookup"><span data-stu-id="bb782-135">Currently, only the audio renderer performs rate matching, because glitches in audio playback are more noticeable than glitches in video.</span></span> <span data-ttu-id="bb782-136">若要執行比對，音訊轉譯器必須選取它將符合的速率。</span><span class="sxs-lookup"><span data-stu-id="bb782-136">To perform rate-matching, the audio renderer must select something against which it will match rates.</span></span> <span data-ttu-id="bb782-137">它會使用下列演算法：</span><span class="sxs-lookup"><span data-stu-id="bb782-137">It uses the following algorithm:</span></span>

-   <span data-ttu-id="bb782-138">如果圖形未使用參考時鐘，則音訊轉譯器不會嘗試比對速率。</span><span class="sxs-lookup"><span data-stu-id="bb782-138">If the graph is not using a reference clock, the audio renderer does not try to match rates.</span></span> <span data-ttu-id="bb782-139"> (，只要圖形沒有參考時鐘，則會在其抵達時立即轉譯樣本。 ) </span><span class="sxs-lookup"><span data-stu-id="bb782-139">(Whenever the graph has no reference clock, samples are always rendered immediately as they arrive.)</span></span>
-   <span data-ttu-id="bb782-140">否則，如果圖形有參考時鐘，則音訊轉譯器會使用先前所述的準則來檢查是否有即時來源上游。</span><span class="sxs-lookup"><span data-stu-id="bb782-140">Otherwise, if there is a reference clock for the graph, the audio renderer checks whether there is a live source upstream, using the criteria described previously.</span></span> <span data-ttu-id="bb782-141">如果不是，則音訊轉譯器不符合費率。</span><span class="sxs-lookup"><span data-stu-id="bb782-141">If not, the audio renderer does not match rates.</span></span>
-   <span data-ttu-id="bb782-142">如果有即時來源上游，且該來源在其輸出 pin 上公開 [**IAMPushSource**](/windows/desktop/api/Strmif/nn-strmif-iampushsource) 介面，則音訊轉譯器會呼叫 [**IAMPushSource：： GetPushSourceFlags**](/windows/desktop/api/Strmif/nf-strmif-iampushsource-getpushsourceflags)。</span><span class="sxs-lookup"><span data-stu-id="bb782-142">If there is a live source upstream, and that source exposes the [**IAMPushSource**](/windows/desktop/api/Strmif/nn-strmif-iampushsource) interface on its output pin, the audio renderer calls [**IAMPushSource::GetPushSourceFlags**](/windows/desktop/api/Strmif/nf-strmif-iampushsource-getpushsourceflags).</span></span> <span data-ttu-id="bb782-143">它會尋找下列其中一個旗標：</span><span class="sxs-lookup"><span data-stu-id="bb782-143">It looks for one of the following flags:</span></span>
    -   <span data-ttu-id="bb782-144">\_PUSHSOURCECAPS \_ 內部 \_ RM。</span><span class="sxs-lookup"><span data-stu-id="bb782-144">AM\_PUSHSOURCECAPS\_INTERNAL\_RM.</span></span> <span data-ttu-id="bb782-145">此旗標表示來源篩選器有自己的速率比對機制，因此音訊轉譯器不符合費率。</span><span class="sxs-lookup"><span data-stu-id="bb782-145">This flag means the source filter has its own rate-matching mechanism, so the audio renderer does not match rates.</span></span>
    -   <span data-ttu-id="bb782-146">AM \_ PUSHSOURCECAPS \_ 無法 \_ 上線。</span><span class="sxs-lookup"><span data-stu-id="bb782-146">AM\_PUSHSOURCECAPS\_NOT\_LIVE.</span></span> <span data-ttu-id="bb782-147">此旗標表示來源篩選不是真正的即時來源，即使它會公開 [**IAMPushSource**](/windows/desktop/api/Strmif/nn-strmif-iampushsource) 介面也一樣。</span><span class="sxs-lookup"><span data-stu-id="bb782-147">This flag means the source filter is not really a live source, even though it exposes the [**IAMPushSource**](/windows/desktop/api/Strmif/nn-strmif-iampushsource) interface.</span></span> <span data-ttu-id="bb782-148">因此，音訊轉譯器不符合費率。</span><span class="sxs-lookup"><span data-stu-id="bb782-148">Therefore, the audio renderer does not match rates.</span></span>
    -   <span data-ttu-id="bb782-149">\_PUSHSOURCECAPS \_ 私用 \_ 時鐘。</span><span class="sxs-lookup"><span data-stu-id="bb782-149">AM\_PUSHSOURCECAPS\_PRIVATE\_CLOCK.</span></span> <span data-ttu-id="bb782-150">此旗標表示來源篩選器會使用私用時鐘來產生時間戳記。</span><span class="sxs-lookup"><span data-stu-id="bb782-150">This flag means the source filter is using a private clock to generate time stamps.</span></span> <span data-ttu-id="bb782-151">在此情況下，音訊轉譯器會與時間戳記的速率相符。</span><span class="sxs-lookup"><span data-stu-id="bb782-151">In this case, the audio renderer matches rates against the time stamps.</span></span> <span data-ttu-id="bb782-152"> (如果樣本沒有時間戳記，則轉譯器會忽略此旗標。 ) </span><span class="sxs-lookup"><span data-stu-id="bb782-152">(If the samples have no time stamps, however, the renderer ignores this flag.)</span></span>
-   <span data-ttu-id="bb782-153">如果 [**GetPushSourceFlags**](/windows/desktop/api/Strmif/nf-strmif-iampushsource-getpushsourceflags) 未 (零) 傳回任何旗標，音訊轉譯器的行為取決於圖形時鐘，以及範例是否有時間戳記：</span><span class="sxs-lookup"><span data-stu-id="bb782-153">If [**GetPushSourceFlags**](/windows/desktop/api/Strmif/nf-strmif-iampushsource-getpushsourceflags) returns no flags (zero), the audio renderer's behavior depends on the graph clock and whether the samples have time stamps:</span></span>
    -   <span data-ttu-id="bb782-154">如果音訊轉譯器不是圖形時鐘，而且樣本具有時間戳記，則音訊轉譯器會比對時間戳記的速率。</span><span class="sxs-lookup"><span data-stu-id="bb782-154">If the audio renderer is not the graph clock, AND the samples have time stamps, the audio renderer matches rates against the time stamps.</span></span>
    -   <span data-ttu-id="bb782-155">如果範例沒有時間戳記，音訊轉譯器會嘗試符合傳入音訊資料的速率。</span><span class="sxs-lookup"><span data-stu-id="bb782-155">If the samples do not have time stamps, the audio renderer tries to match the rate of incoming audio data.</span></span>
    -   <span data-ttu-id="bb782-156">如果音訊轉譯器是圖形時鐘，則會嘗試比對傳入的資料速率。</span><span class="sxs-lookup"><span data-stu-id="bb782-156">If the audio renderer is the graph clock, it tries to match the incoming data rate.</span></span>

<span data-ttu-id="bb782-157">最後一個案例的原因如下：如果音訊轉譯器是參考時鐘，而來源篩選器使用相同的時鐘來產生時間戳記，則音訊轉譯器無法比對時間戳記的速率。</span><span class="sxs-lookup"><span data-stu-id="bb782-157">The reason for the last case is the following: If the audio renderer is the reference clock, and the source filter is using the same clock to generate time stamps, then the audio renderer cannot match rates against the time stamps.</span></span> <span data-ttu-id="bb782-158">如果有的話，則會嘗試比對速率與本身，這可能會導致時鐘漂移。</span><span class="sxs-lookup"><span data-stu-id="bb782-158">If it did, in effect it would be trying to match rates with itself, which could cause the clock to drift.</span></span> <span data-ttu-id="bb782-159">因此，在此情況下，轉譯器會符合傳入音訊資料的速率。</span><span class="sxs-lookup"><span data-stu-id="bb782-159">Therefore, in this case the renderer matches the rate of incoming audio data.</span></span>

## <a name="related-topics"></a><span data-ttu-id="bb782-160">相關主題</span><span class="sxs-lookup"><span data-stu-id="bb782-160">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="bb782-161">DirectShow 中的時間和時鐘</span><span class="sxs-lookup"><span data-stu-id="bb782-161">Time and Clocks in DirectShow</span></span>](time-and-clocks-in-directshow.md)
</dt> </dl>

 

 



