---
description: 影片轉譯器篩選
ms.assetid: 7719ed9d-e3b9-4c84-b587-4e120b5cabf8
title: 影片轉譯器篩選
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c71e72375a43a57ce94b38d01f48abba9309e603
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104191744"
---
# <a name="video-renderer-filter"></a><span data-ttu-id="f774a-103">影片轉譯器篩選</span><span class="sxs-lookup"><span data-stu-id="f774a-103">Video Renderer Filter</span></span>

<span data-ttu-id="f774a-104">影片轉譯器篩選器是一種強大的全用途影片轉譯器。</span><span class="sxs-lookup"><span data-stu-id="f774a-104">The Video Renderer filter is a robust, all-purpose video renderer.</span></span>

> [!Note]  
> <span data-ttu-id="f774a-105">在 Windows XP 和更新版本上，預設的影片轉譯 [器是影片混合轉譯器篩選器 7](video-mixing-renderer-filter-7.md) (VMR-7) 。</span><span class="sxs-lookup"><span data-stu-id="f774a-105">On Windows XP and later, the default video renderer is the [Video Mixing Renderer Filter 7](video-mixing-renderer-filter-7.md) (VMR-7).</span></span> <span data-ttu-id="f774a-106">VMR-7 和影片轉譯器都具有易記名稱「影片轉譯器」。</span><span class="sxs-lookup"><span data-stu-id="f774a-106">The VMR-7 and the Video Renderer both have the friendly name "Video Renderer."</span></span> <span data-ttu-id="f774a-107">在舊版平臺上，影片轉譯器是預設轉譯器。</span><span class="sxs-lookup"><span data-stu-id="f774a-107">On earlier platforms, the Video Renderer is the default renderer.</span></span> <span data-ttu-id="f774a-108">請參閱 [選擇正確的](choosing-the-right-renderer.md)轉譯器。</span><span class="sxs-lookup"><span data-stu-id="f774a-108">See [Choosing the Right Renderer](choosing-the-right-renderer.md).</span></span>

 

<span data-ttu-id="f774a-109">影片轉譯器會使用 DirectDraw 和重迭表面（如果視訊卡支援的話）。</span><span class="sxs-lookup"><span data-stu-id="f774a-109">The Video Renderer uses DirectDraw and overlay surfaces, if the video card supports them.</span></span> <span data-ttu-id="f774a-110">篩選圖形管理員會公開 [**IVideoWindow**](/windows/desktop/api/Control/nn-control-ivideowindow) 介面，此介面可讓應用程式設定和取出影片轉譯器上的屬性。</span><span class="sxs-lookup"><span data-stu-id="f774a-110">The Filter Graph Manager exposes the [**IVideoWindow**](/windows/desktop/api/Control/nn-control-ivideowindow) interface, which enables applications to set and retrieve properties on the Video Renderer.</span></span> <span data-ttu-id="f774a-111">使用較新的視訊卡時，影片轉譯器支援全螢幕呈現。</span><span class="sxs-lookup"><span data-stu-id="f774a-111">With newer video cards, the Video Renderer supports full-screen rendering.</span></span> <span data-ttu-id="f774a-112">否則，篩選圖形管理員會自動切換為全螢幕模式的 [全螢幕](full-screen-renderer-filter.md) 轉譯器篩選。</span><span class="sxs-lookup"><span data-stu-id="f774a-112">Otherwise, the Filter Graph Manager automatically switches to the [Full Screen Renderer](full-screen-renderer-filter.md) filter for full-screen mode.</span></span> <span data-ttu-id="f774a-113">如需詳細資訊，請參閱 [**IVideoWindow：:p 的 \_ FullScreenMode**](/windows/desktop/api/Control/nf-control-ivideowindow-put_fullscreenmode) 。</span><span class="sxs-lookup"><span data-stu-id="f774a-113">See [**IVideoWindow::put\_FullScreenMode**](/windows/desktop/api/Control/nf-control-ivideowindow-put_fullscreenmode) for more information.</span></span>

-   <span data-ttu-id="f774a-114">\[!重要\]</span><span class="sxs-lookup"><span data-stu-id="f774a-114">\[!Important\]</span></span>  
    > <span data-ttu-id="f774a-115">一般來說，此篩選器的影片視窗會處理篩選圖形管理員所建立之工作者執行緒上的訊息。</span><span class="sxs-lookup"><span data-stu-id="f774a-115">Normally, this filter's video window processes messages on a worker thread created by the Filter Graph Manager.</span></span> <span data-ttu-id="f774a-116">但是，如果應用程式使用 **CoCreateInstance** 直接建立篩選器，則影片視窗會處理應用程式執行緒上的訊息。</span><span class="sxs-lookup"><span data-stu-id="f774a-116">Howerver, if an application directly creates the filter using **CoCreateInstance**, the video window processes messages on the application thread.</span></span> <span data-ttu-id="f774a-117">在此情況下，應用程式執行緒必須有訊息迴圈，才能將訊息分派至影片視窗。</span><span class="sxs-lookup"><span data-stu-id="f774a-117">In that case, the application thread must have a message loop, to dispatch messages to the video window.</span></span> <span data-ttu-id="f774a-118">此外，在對影片轉譯器的最終 **發行** 呼叫（當篩選圖形管理員關閉時，就會發生這種情況），執行緒就不能結束。</span><span class="sxs-lookup"><span data-stu-id="f774a-118">Also, the thread must not exit until the final **Release** call to the Video Renderer, which occurs when the Filter Graph Manager shuts down.</span></span> <span data-ttu-id="f774a-119">否則，應用程式可能會鎖死。</span><span class="sxs-lookup"><span data-stu-id="f774a-119">Otherwise, the application might deadlock.</span></span>

     



|                                          |                                                                                                                                                                                                                                                                                                                                                                                                          |
|------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="f774a-120">篩選介面</span><span class="sxs-lookup"><span data-stu-id="f774a-120">Filter Interfaces</span></span>                        | <span data-ttu-id="f774a-121">[**IBaseFilter**](/windows/desktop/api/Strmif/nn-strmif-ibasefilter)、 [**IBasicVideo**](/windows/desktop/api/Control/nn-control-ibasicvideo)、 [**IBasicVideo2**](/windows/desktop/api/Control/nn-control-ibasicvideo2)、 [**IDirectDrawVideo**](/previous-versions/windows/desktop/api/Amvideo/nn-amvideo-idirectdrawvideo)、 [**IKsPropertySet**](ikspropertyset.md)、 [**IMediaPosition**](/windows/desktop/api/Control/nn-control-imediaposition)、 [**IMediaSeeking**](/windows/desktop/api/Strmif/nn-strmif-imediaseeking)、 [**IQualityControl**](/windows/desktop/api/Strmif/nn-strmif-iqualitycontrol)、 [**IQualProp**](/previous-versions/windows/desktop/api/Amvideo/nn-amvideo-iqualprop)、 [**IVideoWindow**](/windows/desktop/api/Control/nn-control-ivideowindow)</span><span class="sxs-lookup"><span data-stu-id="f774a-121">[**IBaseFilter**](/windows/desktop/api/Strmif/nn-strmif-ibasefilter), [**IBasicVideo**](/windows/desktop/api/Control/nn-control-ibasicvideo), [**IBasicVideo2**](/windows/desktop/api/Control/nn-control-ibasicvideo2), [**IDirectDrawVideo**](/previous-versions/windows/desktop/api/Amvideo/nn-amvideo-idirectdrawvideo), [**IKsPropertySet**](ikspropertyset.md), [**IMediaPosition**](/windows/desktop/api/Control/nn-control-imediaposition), [**IMediaSeeking**](/windows/desktop/api/Strmif/nn-strmif-imediaseeking), [**IQualityControl**](/windows/desktop/api/Strmif/nn-strmif-iqualitycontrol), [**IQualProp**](/previous-versions/windows/desktop/api/Amvideo/nn-amvideo-iqualprop), [**IVideoWindow**](/windows/desktop/api/Control/nn-control-ivideowindow)</span></span> |
| <span data-ttu-id="f774a-122">輸入 Pin 媒體類型</span><span class="sxs-lookup"><span data-stu-id="f774a-122">Input Pin Media Types</span></span>                    | <span data-ttu-id="f774a-123">未壓縮的影片格式。</span><span class="sxs-lookup"><span data-stu-id="f774a-123">Uncompressed video formats.</span></span>                                                                                                                                                                                                                                                                                                                                                                              |
| <span data-ttu-id="f774a-124">輸入 Pin 介面</span><span class="sxs-lookup"><span data-stu-id="f774a-124">Input Pin Interfaces</span></span>                     | <span data-ttu-id="f774a-125">[**IMemInputPin**](/windows/desktop/api/Strmif/nn-strmif-imeminputpin)、 [**IOverlay**](/windows/desktop/api/Strmif/nn-strmif-ioverlay)、 [**IPin**](/windows/desktop/api/Strmif/nn-strmif-ipin)、 [**IPinConnection**](/windows/desktop/api/Strmif/nn-strmif-ipinconnection)、 [**IQualityControl**](/windows/desktop/api/Strmif/nn-strmif-iqualitycontrol)</span><span class="sxs-lookup"><span data-stu-id="f774a-125">[**IMemInputPin**](/windows/desktop/api/Strmif/nn-strmif-imeminputpin), [**IOverlay**](/windows/desktop/api/Strmif/nn-strmif-ioverlay), [**IPin**](/windows/desktop/api/Strmif/nn-strmif-ipin), [**IPinConnection**](/windows/desktop/api/Strmif/nn-strmif-ipinconnection), [**IQualityControl**](/windows/desktop/api/Strmif/nn-strmif-iqualitycontrol)</span></span>                                                                                                                                                                                                                           |
| <span data-ttu-id="f774a-126">輸出 Pin 媒體類型</span><span class="sxs-lookup"><span data-stu-id="f774a-126">Output Pin Media Types</span></span>                   | <span data-ttu-id="f774a-127">不適用。</span><span class="sxs-lookup"><span data-stu-id="f774a-127">Not applicable.</span></span>                                                                                                                                                                                                                                                                                                                                                                                          |
| <span data-ttu-id="f774a-128">輸出 Pin 介面</span><span class="sxs-lookup"><span data-stu-id="f774a-128">Output Pin Interfaces</span></span>                    | <span data-ttu-id="f774a-129">不適用。</span><span class="sxs-lookup"><span data-stu-id="f774a-129">Not applicable.</span></span>                                                                                                                                                                                                                                                                                                                                                                                          |
| <span data-ttu-id="f774a-130">篩選 CLSID</span><span class="sxs-lookup"><span data-stu-id="f774a-130">Filter CLSID</span></span>                             | <span data-ttu-id="f774a-131">CLSID \_ VideoRenderer</span><span class="sxs-lookup"><span data-stu-id="f774a-131">CLSID\_VideoRenderer</span></span>                                                                                                                                                                                                                                                                                                                                                                                     |
| <span data-ttu-id="f774a-132">屬性頁 CLSID</span><span class="sxs-lookup"><span data-stu-id="f774a-132">Property Page CLSID</span></span>                      | <span data-ttu-id="f774a-133">沒有屬性頁。</span><span class="sxs-lookup"><span data-stu-id="f774a-133">No property page.</span></span>                                                                                                                                                                                                                                                                                                                                                                                        |
| <span data-ttu-id="f774a-134">可執行檔</span><span class="sxs-lookup"><span data-stu-id="f774a-134">Executable</span></span>                               | <span data-ttu-id="f774a-135">quartz.dll</span><span class="sxs-lookup"><span data-stu-id="f774a-135">quartz.dll</span></span>                                                                                                                                                                                                                                                                                                                                                                                               |
| [<span data-ttu-id="f774a-136">優點</span><span class="sxs-lookup"><span data-stu-id="f774a-136">Merit</span></span>](merit.md)                       | <span data-ttu-id="f774a-137">Windows XP 和更新版本：不 **\_ 太可能**</span><span class="sxs-lookup"><span data-stu-id="f774a-137">Windows XP and later: **MERIT\_UNLIKELY**</span></span>                                                                                                                                                                                                                                                                                                                                                                |
| [<span data-ttu-id="f774a-138">篩選準則分類</span><span class="sxs-lookup"><span data-stu-id="f774a-138">Filter Category</span></span>](filter-categories.md) | <span data-ttu-id="f774a-139">**CLSID \_ LegacyAmFilterCategory**</span><span class="sxs-lookup"><span data-stu-id="f774a-139">**CLSID\_LegacyAmFilterCategory**</span></span>                                                                                                                                                                                                                                                                                                                                                                        |



 

## <a name="remarks"></a><span data-ttu-id="f774a-140">備註</span><span class="sxs-lookup"><span data-stu-id="f774a-140">Remarks</span></span>

<span data-ttu-id="f774a-141">在 Quartz.dll 的偵錯工具版本中，如果記錄 \_ 追蹤調試層級設定為5或更高，則影片轉譯器會在影片視窗上顯示每個畫面格的時間戳記。</span><span class="sxs-lookup"><span data-stu-id="f774a-141">In the debug version of Quartz.dll, if the LOG\_TRACE debug level is set to 5 or higher, the Video Renderer displays each frame's time stamps on the video window.</span></span> <span data-ttu-id="f774a-142">這些數位不會出現在 DLL 的零售版本中。</span><span class="sxs-lookup"><span data-stu-id="f774a-142">These numbers do not appear in the retail version of the DLL.</span></span> <span data-ttu-id="f774a-143">如需詳細資訊，請參閱 [Debug Output 函數](debug-output-functions.md)。</span><span class="sxs-lookup"><span data-stu-id="f774a-143">For more information, see [Debug Output Functions](debug-output-functions.md).</span></span>

<span data-ttu-id="f774a-144">下列備註適用于篩選器開發人員：</span><span class="sxs-lookup"><span data-stu-id="f774a-144">The following remarks are intended for filter developers:</span></span>

<span data-ttu-id="f774a-145">如果影片圖形配接器支援 YUV 重迭表面，則影片轉譯器會接受 YUV 格式。</span><span class="sxs-lookup"><span data-stu-id="f774a-145">The Video Renderer accepts YUV formats if the video graphics card supports YUV overlay surfaces.</span></span> <span data-ttu-id="f774a-146">不過，當它第一次連線到上游篩選器時，影片轉譯器需要的 RGB 格式必須符合目前監視器設定的色彩深度。</span><span class="sxs-lookup"><span data-stu-id="f774a-146">When it first connects to the upstream filter, however, the Video Renderer requires an RGB format that matches the color depth of the current monitor settings.</span></span> <span data-ttu-id="f774a-147">例如，如果目前的顯示設定是24位色彩，上游篩選器必須能夠提供24位 RGB 影片。</span><span class="sxs-lookup"><span data-stu-id="f774a-147">For example, if the current display setting is 24-bit color, the upstream filter must be able to provide 24-bit RGB video.</span></span> <span data-ttu-id="f774a-148">當篩選圖形切換為「已在使用」狀態時，影片轉譯器會將動態格式變更協商至適當的 YUV 色彩空間。</span><span class="sxs-lookup"><span data-stu-id="f774a-148">When the filter graph switches to a runing state, the Video Renderer negotiates a dynamic format change to the appropriate YUV color space.</span></span>

<span data-ttu-id="f774a-149">藉由連接 RGB 型別，影片轉譯器可確保它在無法使用的情況下，可以使用 GDI。</span><span class="sxs-lookup"><span data-stu-id="f774a-149">By connecting with an RGB type, the Video Renderer ensures that it can use GDI in case DirectDraw is not available.</span></span> <span data-ttu-id="f774a-150">如果有其他應用程式正在使用視訊記憶體，則會切換為 GDI; 如果影片矩形跨越多重監視器系統上的兩個監視器，或影片矩形完全被另一個視窗遮蔽，則會切換至 GDI。</span><span class="sxs-lookup"><span data-stu-id="f774a-150">It will switch to GDI if another application is using the video memory, if the video rectangle straddles two monitors on a multi-monitor system, or if the video rectangle is completely obscured by another window.</span></span>

> [!Note]  
> <span data-ttu-id="f774a-151">影片混合轉譯器不會執行這種類型的動態格式變更，而且不需要 RGB 媒體類型，因為它永遠不會使用 GDI 來呈現。</span><span class="sxs-lookup"><span data-stu-id="f774a-151">The Video Mixing Renderer does not perform this type of dynamic format change, and does not require an RGB media type, because it never uses GDI for rendering.</span></span>

 

<span data-ttu-id="f774a-152">為了協調格式變更，影片轉譯器會以新的媒體類型呼叫 [**IPin：： QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) 。</span><span class="sxs-lookup"><span data-stu-id="f774a-152">To negotiate a format change, the Video Renderer calls [**IPin::QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) with the new media type.</span></span> <span data-ttu-id="f774a-153">如果上游篩選傳回 S \_ OK，則影片轉譯器會將新媒體附加至下一個範例。</span><span class="sxs-lookup"><span data-stu-id="f774a-153">If the upstream filter returns S\_OK, the Video Renderer attaches the new media to the next sample.</span></span> <span data-ttu-id="f774a-154">上游篩選應針對每個範例呼叫 [**IMediaSample：： GetMediaType**](/windows/desktop/api/Strmif/nf-strmif-imediasample-getmediatype) 。</span><span class="sxs-lookup"><span data-stu-id="f774a-154">The upstream filter should call [**IMediaSample::GetMediaType**](/windows/desktop/api/Strmif/nf-strmif-imediasample-getmediatype) on each sample.</span></span> <span data-ttu-id="f774a-155">如果 **GetMediaType** 傳回非 **Null** 值，則表示格式變更，而上游篩選器應藉由切換輸出類型來回應。</span><span class="sxs-lookup"><span data-stu-id="f774a-155">If **GetMediaType** returns a non-**NULL** value, it indicates a format change, and the upstream filter should respond by switching output types.</span></span> <span data-ttu-id="f774a-156"> (不會在 **QueryAccept** 方法中切換類型。 ) 上游篩選器應該至少接受主要 RGB 型別，而且在理想情況下應該支援通用 YUV 類型。</span><span class="sxs-lookup"><span data-stu-id="f774a-156">(Do not switch types in the **QueryAccept** method.) The upstream filter should accept at least the major RGB types, and ideally should support the common YUV types.</span></span> <span data-ttu-id="f774a-157">在串流處理期間，影片轉譯器可能會在 YUV 和 RGB 類型之間來回切換。</span><span class="sxs-lookup"><span data-stu-id="f774a-157">During streaming, the Video Renderer might switch back and forth between YUV and RGB types any number of times.</span></span> <span data-ttu-id="f774a-158">影片轉譯器不接受上游篩選所起始的動態格式變更。</span><span class="sxs-lookup"><span data-stu-id="f774a-158">The Video Renderer does not accept dynamic format changes initiated by the upstream filter.</span></span>

<span data-ttu-id="f774a-159">當影片轉譯器繪製至 DirectDraw 重迭介面時，它會為其輸入的 pin 配置單一緩衝區。</span><span class="sxs-lookup"><span data-stu-id="f774a-159">When the Video Renderer draws to a DirectDraw overlay surface, it allocates a single buffer for its input pin.</span></span> <span data-ttu-id="f774a-160">如果上游篩選嘗試使用多個緩衝區來強制連接，則影片轉譯器將無法使用覆迭表面。</span><span class="sxs-lookup"><span data-stu-id="f774a-160">If the upstream filter attempts to force a connection using multiple buffers, the Video Renderer will be unable to use the overlay surface.</span></span>

## <a name="related-topics"></a><span data-ttu-id="f774a-161">相關主題</span><span class="sxs-lookup"><span data-stu-id="f774a-161">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="f774a-162">DirectShow 篩選</span><span class="sxs-lookup"><span data-stu-id="f774a-162">DirectShow Filters</span></span>](directshow-filters.md)
</dt> </dl>

 

 



