---
description: 使用 SQL-DMO 類別範本
ms.assetid: 5193ad08-aaee-47e3-93eb-a126a66d8f23
title: 使用 SQL-DMO 類別範本
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4db80017372f11f6c928e0e6a83b591967a84ee7
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "104027049"
---
# <a name="using-the-dmo-class-template"></a><span data-ttu-id="636bf-103">使用 SQL-DMO 類別範本</span><span class="sxs-lookup"><span data-stu-id="636bf-103">Using the DMO Class Template</span></span>

<span data-ttu-id="636bf-104">DirectShow 包含用來執行 DMOs 的類別範本 [**IMediaObjectImpl**](imediaobjectimpl-class-template.md)。</span><span class="sxs-lookup"><span data-stu-id="636bf-104">DirectShow includes a class template, [**IMediaObjectImpl**](imediaobjectimpl-class-template.md), for implementing DMOs.</span></span> <span data-ttu-id="636bf-105">此範本會處理許多「簿記」工作，例如驗證輸入參數。</span><span class="sxs-lookup"><span data-stu-id="636bf-105">The template handles many of the "bookkeeping" tasks, such as validating input parameters.</span></span> <span data-ttu-id="636bf-106">藉由使用範本，您可以將焦點放在您的 SQL-DMO 專屬的功能。</span><span class="sxs-lookup"><span data-stu-id="636bf-106">By using the template, you can focus on the functionality that is specific to your DMO.</span></span> <span data-ttu-id="636bf-107">此外，此範本有助於確保您能夠建立強大的實作為。</span><span class="sxs-lookup"><span data-stu-id="636bf-107">In addition, the template helps to ensure that you create a robust implementation.</span></span> <span data-ttu-id="636bf-108">範本會定義在標頭檔 Dmoimpl 中，該檔案位於 SDK 的 Include 目錄中。</span><span class="sxs-lookup"><span data-stu-id="636bf-108">The template is defined in the header file Dmoimpl.h, located in the Include directory of the SDK.</span></span>

<span data-ttu-id="636bf-109">**IMediaObjectImpl** 範本會繼承 [**IMediaObject**](/previous-versions/windows/desktop/api/Mediaobj/nn-mediaobj-imediaobject)介面。</span><span class="sxs-lookup"><span data-stu-id="636bf-109">The **IMediaObjectImpl** template inherits the [**IMediaObject**](/previous-versions/windows/desktop/api/Mediaobj/nn-mediaobj-imediaobject) interface.</span></span> <span data-ttu-id="636bf-110">若要使用範本來建立一或一個，請定義衍生自 **IMediaObjectImpl** 的新類別。</span><span class="sxs-lookup"><span data-stu-id="636bf-110">To create a DMO using the template, define a new class that derives from **IMediaObjectImpl**.</span></span> <span data-ttu-id="636bf-111">範本會實 **IMediaObject** 方法。</span><span class="sxs-lookup"><span data-stu-id="636bf-111">The template implements all of the **IMediaObject** methods.</span></span> <span data-ttu-id="636bf-112">在大部分情況下，範本會在衍生類別上呼叫對應的私用方法。</span><span class="sxs-lookup"><span data-stu-id="636bf-112">In most cases, the template calls a corresponding private method on the derived class.</span></span> <span data-ttu-id="636bf-113">範本提供下列功能：</span><span class="sxs-lookup"><span data-stu-id="636bf-113">The template provides the following features:</span></span>

-   <span data-ttu-id="636bf-114">基本參數檢查。</span><span class="sxs-lookup"><span data-stu-id="636bf-114">Basic parameter checking.</span></span> <span data-ttu-id="636bf-115">範本方法會驗證必要的參數不是 **Null**、資料流程索引在範圍內，且旗標有效。</span><span class="sxs-lookup"><span data-stu-id="636bf-115">The template methods verify that required parameters are not **NULL**, that stream indexes are within range, and that flags are valid.</span></span>
-   <span data-ttu-id="636bf-116">鎖定。</span><span class="sxs-lookup"><span data-stu-id="636bf-116">Locking.</span></span> <span data-ttu-id="636bf-117">範本方法會呼叫兩個內部方法（ **鎖定** 和 **解除鎖定**）來序列化一次的作業。</span><span class="sxs-lookup"><span data-stu-id="636bf-117">The template methods call two internal methods, **Lock** and **Unlock**, to serialize operations on the DMO.</span></span> <span data-ttu-id="636bf-118">這項功能可確保是以執行緒安全的表示。</span><span class="sxs-lookup"><span data-stu-id="636bf-118">This feature ensures that the DMO is thread-safe.</span></span>
-   <span data-ttu-id="636bf-119">媒體類型。</span><span class="sxs-lookup"><span data-stu-id="636bf-119">Media types.</span></span> <span data-ttu-id="636bf-120">此範本會儲存用戶端所設定的媒體類型，並提供媒體類型的存取子方法。</span><span class="sxs-lookup"><span data-stu-id="636bf-120">The template stores the media types set by the client, and provides accessor methods for the media types.</span></span>
-   <span data-ttu-id="636bf-121">流。</span><span class="sxs-lookup"><span data-stu-id="636bf-121">Streaming.</span></span> <span data-ttu-id="636bf-122">此範本會防止串流處理，直到用戶端已設定所有非選用資料流程的媒體類型。</span><span class="sxs-lookup"><span data-stu-id="636bf-122">The template prevents streaming until the client has set media types for all non-optional streams.</span></span> <span data-ttu-id="636bf-123">它也可確保在串流開始之前呼叫 [**IMediaObject：： AllocateStreamingResources**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-allocatestreamingresources) 方法，以確保配置資源。</span><span class="sxs-lookup"><span data-stu-id="636bf-123">It also ensures that the [**IMediaObject::AllocateStreamingResources**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-allocatestreamingresources) method is called before streaming begins, which guarantees that resources are allocated.</span></span>

<span data-ttu-id="636bf-124">衍生的類別必須執行 **IUnknown** 介面;範本未提供這個介面。</span><span class="sxs-lookup"><span data-stu-id="636bf-124">The derived class must implement the **IUnknown** interface; the template does not provide this interface.</span></span> <span data-ttu-id="636bf-125">您可以使用 Active Template Library (ATL) 來執行 **IUnknown**，也可以提供一些其他實作為。</span><span class="sxs-lookup"><span data-stu-id="636bf-125">You can use the Active Template Library (ATL) to implement **IUnknown**, or you can provide some other implementation.</span></span> <span data-ttu-id="636bf-126">此範本也不會執行鎖定機制。</span><span class="sxs-lookup"><span data-stu-id="636bf-126">The template also does not implement the locking mechanism.</span></span> <span data-ttu-id="636bf-127">衍生的類別必須執行 **鎖定** 和 **解除** 鎖定方法。</span><span class="sxs-lookup"><span data-stu-id="636bf-127">The derived class must implement the **Lock** and **Unlock** methods.</span></span> <span data-ttu-id="636bf-128">如果您使用 ATL 建立類別，您可以使用預設的 ATL 執行。</span><span class="sxs-lookup"><span data-stu-id="636bf-128">If you create your class using ATL, you can use the default ATL implementations.</span></span>

<span data-ttu-id="636bf-129">**宣告衍生類別**</span><span class="sxs-lookup"><span data-stu-id="636bf-129">**Declaring the Derived Class**</span></span>

<span data-ttu-id="636bf-130">**IMediaObjectImpl** 類別範本的宣告方式如下：</span><span class="sxs-lookup"><span data-stu-id="636bf-130">The **IMediaObjectImpl** class template is declared as follows:</span></span>


```C++
template <class _DERIVED_, int NUMBEROFINPUTS, int NUMBEROFOUTPUTS>
class IMediaObjectImpl : public ImediaObject
```



<span data-ttu-id="636bf-131">這三個範本參數是 \_ 衍生的 \_ 、NUMBEROFINPUTS 和 NUMBEROFOUTPUTS。</span><span class="sxs-lookup"><span data-stu-id="636bf-131">The three template parameters are \_DERIVED\_, NUMBEROFINPUTS, and NUMBEROFOUTPUTS.</span></span> <span data-ttu-id="636bf-132">Set \_ 衍生 \_ 等於您類別的名稱。</span><span class="sxs-lookup"><span data-stu-id="636bf-132">Set \_DERIVED\_ equal to the name of your class.</span></span> <span data-ttu-id="636bf-133">其他兩個參數會定義輸入資料流程的數目，以及在該的輸出資料流程數目。</span><span class="sxs-lookup"><span data-stu-id="636bf-133">The other two parameters define the number of input streams and output streams on the DMO.</span></span> <span data-ttu-id="636bf-134">例如，若要建立名為 CMyDmo 的 SQL-DMO 類別，以支援一個輸入資料流程和兩個輸出資料流程，請使用下列宣告：</span><span class="sxs-lookup"><span data-stu-id="636bf-134">For example, to create a DMO class named CMyDmo that supports one input stream and two output streams, use the following declaration:</span></span>


```C++
class CMyDmo : public IMediaObjectImpl<CMyDmo, 1, 2>
```



<span data-ttu-id="636bf-135">本節的其餘部分將說明範本如何在 **IMediaObject** 中執行各種方法。</span><span class="sxs-lookup"><span data-stu-id="636bf-135">The remainder of this section describes how the template implements the various methods in **IMediaObject**.</span></span>

<span data-ttu-id="636bf-136">**設定媒體類型的方法**</span><span class="sxs-lookup"><span data-stu-id="636bf-136">**Methods for Setting Media Types**</span></span>

<span data-ttu-id="636bf-137">下列方法會在 SQL-DMO 上設定或取出媒體類型：</span><span class="sxs-lookup"><span data-stu-id="636bf-137">The following methods set or retrieve media types on the DMO:</span></span>

-   <span data-ttu-id="636bf-138">**GetInputType**、 **GetOutputType**。</span><span class="sxs-lookup"><span data-stu-id="636bf-138">**GetInputType**, **GetOutputType**.</span></span> <span data-ttu-id="636bf-139">這些方法會傳回慣用的媒體類型，依串流號碼和類型索引。</span><span class="sxs-lookup"><span data-stu-id="636bf-139">These methods return preferred media types, by stream number and type index.</span></span> <span data-ttu-id="636bf-140">此範本會在衍生類別上呼叫 **InternalGetInputType** 或 **InternalGetOutputType** 。</span><span class="sxs-lookup"><span data-stu-id="636bf-140">The template calls **InternalGetInputType** or **InternalGetOutputType** on the derived class.</span></span>
-   <span data-ttu-id="636bf-141">**SetInputType**、 **SetOutputType**。</span><span class="sxs-lookup"><span data-stu-id="636bf-141">**SetInputType**, **SetOutputType**.</span></span> <span data-ttu-id="636bf-142">這些方法會設定資料流程的媒體類型、測試媒體類型或清除媒體類型。</span><span class="sxs-lookup"><span data-stu-id="636bf-142">These methods set the media type on a stream, test a media type, or clear a media type.</span></span> <span data-ttu-id="636bf-143">若要驗證媒體類型，範本會呼叫衍生類別上的 **InternalCheckInputType** 或 **InternalCheckOutputType** 。</span><span class="sxs-lookup"><span data-stu-id="636bf-143">To validate the media type, the template calls **InternalCheckInputType** or **InternalCheckOutputType** on the derived class.</span></span> <span data-ttu-id="636bf-144">衍生的類別會傳回 \_ [確定]，以接受類型或 Sql-dmo \_ E \_ INVALIDTYPE 來拒絕型別。</span><span class="sxs-lookup"><span data-stu-id="636bf-144">The derived class returns S\_OK to accept the type or DMO\_E\_INVALIDTYPE to reject the type.</span></span> <span data-ttu-id="636bf-145">範本會處理設定或清除媒體類型。</span><span class="sxs-lookup"><span data-stu-id="636bf-145">The template handles setting or clearing the media type.</span></span>
-   <span data-ttu-id="636bf-146">**GetInputCurrentType**、 **GetOutputCurrentType**。</span><span class="sxs-lookup"><span data-stu-id="636bf-146">**GetInputCurrentType**, **GetOutputCurrentType**.</span></span> <span data-ttu-id="636bf-147">這些方法會傳回資料流程的目前媒體類型， \_ \_ 如果未 \_ 設定任何類型，則傳回未設定的 E 類型 \_ 。</span><span class="sxs-lookup"><span data-stu-id="636bf-147">These methods return the current media type for a stream, or DMO\_E\_TYPE\_NOT\_SET if no type is set.</span></span> <span data-ttu-id="636bf-148">此範本會完全實作為這些方法。</span><span class="sxs-lookup"><span data-stu-id="636bf-148">The template completely implements these methods.</span></span>

<span data-ttu-id="636bf-149">**參考方法**</span><span class="sxs-lookup"><span data-stu-id="636bf-149">**Informational Methods**</span></span>

<span data-ttu-id="636bf-150">下列方法提供有關 SQL-DMO 的資訊。</span><span class="sxs-lookup"><span data-stu-id="636bf-150">The following methods provide information about the DMO.</span></span>

-   <span data-ttu-id="636bf-151">**GetInputMaxLatency**、 **SetInputMaxLatency**。</span><span class="sxs-lookup"><span data-stu-id="636bf-151">**GetInputMaxLatency**, **SetInputMaxLatency**.</span></span> <span data-ttu-id="636bf-152">這些方法會取得或設定最大延遲。</span><span class="sxs-lookup"><span data-stu-id="636bf-152">These methods retrieve or set the maximum latency.</span></span> <span data-ttu-id="636bf-153">此範本會在衍生類別上呼叫 **InternalGetInputMaxLatency** 或 **InternalSetInputMaxLatency** 。</span><span class="sxs-lookup"><span data-stu-id="636bf-153">The template calls **InternalGetInputMaxLatency** or **InternalSetInputMaxLatency** on the derived class.</span></span>
-   <span data-ttu-id="636bf-154">**GetInputSizeInfo**、 **GetOutputSizeInfo**。</span><span class="sxs-lookup"><span data-stu-id="636bf-154">**GetInputSizeInfo**, **GetOutputSizeInfo**.</span></span> <span data-ttu-id="636bf-155">這些方法會傳回所指定資料流程的 SQL-DMO 緩衝區需求。</span><span class="sxs-lookup"><span data-stu-id="636bf-155">These methods return the DMO's buffer requirements for a specified stream.</span></span> <span data-ttu-id="636bf-156">如果未在該資料流程上設定任何媒體類型，此範本會傳回 [未設定] 的 [ \_ E] \_ 類型 \_ \_ 。</span><span class="sxs-lookup"><span data-stu-id="636bf-156">If no media type has been set on that stream, the template returns DMO\_E\_TYPE\_NOT\_SET.</span></span> <span data-ttu-id="636bf-157">否則，它會在衍生類別上呼叫 **InternalGetInputSizeInfo** 或 **InternalGetOutputSizeInfo** 。</span><span class="sxs-lookup"><span data-stu-id="636bf-157">Otherwise, it calls **InternalGetInputSizeInfo** or **InternalGetOutputSizeInfo** on the derived class.</span></span>
-   <span data-ttu-id="636bf-158">**GetInputStreamInfo**、 **GetOutputStreamInfo**。</span><span class="sxs-lookup"><span data-stu-id="636bf-158">**GetInputStreamInfo**, **GetOutputStreamInfo**.</span></span> <span data-ttu-id="636bf-159">這些方法會傳回各種旗標，以指出用戶端應該如何格式化資料。</span><span class="sxs-lookup"><span data-stu-id="636bf-159">These methods return various flags that indicate how the client should format the data.</span></span> <span data-ttu-id="636bf-160">此範本會在衍生類別上呼叫 **InternalGetInputStreamInfo** 或 **InternalGetOutputStreamInfo** 。</span><span class="sxs-lookup"><span data-stu-id="636bf-160">The template calls **InternalGetInputStreamInfo** or **InternalGetOutputStreamInfo** on the derived class.</span></span>
-   <span data-ttu-id="636bf-161">**GetStreamCount**。</span><span class="sxs-lookup"><span data-stu-id="636bf-161">**GetStreamCount**.</span></span> <span data-ttu-id="636bf-162">這個方法會傳回輸入和輸出資料流程的數目。</span><span class="sxs-lookup"><span data-stu-id="636bf-162">This method returns the number of input and output streams.</span></span> <span data-ttu-id="636bf-163">此範本會使用範本參數來執行此方法。</span><span class="sxs-lookup"><span data-stu-id="636bf-163">The template implements this method, using the template parameters.</span></span>

<span data-ttu-id="636bf-164">**資源配置的方法**</span><span class="sxs-lookup"><span data-stu-id="636bf-164">**Methods for Resource Allocation**</span></span>

-   <span data-ttu-id="636bf-165">**AllocateStreamingResources** 方法會在串流開始之前配置任何的資源。</span><span class="sxs-lookup"><span data-stu-id="636bf-165">The **AllocateStreamingResources** method allocates any resources the DMO needs before streaming begins.</span></span> <span data-ttu-id="636bf-166">**FreeStreamingResources** 方法會釋放相同的資源。</span><span class="sxs-lookup"><span data-stu-id="636bf-166">The **FreeStreamingResources** method releases the same resources.</span></span> <span data-ttu-id="636bf-167">範本會分別呼叫 **InternalAllocateStreamingResources** 和 **InternalFreeStreamingResources**。</span><span class="sxs-lookup"><span data-stu-id="636bf-167">The template calls **InternalAllocateStreamingResources** and **InternalFreeStreamingResources**, respectively.</span></span>

<span data-ttu-id="636bf-168">不需要用來呼叫這些方法的 SQL-DMO 用戶端，但範本會在串流處理開始之前自動呼叫 **AllocateStreamingResources** 。</span><span class="sxs-lookup"><span data-stu-id="636bf-168">The client of the DMO is not required to call these methods, but the template automatically calls **AllocateStreamingResources** before streaming starts.</span></span> <span data-ttu-id="636bf-169">因此，當呼叫 **ProcessInput** 時，會假設已正確配置資源。</span><span class="sxs-lookup"><span data-stu-id="636bf-169">Therefore, the DMO can assume that resources are have been allocated correctly by the time **ProcessInput** is called.</span></span> <span data-ttu-id="636bf-170">SQL-DMO 應該在其函式中呼叫 **FreeStreamingResources** 。</span><span class="sxs-lookup"><span data-stu-id="636bf-170">The DMO should call **FreeStreamingResources** in its destructor.</span></span>

<span data-ttu-id="636bf-171">此外，當範本呼叫 **InternalAllocateStreamingResources** 時，它會設定內部旗標，如此一來，它就不會再次呼叫該方法，直到呼叫 **InternalFreeStreamingResources** 為止。</span><span class="sxs-lookup"><span data-stu-id="636bf-171">Also, when the template calls **InternalAllocateStreamingResources**, it sets an internal flag, so that it does not call that method again until calling **InternalFreeStreamingResources**.</span></span> <span data-ttu-id="636bf-172">這可確保不會意外地重新配置資源，可能會造成記憶體流失。</span><span class="sxs-lookup"><span data-stu-id="636bf-172">This ensures that resources are not re-allocated accidentally, which could cause memory leaks.</span></span>

<span data-ttu-id="636bf-173">**串流處理方法**</span><span class="sxs-lookup"><span data-stu-id="636bf-173">**Methods for Streaming**</span></span>

<span data-ttu-id="636bf-174">下列方法可用來串流資料：</span><span class="sxs-lookup"><span data-stu-id="636bf-174">The following methods are used to stream data:</span></span>

-   <span data-ttu-id="636bf-175">**GetInputStatus**。</span><span class="sxs-lookup"><span data-stu-id="636bf-175">**GetInputStatus**.</span></span> <span data-ttu-id="636bf-176">這個方法會指出一次是否可以接受輸入。</span><span class="sxs-lookup"><span data-stu-id="636bf-176">This method indicates whether the DMO can accept input at this time.</span></span> <span data-ttu-id="636bf-177">範本會在衍生類別上呼叫 **InternalAcceptingInput** 。</span><span class="sxs-lookup"><span data-stu-id="636bf-177">The template calls **InternalAcceptingInput** on the derived class.</span></span> <span data-ttu-id="636bf-178">如果 SQL-DMO 可以接受輸入，則衍生類別會傳回 \_ [確定]，而範本會將 \_ [ \_ dwFlags] 參數中的 [STATUSF \_ 接受] \_ 資料位設定為 [接受]。</span><span class="sxs-lookup"><span data-stu-id="636bf-178">If the DMO can accept input, the derived class returns S\_OK and the template sets the DMO\_INPUT\_STATUSF\_ACCEPT\_DATA bit in the *dwFlags* parameter.</span></span> <span data-ttu-id="636bf-179">否則，衍生類別會傳回 \_ FALSE，而範本會將 *dwFlags* 設定為零。</span><span class="sxs-lookup"><span data-stu-id="636bf-179">Otherwise, the derived class returns S\_FALSE and the template sets *dwFlags* to zero.</span></span>
-   <span data-ttu-id="636bf-180">**ProcessInput**。</span><span class="sxs-lookup"><span data-stu-id="636bf-180">**ProcessInput**.</span></span> <span data-ttu-id="636bf-181">這個方法會處理輸入緩衝區。</span><span class="sxs-lookup"><span data-stu-id="636bf-181">This method processes an input buffer.</span></span> <span data-ttu-id="636bf-182">此範本會呼叫先前所述的 **AllocateStreamingResources**。</span><span class="sxs-lookup"><span data-stu-id="636bf-182">The template calls **AllocateStreamingResources**, described previously.</span></span> <span data-ttu-id="636bf-183">然後，它會在衍生的類別上呼叫 **InternalAcceptingInput** 。</span><span class="sxs-lookup"><span data-stu-id="636bf-183">Then it calls **InternalAcceptingInput** on the derived class.</span></span> <span data-ttu-id="636bf-184">如果 SQL-DMO 可以接受新的輸入，範本就會呼叫 **InternalProcessInput**。</span><span class="sxs-lookup"><span data-stu-id="636bf-184">If the DMO can accept new input, the template calls **InternalProcessInput**.</span></span>
-   <span data-ttu-id="636bf-185">**ProcessOutput**。</span><span class="sxs-lookup"><span data-stu-id="636bf-185">**ProcessOutput**.</span></span> <span data-ttu-id="636bf-186">這個方法會處理一組輸出緩衝區，每個輸出資料流程都有一個緩衝區。</span><span class="sxs-lookup"><span data-stu-id="636bf-186">This method processes a set of output buffers, one buffer for each output stream.</span></span> <span data-ttu-id="636bf-187">此範本會呼叫 **AllocateStreamingResources** ，然後 **InternalProcessOutput**。</span><span class="sxs-lookup"><span data-stu-id="636bf-187">The template calls **AllocateStreamingResources** and then **InternalProcessOutput**.</span></span>
-   <span data-ttu-id="636bf-188">不 **中斷。**</span><span class="sxs-lookup"><span data-stu-id="636bf-188">**Discontinuity**.</span></span> <span data-ttu-id="636bf-189">這個方法會通知輸入資料流程中的不連續。</span><span class="sxs-lookup"><span data-stu-id="636bf-189">This method signals a discontinuity in an input stream.</span></span> <span data-ttu-id="636bf-190">範本會在衍生類別上呼叫 **InternalAcceptingInput** 。</span><span class="sxs-lookup"><span data-stu-id="636bf-190">The template calls **InternalAcceptingInput** on the derived class.</span></span> <span data-ttu-id="636bf-191">如果該方法傳回 S \_ OK，則範本會在衍生類別上呼叫 **InternalDiscontinuity** 。</span><span class="sxs-lookup"><span data-stu-id="636bf-191">If that method returns S\_OK, the template calls **InternalDiscontinuity** on the derived class.</span></span>
-   <span data-ttu-id="636bf-192">**Flush**：</span><span class="sxs-lookup"><span data-stu-id="636bf-192">**Flush**.</span></span> <span data-ttu-id="636bf-193">這個方法會排清。</span><span class="sxs-lookup"><span data-stu-id="636bf-193">This method flushes the DMO.</span></span> <span data-ttu-id="636bf-194">範本會在衍生類別上呼叫 **InternalFlush** 。</span><span class="sxs-lookup"><span data-stu-id="636bf-194">The template calls **InternalFlush** on the derived class.</span></span> <span data-ttu-id="636bf-195">當您想要處理的任何輸入緩衝區仍保留時，</span><span class="sxs-lookup"><span data-stu-id="636bf-195">The DMO should discard any input buffers that it still holds to be processed.</span></span>

<span data-ttu-id="636bf-196">此範本不會提供 [**IMediaObjectInPlace**](/previous-versions/windows/desktop/api/mediaobj/nn-mediaobj-imediaobjectinplace) 介面的任何直接支援。</span><span class="sxs-lookup"><span data-stu-id="636bf-196">The template does not provide any direct support for the [**IMediaObjectInPlace**](/previous-versions/windows/desktop/api/mediaobj/nn-mediaobj-imediaobjectinplace) interface.</span></span>

<span data-ttu-id="636bf-197">**鎖定的方法**</span><span class="sxs-lookup"><span data-stu-id="636bf-197">**Methods for Locking**</span></span>

<span data-ttu-id="636bf-198">鎖定是用來在多執行緒環境中保護 SQL-DMO 的狀態。</span><span class="sxs-lookup"><span data-stu-id="636bf-198">Locking is used to protect the DMO's state in a multithreaded environment.</span></span> <span data-ttu-id="636bf-199">在 ATL 專案中， [**IMediaObject：： Lock**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-lock) 方法會導致名稱與 ATL **鎖定** 方法發生衝突。</span><span class="sxs-lookup"><span data-stu-id="636bf-199">In an ATL project, the [**IMediaObject::Lock**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-lock) method causes a name conflict with the ATL **Lock** method.</span></span> <span data-ttu-id="636bf-200">若要解決此衝突，此範本會將 **IMediaObject** 方法重新命名為 **DMOLock**。</span><span class="sxs-lookup"><span data-stu-id="636bf-200">To resolve the conflict, the template renames the **IMediaObject** method to **DMOLock**.</span></span> <span data-ttu-id="636bf-201">當您編譯衍生類別時，請先定義修正 \_ 鎖定 \_ 名稱，再將標頭檔包含在前面：</span><span class="sxs-lookup"><span data-stu-id="636bf-201">When you compile the derived class, define FIX\_LOCK\_NAME before including the header file Dmo.h:</span></span>


```C++
#define FIX_LOCK_NAME
#include <dmo.h>
```



<span data-ttu-id="636bf-202">這個指示詞會讓預處理器以 **DMOLock** 取代 **IMediaObject** 介面宣告中的 **鎖定**。</span><span class="sxs-lookup"><span data-stu-id="636bf-202">This directive causes the preprocessor to substitute **DMOLock** for **Lock** in the declaration of the **IMediaObject** interface.</span></span> <span data-ttu-id="636bf-203">應用程式仍然可以使用名稱 **鎖定** 來叫用方法，因為 vtable 順序不會變更。</span><span class="sxs-lookup"><span data-stu-id="636bf-203">Applications can still invoke the method using the name **Lock**, because the vtable order does not change.</span></span> <span data-ttu-id="636bf-204">**DMOLock** 方法會呼叫衍生類別的 **鎖定** 或 **解除鎖定**。</span><span class="sxs-lookup"><span data-stu-id="636bf-204">The **DMOLock** method calls **Lock** or **Unlock** on the derived class.</span></span> <span data-ttu-id="636bf-205">如果您使用 ATL 來執行衍生類別，則這些方法已由 ATL 定義，因此不需要額外的程式碼。</span><span class="sxs-lookup"><span data-stu-id="636bf-205">If you are using ATL to implement the derived class, these methods are already defined by ATL, so no additional code is necessary.</span></span> <span data-ttu-id="636bf-206">如果您不是使用 ATL，則必須在衍生類別中提供 **鎖定** 和 **解除** 鎖定方法。</span><span class="sxs-lookup"><span data-stu-id="636bf-206">If you are not using ATL, you must provide **Lock** and **Unlock** methods in your derived class.</span></span>

<span data-ttu-id="636bf-207">此範本會在每個 **IMediaObject** 方法中自動鎖定。</span><span class="sxs-lookup"><span data-stu-id="636bf-207">The template automatically locks the DMO in each of the **IMediaObject** methods.</span></span> <span data-ttu-id="636bf-208">衍生類別可能需要鎖定 (其所執行之其他公用方法內的 IMediaObjectInPlace，例如，如果支援) 。</span><span class="sxs-lookup"><span data-stu-id="636bf-208">The derived class might need to lock the DMO inside other public methods that it implements (for example, if it supports **IMediaObjectInPlace**).</span></span> <span data-ttu-id="636bf-209">類別樣板也會提供內部 helper 類別 [**IMediaObjectImpl：： LockIt**](imediaobjectimpl-lockit.md)，這適用于鎖定和解除鎖定。</span><span class="sxs-lookup"><span data-stu-id="636bf-209">The class template also provides an internal helper class, [**IMediaObjectImpl::LockIt**](imediaobjectimpl-lockit.md), which is useful for locking and unlocking the DMO.</span></span>

<span data-ttu-id="636bf-210">**總結**</span><span class="sxs-lookup"><span data-stu-id="636bf-210">**Summary**</span></span>

<span data-ttu-id="636bf-211">針對下列 **IMediaObject** 方法，範本會在衍生類別上使用相同的簽章來呼叫對應的方法。</span><span class="sxs-lookup"><span data-stu-id="636bf-211">For the following **IMediaObject** methods, the template calls a corresponding method with the same signature on the derived class.</span></span> <span data-ttu-id="636bf-212">衍生的類別必須執行第二個數據行中顯示的每個方法。</span><span class="sxs-lookup"><span data-stu-id="636bf-212">The derived class must implement each of the methods shown in the second column.</span></span>



| <span data-ttu-id="636bf-213">IMediaObject 方法</span><span class="sxs-lookup"><span data-stu-id="636bf-213">IMediaObject Method</span></span>            | <span data-ttu-id="636bf-214">衍生類別方法</span><span class="sxs-lookup"><span data-stu-id="636bf-214">Derived Class Method</span></span>                   |
|--------------------------------|----------------------------------------|
| <span data-ttu-id="636bf-215">**AllocateStreamingResources**</span><span class="sxs-lookup"><span data-stu-id="636bf-215">**AllocateStreamingResources**</span></span> | <span data-ttu-id="636bf-216">**InternalAllocateStreamingResources**</span><span class="sxs-lookup"><span data-stu-id="636bf-216">**InternalAllocateStreamingResources**</span></span> |
| <span data-ttu-id="636bf-217">**間斷**</span><span class="sxs-lookup"><span data-stu-id="636bf-217">**Discontinuity**</span></span>              | <span data-ttu-id="636bf-218">**InternalDiscontinuity**</span><span class="sxs-lookup"><span data-stu-id="636bf-218">**InternalDiscontinuity**</span></span>              |
| <span data-ttu-id="636bf-219">**清除**</span><span class="sxs-lookup"><span data-stu-id="636bf-219">**Flush**</span></span>                      | <span data-ttu-id="636bf-220">**InternalFlush**</span><span class="sxs-lookup"><span data-stu-id="636bf-220">**InternalFlush**</span></span>                      |
| <span data-ttu-id="636bf-221">**FreeStreamingResources**</span><span class="sxs-lookup"><span data-stu-id="636bf-221">**FreeStreamingResources**</span></span>     | <span data-ttu-id="636bf-222">**InternalFreeStreamingResources**</span><span class="sxs-lookup"><span data-stu-id="636bf-222">**InternalFreeStreamingResources**</span></span>     |
| <span data-ttu-id="636bf-223">**GetInputMaxLatency**</span><span class="sxs-lookup"><span data-stu-id="636bf-223">**GetInputMaxLatency**</span></span>         | <span data-ttu-id="636bf-224">**InternalGetInputMaxLatency**</span><span class="sxs-lookup"><span data-stu-id="636bf-224">**InternalGetInputMaxLatency**</span></span>         |
| <span data-ttu-id="636bf-225">**GetInputSizeInfo**</span><span class="sxs-lookup"><span data-stu-id="636bf-225">**GetInputSizeInfo**</span></span>           | <span data-ttu-id="636bf-226">**InternalGetInputSizeInfo**</span><span class="sxs-lookup"><span data-stu-id="636bf-226">**InternalGetInputSizeInfo**</span></span>           |
| <span data-ttu-id="636bf-227">**GetInputStreamInfo**</span><span class="sxs-lookup"><span data-stu-id="636bf-227">**GetInputStreamInfo**</span></span>         | <span data-ttu-id="636bf-228">**InternalGetInputStreamInfo**</span><span class="sxs-lookup"><span data-stu-id="636bf-228">**InternalGetInputStreamInfo**</span></span>         |
| <span data-ttu-id="636bf-229">**GetInputType**</span><span class="sxs-lookup"><span data-stu-id="636bf-229">**GetInputType**</span></span>               | <span data-ttu-id="636bf-230">**InternalGetInputType**</span><span class="sxs-lookup"><span data-stu-id="636bf-230">**InternalGetInputType**</span></span>               |
| <span data-ttu-id="636bf-231">**GetOutputSizeInfo**</span><span class="sxs-lookup"><span data-stu-id="636bf-231">**GetOutputSizeInfo**</span></span>          | <span data-ttu-id="636bf-232">**InternalGetOutputSizeInfo**</span><span class="sxs-lookup"><span data-stu-id="636bf-232">**InternalGetOutputSizeInfo**</span></span>          |
| <span data-ttu-id="636bf-233">**GetOutputStreamInfo**</span><span class="sxs-lookup"><span data-stu-id="636bf-233">**GetOutputStreamInfo**</span></span>        | <span data-ttu-id="636bf-234">**InternalGetOutputStreamInfo**</span><span class="sxs-lookup"><span data-stu-id="636bf-234">**InternalGetOutputStreamInfo**</span></span>        |
| <span data-ttu-id="636bf-235">**GetOutputType**</span><span class="sxs-lookup"><span data-stu-id="636bf-235">**GetOutputType**</span></span>              | <span data-ttu-id="636bf-236">**InternalGetOutputType**</span><span class="sxs-lookup"><span data-stu-id="636bf-236">**InternalGetOutputType**</span></span>              |
| <span data-ttu-id="636bf-237">**ProcessInput**</span><span class="sxs-lookup"><span data-stu-id="636bf-237">**ProcessInput**</span></span>               | <span data-ttu-id="636bf-238">**InternalProcessInput**</span><span class="sxs-lookup"><span data-stu-id="636bf-238">**InternalProcessInput**</span></span>               |
| <span data-ttu-id="636bf-239">**ProcessOutput**</span><span class="sxs-lookup"><span data-stu-id="636bf-239">**ProcessOutput**</span></span>              | <span data-ttu-id="636bf-240">**InternalProcessOutput**</span><span class="sxs-lookup"><span data-stu-id="636bf-240">**InternalProcessOutput**</span></span>              |
| <span data-ttu-id="636bf-241">**SetInputMaxLatency**</span><span class="sxs-lookup"><span data-stu-id="636bf-241">**SetInputMaxLatency**</span></span>         | <span data-ttu-id="636bf-242">**InternalSetInputMaxLatency**</span><span class="sxs-lookup"><span data-stu-id="636bf-242">**InternalSetInputMaxLatency**</span></span>         |



 

<span data-ttu-id="636bf-243">針對其餘的 **IMediaObject** 方法，範本方法與衍生類別方法之間不會有一對一的對應關係。</span><span class="sxs-lookup"><span data-stu-id="636bf-243">For the remaining **IMediaObject** methods, there is not a one-to-one correspondence between template methods and derived-class methods.</span></span> <span data-ttu-id="636bf-244">下表摘要說明範本完全執行的方法，以及在衍生類別上呼叫其他方法的方法。</span><span class="sxs-lookup"><span data-stu-id="636bf-244">The following table summarizes which methods are fully implemented by the template, and which methods call other methods on the derived class.</span></span>



| <span data-ttu-id="636bf-245">IMediaObject 方法</span><span class="sxs-lookup"><span data-stu-id="636bf-245">IMediaObject Method</span></span>                   | <span data-ttu-id="636bf-246">衍生類別方法</span><span class="sxs-lookup"><span data-stu-id="636bf-246">Derived Class Method</span></span>                                                             |
|---------------------------------------|----------------------------------------------------------------------------------|
| <span data-ttu-id="636bf-247">**GetInputCurrentType**</span><span class="sxs-lookup"><span data-stu-id="636bf-247">**GetInputCurrentType**</span></span>               | <span data-ttu-id="636bf-248">完全實作為</span><span class="sxs-lookup"><span data-stu-id="636bf-248">Fully implemented</span></span>                                                                |
| <span data-ttu-id="636bf-249">**GetOutputCurrentType**</span><span class="sxs-lookup"><span data-stu-id="636bf-249">**GetOutputCurrentType**</span></span>              | <span data-ttu-id="636bf-250">完全實作為</span><span class="sxs-lookup"><span data-stu-id="636bf-250">Fully implemented</span></span>                                                                |
| <span data-ttu-id="636bf-251">**GetStreamCount**</span><span class="sxs-lookup"><span data-stu-id="636bf-251">**GetStreamCount**</span></span>                    | <span data-ttu-id="636bf-252">完全實作為</span><span class="sxs-lookup"><span data-stu-id="636bf-252">Fully implemented</span></span>                                                                |
| <span data-ttu-id="636bf-253">**GetInputStatus**</span><span class="sxs-lookup"><span data-stu-id="636bf-253">**GetInputStatus**</span></span>                    | <span data-ttu-id="636bf-254">[**InternalAcceptingInput**](/previous-versions/ms809095(v=msdn.10))</span><span class="sxs-lookup"><span data-stu-id="636bf-254">[**InternalAcceptingInput**](/previous-versions/ms809095(v=msdn.10))</span></span>        |
| <span data-ttu-id="636bf-255">**鎖定** (實作為 **DMOLock**) </span><span class="sxs-lookup"><span data-stu-id="636bf-255">**Lock** (implemented as **DMOLock**)</span></span> | <span data-ttu-id="636bf-256">[**鎖定**](/previous-versions/ms809100(v=msdn.10))， [**解除** 鎖定](/previous-versions/ms809101(v=msdn.10))</span><span class="sxs-lookup"><span data-stu-id="636bf-256">[**Lock**](/previous-versions/ms809100(v=msdn.10)), [**Unlock**](/previous-versions/ms809101(v=msdn.10))</span></span> |
| <span data-ttu-id="636bf-257">**SetInputType**</span><span class="sxs-lookup"><span data-stu-id="636bf-257">**SetInputType**</span></span>                      | <span data-ttu-id="636bf-258">[**InternalCheckInputType**](/previous-versions/ms809096(v=msdn.10))</span><span class="sxs-lookup"><span data-stu-id="636bf-258">[**InternalCheckInputType**](/previous-versions/ms809096(v=msdn.10))</span></span>        |
| <span data-ttu-id="636bf-259">**SetOutputType**</span><span class="sxs-lookup"><span data-stu-id="636bf-259">**SetOutputType**</span></span>                     | <span data-ttu-id="636bf-260">[**InternalCheckOutputType**](/previous-versions/ms809098(v=msdn.10))</span><span class="sxs-lookup"><span data-stu-id="636bf-260">[**InternalCheckOutputType**](/previous-versions/ms809098(v=msdn.10))</span></span>      |



 

## <a name="related-topics"></a><span data-ttu-id="636bf-261">相關主題</span><span class="sxs-lookup"><span data-stu-id="636bf-261">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="636bf-262">**IMediaObjectImpl 類別範本**</span><span class="sxs-lookup"><span data-stu-id="636bf-262">**IMediaObjectImpl Class Template**</span></span>](imediaobjectimpl-class-template.md)
</dt> <dt>

[<span data-ttu-id="636bf-263">撰寫 SQL-DMO</span><span class="sxs-lookup"><span data-stu-id="636bf-263">Writing a DMO</span></span>](writing-a-dmo.md)
</dt> </dl>

 

 
