---
description: SQL-DMO 媒體類型
ms.assetid: 40958e12-09c7-4ce5-aa4d-5ed8b1f40aa3
title: SQL-DMO 媒體類型
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1997abb1cc3c8eb10301778982ef7a46690855ed
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/03/2021
ms.locfileid: "104514361"
---
# <a name="dmo-media-types"></a><span data-ttu-id="e5ae2-103">SQL-DMO 媒體類型</span><span class="sxs-lookup"><span data-stu-id="e5ae2-103">DMO Media Types</span></span>

<span data-ttu-id="e5ae2-104">媒體類型描述與媒體資料資料流程相關聯的格式。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-104">A media type describes the format associated with a stream of media data.</span></span> <span data-ttu-id="e5ae2-105">本文描述 DMOs 如何處理媒體類型。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-105">This article describes how DMOs handle media types.</span></span> <span data-ttu-id="e5ae2-106">它主要適用于撰寫自己的自訂 DMOs 的開發人員。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-106">It is primarily intended for developers who are writing their own custom DMOs.</span></span>

<span data-ttu-id="e5ae2-107">媒體類型是使用 [**Sql-dmo \_ 媒體 \_ 類型**](/previous-versions/windows/desktop/api/mediaobj/ns-mediaobj-dmo_media_type) 結構來定義。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-107">Media types are defined using the [**DMO\_MEDIA\_TYPE**](/previous-versions/windows/desktop/api/mediaobj/ns-mediaobj-dmo_media_type) structure.</span></span> <span data-ttu-id="e5ae2-108">此結構包含下列資訊：</span><span class="sxs-lookup"><span data-stu-id="e5ae2-108">This structure includes the following information:</span></span>

-   <span data-ttu-id="e5ae2-109">*主要類型* 是定義廣大類別的全域唯一識別碼 (GUID) ，例如音訊或影片。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-109">The *major type* is a globally unique identifier (GUID) that defines a broad category, such as audio or video.</span></span>
-   <span data-ttu-id="e5ae2-110">*子類型* 是定義更具體的型別層面的 GUID。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-110">The *subtype* is a GUID that defines more specific aspects of the type.</span></span> <span data-ttu-id="e5ae2-111">例如，在影片中，子類型包含16位 RGB、24位 RGB、UYVY、DV 編碼的影片等等。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-111">For example, within video, the subtypes include 16-bit RGB, 24-bit RGB, UYVY, DV-encoded video, and so forth.</span></span>
-   <span data-ttu-id="e5ae2-112">*格式區塊* 是完整指定格式的輔助結構。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-112">The *format block* is a secondary structure that fully specifies the format.</span></span> <span data-ttu-id="e5ae2-113">格式區塊的版面配置取決於資料的類型。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-113">The layout of the format block depends on the type of data.</span></span> <span data-ttu-id="e5ae2-114">例如，PCM 音訊會使用 **WAVEFORMATEX** 結構。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-114">For example, PCM audio uses the **WAVEFORMATEX** structure.</span></span> <span data-ttu-id="e5ae2-115">影片使用各種其他結構，包括 **VIDEOINFOHEADER** 和 **VIDEOINFOHEADER2**。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-115">Video uses various other structures, including **VIDEOINFOHEADER** and **VIDEOINFOHEADER2**.</span></span> <span data-ttu-id="e5ae2-116">格式區塊的版面配置是以格式類型 GUID 來識別。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-116">The layout of the format block is identified by a format type GUID.</span></span> <span data-ttu-id="e5ae2-117">例如，FORMAT \_ WaveFormatEx 會指定 **WaveFormatEx** 結構。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-117">For example, FORMAT\_WaveFormatEx specifies a **WAVEFORMATEX** structure.</span></span>

<span data-ttu-id="e5ae2-118">第一次建立時，資料流程沒有媒體類型。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-118">When a DMO is first created, the streams do not have a media type.</span></span> <span data-ttu-id="e5ae2-119">用戶端必須先設定每個資料流程的媒體類型，然後才能處理任何資料。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-119">Before the DMO can process any data, the client must set a media type for each stream.</span></span> <span data-ttu-id="e5ae2-120">從用戶端的觀點來看， [設定媒體類型](setting-media-types-on-a-dmo.md)時，會說明此程式。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-120">This process is described from the client's perspective in [Setting Media Types on a DMO](setting-media-types-on-a-dmo.md).</span></span>

<span data-ttu-id="e5ae2-121">**登錄中的媒體類型**</span><span class="sxs-lookup"><span data-stu-id="e5ae2-121">**Media Types in the Registry**</span></span>

<span data-ttu-id="e5ae2-122">SQL-DMO 可以藉由呼叫 [**DMORegister**](/previous-versions/windows/desktop/api/Dmoreg/nf-dmoreg-dmoregister) 函式，將它支援的媒體類型清單新增至登錄。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-122">A DMO can add a list of media types that it supports to the registry, by calling the [**DMORegister**](/previous-versions/windows/desktop/api/Dmoreg/nf-dmoreg-dmoregister) function.</span></span> <span data-ttu-id="e5ae2-123">應用程式可以使用這項資訊來搜尋符合特定格式的 DMOs。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-123">An application can use this information to search for DMOs that match a particular format.</span></span> <span data-ttu-id="e5ae2-124">登錄中的資訊並不是完整的。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-124">The information in the registry is not meant to be comprehensive.</span></span> <span data-ttu-id="e5ae2-125">一般情況下，您只會包含 SQL-DMO 所支援的主要類型。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-125">Typically, you would include only the main types that the DMO supports.</span></span> <span data-ttu-id="e5ae2-126">登錄專案的輸入和輸出類型都有不同的金鑰，但無法區分個別的資料流程。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-126">The registry entry has separate keys for input and output types, but does not distinguish among individual streams.</span></span>

<span data-ttu-id="e5ae2-127">**DMORegister** 函式會使用 [**sql-dmo \_ 部分 \_**](/previous-versions/windows/desktop/api/Dmoreg/ns-dmoreg-dmo_partial_mediatype)媒體型結構來描述媒體類型。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-127">The **DMORegister** function uses the [**DMO\_PARTIAL\_MEDIATYPE**](/previous-versions/windows/desktop/api/Dmoreg/ns-dmoreg-dmo_partial_mediatype) structure to describe media types.</span></span> <span data-ttu-id="e5ae2-128">此結構包含在 **Sql-dmo \_ 媒體 \_ 類型** 結構中找到的資訊子集，也就是主要類型和子類型。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-128">This structure contains a subset of the information found in the **DMO\_MEDIA\_TYPE** structure—namely the major type and the subtype.</span></span> <span data-ttu-id="e5ae2-129">它不包含格式區塊，因為格式區塊通常包含太細微而無法包含在登錄中的資訊，例如影片影像的高度和寬度。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-129">It does not include a format block, because the format block typically contains information that is too granular to include in the registry, such as the height and width of a video image.</span></span>

<span data-ttu-id="e5ae2-130">**慣用的媒體類型**</span><span class="sxs-lookup"><span data-stu-id="e5ae2-130">**Preferred Media Types**</span></span>

<span data-ttu-id="e5ae2-131">應用程式建立了一來，它就可以查詢它所支援的媒體類型。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-131">After the application has created a DMO, it can query the DMO for the media types it supports.</span></span> <span data-ttu-id="e5ae2-132">針對每個資料流程，每個資料流程會建立一份媒體類型清單 (可能是空的) ，並依喜好設定排列順序。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-132">For each stream, the DMO creates a list of media types (possibly empty), ranked in order of preference.</span></span> <span data-ttu-id="e5ae2-133">[**IMediaObject：： GetInputType**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getinputtype)和 [**IMediaObject：： GetOutputType**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getoutputtype)方法會列舉慣用的類型。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-133">The [**IMediaObject::GetInputType**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getinputtype) and [**IMediaObject::GetOutputType**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getoutputtype) methods enumerate the preferred types.</span></span> <span data-ttu-id="e5ae2-134">當應用程式在其他資料流程上設定媒體類型時，資料流程的慣用類型可能會動態變更。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-134">A stream's preferred types can change dynamically when the application sets media types on other streams.</span></span> <span data-ttu-id="e5ae2-135">例如，慣用的輸出類型清單可能會在設定輸入類型之後變更，反之亦然。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-135">For example, the list of preferred output types might change after the input type is set, or vice versa.</span></span> <span data-ttu-id="e5ae2-136">但是，不需要以動態方式更新其慣用類型。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-136">However, the DMO is not required to update its preferred types dynamically.</span></span> <span data-ttu-id="e5ae2-137">應用程式無法假設它收到的每個類型都是有效的。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-137">The application cannot assume that every type it receives is valid.</span></span> <span data-ttu-id="e5ae2-138">基於這個理由， [**IMediaObject：： SetInputType**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-setinputtype) 和 [**IMediaObject：： SetOutputType**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-setoutputtype) 方法支援用於測試特定型別的旗標。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-138">For this reason, the [**IMediaObject::SetInputType**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-setinputtype) and [**IMediaObject::SetOutputType**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-setoutputtype) methods support a flag for testing a specific type.</span></span>

<span data-ttu-id="e5ae2-139">**GetInputType** 和 **GetOutputType** 方法都會傳回 **sql-dmo \_ 媒體 \_ 類型** 結構。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-139">The **GetInputType** and **GetOutputType** methods both return a **DMO\_MEDIA\_TYPE** structure.</span></span> <span data-ttu-id="e5ae2-140">您可以將此結構中的部分資訊留白，以表示類型的範圍。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-140">The DMO can leave some of the information in this structure blank, to indicate a range of types.</span></span> <span data-ttu-id="e5ae2-141">主要類型或子類型可以是 GUID \_ Null，且格式區塊可以是空的 (零位元組) 。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-141">The major type or subtype can be GUID\_NULL, and the format block can be empty (zero bytes).</span></span> <span data-ttu-id="e5ae2-142">如果格式區塊是空的，格式類型必須是 GUID \_ Null。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-142">If the format block is empty, the format type must be GUID\_NULL.</span></span>

<span data-ttu-id="e5ae2-143">應用程式設定所有的輸入型別之後，每個輸出資料流程通常應該會傳回至少一個完整型別。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-143">After the application sets all of a DMO's input types, the DMO should generally return at least one complete type for each output stream.</span></span> <span data-ttu-id="e5ae2-144">完整的輸出型別可加速測試，應用程式可以使用它做為合理的預設值。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-144">A complete output type facilitates testing, and applications can use it as a reasonable default.</span></span> <span data-ttu-id="e5ae2-145">SQL-DMO 測試應用程式依賴此行為。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-145">The DMO test application relies on this behavior.</span></span> <span data-ttu-id="e5ae2-146"> (請參閱 [使用 DMOTest 應用程式](using-the-dmotest-application.md)。 ) </span><span class="sxs-lookup"><span data-stu-id="e5ae2-146">(See [Using the DMOTest Application](using-the-dmotest-application.md).)</span></span>

<span data-ttu-id="e5ae2-147">**設定媒體類型**</span><span class="sxs-lookup"><span data-stu-id="e5ae2-147">**Setting the Media Types**</span></span>

<span data-ttu-id="e5ae2-148">應用程式會使用 **SetInputType** 和 **SetOutputType** 方法來測試、設定或清除指定之資料流程上的類型。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-148">Applications use the **SetInputType** and **SetOutputType** methods to test, set, or clear types on a specified stream.</span></span> <span data-ttu-id="e5ae2-149">應用程式必須完全指定類型。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-149">The application must fully specify the type.</span></span> <span data-ttu-id="e5ae2-150">SQL-DMO 會驗證它是否可以接受建議的型別。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-150">The DMO verifies whether it can accept the proposed type.</span></span> <span data-ttu-id="e5ae2-151">答案可能取決於已在其他資料流程上設定的類型。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-151">The answer may depend on which types have been set on other streams.</span></span> <span data-ttu-id="e5ae2-152">SQL-DMO \_ SET \_ TYPEF \_ CLEAR 旗標會清除資料流程的類型，因此應用程式可以「返回」並嘗試另一個組合。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-152">The DMO\_SET\_TYPEF\_CLEAR flag clears a stream's type, so the application can "back out" and try another combination.</span></span>

<span data-ttu-id="e5ae2-153">**示範案例**</span><span class="sxs-lookup"><span data-stu-id="e5ae2-153">**Example Scenarios**</span></span>

<span data-ttu-id="e5ae2-154">下列範例說明一些一般案例，以說明在先前章節中所做的點。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-154">The following examples describe some typical scenarios, to illustrate the points made in the previous sections.</span></span>

-   <span data-ttu-id="e5ae2-155">**影片解碼器。**</span><span class="sxs-lookup"><span data-stu-id="e5ae2-155">**Video Decoders.**</span></span> <span data-ttu-id="e5ae2-156">在典型的影片解碼中，輸入類型部分會決定輸出類型。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-156">In a typical video decoder, the input type partly determines the output type.</span></span> <span data-ttu-id="e5ae2-157">例如，這兩個數據流通常都必須有相同的畫面播放速率和影像維度。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-157">For example, usually both streams must have the same frame rate and image dimensions.</span></span> <span data-ttu-id="e5ae2-158">其中一個選項是在設定輸入類型之前，不會定義任何慣用的輸出類型。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-158">One option is not to define any preferred output types until the input type is set.</span></span> <span data-ttu-id="e5ae2-159">另一個選項是列舉不完整的類型集合，並省略格式區塊。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-159">Another option is to enumerate a set of incomplete types, omitting the format block.</span></span> <span data-ttu-id="e5ae2-160">您可以使用子類型來指出支援的未壓縮類型，例如16位 RGB、24位 RGB 等等。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-160">Use the subtype to indicate the supported uncompressed types, such as 16-bit RGB, 24-bit RGB, and so forth.</span></span> <span data-ttu-id="e5ae2-161">此外，影片解碼器通常不支援在輸入類型之前設定輸出類型。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-161">Also, video decoders generally do not support setting the output type before the input type.</span></span> <span data-ttu-id="e5ae2-162">常見的案例是從已知的輸入格式解碼，因此這項限制是合理的。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-162">The usual scenario is to decode from a known input format, so this limitation is reasonable.</span></span>
-   <span data-ttu-id="e5ae2-163">**音訊解碼器。**</span><span class="sxs-lookup"><span data-stu-id="e5ae2-163">**Audio Decoders.**</span></span> <span data-ttu-id="e5ae2-164">音訊解碼器可能會支援一組有限且固定的輸出格式。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-164">An audio decoder might support a limited, fixed set of output formats.</span></span> <span data-ttu-id="e5ae2-165">在這種情況下，它可能會在已知輸入格式之前，建立慣用輸出格式的清單。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-165">In that case, it may be able to create a list of preferred output formats before the input format is known.</span></span>
-   <span data-ttu-id="e5ae2-166">**壓縮機。**</span><span class="sxs-lookup"><span data-stu-id="e5ae2-166">**Compressors.**</span></span> <span data-ttu-id="e5ae2-167">在大多數情況下，影片壓縮程式無法完全指定其慣用的輸出格式，直到應用程式設定輸入格式為止，反之亦然。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-167">In most cases, a video compressor cannot fully specify its preferred output formats until the application sets the input format, and vice versa.</span></span> <span data-ttu-id="e5ae2-168">取而代之的是，，則應該傳回不完整的類型，而不含格式區塊。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-168">Instead, the DMO should return an incomplete type with no format block.</span></span> <span data-ttu-id="e5ae2-169">針對音訊和影片壓縮，應用程式通常需要設定各種輸出參數，例如位元速率。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-169">For both audio and video compression, the application usually needs to set various output parameters, such as the bit rate.</span></span> <span data-ttu-id="e5ae2-170">不過，在設定輸入類型之後，基於上述原因，壓縮程式應該會傳回至少一個完整輸出類型。</span><span class="sxs-lookup"><span data-stu-id="e5ae2-170">However, after the input type is set, the compressor should return at least one complete output type, for the reasons mentioned previously.</span></span>

## <a name="related-topics"></a><span data-ttu-id="e5ae2-171">相關主題</span><span class="sxs-lookup"><span data-stu-id="e5ae2-171">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="e5ae2-172">撰寫 SQL-DMO</span><span class="sxs-lookup"><span data-stu-id="e5ae2-172">Writing a DMO</span></span>](writing-a-dmo.md)
</dt> </dl>

 

 



