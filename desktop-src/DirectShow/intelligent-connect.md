---
description: 智慧型連接
ms.assetid: 938ba1b0-822e-4871-8786-b7eeee243867
title: 智慧型連接
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 12aead305867ccec1f1f1f0cbd76c652ba3ec412
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/06/2021
ms.locfileid: "104467837"
---
# <a name="intelligent-connect"></a><span data-ttu-id="3f6ad-103">智慧型連接</span><span class="sxs-lookup"><span data-stu-id="3f6ad-103">Intelligent Connect</span></span>

<span data-ttu-id="3f6ad-104">智慧型 Connect 是篩選圖形管理員用來建立篩選圖形的機制。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-104">Intelligent Connect is the mechanism the Filter Graph Manager uses to build filter graphs.</span></span> <span data-ttu-id="3f6ad-105">它包含數個相關的演算法，這些演算法會選取篩選並將它們加入至篩選圖形。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-105">It consists of several related algorithms that select filters and add them to the filter graph.</span></span>

<span data-ttu-id="3f6ad-106">如果您在建立特定的篩選圖形時遇到問題，或是您要撰寫自己的篩選準則，而且想要讓它可供自動圖形建立使用，請閱讀本主題。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-106">Read this topic if you are having trouble building a certain filter graph and want to troubleshoot the problem, or if you are writing your own filter and want to make it available for automatic graph building.</span></span>

<span data-ttu-id="3f6ad-107">智慧型連接牽涉到下列 [**IGraphBuilder**](/windows/desktop/api/Strmif/nn-strmif-igraphbuilder) 方法：</span><span class="sxs-lookup"><span data-stu-id="3f6ad-107">Intelligent Connect involves the following [**IGraphBuilder**](/windows/desktop/api/Strmif/nn-strmif-igraphbuilder) methods:</span></span>

-   [<span data-ttu-id="3f6ad-108">**IGraphBuilder::AddSourceFilter**</span><span class="sxs-lookup"><span data-stu-id="3f6ad-108">**IGraphBuilder::AddSourceFilter**</span></span>](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-addsourcefilter)
-   [<span data-ttu-id="3f6ad-109">**IGraphBuilder：： Render**</span><span class="sxs-lookup"><span data-stu-id="3f6ad-109">**IGraphBuilder::Render**</span></span>](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-render)
-   [<span data-ttu-id="3f6ad-110">**IGraphBuilder：： RenderFile**</span><span class="sxs-lookup"><span data-stu-id="3f6ad-110">**IGraphBuilder::RenderFile**</span></span>](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-renderfile)
-   [<span data-ttu-id="3f6ad-111">**IGraphBuilder：： Connect**</span><span class="sxs-lookup"><span data-stu-id="3f6ad-111">**IGraphBuilder::Connect**</span></span>](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-connect)

### <a name="igraphbuilderaddsourcefilter"></a><span data-ttu-id="3f6ad-112">IGraphBuilder::AddSourceFilter</span><span class="sxs-lookup"><span data-stu-id="3f6ad-112">IGraphBuilder::AddSourceFilter</span></span>

<span data-ttu-id="3f6ad-113">[**IGraphBuilder：： AddSourceFilter**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-addsourcefilter)方法會新增可轉譯指定檔案的來源篩選。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-113">The [**IGraphBuilder::AddSourceFilter**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-addsourcefilter) method adds a source filter that can render a specified file.</span></span> <span data-ttu-id="3f6ad-114">首先，它會在登錄中尋找並比對通訊協定 (例如 `https://`) 、副檔名或預先決定的 *檢查位元組* 集，這是檔案中符合特定模式之特定位移的位元組。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-114">First it looks in the registry and matches against the protocol (such as `https://`), the file name extension, or a set of predetermined *check bytes*, which are bytes at particular offsets in the file that match certain patterns.</span></span> <span data-ttu-id="3f6ad-115">如需詳細資訊，請參閱 [註冊自訂檔案類型](registering-a-custom-file-type.md)。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-115">For details, see [Registering a Custom File Type](registering-a-custom-file-type.md).</span></span> <span data-ttu-id="3f6ad-116">假設方法找出適當的來源篩選器，則會建立該篩選的實例、將它新增至圖形，然後以檔案名呼叫篩選器的 [**IFileSourceFilter：： Load**](/windows/desktop/api/Strmif/nf-strmif-ifilesourcefilter-load) 方法。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-116">Assuming that the method locates an appropriate source filter, it then creates an instance of that filter, adds it to the graph, and calls the filter's [**IFileSourceFilter::Load**](/windows/desktop/api/Strmif/nf-strmif-ifilesourcefilter-load) method with the file name.</span></span>

### <a name="igraphbuilderrender"></a><span data-ttu-id="3f6ad-117">IGraphBuilder：： Render</span><span class="sxs-lookup"><span data-stu-id="3f6ad-117">IGraphBuilder::Render</span></span>

<span data-ttu-id="3f6ad-118">[**IGraphBuilder：： Render**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-render)方法會建立圖形的子區段。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-118">The [**IGraphBuilder::Render**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-render) method builds a subsection of a graph.</span></span> <span data-ttu-id="3f6ad-119">它會從未連接的輸出圖釘開始並在下游運作，視需要新增篩選。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-119">It starts from an unconnected output pin and works downstream, adding new filters as needed.</span></span> <span data-ttu-id="3f6ad-120">起始篩選必須已經在圖形中。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-120">The starting filter must already be in the graph.</span></span> <span data-ttu-id="3f6ad-121">在每個步驟中， **轉譯方法會** 搜尋可連接到先前篩選準則的篩選準則。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-121">At each step, the **Render** method searches for a filter that can connect to the previous filter.</span></span> <span data-ttu-id="3f6ad-122">如果連接的篩選器有多個輸出圖釘，則資料流程可以分支。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-122">The stream can branch if a connecting filter has multiple output pins.</span></span> <span data-ttu-id="3f6ad-123">當每個資料流程都有轉譯器時，就會停止搜尋。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-123">The search stops when every stream has a renderer.</span></span> <span data-ttu-id="3f6ad-124">如果轉譯 **方法停滯，則可能** 會進行備份，並使用一組不同的篩選器再試一次。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-124">If the **Render** method gets stuck, it might back up and try again, using a different set of filters.</span></span>

<span data-ttu-id="3f6ad-125">若要連接每個輸出圖釘， [**轉譯方法會**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-render) 執行下列動作：</span><span class="sxs-lookup"><span data-stu-id="3f6ad-125">To connect each output pin, the [**Render**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-render) method does the following:</span></span>

1.  <span data-ttu-id="3f6ad-126">如果 pin 支援 [**IStreamBuilder**](/windows/desktop/api/Strmif/nn-strmif-istreambuilder) 介面，則篩選圖形管理員會將整個進程委派給釘選的 [**IStreamBuilder：： Render**](/windows/desktop/api/Strmif/nf-strmif-istreambuilder-render) 方法。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-126">If the pin supports the [**IStreamBuilder**](/windows/desktop/api/Strmif/nn-strmif-istreambuilder) interface, the Filter Graph Manager delegates the entire process to the pin's [**IStreamBuilder::Render**](/windows/desktop/api/Strmif/nf-strmif-istreambuilder-render) method.</span></span> <span data-ttu-id="3f6ad-127">藉由公開此介面，釘選會負責將圖形的其餘部分分配至轉譯器。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-127">By exposing this interface, the pin assumes responsibility for building the remainder of the graph, down to the renderer.</span></span> <span data-ttu-id="3f6ad-128">不過，很少 pin 支援此介面。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-128">However, very few pins support this interface.</span></span>
2.  <span data-ttu-id="3f6ad-129">篩選圖形管理員會嘗試使用在記憶體中快取的篩選（如果有的話）。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-129">The Filter Graph Manager tries to use filters that are cached in memory, if any.</span></span> <span data-ttu-id="3f6ad-130">在整個智慧型 Connect 程式中，篩選圖形管理員可能會快取程式中先前步驟的篩選。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-130">Throughout the Intelligent Connect process, the Filter Graph Manager may cache filters from earlier steps in the process.</span></span> <span data-ttu-id="3f6ad-131"> (也請參閱 [動態圖形建築物](dynamic-graph-building.md)。 ) </span><span class="sxs-lookup"><span data-stu-id="3f6ad-131">(Also, see [Dynamic Graph Building](dynamic-graph-building.md).)</span></span>
3.  <span data-ttu-id="3f6ad-132">如果篩選圖形包含任何具有未連線輸入圖釘的篩選，則篩選圖形管理員會在接下來嘗試這些篩選器。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-132">If the filter graph contains any filters with unconnected input pins, the Filter Graph Manager tries them next.</span></span> <span data-ttu-id="3f6ad-133">您可以藉由 [**在呼叫**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-render)轉譯之前將該篩選新增至圖形，來強制轉譯方法嘗試特定 **篩選。**</span><span class="sxs-lookup"><span data-stu-id="3f6ad-133">You can force the [**Render**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-render) method to try a particular filter by adding that filter to the graph before calling **Render**.</span></span>
4.  <span data-ttu-id="3f6ad-134">從 Windows 7 開始，DirectShow 有特定媒體子類型的慣用篩選清單。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-134">Starting in Windows 7, DirectShow has a list of preferred filters for certain media subtypes.</span></span> <span data-ttu-id="3f6ad-135">如果要轉譯的媒體類型有慣用的篩選，則篩選圖形管理員會嘗試下一個篩選準則。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-135">If there is a preferred filter for the media type that is being rendered, the Filter Graph Manager tries that filter next.</span></span> <span data-ttu-id="3f6ad-136">應用程式可以使用 [**IAMPluginControl**](/windows/desktop/api/Strmif/nn-strmif-iamplugincontrol) 介面來修改慣用篩選器的清單。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-136">An application can modify the list of preferred filters by using the [**IAMPluginControl**](/windows/desktop/api/Strmif/nn-strmif-iamplugincontrol) interface.</span></span> <span data-ttu-id="3f6ad-137">對清單所做的變更會影響應用程式目前的進程，並且會在進程結束之後捨棄。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-137">Changes to the list affect the application's current process, and are discarded after the process ends.</span></span>
5.  <span data-ttu-id="3f6ad-138">最後，如果找不到適合的篩選，則篩選圖形管理員會使用 [**IFilterMapper2：： EnumMatchingFilters**](/windows/desktop/api/Strmif/nf-strmif-ifiltermapper2-enummatchingfilters) 方法來搜尋登錄。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-138">Finally, if no suitable filter has been found, the Filter Graph Manager searches the registry, using the [**IFilterMapper2::EnumMatchingFilters**](/windows/desktop/api/Strmif/nf-strmif-ifiltermapper2-enummatchingfilters) method.</span></span> <span data-ttu-id="3f6ad-139">它會嘗試比對輸出 pin 的慣用媒體類型與登錄中列出的媒體類型。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-139">It tries to match the output pin's preferred media types against media types listed in the registry.</span></span>

    <span data-ttu-id="3f6ad-140">每個篩選器都是 *以一個好用的值* 來註冊，指出篩選的偏好程度（相對於其他篩選）。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-140">Each filter is registered with a *merit*, a numerical value that indicates how preferable the filter is, relative to other filters.</span></span> <span data-ttu-id="3f6ad-141">[**EnumMatchingFilters**](/windows/desktop/api/Strmif/nf-strmif-ifiltermapper2-enummatchingfilters)方法會依下階的順序傳回篩選準則，而最小的優點是 **\_ \_ 不 \_ 使用**+ 1。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-141">The [**EnumMatchingFilters**](/windows/desktop/api/Strmif/nf-strmif-ifiltermapper2-enummatchingfilters) method returns filters in order of merit, with a minimum merit of **MERIT\_DO\_NOT\_USE** + 1.</span></span> <span data-ttu-id="3f6ad-142">它會略過具有 **\_ \_ 未 \_ 使用** 或較少之業績的篩選。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-142">It ignores filters with a merit of **MERIT\_DO\_NOT\_USE** or less.</span></span> <span data-ttu-id="3f6ad-143">篩選準則也會分組為依 GUID 定義的類別。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-143">Filters are also grouped into categories, defined by GUID.</span></span> <span data-ttu-id="3f6ad-144">類別本身也有其優點，而 **EnumMatchingFilters** 方法會忽略任何具有最少 **\_ \_ \_ 用途** 的類別，即使該類別中的篩選具有較高的業績值也是如此。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-144">Categories themselves have merit, and the **EnumMatchingFilters** method ignores any category with a merit of **MERIT\_DO\_NOT\_USE** or less, even if the filters in that category have higher merit values.</span></span>

    <span data-ttu-id="3f6ad-145">從 Windows 7 開始，DirectShow 具有特定媒體子類型的封鎖篩選清單。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-145">Starting in Windows 7, DirectShow has a list of blocked filters for certain media subtypes.</span></span> <span data-ttu-id="3f6ad-146">篩選圖形管理員會略過這份清單上的篩選。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-146">The Filter Graph Manager skips filters on this list.</span></span> <span data-ttu-id="3f6ad-147">應用程式可以使用 [**IAMPluginControl**](/windows/desktop/api/Strmif/nn-strmif-iamplugincontrol) 介面來修改封鎖的篩選器清單。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-147">An application can modify the list of blocked filters by using the [**IAMPluginControl**](/windows/desktop/api/Strmif/nn-strmif-iamplugincontrol) interface.</span></span> <span data-ttu-id="3f6ad-148">對這份清單所做的變更會影響應用程式目前的進程，並在進程結束之後捨棄。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-148">Changes to this list affect the application's current process, and are discarded after the process ends.</span></span>

<span data-ttu-id="3f6ad-149">總而言之， [**Render**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-render) 方法會依下列順序嘗試篩選：</span><span class="sxs-lookup"><span data-stu-id="3f6ad-149">To summarize, the [**Render**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-render) method tries filters in the following order:</span></span>

1.  <span data-ttu-id="3f6ad-150">使用 [**IStreamBuilder**](/windows/desktop/api/Strmif/nn-strmif-istreambuilder)。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-150">Use [**IStreamBuilder**](/windows/desktop/api/Strmif/nn-strmif-istreambuilder).</span></span>
2.  <span data-ttu-id="3f6ad-151">嘗試快取篩選。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-151">Try cached filters.</span></span>
3.  <span data-ttu-id="3f6ad-152">嘗試在圖形中篩選。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-152">Try filters in the graph.</span></span>
4.  <span data-ttu-id="3f6ad-153">Windows 7 或更新版本：嘗試媒體類型的慣用篩選（如果有的話）。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-153">Windows 7 or later: Try the preferred filter for the media type, if any.</span></span>
5.  <span data-ttu-id="3f6ad-154">查閱登錄中的篩選準則。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-154">Look up filters in the registry.</span></span>

### <a name="igraphbuilderrenderfile"></a><span data-ttu-id="3f6ad-155">IGraphBuilder：： RenderFile</span><span class="sxs-lookup"><span data-stu-id="3f6ad-155">IGraphBuilder::RenderFile</span></span>

<span data-ttu-id="3f6ad-156">[**IGraphBuilder：： RenderFile**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-renderfile)方法會從檔案名建立預設播放圖形。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-156">The [**IGraphBuilder::RenderFile**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-renderfile) method builds a default playback graph from a file name.</span></span> <span data-ttu-id="3f6ad-157">這個方法會在內部使用 [**AddSourceFilter**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-addsourcefilter) 來找出正確的來源篩選 [**，並轉譯**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-render) 以建立圖形的其餘部分。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-157">Internally, this method uses [**AddSourceFilter**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-addsourcefilter) to locate the correct source filter, and [**Render**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-render) to build the rest of the graph.</span></span>

### <a name="igraphbuilderconnect"></a><span data-ttu-id="3f6ad-158">IGraphBuilder：： Connect</span><span class="sxs-lookup"><span data-stu-id="3f6ad-158">IGraphBuilder::Connect</span></span>

<span data-ttu-id="3f6ad-159">[**IGraphBuilder：： Connect**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-connect)方法會將輸出圖釘連接至輸入圖釘。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-159">The [**IGraphBuilder::Connect**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-connect) method connects an output pin to an input pin.</span></span> <span data-ttu-id="3f6ad-160">此方法會視需要新增中繼篩選，並使用 [**轉譯方法所**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-render) 述的演算法變化：</span><span class="sxs-lookup"><span data-stu-id="3f6ad-160">This method adds intermediate filters if needed, using a variation of the algorithm described for the [**Render**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-render) method:</span></span>

1.  <span data-ttu-id="3f6ad-161">嘗試在篩選之間進行直接連接，而不使用中繼篩選。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-161">Try a direct connection between the filters, with no intermediate filters.</span></span>
2.  <span data-ttu-id="3f6ad-162">嘗試快取篩選。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-162">Try cached filters.</span></span>
3.  <span data-ttu-id="3f6ad-163">嘗試在圖形中篩選。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-163">Try filters in the graph.</span></span>
4.  <span data-ttu-id="3f6ad-164">Windows 7 或更新版本：嘗試媒體類型的慣用篩選（如果有的話）。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-164">Windows 7 or later: Try the preferred filter for the media type, if any.</span></span>
5.  <span data-ttu-id="3f6ad-165">查閱登錄中的篩選準則。</span><span class="sxs-lookup"><span data-stu-id="3f6ad-165">Look up filters in the registry.</span></span>

## <a name="related-topics"></a><span data-ttu-id="3f6ad-166">相關主題</span><span class="sxs-lookup"><span data-stu-id="3f6ad-166">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="3f6ad-167">篩選準則分類</span><span class="sxs-lookup"><span data-stu-id="3f6ad-167">Filter Categories</span></span>](filter-categories.md)
</dt> <dt>

[<span data-ttu-id="3f6ad-168">優點</span><span class="sxs-lookup"><span data-stu-id="3f6ad-168">Merit</span></span>](merit.md)
</dt> <dt>

[<span data-ttu-id="3f6ad-169">使用 GraphEdit 模擬圖表建立</span><span class="sxs-lookup"><span data-stu-id="3f6ad-169">Simulating Graph Building with GraphEdit</span></span>](simulating-graph-building-with-graphedit.md)
</dt> <dt>

[<span data-ttu-id="3f6ad-170">建立篩選圖形</span><span class="sxs-lookup"><span data-stu-id="3f6ad-170">Building the Filter Graph</span></span>](building-the-filter-graph.md)
</dt> </dl>

 

 



