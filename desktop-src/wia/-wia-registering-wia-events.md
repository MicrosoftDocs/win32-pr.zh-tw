---
description: 應用程式可以藉由呼叫下列其中一種 IWiaDevMgr 或 IWiaDevMgr2 介面方法，註冊以收到 Windows 映像取得 (WIA) 硬體裝置事件的通知： IWiaDevMgr：： RegisterEventCallbackCLSID 或 IWiaDevMgr2：： RegisterEventCallbackCLSIDIWiaDevMgr：： RegisterEventCallbackInterface 或 IWiaDevMgr2：： RegisterEventCallbackInterfaceIWiaDevMgr：： RegisterEventCallbackProgram 或 IWiaDevMgr2：： RegisterEventCallbackProgram
ms.assetid: 0c142083-835f-4bbd-ab32-eb6130f99c59
title: 註冊 WIA 事件
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: aa9fc36540a64211428579bc13b84902490ea103
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "103943460"
---
# <a name="registering-wia-events"></a><span data-ttu-id="4b317-103">註冊 WIA 事件</span><span class="sxs-lookup"><span data-stu-id="4b317-103">Registering WIA Events</span></span>

<span data-ttu-id="4b317-104">應用程式可以藉由呼叫下列其中一種 [**IWiaDevMgr**](/windows/desktop/api/wia_xp/nn-wia_xp-iwiadevmgr) 或 [**IWiaDevMgr2**](-wia-iwiadevmgr2.md) 介面方法，註冊以收到 WINDOWS 映射取得 (WIA) 硬體裝置事件的通知：</span><span class="sxs-lookup"><span data-stu-id="4b317-104">Applications can register to be notified of Windows Image Acquisition (WIA) hardware device events by calling one of the following [**IWiaDevMgr**](/windows/desktop/api/wia_xp/nn-wia_xp-iwiadevmgr) or [**IWiaDevMgr2**](-wia-iwiadevmgr2.md) interface methods:</span></span>

-   <span data-ttu-id="4b317-105">[**IWiaDevMgr：： RegisterEventCallbackCLSID**](/windows/desktop/api/wia_xp/nf-wia_xp-iwiadevmgr-registereventcallbackclsid)或 [ **IWiaDevMgr2：： RegisterEventCallbackCLSID**](-wia-iwiadevmgr2-registereventcallbackclsid.md)</span><span class="sxs-lookup"><span data-stu-id="4b317-105">[**IWiaDevMgr::RegisterEventCallbackCLSID**](/windows/desktop/api/wia_xp/nf-wia_xp-iwiadevmgr-registereventcallbackclsid) or [**IWiaDevMgr2::RegisterEventCallbackCLSID**](-wia-iwiadevmgr2-registereventcallbackclsid.md)</span></span>
-   <span data-ttu-id="4b317-106">[**IWiaDevMgr：： RegisterEventCallbackInterface**](/windows/desktop/api/wia_xp/nf-wia_xp-iwiadevmgr-registereventcallbackinterface)或 [ **IWiaDevMgr2：： RegisterEventCallbackInterface**](-wia-iwiadevmgr2-registereventcallbackinterface.md)</span><span class="sxs-lookup"><span data-stu-id="4b317-106">[**IWiaDevMgr::RegisterEventCallbackInterface**](/windows/desktop/api/wia_xp/nf-wia_xp-iwiadevmgr-registereventcallbackinterface) or [**IWiaDevMgr2::RegisterEventCallbackInterface**](-wia-iwiadevmgr2-registereventcallbackinterface.md)</span></span>
-   <span data-ttu-id="4b317-107">[**IWiaDevMgr：： RegisterEventCallbackProgram**](/windows/desktop/api/wia_xp/nf-wia_xp-iwiadevmgr-registereventcallbackprogram)或 [ **IWiaDevMgr2：： RegisterEventCallbackProgram**](-wia-iwiadevmgr2-registereventcallbackprogram.md)</span><span class="sxs-lookup"><span data-stu-id="4b317-107">[**IWiaDevMgr::RegisterEventCallbackProgram**](/windows/desktop/api/wia_xp/nf-wia_xp-iwiadevmgr-registereventcallbackprogram) or [**IWiaDevMgr2::RegisterEventCallbackProgram**](-wia-iwiadevmgr2-registereventcallbackprogram.md)</span></span>

<span data-ttu-id="4b317-108">所有這些方法都採用參數來指定要通知其應用程式的事件和硬體裝置。</span><span class="sxs-lookup"><span data-stu-id="4b317-108">All of these methods take parameters that specify the event and the hardware device for which the application is to be notified.</span></span> <span data-ttu-id="4b317-109">應用程式會針對指定硬體裝置的參數傳遞 **Null** 值，以註冊接收所有 WIA 裝置的事件。</span><span class="sxs-lookup"><span data-stu-id="4b317-109">Applications register to receive an event for all WIA devices by passing a **NULL** value for the parameter that specifies the hardware device.</span></span>

<span data-ttu-id="4b317-110">如果應用程式在事件發生時執行， **RegisterEventCallbackInterface** 方法會註冊應用程式以接收 WIA 硬體裝置事件。</span><span class="sxs-lookup"><span data-stu-id="4b317-110">The **RegisterEventCallbackInterface** method registers an application to receive a WIA hardware device event if the application is running at the time the event occurs.</span></span> <span data-ttu-id="4b317-111">當應用程式註冊的事件發生時，WIA 會呼叫應用程式提供之物件的 [**IWiaEventCallback：： ImageEventCallback**](/windows/desktop/api/wia_xp/nf-wia_xp-iwiaeventcallback-imageeventcallback) 方法，以傳輸事件資訊。</span><span class="sxs-lookup"><span data-stu-id="4b317-111">When the event for which the application is registered occurs, WIA calls the [**IWiaEventCallback::ImageEventCallback**](/windows/desktop/api/wia_xp/nf-wia_xp-iwiaeventcallback-imageeventcallback) method of the application-provided object to transmit the event information.</span></span>

<span data-ttu-id="4b317-112">**RegisterEventCallbackCLSID** 方法會註冊一個應用程式，該應用程式是註冊的元件物件模型， (COM) 元件來接收 WIA 硬體裝置事件，即使應用程式並未執行也一樣。</span><span class="sxs-lookup"><span data-stu-id="4b317-112">The **RegisterEventCallbackCLSID** method registers an application that is a registered Component Object Model (COM) component to receive a WIA hardware device event even if the application is not running.</span></span> <span data-ttu-id="4b317-113">除了先前所述的參數之外，此方法還採用參數 *pClsID*，它會指定應用程式的類別識別碼。</span><span class="sxs-lookup"><span data-stu-id="4b317-113">In addition to the parameters mentioned previously, this method takes a parameter, *pClsID*, that specifies the class ID of the application.</span></span> <span data-ttu-id="4b317-114">當指定的事件發生時，WIA 系統會使用 [CoCreateInstance](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) 函數和 *pClsID* 指定的類別識別碼來建立應用程式的新實例，並呼叫該應用程式的 [**IWiaEventCallback：： ImageEventCallback**](/windows/desktop/api/wia_xp/nf-wia_xp-iwiaeventcallback-imageeventcallback) 方法，以傳輸事件資訊。</span><span class="sxs-lookup"><span data-stu-id="4b317-114">When the specified event occurs, the WIA system uses the [CoCreateInstance](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) function and the class ID specified by *pClsID* to create a new instance of the application, and calls the [**IWiaEventCallback::ImageEventCallback**](/windows/desktop/api/wia_xp/nf-wia_xp-iwiaeventcallback-imageeventcallback) method of that application to transmit the event information.</span></span>

<span data-ttu-id="4b317-115">**RegisterEventCallbackProgram** 方法會註冊應用程式以接收 WIA 硬體裝置事件，即使在事件發生時應用程式並未執行也一樣。</span><span class="sxs-lookup"><span data-stu-id="4b317-115">The **RegisterEventCallbackProgram** method registers an application to receive a WIA hardware device event even if the application is not running when the event occurs.</span></span> <span data-ttu-id="4b317-116">應用程式不需要是已註冊的 COM 元件。</span><span class="sxs-lookup"><span data-stu-id="4b317-116">The application need not be a registered COM component.</span></span> <span data-ttu-id="4b317-117">WIA 使用命令列語句啟動應用程式。</span><span class="sxs-lookup"><span data-stu-id="4b317-117">WIA launches the application with a command line statement.</span></span> <span data-ttu-id="4b317-118">**RegisterEventCallbackProgram** 採用參數 *bstrCommandline*，指定可執行檔應用程式的完整路徑和檔案名。</span><span class="sxs-lookup"><span data-stu-id="4b317-118">**RegisterEventCallbackProgram** takes a parameter, *bstrCommandline*, that specifies the full path and filename of the executable application.</span></span> <span data-ttu-id="4b317-119">**RegisterEventCallbackProgram** 存在的目的是為了與未針對 WIA 撰寫之應用程式的回溯相容性，因此應予以避免。</span><span class="sxs-lookup"><span data-stu-id="4b317-119">**RegisterEventCallbackProgram** exists for backward compatibility with applications that were not written for WIA, and should be avoided.</span></span> <span data-ttu-id="4b317-120">請改用 **RegisterEventCallbackInterface** 或 **RegisterEventCallbackCLSID** 。</span><span class="sxs-lookup"><span data-stu-id="4b317-120">Use **RegisterEventCallbackInterface** or **RegisterEventCallbackCLSID** instead.</span></span>

<span data-ttu-id="4b317-121">為了判斷哪些處理常式是在特定的 WIA 裝置上註冊事件，應用程式會呼叫根專案的 [**IWiaItem：： EnumRegisterEventInfo**](/windows/desktop/api/wia_xp/nf-wia_xp-iwiaitem-enumregistereventinfo) 或 [**IWiaItem2：： EnumRegisterEventInfo**](-wia-iwiaitem2-enumregistereventinfo.md) 方法。</span><span class="sxs-lookup"><span data-stu-id="4b317-121">To determine which handlers are registered for events on a specific WIA device, an application calls a [**IWiaItem::EnumRegisterEventInfo**](/windows/desktop/api/wia_xp/nf-wia_xp-iwiaitem-enumregistereventinfo) or [**IWiaItem2::EnumRegisterEventInfo**](-wia-iwiaitem2-enumregistereventinfo.md) method of a root item.</span></span> <span data-ttu-id="4b317-122">這個方法會建立註冊資訊的列舉物件。</span><span class="sxs-lookup"><span data-stu-id="4b317-122">This method creates an enumeration object for the registration information.</span></span> <span data-ttu-id="4b317-123">然後，應用程式可以使用該物件的 [**IEnumWIA \_ DEV \_ CAPS**](/windows/desktop/api/wia_xp/nn-wia_xp-ienumwia_dev_caps) 介面，列舉已註冊要接收該裝置事件之處理常式的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="4b317-123">The application can then use the [**IEnumWIA\_DEV\_CAPS**](/windows/desktop/api/wia_xp/nn-wia_xp-ienumwia_dev_caps) interface of that object to enumerate information about the handlers registered to receive events for that device.</span></span>

<span data-ttu-id="4b317-124">如果透過 **RegisterEventCallbackInterface** 和 **RegisterEventCallbackCLSID** 或 **RegisterEventCallbackProgram** 註冊正在執行之應用程式的事件發生，則 WIA 會通知執行中的應用程式，而且不會嘗試啟動應用程式的新實例，因為透過 **RegisterEventCallbackInterface** 的事件註冊優先于 **RegisterEventCallbackCLSID** 和 **RegisterEventCallbackProgram**。</span><span class="sxs-lookup"><span data-stu-id="4b317-124">If an event occurs for which a running application is registered through **RegisterEventCallbackInterface** and either **RegisterEventCallbackCLSID** or **RegisterEventCallbackProgram**, WIA notifies the running application and does not attempt to launch a new instance of the application because event registration through **RegisterEventCallbackInterface** takes precedence over both **RegisterEventCallbackCLSID** and **RegisterEventCallbackProgram**.</span></span>

> [!Note]  
> <span data-ttu-id="4b317-125">在多執行緒應用程式中，並不保證事件通知回呼回呼的執行緒是註冊回呼的相同執行緒。</span><span class="sxs-lookup"><span data-stu-id="4b317-125">In a multi-threaded application, there is no guarantee that the thread that the event notification callback will return on is the same thread that registered the callback.</span></span>

 

 

 
