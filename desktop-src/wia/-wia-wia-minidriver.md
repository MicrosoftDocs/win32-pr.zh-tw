---
description: 應用程式會將 Windows 映像取得 (WIA) 裝置視為 IWiaItem 或 IWiaItem2 物件的階層式樹狀結構，其中根專案代表裝置本身。
ms.assetid: ae4ded93-09be-4caa-ad6e-1a9071fdb4b6
title: WIA 迷你驅動程式
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f5aadaf55cfe2e8102d4e0e02cf9787b9696e327
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104511601"
---
# <a name="wia-minidriver"></a><span data-ttu-id="c8ce4-103">WIA 迷你驅動程式</span><span class="sxs-lookup"><span data-stu-id="c8ce4-103">WIA Minidriver</span></span>

<span data-ttu-id="c8ce4-104">應用程式會將 Windows 映像取得 (WIA) 裝置視為 [**IWiaItem**](/windows/desktop/api/wia_xp/nn-wia_xp-iwiaitem) 或 [**IWiaItem2**](-wia-iwiaitem2.md) 物件的階層式樹狀結構，其中根專案代表裝置本身。</span><span class="sxs-lookup"><span data-stu-id="c8ce4-104">Applications see Windows Image Acquisition (WIA) devices as a hierarchical tree of [**IWiaItem**](/windows/desktop/api/wia_xp/nn-wia_xp-iwiaitem) or [**IWiaItem2**](-wia-iwiaitem2.md) objects with the root item representing the device itself.</span></span> <span data-ttu-id="c8ce4-105">WIA 裝置可同時由一個以上的應用程式使用。</span><span class="sxs-lookup"><span data-stu-id="c8ce4-105">WIA devices may be used concurrently by more than one application.</span></span> <span data-ttu-id="c8ce4-106">因此，每個應用程式的 **IWiaItem** 或 **IWiaItem2** 物件檢視都必須與另一個應用程式的視圖無關。</span><span class="sxs-lookup"><span data-stu-id="c8ce4-106">It is therefore necessary that each application's view of an **IWiaItem** or **IWiaItem2** object be independent of another application's views.</span></span> <span data-ttu-id="c8ce4-107">這可透過兩個不同的專案物件來完成。</span><span class="sxs-lookup"><span data-stu-id="c8ce4-107">This is accomplished by having two different item objects.</span></span> <span data-ttu-id="c8ce4-108">驅動程式會使用 WIA 驅動程式服務方法來建立 [IWiaDrvItem 介面](https://msdn.microsoft.com/library/ms793976.aspx) 物件的驅動程式專案樹狀結構，也稱為驅動程式專案。</span><span class="sxs-lookup"><span data-stu-id="c8ce4-108">The driver creates the driver item tree of [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) objects, also called driver items, using the WIA driver services methods.</span></span> <span data-ttu-id="c8ce4-109">這些是驅動程式用來表示每個驅動程式內部專案的全域物件。</span><span class="sxs-lookup"><span data-stu-id="c8ce4-109">These are global objects that the driver uses to represent each driver's internal items.</span></span> <span data-ttu-id="c8ce4-110">當應用程式建立 **IWiaItem** 或 **IWiaItem2** 物件 (也稱為應用程式專案) 時，此物件會連結至驅動程式專案樹狀結構中驅動程式的對應 [IWiaDrvItem 介面](https://msdn.microsoft.com/library/ms793976.aspx) 。</span><span class="sxs-lookup"><span data-stu-id="c8ce4-110">When an application creates an **IWiaItem** or **IWiaItem2** object (also called an application item), this object is linked to the driver's corresponding [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) in the driver item tree.</span></span> <span data-ttu-id="c8ce4-111">參考計數會在 [IWiaDrvItem 介面](https://msdn.microsoft.com/library/ms793976.aspx) 物件上保留，且受限於下列規則：</span><span class="sxs-lookup"><span data-stu-id="c8ce4-111">A reference count is maintained on the [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) object subject to the following rules:</span></span>

-   <span data-ttu-id="c8ce4-112">當驅動程式將 [IWiaDrvItem 介面](https://msdn.microsoft.com/library/ms793976.aspx) 物件加入至驅動程式專案樹狀結構時， [IWiaDrvItem 介面](https://msdn.microsoft.com/library/ms793976.aspx) 物件的參考計數會遞增。</span><span class="sxs-lookup"><span data-stu-id="c8ce4-112">When a driver adds an [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) object to the driver item tree, the [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) object's reference count is incremented.</span></span> <span data-ttu-id="c8ce4-113">這通常會在 IWiaMiniDrv 期間發生 [：:D rvinitializewia](https://msdn.microsoft.com/library/ms794097.aspx) 或處理 WIA \_ CMD \_ SYNCHRONIZE 命令時。</span><span class="sxs-lookup"><span data-stu-id="c8ce4-113">This typically takes place during [IWiaMiniDrv::drvInitializeWia](https://msdn.microsoft.com/library/ms794097.aspx) or when a WIA\_CMD\_SYNCHRONIZE command is processed.</span></span>
-   <span data-ttu-id="c8ce4-114">當驅動程式從驅動程式專案樹狀結構中移除 [IWiaDrvItem 介面](https://msdn.microsoft.com/library/ms793976.aspx) 物件時， [IWiaDrvItem 介面](https://msdn.microsoft.com/library/ms793976.aspx) 物件的參考計數會減少，並標示 [IWiaDrvItem 介面](https://msdn.microsoft.com/library/ms793976.aspx) 物件，使其無法再次存取裝置。</span><span class="sxs-lookup"><span data-stu-id="c8ce4-114">When a driver removes an [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) object from the driver item tree, the [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) object's reference count is decremented and the [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) object is marked so that it can't access the device again.</span></span> <span data-ttu-id="c8ce4-115">當裝置中斷連線或刪除專案時，通常會發生這種情況。</span><span class="sxs-lookup"><span data-stu-id="c8ce4-115">This typically takes place when a device is disconnected or an item is deleted.</span></span> <span data-ttu-id="c8ce4-116">即使已從驅動程式專案樹狀結構中移除對應的 [IWiaDrvItem 介面](https://msdn.microsoft.com/library/ms793976.aspx)物件，應用程式仍能從 [**IWiaItem**](/windows/desktop/api/wia_xp/nn-wia_xp-iwiaitem)或 [**IWiaItem2**](-wia-iwiaitem2.md)物件讀取屬性。</span><span class="sxs-lookup"><span data-stu-id="c8ce4-116">Applications are still able to read properties from an [**IWiaItem**](/windows/desktop/api/wia_xp/nn-wia_xp-iwiaitem) or [**IWiaItem2**](-wia-iwiaitem2.md) object even when the corresponding [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) object has been removed from the driver item tree.</span></span>
-   <span data-ttu-id="c8ce4-117">建立 [**IWiaItem**](/windows/desktop/api/wia_xp/nn-wia_xp-iwiaitem) 或 [**IWiaItem2**](-wia-iwiaitem2.md) 物件時，它會連結至對應的 [IWiaDrvItem 介面](https://msdn.microsoft.com/library/ms793976.aspx) 物件。</span><span class="sxs-lookup"><span data-stu-id="c8ce4-117">When an [**IWiaItem**](/windows/desktop/api/wia_xp/nn-wia_xp-iwiaitem) or [**IWiaItem2**](-wia-iwiaitem2.md) object is created it is linked to a corresponding [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) object.</span></span> <span data-ttu-id="c8ce4-118">[IWiaDrvItem 介面](https://msdn.microsoft.com/library/ms793976.aspx)物件的參考計數會遞增。</span><span class="sxs-lookup"><span data-stu-id="c8ce4-118">The reference count of the [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) object is incremented.</span></span>
-   <span data-ttu-id="c8ce4-119">釋放 [**IWiaItem**](/windows/desktop/api/wia_xp/nn-wia_xp-iwiaitem) 或 [**IWiaItem2**](-wia-iwiaitem2.md) 物件時，會中斷其對應 [IWiaDrvItem 介面](https://msdn.microsoft.com/library/ms793976.aspx) 物件的連結，並減少 [IWiaDrvItem 介面](https://msdn.microsoft.com/library/ms793976.aspx) 物件的參考計數。</span><span class="sxs-lookup"><span data-stu-id="c8ce4-119">When an [**IWiaItem**](/windows/desktop/api/wia_xp/nn-wia_xp-iwiaitem) or [**IWiaItem2**](-wia-iwiaitem2.md) object is released, the link to its corresponding [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) object is severed and the [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) object's reference count is decremented.</span></span>
-   <span data-ttu-id="c8ce4-120">如果 [IWiaDrvItem 介面](https://msdn.microsoft.com/library/ms793976.aspx) 物件的參考計數變成零，則會刪除 [IWiaDrvItem 介面](https://msdn.microsoft.com/library/ms793976.aspx) 物件。</span><span class="sxs-lookup"><span data-stu-id="c8ce4-120">If an [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) object's reference count goes to zero, the [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) object is deleted.</span></span> <span data-ttu-id="c8ce4-121">這適用于所有 [IWiaDrvItem 的介面](https://msdn.microsoft.com/library/ms793976.aspx) 物件，包括根專案。</span><span class="sxs-lookup"><span data-stu-id="c8ce4-121">This applies to all [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) objects including the root item.</span></span> <span data-ttu-id="c8ce4-122">[IWiaDrvItem 介面](https://msdn.microsoft.com/library/ms793976.aspx)物件的參考計數只有在沒有任何應用程式專案參考時，才會變成零，而且不再連結至驅動程式專案樹狀結構。</span><span class="sxs-lookup"><span data-stu-id="c8ce4-122">An [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) object's reference count only goes to zero when no application items reference it and it is no longer linked to the driver item tree.</span></span>

<span data-ttu-id="c8ce4-123">使用此參考計數配置時，許多 [**IWiaItem**](/windows/desktop/api/wia_xp/nn-wia_xp-iwiaitem) 或 [**IWiaItem2**](-wia-iwiaitem2.md) 物件可以連結至一個 [IWiaDrvItem 介面](https://msdn.microsoft.com/library/ms793976.aspx) ，而不會受到干擾。</span><span class="sxs-lookup"><span data-stu-id="c8ce4-123">Using this reference counting scheme, many [**IWiaItem**](/windows/desktop/api/wia_xp/nn-wia_xp-iwiaitem) or [**IWiaItem2**](-wia-iwiaitem2.md) objects may link to one [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) without interference.</span></span> <span data-ttu-id="c8ce4-124">由於每個 **IWiaItem** 或 **IWiaItem2** 都包含它自己的屬性儲存空間，因此即使在刪除專案之後，應用程式還是可以繼續讀取專案屬性，但不需要存取裝置的作業也會成功。</span><span class="sxs-lookup"><span data-stu-id="c8ce4-124">Because each **IWiaItem** or **IWiaItem2** contains its own property storage, an application can continue to read item properties even after an item has been deleted, but no operation that requires access to the device will succeed.</span></span> <span data-ttu-id="c8ce4-125">因為專案屬性儲存在 **IWiaItem** 或 **IWiaItem2** 物件中，所以在資料傳輸之前，驅動程式必須將 **IWiaItem** 或 **IWiaItem2** 物件的屬性設定為裝置。</span><span class="sxs-lookup"><span data-stu-id="c8ce4-125">Because item properties are stored in the **IWiaItem** or **IWiaItem2** object, the driver must set the **IWiaItem** or **IWiaItem2** object's properties to the device before a data transfer.</span></span>

 

 



