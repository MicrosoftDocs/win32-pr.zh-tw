---
description: 可讓傳輸應用程式的伺服器元件建立伺服器與遠端用戶端之間的 [*安全性內容*](../secgloss/s-gly.md) 。
ms.assetid: eaa15fed-4438-4e43-9be3-aa100ca453c7
title: 'AcceptSecurityCoNtext (一般) 函數 (Sspi. h) '
ms.topic: reference
ms.date: 07/25/2019
ms.openlocfilehash: 41b3220e9304f63e1a6ac4f77b609e3cbbac8741
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "103849616"
---
# <a name="acceptsecuritycontext-general-function"></a><span data-ttu-id="545e9-103">AcceptSecurityCoNtext (一般) 函數</span><span class="sxs-lookup"><span data-stu-id="545e9-103">AcceptSecurityContext (General) function</span></span>

<span data-ttu-id="545e9-104">**AcceptSecurityCoNtext (General)** 函數可讓傳輸應用程式的伺服器元件建立伺服器與遠端用戶端之間的 [*安全性內容*](../secgloss/s-gly.md)。</span><span class="sxs-lookup"><span data-stu-id="545e9-104">The **AcceptSecurityContext (General)** function enables the server component of a transport application to establish a [*security context*](../secgloss/s-gly.md) between the server and a remote client.</span></span> <span data-ttu-id="545e9-105">遠端用戶端會使用 [**InitializeSecurityCoNtext (一般)**](initializesecuritycontext--general.md) 函數來啟動建立 [*安全性內容*](../secgloss/s-gly.md)的程式。</span><span class="sxs-lookup"><span data-stu-id="545e9-105">The remote client uses the [**InitializeSecurityContext (General)**](initializesecuritycontext--general.md) function to start the process of establishing a [*security context*](../secgloss/s-gly.md).</span></span> <span data-ttu-id="545e9-106">伺服器可能需要來自遠端用戶端的一或多個回復權杖，才能完成 [*安全性內容*](../secgloss/s-gly.md)的建立。</span><span class="sxs-lookup"><span data-stu-id="545e9-106">The server can require one or more reply tokens from the remote client to complete establishing the [*security context*](../secgloss/s-gly.md).</span></span>

<span data-ttu-id="545e9-107">如需有關使用此函式搭配特定 [*安全性支援提供者*](../secgloss/s-gly.md) (SSP) 的詳細資訊，請參閱下列主題。</span><span class="sxs-lookup"><span data-stu-id="545e9-107">For information about using this function with a specific [*security support provider*](../secgloss/s-gly.md) (SSP), see the following topics.</span></span>



| <span data-ttu-id="545e9-108">主題</span><span class="sxs-lookup"><span data-stu-id="545e9-108">Topic</span></span>                                                                          | <span data-ttu-id="545e9-109">描述</span><span class="sxs-lookup"><span data-stu-id="545e9-109">Description</span></span>                                                                                                                                                                                                                                                                      |
|--------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="545e9-110">**AcceptSecurityCoNtext (CredSSP)**</span><span class="sxs-lookup"><span data-stu-id="545e9-110">**AcceptSecurityContext (CredSSP)**</span></span>](acceptsecuritycontext--credssp.md)     | <span data-ttu-id="545e9-111">允許傳輸應用程式的伺服器元件使用 (CredSSP) 的認證安全性支援提供者，建立伺服器與遠端用戶端之間的 [*安全性內容*](../secgloss/s-gly.md) 。</span><span class="sxs-lookup"><span data-stu-id="545e9-111">Allows the server component of a transport application establish a [*security context*](../secgloss/s-gly.md) between the server and a remote client by using Credential Security Support Provider (CredSSP).</span></span><br/> |
| [<span data-ttu-id="545e9-112">**AcceptSecurityCoNtext (摘要)**</span><span class="sxs-lookup"><span data-stu-id="545e9-112">**AcceptSecurityContext (Digest)**</span></span>](acceptsecuritycontext--digest.md)       | <span data-ttu-id="545e9-113">啟用傳輸應用程式的伺服器元件，以便在伺服器與使用摘要的遠端用戶端之間建立 [*安全性內容*](../secgloss/s-gly.md) 。</span><span class="sxs-lookup"><span data-stu-id="545e9-113">Enables the server component of a transport application to establish a [*security context*](../secgloss/s-gly.md) between the server and a remote client that is using Digest.</span></span><br/>                                                                                                                  |
| [<span data-ttu-id="545e9-114">**AcceptSecurityCoNtext (Kerberos)**</span><span class="sxs-lookup"><span data-stu-id="545e9-114">**AcceptSecurityContext (Kerberos)**</span></span>](acceptsecuritycontext--kerberos.md)   | <span data-ttu-id="545e9-115">啟用傳輸應用程式的伺服器元件，以便在伺服器與使用 Kerberos 的遠端用戶端之間建立 [*安全性內容*](../secgloss/s-gly.md) 。</span><span class="sxs-lookup"><span data-stu-id="545e9-115">Enables the server component of a transport application to establish a [*security context*](../secgloss/s-gly.md) between the server and a remote client that is using Kerberos.</span></span><br/>                                                                                                                |
| [<span data-ttu-id="545e9-116">**AcceptSecurityCoNtext (Negotiate)**</span><span class="sxs-lookup"><span data-stu-id="545e9-116">**AcceptSecurityContext (Negotiate)**</span></span>](acceptsecuritycontext--negotiate.md) | <span data-ttu-id="545e9-117">啟用傳輸應用程式的伺服器元件，以便在伺服器與使用 Negotiate 的遠端用戶端之間建立 [*安全性內容*](../secgloss/s-gly.md) 。</span><span class="sxs-lookup"><span data-stu-id="545e9-117">Enables the server component of a transport application to establish a [*security context*](../secgloss/s-gly.md) between the server and a remote client that is using Negotiate.</span></span><br/>                                                                                                               |
| [<span data-ttu-id="545e9-118">**AcceptSecurityCoNtext (NTLM)**</span><span class="sxs-lookup"><span data-stu-id="545e9-118">**AcceptSecurityContext (NTLM)**</span></span>](acceptsecuritycontext--ntlm.md)           | <span data-ttu-id="545e9-119">啟用傳輸應用程式的伺服器元件，以便在使用 NTLM 的伺服器與遠端用戶端之間建立 [*安全性內容*](../secgloss/s-gly.md) 。</span><span class="sxs-lookup"><span data-stu-id="545e9-119">Enables the server component of a transport application to establish a [*security context*](../secgloss/s-gly.md) between the server and a remote client that is using NTLM.</span></span><br/>                                                                                                                    |
| [<span data-ttu-id="545e9-120">**AcceptSecurityCoNtext (Schannel)**</span><span class="sxs-lookup"><span data-stu-id="545e9-120">**AcceptSecurityContext (Schannel)**</span></span>](acceptsecuritycontext--schannel.md)   | <span data-ttu-id="545e9-121">啟用傳輸應用程式的伺服器元件，以在使用 Schannel 的伺服器與遠端用戶端之間建立 [*安全性內容*](../secgloss/s-gly.md) 。</span><span class="sxs-lookup"><span data-stu-id="545e9-121">Enables the server component of a transport application to establish a [*security context*](../secgloss/s-gly.md) between the server and a remote client that is using Schannel.</span></span><br/>                                                                                                                |



 

## <a name="syntax"></a><span data-ttu-id="545e9-122">語法</span><span class="sxs-lookup"><span data-stu-id="545e9-122">Syntax</span></span>


```C++
SECURITY_STATUS SEC_Entry AcceptSecurityContext(
  _In_opt_    PCredHandle    phCredential,
  _Inout_opt_ PCtxtHandle    phContext,
  _In_opt_    PSecBufferDesc pInput,
  _In_        ULONG          fContextReq,
  _In_        ULONG          TargetDataRep,
  _Inout_opt_ PCtxtHandle    phNewContext,
  _Inout_opt_ PSecBufferDesc pOutput,
  _Out_       PULONG         pfContextAttr,
  _Out_opt_   PTimeStamp     ptsExpiry
);
```



## <a name="parameters"></a><span data-ttu-id="545e9-123">參數</span><span class="sxs-lookup"><span data-stu-id="545e9-123">Parameters</span></span>

<dl> <dt>

<span data-ttu-id="545e9-124">*phCredential* \[在中，選擇性\]</span><span class="sxs-lookup"><span data-stu-id="545e9-124">*phCredential* \[in, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="545e9-125">伺服器認證的控制碼。</span><span class="sxs-lookup"><span data-stu-id="545e9-125">A handle to the credentials of the server.</span></span> <span data-ttu-id="545e9-126">伺服器會呼叫 [**AcquireCredentialsHandle (一般)**](acquirecredentialshandle--general.md) 函式，並將 \_ \_ \_ \_ 兩個旗標設定為取得此控制碼。</span><span class="sxs-lookup"><span data-stu-id="545e9-126">The server calls the [**AcquireCredentialsHandle (General)**](acquirecredentialshandle--general.md) function with either the SECPKG\_CRED\_INBOUND or SECPKG\_CRED\_BOTH flag set to retrieve this handle.</span></span>

</dd> <dt>

<span data-ttu-id="545e9-127">*phCoNtext* \[in、out\]</span><span class="sxs-lookup"><span data-stu-id="545e9-127">*phContext* \[in, out\]</span></span>
</dt> <dd>

<span data-ttu-id="545e9-128">[CtxtHandle](sspi-handles.md)結構的指標。</span><span class="sxs-lookup"><span data-stu-id="545e9-128">A pointer to a [CtxtHandle](sspi-handles.md) structure.</span></span> <span data-ttu-id="545e9-129">在第一次呼叫 **AcceptSecurityCoNtext (一般)** 時，此指標為 **Null**。</span><span class="sxs-lookup"><span data-stu-id="545e9-129">On the first call to **AcceptSecurityContext (General)**, this pointer is **NULL**.</span></span> <span data-ttu-id="545e9-130">在後續的呼叫中， *phCoNtext* 是第一次呼叫時， *phNewCoNtext* 參數所傳回之部分格式內容的控制碼。</span><span class="sxs-lookup"><span data-stu-id="545e9-130">On subsequent calls, *phContext* is the handle to the partially formed context that was returned in the *phNewContext* parameter by the first call.</span></span>

</dd> <dt>

<span data-ttu-id="545e9-131">*pInput* \[在中，選擇性\]</span><span class="sxs-lookup"><span data-stu-id="545e9-131">*pInput* \[in, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="545e9-132">用戶端呼叫所產生之 [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) 結構的指標，InitializeSecurityCoNtext (包含輸入緩衝區描述項的 [**一般)**](initializesecuritycontext--general.md) 。</span><span class="sxs-lookup"><span data-stu-id="545e9-132">A pointer to a [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) structure generated by a client call to [**InitializeSecurityContext (General)**](initializesecuritycontext--general.md) that contains the input buffer descriptor.</span></span>

<span data-ttu-id="545e9-133">使用安全通道 SSP 時，第一個緩衝區的類型必須是之 SECBUFFER \_ TOKEN，並且包含從用戶端收到的安全性權杖。</span><span class="sxs-lookup"><span data-stu-id="545e9-133">When using the Schannel SSP, the first buffer must be of type SECBUFFER\_TOKEN and contain the security token received from the client.</span></span> <span data-ttu-id="545e9-134">第二個緩衝區的類型應該是之 SECBUFFER \_ EMPTY。</span><span class="sxs-lookup"><span data-stu-id="545e9-134">The second buffer should be of type SECBUFFER\_EMPTY.</span></span>

<span data-ttu-id="545e9-135">使用 Negotiate、Kerberos 或 NTLM Ssp 時，除了 [**InitializeSecurityCoNtext (一般)**](initializesecuritycontext--general.md)函式的呼叫所產生的緩衝區外，也可以透過傳入 **之 secbuffer \_ \_ 通道** 系結類型的 [**之 secbuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer)結構來指定通道系結資訊。</span><span class="sxs-lookup"><span data-stu-id="545e9-135">When using the Negotiate, Kerberos, or NTLM SSPs, channel binding information can be specified by passing in a [**SecBuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer) structure of type **SECBUFFER\_CHANNEL\_BINDINGS** in addition to the buffers generated by the call to the [**InitializeSecurityContext (General)**](initializesecuritycontext--general.md) function.</span></span> <span data-ttu-id="545e9-136">通道系結緩衝區的通道系結資訊，可以藉由在用戶端用來驗證的 Schannel 內容上呼叫 [**QueryCoNtextAttributes (schannel)**](querycontextattributes--schannel.md) 函式取得。</span><span class="sxs-lookup"><span data-stu-id="545e9-136">The channel binding information for the channel binding buffer can be obtained by calling the [**QueryContextAttributes (Schannel)**](querycontextattributes--schannel.md) function on the Schannel context the client used to authenticate.</span></span>

</dd> <dt>

<span data-ttu-id="545e9-137">*fCoNtextReq* \[在\]</span><span class="sxs-lookup"><span data-stu-id="545e9-137">*fContextReq* \[in\]</span></span>
</dt> <dd>

<span data-ttu-id="545e9-138">位旗標，指定伺服器所需的屬性以建立內容。</span><span class="sxs-lookup"><span data-stu-id="545e9-138">Bit flags that specify the attributes required by the server to establish the context.</span></span> <span data-ttu-id="545e9-139">您可以使用位 **or** 運算結合位旗標。</span><span class="sxs-lookup"><span data-stu-id="545e9-139">Bit flags can be combined by using bitwise-**OR** operations.</span></span> <span data-ttu-id="545e9-140">這個參數可以是下列一或多個值。</span><span class="sxs-lookup"><span data-stu-id="545e9-140">This parameter can be one or more of the following values.</span></span>



| <span data-ttu-id="545e9-141">值</span><span class="sxs-lookup"><span data-stu-id="545e9-141">Value</span></span>                                                                                                                                                                                                                                          | <span data-ttu-id="545e9-142">意義</span><span class="sxs-lookup"><span data-stu-id="545e9-142">Meaning</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span id="ASC_REQ_ALLOCATE_MEMORY"></span><span id="asc_req_allocate_memory"></span><dl> <span data-ttu-id="545e9-143"><dt>**ASC \_ 需求 \_ 配置 \_ 記憶體**</dt></span><span class="sxs-lookup"><span data-stu-id="545e9-143"><dt>**ASC\_REQ\_ALLOCATE\_MEMORY**</dt></span></span> </dl>                                                  | <span data-ttu-id="545e9-144">摘要式和 Schannel 將為您配置輸出緩衝區。</span><span class="sxs-lookup"><span data-stu-id="545e9-144">Digest and Schannel will allocate output buffers for you.</span></span> <span data-ttu-id="545e9-145">當您完成使用輸出緩衝區時，請呼叫 [**FreeCoNtextBuffer**](/windows/win32/api/sspi/nf-sspi-freecontextbuffer) 函式釋放它們。</span><span class="sxs-lookup"><span data-stu-id="545e9-145">When you have finished using the output buffers, free them by calling the [**FreeContextBuffer**](/windows/win32/api/sspi/nf-sspi-freecontextbuffer) function.</span></span><br/>                                                                                                                                                                                                                                                                                |
| <span id="ASC_REQ_ALLOW_MISSING_BINDINGS"></span><span id="asc_req_allow_missing_bindings"></span><dl> <span data-ttu-id="545e9-146"><dt>**ASC \_ 需求 \_ 允許 \_ 遺漏 \_ 系結**</dt></span><span class="sxs-lookup"><span data-stu-id="545e9-146"><dt>**ASC\_REQ\_ALLOW\_MISSING\_BINDINGS**</dt></span></span> </dl>                            | <span data-ttu-id="545e9-147">表示摘要不需要內部和外部通道的通道系結。</span><span class="sxs-lookup"><span data-stu-id="545e9-147">Indicates that Digest does not require channel bindings for both inner and outer channels.</span></span> <span data-ttu-id="545e9-148">當端點通道系結的支援未知時，此值會用於回溯相容性。</span><span class="sxs-lookup"><span data-stu-id="545e9-148">This value is used for backward compatibility when support for endpoint channel binding is not known.</span></span><br/> <span data-ttu-id="545e9-149">此值與 **ASC \_ 需求 \_ PROXY \_** 系結互斥。</span><span class="sxs-lookup"><span data-stu-id="545e9-149">This value is mutually exclusive with **ASC\_REQ\_PROXY\_BINDINGS**.</span></span><br/> <span data-ttu-id="545e9-150">只有摘要 SSP 才支援這個值。</span><span class="sxs-lookup"><span data-stu-id="545e9-150">This value is supported only by the Digest SSP.</span></span><br/> <span data-ttu-id="545e9-151">**Windows server 2008、Windows Vista、Windows server 2003 和 WINDOWS XP：** 不支援這個值。</span><span class="sxs-lookup"><span data-stu-id="545e9-151">**Windows Server 2008, Windows Vista, Windows Server 2003 and Windows XP:** This value is not supported.</span></span><br/> <br/> |
| <span id="ASC_REQ_CONFIDENTIALITY"></span><span id="asc_req_confidentiality"></span><dl> <span data-ttu-id="545e9-152"><dt>**ASC \_ 需求 \_ 機密性**</dt></span><span class="sxs-lookup"><span data-stu-id="545e9-152"><dt>**ASC\_REQ\_CONFIDENTIALITY**</dt></span></span> </dl>                                                   | <span data-ttu-id="545e9-153">加密和解密訊息。</span><span class="sxs-lookup"><span data-stu-id="545e9-153">Encrypt and decrypt messages.</span></span> <br/> <span data-ttu-id="545e9-154">摘要 SSP 僅支援 SASL 的此旗標。</span><span class="sxs-lookup"><span data-stu-id="545e9-154">The Digest SSP supports this flag for SASL only.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                  |
| <span id="ASC_REQ_CONNECTION"></span><span id="asc_req_connection"></span><dl> <span data-ttu-id="545e9-155"><dt>**ASC \_ 需求 \_ 連接**</dt></span><span class="sxs-lookup"><span data-stu-id="545e9-155"><dt>**ASC\_REQ\_CONNECTION**</dt></span></span> </dl>                                                                  | <span data-ttu-id="545e9-156">[*安全性內容*](../secgloss/s-gly.md)將不會處理格式化訊息。</span><span class="sxs-lookup"><span data-stu-id="545e9-156">The [*security context*](../secgloss/s-gly.md) will not handle formatting messages.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                   |
| <span id="ASC_REQ_DELEGATE"></span><span id="asc_req_delegate"></span><dl> <span data-ttu-id="545e9-157"><dt>**ASC \_ 需求 \_ 委派**</dt></span><span class="sxs-lookup"><span data-stu-id="545e9-157"><dt>**ASC\_REQ\_DELEGATE**</dt></span></span> </dl>                                                                        | <span data-ttu-id="545e9-158">允許伺服器模擬用戶端。</span><span class="sxs-lookup"><span data-stu-id="545e9-158">The server is allowed to impersonate the client.</span></span> <span data-ttu-id="545e9-159">適用于 Kerberos。</span><span class="sxs-lookup"><span data-stu-id="545e9-159">Valid for Kerberos.</span></span> <span data-ttu-id="545e9-160">請忽略此旗標以進行 [*限制委派*](../secgloss/c-gly.md)。</span><span class="sxs-lookup"><span data-stu-id="545e9-160">Ignore this flag for [*constrained delegation*](../secgloss/c-gly.md).</span></span><br/>                                                                                                                                                                                                                                                             |
| <span id="ASC_REQ_EXTENDED_ERROR"></span><span id="asc_req_extended_error"></span><dl> <span data-ttu-id="545e9-161"><dt>**ASC \_ 需求 \_ 擴充 \_ 錯誤**</dt></span><span class="sxs-lookup"><span data-stu-id="545e9-161"><dt>**ASC\_REQ\_EXTENDED\_ERROR**</dt></span></span> </dl>                                                     | <span data-ttu-id="545e9-162">發生錯誤時，將會通知遠端方。</span><span class="sxs-lookup"><span data-stu-id="545e9-162">When errors occur, the remote party will be notified.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                       |
| <span id="ASC_REQ_HTTP__0x10000000_"></span><span id="asc_req_http__0x10000000_"></span><span id="ASC_REQ_HTTP__0X10000000_"></span><dl> <span data-ttu-id="545e9-163"><dt>**ASC \_ 需求 \_ HTTP (0x10000000)**</dt></span><span class="sxs-lookup"><span data-stu-id="545e9-163"><dt>**ASC\_REQ\_HTTP (0x10000000)**</dt></span></span> </dl> | <span data-ttu-id="545e9-164">針對 HTTP 使用 Digest。</span><span class="sxs-lookup"><span data-stu-id="545e9-164">Use Digest for HTTP.</span></span> <span data-ttu-id="545e9-165">省略此旗標以使用摘要做為 SASL 機制。</span><span class="sxs-lookup"><span data-stu-id="545e9-165">Omit this flag to use Digest as an SASL mechanism.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                     |
| <span id="ASC_REQ_INTEGRITY"></span><span id="asc_req_integrity"></span><dl> <span data-ttu-id="545e9-166"><dt>**ASC \_ 需求 \_ 完整性**</dt></span><span class="sxs-lookup"><span data-stu-id="545e9-166"><dt>**ASC\_REQ\_INTEGRITY**</dt></span></span> </dl>                                                                     | <span data-ttu-id="545e9-167">簽署訊息並驗證簽章。</span><span class="sxs-lookup"><span data-stu-id="545e9-167">Sign messages and verify signatures.</span></span><br/> <span data-ttu-id="545e9-168">Schannel 不支援此旗標。</span><span class="sxs-lookup"><span data-stu-id="545e9-168">Schannel does not support this flag.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                        |
| <span id="ASC_REQ_MUTUAL_AUTH"></span><span id="asc_req_mutual_auth"></span><dl> <span data-ttu-id="545e9-169"><dt>**ASC \_ 要求 \_ 相互 \_ 驗證**</dt></span><span class="sxs-lookup"><span data-stu-id="545e9-169"><dt>**ASC\_REQ\_MUTUAL\_AUTH**</dt></span></span> </dl>                                                              | <span data-ttu-id="545e9-170">用戶端必須提供要用於用戶端驗證的憑證。</span><span class="sxs-lookup"><span data-stu-id="545e9-170">The client is required to supply a certificate to be used for client authentication.</span></span><br/> <span data-ttu-id="545e9-171">只有 Schannel 才支援此旗標。</span><span class="sxs-lookup"><span data-stu-id="545e9-171">This flag is supported only by Schannel.</span></span><br/>                                                                                                                                                                                                                                                                                                                                    |
| <span id="ASC_REQ_PROXY_BINDINGS"></span><span id="asc_req_proxy_bindings"></span><dl> <span data-ttu-id="545e9-172"><dt>**ASC \_ 需求 \_ PROXY 系結 \_**</dt></span><span class="sxs-lookup"><span data-stu-id="545e9-172"><dt>**ASC\_REQ\_PROXY\_BINDINGS**</dt></span></span> </dl>                                                     | <span data-ttu-id="545e9-173">表示摘要需要通道系結。</span><span class="sxs-lookup"><span data-stu-id="545e9-173">Indicates that Digest requires channel binding.</span></span><br/> <span data-ttu-id="545e9-174">此值與 **ASC 要求 \_ \_ 允許 \_ 遺漏 \_** 系結互斥。</span><span class="sxs-lookup"><span data-stu-id="545e9-174">This value is mutually exclusive with **ASC\_REQ\_ALLOW\_MISSING\_BINDINGS**.</span></span><br/> <span data-ttu-id="545e9-175">只有摘要 SSP 才支援這個值。</span><span class="sxs-lookup"><span data-stu-id="545e9-175">This value is supported only by the Digest SSP.</span></span><br/> <span data-ttu-id="545e9-176">**Windows server 2008、Windows Vista、Windows server 2003 和 WINDOWS XP：** 不支援這個值。</span><span class="sxs-lookup"><span data-stu-id="545e9-176">**Windows Server 2008, Windows Vista, Windows Server 2003 and Windows XP:** This value is not supported.</span></span><br/> <br/>                                                                                                                                         |
| <span id="ASC_REQ_REPLAY_DETECT"></span><span id="asc_req_replay_detect"></span><dl> <span data-ttu-id="545e9-177"><dt>**ASC 要求重新執行偵測 \_ \_ \_**</dt></span><span class="sxs-lookup"><span data-stu-id="545e9-177"><dt>**ASC\_REQ\_REPLAY\_DETECT**</dt></span></span> </dl>                                                        | <span data-ttu-id="545e9-178">偵測重新執行的封包。</span><span class="sxs-lookup"><span data-stu-id="545e9-178">Detect replayed packets.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| <span id="ASC_REQ_SEQUENCE_DETECT"></span><span id="asc_req_sequence_detect"></span><dl> <span data-ttu-id="545e9-179"><dt>**ASC \_ 需求 \_ 序列 \_ 偵測**</dt></span><span class="sxs-lookup"><span data-stu-id="545e9-179"><dt>**ASC\_REQ\_SEQUENCE\_DETECT**</dt></span></span> </dl>                                                  | <span data-ttu-id="545e9-180">偵測順序中所接收的訊息。</span><span class="sxs-lookup"><span data-stu-id="545e9-180">Detect messages received out of sequence.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| <span id="ASC_REQ_STREAM"></span><span id="asc_req_stream"></span><dl> <span data-ttu-id="545e9-181"><dt>**ASC \_ 需求 \_ 資料流程**</dt></span><span class="sxs-lookup"><span data-stu-id="545e9-181"><dt>**ASC\_REQ\_STREAM**</dt></span></span> </dl>                                                                              | <span data-ttu-id="545e9-182">支援資料流程導向連接。</span><span class="sxs-lookup"><span data-stu-id="545e9-182">Support a stream-oriented connection.</span></span><br/> <span data-ttu-id="545e9-183">只有 Schannel 才支援此旗標。</span><span class="sxs-lookup"><span data-stu-id="545e9-183">This flag is supported only by Schannel.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                   |



 

<span data-ttu-id="545e9-184">如需可能的屬性旗標及其意義，請參閱 [內容需求](context-requirements.md)。</span><span class="sxs-lookup"><span data-stu-id="545e9-184">For possible attribute flags and their meanings, see [Context Requirements](context-requirements.md).</span></span> <span data-ttu-id="545e9-185">用於此參數的旗標前面會加上 ASC \_ 需求，例如 asc \_ 要求 \_ 委派。</span><span class="sxs-lookup"><span data-stu-id="545e9-185">Flags used for this parameter are prefixed with ASC\_REQ, for example, ASC\_REQ\_DELEGATE.</span></span>

<span data-ttu-id="545e9-186">用戶端可能不支援要求的屬性。</span><span class="sxs-lookup"><span data-stu-id="545e9-186">The requested attributes may not be supported by the client.</span></span> <span data-ttu-id="545e9-187">如需詳細資訊，請參閱 *pfCoNtextAttr* 參數。</span><span class="sxs-lookup"><span data-stu-id="545e9-187">For more information, see the *pfContextAttr* parameter.</span></span>

</dd> <dt>

<span data-ttu-id="545e9-188">*TargetDataRep* \[在\]</span><span class="sxs-lookup"><span data-stu-id="545e9-188">*TargetDataRep* \[in\]</span></span>
</dt> <dd>

<span data-ttu-id="545e9-189">目標上的資料標記法，例如位元組順序。</span><span class="sxs-lookup"><span data-stu-id="545e9-189">The data representation, such as byte ordering, on the target.</span></span> <span data-ttu-id="545e9-190">此參數可以是安全性 \_ 原生 \_ DREP 或安全性 \_ 網路 \_ DREP。</span><span class="sxs-lookup"><span data-stu-id="545e9-190">This parameter can be either SECURITY\_NATIVE\_DREP or SECURITY\_NETWORK\_DREP.</span></span>

<span data-ttu-id="545e9-191">此參數不適用於 Schannel 或 Digest Ssp。</span><span class="sxs-lookup"><span data-stu-id="545e9-191">This parameter is not used with Schannel or Digest SSPs.</span></span> <span data-ttu-id="545e9-192">當您使用 Schannel 或 Digest Ssp 時，請為此參數指定零。</span><span class="sxs-lookup"><span data-stu-id="545e9-192">When you use Schannel or Digest SSPs, specify zero for this parameter.</span></span>

</dd> <dt>

<span data-ttu-id="545e9-193">*phNewCoNtext* \[in、out、optional\]</span><span class="sxs-lookup"><span data-stu-id="545e9-193">*phNewContext* \[in, out, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="545e9-194">[CtxtHandle](sspi-handles.md)結構的指標。</span><span class="sxs-lookup"><span data-stu-id="545e9-194">A pointer to a [CtxtHandle](sspi-handles.md) structure.</span></span> <span data-ttu-id="545e9-195">在第一次呼叫 **AcceptSecurityCoNtext (一般)** 時，此指標會收到新的內容控制碼。</span><span class="sxs-lookup"><span data-stu-id="545e9-195">On the first call to **AcceptSecurityContext (General)**, this pointer receives the new context handle.</span></span> <span data-ttu-id="545e9-196">在後續的呼叫中， *phNewCoNtext* 可以與 *phCoNtext* 參數中指定的控制碼相同。</span><span class="sxs-lookup"><span data-stu-id="545e9-196">On subsequent calls, *phNewContext* can be the same as the handle specified in the *phContext* parameter.</span></span>

</dd> <dt>

<span data-ttu-id="545e9-197">*pOutput* \[in、out、optional\]</span><span class="sxs-lookup"><span data-stu-id="545e9-197">*pOutput* \[in, out, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="545e9-198">[**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc)結構的指標，其中包含輸出緩衝區描述項。</span><span class="sxs-lookup"><span data-stu-id="545e9-198">A pointer to a [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) structure that contains the output buffer descriptor.</span></span> <span data-ttu-id="545e9-199">此緩衝區會傳送至用戶端，以輸入 [**InitializeSecurityCoNtext (一般)**](initializesecuritycontext--general.md)的其他呼叫。</span><span class="sxs-lookup"><span data-stu-id="545e9-199">This buffer is sent to the client for input into additional calls to [**InitializeSecurityContext (General)**](initializesecuritycontext--general.md).</span></span> <span data-ttu-id="545e9-200">即使函數傳回 SEC E OK，也可能產生輸出緩衝區 \_ \_ 。</span><span class="sxs-lookup"><span data-stu-id="545e9-200">An output buffer may be generated even if the function returns SEC\_E\_OK.</span></span> <span data-ttu-id="545e9-201">任何產生的緩衝區都必須傳送回用戶端應用程式。</span><span class="sxs-lookup"><span data-stu-id="545e9-201">Any buffer generated must be sent back to the client application.</span></span>

<span data-ttu-id="545e9-202">使用 Schannel 時，在輸出上，此緩衝區會接收 [*安全性內容*](../secgloss/s-gly.md)的權杖。</span><span class="sxs-lookup"><span data-stu-id="545e9-202">When using Schannel, on output, this buffer receives a token for the [*security context*](../secgloss/s-gly.md).</span></span> <span data-ttu-id="545e9-203">權杖必須傳送至用戶端。</span><span class="sxs-lookup"><span data-stu-id="545e9-203">The token must be sent to the client.</span></span> <span data-ttu-id="545e9-204">函數也可以傳回之 SECBUFFER 額外的緩衝區 \_ 。</span><span class="sxs-lookup"><span data-stu-id="545e9-204">The function can also return a buffer of type SECBUFFER\_EXTRA.</span></span> <span data-ttu-id="545e9-205">此外，呼叫端必須傳入 **之 secbuffer \_ 警示** 類型的緩衝區。</span><span class="sxs-lookup"><span data-stu-id="545e9-205">In addition, the caller must pass in a buffer of type **SECBUFFER\_ALERT**.</span></span> <span data-ttu-id="545e9-206">在輸出時，如果產生警示，此緩衝區就會包含該警示的相關資訊，而且該函式會失敗。</span><span class="sxs-lookup"><span data-stu-id="545e9-206">On output, if an alert is generated, this buffer contains information about that alert, and the function fails.</span></span>

</dd> <dt>

<span data-ttu-id="545e9-207">*pfCoNtextAttr* \[擴展\]</span><span class="sxs-lookup"><span data-stu-id="545e9-207">*pfContextAttr* \[out\]</span></span>
</dt> <dd>

<span data-ttu-id="545e9-208">變數的指標，此變數會接收一組位旗標，以指出已建立內容的屬性。</span><span class="sxs-lookup"><span data-stu-id="545e9-208">A pointer to a variable that receives a set of bit flags that indicate the attributes of the established context.</span></span> <span data-ttu-id="545e9-209">如需各種屬性的說明，請參閱 [內容需求](context-requirements.md)。</span><span class="sxs-lookup"><span data-stu-id="545e9-209">For a description of the various attributes, see [Context Requirements](context-requirements.md).</span></span> <span data-ttu-id="545e9-210">用於此參數的旗標前面會加上 ASC \_ ret，例如 asc \_ ret \_ 委派。</span><span class="sxs-lookup"><span data-stu-id="545e9-210">Flags used for this parameter are prefixed with ASC\_RET, for example, ASC\_RET\_DELEGATE.</span></span>

<span data-ttu-id="545e9-211">在最後一個函式呼叫成功傳回之前，請勿檢查安全性相關屬性。</span><span class="sxs-lookup"><span data-stu-id="545e9-211">Do not check for security-related attributes until the final function call returns successfully.</span></span> <span data-ttu-id="545e9-212">與安全性無關的屬性旗標（例如 ASC \_ RET 配置 \_ 的 \_ 記憶體旗標）可以在最後一次傳回前進行檢查。</span><span class="sxs-lookup"><span data-stu-id="545e9-212">Attribute flags not related to security, such as the ASC\_RET\_ALLOCATED\_MEMORY flag, can be checked before the final return.</span></span>

</dd> <dt>

<span data-ttu-id="545e9-213">*ptsTimeStamp* \[out、optional\]</span><span class="sxs-lookup"><span data-stu-id="545e9-213">*ptsTimeStamp* \[out, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="545e9-214">[**時間戳記**](timestamp.md)結構的指標，此結構會接收內容的到期時間。</span><span class="sxs-lookup"><span data-stu-id="545e9-214">A pointer to a [**TimeStamp**](timestamp.md) structure that receives the expiration time of the context.</span></span> <span data-ttu-id="545e9-215">我們建議 [*安全性封裝*](../secgloss/s-gly.md) 一律以當地時間傳回此值。</span><span class="sxs-lookup"><span data-stu-id="545e9-215">We recommend that the [*security package*](../secgloss/s-gly.md) always return this value in local time.</span></span>

<span data-ttu-id="545e9-216">此參數會設定為常數的最長時間。</span><span class="sxs-lookup"><span data-stu-id="545e9-216">This parameter is set to a constant maximum time.</span></span> <span data-ttu-id="545e9-217">摘要式 [*安全性內容*](../secgloss/s-gly.md)或認證或使用摘要 SSP 時，沒有到期時間。</span><span class="sxs-lookup"><span data-stu-id="545e9-217">There is no expiration time for Digest [*security context*](../secgloss/s-gly.md)s or credentials or when using the Digest SSP.</span></span>

<span data-ttu-id="545e9-218">這在使用 Schannel SSP 時是選擇性的。</span><span class="sxs-lookup"><span data-stu-id="545e9-218">This is optional when using the Schannel SSP.</span></span> <span data-ttu-id="545e9-219">當遠端物件提供要用於驗證的憑證時，此參數會收到該憑證的到期時間。</span><span class="sxs-lookup"><span data-stu-id="545e9-219">When the remote party has supplied a certificate to be used for authentication, this parameter receives the expiration time for that certificate.</span></span> <span data-ttu-id="545e9-220">如果未提供任何憑證，則會傳回最大時間值。</span><span class="sxs-lookup"><span data-stu-id="545e9-220">If no certificate was supplied, a maximum time value is returned.</span></span>

> [!Note]  
> <span data-ttu-id="545e9-221">在驗證程式的最後一個呼叫之前，內容的到期時間可能會不正確，因為在後續的協商階段中將會提供更多的資訊。</span><span class="sxs-lookup"><span data-stu-id="545e9-221">Until the last call of the authentication process, the expiration time for the context can be incorrect because more information will be provided during later stages of the negotiation.</span></span> <span data-ttu-id="545e9-222">因此，在最後一次呼叫函式之前， *ptsTimeStamp* 必須是 **Null** 。</span><span class="sxs-lookup"><span data-stu-id="545e9-222">Therefore, *ptsTimeStamp* must be **NULL** until the last call to the function.</span></span>

 

</dd> </dl>

## <a name="return-value"></a><span data-ttu-id="545e9-223">傳回值</span><span class="sxs-lookup"><span data-stu-id="545e9-223">Return value</span></span>

<span data-ttu-id="545e9-224">此函數會傳回下列其中一個值。</span><span class="sxs-lookup"><span data-stu-id="545e9-224">This function returns one of the following values.</span></span>



<table><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><thead><tr class="header"><th><span data-ttu-id="545e9-225">傳回碼/值</span><span class="sxs-lookup"><span data-stu-id="545e9-225">Return code/value</span></span></th><th><span data-ttu-id="545e9-226">Description</span><span class="sxs-lookup"><span data-stu-id="545e9-226">Description</span></span></th></tr></thead><tbody><tr class="odd"><td><dl> <span data-ttu-id="545e9-227"><dt><strong>SEC_E_BAD_BINDINGS</strong></dt> <dt>0x80090346L</dt> </span><span class="sxs-lookup"><span data-stu-id="545e9-227"><dt><strong>SEC_E_BAD_BINDINGS</strong></dt> <dt>0x80090346L</dt> </span></span></dl></td><td><span data-ttu-id="545e9-228">函數失敗。</span><span class="sxs-lookup"><span data-stu-id="545e9-228">The function failed.</span></span> <span data-ttu-id="545e9-229">未滿足通道系結原則。</span><span class="sxs-lookup"><span data-stu-id="545e9-229">Channel binding policy was not satisfied.</span></span><br/></td></tr><tr class="even"><td><dl> <span data-ttu-id="545e9-230"><dt><strong>SEC_E_INCOMPLETE_MESSAGE</strong></dt> <dt>0x80090318L</dt> </span><span class="sxs-lookup"><span data-stu-id="545e9-230"><dt><strong>SEC_E_INCOMPLETE_MESSAGE</strong></dt> <dt>0x80090318L</dt> </span></span></dl></td><td><span data-ttu-id="545e9-231">此函數已成功。</span><span class="sxs-lookup"><span data-stu-id="545e9-231">The function succeeded.</span></span> <span data-ttu-id="545e9-232">輸入緩衝區中的資料不完整。</span><span class="sxs-lookup"><span data-stu-id="545e9-232">The data in the input buffer is incomplete.</span></span> <span data-ttu-id="545e9-233">應用程式必須從用戶端讀取其他資料，然後再次呼叫 [<strong>AcceptSecurityCoNtext (一般) </strong>] (acceptsecuritycoNtext--general.md) 。</span><span class="sxs-lookup"><span data-stu-id="545e9-233">The application must read additional data from the client and call [<strong>AcceptSecurityContext (General)</strong>](acceptsecuritycontext--general.md) again.</span></span><br/> <span data-ttu-id="545e9-234">使用 Schannel SSP 時，可以傳回這個值。</span><span class="sxs-lookup"><span data-stu-id="545e9-234">This value can be returned when using the Schannel SSP.</span></span> <span data-ttu-id="545e9-235">如需此傳回值的詳細資訊，請參閱 [<strong>AcceptSecurityCoNtext (Schannel) </strong>] (acceptsecuritycoNtext--schannel.md) 。</span><span class="sxs-lookup"><span data-stu-id="545e9-235">For more information about this return value, see [<strong>AcceptSecurityContext (Schannel)</strong>](acceptsecuritycontext--schannel.md).</span></span><br/></td></tr><tr class="odd"><td><dl> <span data-ttu-id="545e9-236"><dt><strong>SEC_E_INSUFFICIENT_MEMORY</strong></dt> <dt>0x80090300L</dt> </span><span class="sxs-lookup"><span data-stu-id="545e9-236"><dt><strong>SEC_E_INSUFFICIENT_MEMORY</strong></dt> <dt>0x80090300L</dt> </span></span></dl></td><td><span data-ttu-id="545e9-237">函數失敗。</span><span class="sxs-lookup"><span data-stu-id="545e9-237">The function failed.</span></span> <span data-ttu-id="545e9-238">沒有足夠的記憶體可完成要求的動作。</span><span class="sxs-lookup"><span data-stu-id="545e9-238">There is not enough memory available to complete the requested action.</span></span><br/></td></tr><tr class="even"><td><dl> <span data-ttu-id="545e9-239"><dt><strong>SEC_E_INTERNAL_ERROR</strong></dt> <dt>0x80090304L</dt> </span><span class="sxs-lookup"><span data-stu-id="545e9-239"><dt><strong>SEC_E_INTERNAL_ERROR</strong></dt> <dt>0x80090304L</dt> </span></span></dl></td><td><span data-ttu-id="545e9-240">函數失敗。</span><span class="sxs-lookup"><span data-stu-id="545e9-240">The function failed.</span></span> <span data-ttu-id="545e9-241">發生未對應到 SSPI 錯誤碼的錯誤。</span><span class="sxs-lookup"><span data-stu-id="545e9-241">An error occurred that did not map to an SSPI error code.</span></span><br/></td></tr><tr class="odd"><td><dl> <span data-ttu-id="545e9-242"><dt><strong>SEC_E_INVALID_HANDLE</strong></dt> <dt>0x80100003L</dt> </span><span class="sxs-lookup"><span data-stu-id="545e9-242"><dt><strong>SEC_E_INVALID_HANDLE</strong></dt> <dt>0x80100003L</dt> </span></span></dl></td><td><span data-ttu-id="545e9-243">函數失敗。</span><span class="sxs-lookup"><span data-stu-id="545e9-243">The function failed.</span></span> <span data-ttu-id="545e9-244">傳遞給函數的控制碼無效。</span><span class="sxs-lookup"><span data-stu-id="545e9-244">The handle passed to the function is not valid.</span></span><br/></td></tr><tr class="even"><td><dl> <span data-ttu-id="545e9-245"><dt><strong>SEC_E_INVALID_TOKEN</strong></dt> <dt>0x80090308L</dt> </span><span class="sxs-lookup"><span data-stu-id="545e9-245"><dt><strong>SEC_E_INVALID_TOKEN</strong></dt> <dt>0x80090308L</dt> </span></span></dl></td><td><span data-ttu-id="545e9-246">函數失敗。</span><span class="sxs-lookup"><span data-stu-id="545e9-246">The function failed.</span></span> <span data-ttu-id="545e9-247">傳遞給函數的 token 無效。</span><span class="sxs-lookup"><span data-stu-id="545e9-247">The token passed to the function is not valid.</span></span><br/></td></tr><tr class="odd"><td><dl> <span data-ttu-id="545e9-248"><dt><strong>SEC_E_LOGON_DENIED</strong></dt> <dt>0x8009030CL</dt> </span><span class="sxs-lookup"><span data-stu-id="545e9-248"><dt><strong>SEC_E_LOGON_DENIED</strong></dt> <dt>0x8009030CL</dt> </span></span></dl></td><td><span data-ttu-id="545e9-249">登入失敗。</span><span class="sxs-lookup"><span data-stu-id="545e9-249">The logon failed.</span></span><br/></td></tr><tr class="even"><td><dl> <span data-ttu-id="545e9-250"><dt><strong>SEC_E_NO_AUTHENTICATING_AUTHORITY</strong></dt> <dt>0x80090311L</dt> </span><span class="sxs-lookup"><span data-stu-id="545e9-250"><dt><strong>SEC_E_NO_AUTHENTICATING_AUTHORITY</strong></dt> <dt>0x80090311L</dt> </span></span></dl></td><td><span data-ttu-id="545e9-251">函數失敗。</span><span class="sxs-lookup"><span data-stu-id="545e9-251">The function failed.</span></span> <span data-ttu-id="545e9-252">無法連絡任何授權單位進行驗證。</span><span class="sxs-lookup"><span data-stu-id="545e9-252">No authority could be contacted for authentication.</span></span> <span data-ttu-id="545e9-253">這可能是因為下列狀況：</span><span class="sxs-lookup"><span data-stu-id="545e9-253">This could be due to the following conditions:</span></span><br/><ul><li><span data-ttu-id="545e9-254">驗證方的功能變數名稱不正確。</span><span class="sxs-lookup"><span data-stu-id="545e9-254">The domain name of the authenticating party is incorrect.</span></span></li><li><span data-ttu-id="545e9-255">網域無法使用。</span><span class="sxs-lookup"><span data-stu-id="545e9-255">The domain is unavailable.</span></span></li><li><span data-ttu-id="545e9-256">信任關係失敗。</span><span class="sxs-lookup"><span data-stu-id="545e9-256">The trust relationship has failed.</span></span></li></ul></td></tr><tr class="odd"><td><dl> <span data-ttu-id="545e9-257"><dt><strong>SEC_E_NO_CREDENTIALS</strong></dt> <dt>0x8009030EL</dt> </span><span class="sxs-lookup"><span data-stu-id="545e9-257"><dt><strong>SEC_E_NO_CREDENTIALS</strong></dt> <dt>0x8009030EL</dt> </span></span></dl></td><td><span data-ttu-id="545e9-258">函數失敗。</span><span class="sxs-lookup"><span data-stu-id="545e9-258">The function failed.</span></span> <span data-ttu-id="545e9-259"><em>PhCredential</em>參數中指定的認證控制碼無效。</span><span class="sxs-lookup"><span data-stu-id="545e9-259">The credentials handle specified in the <em>phCredential</em> parameter is not valid.</span></span> <span data-ttu-id="545e9-260">使用 Digest 或 Schannel SSP 時，可以傳回這個值。</span><span class="sxs-lookup"><span data-stu-id="545e9-260">This value can be returned when using the Digest or Schannel SSP.</span></span><br/></td></tr><tr class="even"><td><dl> <span data-ttu-id="545e9-261"><dt><strong>SEC_E_OK</strong></dt> <dt>0x00000000L</dt> </span><span class="sxs-lookup"><span data-stu-id="545e9-261"><dt><strong>SEC_E_OK</strong></dt> <dt>0x00000000L</dt> </span></span></dl></td><td><span data-ttu-id="545e9-262">此函數已成功。</span><span class="sxs-lookup"><span data-stu-id="545e9-262">The function succeeded.</span></span> <span data-ttu-id="545e9-263">接受從用戶端接收的 [*安全性內容*](../secgloss/s-gly.md) 。</span><span class="sxs-lookup"><span data-stu-id="545e9-263">The [*security context*](../secgloss/s-gly.md) received from the client was accepted.</span></span> <span data-ttu-id="545e9-264">如果輸出 token 是由函式所產生，則必須將它傳送至用戶端進程。</span><span class="sxs-lookup"><span data-stu-id="545e9-264">If an output token was generated by the function, it must be sent to the client process.</span></span><br/></td></tr><tr class="odd"><td><dl> <span data-ttu-id="545e9-265"><dt><strong>SEC_E_SECURITY_QOS_FAILED</strong></dt> <dt>0x80090332L</dt> </span><span class="sxs-lookup"><span data-stu-id="545e9-265"><dt><strong>SEC_E_SECURITY_QOS_FAILED</strong></dt> <dt>0x80090332L</dt> </span></span></dl></td><td><span data-ttu-id="545e9-266">函數失敗。</span><span class="sxs-lookup"><span data-stu-id="545e9-266">The function failed.</span></span> <span data-ttu-id="545e9-267">在 <em>fCoNtextReq</em> 參數中指定了不正確內容屬性旗標。</span><span class="sxs-lookup"><span data-stu-id="545e9-267">A context attribute flag that is not valid was specified in the <em>fContextReq</em> parameter.</span></span> <span data-ttu-id="545e9-268">使用摘要 SSP 時，可以傳回這個值。</span><span class="sxs-lookup"><span data-stu-id="545e9-268">This value can be returned when using the Digest SSP.</span></span><br/></td></tr><tr class="even"><td><dl> <span data-ttu-id="545e9-269"><dt><strong>SEC_E_UNSUPPORTED_FUNCTION</strong></dt> <dt>0x80090302L</dt> </span><span class="sxs-lookup"><span data-stu-id="545e9-269"><dt><strong>SEC_E_UNSUPPORTED_FUNCTION</strong></dt> <dt>0x80090302L</dt> </span></span></dl></td><td><span data-ttu-id="545e9-270">函數失敗。</span><span class="sxs-lookup"><span data-stu-id="545e9-270">The function failed.</span></span> <span data-ttu-id="545e9-271">在 <em>fCoNtextReq</em> 參數中指定了無效 (ASC_REQ_DELEGATE 或 ASC_REQ_PROMPT_FOR_CREDS) 的內容屬性旗標。</span><span class="sxs-lookup"><span data-stu-id="545e9-271">A context attribute flag that is not valid (ASC_REQ_DELEGATE or ASC_REQ_PROMPT_FOR_CREDS) was specified in the <em>fContextReq</em> parameter.</span></span> <span data-ttu-id="545e9-272">使用 Schannel SSP 時，可以傳回這個值。</span><span class="sxs-lookup"><span data-stu-id="545e9-272">This value can be returned when using the Schannel SSP.</span></span><br/></td></tr><tr class="odd"><td><dl> <span data-ttu-id="545e9-273"><dt><strong>SEC_I_COMPLETE_AND_CONTINUE</strong></dt> <dt>0x00090314L</dt> </span><span class="sxs-lookup"><span data-stu-id="545e9-273"><dt><strong>SEC_I_COMPLETE_AND_CONTINUE</strong></dt> <dt>0x00090314L</dt> </span></span></dl></td><td><span data-ttu-id="545e9-274">此函數已成功。</span><span class="sxs-lookup"><span data-stu-id="545e9-274">The function succeeded.</span></span> <span data-ttu-id="545e9-275">伺服器必須呼叫 [<strong>CompleteAuthToken</strong>] (/windows/win32/api/sspi/nf-sspi-completeauthtoken) ，並將輸出 token 傳遞給用戶端。</span><span class="sxs-lookup"><span data-stu-id="545e9-275">The server must call [<strong>CompleteAuthToken</strong>](/windows/win32/api/sspi/nf-sspi-completeauthtoken) and pass the output token to the client.</span></span> <span data-ttu-id="545e9-276">然後伺服器會等候來自用戶端的傳回權杖，然後對 [<strong>AcceptSecurityCoNtext (一般) </strong>] (acceptsecuritycoNtext--general.md) 進行另一個呼叫。</span><span class="sxs-lookup"><span data-stu-id="545e9-276">The server then waits for a return token from the client and then makes another call to [<strong>AcceptSecurityContext (General)</strong>](acceptsecuritycontext--general.md).</span></span> <br/></td></tr><tr class="even"><td><dl> <span data-ttu-id="545e9-277"><dt><strong>SEC_I_COMPLETE_NEEDED</strong></dt> <dt>0x00090313L</dt> </span><span class="sxs-lookup"><span data-stu-id="545e9-277"><dt><strong>SEC_I_COMPLETE_NEEDED</strong></dt> <dt>0x00090313L</dt> </span></span></dl></td><td><span data-ttu-id="545e9-278">此函數已成功。</span><span class="sxs-lookup"><span data-stu-id="545e9-278">The function succeeded.</span></span> <span data-ttu-id="545e9-279">伺服器必須完成從用戶端建立訊息，然後呼叫 [<strong>CompleteAuthToken</strong>] (/windows/win32/api/sspi/nf-sspi-completeauthtoken) 函數。</span><span class="sxs-lookup"><span data-stu-id="545e9-279">The server must finish building the message from the client and then call the [<strong>CompleteAuthToken</strong>](/windows/win32/api/sspi/nf-sspi-completeauthtoken) function.</span></span><br/></td></tr><tr class="odd"><td><dl> <span data-ttu-id="545e9-280"><dt><strong>SEC_I_CONTINUE_NEEDED</strong></dt> <dt>0x00090312L</dt> </span><span class="sxs-lookup"><span data-stu-id="545e9-280"><dt><strong>SEC_I_CONTINUE_NEEDED</strong></dt> <dt>0x00090312L</dt> </span></span></dl></td><td><span data-ttu-id="545e9-281">此函數已成功。</span><span class="sxs-lookup"><span data-stu-id="545e9-281">The function succeeded.</span></span> <span data-ttu-id="545e9-282">伺服器必須將輸出 token 傳送給用戶端，並等候傳回的權杖。</span><span class="sxs-lookup"><span data-stu-id="545e9-282">The server must send the output token to the client and wait for a returned token.</span></span> <span data-ttu-id="545e9-283">傳回的權杖應該在 <em>pInput</em> 中傳遞給 [<strong>AcceptSecurityCoNtext (一般) </strong>] (acceptsecuritycoNtext--general.md) 的另一個呼叫。</span><span class="sxs-lookup"><span data-stu-id="545e9-283">The returned token should be passed in <em>pInput</em> for another call to [<strong>AcceptSecurityContext (General)</strong>](acceptsecuritycontext--general.md).</span></span><br/></td></tr><tr class="even"><td><dl> <span data-ttu-id="545e9-284"><dt><strong>STATUS_LOGON_FAILURE</strong></dt> <dt>0xC000006DL</dt> </span><span class="sxs-lookup"><span data-stu-id="545e9-284"><dt><strong>STATUS_LOGON_FAILURE</strong></dt> <dt>0xC000006DL</dt> </span></span></dl></td><td><span data-ttu-id="545e9-285">函數失敗。</span><span class="sxs-lookup"><span data-stu-id="545e9-285">The function failed.</span></span> <span data-ttu-id="545e9-286">建立指定的內容之後，會呼叫 [<strong>AcceptSecurityCoNtext (一般) </strong>] (acceptsecuritycoNtext--general.md) 函數。</span><span class="sxs-lookup"><span data-stu-id="545e9-286">The [<strong>AcceptSecurityContext (General)</strong>](acceptsecuritycontext--general.md) function was called after the specified context was established.</span></span> <span data-ttu-id="545e9-287">使用摘要 SSP 時，可以傳回這個值。</span><span class="sxs-lookup"><span data-stu-id="545e9-287">This value can be returned when using the Digest SSP.</span></span><br/></td></tr></tbody></table>



 

## <a name="remarks"></a><span data-ttu-id="545e9-288">備註</span><span class="sxs-lookup"><span data-stu-id="545e9-288">Remarks</span></span>

<span data-ttu-id="545e9-289">**AcceptSecurityCoNtext (一般)** 函數是 [**InitializeSecurityCoNtext (一般)**](initializesecuritycontext--general.md)函數的伺服器對應項。</span><span class="sxs-lookup"><span data-stu-id="545e9-289">The **AcceptSecurityContext (General)** function is the server counterpart to the [**InitializeSecurityContext (General)**](initializesecuritycontext--general.md) function.</span></span>

<span data-ttu-id="545e9-290">當伺服器收到來自用戶端的要求時，伺服器會使用 *fCoNtextReq* 參數來指定它需要的會話。</span><span class="sxs-lookup"><span data-stu-id="545e9-290">When the server receives a request from a client, the server uses the *fContextReq* parameter to specify what it requires of the session.</span></span> <span data-ttu-id="545e9-291">如此一來，伺服器可以指定用戶端必須能夠使用機密或 [*完整性*](../secgloss/i-gly.md)檢查的會話，而且它可以拒絕不符合該要求的用戶端。</span><span class="sxs-lookup"><span data-stu-id="545e9-291">In this fashion, a server can specify that clients must be capable of using a confidential or [*integrity*](../secgloss/i-gly.md)-checked session, and it can reject clients that cannot meet that demand.</span></span> <span data-ttu-id="545e9-292">或者，伺服器可能不需要任何專案，而且用戶端可以提供或需要的任何專案，都會在 *pfCoNtextAttr* 參數中傳回。</span><span class="sxs-lookup"><span data-stu-id="545e9-292">Alternatively, a server can require nothing, and whatever the client can provide or requires is returned in the *pfContextAttr* parameter.</span></span>

<span data-ttu-id="545e9-293">針對支援多階段驗證的封裝，例如相互驗證，呼叫順序如下所示：</span><span class="sxs-lookup"><span data-stu-id="545e9-293">For a package that supports multiple-leg authentication, such as mutual authentication, the calling sequence is as follows:</span></span>

1.  <span data-ttu-id="545e9-294">用戶端會將權杖傳送至伺服器。</span><span class="sxs-lookup"><span data-stu-id="545e9-294">The client transmits a token to the server.</span></span>
2.  <span data-ttu-id="545e9-295">伺服器會在第一次呼叫 **AcceptSecurityCoNtext (一般)** ，它會產生回復權杖，然後傳送至用戶端。</span><span class="sxs-lookup"><span data-stu-id="545e9-295">The server calls **AcceptSecurityContext (General)** the first time, which generates a reply token that is then sent to the client.</span></span>
3.  <span data-ttu-id="545e9-296">用戶端會接收權杖，並將它傳遞給 [**InitializeSecurityCoNtext (一般)**](initializesecuritycontext--general.md)。</span><span class="sxs-lookup"><span data-stu-id="545e9-296">The client receives the token and passes it to [**InitializeSecurityContext (General)**](initializesecuritycontext--general.md).</span></span> <span data-ttu-id="545e9-297">如果 **InitializeSecurityCoNtext (General)** 會傳回 SEC \_ E \_ OK，相互驗證已完成，而且可以開始安全的會話。</span><span class="sxs-lookup"><span data-stu-id="545e9-297">If **InitializeSecurityContext (General)** returns SEC\_E\_OK, mutual authentication has been completed and a secure session can begin.</span></span> <span data-ttu-id="545e9-298">如果 **InitializeSecurityCoNtext (一般)** 會傳回錯誤碼，則會結束相互驗證協商。</span><span class="sxs-lookup"><span data-stu-id="545e9-298">If **InitializeSecurityContext (General)** returns an error code, the mutual authentication negotiation ends.</span></span> <span data-ttu-id="545e9-299">否則，InitializeSecurityCoNtext 所傳回的安全性權杖 **(一般)** 會傳送至用戶端，並重複步驟2和3。</span><span class="sxs-lookup"><span data-stu-id="545e9-299">Otherwise, the security token returned by **InitializeSecurityContext (General)** is sent to the client, and steps 2 and 3 are repeated.</span></span>

<span data-ttu-id="545e9-300">*FCoNtextReq* 和 *pfCoNtextAttr* 參數是代表各種內容屬性的位元遮罩。</span><span class="sxs-lookup"><span data-stu-id="545e9-300">The *fContextReq* and *pfContextAttr* parameters are bitmasks that represent various context attributes.</span></span> <span data-ttu-id="545e9-301">如需各種屬性的說明，請參閱 [內容需求](context-requirements.md)。</span><span class="sxs-lookup"><span data-stu-id="545e9-301">For a description of the various attributes, see [Context Requirements](context-requirements.md).</span></span>

> [!Note]  
> <span data-ttu-id="545e9-302">*PfCoNtextAttr* 參數在任何成功傳回時都有效，但只有在最後成功傳回時，才應該檢查與內容安全性層面相關的旗標。</span><span class="sxs-lookup"><span data-stu-id="545e9-302">The *pfContextAttr* parameter is valid on any successful return, but only on the final successful return should you examine the flags pertaining to security aspects of the context.</span></span> <span data-ttu-id="545e9-303">例如，中繼傳回可以設定 ISC RET 配置的 \_ \_ \_ 記憶體旗標。</span><span class="sxs-lookup"><span data-stu-id="545e9-303">Intermediate returns can set, for example, the ISC\_RET\_ALLOCATED\_MEMORY flag.</span></span>

 

<span data-ttu-id="545e9-304">呼叫端負責判斷最終的內容屬性是否足夠。</span><span class="sxs-lookup"><span data-stu-id="545e9-304">The caller is responsible for determining whether the final context attributes are sufficient.</span></span> <span data-ttu-id="545e9-305">例如，如果要求加密)  (加密，但無法建立，有些應用程式可能會選擇立即關閉連接。</span><span class="sxs-lookup"><span data-stu-id="545e9-305">If, for example, confidentiality (encryption) was requested, but could not be established, some applications may choose to shut down the connection immediately.</span></span> <span data-ttu-id="545e9-306">如果無法建立 [*安全性內容*](../secgloss/s-gly.md) ，伺服器必須藉由呼叫 [**DeleteSecurityCoNtext**](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext) 函式來釋放部分建立的內容。</span><span class="sxs-lookup"><span data-stu-id="545e9-306">If the [*security context*](../secgloss/s-gly.md) cannot be established, the server must free the partially created context by calling the [**DeleteSecurityContext**](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext) function.</span></span> <span data-ttu-id="545e9-307">如需何時呼叫 **DeleteSecurityCoNtext** 函數的詳細資訊，請參閱 **DeleteSecurityCoNtext**。</span><span class="sxs-lookup"><span data-stu-id="545e9-307">For information about when to call the **DeleteSecurityContext** function, see **DeleteSecurityContext**.</span></span>

<span data-ttu-id="545e9-308">建立 [*安全性內容*](../secgloss/s-gly.md) 之後，伺服器應用程式可以使用 [**QuerySecurityCoNtextToken**](/windows/win32/api/sspi/nf-sspi-querysecuritycontexttoken) 函式來抓取用戶端憑證所對應之使用者帳戶的控制碼。</span><span class="sxs-lookup"><span data-stu-id="545e9-308">After the [*security context*](../secgloss/s-gly.md) has been established, the server application can use the [**QuerySecurityContextToken**](/windows/win32/api/sspi/nf-sspi-querysecuritycontexttoken) function to retrieve a handle to the user account to which the client certificate was mapped.</span></span> <span data-ttu-id="545e9-309">此外，伺服器也可以使用 [**ImpersonateSecurityCoNtext**](/windows/win32/api/sspi/nf-sspi-impersonatesecuritycontext) 函數來模擬使用者。</span><span class="sxs-lookup"><span data-stu-id="545e9-309">Also, the server can use the [**ImpersonateSecurityContext**](/windows/win32/api/sspi/nf-sspi-impersonatesecuritycontext) function to impersonate the user.</span></span>

## <a name="requirements"></a><span data-ttu-id="545e9-310">規格需求</span><span class="sxs-lookup"><span data-stu-id="545e9-310">Requirements</span></span>



| <span data-ttu-id="545e9-311">需求</span><span class="sxs-lookup"><span data-stu-id="545e9-311">Requirement</span></span> | <span data-ttu-id="545e9-312">值</span><span class="sxs-lookup"><span data-stu-id="545e9-312">Value</span></span> |
|-------------------------------------|--------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="545e9-313">最低支援的用戶端</span><span class="sxs-lookup"><span data-stu-id="545e9-313">Minimum supported client</span></span><br/> | <span data-ttu-id="545e9-314">\[僅限 WINDOWS XP desktop 應用程式\]</span><span class="sxs-lookup"><span data-stu-id="545e9-314">Windows XP \[desktop apps only\]</span></span><br/>                                                            |
| <span data-ttu-id="545e9-315">最低支援的伺服器</span><span class="sxs-lookup"><span data-stu-id="545e9-315">Minimum supported server</span></span><br/> | <span data-ttu-id="545e9-316">僅限 Windows Server 2003 \[ desktop 應用程式\]</span><span class="sxs-lookup"><span data-stu-id="545e9-316">Windows Server 2003 \[desktop apps only\]</span></span><br/>                                                   |
| <span data-ttu-id="545e9-317">標頭</span><span class="sxs-lookup"><span data-stu-id="545e9-317">Header</span></span><br/>                   | <dl> <span data-ttu-id="545e9-318"><dt>Sspi (包含 Security .h) </dt></span><span class="sxs-lookup"><span data-stu-id="545e9-318"><dt>Sspi.h (include Security.h)</dt></span></span> </dl> |
| <span data-ttu-id="545e9-319">程式庫</span><span class="sxs-lookup"><span data-stu-id="545e9-319">Library</span></span><br/>                  | <dl> <span data-ttu-id="545e9-320"><dt>Secur32 .lib</dt></span><span class="sxs-lookup"><span data-stu-id="545e9-320"><dt>Secur32.lib</dt></span></span> </dl>                 |
| <span data-ttu-id="545e9-321">DLL</span><span class="sxs-lookup"><span data-stu-id="545e9-321">DLL</span></span><br/>                      | <dl> <span data-ttu-id="545e9-322"><dt>Secur32.dll</dt></span><span class="sxs-lookup"><span data-stu-id="545e9-322"><dt>Secur32.dll</dt></span></span> </dl>                 |



## <a name="see-also"></a><span data-ttu-id="545e9-323">另請參閱</span><span class="sxs-lookup"><span data-stu-id="545e9-323">See also</span></span>

<dl> <dt>

[<span data-ttu-id="545e9-324">SSPI 函數</span><span class="sxs-lookup"><span data-stu-id="545e9-324">SSPI Functions</span></span>](authentication-functions.md#sspi-functions)
</dt> <dt>

[<span data-ttu-id="545e9-325">**DeleteSecurityCoNtext**</span><span class="sxs-lookup"><span data-stu-id="545e9-325">**DeleteSecurityContext**</span></span>](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext)
</dt> <dt>

[<span data-ttu-id="545e9-326">**InitializeSecurityCoNtext (一般)**</span><span class="sxs-lookup"><span data-stu-id="545e9-326">**InitializeSecurityContext (General)**</span></span>](initializesecuritycontext--general.md)
</dt> </dl>

 

 
