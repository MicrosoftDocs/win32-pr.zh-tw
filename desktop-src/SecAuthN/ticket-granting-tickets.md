---
description: 如同原先設計的 Kerberos 通訊協定，使用者的主要金鑰是衍生自使用者提供的密碼。
ms.assetid: b8fcb68d-751e-4495-ab92-8b70c96aaa7a
title: Ticket-Granting 票證
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 39dff161ba2d905f676fe6b6b5e7e7d5289ee550
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104113197"
---
# <a name="ticket-granting-tickets"></a><span data-ttu-id="9df93-103">Ticket-Granting 票證</span><span class="sxs-lookup"><span data-stu-id="9df93-103">Ticket-Granting Tickets</span></span>

<span data-ttu-id="9df93-104">如同原先設計的 [*Kerberos 通訊協定*](../secgloss/k-gly.md) ，使用者的主要金鑰是衍生自使用者提供的密碼。</span><span class="sxs-lookup"><span data-stu-id="9df93-104">As the [*Kerberos protocol*](../secgloss/k-gly.md) was originally designed, a master key for a user was derived from a password provided by the user.</span></span> <span data-ttu-id="9df93-105">當使用者登入時，使用者工作站上的 Kerberos 用戶端會接受使用者的密碼，並透過單向 [*雜湊*](../secgloss/h-gly.md) 函式傳遞文字，將密碼轉換成加密金鑰。</span><span class="sxs-lookup"><span data-stu-id="9df93-105">When a user logged on, the Kerberos client on the user's workstation accepted the password from the user and converted it into an encryption key by passing the text through a one-way [*hash*](../secgloss/h-gly.md) function.</span></span> <span data-ttu-id="9df93-106">產生的雜湊是使用者的 [*主要金鑰*](../secgloss/m-gly.md)。</span><span class="sxs-lookup"><span data-stu-id="9df93-106">The resulting hash was the user's [*master key*](../secgloss/m-gly.md).</span></span> <span data-ttu-id="9df93-107">用戶端使用此 *主要金鑰* 來解密從 KDC 接收的 [*工作階段金鑰*](../secgloss/s-gly.md) 。</span><span class="sxs-lookup"><span data-stu-id="9df93-107">The client used this *master key* to decrypt [*session keys*](../secgloss/s-gly.md) received from KDC.</span></span>

<span data-ttu-id="9df93-108">原始的 Kerberos 設計有個問題，就是用戶端每次從 KDC 解密工作階段金鑰時，都需要使用者的主要金鑰。</span><span class="sxs-lookup"><span data-stu-id="9df93-108">The problem with the original Kerberos design is the client needs the user's master key each time it decrypts a session key from the KDC.</span></span> <span data-ttu-id="9df93-109">這表示用戶端必須在每個用戶端/伺服器交換的開頭要求使用者輸入密碼，否則用戶端必須將使用者金鑰儲存在工作站上。</span><span class="sxs-lookup"><span data-stu-id="9df93-109">That means either the client must ask the user for the password at the beginning of every client/server exchange, or the client must store the user's key on the workstation.</span></span> <span data-ttu-id="9df93-110">頻繁的使用者中斷太過干擾。</span><span class="sxs-lookup"><span data-stu-id="9df93-110">Frequent interruptions of the user are too intrusive.</span></span> <span data-ttu-id="9df93-111">將金鑰儲存在工作站上，會危及衍生自使用者密碼的金鑰，這是長期的金鑰。</span><span class="sxs-lookup"><span data-stu-id="9df93-111">Storing the key on the workstation risks compromising a key derived from the user password which is a long term key.</span></span>

<span data-ttu-id="9df93-112">Kerberos 通訊協定的解決方法是讓用戶端從 KDC 取得暫存金鑰。</span><span class="sxs-lookup"><span data-stu-id="9df93-112">The Kerberos protocol's solution to this problem is for the client to get a temporary key from the KDC.</span></span> <span data-ttu-id="9df93-113">這個暫時金鑰只適用于此 [*登入會話*](../secgloss/l-gly.md)。</span><span class="sxs-lookup"><span data-stu-id="9df93-113">This temporary key is good only for this [*logon session*](../secgloss/l-gly.md).</span></span> <span data-ttu-id="9df93-114">當使用者登入時，用戶端會要求 KDC 的票證，就如同要求任何其他服務的票證一樣。</span><span class="sxs-lookup"><span data-stu-id="9df93-114">When a user logs on, the client requests a ticket for the KDC just as it would request a ticket for any other service.</span></span> <span data-ttu-id="9df93-115">KDC 的回應方式是建立登入工作階段金鑰和特殊伺服器的票證（KDC 的完整票證授與服務）。</span><span class="sxs-lookup"><span data-stu-id="9df93-115">The KDC responds by creating a logon session key and a ticket for a special server, the KDC's full ticket-granting service.</span></span> <span data-ttu-id="9df93-116">登入工作階段金鑰的其中一個複本內嵌在票證中，並使用 KDC 的主要金鑰來加密票證。</span><span class="sxs-lookup"><span data-stu-id="9df93-116">One copy of the logon session key is embedded in the ticket, and the ticket is encrypted with the KDC's master key.</span></span> <span data-ttu-id="9df93-117">另一個登入工作階段金鑰複本會以使用者的登入密碼所衍生的使用者主要金鑰進行加密。</span><span class="sxs-lookup"><span data-stu-id="9df93-117">Another copy of the logon session key is encrypted with the user's master key derived from the user's logon password.</span></span> <span data-ttu-id="9df93-118">票證和加密工作階段金鑰都會傳送至用戶端。</span><span class="sxs-lookup"><span data-stu-id="9df93-118">Both the ticket and the encrypted session key are sent to the client.</span></span>

<span data-ttu-id="9df93-119">當用戶端取得 KDC 的回復時，它會使用從使用者的密碼衍生的使用者主要金鑰來解密登入工作階段金鑰。</span><span class="sxs-lookup"><span data-stu-id="9df93-119">When the client gets the KDC's reply, it decrypts the logon session key with the user's master key derived from the user's password.</span></span> <span data-ttu-id="9df93-120">用戶端不再需要從使用者的密碼衍生的金鑰，因為用戶端現在會使用登入工作階段金鑰，將它從 KDC 取得之任何伺服器工作階段金鑰的複本解密。</span><span class="sxs-lookup"><span data-stu-id="9df93-120">The client no longer needs the key derived from the user's password because the client will now use the logon session key to decrypt its copy of any server session key it gets from the KDC.</span></span> <span data-ttu-id="9df93-121">用戶端會在其票證快取中儲存登入工作階段金鑰，並將其票證儲存至 KDC 的完整票證授與服務的票證。</span><span class="sxs-lookup"><span data-stu-id="9df93-121">The client stores the logon session key in its ticket cache along with its ticket for the KDC's full ticket-granting service.</span></span>

<span data-ttu-id="9df93-122">完整票證授權服務的票證稱為 (TGT) 的票證授與票證。</span><span class="sxs-lookup"><span data-stu-id="9df93-122">The ticket for the full ticket-granting service is called a ticket-granting ticket (TGT).</span></span> <span data-ttu-id="9df93-123">當用戶端向伺服器要求 KDC 的票證時，它會以驗證器訊息和票證（在此案例中為 TGT）的 [*形式呈現認證*](../secgloss/c-gly.md) ，就像向任何其他服務出示認證一樣。</span><span class="sxs-lookup"><span data-stu-id="9df93-123">When the client asks the KDC for a ticket to a server, it presents [*credentials*](../secgloss/c-gly.md) in the form of an authenticator message and a ticket — in this case a TGT — just as it would present credentials to any other service.</span></span> <span data-ttu-id="9df93-124">票證授與服務會以其主要金鑰來開啟 TGT，並解壓縮此用戶端的登入工作階段金鑰，並使用登入工作階段金鑰來加密用戶端伺服器工作階段金鑰的複本。</span><span class="sxs-lookup"><span data-stu-id="9df93-124">The ticket-granting service opens the TGT with its master key, extracts the logon session key for this client, and uses the logon session key to encrypt the client's copy of a session key for the server.</span></span>

 

 
