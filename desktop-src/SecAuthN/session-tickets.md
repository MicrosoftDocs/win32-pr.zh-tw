---
description: KDC 不會將加密的工作階段金鑰傳送給這兩個主體，而是會將用戶端和伺服器的工作階段金鑰複本傳送給用戶端。
ms.assetid: 6b20ab30-2cd9-4f2e-a26b-316980c4bc78
title: 會話票證
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 762223311dd71f8bded5e021372d3a281f711eda
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "106980831"
---
# <a name="session-tickets"></a><span data-ttu-id="325a8-103">會話票證</span><span class="sxs-lookup"><span data-stu-id="325a8-103">Session Tickets</span></span>

<span data-ttu-id="325a8-104">[KDC](key-distribution-center.md)不會將加密的工作階段金鑰傳送給這兩個主體，而是會將用戶端和伺服器的 [*工作階段金鑰*](../secgloss/s-gly.md)複本傳送給用戶端。</span><span class="sxs-lookup"><span data-stu-id="325a8-104">Instead of sending the encrypted session keys to both of the principals, the [KDC](key-distribution-center.md) sends both the client's and the server's copies of the [*session key*](../secgloss/s-gly.md) to the client.</span></span> <span data-ttu-id="325a8-105">用戶端的工作階段金鑰複本會使用用戶端的 [*主要金鑰*](../secgloss/m-gly.md) 進行加密，因此無法由任何其他實體解密。</span><span class="sxs-lookup"><span data-stu-id="325a8-105">The client's copy of the session key is encrypted with the client's [*master key*](../secgloss/m-gly.md) and therefore cannot be decrypted by any other entity.</span></span> <span data-ttu-id="325a8-106">在名為票證的資料結構中，會內嵌伺服器的工作階段金鑰複本，以及用戶端的授權資料。</span><span class="sxs-lookup"><span data-stu-id="325a8-106">The server's copy of the session key is embedded, along with authorization data about the client, in a data structure called a ticket.</span></span> <span data-ttu-id="325a8-107">票證已完全以伺服器的主要金鑰加密，因此無法由用戶端或沒有伺服器主要金鑰存取權的任何其他實體讀取或變更。</span><span class="sxs-lookup"><span data-stu-id="325a8-107">The ticket is entirely encrypted with the server's master key and therefore cannot be read or changed by the client or any other entity that does not have access to the server's master key.</span></span> <span data-ttu-id="325a8-108">用戶端必須負責安全地儲存票證，直到與伺服器聯繫為止。</span><span class="sxs-lookup"><span data-stu-id="325a8-108">It is the responsibility of the client to store the ticket safely until contact with the server.</span></span>

> [!Note]  
> <span data-ttu-id="325a8-109">KDC 只提供票證授與服務。</span><span class="sxs-lookup"><span data-stu-id="325a8-109">The KDC only provides a ticket-granting service.</span></span> <span data-ttu-id="325a8-110">用戶端和伺服器會負責維護各自的主要金鑰安全。</span><span class="sxs-lookup"><span data-stu-id="325a8-110">The client and server are responsible for keeping their respective master keys secure.</span></span>

 

<span data-ttu-id="325a8-111">當用戶端收到 KDC 的回應時，它會將票證和自己的工作階段金鑰複本解壓縮，並放在安全的快取中。</span><span class="sxs-lookup"><span data-stu-id="325a8-111">When the client receives the KDC's response, it extracts the ticket and its own copy of the session key, putting both aside in a secure cache.</span></span> <span data-ttu-id="325a8-112">若要建立與伺服器的安全會話，它會傳送包含票證的訊息，並以伺服器的主要金鑰加密，以及使用工作階段金鑰加密的 [驗證器訊息](authenticator-messages.md) 。</span><span class="sxs-lookup"><span data-stu-id="325a8-112">To establish a secure session with the server, it sends the server a message consisting of the ticket, still encrypted with the server's master key, and an [authenticator message](authenticator-messages.md) encrypted with the session key.</span></span> <span data-ttu-id="325a8-113">票證和驗證器訊息會一起是用戶端對伺服器的 [*認證*](../secgloss/c-gly.md) 。</span><span class="sxs-lookup"><span data-stu-id="325a8-113">Together, the ticket and authenticator message are the client's [*credentials*](../secgloss/c-gly.md) to the server.</span></span>

<span data-ttu-id="325a8-114">當伺服器接收來自用戶端的認證時，它會使用其 [*主要金鑰*](../secgloss/m-gly.md)來解密票證、將 [*工作階段金鑰*](../secgloss/s-gly.md)解壓縮，並使用工作階段金鑰來解密用戶端的驗證器訊息。</span><span class="sxs-lookup"><span data-stu-id="325a8-114">When the server receives credentials from a client, it decrypts the ticket with its [*master key*](../secgloss/m-gly.md), extracts the [*session key*](../secgloss/s-gly.md), and uses the session key to decrypt the client's authenticator message.</span></span> <span data-ttu-id="325a8-115">如果所有專案都已簽出，伺服器會知道用戶端的認證是由 KDC （受信任的授權單位）發出。</span><span class="sxs-lookup"><span data-stu-id="325a8-115">If everything checks out, the server knows that the client's credentials were issued by the KDC, a trusted authority.</span></span> <span data-ttu-id="325a8-116">針對相互驗證，伺服器會使用工作階段金鑰，從用戶端的驗證器訊息加密時間戳記，以進行回應。</span><span class="sxs-lookup"><span data-stu-id="325a8-116">For mutual authentication, the server responds by encrypting the time stamp from the client's authenticator message using the session key.</span></span> <span data-ttu-id="325a8-117">此加密訊息會傳送至用戶端。</span><span class="sxs-lookup"><span data-stu-id="325a8-117">This encrypted message is sent to the client.</span></span> <span data-ttu-id="325a8-118">然後，用戶端會解密訊息。</span><span class="sxs-lookup"><span data-stu-id="325a8-118">The client then decrypts the message.</span></span> <span data-ttu-id="325a8-119">如果傳回的訊息與原始驗證者訊息中的時間戳記相同，則會驗證服務器。</span><span class="sxs-lookup"><span data-stu-id="325a8-119">If the returned message is the same as the time stamp in the original authenticator message, the server is authenticated.</span></span>

<span data-ttu-id="325a8-120">除了額外的優點之外，伺服器還不需要儲存與其用戶端搭配使用的工作階段金鑰。</span><span class="sxs-lookup"><span data-stu-id="325a8-120">As an added benefit, the server does not need to store the session keys it uses with its clients.</span></span> <span data-ttu-id="325a8-121">每個用戶端都必須負責管理其票證快取中的伺服器票證，並在每次存取伺服器時呈現該票證。</span><span class="sxs-lookup"><span data-stu-id="325a8-121">It is each client's responsibility to manage the ticket for the server in its ticket cache and to present that ticket each time it accesses the server.</span></span> <span data-ttu-id="325a8-122">只要伺服器收到來自用戶端的票證，它就會使用其主要金鑰來解密票證，並將工作階段金鑰解壓縮。</span><span class="sxs-lookup"><span data-stu-id="325a8-122">Whenever the server receives a ticket from a client, it uses its master key to decrypt the ticket and extract the session key.</span></span> <span data-ttu-id="325a8-123">當伺服器不再需要工作階段金鑰時，就會刪除該金鑰。</span><span class="sxs-lookup"><span data-stu-id="325a8-123">When the server no longer needs the session key, the key is deleted.</span></span>

<span data-ttu-id="325a8-124">用戶端不需要在每次需要存取此特定伺服器的情況下存取 KDC。</span><span class="sxs-lookup"><span data-stu-id="325a8-124">The client does not need to access the KDC each time it wants access to this particular server.</span></span> <span data-ttu-id="325a8-125">您可以重複使用票證。</span><span class="sxs-lookup"><span data-stu-id="325a8-125">Tickets can be reused.</span></span> <span data-ttu-id="325a8-126">為了預防票證遭竊的可能性，票證的到期時間是由票證結構中的 KDC 指定。</span><span class="sxs-lookup"><span data-stu-id="325a8-126">As a precaution against the possibility of ticket theft, tickets have an expiration time, specified by the KDC in the ticket structure.</span></span> <span data-ttu-id="325a8-127">票證的有效時間長短取決於領域的 Kerberos 原則。</span><span class="sxs-lookup"><span data-stu-id="325a8-127">How long a ticket is valid depends on Kerberos policy for the realm.</span></span> <span data-ttu-id="325a8-128">一般來說，票證的良好時間不超過八小時，而是一般 [*登入會話*](../secgloss/l-gly.md)的長度。</span><span class="sxs-lookup"><span data-stu-id="325a8-128">Typically, tickets are good for no longer than eight hours, about the length of a normal [*logon session*](../secgloss/l-gly.md).</span></span> <span data-ttu-id="325a8-129">當用戶端工作站上的使用者登出時，會清除用戶端票證快取，並終結所有票證和用戶端工作階段金鑰。</span><span class="sxs-lookup"><span data-stu-id="325a8-129">When the user at a client workstation logs off, the client ticket cache is flushed and all tickets and client session keys are destroyed.</span></span>

 

 
