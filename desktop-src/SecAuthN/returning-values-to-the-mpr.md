---
description: Windows 網路功能 \_ 會在成功時傳回 WN 成功，如果函式遇到錯誤，則會傳回唯一的非零值。 此外，它們還會使用 WNetSetLastError 和 SetLastError 傳回擴充的錯誤資訊。
ms.assetid: cb9d29a1-b3a5-4440-a069-3cd1565b1699
title: 傳回值給 MPR
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8c96a5636f57d5c926af4e43e676f0b6db75d164
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "103944135"
---
# <a name="returning-values-to-the-mpr"></a><span data-ttu-id="5d05c-104">傳回值給 MPR</span><span class="sxs-lookup"><span data-stu-id="5d05c-104">Returning Values to the MPR</span></span>

<span data-ttu-id="5d05c-105">Windows 網路功能 \_ 會在成功時傳回 WN 成功，如果函式遇到錯誤，則會傳回唯一的非零值。</span><span class="sxs-lookup"><span data-stu-id="5d05c-105">The Windows Networking functions return WN\_SUCCESS on success, or they return a unique nonzero value if the function encounters an error.</span></span> <span data-ttu-id="5d05c-106">此外，它們還會使用 [**WNetSetLastError**](/windows/desktop/api/Npapi/nf-npapi-wnetsetlasterrora) 和 [**SetLastError**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-setlasterror)傳回擴充的錯誤資訊。</span><span class="sxs-lookup"><span data-stu-id="5d05c-106">In addition, they return extended error information using [**WNetSetLastError**](/windows/desktop/api/Npapi/nf-npapi-wnetsetlasterrora) and [**SetLastError**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-setlasterror).</span></span>

<span data-ttu-id="5d05c-107">為了支援上述行為，網路提供者函式不應該在傳回之前呼叫 [**SetLastError**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-setlasterror) 。</span><span class="sxs-lookup"><span data-stu-id="5d05c-107">To support the above behavior, network provider functions should not call [**SetLastError**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-setlasterror) before returning.</span></span> <span data-ttu-id="5d05c-108">這是因為 MPR 傳回之後，會在網路提供者 API 中呼叫函式的 **SetLastError** 。</span><span class="sxs-lookup"><span data-stu-id="5d05c-108">This is because the MPR calls **SetLastError** for the functions in the Network Provider API after they return.</span></span> <span data-ttu-id="5d05c-109">如果網路提供者直接呼叫 **SetLastError** ，則會進行重複的函式呼叫。</span><span class="sxs-lookup"><span data-stu-id="5d05c-109">If the network providers call **SetLastError** directly, they will be making redundant function calls.</span></span> <span data-ttu-id="5d05c-110">網路提供者函式應該只傳回錯誤碼。</span><span class="sxs-lookup"><span data-stu-id="5d05c-110">Network provider functions should simply return an error code.</span></span> <span data-ttu-id="5d05c-111">錯誤碼是在函數描述或傳回 [值](network-security-return-values.md)中指定。</span><span class="sxs-lookup"><span data-stu-id="5d05c-111">The error codes are specified in the function description or [Return Values](network-security-return-values.md).</span></span> <span data-ttu-id="5d05c-112">此外，網路提供者函式可能會傳回任何 [系統錯誤代碼](../debug/system-error-codes.md)，例如記憶體不足。</span><span class="sxs-lookup"><span data-stu-id="5d05c-112">Also, network provider functions may return any [System Error Codes](../debug/system-error-codes.md), such as insufficient memory.</span></span> <span data-ttu-id="5d05c-113">唯一的例外是 [**NPGetCaps**](/windows/desktop/api/Npapi/nf-npapi-npgetcaps)，它應該會傳回遮罩，指出網路提供者所支援的函式。</span><span class="sxs-lookup"><span data-stu-id="5d05c-113">The only exception is [**NPGetCaps**](/windows/desktop/api/Npapi/nf-npapi-npgetcaps), which should return a mask indicating the functions supported by the network provider.</span></span>

<span data-ttu-id="5d05c-114">如果網路提供者函式需要傳回擴充的錯誤資訊，則應該呼叫 [**WNetSetLastError**](/windows/desktop/api/Npapi/nf-npapi-wnetsetlasterrora)。</span><span class="sxs-lookup"><span data-stu-id="5d05c-114">If a network provider function needs to return extended error information, it should call [**WNetSetLastError**](/windows/desktop/api/Npapi/nf-npapi-wnetsetlasterrora).</span></span> <span data-ttu-id="5d05c-115">這項功能是由 Windows 作業系統提供，供網路提供者使用。</span><span class="sxs-lookup"><span data-stu-id="5d05c-115">This function is provided by the Windows operating system for use by network providers.</span></span> <span data-ttu-id="5d05c-116">當提供者呼叫 **WNetSetLastError** 時，可以設定字串，其中包含有關錯誤的其他資訊。</span><span class="sxs-lookup"><span data-stu-id="5d05c-116">When the provider calls **WNetSetLastError**, it can set a string containing additional information about the error.</span></span> <span data-ttu-id="5d05c-117">這項資訊是以每個執行緒為基礎來儲存。</span><span class="sxs-lookup"><span data-stu-id="5d05c-117">This information is stored on a per-thread basis.</span></span> <span data-ttu-id="5d05c-118">這類似于 [**SetLastError**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-setlasterror) Windows 應用程式。</span><span class="sxs-lookup"><span data-stu-id="5d05c-118">This is analogous to [**SetLastError**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-setlasterror) for Windows applications.</span></span> <span data-ttu-id="5d05c-119">Windows 作業系統會呼叫 **WNetSetLastError** 來檢查使用 **WNetSetLastError** 儲存的字串，如果找到的話，會將擴充的錯誤資訊傳回給起始網路要求的呼叫應用程式。</span><span class="sxs-lookup"><span data-stu-id="5d05c-119">The Windows operating system calls **WNetSetLastError** to check for a string stored using **WNetSetLastError** and, if found, returns the extended error information to the calling application that initiated the network request.</span></span>

> [!Note]  
> <span data-ttu-id="5d05c-120">[**WNetSetLastError**](/windows/desktop/api/Npapi/nf-npapi-wnetsetlasterrora)的 WNet 前置詞會誤導，因為此 API 與 **WNetSetLastError** 不同，它不是 Windows 網路功能 API 集的一部分。</span><span class="sxs-lookup"><span data-stu-id="5d05c-120">The WNet prefix of [**WNetSetLastError**](/windows/desktop/api/Npapi/nf-npapi-wnetsetlasterrora) is misleading since this API, unlike **WNetSetLastError**, is not part of the Windows Networking API set.</span></span> <span data-ttu-id="5d05c-121">**WNetSetLastError** 僅供網路提供者使用。</span><span class="sxs-lookup"><span data-stu-id="5d05c-121">**WNetSetLastError** is intended for use only by network providers.</span></span> <span data-ttu-id="5d05c-122">名稱 **WNetSetLastError** 會保留，以提供與現有提供者的相容性。</span><span class="sxs-lookup"><span data-stu-id="5d05c-122">The name, **WNetSetLastError**, is retained for compatibility with existing providers.</span></span>

 

 

 
