---
description: 讓傳輸應用程式的伺服器元件建立伺服器與遠端用戶端之間的安全性內容。
ms.assetid: a53f733e-b646-4431-b021-a2c446308849
title: AcceptSecurityCoNtext (CredSSP) 函數
ms.topic: article
ms.date: 07/25/2019
ms.openlocfilehash: 681e03ea15729cc8726d63551e8b7b0a2b39ecac
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "106983519"
---
# <a name="acceptsecuritycontext-credssp-function"></a><span data-ttu-id="bdec8-103">AcceptSecurityCoNtext (CredSSP) 函數</span><span class="sxs-lookup"><span data-stu-id="bdec8-103">AcceptSecurityContext (CredSSP) function</span></span>

<span data-ttu-id="bdec8-104">**AcceptSecurityCoNtext (CredSSP)** 函數可讓傳輸應用程式的伺服器元件建立伺服器與遠端用戶端之間的安全性內容。</span><span class="sxs-lookup"><span data-stu-id="bdec8-104">The **AcceptSecurityContext (CredSSP)** function lets the server component of a transport application establish a security context between the server and a remote client.</span></span> <span data-ttu-id="bdec8-105">遠端用戶端會呼叫 [**InitializeSecurityCoNtext (CredSSP)**](initializesecuritycontext--credssp.md) 函數來啟動建立安全性內容的程式。</span><span class="sxs-lookup"><span data-stu-id="bdec8-105">The remote client calls the [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md) function to start the process of establishing a security context.</span></span> <span data-ttu-id="bdec8-106">伺服器可能需要來自遠端用戶端的一或多個回復權杖，才能完成安全性內容的建立。</span><span class="sxs-lookup"><span data-stu-id="bdec8-106">The server can require one or more reply tokens from the remote client to complete establishing the security context.</span></span>

## <a name="syntax"></a><span data-ttu-id="bdec8-107">語法</span><span class="sxs-lookup"><span data-stu-id="bdec8-107">Syntax</span></span>

```C++
SECURITY_STATUS SEC_ENTRY AcceptSecurityContext(
  _In_opt_    PCredHandle    phCredential,
  _In_opt_    PCtxtHandle    phContext,
  _In_opt_    PSecBufferDesc pInput,
  _In_        unsigned long  fContextReq,
  _In_        unsigned long  TargetDataRep,
  _Inout_opt_ PCtxtHandle    phNewContext,
  _Inout_opt_ PSecBufferDesc pOutput,
  _Out_       unsigned long  *pfContextAttr,
  _Out_opt_   PTimeStamp     ptsExpiry
);
```

## <a name="parameters"></a><span data-ttu-id="bdec8-108">參數</span><span class="sxs-lookup"><span data-stu-id="bdec8-108">Parameters</span></span>

<span data-ttu-id="bdec8-109">*phCredential* \[在中，選擇性\]</span><span class="sxs-lookup"><span data-stu-id="bdec8-109">*phCredential* \[in, optional\]</span></span>

<span data-ttu-id="bdec8-110">伺服器認證的控制碼。</span><span class="sxs-lookup"><span data-stu-id="bdec8-110">A handle to the server credentials.</span></span> <span data-ttu-id="bdec8-111">為了取得此控制碼，伺服器會呼叫 [**AcquireCredentialsHandle (CredSSP)**](acquirecredentialshandle--credssp.md) 函式，並同時設定 SECPKG 的認證 \_ \_ 輸入或 SECPKG 認證 \_ \_ 兩個旗標。</span><span class="sxs-lookup"><span data-stu-id="bdec8-111">To retrieve this handle, the server calls the [**AcquireCredentialsHandle (CredSSP)**](acquirecredentialshandle--credssp.md) function with either the SECPKG\_CRED\_INBOUND or SECPKG\_CRED\_BOTH flag set.</span></span>

<span data-ttu-id="bdec8-112">*phCoNtext* \[在中，選擇性\]</span><span class="sxs-lookup"><span data-stu-id="bdec8-112">*phContext* \[in, optional\]</span></span>

<span data-ttu-id="bdec8-113">[CtxtHandle](sspi-handles.md)結構的指標。</span><span class="sxs-lookup"><span data-stu-id="bdec8-113">A pointer to a [CtxtHandle](sspi-handles.md) structure.</span></span> <span data-ttu-id="bdec8-114">在第一次呼叫 **AcceptSecurityCoNtext (CredSSP)** 時，此指標為 **Null**。</span><span class="sxs-lookup"><span data-stu-id="bdec8-114">On the first call to **AcceptSecurityContext (CredSSP)**, this pointer is **NULL**.</span></span> <span data-ttu-id="bdec8-115">在後續的呼叫中， *phCoNtext* 會指定第一次呼叫時，在 *phNewCoNtext* 參數中傳回的部分格式內容。</span><span class="sxs-lookup"><span data-stu-id="bdec8-115">On subsequent calls, *phContext* specifies the partially formed context returned in the *phNewContext* parameter by the first call.</span></span>

<span data-ttu-id="bdec8-116">*pInput* \[在中，選擇性\]</span><span class="sxs-lookup"><span data-stu-id="bdec8-116">*pInput* \[in, optional\]</span></span>

<span data-ttu-id="bdec8-117">用戶端呼叫所產生之 [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) 結構的指標， [**InitializeSecurityCoNtext (CredSSP)**](initializesecuritycontext--credssp.md)。</span><span class="sxs-lookup"><span data-stu-id="bdec8-117">A pointer to a [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) structure generated by a client call to [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md).</span></span> <span data-ttu-id="bdec8-118">結構包含輸入緩衝區描述項。</span><span class="sxs-lookup"><span data-stu-id="bdec8-118">The structure contains the input buffer descriptor.</span></span>

<span data-ttu-id="bdec8-119">第一個緩衝區的型別必須是 **之 secbuffer \_ TOKEN** ，並且包含從用戶端收到的安全性權杖。</span><span class="sxs-lookup"><span data-stu-id="bdec8-119">The first buffer must be of type **SECBUFFER\_TOKEN** and contain the security token received from the client.</span></span> <span data-ttu-id="bdec8-120">第二個緩衝區的類型應該是 **之 secbuffer \_ EMPTY**。</span><span class="sxs-lookup"><span data-stu-id="bdec8-120">The second buffer should be of type **SECBUFFER\_EMPTY**.</span></span>

<span data-ttu-id="bdec8-121">*fCoNtextReq* \[在\]</span><span class="sxs-lookup"><span data-stu-id="bdec8-121">*fContextReq* \[in\]</span></span>

<span data-ttu-id="bdec8-122">-位旗標，指定伺服器所需的屬性以建立內容。</span><span class="sxs-lookup"><span data-stu-id="bdec8-122">-Bit flags that specify the attributes required by the server to establish the context.</span></span> <span data-ttu-id="bdec8-123">您可以使用位 **or** 運算結合位旗標。</span><span class="sxs-lookup"><span data-stu-id="bdec8-123">Bit flags can be combined by using bitwise-**OR** operations.</span></span> <span data-ttu-id="bdec8-124">這個參數可以是下列一或多個值。</span><span class="sxs-lookup"><span data-stu-id="bdec8-124">This parameter can be one or more of the following values.</span></span>

| <span data-ttu-id="bdec8-125">值</span><span class="sxs-lookup"><span data-stu-id="bdec8-125">Value</span></span>                          | <span data-ttu-id="bdec8-126">意義</span><span class="sxs-lookup"><span data-stu-id="bdec8-126">Meaning</span></span>                                                                                                                                                                                                        |
|--------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="bdec8-127">**ASC \_ 需求 \_ 配置 \_ 記憶體**</span><span class="sxs-lookup"><span data-stu-id="bdec8-127">**ASC\_REQ\_ALLOCATE\_MEMORY**</span></span> | <span data-ttu-id="bdec8-128">認證安全性支援提供者 (CredSSP) 將會配置輸出緩衝區。</span><span class="sxs-lookup"><span data-stu-id="bdec8-128">Credential Security Support Provider (CredSSP) will allocate output buffers.</span></span> <span data-ttu-id="bdec8-129">當您完成使用輸出緩衝區時，請呼叫 [**FreeCoNtextBuffer**](/windows/win32/api/sspi/nf-sspi-freecontextbuffer) 函式釋放它們。</span><span class="sxs-lookup"><span data-stu-id="bdec8-129">When you have finished using the output buffers, free them by calling the [**FreeContextBuffer**](/windows/win32/api/sspi/nf-sspi-freecontextbuffer) function.</span></span> |
| <span data-ttu-id="bdec8-130">**ASC \_ 需求 \_ 連接**</span><span class="sxs-lookup"><span data-stu-id="bdec8-130">**ASC\_REQ\_CONNECTION**</span></span>       | <span data-ttu-id="bdec8-131">安全性內容將不會處理格式化訊息。</span><span class="sxs-lookup"><span data-stu-id="bdec8-131">The security context will not handle formatting messages.</span></span>                                                                                                                                                      |
| <span data-ttu-id="bdec8-132">**ASC \_ 需求 \_ 委派**</span><span class="sxs-lookup"><span data-stu-id="bdec8-132">**ASC\_REQ\_DELEGATE**</span></span>         | <span data-ttu-id="bdec8-133">允許伺服器模擬用戶端。</span><span class="sxs-lookup"><span data-stu-id="bdec8-133">The server is allowed to impersonate the client.</span></span> <span data-ttu-id="bdec8-134">請忽略此旗標以進行限制委派。</span><span class="sxs-lookup"><span data-stu-id="bdec8-134">Ignore this flag for constrained delegation.</span></span>                                                         |
| <span data-ttu-id="bdec8-135">**ASC \_ 需求 \_ 擴充 \_ 錯誤**</span><span class="sxs-lookup"><span data-stu-id="bdec8-135">**ASC\_REQ\_EXTENDED\_ERROR**</span></span>  | <span data-ttu-id="bdec8-136">發生錯誤時，將會通知遠端方。</span><span class="sxs-lookup"><span data-stu-id="bdec8-136">When errors occur, the remote party will be notified.</span></span>                                                                                                                                                          |
| <span data-ttu-id="bdec8-137">**ASC 要求重新執行偵測 \_ \_ \_**</span><span class="sxs-lookup"><span data-stu-id="bdec8-137">**ASC\_REQ\_REPLAY\_DETECT**</span></span>   | <span data-ttu-id="bdec8-138">偵測重新執行的封包。</span><span class="sxs-lookup"><span data-stu-id="bdec8-138">Detect replayed packets.</span></span>                                                                                                                                                                                       |
| <span data-ttu-id="bdec8-139">**ASC \_ 需求 \_ 序列 \_ 偵測**</span><span class="sxs-lookup"><span data-stu-id="bdec8-139">**ASC\_REQ\_SEQUENCE\_DETECT**</span></span> | <span data-ttu-id="bdec8-140">偵測順序中所接收的訊息。</span><span class="sxs-lookup"><span data-stu-id="bdec8-140">Detect messages received out of sequence.</span></span>                                                                                                                                                                      |
| <span data-ttu-id="bdec8-141">**ASC \_ 需求 \_ 資料流程**</span><span class="sxs-lookup"><span data-stu-id="bdec8-141">**ASC\_REQ\_STREAM**</span></span>           | <span data-ttu-id="bdec8-142">支援資料流程導向連接。</span><span class="sxs-lookup"><span data-stu-id="bdec8-142">Support a stream-oriented connection.</span></span>                                                                                                                                                                          |

<span data-ttu-id="bdec8-143">如需可能的屬性旗標及其意義，請參閱 [內容需求](context-requirements.md)。</span><span class="sxs-lookup"><span data-stu-id="bdec8-143">For possible attribute flags and their meanings, see [Context Requirements](context-requirements.md).</span></span> <span data-ttu-id="bdec8-144">用於此參數的旗標前面會加上 ASC \_ 需求，例如 asc \_ 要求 \_ 委派。</span><span class="sxs-lookup"><span data-stu-id="bdec8-144">Flags used for this parameter are prefixed with ASC\_REQ, for example, ASC\_REQ\_DELEGATE.</span></span>

<span data-ttu-id="bdec8-145">用戶端可能不支援要求的屬性。</span><span class="sxs-lookup"><span data-stu-id="bdec8-145">The requested attributes may not be supported by the client.</span></span> <span data-ttu-id="bdec8-146">如需詳細資訊，請參閱 *pfCoNtextAttr* 參數。</span><span class="sxs-lookup"><span data-stu-id="bdec8-146">For more information, see the *pfContextAttr* parameter.</span></span>

<span data-ttu-id="bdec8-147">*TargetDataRep* \[在\]</span><span class="sxs-lookup"><span data-stu-id="bdec8-147">*TargetDataRep* \[in\]</span></span>

<span data-ttu-id="bdec8-148">目標上的資料標記法，例如位元組順序。</span><span class="sxs-lookup"><span data-stu-id="bdec8-148">The data representation, such as byte ordering, on the target.</span></span> <span data-ttu-id="bdec8-149">此參數可以是 **安全性 \_ 原生 \_ DREP** 或 **安全性 \_ 網路 \_ DREP**。</span><span class="sxs-lookup"><span data-stu-id="bdec8-149">This parameter can be either **SECURITY\_NATIVE\_DREP** or **SECURITY\_NETWORK\_DREP**.</span></span>

<span data-ttu-id="bdec8-150">*phNewCoNtext* \[in、out、optional\]</span><span class="sxs-lookup"><span data-stu-id="bdec8-150">*phNewContext* \[in, out, optional\]</span></span>

<span data-ttu-id="bdec8-151">[CtxtHandle](sspi-handles.md)結構的指標。</span><span class="sxs-lookup"><span data-stu-id="bdec8-151">A pointer to a [CtxtHandle](sspi-handles.md) structure.</span></span> <span data-ttu-id="bdec8-152">在第一次呼叫 **AcceptSecurityCoNtext (CredSSP)** 時，此指標會收到新的內容控制碼。</span><span class="sxs-lookup"><span data-stu-id="bdec8-152">On the first call to **AcceptSecurityContext (CredSSP)**, this pointer receives the new context handle.</span></span> <span data-ttu-id="bdec8-153">在後續的呼叫中， *phNewCoNtext* 可以與 *phCoNtext* 參數中指定的控制碼相同。</span><span class="sxs-lookup"><span data-stu-id="bdec8-153">On subsequent calls, *phNewContext* can be the same as the handle specified in the *phContext* parameter.</span></span>

<span data-ttu-id="bdec8-154">*pOutput* \[in、out、optional\]</span><span class="sxs-lookup"><span data-stu-id="bdec8-154">*pOutput* \[in, out, optional\]</span></span>

<span data-ttu-id="bdec8-155">[**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc)結構的指標，其中包含輸出緩衝區描述項。</span><span class="sxs-lookup"><span data-stu-id="bdec8-155">A pointer to a [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) structure that contains the output buffer descriptor.</span></span> <span data-ttu-id="bdec8-156">此緩衝區會傳送至用戶端，以輸入至 [**InitializeSecurityCoNtext (CredSSP)**](initializesecuritycontext--credssp.md)的其他呼叫。</span><span class="sxs-lookup"><span data-stu-id="bdec8-156">This buffer is sent to the client for input into additional calls to [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md).</span></span> <span data-ttu-id="bdec8-157">即使函數傳回 SEC E OK，也可能產生輸出緩衝區 \_ \_ 。</span><span class="sxs-lookup"><span data-stu-id="bdec8-157">An output buffer may be generated even if the function returns SEC\_E\_OK.</span></span> <span data-ttu-id="bdec8-158">任何產生的緩衝區都必須傳送回用戶端應用程式。</span><span class="sxs-lookup"><span data-stu-id="bdec8-158">Any buffer generated must be sent back to the client application.</span></span>

<span data-ttu-id="bdec8-159">在輸出時，此緩衝區會接收資訊安全內容的權杖。</span><span class="sxs-lookup"><span data-stu-id="bdec8-159">On output, this buffer receives a token for the security context.</span></span> <span data-ttu-id="bdec8-160">權杖必須傳送至用戶端。</span><span class="sxs-lookup"><span data-stu-id="bdec8-160">The token must be sent to the client.</span></span> <span data-ttu-id="bdec8-161">函數也可以傳回之 SECBUFFER 額外的緩衝區 \_ 。</span><span class="sxs-lookup"><span data-stu-id="bdec8-161">The function can also return a buffer of type SECBUFFER\_EXTRA.</span></span>

<span data-ttu-id="bdec8-162">*pfCoNtextAttr* \[擴展\]</span><span class="sxs-lookup"><span data-stu-id="bdec8-162">*pfContextAttr* \[out\]</span></span>

<span data-ttu-id="bdec8-163">一組位旗標的指標，指出已建立內容的屬性。</span><span class="sxs-lookup"><span data-stu-id="bdec8-163">A pointer to a set of bit flags that indicate the attributes of the established context.</span></span> <span data-ttu-id="bdec8-164">如需各種屬性的說明，請參閱 [內容需求](context-requirements.md)。</span><span class="sxs-lookup"><span data-stu-id="bdec8-164">For a description of the various attributes, see [Context Requirements](context-requirements.md).</span></span> <span data-ttu-id="bdec8-165">用於此參數的旗標前面會加上 ASC \_ ret，例如 asc \_ ret \_ 委派。</span><span class="sxs-lookup"><span data-stu-id="bdec8-165">Flags used for this parameter are prefixed with ASC\_RET, for example, ASC\_RET\_DELEGATE.</span></span>

<span data-ttu-id="bdec8-166">在最後一個函式呼叫成功傳回之前，請勿檢查安全性相關屬性。</span><span class="sxs-lookup"><span data-stu-id="bdec8-166">Do not check for security-related attributes until the final function call returns successfully.</span></span> <span data-ttu-id="bdec8-167">與安全性無關的屬性旗標（例如 ASC \_ RET 配置 \_ 的 \_ 記憶體旗標）可以在最後一次傳回前進行檢查。</span><span class="sxs-lookup"><span data-stu-id="bdec8-167">Attribute flags not related to security, such as the ASC\_RET\_ALLOCATED\_MEMORY flag, can be checked before the final return.</span></span>

<span data-ttu-id="bdec8-168">*ptsExpiry* \[out、optional\]</span><span class="sxs-lookup"><span data-stu-id="bdec8-168">*ptsExpiry* \[out, optional\]</span></span>

<span data-ttu-id="bdec8-169">[**時間戳記**](timestamp.md)結構的指標，此結構會接收內容的到期時間。</span><span class="sxs-lookup"><span data-stu-id="bdec8-169">A pointer to a [**TimeStamp**](timestamp.md) structure that receives the expiration time of the context.</span></span> <span data-ttu-id="bdec8-170">我們建議安全性封裝一律以當地時間傳回此值。</span><span class="sxs-lookup"><span data-stu-id="bdec8-170">We recommend that the security package always return this value in local time.</span></span>

> [!Note]  
> <span data-ttu-id="bdec8-171">在驗證程式的最後一個呼叫之前，內容的到期時間可能會不正確，因為在後續的協商階段中將會提供更多的資訊。</span><span class="sxs-lookup"><span data-stu-id="bdec8-171">Until the last call of the authentication process, the expiration time for the context can be incorrect because more information will be provided during later stages of the negotiation.</span></span> <span data-ttu-id="bdec8-172">因此，在最後一次呼叫函式之前， *ptsTimeStamp* 必須是 **Null** 。</span><span class="sxs-lookup"><span data-stu-id="bdec8-172">Therefore, *ptsTimeStamp* must be **NULL** until the last call to the function.</span></span>

## <a name="return-value"></a><span data-ttu-id="bdec8-173">傳回值</span><span class="sxs-lookup"><span data-stu-id="bdec8-173">Return value</span></span>

<span data-ttu-id="bdec8-174">此函數會傳回下列其中一個值。</span><span class="sxs-lookup"><span data-stu-id="bdec8-174">This function returns one of the following values.</span></span>

| <span data-ttu-id="bdec8-175">傳回碼/值</span><span class="sxs-lookup"><span data-stu-id="bdec8-175">Return code/value</span></span>                                   | <span data-ttu-id="bdec8-176">Description</span><span class="sxs-lookup"><span data-stu-id="bdec8-176">Description</span></span>                                                                                                                                                                 |
|-----------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="bdec8-177">SEC_E_INCOMPLETE_MESSAGE</span><span class="sxs-lookup"><span data-stu-id="bdec8-177">SEC_E_INCOMPLETE_MESSAGE</span></span> <br/> <span data-ttu-id="bdec8-178">0x80090318L</span><span class="sxs-lookup"><span data-stu-id="bdec8-178">0x80090318L</span></span>          | <span data-ttu-id="bdec8-179">此函數已成功。</span><span class="sxs-lookup"><span data-stu-id="bdec8-179">The function succeeded.</span></span> <span data-ttu-id="bdec8-180">輸入緩衝區中的資料不完整。</span><span class="sxs-lookup"><span data-stu-id="bdec8-180">The data in the input buffer is incomplete.</span></span> <span data-ttu-id="bdec8-181">應用程式必須從用戶端讀取其他資料，並再次呼叫 [<strong>AcceptSecurityCoNtext (CredSSP) </strong>](acceptsecuritycontext--credssp.md) 。</span><span class="sxs-lookup"><span data-stu-id="bdec8-181">The application must read additional data from the client and call [<strong>AcceptSecurityContext (CredSSP)</strong>](acceptsecuritycontext--credssp.md) again.</span></span> |
| <span data-ttu-id="bdec8-182">SEC_E_INSUFFICIENT_MEMORY</span><span class="sxs-lookup"><span data-stu-id="bdec8-182">SEC_E_INSUFFICIENT_MEMORY</span></span> <br/> <span data-ttu-id="bdec8-183">0x80090300L</span><span class="sxs-lookup"><span data-stu-id="bdec8-183">0x80090300L</span></span>         | <span data-ttu-id="bdec8-184">函數失敗。</span><span class="sxs-lookup"><span data-stu-id="bdec8-184">The function failed.</span></span> <span data-ttu-id="bdec8-185">沒有足夠的記憶體可完成要求的動作。</span><span class="sxs-lookup"><span data-stu-id="bdec8-185">There is not enough memory available to complete the requested action.</span></span>                                                                                 |
| <span data-ttu-id="bdec8-186">SEC_E_INTERNAL_ERROR</span><span class="sxs-lookup"><span data-stu-id="bdec8-186">SEC_E_INTERNAL_ERROR</span></span> <br/> <span data-ttu-id="bdec8-187">0x80090304L</span><span class="sxs-lookup"><span data-stu-id="bdec8-187">0x80090304L</span></span>              | <span data-ttu-id="bdec8-188">函數失敗。</span><span class="sxs-lookup"><span data-stu-id="bdec8-188">The function failed.</span></span> <span data-ttu-id="bdec8-189">發生未對應到 SSPI 錯誤碼的錯誤。</span><span class="sxs-lookup"><span data-stu-id="bdec8-189">An error occurred that did not map to an SSPI error code.</span></span>                                                                                              |
| <span data-ttu-id="bdec8-190">SEC_E_INVALID_HANDLE</span><span class="sxs-lookup"><span data-stu-id="bdec8-190">SEC_E_INVALID_HANDLE</span></span> <br/> <span data-ttu-id="bdec8-191">0x80100003L</span><span class="sxs-lookup"><span data-stu-id="bdec8-191">0x80100003L</span></span>              | <span data-ttu-id="bdec8-192">函數失敗。</span><span class="sxs-lookup"><span data-stu-id="bdec8-192">The function failed.</span></span> <span data-ttu-id="bdec8-193">傳遞給函數的控制碼無效。</span><span class="sxs-lookup"><span data-stu-id="bdec8-193">The handle passed to the function is not valid.</span></span>                                                                                                        |
| <span data-ttu-id="bdec8-194">SEC_E_INVALID_TOKEN</span><span class="sxs-lookup"><span data-stu-id="bdec8-194">SEC_E_INVALID_TOKEN</span></span> <br/> <span data-ttu-id="bdec8-195">0x80090308L</span><span class="sxs-lookup"><span data-stu-id="bdec8-195">0x80090308L</span></span>               | <span data-ttu-id="bdec8-196">函數失敗。</span><span class="sxs-lookup"><span data-stu-id="bdec8-196">The function failed.</span></span> <span data-ttu-id="bdec8-197">傳遞給函數的 token 無效。</span><span class="sxs-lookup"><span data-stu-id="bdec8-197">The token passed to the function is not valid.</span></span>                                                                                                         |
| <span data-ttu-id="bdec8-198">SEC_E_LOGON_DENIED</span><span class="sxs-lookup"><span data-stu-id="bdec8-198">SEC_E_LOGON_DENIED</span></span> <br/> <span data-ttu-id="bdec8-199">0x8009030CL</span><span class="sxs-lookup"><span data-stu-id="bdec8-199">0x8009030CL</span></span>                | <span data-ttu-id="bdec8-200">登入失敗。</span><span class="sxs-lookup"><span data-stu-id="bdec8-200">The logon failed.</span></span>                                                                                                                                                           |
| <span data-ttu-id="bdec8-201">SEC_E_NO_AUTHENTICATING_AUTHORITY</span><span class="sxs-lookup"><span data-stu-id="bdec8-201">SEC_E_NO_AUTHENTICATING_AUTHORITY</span></span> <br/> <span data-ttu-id="bdec8-202">0x80090311L</span><span class="sxs-lookup"><span data-stu-id="bdec8-202">0x80090311L</span></span> | <span data-ttu-id="bdec8-203">函數失敗。</span><span class="sxs-lookup"><span data-stu-id="bdec8-203">The function failed.</span></span> <span data-ttu-id="bdec8-204">無法連絡任何授權單位進行驗證。</span><span class="sxs-lookup"><span data-stu-id="bdec8-204">No authority could be contacted for authentication.</span></span> <span data-ttu-id="bdec8-205">這可能是因為下列狀況：</span><span class="sxs-lookup"><span data-stu-id="bdec8-205">This could be due to the following conditions:</span></span><br/><ul><li><span data-ttu-id="bdec8-206">驗證方的功能變數名稱不正確。</span><span class="sxs-lookup"><span data-stu-id="bdec8-206">The domain name of the authenticating party is incorrect.</span></span></li><li><span data-ttu-id="bdec8-207">網域無法使用。</span><span class="sxs-lookup"><span data-stu-id="bdec8-207">The domain is unavailable.</span></span></li><li><span data-ttu-id="bdec8-208">信任關係失敗。</span><span class="sxs-lookup"><span data-stu-id="bdec8-208">The trust relationship has failed.</span></span> |
| <span data-ttu-id="bdec8-209">SEC_E_NO_CREDENTIALS</span><span class="sxs-lookup"><span data-stu-id="bdec8-209">SEC_E_NO_CREDENTIALS</span></span> <br/><span data-ttu-id="bdec8-210">0x8009030EL</span><span class="sxs-lookup"><span data-stu-id="bdec8-210">0x8009030EL</span></span>               | <span data-ttu-id="bdec8-211">函數失敗。</span><span class="sxs-lookup"><span data-stu-id="bdec8-211">The function failed.</span></span> <span data-ttu-id="bdec8-212">*PhCredential* 參數中指定的認證控制碼無效。</span><span class="sxs-lookup"><span data-stu-id="bdec8-212">The credentials handle specified in the *phCredential* parameter is not valid.</span></span>                            |
| <span data-ttu-id="bdec8-213">SEC_E_OK</span><span class="sxs-lookup"><span data-stu-id="bdec8-213">SEC_E_OK</span></span> <br/> <span data-ttu-id="bdec8-214">0x00000000L</span><span class="sxs-lookup"><span data-stu-id="bdec8-214">0x00000000L</span></span>                          | <span data-ttu-id="bdec8-215">此函數已成功。</span><span class="sxs-lookup"><span data-stu-id="bdec8-215">The function succeeded.</span></span> <span data-ttu-id="bdec8-216">接受從用戶端接收的安全性內容。</span><span class="sxs-lookup"><span data-stu-id="bdec8-216">The security context received from the client was accepted.</span></span> <span data-ttu-id="bdec8-217">如果函式產生輸出 token，則必須將標記傳送至用戶端進程。</span><span class="sxs-lookup"><span data-stu-id="bdec8-217">If the function generated an output token, the token must be sent to the client process.</span></span> |
| <span data-ttu-id="bdec8-218">SEC_E_UNSUPPORTED_FUNCTION</span><span class="sxs-lookup"><span data-stu-id="bdec8-218">SEC_E_UNSUPPORTED_FUNCTION</span></span> <br/> <span data-ttu-id="bdec8-219">0x80090302L</span><span class="sxs-lookup"><span data-stu-id="bdec8-219">0x80090302L</span></span>        | <span data-ttu-id="bdec8-220">函數失敗。</span><span class="sxs-lookup"><span data-stu-id="bdec8-220">The function failed.</span></span> <span data-ttu-id="bdec8-221">*FCoNtextReq* 參數指定了內容屬性旗標 (ASC_REQ_DELEGATE 或 ASC_REQ_PROMPT_FOR_CREDS) 無效。</span><span class="sxs-lookup"><span data-stu-id="bdec8-221">The *fContextReq* parameter specified a context attribute flag (ASC_REQ_DELEGATE or ASC_REQ_PROMPT_FOR_CREDS) that was not valid.</span></span>                       |
| <span data-ttu-id="bdec8-222">SEC_I_COMPLETE_AND_CONTINUE</span><span class="sxs-lookup"><span data-stu-id="bdec8-222">SEC_I_COMPLETE_AND_CONTINUE</span></span> <br/> <span data-ttu-id="bdec8-223">0x00090314L</span><span class="sxs-lookup"><span data-stu-id="bdec8-223">0x00090314L</span></span>       | <span data-ttu-id="bdec8-224">此函數已成功。</span><span class="sxs-lookup"><span data-stu-id="bdec8-224">The function succeeded.</span></span> <span data-ttu-id="bdec8-225">伺服器必須呼叫 [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken) ，並將輸出 token 傳遞給用戶端。</span><span class="sxs-lookup"><span data-stu-id="bdec8-225">The server must call [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken) and pass the output token to the client.</span></span> <span data-ttu-id="bdec8-226">然後，伺服器必須等待用戶端的傳回權杖，再對 [**AcceptSecurityCoNtext (CredSSP)**](acceptsecuritycontext--credssp.md)進行另一個呼叫。</span><span class="sxs-lookup"><span data-stu-id="bdec8-226">The server must then wait for a return token from the client before making another call to [**AcceptSecurityContext (CredSSP)**](acceptsecuritycontext--credssp.md).</span></span> |
| <span data-ttu-id="bdec8-227">SEC_I_COMPLETE_NEEDED</span><span class="sxs-lookup"><span data-stu-id="bdec8-227">SEC_I_COMPLETE_NEEDED</span></span> <br/> <span data-ttu-id="bdec8-228">0x00090313L</span><span class="sxs-lookup"><span data-stu-id="bdec8-228">0x00090313L</span></span>             | <span data-ttu-id="bdec8-229">此函數已成功。</span><span class="sxs-lookup"><span data-stu-id="bdec8-229">The function succeeded.</span></span> <span data-ttu-id="bdec8-230">伺服器必須先完成從用戶端建立訊息，然後再呼叫 [ **CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken)</span><span class="sxs-lookup"><span data-stu-id="bdec8-230">The server must finish building the message from the client before calling [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken)</span></span>                             |
| <span data-ttu-id="bdec8-231">SEC_I_CONTINUE_NEEDED</span><span class="sxs-lookup"><span data-stu-id="bdec8-231">SEC_I_CONTINUE_NEEDED</span></span> <br/> <span data-ttu-id="bdec8-232">0x00090312L</span><span class="sxs-lookup"><span data-stu-id="bdec8-232">0x00090312L</span></span>             | <span data-ttu-id="bdec8-233">此函數已成功。</span><span class="sxs-lookup"><span data-stu-id="bdec8-233">The function succeeded.</span></span> <span data-ttu-id="bdec8-234">伺服器必須將輸出 token 傳送給用戶端，並等候傳回的權杖。</span><span class="sxs-lookup"><span data-stu-id="bdec8-234">The server must send the output token to the client and wait for a returned token.</span></span> <span data-ttu-id="bdec8-235">針對 [**AcceptSecurityCoNtext (CredSSP)**](acceptsecuritycontext--credssp.md)的另一次呼叫，應該在 *pInput* 中傳遞傳回的權杖。</span><span class="sxs-lookup"><span data-stu-id="bdec8-235">The returned token should be passed in *pInput* for another call to [**AcceptSecurityContext (CredSSP)**](acceptsecuritycontext--credssp.md).</span></span>


## <a name="remarks"></a><span data-ttu-id="bdec8-236">備註</span><span class="sxs-lookup"><span data-stu-id="bdec8-236">Remarks</span></span>

<span data-ttu-id="bdec8-237">**AcceptSecurityCoNtext (credssp)** 函數是 [**InitializeSecurityCoNtext (CredSSP)**](initializesecuritycontext--credssp.md)函數的伺服器對應項。</span><span class="sxs-lookup"><span data-stu-id="bdec8-237">The **AcceptSecurityContext (CredSSP)** function is the server counterpart to the [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md) function.</span></span>

<span data-ttu-id="bdec8-238">當伺服器收到來自用戶端的要求時，它會使用 *fCoNtextReq* 參數來指定它需要的會話。</span><span class="sxs-lookup"><span data-stu-id="bdec8-238">When the server receives a request from a client, it uses the *fContextReq* parameter to specify what it requires of the session.</span></span> <span data-ttu-id="bdec8-239">如此一來，伺服器就可以要求用戶端能夠使用機密或 [*完整性*](../secgloss/i-gly.md)檢查的會話;它可以拒絕不符合該要求的用戶端。</span><span class="sxs-lookup"><span data-stu-id="bdec8-239">In this fashion, a server can require that clients be capable of using a confidential or [*integrity*](../secgloss/i-gly.md)-checked session; it can reject clients that cannot meet that demand.</span></span> <span data-ttu-id="bdec8-240">或者，伺服器也不需要任何東西;無論用戶端需要或可提供的內容，都會在 *pfCoNtextAttr* 參數中傳回。</span><span class="sxs-lookup"><span data-stu-id="bdec8-240">Alternatively, a server can require nothing; whatever the client requires or can provide is returned in the *pfContextAttr* parameter.</span></span>

<span data-ttu-id="bdec8-241">*FCoNtextReq* 和 *pfCoNtextAttr* 參數是代表各種內容屬性的位元遮罩。</span><span class="sxs-lookup"><span data-stu-id="bdec8-241">The *fContextReq* and *pfContextAttr* parameters are bitmasks that represent various context attributes.</span></span> <span data-ttu-id="bdec8-242">如需各種屬性的說明，請參閱 [內容需求](context-requirements.md)。</span><span class="sxs-lookup"><span data-stu-id="bdec8-242">For a description of the various attributes, see [Context Requirements](context-requirements.md).</span></span>

> [!Note]  
> <span data-ttu-id="bdec8-243">雖然 *pfCoNtextAttr* 參數在任何成功傳回時都有效，但您應該只在最終成功傳回時，檢查有關內容安全性層面的旗標。</span><span class="sxs-lookup"><span data-stu-id="bdec8-243">While the *pfContextAttr* parameter is valid on any successful return, you should examine the flags pertaining to security aspects of the context only on the final successful return.</span></span> <span data-ttu-id="bdec8-244">例如，中繼傳回可以設定 ISC RET 配置的 \_ \_ \_ 記憶體旗標。</span><span class="sxs-lookup"><span data-stu-id="bdec8-244">Intermediate returns can set, for example, the ISC\_RET\_ALLOCATED\_MEMORY flag.</span></span>

<span data-ttu-id="bdec8-245">呼叫端負責判斷最終的內容屬性是否足夠。</span><span class="sxs-lookup"><span data-stu-id="bdec8-245">The caller is responsible for determining whether the final context attributes are sufficient.</span></span> <span data-ttu-id="bdec8-246">例如，如果要求加密)  (加密，但無法建立，有些應用程式可能會選擇立即關閉連接。</span><span class="sxs-lookup"><span data-stu-id="bdec8-246">For example, if confidentiality (encryption) was requested but could not be established, some applications may choose to shut down the connection immediately.</span></span> <span data-ttu-id="bdec8-247">如果無法建立安全性內容，伺服器必須藉由呼叫 [**DeleteSecurityCoNtext**](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext) 函式來釋放部分建立的內容。</span><span class="sxs-lookup"><span data-stu-id="bdec8-247">If the security context cannot be established, the server must free the partially created context by calling the [**DeleteSecurityContext**](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext) function.</span></span> <span data-ttu-id="bdec8-248">如需何時呼叫 **DeleteSecurityCoNtext** 函數的詳細資訊，請參閱 **DeleteSecurityCoNtext**。</span><span class="sxs-lookup"><span data-stu-id="bdec8-248">For information about when to call the **DeleteSecurityContext** function, see **DeleteSecurityContext**.</span></span>

<span data-ttu-id="bdec8-249">建立安全性內容之後，伺服器應用程式可以使用 [**QuerySecurityCoNtextToken**](/windows/win32/api/sspi/nf-sspi-querysecuritycontexttoken) 函式來抓取用戶端憑證所對應之使用者帳戶的控制碼。</span><span class="sxs-lookup"><span data-stu-id="bdec8-249">After the security context has been established, the server application can use the [**QuerySecurityContextToken**](/windows/win32/api/sspi/nf-sspi-querysecuritycontexttoken) function to retrieve a handle to the user account to which the client certificate was mapped.</span></span> <span data-ttu-id="bdec8-250">此外，伺服器也可以使用 [**ImpersonateSecurityCoNtext**](/windows/win32/api/sspi/nf-sspi-impersonatesecuritycontext) 函數來模擬使用者。</span><span class="sxs-lookup"><span data-stu-id="bdec8-250">Also, the server can use the [**ImpersonateSecurityContext**](/windows/win32/api/sspi/nf-sspi-impersonatesecuritycontext) function to impersonate the user.</span></span>

## <a name="requirements"></a><span data-ttu-id="bdec8-251">規格需求</span><span class="sxs-lookup"><span data-stu-id="bdec8-251">Requirements</span></span>

| <span data-ttu-id="bdec8-252">需求</span><span class="sxs-lookup"><span data-stu-id="bdec8-252">Requirement</span></span> | <span data-ttu-id="bdec8-253">值</span><span class="sxs-lookup"><span data-stu-id="bdec8-253">Value</span></span> |
|--------------------------|-------------------------------------------|
| <span data-ttu-id="bdec8-254">最低支援的用戶端</span><span class="sxs-lookup"><span data-stu-id="bdec8-254">Minimum supported client</span></span> | <span data-ttu-id="bdec8-255">\[僅限 Windows Vista 桌面應用程式\]</span><span class="sxs-lookup"><span data-stu-id="bdec8-255">Windows�Vista \[desktop apps only\]</span></span>       |
| <span data-ttu-id="bdec8-256">最低支援的伺服器</span><span class="sxs-lookup"><span data-stu-id="bdec8-256">Minimum supported server</span></span> | <span data-ttu-id="bdec8-257">僅限 Windows Server 2008 \[ desktop 應用程式\]</span><span class="sxs-lookup"><span data-stu-id="bdec8-257">Windows Server�2008 \[desktop apps only\]</span></span> |
| <span data-ttu-id="bdec8-258">標頭</span><span class="sxs-lookup"><span data-stu-id="bdec8-258">Header</span></span>                   | <span data-ttu-id="bdec8-259">Sspi (包含 Security .h) </span><span class="sxs-lookup"><span data-stu-id="bdec8-259">Sspi.h (include Security.h)</span></span>               |
| <span data-ttu-id="bdec8-260">程式庫</span><span class="sxs-lookup"><span data-stu-id="bdec8-260">Library</span></span>                  | <span data-ttu-id="bdec8-261">Secur32 .lib</span><span class="sxs-lookup"><span data-stu-id="bdec8-261">Secur32.lib</span></span>                               |
| <span data-ttu-id="bdec8-262">DLL</span><span class="sxs-lookup"><span data-stu-id="bdec8-262">DLL</span></span>                      | <span data-ttu-id="bdec8-263">Secur32.dll</span><span class="sxs-lookup"><span data-stu-id="bdec8-263">Secur32.dll</span></span>                               |

## <a name="see-also"></a><span data-ttu-id="bdec8-264">另請參閱</span><span class="sxs-lookup"><span data-stu-id="bdec8-264">See also</span></span>

- [<span data-ttu-id="bdec8-265">SSPI 函數</span><span class="sxs-lookup"><span data-stu-id="bdec8-265">SSPI Functions</span></span>](authentication-functions.md#sspi-functions)
- [<span data-ttu-id="bdec8-266">**DeleteSecurityCoNtext**</span><span class="sxs-lookup"><span data-stu-id="bdec8-266">**DeleteSecurityContext**</span></span>](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext)
- [<span data-ttu-id="bdec8-267">**InitializeSecurityCoNtext (CredSSP)**</span><span class="sxs-lookup"><span data-stu-id="bdec8-267">**InitializeSecurityContext (CredSSP)**</span></span>](initializesecuritycontext--credssp.md)
