---
title: 驗證通訊協定初始化
description: 在用戶端與伺服器之間，以 RAS 和無線 (802.1 X) 用戶端的相同方式初始化 EAP 安全連線。
ms.assetid: 1cd5bfc9-2ba3-477c-9bbb-73578a5623c2
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 856bd173ef617fb272460f874fa1d2087322c8b4
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/19/2020
ms.locfileid: "104375132"
---
# <a name="authentication-protocol-initialization"></a><span data-ttu-id="c4f70-103">驗證通訊協定初始化</span><span class="sxs-lookup"><span data-stu-id="c4f70-103">Authentication Protocol Initialization</span></span>

<span data-ttu-id="c4f70-104">在用戶端與伺服器之間，以 RAS 和無線 (802.1 X) 用戶端的相同方式初始化 EAP 安全連線。</span><span class="sxs-lookup"><span data-stu-id="c4f70-104">The EAP secured connection is initialized between the client and server in similar ways for RAS and wireless (802.1X) clients.</span></span>

## <a name="client"></a><span data-ttu-id="c4f70-105">用戶端</span><span class="sxs-lookup"><span data-stu-id="c4f70-105">Client</span></span>

<span data-ttu-id="c4f70-106">當用戶端嘗試建立連接時，驗證服務會取得使用者的身分 [識別資訊](obtaining-identity-information.md) 。</span><span class="sxs-lookup"><span data-stu-id="c4f70-106">When the client attempts to establish the connection, the authentication service obtains [identity information](obtaining-identity-information.md) for the user.</span></span> <span data-ttu-id="c4f70-107">如果這個驗證通訊協定的登錄中有 **RAS \_ EAP \_ VALUENAME \_ INVOKE \_ NAMEDLG** 值，而且此值設定為零，則驗證服務會呼叫 [**RasEapGetIdentity**](/previous-versions/windows/desktop/api/Raseapif/nf-raseapif-raseapgetidentity)。</span><span class="sxs-lookup"><span data-stu-id="c4f70-107">If the **RAS\_EAP\_VALUENAME\_INVOKE\_NAMEDLG** value is present in the registry for this authentication protocol and this value is set to zero, the authentication service calls [**RasEapGetIdentity**](/previous-versions/windows/desktop/api/Raseapif/nf-raseapif-raseapgetidentity).</span></span> <span data-ttu-id="c4f70-108">此函式通常會顯示使用者介面，讓身分識別資訊成為驗證通訊協定的特定類型;例如，憑證或數位識別碼。</span><span class="sxs-lookup"><span data-stu-id="c4f70-108">This function typically displays a user interface that allows the identity information to be of a type specific to the authentication protocol; for example, a certificate or numeric ID.</span></span> <span data-ttu-id="c4f70-109">如果 **RAS \_ EAP \_ VALUENAME \_ INVOKE \_** 叫用 NAMEDLG 不存在，或設定為1，則驗證服務會顯示標準系統使用者名稱對話方塊。</span><span class="sxs-lookup"><span data-stu-id="c4f70-109">If **RAS\_EAP\_VALUENAME\_INVOKE\_NAMEDLG** is not present, or is set to one, the authentication service displays the standard system user-name dialog.</span></span>

<span data-ttu-id="c4f70-110">一旦驗證服務取得使用者的身分識別資訊，它就會呼叫 [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85))的驗證通訊協定的執行。</span><span class="sxs-lookup"><span data-stu-id="c4f70-110">Once the authentication service has obtained the identity information for the user, it calls the authentication protocol's implementation of [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)).</span></span> <span data-ttu-id="c4f70-111">此呼叫可讓驗證通訊協定配置和初始化工作緩衝區，讓服務在後續呼叫 [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) 和 [**RasEapEnd**](/previous-versions/windows/desktop/legacy/aa363521(v=vs.85))時傳遞。</span><span class="sxs-lookup"><span data-stu-id="c4f70-111">This call allows the authentication protocol to allocate and initialize a work buffer that the service passes on subsequent calls to [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) and [**RasEapEnd**](/previous-versions/windows/desktop/legacy/aa363521(v=vs.85)).</span></span> <span data-ttu-id="c4f70-112">工作緩衝區對服務而言是不透明的，而且永遠不會存取工作緩衝區的內容。</span><span class="sxs-lookup"><span data-stu-id="c4f70-112">The work buffer is opaque to the service and never accesses the contents of the work buffer.</span></span> <span data-ttu-id="c4f70-113">如果驗證通訊協定為每個 EAP 會話建立不同的工作緩衝區，則工作緩衝區會是會話和安全線程。</span><span class="sxs-lookup"><span data-stu-id="c4f70-113">If the authentication protocol creates a distinct work buffer for each EAP session, then the work buffer is session and thread safe.</span></span> <span data-ttu-id="c4f70-114">由於驗證通訊協定會配置工作緩衝區的記憶體，因此驗證通訊協定也應使用 [**RasEapFreeMemory**](/previous-versions/windows/desktop/api/Raseapif/nf-raseapif-raseapfreememory) 函式釋放這個記憶體。</span><span class="sxs-lookup"><span data-stu-id="c4f70-114">Because the authentication protocol allocates the memory for the work buffer, the authentication protocol should also free this memory using the [**RasEapFreeMemory**](/previous-versions/windows/desktop/api/Raseapif/nf-raseapif-raseapfreememory) function.</span></span>

<span data-ttu-id="c4f70-115">在 [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85))的呼叫中，服務也會傳遞 [**PPP \_ EAP \_ 輸入**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) 結構，其中包含連線設定資訊的指標，以及使用者的身分識別資訊。</span><span class="sxs-lookup"><span data-stu-id="c4f70-115">In the call to [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)), the service also passes a [**PPP\_EAP\_INPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) structure that contains pointers to the configuration information for the connection, and the identity information for the user.</span></span> <span data-ttu-id="c4f70-116">服務一律會傳入 **PPP \_ EAP \_ 輸入** 之 **pszIdentity** 成員的值。</span><span class="sxs-lookup"><span data-stu-id="c4f70-116">The service always passes in a value for the **pszIdentity** member of **PPP\_EAP\_INPUT**.</span></span> <span data-ttu-id="c4f70-117">不過， [**PPP \_ EAP \_ 輸入**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input)的 **pszPassword** 成員可以是 **Null**。</span><span class="sxs-lookup"><span data-stu-id="c4f70-117">However, the **pszPassword** member of [**PPP\_EAP\_INPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) may be **NULL**.</span></span>

<span data-ttu-id="c4f70-118">在 [**PPP \_ EAP \_ 輸入**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) 結構內， **fAuthenticator** 成員會指出是否要叫用驗證通訊協定，以在用戶端) 上進行驗證 (，或做為伺服器) 上的驗證器 (。</span><span class="sxs-lookup"><span data-stu-id="c4f70-118">Within the [**PPP\_EAP\_INPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) structure, the **fAuthenticator** member indicates whether the authentication protocol is being invoked to be authenticated (on the client) or as the authenticator (on the server).</span></span>

## <a name="server"></a><span data-ttu-id="c4f70-119">伺服器</span><span class="sxs-lookup"><span data-stu-id="c4f70-119">Server</span></span>

<span data-ttu-id="c4f70-120">在伺服器上， [**PPP \_ EAP \_ 輸入**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input)的 **bInitialID** 成員會指定伺服器用於第一個 EAP 封包的識別碼。</span><span class="sxs-lookup"><span data-stu-id="c4f70-120">On the server, the **bInitialID** member of [**PPP\_EAP\_INPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) specifies the ID that the server uses for the first EAP packet.</span></span> <span data-ttu-id="c4f70-121">伺服器會針對後續的封包遞增此識別碼。</span><span class="sxs-lookup"><span data-stu-id="c4f70-121">The server increments this ID for subsequent packets.</span></span>

<span data-ttu-id="c4f70-122">此外，在伺服器上， [**PPP \_ EAP \_ 輸入**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input)中的 **pUserAttributes** 指標會指向 [**RAS \_ AUTH \_ 屬性 \_ 類型**](/windows/win32/api/raseapif/ne-raseapif-ras_auth_attribute_type)類型的屬性陣列。</span><span class="sxs-lookup"><span data-stu-id="c4f70-122">Also on the server, the **pUserAttributes** pointer in [**PPP\_EAP\_INPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) points to an array of attributes of the [**RAS\_AUTH\_ATTRIBUTE\_TYPE**](/windows/win32/api/raseapif/ne-raseapif-ras_auth_attribute_type) type.</span></span> <span data-ttu-id="c4f70-123">這些是從用戶端取得之使用者的屬性。</span><span class="sxs-lookup"><span data-stu-id="c4f70-123">These are attributes for the user that were obtained from the client.</span></span>

<span data-ttu-id="c4f70-124">如果 [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)) 呼叫傳回任何 **不是 \_ 錯誤** 的值，會話就會中斷連線。</span><span class="sxs-lookup"><span data-stu-id="c4f70-124">If the [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)) call returns any value other than **NO\_ERROR**, the session is disconnected.</span></span> <span data-ttu-id="c4f70-125">傳回的錯誤會記錄在伺服器) 上 (，或顯示給用戶端) 上的使用者 (。</span><span class="sxs-lookup"><span data-stu-id="c4f70-125">The returned error is logged (on the server), or displayed to the user (on the client).</span></span>

 

 