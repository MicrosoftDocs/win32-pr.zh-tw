---
description: 自動代理快取
ms.assetid: 087104e8-ab38-4ba4-be70-23a5ea2bb130
title: 自動代理快取
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6d0492bec116bad8a82da0e961cf6d851d27c787
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "106984728"
---
# <a name="autoproxy-cache"></a><span data-ttu-id="32cee-103">自動代理快取</span><span class="sxs-lookup"><span data-stu-id="32cee-103">AutoProxy Cache</span></span>

<span data-ttu-id="32cee-104">[**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl)函式會針對指定的 URL，以每個要求為基礎執行自動代理程式查閱。</span><span class="sxs-lookup"><span data-stu-id="32cee-104">The [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) function performs autoproxy lookup on a per-request basis for the specified URL.</span></span> <span data-ttu-id="32cee-105">如果傳回多個 proxy，用戶端應用程式應該在傳送要求之前測試每個 proxy (如需詳細資訊，請參閱 WinHTTP 中的自動代理程式問題中， [目前唯一支援的 Proxy 伺服器](autoproxy-issues-in-winhttp.md) 一節) 。</span><span class="sxs-lookup"><span data-stu-id="32cee-105">If multiple proxies are returned, client applications should test each proxy before sending the request (for more information, see the [Only One Proxy Server is Currently Supported](autoproxy-issues-in-winhttp.md) section in AutoProxy Issues in WinHTTP).</span></span> <span data-ttu-id="32cee-106">當用戶端指定自動 proxy 探索時，本主題中的資訊適用于 **WinHttpGetProxyForUrl** 的呼叫。</span><span class="sxs-lookup"><span data-stu-id="32cee-106">The information in this topic applies to calls to **WinHttpGetProxyForUrl** when the client specifies automatic proxy discovery.</span></span>

<span data-ttu-id="32cee-107">[**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) 可選擇性地找到自動代理程式 URL，並從該網站下載自動代理程式腳本。</span><span class="sxs-lookup"><span data-stu-id="32cee-107">[**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) optionally locates the autoproxy URL and downloads the autoproxy script from that site.</span></span> <span data-ttu-id="32cee-108">WinHttp 使用自動代理腳本來尋找 proxy 伺服器。</span><span class="sxs-lookup"><span data-stu-id="32cee-108">WinHttp uses the autoproxy script to locate the proxy servers.</span></span> <span data-ttu-id="32cee-109">針對指定的會話，會快取自動代理程式 URL 和自動代理程式腳本。</span><span class="sxs-lookup"><span data-stu-id="32cee-109">Both the autoproxy URL and the autoproxy script are cached for the specified session.</span></span> <span data-ttu-id="32cee-110">每個會話只會快取一個自動代理程式 URL 和腳本。</span><span class="sxs-lookup"><span data-stu-id="32cee-110">Only one autoproxy URL and script are cached for each session.</span></span> <span data-ttu-id="32cee-111">一般而言，會快取自動代理腳本和 URL，直到與該電腦相關聯的 IP 位址變更為止。</span><span class="sxs-lookup"><span data-stu-id="32cee-111">Typically, the autoproxy script and URL are cached until the IP address associated with the computer changes.</span></span> <span data-ttu-id="32cee-112">如果在呼叫 **WinHttpGetProxyForUrl** 期間偵測到新的 IP 位址，則呼叫會嘗試找出新的自動代理程式 URL 和腳本，並快取結果。</span><span class="sxs-lookup"><span data-stu-id="32cee-112">If a new IP address is detected during a call to **WinHttpGetProxyForUrl**, the call will attempt to locate a new autoproxy URL and script and cache the results.</span></span> <span data-ttu-id="32cee-113">每個會話只應允許一位使用者，如此一來，快取的資料就不會與電腦上的其他使用者共用。</span><span class="sxs-lookup"><span data-stu-id="32cee-113">Only one user should be allowed per session, so that the cached data is not shared with other users on the computer.</span></span> <span data-ttu-id="32cee-114">如需詳細資訊，請參閱 [WinHTTP 會話總覽](winhttp-sessions-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="32cee-114">For more information, see [WinHTTP Sessions Overview](winhttp-sessions-overview.md).</span></span>

<span data-ttu-id="32cee-115">當呼叫 [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) 時，如果進程外服務在使用中，則會將快取的自動代理程式 URL 和腳本提供給整部電腦使用。</span><span class="sxs-lookup"><span data-stu-id="32cee-115">If the out-of-process service is active when [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) is called, the cached autoproxy URL and script are available to the whole computer.</span></span> <span data-ttu-id="32cee-116">但是，如果使用跨進程服務，而且 *pAutoProxyOptions* 結構中的 **fAutoLogonIfChallenged** 旗標為 true，則不會快取自動代理程式 URL 和腳本。</span><span class="sxs-lookup"><span data-stu-id="32cee-116">However, if the out-of-process service is used, and the **fAutoLogonIfChallenged** flag in the *pAutoProxyOptions* structure is true, then the autoproxy URL and script are not cached.</span></span> <span data-ttu-id="32cee-117">因此，將 **fAutoLogonIfChallenged** 成員設為 **TRUE** 時，呼叫 **WinHttpGetProxyForUrl** 會導致額外的額外負荷作業，這些作業可能會影響效能。</span><span class="sxs-lookup"><span data-stu-id="32cee-117">Therefore, calling **WinHttpGetProxyForUrl** with the **fAutoLogonIfChallenged** member set to **TRUE** results in additional overhead operations that may affect performance.</span></span> <span data-ttu-id="32cee-118">您可以使用下列步驟來改善效能。</span><span class="sxs-lookup"><span data-stu-id="32cee-118">The following steps can be used to improve performance.</span></span>

<span data-ttu-id="32cee-119">**改善效能**</span><span class="sxs-lookup"><span data-stu-id="32cee-119">**To improve performance**</span></span>

1.  <span data-ttu-id="32cee-120">呼叫 [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) ，並將 fAutoLogonIfChallenged 參數設定為 **false**。</span><span class="sxs-lookup"><span data-stu-id="32cee-120">Call [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) with the fAutoLogonIfChallenged parameter set to **false**.</span></span> <span data-ttu-id="32cee-121">系統會快取自動代理程式 URL 和腳本，以供未來呼叫 **WinHttpGetProxyForUrl**。</span><span class="sxs-lookup"><span data-stu-id="32cee-121">The autoproxy URL and script are cached for future calls to **WinHttpGetProxyForUrl**.</span></span>
2.  <span data-ttu-id="32cee-122">如果步驟1失敗，發生 **錯誤 \_ WINHTTP \_ 登入 \_ 失敗** 時，請呼叫 [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) ，並將 **fAutoLogonIfChallenged** 成員設為 **TRUE**。</span><span class="sxs-lookup"><span data-stu-id="32cee-122">If Step 1 fails, with **ERROR\_WINHTTP\_LOGIN\_FAILURE**, then call [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) with the **fAutoLogonIfChallenged** member set to **TRUE**.</span></span>

 

 



