---
description: 本主題說明 WinHTTP 5.1 版和5.0 版之間最重要的差異。
ms.assetid: df3fcf27-3012-4818-b29c-b8a4dc409828
title: WinHTTP 5.1 的新功能
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 909d5ae8fb1d169af01782d21d2ead56b25c940c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "106974040"
---
# <a name="whats-new-in-winhttp-51"></a><span data-ttu-id="6aef0-103">WinHTTP 5.1 的新功能</span><span class="sxs-lookup"><span data-stu-id="6aef0-103">What's New in WinHTTP 5.1</span></span>

<span data-ttu-id="6aef0-104">本主題說明 WinHTTP 5.1 版和5.0 版之間最重要的差異。</span><span class="sxs-lookup"><span data-stu-id="6aef0-104">This topic describes the most important differences between WinHTTP version 5.1 and version 5.0.</span></span> <span data-ttu-id="6aef0-105">其中有許多差異需要將應用程式中的程式碼變更從5.0 版遷移至5.1 版。</span><span class="sxs-lookup"><span data-stu-id="6aef0-105">Many of these differences require code changes in applications migrating from version 5.0 to version 5.1.</span></span> <span data-ttu-id="6aef0-106">版本5.1 中的部分功能只有在 Windows Server 2003 和 Windows XP Service Pack 2 (SP2) 才有提供，特別是為了改善用戶端與惡意網頁伺服器的安全性有關的功能。</span><span class="sxs-lookup"><span data-stu-id="6aef0-106">Some of the features in version 5.1 are only available starting with Windows Server 2003 and Windows XP with Service Pack 2 (SP2), particularly features related to improving the security of the client against malicious Web servers.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="6aef0-107">隨著 WinHTTP 5.1 版的發行，將不再提供 WinHTTP 5.0 下載。</span><span class="sxs-lookup"><span data-stu-id="6aef0-107">With the release of WinHTTP Version 5.1, the WinHTTP 5.0 download is no longer available.</span></span> <span data-ttu-id="6aef0-108">自2004年10月1日起，Microsoft 已從 MSDN 移除 WinHTTP 5.0 SDK 下載，並已終止版本5.0 的產品支援。</span><span class="sxs-lookup"><span data-stu-id="6aef0-108">As of October 1, 2004, Microsoft has removed the WinHTTP 5.0 SDK download from MSDN and has terminated product support for version 5.0.</span></span>

 

## <a name="dll-name-change"></a><span data-ttu-id="6aef0-109">DLL 名稱變更</span><span class="sxs-lookup"><span data-stu-id="6aef0-109">DLL Name Change</span></span>

<span data-ttu-id="6aef0-110">新的 WinHTTP 5.1 DLL 的名稱是 Winhttp.dll，而 WinHTTP 5.0 DLL 的名稱則是 Winhttp5.dll。</span><span class="sxs-lookup"><span data-stu-id="6aef0-110">The name of the new WinHTTP 5.1 DLL is Winhttp.dll, whereas the name of the WinHTTP 5.0 DLL is Winhttp5.dll.</span></span>

<span data-ttu-id="6aef0-111">WinHTTP 5.0 和5.1 可並存于同一個系統;WinHTTP 5.1 不會取代或安裝 WinHTTP 5.0。</span><span class="sxs-lookup"><span data-stu-id="6aef0-111">WinHTTP 5.0 and 5.1 can coexist on the same system; WinHTTP 5.1 does not replace, or install over, WinHTTP 5.0.</span></span>

## <a name="redistribution"></a><span data-ttu-id="6aef0-112">可轉散發</span><span class="sxs-lookup"><span data-stu-id="6aef0-112">Redistribution</span></span>

<span data-ttu-id="6aef0-113">WinHTTP 5.1 僅適用于 Windows Server 2003、Windows 2000 Professional Service Pack 3 (SP3) 、Windows XP 加裝 Service Pack 1 (SP1) 和更新版本的作業系統。</span><span class="sxs-lookup"><span data-stu-id="6aef0-113">WinHTTP 5.1 is available only with Windows Server 2003, Windows 2000 Professional with Service Pack 3 (SP3), Windows XP with Service Pack 1 (SP1), and later operating systems.</span></span> <span data-ttu-id="6aef0-114">適用于 WinHTTP 5.1 的可轉散發合併模組 ( .msm) 檔案無法使用。</span><span class="sxs-lookup"><span data-stu-id="6aef0-114">A redistributable merge module (.msm) file is not available for WinHTTP 5.1.</span></span>

## <a name="winhttprequest-progid"></a><span data-ttu-id="6aef0-115">WinHttpRequest ProgID</span><span class="sxs-lookup"><span data-stu-id="6aef0-115">WinHttpRequest ProgID</span></span>

<span data-ttu-id="6aef0-116">WinHttpRequest 元件的 ProgID 已從 "WinHttp. WinHttpRequest. 5" 變更為 "WinHttp. WinHttpRequest. 5.1"。</span><span class="sxs-lookup"><span data-stu-id="6aef0-116">The ProgID of the WinHttpRequest component has changed from "WinHttp.WinHttpRequest.5" to "WinHttp.WinHttpRequest.5.1".</span></span> <span data-ttu-id="6aef0-117">[**WinHttpRequest**](winhttprequest.md)類別的 CLSID 也已變更。</span><span class="sxs-lookup"><span data-stu-id="6aef0-117">The CLSID of the [**WinHttpRequest**](winhttprequest.md) class has also changed.</span></span>

## <a name="async-callback-behavior-change"></a><span data-ttu-id="6aef0-118">非同步回呼行為變更</span><span class="sxs-lookup"><span data-stu-id="6aef0-118">Async Callback Behavior Change</span></span>

<span data-ttu-id="6aef0-119">在非同步模式中呼叫 [**WinHttpWriteData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpwritedata)、 [**WinHttpQueryDataAvailable**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpquerydataavailable) 和 [**WinHttpReadData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreaddata) 函式時，請勿依賴要設定的個別 *lpdwNumberOfBytesWritten*、 *lpdwNumberOfBytesAvailable* 和 *lpdwNumberOfBytesRead* OUT 參數。</span><span class="sxs-lookup"><span data-stu-id="6aef0-119">When calling the [**WinHttpWriteData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpwritedata), [**WinHttpQueryDataAvailable**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpquerydataavailable) and [**WinHttpReadData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreaddata) functions in asynchronous mode, do not rely on the respective *lpdwNumberOfBytesWritten*, *lpdwNumberOfBytesAvailable*, and *lpdwNumberOfBytesRead* OUT parameters to be set.</span></span> <span data-ttu-id="6aef0-120">如果函式呼叫以非同步方式完成，則 WinHTTP 不會寫入應用程式程式碼所提供的這些指標。</span><span class="sxs-lookup"><span data-stu-id="6aef0-120">If the function call completes asynchronously, WinHTTP does not write to these pointers supplied by the application code.</span></span> <span data-ttu-id="6aef0-121">相反地，應用程式應該使用 *lpvStatusInformation* 和 *dwStatusInformationLength* 參數將這些值取出至回呼函數。</span><span class="sxs-lookup"><span data-stu-id="6aef0-121">Instead, the application should retrieve these values using *lpvStatusInformation* and *dwStatusInformationLength* parameters to the callback function.</span></span>

## <a name="changes-to-default-settings"></a><span data-ttu-id="6aef0-122">預設設定的變更</span><span class="sxs-lookup"><span data-stu-id="6aef0-122">Changes to Default Settings</span></span>

<span data-ttu-id="6aef0-123">預設設定的變更包括：</span><span class="sxs-lookup"><span data-stu-id="6aef0-123">Changes to default settings include:</span></span>

-   <span data-ttu-id="6aef0-124">WinHTTP 5.1 中預設會啟用 SSL 伺服器憑證驗證。</span><span class="sxs-lookup"><span data-stu-id="6aef0-124">SSL server certificate verification is enabled by default in WinHTTP 5.1.</span></span> <span data-ttu-id="6aef0-125">當驗證伺服器憑證為嚴重錯誤時，WinHTTP 5.0 不會處理發生的失敗;系統會使用 **安全的 \_ 失敗** 回呼通知將它們回報給應用程式，但不會導致要求中止。</span><span class="sxs-lookup"><span data-stu-id="6aef0-125">WinHTTP 5.0 does not handle failures encountered when validating the server certificate as fatal errors; they are reported to the application using a **SECURE\_FAILURE** callback notification, but does not cause the request to be aborted.</span></span> <span data-ttu-id="6aef0-126">此外，WinHTTP 5.1 也會將伺服器憑證驗證失敗視為嚴重錯誤，以中止要求。</span><span class="sxs-lookup"><span data-stu-id="6aef0-126">WinHTTP 5.1, alternatively, handles server certificate validation failures as fatal errors that abort the request.</span></span> <span data-ttu-id="6aef0-127">應用程式可以使用 **winHTTP \_ 選項 \_ 安全性 \_ 旗標** 選項，指示 WinHTTP 忽略一小部分的憑證錯誤，例如未知的 CA、無效/過期的憑證日期，或不正確憑證主體名稱。</span><span class="sxs-lookup"><span data-stu-id="6aef0-127">The application can instruct WinHTTP to ignore a small subset of certificate errors such as unknown CA, invalid/expired certificate date, or invalid certificate subject name, using the **WINHTTP\_OPTION\_SECURITY\_FLAGS** option.</span></span>
-   <span data-ttu-id="6aef0-128">WinHTTP 5.1 中預設會停用 Passport 驗證支援。</span><span class="sxs-lookup"><span data-stu-id="6aef0-128">Passport authentication support is disabled by default in WinHTTP 5.1.</span></span> <span data-ttu-id="6aef0-129">您可以使用 **WINHTTP \_ 選項 [ \_ 設定 \_ passport \_ 驗證** ] 選項來啟用 Passport 支援。</span><span class="sxs-lookup"><span data-stu-id="6aef0-129">Passport support can be enabled with the **WINHTTP\_OPTION\_CONFIGURE\_PASSPORT\_AUTH** option.</span></span> <span data-ttu-id="6aef0-130">Keyring 中的自動 Passport 認證查閱預設也會停用。</span><span class="sxs-lookup"><span data-stu-id="6aef0-130">Automatic Passport credential look-up in the Keyring is also disabled by default.</span></span>
-   <span data-ttu-id="6aef0-131">重新導向行為變更：基於安全性理由，根據預設，HTTP 會將 url 從安全的 **HTTPs** 重新導向至一般 **HTTP：** url，因此不會再自動遵循。</span><span class="sxs-lookup"><span data-stu-id="6aef0-131">Redirect behavior change: HTTP redirects from a secure **https:** URL to a regular **http:** URL are no longer followed automatically by default for security reasons.</span></span> <span data-ttu-id="6aef0-132">有新的選項 [ **WINHTTP \_ 選項重新 \_ 導向] \_ 原則**，可覆寫 winHTTP 5.1 中的預設重新導向行為。</span><span class="sxs-lookup"><span data-stu-id="6aef0-132">There is a new option, **WINHTTP\_OPTION\_REDIRECT\_POLICY**, to override the default redirect behavior in WinHTTP 5.1.</span></span> <span data-ttu-id="6aef0-133">使用 **WinHttpRequest** COM 元件時，請使用 [新增 **WinHttpRequestOption \_ EnableHttpsToHttpRedirects** ] 選項，以啟用從 Https：到 HTTP： url 的重新導向。</span><span class="sxs-lookup"><span data-stu-id="6aef0-133">With the **WinHttpRequest** COM component, use the new **WinHttpRequestOption\_EnableHttpsToHttpRedirects** option to enable redirects from https: to http: URLs.</span></span>
-   <span data-ttu-id="6aef0-134">建立 WinHTTP 追蹤檔時，存取權會受到 ACL 的限制，因此只有系統管理員可以讀取或寫入檔案。</span><span class="sxs-lookup"><span data-stu-id="6aef0-134">When a WinHTTP trace file is created, access is restricted with an ACL such that only administrators can read or write the file.</span></span> <span data-ttu-id="6aef0-135">用來建立 tracefile 的使用者帳戶也可以修改 ACL，以授與其他人存取權。</span><span class="sxs-lookup"><span data-stu-id="6aef0-135">The user account under which the tracefile was created can also modify the ACL to grant others access.</span></span> <span data-ttu-id="6aef0-136">這項保護僅適用于支援安全性的檔案系統;也就是 NTFS，而非 FAT32) 。</span><span class="sxs-lookup"><span data-stu-id="6aef0-136">This protection is available only on file systems which support security; that is, NTFS, not FAT32).</span></span>
-   <span data-ttu-id="6aef0-137">從 Windows Server 2003 和 Windows XP （含 SP2）開始，將要求傳送至下列已知的非 HTTP 埠，會因為安全考慮而受到限制： 21 (FTP) 、25 (SMTP) 、70 (GOPHER) 、110 (POP3) 、119 (NNTP) 、143 (IMAP) 。</span><span class="sxs-lookup"><span data-stu-id="6aef0-137">Starting with Windows Server 2003 and Windows XP with SP2, sending requests to the following well-known, non-HTTP, ports is restricted for security reasons: 21 (FTP), 25 (SMTP), 70 (GOPHER), 110 (POP3), 119 (NNTP), 143 (IMAP).</span></span>
-   <span data-ttu-id="6aef0-138">從 Windows Server 2003 和 Windows XP （含 SP2）開始，在 HTTP 回應中接受的標頭資料的最大數量是64K （預設值）。</span><span class="sxs-lookup"><span data-stu-id="6aef0-138">Starting with Windows Server 2003, and Windows XP with SP2, the maximum amount of header data WinHTTP accepts in an HTTP response is 64K, by default.</span></span> <span data-ttu-id="6aef0-139">如果伺服器 HTTP 回應包含更多64K 的總標頭資料，WinHTTP 將要求失敗，並出現 **錯誤 \_ WinHTTP 不正確 \_ \_ 伺服器 \_ 回應** 錯誤。</span><span class="sxs-lookup"><span data-stu-id="6aef0-139">If the server HTTP response contains more that 64K of total header data, WinHTTP fails the request with an **ERROR\_WINHTTP\_INVALID\_SERVER\_RESPONSE** error.</span></span> <span data-ttu-id="6aef0-140">您可以使用新的 **WINHTTP \_ 選項 \_ MAX \_ RESPONSE \_ HEADER \_ SIZE** 選項來覆寫這個64k 的限制。</span><span class="sxs-lookup"><span data-stu-id="6aef0-140">This 64K limit can be overridden using the new **WINHTTP\_OPTION\_MAX\_RESPONSE\_HEADER\_SIZE** option.</span></span>

## <a name="ipv6-support"></a><span data-ttu-id="6aef0-141">IPv6 支援</span><span class="sxs-lookup"><span data-stu-id="6aef0-141">IPv6 Support</span></span>

<span data-ttu-id="6aef0-142">WinHTTP 5.1 新增對網際網路通訊協定第6版 (IPv6) 的支援。</span><span class="sxs-lookup"><span data-stu-id="6aef0-142">WinHTTP 5.1 adds support for Internet Protocol Version 6 (IPv6).</span></span> <span data-ttu-id="6aef0-143">WinHTTP 可以將 HTTP 要求傳送至伺服器，其 DNS 名稱會解析成 IPv6 位址，從 Windows Server 2003 和 Windows XP SP2 開始，WinHTTP 也支援 IPv6 常值位址。</span><span class="sxs-lookup"><span data-stu-id="6aef0-143">WinHTTP can send HTTP requests to a server whose DNS name resolves into an IPv6 address, and starting with Windows Server 2003 and Windows XP with SP2, WinHTTP also supports IPv6 literal addresses.</span></span>

## <a name="new-options-in-the-cc-api-for-winhttp"></a><span data-ttu-id="6aef0-144">適用于 WinHTTP 的 C/c + + API 中的新選項</span><span class="sxs-lookup"><span data-stu-id="6aef0-144">New Options in the C/C++ API for WinHTTP</span></span>

<span data-ttu-id="6aef0-145">WinHTTP 5.1 會實行下列新選項：</span><span class="sxs-lookup"><span data-stu-id="6aef0-145">WinHTTP 5.1 implements the following new options:</span></span>

<dl> <span data-ttu-id="6aef0-146">「 \# 定義 WINHTTP \_ 選項 \_ PASSPORT \_ 登出 \_ 86」</span><span class="sxs-lookup"><span data-stu-id="6aef0-146">"\#define WINHTTP\_OPTION\_PASSPORT\_SIGN\_OUT 86"</span></span>  
<span data-ttu-id="6aef0-147">" \# 定義 WINHTTP \_ 選項 \_ PASSPORT \_ RETURN \_ URL 87"</span><span class="sxs-lookup"><span data-stu-id="6aef0-147">"\#define WINHTTP\_OPTION\_PASSPORT\_RETURN\_URL 87"</span></span>  
<span data-ttu-id="6aef0-148">「 \# 定義 WINHTTP \_ 選項重新 \_ 導向 \_ 原則88」</span><span class="sxs-lookup"><span data-stu-id="6aef0-148">"\#define WINHTTP\_OPTION\_REDIRECT\_POLICY 88"</span></span>  
</dl>

<span data-ttu-id="6aef0-149">從 Windows Server 2003 和 Windows XP （含 SP2）開始，WinHTTP 5.1 會實行下列新選項。</span><span class="sxs-lookup"><span data-stu-id="6aef0-149">Starting with Windows Server 2003 and Windows XP with SP2, WinHTTP 5.1 implements the following new options.</span></span> <span data-ttu-id="6aef0-150">不過，在 Windows 2000 Professional 含 SP3 或 Windows XP SP1 上，使用這些選項識別碼的 [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) 或 [**WinHttpQueryOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryoption) 呼叫會失敗：</span><span class="sxs-lookup"><span data-stu-id="6aef0-150">On Windows 2000 Professional with SP3 or Windows XP with SP1, however, calls to [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) or [**WinHttpQueryOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryoption) with these option IDs fail:</span></span>

<dl> <span data-ttu-id="6aef0-151">「 \# 定義 WINHTTP \_ 選項 \_ 接收 \_ 回應 \_ 超時7」</span><span class="sxs-lookup"><span data-stu-id="6aef0-151">"\#define WINHTTP\_OPTION\_RECEIVE\_RESPONSE\_TIMEOUT 7"</span></span>  
<span data-ttu-id="6aef0-152">「 \# 定義 WINHTTP \_ 選項 \_ 最大 \_ HTTP \_ 自動重新 \_ 導向89」</span><span class="sxs-lookup"><span data-stu-id="6aef0-152">"\#define WINHTTP\_OPTION\_MAX\_HTTP\_AUTOMATIC\_REDIRECTS 89"</span></span>  
<span data-ttu-id="6aef0-153">「 \# 定義 WINHTTP \_ 選項 \_ 最大 \_ HTTP \_ 狀態 \_ 繼續90」</span><span class="sxs-lookup"><span data-stu-id="6aef0-153">"\#define WINHTTP\_OPTION\_MAX\_HTTP\_STATUS\_CONTINUE 90"</span></span>  
<span data-ttu-id="6aef0-154">「 \# 定義 WINHTTP \_ 選項 \_ 的 \_ 回應 \_ 標頭 \_ 大小上限91」</span><span class="sxs-lookup"><span data-stu-id="6aef0-154">"\#define WINHTTP\_OPTION\_MAX\_RESPONSE\_HEADER\_SIZE 91"</span></span>  
<span data-ttu-id="6aef0-155">「 \# 定義 WINHTTP \_ 選項 \_ 最大 \_ 回應 \_ 清空 \_ 大小92」</span><span class="sxs-lookup"><span data-stu-id="6aef0-155">"\#define WINHTTP\_OPTION\_MAX\_RESPONSE\_DRAIN\_SIZE 92"</span></span>  
</dl>

## <a name="new-options-in-the-winhttprequest-51-component"></a><span data-ttu-id="6aef0-156">WinHttpRequest 5.1 元件中的新選項</span><span class="sxs-lookup"><span data-stu-id="6aef0-156">New Options in the WinHttpRequest 5.1 Component</span></span>

<span data-ttu-id="6aef0-157">WinHttpRequest 5.1 元件會執行下列新選項：</span><span class="sxs-lookup"><span data-stu-id="6aef0-157">The WinHttpRequest 5.1 component implements the following new options:</span></span>

<dl> <span data-ttu-id="6aef0-158">"WinHttpRequestOption \_ RevertImpersonationOverSsl"</span><span class="sxs-lookup"><span data-stu-id="6aef0-158">"WinHttpRequestOption\_RevertImpersonationOverSsl"</span></span>  
<span data-ttu-id="6aef0-159">"WinHttpRequestOption \_ EnableHttpsToHttpRedirects"</span><span class="sxs-lookup"><span data-stu-id="6aef0-159">"WinHttpRequestOption\_EnableHttpsToHttpRedirects"</span></span>  
<span data-ttu-id="6aef0-160">"WinHttpRequestOption \_ EnablePassportAuthentication"</span><span class="sxs-lookup"><span data-stu-id="6aef0-160">"WinHttpRequestOption\_EnablePassportAuthentication"</span></span>  
</dl>

<span data-ttu-id="6aef0-161">從 Windows Server 2003 和 Windows XP SP2 開始，可以使用下列新的 WinHttpRequest 5.1 選項：</span><span class="sxs-lookup"><span data-stu-id="6aef0-161">The following new WinHttpRequest 5.1 options are available starting with Windows Server 2003 and Windows XP with SP2:</span></span>

<dl> <span data-ttu-id="6aef0-162">"WinHttpRequestOption \_ MaxAutomaticRedirects"</span><span class="sxs-lookup"><span data-stu-id="6aef0-162">"WinHttpRequestOption\_MaxAutomaticRedirects"</span></span>  
<span data-ttu-id="6aef0-163">"WinHttpRequestOption \_ MaxResponseHeaderSize"</span><span class="sxs-lookup"><span data-stu-id="6aef0-163">"WinHttpRequestOption\_MaxResponseHeaderSize"</span></span>  
<span data-ttu-id="6aef0-164">"WinHttpRequestOption \_ MaxResponseDrainSize"</span><span class="sxs-lookup"><span data-stu-id="6aef0-164">"WinHttpRequestOption\_MaxResponseDrainSize"</span></span>  
<span data-ttu-id="6aef0-165">"WinHttpRequestOptions \_ EnableHttp1 \_ 1"</span><span class="sxs-lookup"><span data-stu-id="6aef0-165">"WinHttpRequestOptions\_EnableHttp1\_1"</span></span>  
</dl>

## <a name="proxies-are-not-trusted-when-auto-logon-security-is-set-to-high"></a><span data-ttu-id="6aef0-166">當自動登入安全性設定為 High 時，不信任 proxy</span><span class="sxs-lookup"><span data-stu-id="6aef0-166">Proxies Are Not Trusted When Auto-Logon Security is Set to High</span></span>

<span data-ttu-id="6aef0-167">在 WinHTTP 5.0 中，proxy 伺服器一律受信任，可進行自動登入。</span><span class="sxs-lookup"><span data-stu-id="6aef0-167">In WinHTTP 5.0, proxy servers are always trusted for auto-logon.</span></span> <span data-ttu-id="6aef0-168">當已設定 **winHTTP 自動登入 \_ \_ 安全性 \_ 等級 \_ 高** 原則選項時，此功能不再適用于在 windows Server 2003 和 windows XP （含 SP2）上執行的 winHTTP 5.1。</span><span class="sxs-lookup"><span data-stu-id="6aef0-168">This is no longer valid for WinHTTP 5.1 running on Windows Server 2003 and Windows XP with SP2 when the **WINHTTP\_AUTOLOGON\_SECURITY\_LEVEL\_HIGH** policy option is set.</span></span>

## <a name="web-proxy-auto-discovery-autoproxy-api"></a><span data-ttu-id="6aef0-169">Web Proxy 自動探索 (自動代理) API</span><span class="sxs-lookup"><span data-stu-id="6aef0-169">Web Proxy Auto-Discovery (AutoProxy) API</span></span>

<span data-ttu-id="6aef0-170">為了簡化以 WinHTTP 為基礎之應用程式的 proxy 設定，WinHTTP 現在會將 Web Proxy 自動探索 (WPAD) 通訊協定，也稱為 *自動代理程式。*</span><span class="sxs-lookup"><span data-stu-id="6aef0-170">To ease the configuration of proxy settings for WinHTTP-based applications, WinHTTP now implements the Web Proxy Auto-Discovery (WPAD) protocol, also referred to as *autoproxy*.</span></span> <span data-ttu-id="6aef0-171">這和網頁瀏覽器（例如 Internet Explorer）的相同通訊協定會自動探索 proxy 設定，而不需要使用者手動指定 proxy 伺服器。</span><span class="sxs-lookup"><span data-stu-id="6aef0-171">This is the same protocol that web browsers, such as Internet Explorer, implement to discover the proxy configuration automatically without requiring an end-user to specify a proxy server manually.</span></span> <span data-ttu-id="6aef0-172">為了支援自動代理功能，WinHTTP 5.1 會實作為新的 C/c + + 函式、 [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl)，以及兩個支援的函式： [**WinHttpDetectAutoProxyConfigUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpdetectautoproxyconfigurl) 和 [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser)。</span><span class="sxs-lookup"><span data-stu-id="6aef0-172">To support autoproxy, WinHTTP 5.1 implements a new C/C++ function, [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl), plus two supporting functions, [**WinHttpDetectAutoProxyConfigUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpdetectautoproxyconfigurl) and [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser).</span></span>

## <a name="known-issues"></a><span data-ttu-id="6aef0-173">已知問題</span><span class="sxs-lookup"><span data-stu-id="6aef0-173">Known Issues</span></span>

<span data-ttu-id="6aef0-174">下列問題已知存在於 Windows 2000 Professional SP3 和 Windows XP SP1 的 WinHTTP 5.1 中。</span><span class="sxs-lookup"><span data-stu-id="6aef0-174">The following issues are known to exist in WinHTTP 5.1 on Windows 2000 Professional with SP3 and Windows XP with SP1.</span></span> <span data-ttu-id="6aef0-175">從 Windows Server 2003 和 Windows XP SP2 開始，WinHTTP 已解決這些問題：</span><span class="sxs-lookup"><span data-stu-id="6aef0-175">These issues are resolved for WinHTTP starting with Windows Server 2003 and Windows XP with SP2:</span></span>

-   <span data-ttu-id="6aef0-176">如果應用程式在 [**WinHttpRequest**](iwinhttprequest-interface.md)元件上使用 [**WinHttpSetTimeouts**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsettimeouts)函式或 [**SetTimeouts**](iwinhttprequest-settimeouts.md)方法來設定非無限 DNS 解析超時（例如 *DwResolveTimeout* 參數），則每次 WinHTTP 解析 DNS 名稱時，就會發生執行緒控制碼流失的情況。</span><span class="sxs-lookup"><span data-stu-id="6aef0-176">If the application uses the [**WinHttpSetTimeouts**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsettimeouts) function or the [**SetTimeouts**](iwinhttprequest-settimeouts.md) method on the [**WinHttpRequest**](iwinhttprequest-interface.md) component to set a non-infinite DNS resolve timeout such as the *dwResolveTimeout* parameter, a thread handle leak occurs each time WinHTTP resolves a DNS name.</span></span> <span data-ttu-id="6aef0-177">在大量的 HTTP 要求中，這會造成大量的記憶體流失。</span><span class="sxs-lookup"><span data-stu-id="6aef0-177">Over a large number of HTTP requests, this causes a significant memory leak.</span></span> <span data-ttu-id="6aef0-178">因應措施是將預設的無限解析 timeout 設定維持不變 (值為0會指定無限超時) 。</span><span class="sxs-lookup"><span data-stu-id="6aef0-178">The workaround is to leave the default infinite resolve timeout setting unchanged (a value of 0 specifies an infinite timeout).</span></span> <span data-ttu-id="6aef0-179">在任何情況下，強烈建議您這樣做，因為 WinHTTP 中的 DNS 名稱解析的支援超時，在效能方面很昂貴。</span><span class="sxs-lookup"><span data-stu-id="6aef0-179">This is strongly recommended in any case as supporting timeouts on DNS name resolutions in WinHTTP is expensive in terms of performance.</span></span> <span data-ttu-id="6aef0-180">在 Windows 2000 和更新版本中，因為基礎 DNS 用戶端服務會自行執行解析超時，所以不需要在 WinHTTP 中設定 DNS 解析超時時間。</span><span class="sxs-lookup"><span data-stu-id="6aef0-180">For Windows 2000 and later, setting a DNS resolve timeout in WinHTTP is unnecessary as the underlying DNS client service implements its own resolve timeout.</span></span>
-   <span data-ttu-id="6aef0-181">處理非同步要求時，WinHTTP 不會正確處理執行緒模擬。</span><span class="sxs-lookup"><span data-stu-id="6aef0-181">When processing asynchronous requests, WinHTTP does not handle thread impersonation properly.</span></span> <span data-ttu-id="6aef0-182">這會導致要求 NTLM/協商驗證的要求失敗，除非使用 [**WinHttpSetCredentials**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetcredentials) 或 [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) 函式明確指定認證。</span><span class="sxs-lookup"><span data-stu-id="6aef0-182">This causes requests that require NTLM/Negotiate authentication to fail, unless credentials are explicitly given using the [**WinHttpSetCredentials**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetcredentials) or [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) functions.</span></span>

 

 



