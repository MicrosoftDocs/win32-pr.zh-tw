---
description: 在需要存取 HTTP 用戶端堆疊的中介層和後端伺服器應用程式上，Microsoft Windows HTTP Services (WinHTTP) 的目標。
ms.assetid: 5b0cf321-8f69-4526-a628-e6ca0f9d4a58
title: 將 WinINet 應用程式移植到 WinHTTP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6f64c4ecc825934d32b1d363f010bd04e1484428
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "103945296"
---
# <a name="porting-wininet-applications-to-winhttp"></a><span data-ttu-id="e982c-103">將 WinINet 應用程式移植到 WinHTTP</span><span class="sxs-lookup"><span data-stu-id="e982c-103">Porting WinINet Applications to WinHTTP</span></span>

<span data-ttu-id="e982c-104">在需要存取 HTTP 用戶端堆疊的中介層和後端伺服器應用程式上，Microsoft Windows HTTP Services (WinHTTP) 的目標。</span><span class="sxs-lookup"><span data-stu-id="e982c-104">Microsoft Windows HTTP Services (WinHTTP) is targeted at middle-tier and back-end server applications that require access to an HTTP client stack.</span></span> <span data-ttu-id="e982c-105">[Microsoft Windows Internet (WinINet) ](winhttp-start-page.md) 提供用戶端應用程式的 HTTP 用戶端堆疊，以及檔案傳輸通訊協定 (FTP) 、SOCKSv4 和 Gopher 通訊協定的存取權。</span><span class="sxs-lookup"><span data-stu-id="e982c-105">[Microsoft Windows Internet (WinINet)](winhttp-start-page.md) provides an HTTP client stack for client applications, as well as access to the File Transfer Protocol (FTP), SOCKSv4, and Gopher protocols.</span></span> <span data-ttu-id="e982c-106">本總覽有助於判斷將您的 WinINet 應用程式移植到 WinHTTP 是否有説明。</span><span class="sxs-lookup"><span data-stu-id="e982c-106">This overview can help determine whether porting your WinINet applications to WinHTTP would be beneficial.</span></span> <span data-ttu-id="e982c-107">它也會說明特定的轉換需求。</span><span class="sxs-lookup"><span data-stu-id="e982c-107">It also describes specific conversion requirements.</span></span>

-   [<span data-ttu-id="e982c-108">移植 WinINet 應用程式之前應考慮的事項</span><span class="sxs-lookup"><span data-stu-id="e982c-108">Things to Consider Before Porting Your WinINet Application</span></span>](#things-to-consider-before-porting-your-wininet-application)
-   [<span data-ttu-id="e982c-109">對 WinINet 函數的 WinHTTP 對等專案</span><span class="sxs-lookup"><span data-stu-id="e982c-109">WinHTTP Equivalents to WinINet Functions</span></span>](#winhttp-equivalents-to-wininet-functions)
-   [<span data-ttu-id="e982c-110">非同步要求的不同處理</span><span class="sxs-lookup"><span data-stu-id="e982c-110">Different Handling of Asynchronous Requests</span></span>](#different-handling-of-asynchronous-requests)
-   [<span data-ttu-id="e982c-111">WinHTTP 回呼通知的差異</span><span class="sxs-lookup"><span data-stu-id="e982c-111">Differences in WinHTTP Callback Notifications</span></span>](#differences-in-winhttp-callback-notifications)
-   [<span data-ttu-id="e982c-112">驗證差異</span><span class="sxs-lookup"><span data-stu-id="e982c-112">Authentication Differences</span></span>](#authentication-differences)
-   [<span data-ttu-id="e982c-113">安全 HTTP 交易的差異</span><span class="sxs-lookup"><span data-stu-id="e982c-113">Differences in Secure HTTP Transactions</span></span>](#differences-in-secure-http-transactions)

## <a name="things-to-consider-before-porting-your-wininet-application"></a><span data-ttu-id="e982c-114">移植 WinINet 應用程式之前應考慮的事項</span><span class="sxs-lookup"><span data-stu-id="e982c-114">Things to Consider Before Porting Your WinINet Application</span></span>

<span data-ttu-id="e982c-115">如果您的應用程式可受益于下列情況，請考慮將 WinINet 應用程式移植到 WinHTTP：</span><span class="sxs-lookup"><span data-stu-id="e982c-115">Consider porting your WinINet application to WinHTTP if your application would benefit from:</span></span>

-   <span data-ttu-id="e982c-116">伺服器安全的 HTTP 用戶端堆疊。</span><span class="sxs-lookup"><span data-stu-id="e982c-116">A server-safe HTTP client stack.</span></span>
-   <span data-ttu-id="e982c-117">最小化堆疊使用方式。</span><span class="sxs-lookup"><span data-stu-id="e982c-117">Minimized stack usage.</span></span>
-   <span data-ttu-id="e982c-118">伺服器應用程式的擴充性。</span><span class="sxs-lookup"><span data-stu-id="e982c-118">The scalability of a server application.</span></span>
-   <span data-ttu-id="e982c-119">與平臺相關的 Api 相依性較少。</span><span class="sxs-lookup"><span data-stu-id="e982c-119">Fewer dependencies on platform-related APIs.</span></span>
-   <span data-ttu-id="e982c-120">支援執行緒模擬。</span><span class="sxs-lookup"><span data-stu-id="e982c-120">Support for thread impersonation.</span></span>
-   <span data-ttu-id="e982c-121">服務易記的 HTTP 堆疊。</span><span class="sxs-lookup"><span data-stu-id="e982c-121">A service-friendly HTTP stack.</span></span>
-   <span data-ttu-id="e982c-122">存取可編寫腳本的 [**WinHttpRequest**](winhttprequest.md) 物件。</span><span class="sxs-lookup"><span data-stu-id="e982c-122">Access to the scriptable [**WinHttpRequest**](winhttprequest.md) object.</span></span>

<span data-ttu-id="e982c-123">如果您的 WinINet 應用程式必須支援下列其中一項或多項作業，請勿考慮將您的 WinINet 應用程式移植到 WinHTTP：</span><span class="sxs-lookup"><span data-stu-id="e982c-123">Do not consider porting your WinINet application to WinHTTP if it must support one or more of the following:</span></span>

-   <span data-ttu-id="e982c-124">來自 HTTP 堆疊的 FTP 或 Gopher 通訊協定。</span><span class="sxs-lookup"><span data-stu-id="e982c-124">The FTP or Gopher protocol from the HTTP stack.</span></span>
-   <span data-ttu-id="e982c-125">支援使用 SOCKSv4 通訊協定與 SOCKS proxy 進行通訊。</span><span class="sxs-lookup"><span data-stu-id="e982c-125">Support for SOCKSv4 protocol for communicating with SOCKS proxies.</span></span>
-   <span data-ttu-id="e982c-126">自動撥號服務。</span><span class="sxs-lookup"><span data-stu-id="e982c-126">Automatic dial-up services.</span></span>

<span data-ttu-id="e982c-127">如果您決定將應用程式移植到 WinHTTP，下列各節會引導您完成轉換程式。</span><span class="sxs-lookup"><span data-stu-id="e982c-127">If you decide to port your application to WinHTTP, the following sections guide you through the conversion process.</span></span>

<span data-ttu-id="e982c-128">如需 WinINet 和 WinHTTP 的範例應用程式，請比較 WinINet 的 AsyncDemo 範例與 WinHTTP 的 AsyncDemo 範例。</span><span class="sxs-lookup"><span data-stu-id="e982c-128">For a sample application for both WinINet and WinHTTP, compare the AsyncDemo sample for WinINet with the AsyncDemo sample for WinHTTP.</span></span>

## <a name="winhttp-equivalents-to-wininet-functions"></a><span data-ttu-id="e982c-129">對 WinINet 函數的 WinHTTP 對等專案</span><span class="sxs-lookup"><span data-stu-id="e982c-129">WinHTTP Equivalents to WinINet Functions</span></span>

<span data-ttu-id="e982c-130">下表列出與 HTTP 用戶端堆疊相關的 WinINet 函式，以及 WinHTTP 對等專案。</span><span class="sxs-lookup"><span data-stu-id="e982c-130">The following table lists WinINet functions related to the HTTP client stack together with the WinHTTP equivalents.</span></span>

<span data-ttu-id="e982c-131">如果您的應用程式需要未列出的 WinINet 函式，請勿將應用程式移植至 WinHTTP。</span><span class="sxs-lookup"><span data-stu-id="e982c-131">If your application requires WinINet functions that are not listed, do not port your application to WinHTTP.</span></span>



| <span data-ttu-id="e982c-132">WinINet 函數</span><span class="sxs-lookup"><span data-stu-id="e982c-132">WinINet function</span></span>                                                       | <span data-ttu-id="e982c-133">WinHTTP 對等專案</span><span class="sxs-lookup"><span data-stu-id="e982c-133">WinHTTP equivalent</span></span>                                                                                                                                                                                     | <span data-ttu-id="e982c-134">值得注意的變更</span><span class="sxs-lookup"><span data-stu-id="e982c-134">Notable changes</span></span>                                                                                                                                                                                                                                                                                                                      |
|------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="e982c-135">**HttpAddRequestHeaders**</span><span class="sxs-lookup"><span data-stu-id="e982c-135">**HttpAddRequestHeaders**</span></span>](/windows/desktop/api/wininet/nf-wininet-httpaddrequestheadersa)             | [<span data-ttu-id="e982c-136">**WinHttpAddRequestHeaders**</span><span class="sxs-lookup"><span data-stu-id="e982c-136">**WinHttpAddRequestHeaders**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders)                                                                                                                                           | <span data-ttu-id="e982c-137">無。</span><span class="sxs-lookup"><span data-stu-id="e982c-137">None.</span></span>                                                                                                                                                                                                                                                                                                                                |
| [<span data-ttu-id="e982c-138">**HttpEndRequest**</span><span class="sxs-lookup"><span data-stu-id="e982c-138">**HttpEndRequest**</span></span>](/windows/desktop/api/wininet/nf-wininet-httpendrequesta)                           | [<span data-ttu-id="e982c-139">**WinHttpReceiveResponse**</span><span class="sxs-lookup"><span data-stu-id="e982c-139">**WinHttpReceiveResponse**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse)                                                                                                                                               | <span data-ttu-id="e982c-140">內容值會設定為 [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) 或 [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption)。</span><span class="sxs-lookup"><span data-stu-id="e982c-140">The context value is set with [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) or [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span></span> <span data-ttu-id="e982c-141">要求選項是以 [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest)設定。</span><span class="sxs-lookup"><span data-stu-id="e982c-141">Request options are set with [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest).</span></span> <span data-ttu-id="e982c-142">傳送要求之後，必須呼叫 [**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse) 。</span><span class="sxs-lookup"><span data-stu-id="e982c-142">[**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse) must be called after sending a request.</span></span>                      |
| [<span data-ttu-id="e982c-143">**HttpOpenRequest**</span><span class="sxs-lookup"><span data-stu-id="e982c-143">**HttpOpenRequest**</span></span>](/windows/desktop/api/wininet/nf-wininet-httpopenrequesta)                         | [<span data-ttu-id="e982c-144">**WinHttpOpenRequest**</span><span class="sxs-lookup"><span data-stu-id="e982c-144">**WinHttpOpenRequest**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest)                                                                                                                                                       | <span data-ttu-id="e982c-145">內容值會設定為 [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) 或 [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption)。</span><span class="sxs-lookup"><span data-stu-id="e982c-145">The context value is set with [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) or [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span></span>                                                                                                                                                                                                      |
| [<span data-ttu-id="e982c-146">**HttpQueryInfo**</span><span class="sxs-lookup"><span data-stu-id="e982c-146">**HttpQueryInfo**</span></span>](/windows/desktop/api/wininet/nf-wininet-httpqueryinfoa)                             | [<span data-ttu-id="e982c-147">**WinHttpQueryHeaders**</span><span class="sxs-lookup"><span data-stu-id="e982c-147">**WinHttpQueryHeaders**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryheaders)                                                                                                                                                     | <span data-ttu-id="e982c-148">無。</span><span class="sxs-lookup"><span data-stu-id="e982c-148">None.</span></span>                                                                                                                                                                                                                                                                                                                                |
| [<span data-ttu-id="e982c-149">**HttpSendRequest**</span><span class="sxs-lookup"><span data-stu-id="e982c-149">**HttpSendRequest**</span></span>](/windows/desktop/api/wininet/nf-wininet-httpsendrequesta)                         | [<span data-ttu-id="e982c-150">**WinHttpSendRequest**</span><span class="sxs-lookup"><span data-stu-id="e982c-150">**WinHttpSendRequest**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest)                                                                                                                                                       | <span data-ttu-id="e982c-151">您可以使用 [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest)來設定內容值。</span><span class="sxs-lookup"><span data-stu-id="e982c-151">The context value can be set with [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest).</span></span>                                                                                                                                                                                                                                                  |
| [<span data-ttu-id="e982c-152">**HttpSendRequestEx**</span><span class="sxs-lookup"><span data-stu-id="e982c-152">**HttpSendRequestEx**</span></span>](/windows/desktop/api/wininet/nf-wininet-httpsendrequestexa)                     | [<span data-ttu-id="e982c-153">**WinHttpSendRequest**</span><span class="sxs-lookup"><span data-stu-id="e982c-153">**WinHttpSendRequest**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest)                                                                                                                                                       | <span data-ttu-id="e982c-154">無法提供緩衝區。</span><span class="sxs-lookup"><span data-stu-id="e982c-154">Buffers cannot be provided.</span></span>                                                                                                                                                                                                                                                                                                          |
| [<span data-ttu-id="e982c-155">**InternetCanonicalizeUrl**</span><span class="sxs-lookup"><span data-stu-id="e982c-155">**InternetCanonicalizeUrl**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetcanonicalizeurla)         | <span data-ttu-id="e982c-156">沒有對等項目</span><span class="sxs-lookup"><span data-stu-id="e982c-156">No equivalent</span></span>                                                                                                                                                                                          | <span data-ttu-id="e982c-157">Url 現在會在 [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest)中放入標準格式。</span><span class="sxs-lookup"><span data-stu-id="e982c-157">URLs are now put in canonical form in [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest).</span></span>                                                                                                                                                                                                                                              |
| [<span data-ttu-id="e982c-158">**InternetCheckConnection**</span><span class="sxs-lookup"><span data-stu-id="e982c-158">**InternetCheckConnection**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetcheckconnectiona)         | <span data-ttu-id="e982c-159">沒有對等項目</span><span class="sxs-lookup"><span data-stu-id="e982c-159">No equivalent</span></span>                                                                                                                                                                                          | <span data-ttu-id="e982c-160">未在 WinHTTP 中執行。</span><span class="sxs-lookup"><span data-stu-id="e982c-160">Not implemented in WinHTTP.</span></span>                                                                                                                                                                                                                                                                                                          |
| [<span data-ttu-id="e982c-161">**InternetCloseHandle**</span><span class="sxs-lookup"><span data-stu-id="e982c-161">**InternetCloseHandle**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetclosehandle)                 | [<span data-ttu-id="e982c-162">**WinHttpCloseHandle**</span><span class="sxs-lookup"><span data-stu-id="e982c-162">**WinHttpCloseHandle**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpclosehandle)                                                                                                                                                       | <span data-ttu-id="e982c-163">在 WinHTTP 中關閉父控制碼，並不會以遞迴方式關閉子控制碼。</span><span class="sxs-lookup"><span data-stu-id="e982c-163">Closing a parent handle in WinHTTP does not recursively close child handles.</span></span>                                                                                                                                                                                                                                                         |
| [<span data-ttu-id="e982c-164">**InternetCombineUrl**</span><span class="sxs-lookup"><span data-stu-id="e982c-164">**InternetCombineUrl**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetcombineurla)                   | <span data-ttu-id="e982c-165">沒有對等項目</span><span class="sxs-lookup"><span data-stu-id="e982c-165">No equivalent</span></span>                                                                                                                                                                                          | <span data-ttu-id="e982c-166">您可以使用 [**WinHttpCreateUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpcreateurl) 函式來組合 url。</span><span class="sxs-lookup"><span data-stu-id="e982c-166">URLs can be assembled with the [**WinHttpCreateUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpcreateurl) function.</span></span>                                                                                                                                                                                                                                                |
| [<span data-ttu-id="e982c-167">**InternetConfirmZoneCrossing**</span><span class="sxs-lookup"><span data-stu-id="e982c-167">**InternetConfirmZoneCrossing**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetconfirmzonecrossing) | <span data-ttu-id="e982c-168">沒有對等項目</span><span class="sxs-lookup"><span data-stu-id="e982c-168">No equivalent</span></span>                                                                                                                                                                                          | <span data-ttu-id="e982c-169">未在 WinHTTP 中執行。</span><span class="sxs-lookup"><span data-stu-id="e982c-169">Not implemented in WinHTTP.</span></span>                                                                                                                                                                                                                                                                                                          |
| [<span data-ttu-id="e982c-170">**InternetConnect**</span><span class="sxs-lookup"><span data-stu-id="e982c-170">**InternetConnect**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetconnecta)                         | [<span data-ttu-id="e982c-171">**WinHttpConnect**</span><span class="sxs-lookup"><span data-stu-id="e982c-171">**WinHttpConnect**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpconnect)                                                                                                                                                               | <span data-ttu-id="e982c-172">內容值會設定為 [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) 或 [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption)。</span><span class="sxs-lookup"><span data-stu-id="e982c-172">The context value is set with [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) or [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span></span> <span data-ttu-id="e982c-173">要求選項是以 [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest)設定。</span><span class="sxs-lookup"><span data-stu-id="e982c-173">Request options are set with [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest).</span></span> <span data-ttu-id="e982c-174">使用者認證會以 [**WinHttpSetCredentials**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetcredentials)設定。</span><span class="sxs-lookup"><span data-stu-id="e982c-174">User credentials are set with [**WinHttpSetCredentials**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetcredentials).</span></span>                                 |
| [<span data-ttu-id="e982c-175">**InternetCrackUrl**</span><span class="sxs-lookup"><span data-stu-id="e982c-175">**InternetCrackUrl**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetcrackurla)                       | [<span data-ttu-id="e982c-176">**WinHttpCrackUrl**</span><span class="sxs-lookup"><span data-stu-id="e982c-176">**WinHttpCrackUrl**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpcrackurl)                                                                                                                                                             | <span data-ttu-id="e982c-177">與 ICU ESCAPE 旗標相反的行為 \_ ：使用 [**InternetCrackUrl**](/windows/desktop/api/wininet/nf-wininet-internetcrackurla)時，此旗標會使 (% xx) 的 ESCAPE 序列轉換成字元，但使用 [**WinHttpCrackUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpcrackurl)時，它會導致必須從 HTTP 要求中將的字元轉換成 ESCAPE 序列。</span><span class="sxs-lookup"><span data-stu-id="e982c-177">Opposite behavior of the ICU\_ESCAPE flag: with [**InternetCrackUrl**](/windows/desktop/api/wininet/nf-wininet-internetcrackurla), this flag causes escape sequences (%xx) to be converted to characters, but with [**WinHttpCrackUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpcrackurl), it causes characters that must be escaped from in an HTTP request to be converted to escape sequences.</span></span> |
| [<span data-ttu-id="e982c-178">**InternetCreateUrl**</span><span class="sxs-lookup"><span data-stu-id="e982c-178">**InternetCreateUrl**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetcreateurla)                     | [<span data-ttu-id="e982c-179">**WinHttpCreateUrl**</span><span class="sxs-lookup"><span data-stu-id="e982c-179">**WinHttpCreateUrl**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpcreateurl)                                                                                                                                                           | <span data-ttu-id="e982c-180">無。</span><span class="sxs-lookup"><span data-stu-id="e982c-180">None.</span></span>                                                                                                                                                                                                                                                                                                                                |
| [<span data-ttu-id="e982c-181">**InternetErrorDlg**</span><span class="sxs-lookup"><span data-stu-id="e982c-181">**InternetErrorDlg**</span></span>](/windows/desktop/api/wininet/nf-wininet-interneterrordlg)                       | <span data-ttu-id="e982c-182">沒有對等項目</span><span class="sxs-lookup"><span data-stu-id="e982c-182">No equivalent</span></span>                                                                                                                                                                                          | <span data-ttu-id="e982c-183">由於 WinHTTP 是以伺服器端應用程式為目標，因此它不會執行任何使用者介面。</span><span class="sxs-lookup"><span data-stu-id="e982c-183">Because WinHTTP is targeted at server-side applications, it does not implement any user interface.</span></span>                                                                                                                                                                                                                                   |
| [<span data-ttu-id="e982c-184">**InternetGetCookie**</span><span class="sxs-lookup"><span data-stu-id="e982c-184">**InternetGetCookie**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetgetcookiea)                     | <span data-ttu-id="e982c-185">沒有對等項目</span><span class="sxs-lookup"><span data-stu-id="e982c-185">No equivalent</span></span>                                                                                                                                                                                          | <span data-ttu-id="e982c-186">WinHTTP 不會在會話之間保存資料，也無法存取 WinINet cookie。</span><span class="sxs-lookup"><span data-stu-id="e982c-186">WinHTTP does not persist data between sessions and cannot access WinINet cookies.</span></span>                                                                                                                                                                                                                                                    |
| [<span data-ttu-id="e982c-187">**InternetOpen**</span><span class="sxs-lookup"><span data-stu-id="e982c-187">**InternetOpen**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetopena)                               | [<span data-ttu-id="e982c-188">**WinHttpOpen**</span><span class="sxs-lookup"><span data-stu-id="e982c-188">**WinHttpOpen**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen)                                                                                                                                                                     | <span data-ttu-id="e982c-189">無。</span><span class="sxs-lookup"><span data-stu-id="e982c-189">None.</span></span>                                                                                                                                                                                                                                                                                                                                |
| [<span data-ttu-id="e982c-190">**InternetOpenUrl**</span><span class="sxs-lookup"><span data-stu-id="e982c-190">**InternetOpenUrl**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetopenurla)                         | <span data-ttu-id="e982c-191">[**WinHttpConnect**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpconnect)、 [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest)、 [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest)、 [**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse)</span><span class="sxs-lookup"><span data-stu-id="e982c-191">[**WinHttpConnect**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpconnect), [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest), [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest), [**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse)</span></span> | <span data-ttu-id="e982c-192">這項功能可在列出的 WinHTTP 函式中使用。</span><span class="sxs-lookup"><span data-stu-id="e982c-192">This functionality is available in the WinHTTP functions listed.</span></span>                                                                                                                                                                                                                                                                     |
| [<span data-ttu-id="e982c-193">**InternetQueryDataAvailable**</span><span class="sxs-lookup"><span data-stu-id="e982c-193">**InternetQueryDataAvailable**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetquerydataavailable)   | [<span data-ttu-id="e982c-194">**WinHttpQueryDataAvailable**</span><span class="sxs-lookup"><span data-stu-id="e982c-194">**WinHttpQueryDataAvailable**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpquerydataavailable)                                                                                                                                         | <span data-ttu-id="e982c-195">沒有保留的參數。</span><span class="sxs-lookup"><span data-stu-id="e982c-195">No reserved parameters.</span></span>                                                                                                                                                                                                                                                                                                              |
| [<span data-ttu-id="e982c-196">**InternetQueryOption**</span><span class="sxs-lookup"><span data-stu-id="e982c-196">**InternetQueryOption**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetqueryoptiona)                 | [<span data-ttu-id="e982c-197">**WinHttpQueryOption**</span><span class="sxs-lookup"><span data-stu-id="e982c-197">**WinHttpQueryOption**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryoption)                                                                                                                                                       | <span data-ttu-id="e982c-198">WinHTTP 提供一組不同于 WinINet 的選項。</span><span class="sxs-lookup"><span data-stu-id="e982c-198">WinHTTP offers a different set of options from WinINet.</span></span> <span data-ttu-id="e982c-199">如需 WinHTTP 提供的詳細資訊和選項，請參閱 [**選項旗標**](option-flags.md)。</span><span class="sxs-lookup"><span data-stu-id="e982c-199">For more information and options offered by WinHTTP, see [**Option Flags**](option-flags.md).</span></span>                                                                                                                                                                               |
| [<span data-ttu-id="e982c-200">**InternetReadFile**</span><span class="sxs-lookup"><span data-stu-id="e982c-200">**InternetReadFile**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetreadfile)                       | [<span data-ttu-id="e982c-201">**WinHttpReadData**</span><span class="sxs-lookup"><span data-stu-id="e982c-201">**WinHttpReadData**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreaddata)                                                                                                                                                             | <span data-ttu-id="e982c-202">無。</span><span class="sxs-lookup"><span data-stu-id="e982c-202">None.</span></span>                                                                                                                                                                                                                                                                                                                                |
| [<span data-ttu-id="e982c-203">**InternetReadFileEx**</span><span class="sxs-lookup"><span data-stu-id="e982c-203">**InternetReadFileEx**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetreadfileexa)                   | [<span data-ttu-id="e982c-204">**WinHttpReadData**</span><span class="sxs-lookup"><span data-stu-id="e982c-204">**WinHttpReadData**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreaddata)                                                                                                                                                             | <span data-ttu-id="e982c-205">緩衝區是以指標定址的記憶體區域，而不是結構。</span><span class="sxs-lookup"><span data-stu-id="e982c-205">Rather than a structure, the buffer is a region of memory addressed with a pointer.</span></span>                                                                                                                                                                                                                                                  |
| [<span data-ttu-id="e982c-206">**InternetSetOption**</span><span class="sxs-lookup"><span data-stu-id="e982c-206">**InternetSetOption**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetsetoptiona)                     | [<span data-ttu-id="e982c-207">**WinHttpSetOption**</span><span class="sxs-lookup"><span data-stu-id="e982c-207">**WinHttpSetOption**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption)                                                                                                                                                           | <span data-ttu-id="e982c-208">無。</span><span class="sxs-lookup"><span data-stu-id="e982c-208">None.</span></span>                                                                                                                                                                                                                                                                                                                                |
| [<span data-ttu-id="e982c-209">**InternetSetStatusCallback**</span><span class="sxs-lookup"><span data-stu-id="e982c-209">**InternetSetStatusCallback**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetsetstatuscallback)     | [<span data-ttu-id="e982c-210">**WinHttpSetStatusCallback**</span><span class="sxs-lookup"><span data-stu-id="e982c-210">**WinHttpSetStatusCallback**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetstatuscallback)                                                                                                                                           | <span data-ttu-id="e982c-211">如需詳細資訊，請參閱本主題中的「非同步要求的不同處理方式」。</span><span class="sxs-lookup"><span data-stu-id="e982c-211">For more information, see "Different Handling of Asynchronous Requests" in this topic.</span></span>                                                                                                                                                                                                                                               |
| [<span data-ttu-id="e982c-212">**InternetTimeFromSystemTime**</span><span class="sxs-lookup"><span data-stu-id="e982c-212">**InternetTimeFromSystemTime**</span></span>](/windows/desktop/api/wininet/nf-wininet-internettimefromsystemtime)   | [<span data-ttu-id="e982c-213">**WinHttpTimeFromSystemTime**</span><span class="sxs-lookup"><span data-stu-id="e982c-213">**WinHttpTimeFromSystemTime**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttptimefromsystemtime)                                                                                                                                         | <span data-ttu-id="e982c-214">無。</span><span class="sxs-lookup"><span data-stu-id="e982c-214">None.</span></span>                                                                                                                                                                                                                                                                                                                                |
| [<span data-ttu-id="e982c-215">**InternetTimeToSystemTime**</span><span class="sxs-lookup"><span data-stu-id="e982c-215">**InternetTimeToSystemTime**</span></span>](/windows/desktop/api/wininet/nf-wininet-internettimetosystemtime)       | [<span data-ttu-id="e982c-216">**WinHttpTimeToSystemTime**</span><span class="sxs-lookup"><span data-stu-id="e982c-216">**WinHttpTimeToSystemTime**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttptimetosystemtime)                                                                                                                                             | <span data-ttu-id="e982c-217">無。</span><span class="sxs-lookup"><span data-stu-id="e982c-217">None.</span></span>                                                                                                                                                                                                                                                                                                                                |
| [<span data-ttu-id="e982c-218">**InternetWriteFile**</span><span class="sxs-lookup"><span data-stu-id="e982c-218">**InternetWriteFile**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetwritefile)                     | [<span data-ttu-id="e982c-219">**WinHttpWriteData**</span><span class="sxs-lookup"><span data-stu-id="e982c-219">**WinHttpWriteData**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpwritedata)                                                                                                                                                           | <span data-ttu-id="e982c-220">無。</span><span class="sxs-lookup"><span data-stu-id="e982c-220">None.</span></span>                                                                                                                                                                                                                                                                                                                                |



 

## <a name="different-handling-of-asynchronous-requests"></a><span data-ttu-id="e982c-221">非同步要求的不同處理</span><span class="sxs-lookup"><span data-stu-id="e982c-221">Different Handling of Asynchronous Requests</span></span>

<span data-ttu-id="e982c-222">請注意，在 WinINet 和 WinHTTP 中，某些函數可以同步或非同步方式完成非同步要求。</span><span class="sxs-lookup"><span data-stu-id="e982c-222">Be aware that in WinINet and WinHTTP, some functions can complete asynchronous requests either synchronously or asynchronously.</span></span> <span data-ttu-id="e982c-223">您的應用程式必須處理這兩種情況。</span><span class="sxs-lookup"><span data-stu-id="e982c-223">Your application must handle either situation.</span></span> <span data-ttu-id="e982c-224">WinINet 和 WinHTTP 如何處理這些可能的非同步函式有很大的差異。</span><span class="sxs-lookup"><span data-stu-id="e982c-224">There are significant differences in how WinINet and WinHTTP handle these potentially asynchronous functions.</span></span>

<span data-ttu-id="e982c-225">WinINet</span><span class="sxs-lookup"><span data-stu-id="e982c-225">WinINet</span></span>

-   <span data-ttu-id="e982c-226">同步完成：如果可能的非同步 WinINet 函式呼叫以同步方式完成，則函數的 OUT 參數會傳回作業的結果。</span><span class="sxs-lookup"><span data-stu-id="e982c-226">Synchronous completion: If a potentially asynchronous WinINet function call completes synchronously, the OUT parameters of the function return the results of the operation.</span></span> <span data-ttu-id="e982c-227">發生錯誤時，請在 WinINet 函式呼叫之後呼叫 [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) 來取得錯誤碼。</span><span class="sxs-lookup"><span data-stu-id="e982c-227">When an error occurs, retrieve the error code by calling [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) after the WinINet function call.</span></span>

-   <span data-ttu-id="e982c-228">非同步完成：如果可能非同步函式呼叫以非同步方式完成，則會在回呼函式中存取作業的結果和任何錯誤。</span><span class="sxs-lookup"><span data-stu-id="e982c-228">Asynchronous completion: If a potentially asynchronous function call completes asynchronously, the results of the operation, and any errors, are accessible in the callback function.</span></span> <span data-ttu-id="e982c-229">回呼函式會在背景工作執行緒上執行，而不是在進行初始函式呼叫的執行緒上執行。</span><span class="sxs-lookup"><span data-stu-id="e982c-229">The callback function is executed on a worker thread, not on the thread that made the initial function call.</span></span>

<span data-ttu-id="e982c-230">換句話說，您的應用程式必須重複邏輯，以在兩個位置處理這類作業的結果：兩者都緊接在函式呼叫和回呼函數中。</span><span class="sxs-lookup"><span data-stu-id="e982c-230">In other words, your application must duplicate logic to handle the results of such operations in two places: both immediately after the function call and in the callback function.</span></span>

<span data-ttu-id="e982c-231">WinHTTP 藉由讓您只在回呼函式中執行操作邏輯來簡化此模型，不論作業是以同步方式或非同步方式完成，都會收到完成通知。</span><span class="sxs-lookup"><span data-stu-id="e982c-231">WinHTTP simplifies this model by enabling you to implement the operational logic only in the callback function, which receives a completion notification regardless of whether the operation completed synchronously or asynchronously.</span></span> <span data-ttu-id="e982c-232">啟用非同步作業時，WinHTTP 函數的 OUT 參數不會傳回有意義的資料，而且必須設定為 **Null**。</span><span class="sxs-lookup"><span data-stu-id="e982c-232">When asynchronous operation is enabled, the OUT parameters of WinHTTP functions do not return meaningful data and must be set to **NULL**.</span></span>

<span data-ttu-id="e982c-233">從應用程式的觀點來看，WinHTTP 中的非同步和同步完成之間唯一的差異在於執行回呼函數的位置。</span><span class="sxs-lookup"><span data-stu-id="e982c-233">The only significant difference between asynchronous and synchronous completion in WinHTTP, from the application perspective, is in where the callback function is executed.</span></span>

<span data-ttu-id="e982c-234">WinHTTP</span><span class="sxs-lookup"><span data-stu-id="e982c-234">WinHTTP</span></span>

-   <span data-ttu-id="e982c-235">同步完成：當作業同步完成時，會在與原始函數呼叫相同的執行緒中執行的回呼函式中傳回結果。</span><span class="sxs-lookup"><span data-stu-id="e982c-235">Synchronous completion: When an operation completes synchronously, the results are returned in a callback function that executes in the same thread as the original function call.</span></span>

-   <span data-ttu-id="e982c-236">非同步完成：當作業以非同步方式完成時，會在背景工作執行緒中執行的回呼函數中傳回結果。</span><span class="sxs-lookup"><span data-stu-id="e982c-236">Asynchronous completion: When an operation completes asynchronously, the results are returned in a callback function that executes in a worker thread.</span></span>

<span data-ttu-id="e982c-237">雖然大部分的錯誤也可以完全在回呼函式內進行處理，但由於錯誤不正確 \_ \_ 參數或藉由呼叫 [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror)而抓取的其他類似錯誤，因此必須針對函式準備 WinHTTP 應用程式以傳回 FALSE。</span><span class="sxs-lookup"><span data-stu-id="e982c-237">Although most errors can also be handled entirely within the callback function, WinHTTP applications must still be prepared for a function to return **FALSE** because of an ERROR\_INVALID\_PARAMETER or other similar error retrieved by calling [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror).</span></span>

<span data-ttu-id="e982c-238">不同于 WinINet （可同時執行多個非同步作業），WinHTTP 會針對每個要求控制碼強制執行一個擱置中非同步作業的原則。</span><span class="sxs-lookup"><span data-stu-id="e982c-238">Unlike WinINet, which can execute multiple asynchronous operations simultaneously, WinHTTP enforces a policy of one pending asynchronous operation per request handle.</span></span> <span data-ttu-id="e982c-239">如果有一個作業暫止，並呼叫另一個 WinHTTP 函式，則第二個函式會失敗，而 [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) 會傳回錯誤 \_ 無效 \_ 的作業。</span><span class="sxs-lookup"><span data-stu-id="e982c-239">If one operation is pending and another WinHTTP function is called, the second function fails and [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) returns ERROR\_INVALID\_OPERATION.</span></span>

<span data-ttu-id="e982c-240">WinHTTP 藉由讓您只在回呼函式中執行操作邏輯來簡化此模型，不論作業是以同步方式或非同步方式完成，都會收到完成通知。</span><span class="sxs-lookup"><span data-stu-id="e982c-240">WinHTTP simplifies this model by enabling you to implement the operational logic only in the callback function, which receives a completion notification regardless of whether the operation completed synchronously or asynchronously.</span></span> <span data-ttu-id="e982c-241">啟用非同步作業時，WinHTTP 函數的 OUT 參數不會傳回有意義的資料，而且必須設定為 **Null**。</span><span class="sxs-lookup"><span data-stu-id="e982c-241">When asynchronous operation is enabled, the OUT parameters of WinHTTP functions do not return meaningful data and must be set to **NULL**.</span></span>

## <a name="differences-in-winhttp-callback-notifications"></a><span data-ttu-id="e982c-242">WinHTTP 回呼通知的差異</span><span class="sxs-lookup"><span data-stu-id="e982c-242">Differences in WinHTTP Callback Notifications</span></span>

<span data-ttu-id="e982c-243">狀態回呼函式會透過通知旗標接收作業狀態的更新。</span><span class="sxs-lookup"><span data-stu-id="e982c-243">The status callback function receives updates on the status of operations through notification flags.</span></span> <span data-ttu-id="e982c-244">在 WinHTTP 中，會使用 [**WinHttpSetStatusCallback**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetstatuscallback)函數的 *dwNotificationFlags* 參數來選取通知。</span><span class="sxs-lookup"><span data-stu-id="e982c-244">In WinHTTP, notifications are selected using the *dwNotificationFlags* parameter of the [**WinHttpSetStatusCallback**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetstatuscallback) function.</span></span> <span data-ttu-id="e982c-245">使用 **WINHTTP \_ 回呼旗 \_ 標 \_ 所有 \_ 通知** 旗標，以通知所有狀態更新。</span><span class="sxs-lookup"><span data-stu-id="e982c-245">Use the **WINHTTP\_CALLBACK\_FLAG\_ALL\_NOTIFICATIONS** flag to be notified of all status updates.</span></span>

<span data-ttu-id="e982c-246">指出特定作業已完成的通知稱為完成通知，或只是完成。</span><span class="sxs-lookup"><span data-stu-id="e982c-246">Notifications that indicate a particular operation is complete are called completion notifications, or just completions.</span></span> <span data-ttu-id="e982c-247">在 WinINet 中，每次回呼函式收到完成時， *lpvStatusInformation* 參數都包含 [**網際網路 \_ 非同步 \_ 結果**](/windows/desktop/api/wininet/ns-wininet-internet_async_result) 結構。</span><span class="sxs-lookup"><span data-stu-id="e982c-247">In WinINet, each time the callback function receives a completion, the *lpvStatusInformation* parameter contains an [**INTERNET\_ASYNC\_RESULT**](/windows/desktop/api/wininet/ns-wininet-internet_async_result) structure.</span></span> <span data-ttu-id="e982c-248">在 WinHTTP 中，此結構不適用於所有的完成。</span><span class="sxs-lookup"><span data-stu-id="e982c-248">In WinHTTP, this structure is not available for all completions.</span></span> <span data-ttu-id="e982c-249">請務必參閱 [**WINHTTP \_ 狀態 \_ 回呼**](/windows/win32/api/winhttp/nc-winhttp-winhttp_status_callback)的參考頁面，其中包含通知的相關資訊，以及每個通知可預期的資料類型。</span><span class="sxs-lookup"><span data-stu-id="e982c-249">It is important to review the reference page for [**WINHTTP\_STATUS\_CALLBACK**](/windows/win32/api/winhttp/nc-winhttp-winhttp_status_callback), which contains information about notifications and what type of data can be expected for each.</span></span>

<span data-ttu-id="e982c-250">在 WinHTTP 中，單次完成（ **WinHTTP \_ 回呼 \_ 狀態 \_ 要求 \_ 錯誤**）表示作業失敗。</span><span class="sxs-lookup"><span data-stu-id="e982c-250">In WinHTTP, a single completion, **WINHTTP\_CALLBACK\_STATUS\_REQUEST\_ERROR**, indicates that an operation failed.</span></span> <span data-ttu-id="e982c-251">所有其他完成表示作業成功。</span><span class="sxs-lookup"><span data-stu-id="e982c-251">All other completions indicate a successful operation.</span></span>

<span data-ttu-id="e982c-252">WinINet 和 WinHTTP 都會使用使用者定義的內容值，將主要執行緒的資訊傳遞給狀態回呼函式，該函式可在背景工作執行緒上執行。</span><span class="sxs-lookup"><span data-stu-id="e982c-252">Both WinINet and WinHTTP use a user-defined context value to pass information from the main thread to the status callback function, which can be executed on a worker thread.</span></span> <span data-ttu-id="e982c-253">在 WinINet 中，狀態回呼函式所使用的內容值是藉由呼叫數個函式的其中一個來設定。</span><span class="sxs-lookup"><span data-stu-id="e982c-253">In WinINet, the context value used by the status callback function is set by calling one of several functions.</span></span> <span data-ttu-id="e982c-254">在 WinHTTP 中，內容值只會使用 [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) 或 [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption)來設定。</span><span class="sxs-lookup"><span data-stu-id="e982c-254">In WinHTTP, the context value is set only with [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) or [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span></span> <span data-ttu-id="e982c-255">基於這個原因，WinHTTP 可能會在設定內容值之前發生通知。</span><span class="sxs-lookup"><span data-stu-id="e982c-255">Because of this, it is possible in WinHTTP for a notification to occur before a context value is set.</span></span> <span data-ttu-id="e982c-256">如果回呼函數在設定內容值之前收到通知，應用程式必須準備好在回呼函數的 *dwCoNtext* 參數中接收 **Null** 。</span><span class="sxs-lookup"><span data-stu-id="e982c-256">If the callback function receives a notification before the context value is set, the application must be prepared to receive **NULL** in the *dwContext* parameter of the callback function.</span></span>

## <a name="authentication-differences"></a><span data-ttu-id="e982c-257">驗證差異</span><span class="sxs-lookup"><span data-stu-id="e982c-257">Authentication Differences</span></span>

<span data-ttu-id="e982c-258">在 WinINet 中，使用者認證是藉由呼叫 [**InternetSetOption**](/windows/desktop/api/wininet/nf-wininet-internetsetoptiona) 函式來設定，並使用與下列程式碼範例中所提供類似的程式碼。</span><span class="sxs-lookup"><span data-stu-id="e982c-258">In WinINet, user credentials are set by calling the [**InternetSetOption**](/windows/desktop/api/wininet/nf-wininet-internetsetoptiona) function, using code similar to that provided in the following code example.</span></span>

``` syntax
// Use the WinINet InternetSetOption function to set the 
// user credentials to the user name contained in strUsername 
// and the password to the contents of strPassword.
       
InternetSetOption( hRequest, INTERNET_OPTION_PROXY_USERNAME, 
                   strUsername, strlen(strUsername) + 1 );

InternetSetOption( hRequest, INTERNET_OPTION_PROXY_PASSWORD, 
                   strPassword, strlen(strPassword) + 1 );
```

<span data-ttu-id="e982c-259">為了提供相容性，您可以使用 [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) 函式在 WinHTTP 中設定使用者認證，但不建議這麼做，因為這可能會造成安全性弱點。</span><span class="sxs-lookup"><span data-stu-id="e982c-259">For compatibility, user credentials can similarly be set in WinHTTP using the [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) function, but this is not recommended because it can pose a security vulnerability.</span></span>

<span data-ttu-id="e982c-260">相反地，當應用程式在 WinHTTP 中收到401狀態碼時，建議的設定認證方法是先識別使用 [**WinHttpQueryAuthSchemes**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryauthschemes) 的驗證配置，然後使用 [**WinHttpSetCredentials**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetcredentials)來設定認證。</span><span class="sxs-lookup"><span data-stu-id="e982c-260">Instead, when an application receives a 401 status code in WinHTTP, the recommended method of setting credentials is first to identify an authentication scheme using [**WinHttpQueryAuthSchemes**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryauthschemes) and, second, set the credentials using [**WinHttpSetCredentials**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetcredentials).</span></span> <span data-ttu-id="e982c-261">下列程式碼範例示範如何執行這項作業。</span><span class="sxs-lookup"><span data-stu-id="e982c-261">The following code example shows how to do this.</span></span>

``` syntax
DWORD dwSupportedSchemes;
DWORD dwPrefered;
DWORD dwTarget;

// Obtain the supported and first schemes.
WinHttpQueryAuthSchemes( hRequest, &dwSupportedSchemes, &dwPrefered, &dwTarget );

// Set the credentials before resending the request.
WinHttpSetCredentials( hRequest, dwTarget, dwPrefered, strUsername, strPassword, NULL );
```

<span data-ttu-id="e982c-262">因為在 WinHTTP 中沒有對等 [**InternetErrorDlg**](/windows/desktop/api/wininet/nf-wininet-interneterrordlg) ，透過使用者介面取得認證的應用程式必須提供自己的介面。</span><span class="sxs-lookup"><span data-stu-id="e982c-262">Because there is no equivalent to [**InternetErrorDlg**](/windows/desktop/api/wininet/nf-wininet-interneterrordlg) in WinHTTP, applications that obtain credentials through a user interface must provide their own interface.</span></span>

<span data-ttu-id="e982c-263">和 WinINet 不同的是，WinHTTP 不會快取密碼。</span><span class="sxs-lookup"><span data-stu-id="e982c-263">Unlike WinINet, WinHTTP does not cache passwords.</span></span> <span data-ttu-id="e982c-264">必須針對每個要求提供有效的使用者認證。</span><span class="sxs-lookup"><span data-stu-id="e982c-264">Valid user credentials must be supplied for each request.</span></span>

<span data-ttu-id="e982c-265">WinHTTP 不支援 WinINet 所支援的 (DPA) 配置的分散式密碼驗證。</span><span class="sxs-lookup"><span data-stu-id="e982c-265">WinHTTP does not support the Distributed Password Authentication (DPA) scheme supported by WinINet.</span></span> <span data-ttu-id="e982c-266">但是，WinHTTP 支援 Microsoft Passport 1.4。</span><span class="sxs-lookup"><span data-stu-id="e982c-266">WinHTTP does, however, support Microsoft Passport 1.4.</span></span> <span data-ttu-id="e982c-267">如需在 WinHTTP 中使用 Passport 驗證的詳細資訊，請參閱 [winHTTP 中的 Passport 驗證](passport-authentication-in-winhttp.md)。</span><span class="sxs-lookup"><span data-stu-id="e982c-267">For more information about using Passport authentication in WinHTTP, see [Passport Authentication in WinHTTP](passport-authentication-in-winhttp.md).</span></span>

<span data-ttu-id="e982c-268">WinHTTP 不依賴 Internet Explorer 設定來判斷自動登入原則。</span><span class="sxs-lookup"><span data-stu-id="e982c-268">WinHTTP does not rely on Internet Explorer settings to determine the automatic logon policy.</span></span> <span data-ttu-id="e982c-269">相反地，自動登入原則會以 [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption)設定。</span><span class="sxs-lookup"><span data-stu-id="e982c-269">Instead, the auto-logon policy is set with [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span></span> <span data-ttu-id="e982c-270">如需 WinHTTP 中的驗證（包括自動登入原則）的詳細資訊，請參閱 [winHTTP 中的驗證](authentication-in-winhttp.md)。</span><span class="sxs-lookup"><span data-stu-id="e982c-270">For more information about authentication in WinHTTP, including the auto-logon policy, see [Authentication in WinHTTP](authentication-in-winhttp.md).</span></span>

## <a name="differences-in-secure-http-transactions"></a><span data-ttu-id="e982c-271">安全 HTTP 交易的差異</span><span class="sxs-lookup"><span data-stu-id="e982c-271">Differences in Secure HTTP Transactions</span></span>

<span data-ttu-id="e982c-272">在 WinINet 中，使用 [**HttpOpenRequest**](/windows/desktop/api/wininet/nf-wininet-httpopenrequesta)或 [**InternetConnect**](/windows/desktop/api/wininet/nf-wininet-internetconnecta)來起始安全會話，但在 WinHTTP 中，您必須使用 **winHTTP 旗標 \_ \_ 安全** 旗標來呼叫 [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest) 。</span><span class="sxs-lookup"><span data-stu-id="e982c-272">In WinINet, initiate a secure session using either [**HttpOpenRequest**](/windows/desktop/api/wininet/nf-wininet-httpopenrequesta) or [**InternetConnect**](/windows/desktop/api/wininet/nf-wininet-internetconnecta), but in WinHTTP, you must call [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest) using the **WINHTTP\_FLAG\_SECURE** flag.</span></span>

<span data-ttu-id="e982c-273">在安全的 HTTP 交易中，伺服器憑證可以用來向用戶端驗證服務器。</span><span class="sxs-lookup"><span data-stu-id="e982c-273">In a secure HTTP transaction, server certificates can be used to authenticate a server to the client.</span></span> <span data-ttu-id="e982c-274">在 WinINet 中，如果伺服器憑證包含錯誤， [**HttpSendRequest**](/windows/desktop/api/wininet/nf-wininet-httpsendrequesta) 會失敗並提供憑證錯誤的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="e982c-274">In WinINet, if a server certificate contains errors, [**HttpSendRequest**](/windows/desktop/api/wininet/nf-wininet-httpsendrequesta) fails and provides details about the certificate errors.</span></span>

<span data-ttu-id="e982c-275">在 WinHttp 中，會根據版本處理伺服器憑證錯誤，如下所示：</span><span class="sxs-lookup"><span data-stu-id="e982c-275">In WinHttp, server certificate errors are handled according to the version as follows:</span></span>

-   <span data-ttu-id="e982c-276">從 WinHttp 5.1 開始，如果伺服器憑證失敗或包含錯誤， [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) 的呼叫會報告回呼函式中的 **WinHttp \_ 回呼 \_ 狀態 \_ 安全 \_ 失敗** 。</span><span class="sxs-lookup"><span data-stu-id="e982c-276">Starting with WinHttp 5.1, if a server certificate fails or contains errors, the call to [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) reports a **WINHTTP\_CALLBACK\_STATUS\_SECURE\_FAILURE** in the callback function.</span></span> <span data-ttu-id="e982c-277">如果忽略 **WinHttpSendRequest** 所產生的錯誤，後續對 [**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse) 的呼叫會失敗，並出現錯誤 WINHTTP 作業已 \_ 取消的 \_ \_ 錯誤。</span><span class="sxs-lookup"><span data-stu-id="e982c-277">If the error generated by **WinHttpSendRequest** is ignored, subsequent calls to [**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse) fail with an ERROR\_WINHTTP\_OPERATION\_CANCELLED error.</span></span>
-   <span data-ttu-id="e982c-278">在 WinHTTP 5.0 中，伺服器憑證的錯誤預設不會導致要求失敗。</span><span class="sxs-lookup"><span data-stu-id="e982c-278">In WinHTTP 5.0, errors in server certificates do not, by default, cause a request to fail.</span></span> <span data-ttu-id="e982c-279">相反地，在具有 **WINHTTP \_ 回呼 \_ 狀態 \_ 安全 \_ 失敗** 通知的回呼函式中報告錯誤。</span><span class="sxs-lookup"><span data-stu-id="e982c-279">Instead, the errors are reported in the callback function with the **WINHTTP\_CALLBACK\_STATUS\_SECURE\_FAILURE** notification.</span></span>

<span data-ttu-id="e982c-280">在某些較早的平臺上，WinINet 支援私用通訊技術 (PCT) 和/或 Fortezza 通訊協定，但不能在 Windows XP 上。</span><span class="sxs-lookup"><span data-stu-id="e982c-280">On some earlier platforms, WinINet supported the Private Communication Technology (PCT) and/or Fortezza protocols, although not on Windows XP.</span></span>

<span data-ttu-id="e982c-281">WinHTTP 不支援任何平臺上的 PCT 和 Fortezza 通訊協定，而是依賴安全通訊端層 (SSL) 2.0、SSL 3.0 或傳輸層安全性 (TLS) 1.0。</span><span class="sxs-lookup"><span data-stu-id="e982c-281">WinHTTP does not support the PCT and Fortezza protocols on any platform, and instead relies on Secure Sockets Layer (SSL) 2.0, SSL 3.0, or Transport Layer Security (TLS) 1.0.</span></span>

 

 
