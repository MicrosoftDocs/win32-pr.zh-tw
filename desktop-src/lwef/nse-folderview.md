---
title: 實作資料夾檢視
description: Windows Shell 會提供資料夾堆疊的預設執行，稱為 DefView，如此您就可以避免執行自己的命名空間延伸模組的大部分工作。
ms.assetid: 8c6712d8-c3cb-4450-8277-3a8675622651
keywords:
- 資料夾檢視物件
- IShellView
- IShellBrowser，資料夾檢視物件
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 48c7b86d587154a034f276d4bdab903e5337ed4b
ms.sourcegitcommit: 469b6de41e2a565b7ead231d7f282ec4071ac158
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/11/2020
ms.locfileid: "104383153"
---
# <a name="implementing-a-folder-view"></a><span data-ttu-id="b6ed1-106">實作資料夾檢視</span><span class="sxs-lookup"><span data-stu-id="b6ed1-106">Implementing a Folder View</span></span>

<span data-ttu-id="b6ed1-107">Windows Shell 會提供資料夾堆疊的預設執行，稱為 DefView，如此您就可以避免執行自己的命名空間延伸模組的大部分工作。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-107">Windows Shell provides a default implementation of the folder view, colloquially known as DefView, so that you can avoid much of the work of implementing your own namespace extension.</span></span> <span data-ttu-id="b6ed1-108">由於某些視圖功能無法透過自訂視圖來達成，因此通常建議使用預設的系統資料夾 view 物件來取代自訂視圖。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-108">Because some view features cannot be achieved through custom views, it is often recommended that the default system folder view object is used in place of a custom view.</span></span> <span data-ttu-id="b6ed1-109">如需詳細資訊，請參閱 [**SHCreateShellFolderView**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shcreateshellfolderview)。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-109">For more information, see [**SHCreateShellFolderView**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shcreateshellfolderview).</span></span> <span data-ttu-id="b6ed1-110">本主題的其餘部分將討論如何執行無法支援較新的視圖功能的自訂資料夾檢視。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-110">The remainder of this topic discusses implementing a custom folder view that cannot support newer view features.</span></span>

<span data-ttu-id="b6ed1-111">不同于樹狀檢視，Windows 檔案總管不會管理資料夾檢視的內容。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-111">Unlike the tree view, Windows Explorer does not manage the contents of a folder view.</span></span> <span data-ttu-id="b6ed1-112">資料夾檢視視窗會改為裝載資料夾物件所提供的子視窗。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-112">Instead, the folder view window hosts a child window that is provided by the folder object.</span></span> <span data-ttu-id="b6ed1-113">資料夾物件負責建立資料夾 view 物件，以在子視窗中顯示資料夾的內容。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-113">The folder object is responsible for creating a folder view object to display the folder's contents in the child window.</span></span>

<span data-ttu-id="b6ed1-114">執行資料夾檢視物件的關鍵是 [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) 介面。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-114">The key to implementing a folder view object is the [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) interface.</span></span> <span data-ttu-id="b6ed1-115">Windows 檔案總管會使用這個介面與資料夾 view 物件進行通訊。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-115">This interface is used by Windows Explorer to communicate with the folder view object.</span></span> <span data-ttu-id="b6ed1-116">在顯示資料夾視圖之前，Windows 檔案總管會呼叫資料夾物件的 [**IShellFolder：： CreateViewObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-createviewobject) 方法，並將 *RIID* 設定為 IID \_ IShellView。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-116">Before displaying a folder view, Windows Explorer calls the folder object's [**IShellFolder::CreateViewObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-createviewobject) method with *riid* set to IID\_IShellView.</span></span> <span data-ttu-id="b6ed1-117">建立資料夾 view 物件，並傳回其 **IShellView** 介面。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-117">Create a folder view object and return its **IShellView** interface.</span></span> <span data-ttu-id="b6ed1-118">資料夾 view 物件接著必須建立資料夾檢視視窗的子視窗，並使用子視窗來顯示資料夾內容的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-118">The folder view object must then create a child window of the folder view window and use the child window to display information about the folder's contents.</span></span>

<span data-ttu-id="b6ed1-119">除了控制資料的顯示方式，擴充功能也可以自訂 Windows 檔案總管的一些功能。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-119">In addition to controlling how data is displayed, extensions can also customize a number of the features of Windows Explorer.</span></span> <span data-ttu-id="b6ed1-120">例如，延伸模組可以將專案加入至工具列或功能表列，或在狀態列上顯示資訊。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-120">For instance, an extension can add items to the toolbar or menu bar, or display information on the status bar.</span></span>

-   [<span data-ttu-id="b6ed1-121">資料夾 View 物件</span><span class="sxs-lookup"><span data-stu-id="b6ed1-121">The Folder View Object</span></span>](#the-folder-view-object)
-   [<span data-ttu-id="b6ed1-122">正在初始化資料夾 View 物件</span><span class="sxs-lookup"><span data-stu-id="b6ed1-122">Initializing the Folder View Object</span></span>](#initializing-the-folder-view-object)
-   [<span data-ttu-id="b6ed1-123">顯示資料夾視圖</span><span class="sxs-lookup"><span data-stu-id="b6ed1-123">Displaying the Folder View</span></span>](#displaying-the-folder-view)
-   [<span data-ttu-id="b6ed1-124">執行 IShellView</span><span class="sxs-lookup"><span data-stu-id="b6ed1-124">Implementing IShellView</span></span>](#implementing-ishellview)
    -   [<span data-ttu-id="b6ed1-125">AddPropertySheetPages</span><span class="sxs-lookup"><span data-stu-id="b6ed1-125">AddPropertySheetPages</span></span>](#addpropertysheetpages)
    -   [<span data-ttu-id="b6ed1-126">GetCurrentInfo</span><span class="sxs-lookup"><span data-stu-id="b6ed1-126">GetCurrentInfo</span></span>](#getcurrentinfo)
    -   <span data-ttu-id="b6ed1-127">[[重新整理]](#refresh)</span><span class="sxs-lookup"><span data-stu-id="b6ed1-127">[Refresh](#refresh)</span></span>
    -   [<span data-ttu-id="b6ed1-128">SaveViewState</span><span class="sxs-lookup"><span data-stu-id="b6ed1-128">SaveViewState</span></span>](#saveviewstate)
    -   [<span data-ttu-id="b6ed1-129">TranslateAcelerator</span><span class="sxs-lookup"><span data-stu-id="b6ed1-129">TranslateAcelerator</span></span>](#translateacelerator)
-   [<span data-ttu-id="b6ed1-130">使用 IShellBrowser 與 Windows 檔案總管通訊</span><span class="sxs-lookup"><span data-stu-id="b6ed1-130">Using IShellBrowser to Communicate with Windows Explorer</span></span>](#using-ishellbrowser-to-communicate-with-windows-explorer)
    -   [<span data-ttu-id="b6ed1-131">修改 Windows 檔案總管的功能表列</span><span class="sxs-lookup"><span data-stu-id="b6ed1-131">Modifying the Windows Explorer Menu Bar</span></span>](#modifying-the-windows-explorer-menu-bar)
    -   [<span data-ttu-id="b6ed1-132">修改 Windows 檔案總管的工具列</span><span class="sxs-lookup"><span data-stu-id="b6ed1-132">Modifying the Windows Explorer Toolbar</span></span>](#modifying-the-windows-explorer-toolbar)
    -   [<span data-ttu-id="b6ed1-133">修改 Windows 檔案總管狀態列</span><span class="sxs-lookup"><span data-stu-id="b6ed1-133">Modifying the Windows Explorer Status Bar</span></span>](#modifying-the-windows-explorer-status-bar)
    -   [<span data-ttu-id="b6ed1-134">儲存視圖特定資訊</span><span class="sxs-lookup"><span data-stu-id="b6ed1-134">Storing View-specific Information</span></span>](#storing-view-specific-information)

## <a name="the-folder-view-object"></a><span data-ttu-id="b6ed1-135">資料夾 View 物件</span><span class="sxs-lookup"><span data-stu-id="b6ed1-135">The Folder View Object</span></span>

<span data-ttu-id="b6ed1-136">資料夾檢視物件是 (COM) 物件的元件物件模型，此物件會公開 [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) 介面。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-136">A folder view object is a Component Object Model (COM) object that exposes an [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) interface.</span></span> <span data-ttu-id="b6ed1-137">此物件負責：</span><span class="sxs-lookup"><span data-stu-id="b6ed1-137">This object is responsible for:</span></span>

-   <span data-ttu-id="b6ed1-138">建立資料夾檢視視窗的子視窗，並使用它來顯示資料夾的內容。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-138">Creating a child window of the folder view window and using it to display the contents of the folder.</span></span>
-   <span data-ttu-id="b6ed1-139">處理與 Windows 檔案總管的通訊。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-139">Handling communication with Windows Explorer.</span></span>
-   <span data-ttu-id="b6ed1-140">將資料夾特定的命令新增至 Windows 檔案總管功能表列和工具列，並在選取這些命令時進行處理。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-140">Adding folder-specific commands to the Windows Explorer menu bar and toolbar and handling those commands when they are selected.</span></span>
-   <span data-ttu-id="b6ed1-141">管理使用者與資料夾檢視視窗的互動，例如顯示快捷方式功能表或處理拖放作業。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-141">Managing user interaction with the folder view window, such as displaying shortcut menus or handling drag-and-drop operations.</span></span>

<span data-ttu-id="b6ed1-142">本檔討論前三個主題。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-142">This document discusses the first three topics.</span></span> <span data-ttu-id="b6ed1-143">因為與資料夾檢視互動的使用者會在子視窗內進行，所以您的資料夾 view 物件會負責處理它，就像在任何其他視窗中一樣。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-143">Because user interaction with the folder view takes place within your child window, your folder view object is responsible for handling it as it would for any other window.</span></span>

<span data-ttu-id="b6ed1-144">Windows 檔案總管藉由呼叫您的資料夾物件的 [**IShellFolder：： CreateViewObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-createviewobject) ，並將 *RIID* 設定為 IID IShellView，要求資料夾 view 物件 \_ 。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-144">Windows Explorer requests a folder view object by calling your folder object's [**IShellFolder::CreateViewObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-createviewobject) with *riid* set to IID\_IShellView.</span></span> <span data-ttu-id="b6ed1-145">建立資料夾檢視的程式如下：</span><span class="sxs-lookup"><span data-stu-id="b6ed1-145">The procedure for creating a folder view is:</span></span>

1.  <span data-ttu-id="b6ed1-146">您的資料夾物件會建立資料夾 view 物件的新實例，並傳回其 [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) 介面的指標。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-146">Your folder object creates a new instance of your folder view object and returns a pointer to its [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) interface.</span></span>
2.  <span data-ttu-id="b6ed1-147">Windows 檔案總管藉由呼叫 [**IShellView：： CreateViewWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-createviewwindow) 方法，初始化資料夾 view 物件。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-147">Windows Explorer initializes the folder view object by calling the [**IShellView::CreateViewWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-createviewwindow) method.</span></span> <span data-ttu-id="b6ed1-148">建立資料夾檢視視窗的子視窗，並將其控制碼傳回 Windows 檔案總管。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-148">Create a child window of the folder view window and return its handle to Windows Explorer.</span></span>
3.  <span data-ttu-id="b6ed1-149">資料夾 view 物件使用 Windows 檔案總管 [**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser) 介面來自訂 Windows 檔案總管工具列、功能表列和狀態列。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-149">The folder view object uses the Windows Explorer [**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser) interface to customize the Windows Explorer toolbar, menu bar, and status bar.</span></span>
4.  <span data-ttu-id="b6ed1-150">資料夾 view 物件會在子視窗中顯示資料夾的內容。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-150">The folder view object displays the contents of the folder in the child window.</span></span>
5.  <span data-ttu-id="b6ed1-151">資料夾檢視物件會處理使用者與資料夾檢視的互動，以及任何資料夾特定的工具列或功能表列專案。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-151">The folder view object handles user interaction with the folder view and any folder-specific toolbar or menu bar items.</span></span>

## <a name="initializing-the-folder-view-object"></a><span data-ttu-id="b6ed1-152">正在初始化資料夾 View 物件</span><span class="sxs-lookup"><span data-stu-id="b6ed1-152">Initializing the Folder View Object</span></span>

<span data-ttu-id="b6ed1-153">Windows 檔案總管藉由呼叫 [**IShellView：： CreateViewWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-createviewwindow) 方法，初始化資料夾 view 物件。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-153">Windows Explorer initializes the folder view object by calling the [**IShellView::CreateViewWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-createviewwindow) method.</span></span> <span data-ttu-id="b6ed1-154">方法的參數會為資料夾 view 物件提供建立子視窗所需的資訊，以用來顯示資料夾的內容：</span><span class="sxs-lookup"><span data-stu-id="b6ed1-154">The method's parameters provide the folder view object with the information it needs to create the child window that will be used to display the folder's contents:</span></span>

-   <span data-ttu-id="b6ed1-155">上一個資料夾檢視物件之 [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) 介面的指標。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-155">A pointer to the previous folder view object's [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) interface.</span></span> <span data-ttu-id="b6ed1-156">這個參數可以設定為 **Null**。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-156">This parameter can be set to **NULL**.</span></span>
-   <span data-ttu-id="b6ed1-157">包含前一個資料夾檢視設定的 [**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) 結構。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-157">A [**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) structure that contains the previous folder view's settings.</span></span>
-   <span data-ttu-id="b6ed1-158">Windows 檔案總管 [**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser) 介面的指標。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-158">A pointer to the Windows Explorer [**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser) interface.</span></span>
-   <span data-ttu-id="b6ed1-159">具有資料夾檢視視窗維度的 [矩形](/previous-versions//ms536136(v=vs.85)) 結構。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-159">A [RECT](/previous-versions//ms536136(v=vs.85)) structure with the dimensions of the folder view window.</span></span>

<span data-ttu-id="b6ed1-160">[**IShellView：： CreateViewWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-createviewwindow)方法是在終結先前的資料夾 view 物件之前呼叫。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-160">The [**IShellView::CreateViewWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-createviewwindow) method is called before the previous folder view object is destroyed.</span></span> <span data-ttu-id="b6ed1-161">因此， [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) 介面指標可讓您與上一個資料夾 view 物件進行通訊。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-161">The [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) interface pointer thus allows you to communicate with the previous folder view object.</span></span> <span data-ttu-id="b6ed1-162">如果先前的資料夾屬於您的延伸模組，並使用相同的顯示配置，這個介面主要很有用。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-162">This interface is primarily useful if the previous folder belonged to your extension and used the same display scheme.</span></span> <span data-ttu-id="b6ed1-163">若是如此，您可以與先前的資料夾 view 物件進行通訊，以做為交換私用設定的目的。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-163">If so, you can communicate with the previous folder view object for such purposes as exchanging private settings.</span></span>

<span data-ttu-id="b6ed1-164">判斷 [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) 指標是否屬於您延伸模組的簡單方式，就是讓所有資料夾 view 物件都公開私用介面。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-164">A simple way to determine whether the [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) pointer belongs to your extension is to have all your folder view objects expose a private interface.</span></span> <span data-ttu-id="b6ed1-165">呼叫 [IShellView：： QueryInterface](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) 要求私用介面，並檢查傳回值，判斷資料夾 view 物件是否為您的資料夾。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-165">Call [IShellView::QueryInterface](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) to request the private interface, and examine the return value to determine whether the folder view object is one of yours.</span></span> <span data-ttu-id="b6ed1-166">然後，您可以在該介面上使用私用方法來交換資訊。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-166">You can then use a private method on that interface to exchange information.</span></span>

<span data-ttu-id="b6ed1-167">[**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings)結構包含上一個資料夾檢視的顯示設定。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-167">The [**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) structure contains the previous folder view's display settings.</span></span> <span data-ttu-id="b6ed1-168">主要設定是觀看模式：大型圖示、小圖示、清單或詳細資料。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-168">The primary setting is the viewing mode: large icon, small icon, list, or details.</span></span> <span data-ttu-id="b6ed1-169">另外還有一個旗標，其中包含各種顯示選項的設定，例如，視圖是否應靠左對齊。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-169">There is also a flag that contains the settings of a variety of display options, such as whether the view should be left-aligned.</span></span> <span data-ttu-id="b6ed1-170">您的資料夾顯示應該盡可能將這些設定放在可能的範圍內，讓使用者在從一個資料夾移到另一個資料夾時擁有一致的體驗。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-170">Your folder display should follow these settings to the extent possible, to give users a consistent experience as they go from one folder to another.</span></span> <span data-ttu-id="b6ed1-171">您應該儲存此結構，並在設定變更時加以更新。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-171">You should store this structure and update it as the settings change.</span></span> <span data-ttu-id="b6ed1-172">Windows 檔案總管會呼叫 [**IShellView：： GetCurrentInfo**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-getcurrentinfo) 來取得此結構的最新值，然後再開啟下一個資料夾檢視。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-172">Windows Explorer calls [**IShellView::GetCurrentInfo**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-getcurrentinfo) to obtain the most recent value of this structure before it opens the next folder view.</span></span>

<span data-ttu-id="b6ed1-173">[**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser)介面是由 Windows 檔案總管所公開。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-173">The [**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser) interface is exposed by Windows Explorer.</span></span> <span data-ttu-id="b6ed1-174">此介面是 [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) 的隨附物件，可讓資料夾檢視物件與 Windows 檔案總管進行通訊。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-174">This interface is a companion to [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) and allows a folder view object to communicate with Windows Explorer.</span></span> <span data-ttu-id="b6ed1-175">沒有其他方法可取得此介面指標，因此您的資料夾 view 物件應該儲存它以供稍後使用。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-175">There is no other way to retrieve this interface pointer, so your folder view object should store it for later use.</span></span> <span data-ttu-id="b6ed1-176">尤其是，您必須呼叫 [IShellBrowser：： GetWindow](/windows/win32/api/oleidl/nf-oleidl-iolewindow-getwindow) ，以抓取您將用來建立子視窗的父資料夾檢視視窗。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-176">In particular, you will need to call [IShellBrowser::GetWindow](/windows/win32/api/oleidl/nf-oleidl-iolewindow-getwindow) to retrieve the parent folder view window that you will use to create your child window.</span></span> <span data-ttu-id="b6ed1-177">請注意，IShellBrowser：： GetWindow 方法不包含在 **IShellBrowser** 檔中，因為它是從 [IOleWindow](/windows/win32/api/oleidl/nn-oleidl-iolewindow)繼承的。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-177">Note that the IShellBrowser::GetWindow method is not included in the **IShellBrowser** documentation because it is inherited from [IOleWindow](/windows/win32/api/oleidl/nn-oleidl-iolewindow).</span></span> <span data-ttu-id="b6ed1-178">儲存介面指標之後，請記得呼叫 [IShellBrowser：： AddRef](/windows/win32/api/unknwn/nf-unknwn-iunknown-addref) 來遞增介面的參考計數。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-178">After storing the interface pointer, remember to call [IShellBrowser::AddRef](/windows/win32/api/unknwn/nf-unknwn-iunknown-addref) to increment the interface's reference count.</span></span> <span data-ttu-id="b6ed1-179">當您不再需要介面時，請呼叫 [IShellBrowser：： Release](/windows/win32/api/unknwn/nf-unknwn-iunknown-release)。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-179">When you no longer need the interface, call [IShellBrowser::Release](/windows/win32/api/unknwn/nf-unknwn-iunknown-release).</span></span>

<span data-ttu-id="b6ed1-180">若要建立子視窗：</span><span class="sxs-lookup"><span data-stu-id="b6ed1-180">To create your child window:</span></span>

1.  <span data-ttu-id="b6ed1-181">檢查 [**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) 和 [RECT](/previous-versions//ms536136(v=vs.85)) 結構。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-181">Examine the [**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) and [RECT](/previous-versions//ms536136(v=vs.85)) structures.</span></span>
2.  <span data-ttu-id="b6ed1-182">如有需要，請從上一個資料夾 view 物件取得私用設定。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-182">If needed, obtain private settings from the previous folder view object.</span></span>
3.  <span data-ttu-id="b6ed1-183">呼叫 [IShellBrowser：： GetWindow](/windows/win32/api/oleidl/nf-oleidl-iolewindow-getwindow) ，以抓取父資料夾的視圖視窗。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-183">Call [IShellBrowser::GetWindow](/windows/win32/api/oleidl/nf-oleidl-iolewindow-getwindow) to retrieve the parent folder view window.</span></span>
4.  <span data-ttu-id="b6ed1-184">建立在上一個步驟中取得之資料夾檢視視窗的子系，並將其傳回 Windows 檔案總管。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-184">Create a child of the folder view window obtained in the previous step and return it to Windows Explorer.</span></span>

## <a name="displaying-the-folder-view"></a><span data-ttu-id="b6ed1-185">顯示資料夾視圖</span><span class="sxs-lookup"><span data-stu-id="b6ed1-185">Displaying the Folder View</span></span>

<span data-ttu-id="b6ed1-186">當您建立子視窗，並將它傳回 Windows 檔案總管之後，您就可以顯示資料夾的內容。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-186">Once you have created the child window and returned it to Windows Explorer, you can display the folder's contents.</span></span> <span data-ttu-id="b6ed1-187">一般情況下，延伸模組會顯示其資訊，方法是讓子視窗主 [控制項成為清單視圖控制項](../controls/list-view-control-reference.md) 或 **WebBrowser 控制項**。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-187">Typically, extensions display their information by having the child window host either a [list view control](../controls/list-view-control-reference.md) or a **WebBrowser control**.</span></span> <span data-ttu-id="b6ed1-188">清單視圖控制項可讓您複寫 Windows 檔案總管的 [傳統視圖](web-view.md)。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-188">The list view control allows you to replicate the Windows Explorer [classic view](web-view.md).</span></span> <span data-ttu-id="b6ed1-189">WebBrowser 控制項可讓您使用動態 HTML (DHTML) 檔來顯示您的資訊，就像 Windows 檔案總管 Web 視圖一樣。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-189">The WebBrowser control allows you to use a Dynamic HTML (DHTML) document to display your information, much like the Windows Explorer Web view.</span></span> <span data-ttu-id="b6ed1-190">如需詳細資訊，請參閱這些控制項的檔。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-190">For further information, refer to the documentation of those controls.</span></span>

<span data-ttu-id="b6ed1-191">資料夾檢視視窗一律存在，即使沒有焦點也一樣。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-191">The folder view window always exists, even if it does not have focus.</span></span> <span data-ttu-id="b6ed1-192">因此，您應該為子視窗維持三種狀態：</span><span class="sxs-lookup"><span data-stu-id="b6ed1-192">You should therefore maintain three states for your child window:</span></span>

-   <span data-ttu-id="b6ed1-193">以焦點啟用。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-193">Activated with focus.</span></span> <span data-ttu-id="b6ed1-194">資料夾檢視已建立並具有焦點。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-194">The folder view has been created and has focus.</span></span> <span data-ttu-id="b6ed1-195">設定適合焦點狀態的功能表列或工具列專案。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-195">Set the menu bar or toolbar items that are appropriate for a focused state.</span></span>
-   <span data-ttu-id="b6ed1-196">啟用但不包含焦點。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-196">Activated without focus.</span></span> <span data-ttu-id="b6ed1-197">資料夾檢視已建立且為使用中狀態，但沒有焦點。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-197">The folder view has been created and is active, but it does not have focus.</span></span> <span data-ttu-id="b6ed1-198">設定適用于 nonfocused 狀態的功能表列或工具列專案。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-198">Set the menu bar or toolbar items that are appropriate for a nonfocused state.</span></span> <span data-ttu-id="b6ed1-199">省略套用至資料夾檢視內專案選取專案的任何專案。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-199">Omit any items that apply to the selection of items within the folder view.</span></span>
-   <span data-ttu-id="b6ed1-200">關閉。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-200">Deactivated.</span></span> <span data-ttu-id="b6ed1-201">資料夾檢視即將損毀。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-201">The folder view is about to be destroyed.</span></span> <span data-ttu-id="b6ed1-202">移除所有資料夾特定的功能表項目。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-202">Remove all folder-specific menu items.</span></span>

<span data-ttu-id="b6ed1-203">Windows 檔案總管藉由呼叫 [**IShellView：： UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate)，在視窗狀態變更時通知資料夾 view 物件。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-203">Windows Explorer notifies your folder view object when the window state changes by calling [**IShellView::UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate).</span></span> <span data-ttu-id="b6ed1-204">接著，當使用者藉由呼叫 [**IShellBrowser：： OnViewWindowActive**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-onviewwindowactive)來啟動資料夾檢視視窗時，資料夾 view 物件應該會通知 Windows 檔案總管。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-204">In turn, the folder view object should notify Windows Explorer when a user activates the folder view window by calling [**IShellBrowser::OnViewWindowActive**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-onviewwindowactive).</span></span> <span data-ttu-id="b6ed1-205">如需此介面的進一步討論，請參閱 [使用 IShellBrowser 與 Windows 檔案總管進行通訊](#using-ishellbrowser-to-communicate-with-windows-explorer)。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-205">For further discussion of this interface, see [Using IShellBrowser to Communicate with Windows Explorer](#using-ishellbrowser-to-communicate-with-windows-explorer).</span></span>

<span data-ttu-id="b6ed1-206">當資料夾檢視為使用中狀態時，您需要處理屬於子視窗的任何 Windows 訊息，例如 [WM \_ 大小](../winmsg/wm-size.md)。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-206">While the folder view is active, you need to process any Windows messages, such as [WM\_SIZE](../winmsg/wm-size.md), that belong to your child window.</span></span> <span data-ttu-id="b6ed1-207">您的視窗程式也會收到您已新增至 Windows 檔案總管功能表列或工具列之任何專案的 [WM \_ 命令](../menurc/wm-command.md) 訊息。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-207">Your window procedure will also receive [WM\_COMMAND](../menurc/wm-command.md) messages for any items you have added to the Windows Explorer menu bar or toolbar.</span></span>

<span data-ttu-id="b6ed1-208">建立資料夾檢視之後，Windows 檔案總管會呼叫資料夾 view 物件的 [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) 介面，將各種資訊傳遞給它。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-208">After creating the folder view, Windows Explorer calls the folder view object's [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) interface to pass it a variety of information.</span></span> <span data-ttu-id="b6ed1-209">您的物件必須據以修改其顯示。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-209">Your object must modify its display accordingly.</span></span> <span data-ttu-id="b6ed1-210">當資料夾檢視即將終結時，Windows 檔案總管藉由呼叫 [**IShellView：:D estroyviewwindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-destroyviewwindow) 方法來通知資料夾 view 物件。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-210">When the folder view is about to be destroyed, Windows Explorer notifies the folder view object by calling its [**IShellView::DestroyViewWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-destroyviewwindow) method.</span></span>

## <a name="implementing-ishellview"></a><span data-ttu-id="b6ed1-211">執行 IShellView</span><span class="sxs-lookup"><span data-stu-id="b6ed1-211">Implementing IShellView</span></span>

<span data-ttu-id="b6ed1-212">建立資料夾物件之後，Windows 檔案總管會呼叫各種 [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) 方法來要求資訊，或將 Windows 檔案總管狀態的變更通知物件。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-212">After the folder object has been created, Windows Explorer calls various [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) methods to either request information or notify the object of a change in the state of Windows Explorer.</span></span> <span data-ttu-id="b6ed1-213">本節概述如何執行這些 **IShellView** 方法。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-213">This section outlines how to implement those **IShellView** methods.</span></span> <span data-ttu-id="b6ed1-214">其餘的方法會用於更特製化的用途，例如 [檔案開啟一般] 對話方塊。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-214">The remaining methods are used for more specialized purposes, such as the File Open common dialog box.</span></span> <span data-ttu-id="b6ed1-215">如需詳細資訊，請參閱 **IShellView** 檔。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-215">For details, see the **IShellView** documentation.</span></span>

### <a name="addpropertysheetpages"></a><span data-ttu-id="b6ed1-216">AddPropertySheetPages</span><span class="sxs-lookup"><span data-stu-id="b6ed1-216">AddPropertySheetPages</span></span>

<span data-ttu-id="b6ed1-217">當使用者從 Windows 檔案總管 [**工具**] 功能表選取 [**資料夾選項**] 時，會顯示可讓使用者修改資料夾選項的屬性工作表。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-217">When a user selects **Folder Options** from the Windows Explorer **Tools** menu, a property sheet is displayed that allows the user to modify the folder options.</span></span> <span data-ttu-id="b6ed1-218">Windows 檔案總管會呼叫您的資料夾 view 物件的 [**IShellView：： AddPropertySheetPages**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-addpropertysheetpages) 方法，讓您可以在此屬性工作表中加入頁面。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-218">Windows Explorer calls your folder view object's [**IShellView::AddPropertySheetPages**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-addpropertysheetpages) method to allow you to add a page to this property sheet.</span></span>

<span data-ttu-id="b6ed1-219">Windows 檔案總管會在 [**IShellView：： AddPropertySheetPages**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-addpropertysheetpages)的 *lpfn* 參數中傳遞 [AddPropSheetPageProc](/windows/win32/api/prsht/nc-prsht-lpfnaddpropsheetpage)回呼函數的指標。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-219">Windows Explorer passes a pointer to an [AddPropSheetPageProc](/windows/win32/api/prsht/nc-prsht-lpfnaddpropsheetpage) callback function in the *lpfn* parameter of [**IShellView::AddPropertySheetPages**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-addpropertysheetpages).</span></span> <span data-ttu-id="b6ed1-220">呼叫 [CreatePropertySheetPage](/windows/win32/api/prsht/nf-prsht-createpropertysheetpagea) 來建立頁面，然後呼叫 AddPropSheetPageProc，將它加入至屬性工作表。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-220">Call [CreatePropertySheetPage](/windows/win32/api/prsht/nf-prsht-createpropertysheetpagea) to create the page, and then call the AddPropSheetPageProc to add it to the property sheet.</span></span> <span data-ttu-id="b6ed1-221">如需如何處理屬性工作表的進一步討論，請參閱 [屬性工作表](../controls/property-sheets.md)。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-221">For further discussion of how to handle property sheets, see [Property Sheets](../controls/property-sheets.md).</span></span>

### <a name="getcurrentinfo"></a><span data-ttu-id="b6ed1-222">GetCurrentInfo</span><span class="sxs-lookup"><span data-stu-id="b6ed1-222">GetCurrentInfo</span></span>

<span data-ttu-id="b6ed1-223">當使用者從某個資料夾切換到另一個資料夾時，Windows 檔案總管嘗試維護類似的資料夾檢視。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-223">When the user switches from one folder to another, Windows Explorer attempts to maintain a similar folder view.</span></span> <span data-ttu-id="b6ed1-224">比方說，如果前一個資料夾檢視顯示大型圖示，則下一個資料夾應該也是。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-224">For instance, if the previous folder view showed large icons, the next should as well.</span></span> <span data-ttu-id="b6ed1-225">當 Windows 檔案總管呼叫 [**IShellView：： CreateViewWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-createviewwindow) 來初始化您的資料夾 view 物件時，方法會收到 [**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) 結構。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-225">When Windows Explorer calls [**IShellView::CreateViewWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-createviewwindow) to initialize your folder view object, the method receives a [**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) structure.</span></span> <span data-ttu-id="b6ed1-226">此結構包含的資訊可讓您將資料夾檢視顯示為與上一個資料夾檢視一致。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-226">This structure contains information that allows you to make your folder view display consistent with the previous folder view.</span></span>

<span data-ttu-id="b6ed1-227">為了協助確保下一個視圖與目前的視圖一致，請儲存 [**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) 結構。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-227">To help ensure that the next view is consistent with the current view, store the [**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) structure.</span></span> <span data-ttu-id="b6ed1-228">如果視圖變更（例如，從大到小的圖示），請據以更新結構。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-228">If the view changes, for instance from large to small icons, update the structure accordingly.</span></span> <span data-ttu-id="b6ed1-229">切換視圖之前，Windows 檔案總管會呼叫 [**IShellView：： GetCurrentInfo**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-getcurrentinfo) 來要求目前的 **FOLDERSETTINGS** 值，將其傳遞至下一個資料夾 view 物件。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-229">Prior to switching views, Windows Explorer will call [**IShellView::GetCurrentInfo**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-getcurrentinfo) to request the current **FOLDERSETTINGS** values to pass them to the next folder view object.</span></span>

### <a name="refresh"></a><span data-ttu-id="b6ed1-230">重新整理</span><span class="sxs-lookup"><span data-stu-id="b6ed1-230">Refresh</span></span>

<span data-ttu-id="b6ed1-231">使用者 **可以從 [** **view** ] 功能表中選取 [重新整理] 或按 F5 鍵，以確保資料夾檢視反映資料夾的目前狀態。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-231">The user can ensure that the folder view reflects the current state of the folder by selecting **Refresh** from the **View** menu or pressing the F5 key.</span></span> <span data-ttu-id="b6ed1-232">當使用者這樣做時，Windows 檔案總管會呼叫 [**IShellView：： Refresh**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-refresh) 方法。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-232">When the user does so, Windows Explorer calls the [**IShellView::Refresh**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-refresh) method.</span></span> <span data-ttu-id="b6ed1-233">您的資料夾 view 物件應該立即更新資料夾檢視顯示。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-233">Your folder view object should immediately update the folder view display.</span></span>

### <a name="saveviewstate"></a><span data-ttu-id="b6ed1-234">SaveViewState</span><span class="sxs-lookup"><span data-stu-id="b6ed1-234">SaveViewState</span></span>

<span data-ttu-id="b6ed1-235">Windows 檔案總管會呼叫 [**IShellView：： SaveViewState**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-saveviewstate) 方法，以提示您的資料夾 view 物件儲存其檢視狀態。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-235">Windows Explorer calls the [**IShellView::SaveViewState**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-saveviewstate) method to prompt your folder view object to save its view state.</span></span> <span data-ttu-id="b6ed1-236">然後，您可以在下一次查看資料夾時復原狀態。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-236">You can then recover the state the next time the folder is viewed.</span></span> <span data-ttu-id="b6ed1-237">儲存檢視狀態的慣用方式是呼叫 [**IShellBrowser：： GetViewStateStream**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-getviewstatestream) 方法。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-237">The preferred way to save a view state is by calling the [**IShellBrowser::GetViewStateStream**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-getviewstatestream) method.</span></span> <span data-ttu-id="b6ed1-238">這個方法會傳回一個 [IStream](/windows/win32/api/objidl/nn-objidl-istream) 介面，您的資料夾 view 物件可以使用它來儲存其狀態。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-238">This method returns an [IStream](/windows/win32/api/objidl/nn-objidl-istream) interface that your folder view object can use to save its state.</span></span> <span data-ttu-id="b6ed1-239">當您建立另一個資料夾檢視時，您可以呼叫相同的 **IShellBrowser：： GetViewStateStream** 方法來取得 IStream 指標，讓您能夠讀取先前資料夾檢視所儲存的設定。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-239">When you create another folder view, you can call the same **IShellBrowser::GetViewStateStream** method to obtain an IStream pointer that allows you to read the settings saved by previous folder views.</span></span>

### <a name="translateacelerator"></a><span data-ttu-id="b6ed1-240">TranslateAcelerator</span><span class="sxs-lookup"><span data-stu-id="b6ed1-240">TranslateAcelerator</span></span>

<span data-ttu-id="b6ed1-241">當使用者按下快速鍵時，Windows 檔案總管藉由呼叫 [**IShellView：： TranslateAccelerator**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-translateaccelerator)，將訊息傳遞至資料夾 view 物件。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-241">When the user presses a shortcut key, Windows Explorer passes the message to the folder view object by calling [**IShellView::TranslateAccelerator**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-translateaccelerator).</span></span> <span data-ttu-id="b6ed1-242">傳回 \_ FALSE，使 Windows 檔案總管處理訊息。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-242">Return S\_FALSE to have Windows Explorer process the message.</span></span> <span data-ttu-id="b6ed1-243">如果您的資料夾 view 物件已處理訊息，請返回 \_ [確定]。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-243">If your folder view object has processed the message, return S\_OK.</span></span>

<span data-ttu-id="b6ed1-244">當資料夾檢視視窗具有焦點時，Windows 檔案總管會先呼叫 [**IShellView：： TranslateAccelerator**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-translateaccelerator) ，然後再處理訊息。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-244">When the folder view window has focus, Windows Explorer calls [**IShellView::TranslateAccelerator**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-translateaccelerator) before it processes the message.</span></span> <span data-ttu-id="b6ed1-245">因為大部分的訊息通常會與 Windows 檔案總管的功能表列或工具列命令相關聯，所以您的資料夾 view 物件通常會傳回 \_ FALSE。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-245">Because most of the messages are typically associated with Windows Explorer menu bar or toolbar commands, your folder view object should normally return S\_FALSE.</span></span> <span data-ttu-id="b6ed1-246">然後 Windows 檔案總管可以正常地處理訊息。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-246">Windows Explorer can then process the message normally.</span></span> <span data-ttu-id="b6ed1-247">\_只有當訊息是資料夾特定的，而且您不想 Windows 檔案總管進行任何進一步的處理時，才會傳回 [確定]。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-247">Return S\_OK only if the message is folder-specific and you do not want Windows Explorer to do any further processing.</span></span> <span data-ttu-id="b6ed1-248">如果資料夾檢視沒有焦點，Windows 檔案總管先處理訊息。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-248">If the folder view does not have focus, Windows Explorer processes the message first.</span></span> <span data-ttu-id="b6ed1-249">只有在未處理訊息時，它才會呼叫 [**IShellBrowser：： TranslateAcceleratorSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-translateacceleratorsb) 。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-249">It calls [**IShellBrowser::TranslateAcceleratorSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-translateacceleratorsb) only if it does not handle the message.</span></span>

## <a name="using-ishellbrowser-to-communicate-with-windows-explorer"></a><span data-ttu-id="b6ed1-250">使用 IShellBrowser 與 Windows 檔案總管通訊</span><span class="sxs-lookup"><span data-stu-id="b6ed1-250">Using IShellBrowser to Communicate with Windows Explorer</span></span>

<span data-ttu-id="b6ed1-251">資料夾檢視物件會使用 [**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser) 介面來與 Windows 檔案總管進行通訊，以因應各種用途，包括：</span><span class="sxs-lookup"><span data-stu-id="b6ed1-251">The [**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser) interface is used by the folder view object to communicate with Windows Explorer for a variety of purposes, including:</span></span>

-   [<span data-ttu-id="b6ed1-252">修改 Windows 檔案總管的功能表列</span><span class="sxs-lookup"><span data-stu-id="b6ed1-252">Modifying the Windows Explorer Menu Bar</span></span>](#modifying-the-windows-explorer-menu-bar)
-   [<span data-ttu-id="b6ed1-253">修改 Windows 檔案總管的工具列</span><span class="sxs-lookup"><span data-stu-id="b6ed1-253">Modifying the Windows Explorer Toolbar</span></span>](#modifying-the-windows-explorer-toolbar)
-   [<span data-ttu-id="b6ed1-254">修改 Windows 檔案總管狀態列</span><span class="sxs-lookup"><span data-stu-id="b6ed1-254">Modifying the Windows Explorer Status Bar</span></span>](#modifying-the-windows-explorer-status-bar)
-   [<span data-ttu-id="b6ed1-255">儲存視圖特定資訊</span><span class="sxs-lookup"><span data-stu-id="b6ed1-255">Storing View-specific Information</span></span>](#storing-view-specific-information)

### <a name="modifying-the-windows-explorer-menu-bar"></a><span data-ttu-id="b6ed1-256">修改 Windows 檔案總管的功能表列</span><span class="sxs-lookup"><span data-stu-id="b6ed1-256">Modifying the Windows Explorer Menu Bar</span></span>

<span data-ttu-id="b6ed1-257">Windows 檔案總管的功能表列可讓使用者啟動各種不同的命令。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-257">The Windows Explorer menu bar allows the user to launch a variety of commands.</span></span> <span data-ttu-id="b6ed1-258">依預設，功能表列只支援特定于 Windows 檔案總管的命令。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-258">By default, the menu bar only supports commands that are specific to Windows Explorer.</span></span> <span data-ttu-id="b6ed1-259">相關的 [WM \_ 命令](../menurc/wm-command.md) 訊息會由 Windows 檔案總管處理，而不會傳遞至您的資料夾 view 物件。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-259">The related [WM\_COMMAND](../menurc/wm-command.md) messages are processed by Windows Explorer and are not passed to your folder view object.</span></span> <span data-ttu-id="b6ed1-260">不過，您可以使用 [**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser)修改功能表列，以包含一或多個資料夾特定的功能表項目。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-260">However, you can modify the menu bar to include one or more folder-specific menu items with [**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser).</span></span> <span data-ttu-id="b6ed1-261">Windows 檔案總管將這些專案的相關聯的 WM \_ 命令訊息傳遞至您資料夾物件的視窗程式進行處理。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-261">Windows Explorer passes the associated WM\_COMMAND messages of those items to your folder object's window procedure for processing.</span></span> <span data-ttu-id="b6ed1-262">您也可以移除或停用任何未套用至應用程式的標準命令。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-262">You can also remove or disable any standard commands that do not apply to your application.</span></span>

<span data-ttu-id="b6ed1-263">資料夾檢視物件通常會在第一次顯示資料夾視圖之前修改功能表列。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-263">Folder view objects typically modify the menu bar before the folder view is first displayed.</span></span> <span data-ttu-id="b6ed1-264">當資料夾檢視損毀時，他們必須將功能表列傳回其原始狀態。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-264">They must return the menu bar to its original state when the folder view is destroyed.</span></span> <span data-ttu-id="b6ed1-265">您也可能需要在每次資料夾檢視獲得或失去焦點時，修改功能表列。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-265">You might also need to modify the menu bar each time your folder view gains or loses focus.</span></span>

<span data-ttu-id="b6ed1-266">因為 Windows 檔案總管會在每次資料夾檢視視窗的狀態變更時呼叫 [**IShellView：： UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate) ，所以通常會在該方法的執行中包含功能表列修改。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-266">Because Windows Explorer calls [**IShellView::UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate) each time the folder view window's state changes, menu bar modification is normally included in that method's implementation.</span></span> <span data-ttu-id="b6ed1-267">修改 Windows 檔案總管功能表列的基本程式如下：</span><span class="sxs-lookup"><span data-stu-id="b6ed1-267">The basic procedure for modifying the Windows Explorer menu bar is:</span></span>

1.  <span data-ttu-id="b6ed1-268">呼叫 [CreateMenu](/windows/win32/api/winuser/nf-winuser-createmenu) 來建立功能表控制碼。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-268">Call [CreateMenu](/windows/win32/api/winuser/nf-winuser-createmenu) to create a menu handle.</span></span>
2.  <span data-ttu-id="b6ed1-269">藉由呼叫 [**IShellBrowser：： InsertMenusSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-insertmenussb)，將該功能表控制碼傳遞至 Windows 檔案總管。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-269">Pass that menu handle to Windows Explorer by calling [**IShellBrowser::InsertMenusSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-insertmenussb).</span></span> <span data-ttu-id="b6ed1-270">Windows 檔案總管將會填入其功能表資訊。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-270">Windows Explorer will fill in its menu information.</span></span>
3.  <span data-ttu-id="b6ed1-271">視需要修改功能表。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-271">Modify the menu as needed.</span></span>
4.  <span data-ttu-id="b6ed1-272">呼叫 [**IShellBrowser：： SetMenuSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-setmenusb) ，讓 Windows 檔案總管顯示修改過的功能表列。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-272">Call [**IShellBrowser::SetMenuSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-setmenusb) to have Windows Explorer display the modified menu bar.</span></span>

<span data-ttu-id="b6ed1-273">Windows 檔案總管在功能表列上有六個快顯功能表。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-273">Windows Explorer has six pop-up menus on its menu bar.</span></span> <span data-ttu-id="b6ed1-274">如同所有的 OLE 容器，[Windows 檔案總管] 功能表分為六個群組： [檔案]、[編輯]、[容器]、[物件]、[視窗] 和 [說明]。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-274">As with all OLE containers, the Windows Explorer menu is divided into six groups: File, Edit, Container, Object, Window, and Help.</span></span> <span data-ttu-id="b6ed1-275">下表列出 Windows 檔案總管快顯功能表與其相關聯的群組，以及功能表識別碼。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-275">The following table lists the Windows Explorer pop-up menus and their associated group, along with the menu IDs.</span></span>



| <span data-ttu-id="b6ed1-276">快顯功能表</span><span class="sxs-lookup"><span data-stu-id="b6ed1-276">Pop-up menu</span></span> | <span data-ttu-id="b6ed1-277">識別碼</span><span class="sxs-lookup"><span data-stu-id="b6ed1-277">ID</span></span>                     | <span data-ttu-id="b6ed1-278">Group</span><span class="sxs-lookup"><span data-stu-id="b6ed1-278">Group</span></span>     |
|-------------|------------------------|-----------|
| <span data-ttu-id="b6ed1-279">檔案</span><span class="sxs-lookup"><span data-stu-id="b6ed1-279">File</span></span>        | <span data-ttu-id="b6ed1-280">FCIDM \_ 功能表 \_ 檔</span><span class="sxs-lookup"><span data-stu-id="b6ed1-280">FCIDM\_MENU\_FILE</span></span>      | <span data-ttu-id="b6ed1-281">檔案</span><span class="sxs-lookup"><span data-stu-id="b6ed1-281">File</span></span>      |
| <span data-ttu-id="b6ed1-282">編輯</span><span class="sxs-lookup"><span data-stu-id="b6ed1-282">Edit</span></span>        | <span data-ttu-id="b6ed1-283">FCIDM \_ 功能表 \_ 編輯</span><span class="sxs-lookup"><span data-stu-id="b6ed1-283">FCIDM\_MENU\_EDIT</span></span>      | <span data-ttu-id="b6ed1-284">檔案</span><span class="sxs-lookup"><span data-stu-id="b6ed1-284">File</span></span>      |
| <span data-ttu-id="b6ed1-285">檢視</span><span class="sxs-lookup"><span data-stu-id="b6ed1-285">View</span></span>        | <span data-ttu-id="b6ed1-286">FCIDM \_ 功能表 \_ 視圖</span><span class="sxs-lookup"><span data-stu-id="b6ed1-286">FCIDM\_MENU\_VIEW</span></span>      | <span data-ttu-id="b6ed1-287">容器</span><span class="sxs-lookup"><span data-stu-id="b6ed1-287">Container</span></span> |
| <span data-ttu-id="b6ed1-288">我的最愛</span><span class="sxs-lookup"><span data-stu-id="b6ed1-288">Favorites</span></span>   | <span data-ttu-id="b6ed1-289">FCIDM 功能表我的最愛 \_ \_</span><span class="sxs-lookup"><span data-stu-id="b6ed1-289">FCIDM\_MENU\_FAVORITES</span></span> | <span data-ttu-id="b6ed1-290">容器</span><span class="sxs-lookup"><span data-stu-id="b6ed1-290">Container</span></span> |
| <span data-ttu-id="b6ed1-291">工具</span><span class="sxs-lookup"><span data-stu-id="b6ed1-291">Tools</span></span>       | <span data-ttu-id="b6ed1-292">FCIDM \_ 功能表 \_ 工具</span><span class="sxs-lookup"><span data-stu-id="b6ed1-292">FCIDM\_MENU\_TOOLS</span></span>     | <span data-ttu-id="b6ed1-293">容器</span><span class="sxs-lookup"><span data-stu-id="b6ed1-293">Container</span></span> |
| <span data-ttu-id="b6ed1-294">Help</span><span class="sxs-lookup"><span data-stu-id="b6ed1-294">Help</span></span>        | <span data-ttu-id="b6ed1-295">FCIDM \_ 功能表 \_ 說明</span><span class="sxs-lookup"><span data-stu-id="b6ed1-295">FCIDM\_MENU\_HELP</span></span>      | <span data-ttu-id="b6ed1-296">時間範圍</span><span class="sxs-lookup"><span data-stu-id="b6ed1-296">Window</span></span>    |



 

<span data-ttu-id="b6ed1-297">當您藉由呼叫 [**IShellBrowser：： InsertMenusSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-insertmenussb)，將功能表控制碼傳遞至 Windows 檔案總管時，您也必須將指標傳遞至其成員已初始化為零的 [OLEMENUGROUPWIDTHS](/windows/win32/api/oleidl/ns-oleidl-olemenugroupwidths) 結構。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-297">When you pass the menu handle to Windows Explorer by calling [**IShellBrowser::InsertMenusSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-insertmenussb), you must also pass a pointer to an [OLEMENUGROUPWIDTHS](/windows/win32/api/oleidl/ns-oleidl-olemenugroupwidths) structure whose members have been initialized to zero.</span></span>

<span data-ttu-id="b6ed1-298">當 [**IShellBrowser：： InsertMenusSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-insertmenussb) 傳回時，Windows 檔案總管會新增其功能表項目。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-298">When [**IShellBrowser::InsertMenusSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-insertmenussb) returns, Windows Explorer will have added its menu items.</span></span> <span data-ttu-id="b6ed1-299">然後，您可以將傳回的功能表控制碼與標準的 Windows 功能表功能搭配使用，例如 [InsertMenuItem](/windows/win32/api/winuser/nf-winuser-insertmenuitema) 至：</span><span class="sxs-lookup"><span data-stu-id="b6ed1-299">You can then use the returned menu handle with standard Windows menu functions such as [InsertMenuItem](/windows/win32/api/winuser/nf-winuser-insertmenuitema) to:</span></span>

-   <span data-ttu-id="b6ed1-300">將專案新增至 Windows 檔案總管快顯功能表。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-300">Add items to the Windows Explorer pop-up menus.</span></span>
-   <span data-ttu-id="b6ed1-301">修改或刪除 Windows 檔案總管快顯功能表中的現有專案。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-301">Modify or delete existing items in the Windows Explorer pop-up menus.</span></span>
-   <span data-ttu-id="b6ed1-302">加入新的快顯功能表。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-302">Add new pop-up menus.</span></span>

<span data-ttu-id="b6ed1-303">使用表格中所列的識別碼來識別各種 Windows 檔案總管快顯功能表。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-303">Use the IDs listed in the table to identify the various Windows Explorer pop-up menus.</span></span>

> [!Note]  
> <span data-ttu-id="b6ed1-304">為了避免與 Windows 檔案總管的命令識別碼發生衝突，您新增的任何功能表項目的識別碼都必須介於 FCIDM \_ SHVIEWFIRST 和 FCIDM \_ SHVIEWLAST 之間。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-304">To avoid conflicts with Windows Explorer command IDs, the IDs of any menu items that you add must fall between FCIDM\_SHVIEWFIRST and FCIDM\_SHVIEWLAST.</span></span> <span data-ttu-id="b6ed1-305">這兩個值是在 Shlobj.h 中定義。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-305">These two values are defined in Shlobj.h.</span></span>

 

<span data-ttu-id="b6ed1-306">當您完成修改功能表之後，請呼叫 [**IShellBrowser：： SetMenuSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-setmenusb) 讓 Windows 檔案總管顯示新的功能表列。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-306">Once you have finished modifying the menu, call [**IShellBrowser::SetMenuSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-setmenusb) to have Windows Explorer display the new menu bar.</span></span>

<span data-ttu-id="b6ed1-307">一開始顯示資料夾視圖之後，Windows 檔案總管每次資料夾檢視獲得或失去焦點時，就會呼叫 [**IShellView：： UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate) 。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-307">After the folder view is initially displayed, Windows Explorer calls [**IShellView::UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate) each time the folder view gains or loses focus.</span></span> <span data-ttu-id="b6ed1-308">如果您有任何與資料夾檢視狀態相關的功能表項目，您應該在每次狀態變更時，據以修改功能表。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-308">If you have any menu items that are sensitive to the state of the folder view, you should modify the menu accordingly, each time the state changes.</span></span> <span data-ttu-id="b6ed1-309">比方說，您可能有一個功能表項目，它會作用於使用者所選取的資料夾檢視中的專案。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-309">For instance, you might have a menu item that acts on an item in the folder view that has been selected by the user.</span></span> <span data-ttu-id="b6ed1-310">當資料夾檢視失去焦點時，您應該停用或移除這個功能表項目。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-310">You should disable or remove this menu item when the folder view loses focus.</span></span>

<span data-ttu-id="b6ed1-311">當 Windows 檔案總管呼叫 [**IShellView：： UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate) 指出正在停用資料夾檢視時，請呼叫 [**IShellBrowser：： RemoveMenusSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-removemenussb)，將功能表列還原為其原始狀態。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-311">When Windows Explorer calls [**IShellView::UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate) to indicate that the folder view is being deactivated, restore the menu bar to its original state by calling [**IShellBrowser::RemoveMenusSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-removemenussb).</span></span>

### <a name="modifying-the-windows-explorer-toolbar"></a><span data-ttu-id="b6ed1-312">修改 Windows 檔案總管的工具列</span><span class="sxs-lookup"><span data-stu-id="b6ed1-312">Modifying the Windows Explorer Toolbar</span></span>

<span data-ttu-id="b6ed1-313">除了修改 Windows 檔案總管的功能表列，您也可以將按鈕加入至工具列。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-313">In addition to modifying the Windows Explorer menu bar, you can also add buttons to the toolbar.</span></span> <span data-ttu-id="b6ed1-314">在功能表列中，修改工具列通常是 [**IShellView：： UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate) 執行的一部分。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-314">As with the menu bar, toolbar modification is usually part of the [**IShellView::UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate) implementation.</span></span> <span data-ttu-id="b6ed1-315">將按鈕新增至 Windows 檔案總管工具列的程式如下：</span><span class="sxs-lookup"><span data-stu-id="b6ed1-315">The procedure for adding buttons to the Windows Explorer toolbar is:</span></span>

1.  <span data-ttu-id="b6ed1-316">將按鈕的點陣圖新增至工具列的影像清單。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-316">Add the button's bitmap to the toolbar's image list.</span></span>
2.  <span data-ttu-id="b6ed1-317">定義按鈕的文字字串。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-317">Define the button's text string.</span></span>
3.  <span data-ttu-id="b6ed1-318">將按鈕加入至工具列。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-318">Add the button to the toolbar.</span></span>

<span data-ttu-id="b6ed1-319">若要將點陣圖新增至工具列的影像清單，請藉由呼叫 [**IShellBrowser：： SendControlMsg**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-sendcontrolmsg)，將一個 [ [TB] \_ ADDBITMAP](../controls/tb-addbitmap.md)訊息傳送給工具列。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-319">To add a bitmap to a toolbar's image list, send the toolbar a [TB\_ADDBITMAP](../controls/tb-addbitmap.md) message by calling [**IShellBrowser::SendControlMsg**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-sendcontrolmsg).</span></span> <span data-ttu-id="b6ed1-320">若要指定工具列控制項，請將方法的 *id* 參數設定為 **FCW \_ 工具列**。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-320">To specify the toolbar control, set the method's *id* parameter to **FCW\_TOOLBAR**.</span></span> <span data-ttu-id="b6ed1-321">將 *wParam* 設定為點陣圖中的按鈕影像數目，並 *lParam* 至 [TBADDBITMAP](/windows/win32/api/commctrl/ns-commctrl-tbaddbitmap) 結構的位址。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-321">Set *wParam* to the number of button images in the bitmap, and *lParam* to the address of a [TBADDBITMAP](/windows/win32/api/commctrl/ns-commctrl-tbaddbitmap) structure.</span></span> <span data-ttu-id="b6ed1-322">映射索引會在 *pret* 參數中傳回。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-322">The image index is returned in the *pret* parameter.</span></span>

<span data-ttu-id="b6ed1-323">有兩種方式可以定義按鈕的字串：</span><span class="sxs-lookup"><span data-stu-id="b6ed1-323">There are two ways to define a string for the button:</span></span>

-   <span data-ttu-id="b6ed1-324">將字串指派給按鈕 [TBBUTTON](/windows/win32/api/commctrl/ns-commctrl-tbbutton)結構的 **iString** 成員。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-324">Assign the string to the **iString** member of the button's [TBBUTTON](/windows/win32/api/commctrl/ns-commctrl-tbbutton) structure.</span></span>
-   <span data-ttu-id="b6ed1-325">呼叫 [**IShellBrowser：： SendControlMsg**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-sendcontrolmsg) ，將 [ \_ ADDSTRING](../controls/tb-addstring.md) 訊息傳送至工具列控制項。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-325">Call [**IShellBrowser::SendControlMsg**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-sendcontrolmsg) to send the toolbar control a [TB\_ADDSTRING](../controls/tb-addstring.md) message.</span></span> <span data-ttu-id="b6ed1-326">*WParam* 參數應設為零，並將 *lParam* 參數設定為字串。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-326">The *wParam* parameter should be set to zero and the *lParam* parameter to the string.</span></span> <span data-ttu-id="b6ed1-327">字串索引會在 *pret* 參數中傳回。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-327">The string index is returned in the *pret* parameter.</span></span>

<span data-ttu-id="b6ed1-328">若要將按鈕加入至工具列，請填入 [TBBUTTON](/windows/win32/api/commctrl/ns-commctrl-tbbutton) 結構，並將它傳遞至 [**IShellBrowser：： SetToolbarItems**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-settoolbaritems)。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-328">To add the button to the toolbar, fill in a [TBBUTTON](/windows/win32/api/commctrl/ns-commctrl-tbbutton) structure and pass it to [**IShellBrowser::SetToolbarItems**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-settoolbaritems).</span></span> <span data-ttu-id="b6ed1-329">如同功能表，您的命令識別碼必須落在 FCIDM \_ SHVIEWFIRST 和 FCIDM \_ SHVIEWLAST 之間。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-329">As with the menu, your command ID must fall between FCIDM\_SHVIEWFIRST and FCIDM\_SHVIEWLAST.</span></span> <span data-ttu-id="b6ed1-330">工具列接著會將按鈕附加至現有按鈕的右邊。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-330">The toolbar will then append the button to the right of the existing buttons.</span></span>

<span data-ttu-id="b6ed1-331">例如，下列程式碼片段會將一個標準按鈕新增至 [Windows 檔案總管] 工具列，其中包含 [.IDB MYBUTTON] 的命令識別碼 \_ 。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-331">For instance, the following code fragment adds one standard button to the Windows Explorer toolbar with a command ID of IDB\_MYBUTTON.</span></span>


```
TBADDBITMAP tbadbm;
int iButtonIndex;
TBBUTTON tbb;

tbadbm.hInst = g_hInstance;    // The module's instance handle
tbadbm.nID = IDB_BUTTONIMAGE;  // The bitmap's resource ID

psb->SendControlMsg(FCW_TOOLBAR, TB_ADDBITMAP, 1,
                    reinterpret_cast<LPARAM>(&tbadbm), &iButtonIndex);

psb->SendControlMsg(FCW_TOOLBAR, TB_ADDSTRING, NULL,
                    reinterpret_cast<LPARAM>(szLabel), &iStringIndex);

ZeroMemory(&tbb, sizeof(TBBUTTON));
tbb.iBitmap = iButtonIndex;
tbb.iCommand = IDB_MYBUTTON;
tbb.iString = iStringIndex;
tbb.fsState = TBSTATE_ENABLED;
tbb.fsStyle = TBSTYLE_BUTTON;

psb->SetToolbarItems(&tbb, 1, FCT_MERGE);
```



<span data-ttu-id="b6ed1-332">如需如何處理工具列控制項的進一步討論，請參閱 [工具列控制項](../controls/toolbar-control-reference.md)。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-332">For further discussion of how to handle toolbar controls, see [Toolbar Controls](../controls/toolbar-control-reference.md).</span></span>

### <a name="modifying-the-windows-explorer-status-bar"></a><span data-ttu-id="b6ed1-333">修改 Windows 檔案總管狀態列</span><span class="sxs-lookup"><span data-stu-id="b6ed1-333">Modifying the Windows Explorer Status Bar</span></span>

<span data-ttu-id="b6ed1-334">您可以使用 Windows 檔案總管狀態列來顯示各種有用的資訊。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-334">You can use the Windows Explorer status bar to display a variety of useful information.</span></span> <span data-ttu-id="b6ed1-335">有兩種方式可以使用狀態列：</span><span class="sxs-lookup"><span data-stu-id="b6ed1-335">There are two ways to use the status bar:</span></span>

-   <span data-ttu-id="b6ed1-336">使用 [**IShellBrowser：： SetStatusTextSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-setstatustextsb) 在狀態列上顯示文字字串。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-336">Use [**IShellBrowser::SetStatusTextSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-setstatustextsb) to display a text string on the status bar.</span></span>
-   <span data-ttu-id="b6ed1-337">將訊息直接傳送至具有 [**IShellBrowser：： SendControlMsg**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-sendcontrolmsg)的狀態列控制項。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-337">Send messages directly to the status bar control with [**IShellBrowser::SendControlMsg**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-sendcontrolmsg).</span></span>

<span data-ttu-id="b6ed1-338">第一個方法很簡單，但也足以滿足許多用途。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-338">The first method is straightforward but sufficient for many purposes.</span></span> <span data-ttu-id="b6ed1-339">為了提供更大的彈性，您可以呼叫 [**IShellBrowser：： SendControlMsg**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-sendcontrolmsg) ，並將 *id* 參數設定為 **FCW \_ status**，將訊息直接傳送至狀態列控制項。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-339">For greater flexibility, you can send messages directly to the status bar control by calling [**IShellBrowser::SendControlMsg**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-sendcontrolmsg) with the *id* parameter set to **FCW\_STATUS**.</span></span> <span data-ttu-id="b6ed1-340">如需狀態列控制項的進一步討論，請參閱 [狀態列](../controls/status-bars.md)。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-340">For further discussion of status bar controls, see [Status Bars](../controls/status-bars.md).</span></span>

### <a name="storing-view-specific-information"></a><span data-ttu-id="b6ed1-341">儲存視圖特定資訊</span><span class="sxs-lookup"><span data-stu-id="b6ed1-341">Storing View-specific Information</span></span>

<span data-ttu-id="b6ed1-342">當某個視圖即將終結時，儲存資訊（例如，視圖的狀態或設定）通常會很有用。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-342">When a view is about to be destroyed, it is often useful to store information such as the view's state or settings.</span></span> <span data-ttu-id="b6ed1-343">Windows 檔案總管會提示您藉由呼叫 [**IShellView：： SaveViewState**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-saveviewstate)來執行這項工作。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-343">Windows Explorer prompts you to do this task by calling [**IShellView::SaveViewState**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-saveviewstate).</span></span> <span data-ttu-id="b6ed1-344">儲存視圖特定資訊的慣用方式是呼叫 [**IShellBrowser：： GetViewStateStream**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-getviewstatestream)。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-344">The preferred way to save view-specific information is to call [**IShellBrowser::GetViewStateStream**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-getviewstatestream).</span></span> <span data-ttu-id="b6ed1-345">這個方法會提供您可用來儲存資訊的 [IStream](/windows/win32/api/objidl/nn-objidl-istream) 介面。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-345">This method provides you with an [IStream](/windows/win32/api/objidl/nn-objidl-istream) interface that you can use to store the information.</span></span> <span data-ttu-id="b6ed1-346">您可以自由使用任何適合的資料格式。</span><span class="sxs-lookup"><span data-stu-id="b6ed1-346">You are free to use any suitable data format.</span></span>

 

 
