---
title: 建立磁片清理處理常式
description: 在電腦的世界中，一次條真理經過證實的時間，不論電腦的儲存容量大小為何，最後都會填滿。
ms.assetid: f85e0db7-fbdb-452e-90c8-672f716b5692
keywords:
- 磁片清理處理常式
- 磁碟清理
- DataDrivenCleaner
- 註冊，磁片清理處理常式
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 30584439ae2c38ae8a9b7106dae96f69eea5df37
ms.sourcegitcommit: ae73f4dd3cf5a3c6a1ea7d191ca32a5b01f6686b
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/08/2020
ms.locfileid: "106967930"
---
# <a name="creating-a-disk-cleanup-handler"></a><span data-ttu-id="fa989-107">建立磁片清理處理常式</span><span class="sxs-lookup"><span data-stu-id="fa989-107">Creating a Disk Cleanup Handler</span></span>

<span data-ttu-id="fa989-108">在電腦的世界中，一次條真理經過證實的時間，不論電腦的儲存容量大小為何，最後都會填滿。</span><span class="sxs-lookup"><span data-stu-id="fa989-108">One axiom proven time and again in the world of computers is that regardless of the size of your computer's storage capacity, you will eventually fill it up.</span></span> <span data-ttu-id="fa989-109">雖然電腦硬碟的平均大小會隨著時間大幅增加，但應用程式也會隨之增加，讓使用者尋找建立更多可用硬碟空間的方法。</span><span class="sxs-lookup"><span data-stu-id="fa989-109">While the average size of a computer's hard disk has increased dramatically over time, applications have also grown accordingly, leaving users looking for ways to create more free hard disk space.</span></span> <span data-ttu-id="fa989-110">應用程式基於備份或效能考慮而建立的許多暫存檔案，也會減少可用空間。</span><span class="sxs-lookup"><span data-stu-id="fa989-110">Available space is also reduced by the many temporary files that applications create for backup or performance reasons.</span></span> <span data-ttu-id="fa989-111">當磁碟空間變少時，就必須減少應用程式所使用的空間量。</span><span class="sxs-lookup"><span data-stu-id="fa989-111">When disk space becomes low, it becomes necessary to reduce the amount of space used by applications.</span></span> <span data-ttu-id="fa989-112">您可以使用各種不同的方法來釋放磁碟空間，包括下列各項：</span><span class="sxs-lookup"><span data-stu-id="fa989-112">Disk space can be freed using a variety of means, including the following:</span></span>

-   <span data-ttu-id="fa989-113">刪除檔案。</span><span class="sxs-lookup"><span data-stu-id="fa989-113">Deleting files.</span></span>
-   <span data-ttu-id="fa989-114">壓縮檔案。</span><span class="sxs-lookup"><span data-stu-id="fa989-114">Compressing files.</span></span>
-   <span data-ttu-id="fa989-115">將檔案移至備份媒體。</span><span class="sxs-lookup"><span data-stu-id="fa989-115">Moving files to a backup medium.</span></span>
-   <span data-ttu-id="fa989-116">將檔案傳送至遠端伺服器。</span><span class="sxs-lookup"><span data-stu-id="fa989-116">Transferring files to a remote server.</span></span>

<span data-ttu-id="fa989-117">非常適合清除的檔案包括：</span><span class="sxs-lookup"><span data-stu-id="fa989-117">Files that are good candidates for cleanup include:</span></span>

-   <span data-ttu-id="fa989-118">使用者將永遠不需要的檔案。</span><span class="sxs-lookup"><span data-stu-id="fa989-118">Files that the user will never need again.</span></span>
-   <span data-ttu-id="fa989-119">只有基於效能考慮才存在的暫存檔案。</span><span class="sxs-lookup"><span data-stu-id="fa989-119">Temporary files that exist only for performance reasons.</span></span>
-   <span data-ttu-id="fa989-120">可從安裝光碟還原的檔案（如有需要）。</span><span class="sxs-lookup"><span data-stu-id="fa989-120">Files that can be restored, if needed, from an installation CD.</span></span>
-   <span data-ttu-id="fa989-121">可能已由較新版本取代的資料檔案，例如舊的備份檔案。</span><span class="sxs-lookup"><span data-stu-id="fa989-121">Data files that have possibly been superseded by newer versions, such as old backup files.</span></span>
-   <span data-ttu-id="fa989-122">長時間未使用的舊檔案。</span><span class="sxs-lookup"><span data-stu-id="fa989-122">Older files that have not been used in a long time.</span></span>

<span data-ttu-id="fa989-123">刪除特別適用于使用者不再需要的檔案，例如基於效能考慮暫時快取的檔案。</span><span class="sxs-lookup"><span data-stu-id="fa989-123">Deletion is particularly appropriate for files that the user will never need again for example, files that are temporarily cached for performance reasons.</span></span> <span data-ttu-id="fa989-124">刪除也適合方便還原的檔案，例如可從安裝光碟重載的圖形檔案。</span><span class="sxs-lookup"><span data-stu-id="fa989-124">Deletion is also appropriate for files that are easily restored, such as graphics files that can be reloaded from an installation CD.</span></span> <span data-ttu-id="fa989-125">使用者稍後可能需要或難以重建的檔案，是更適合壓縮或備份的候選項目。</span><span class="sxs-lookup"><span data-stu-id="fa989-125">Files that the user might need later or that would be difficult to reconstruct are better candidates for compression or backup.</span></span>

<span data-ttu-id="fa989-126">需要使用者手動清除檔案系統並不是理想的解決方案。</span><span class="sxs-lookup"><span data-stu-id="fa989-126">Expecting a user to manually clean the file system is not a good solution.</span></span> <span data-ttu-id="fa989-127">使用者可能不知道有許多檔案的所在位置，或是如何辨識哪些檔案可以安全地移除。</span><span class="sxs-lookup"><span data-stu-id="fa989-127">The user may not know where many of the files are located or how to recognize which ones can be safely removed.</span></span> <span data-ttu-id="fa989-128">此外，使用者可能會有可能刪除重要檔案的風險。</span><span class="sxs-lookup"><span data-stu-id="fa989-128">In addition, there's the risk that the user might delete essential files.</span></span>

<span data-ttu-id="fa989-129">本主題將討論磁片清理公用程式的下列 facet。</span><span class="sxs-lookup"><span data-stu-id="fa989-129">The following facets of the Disk Cleanup utility are discussed in this topic.</span></span>

-   [<span data-ttu-id="fa989-130">Windows 磁片清理公用程式</span><span class="sxs-lookup"><span data-stu-id="fa989-130">The Windows Disk Cleanup Utility</span></span>](#the-windows-disk-cleanup-utility)
-   [<span data-ttu-id="fa989-131">執行基本概念</span><span class="sxs-lookup"><span data-stu-id="fa989-131">Implementation Basics</span></span>](#implementation-basics)
    -   [<span data-ttu-id="fa989-132">Initialize/InitializeEx</span><span class="sxs-lookup"><span data-stu-id="fa989-132">Initialize/InitializeEx</span></span>](#initializeinitializeex)
    -   [<span data-ttu-id="fa989-133">GetSpaceUsed</span><span class="sxs-lookup"><span data-stu-id="fa989-133">GetSpaceUsed</span></span>](#getspaceused)
    -   [<span data-ttu-id="fa989-134">Interactivesession.showproperties</span><span class="sxs-lookup"><span data-stu-id="fa989-134">ShowProperties</span></span>](#showproperties)
    -   [<span data-ttu-id="fa989-135">清除</span><span class="sxs-lookup"><span data-stu-id="fa989-135">Purge</span></span>](#purge)
    -   [<span data-ttu-id="fa989-136">停用</span><span class="sxs-lookup"><span data-stu-id="fa989-136">Deactivate</span></span>](#deactivate)
-   [<span data-ttu-id="fa989-137">註冊磁片清理處理常式</span><span class="sxs-lookup"><span data-stu-id="fa989-137">Registering a Disk Cleanup Handler</span></span>](#registering-a-disk-cleanup-handler)
    -   [<span data-ttu-id="fa989-138">註冊處理常式的 CLSID</span><span class="sxs-lookup"><span data-stu-id="fa989-138">Registering a Handler's CLSID</span></span>](#registering-a-handlers-clsid)
    -   [<span data-ttu-id="fa989-139">使用磁片清理管理員來註冊處理常式：一般</span><span class="sxs-lookup"><span data-stu-id="fa989-139">Registering a Handler with the Disk Cleanup Manager: General</span></span>](#registering-a-handler-with-the-disk-cleanup-manager-general)
    -   [<span data-ttu-id="fa989-140">使用磁片清理管理員來註冊處理常式： Windows 2000 或更新版本的系統</span><span class="sxs-lookup"><span data-stu-id="fa989-140">Registering a Handler with the Disk Cleanup Manager: Windows 2000 or Later Systems</span></span>](#registering-a-handler-with-the-disk-cleanup-manager-windows-2000-or-later-systems)
    -   [<span data-ttu-id="fa989-141">使用 DataDrivenCleaner 物件</span><span class="sxs-lookup"><span data-stu-id="fa989-141">Using the DataDrivenCleaner Object</span></span>](#using-the-datadrivencleaner-object)
    -   [<span data-ttu-id="fa989-142">磁片清理處理常式的註冊範例</span><span class="sxs-lookup"><span data-stu-id="fa989-142">Example Registration of a Disk Cleanup Handler</span></span>](#example-registration-of-a-disk-cleanup-handler)

## <a name="the-windows-disk-cleanup-utility"></a><span data-ttu-id="fa989-143">Windows 磁片清理公用程式</span><span class="sxs-lookup"><span data-stu-id="fa989-143">The Windows Disk Cleanup Utility</span></span>

<span data-ttu-id="fa989-144">從 Windows 98 開始，Windows 作業系統包含磁片清理，這是一個公用程式，可讓使用者更輕鬆地管理可用的硬碟空間。</span><span class="sxs-lookup"><span data-stu-id="fa989-144">Starting on Windows 98, the Windows operating system includes Disk Cleanup, a utility that makes it much easier for the user to manage available hard disk space.</span></span> <span data-ttu-id="fa989-145">磁片清理公用程式是設計用來釋出盡可能多的磁碟空間，並降低使用者不小心刪除重要檔案的風險。</span><span class="sxs-lookup"><span data-stu-id="fa989-145">The Disk Cleanup utility is designed to free up as much disk space as possible and decrease the risk that the user will delete essential files accidentally.</span></span>

<span data-ttu-id="fa989-146">您可以用三種方式起始磁片清理。</span><span class="sxs-lookup"><span data-stu-id="fa989-146">Disk cleanup can be initiated in three ways.</span></span>

-   <span data-ttu-id="fa989-147">使用者可以按一下 [ **開始**] 來起始磁片清理;指向 [ **所有程式**]、[ **附屬** 應用程式] 和 [ **系統工具**];然後按一下 [ **磁片清理**]。</span><span class="sxs-lookup"><span data-stu-id="fa989-147">The user can initiate disk cleanup by clicking **Start**; pointing to **All Programs**, **Accessories**, and **System Tools**; and then clicking **Disk Cleanup**.</span></span>
-   <span data-ttu-id="fa989-148">系統會通知使用者，指出未使用的磁碟空間已達重大模式。</span><span class="sxs-lookup"><span data-stu-id="fa989-148">The system notifies the user with a message box that unused disk space has reached critical mode.</span></span> <span data-ttu-id="fa989-149">大於 2.25 gb 的磁片磁碟機的重大模式閾值 (GB) 200 mb (MB) 。</span><span class="sxs-lookup"><span data-stu-id="fa989-149">The critical mode threshold for a drive larger than 2.25 gigabytes (GB) is 200 megabytes (MB).</span></span> <span data-ttu-id="fa989-150">後續的警告會在80、50和 1 MB 提供。</span><span class="sxs-lookup"><span data-stu-id="fa989-150">Subsequent warnings are given at 80, 50, and 1 MB.</span></span> <span data-ttu-id="fa989-151">使用者可以選擇手動釋出磁碟空間，或啟動磁片清理公用程式。</span><span class="sxs-lookup"><span data-stu-id="fa989-151">The user is given the option of freeing disk space manually or starting the Disk Cleanup utility.</span></span>
-   <span data-ttu-id="fa989-152">使用者可以讓 Windows 排程的工作 Wizard (稱為舊版系統上的維護嚮導) 在排程的時間自動執行磁片清理公用程式。</span><span class="sxs-lookup"><span data-stu-id="fa989-152">The user can have the Windows Scheduled Task Wizard (known as the Maintenance Wizard on older systems) run the Disk Cleanup utility automatically at scheduled times.</span></span>

<span data-ttu-id="fa989-153">磁片清理所固有的基本挑戰是，盡可能釋放磁碟空間，而不需要刪除重要的檔案。</span><span class="sxs-lookup"><span data-stu-id="fa989-153">The basic challenge inherent in disk cleanup is to free as much disk space as possible without deleting essential files.</span></span> <span data-ttu-id="fa989-154">因為沒有任何標準的方式可標示要清除的檔案，所以沒有任何單一應用程式可以可靠地偵測和清除所有 unessential 檔案。</span><span class="sxs-lookup"><span data-stu-id="fa989-154">Because there is no standard way to mark files for cleanup, no single application can reliably detect and clean all unessential files.</span></span> <span data-ttu-id="fa989-155">磁片清理公用程式會藉由分割單一 *磁片清理管理員* 與 *磁片清理處理常式* 集合之間的清除操作來解決此問題。</span><span class="sxs-lookup"><span data-stu-id="fa989-155">The Disk Cleanup utility addresses this problem by splitting the cleanup operation between a single *disk cleanup manager* and a collection of *disk cleanup handlers*.</span></span>

<span data-ttu-id="fa989-156">執行磁片清理公用程式時，使用者會看到下列對話方塊。</span><span class="sxs-lookup"><span data-stu-id="fa989-156">When the Disk Cleanup utility is run, the user sees the following dialog box.</span></span> <span data-ttu-id="fa989-157"> (如果電腦上有一個以上的磁片或磁碟分割，系統會先要求使用者選擇磁片磁碟機，然後才會顯示此對話方塊。 ) </span><span class="sxs-lookup"><span data-stu-id="fa989-157">(If more than one disk or disk partition exists on the computer, the user is first asked to choose a drive before this dialog is displayed.)</span></span>

![[清除] 對話方塊的螢幕擷取畫面](images/cleanup1.png)

<span data-ttu-id="fa989-159">磁片清理管理員是作業系統的一部分。</span><span class="sxs-lookup"><span data-stu-id="fa989-159">The disk cleanup manager is part of the operating system.</span></span> <span data-ttu-id="fa989-160">它會顯示上圖中顯示的對話方塊、處理使用者輸入，以及管理清除操作。</span><span class="sxs-lookup"><span data-stu-id="fa989-160">It displays the dialog box shown in the preceding illustration, handles user input, and manages the cleanup operation.</span></span> <span data-ttu-id="fa989-161">實際選取和清除不需要的檔案是由 [磁片清理管理員] 清單方塊中顯示的個別磁片清理處理常式所完成。</span><span class="sxs-lookup"><span data-stu-id="fa989-161">The actual selection and cleanup of unneeded files is done by the individual disk cleanup handlers shown in the disk cleanup manager's list box.</span></span> <span data-ttu-id="fa989-162">使用者可以選擇啟用或停用個別處理常式，方法是在 [磁片清理管理員] UI 中選取或清除其核取方塊。</span><span class="sxs-lookup"><span data-stu-id="fa989-162">The user has the option of enabling or disabling individual handlers by selecting or clearing their check box in the disk cleanup manager's UI.</span></span>

<span data-ttu-id="fa989-163">每個處理常式都負責一組妥善定義的檔案。</span><span class="sxs-lookup"><span data-stu-id="fa989-163">Each handler is responsible for a well defined set of files.</span></span> <span data-ttu-id="fa989-164">例如，在圖例中選取的處理常式會負責清除下載的程式檔。</span><span class="sxs-lookup"><span data-stu-id="fa989-164">For example, the selected handler in the illustration is responsible for cleaning up downloaded program files.</span></span> <span data-ttu-id="fa989-165">在圖例中選取的處理常式也會提供 [ **View Files** ] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="fa989-165">The handler selected in the illustration also provides a **View Files** button.</span></span> <span data-ttu-id="fa989-166">藉由按一下按鈕，使用者可以要求處理常式顯示 UI，通常是 Windows 檔案總管視窗，可讓使用者指定要清除的檔案或檔案類別。</span><span class="sxs-lookup"><span data-stu-id="fa989-166">By clicking the button, the user can request that the handler display a UI typically a Windows Explorer window that allows the user to specify which files or classes of files to clean.</span></span>

<span data-ttu-id="fa989-167">雖然 Windows 有一些磁片清理處理常式，但它們並不是用來處理其他應用程式所產生的檔案。</span><span class="sxs-lookup"><span data-stu-id="fa989-167">Although Windows comes with a number of disk cleanup handlers, they aren't designed to handle files produced by other applications.</span></span> <span data-ttu-id="fa989-168">磁片清理管理員的設計目的是要讓任何開發人員都能執行並註冊自己的磁片清理處理常式，以提供彈性且可擴充的功能。</span><span class="sxs-lookup"><span data-stu-id="fa989-168">Instead, the disk cleanup manager is designed to be flexible and extensible by enabling any developer to implement and register their own disk cleanup handler.</span></span> <span data-ttu-id="fa989-169">任何開發人員都可以藉由執行和註冊磁片清理處理常式來擴充可用的磁片清理服務。</span><span class="sxs-lookup"><span data-stu-id="fa989-169">Any developer can extend the available disk cleanup services by implementing and registering a disk cleanup handler.</span></span>

<span data-ttu-id="fa989-170">產生暫存檔案的所有應用程式都可以執行和註冊磁片清理處理常式。</span><span class="sxs-lookup"><span data-stu-id="fa989-170">All applications that produce temporary files can and should implement and register a disk cleanup handler.</span></span> <span data-ttu-id="fa989-171">這麼做可讓使用者有便利且可靠的方式來管理應用程式的暫存檔案。</span><span class="sxs-lookup"><span data-stu-id="fa989-171">Doing so gives users a convenient and reliable way to manage the application's temporary files.</span></span> <span data-ttu-id="fa989-172">當您執行此處理程式時，您可以決定哪些檔案受到影響，並決定實際的清除動作。</span><span class="sxs-lookup"><span data-stu-id="fa989-172">When you implement the handler, you can decide which files are affected and determine how the actual cleanup happens.</span></span>

## <a name="implementation-basics"></a><span data-ttu-id="fa989-173">執行基本概念</span><span class="sxs-lookup"><span data-stu-id="fa989-173">Implementation Basics</span></span>

<span data-ttu-id="fa989-174">清除處理常式是 (COM) 物件的同進程伺服器元件物件模型。</span><span class="sxs-lookup"><span data-stu-id="fa989-174">Cleanup handlers are in-process server Component Object Model (COM) objects.</span></span> <span data-ttu-id="fa989-175">Windows 提供現有的處理常式物件，稱為 DataDrivenCleaner 供您使用。</span><span class="sxs-lookup"><span data-stu-id="fa989-175">Windows provides an existing handler object called the DataDrivenCleaner for your use.</span></span> <span data-ttu-id="fa989-176">您也可以選擇自行執行處理常式，以提供更大的彈性。</span><span class="sxs-lookup"><span data-stu-id="fa989-176">You can also opt to implement a handler yourself for more flexibility.</span></span> <span data-ttu-id="fa989-177">然後，這些物件可讓您指定如何選取檔案、釋放磁碟空間，以及在執行的處理常式時，顯示選用的 UI 以進行更細微的控制。</span><span class="sxs-lookup"><span data-stu-id="fa989-177">These objects then allow you to specify how to select files, free disk space, and, in the case of an implemented handler, display the optional UI for more granular control.</span></span> <span data-ttu-id="fa989-178">本節將討論如何執行您自己的處理常式。</span><span class="sxs-lookup"><span data-stu-id="fa989-178">This section addresses the matter of implementing your own handler.</span></span> <span data-ttu-id="fa989-179">如需有關使用 DataDrivenCleaner 物件的詳細資訊，請參閱 [使用 DataDrivenCleaner 物件](#using-the-datadrivencleaner-object)。</span><span class="sxs-lookup"><span data-stu-id="fa989-179">For details concerning the use of the DataDrivenCleaner object, see [Using the DataDrivenCleaner Object](#using-the-datadrivencleaner-object).</span></span>

<span data-ttu-id="fa989-180">磁片清理處理常式應該執行這五個基本工作。</span><span class="sxs-lookup"><span data-stu-id="fa989-180">A disk cleanup handler should perform these five basic tasks.</span></span>

-   <span data-ttu-id="fa989-181">初始化處理常式物件。</span><span class="sxs-lookup"><span data-stu-id="fa989-181">Initialize the handler object.</span></span>
-   <span data-ttu-id="fa989-182">掃描磁片以判斷可以釋放多少磁碟空間。</span><span class="sxs-lookup"><span data-stu-id="fa989-182">Scan the disk to determine how much disk space can be freed.</span></span>
-   <span data-ttu-id="fa989-183">顯示 UI 以取得要清除哪些檔案的使用者意見反應。</span><span class="sxs-lookup"><span data-stu-id="fa989-183">Display the UI to obtain user feedback about which files to clean.</span></span> <span data-ttu-id="fa989-184">(選用)</span><span class="sxs-lookup"><span data-stu-id="fa989-184">(Optional)</span></span>
-   <span data-ttu-id="fa989-185">進行清除。</span><span class="sxs-lookup"><span data-stu-id="fa989-185">Do the cleanup.</span></span>
-   <span data-ttu-id="fa989-186">[關閉]。</span><span class="sxs-lookup"><span data-stu-id="fa989-186">Shut down.</span></span>

<span data-ttu-id="fa989-187">若要讓「磁片清理管理員」管理這些工作，處理常式必須將 windows 98 的 [**IEmptyVolumeCache**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache) 或 Windows Millennium Edition 的 [**IEmptyVolumeCache2**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache2) 匯出 (Windows Me) 、WINDOWS 2000 和 windows XP。</span><span class="sxs-lookup"><span data-stu-id="fa989-187">To allow the disk cleanup manager to manage these tasks, a handler must export either [**IEmptyVolumeCache**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache) for Windows 98 or [**IEmptyVolumeCache2**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache2) for Windows Millennium Edition (Windows Me), Windows 2000, and Windows XP.</span></span> <span data-ttu-id="fa989-188">由於 **IEmptyVolumeCache2** 繼承自 **IEmptyVolumeCache**，因此只新增額外的方法 **InitializeEx**，因此不需要額外的工作來執行兩者。</span><span class="sxs-lookup"><span data-stu-id="fa989-188">Because **IEmptyVolumeCache2** inherits from **IEmptyVolumeCache**, adding only the additional method **InitializeEx**, relatively little extra work is required to implement both.</span></span> <span data-ttu-id="fa989-189">除非您的處理常式只適用于其中一個作業系統，否則它應該匯出這兩個介面。</span><span class="sxs-lookup"><span data-stu-id="fa989-189">Unless your handler is intended for only one of these operating systems, it should export both interfaces.</span></span>

<span data-ttu-id="fa989-190">若要匯出這些介面，您必須執行對應至五個基本工作的這些方法。</span><span class="sxs-lookup"><span data-stu-id="fa989-190">To export these interfaces, you must implement these methods corresponding to the five basic tasks.</span></span>

-   [<span data-ttu-id="fa989-191">Initialize/InitializeEx</span><span class="sxs-lookup"><span data-stu-id="fa989-191">Initialize/InitializeEx</span></span>](#initializeinitializeex)
-   [<span data-ttu-id="fa989-192">GetSpaceUsed</span><span class="sxs-lookup"><span data-stu-id="fa989-192">GetSpaceUsed</span></span>](#getspaceused)
-   [<span data-ttu-id="fa989-193">Interactivesession.showproperties</span><span class="sxs-lookup"><span data-stu-id="fa989-193">ShowProperties</span></span>](#showproperties)
-   [<span data-ttu-id="fa989-194">清除</span><span class="sxs-lookup"><span data-stu-id="fa989-194">Purge</span></span>](#purge)
-   [<span data-ttu-id="fa989-195">停用</span><span class="sxs-lookup"><span data-stu-id="fa989-195">Deactivate</span></span>](#deactivate)

### <a name="initializeinitializeex"></a><span data-ttu-id="fa989-196">Initialize/InitializeEx</span><span class="sxs-lookup"><span data-stu-id="fa989-196">Initialize/InitializeEx</span></span>

<span data-ttu-id="fa989-197">執行磁片清理公用程式時，會呼叫兩個相當類似的初始化方法。</span><span class="sxs-lookup"><span data-stu-id="fa989-197">The two initialization methods, which are quite similar, are called when the Disk Cleanup utility is run.</span></span> <span data-ttu-id="fa989-198">Windows 98 磁片清理管理員會呼叫處理常式的 [**IEmptyVolumeCache：： Initialize**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-initialize) 方法。</span><span class="sxs-lookup"><span data-stu-id="fa989-198">The Windows 98 disk cleanup manager calls a handler's [**IEmptyVolumeCache::Initialize**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-initialize) method.</span></span> <span data-ttu-id="fa989-199">不過，Windows Millennium Edition (Windows Me) 、Windows 2000 或 Windows XP disk 清理管理員，會先嘗試呼叫 [**IEmptyVolumeCache2：： InitializeEx**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex) ，而且只有在處理常式未公開 [**IEmptyVolumeCache2**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache2)時，才會使用 **IEmptyVolumeCache：： Initialize** 。</span><span class="sxs-lookup"><span data-stu-id="fa989-199">The Windows Millennium Edition (Windows Me), Windows 2000, or Windows XP disk cleanup manager, however, first tries calling [**IEmptyVolumeCache2::InitializeEx**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex) and only uses **IEmptyVolumeCache::Initialize** if [**IEmptyVolumeCache2**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache2) is not exposed by the handler.</span></span> <span data-ttu-id="fa989-200">磁片清理管理員會將資訊傳遞給方法，例如處理常式的登錄機碼和要清除的磁片區。</span><span class="sxs-lookup"><span data-stu-id="fa989-200">The disk cleanup manager passes information to the method, such as the handler's registry key and the disk volume that is to be cleaned.</span></span>

<span data-ttu-id="fa989-201">這兩種方法都可以傳回各種顯示字串，並設定一或多個旗標。</span><span class="sxs-lookup"><span data-stu-id="fa989-201">Either method can return various display strings and set one or more flags.</span></span> <span data-ttu-id="fa989-202">這兩種方法的主要差異在於如何處理磁片清理管理員中顯示的文字。</span><span class="sxs-lookup"><span data-stu-id="fa989-202">The primary difference between the two methods is how the text displayed in the disk cleanup manager is handled.</span></span> <span data-ttu-id="fa989-203">下列三個字串會受到影響。</span><span class="sxs-lookup"><span data-stu-id="fa989-203">The following three strings are affected.</span></span>



| <span data-ttu-id="fa989-204">String</span><span class="sxs-lookup"><span data-stu-id="fa989-204">String</span></span>       | <span data-ttu-id="fa989-205">目的</span><span class="sxs-lookup"><span data-stu-id="fa989-205">Purpose</span></span>                                                                            | <span data-ttu-id="fa989-206">初始化</span><span class="sxs-lookup"><span data-stu-id="fa989-206">Initialize</span></span>                                                                           | <span data-ttu-id="fa989-207">InitializeEx</span><span class="sxs-lookup"><span data-stu-id="fa989-207">InitializeEx</span></span>                                                                                     |
|--------------|------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------|
| <span data-ttu-id="fa989-208">顯示名稱</span><span class="sxs-lookup"><span data-stu-id="fa989-208">Display Name</span></span> | <span data-ttu-id="fa989-209">處理常式的名稱會顯示在 [磁片清理管理員] 清單方塊中。</span><span class="sxs-lookup"><span data-stu-id="fa989-209">The handler's name displayed in the disk cleanup manager's list box.</span></span>               | <span data-ttu-id="fa989-210">如果 *ppwszDisplayName* 為 **Null**，則會從登錄取出預設值。</span><span class="sxs-lookup"><span data-stu-id="fa989-210">If *ppwszDisplayName* is **NULL**, the default value is retrieved from the registry.</span></span> | <span data-ttu-id="fa989-211">您必須在 *ppwszDisplayName* 中指定正確的當地語系化字串，而不會使用任何登錄值。</span><span class="sxs-lookup"><span data-stu-id="fa989-211">A properly localized string must be specified in *ppwszDisplayName* no registry values are used.</span></span> |
| <span data-ttu-id="fa989-212">Description</span><span class="sxs-lookup"><span data-stu-id="fa989-212">Description</span></span>  | <span data-ttu-id="fa989-213">選取處理常式的名稱時，顯示于清單方塊下方的描述性文字。</span><span class="sxs-lookup"><span data-stu-id="fa989-213">Descriptive text displayed below the list box when the handler's name is selected.</span></span> | <span data-ttu-id="fa989-214">如果 *ppwszDescription* 為 **Null**，則會從登錄取出預設值。</span><span class="sxs-lookup"><span data-stu-id="fa989-214">If *ppwszDescription* is **NULL**, the default value is retrieved from the registry.</span></span> | <span data-ttu-id="fa989-215">您必須在 *ppwszDescription* 中指定正確的當地語系化字串，而不會使用任何登錄值。</span><span class="sxs-lookup"><span data-stu-id="fa989-215">A properly localized string must be specified in *ppwszDescription* no registry values are used.</span></span> |
| <span data-ttu-id="fa989-216">按鈕文字</span><span class="sxs-lookup"><span data-stu-id="fa989-216">Button Text</span></span>  | <span data-ttu-id="fa989-217">選擇性按鈕的文字，可讓使用者顯示處理常式的 UI。</span><span class="sxs-lookup"><span data-stu-id="fa989-217">Text for the optional button that allows users to display the handler's UI.</span></span>        | <span data-ttu-id="fa989-218">沒有任何可用的參數。</span><span class="sxs-lookup"><span data-stu-id="fa989-218">No parameter available.</span></span> <span data-ttu-id="fa989-219">必須在登錄中指定。</span><span class="sxs-lookup"><span data-stu-id="fa989-219">Must be specified in the registry.</span></span>                           | <span data-ttu-id="fa989-220">您必須在 *ppwszBtnText* 中指定正確的當地語系化字串，而不會使用任何登錄值。</span><span class="sxs-lookup"><span data-stu-id="fa989-220">A properly localized string must be specified in *ppwszBtnText* no registry values are used.</span></span>     |



 

<span data-ttu-id="fa989-221">在這兩個初始化方法中找到的 *pdwFlags* 參數會辨識同一組旗標。</span><span class="sxs-lookup"><span data-stu-id="fa989-221">The *pdwFlags* parameter found in both initialization methods recognizes the same set of flags.</span></span> <span data-ttu-id="fa989-222">磁片清理管理員會將這兩個旗標傳遞給方法。</span><span class="sxs-lookup"><span data-stu-id="fa989-222">Two of these flags are passed to the method by the disk cleanup manager.</span></span>

-   <span data-ttu-id="fa989-223">**EVCF \_ SETTINGSMODE**</span><span class="sxs-lookup"><span data-stu-id="fa989-223">**EVCF\_SETTINGSMODE**</span></span>

    <span data-ttu-id="fa989-224">如果正在依排程執行磁片清理管理員，則會設定 **EVCF \_ SETTINGSMODE** 旗標。</span><span class="sxs-lookup"><span data-stu-id="fa989-224">If the disk cleanup manager is being run on a schedule, it sets the **EVCF\_SETTINGSMODE** flag.</span></span> <span data-ttu-id="fa989-225">如果設定此旗標，則「磁片清理管理員」不會呼叫 [GetSpaceUsed](#getspaceused)、 [清除](#purge)或 [interactivesession.showproperties](#showproperties) 方法。</span><span class="sxs-lookup"><span data-stu-id="fa989-225">If this flag is set, the disk cleanup manager does not call the [GetSpaceUsed](#getspaceused), [Purge](#purge), or [ShowProperties](#showproperties) methods.</span></span> <span data-ttu-id="fa989-226">處理常式的 [**Initialize**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-initialize) 或 [**InitializeEx**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex) 方法必須處理通常由 [**GetSpaceUsed**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-getspaceused) 和 [**清除**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-purge)執行的所有工作。</span><span class="sxs-lookup"><span data-stu-id="fa989-226">The handler's [**Initialize**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-initialize) or [**InitializeEx**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex) method must handle all of the tasks normally performed by [**GetSpaceUsed**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-getspaceused) and [**Purge**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-purge).</span></span> <span data-ttu-id="fa989-227">由於沒有機會提供使用者意見反應，因此應該只觸及非常安全地清除的檔案。</span><span class="sxs-lookup"><span data-stu-id="fa989-227">Because there is no opportunity for user feedback, only those files that are extremely safe to clean up should be touched.</span></span> <span data-ttu-id="fa989-228">您應忽略初始化方法的 *pcwszVolume* 參數，並清除不需要的檔案，不論它們在什麼磁片磁碟機上。</span><span class="sxs-lookup"><span data-stu-id="fa989-228">You should ignore the initialization method's *pcwszVolume* parameter and clean unneeded files regardless of what drive they are on.</span></span>

-   <span data-ttu-id="fa989-229">**EVCF \_ OUTOFDISKSPACE**</span><span class="sxs-lookup"><span data-stu-id="fa989-229">**EVCF\_OUTOFDISKSPACE**</span></span>

    <span data-ttu-id="fa989-230">如果已設定 **EVCF \_ OUTOFDISKSPACE** 旗標，則使用者的磁片磁碟機的空間相當短。</span><span class="sxs-lookup"><span data-stu-id="fa989-230">If the **EVCF\_OUTOFDISKSPACE** flag is set, the user's disk drive is critically short of space.</span></span> <span data-ttu-id="fa989-231">處理常式應該積極地刪除檔案，即使會導致效能遺失也一樣。</span><span class="sxs-lookup"><span data-stu-id="fa989-231">The handler should be aggressive about deleting files, even if it results in a performance loss.</span></span> <span data-ttu-id="fa989-232">不過，處理常式顯然不應該刪除會導致應用程式失敗或使用者遺失資料的檔案。</span><span class="sxs-lookup"><span data-stu-id="fa989-232">However, the handler obviously should not delete files that would cause an application to fail or the user to lose data.</span></span>

<span data-ttu-id="fa989-233">其餘旗標是由「磁片清理」處理常式所設定，並傳回到「磁片清理管理員」。</span><span class="sxs-lookup"><span data-stu-id="fa989-233">The remaining flags are set by the disk cleanup handler and returned to the disk cleanup manager.</span></span> <span data-ttu-id="fa989-234">如需詳細資訊，請參閱 [**IEmptyVolumeCache：： Initialize**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-initialize) 和 [**IEmptyVolumeCache2：： InitializeEx**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex)的方法參考頁面。</span><span class="sxs-lookup"><span data-stu-id="fa989-234">For more information, see the method reference pages for [**IEmptyVolumeCache::Initialize**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-initialize) and [**IEmptyVolumeCache2::InitializeEx**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex).</span></span>

-   <span data-ttu-id="fa989-235">EVCF \_ DONTSHOWIFZERO</span><span class="sxs-lookup"><span data-stu-id="fa989-235">EVCF\_DONTSHOWIFZERO</span></span>

    <span data-ttu-id="fa989-236">只有當 [**GetSpaceUsed**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-getspaceused) 傳回的值指出處理常式可以釋放一些磁碟空間時，才會在 [磁片清理管理員] 清單方塊中顯示處理常式。</span><span class="sxs-lookup"><span data-stu-id="fa989-236">Display the handler in the disk cleanup manager's list box only if the value returned by [**GetSpaceUsed**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-getspaceused) indicates that the handler can free some disk space.</span></span>

-   <span data-ttu-id="fa989-237">EVCF \_ ENABLEBYDEFAULT</span><span class="sxs-lookup"><span data-stu-id="fa989-237">EVCF\_ENABLEBYDEFAULT</span></span>

    <span data-ttu-id="fa989-238">指定預設會啟用處理常式。</span><span class="sxs-lookup"><span data-stu-id="fa989-238">Specifies that the handler is enabled by default.</span></span> <span data-ttu-id="fa989-239">除非使用者在磁片清理管理員的處理常式清單中清除其核取方塊，否則會在每次發生磁片清理時執行它。</span><span class="sxs-lookup"><span data-stu-id="fa989-239">It will run every time a disk cleanup takes place unless the user disables it by clearing its check box in the disk cleanup manager's list of handlers.</span></span>

-   <span data-ttu-id="fa989-240">EVCF \_ ENABLEBYDEFAULT \_ 自動</span><span class="sxs-lookup"><span data-stu-id="fa989-240">EVCF\_ENABLEBYDEFAULT\_AUTO</span></span>

    <span data-ttu-id="fa989-241">指定自動啟用處理常式，以便在排程的清除期間執行。</span><span class="sxs-lookup"><span data-stu-id="fa989-241">Specifies that the handler is automatically enabled to run during scheduled cleanups.</span></span>

-   <span data-ttu-id="fa989-242">EVCF \_ HASSETTINGS</span><span class="sxs-lookup"><span data-stu-id="fa989-242">EVCF\_HASSETTINGS</span></span>

    <span data-ttu-id="fa989-243">如果您的處理常式具有可顯示的 UI，請設定此旗標。</span><span class="sxs-lookup"><span data-stu-id="fa989-243">Set this flag if your handler has a UI to display.</span></span> <span data-ttu-id="fa989-244">在 [回應] 中，[磁片清理管理員] 會在清單方塊中選取該處理常式時顯示按鈕。</span><span class="sxs-lookup"><span data-stu-id="fa989-244">In response, the disk cleanup manager displays a button when that handler is selected in the list box.</span></span> <span data-ttu-id="fa989-245">如果按一下該按鈕，「磁片清理管理員」就會呼叫 [**interactivesession.showproperties**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-showproperties)。</span><span class="sxs-lookup"><span data-stu-id="fa989-245">If that button is clicked, the disk cleanup manager calls [**ShowProperties**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-showproperties).</span></span>

-   <span data-ttu-id="fa989-246">EVCF \_ REMOVEFROMLIST</span><span class="sxs-lookup"><span data-stu-id="fa989-246">EVCF\_REMOVEFROMLIST</span></span>

    <span data-ttu-id="fa989-247">在處理常式執行一次之後，從可用的處理常式清單中刪除處理常式的名稱。</span><span class="sxs-lookup"><span data-stu-id="fa989-247">Delete the handler's name from the list of available handlers after the handler has been run once.</span></span> <span data-ttu-id="fa989-248">也會一併刪除處理常式的登錄資訊。</span><span class="sxs-lookup"><span data-stu-id="fa989-248">The handler's registry information is also deleted.</span></span>

### <a name="getspaceused"></a><span data-ttu-id="fa989-249">GetSpaceUsed</span><span class="sxs-lookup"><span data-stu-id="fa989-249">GetSpaceUsed</span></span>

<span data-ttu-id="fa989-250">磁片清理管理員會呼叫這個方法，以判斷磁片清理處理常式可能可用的空間量。</span><span class="sxs-lookup"><span data-stu-id="fa989-250">The disk cleanup manager calls this method to determine how much space a disk cleanup handler can potentially free.</span></span> <span data-ttu-id="fa989-251">[磁片清理管理員] 接著會在清單方塊中顯示處理常式名稱右邊的值。</span><span class="sxs-lookup"><span data-stu-id="fa989-251">The disk cleanup manager then displays that value to the right of the handler's name in the list box.</span></span> <span data-ttu-id="fa989-252">當管理員啟動時，以及在管理員的主要 UI 顯示之前，所有向「磁片清理管理員」註冊的處理常式都會執行這項操作。</span><span class="sxs-lookup"><span data-stu-id="fa989-252">This operation is performed on all of the handlers registered with the disk cleanup manager when the manager is launched and before the manager's main UI is displayed.</span></span> <span data-ttu-id="fa989-253">呼叫 [**GetSpaceUsed**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-getspaceused) 時，處理常式應該掃描其負責的檔案、判斷哪些是清除候選項目，並傳回可釋放的磁碟空間量。</span><span class="sxs-lookup"><span data-stu-id="fa989-253">When [**GetSpaceUsed**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-getspaceused) is called, the handler should scan the files that it is responsible for, determine which of them are cleanup candidates, and return the amount of disk space that it can free.</span></span>

<span data-ttu-id="fa989-254">由於掃描可能是很長的程式，因此磁片清理管理員會使用這個方法的 *picb* 參數，將指標傳遞至 [**IEmptyVolumeCacheCallBack**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecachecallback) 介面。</span><span class="sxs-lookup"><span data-stu-id="fa989-254">Because scanning can be a lengthy process, the disk cleanup manager uses this method's *picb* parameter to pass a pointer to an [**IEmptyVolumeCacheCallBack**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecachecallback) interface.</span></span> <span data-ttu-id="fa989-255">處理常式會在掃描期間定期使用介面，以呼叫 [**IEmptyVolumeCacheCallBack：： ScanProgress**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecachecallback-scanprogress)，這有兩個用途。</span><span class="sxs-lookup"><span data-stu-id="fa989-255">The handler uses the interface periodically during the scan to call [**IEmptyVolumeCacheCallBack::ScanProgress**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecachecallback-scanprogress), which serves two purposes.</span></span>

-   <span data-ttu-id="fa989-256">允許 [磁片清理管理員] 更新進度列，通知使用者掃描的進度。</span><span class="sxs-lookup"><span data-stu-id="fa989-256">Allows the disk cleanup manager to update a progress bar, informing the user how the scan is progressing.</span></span>
-   <span data-ttu-id="fa989-257">當按一下進度視窗的 [ **取消** ] 按鈕時，通知處理常式停止掃描。</span><span class="sxs-lookup"><span data-stu-id="fa989-257">Notifies the handler to stop the scan in the event that the progress window's **Cancel** button is clicked.</span></span> <span data-ttu-id="fa989-258">該按鈕事件不會直接傳達給處理常式;相反地，磁片清理管理員會 \_ 在下一次 [**GetSpaceUsed**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-getspaceused) 呼叫 [**IEmptyVolumeCacheCallBack：： ScanProgress**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecachecallback-scanprogress)時，傳回 E ABORT。</span><span class="sxs-lookup"><span data-stu-id="fa989-258">That button event is not communicated directly to the handler; instead, the disk cleanup manager returns E\_ABORT the next time [**GetSpaceUsed**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-getspaceused) calls [**IEmptyVolumeCacheCallBack::ScanProgress**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecachecallback-scanprogress).</span></span>

### <a name="showproperties"></a><span data-ttu-id="fa989-259">Interactivesession.showproperties</span><span class="sxs-lookup"><span data-stu-id="fa989-259">ShowProperties</span></span>

<span data-ttu-id="fa989-260">開始清除之前，處理常式可以使用 Windows 檔案總管視窗的形式來顯示 UI，以允許使用者查看由處理常式選取要清除的檔案或檔案類別清單。</span><span class="sxs-lookup"><span data-stu-id="fa989-260">Before starting cleanup, the handler can display a UI typically in the form of a Windows Explorer window that allows the user to see a list of files or classes of files selected for cleanup by the handler.</span></span> <span data-ttu-id="fa989-261">如果處理常式在呼叫 [**Initialize**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-initialize)或 [**InitializeEx**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex)時設定了 **EVCF \_ HASSETTINGS** 旗標，使用者就可以在 [磁片清理管理員] 中，按一下針對該目的所顯示的按鈕來要求 UI。</span><span class="sxs-lookup"><span data-stu-id="fa989-261">If the handler sets the **EVCF\_HASSETTINGS** flag when [**Initialize**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-initialize) or [**InitializeEx**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex) is called, the user can request the UI by clicking the button displayed for that purpose in the disk cleanup manager.</span></span> <span data-ttu-id="fa989-262">按鈕文字會因處理常式而異，但 [View Files]、[View Pages] 和 [Options] 是常見的標籤。</span><span class="sxs-lookup"><span data-stu-id="fa989-262">The button text varies from handler to handler, but "View Files," "View Pages," and "Options" are common labels.</span></span>

<span data-ttu-id="fa989-263">按一下按鈕時，「磁片清理管理員」會呼叫 [**interactivesession.showproperties**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-showproperties) 以提示處理常式顯示 UI。</span><span class="sxs-lookup"><span data-stu-id="fa989-263">When the button is clicked, the disk cleanup manager calls [**ShowProperties**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-showproperties) to prompt the handler to display the UI.</span></span> <span data-ttu-id="fa989-264">UI 應該建立為視窗的子系，其控制碼會以 **interactivesession.showproperties** 方法的 *hwnd* 參數傳遞。</span><span class="sxs-lookup"><span data-stu-id="fa989-264">The UI should be created as a child of the window whose handle is passed in the **ShowProperties** method's *hwnd* parameter.</span></span>

### <a name="purge"></a><span data-ttu-id="fa989-265">清除</span><span class="sxs-lookup"><span data-stu-id="fa989-265">Purge</span></span>

<span data-ttu-id="fa989-266">「磁片清理管理員」會呼叫處理常式的 [**清除**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-purge) 方法來設定動態清除。</span><span class="sxs-lookup"><span data-stu-id="fa989-266">The disk cleanup manager calls the handler's [**Purge**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-purge) method to set the cleanup in motion.</span></span> <span data-ttu-id="fa989-267">方法的 *picb* 參數是磁片清理管理員的 [**IEmptyVolumeCacheCallBack**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecachecallback) 介面指標。</span><span class="sxs-lookup"><span data-stu-id="fa989-267">The method's *picb* parameter is a pointer to the disk cleanup manager's [**IEmptyVolumeCacheCallBack**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecachecallback) interface.</span></span> <span data-ttu-id="fa989-268">如同 [**GetSpaceUsed**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-getspaceused) 方法，處理常式應該定期使用回呼介面來報告其進度，並查詢「磁片清理管理員」是否已按下 [ **取消**]。</span><span class="sxs-lookup"><span data-stu-id="fa989-268">As with the [**GetSpaceUsed**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-getspaceused) method, the handler should use the callback interface periodically to report its progress and query the disk cleanup manager whether the user has clicked **Cancel**.</span></span> <span data-ttu-id="fa989-269">不過請注意， **清除** 方法必須呼叫 [**IEmptyVolumeCacheCallBack：:P urgeprogress**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecachecallback-purgeprogress)，而不是 [**ScanProgress**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecachecallback-scanprogress)。</span><span class="sxs-lookup"><span data-stu-id="fa989-269">However, note that the **Purge** method must call [**IEmptyVolumeCacheCallBack::PurgeProgress**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecachecallback-purgeprogress), not [**ScanProgress**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecachecallback-scanprogress).</span></span>

### <a name="deactivate"></a><span data-ttu-id="fa989-270">停用</span><span class="sxs-lookup"><span data-stu-id="fa989-270">Deactivate</span></span>

<span data-ttu-id="fa989-271">當「磁片清理管理員」準備關閉時，會呼叫「 [**停用**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-deactivate) 」方法。</span><span class="sxs-lookup"><span data-stu-id="fa989-271">The [**Deactivate**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-deactivate) method is called when the disk cleanup manager is preparing to shut down.</span></span> <span data-ttu-id="fa989-272">處理常式應該執行任何必要的清除工作並傳回。</span><span class="sxs-lookup"><span data-stu-id="fa989-272">The handler should perform any needed cleanup tasks and return.</span></span> <span data-ttu-id="fa989-273">如果您不想要再次執行處理常式，請在初始化方法的 *pdwFlags* 參數中設定 **EVCF \_ REMOVEFROMLIST** 旗標。</span><span class="sxs-lookup"><span data-stu-id="fa989-273">If you don't want the handler to be run again, set the **EVCF\_REMOVEFROMLIST** flag in the initialization method's *pdwFlags* parameter.</span></span> <span data-ttu-id="fa989-274">如果設定此旗標，則磁片清理管理員會從其清單中移除處理常式，並刪除處理常式的登錄專案。</span><span class="sxs-lookup"><span data-stu-id="fa989-274">If this flag is set, the disk cleanup manager removes the handler from its list and deletes the handler's registry entries.</span></span> <span data-ttu-id="fa989-275">您必須重新加入登錄專案，才能再次執行處理常式。</span><span class="sxs-lookup"><span data-stu-id="fa989-275">You must re-add the registry entries to run the handler again.</span></span> <span data-ttu-id="fa989-276">此旗標通常用於只執行一次的處理常式。</span><span class="sxs-lookup"><span data-stu-id="fa989-276">This flag is typically used for handlers that are run only once.</span></span>

## <a name="registering-a-disk-cleanup-handler"></a><span data-ttu-id="fa989-277">註冊磁片清理處理常式</span><span class="sxs-lookup"><span data-stu-id="fa989-277">Registering a Disk Cleanup Handler</span></span>

<span data-ttu-id="fa989-278">若要將處理常式新增到磁片清理管理員的清單中，必須將某些索引鍵和值新增至 Windows 登錄。</span><span class="sxs-lookup"><span data-stu-id="fa989-278">To add a handler to the disk cleanup manager's list, certain keys and values must be added to the Windows registry.</span></span>

-   [<span data-ttu-id="fa989-279">註冊處理常式的 CLSID</span><span class="sxs-lookup"><span data-stu-id="fa989-279">Registering a Handler's CLSID</span></span>](#registering-a-handlers-clsid)
-   [<span data-ttu-id="fa989-280">使用磁片清理管理員來註冊處理常式：一般</span><span class="sxs-lookup"><span data-stu-id="fa989-280">Registering a Handler with the Disk Cleanup Manager: General</span></span>](#registering-a-handler-with-the-disk-cleanup-manager-general)
-   [<span data-ttu-id="fa989-281">使用磁片清理管理員來註冊處理常式： Windows 2000 或更新版本的系統</span><span class="sxs-lookup"><span data-stu-id="fa989-281">Registering a Handler with the Disk Cleanup Manager: Windows 2000 or Later Systems</span></span>](#registering-a-handler-with-the-disk-cleanup-manager-windows-2000-or-later-systems)
-   [<span data-ttu-id="fa989-282">使用 DataDrivenCleaner 物件</span><span class="sxs-lookup"><span data-stu-id="fa989-282">Using the DataDrivenCleaner Object</span></span>](#using-the-datadrivencleaner-object)
-   [<span data-ttu-id="fa989-283">磁片清理處理常式的註冊範例</span><span class="sxs-lookup"><span data-stu-id="fa989-283">Example Registration of a Disk Cleanup Handler</span></span>](#example-registration-of-a-disk-cleanup-handler)

### <a name="registering-a-handlers-clsid"></a><span data-ttu-id="fa989-284">註冊處理常式的 CLSID</span><span class="sxs-lookup"><span data-stu-id="fa989-284">Registering a Handler's CLSID</span></span>

<span data-ttu-id="fa989-285">和所有 COM 物件一樣，處理常式物件的 GUID 和 DLL 都必須在 **HKEY \_ 類別 \_ 根目錄** 的 **CLSID** 機碼下註冊。</span><span class="sxs-lookup"><span data-stu-id="fa989-285">As with all COM objects, the handler object's GUID and DLL must be registered under the **CLSID** key in **HKEY\_CLASSES\_ROOT**.</span></span> <span data-ttu-id="fa989-286">您也可以在 [磁片清理管理員] 清單方塊中，註冊顯示于處理常式名稱旁邊的圖示，但這是選擇性的。</span><span class="sxs-lookup"><span data-stu-id="fa989-286">You can also register an icon that is displayed next to the handler's name in the disk cleanup manager's list box, but this is optional.</span></span> <span data-ttu-id="fa989-287">下列範例會顯示相關的索引鍵、值和資料。</span><span class="sxs-lookup"><span data-stu-id="fa989-287">The following example shows the keys, values, and data involved.</span></span>

```
HKEY_CLASSES_ROOT
   CLSID
      Handler's GUID
         DefaultIcon
            (Default) = Handler's Icon Path, Icon Index
         InprocServer32
            (Default) = Handler's DLL path
            ThreadingModel = Apartment
```

### <a name="registering-a-handler-with-the-disk-cleanup-manager-general"></a><span data-ttu-id="fa989-288">使用磁片清理管理員來註冊處理常式：一般</span><span class="sxs-lookup"><span data-stu-id="fa989-288">Registering a Handler with the Disk Cleanup Manager: General</span></span>

<span data-ttu-id="fa989-289">若要完成註冊，處理常式必須加入保存其細節的金鑰，如下所示。</span><span class="sxs-lookup"><span data-stu-id="fa989-289">To complete the registration, a handler must add a key holding its specifics as shown here.</span></span> <span data-ttu-id="fa989-290">本節的其餘部分將討論此機碼的內容。</span><span class="sxs-lookup"><span data-stu-id="fa989-290">The remainder of this section discusses the contents of this key.</span></span>

```
HKEY_LOCAL_MACHINE
   Software
      Microsoft
         Windows
            CurrentVersion
               Explorer
                  VolumeCaches
                     Handler's Key
```

<span data-ttu-id="fa989-291">一般而言，保存處理常式細節的金鑰名稱會以它所處理的檔案類型命名，例如 **下載的程式** 檔案，但這不是必要條件。</span><span class="sxs-lookup"><span data-stu-id="fa989-291">In general, the name of the key holding a handler's particulars is named for the type of file that it handles, such as **Downloaded Program Files**, but this is not a requirement.</span></span> <span data-ttu-id="fa989-292">下表詳細說明在此機碼下找到的可能值。</span><span class="sxs-lookup"><span data-stu-id="fa989-292">The following table details the possible values found under this key.</span></span>

> [!Note]  
> <span data-ttu-id="fa989-293">只有指定處理常式之類別識別碼 (CLSID) 的預設值，其他所有值都是選擇性的。</span><span class="sxs-lookup"><span data-stu-id="fa989-293">Only the Default value specifying the handler's class identifier (CLSID) is required all other values are optional.</span></span>

 



<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th><span data-ttu-id="fa989-294">值</span><span class="sxs-lookup"><span data-stu-id="fa989-294">Value</span></span></th>
<th><span data-ttu-id="fa989-295">類型</span><span class="sxs-lookup"><span data-stu-id="fa989-295">Type</span></span></th>
<th><span data-ttu-id="fa989-296">意義</span><span class="sxs-lookup"><span data-stu-id="fa989-296">Meaning</span></span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span data-ttu-id="fa989-297">預設</span><span class="sxs-lookup"><span data-stu-id="fa989-297">Default</span></span></td>
<td><span data-ttu-id="fa989-298">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="fa989-298">REG_SZ</span></span></td>
<td><span data-ttu-id="fa989-299">在<strong>HKEY_CLASSES_ROOT</strong>clsid 下註冊的處理常式 CLSID \ <strong> </strong>。</span><span class="sxs-lookup"><span data-stu-id="fa989-299">The handler's CLSID as registered under <strong>HKEY_CLASSES_ROOT</strong>\<strong>CLSID</strong>.</span></span></td>
</tr>
<tr class="even">
<td><span data-ttu-id="fa989-300">AdvancedButtonText</span><span class="sxs-lookup"><span data-stu-id="fa989-300">AdvancedButtonText</span></span></td>
<td><span data-ttu-id="fa989-301">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="fa989-301">REG_SZ</span></span></td>
<td><span data-ttu-id="fa989-302">選擇性按鈕的文字，使用者可以按一下此按鈕以顯示處理常式的 UI。</span><span class="sxs-lookup"><span data-stu-id="fa989-302">Text for the optional button that users can click to display the handler's UI.</span></span> <span data-ttu-id="fa989-303">您可以在字元之前放置 & 字元，以指派按鈕的鍵盤快速鍵。</span><span class="sxs-lookup"><span data-stu-id="fa989-303">The & character can be placed before a character to assign a keyboard shortcut for the button.</span></span> <span data-ttu-id="fa989-304">公開 <a href="/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex"><strong>IEmptyVolumeCache2：： InitializeEx</strong></a>的處理常式會忽略 AdvancedButtonText 值。</span><span class="sxs-lookup"><span data-stu-id="fa989-304">The AdvancedButtonText value is ignored by handlers exposing <a href="/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex"><strong>IEmptyVolumeCache2::InitializeEx</strong></a>.</span></span></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="fa989-305">CleanupString</span><span class="sxs-lookup"><span data-stu-id="fa989-305">CleanupString</span></span></td>
<td><span data-ttu-id="fa989-306">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="fa989-306">REG_SZ</span></span></td>
<td><span data-ttu-id="fa989-307">指定可執行檔和選擇性命令列參數的命令列。</span><span class="sxs-lookup"><span data-stu-id="fa989-307">Command line specifying an executable file and optional command line parameters.</span></span> <span data-ttu-id="fa989-308">此命令列會在磁片清理完成時執行。</span><span class="sxs-lookup"><span data-stu-id="fa989-308">This command line is run at the completion of the disk cleanup.</span></span></td>
</tr>
<tr class="even">
<td><span data-ttu-id="fa989-309">CSIDL</span><span class="sxs-lookup"><span data-stu-id="fa989-309">CSIDL</span></span></td>
<td><span data-ttu-id="fa989-310">REG_DWORD</span><span class="sxs-lookup"><span data-stu-id="fa989-310">REG_DWORD</span></span></td>
<td><span data-ttu-id="fa989-311">要包含在檔案搜尋中之特殊資料夾的系統獨立識別碼。</span><span class="sxs-lookup"><span data-stu-id="fa989-311">A system-independent identifier for a special folder to include in the file search.</span></span> <span data-ttu-id="fa989-312">此值必須輸入為實例的數值，0x0000001c，而不是 CSIDL_LOCAL_APPDATA。</span><span class="sxs-lookup"><span data-stu-id="fa989-312">This value must be entered as a numerical value for instance, 0x0000001c rather than CSIDL_LOCAL_APPDATA.</span></span> <span data-ttu-id="fa989-313">如需可能值的清單，請參閱 <a href="/windows/desktop/shell/csidl"><strong>CSIDL</strong></a>。</span><span class="sxs-lookup"><span data-stu-id="fa989-313">For a list of possible values, see <a href="/windows/desktop/shell/csidl"><strong>CSIDL</strong></a>.</span></span> <span data-ttu-id="fa989-314">只能使用單一值。</span><span class="sxs-lookup"><span data-stu-id="fa989-314">Only a single value can be used.</span></span><br/> <span data-ttu-id="fa989-315">如果指定了資料夾值，則會在該資訊前面加上 CSIDL 值所指出的位置，以撰寫搜尋路徑。</span><span class="sxs-lookup"><span data-stu-id="fa989-315">If the Folder value is specified, the location indicated by the CSIDL value is prepended to that information to compose a search path.</span></span> <span data-ttu-id="fa989-316">例如，請考慮下列案例。</span><span class="sxs-lookup"><span data-stu-id="fa989-316">For instance, consider the following scenario.</span></span><br/>
<ul>
<li><span data-ttu-id="fa989-317">CSIDL 值會指定為 0x0000000d (CSIDL_MYMUSIC) </span><span class="sxs-lookup"><span data-stu-id="fa989-317">The CSIDL value is specified as 0x0000000d (CSIDL_MYMUSIC)</span></span></li>
<li><span data-ttu-id="fa989-318">[我的音樂] 資料夾位於 C:\documents and 和 Settings \<em>username</em>\My 音樂</span><span class="sxs-lookup"><span data-stu-id="fa989-318">Your My Music folder is located at C:\Documents and Settings\<em>username</em>\My Music</span></span></li>
<li><span data-ttu-id="fa989-319">資料夾值包含 &quot; Jazz\Singers&quot;</span><span class="sxs-lookup"><span data-stu-id="fa989-319">The Folder value contains &quot;Jazz\Singers&quot;</span></span></li>
</ul>
<span data-ttu-id="fa989-320">該案例的結果是，「磁片清理」處理常式會搜尋 C:\documents and 和 Settings \<em>username</em>\My Music\Jazz\Singers 資料夾。</span><span class="sxs-lookup"><span data-stu-id="fa989-320">The result of that scenario is that the disk cleanup handler searches the C:\Documents and Settings\<em>username</em>\My Music\Jazz\Singers folder.</span></span> <span data-ttu-id="fa989-321">請注意，如果資料夾值前面沒有斜線，則會加以新增。</span><span class="sxs-lookup"><span data-stu-id="fa989-321">Note that the slash preceding the Folder value is added if it is not present.</span></span><br/></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="fa989-322">Description</span><span class="sxs-lookup"><span data-stu-id="fa989-322">Description</span></span></td>
<td><span data-ttu-id="fa989-323">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="fa989-323">REG_SZ</span></span></td>
<td><span data-ttu-id="fa989-324">選取處理常式的名稱時，顯示在 [磁片清理管理員] 清單方塊下方的描述性文字。</span><span class="sxs-lookup"><span data-stu-id="fa989-324">Descriptive text displayed below the disk cleanup manager's list box when the handler's name is selected.</span></span> <span data-ttu-id="fa989-325">您可以在這裡說明處理常式的功能、其關注的檔案，以及 elucidatory 給使用者的任何其他資訊。</span><span class="sxs-lookup"><span data-stu-id="fa989-325">Here you can explain what the handler does, what files it concerns itself with, and any other information elucidatory to the user.</span></span> <span data-ttu-id="fa989-326">如果<a href="/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex"><strong>IEmptyVolumeCache2：： InitializeEx</strong></a>不是由處理常式公開，則在呼叫方法時，可以在<em>ppwszDescription</em>參數中指定替代字串，藉此覆寫此文字。 <a href="/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-initialize"><strong></strong></a></span><span class="sxs-lookup"><span data-stu-id="fa989-326">If <a href="/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex"><strong>IEmptyVolumeCache2::InitializeEx</strong></a> is not exposed by the handler, this text can be overridden through the handler's <a href="/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-initialize"><strong>IEmptyVolumeCache::Initialize</strong></a> method by specifying an alternate string in the <em>ppwszDescription</em> parameter when the method is called.</span></span></td>
</tr>
<tr class="even">
<td><span data-ttu-id="fa989-327">顯示</span><span class="sxs-lookup"><span data-stu-id="fa989-327">Display</span></span></td>
<td><span data-ttu-id="fa989-328">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="fa989-328">REG_SZ</span></span></td>
<td><span data-ttu-id="fa989-329">要在 [磁片清理管理員] 清單方塊中顯示的處理常式名稱。</span><span class="sxs-lookup"><span data-stu-id="fa989-329">The handler's name to be displayed in the disk cleanup manager's list box.</span></span> <span data-ttu-id="fa989-330">如果<a href="/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex"><strong>IEmptyVolumeCache2：： InitializeEx</strong></a>不是由處理常式公開，則在呼叫方法時，可以在<em>ppwszDisplayName</em>參數中指定替代字串，藉此覆寫此文字。 <a href="/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-initialize"><strong></strong></a></span><span class="sxs-lookup"><span data-stu-id="fa989-330">If <a href="/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex"><strong>IEmptyVolumeCache2::InitializeEx</strong></a> is not exposed by the handler, this text can be overridden through the handler's <a href="/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-initialize"><strong>IEmptyVolumeCache::Initialize</strong></a> method by specifying an alternate string in the <em>ppwszDisplayName</em> parameter when the method is called.</span></span></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="fa989-331">FileList (檔案清單)</span><span class="sxs-lookup"><span data-stu-id="fa989-331">FileList</span></span></td>
<td><span data-ttu-id="fa989-332">REG_SZ 或 REG_MULTI_SZ</span><span class="sxs-lookup"><span data-stu-id="fa989-332">REG_SZ or REG_MULTI_SZ</span></span></td>
<td><span data-ttu-id="fa989-333">此處理程式所搜尋和清除的檔案清單。</span><span class="sxs-lookup"><span data-stu-id="fa989-333">A list of files searched for and cleaned by this handler.</span></span> <span data-ttu-id="fa989-334">您可以使用來指定萬用字元？</span><span class="sxs-lookup"><span data-stu-id="fa989-334">You can specify wildcards using the ?</span></span> <span data-ttu-id="fa989-335">或 \* 個字元。</span><span class="sxs-lookup"><span data-stu-id="fa989-335">or \* characters.</span></span> <span data-ttu-id="fa989-336">如果值是 REG_SZ 類型，則會使用多個擴充功能來分隔 |或：字元，其中任一端沒有空格。</span><span class="sxs-lookup"><span data-stu-id="fa989-336">If the value is of type REG_SZ, multiple extensions are separated using the | or : characters, with no spaces on either side of them.</span></span><br/> <span data-ttu-id="fa989-337">如果在旗標值中設定 DDEVCF_REMOVEDIRS 旗標，這些值可以指定目錄名稱和檔案。</span><span class="sxs-lookup"><span data-stu-id="fa989-337">If the DDEVCF_REMOVEDIRS flag is set in the Flags value, these values can specify directory names as well as files.</span></span><br/></td>
</tr>
<tr class="even">
<td><span data-ttu-id="fa989-338">Flags</span><span class="sxs-lookup"><span data-stu-id="fa989-338">Flags</span></span></td>
<td><span data-ttu-id="fa989-339">REG_DWORD 或 REG_BINARY</span><span class="sxs-lookup"><span data-stu-id="fa989-339">REG_DWORD or REG_BINARY</span></span></td>
<td><span data-ttu-id="fa989-340">控制搜尋和清除程式元素的旗標。</span><span class="sxs-lookup"><span data-stu-id="fa989-340">Flags controlling elements of the search and cleaning procedure.</span></span> <span data-ttu-id="fa989-341">下列一個或多個值。</span><span class="sxs-lookup"><span data-stu-id="fa989-341">One or more of the following values.</span></span>
<ul>
<li><span data-ttu-id="fa989-342">DDEVCF_DOSUBDIRS (0x00000001) 。</span><span class="sxs-lookup"><span data-stu-id="fa989-342">DDEVCF_DOSUBDIRS (0x00000001).</span></span> <span data-ttu-id="fa989-343">以遞迴方式搜尋和移除。</span><span class="sxs-lookup"><span data-stu-id="fa989-343">Search and remove recursively.</span></span></li>
<li><span data-ttu-id="fa989-344">DDEVCF_REMOVEAFTERCLEAN (0x00000002) 。</span><span class="sxs-lookup"><span data-stu-id="fa989-344">DDEVCF_REMOVEAFTERCLEAN (0x00000002).</span></span> <span data-ttu-id="fa989-345">當處理常式執行一次之後，請將它從登錄中移除。</span><span class="sxs-lookup"><span data-stu-id="fa989-345">After the handler is run once, remove it from the registry.</span></span></li>
<li><span data-ttu-id="fa989-346">DDEVCF_REMOVEREADONLY (0x00000004) 。</span><span class="sxs-lookup"><span data-stu-id="fa989-346">DDEVCF_REMOVEREADONLY (0x00000004).</span></span> <span data-ttu-id="fa989-347">移除符合搜尋條件的檔案（即使它們是唯讀的）。</span><span class="sxs-lookup"><span data-stu-id="fa989-347">Remove files that meet the search criteria even if they are read-only.</span></span></li>
<li><span data-ttu-id="fa989-348">DDEVCF_REMOVESYSTEM (0x00000008) 。</span><span class="sxs-lookup"><span data-stu-id="fa989-348">DDEVCF_REMOVESYSTEM (0x00000008).</span></span> <span data-ttu-id="fa989-349">移除符合搜尋條件的檔案，即使它們是系統檔案也一樣。</span><span class="sxs-lookup"><span data-stu-id="fa989-349">Remove files that meet the search criteria even if they are system files.</span></span></li>
<li><span data-ttu-id="fa989-350">DDEVCF_REMOVEHIDDEN (0x00000010) 。</span><span class="sxs-lookup"><span data-stu-id="fa989-350">DDEVCF_REMOVEHIDDEN (0x00000010).</span></span> <span data-ttu-id="fa989-351">移除符合搜尋條件的檔案（即使它們是隱藏的檔案）。</span><span class="sxs-lookup"><span data-stu-id="fa989-351">Remove files that meet the search criteria even if they are hidden files.</span></span></li>
<li><span data-ttu-id="fa989-352">DDEVCF_DONTSHOWIFZERO (0x00000020) 。</span><span class="sxs-lookup"><span data-stu-id="fa989-352">DDEVCF_DONTSHOWIFZERO (0x00000020).</span></span> <span data-ttu-id="fa989-353">如果沒有任何檔案符合搜尋準則，請勿在 [磁片清理管理員] 中顯示此處理程式。</span><span class="sxs-lookup"><span data-stu-id="fa989-353">Do not display this handler in the disk cleanup manager if no files match its search criteria.</span></span></li>
<li><span data-ttu-id="fa989-354">DDEVCF_REMOVEDIRS (0x00000040) 。</span><span class="sxs-lookup"><span data-stu-id="fa989-354">DDEVCF_REMOVEDIRS (0x00000040).</span></span> <span data-ttu-id="fa989-355">比對目錄的 FileList 值，並移除相符專案及其所有子目錄。</span><span class="sxs-lookup"><span data-stu-id="fa989-355">Match the FileList value against directories and remove matches and all of their subdirectories.</span></span></li>
<li><span data-ttu-id="fa989-356">DDEVCF_RUNIFOUTOFDISKSPACE (0x00000080) 。</span><span class="sxs-lookup"><span data-stu-id="fa989-356">DDEVCF_RUNIFOUTOFDISKSPACE (0x00000080).</span></span> <span data-ttu-id="fa989-357">只有在磁片清理管理員透過 <a href="/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-initialize"><strong>IEmptyVolumeCache：： Initialize</strong></a> 或 <a href="/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex"><strong>IEmptyVolumeCache2：： InitializeEx</strong></a>設定 EVCF_OUTOFDISKSPACE 旗標時，才會執行此處理程式。</span><span class="sxs-lookup"><span data-stu-id="fa989-357">Run this handler only if available disk space has fallen below the critical value, determined by the disk cleanup manager setting the EVCF_OUTOFDISKSPACE flag through <a href="/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-initialize"><strong>IEmptyVolumeCache::Initialize</strong></a> or <a href="/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex"><strong>IEmptyVolumeCache2::InitializeEx</strong></a>.</span></span></li>
<li><span data-ttu-id="fa989-358">DDEVCF_REMOVEPARENTDIR (0x00000100) 。</span><span class="sxs-lookup"><span data-stu-id="fa989-358">DDEVCF_REMOVEPARENTDIR (0x00000100).</span></span> <span data-ttu-id="fa989-359">一旦清除程式執行之後，請移除指定檔案的上層目錄。</span><span class="sxs-lookup"><span data-stu-id="fa989-359">Remove the parent directory of the specified files once the cleaner has run.</span></span></li>
<li><span data-ttu-id="fa989-360">DDEVCF_PRI加值稅E_LASTACCESS (0x10000000) 。</span><span class="sxs-lookup"><span data-stu-id="fa989-360">DDEVCF_PRIVATE_LASTACCESS (0x10000000).</span></span> <span data-ttu-id="fa989-361">如果有提供，請使用 LastAccess 值，在查明應清除的檔案。</span><span class="sxs-lookup"><span data-stu-id="fa989-361">Use the LastAccess value, if provided, in ascertaining which files should be cleaned.</span></span> <span data-ttu-id="fa989-362">使用 <a href="#using-the-datadrivencleaner-object">DataDrivenCleaner</a> 時，會忽略此旗標（一律使用任何提供的 LastAccess 值）。</span><span class="sxs-lookup"><span data-stu-id="fa989-362">This flag is ignored when using the <a href="#using-the-datadrivencleaner-object">DataDrivenCleaner</a> any provided LastAccess value is always used.</span></span></li>
</ul></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="fa989-363">資料夾</span><span class="sxs-lookup"><span data-stu-id="fa989-363">Folder</span></span></td>
<td><span data-ttu-id="fa989-364">REG_SZ、REG_MULTI_SZ 或 REG_EXPAND_SZ</span><span class="sxs-lookup"><span data-stu-id="fa989-364">REG_SZ, REG_MULTI_SZ, or REG_EXPAND_SZ</span></span></td>
<td><span data-ttu-id="fa989-365">特定資料夾或資料夾，用來搜尋符合 FileList 值中專案的專案。</span><span class="sxs-lookup"><span data-stu-id="fa989-365">A specific folder or folders to search for items matching entries in the FileList value.</span></span> <span data-ttu-id="fa989-366">您可以使用來指定萬用字元？</span><span class="sxs-lookup"><span data-stu-id="fa989-366">You can specify wildcards using the ?</span></span> <span data-ttu-id="fa989-367">或 \* 個字元。</span><span class="sxs-lookup"><span data-stu-id="fa989-367">or \* characters.</span></span> <span data-ttu-id="fa989-368">如果值是 REG_SZ 類型，則會使用多個資料夾名稱來分隔 |字元，其中任何一側都沒有空格。</span><span class="sxs-lookup"><span data-stu-id="fa989-368">If the value is of type REG_SZ, multiple folder names are separated using the | character, without spaces on either side of it.</span></span><br/> <span data-ttu-id="fa989-369">如果有 CSIDL 值，此值中只能指定一個資料夾。</span><span class="sxs-lookup"><span data-stu-id="fa989-369">If a CSIDL value is present, only one folder can be specified in this value.</span></span> <span data-ttu-id="fa989-370">CSIDL 值所指示的位置會在該資料夾路徑的前面加上，以撰寫搜尋路徑。</span><span class="sxs-lookup"><span data-stu-id="fa989-370">The location indicated by the CSIDL value is prepended to that folder path to compose a search path.</span></span> <span data-ttu-id="fa989-371">如需範例，請參閱 CSIDL 值描述。</span><span class="sxs-lookup"><span data-stu-id="fa989-371">For an example, see the CSIDL value description.</span></span><br/> <span data-ttu-id="fa989-372">如果 Windows Vista Service Pack 1 上沒有這個值 (SP1) 和更新版本，則會忽略清除處理常式，並在初始化時傳回 S_FALSE。</span><span class="sxs-lookup"><span data-stu-id="fa989-372">If this value is absent on Windows Vista Service Pack 1 (SP1) and later, the cleanup handler is ignored and it returns S_FALSE on initialization.</span></span><br/> <span data-ttu-id="fa989-373">如果原始版本的 Windows Vista 及更早版本沒有此值，則會使用目前磁片區的根資料夾。</span><span class="sxs-lookup"><span data-stu-id="fa989-373">If this value is absent on the original release of Windows Vista and earlier, the root folder of the current volume is used.</span></span> <span data-ttu-id="fa989-374">在該情況下，需要 DDEVCF_DOSUBDIRS 旗標來搜尋整個磁片磁碟機。</span><span class="sxs-lookup"><span data-stu-id="fa989-374">The DDEVCF_DOSUBDIRS flag is needed in that case to search the entire drive.</span></span> <span data-ttu-id="fa989-375">如果沒有它，就只會搜尋根資料夾本身。</span><span class="sxs-lookup"><span data-stu-id="fa989-375">Without it, only the root folder itself is searched.</span></span><br/> <span data-ttu-id="fa989-376">必須指定磁片磁碟機或磁片磁碟機。</span><span class="sxs-lookup"><span data-stu-id="fa989-376">A drive or drives must be specified.</span></span> <span data-ttu-id="fa989-377">這可以透過 CSIDL 值或 REG_EXPAND_SZ 字串來提供。</span><span class="sxs-lookup"><span data-stu-id="fa989-377">This can be provided through the CSIDL value or through a REG_EXPAND_SZ string.</span></span> <span data-ttu-id="fa989-378">不過，您必須在資料夾名稱中指定要搜尋的磁片磁碟機，才能禁止這些選項。</span><span class="sxs-lookup"><span data-stu-id="fa989-378">Barring those options, however, the drive to search must be specified in the folder name.</span></span> <span data-ttu-id="fa989-379">使用？：搜尋目前磁片磁碟機上的資料夾。</span><span class="sxs-lookup"><span data-stu-id="fa989-379">Use ?: to search the folder on the current drive.</span></span><br/></td>
</tr>
<tr class="even">
<td><span data-ttu-id="fa989-380">>iconpath</span><span class="sxs-lookup"><span data-stu-id="fa989-380">IconPath</span></span></td>
<td><span data-ttu-id="fa989-381">REG_SZ 或 REG_EXPAND_SZ</span><span class="sxs-lookup"><span data-stu-id="fa989-381">REG_SZ or REG_EXPAND_SZ</span></span></td>
<td><span data-ttu-id="fa989-382">資源的路徑，從中取得要與處理常式關聯的圖示。</span><span class="sxs-lookup"><span data-stu-id="fa989-382">The path to the resource from which to obtain an icon to use in association with the handler.</span></span></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="fa989-383">LastAccess</span><span class="sxs-lookup"><span data-stu-id="fa989-383">LastAccess</span></span></td>
<td><span data-ttu-id="fa989-384">REG_DWORD 或 REG_BINARY</span><span class="sxs-lookup"><span data-stu-id="fa989-384">REG_DWORD or REG_BINARY</span></span></td>
<td><span data-ttu-id="fa989-385">自上次存取檔案以來經過的天數，或針對要視為清除的檔案或目錄建立的目錄。</span><span class="sxs-lookup"><span data-stu-id="fa989-385">The number of days that must have elapsed since a file was last accessed or a directory was created for that file or directory to be considered for cleanup.</span></span></td>
</tr>
<tr class="even">
<td><span data-ttu-id="fa989-386">優先順序</span><span class="sxs-lookup"><span data-stu-id="fa989-386">Priority</span></span></td>
<td><span data-ttu-id="fa989-387">REG_DWORD 或 REG_BINARY</span><span class="sxs-lookup"><span data-stu-id="fa989-387">REG_DWORD or REG_BINARY</span></span></td>
<td><span data-ttu-id="fa989-388">判斷處理常式相對於其他處理常式的執行順序。</span><span class="sxs-lookup"><span data-stu-id="fa989-388">Determines the order that the handler is run with respect to other handlers.</span></span> <span data-ttu-id="fa989-389">數位愈高，處理常式在處理常式中執行的程式就越早。</span><span class="sxs-lookup"><span data-stu-id="fa989-389">The higher the number, the earlier in the process that the handler runs.</span></span> <span data-ttu-id="fa989-390">沒有任何已定義的範圍可接受任何數位。</span><span class="sxs-lookup"><span data-stu-id="fa989-390">There is no defined range any number is acceptable.</span></span></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="fa989-391">PropertyBag</span><span class="sxs-lookup"><span data-stu-id="fa989-391">PropertyBag</span></span></td>
<td><span data-ttu-id="fa989-392">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="fa989-392">REG_SZ</span></span></td>
<td><span data-ttu-id="fa989-393">用來為顯示名稱、描述和按鈕文字提供當地語系化文字之資源的 CLSID。</span><span class="sxs-lookup"><span data-stu-id="fa989-393">The CLSID of a resource used to provide localized text for the display name, description, and button text.</span></span> <span data-ttu-id="fa989-394">當處理常式未執行 <a href="/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache"><strong>IEmptyVolumeCache</strong></a> ，且處理常式正在 Microsoft Windows NT 或 Windows XP 下執行時，此資源就很有用。</span><span class="sxs-lookup"><span data-stu-id="fa989-394">This resource is useful in the situation where a handler does not implement <a href="/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache"><strong>IEmptyVolumeCache</strong></a> and the handler is being run under Microsoft Windows NT or Windows XP.</span></span><br/> <span data-ttu-id="fa989-395">「磁片清理管理員」會先檢查處理程式的初始化常式是否傳回這些字串，就像 <a href="/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache2"><strong>IEmptyVolumeCache2</strong></a> 的情況一樣。</span><span class="sxs-lookup"><span data-stu-id="fa989-395">The disk cleanup manager first checks whether the handler's initialization routine returned those strings, as would be the case when <a href="/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache2"><strong>IEmptyVolumeCache2</strong></a> is implemented.</span></span> <span data-ttu-id="fa989-396">若失敗，管理員接下來會在此值中開啟名為的屬性包。</span><span class="sxs-lookup"><span data-stu-id="fa989-396">Failing that, the manager next turns to a property bag named in this value.</span></span> <span data-ttu-id="fa989-397">如果未提供任何內容，則會從登錄抓取文字。</span><span class="sxs-lookup"><span data-stu-id="fa989-397">If none has been provided, it retrieves the text from the registry.</span></span><br/></td>
</tr>
<tr class="even">
<td><span data-ttu-id="fa989-398">StateFlags</span><span class="sxs-lookup"><span data-stu-id="fa989-398">StateFlags</span></span></td>
<td><span data-ttu-id="fa989-399">REG_DWORD</span><span class="sxs-lookup"><span data-stu-id="fa989-399">REG_DWORD</span></span></td>
<td><span data-ttu-id="fa989-400">藉由從命令列執行磁片清理管理員的可執行檔 Cleanmgr.exe，您可以宣告清除 <em>設定檔</em>。</span><span class="sxs-lookup"><span data-stu-id="fa989-400">By running the disk cleanup manager's executable file Cleanmgr.exe from a command line, you can declare cleanup <em>profiles</em>.</span></span> <span data-ttu-id="fa989-401">這些設定檔是由可用的處理常式子集所組成，而且會獲得唯一的數值標籤。</span><span class="sxs-lookup"><span data-stu-id="fa989-401">These profiles are composed of a subset of the available handlers and are given a unique numeric label.</span></span> <span data-ttu-id="fa989-402">這可讓您在不同時間自動執行不同組的處理常式。</span><span class="sxs-lookup"><span data-stu-id="fa989-402">This allows you to automate the running of different sets of handlers at different times.</span></span><br/> <span data-ttu-id="fa989-403">命令列 &quot;cleanmgr.exe/sageset：<strong>nnnn</strong> &quot; ，其中<strong>nnnn</strong>是唯一的數值標籤，會顯示 UI，讓您選擇要包含在該設定檔中的處理常式。</span><span class="sxs-lookup"><span data-stu-id="fa989-403">The command line &quot;cleanmgr.exe /sageset:<strong>nnnn</strong>&quot;, where <strong>nnnn</strong> is a unique numeric label, displays a UI allowing you to choose the handlers to be included in that profile.</span></span> <span data-ttu-id="fa989-404">除了定義設定檔，sageset 參數也會將名為 StateFlags<strong>nnnn</strong>的值寫入，其中 <strong>nnnn</strong> 是您在參數中使用的標籤，以及 <strong>VolumeCaches</strong>底下的所有子機碼。</span><span class="sxs-lookup"><span data-stu-id="fa989-404">As well as defining the profile, the sageset parameter also writes a value named StateFlags<strong>nnnn</strong>, where <strong>nnnn</strong> is the label you used in the parameter, to all of the subkeys under <strong>VolumeCaches</strong>.</span></span> <span data-ttu-id="fa989-405">這些專案有兩個可能的資料值。</span><span class="sxs-lookup"><span data-stu-id="fa989-405">There are two possible data values for those entries.</span></span>
<ul>
<li><span data-ttu-id="fa989-406">0：當此設定檔執行時，請勿執行此處理程式。</span><span class="sxs-lookup"><span data-stu-id="fa989-406">0: Do not run this handler when this profile is run.</span></span></li>
<li><span data-ttu-id="fa989-407">2：執行此設定檔時，請包含此處理程式。</span><span class="sxs-lookup"><span data-stu-id="fa989-407">2: Include this handler when this profile is run.</span></span></li>
</ul>
<br/> <span data-ttu-id="fa989-408">例如，假設命令列 &quot;cleanmgr.exe/sageset： 1234 &quot; 執行。</span><span class="sxs-lookup"><span data-stu-id="fa989-408">For example, suppose that the command line &quot;cleanmgr.exe /sageset:1234&quot; is run.</span></span> <span data-ttu-id="fa989-409">在顯示的 UI 中，使用者選擇下載的 <strong>程式</strong>檔，但不會選擇 [ <strong>網際網路暫存</strong>檔案]。</span><span class="sxs-lookup"><span data-stu-id="fa989-409">In the UI that is presented, the user chooses <strong>Downloaded Program Files</strong>, but does not choose <strong>Temporary Internet Files</strong>.</span></span> <span data-ttu-id="fa989-410">接著會將下列值寫入登錄中。</span><span class="sxs-lookup"><span data-stu-id="fa989-410">The following values are then written to the registry.</span></span><br/>
<pre data-space="preserve"><code>HKEY_LOCAL_MACHINE
   Software
      Microsoft
         Windows
            CurrentVersion
               Explorer
                  VolumeCaches
                     Downloaded Program Files
                        StateFlags1234 = 0x00000002
                     Internet Cache Files
                        StateFlags1234 = 0x00000000</code></pre>
<br/> <span data-ttu-id="fa989-411">命令列 &quot;cleanmgr.exe/sagerun：<strong>nnnn</strong> &quot; ，其中<strong>nnnn</strong>的值符合以 sageset 參數宣告的標籤，會執行在該設定檔中選取的所有處理常式。</span><span class="sxs-lookup"><span data-stu-id="fa989-411">The command line &quot;cleanmgr.exe /sagerun:<strong>nnnn</strong>&quot;, where the value of <strong>nnnn</strong> matches the label declared with the sageset parameter, runs all of the handlers selected in that profile.</span></span><br/> <span data-ttu-id="fa989-412">當磁片清理正常執行時，會將一般 StateFlags 值寫入登錄中。</span><span class="sxs-lookup"><span data-stu-id="fa989-412">A generic StateFlags value is written to the registry when Disk Cleanup is run normally.</span></span> <span data-ttu-id="fa989-413">此值只會儲存狀態 (在最後一次呈現為使用者的選項時，檢查或取消核取處理常式) 。</span><span class="sxs-lookup"><span data-stu-id="fa989-413">This value simply stores the state (checked or unchecked) of the handler the last time it was presented as an option to the user.</span></span> <span data-ttu-id="fa989-414">這些專案有兩個可能的資料值。</span><span class="sxs-lookup"><span data-stu-id="fa989-414">There are two possible data values for those entries.</span></span>
<ul>
<li><span data-ttu-id="fa989-415">0：未選取處理常式。</span><span class="sxs-lookup"><span data-stu-id="fa989-415">0: The handler was not selected.</span></span></li>
<li><span data-ttu-id="fa989-416">1：已選取處理常式。</span><span class="sxs-lookup"><span data-stu-id="fa989-416">1: The handler was selected.</span></span></li>
</ul>
<br/></td>
</tr>
</tbody>
</table>



 

### <a name="registering-a-handler-with-the-disk-cleanup-manager-windows-2000-or-later-systems"></a><span data-ttu-id="fa989-417">使用磁片清理管理員來註冊處理常式： Windows 2000 或更新版本的系統</span><span class="sxs-lookup"><span data-stu-id="fa989-417">Registering a Handler with the Disk Cleanup Manager: Windows 2000 or Later Systems</span></span>

<span data-ttu-id="fa989-418">在登錄中指定顯示文字可能會使軟體難以當地語系化。</span><span class="sxs-lookup"><span data-stu-id="fa989-418">Specifying display text in the registry can make it difficult to localize software.</span></span> <span data-ttu-id="fa989-419">基於這個理由，Windows 2000 和 Windows XP 支援 [**IEmptyVolumeCache2**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache2) 介面及其慣用的初始化方法 [**InitializeEx**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex)。</span><span class="sxs-lookup"><span data-stu-id="fa989-419">For this reason, Windows 2000 and Windows XP support the [**IEmptyVolumeCache2**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache2) interface with its preferred initialization method [**InitializeEx**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex).</span></span> <span data-ttu-id="fa989-420">在 Windows 2000 或更新版本下，一律會嘗試在 [**IEmptyVolumeCache：： Initialize**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-initialize)之前呼叫 **IEmptyVolumeCache2：： InitializeEx** 。</span><span class="sxs-lookup"><span data-stu-id="fa989-420">Under Windows 2000 or later, an attempt is always made to call **IEmptyVolumeCache2::InitializeEx** before [**IEmptyVolumeCache::Initialize**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-initialize).</span></span> <span data-ttu-id="fa989-421">如果未公開 **IEmptyVolumeCache2** ，系統只會使用 **initialize** 來初始化處理常式。</span><span class="sxs-lookup"><span data-stu-id="fa989-421">The system only uses **Initialize** to initialize a handler if **IEmptyVolumeCache2** is not exposed.</span></span>

<span data-ttu-id="fa989-422">就登錄而言，Windows 2000 或更新版本下的唯一差異在於，您可以在處理常式公開 [**IEmptyVolumeCache2：： InitializeEx**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex) 時省略 AdvancedButtonText、顯示及描述值。</span><span class="sxs-lookup"><span data-stu-id="fa989-422">In regard to the registry, the only difference under Windows 2000 or later is that you can omit the AdvancedButtonText, Display, and Description values when [**IEmptyVolumeCache2::InitializeEx**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex) is exposed by the handler.</span></span> <span data-ttu-id="fa989-423">這些值（包含適當當地語系化的文字）在呼叫 **InitializeEx** 時，會提供給「磁片清理管理員」。</span><span class="sxs-lookup"><span data-stu-id="fa989-423">Those values, containing properly localized text, are provided to the disk cleanup manager when it calls **InitializeEx**.</span></span>

### <a name="using-the-datadrivencleaner-object"></a><span data-ttu-id="fa989-424">使用 DataDrivenCleaner 物件</span><span class="sxs-lookup"><span data-stu-id="fa989-424">Using the DataDrivenCleaner Object</span></span>

<span data-ttu-id="fa989-425">作業系統會提供基本的磁片清理處理常式（稱為 DataDrivenCleaner）。</span><span class="sxs-lookup"><span data-stu-id="fa989-425">A basic disk cleanup handler, called the DataDrivenCleaner, is provided by the operating system.</span></span> <span data-ttu-id="fa989-426">若要使用此物件做為處理常式，而不是執行自己的處理常式，請使用 CLSID {C0E13E61-0CC6-11d1-BBB6-0060978B2AE6} 做為 **VolumeCaches** 上處理常式子機碼的預設值，如使用 [磁片清理管理員註冊處理常式所述：一般](#registering-a-handler-with-the-disk-cleanup-manager-general)。</span><span class="sxs-lookup"><span data-stu-id="fa989-426">To use this object as a handler rather than implementing your own, use the CLSID {C0E13E61-0CC6-11d1-BBB6-0060978B2AE6} as the Default value for the handler's subkey under **VolumeCaches** as described in [Registering a Handler with the Disk Cleanup Manager: General](#registering-a-handler-with-the-disk-cleanup-manager-general).</span></span>

<span data-ttu-id="fa989-427">DataDrivenCleaner 不會公開 [**IEmptyVolumeCache2**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache2)，因此會透過登錄提供顯示和描述值。</span><span class="sxs-lookup"><span data-stu-id="fa989-427">The DataDrivenCleaner does not expose [**IEmptyVolumeCache2**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache2), so the Display and Description values are provided through the registry.</span></span> <span data-ttu-id="fa989-428">宣告這些字串時，請注意這可能會導致當地語系化問題。</span><span class="sxs-lookup"><span data-stu-id="fa989-428">When declaring those strings, be aware that this could cause localization issues.</span></span> <span data-ttu-id="fa989-429">您可以透過 PropertyBag 值提供當地語系化文字。</span><span class="sxs-lookup"><span data-stu-id="fa989-429">Localized text can be provided through the PropertyBag value.</span></span> <span data-ttu-id="fa989-430">AdvancedButtonText 值會被忽略，因為沒有 UI，因此沒有可顯示的按鈕，此處理程式會提供此值。</span><span class="sxs-lookup"><span data-stu-id="fa989-430">The AdvancedButtonText value is ignored since no UI, and thus no button to display it, is available for this handler.</span></span>

### <a name="example-registration-of-a-disk-cleanup-handler"></a><span data-ttu-id="fa989-431">磁片清理處理常式的註冊範例</span><span class="sxs-lookup"><span data-stu-id="fa989-431">Example Registration of a Disk Cleanup Handler</span></span>

<span data-ttu-id="fa989-432">以下顯示電話公司所執行之磁片清理處理常式的註冊範例。</span><span class="sxs-lookup"><span data-stu-id="fa989-432">The following shows an example registration for a disk cleanup handler implemented by The Phone Company.</span></span> <span data-ttu-id="fa989-433">此處理程式會同時執行 [**IEmptyVolumeCache**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache) 和 [**IEmptyVolumeCache2**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache2)，因此，如果在執行 Windows 98 的電腦上使用 AdvancedButtonText、Description 和 Display 值，就會提供這些值。</span><span class="sxs-lookup"><span data-stu-id="fa989-433">This handler implements both [**IEmptyVolumeCache**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache) and [**IEmptyVolumeCache2**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache2), and so provides AdvancedButtonText, Description, and Display values in case it is used on a computer running Windows 98.</span></span> <span data-ttu-id="fa989-434">此處理程式會結合 CSIDL 和資料夾值，以搜尋 C： \\ Program files 中的 \\ Phone 公司 Temp 目錄中的檔案 \\ ，並 \_ 設定 DDEVCF DOSUBDIRS 旗標，因此也會搜尋其子目錄。</span><span class="sxs-lookup"><span data-stu-id="fa989-434">The handler combines the CSIDL and Folder values to search for files in the C:\\Program Files\\The Phone Company\\Temp directory, and the DDEVCF\_DOSUBDIRS flag is set so that its subdirectories are also searched.</span></span> <span data-ttu-id="fa989-435">只有使用 .tmp 和 tpc 副檔名的檔案會被視為清除，而且會 \_ 設定 DDEVCF 私用 \_ LASTACCESS 旗標，如此一來，就只會考慮未存取14天以上的檔案。</span><span class="sxs-lookup"><span data-stu-id="fa989-435">Only those files with .tmp and .tpc extensions are considered for cleanup, and the DDEVCF\_PRIVATE\_LASTACCESS flag is set so that out of those files, only those that have not been accessed for 14 days or more are considered.</span></span> <span data-ttu-id="fa989-436">此外， \_ 也會設定 DDEVCF DONTSHOWIFZERO 旗標，讓處理常式不會出現在清單中，除非它找到清除候選項目。</span><span class="sxs-lookup"><span data-stu-id="fa989-436">The DDEVCF\_DONTSHOWIFZERO flag is also set so that the handler does not appear on the list unless it has found cleanup candidates.</span></span>

```
HKEY_LOCAL_MACHINE
   Software
      Microsoft
         Windows
            CurrentVersion
               Explorer
                  VolumeCaches
                     The Phone Company Files
                        (Default) = {the CLSID GUID}
                        AdvancedButtonText = &View Files
                        CleanupString = c:\tpc.exe
                        CSIDL = 0x00000026
                        Description = Old temporary files.
                        Display = The Phone Company Files
                        FileList = *.tmp|*.tpc
                        Flags = 0x10000021
                        Folder = \The Phone Company\Temp
                        IconPath = c:\Program Files\The Phone Company\tpc.dll,2
                        LastAccess = 0x0000000e
                        Priority = 200
                        PropertyBag = {Property Bag CLSID GUID}
```

 

