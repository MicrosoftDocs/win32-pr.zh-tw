---
description: 有幾個選項可用來接收完成指示，因此提供應用程式適當的彈性層級。 這些包括：等候 (或封鎖事件物件、輪詢事件物件和通訊端 i/o 完成常式的) 。
ms.assetid: 071cf198-6b4c-445e-9bd9-044f57f994a3
title: 接收完成指示
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cd05d8297af17c26393b5db113fac283b39fcbb3
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "107000170"
---
# <a name="receiving-completion-indications"></a><span data-ttu-id="8f1d2-104">接收完成指示</span><span class="sxs-lookup"><span data-stu-id="8f1d2-104">Receiving Completion Indications</span></span>

<span data-ttu-id="8f1d2-105">有幾個選項可用來接收完成指示，因此提供應用程式適當的彈性層級。</span><span class="sxs-lookup"><span data-stu-id="8f1d2-105">Several options are available for receiving completion indications, thus providing applications with appropriate levels of flexibility.</span></span> <span data-ttu-id="8f1d2-106">這些包括：等候 (或封鎖事件物件、輪詢事件物件和通訊端 i/o 完成常式的) 。</span><span class="sxs-lookup"><span data-stu-id="8f1d2-106">These include: waiting (or blocking) on event objects, polling event objects, and socket I/O completion routines.</span></span>

## <a name="blocking-and-waiting-for-completion-indication"></a><span data-ttu-id="8f1d2-107">封鎖並等候完成指示</span><span class="sxs-lookup"><span data-stu-id="8f1d2-107">Blocking and Waiting for Completion Indication</span></span>

<span data-ttu-id="8f1d2-108">應用程式可以在等候一個或多個事件物件變成使用 [**WSAWaitForMultipleEvents**](/windows/desktop/api/Winsock2/nf-winsock2-wsawaitformultipleevents) 函式設定時封鎖。</span><span class="sxs-lookup"><span data-stu-id="8f1d2-108">Applications can block while waiting for one or more event objects to become set using the [**WSAWaitForMultipleEvents**](/windows/desktop/api/Winsock2/nf-winsock2-wsawaitformultipleevents) function.</span></span> <span data-ttu-id="8f1d2-109">在 Windows 執行中，進程或執行緒真正會封鎖。</span><span class="sxs-lookup"><span data-stu-id="8f1d2-109">In Windows implementations, the process or thread truly blocks.</span></span> <span data-ttu-id="8f1d2-110">由於 Windows 通訊端2事件物件會實作為 Windows 事件，因此原生 Windows 函數 [**WaitForMultipleObjects**](/windows/win32/api/synchapi/nf-synchapi-waitformultipleobjects) 也可用於此用途。</span><span class="sxs-lookup"><span data-stu-id="8f1d2-110">Since Windows Sockets 2 event objects are implemented as Windows events, the native Windows function, [**WaitForMultipleObjects**](/windows/win32/api/synchapi/nf-synchapi-waitformultipleobjects) can also be used for this purpose.</span></span> <span data-ttu-id="8f1d2-111">如果執行緒需要等待通訊端和 nonsocket 事件，這會特別有用。</span><span class="sxs-lookup"><span data-stu-id="8f1d2-111">This is especially useful if the thread needs to wait on both socket and nonsocket events.</span></span>

## <a name="polling-for-completion-indication"></a><span data-ttu-id="8f1d2-112">輪詢完成指示</span><span class="sxs-lookup"><span data-stu-id="8f1d2-112">Polling for Completion Indication</span></span>

<span data-ttu-id="8f1d2-113">偏好不封鎖的應用程式可以使用 [**WSAGetOverlappedResult**](/windows/desktop/api/Winsock2/nf-winsock2-wsagetoverlappedresult) 函數來輪詢與任何特定事件物件相關聯的完成狀態。</span><span class="sxs-lookup"><span data-stu-id="8f1d2-113">Applications that prefer not to block can use the [**WSAGetOverlappedResult**](/windows/desktop/api/Winsock2/nf-winsock2-wsagetoverlappedresult) function to poll for the completion status associated with any particular event object.</span></span> <span data-ttu-id="8f1d2-114">此函式指出重迭的作業是否已完成，如果已完成，則會排列 [**WSAGetLastError**](/windows/desktop/api/winsock/nf-winsock-wsagetlasterror) 函式，以取得重迭作業的錯誤狀態。</span><span class="sxs-lookup"><span data-stu-id="8f1d2-114">This function indicates whether or not the overlapped operation has completed, and if completed, arranges for the [**WSAGetLastError**](/windows/desktop/api/winsock/nf-winsock-wsagetlasterror) function to retrieve the error status of the overlapped operation.</span></span>

## <a name="using-socket-io-completion-routines"></a><span data-ttu-id="8f1d2-115">使用通訊端 i/o 完成常式</span><span class="sxs-lookup"><span data-stu-id="8f1d2-115">Using Socket I/O Completion Routines</span></span>

<span data-ttu-id="8f1d2-116">用來起始重迭 i/o 的函式 ( [**WSASend**](/windows/desktop/api/Winsock2/nf-winsock2-wsasend)、 [**WSASendTo**](/windows/desktop/api/Winsock2/nf-winsock2-wsasendto)、 [**WSARecv**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecv)、 [**WSARecvFrom**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvfrom)) 全部採用 *lpCompletionRoutine* 做為選擇性的輸入參數。</span><span class="sxs-lookup"><span data-stu-id="8f1d2-116">The functions used to initiate overlapped I/O ( [**WSASend**](/windows/desktop/api/Winsock2/nf-winsock2-wsasend), [**WSASendTo**](/windows/desktop/api/Winsock2/nf-winsock2-wsasendto), [**WSARecv**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecv), [**WSARecvFrom**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvfrom)) all take *lpCompletionRoutine* as an optional input parameter.</span></span> <span data-ttu-id="8f1d2-117">這是應用程式特定函式的指標，該函式會在成功起始重迭的 i/o 作業完成 (成功或) 的情況下呼叫。</span><span class="sxs-lookup"><span data-stu-id="8f1d2-117">This is a pointer to an application-specific function that is called after a successfully initiated overlapped I/O operation completes (successfully or otherwise).</span></span> <span data-ttu-id="8f1d2-118">完成常式會遵循與 Windows 檔案 i/o 完成常式的約定相同的規則。</span><span class="sxs-lookup"><span data-stu-id="8f1d2-118">The completion routine follows the same rules as stipulated for Windows file I/O completion routines.</span></span> <span data-ttu-id="8f1d2-119">也就是說，線上程處於可提供警示等候狀態之前，不會叫用完成常式，例如，使用旗標設定叫用函數 [**WSAWaitForMultipleEvents**](/windows/desktop/api/Winsock2/nf-winsock2-wsawaitformultipleevents) 時 `fAlertable` 。</span><span class="sxs-lookup"><span data-stu-id="8f1d2-119">That is, the completion routine is not invoked until the thread is in an alertable wait state, such as when the function [**WSAWaitForMultipleEvents**](/windows/desktop/api/Winsock2/nf-winsock2-wsawaitformultipleevents) is invoked with the `fAlertable` flag set.</span></span> <span data-ttu-id="8f1d2-120">針對特定重迭 i/o 要求使用完成常式選項的應用程式，可能不會針對相同的重迭 i/o 要求使用 [**WSAGetOverlappedResult**](/windows/desktop/api/Winsock2/nf-winsock2-wsagetoverlappedresult) 的 wait 選項。</span><span class="sxs-lookup"><span data-stu-id="8f1d2-120">An application that uses the completion routine option for a particular overlapped I/O request may not use the wait option of [**WSAGetOverlappedResult**](/windows/desktop/api/Winsock2/nf-winsock2-wsagetoverlappedresult) for that same overlapped I/O request.</span></span>

<span data-ttu-id="8f1d2-121">傳輸可讓應用程式從通訊端 i/o 完成常式的內容中叫用傳送和接收作業，並保證指定的通訊端、i/o 完成常式不會進行嵌套。</span><span class="sxs-lookup"><span data-stu-id="8f1d2-121">The transports allow an application to invoke send and receive operations from within the context of the socket I/O completion routine and guarantee that, for a given socket, I/O completion routines will not be nested.</span></span> <span data-ttu-id="8f1d2-122">這可讓時間緊迫的資料傳輸完全在先占式內容中發生。</span><span class="sxs-lookup"><span data-stu-id="8f1d2-122">This permits time-sensitive data transmissions to occur entirely within a preemptive context.</span></span>

## <a name="summary-of-overlapped-completion-indication-mechanisms"></a><span data-ttu-id="8f1d2-123">重迭完成指示機制的摘要</span><span class="sxs-lookup"><span data-stu-id="8f1d2-123">Summary of Overlapped Completion Indication Mechanisms</span></span>

<span data-ttu-id="8f1d2-124">指定重迭作業所要使用的特定重迭 i/o 完成指示，取決於應用程式是否提供完成函式的指標、是否參考 [**WSAOVERLAPPED**](/windows/desktop/api/Winsock2/ns-winsock2-wsaoverlapped)結構，以及 **WSAOVERLAPPED** 結構內 **hEvent** 成員的值（如果有提供的話） (（如果有提供) ）。</span><span class="sxs-lookup"><span data-stu-id="8f1d2-124">The particular overlapped I/O completion indication to be used for a given overlapped operation is determined by whether the application supplies a pointer to a completion function, whether a [**WSAOVERLAPPED**](/windows/desktop/api/Winsock2/ns-winsock2-wsaoverlapped) structure is referenced, and by the value of the **hEvent** member within the **WSAOVERLAPPED** structure (if supplied).</span></span> <span data-ttu-id="8f1d2-125">下表摘要說明重迭通訊端的完成語義，並顯示 *lpOverlapped*、 **hEvent** 和 *lpCompletionRoutine* 的各種組合：</span><span class="sxs-lookup"><span data-stu-id="8f1d2-125">The following table summarizes the completion semantics for an overlapped socket and shows the various combinations of *lpOverlapped*, **hEvent**, and *lpCompletionRoutine*:</span></span>

| <span data-ttu-id="8f1d2-126">*lpOverlapped*</span><span class="sxs-lookup"><span data-stu-id="8f1d2-126">*lpOverlapped*</span></span> | <span data-ttu-id="8f1d2-127">hEvent</span><span class="sxs-lookup"><span data-stu-id="8f1d2-127">hEvent</span></span>         | <span data-ttu-id="8f1d2-128">*lpCompletionRoutine*</span><span class="sxs-lookup"><span data-stu-id="8f1d2-128">*lpCompletionRoutine*</span></span> | <span data-ttu-id="8f1d2-129">完成指示</span><span class="sxs-lookup"><span data-stu-id="8f1d2-129">Completion indication</span></span>                                                                                                                                                                                                    |
|----------------|----------------|-----------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="8f1d2-130">NULL</span><span class="sxs-lookup"><span data-stu-id="8f1d2-130">NULL</span></span>           | <span data-ttu-id="8f1d2-131">不適用</span><span class="sxs-lookup"><span data-stu-id="8f1d2-131">Not applicable</span></span> | <span data-ttu-id="8f1d2-132">忽略</span><span class="sxs-lookup"><span data-stu-id="8f1d2-132">Ignored</span></span>               | <span data-ttu-id="8f1d2-133">作業以同步方式完成。</span><span class="sxs-lookup"><span data-stu-id="8f1d2-133">Operation completes synchronously.</span></span> <span data-ttu-id="8f1d2-134">它的行為就像是 nonoverlapped 通訊端一樣。</span><span class="sxs-lookup"><span data-stu-id="8f1d2-134">It behaves as if it were a nonoverlapped socket.</span></span>                                                                                                                                      |
| <span data-ttu-id="8f1d2-135">!空</span><span class="sxs-lookup"><span data-stu-id="8f1d2-135">!NULL</span></span>          | <span data-ttu-id="8f1d2-136">NULL</span><span class="sxs-lookup"><span data-stu-id="8f1d2-136">NULL</span></span>           | <span data-ttu-id="8f1d2-137">NULL</span><span class="sxs-lookup"><span data-stu-id="8f1d2-137">NULL</span></span>                  | <span data-ttu-id="8f1d2-138">作業已完成重迭，但沒有 Windows 通訊端2支援的完成機制。</span><span class="sxs-lookup"><span data-stu-id="8f1d2-138">Operation completes overlapped, but there is no Windows Sockets 2-supported completion mechanism.</span></span> <span data-ttu-id="8f1d2-139">完成埠機制 (是否可在此情況下使用支援的) 。</span><span class="sxs-lookup"><span data-stu-id="8f1d2-139">The completion port mechanism (if supported) can be used in this case.</span></span> <span data-ttu-id="8f1d2-140">否則，就不會有完成通知。</span><span class="sxs-lookup"><span data-stu-id="8f1d2-140">Otherwise, there is no completion notification.</span></span> |
| <span data-ttu-id="8f1d2-141">!空</span><span class="sxs-lookup"><span data-stu-id="8f1d2-141">!NULL</span></span>          | <span data-ttu-id="8f1d2-142">!空</span><span class="sxs-lookup"><span data-stu-id="8f1d2-142">!NULL</span></span>          | <span data-ttu-id="8f1d2-143">NULL</span><span class="sxs-lookup"><span data-stu-id="8f1d2-143">NULL</span></span>                  | <span data-ttu-id="8f1d2-144">作業完成重迭，由訊號事件物件發出通知。</span><span class="sxs-lookup"><span data-stu-id="8f1d2-144">Operation completes overlapped, notification by signaling event object.</span></span>                                                                                                                                                  |
| <span data-ttu-id="8f1d2-145">!空</span><span class="sxs-lookup"><span data-stu-id="8f1d2-145">!NULL</span></span>          | <span data-ttu-id="8f1d2-146">忽略</span><span class="sxs-lookup"><span data-stu-id="8f1d2-146">Ignored</span></span>        | <span data-ttu-id="8f1d2-147">!空</span><span class="sxs-lookup"><span data-stu-id="8f1d2-147">!NULL</span></span>                 | <span data-ttu-id="8f1d2-148">作業完成重迭，藉由排程完成常式來通知。</span><span class="sxs-lookup"><span data-stu-id="8f1d2-148">Operation completes overlapped, notification by scheduling completion routine.</span></span>                                                                                                                                           |



 

 

 
