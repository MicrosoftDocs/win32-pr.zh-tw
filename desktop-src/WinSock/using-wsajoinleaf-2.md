---
description: 如先前所述，函式 WSAJoinLeaf 是用來將分葉節點聯結至 multipoint 會話中。
ms.assetid: eaa1593a-36eb-4d92-a3d9-91566fc0216b
title: 使用 WSAJoinLeaf
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 027262a117edc5541a4809481aa4607837343b4f
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "103849572"
---
# <a name="using-wsajoinleaf"></a><span data-ttu-id="73eb5-103">使用 WSAJoinLeaf</span><span class="sxs-lookup"><span data-stu-id="73eb5-103">Using WSAJoinLeaf</span></span>

<span data-ttu-id="73eb5-104">如先前所述，函式 [**WSAJoinLeaf**](/windows/desktop/api/Winsock2/nf-winsock2-wsajoinleaf) 是用來將分葉節點聯結至 multipoint 會話中。</span><span class="sxs-lookup"><span data-stu-id="73eb5-104">As mentioned previously, the function [**WSAJoinLeaf**](/windows/desktop/api/Winsock2/nf-winsock2-wsajoinleaf) is used to join a leaf node into a multipoint session.</span></span> <span data-ttu-id="73eb5-105">**WSAJoinLeaf** 與 [**WSAConnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsaconnect) 具有相同的參數和語義，不同之處在于它會傳回通訊端描述項 (如 [**WSAAccept**](/windows/desktop/api/Winsock2/nf-winsock2-wsaaccept)) 中所示，而且它還有一個額外的 *dwFlags* 參數。</span><span class="sxs-lookup"><span data-stu-id="73eb5-105">**WSAJoinLeaf** has the same parameters and semantics as [**WSAConnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsaconnect) except that it returns a socket descriptor (as in [**WSAAccept**](/windows/desktop/api/Winsock2/nf-winsock2-wsaaccept)), and it has an additional *dwFlags* parameter.</span></span>

<span data-ttu-id="73eb5-106">*DwFlags* 參數是用來指出通訊端是否只做為傳送者，只做為收件者，或兩者。</span><span class="sxs-lookup"><span data-stu-id="73eb5-106">The *dwFlags* parameter is used to indicate whether the socket will be acting only as a sender, only as a receiver, or both.</span></span> <span data-ttu-id="73eb5-107">只有 multipoint 通訊端可以用於此函式中的輸入參數 *s* 。</span><span class="sxs-lookup"><span data-stu-id="73eb5-107">Only multipoint sockets may be used for input parameter *s* in this function.</span></span> <span data-ttu-id="73eb5-108">如果 multipoint 通訊端處於非封鎖模式，則在收到對應的 FD 連接指示之前，無法使用傳回的通訊端描述項 \_ 。</span><span class="sxs-lookup"><span data-stu-id="73eb5-108">If the multipoint socket is in nonblocking mode, the returned socket descriptor is not usable until after a corresponding FD\_CONNECT indication is received.</span></span> <span data-ttu-id="73eb5-109">Multipoint 會話中的根應用程式可能會呼叫 [**WSAJoinLeaf**](/windows/desktop/api/Winsock2/nf-winsock2-wsajoinleaf) 一次或多次，以便加入多個分葉節點，但一次最多隻能有一個 multipoint 連接要求。</span><span class="sxs-lookup"><span data-stu-id="73eb5-109">A root application in a multipoint session may call [**WSAJoinLeaf**](/windows/desktop/api/Winsock2/nf-winsock2-wsajoinleaf) one or more times in order to add a number of leaf nodes, however at most one multipoint connection request may be outstanding at a time.</span></span>

<span data-ttu-id="73eb5-110">[**WSAJoinLeaf**](/windows/desktop/api/Winsock2/nf-winsock2-wsajoinleaf)傳回的通訊端描述項會根據輸入通訊端描述項是c \_ 根或 c 分葉而有所不同 \_ 。</span><span class="sxs-lookup"><span data-stu-id="73eb5-110">The socket descriptor returned by [**WSAJoinLeaf**](/windows/desktop/api/Winsock2/nf-winsock2-wsajoinleaf) differs depending on whether the input socket descriptor, *s*, is a c\_root or a c\_leaf.</span></span> <span data-ttu-id="73eb5-111">搭配 c \_ 根通訊端使用時， *name* 參數會指定要加入的特定分葉節點，而傳回的通訊端描述項是 \_ 對應至新加入之分葉節點的 c 分葉通訊端。</span><span class="sxs-lookup"><span data-stu-id="73eb5-111">When used with a c\_root socket, the *name* parameter designates a particular leaf node to be added and the returned socket descriptor is a c\_leaf socket corresponding to the newly added leaf node.</span></span> <span data-ttu-id="73eb5-112">它並不適合用來交換 multipoint 資料，而是用來接收 FD XXX 指標 (例如，針對 \_ \_ 存在於特定 c 分葉的連接關閉) \_ 。</span><span class="sxs-lookup"><span data-stu-id="73eb5-112">It is not intended to be used for the exchange of multipoint data, but rather it is used to receive FD\_XXX indications (for example, FD\_CLOSE) for the connection that exists to the particular c\_leaf.</span></span> <span data-ttu-id="73eb5-113">某些 multipoint 執行也可能會允許此通訊端用於根和個別分葉節點之間的並存聊天。</span><span class="sxs-lookup"><span data-stu-id="73eb5-113">Some multipoint implementations may also allow this socket to be used for side chats between the root and an individual leaf node.</span></span> <span data-ttu-id="73eb5-114">\_如果對應的分葉節點呼叫 [**導致 closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket)來捨棄 multipoint 會話，則會收到此通訊端的 FD 關閉指示。</span><span class="sxs-lookup"><span data-stu-id="73eb5-114">An FD\_CLOSE indication is received for this socket if the corresponding leaf node calls [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) to drop out of the multipoint session.</span></span> <span data-ttu-id="73eb5-115">對稱地， 在 \_ 從 **WSAJoinLeaf** 傳回的 c 分葉通訊端上叫用導致 closesocket，會導致對應的分葉節點中的通訊端取得 FD \_ 關閉通知。</span><span class="sxs-lookup"><span data-stu-id="73eb5-115">Symmetrically, invoking **closesocket** on the c\_leaf socket returned from **WSAJoinLeaf** causes the socket in the corresponding leaf node to get an FD\_CLOSE notification.</span></span>

<span data-ttu-id="73eb5-116">使用 c 分葉通訊端叫用 [**WSAJoinLeaf**](/windows/desktop/api/Winsock2/nf-winsock2-wsajoinleaf) 時 \_ ， *name* 參數會包含根應用程式的位址 (用於根控制項配置) 或現有 multipoint 會話 (nonrooted 控制項配置) ，而傳回的通訊端描述項與輸入通訊端描述項相同。</span><span class="sxs-lookup"><span data-stu-id="73eb5-116">When [**WSAJoinLeaf**](/windows/desktop/api/Winsock2/nf-winsock2-wsajoinleaf) is invoked with a c\_leaf socket, the *name* parameter contains the address of the root application (for a rooted control scheme) or an existing multipoint session (nonrooted control scheme), and the returned socket descriptor is the same as the input socket descriptor.</span></span> <span data-ttu-id="73eb5-117">在根控制項配置中，根應用程式會藉由呼叫接聽，將其 c \_ 根[](/windows/desktop/api/Winsock2/nf-winsock2-listen)通訊端置於接聽模式。</span><span class="sxs-lookup"><span data-stu-id="73eb5-117">In a rooted control scheme, the root application puts its c\_root socket in listening mode by calling [**listen**](/windows/desktop/api/Winsock2/nf-winsock2-listen).</span></span> <span data-ttu-id="73eb5-118">\_當分葉節點要求將本身聯結至 multipoint 會話時，會傳遞標準 FD 接受通知。</span><span class="sxs-lookup"><span data-stu-id="73eb5-118">The standard FD\_ACCEPT notification is delivered when the leaf node requests to join itself to the multipoint session.</span></span> <span data-ttu-id="73eb5-119">根應用程式會使用一般的 [**accept**](/windows/desktop/api/Winsock2/nf-winsock2-accept) / [**WSAAccept**](/windows/desktop/api/Winsock2/nf-winsock2-wsaaccept)函式來承認新的分葉節點。</span><span class="sxs-lookup"><span data-stu-id="73eb5-119">The root application uses the usual [**accept**](/windows/desktop/api/Winsock2/nf-winsock2-accept)/[**WSAAccept**](/windows/desktop/api/Winsock2/nf-winsock2-wsaaccept) functions to admit the new leaf node.</span></span> <span data-ttu-id="73eb5-120">從 **accept** 或 **WSAAccept** 傳回的值也是 c 分 \_ 葉通訊端描述項，就像從 **WSAJoinLeaf** 傳回的值一樣。</span><span class="sxs-lookup"><span data-stu-id="73eb5-120">The value returned from either **accept** or **WSAAccept** is also a c\_leaf socket descriptor just like those returned from **WSAJoinLeaf**.</span></span> <span data-ttu-id="73eb5-121">若要容納可同時允許根起始和分葉起始聯結的 multipoint 配置，可接受 \_ 已在接聽模式中的 c 根通訊端作為 **WSAJoinLeaf** 的輸入。</span><span class="sxs-lookup"><span data-stu-id="73eb5-121">To accommodate multipoint schemes that allow both root-initiated and leaf-initiated joins, it is acceptable for a c\_root socket that is already in listening mode to be used as input to **WSAJoinLeaf**.</span></span>

<span data-ttu-id="73eb5-122">Multipoint 根應用程式通常負責 multipoint 會話的有條理 dismantling。</span><span class="sxs-lookup"><span data-stu-id="73eb5-122">A multipoint root application is generally responsible for the orderly dismantling of a multipoint session.</span></span> <span data-ttu-id="73eb5-123">這類應用程式可能會在 c 根通訊端上使用 [**shutdown**](/windows/desktop/api/winsock/nf-winsock-shutdown) 或 [**導致 closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) \_ ，使所有相關聯的 c 分 \_ 葉通訊端（包括從 [**WSAJoinLeaf**](/windows/desktop/api/Winsock2/nf-winsock2-wsajoinleaf) 傳回的通訊端，以及遠端分葉節點中對應的 c 分 \_ 葉通訊端）取得 FD \_ 關閉通知。</span><span class="sxs-lookup"><span data-stu-id="73eb5-123">Such an application may use [**shutdown**](/windows/desktop/api/winsock/nf-winsock-shutdown) or [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) on a c\_root socket to cause all of the associated c\_leaf sockets, including those returned from [**WSAJoinLeaf**](/windows/desktop/api/Winsock2/nf-winsock2-wsajoinleaf) and their corresponding c\_leaf sockets in the remote leaf nodes, to get FD\_CLOSE notification.</span></span>

 

 



