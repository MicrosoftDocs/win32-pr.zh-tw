---
description: 頻外 (OOB) 資料是與一組連接的串流通訊端相關聯的邏輯獨立傳輸通道。
ms.assetid: 30f667cd-5be9-45f2-9d55-bff04834078f
title: SPI 中的通訊協定 IndependentOut 資料
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b53e5c7c5c8c8ad7a5985ec101dd157370c5f32f
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104511404"
---
# <a name="protocol-independentout-of-band-data-in-the-spi"></a><span data-ttu-id="dde5e-103">SPI 中的通訊協定 IndependentOut 資料</span><span class="sxs-lookup"><span data-stu-id="dde5e-103">Protocol IndependentOut-of-Band Data in the SPI</span></span>

<span data-ttu-id="dde5e-104">頻外 (OOB) 資料是與一組連接的串流通訊端相關聯的邏輯獨立傳輸通道。</span><span class="sxs-lookup"><span data-stu-id="dde5e-104">Out-of-Band (OOB) data is a logically independent transmission channel associated with a pair of connected stream sockets.</span></span> <span data-ttu-id="dde5e-105">OOB 資料可能會與一般資料分開傳遞給使用者。</span><span class="sxs-lookup"><span data-stu-id="dde5e-105">OOB data may be delivered to the user independently of normal data.</span></span> <span data-ttu-id="dde5e-106">此抽象概念會定義 OOB 資料設施一次至少必須支援至少一個 OOB 資料區塊的可靠傳遞。</span><span class="sxs-lookup"><span data-stu-id="dde5e-106">The abstraction defines that the OOB data facilities must support the reliable delivery of at least one OOB data block at a time.</span></span> <span data-ttu-id="dde5e-107">此資料區塊可能包含至少一個位元組的資料，而且至少有一個 OOB 資料區塊可能會在任何一次都有擱置的傳遞給使用者。</span><span class="sxs-lookup"><span data-stu-id="dde5e-107">This data block may contain at least one byte of data, and at least one OOB data block may be pending delivery to the user at any one time.</span></span> <span data-ttu-id="dde5e-108">針對支援頻外信號的通訊協定 (也就是 TCP，也就是以一般資料) 順序傳遞緊急資料的情況下，系統通常會從一般資料流程中將 OOB 資料解壓縮，並將其分開儲存 (在一般資料流程) 中留出間距。</span><span class="sxs-lookup"><span data-stu-id="dde5e-108">For communications protocols which support in-band signaling (that is, TCP, where the urgent data is delivered in sequence with the normal data), the system normally extracts the OOB data from the normal data stream and stores it separately (leaving a gap in the normal data stream).</span></span> <span data-ttu-id="dde5e-109">這可讓使用者依序接收 OOB 資料並依序接收該資料，而不需要緩衝所有的中間資料。</span><span class="sxs-lookup"><span data-stu-id="dde5e-109">This allows users to choose between receiving the OOB data in order and receiving it out of sequence without having to buffer all the intervening data.</span></span> <span data-ttu-id="dde5e-110">您可以查看 OOB 資料。</span><span class="sxs-lookup"><span data-stu-id="dde5e-110">It is possible to peek at OOB data.</span></span>

<span data-ttu-id="dde5e-111">使用者可以使用 [**WSPIoctl**](/previous-versions/windows/hardware/network/ff566296(v=vs.85)) (SIOCATMARK) 函數，判斷是否有任何的 OOB 資料正在等候讀取。</span><span class="sxs-lookup"><span data-stu-id="dde5e-111">A user can determine if there is any OOB data waiting to be read using the [**WSPIoctl**](/previous-versions/windows/hardware/network/ff566296(v=vs.85)) (SIOCATMARK) function.</span></span> <span data-ttu-id="dde5e-112">若為通訊協定，則一般資料流程內 OOB 資料區塊位置的概念會有意義 (也就是 TCP) ，Windows 通訊端服務提供者將會維護概念性標記，指出一般資料流程內 OOB 資料最後一個位元組的位置。</span><span class="sxs-lookup"><span data-stu-id="dde5e-112">For protocols where the concept of the position of the OOB data block within the normal data stream is meaningful (that is, TCP), a Windows Sockets service provider will maintain a conceptual marker indicating the position of the last byte of OOB data within the normal data stream.</span></span> <span data-ttu-id="dde5e-113">**WSPIoctl** (SIOCATMARK) 功能的執行不需要這項功能，因為 OOB 資料的存在與否都是必要的。</span><span class="sxs-lookup"><span data-stu-id="dde5e-113">This is not necessary for the implementation of the **WSPIoctl** (SIOCATMARK) functionality — the presence or absence of OOB data is all that is required.</span></span>

<span data-ttu-id="dde5e-114">若為通訊協定，則一般資料流程內 OOB 資料區塊位置的概念會有意義，因為這是一般資料流程的一部分，所以應用程式可能偏好以內嵌方式處理頻外資料。</span><span class="sxs-lookup"><span data-stu-id="dde5e-114">For protocols where the concept of the position of the OOB data block within the normal data stream is meaningful an application may prefer to process out-of-band data inline, as part of the normal data stream.</span></span> <span data-ttu-id="dde5e-115">這是藉由設定通訊端選項來達成，因此 \_ OOBINLINE (請參閱 [**WSPIoctl**](/previous-versions/windows/hardware/network/ff566296(v=vs.85))) 一節。</span><span class="sxs-lookup"><span data-stu-id="dde5e-115">This is achieved by setting the socket option SO\_OOBINLINE (see section [**WSPIoctl**](/previous-versions/windows/hardware/network/ff566296(v=vs.85))).</span></span> <span data-ttu-id="dde5e-116">對於 OOB 資料區塊真正獨立于一般資料流程的其他通訊協定，嘗試設定 \_ OOBINLINE 會導致錯誤。</span><span class="sxs-lookup"><span data-stu-id="dde5e-116">For other protocols where the OOB data blocks are truly independent of the normal data stream, attempting to set SO\_OOBINLINE will result in an error.</span></span> <span data-ttu-id="dde5e-117">應用程式可以使用 SIOCATMARK WSPIoctl 命令，判斷標記前面是否有任何未讀取的 OOB 資料。</span><span class="sxs-lookup"><span data-stu-id="dde5e-117">An application can use the SIOCATMARK WSPIoctl command to determine whether there is any unread OOB data preceding the mark.</span></span> <span data-ttu-id="dde5e-118">例如，它可能會使用這項功能，藉由確保在適當的情況下捨棄資料流程中標示的所有資料，來重新同步處理其對等。</span><span class="sxs-lookup"><span data-stu-id="dde5e-118">For example, it might use this to resynchronize with its peer by ensuring that all data up to the mark in the data stream is discarded when appropriate.</span></span>

<span data-ttu-id="dde5e-119">使用 \_ OOBINLINE 停用 (預設為) ：</span><span class="sxs-lookup"><span data-stu-id="dde5e-119">With SO\_OOBINLINE disabled (by default):</span></span>

-   <span data-ttu-id="dde5e-120">\_如果用戶端已使用 [**WSPAsyncSelect**](/previous-versions/windows/desktop/legacy/ms742267(v=vs.85))註冊通知，Winsock 服務提供者就會通知該用戶端的 fd OOB 事件， \_ 就像是使用 FD READ 來通知存在正常資料的方式一樣。</span><span class="sxs-lookup"><span data-stu-id="dde5e-120">The Winsock service provider notifies a client of an FD\_OOB event, if the client registered for notification with [**WSPAsyncSelect**](/previous-versions/windows/desktop/legacy/ms742267(v=vs.85)), in exactly the same way FD\_READ is used to notify of the presence of normal data.</span></span> <span data-ttu-id="dde5e-121">也就是說， \_ 當 oob 資料到達，而且沒有先前已排入佇列的 oob 資料，而且在使用 MSG OOB 旗標讀取資料時，以及在 \_ 讀取作業傳回之後仍會讀取一些 oob 資料時，就會公佈 FD oob。</span><span class="sxs-lookup"><span data-stu-id="dde5e-121">That is, FD\_OOB is posted when OOB data arrives and there was no OOB data previously queued, and also when data is read using the MSG\_OOB flag, and some OOB data remains to be read after the read operation has returned.</span></span> <span data-ttu-id="dde5e-122">FD \_ 讀取訊息不會針對 OOB 資料張貼。</span><span class="sxs-lookup"><span data-stu-id="dde5e-122">FD\_READ messages are not posted for OOB data.</span></span>
-   <span data-ttu-id="dde5e-123">如果 OOB 資料在通訊端上排入佇列，Winsock 服務提供者會從 [**WSPSelect**](/previous-versions/windows/desktop/legacy/ms742289(v=vs.85)) 傳回適當的 *exceptfds* 通訊端集。</span><span class="sxs-lookup"><span data-stu-id="dde5e-123">The Winsock service provider returns from [**WSPSelect**](/previous-versions/windows/desktop/legacy/ms742289(v=vs.85)) with the appropriate *exceptfds* socket set if OOB data is queued on the socket.</span></span>
-   <span data-ttu-id="dde5e-124">用戶端可以使用訊息 OOB 來呼叫 [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) ， \_ 以在任何時間讀取緊急資料區塊。</span><span class="sxs-lookup"><span data-stu-id="dde5e-124">The client can call [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) with MSG\_OOB to read the urgent data block at any time.</span></span> <span data-ttu-id="dde5e-125">OOB 資料的區塊會跳至佇列。</span><span class="sxs-lookup"><span data-stu-id="dde5e-125">The block of OOB data jumps the queue.</span></span>
-   <span data-ttu-id="dde5e-126">用戶端可以呼叫 [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) ，而不需要訊息 \_ OOB 來讀取一般資料串流。</span><span class="sxs-lookup"><span data-stu-id="dde5e-126">The client can call [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) without MSG\_OOB to read the normal data stream.</span></span> <span data-ttu-id="dde5e-127">OOB 資料區塊將不會出現在具有一般資料的資料流程中。</span><span class="sxs-lookup"><span data-stu-id="dde5e-127">The OOB data block will not appear in the data stream with normal data.</span></span> <span data-ttu-id="dde5e-128">如果在任何呼叫 **WSPRecv** 之後仍保留 OOB 資料，服務提供者會在 \_ 使用 [**WSPSELECT**](/previous-versions/windows/desktop/legacy/ms742289(v=vs.85))時，透過 FD OOB 或 *exceptfds* 通知用戶端。</span><span class="sxs-lookup"><span data-stu-id="dde5e-128">If OOB data remains after any call to **WSPRecv**, the service provider notifies the client with FD\_OOB or through *exceptfds* when using [**WSPSelect**](/previous-versions/windows/desktop/legacy/ms742289(v=vs.85)).</span></span>
-   <span data-ttu-id="dde5e-129">針對 OOB 資料在標準資料流程中具有位置的通訊協定，單一 [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) 作業不會跨越該位置。</span><span class="sxs-lookup"><span data-stu-id="dde5e-129">For protocols where the OOB data has a position within the normal data stream, a single [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) operation will not span that position.</span></span> <span data-ttu-id="dde5e-130">其中一個 **WSPRecv** 會傳回標記之前的一般資料，而第二個 **WSPRecv** 則需要在標記之後開始讀取資料。</span><span class="sxs-lookup"><span data-stu-id="dde5e-130">One **WSPRecv** will return the normal data before the mark, and a second **WSPRecv** is required to begin reading data after the mark.</span></span>

<span data-ttu-id="dde5e-131">\_啟用 OOBINLINE 之後：</span><span class="sxs-lookup"><span data-stu-id="dde5e-131">With SO\_OOBINLINE enabled:</span></span>

-   <span data-ttu-id="dde5e-132">FD 的 oob \_ 訊息不會針對 OOB 資料張貼，因為 [**WSPSelect**](/previous-versions/windows/desktop/legacy/ms742289(v=vs.85)) 和 [**WSPAsyncSelect**](/previous-versions/windows/desktop/legacy/ms742267(v=vs.85)) 函式的目的是將 oob 資料視為一般資料，並藉由在 *readfds* 中設定通訊端，或分別傳送 FD \_ 讀取訊息來表示。</span><span class="sxs-lookup"><span data-stu-id="dde5e-132">FD\_OOB messages are not posted for OOB data — for the purpose of the [**WSPSelect**](/previous-versions/windows/desktop/legacy/ms742289(v=vs.85)) and [**WSPAsyncSelect**](/previous-versions/windows/desktop/legacy/ms742267(v=vs.85)) functions, OOB data is treated as normal data, and indicated by setting the socket in *readfds* or by sending an FD\_READ message respectively.</span></span>
-   <span data-ttu-id="dde5e-133">用戶端可能不會呼叫 [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) ，並將 MSG \_ oob 旗標設為讀取 OOB 資料區塊，而錯誤碼 WSAEINVAL 將會傳回。</span><span class="sxs-lookup"><span data-stu-id="dde5e-133">The client may not call [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) with the MSG\_OOB flag set to read the OOB data block — the error code WSAEINVAL will be returned.</span></span>
-   <span data-ttu-id="dde5e-134">用戶端可以呼叫未設定 MSG OOB 旗標的 [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) \_ 。</span><span class="sxs-lookup"><span data-stu-id="dde5e-134">The client can call [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) without the MSG\_OOB flag set.</span></span> <span data-ttu-id="dde5e-135">任何 OOB 資料都會以正確的順序在正常資料流程中傳遞。</span><span class="sxs-lookup"><span data-stu-id="dde5e-135">Any OOB data will be delivered in its correct order within the normal data stream.</span></span> <span data-ttu-id="dde5e-136">OOB 資料永遠不會與一般資料混合使用，因此必須有三個讀取要求才能取得過去的 OOB 資料。</span><span class="sxs-lookup"><span data-stu-id="dde5e-136">OOB data will never be mixed with normal data — there must be three read requests to get past the OOB data.</span></span> <span data-ttu-id="dde5e-137">第一個會傳回 OOB 資料區塊之前的一般資料，第二個會傳回 OOB 資料，而第三個會傳回 oob 資料之後的一般資料。</span><span class="sxs-lookup"><span data-stu-id="dde5e-137">The first returns the normal data prior to the OOB data block, the second returns the OOB data, the third returns the normal data following the OOB data.</span></span> <span data-ttu-id="dde5e-138">換句話說，會保留 OOB 資料區塊界限。</span><span class="sxs-lookup"><span data-stu-id="dde5e-138">In other words, the OOB data block boundaries are preserved.</span></span>

<span data-ttu-id="dde5e-139">[**WSPAsyncSelect**](/previous-versions/windows/desktop/legacy/ms742267(v=vs.85))常式特別適合用來處理當 OOBINLINE 為 off 時，有 OOB 資料存在的通知 \_ 。</span><span class="sxs-lookup"><span data-stu-id="dde5e-139">The [**WSPAsyncSelect**](/previous-versions/windows/desktop/legacy/ms742267(v=vs.85)) routine is particularly well suited to handling notification of the presence of OOB data when SO\_OOBINLINE is off.</span></span>

 

 
