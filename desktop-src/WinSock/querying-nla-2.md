---
description: 若要取得無效邏輯網路的通知，請使用 WSANSPIoctl 函數來註冊網路位置變更事件。
ms.assetid: 531b6269-5f35-44c1-ad0f-c5f103029893
title: 查詢 NLA
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0ac7a4f57e14bb967b04d3a9fd6fe66717da3878
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "106982361"
---
# <a name="querying-nla"></a><span data-ttu-id="36d93-103">查詢 NLA</span><span class="sxs-lookup"><span data-stu-id="36d93-103">Querying NLA</span></span>

<span data-ttu-id="36d93-104">若要取得無效邏輯網路的通知，請使用 [**WSANSPIoctl**](/windows/desktop/api/Winsock2/nf-winsock2-wsanspioctl) 函數來註冊網路位置變更事件。</span><span class="sxs-lookup"><span data-stu-id="36d93-104">To obtain notification of invalidated logical networks, use the [**WSANSPIoctl**](/windows/desktop/api/Winsock2/nf-winsock2-wsanspioctl) function to register for network location change events.</span></span> <span data-ttu-id="36d93-105">您可以使用兩種方法來判斷先前有效的網路位置是否失效：輪詢方法，或使用重迭 i/o 或 Windows 訊息的通知。</span><span class="sxs-lookup"><span data-stu-id="36d93-105">Two methods can be used to determine whether a previously valid network location has become invalid: polling methods, or notification using overlapped I/O or Windows messaging.</span></span>

<span data-ttu-id="36d93-106">查詢會使用 [**WSALookupServiceBegin**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina)、 [**WSALookupServiceNext**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta) 和 [**WSALookupServiceEnd**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupserviceend) 函式來形成，以列舉所有可用的邏輯網路。</span><span class="sxs-lookup"><span data-stu-id="36d93-106">Queries are formed using the [**WSALookupServiceBegin**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina), [**WSALookupServiceNext,**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta) and [**WSALookupServiceEnd**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupserviceend) functions to enumerate all available logical networks.</span></span> <span data-ttu-id="36d93-107">本節的其餘部分會個別說明這些函式的用法，從 **WSALookupServiceBegin** 函數開始。</span><span class="sxs-lookup"><span data-stu-id="36d93-107">The use of each of these functions is explained individually throughout the remainder of this section, beginning with the **WSALookupServiceBegin** function.</span></span>

> [!Note]  
> <span data-ttu-id="36d93-108">NLA 需要 Mswsock .h 標頭檔，其預設不包含在 Winsock2 檔案中。</span><span class="sxs-lookup"><span data-stu-id="36d93-108">NLA requires the Mswsock.h header file, which by default is not included in the Winsock2.h file.</span></span>

 

## <a name="step-1-initiate-the-query"></a><span data-ttu-id="36d93-109">步驟1：起始查詢</span><span class="sxs-lookup"><span data-stu-id="36d93-109">Step 1: Initiate the Query</span></span>

<span data-ttu-id="36d93-110">如需快速參考， [**WSALookupServiceBegin**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina) 函式具有下列語法：</span><span class="sxs-lookup"><span data-stu-id="36d93-110">For quick reference, the [**WSALookupServiceBegin**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina) function has the following syntax:</span></span>

``` syntax
INT WSALookupServiceBegin(
  LPWSAQUERYSET lpqsRestrictions,
  DWORD dwControlFlags,
  LPHANDLE lphLookup
);
```

<span data-ttu-id="36d93-111">NLA 支援下列 *dwControlFlags* 查閱旗標：</span><span class="sxs-lookup"><span data-stu-id="36d93-111">NLA supports the following *dwControlFlags* lookup flags:</span></span>

<dl> <span data-ttu-id="36d93-112">LUP \_ 傳回 \_ 名稱</span><span class="sxs-lookup"><span data-stu-id="36d93-112">LUP\_RETURN\_NAME</span></span>  
<span data-ttu-id="36d93-113">LUP \_ 傳回 \_ 批註</span><span class="sxs-lookup"><span data-stu-id="36d93-113">LUP\_RETURN\_COMMENT</span></span>  
<span data-ttu-id="36d93-114">LUP \_ 傳回 \_ BLOB</span><span class="sxs-lookup"><span data-stu-id="36d93-114">LUP\_RETURN\_BLOB</span></span>  
<span data-ttu-id="36d93-115">LUP \_ 傳回 \_ 全部</span><span class="sxs-lookup"><span data-stu-id="36d93-115">LUP\_RETURN\_ALL</span></span>  
<span data-ttu-id="36d93-116">LUP \_ 深度</span><span class="sxs-lookup"><span data-stu-id="36d93-116">LUP\_DEEP</span></span>  
</dl>

<span data-ttu-id="36d93-117">這些旗標會將後續呼叫 [**WSALookupServiceNext**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta)時所傳回的結果集限制為包含指定類型之欄位的網路。</span><span class="sxs-lookup"><span data-stu-id="36d93-117">These flags restrict the result sets returned in subsequent calls to the [**WSALookupServiceNext**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta), function to networks that contain fields of the specified type.</span></span> <span data-ttu-id="36d93-118">例如， \_ \_ 在 [**WSALookupServiceBegin**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina)函式呼叫的 *dwControlFlags* 參數中指定 LUP RETURN BLOB，會將對 **WSALookupServiceNext** 的後續呼叫的結果集限制為包含 BLOB 資訊的網路。</span><span class="sxs-lookup"><span data-stu-id="36d93-118">For example, specifying LUP\_RETURN\_BLOB in the *dwControlFlags* parameter of the [**WSALookupServiceBegin**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina) function call restricts result sets from subsequent calls to **WSALookupServiceNext**, to networks that contain BLOB information.</span></span> <span data-ttu-id="36d93-119">使用 LUP \_ RETURN \_ ALL 旗標相當於指定 LUP 傳回 \_ \_ 名稱、LUP 傳回 \_ \_ 批註和 LUP 傳回 \_ \_ BLOB，但不是 LUP \_ 深度。</span><span class="sxs-lookup"><span data-stu-id="36d93-119">Using the LUP\_RETURN\_ALL flag is equivalent to specifying LUP\_RETURN\_NAME, LUP\_RETURN\_COMMENT, and LUP\_RETURN\_BLOB, but not LUP\_DEEP.</span></span>

<span data-ttu-id="36d93-120">如需這些查閱旗標的說明，請參閱 [**WSALookupServiceBegin**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina) 函數參考頁面。</span><span class="sxs-lookup"><span data-stu-id="36d93-120">For an explanation of these lookup flags, consult the [**WSALookupServiceBegin**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina) function reference page.</span></span>

<span data-ttu-id="36d93-121">*LphLookup* 參數中 nla 所傳回的查閱控制碼是 nla 私用的，而且不應該修改。</span><span class="sxs-lookup"><span data-stu-id="36d93-121">The lookup handle returned by NLA in the *lphLookup* parameter is private to NLA, and should not be modified.</span></span> <span data-ttu-id="36d93-122">由於傳回的控制碼對 NLA 而言是私用的，因此無法使用 [**WSAGetOverlappedResult**](/windows/desktop/api/Winsock2/nf-winsock2-wsagetoverlappedresult) 等函數。</span><span class="sxs-lookup"><span data-stu-id="36d93-122">Since the returned handle is private to NLA, functions such as [**WSAGetOverlappedResult**](/windows/desktop/api/Winsock2/nf-winsock2-wsagetoverlappedresult) are not available.</span></span>

<span data-ttu-id="36d93-123">在成功完成時，NLA 會傳回零，如 [**WSALookupServiceBegin**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina) 函數參考頁面中所定義。</span><span class="sxs-lookup"><span data-stu-id="36d93-123">NLA returns zero upon successful completion, as defined in the [**WSALookupServiceBegin**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina) function reference page.</span></span> <span data-ttu-id="36d93-124">否則，NLA 支援下列錯誤碼。</span><span class="sxs-lookup"><span data-stu-id="36d93-124">Otherwise, NLA supports the following error codes.</span></span>

| <span data-ttu-id="36d93-125">錯誤</span><span class="sxs-lookup"><span data-stu-id="36d93-125">Error</span></span>                    | <span data-ttu-id="36d93-126">意義</span><span class="sxs-lookup"><span data-stu-id="36d93-126">Meaning</span></span>                                                                                                                                                     |
|--------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="36d93-127">WSANOTINITIALISED</span><span class="sxs-lookup"><span data-stu-id="36d93-127">WSANOTINITIALISED</span></span>        | <span data-ttu-id="36d93-128">未執行成功呼叫 [**WSAStartup**](/windows/desktop/api/winsock/nf-winsock-wsastartup) 函式來初始化 NLA。</span><span class="sxs-lookup"><span data-stu-id="36d93-128">A successful call to the [**WSAStartup**](/windows/desktop/api/winsock/nf-winsock-wsastartup) function to initialize NLA was not performed.</span></span>                                                   |
| <span data-ttu-id="36d93-129">WSAEINVAL</span><span class="sxs-lookup"><span data-stu-id="36d93-129">WSAEINVAL</span></span>                | <span data-ttu-id="36d93-130">有一或多個參數無效，或在函式呼叫中指定的參數適用于 IP 以外的通訊協定。</span><span class="sxs-lookup"><span data-stu-id="36d93-130">One or more parameters were invalid, or parameters specified in the function call apply to protocols other than IP.</span></span>                                         |
| <span data-ttu-id="36d93-131">\_找不 \_ 到 WSASERVICE</span><span class="sxs-lookup"><span data-stu-id="36d93-131">WSASERVICE\_NOT\_FOUND</span></span>   | <span data-ttu-id="36d93-132">在 *lpqsRestrictions* 參數中傳遞之 [**WSAQUERYSET**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw)結構的 *LPSERVICECLASSID* 參數包含不正確 GUID。</span><span class="sxs-lookup"><span data-stu-id="36d93-132">The *lpServiceClassId* parameter of the [**WSAQUERYSET**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) structure passed in the *lpqsRestrictions* parameter contains an invalid GUID.</span></span> |
| <span data-ttu-id="36d93-133">WSANO \_ 資料</span><span class="sxs-lookup"><span data-stu-id="36d93-133">WSANO\_DATA</span></span>              | <span data-ttu-id="36d93-134">\_ *DwControlFlags* 參數中指定了 LUP 容器旗標。</span><span class="sxs-lookup"><span data-stu-id="36d93-134">The LUP\_CONTAINERS flag was specified in *dwControlFlags* parameter.</span></span>                                                                                       |
| <span data-ttu-id="36d93-135">WSAEFAULT</span><span class="sxs-lookup"><span data-stu-id="36d93-135">WSAEFAULT</span></span>                | <span data-ttu-id="36d93-136">嘗試存取使用者提供的參數時發生存取違規。</span><span class="sxs-lookup"><span data-stu-id="36d93-136">An access violation occurred when attempting to access user-supplied parameters.</span></span>                                                                            |
| <span data-ttu-id="36d93-137">WSASYSNOTREADY</span><span class="sxs-lookup"><span data-stu-id="36d93-137">WSASYSNOTREADY</span></span>           | <span data-ttu-id="36d93-138">NLA 服務無法處理要求。</span><span class="sxs-lookup"><span data-stu-id="36d93-138">The NLA service is unavailable to process the request.</span></span>                                                                                                      |
| <span data-ttu-id="36d93-139">WSA \_ 沒有 \_ 足夠的 \_ 記憶體</span><span class="sxs-lookup"><span data-stu-id="36d93-139">WSA\_NOT\_ENOUGH\_MEMORY</span></span> | <span data-ttu-id="36d93-140">NLA 或 NLA 服務無法配置足夠的記憶體來處理此要求。</span><span class="sxs-lookup"><span data-stu-id="36d93-140">NLA or the NLA service was unable to allocate enough memory to process this request.</span></span>                                                                        |



 

## <a name="step-2-perform-the-query"></a><span data-ttu-id="36d93-141">步驟2：執行查詢</span><span class="sxs-lookup"><span data-stu-id="36d93-141">Step 2: Perform the Query</span></span>

<span data-ttu-id="36d93-142">查詢 NLA 的下一個步驟需要使用 [**WSALookupServiceNext**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta) 函數。</span><span class="sxs-lookup"><span data-stu-id="36d93-142">The next step in querying NLA requires use of the [**WSALookupServiceNext**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta) function.</span></span> <span data-ttu-id="36d93-143">如需快速參考， **WSALookupServiceNext** 函數具有下列語法：</span><span class="sxs-lookup"><span data-stu-id="36d93-143">For quick reference, the **WSALookupServiceNext**, function has the following syntax:</span></span>

``` syntax
INT WSALookupServiceNext(
  HANDLE hLookup,
  DWORD dwControlFlags,
  LPDWORD lpdwBufferLength,
  LPWSAQUERYSET lpqsResults
);
```

<span data-ttu-id="36d93-144">*LLookup* 參數是從上一次呼叫 [**WSALookupServiceBegin**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina)函數所傳回的查詢控制碼。</span><span class="sxs-lookup"><span data-stu-id="36d93-144">The *lLookup* parameter is the lookup handle returned from the previous call to the [**WSALookupServiceBegin**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina) function.</span></span>

<span data-ttu-id="36d93-145">*DwControlFlags* 參數支援下列旗標：</span><span class="sxs-lookup"><span data-stu-id="36d93-145">The *dwControlFlags* parameter supports the following flags:</span></span>

<dl> <span data-ttu-id="36d93-146">LUP \_ 傳回 \_ 名稱</span><span class="sxs-lookup"><span data-stu-id="36d93-146">LUP\_RETURN\_NAME</span></span>  
<span data-ttu-id="36d93-147">LUP \_ 傳回 \_ 批註</span><span class="sxs-lookup"><span data-stu-id="36d93-147">LUP\_RETURN\_COMMENT</span></span>  
<span data-ttu-id="36d93-148">LUP \_ 傳回 \_ BLOB</span><span class="sxs-lookup"><span data-stu-id="36d93-148">LUP\_RETURN\_BLOB</span></span>  
<span data-ttu-id="36d93-149">LUP \_ 傳回 \_ 全部</span><span class="sxs-lookup"><span data-stu-id="36d93-149">LUP\_RETURN\_ALL</span></span>  
<span data-ttu-id="36d93-150">LUP \_ FLUSHPREVIOUS</span><span class="sxs-lookup"><span data-stu-id="36d93-150">LUP\_FLUSHPREVIOUS</span></span>  
</dl>

<span data-ttu-id="36d93-151">這些旗標獨立于 [**WSALookupServiceBegin**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina) 函式呼叫中支援的旗標。</span><span class="sxs-lookup"><span data-stu-id="36d93-151">These flags are independent of the flags supported in the [**WSALookupServiceBegin**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina) function call.</span></span> <span data-ttu-id="36d93-152">請注意，先前呼叫 **WSALookupServiceBegin** 函式所指定的任何條件約束都會限制查閱;使用 [**WSALookupServiceNext**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta) 函式新增旗標，以嘗試將查詢擴大至 **WSALookupServiceBegin** 呼叫中指定的條件約束以外的範圍，會以無訊息方式略過。</span><span class="sxs-lookup"><span data-stu-id="36d93-152">Note that any constraints specified in the previous call to the **WSALookupServiceBegin** function constrain the lookup; adding flags with the [**WSALookupServiceNext**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta) function in an attempt to broaden the query beyond the constraints specified in the **WSALookupServiceBegin** call are silently ignored.</span></span> <span data-ttu-id="36d93-153">不過，您可以指定一組比 **WSALookupServiceBegin** 呼叫中所指定更嚴格的旗標。</span><span class="sxs-lookup"><span data-stu-id="36d93-153">Specifying a more restrictive set of flags than that specified in the **WSALookupServiceBegin** call, however, is allowed.</span></span>

<span data-ttu-id="36d93-154">如果 *lpqsResults* 中詳細說明的網路是使用中的網路，則會附加一系列的 **NLA \_ BLOB** 結構，如同 *lpqsResults* 中所傳回之 [**WSAQUERYSET**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw)結構的 **lpBlob** 成員所指定。</span><span class="sxs-lookup"><span data-stu-id="36d93-154">If the network detailed in *lpqsResults* is an active network, a series of **NLA\_BLOB** structures is appended as specified in the **lpBlob** member of the [**WSAQUERYSET**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) structure returned in *lpqsResults*.</span></span> <span data-ttu-id="36d93-155">這些 **NLA \_ blob** 結構可能是連結的，而且可以藉由在 \_ nextOffset 為非零值的情況下，透過遍歷清單來列舉。</span><span class="sxs-lookup"><span data-stu-id="36d93-155">These **NLA\_BLOB** structures may be chained, and can be enumerated by traversing the list while NLA\_BLOB.header.nextOffset is nonzero.</span></span> <span data-ttu-id="36d93-156">若要取得所有網路位置資訊的結果，請繼續呼叫 [**WSALookupServiceNext**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta)，直到 \_ 不傳回 WSA E \_ NO \_ 其他錯誤為止（如 **WSALookupServiceNext** 參考頁面中所述）。</span><span class="sxs-lookup"><span data-stu-id="36d93-156">To obtain results for all network location information, continue calling the [**WSALookupServiceNext**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta), function until the WSA\_E\_NO\_MORE error is returned, as explained in the **WSALookupServiceNext**, reference page.</span></span>

<span data-ttu-id="36d93-157">[**WSALookupServiceNext**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta)函式也會與 [**WSANSPIoctl**](/windows/desktop/api/Winsock2/nf-winsock2-wsanspioctl)函數搭配使用，以接收網路變更的通知。</span><span class="sxs-lookup"><span data-stu-id="36d93-157">The [**WSALookupServiceNext**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta) function is also used in conjunction with the [**WSANSPIoctl**](/windows/desktop/api/Winsock2/nf-winsock2-wsanspioctl) function to receive notification of network changes.</span></span> <span data-ttu-id="36d93-158">如需詳細資訊，請參閱 [來自 NLA 的通知](notification-from-nla-2.md) 。</span><span class="sxs-lookup"><span data-stu-id="36d93-158">See [Notification from NLA](notification-from-nla-2.md) for more information.</span></span>

<span data-ttu-id="36d93-159">在成功完成時，NLA 會傳回零。</span><span class="sxs-lookup"><span data-stu-id="36d93-159">NLA returns zero upon successful completion.</span></span> <span data-ttu-id="36d93-160">NLA 的用戶端應該繼續呼叫 [**WSALookupServiceNext**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta)，函式直到 \_ 未傳回 WSA E 為止 \_ \_ ，表示已傳回可用網路的所有相關資訊。</span><span class="sxs-lookup"><span data-stu-id="36d93-160">Clients of NLA should continue calling the [**WSALookupServiceNext**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta), function until WSA\_E\_NO\_MORE is returned, indicating that all of the information about available networks has been returned.</span></span>

<span data-ttu-id="36d93-161">否則，呼叫 [**WSALookupServiceNext**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta)，適用于 NLA 的函式支援下列錯誤碼。</span><span class="sxs-lookup"><span data-stu-id="36d93-161">Otherwise, calling the [**WSALookupServiceNext**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta), function for NLA supports the following error codes.</span></span>

| <span data-ttu-id="36d93-162">錯誤</span><span class="sxs-lookup"><span data-stu-id="36d93-162">Error</span></span>                    | <span data-ttu-id="36d93-163">意義</span><span class="sxs-lookup"><span data-stu-id="36d93-163">Meaning</span></span>                                                                                                                                                                                                                                                                                                                                                                                                     |
|--------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="36d93-164">WSANOTINITIALISED</span><span class="sxs-lookup"><span data-stu-id="36d93-164">WSANOTINITIALISED</span></span>        | <span data-ttu-id="36d93-165">未執行初始化 NLA 的 [**WSAStartup**](/windows/desktop/api/winsock/nf-winsock-wsastartup) 函式的成功呼叫。</span><span class="sxs-lookup"><span data-stu-id="36d93-165">A successful call to the [**WSAStartup**](/windows/desktop/api/winsock/nf-winsock-wsastartup) function that initialized NLA was not performed.</span></span>                                                                                                                                                                                                                                                                                                |
| <span data-ttu-id="36d93-166">WSA \_ 不正確 \_ 控制碼</span><span class="sxs-lookup"><span data-stu-id="36d93-166">WSA\_INVALID\_HANDLE</span></span>     | <span data-ttu-id="36d93-167">*HLookup* 參數中提供的查閱控制碼不是有效的 NLA SP 控制碼。</span><span class="sxs-lookup"><span data-stu-id="36d93-167">The lookup handle provided in the *hLookup* parameter was not a valid NLA SP handle.</span></span> <span data-ttu-id="36d93-168">用戶端必須先呼叫 [**WSALookupServiceBegin**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina) 函式，並接收有效的 NLA SP 控制碼，以取得查詢結果。</span><span class="sxs-lookup"><span data-stu-id="36d93-168">Clients must first call the [**WSALookupServiceBegin**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina) function and receive a valid NLA SP handle to obtain query results.</span></span>                                                                                                                                                               |
| <span data-ttu-id="36d93-169">WSAESYSNOTREADY</span><span class="sxs-lookup"><span data-stu-id="36d93-169">WSAESYSNOTREADY</span></span>          | <span data-ttu-id="36d93-170">NLA 服務無法處理此要求。</span><span class="sxs-lookup"><span data-stu-id="36d93-170">The NLA service is unavailable to process this request.</span></span>                                                                                                                                                                                                                                                                                                                                                     |
| <span data-ttu-id="36d93-171">WSAEFAULT</span><span class="sxs-lookup"><span data-stu-id="36d93-171">WSAEFAULT</span></span>                | <span data-ttu-id="36d93-172">*LpdwBufferLength* 參數中指定的緩衝區大小不足以保存 *lpqsResults* 所指向的結果。</span><span class="sxs-lookup"><span data-stu-id="36d93-172">The buffer size specified in the *lpdwBufferLength* parameter was insufficient to hold the results pointed to by *lpqsResults*.</span></span> <span data-ttu-id="36d93-173">必要的緩衝區是在 *lpdwBufferLength* 中指定;如果用戶端無法提供夠大的緩衝區，用戶端可以呼叫 [**WSALookupServiceNext**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta) 函數，並將 *DWCONTROLFLAGS* 設定為 LUP \_ FLUSHPREVIOUS，以略過該專案。</span><span class="sxs-lookup"><span data-stu-id="36d93-173">The required buffer is specified in *lpdwBufferLength*; if the client cannot supply a sufficiently large buffer, the client can call the [**WSALookupServiceNext**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta) function with *dwControlFlags* set to LUP\_FLUSHPREVIOUS to skip the entry.</span></span> |
| <span data-ttu-id="36d93-174">WSA \_ 沒有 \_ 足夠的 \_ 記憶體</span><span class="sxs-lookup"><span data-stu-id="36d93-174">WSA\_NOT\_ENOUGH\_MEMORY</span></span> | <span data-ttu-id="36d93-175">因為呼叫進程中的記憶體不足，所以 NLA 無法從 NLA 系統服務取得網路資訊。</span><span class="sxs-lookup"><span data-stu-id="36d93-175">NLA is unable to obtain network information from the NLA system service due to insufficient memory in the calling process.</span></span>                                                                                                                                                                                                                                                                                  |
| <span data-ttu-id="36d93-176">WSA \_ E \_ 否 \_ 其他</span><span class="sxs-lookup"><span data-stu-id="36d93-176">WSA\_E\_NO\_MORE</span></span>         | <span data-ttu-id="36d93-177">沒有其他網路可列舉查詢。</span><span class="sxs-lookup"><span data-stu-id="36d93-177">There are no additional networks to enumerate for the query.</span></span>                                                                                                                                                                                                                                                                                                                                                |



 

## <a name="step-3-terminate-the-query"></a><span data-ttu-id="36d93-178">步驟3：終止查詢</span><span class="sxs-lookup"><span data-stu-id="36d93-178">Step 3: Terminate the Query</span></span>

<span data-ttu-id="36d93-179">當所有對 NLA 的查詢都已完成，而且應用程式不再需要使用 NLA 時，應該呼叫 [**WSALookupServiceEnd**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupserviceend) 函數。</span><span class="sxs-lookup"><span data-stu-id="36d93-179">When all queries to NLA are complete and an application no longer requires use of NLA, a call to the [**WSALookupServiceEnd**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupserviceend) function should be made.</span></span> <span data-ttu-id="36d93-180">如果應用程式會根據提交的查詢接收變更通知，請勿呼叫 **WSALookupServiceEnd** 。</span><span class="sxs-lookup"><span data-stu-id="36d93-180">Do not call **WSALookupServiceEnd** if the application will receive change notification based on the submitted query.</span></span> <span data-ttu-id="36d93-181">如需接收通知的詳細資訊，請參閱 [來自 NLA 的通知](notification-from-nla-2.md) 。</span><span class="sxs-lookup"><span data-stu-id="36d93-181">See [Notification from NLA](notification-from-nla-2.md) for more information on receiving notification.</span></span> <span data-ttu-id="36d93-182">如同大部分的 Windows 通訊端服務提供者，NLA 會維護其用戶端的參考計數。</span><span class="sxs-lookup"><span data-stu-id="36d93-182">Like most Windows Sockets service providers, NLA maintains a reference count for its clients.</span></span> <span data-ttu-id="36d93-183">當對 NLA 的查詢完成時呼叫 **WSALookupServiceEnd** 函式，可讓 NLA 不再需要的系統資源被釋放。</span><span class="sxs-lookup"><span data-stu-id="36d93-183">Calling the **WSALookupServiceEnd** function when queries to NLA are completed enables system resources no longer required by NLA to be freed.</span></span>

<span data-ttu-id="36d93-184">NLA 支援下列 [**WSALookupServiceEnd**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupserviceend) 函式呼叫的錯誤碼。</span><span class="sxs-lookup"><span data-stu-id="36d93-184">NLA supports the following error codes for [**WSALookupServiceEnd**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupserviceend) function calls.</span></span>

| <span data-ttu-id="36d93-185">錯誤</span><span class="sxs-lookup"><span data-stu-id="36d93-185">Error</span></span>                | <span data-ttu-id="36d93-186">意義</span><span class="sxs-lookup"><span data-stu-id="36d93-186">Meaning</span></span>                                                                                                   |
|----------------------|-----------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="36d93-187">WSANOTINITIALISED</span><span class="sxs-lookup"><span data-stu-id="36d93-187">WSANOTINITIALISED</span></span>    | <span data-ttu-id="36d93-188">未執行成功呼叫 [**WSAStartup**](/windows/desktop/api/winsock/nf-winsock-wsastartup) 函式來初始化 NLA。</span><span class="sxs-lookup"><span data-stu-id="36d93-188">A successful call to the [**WSAStartup**](/windows/desktop/api/winsock/nf-winsock-wsastartup) function to initialize NLA was not performed.</span></span> |
| <span data-ttu-id="36d93-189">WSA \_ 不正確 \_ 控制碼</span><span class="sxs-lookup"><span data-stu-id="36d93-189">WSA\_INVALID\_HANDLE</span></span> | <span data-ttu-id="36d93-190">*HLookup* 參數中提供的控制碼不是有效的 NLA SP 控制碼。</span><span class="sxs-lookup"><span data-stu-id="36d93-190">The handle provided in the *hLookup* parameter was not a valid NLA SP handle.</span></span>                             |



 

 

 



