---
description: WSAQUERYSET 結構是用來形成 NSPLookupServiceBegin 函數的查詢，並用來傳遞 NSPLookupServiceNext 函數的查詢結果。
ms.assetid: 017b5828-bc6e-42b7-aba7-21648b2dd707
title: SPI 中的 Query-Related 資料結構
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 57ce5a7016bd2ad96f464137177036b470c64a95
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104555024"
---
# <a name="query-related-data-structures-in-the-spi"></a><span data-ttu-id="42b10-103">SPI 中的 Query-Related 資料結構</span><span class="sxs-lookup"><span data-stu-id="42b10-103">Query-Related Data Structures in the SPI</span></span>

<span data-ttu-id="42b10-104">[**WSAQUERYSET**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw)結構是用來形成 [**NSPLookupServiceBegin**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpnsplookupservicebegin)的查詢，用來傳遞 [**NSPLookupServiceNext**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpnsplookupservicenext)的查詢結果。</span><span class="sxs-lookup"><span data-stu-id="42b10-104">The [**WSAQUERYSET**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) structure is used to form queries for [**NSPLookupServiceBegin**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpnsplookupservicebegin), and used to deliver query results for [**NSPLookupServiceNext**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpnsplookupservicenext).</span></span> <span data-ttu-id="42b10-105">這是複雜的結構，因為它包含多個其他結構的指標，其中有些參考仍是其他結構。</span><span class="sxs-lookup"><span data-stu-id="42b10-105">It is a complex structure because it contains pointers to several other structures, some of which reference still other structures.</span></span> <span data-ttu-id="42b10-106">**WSAQUERYSET** 與它所參考之結構之間的關聯性如下所示：</span><span class="sxs-lookup"><span data-stu-id="42b10-106">The relationship between **WSAQUERYSET** and the structures it references is illustrated as follows:</span></span>

![wsaqueryset 結構](images/ovrvw3-2.png)

<span data-ttu-id="42b10-108">在 [**WSAQUERYSET**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) 結構內，大部分的成員都是一目了然的，但有一些額外的說明。</span><span class="sxs-lookup"><span data-stu-id="42b10-108">Within the [**WSAQUERYSET**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) structure, most of the members are self explanatory, but some deserve additional explanation.</span></span> <span data-ttu-id="42b10-109">**DwSize** 將會填入 Sizeof ( **WSAQUERYSET**) ，並且可供命名空間提供者用來偵測及調整可能出現的不同 **WSAQUERYSET** 結構版本。</span><span class="sxs-lookup"><span data-stu-id="42b10-109">The **dwSize** will be filled in with sizeof( **WSAQUERYSET**), and can be used by namespace providers to detect and adapt to different versions of the **WSAQUERYSET** structure that may appear.</span></span>

<span data-ttu-id="42b10-110">命名空間提供者會使用 **dwOutputFlags** 成員來提供查詢結果的其他相關資料。</span><span class="sxs-lookup"><span data-stu-id="42b10-110">The **dwOutputFlags** member is used by a namespace provider to provide additional data about query results.</span></span> <span data-ttu-id="42b10-111">如需詳細資訊，請參閱 [**NSPLookupServiceNext**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpnsplookupservicenext)。</span><span class="sxs-lookup"><span data-stu-id="42b10-111">For more information, see [**NSPLookupServiceNext**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpnsplookupservicenext).</span></span>

<span data-ttu-id="42b10-112">**Lpversion** 所參考的 [**WSAECOMPARATOR**](/windows/desktop/api/Winsock2/ne-winsock2-wsaecomparator)結構會用於查詢準則約束和結果。</span><span class="sxs-lookup"><span data-stu-id="42b10-112">The [**WSAECOMPARATOR**](/windows/desktop/api/Winsock2/ne-winsock2-wsaecomparator) structure referenced by **lpversion** is used for both query constraint and results.</span></span> <span data-ttu-id="42b10-113">若為查詢， **dwVersion** 成員會指出所需的服務版本。</span><span class="sxs-lookup"><span data-stu-id="42b10-113">For queries, the **dwVersion** member indicates the desired version of the service.</span></span> <span data-ttu-id="42b10-114">**EcHow** 成員是列舉型別，會指定如何進行比較。</span><span class="sxs-lookup"><span data-stu-id="42b10-114">The **ecHow** member is an enumerated type which specifies how the comparison will be made.</span></span> <span data-ttu-id="42b10-115">選項為 [複合 \_ EQUALS]，其需要在版本中進行完全相符，或 \_ 指定服務的版本號碼不小於 **dwVersion** 的值的 [複合] NOTLESS。</span><span class="sxs-lookup"><span data-stu-id="42b10-115">The choices are COMP\_EQUALS which requires that an exact match in version occurs, or COMP\_NOTLESS which specifies that the service's version number be no less than the value of **dwVersion**.</span></span>

<span data-ttu-id="42b10-116">**DwNameSpace** 和 **lpNSProviderId** 的解讀取決於結構的使用方式，並在使用此結構的個別函式描述中進一步說明。</span><span class="sxs-lookup"><span data-stu-id="42b10-116">The interpretation of **dwNameSpace** and **lpNSProviderId** depends upon how the structure is being used and is described further in the individual function descriptions that utilize this structure.</span></span>

<span data-ttu-id="42b10-117">**LpszCoNtext** 成員會套用至階層命名空間，並指定查詢的起點或服務所在階層中的位置。</span><span class="sxs-lookup"><span data-stu-id="42b10-117">The **lpszContext** member applies to hierarchical namespaces, and specifies the starting point of a query or the location within the hierarchy where the service resides.</span></span> <span data-ttu-id="42b10-118">一般規則如下：</span><span class="sxs-lookup"><span data-stu-id="42b10-118">The general rules are:</span></span>

-   <span data-ttu-id="42b10-119">值為 **Null**、空白 ( "" ) 將在預設內容中開始搜尋。</span><span class="sxs-lookup"><span data-stu-id="42b10-119">A value of **NULL**, blank ("") will start the search at the default context.</span></span>
-   <span data-ttu-id="42b10-120">"" 的值會 \\ 在命名空間的頂端開始搜尋。</span><span class="sxs-lookup"><span data-stu-id="42b10-120">A value of "\\" starts the search at the top of the namespace.</span></span>
-   <span data-ttu-id="42b10-121">任何其他值都會在指定的點開始搜尋。</span><span class="sxs-lookup"><span data-stu-id="42b10-121">Any other value starts the search at the designated point.</span></span>

<span data-ttu-id="42b10-122">如果指定了 "" 或 "" 以外的任何專案，則不支援內含專案的提供者可能會傳回錯誤 \\ 。</span><span class="sxs-lookup"><span data-stu-id="42b10-122">Providers that do not support containment may return an error if anything other than "" or "\\" is specified.</span></span> <span data-ttu-id="42b10-123">支援有限內含專案的提供者（例如群組）應接受 ""，' \\ "或指定的點。</span><span class="sxs-lookup"><span data-stu-id="42b10-123">Providers that support limited containment, such as groups, should accept "", '\\", or a designated point.</span></span> <span data-ttu-id="42b10-124">內容是特定命名空間。</span><span class="sxs-lookup"><span data-stu-id="42b10-124">Contexts are namespace specific.</span></span> <span data-ttu-id="42b10-125">如果 **dwNameSpace** 為 NS \_ ALL，則只應將 "" 或 " \\ " 傳遞為內容，因為所有命名空間都能辨識這些內容。</span><span class="sxs-lookup"><span data-stu-id="42b10-125">If **dwNameSpace** is NS\_ALL, then only "" or "\\" should be passed as the context because these are recognized by all namespaces.</span></span>

<span data-ttu-id="42b10-126">**LpszQueryString** 成員是用來提供其他命名空間特定的查詢資訊，例如描述已知服務和傳輸通訊協定名稱的字串，例如 "ftp/tcp"。</span><span class="sxs-lookup"><span data-stu-id="42b10-126">The **lpszQueryString** member is used to supply additional, namespace-specific query information such as a string describing a well-known service and transport protocol name, as in "ftp/tcp".</span></span>

<span data-ttu-id="42b10-127">**LpafpProtocols** 所參考的 [**AFPROTOCOLS**](/windows/desktop/api/Winsock2/ns-winsock2-afprotocols)結構僅用於查詢用途，並提供用來限制查詢的通訊協定清單。</span><span class="sxs-lookup"><span data-stu-id="42b10-127">The [**AFPROTOCOLS**](/windows/desktop/api/Winsock2/ns-winsock2-afprotocols) structure referenced by **lpafpProtocols** is used for query purposes only, and supplies a list of protocols to constrain the query.</span></span> <span data-ttu-id="42b10-128">這些通訊協定會以 (位址系列、通訊協定) 組表示，因為通訊協定值只有在位址系列的內容中才有意義。</span><span class="sxs-lookup"><span data-stu-id="42b10-128">These protocols are represented as (address family, protocol) pairs, because protocol values only have meaning within the context of an address family.</span></span>

<span data-ttu-id="42b10-129">**LpcsaBuffer** 所參考之 [**CSADDR \_ 資訊**](/windows/win32/api/ws2def/ns-ws2def-csaddr_info)結構的陣列，包含服務在建立接聽時所需的所有資訊，或是用來建立服務連接的用戶端。</span><span class="sxs-lookup"><span data-stu-id="42b10-129">The array of [**CSADDR\_INFO**](/windows/win32/api/ws2def/ns-ws2def-csaddr_info) structure referenced by **lpcsaBuffer** contains all of the information required for either a service to use in establishing a listen, or a client to use in establishing a connection to the service.</span></span> <span data-ttu-id="42b10-130">**LocalAddr** 和 **RemoteAddr** 成員都直接包含 [**通訊端 \_ 位址**](/windows/desktop/api/Ws2def/ns-ws2def-socket_address)結構。</span><span class="sxs-lookup"><span data-stu-id="42b10-130">The **LocalAddr** and **RemoteAddr** members both directly contain a [**SOCKET\_ADDRESS**](/windows/desktop/api/Ws2def/ns-ws2def-socket_address) structure.</span></span> <span data-ttu-id="42b10-131">服務會使用元組 (LocalAddr lpSockaddr >sa \_ 系列、iSocketType、iProtocol) 來建立通訊端。</span><span class="sxs-lookup"><span data-stu-id="42b10-131">A service would create a socket using the tuple (LocalAddr.lpSockaddr->sa\_family, iSocketType, iProtocol).</span></span> <span data-ttu-id="42b10-132">它會使用 LocalAddr lpSockaddr 和 LocalAddr，將通訊端系結至本機位址。</span><span class="sxs-lookup"><span data-stu-id="42b10-132">It would bind the socket to a local address using LocalAddr.lpSockaddr, and LocalAddr.lpSockaddrLength.</span></span> <span data-ttu-id="42b10-133">用戶端會使用元組 (RemoteAddr lpSockaddr >sa \_ 系列、iSocketType、iProtocol) 建立其通訊端，並在建立遠端連線時使用 RemoteAddr. lpSockaddr 和 RemoteAddr 的組合。</span><span class="sxs-lookup"><span data-stu-id="42b10-133">The client creates its socket with the tuple (RemoteAddr.lpSockaddr->sa\_family, iSocketType, iProtocol), and uses the combination of RemoteAddr.lpSockaddr, and RemoteAddr.lpSockaddrLength when making a remote connection.</span></span>

 

 
