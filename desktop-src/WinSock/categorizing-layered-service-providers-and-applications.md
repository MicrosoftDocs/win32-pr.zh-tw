---
title: 將多層式服務提供者和應用程式分類
description: Winsock 2 容納多層通訊協定。
ms.assetid: 1c5efd2e-1b42-4c20-a4da-b81a5fc4243c
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a966d54da0be26f75a074de18abe1b9e080c0c9f
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "107000071"
---
# <a name="categorizing-layered-service-providers-and-apps"></a><span data-ttu-id="b9eb2-103">將多層式服務提供者和應用程式分類</span><span class="sxs-lookup"><span data-stu-id="b9eb2-103">Categorizing layered service providers and apps</span></span>

> [!Note]  
> <span data-ttu-id="b9eb2-104">已淘汰分層服務提供者。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-104">Layered Service Providers are deprecated.</span></span> <span data-ttu-id="b9eb2-105">從 Windows 8 和 Windows Server 2012 開始，請使用 [Windows 篩選平台](../fwp/windows-filtering-platform-start-page.md)。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-105">Starting with Windows 8 and Windows Server 2012, use [Windows Filtering Platform](../fwp/windows-filtering-platform-start-page.md).</span></span>

 

<span data-ttu-id="b9eb2-106">Winsock 2 容納多層通訊協定。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-106">Winsock 2 accommodates layered protocols.</span></span> <span data-ttu-id="b9eb2-107">分層式通訊協定是一種只會執行較高層級通訊函式的通訊協定，同時依賴于與遠端端點實際交換資料的基礎傳輸堆疊。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-107">A layered protocol is one that implements only higher level communications functions, while relying on an underlying transport stack for the actual exchange of data with a remote endpoint.</span></span> <span data-ttu-id="b9eb2-108">多層式通訊協定或多層式服務提供者的範例是安全性層級，會將通訊協定新增至連線建立程式，以執行驗證並建立相互同意的加密配置。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-108">An example of a layered protocol or layered service provider would be a security layer that adds protocol to the connection establishment process in order to perform authentication and to establish a mutually agreed upon encryption scheme.</span></span> <span data-ttu-id="b9eb2-109">這種安全性通訊協定通常需要基礎可靠傳輸通訊協定（例如 TCP 或 SPX）的服務。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-109">Such a security protocol would generally require the services of an underlying reliable transport protocol such as TCP or SPX.</span></span> <span data-ttu-id="b9eb2-110">基底提供者所執行的「基底」（base protocol）一詞是指可執行 TCP 或 SPX 等通訊協定的 Winsock 提供者，其能夠執行與遠端端點的資料通訊。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-110">The term base protocol implemented by base provider refers to a Winsock provider that implements a protocol such as TCP or SPX which is capable of performing data communications with a remote endpoint.</span></span> <span data-ttu-id="b9eb2-111">「多層式通訊協定」一詞是用來描述無法獨立的通訊協定。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-111">The term layered protocol is used to describe a protocol that cannot stand alone.</span></span> <span data-ttu-id="b9eb2-112">這些多層式通訊協定會以 Winsock 多層式服務提供者的形式安裝 (Lsp) 。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-112">These layered protocols are installed as Winsock Layered Service Providers (LSPs).</span></span>

<span data-ttu-id="b9eb2-113">LSP 的範例是安裝在 Internet Secutity 和 Authentication Server 中的 Microsoft 防火牆用戶端服務提供者 (ISA) 用戶端。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-113">An example of an LSP is the Microsoft Firewall Client Service Provider installed as part of the Internet Secutity and Authentication Server (ISA) on clients.</span></span> <span data-ttu-id="b9eb2-114">Microsoft 防火牆用戶端服務提供者會透過 TCP 和 UDP 的 Winsock 基底提供者安裝。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-114">The Microsoft Firewall Client Service Provider installs over the Winsock base providers for TCP and UDP.</span></span> <span data-ttu-id="b9eb2-115">ISA 防火牆用戶端軟體中的動態連結程式庫 (DLL) 變成 Winsock 分層服務提供者，所有 Winsock 應用程式都會以透明的方式使用。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-115">A dynamic-link library (DLL) in the ISA Firewall Client software becomes a Winsock layered service provider that all Winsock applications use transparently.</span></span> <span data-ttu-id="b9eb2-116">如此一來，ISA 防火牆用戶端 LSP 可以攔截來自用戶端應用程式的 Winsock 函式呼叫，然後將要求路由傳送至原始基礎服務提供者（如果目的地為本機或 ISA Server 電腦上的防火牆服務）（如果目的地為遠端）。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-116">This way, the ISA Firewall Client LSP can intercept Winsock function calls from client applications and then route a request to the original underlying base service provider if the destination is local or to the Firewall service on an ISA Server computer if the destination is remote.</span></span> <span data-ttu-id="b9eb2-117">類似的 LSP 會安裝為 Microsoft Forefront Firewall Service 的一部分，而威脅管理閘道 (TMG) 用戶端上的用戶端。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-117">A similar LSP is installed as part of the Microsoft Forefront Firewall Service and the Threat Management Gateway (TMG) Client on clients.</span></span>

<span data-ttu-id="b9eb2-118">在 LSP 初始化期間，LSP 必須提供指向多個 Winsock 服務提供者介面的指標， (SPI) 函數。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-118">During LSP initialization, the LSP must provide pointers to a number of Winsock Service Provider Interface (SPI) functions.</span></span> <span data-ttu-id="b9eb2-119">這些函式會在 (其他 LSP 或 Ws232.DLL) 的正常處理期間由 LSP 直接進行呼叫 \_ 。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-119">These functions will be called during normal processing by the layer directly above the LSP (either another LSP or Ws2\_32.DLL).</span></span>

<span data-ttu-id="b9eb2-120">您可以根據 LSP 所實行的 SPI 函式子集，以及針對每個函式執行的額外處理的本質，來定義 LSP 類別。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-120">It is possible to define LSP categories based upon the subset of SPI functions an LSP implements and the nature of the extra processing performed for each of those functions.</span></span> <span data-ttu-id="b9eb2-121">藉由將 Lsp 分類，以及分類使用 Winsock 通訊端的應用程式，您可以選擇性地判斷在執行時間是否應該在指定的進程中包含 LSP。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-121">By classifying LSPs, as well as classifying applications which use Winsock sockets, it becomes possible to selectively determine if an LSP should be involved in a given process at runtime.</span></span>

<span data-ttu-id="b9eb2-122">在 Windows Vista 和更新版本上，會提供新的方法，以分類 Winsock 多層式服務提供者和應用程式，因此只會載入特定的 Lsp。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-122">On Windows Vista and later, a new method is provided for categorizing both Winsock Layered Service Providers and applications so that only certain LSPs will be loaded.</span></span> <span data-ttu-id="b9eb2-123">新增這些功能有幾個原因。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-123">There are several reasons for adding these features.</span></span>

<span data-ttu-id="b9eb2-124">其中一個主要原因是某些系統重要的處理常式（例如 winlogon 和 lsass）會建立通訊端，但這些程式並不會使用這些通訊端來傳送網路上的任何流量。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-124">One of the primary reasons is that certain system critical processes such as winlogon and lsass create sockets, but these processes do not use these sockets to send any traffic on the network.</span></span> <span data-ttu-id="b9eb2-125">因此大部分的 Lsp 都不應該載入到這些進程中。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-125">So most LSPs should not be loaded into these processes.</span></span> <span data-ttu-id="b9eb2-126">許多案例也記載在錯誤 Lsp 可能導致 *lsass.exe* 損毀的情況。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-126">A number of cases have also been documented where buggy LSPs can cause *lsass.exe* to crash.</span></span> <span data-ttu-id="b9eb2-127">如果 lsass 當機，系統會強制關機。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-127">If lsass crashes, the system forces a shutdown.</span></span> <span data-ttu-id="b9eb2-128">這些系統進程載入 Lsp 的副作用是，這些程式永遠不會結束，因此當 LSP 已安裝或移除時，需要重新開機。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-128">A side affect of these system processes loading LSPs is that these processes never exit so when an LSP is installed or removed, a reboot is required.</span></span>

<span data-ttu-id="b9eb2-129">次要原因是應用程式在某些情況下可能不會想要載入某些 Lsp。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-129">A secondary reason is that there are some cases where applications may not want to load certain LSPs.</span></span> <span data-ttu-id="b9eb2-130">例如，有些應用程式可能不會想要載入密碼編譯 Lsp，以防止應用程式與未安裝 cyptographic LSP 的其他系統進行通訊。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-130">For example, some applications may not want to load cryptographic LSPs which could prevent the application from communicating with other systems that do not have the cyptographic LSP installed.</span></span>

<span data-ttu-id="b9eb2-131">最後，其他 Lsp 可以使用 LSP 類別來判斷 Winsock 通訊協定鏈中應自行安裝的位置。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-131">Finally, LSP categories can be used by other LSPs to determine where in the Winsock protocol chain they should install themselves.</span></span> <span data-ttu-id="b9eb2-132">多年來，不同的 LSP 開發人員都想知道 LSP 的表現方式。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-132">For years, various LSP developers have wanted a way of knowing how an LSP will behave.</span></span> <span data-ttu-id="b9eb2-133">例如，檢查資料流程的 LSP 可能會想要在加密資料的 LSP 上方。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-133">For example, an LSP that inspects the data stream would want to be above an LSP that encrypts the data.</span></span> <span data-ttu-id="b9eb2-134">當然，這種 LSP 類別的方法並不是欺騙證明，因為它依賴協力廠商 Lsp 來適當地分類。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-134">Of course, this method of LSP categorization isn't fool proof since it relies on third-party LSPs to categorize themselves appropriately.</span></span>

<span data-ttu-id="b9eb2-135">Windows Vista 和更新版本中的 LSP 分類和其他安全性增強功能是設計來協助防止使用者不慎安裝惡意 Lsp。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-135">The LSP categorization and other security enhancements in Windows Vista and later are designed to help prevent users from unintentionally installing malicious LSPs.</span></span>

## <a name="lsp-categories"></a><span data-ttu-id="b9eb2-136">LSP 類別</span><span class="sxs-lookup"><span data-stu-id="b9eb2-136">LSP Categories</span></span>

<span data-ttu-id="b9eb2-137">在 Windows Vista 和更新版本上，LSP 可根據其與 Windows 通訊端呼叫和資料互動的方式進行分類。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-137">On Windows Vista and later, an LSP can be classified based on how it interacts with Windows Sockets calls and data.</span></span> <span data-ttu-id="b9eb2-138">LSP 類別是 Winsock SPI 函式子集上可辨識的行為群組。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-138">An LSP category is an identifiable group of behaviors on a subset of Winsock SPI functions.</span></span> <span data-ttu-id="b9eb2-139">例如，HTTP 內容篩選器會分類為 (LSP 偵測器類別) 的資料偵測器 \_ 。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-139">For example, an HTTP content filter would be categorized as a data inspector (the LSP\_INSPECTOR category).</span></span> <span data-ttu-id="b9eb2-140">LSP 偵測 \_ 器類別會檢查 (，但不會將) 參數變更為資料傳輸 SPI 函數。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-140">The LSP\_INSPECTOR category will inspect (but not alter) parameters to data transfer SPI functions.</span></span> <span data-ttu-id="b9eb2-141">應用程式可以查詢 LSP 的類別，並選擇不要根據 LSP 類別和應用程式所允許的 LSP 類別組合來載入 LSP。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-141">An application can query for the category of an LSP and choose to not load the LSP based on the LSP category and the application's set of permitted LSP categories.</span></span>

<span data-ttu-id="b9eb2-142">下表列出 LSP 可分類的類別。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-142">The following table lists categories that an LSP can be classified into.</span></span>

| <span data-ttu-id="b9eb2-143">LSP 類別</span><span class="sxs-lookup"><span data-stu-id="b9eb2-143">LSP Category</span></span>              | <span data-ttu-id="b9eb2-144">Description</span><span class="sxs-lookup"><span data-stu-id="b9eb2-144">Description</span></span>                                                     |
|---------------------------|-----------------------------------------------------------------|
| <span data-ttu-id="b9eb2-145">**LSP \_ 加密 \_ 壓縮**</span><span class="sxs-lookup"><span data-stu-id="b9eb2-145">**LSP\_CRYPTO\_COMPRESS**</span></span> | <span data-ttu-id="b9eb2-146">LSP 是密碼編譯或資料壓縮提供者。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-146">The LSP is a cryptography or data compression provider.</span></span>         |
| <span data-ttu-id="b9eb2-147">**LSP \_ 防火牆**</span><span class="sxs-lookup"><span data-stu-id="b9eb2-147">**LSP\_FIREWALL**</span></span>         | <span data-ttu-id="b9eb2-148">LSP 是防火牆提供者。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-148">The LSP is a firewall provider.</span></span>                                 |
| <span data-ttu-id="b9eb2-149">**LSP \_ 本機快取 \_**</span><span class="sxs-lookup"><span data-stu-id="b9eb2-149">**LSP\_LOCAL\_CACHE**</span></span>     | <span data-ttu-id="b9eb2-150">LSP 是本機快取提供者。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-150">The LSP is a local cache provider.</span></span>                              |
| <span data-ttu-id="b9eb2-151">**LSP \_ 輸入 \_ 修改**</span><span class="sxs-lookup"><span data-stu-id="b9eb2-151">**LSP\_INBOUND\_MODIFY**</span></span>  | <span data-ttu-id="b9eb2-152">LSP 會修改輸入資料。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-152">The LSP modifies inbound data.</span></span>                                  |
| <span data-ttu-id="b9eb2-153">**LSP 偵測 \_ 器**</span><span class="sxs-lookup"><span data-stu-id="b9eb2-153">**LSP\_INSPECTOR**</span></span>        | <span data-ttu-id="b9eb2-154">LSP 會檢查或篩選資料。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-154">The LSP inspects or filters data.</span></span>                               |
| <span data-ttu-id="b9eb2-155">**LSP \_ 輸出 \_ 修改**</span><span class="sxs-lookup"><span data-stu-id="b9eb2-155">**LSP\_OUTBOUND\_MODIFY**</span></span> | <span data-ttu-id="b9eb2-156">LSP 修改了輸出資料。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-156">The LSP modifies outbound data.</span></span>                                 |
| <span data-ttu-id="b9eb2-157">**LSP \_ PROXY**</span><span class="sxs-lookup"><span data-stu-id="b9eb2-157">**LSP\_PROXY**</span></span>            | <span data-ttu-id="b9eb2-158">LSP 可作為 proxy 並重新導向封包。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-158">The LSP acts as a proxy and redirects packets.</span></span>                  |
| <span data-ttu-id="b9eb2-159">**LSP \_ 重新導向程式**</span><span class="sxs-lookup"><span data-stu-id="b9eb2-159">**LSP\_REDIRECTOR**</span></span>       | <span data-ttu-id="b9eb2-160">LSP 是網路重新導向程式。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-160">The LSP is a network redirector.</span></span>                                |
| <span data-ttu-id="b9eb2-161">**LSP \_ 系統**</span><span class="sxs-lookup"><span data-stu-id="b9eb2-161">**LSP\_SYSTEM**</span></span>           | <span data-ttu-id="b9eb2-162">LSP 可接受用於服務和系統進程。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-162">The LSP is acceptable for use in services and system processes.</span></span> |



 

<span data-ttu-id="b9eb2-163">LSP 可能屬於一個以上的類別。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-163">An LSP may belong to more than one category.</span></span> <span data-ttu-id="b9eb2-164">例如，防火牆/安全性 LSP 可能屬於偵測器 (**lsp 偵測 \_ 器**) 和防火牆 (**lsp \_ 防火牆**) 類別。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-164">For example, a firewall/security LSP could belong to both the inspector (**LSP\_INSPECTOR**) and firewall (**LSP\_FIREWALL**) categories.</span></span>

<span data-ttu-id="b9eb2-165">如果 LSP 沒有設定類別，則會被視為在所有其他類別中。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-165">If an LSP does not have a category set, it is considered to be in the All Other category.</span></span> <span data-ttu-id="b9eb2-166">此 LSP 類別目錄將不會載入至服務或系統進程 (例如，lsass、winlogon 以及許多 svchost 進程) 。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-166">This LSP category will not be loaded in services or system processes (for example, lsass, winlogon, and many svchost processes).</span></span>

## <a name="categorizing-lsps"></a><span data-ttu-id="b9eb2-167">將 Lsp 分類</span><span class="sxs-lookup"><span data-stu-id="b9eb2-167">Categorizing LSPs</span></span>

<span data-ttu-id="b9eb2-168">Windows Vista 和更新版本提供數個新功能來分類 LSP：</span><span class="sxs-lookup"><span data-stu-id="b9eb2-168">Several new functions are available on Windows Vista and later for categorizing an LSP:</span></span>

-   [<span data-ttu-id="b9eb2-169">**WSCGetProviderInfo**</span><span class="sxs-lookup"><span data-stu-id="b9eb2-169">**WSCGetProviderInfo**</span></span>](/windows/desktop/api/Ws2spi/nf-ws2spi-wscgetproviderinfo)
-   [<span data-ttu-id="b9eb2-170">**WSCGetProviderInfo32**</span><span class="sxs-lookup"><span data-stu-id="b9eb2-170">**WSCGetProviderInfo32**</span></span>](/windows/desktop/api/Ws2spi/nf-ws2spi-wscgetproviderinfo32)
-   [<span data-ttu-id="b9eb2-171">**WSCSetProviderInfo**</span><span class="sxs-lookup"><span data-stu-id="b9eb2-171">**WSCSetProviderInfo**</span></span>](/windows/desktop/api/Ws2spi/nf-ws2spi-wscsetproviderinfo)
-   [<span data-ttu-id="b9eb2-172">**WSCSetProviderInfo32**</span><span class="sxs-lookup"><span data-stu-id="b9eb2-172">**WSCSetProviderInfo32**</span></span>](/windows/desktop/api/Ws2spi/nf-ws2spi-wscsetproviderinfo32)

<span data-ttu-id="b9eb2-173">為了將 LSP 分類，會以 GUID 呼叫 [**WSCSetProviderInfo**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscsetproviderinfo) 或 [**WSCSetProviderInfo32**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscsetproviderinfo32) 函式，以識別 LSP 隱藏專案、為此 LSP 通訊協定專案設定的資訊類別，以及用來修改函式行為的一組旗標。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-173">In order to categorize an LSP, the [**WSCSetProviderInfo**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscsetproviderinfo) or [**WSCSetProviderInfo32**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscsetproviderinfo32) function is called with a GUID to identify the LSP hidden entry, the information class to be set for this LSP protocol entry, and a set of flags used to modify the behavior of the function.</span></span>

<span data-ttu-id="b9eb2-174">[**WSCGetProviderInfo**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscgetproviderinfo)或 [**WSCGetProviderInfo32**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscgetproviderinfo32)函數類似于抓取 LSP 的資訊類別相關資料。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-174">The [**WSCGetProviderInfo**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscgetproviderinfo) or [**WSCGetProviderInfo32**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscgetproviderinfo32) function is similarly used to retrieve the data associated with an information class for an LSP.</span></span>

## <a name="categorizing-applications"></a><span data-ttu-id="b9eb2-175">將應用程式分類</span><span class="sxs-lookup"><span data-stu-id="b9eb2-175">Categorizing Applications</span></span>

<span data-ttu-id="b9eb2-176">Windows Vista 和更新版本提供數個新的功能，可將應用程式分類：</span><span class="sxs-lookup"><span data-stu-id="b9eb2-176">Several new functions are available on Windows Vista and later for categorizing an application:</span></span>

-   [<span data-ttu-id="b9eb2-177">**WSCGetApplicationCategory**</span><span class="sxs-lookup"><span data-stu-id="b9eb2-177">**WSCGetApplicationCategory**</span></span>](/windows/desktop/api/Ws2spi/nf-ws2spi-wscgetapplicationcategory)
-   [<span data-ttu-id="b9eb2-178">**WSCSetApplicationCategory**</span><span class="sxs-lookup"><span data-stu-id="b9eb2-178">**WSCSetApplicationCategory**</span></span>](/windows/desktop/api/Ws2spi/nf-ws2spi-wscsetapplicationcategory)

<span data-ttu-id="b9eb2-179">為了將應用程式分類， [**WSCSetApplicationCategory**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscsetapplicationcategory) 函式會以可執行檔映射的載入路徑來呼叫，以識別應用程式、啟動應用程式時使用的命令列引數，以及此應用程式的所有實例允許的 LSP 類別。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-179">In order to categorize an application, the [**WSCSetApplicationCategory**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscsetapplicationcategory) function is called with the load path to the executable image to identify the application, the command line arguments used when starting the application, and the LSP categories which are permitted for all instances of this application.</span></span>

<span data-ttu-id="b9eb2-180">[**WSCGetApplicationCategory**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscgetapplicationcategory)函式類似于抓取多層式服務提供者 (LSP) 類別與應用程式相關聯。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-180">The [**WSCGetApplicationCategory**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscgetapplicationcategory) function is similarly used to retrieve the layered service provider (LSP) categories associated with an application.</span></span>

## <a name="determining-which-lsps-get-loaded"></a><span data-ttu-id="b9eb2-181">判斷要載入的 Lsp</span><span class="sxs-lookup"><span data-stu-id="b9eb2-181">Determining Which LSPs Get Loaded</span></span>

<span data-ttu-id="b9eb2-182">LSP 分類的最後一個部分是決定哪些 Lsp 將會載入至哪些處理常式。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-182">The final part of LSP categorization is determining which LSPs will be loaded into which processes.</span></span> <span data-ttu-id="b9eb2-183">當進程載入 Winsock 時，會對應用程式類別和所有已安裝 Lsp 的 LSP 類別進行下列比較：</span><span class="sxs-lookup"><span data-stu-id="b9eb2-183">When a process loads Winsock, the following comparisons are made of the application category and the LSP categories for all installed LSPs:</span></span>

-   <span data-ttu-id="b9eb2-184">如果應用程式未分類，則允許將所有 Lsp 載入至進程。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-184">If the application is not categorized, allow all LSPs to be loaded into the process.</span></span>
-   <span data-ttu-id="b9eb2-185">如果應用程式和 LSP 都有指派類別，下列所有條件都必須為 true：</span><span class="sxs-lookup"><span data-stu-id="b9eb2-185">If both the application and the LSP have assigned categories, all of the following must be true:</span></span> <dl> <span data-ttu-id="b9eb2-186">應用程式的指定類別中至少有一個 LSP 類別存在。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-186">At least one of the LSP categories is present in the application's specified categories.</span></span>  
    <span data-ttu-id="b9eb2-187">Lsp 類別中只會指定應用程式指定類別中指定的類別。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-187">Only categories specified in the application's specified categories are specified in the LSPs categories.</span></span> <span data-ttu-id="b9eb2-188">例如，如果應用程式指定類別目錄，它必須位於 LSP 的類別中。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-188">For example, if the application specifies a category it must be in the LSP's category.</span></span>  
    <span data-ttu-id="b9eb2-189">如果 \_ 應用程式類別中出現 lsp 系統類別，則它必須存在於 lsp 的類別中。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-189">If the LSP\_SYSTEM category is present in the application's category, it must be present in the LSP's categories.</span></span>  
    </dl>

> [!Note]  
> <span data-ttu-id="b9eb2-190">如果 LSP 未分類，其類別目錄實際上是零。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-190">If an LSP is not categorized, its category is effectively zero.</span></span> <span data-ttu-id="b9eb2-191">若要進行相符，所有 LSP 的指定類別都必須出現在應用程式類別中 (應用程式類別必須是 LSP 類別的超集合) 注意，如果 LSP \_ 系統存在於應用程式類別中，它也必須存在於 lsp 的類別中。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-191">For a match to occur, all the LSP's specified categories must be present in the application's categories (the application's categories must be a superset of the LSP's categories) with the caveat that if LSP\_SYSTEM is present in the application's category it must also be present in the LSP's category.</span></span>

 

<span data-ttu-id="b9eb2-192">請考慮下列範例：</span><span class="sxs-lookup"><span data-stu-id="b9eb2-192">Consider the following example:</span></span>

<span data-ttu-id="b9eb2-193">*Foo.exe* 的應用程式會分類為 lsp \_ 系統 + LSP \_ 防火牆 + lsp \_ 加密 \_ 壓縮。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-193">The *Foo.exe* application is categorized as LSP\_SYSTEM + LSP\_FIREWALL + LSP\_CRYPTO\_COMPRESS.</span></span> <span data-ttu-id="b9eb2-194">應用程式 *Bar.exe* 會分類為 lsp \_ 防火牆 + lsp \_ 加密 \_ 壓縮。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-194">The application *Bar.exe* is categorized as LSP\_FIREWALL + LSP\_CRYPTO\_COMPRESS.</span></span> <span data-ttu-id="b9eb2-195">系統上已安裝四個 Lsp：</span><span class="sxs-lookup"><span data-stu-id="b9eb2-195">There are four LSPs installed on the system:</span></span>

-   <span data-ttu-id="b9eb2-196">LSP1 已設定 LSP 系統的類別 \_ 。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-196">LSP1 has set a category of LSP\_SYSTEM.</span></span>
-   <span data-ttu-id="b9eb2-197">LSP2 不是分類集合，因此其類別目錄為零。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-197">LSP2 is not categories set, so its category is zero.</span></span>
-   <span data-ttu-id="b9eb2-198">LSP3 已設定 LSP 防火牆的類別 \_ 。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-198">LSP3 has set a category of LSP\_FIREWALL.</span></span>
-   <span data-ttu-id="b9eb2-199">LSP4 已設定 LSP \_ 系統 + lsp \_ 防火牆 + lsp \_ 加密 \_ 壓縮 + lsp 偵測 \_ 器的分類</span><span class="sxs-lookup"><span data-stu-id="b9eb2-199">LSP4 has set categories of LSP\_SYSTEM + LSP\_FIREWALL + LSP\_CRYPTO\_COMPRESS + LSP\_INSPECTOR</span></span>

<span data-ttu-id="b9eb2-200">在此範例中， *Foo.exe* 應用程式只會載入 LSP1，而 *Bar.exe* 應用程式會載入 LSP3。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-200">In this example, the *Foo.exe* application would only load LSP1, while the *Bar.exe* application would load LSP3.</span></span>

## <a name="determining-winsock-providers-installed"></a><span data-ttu-id="b9eb2-201">判斷已安裝 Winsock 提供者</span><span class="sxs-lookup"><span data-stu-id="b9eb2-201">Determining Winsock Providers Installed</span></span>

<span data-ttu-id="b9eb2-202">Microsoft Windows 軟體開發套件 (SDK) 包含範例 Winsock 程式，可用來判斷本機電腦上安裝的 Winsock 傳輸提供者。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-202">The Microsoft Windows Software Development Kit (SDK) includes a sample Winsock program that can be used to determine the Winsock transport providers installed on a local computer.</span></span> <span data-ttu-id="b9eb2-203">根據預設，此 Winsock 範例的原始程式碼會安裝在 Windows 7 Windows SDK 的下列目錄中：</span><span class="sxs-lookup"><span data-stu-id="b9eb2-203">By default, the source code for this Winsock sample is installed in the following directory of the Windows SDK for Windows 7:</span></span>

<span data-ttu-id="b9eb2-204">*C： \\ Program Files \\ Microsoft sdk \\ Windows \\ 7.0 \\ 範例 \\ NetDs \\ winsock \\ LSP*</span><span class="sxs-lookup"><span data-stu-id="b9eb2-204">*C:\\Program Files\\Microsoft SDKs\\Windows\\v7.0\\Samples\\NetDs\\winsock\\LSP*</span></span>

<span data-ttu-id="b9eb2-205">此範例是安裝和測試多層式服務提供者的公用程式。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-205">This sample is a utility for installing and testing layered service providers.</span></span> <span data-ttu-id="b9eb2-206">但是它也可以用來以程式設計的方式，從本機電腦上的 Winsock 類別目錄收集詳細資訊。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-206">But it can also be used to programmatically collect detailed information from the Winsock catalog on a local computer.</span></span> <span data-ttu-id="b9eb2-207">若要列出所有目前的 Winsock 提供者（包括基底提供者和層級服務提供者），請建立此 Winsock 範例，然後執行下列主控台命令：</span><span class="sxs-lookup"><span data-stu-id="b9eb2-207">To list all of the current Winsock providers including both base providers and layer service providers, build this Winsock sample and execute the following console command:</span></span>

<span data-ttu-id="b9eb2-208">**instlsp-p**</span><span class="sxs-lookup"><span data-stu-id="b9eb2-208">**instlsp -p**</span></span>

<span data-ttu-id="b9eb2-209">輸出將會是安裝在本機電腦上的 Winsock 提供者清單，包括分層服務提供者。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-209">The output will be a list of Winsock providers installed on the local computer including layered service providers.</span></span> <span data-ttu-id="b9eb2-210">輸出會列出 Winsock 提供者的目錄識別碼和字串名稱</span><span class="sxs-lookup"><span data-stu-id="b9eb2-210">The output lists the catalog ID and the string name for the Winsock provider</span></span>

<span data-ttu-id="b9eb2-211">若要收集所有 Winsock 提供者的詳細資訊，請執行下列主控台命令：</span><span class="sxs-lookup"><span data-stu-id="b9eb2-211">To collect more detailed information on all Winsock providers, execute the following console command:</span></span>

<span data-ttu-id="b9eb2-212">**instlsp-p-v**</span><span class="sxs-lookup"><span data-stu-id="b9eb2-212">**instlsp -p -v**</span></span>

<span data-ttu-id="b9eb2-213">輸出將會是本機電腦上所支援的清單 [**WSAPROTOCOL \_ 資訊**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) 結構。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-213">The output will be a list [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structures supported on the local computer.</span></span>

<span data-ttu-id="b9eb2-214">如需本機電腦上已安裝的多層式服務提供者清單，請執行下列主控台命令：</span><span class="sxs-lookup"><span data-stu-id="b9eb2-214">For a list of only layered service providers installed on the local computer, execute the following console command:</span></span>

<span data-ttu-id="b9eb2-215">**instlsp-l**</span><span class="sxs-lookup"><span data-stu-id="b9eb2-215">**instlsp -l**</span></span>

<span data-ttu-id="b9eb2-216">若要對應 LSP 結構，請執行下列主控台命令：</span><span class="sxs-lookup"><span data-stu-id="b9eb2-216">To map the LSP structure, execute the following console command:</span></span>

<span data-ttu-id="b9eb2-217">**instlsp-m**</span><span class="sxs-lookup"><span data-stu-id="b9eb2-217">**instlsp -m**</span></span>

> [!Note]  
> <span data-ttu-id="b9eb2-218">TDI 功能已被取代，並將在未來的 Microsoft Windows 版本中移除。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-218">The TDI feature is deprecated and will be removed in future versions of Microsoft Windows.</span></span> <span data-ttu-id="b9eb2-219">根據您使用 TDI 的方式，使用 Winsock Kernel (WSK) 或 Windows 篩選平台 (WFP) 。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-219">Depending on how you use TDI, use either the Winsock Kernel (WSK) or Windows Filtering Platform (WFP).</span></span> <span data-ttu-id="b9eb2-220">如需有關 WFP 和 WSK 的詳細資訊，請參閱 [Windows 篩選平台](../fwp/windows-filtering-platform-start-page.md) 和 [Winsock 核心](/windows-hardware/drivers/ddi/_netvista/)。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-220">For more information about WFP and WSK, see [Windows Filtering Platform](../fwp/windows-filtering-platform-start-page.md) and [Winsock Kernel](/windows-hardware/drivers/ddi/_netvista/).</span></span> <span data-ttu-id="b9eb2-221">如需有關 WSK 和 TDI 的 Windows 核心網路功能 blog 專案，請參閱 [Winsock 核心 (WSK 簡介) ](/archive/blogs/wndp/)。</span><span class="sxs-lookup"><span data-stu-id="b9eb2-221">For a Windows Core Networking blog entry about WSK and TDI, see [Introduction to Winsock Kernel (WSK)](/archive/blogs/wndp/).</span></span>

 

 

 
