---
description: Windows 通訊端可透過使用通訊端選項和 IOCTLs，在 IPv6 和網際網路群組管理通訊協定上 (MLD) 啟用多播接聽程式探索，並 (IGMP) IPv4 上的多播應用程式。
ms.assetid: a5de4273-e86e-4f13-b068-256cb38706d4
title: 使用 Windows 通訊端的 MLD 和 IGMP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e6cb9f9c345463e283adea0136037d7ccd03cebd
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104191337"
---
# <a name="mld-and-igmp-using-windows-sockets"></a><span data-ttu-id="c4f50-103">使用 Windows 通訊端的 MLD 和 IGMP</span><span class="sxs-lookup"><span data-stu-id="c4f50-103">MLD and IGMP Using Windows Sockets</span></span>

<span data-ttu-id="c4f50-104">Windows 通訊端可透過使用通訊端選項和 IOCTLs，在 IPv6 和網際網路群組管理通訊協定上 (MLD) 啟用多播接聽程式探索，並 (IGMP) IPv4 上的多播應用程式。</span><span class="sxs-lookup"><span data-stu-id="c4f50-104">Windows Sockets enables the Multicast Listener Discovery (MLD) on IPv6 and the Internet Group Management Protocol (IGMP) on IPv4 for multicast applications through the use of socket options and IOCTLs.</span></span> <span data-ttu-id="c4f50-105">此頁面說明啟用多播程式設計的通訊端選項，並說明其使用方式。</span><span class="sxs-lookup"><span data-stu-id="c4f50-105">This page describes the socket options that enable multicast programming, and describes how they are used.</span></span> <span data-ttu-id="c4f50-106">如需每個通訊端選項的定義，請參閱 [ [通訊端選項](socket-options.md) ] 頁面。</span><span class="sxs-lookup"><span data-stu-id="c4f50-106">For definitions of each socket option, consult the [Socket Options](socket-options.md) page.</span></span>

<span data-ttu-id="c4f50-107">如需有關使用 IOCTLs 進行多播程式設計的詳細資訊，請參閱本節稍後的 [最終狀態式多播程式設計](final-state-based-multicast-programming.md) 。</span><span class="sxs-lookup"><span data-stu-id="c4f50-107">For information on using IOCTLs for multicast programming, see [Final-State-Based Multicast Programming](final-state-based-multicast-programming.md) later in this section.</span></span>

<span data-ttu-id="c4f50-108">在 Windows Vista 和更新版本上，有一組通訊端選項可用於支援 IPv6 和 IPv4 位址的多播程式設計。</span><span class="sxs-lookup"><span data-stu-id="c4f50-108">On Windows Vista and later, a set of socket options are available for multicast programming that support IPv6 and IPv4 addresses.</span></span> <span data-ttu-id="c4f50-109">這些通訊端選項與 IP 無關，而且可以同時用於 IPv6 和 IPv4。</span><span class="sxs-lookup"><span data-stu-id="c4f50-109">These socket options are IP agnostic and can be used on both IPv6 and IPv4.</span></span> <span data-ttu-id="c4f50-110">在 IPv6 上，這些通訊端選項使用 MLDv2。</span><span class="sxs-lookup"><span data-stu-id="c4f50-110">On IPv6, these socket options use MLDv2.</span></span> <span data-ttu-id="c4f50-111">在 IPv4 上，這些通訊端選項使用 IGMPv3。</span><span class="sxs-lookup"><span data-stu-id="c4f50-111">On IPv4, these socket options use IGMPv3.</span></span> <span data-ttu-id="c4f50-112">這些 IP 中立的選項是 Windows Vista 和更新版本上多播程式設計的慣用通訊端選項。</span><span class="sxs-lookup"><span data-stu-id="c4f50-112">These IP agnostic options are the preferred socket options for multicast programming on Windows Vista and later.</span></span> <span data-ttu-id="c4f50-113">Windows 通訊端使用下列通訊端選項：</span><span class="sxs-lookup"><span data-stu-id="c4f50-113">Windows Sockets uses the following socket options:</span></span> 

| <span data-ttu-id="c4f50-114">通訊端選項</span><span class="sxs-lookup"><span data-stu-id="c4f50-114">Socket option</span></span>               | <span data-ttu-id="c4f50-115">引數類型</span><span class="sxs-lookup"><span data-stu-id="c4f50-115">Argument type</span></span>                                            |
|-----------------------------|----------------------------------------------------------|
| <span data-ttu-id="c4f50-116">MCAST \_ 區塊 \_ 來源</span><span class="sxs-lookup"><span data-stu-id="c4f50-116">MCAST\_BLOCK\_SOURCE</span></span>        | <span data-ttu-id="c4f50-117">[**群組 \_來源 \_ 需求**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-group_source_req) 結構</span><span class="sxs-lookup"><span data-stu-id="c4f50-117">[**GROUP\_SOURCE\_REQ**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-group_source_req) structure</span></span> |
| <span data-ttu-id="c4f50-118">MCAST \_ 聯結 \_ 群組</span><span class="sxs-lookup"><span data-stu-id="c4f50-118">MCAST\_JOIN\_GROUP</span></span>          | <span data-ttu-id="c4f50-119">[**群組 \_需求**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-group_req) 結構</span><span class="sxs-lookup"><span data-stu-id="c4f50-119">[**GROUP\_REQ**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-group_req) structure</span></span>                |
| <span data-ttu-id="c4f50-120">MCAST \_ 聯結 \_ 來源 \_ 群組</span><span class="sxs-lookup"><span data-stu-id="c4f50-120">MCAST\_JOIN\_SOURCE\_GROUP</span></span>  | <span data-ttu-id="c4f50-121">[**群組 \_來源 \_ 需求**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-group_source_req) 結構</span><span class="sxs-lookup"><span data-stu-id="c4f50-121">[**GROUP\_SOURCE\_REQ**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-group_source_req) structure</span></span> |
| <span data-ttu-id="c4f50-122">MCAST \_ 離開 \_ 群組</span><span class="sxs-lookup"><span data-stu-id="c4f50-122">MCAST\_LEAVE\_GROUP</span></span>         | <span data-ttu-id="c4f50-123">[**群組 \_需求**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-group_req) 結構</span><span class="sxs-lookup"><span data-stu-id="c4f50-123">[**GROUP\_REQ**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-group_req) structure</span></span>                |
| <span data-ttu-id="c4f50-124">MCAST \_ 離開 \_ 來源 \_ 群組</span><span class="sxs-lookup"><span data-stu-id="c4f50-124">MCAST\_LEAVE\_SOURCE\_GROUP</span></span> | <span data-ttu-id="c4f50-125">[**群組 \_來源 \_ 需求**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-group_source_req) 結構</span><span class="sxs-lookup"><span data-stu-id="c4f50-125">[**GROUP\_SOURCE\_REQ**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-group_source_req) structure</span></span> |
| <span data-ttu-id="c4f50-126">MCAST \_ 解除封鎖 \_ 來源</span><span class="sxs-lookup"><span data-stu-id="c4f50-126">MCAST\_UNBLOCK\_SOURCE</span></span>      | <span data-ttu-id="c4f50-127">[**群組 \_來源 \_ 需求**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-group_source_req) 結構</span><span class="sxs-lookup"><span data-stu-id="c4f50-127">[**GROUP\_SOURCE\_REQ**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-group_source_req) structure</span></span> |



 

<span data-ttu-id="c4f50-128">一組通訊端選項適用于支援 IPv6 專用位址的多播程式設計。</span><span class="sxs-lookup"><span data-stu-id="c4f50-128">A set of socket options are available for multicast programming that support IPv6 only addresses.</span></span> <span data-ttu-id="c4f50-129">這些通訊端選項使用 MLDv1 或 MLDv2。</span><span class="sxs-lookup"><span data-stu-id="c4f50-129">These socket options use MLDv1 or MLDv2.</span></span> <span data-ttu-id="c4f50-130">使用的 MLD 版本取決於 Windows 版本。</span><span class="sxs-lookup"><span data-stu-id="c4f50-130">The version of MLD used is dependent on the version of Windows.</span></span> <span data-ttu-id="c4f50-131">Windows Vista 和更新版本支援 MLDv2。</span><span class="sxs-lookup"><span data-stu-id="c4f50-131">MLDv2 is supported on Windows Vista and later.</span></span> <span data-ttu-id="c4f50-132">Windows 通訊端使用下列通訊端選項：</span><span class="sxs-lookup"><span data-stu-id="c4f50-132">Windows Sockets uses the following socket options:</span></span> 

| <span data-ttu-id="c4f50-133">通訊端選項</span><span class="sxs-lookup"><span data-stu-id="c4f50-133">Socket option</span></span>          | <span data-ttu-id="c4f50-134">引數類型</span><span class="sxs-lookup"><span data-stu-id="c4f50-134">Argument type</span></span>                             |
|------------------------|-------------------------------------------|
| <span data-ttu-id="c4f50-135">IPV6 \_ 新增 \_ 成員資格</span><span class="sxs-lookup"><span data-stu-id="c4f50-135">IPV6\_ADD\_MEMBERSHIP</span></span>  | <span data-ttu-id="c4f50-136">[**ipv6 \_ mreq**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-ipv6_mreq) 結構</span><span class="sxs-lookup"><span data-stu-id="c4f50-136">[**ipv6\_mreq**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-ipv6_mreq) structure</span></span> |
| <span data-ttu-id="c4f50-137">IPV6 \_ 捨棄 \_ 成員資格</span><span class="sxs-lookup"><span data-stu-id="c4f50-137">IPV6\_DROP\_MEMBERSHIP</span></span> | <span data-ttu-id="c4f50-138">[**ipv6 \_ mreq**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-ipv6_mreq) 結構</span><span class="sxs-lookup"><span data-stu-id="c4f50-138">[**ipv6\_mreq**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-ipv6_mreq) structure</span></span> |



 

<span data-ttu-id="c4f50-139">一組通訊端選項適用于僅支援 IPv4 位址的多播程式設計。</span><span class="sxs-lookup"><span data-stu-id="c4f50-139">A set of socket options are available for multicast programming that support IPv4 only addresses.</span></span> <span data-ttu-id="c4f50-140">這些通訊端選項使用 IGMPv3 或 IGMPv2。</span><span class="sxs-lookup"><span data-stu-id="c4f50-140">These socket options use IGMPv3 or IGMPv2.</span></span> <span data-ttu-id="c4f50-141">使用的 IGMP 版本取決於 Windows 版本。</span><span class="sxs-lookup"><span data-stu-id="c4f50-141">The version of IGMP used is dependent on the version of Windows.</span></span> <span data-ttu-id="c4f50-142">Windows Vista 和更新版本支援 IGMPv3。</span><span class="sxs-lookup"><span data-stu-id="c4f50-142">IGMPv3 is supported on Windows Vista and later.</span></span> <span data-ttu-id="c4f50-143">Windows 通訊端使用下列通訊端選項：</span><span class="sxs-lookup"><span data-stu-id="c4f50-143">Windows Sockets uses the following socket options:</span></span>

| <span data-ttu-id="c4f50-144">通訊端選項</span><span class="sxs-lookup"><span data-stu-id="c4f50-144">Socket option</span></span>                | <span data-ttu-id="c4f50-145">引數類型</span><span class="sxs-lookup"><span data-stu-id="c4f50-145">Argument type</span></span>                                        |
|------------------------------|------------------------------------------------------|
| <span data-ttu-id="c4f50-146">IP \_ 新增 \_ 成員資格</span><span class="sxs-lookup"><span data-stu-id="c4f50-146">IP\_ADD\_MEMBERSHIP</span></span>          | <span data-ttu-id="c4f50-147">[**ip \_ mreq**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-ip_mreq) 結構</span><span class="sxs-lookup"><span data-stu-id="c4f50-147">[**ip\_mreq**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-ip_mreq) structure</span></span>                |
| <span data-ttu-id="c4f50-148">IP \_ 新增 \_ 來源 \_ 成員資格</span><span class="sxs-lookup"><span data-stu-id="c4f50-148">IP\_ADD\_SOURCE\_MEMBERSHIP</span></span>  | <span data-ttu-id="c4f50-149">[**ip \_ mreq \_ 來源**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-ip_mreq_source) 結構</span><span class="sxs-lookup"><span data-stu-id="c4f50-149">[**ip\_mreq\_source**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-ip_mreq_source) structure</span></span> |
| <span data-ttu-id="c4f50-150">IP \_ 區塊 \_ 來源</span><span class="sxs-lookup"><span data-stu-id="c4f50-150">IP\_BLOCK\_SOURCE</span></span>            | <span data-ttu-id="c4f50-151">[**ip \_ mreq \_ 來源**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-ip_mreq_source) 結構</span><span class="sxs-lookup"><span data-stu-id="c4f50-151">[**ip\_mreq\_source**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-ip_mreq_source) structure</span></span> |
| <span data-ttu-id="c4f50-152">IP \_ 捨棄 \_ 成員資格</span><span class="sxs-lookup"><span data-stu-id="c4f50-152">IP\_DROP\_MEMBERSHIP</span></span>         | <span data-ttu-id="c4f50-153">[**ip \_ mreq**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-ip_mreq) 結構</span><span class="sxs-lookup"><span data-stu-id="c4f50-153">[**ip\_mreq**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-ip_mreq) structure</span></span>                |
| <span data-ttu-id="c4f50-154">IP \_ DROP \_ SOURCE \_ 成員資格</span><span class="sxs-lookup"><span data-stu-id="c4f50-154">IP\_DROP\_SOURCE\_MEMBERSHIP</span></span> | <span data-ttu-id="c4f50-155">[**ip \_ mreq \_ 來源**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-ip_mreq_source) 結構</span><span class="sxs-lookup"><span data-stu-id="c4f50-155">[**ip\_mreq\_source**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-ip_mreq_source) structure</span></span> |
| <span data-ttu-id="c4f50-156">IP \_ 解除封鎖 \_ 來源</span><span class="sxs-lookup"><span data-stu-id="c4f50-156">IP\_UNBLOCK\_SOURCE</span></span>          | <span data-ttu-id="c4f50-157">[**ip \_ mreq \_ 來源**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-ip_mreq_source) 結構</span><span class="sxs-lookup"><span data-stu-id="c4f50-157">[**ip\_mreq\_source**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-ip_mreq_source) structure</span></span> |



 

<span data-ttu-id="c4f50-158">當 IGMPv3 可用時， \_ \_ \_ 就會更有效率地處理 ip 新增來源成員資格、ip \_ 區塊 \_ 來源、ip \_ 放置 \_ 來源 \_ 成員資格和 ip \_ 解除封鎖 \_ 來源選項，因為路由器可以處理篩選。</span><span class="sxs-lookup"><span data-stu-id="c4f50-158">When IGMPv3 is available, the IP\_ADD\_SOURCE\_MEMBERSHIP, IP\_BLOCK\_SOURCE, IP\_DROP\_SOURCE\_MEMBERSHIP, and IP\_UNBLOCK\_SOURCE options are handled more efficiently since the router can handle the filtering.</span></span> <span data-ttu-id="c4f50-159">當只有 IGMPv2 可用時，主機必須處理篩選。</span><span class="sxs-lookup"><span data-stu-id="c4f50-159">When only IGMPv2 is available, the host must handle the filtering.</span></span>

<span data-ttu-id="c4f50-160">大部分的應用程式可能會落在兩個類別中：任何來源和受控制的來源。</span><span class="sxs-lookup"><span data-stu-id="c4f50-160">There are two categories into which most applications are likely to fall: any-source and controlled-source.</span></span>

-   <span data-ttu-id="c4f50-161">依預設，**任何來源** 應用程式都會接受所有來源，以便視需要關閉個別來源。</span><span class="sxs-lookup"><span data-stu-id="c4f50-161">**Any-source** applications accept all sources by default, allowing individual sources to be turned off as required.</span></span> <span data-ttu-id="c4f50-162">任何來源應用程式的範例是可讓所有收件者參與的影片會議通話。</span><span class="sxs-lookup"><span data-stu-id="c4f50-162">An example of an any-source application is a video conference call that enables all recipients to participate.</span></span>
-   <span data-ttu-id="c4f50-163">**受控制的來源** 應用程式會將來源限制為指定的清單，例如網際網路無線電站，或有明顯事件的廣播。</span><span class="sxs-lookup"><span data-stu-id="c4f50-163">**Controlled-source** applications limit sources to a given list, such as an Internet radio station, or the broadcast of a notable event.</span></span> <span data-ttu-id="c4f50-164">使用通訊端選項的程式對每個選項稍有不同。</span><span class="sxs-lookup"><span data-stu-id="c4f50-164">The process of using socket options is slightly different for each.</span></span>

<span data-ttu-id="c4f50-165">在 Windows Vista 和更新版本上，下列步驟適用于任何來源應用程式：</span><span class="sxs-lookup"><span data-stu-id="c4f50-165">On Windows Vista and later, the following steps apply for any-source applications:</span></span>

- <span data-ttu-id="c4f50-166">使用 **MCAST \_ 聯結 \_ 群組** 加入群組。</span><span class="sxs-lookup"><span data-stu-id="c4f50-166">Use **MCAST\_JOIN\_GROUP** to join a group.</span></span>  
- <span data-ttu-id="c4f50-167">如有需要，請使用 **MCAST \_ 區塊 \_ 來源** 來關閉指定的來源。</span><span class="sxs-lookup"><span data-stu-id="c4f50-167">Use **MCAST\_BLOCK\_SOURCE** to turn off a given source, if required.</span></span>  
- <span data-ttu-id="c4f50-168">若有需要，請使用 **MCAST \_ 解除封鎖 \_ 來源** 來重新允許封鎖的來源。</span><span class="sxs-lookup"><span data-stu-id="c4f50-168">Use **MCAST\_UNBLOCK\_SOURCE** to re-allow a blocked source, if required.</span></span>  
- <span data-ttu-id="c4f50-169">使用 **MCAST \_ 離開 \_ 群組** 來離開群組。</span><span class="sxs-lookup"><span data-stu-id="c4f50-169">Use **MCAST\_LEAVE\_GROUP** to leave the group.</span></span>  

<span data-ttu-id="c4f50-170">在 Windows Vista 和更新版本上，下列步驟適用于受控制的來源應用程式：</span><span class="sxs-lookup"><span data-stu-id="c4f50-170">On Windows Vista and later, the following steps apply for controlled-source applications:</span></span>

- <span data-ttu-id="c4f50-171">使用 **MCAST \_ 聯結 \_ 來源 \_ 群組** 來聯結每個群組/來源配對。</span><span class="sxs-lookup"><span data-stu-id="c4f50-171">Use **MCAST\_JOIN\_SOURCE\_GROUP** to join each group/source pair.</span></span>  
- <span data-ttu-id="c4f50-172">如果所有來源都使用相同的群組位址，請使用 **MCAST \_ 保留 \_ 來源 \_ 群組** 來保留每個群組/來源，或使用 **MCAST \_ 離開 \_ 群組** 來保留所有來源。</span><span class="sxs-lookup"><span data-stu-id="c4f50-172">Use **MCAST\_LEAVE\_SOURCE\_GROUP** to leave each group/source, or use **MCAST\_LEAVE\_GROUP** to leave all sources, if the same group address is used by all sources.</span></span>  

<span data-ttu-id="c4f50-173">下列步驟適用于任何來源應用程式：</span><span class="sxs-lookup"><span data-stu-id="c4f50-173">The following steps apply for any-source applications:</span></span>

- <span data-ttu-id="c4f50-174">使用 **IP \_ 新增 \_ 成員資格** 加入群組 (ipv6) 的 **ipv6 \_ 新增 \_ 成員資格** 。</span><span class="sxs-lookup"><span data-stu-id="c4f50-174">Use **IP\_ADD\_MEMBERSHIP** to join a group (**IPV6\_ADD\_MEMBERSHIP** for IPv6).</span></span>  
- <span data-ttu-id="c4f50-175">如有需要，請使用 **IP \_ 區塊 \_ 來源** 來關閉指定的來源。</span><span class="sxs-lookup"><span data-stu-id="c4f50-175">Use **IP\_BLOCK\_SOURCE** to turn off a given source, if required.</span></span>  
- <span data-ttu-id="c4f50-176">如有需要，請使用 **IP \_ 解除封鎖 \_ 來源** 來重新允許封鎖的來源。</span><span class="sxs-lookup"><span data-stu-id="c4f50-176">Use **IP\_UNBLOCK\_SOURCE** to re-allow a blocked source, if required.</span></span>  
- <span data-ttu-id="c4f50-177">使用 **IP \_ DROP \_ 成員資格** ，讓群組 (ipv6) 的 **ipv6 \_ 捨棄 \_ 成員資格** 。</span><span class="sxs-lookup"><span data-stu-id="c4f50-177">Use **IP\_DROP\_MEMBERSHIP** to leave the group (**IPV6\_DROP\_MEMBERSHIP** for IPv6).</span></span>  

<span data-ttu-id="c4f50-178">下列步驟適用于受控制的來源應用程式：</span><span class="sxs-lookup"><span data-stu-id="c4f50-178">The following steps apply for controlled-source applications:</span></span>

- <span data-ttu-id="c4f50-179">使用 **IP \_ 新增 \_ 來源 \_ 成員資格** 加入每個群組/來源配對。</span><span class="sxs-lookup"><span data-stu-id="c4f50-179">Use **IP\_ADD\_SOURCE\_MEMBERSHIP** to join each group/source pair.</span></span>  
- <span data-ttu-id="c4f50-180">如果所有來源都使用相同的群組位址，請使用 **ip \_ drop \_ SOURCE \_ 成員資格** 來保留每個群組/來源，或使用 **ip \_ drop \_ 成員資格** 來保留所有來源。</span><span class="sxs-lookup"><span data-stu-id="c4f50-180">Use **IP\_DROP\_SOURCE\_MEMBERSHIP** to leave each group/source, or use **IP\_DROP\_MEMBERSHIP** to leave all sources, if the same group address is used by all sources.</span></span>  

<span data-ttu-id="c4f50-181">設定這些通訊端選項的順序有相關聯的規則。</span><span class="sxs-lookup"><span data-stu-id="c4f50-181">The order in which these socket options are set has associated rules.</span></span> <span data-ttu-id="c4f50-182">如需多播通訊端選項的詳細資訊和疑難排解資訊，請參閱 [多播通訊端選項行為](multicast-socket-option-behavior.md)。</span><span class="sxs-lookup"><span data-stu-id="c4f50-182">For information and troubleshooting information on multicast socket options, see [Multicast Socket Option Behavior](multicast-socket-option-behavior.md).</span></span>
