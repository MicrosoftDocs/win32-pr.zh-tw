---
description: 如先前所述，WSPJoinLeaf 是用來將分葉節點聯結到 multipoint 會話中。
ms.assetid: 03325f5e-4d4a-405b-b644-3d8c03435e17
title: 使用 WSPJoinLeaf
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ef4426c0d22657b26dcc2217d856865d9ebe98db
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104191327"
---
# <a name="using-wspjoinleaf"></a><span data-ttu-id="62868-103">使用 WSPJoinLeaf</span><span class="sxs-lookup"><span data-stu-id="62868-103">Using WSPJoinLeaf</span></span>

<span data-ttu-id="62868-104">如先前所述， [**WSPJoinLeaf**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspjoinleaf) 是用來將分葉節點聯結到 multipoint 會話中。</span><span class="sxs-lookup"><span data-stu-id="62868-104">As mentioned previously, [**WSPJoinLeaf**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspjoinleaf) is used to join a leaf node into a multipoint session.</span></span> <span data-ttu-id="62868-105">**WSPJoinLeaf** 與 [**WSPConnect**](/previous-versions/windows/hardware/network/ff566275(v=vs.85)) 具有相同的參數和語義，不同之處在于它會傳回通訊端描述項 (如 [**WSPAccept**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspaccept)) 中所示，而且它還有一個額外的 *dwFlags* 參數。</span><span class="sxs-lookup"><span data-stu-id="62868-105">**WSPJoinLeaf** has the same parameters and semantics as [**WSPConnect**](/previous-versions/windows/hardware/network/ff566275(v=vs.85)) except that it returns a socket descriptor (as in [**WSPAccept**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspaccept)), and it has an additional *dwFlags* parameter.</span></span> <span data-ttu-id="62868-106">*DwFlags* 參數是用來指出通訊端是否只做為傳送者，只做為收件者，或兩者。</span><span class="sxs-lookup"><span data-stu-id="62868-106">The *dwFlags* parameter is used to indicate whether the socket will be acting only as a sender, only as a receiver, or both.</span></span> <span data-ttu-id="62868-107">只有 multipoint 通訊端可以用於此函式中的輸入參數 *s* 。</span><span class="sxs-lookup"><span data-stu-id="62868-107">Only multipoint sockets may be used for input parameter *s* in this function.</span></span> <span data-ttu-id="62868-108">如果 multipoint 通訊端處於非封鎖模式，傳回的通訊端描述項必須等到收到對應的 FD CONNECT 指示之後，才可使用 \_ 。</span><span class="sxs-lookup"><span data-stu-id="62868-108">If the multipoint socket is in the nonblocking mode, the returned socket descriptor will not be usable until after a corresponding FD\_CONNECT indication has been received.</span></span> <span data-ttu-id="62868-109">Multipoint 會話中的根應用程式可能會呼叫 **WSPJoinLeaf** 一次或多次，以便加入多個分葉節點，但一次最多隻能有一個 multipoint 連接要求。</span><span class="sxs-lookup"><span data-stu-id="62868-109">A root application in a multipoint session may call **WSPJoinLeaf** one or more times in order to add a number of leaf nodes, however at most one multipoint connection request may be outstanding at a time.</span></span>

<span data-ttu-id="62868-110">[**WSPJoinLeaf**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspjoinleaf)傳回的通訊端描述項會根據輸入通訊端描述項是 c  \_ 根或 c 分葉而有所不同 \_ 。</span><span class="sxs-lookup"><span data-stu-id="62868-110">The socket descriptor returned by [**WSPJoinLeaf**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspjoinleaf) is different depending on whether the input socket descriptor, *s*, is a c\_root or a c\_leaf.</span></span> <span data-ttu-id="62868-111">搭配 c \_ 根通訊端使用時， *name* 參數會指定要加入的特定分葉節點，而傳回的通訊端描述項是 \_ 對應至新加入之分葉節點的 c 分葉通訊端。</span><span class="sxs-lookup"><span data-stu-id="62868-111">When used with a c\_root socket, the *name* parameter designates a particular leaf node to be added and the returned socket descriptor is a c\_leaf socket corresponding to the newly added leaf node.</span></span> <span data-ttu-id="62868-112">它並不適合用來交換 multipoint 資料，而是用來接收網路事件指標 (例如，針對 \_ 存在於特定 c 分葉的連接，則會關閉) \_ 。</span><span class="sxs-lookup"><span data-stu-id="62868-112">It is not intended to be used for exchange of multipoint data, but rather is used to receive network event indications (for example FD\_CLOSE) for the connection that exists to the particular c\_leaf.</span></span> <span data-ttu-id="62868-113">某些 multipoint 執行也可能會允許此通訊端用於根和個別分葉節點之間的並存聊天。</span><span class="sxs-lookup"><span data-stu-id="62868-113">Some multipoint implementations may also allow this socket to be used for side chats between the root and an individual leaf node.</span></span> <span data-ttu-id="62868-114">\_如果對應的分葉節點呼叫 [**WSPCloseSocket**](/previous-versions/windows/hardware/network/ff566273(v=vs.85))來卸載 multipoint 會話，則應該為這個通訊端提供 FD 關閉指示。</span><span class="sxs-lookup"><span data-stu-id="62868-114">An FD\_CLOSE indication should be given for this socket if the corresponding leaf node calls [**WSPCloseSocket**](/previous-versions/windows/hardware/network/ff566273(v=vs.85)) to drop out of the multipoint session.</span></span> <span data-ttu-id="62868-115">對稱地， 在 \_ 從 [**WSPJoinLeaf**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspjoinleaf)傳回的 c 分葉通訊端上叫用 WSPCloseSocket，會導致對應的分葉節點中的通訊端取得 FD \_ 關閉通知。</span><span class="sxs-lookup"><span data-stu-id="62868-115">Symmetrically, invoking **WSPCloseSocket** on the c\_leaf socket returned from [**WSPJoinLeaf**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspjoinleaf) will cause the socket in the corresponding leaf node to get FD\_CLOSE notification.</span></span>

<span data-ttu-id="62868-116">使用 c 分葉通訊端叫用 [**WSPJoinLeaf**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspjoinleaf) 時 \_ ， *name* 參數會包含根應用程式的位址 (用於根控制項配置) 或現有 multipoint 會話 (nonrooted 控制項配置) ，而傳回的通訊端描述項與輸入通訊端描述項相同。</span><span class="sxs-lookup"><span data-stu-id="62868-116">When [**WSPJoinLeaf**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspjoinleaf) is invoked with a c\_leaf socket, the *name* parameter contains the address of the root application (for a rooted control scheme) or an existing multipoint session (nonrooted control scheme), and the returned socket descriptor is the same as the input socket descriptor.</span></span> <span data-ttu-id="62868-117">在根控制項配置中，根用戶端會呼叫 WSPListen，將其 c \_ 根通訊端置於接聽[](/previous-versions/windows/hardware/network/ff566297(v=vs.85))模式。</span><span class="sxs-lookup"><span data-stu-id="62868-117">In a rooted control scheme, the root client would put its c\_root socket in the listening mode by calling [**WSPListen**](/previous-versions/windows/hardware/network/ff566297(v=vs.85)).</span></span> <span data-ttu-id="62868-118">\_當分葉節點要求將本身加入 multipoint 會話時，將會傳遞標準 FD 接受通知。</span><span class="sxs-lookup"><span data-stu-id="62868-118">The standard FD\_ACCEPT notification will be delivered when the leaf node requests to join itself to the multipoint session.</span></span> <span data-ttu-id="62868-119">根用戶端會使用一般 [**WSPAccept**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspaccept) 函式來承認新的分葉節點。</span><span class="sxs-lookup"><span data-stu-id="62868-119">The root client uses the usual [**WSPAccept**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspaccept) function to admit the new leaf node.</span></span> <span data-ttu-id="62868-120">從 **WSPAccept** 傳回的值也是 c 分 \_ 葉通訊端描述項，就像從 **WSPJoinLeaf** 傳回的值一樣。</span><span class="sxs-lookup"><span data-stu-id="62868-120">The value returned from **WSPAccept** is also a c\_leaf socket descriptor just like those returned from **WSPJoinLeaf**.</span></span> <span data-ttu-id="62868-121">若要容納可同時允許根起始和分葉起始聯結的 multipoint 配置，可接受 \_ 已在接聽模式中的 c 根通訊端，以做為 **WSPJoinLeaf** 的輸入。</span><span class="sxs-lookup"><span data-stu-id="62868-121">To accommodate multipoint schemes that allow both root-initiated and leaf-initiated joins, it is acceptable for a c\_root socket that is already in listening mode to be used as in input to **WSPJoinLeaf**.</span></span>

<span data-ttu-id="62868-122">Multipoint 根用戶端通常負責 multipoint 會話的有條理 dismantling。</span><span class="sxs-lookup"><span data-stu-id="62868-122">A multipoint root client is generally responsible for the orderly dismantling of a multipoint session.</span></span> <span data-ttu-id="62868-123">這類應用程式可能會在 c 根通訊端上使用 [**WSPShutdown**](/previous-versions/windows/desktop/legacy/ms742294(v=vs.85)) 或 [**WSPCloseSocket**](/previous-versions/windows/hardware/network/ff566273(v=vs.85)) ， \_ 以產生所有相關聯的 c 分 \_ 葉通訊端，包括從 [**WSPJoinLeaf**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspjoinleaf) 傳回的，以及遠端分葉節點中對應的 c 分 \_ 葉通訊端，以取得 FD \_ 關閉通知。</span><span class="sxs-lookup"><span data-stu-id="62868-123">Such an application may use [**WSPShutdown**](/previous-versions/windows/desktop/legacy/ms742294(v=vs.85)) or [**WSPCloseSocket**](/previous-versions/windows/hardware/network/ff566273(v=vs.85)) on a c\_root socket to cause all of the associated c\_leaf sockets, including those returned from [**WSPJoinLeaf**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspjoinleaf) and their corresponding c\_leaf sockets in the remote leaf nodes, to get FD\_CLOSE notification.</span></span>

 

 
