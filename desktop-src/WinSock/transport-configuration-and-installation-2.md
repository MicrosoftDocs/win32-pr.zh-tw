---
description: 為了讓傳輸通訊協定可透過 Windows 通訊端存取，它必須正確安裝在系統上，並向 Windows 通訊端註冊。
ms.assetid: 0f0b22e4-81b7-43a7-bc2f-7124fa32d925
title: 傳輸設定和安裝
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ea980740f727e39338c7568f4cc30a961b5484df
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "107001334"
---
# <a name="transport-configuration-and-installation"></a><span data-ttu-id="d78ba-103">傳輸設定和安裝</span><span class="sxs-lookup"><span data-stu-id="d78ba-103">Transport Configuration and Installation</span></span>

<span data-ttu-id="d78ba-104">為了讓傳輸通訊協定可透過 Windows 通訊端存取，它必須正確安裝在系統上，並向 Windows 通訊端註冊。</span><span class="sxs-lookup"><span data-stu-id="d78ba-104">In order for a transport protocol to be accessible through Windows Sockets it must be properly installed on the system and registered with Windows Sockets.</span></span> <span data-ttu-id="d78ba-105">藉由叫用廠商的安裝程式來安裝傳輸服務提供者時，必須將設定資訊新增至設定資料庫，以提供 Ws2 \_32.dll 有關服務提供者的必要資訊。</span><span class="sxs-lookup"><span data-stu-id="d78ba-105">When a transport service provider is installed by invoking a vendor's installation program, configuration information must be added to a configuration database to give the Ws2\_32.dll required information regarding the service provider.</span></span> <span data-ttu-id="d78ba-106">Ws2 \_32.dll 會針對廠商的安裝程式匯出數個安裝功能（ [**WSCInstallProvider**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscinstallprovider) 和 [**WSCInstallProviderAndChains**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscinstallproviderandchains)），以提供要安裝之服務提供者的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="d78ba-106">The Ws2\_32.dll exports several installation functions, [**WSCInstallProvider**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscinstallprovider) and [**WSCInstallProviderAndChains**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscinstallproviderandchains), for the vendor's installation program to supply the relevant information about the service provider to be installed.</span></span> <span data-ttu-id="d78ba-107">例如，這項資訊包含服務提供者 DLL 的名稱和路徑，以及此提供者可支援的 [**WSAPROTOCOL \_ 資訊**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) 結構清單。</span><span class="sxs-lookup"><span data-stu-id="d78ba-107">This information includes, for example, the name and path to the service provider DLL and a list of [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structures that this provider can support.</span></span> <span data-ttu-id="d78ba-108">Ws2 \_32.dll 也提供廠商的卸載程式的函式 [**WSCDeinstallProvider**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscdeinstallprovider)，以從 Ws232.dll 所維護的設定資料庫中移除所有相關資訊 \_ 。</span><span class="sxs-lookup"><span data-stu-id="d78ba-108">The Ws2\_32.dll also provides a function, [**WSCDeinstallProvider**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscdeinstallprovider), for a vendor's deinstallation program to remove all the relevant information from the configuration database maintained by the Ws2\_32.dll.</span></span> <span data-ttu-id="d78ba-109">這項設定資訊的確切位置和格式對 Ws232.dll 是私 \_ 用的，而且只能由上述的函式來操作。</span><span class="sxs-lookup"><span data-stu-id="d78ba-109">The exact location and format of this configuration information is private to the Ws2\_32.dll, and can only be manipulated by the above-mentioned functions.</span></span>

<span data-ttu-id="d78ba-110">在64位平臺上，有類似的函式可在32位和64位目錄上運作。</span><span class="sxs-lookup"><span data-stu-id="d78ba-110">On 64-bit platforms, there are similar functions that operate on a 32-bit and 64-bit catalogs.</span></span> <span data-ttu-id="d78ba-111">這些函數包括 [**WSCInstallProvider64 \_ 32**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscinstallprovider64_32)、 [**WSCInstallProviderAndChains64 \_ 32**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscinstallproviderandchains64_32)和 [**WSCDeinstallProvider32**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscdeinstallprovider32)。</span><span class="sxs-lookup"><span data-stu-id="d78ba-111">These functions include [**WSCInstallProvider64\_32**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscinstallprovider64_32), [**WSCInstallProviderAndChains64\_32**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscinstallproviderandchains64_32), and [**WSCDeinstallProvider32**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscdeinstallprovider32).</span></span>

<span data-ttu-id="d78ba-112">最初安裝傳輸服務提供者的順序，會控制在服務提供者介面上透過 [**WSCEnumProtocols**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscenumprotocols) 和 [**WSCEnumProtocols32**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscenumprotocols32) 列舉的順序，或透過應用程式介面上的 [**WSAEnumProtocols**](/windows/desktop/api/Winsock2/nf-winsock2-wsaenumprotocolsa) 來進行列舉的順序。</span><span class="sxs-lookup"><span data-stu-id="d78ba-112">The order in which transport service providers are initially installed governs the order in which they are enumerated through [**WSCEnumProtocols**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscenumprotocols) and [**WSCEnumProtocols32**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscenumprotocols32) at the service provider interface, or through [**WSAEnumProtocols**](/windows/desktop/api/Winsock2/nf-winsock2-wsaenumprotocolsa) at the application interface.</span></span> <span data-ttu-id="d78ba-113">更重要的是，當用戶端要求根據地址系列、類型和通訊協定識別碼建立通訊端時，此順序也會控制通訊協定和服務提供者的順序。</span><span class="sxs-lookup"><span data-stu-id="d78ba-113">More importantly, this order also governs the order in which protocols and service providers are considered when a client requests creation of a socket based on its address family, type, and protocol identifier.</span></span> <span data-ttu-id="d78ba-114">Windows 通訊端2包含稱為 Sporder.exe 的小程式，可讓已安裝的通訊協定目錄在安裝通訊協定之後以互動方式重新排序。</span><span class="sxs-lookup"><span data-stu-id="d78ba-114">Windows Sockets 2 includes an applet called Sporder.exe that allows the catalog of installed protocols to be reordered interactively after protocols have already been installed.</span></span> <span data-ttu-id="d78ba-115">Windows 通訊端2也包含輔助 DLL （Sporder.dll），可匯出重新排列通訊協定的程式性介面。</span><span class="sxs-lookup"><span data-stu-id="d78ba-115">Windows Sockets 2 also includes an auxiliary DLL, Sporder.dll, that exports a procedural interface for reordering protocols.</span></span> <span data-ttu-id="d78ba-116">這個程式介面是由稱為 [**WSCWriteProviderOrder**](/windows/desktop/api/Sporder/nf-sporder-wscwriteproviderorder)的單一程式所組成。</span><span class="sxs-lookup"><span data-stu-id="d78ba-116">This procedural interface consists of a single procedure called [**WSCWriteProviderOrder**](/windows/desktop/api/Sporder/nf-sporder-wscwriteproviderorder).</span></span>

## <a name="installing-layered-protocols-and-protocol-chains"></a><span data-ttu-id="d78ba-117">安裝多層式通訊協定和通訊協定鏈</span><span class="sxs-lookup"><span data-stu-id="d78ba-117">Installing Layered Protocols and Protocol Chains</span></span>

<span data-ttu-id="d78ba-118">每個要安裝的通訊協定所提供的 [**WSAPROTOCOL \_ 資訊**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) 結構，都會指出通訊協定是基本通訊協定、分層式通訊協定或通訊協定鏈。</span><span class="sxs-lookup"><span data-stu-id="d78ba-118">The [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure supplied with each protocol to be installed indicates whether the protocol is a base protocol, layered protocol, or protocol chain.</span></span> <span data-ttu-id="d78ba-119">*ProtocolChain. ChainLen* 參數的值如下表所示。</span><span class="sxs-lookup"><span data-stu-id="d78ba-119">The value of the *ProtocolChain.ChainLen* parameter is interpreted as shown in the following table.</span></span>

| <span data-ttu-id="d78ba-120">值</span><span class="sxs-lookup"><span data-stu-id="d78ba-120">Value</span></span> | <span data-ttu-id="d78ba-121">意義</span><span class="sxs-lookup"><span data-stu-id="d78ba-121">Meaning</span></span>                                           |
|-------|---------------------------------------------------|
| <span data-ttu-id="d78ba-122">0</span><span class="sxs-lookup"><span data-stu-id="d78ba-122">0</span></span>     | <span data-ttu-id="d78ba-123">多層通訊協定。</span><span class="sxs-lookup"><span data-stu-id="d78ba-123">Layered protocol.</span></span>                                 |
| <span data-ttu-id="d78ba-124">1</span><span class="sxs-lookup"><span data-stu-id="d78ba-124">1</span></span>     | <span data-ttu-id="d78ba-125">基本通訊協定 (或僅) 一個元件。</span><span class="sxs-lookup"><span data-stu-id="d78ba-125">Base protocol (or chain with only one component).</span></span> |
| <span data-ttu-id="d78ba-126">> 1</span><span class="sxs-lookup"><span data-stu-id="d78ba-126">>1</span></span> | <span data-ttu-id="d78ba-127">通訊協定鏈。</span><span class="sxs-lookup"><span data-stu-id="d78ba-127">Protocol chain.</span></span>                                   |



 

<span data-ttu-id="d78ba-128">通訊協定鏈的安裝只會在成功安裝所有組成元件 (基礎通訊協定和分層通訊協定) 之後才會發生。</span><span class="sxs-lookup"><span data-stu-id="d78ba-128">Installation of protocol chains can only occur after successful installation of all of the constituent components (base protocols and layered protocols).</span></span> <span data-ttu-id="d78ba-129">通訊協定鏈的 [**WSAPROTOCOL \_ 資訊**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) 結構會使用 *ProtocolChain* 參數來描述鏈的長度和每個元件的身分識別。</span><span class="sxs-lookup"><span data-stu-id="d78ba-129">The [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure for a protocol chain uses the *ProtocolChain* parameter to describe the length of the chain and the identity of each component.</span></span> <span data-ttu-id="d78ba-130">組成鏈的個別通訊協定會依序列在 ProtocolChain. ChainEntries 陣列中，並具有對應至第一個分層提供者的陣列第零個元素。</span><span class="sxs-lookup"><span data-stu-id="d78ba-130">The individual protocols that make up a chain are listed in order in the ProtocolChain.ChainEntries array, with the zeroth element of the array corresponding to the first layered provider.</span></span> <span data-ttu-id="d78ba-131">通訊協定是由 Ws232.dll 在通訊協定安裝時所指派的 *CatalogEntryID* 值來識別， \_ 並可在每個通訊協定的 **WSAPROTOCOL \_ 資訊** 結構中找到。</span><span class="sxs-lookup"><span data-stu-id="d78ba-131">Protocols are identified by their *CatalogEntryID* values, which are assigned by the Ws2\_32.dll at protocol installation time, and can be found in the **WSAPROTOCOL\_INFO** structure for each protocol.</span></span>

<span data-ttu-id="d78ba-132">您應選擇通訊協定鏈 [**WSAPROTOCOL \_ 資訊**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) 結構中其餘參數的值，以反映最能將通訊協定鏈視為整體的屬性和識別碼。</span><span class="sxs-lookup"><span data-stu-id="d78ba-132">The values for the remaining parameters in the protocol chain's [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure should be chosen to reflect the attributes and identifiers that best characterize the protocol chain as a whole.</span></span> <span data-ttu-id="d78ba-133">當選取這些值時，開發人員應該注意，只有在兩個端點都已安裝相容的通訊協定鏈，而且應用程式必須能夠辨識對應的 **WSAPROTOCOL \_ 資訊** 結構時，才會透過通訊協定鏈進行通訊。</span><span class="sxs-lookup"><span data-stu-id="d78ba-133">When selecting these values, developers should bear in mind that communications over protocol chains can only occur when both endpoints have compatible protocol chains installed, and that applications must be able to recognize the corresponding **WSAPROTOCOL\_INFO** structure.</span></span>

<span data-ttu-id="d78ba-134">安裝基本通訊協定時，不需要在 *ProtocolChain. ChainEntries* 陣列中建立任何專案。</span><span class="sxs-lookup"><span data-stu-id="d78ba-134">When a base protocol is installed, it is not necessary to make any entries in the *ProtocolChain.ChainEntries* array.</span></span> <span data-ttu-id="d78ba-135">它會隱含地瞭解，此鏈的唯一元件已在相同 [**WSAPROTOCOL \_ 資訊**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa)結構的 *CatalogEntryID* 參數中識別。</span><span class="sxs-lookup"><span data-stu-id="d78ba-135">It is implicitly understood that the sole component of this chain is already identified in the *CatalogEntryID* parameter of the same [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure.</span></span> <span data-ttu-id="d78ba-136">另請注意，通訊協定鏈可能不包含相同分層通訊協定的多個實例。</span><span class="sxs-lookup"><span data-stu-id="d78ba-136">Also note that protocol chains may not include multiple instances of the same layered protocol.</span></span>

 

 
