---
description: 支援從16位程式碼移植的全域和區域函式，或維護與16位 Windows 之間的原始程式碼相容性。
ms.assetid: 97707ce7-4c65-4d0e-ba69-47fdaee73a9b
title: 全域和區域函數
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cf356647f92f0e7d82e914a91020c438363ff082
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "103847944"
---
# <a name="global-and-local-functions"></a><span data-ttu-id="14cf2-103">全域和區域函數</span><span class="sxs-lookup"><span data-stu-id="14cf2-103">Global and Local Functions</span></span>

<span data-ttu-id="14cf2-104">支援從16位程式碼移植的全域和區域函式，或維護與16位 Windows 之間的原始程式碼相容性。</span><span class="sxs-lookup"><span data-stu-id="14cf2-104">The global and local functions are supported for porting from 16-bit code, or for maintaining source code compatibility with 16-bit Windows.</span></span> <span data-ttu-id="14cf2-105">從32位 Windows 開始，全域和區域函式會實作為包裝函式，以使用進程預設堆積的控制碼來呼叫對應的 [堆積函數](heap-functions.md) 。</span><span class="sxs-lookup"><span data-stu-id="14cf2-105">Starting with 32-bit Windows, the global and local functions are implemented as wrapper functions that call the corresponding [heap functions](heap-functions.md) using a handle to the process's default heap.</span></span> <span data-ttu-id="14cf2-106">因此，全域和區域函數的額外負荷會比其他記憶體管理函數更大。</span><span class="sxs-lookup"><span data-stu-id="14cf2-106">Therefore, the global and local functions have greater overhead than other memory management functions.</span></span>

<span data-ttu-id="14cf2-107">[堆積](heap-functions.md)函式提供的功能和控制與全域和區域函式不同。</span><span class="sxs-lookup"><span data-stu-id="14cf2-107">The [heap functions](heap-functions.md) provide more features and control than the global and local functions.</span></span> <span data-ttu-id="14cf2-108">新的應用程式應該使用堆積函式，除非檔特別指出應該使用全域或區域函數。</span><span class="sxs-lookup"><span data-stu-id="14cf2-108">New applications should use the heap functions unless documentation specifically states that a global or local function should be used.</span></span> <span data-ttu-id="14cf2-109">例如，某些 Windows 函式會配置必須使用 [**>localfree**](/windows/desktop/api/WinBase/nf-winbase-localfree)釋放的記憶體，而全域函式仍會搭配動態資料交換 (DDE) 、剪貼簿函式和 OLE 資料物件使用。</span><span class="sxs-lookup"><span data-stu-id="14cf2-109">For example, some Windows functions allocate memory that must be freed with [**LocalFree**](/windows/desktop/api/WinBase/nf-winbase-localfree), and the global functions are still used with Dynamic Data Exchange (DDE), the clipboard functions, and OLE data objects.</span></span> <span data-ttu-id="14cf2-110">如需全域和區域函數的完整清單，請參閱 [記憶體管理函數](memory-management-functions.md)中的資料表。</span><span class="sxs-lookup"><span data-stu-id="14cf2-110">For a complete list of global and local functions, see the table in [Memory Management Functions](memory-management-functions.md).</span></span>

<span data-ttu-id="14cf2-111">Windows 記憶體管理不提供個別的本機堆積和全域堆積，因為16位的 Windows 會這樣做。</span><span class="sxs-lookup"><span data-stu-id="14cf2-111">Windows memory management does not provide a separate local heap and global heap, as 16-bit Windows does.</span></span> <span data-ttu-id="14cf2-112">因此，全域和區域系列的函式是相等的，而在它們之間選擇則是個人喜好設定。</span><span class="sxs-lookup"><span data-stu-id="14cf2-112">As a result, the global and local families of functions are equivalent and choosing between them is a matter of personal preference.</span></span> <span data-ttu-id="14cf2-113">請注意，從16位分割的記憶體模型到32位虛擬記憶體模型的變更，已使某些相關的全域和區域函數和其選項不需要或無意義。</span><span class="sxs-lookup"><span data-stu-id="14cf2-113">Note that the change from a 16-bit segmented memory model to a 32-bit virtual memory model has made some of the related global and local functions and their options unnecessary or meaningless.</span></span> <span data-ttu-id="14cf2-114">例如，因為本機和全域配置都會傳回32位虛擬位址，所以不會再有接近或遠的指標。</span><span class="sxs-lookup"><span data-stu-id="14cf2-114">For example, there are no longer near and far pointers, because both local and global allocations return 32-bit virtual addresses.</span></span>

<span data-ttu-id="14cf2-115">[**GlobalAlloc**](/windows/desktop/api/WinBase/nf-winbase-globalalloc)和 [**LocalAlloc**](/windows/desktop/api/WinBase/nf-winbase-localalloc)所配置的記憶體物件位於私用、已認可的頁面，其具有無法由其他進程存取的讀取/寫入存取權。</span><span class="sxs-lookup"><span data-stu-id="14cf2-115">Memory objects allocated by [**GlobalAlloc**](/windows/desktop/api/WinBase/nf-winbase-globalalloc) and [**LocalAlloc**](/windows/desktop/api/WinBase/nf-winbase-localalloc) are in private, committed pages with read/write access that cannot be accessed by other processes.</span></span> <span data-ttu-id="14cf2-116">使用 **GlobalAlloc** 搭配 **GMEM \_ DDESHARE** 所配置的記憶體，實際上並不是全域共用，因為它在16位的 Windows 中。</span><span class="sxs-lookup"><span data-stu-id="14cf2-116">Memory allocated by using **GlobalAlloc** with **GMEM\_DDESHARE** is not actually shared globally as it is in 16-bit Windows.</span></span> <span data-ttu-id="14cf2-117">此值沒有任何作用，而且僅適用于相容性。</span><span class="sxs-lookup"><span data-stu-id="14cf2-117">This value has no effect and is available only for compatibility.</span></span> <span data-ttu-id="14cf2-118">針對其他用途需要共用記憶體的應用程式必須使用檔案對應物件。</span><span class="sxs-lookup"><span data-stu-id="14cf2-118">Applications requiring shared memory for other purposes must use file-mapping objects.</span></span> <span data-ttu-id="14cf2-119">多個進程可以對應相同檔案對應物件的視圖，以提供命名的共用記憶體。</span><span class="sxs-lookup"><span data-stu-id="14cf2-119">Multiple processes can map a view of the same file-mapping object to provide named shared memory.</span></span> <span data-ttu-id="14cf2-120">如需詳細資訊，請參閱檔案 [對應](file-mapping.md)。</span><span class="sxs-lookup"><span data-stu-id="14cf2-120">For more information, see [File Mapping](file-mapping.md).</span></span>

<span data-ttu-id="14cf2-121">記憶體配置只受限於可用的實體記憶體，包括磁片上分頁檔案中的儲存體。</span><span class="sxs-lookup"><span data-stu-id="14cf2-121">Memory allocations are limited only by the available physical memory, including storage in the paging file on disk.</span></span> <span data-ttu-id="14cf2-122">當您配置固定的記憶體時， [**GlobalAlloc**](/windows/desktop/api/WinBase/nf-winbase-globalalloc) 和 [**LocalAlloc**](/windows/desktop/api/WinBase/nf-winbase-localalloc) 會傳回呼叫進程可以立即用來存取記憶體的指標。</span><span class="sxs-lookup"><span data-stu-id="14cf2-122">When you allocate fixed memory, [**GlobalAlloc**](/windows/desktop/api/WinBase/nf-winbase-globalalloc) and [**LocalAlloc**](/windows/desktop/api/WinBase/nf-winbase-localalloc) return a pointer that the calling process can immediately use to access the memory.</span></span> <span data-ttu-id="14cf2-123">當您配置可移動記憶體時，傳回值為控制碼。</span><span class="sxs-lookup"><span data-stu-id="14cf2-123">When you allocate moveable memory, the return value is a handle.</span></span> <span data-ttu-id="14cf2-124">若要取得可移動記憶體物件的指標，請使用 [**GlobalLock**](/windows/desktop/api/WinBase/nf-winbase-globallock) 和 [**LocalLock**](/windows/desktop/api/WinBase/nf-winbase-locallock) 函數。</span><span class="sxs-lookup"><span data-stu-id="14cf2-124">To get a pointer to a movable memory object, use the [**GlobalLock**](/windows/desktop/api/WinBase/nf-winbase-globallock) and [**LocalLock**](/windows/desktop/api/WinBase/nf-winbase-locallock) functions.</span></span>

<span data-ttu-id="14cf2-125">所配置記憶體的實際大小可能會大於所要求的大小。</span><span class="sxs-lookup"><span data-stu-id="14cf2-125">The actual size of the memory allocated can be larger than the requested size.</span></span> <span data-ttu-id="14cf2-126">若要判斷配置的實際位元組數目，請使用 [**GlobalSize**](/windows/desktop/api/WinBase/nf-winbase-globalsize) 或 [**LocalSize**](/windows/desktop/api/WinBase/nf-winbase-localsize) 函數。</span><span class="sxs-lookup"><span data-stu-id="14cf2-126">To determine the actual number of bytes allocated, use the [**GlobalSize**](/windows/desktop/api/WinBase/nf-winbase-globalsize) or [**LocalSize**](/windows/desktop/api/WinBase/nf-winbase-localsize) function.</span></span> <span data-ttu-id="14cf2-127">如果配置的數量大於所要求的數量，則處理常式可以使用整個數量。</span><span class="sxs-lookup"><span data-stu-id="14cf2-127">If the amount allocated is greater than the amount requested, the process can use the entire amount.</span></span>

<span data-ttu-id="14cf2-128">[**GlobalReAlloc**](/windows/desktop/api/WinBase/nf-winbase-globalrealloc)和 [**LocalReAlloc**](/windows/desktop/api/WinBase/nf-winbase-localrealloc)函式會變更 [**GlobalAlloc**](/windows/desktop/api/WinBase/nf-winbase-globalalloc)和 [**LocalAlloc**](/windows/desktop/api/WinBase/nf-winbase-localalloc)所配置之記憶體物件的大小或屬性。</span><span class="sxs-lookup"><span data-stu-id="14cf2-128">The [**GlobalReAlloc**](/windows/desktop/api/WinBase/nf-winbase-globalrealloc) and [**LocalReAlloc**](/windows/desktop/api/WinBase/nf-winbase-localrealloc) functions change the size or the attributes of a memory object allocated by [**GlobalAlloc**](/windows/desktop/api/WinBase/nf-winbase-globalalloc) and [**LocalAlloc**](/windows/desktop/api/WinBase/nf-winbase-localalloc).</span></span> <span data-ttu-id="14cf2-129">大小可能會增加或減少。</span><span class="sxs-lookup"><span data-stu-id="14cf2-129">The size can increase or decrease.</span></span>

<span data-ttu-id="14cf2-130">[**GlobalFree**](/windows/desktop/api/WinBase/nf-winbase-globalfree)和 [**>localfree**](/windows/desktop/api/WinBase/nf-winbase-localfree)函式會釋放由 [**GlobalAlloc**](/windows/desktop/api/WinBase/nf-winbase-globalalloc)、 [**LocalAlloc**](/windows/desktop/api/WinBase/nf-winbase-localalloc)、 [**GlobalReAlloc**](/windows/desktop/api/WinBase/nf-winbase-globalrealloc)或 [**LocalReAlloc**](/windows/desktop/api/WinBase/nf-winbase-localrealloc)所配置的記憶體。</span><span class="sxs-lookup"><span data-stu-id="14cf2-130">The [**GlobalFree**](/windows/desktop/api/WinBase/nf-winbase-globalfree) and [**LocalFree**](/windows/desktop/api/WinBase/nf-winbase-localfree) functions release memory allocated by [**GlobalAlloc**](/windows/desktop/api/WinBase/nf-winbase-globalalloc), [**LocalAlloc**](/windows/desktop/api/WinBase/nf-winbase-localalloc), [**GlobalReAlloc**](/windows/desktop/api/WinBase/nf-winbase-globalrealloc), or [**LocalReAlloc**](/windows/desktop/api/WinBase/nf-winbase-localrealloc).</span></span> <span data-ttu-id="14cf2-131">若要捨棄指定的記憶體物件而不使控制碼失效，請使用 [**GlobalDiscard**](/windows/desktop/api/WinBase/nf-winbase-globaldiscard) 或 [**LocalDiscard**](/windows/win32/api/minwinbase/nf-minwinbase-localdiscard) 函數。</span><span class="sxs-lookup"><span data-stu-id="14cf2-131">To discard the specified memory object without invalidating the handle, use the [**GlobalDiscard**](/windows/desktop/api/WinBase/nf-winbase-globaldiscard) or [**LocalDiscard**](/windows/win32/api/minwinbase/nf-minwinbase-localdiscard) function.</span></span> <span data-ttu-id="14cf2-132">**GlobalReAlloc** 或 **LocalReAlloc** 稍後可以使用此控制碼來配置與相同控制碼相關聯的新記憶體區塊。</span><span class="sxs-lookup"><span data-stu-id="14cf2-132">The handle can be used later by **GlobalReAlloc** or **LocalReAlloc** to allocate a new block of memory associated with the same handle.</span></span>

<span data-ttu-id="14cf2-133">若要傳回指定之記憶體物件的相關資訊，請使用 [**GlobalFlags**](/windows/desktop/api/WinBase/nf-winbase-globalflags) 或 [**LocalFlags**](/windows/desktop/api/WinBase/nf-winbase-localflags) 函數。</span><span class="sxs-lookup"><span data-stu-id="14cf2-133">To return information about a specified memory object, use the [**GlobalFlags**](/windows/desktop/api/WinBase/nf-winbase-globalflags) or [**LocalFlags**](/windows/desktop/api/WinBase/nf-winbase-localflags) function.</span></span> <span data-ttu-id="14cf2-134">此資訊包含物件的鎖定計數，並指出物件是否為 discardable 或已被捨棄。</span><span class="sxs-lookup"><span data-stu-id="14cf2-134">The information includes the object's lock count and indicates whether the object is discardable or has already been discarded.</span></span> <span data-ttu-id="14cf2-135">若要將控制碼傳回至與指定之指標相關聯的記憶體物件，請使用 [**GlobalHandle**](/windows/desktop/api/WinBase/nf-winbase-globalhandle) 或 [**LocalHandle**](/windows/desktop/api/WinBase/nf-winbase-localhandle) 函數。</span><span class="sxs-lookup"><span data-stu-id="14cf2-135">To return a handle to the memory object associated with a specified pointer, use the [**GlobalHandle**](/windows/desktop/api/WinBase/nf-winbase-globalhandle) or [**LocalHandle**](/windows/desktop/api/WinBase/nf-winbase-localhandle) function.</span></span>

## <a name="related-topics"></a><span data-ttu-id="14cf2-136">相關主題</span><span class="sxs-lookup"><span data-stu-id="14cf2-136">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="14cf2-137">比較記憶體配置方法</span><span class="sxs-lookup"><span data-stu-id="14cf2-137">Comparing Memory Allocation Methods</span></span>](comparing-memory-allocation-methods.md)
</dt> </dl>

 

 
