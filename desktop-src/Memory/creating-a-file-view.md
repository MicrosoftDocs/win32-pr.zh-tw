---
description: 若要將檔案中的資料對應至進程的虛擬記憶體，您必須建立檔案的視圖。
ms.assetid: b1ebd9a4-cde4-4c0c-80d2-5ccb655cd3a4
title: 建立檔案視圖
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 498f7ba132efd9ecf82f9ec087492c9622824b51
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "103944165"
---
# <a name="creating-a-file-view"></a><span data-ttu-id="b62dc-103">建立檔案視圖</span><span class="sxs-lookup"><span data-stu-id="b62dc-103">Creating a File View</span></span>

<span data-ttu-id="b62dc-104">若要將檔案中的資料對應至進程的虛擬記憶體，您必須建立檔案的視圖。</span><span class="sxs-lookup"><span data-stu-id="b62dc-104">To map the data from a file to the virtual memory of a process, you must create a view of the file.</span></span> <span data-ttu-id="b62dc-105">[**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile)和 [**MapViewOfFileEx**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffileex)函式會使用 [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga)所傳回的檔案對應物件控制碼，在進程的虛擬位址空間中建立檔案的視圖或部分檔案。</span><span class="sxs-lookup"><span data-stu-id="b62dc-105">The [**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile) and [**MapViewOfFileEx**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffileex) functions use the file mapping object handle returned by [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) to create a view of the file or a portion of the file in the process's virtual address space.</span></span> <span data-ttu-id="b62dc-106">如果存取旗標與 **CreateFileMapping** 建立檔案對應物件時所指定的旗標發生衝突，則這些函式會失敗。</span><span class="sxs-lookup"><span data-stu-id="b62dc-106">These functions fail if the access flags conflict with those specified when **CreateFileMapping** created the file mapping object.</span></span>

<span data-ttu-id="b62dc-107">[**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile)函式會傳回檔案視圖的指標。</span><span class="sxs-lookup"><span data-stu-id="b62dc-107">The [**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile) function returns a pointer to the file view.</span></span> <span data-ttu-id="b62dc-108">藉由在 **MapViewOfFile** 中指定的位址範圍內取值指標，應用程式可以從檔案讀取資料，並將資料寫入檔案。</span><span class="sxs-lookup"><span data-stu-id="b62dc-108">By dereferencing a pointer in the range of addresses specified in **MapViewOfFile**, an application can read data from the file and write data to the file.</span></span> <span data-ttu-id="b62dc-109">寫入檔案視圖會導致檔案對應物件的變更。</span><span class="sxs-lookup"><span data-stu-id="b62dc-109">Writing to the file view results in changes to the file mapping object.</span></span> <span data-ttu-id="b62dc-110">實際寫入磁片上的檔案是由系統處理。</span><span class="sxs-lookup"><span data-stu-id="b62dc-110">The actual writing to the file on disk is handled by the system.</span></span> <span data-ttu-id="b62dc-111">資料在寫入檔案對應物件時，不會實際傳送。</span><span class="sxs-lookup"><span data-stu-id="b62dc-111">Data is not actually transferred at the time the file mapping object is written to.</span></span> <span data-ttu-id="b62dc-112">相反地，大部分的檔案輸入和輸出 (i/o) 都會進行快取，以改善一般系統效能。</span><span class="sxs-lookup"><span data-stu-id="b62dc-112">Instead, much of the file input and output (I/O) is cached to improve general system performance.</span></span> <span data-ttu-id="b62dc-113">應用程式可以藉由呼叫 [**FlushViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-flushviewoffile) 函式來強制系統立即執行磁片交易，藉以覆寫此行為。</span><span class="sxs-lookup"><span data-stu-id="b62dc-113">Applications can override this behavior by calling the [**FlushViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-flushviewoffile) function to force the system to perform disk transactions immediately.</span></span>

<span data-ttu-id="b62dc-114">[**MapViewOfFileEx**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffileex)函式的運作方式與 [**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile)函式完全相同，不同之處在于它可讓進程在 *lpvBase* 參數中，于進程的虛擬位址空間中，指定檔案視圖的基底位址。</span><span class="sxs-lookup"><span data-stu-id="b62dc-114">The [**MapViewOfFileEx**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffileex) function works exactly like the [**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile) function except that it allows a process to specify the base address of the view of the file in the process's virtual address space in the *lpvBase* parameter.</span></span> <span data-ttu-id="b62dc-115">如果指定的位址沒有足夠的空間，則呼叫會失敗。</span><span class="sxs-lookup"><span data-stu-id="b62dc-115">If there is not enough space at the specified address, the call fails.</span></span> <span data-ttu-id="b62dc-116">因此，如果您必須將檔案對應到多個進程中的相同位址，則處理常式應協商適當的位址： *lpvBase* 參數必須是系統記憶體配置細微性的整數倍數，否則呼叫會失敗。</span><span class="sxs-lookup"><span data-stu-id="b62dc-116">Therefore, if you must map a file to the same address in multiple processes, the processes should negotiate an appropriate address: The *lpvBase* parameter must be an integral multiple of the system memory allocation granularity or the call fails.</span></span> <span data-ttu-id="b62dc-117">若要取得系統的記憶體配置細微性，請使用 [**GetSystemInfo**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsysteminfo) 函數，它會填入 [**系統 \_ 資訊**](/windows/win32/api/sysinfoapi/ns-sysinfoapi-system_info) 結構的成員。</span><span class="sxs-lookup"><span data-stu-id="b62dc-117">To obtain the system's memory allocation granularity, use the [**GetSystemInfo**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsysteminfo) function, which fills in the members of a [**SYSTEM\_INFO**](/windows/win32/api/sysinfoapi/ns-sysinfoapi-system_info) structure.</span></span>

<span data-ttu-id="b62dc-118">應用程式可以從相同的檔案對應物件建立多個檔案視圖。</span><span class="sxs-lookup"><span data-stu-id="b62dc-118">An application can create multiple file views from the same file mapping object.</span></span> <span data-ttu-id="b62dc-119">檔案視圖的大小可以不同于從其中衍生的檔案對應物件，但它必須小於檔案對應物件。</span><span class="sxs-lookup"><span data-stu-id="b62dc-119">A file view can be a different size than the file mapping object from which it is derived, but it must be smaller than the file mapping object.</span></span> <span data-ttu-id="b62dc-120">[**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile)的 *dwOffsetHigh* 和 *dwOffsetLow* 參數所指定的位移必須是系統組態細微性的倍數。</span><span class="sxs-lookup"><span data-stu-id="b62dc-120">The offset specified by the *dwOffsetHigh* and *dwOffsetLow* parameters of [**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile) must be a multiple of the allocation granularity of the system.</span></span>

## <a name="related-topics"></a><span data-ttu-id="b62dc-121">相關主題</span><span class="sxs-lookup"><span data-stu-id="b62dc-121">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="b62dc-122">在檔案中建立視圖</span><span class="sxs-lookup"><span data-stu-id="b62dc-122">Creating a View Within a File</span></span>](creating-a-view-within-a-file.md)
</dt> </dl>

 

 
