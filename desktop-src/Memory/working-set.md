---
description: 進程的工作集是目前駐留在實體記憶體中之進程的虛擬位址空間中的一組頁面。
ms.assetid: ff05276a-1d40-4844-b649-10e32e3f1937
title: 工作集
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4985e7eb526d5dda8469ccc2f46bfe6fd050c745
ms.sourcegitcommit: b01ad017c152c6756f3638623fe335877644d414
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/06/2021
ms.locfileid: "111549890"
---
# <a name="working-set"></a><span data-ttu-id="99f8c-103">工作集</span><span class="sxs-lookup"><span data-stu-id="99f8c-103">Working Set</span></span>

<span data-ttu-id="99f8c-104">進程的工作集是目前駐留在實體記憶體中之進程的虛擬位址空間中的一組頁面。</span><span class="sxs-lookup"><span data-stu-id="99f8c-104">The working set of a process is the set of pages in the virtual address space of the process that are currently resident in physical memory.</span></span> <span data-ttu-id="99f8c-105">工作集只包含可分頁的記憶體配置;nonpageable 記憶體配置（例如 [位址視窗擴充](address-windowing-extensions.md) (AWE) 或 [大型分頁](large-page-support.md) 配置）不包含在工作集內。</span><span class="sxs-lookup"><span data-stu-id="99f8c-105">The working set contains only pageable memory allocations; nonpageable memory allocations such as [Address Windowing Extensions](address-windowing-extensions.md) (AWE) or [large page allocations](large-page-support.md) are not included in the working set.</span></span>

<span data-ttu-id="99f8c-106">當進程參考目前不在其工作集中的可分頁記憶體時，就會發生 *分頁錯誤* 。</span><span class="sxs-lookup"><span data-stu-id="99f8c-106">When a process references pageable memory that is not currently in its working set, a *page fault* occurs.</span></span> <span data-ttu-id="99f8c-107">系統分頁錯誤處理常式會嘗試解析分頁錯誤，如果成功，則會將頁面加入工作集。</span><span class="sxs-lookup"><span data-stu-id="99f8c-107">The system page fault handler attempts to resolve the page fault and, if it succeeds, the page is added to the working set.</span></span> <span data-ttu-id="99f8c-108">存取 AWE 或大型頁面配置的 (永遠不會造成分頁錯誤，因為這些配置無法分頁。 ) </span><span class="sxs-lookup"><span data-stu-id="99f8c-108">(Accessing AWE or large page allocations never causes a page fault, because these allocations are not pageable .)</span></span>

<span data-ttu-id="99f8c-109">若要解決 *硬分頁錯誤* ，必須從頁面的 *備份存放區* 讀取頁面內容，也就是系統分頁檔案或進程所建立的記憶體對應檔。</span><span class="sxs-lookup"><span data-stu-id="99f8c-109">A *hard page fault* must be resolved by reading page contents from the page's *backing store*, which is either the system paging file or a memory-mapped file created by the process.</span></span> <span data-ttu-id="99f8c-110">您可以在不存取備份存放區的情況下解析 *軟分頁錯誤* 。</span><span class="sxs-lookup"><span data-stu-id="99f8c-110">A *soft page fault* can be resolved without accessing the backing store.</span></span> <span data-ttu-id="99f8c-111">當發生下列情況時，就會發生軟分頁錯誤：</span><span class="sxs-lookup"><span data-stu-id="99f8c-111">A soft page fault occurs when:</span></span>

-   <span data-ttu-id="99f8c-112">此頁面位於一些其他進程的工作集內，因此它已經常駐在記憶體中。</span><span class="sxs-lookup"><span data-stu-id="99f8c-112">The page is in the working set of some other process, so it is already resident in memory.</span></span>
-   <span data-ttu-id="99f8c-113">頁面正在轉換中，因為已從所有使用頁面的處理常式的工作集移除該頁面，但尚未重設用途，或已經在執行記憶體管理員預先提取作業的結果中。</span><span class="sxs-lookup"><span data-stu-id="99f8c-113">The page is in transition, because it either has been removed from the working sets of all processes that were using the page and has not yet been repurposed, or it is already resident as a result of a memory manager prefetch operation.</span></span>
-   <span data-ttu-id="99f8c-114">程式會在第一次參考配置的虛擬頁面 (有時也稱為「 *需要零的錯誤*) 。</span><span class="sxs-lookup"><span data-stu-id="99f8c-114">A process references an allocated virtual page for the first time (sometimes called a *demand-zero fault*).</span></span>

<span data-ttu-id="99f8c-115">您可以從處理常式工作集移除頁面，作為下列動作的結果：</span><span class="sxs-lookup"><span data-stu-id="99f8c-115">Pages can be removed from a process working set as a result of the following actions:</span></span>

-   <span data-ttu-id="99f8c-116">此程式會藉由呼叫 [**SetProcessWorkingSetSize**](/windows/win32/api/memoryapi/nf-memoryapi-setprocessworkingsetsize)、 [**SetProcessWorkingSetSizeEx**](/windows/win32/api/memoryapi/nf-memoryapi-setprocessworkingsetsizeex) 或 [**EmptyWorkingSet**](/windows/win32/api/psapi/nf-psapi-emptyworkingset) 函數來減少或清空工作集。</span><span class="sxs-lookup"><span data-stu-id="99f8c-116">The process reduces or empties the working set by calling the [**SetProcessWorkingSetSize**](/windows/win32/api/memoryapi/nf-memoryapi-setprocessworkingsetsize), [**SetProcessWorkingSetSizeEx**](/windows/win32/api/memoryapi/nf-memoryapi-setprocessworkingsetsizeex) or [**EmptyWorkingSet**](/windows/win32/api/psapi/nf-psapi-emptyworkingset) function.</span></span>
-   <span data-ttu-id="99f8c-117">此處理程式會在未鎖定的記憶體範圍上呼叫 [**VirtualUnlock**](/windows/win32/api/memoryapi/nf-memoryapi-virtualunlock) 函數。</span><span class="sxs-lookup"><span data-stu-id="99f8c-117">The process calls the [**VirtualUnlock**](/windows/win32/api/memoryapi/nf-memoryapi-virtualunlock) function on a memory range that is not locked.</span></span>
-   <span data-ttu-id="99f8c-118">此程式會使用 [**UnmapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-unmapviewoffile) 函數 unmaps 檔案的對應視圖。</span><span class="sxs-lookup"><span data-stu-id="99f8c-118">The process unmaps a mapped view of a file using the [**UnmapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-unmapviewoffile) function.</span></span>
-   <span data-ttu-id="99f8c-119">記憶體管理員會從工作集修剪頁面，以建立更多可用的記憶體。</span><span class="sxs-lookup"><span data-stu-id="99f8c-119">The memory manager trims pages from the working set to create more available memory.</span></span>
-   <span data-ttu-id="99f8c-120">記憶體管理員必須從工作集移除頁面，以騰出空間給新的頁面 (例如，因為工作集的大小上限為) 。</span><span class="sxs-lookup"><span data-stu-id="99f8c-120">The memory manager must remove a page from the working set to make room for a new page (for example, because the working set is at its maximum size).</span></span>

<span data-ttu-id="99f8c-121">如果有數個進程共用某個頁面，從一個進程的工作集移除頁面，並不會影響其他進程。</span><span class="sxs-lookup"><span data-stu-id="99f8c-121">If several processes share a page, removing the page from the working set of one process does not affect other processes.</span></span> <span data-ttu-id="99f8c-122">從所有使用它的進程的工作集移除頁面之後，該頁面就會變成 *轉換頁面*。</span><span class="sxs-lookup"><span data-stu-id="99f8c-122">After a page is removed from the working sets of all processes that were using it, the page becomes a *transition page*.</span></span> <span data-ttu-id="99f8c-123">轉換頁面會在 RAM 中保持快取狀態，直到某個進程或重新用途的 (重新參考頁面為止例如，填滿零，並將其提供給另一個進程) 。</span><span class="sxs-lookup"><span data-stu-id="99f8c-123">Transition pages remain cached in RAM until the page is either referenced again by some process or repurposed (for example, filled with zeros and given to another process).</span></span> <span data-ttu-id="99f8c-124">如果轉換頁面自從上次寫入磁片後已經過修改 (也就是，如果頁面是「已變更」 ) ，則必須先將該頁面寫入至其備份存放區，才能重新建立用途。</span><span class="sxs-lookup"><span data-stu-id="99f8c-124">If a transition page has been modified since it was last written to disk (that is, if the page is "dirty"), then the page must be written to its backing store before it can be repurposed.</span></span> <span data-ttu-id="99f8c-125">當這類頁面可供使用時，系統就會開始將中途轉換頁面寫入其備份存放區。</span><span class="sxs-lookup"><span data-stu-id="99f8c-125">The system may start writing dirty transition pages to their backing store as soon as such pages become available.</span></span>

<span data-ttu-id="99f8c-126">每個進程都有最小和最大的工作集大小，它會影響進程的虛擬記憶體分頁行為。</span><span class="sxs-lookup"><span data-stu-id="99f8c-126">Each process has a minimum and maximum working set size that affect the virtual memory paging behavior of the process.</span></span> <span data-ttu-id="99f8c-127">若要取得指定進程之工作集的目前大小，請使用 [**GetProcessMemoryInfo**](/windows/win32/api/psapi/nf-psapi-getprocessmemoryinfo) 函數。</span><span class="sxs-lookup"><span data-stu-id="99f8c-127">To obtain the current size of the working set of a specified process, use the [**GetProcessMemoryInfo**](/windows/win32/api/psapi/nf-psapi-getprocessmemoryinfo) function.</span></span> <span data-ttu-id="99f8c-128">若要取得或變更工作集大小的下限和上限，請使用 [**GetProcessWorkingSetSizeEx**](/windows/win32/api/memoryapi/nf-memoryapi-getprocessworkingsetsizeex) 和 [**SetProcessWorkingSetSizeEx**](/windows/win32/api/memoryapi/nf-memoryapi-setprocessworkingsetsizeex) 函數。</span><span class="sxs-lookup"><span data-stu-id="99f8c-128">To obtain or change the minimum and maximum working set sizes, use the [**GetProcessWorkingSetSizeEx**](/windows/win32/api/memoryapi/nf-memoryapi-getprocessworkingsetsizeex) and [**SetProcessWorkingSetSizeEx**](/windows/win32/api/memoryapi/nf-memoryapi-setprocessworkingsetsizeex) functions.</span></span>

<span data-ttu-id="99f8c-129">進程狀態應用程式開發介面 (PSAPI.DLL) 提供許多函數，以傳回有關處理常式工作集的詳細資訊。</span><span class="sxs-lookup"><span data-stu-id="99f8c-129">The process status application programming interface (PSAPI) provides a number of functions that return detailed information about the working set of a process.</span></span> <span data-ttu-id="99f8c-130">如需詳細資訊，請參閱 [工作集資訊](../psapi/working-set-information.md)。</span><span class="sxs-lookup"><span data-stu-id="99f8c-130">For details, see [Working Set Information](../psapi/working-set-information.md).</span></span>

 

 
