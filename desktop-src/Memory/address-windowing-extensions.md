---
description: 位址視窗擴充 (AWE) 是一組延伸模組，可讓應用程式快速操作大於4GB 的實體記憶體。
ms.assetid: 48a29922-8130-4540-86b0-0faa120566a6
title: 位址視窗擴充功能
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b8cb311bf9ecef2de334018ca3f9982a31f0b072
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "103849165"
---
# <a name="address-windowing-extensions"></a><span data-ttu-id="98cfb-103">位址視窗擴充功能</span><span class="sxs-lookup"><span data-stu-id="98cfb-103">Address Windowing Extensions</span></span>

<span data-ttu-id="98cfb-104">位址視窗擴充 (AWE) 是一組延伸模組，可讓應用程式快速操作大於4GB 的實體記憶體。</span><span class="sxs-lookup"><span data-stu-id="98cfb-104">Address Windowing Extensions (AWE) is a set of extensions that allows an application to quickly manipulate physical memory greater than 4GB.</span></span> <span data-ttu-id="98cfb-105">某些需要大量資料的應用程式（例如資料庫管理系統、科學和工程軟體）需要存取非常大量的資料快取。</span><span class="sxs-lookup"><span data-stu-id="98cfb-105">Certain data-intensive applications, such as database management systems and scientific and engineering software, need access to very large caches of data.</span></span> <span data-ttu-id="98cfb-106">在非常大型的資料集的情況下，限制快取以容納在應用程式的使用者位址空間的2GB 內，是一項嚴重的限制。</span><span class="sxs-lookup"><span data-stu-id="98cfb-106">In the case of very large data sets, restricting the cache to fit within an application's 2GB of user address space is a severe restriction.</span></span> <span data-ttu-id="98cfb-107">在這些情況下，快取太小，無法正確支援應用程式。</span><span class="sxs-lookup"><span data-stu-id="98cfb-107">In these situations, the cache is too small to properly support the application.</span></span>

<span data-ttu-id="98cfb-108">AWE 可讓應用程式直接處理海量儲存體，同時繼續使用32位指標，藉此解決這個問題。</span><span class="sxs-lookup"><span data-stu-id="98cfb-108">AWE solves this problem by allowing applications to directly address huge amounts of memory while continuing to use 32-bit pointers.</span></span> <span data-ttu-id="98cfb-109">AWE 可讓應用程式在有足夠實體記憶體的情況下，將資料快取到大於4GB 的 () 。</span><span class="sxs-lookup"><span data-stu-id="98cfb-109">AWE allows applications to have data caches larger than 4GB (where sufficient physical memory is present).</span></span> <span data-ttu-id="98cfb-110">AWE 會在32位虛擬位址空間內，針對此實體記憶體的各個部分，使用物理非分頁式記憶體和視窗視圖。</span><span class="sxs-lookup"><span data-stu-id="98cfb-110">AWE uses physical nonpaged memory and window views of various portions of this physical memory within a 32-bit virtual address space.</span></span>

<span data-ttu-id="98cfb-111">AWE 對此記憶體的使用方式有一些限制，主要是因為這些限制可讓您以極快速的方式對應、重新對應和釋放。</span><span class="sxs-lookup"><span data-stu-id="98cfb-111">AWE places a few restrictions on how this memory may be used, primarily because these restrictions allow extremely fast mapping, remapping, and freeing.</span></span> <span data-ttu-id="98cfb-112">快速記憶體管理對於這些可能的大量位址空間而言很重要。</span><span class="sxs-lookup"><span data-stu-id="98cfb-112">Fast memory management is important for these potentially enormous address spaces.</span></span>

-   <span data-ttu-id="98cfb-113">配置給 AWE 的虛擬位址範圍不能與其他進程共用 (因此無法繼承) 。</span><span class="sxs-lookup"><span data-stu-id="98cfb-113">Virtual address ranges allocated for the AWE are not sharable with other processes (and therefore not inheritable).</span></span> <span data-ttu-id="98cfb-114">事實上，相同進程內的兩個不同 AWE 虛擬位址不允許對應相同的實體頁面。</span><span class="sxs-lookup"><span data-stu-id="98cfb-114">In fact, two different AWE virtual addresses within the same process are not allowed to map the same physical page.</span></span> <span data-ttu-id="98cfb-115">這些限制可在釋放記憶體時，提供快速重新對應和清除。</span><span class="sxs-lookup"><span data-stu-id="98cfb-115">These restrictions provide fast remapping and cleanup when memory is freed.</span></span>
-   <span data-ttu-id="98cfb-116">可以針對 AWE 區域配置的實體頁面會受限於機器中的實體頁面數目，因為此記憶體從未分頁過，所以會被鎖定，直到應用程式明確釋出或結束為止。</span><span class="sxs-lookup"><span data-stu-id="98cfb-116">The physical pages that can be allocated for an AWE region are limited by the number of physical pages present in the machine, since this memory is never paged – it is locked down until the application explicitly frees it or exits.</span></span> <span data-ttu-id="98cfb-117">針對給定進程配置的實體頁面可以對應到相同進程內的任何 AWE 虛擬區域。</span><span class="sxs-lookup"><span data-stu-id="98cfb-117">The physical pages allocated for a given process can be mapped into any AWE virtual region within the same process.</span></span> <span data-ttu-id="98cfb-118">使用 AWE 的應用程式必須小心，不要佔用太多實體記憶體，讓其他應用程式過度分頁，或防止建立新的進程或執行緒，因為資源不足。</span><span class="sxs-lookup"><span data-stu-id="98cfb-118">Applications that use AWE must be careful not to take so much physical memory that they cause other applications to page excessively or prevent creation of new processes or threads due to lack of resources.</span></span> <span data-ttu-id="98cfb-119">使用 [**GlobalMemoryStatusEx**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-globalmemorystatusex) 函式來監視實體記憶體的使用方式。</span><span class="sxs-lookup"><span data-stu-id="98cfb-119">Use the [**GlobalMemoryStatusEx**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-globalmemorystatusex) function to monitor physical memory use.</span></span>
-   <span data-ttu-id="98cfb-120">AWE 虛擬位址一律是讀取/寫入，而且無法透過呼叫 ([**VirtualProtect**](/windows/win32/api/memoryapi/nf-memoryapi-virtualprotect) 進行保護，也就是沒有唯讀的記憶體、noaccess 記憶體、防護頁面，而且可以指定) 的 like。</span><span class="sxs-lookup"><span data-stu-id="98cfb-120">AWE virtual addresses are always read/write and cannot be protected via calls to [**VirtualProtect**](/windows/win32/api/memoryapi/nf-memoryapi-virtualprotect) (that is, no read-only memory, noaccess memory, guard pages, and the like can be specified).</span></span>
-   <span data-ttu-id="98cfb-121">AWE 位址範圍不能用來緩衝處理圖形或影片呼叫的資料。</span><span class="sxs-lookup"><span data-stu-id="98cfb-121">AWE address ranges cannot be used to buffer data for graphics or video calls.</span></span>
-   <span data-ttu-id="98cfb-122">無法分割 AWE 記憶體範圍，也無法刪除它的片段。</span><span class="sxs-lookup"><span data-stu-id="98cfb-122">An AWE memory range cannot be split, nor can pieces of it be deleted.</span></span> <span data-ttu-id="98cfb-123">相反地，必須刪除整個虛擬位址範圍，以作為需要刪除的單位。</span><span class="sxs-lookup"><span data-stu-id="98cfb-123">Instead, the entire virtual address range must be deleted as a unit when deletion is required.</span></span> <span data-ttu-id="98cfb-124">這表示在呼叫 [**VirtualFree**](/windows/win32/api/memoryapi/nf-memoryapi-virtualfree)時，您必須指定 **MEM \_ 釋放**。</span><span class="sxs-lookup"><span data-stu-id="98cfb-124">This means you must specify **MEM\_RELEASE** when calling [**VirtualFree**](/windows/win32/api/memoryapi/nf-memoryapi-virtualfree).</span></span>
-   <span data-ttu-id="98cfb-125">應用程式可以同時對應多個區域，但前提是它們不會重迭。</span><span class="sxs-lookup"><span data-stu-id="98cfb-125">Applications can map multiple regions simultaneously, provided they do not overlap.</span></span>
-   <span data-ttu-id="98cfb-126">模擬模式不支援使用 AWE 的應用程式。</span><span class="sxs-lookup"><span data-stu-id="98cfb-126">Applications that use AWE are not supported in emulation mode.</span></span> <span data-ttu-id="98cfb-127">也就是說，使用 AWE 函式的 x86 應用程式必須重新編譯，才能在另一個處理器上執行，而大部分的應用程式都可以在不需要重新編譯的情況下，于其他平臺的模擬器下執行。</span><span class="sxs-lookup"><span data-stu-id="98cfb-127">That is, an x86 application that uses AWE functions must be recompiled to run on another processor, whereas most applications can run without recompiling under an emulator on other platforms.</span></span>

<span data-ttu-id="98cfb-128">此解決方案以非常普遍、普遍適用的方式解決實體記憶體問題。</span><span class="sxs-lookup"><span data-stu-id="98cfb-128">This solution addresses the physical memory issues in a very general, widely applicable manner.</span></span> <span data-ttu-id="98cfb-129">AWE 的一些優點如下：</span><span class="sxs-lookup"><span data-stu-id="98cfb-129">Some of the benefits of AWE are:</span></span>

-   <span data-ttu-id="98cfb-130">定義一小部分的新函數，以操作 AWE 記憶體。</span><span class="sxs-lookup"><span data-stu-id="98cfb-130">A small group of new functions is defined to manipulate AWE memory.</span></span>
-   <span data-ttu-id="98cfb-131">AWE 提供非常快速的重新對應功能。</span><span class="sxs-lookup"><span data-stu-id="98cfb-131">AWE provides a very fast remapping capability.</span></span> <span data-ttu-id="98cfb-132">重新對應是藉由操作虛擬記憶體資料表來完成，而不是在實體記憶體中移動資料。</span><span class="sxs-lookup"><span data-stu-id="98cfb-132">Remapping is done by manipulating virtual memory tables, not by moving data in physical memory.</span></span>
-   <span data-ttu-id="98cfb-133">AWE 提供適用于處理器 (的頁面大小細微性，例如在 x86) 上為 4 KB，這對應用程式比大型頁面更有用 (例如，x86) 上的2MB 或4MB。</span><span class="sxs-lookup"><span data-stu-id="98cfb-133">AWE provides page size granularity appropriate to the processor (for example, 4 KB on x86), which is more useful to applications than large pages (for example, 2MB or 4MB on x86).</span></span>

<span data-ttu-id="98cfb-134">應用程式必須具有 [鎖定記憶體中的分頁] 許可權，才能使用 AWE。</span><span class="sxs-lookup"><span data-stu-id="98cfb-134">An application must have the Lock Pages in Memory privilege to use AWE.</span></span> <span data-ttu-id="98cfb-135">若要取得此許可權，系統管理員必須 **在記憶體中將鎖定頁面** 新增至使用者的 **使用者權限指派**。</span><span class="sxs-lookup"><span data-stu-id="98cfb-135">To obtain this privilege, an administrator must add **Lock Pages in Memory** to the user's **User Rights Assignments**.</span></span> <span data-ttu-id="98cfb-136">如需如何進行這項操作的詳細資訊，請參閱作業系統說明中的「使用者權限」。</span><span class="sxs-lookup"><span data-stu-id="98cfb-136">For more information on how to do this, see "User Rights" in the operating system help.</span></span>

<span data-ttu-id="98cfb-137">下列函式會組成 (AWE) API 的位址視窗擴充功能。</span><span class="sxs-lookup"><span data-stu-id="98cfb-137">The following functions make up the Address Windowing Extensions (AWE) API.</span></span>



| <span data-ttu-id="98cfb-138">函式</span><span class="sxs-lookup"><span data-stu-id="98cfb-138">Function</span></span>                                                                          | <span data-ttu-id="98cfb-139">描述</span><span class="sxs-lookup"><span data-stu-id="98cfb-139">Description</span></span>                                                                                                                                                                                                                                               |
|-----------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="98cfb-140">[**VirtualAlloc**](/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc)和 [ **VirtualAllocEx**](/windows/win32/api/memoryapi/nf-memoryapi-virtualallocex)</span><span class="sxs-lookup"><span data-stu-id="98cfb-140">[**VirtualAlloc**](/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc) and [**VirtualAllocEx**](/windows/win32/api/memoryapi/nf-memoryapi-virtualallocex)</span></span> | <span data-ttu-id="98cfb-141">使用 **記憶體 \_ 實體**，保留要用於 AWE 的部分虛擬位址空間。</span><span class="sxs-lookup"><span data-stu-id="98cfb-141">Reserve a portion of virtual address space to use for AWE, using **MEM\_PHYSICAL**.</span></span>                                                                                                                                                                       |
| [<span data-ttu-id="98cfb-142">**AllocateUserPhysicalPages**</span><span class="sxs-lookup"><span data-stu-id="98cfb-142">**AllocateUserPhysicalPages**</span></span>](/windows/win32/api/memoryapi/nf-memoryapi-allocateuserphysicalpages)                    | <span data-ttu-id="98cfb-143">配置要搭配 AWE 使用的實體記憶體。</span><span class="sxs-lookup"><span data-stu-id="98cfb-143">Allocate physical memory for use with AWE.</span></span>                                                                                                                                                                                                                |
| [<span data-ttu-id="98cfb-144">**MapUserPhysicalPages**</span><span class="sxs-lookup"><span data-stu-id="98cfb-144">**MapUserPhysicalPages**</span></span>](/windows/win32/api/memoryapi/nf-memoryapi-mapuserphysicalpages)                              | <span data-ttu-id="98cfb-145">將) AWE 虛擬位址對應 (或使其失效，並放到以 [**AllocateUserPhysicalPages**](/windows/win32/api/memoryapi/nf-memoryapi-allocateuserphysicalpages)取得的任何實體頁面上。</span><span class="sxs-lookup"><span data-stu-id="98cfb-145">Map (or invalidate) AWE virtual addresses onto any set of physical pages obtained with [**AllocateUserPhysicalPages**](/windows/win32/api/memoryapi/nf-memoryapi-allocateuserphysicalpages).</span></span>                                                                                                    |
| [<span data-ttu-id="98cfb-146">**MapUserPhysicalPagesScatter**</span><span class="sxs-lookup"><span data-stu-id="98cfb-146">**MapUserPhysicalPagesScatter**</span></span>](/windows/desktop/api/WinBase/nf-winbase-mapuserphysicalpagesscatter)                | <span data-ttu-id="98cfb-147">將) AWE 虛擬位址對應 (或使其在以 [**AllocateUserPhysicalPages**](/windows/win32/api/memoryapi/nf-memoryapi-allocateuserphysicalpages)取得的任何實體頁面上失效，但使用 [**MapUserPhysicalPages**](/windows/win32/api/memoryapi/nf-memoryapi-mapuserphysicalpages)所提供的更細微控制。</span><span class="sxs-lookup"><span data-stu-id="98cfb-147">Map (or invalidate) AWE virtual addresses onto any set of physical pages obtained with [**AllocateUserPhysicalPages**](/windows/win32/api/memoryapi/nf-memoryapi-allocateuserphysicalpages), but with finer control than that provided by [**MapUserPhysicalPages**](/windows/win32/api/memoryapi/nf-memoryapi-mapuserphysicalpages).</span></span> |
| [<span data-ttu-id="98cfb-148">**FreeUserPhysicalPages**</span><span class="sxs-lookup"><span data-stu-id="98cfb-148">**FreeUserPhysicalPages**</span></span>](/windows/win32/api/memoryapi/nf-memoryapi-freeuserphysicalpages)                            | <span data-ttu-id="98cfb-149">用於 AWE 的可用實體記憶體。</span><span class="sxs-lookup"><span data-stu-id="98cfb-149">Free physical memory that was used for AWE.</span></span>                                                                                                                                                                                                               |



 

 

 
