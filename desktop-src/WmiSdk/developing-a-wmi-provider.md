---
description: 提供者是元件物件模型 (COM) 物件，可作為 WMI 和 managed 物件之間的媒介。
ms.assetid: a4f537ba-9081-43b4-acff-4d206de3d9d7
ms.tgt_platform: multiple
title: 開發 WMI 提供者
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9249c251f75f08f9e5142e70a507b0dced8f91df
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "107000270"
---
# <a name="developing-a-wmi-provider"></a><span data-ttu-id="87fbe-103">開發 WMI 提供者</span><span class="sxs-lookup"><span data-stu-id="87fbe-103">Developing a WMI Provider</span></span>

<span data-ttu-id="87fbe-104">提供者是元件物件模型 (COM) 物件，可作為 WMI 和 managed 物件之間的媒介。</span><span class="sxs-lookup"><span data-stu-id="87fbe-104">A provider is a Component Object Model (COM) object that acts as an intermediary between WMI and a managed object.</span></span> <span data-ttu-id="87fbe-105">例如，當應用程式或腳本使用 WMI [**Win32 \_ LogicalDisk**](/windows/desktop/CIMWin32Prov/win32-logicaldisk) 類別來要求磁片資料時，會透過預先安裝的 [Win32 提供者](/windows/desktop/CIMWin32Prov/win32-provider)動態取得資料。</span><span class="sxs-lookup"><span data-stu-id="87fbe-105">For example, when an application or script requests disk data using the WMI [**Win32\_LogicalDisk**](/windows/desktop/CIMWin32Prov/win32-logicaldisk) class, the data is obtained dynamically through the preinstalled [Win32 provider](/windows/desktop/CIMWin32Prov/win32-provider).</span></span>

<span data-ttu-id="87fbe-106">如果您想要透過 WMI 提供資料給其他應用程式，您可以藉由撰寫 COM 伺服器或透過 Visual Studio 中的 **WMI ATL 嚮導** 來建立非受控程式碼提供者。</span><span class="sxs-lookup"><span data-stu-id="87fbe-106">If you want to supply data through WMI to other applications, you can create an unmanaged code provider by writing a COM server or through the **WMI ATL wizards** in Visual Studio.</span></span> <span data-ttu-id="87fbe-107">您可以使用 .NET Framework 中的 WMI 來撰寫 managed 程式碼提供者。</span><span class="sxs-lookup"><span data-stu-id="87fbe-107">You can write a managed code provider by using WMI in the .NET Framework.</span></span> <span data-ttu-id="87fbe-108">本節中的主題描述撰寫非受控 COM 提供者的程式。</span><span class="sxs-lookup"><span data-stu-id="87fbe-108">The topics in this section describe the process of writing an unmanaged COM provider.</span></span>

> [!Note]  
> <span data-ttu-id="87fbe-109">若要確保在 WMI 發生失敗並重新啟動時，受管理物件的所有 WMI 類別定義都會還原至 [*wmi 儲存*](gloss-w.md)機制，請使用受控物件格式 (MOF) 檔中的 [**\# pragma 自動**](pragma-autorecover.md)復原預處理器指令。</span><span class="sxs-lookup"><span data-stu-id="87fbe-109">To ensure that all of your WMI class definitions for managed objects are restored to the [*WMI repository*](gloss-w.md) if WMI has a failure and restarts, use the [**\#pragma autorecover**](pragma-autorecover.md) preprocessor instruction in your Managed Object Format (MOF) file.</span></span>

 

<span data-ttu-id="87fbe-110">提供者是由 [*受控物件格式 (MOF)*](gloss-m.md) 架構中定義的類別，以及執行提供者功能的 DLL 檔案所組成。</span><span class="sxs-lookup"><span data-stu-id="87fbe-110">A provider consists of classes defined in the [*Managed Object Format (MOF)*](gloss-m.md) schema and a DLL file which carries out the functions of the provider.</span></span> <span data-ttu-id="87fbe-111">例如，定義 Win32 提供者類別的 MOF 為 CIMWin32，而 DLL 是 CIMWin32.dll，這兩者都位於% windir% \\ System32 \\ Wbem 中。</span><span class="sxs-lookup"><span data-stu-id="87fbe-111">For example, the MOF that defines the classes of the Win32 provider is CIMWin32.mof and the DLL is CIMWin32.dll, both are found in %windir%\\System32\\Wbem.</span></span>

<span data-ttu-id="87fbe-112">提供者的 MOF 架構可能包含數種提供者類型。</span><span class="sxs-lookup"><span data-stu-id="87fbe-112">The MOF schema for the provider may contain several provider types.</span></span> <span data-ttu-id="87fbe-113">例如， [事件記錄提供者](/previous-versions/windows/desktop/eventlogprov/event-log-provider) 在名為 Ntevt 的一個 mof 檔案中有實例、方法和事件提供者類型。</span><span class="sxs-lookup"><span data-stu-id="87fbe-113">For example, the [Event Log Provider](/previous-versions/windows/desktop/eventlogprov/event-log-provider) has instance, method, and event provider types in one MOF file named Ntevt.mof.</span></span> <span data-ttu-id="87fbe-114">建議將相關提供者的所有類別和註冊架構組合在一個檔案中，而不是為每個類別建立一個檔案。</span><span class="sxs-lookup"><span data-stu-id="87fbe-114">It is recommended that all of the classes and registration schema for related providers be assembled in one file, rather than creating one file per class.</span></span>

<span data-ttu-id="87fbe-115">除了使用預先安裝的提供者之外，您還可以建立自己的提供者，以提供硬體裝置或軟體作業的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="87fbe-115">In addition to using preinstalled providers, you can create your own provider to supply information about a hardware device or the operations of software.</span></span>

<span data-ttu-id="87fbe-116">下表列出建立提供者的基本工作。</span><span class="sxs-lookup"><span data-stu-id="87fbe-116">The following table lists the basic tasks that create a provider.</span></span>



| <span data-ttu-id="87fbe-117">Task</span><span class="sxs-lookup"><span data-stu-id="87fbe-117">Task</span></span>                                                                                                                                                            | <span data-ttu-id="87fbe-118">Description</span><span class="sxs-lookup"><span data-stu-id="87fbe-118">Description</span></span>                                                                                                                                      |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="87fbe-119">設計受控物件格式 (MOF) 類別</span><span class="sxs-lookup"><span data-stu-id="87fbe-119">Designing Managed Object Format (MOF) Classes</span></span>](designing-managed-object-format--mof--classes.md)                                                              | <span data-ttu-id="87fbe-120">針對您想要透過 WMI 管理的實體開發模型，並建立受控物件格式 (MOF) 檔來描述架構。</span><span class="sxs-lookup"><span data-stu-id="87fbe-120">Develop a model for the entities you want to manage through WMI and create a Managed Object Format (MOF) file to describe the schema.</span></span><br/> |
| [<span data-ttu-id="87fbe-121">藉由撰寫提供者，將資料提供給 WMI</span><span class="sxs-lookup"><span data-stu-id="87fbe-121">Supplying Data to WMI by Writing a Provider</span></span>](supplying-data-to-wmi-by-writing-a-provider.md)                                                                  | <span data-ttu-id="87fbe-122">建立與 WMI 結合的最基本提供者。</span><span class="sxs-lookup"><span data-stu-id="87fbe-122">Create the most basic provider that is coupled to WMI.</span></span><br/>                                                                                |
| [<span data-ttu-id="87fbe-123">將提供者併入應用程式中</span><span class="sxs-lookup"><span data-stu-id="87fbe-123">Incorporating a Provider in an Application</span></span>](incorporating-a-provider-in-an-application.md)                                                                    | <span data-ttu-id="87fbe-124">將提供者包含在應用程式中的元件（如果沒有全部時間執行）。</span><span class="sxs-lookup"><span data-stu-id="87fbe-124">Include the provider as a component within an application if it does not run all of the time.</span></span><br/>                                         |
| [<span data-ttu-id="87fbe-125">註冊提供者</span><span class="sxs-lookup"><span data-stu-id="87fbe-125">Registering a Provider</span></span>](registering-a-provider.md)                                                                                                            | <span data-ttu-id="87fbe-126">向 COM 和 WMI 註冊提供者。</span><span class="sxs-lookup"><span data-stu-id="87fbe-126">Register the provider with COM and WMI.</span></span><br/>                                                                                               |
| [<span data-ttu-id="87fbe-127">初始化提供者</span><span class="sxs-lookup"><span data-stu-id="87fbe-127">Initializing a Provider</span></span>](initializing-a-provider.md)                                                                                                          | <span data-ttu-id="87fbe-128">執行 [**IWbemProviderInit**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemproviderinit) 和 [**IWbemProviderInitSink**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemproviderinitsink) 介面。</span><span class="sxs-lookup"><span data-stu-id="87fbe-128">Implement the [**IWbemProviderInit**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemproviderinit) and [**IWbemProviderInitSink**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemproviderinitsink) interfaces.</span></span><br/>   |
| [<span data-ttu-id="87fbe-129">對 WMI 進行呼叫</span><span class="sxs-lookup"><span data-stu-id="87fbe-129">Making Calls to WMI</span></span>](making-calls-to-wmi.md)                                                                                                                  | <span data-ttu-id="87fbe-130">從提供者呼叫 WMI 介面。</span><span class="sxs-lookup"><span data-stu-id="87fbe-130">Call WMI interfaces from a provider.</span></span><br/>                                                                                                  |
| [<span data-ttu-id="87fbe-131">模擬用戶端</span><span class="sxs-lookup"><span data-stu-id="87fbe-131">Impersonating a Client</span></span>](impersonating-a-client.md)                                                                                                            | <span data-ttu-id="87fbe-132">設定安全性以存取用戶端應用程式。</span><span class="sxs-lookup"><span data-stu-id="87fbe-132">Set security to access a client application.</span></span><br/>                                                                                          |
| [<span data-ttu-id="87fbe-133">更新提供者</span><span class="sxs-lookup"><span data-stu-id="87fbe-133">Updating a Provider</span></span>](updating-a-provider.md)                                                                                                                  | <span data-ttu-id="87fbe-134">視需要改善提供者。</span><span class="sxs-lookup"><span data-stu-id="87fbe-134">Improve the provider as needed.</span></span><br/>                                                                                                       |
| [<span data-ttu-id="87fbe-135">卸載提供者</span><span class="sxs-lookup"><span data-stu-id="87fbe-135">Unloading a Provider</span></span>](unloading-a-provider.md)                                                                                                                | <span data-ttu-id="87fbe-136">在關機期間或提供者閒置時，從記憶體中移除提供者。</span><span class="sxs-lookup"><span data-stu-id="87fbe-136">Remove the provider from memory during shutdown or when the provider is idle.</span></span><br/>                                                         |
| <span data-ttu-id="87fbe-137">偵測[提供者](debugging-providers.md)和[提供者設定和疑難排解類別](provider-configuration-and-troubleshooting-classes.md)</span><span class="sxs-lookup"><span data-stu-id="87fbe-137">[Debugging Providers](debugging-providers.md) and [Provider Configuration and Troubleshooting Classes](provider-configuration-and-troubleshooting-classes.md)</span></span> | <span data-ttu-id="87fbe-138">使用 WMI 提供的功能來對提供者進行 Debug 錯。</span><span class="sxs-lookup"><span data-stu-id="87fbe-138">Debug your provider using facilities supplied by WMI.</span></span><br/>                                                                                 |
| [<span data-ttu-id="87fbe-139">在64位電腦上取得和提供資料</span><span class="sxs-lookup"><span data-stu-id="87fbe-139">Getting and Providing Data on a 64-bit Computer</span></span>](getting-and-providing-data-on-a-64-bit-computer.md)                                                          | <span data-ttu-id="87fbe-140">評估您是否需要32位的應用程式相容性提供者，或如果64位提供者可提供資料給這兩個用戶端。</span><span class="sxs-lookup"><span data-stu-id="87fbe-140">Evaluate whether you need a 32-bit application compatibility provider or if the 64-bit provider can supply data to both clients.</span></span><br/>      |



 

<span data-ttu-id="87fbe-141">下列主題討論撰寫不同類型的提供者所需的步驟：</span><span class="sxs-lookup"><span data-stu-id="87fbe-141">The following topics discuss the steps needed to write different types of providers:</span></span>

-   [<span data-ttu-id="87fbe-142">撰寫執行個體提供者</span><span class="sxs-lookup"><span data-stu-id="87fbe-142">Writing an Instance Provider</span></span>](writing-an-instance-provider.md)
-   [<span data-ttu-id="87fbe-143">撰寫方法提供者</span><span class="sxs-lookup"><span data-stu-id="87fbe-143">Writing a Method Provider</span></span>](writing-a-method-provider.md)
-   [<span data-ttu-id="87fbe-144">撰寫事件提供者</span><span class="sxs-lookup"><span data-stu-id="87fbe-144">Writing an Event Provider</span></span>](writing-an-event-provider.md)
-   [<span data-ttu-id="87fbe-145">撰寫事件取用者提供者</span><span class="sxs-lookup"><span data-stu-id="87fbe-145">Writing an Event Consumer Provider</span></span>](writing-an-event-consumer-provider.md)
-   [<span data-ttu-id="87fbe-146">撰寫類別提供者</span><span class="sxs-lookup"><span data-stu-id="87fbe-146">Writing a Class Provider</span></span>](writing-a-class-provider.md)
-   [<span data-ttu-id="87fbe-147">撰寫屬性提供者</span><span class="sxs-lookup"><span data-stu-id="87fbe-147">Writing a Property Provider</span></span>](writing-a-property-provider.md)
-   [<span data-ttu-id="87fbe-148">讓執行個體提供者成為 High-Performance 提供者</span><span class="sxs-lookup"><span data-stu-id="87fbe-148">Making an Instance Provider into a High-Performance Provider</span></span>](making-an-instance-provider-into-a-high-performance-provider.md)

 

