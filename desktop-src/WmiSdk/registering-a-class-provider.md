---
description: 若要建立 WMI 類別提供者，您必須 \_ \_ 使用 ClassProviderRegistration 的實例，註冊代表提供者的 Win32Provider 實例 \_ \_ 。
ms.assetid: ed834969-47e9-47df-9db8-c805b2eb71da
ms.tgt_platform: multiple
title: 註冊類別提供者
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7bc15893e654f96f8c4e476219389a1f8f2c464a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "103943827"
---
# <a name="registering-a-class-provider"></a><span data-ttu-id="ab6e2-103">註冊類別提供者</span><span class="sxs-lookup"><span data-stu-id="ab6e2-103">Registering a Class Provider</span></span>

<span data-ttu-id="ab6e2-104">若要建立 WMI 類別提供者，您必須使用 [**\_ \_ ClassProviderRegistration**](--classproviderregistration.md)的實例，註冊代表提供者的 [**\_ \_ Win32Provider**](--win32provider.md)實例。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-104">To create a WMI class provider you must register the [**\_\_Win32Provider**](--win32provider.md) instance that represents your provider using an instance of [**\_\_ClassProviderRegistration**](--classproviderregistration.md).</span></span> <span data-ttu-id="ab6e2-105">如果您是 COM 物件，則您的提供者必須向作業系統和 WMI 註冊。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-105">As a COM object, your provider must register with the operating system and WMI.</span></span> <span data-ttu-id="ab6e2-106">下列程式假設您已依照 [註冊提供者](registering-a-provider.md)中所述的方式來執行註冊程式。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-106">The following procedure assumes that you have already implemented the registration process as described in [Registering a Provider](registering-a-provider.md).</span></span> <span data-ttu-id="ab6e2-107">如果您的提供者將大部分資料儲存在 WMI 存放庫中，而且資料只會在 WMI 初始化時更新，請將您的類別註冊為 push 類別提供者。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-107">If your provider stores most data in the WMI repository and that data is updated only on WMI initialization, then register your class as a push class provider.</span></span> <span data-ttu-id="ab6e2-108">如果您所提供的資料經常變更，而且您的程式碼會在每個 WMI 要求時動態抓取，請將您的提供者註冊為提取類別提供者。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-108">If the data you are providing changes frequently and is retrieved dynamically by your code on every request from WMI, then register your provider as a pull class provider.</span></span>

<span data-ttu-id="ab6e2-109">下列程式說明如何註冊推播類別提供者。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-109">The following procedure describes how to register a push class provider.</span></span>

<span data-ttu-id="ab6e2-110">**註冊推播類別提供者**</span><span class="sxs-lookup"><span data-stu-id="ab6e2-110">**To register a push class provider**</span></span>

-   <span data-ttu-id="ab6e2-111">將 [**\_ \_ ClassProviderRegistration**](--classproviderregistration.md)實例的 **InteractionType** 屬性設定為1。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-111">Set the **InteractionType** property of the [**\_\_ClassProviderRegistration**](--classproviderregistration.md) instance to 1.</span></span>

    <span data-ttu-id="ab6e2-112">建立 [**\_ \_ ClassProviderRegistration**](--classproviderregistration.md)的實例是註冊程式的一部分。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-112">Creating an instance of [**\_\_ClassProviderRegistration**](--classproviderregistration.md) is part of the registration process.</span></span>

<span data-ttu-id="ab6e2-113">下列程式說明如何註冊提取類別提供者。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-113">The following procedure describes how to register a pull class provider.</span></span>

<span data-ttu-id="ab6e2-114">**註冊提取類別提供者**</span><span class="sxs-lookup"><span data-stu-id="ab6e2-114">**To register a pull class provider**</span></span>

1.  <span data-ttu-id="ab6e2-115">建立描述提供者之 [**\_ \_ Win32Provider**](--win32provider.md)類別的實例。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-115">Create an instance of the [**\_\_Win32Provider**](--win32provider.md) class that describes the provider.</span></span>
2.  <span data-ttu-id="ab6e2-116">建立 [**\_ \_ ClassProviderRegistration**](--classproviderregistration.md)類別的實例，以描述提供者的功能集。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-116">Create an instance of the [**\_\_ClassProviderRegistration**](--classproviderregistration.md) class that describes the feature set of the provider.</span></span>

    <span data-ttu-id="ab6e2-117">在 [**\_ \_ ClassProviderRegistration**](--classproviderregistration.md)實例中：</span><span class="sxs-lookup"><span data-stu-id="ab6e2-117">Within the [**\_\_ClassProviderRegistration**](--classproviderregistration.md) instance:</span></span>

    1.  <span data-ttu-id="ab6e2-118">設定 **InteractionType** 屬性，指出提供者是否為 push 或 pull 提供者。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-118">Set the **InteractionType** property to indicate whether the provider is a push or pull provider.</span></span>
    2.  <span data-ttu-id="ab6e2-119">以 [**動態**](standard-wmi-qualifiers.md) 和 [**提供者**](/windows/desktop/api/Provider/nl-provider-provider) 辨識符號標記類別。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-119">Tag the class with both the [**Dynamic**](standard-wmi-qualifiers.md) and [**Provider**](/windows/desktop/api/Provider/nl-provider-provider) qualifiers.</span></span>

        <span data-ttu-id="ab6e2-120">[**動態**](standard-wmi-qualifiers.md)限定詞表示 WMI 應該使用提供者來取出類別實例。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-120">The [**Dynamic**](standard-wmi-qualifiers.md) qualifier signals that WMI should use a provider to retrieve the class instances.</span></span> <span data-ttu-id="ab6e2-121">[**提供者**](/windows/desktop/api/Provider/nl-provider-provider)辨識符號會指定 WMI 應使用的提供者名稱。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-121">The [**Provider**](/windows/desktop/api/Provider/nl-provider-provider) qualifier specifies the name of the provider that WMI should use.</span></span>

    3.  <span data-ttu-id="ab6e2-122">定義 **ResultSetQueries**、 **ReferencedSetQueries** 和 **UnsupportedQueries** 屬性。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-122">Define the **ResultSetQueries**, **ReferencedSetQueries**, and **UnsupportedQueries** properties.</span></span>

        <span data-ttu-id="ab6e2-123">這些查詢屬性會描述有關支援類別的詳細資訊。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-123">These query properties describe detailed information about the supported class.</span></span>

<span data-ttu-id="ab6e2-124">除了描述類別的各種支援方法之外， [**\_ \_ ClassProviderRegistration**](--classproviderregistration.md)類別也有三個描述一系列查詢的屬性。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-124">In addition to describing the various supported methods of a class, the [**\_\_ClassProviderRegistration**](--classproviderregistration.md) class also has three properties that describe a series of queries.</span></span> <span data-ttu-id="ab6e2-125">搭配使用時，這三個屬性會描述類別提供者所提供的整個類別範圍。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-125">When used together, these three properties describe the entire range of classes supplied by the class provider.</span></span> <span data-ttu-id="ab6e2-126">每個查詢屬性都包含 WQL SELECT 語句（稱為「架構查詢」）來指定支援類別的類型。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-126">Each query property contains a WQL SELECT statement, called a "schema query," to specify the types of supported classes.</span></span> <span data-ttu-id="ab6e2-127">架構查詢會指定稱為中繼類別的特殊類別名稱 \_ 。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-127">Schema queries specify a special class name called meta\_class.</span></span> <span data-ttu-id="ab6e2-128">下表列出查詢屬性。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-128">The following table lists the query properties.</span></span>



| <span data-ttu-id="ab6e2-129">屬性</span><span class="sxs-lookup"><span data-stu-id="ab6e2-129">Property</span></span>                 | <span data-ttu-id="ab6e2-130">描述</span><span class="sxs-lookup"><span data-stu-id="ab6e2-130">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|--------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="ab6e2-131">**ResultSetQueries**</span><span class="sxs-lookup"><span data-stu-id="ab6e2-131">**ResultSetQueries**</span></span>     | <span data-ttu-id="ab6e2-132">包含提供者所提供之結果集的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-132">Contains information about the result set the provider supplies.</span></span> <span data-ttu-id="ab6e2-133">WMI 會使用此資訊來判斷是否要叫用提供者來滿足應用程式的查詢。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-133">WMI uses the information to determine whether to invoke the provider to satisfy a query from an application.</span></span> <span data-ttu-id="ab6e2-134">這個屬性描述提供者可以提供的所有類別集合，或是可用類別的超集合，但絕對不能是子集。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-134">This property describes either the set of all classes that the provider can supply or a superset of the available classes, but never a subset.</span></span> <span data-ttu-id="ab6e2-135">WMI 需要提供者在這個屬性中指定至少一個查詢。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-135">WMI requires a provider to specify at least one query in this property.</span></span><br/> <span data-ttu-id="ab6e2-136">下列範例顯示如何在提供者提供參考 [**Win32 \_ LogicalDisk**](/windows/desktop/CIMWin32Prov/win32-logicaldisk)類別的關聯類別時設定 **ResultSetQueries** 。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-136">The following example shows how to set **ResultSetQueries** when a provider supplies an association class that references the [**Win32\_LogicalDisk**](/windows/desktop/CIMWin32Prov/win32-logicaldisk) class.</span></span><br/> `SELECT * FROM meta_class WHERE __Class = "Win32_LogicalDisk"`<br/> <span data-ttu-id="ab6e2-137">下列範例顯示如何在提供者提供參考其他未知類別的類別時，指定一般查詢。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-137">The following example shows how to specify a general query when a provider supplies classes that reference other unknown classes.</span></span><br/> `SELECT * FROM meta_class`<br/> <span data-ttu-id="ab6e2-138">下列範例示範當提供者僅提供子類別，而不是指定類別的父類別時，如何設定 **ResultSetQueries** 。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-138">The following example shows how to set **ResultSetQueries** when a provider supplies only subclasses, but not the parent class of a given class.</span></span><br/> `SELECT * FROM meta_class WHERE __Dynasty = "MyClass"`<br/> <span data-ttu-id="ab6e2-139">下列範例示範如何使用這個屬性的特殊 \_ \_ 屬性，並在提供者提供所有類別和子類別時設定 **ResultSetQueries** 。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-139">The following example shows how to use the special \_\_this property and set **ResultSetQueries** when a provider supplies all class and subclasses.</span></span><br/> `SELECT * FROM meta_class WHERE __this ISA "MyClass"`<br/> |
| <span data-ttu-id="ab6e2-140">**ReferencedSetQueries**</span><span class="sxs-lookup"><span data-stu-id="ab6e2-140">**ReferencedSetQueries**</span></span> | <span data-ttu-id="ab6e2-141">決定是否要在要求關聯和參考的架構查詢中略過提供者。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-141">Determines whether to bypass the provider in schema queries where associations and references are being requested.</span></span> <span data-ttu-id="ab6e2-142">可以提供關聯類別的提供者，在其 **ReferencedSetQueries** 屬性中必須至少包含一個查詢。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-142">Providers that can supply association classes must include at least one query in their **ReferencedSetQueries** property.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| <span data-ttu-id="ab6e2-143">**UnsupportedQueries**</span><span class="sxs-lookup"><span data-stu-id="ab6e2-143">**UnsupportedQueries**</span></span>   | <span data-ttu-id="ab6e2-144">包含類別提供者未提供之結果集的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-144">Contains information about the result set that a class provider does not supply.</span></span> <span data-ttu-id="ab6e2-145">WMI 會使用這個屬性來減去 **ResultSetQueries** 所隱含的一組類別。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-145">WMI uses this property to subtract from the set of classes implied by **ResultSetQueries**.</span></span> <span data-ttu-id="ab6e2-146">例如，類別提供者可以針對所有衍生自 MyClass 的類別指定 **ResultSetQueries** 支援，並在 **UnsupportedQueries** 中指定不支援一個特定的衍生類別。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-146">For example, a class provider can specify in **ResultSetQueries** support for all classes derived from MyClass and specify in **UnsupportedQueries** a lack of support for one particular derived class.</span></span><br/> <span data-ttu-id="ab6e2-147">提供者可註冊其查詢處理功能的詳細資訊，其執行速度愈快。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-147">The more information that a provider can register about its query processing capabilities, the faster it runs.</span></span> <span data-ttu-id="ab6e2-148">在 **UnsupportedQueries** 屬性中輸入一或多個查詢是一種特定的方法，當提供者依賴其未提供的類別時，這一點特別重要。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-148">Entering one or more queries in the **UnsupportedQueries** property is one way to be specific and is particularly important when a provider relies on a class that it does not supply.</span></span> <span data-ttu-id="ab6e2-149">當針對 **UnsupportedQueries** 屬性中的查詢所列的類別提出要求時，WMI 可以提供類別本身，或叫用替代提供者來提供它。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-149">When a request is made for a class that is listed in a query in the **UnsupportedQueries** property, WMI can supply the class itself or invoke an alternate provider to supply it.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                             |



 

<span data-ttu-id="ab6e2-150">因為 WMI 不支援或子句，所以您必須為每個類別建立個別的查詢。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-150">Because WMI does not support the OR clause, you must create a separate query for each class.</span></span>

<span data-ttu-id="ab6e2-151">當類別提供者提供 MyClass1、MyClass2 和 MyClass3 時，會在 **ResultSetQueries** 中指定下列查詢。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-151">The following queries are specified in **ResultSetQueries** when a class provider supplies MyClass1, MyClass2, and MyClass3.</span></span>


```sql
SELECT * FROM meta_class WHERE __Class = "MyClass1"
SELECT * FROM meta_class WHERE __Class = "MyClass2"
SELECT * FROM meta_class WHERE __Class = "MyClass3"
```



<span data-ttu-id="ab6e2-152">只有系統管理員可以藉由建立 [**\_ \_ Win32Provider**](--win32provider.md)和 [**\_ \_ ClassProviderRegistration**](--classproviderregistration.md)的實例來註冊或刪除提供者。</span><span class="sxs-lookup"><span data-stu-id="ab6e2-152">Only administrators can register or delete a provider by creating an instance of [**\_\_Win32Provider**](--win32provider.md) and [**\_\_ClassProviderRegistration**](--classproviderregistration.md).</span></span>

 

