---
description: 呼叫 WMI 介面的用戶端應用程式可以控制其進程的安全性層級。
ms.assetid: 790b4e40-9b92-464a-a774-dec0b75cedee
ms.tgt_platform: multiple
title: 設定用戶端應用程式處理安全性
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8bfa0a42390ffa433cff01300b0976d40553665c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "104193633"
---
# <a name="setting-client-application-process-security"></a><span data-ttu-id="d8d9d-103">設定用戶端應用程式處理安全性</span><span class="sxs-lookup"><span data-stu-id="d8d9d-103">Setting Client Application Process Security</span></span>

<span data-ttu-id="d8d9d-104">呼叫 WMI 介面的用戶端應用程式可以控制其進程的安全性層級。</span><span class="sxs-lookup"><span data-stu-id="d8d9d-104">Client applications that call WMI interfaces can control the security levels of their processes.</span></span> <span data-ttu-id="d8d9d-105">所有 WMI 應用程式都會透過 COM 存取 WMI，而您可以呼叫 COM 函式 [**CoInitializeSecurity**](/windows/win32/api/combaseapi/nf-combaseapi-coinitializesecurity) 來設定處理常式的安全性。</span><span class="sxs-lookup"><span data-stu-id="d8d9d-105">All WMI applications access WMI through COM, and you can call the COM function [**CoInitializeSecurity**](/windows/win32/api/combaseapi/nf-combaseapi-coinitializesecurity) to set security for your processes.</span></span> <span data-ttu-id="d8d9d-106">對 WMI 進行非同步呼叫的應用程式，以及註冊為事件取用者的應用程式，會將呼叫的安全性層級設定為 WMI。</span><span class="sxs-lookup"><span data-stu-id="d8d9d-106">Applications that make asynchronous calls to WMI and applications that register as event consumers set security levels on the call into WMI.</span></span>

<span data-ttu-id="d8d9d-107">如果您沒有明確呼叫 [**CoInitializeSecurity**](/windows/win32/api/combaseapi/nf-combaseapi-coinitializesecurity)，COM 會以隱含方式呼叫登錄中的值。</span><span class="sxs-lookup"><span data-stu-id="d8d9d-107">If you do not make an explicit call to [**CoInitializeSecurity**](/windows/win32/api/combaseapi/nf-combaseapi-coinitializesecurity), COM calls it implicitly with values from the registry.</span></span> <span data-ttu-id="d8d9d-108">但是，登錄值可能會有較低的模擬和驗證設定，而不會提供 WMI 所需的安全性。</span><span class="sxs-lookup"><span data-stu-id="d8d9d-108">However, the registry values may have lower settings for impersonation and authentication that do not provide the security required for WMI.</span></span> <span data-ttu-id="d8d9d-109">如需詳細資訊，請參閱 [使用 c + + 設定預設進程安全性層級](setting-the-default-process-security-level-using-c-.md)。</span><span class="sxs-lookup"><span data-stu-id="d8d9d-109">For more information, see [Setting the Default Process Security Level Using C++](setting-the-default-process-security-level-using-c-.md).</span></span>

<span data-ttu-id="d8d9d-110">不建議對 WMI 進行非同步存取。</span><span class="sxs-lookup"><span data-stu-id="d8d9d-110">Asynchronous access to WMI is not recommended.</span></span> <span data-ttu-id="d8d9d-111">非同步回呼可讓未經驗證的使用者提供資料給接收。</span><span class="sxs-lookup"><span data-stu-id="d8d9d-111">An asynchronous callback allows a non-authenticated user to provide data to the sink.</span></span> <span data-ttu-id="d8d9d-112">這會對您的腳本和應用程式帶來安全性風險。</span><span class="sxs-lookup"><span data-stu-id="d8d9d-112">This poses security risks to your scripts and applications.</span></span> <span data-ttu-id="d8d9d-113">若要消除風險，請使用最半同步或同步通訊，或在用戶端應用程式中執行適當的存取檢查。</span><span class="sxs-lookup"><span data-stu-id="d8d9d-113">To eliminate the risks, use semisynchronous or synchronous communication, or perform proper access checks in your client application.</span></span> <span data-ttu-id="d8d9d-114">如需詳細資訊，請參閱 [呼叫方法](calling-a-method.md)。</span><span class="sxs-lookup"><span data-stu-id="d8d9d-114">For more information, see [Calling a Method](calling-a-method.md).</span></span>

<span data-ttu-id="d8d9d-115">對任何 WMI proxy 的呼叫 ([**IWbemServices**](/windows/desktop/api/WbemCli/nn-wbemcli-iwbemservices)、 [**IEnumWbemClassObject**](/windows/desktop/api/Wbemcli/nn-wbemcli-ienumwbemclassobject)、[**IWbemCallResult**](/windows/desktop/api/Wbemcli/nn-wbemcli-iwbemcallresult)或 [**IWbemRefresher**](/windows/desktop/api/Wbemcli/nn-wbemcli-iwbemrefresher)) 使用跨進程指標。</span><span class="sxs-lookup"><span data-stu-id="d8d9d-115">Calls to any of the WMI proxies ([**IWbemServices**](/windows/desktop/api/WbemCli/nn-wbemcli-iwbemservices), [**IEnumWbemClassObject**](/windows/desktop/api/Wbemcli/nn-wbemcli-ienumwbemclassobject),[**IWbemCallResult**](/windows/desktop/api/Wbemcli/nn-wbemcli-iwbemcallresult), or [**IWbemRefresher**](/windows/desktop/api/Wbemcli/nn-wbemcli-iwbemrefresher)) use an out-of-process pointer.</span></span> <span data-ttu-id="d8d9d-116">如需預設值和建議的詳細資訊，請參閱 [設定 IWbemServices 和其他 proxy 的安全性](setting-the-security-on-iwbemservices-and-other-proxies.md)。</span><span class="sxs-lookup"><span data-stu-id="d8d9d-116">For more information about the defaults and recommendations, see [Setting the Security on IWbemServices and Other Proxies](setting-the-security-on-iwbemservices-and-other-proxies.md).</span></span>

<span data-ttu-id="d8d9d-117">下列程式說明在應用程式處理常式上設定 WMI 安全性時必須執行的步驟。</span><span class="sxs-lookup"><span data-stu-id="d8d9d-117">The following procedure describes the steps you must perform to set the security for WMI on your application process.</span></span>

<span data-ttu-id="d8d9d-118">**若要設定應用程式進程上的 WMI 安全性**</span><span class="sxs-lookup"><span data-stu-id="d8d9d-118">**To set security for WMI on your application process**</span></span>

1.  <span data-ttu-id="d8d9d-119">判斷用戶端應用程式執行所在的 Windows 作業系統所需的安全性層級。</span><span class="sxs-lookup"><span data-stu-id="d8d9d-119">Determine the security levels required for the Windows operating systems on which your client application runs.</span></span>
2.  <span data-ttu-id="d8d9d-120">呼叫 COM [**CoInitializeSecurity**](/windows/win32/api/combaseapi/nf-combaseapi-coinitializesecurity) 函式，以設定用戶端應用程式執行所在之進程的預設安全性。</span><span class="sxs-lookup"><span data-stu-id="d8d9d-120">Call the COM [**CoInitializeSecurity**](/windows/win32/api/combaseapi/nf-combaseapi-coinitializesecurity) function to set the default security for the process in which the client application runs.</span></span> <span data-ttu-id="d8d9d-121">這會宣告其他應用程式在應用程式執行時需要多少安全性。</span><span class="sxs-lookup"><span data-stu-id="d8d9d-121">This declares how much security other applications require to access the process in which your application runs.</span></span>
3.  <span data-ttu-id="d8d9d-122">如果您需要變更個別 proxy 的安全性（例如，在另一次呼叫 [**IWbemServices**](/windows/desktop/api/WbemCli/nn-wbemcli-iwbemservices)時），請呼叫 [**CoSetProxyBlanket**](/windows/win32/api/combaseapi/nf-combaseapi-cosetproxyblanket)。</span><span class="sxs-lookup"><span data-stu-id="d8d9d-122">If you need to change the security on an individual proxy, for example on another call to [**IWbemServices**](/windows/desktop/api/WbemCli/nn-wbemcli-iwbemservices), call [**CoSetProxyBlanket**](/windows/win32/api/combaseapi/nf-combaseapi-cosetproxyblanket).</span></span>
4.  <span data-ttu-id="d8d9d-123">如果您需要控制遠端硬體或需要更多許可權的系統物件，請使用 [**AdjustTokenPrivileges**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-adjusttokenprivileges) 函式來啟用必要的許可權。</span><span class="sxs-lookup"><span data-stu-id="d8d9d-123">If you need to control remote hardware or a system object that requires more privilege, use the [**AdjustTokenPrivileges**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-adjusttokenprivileges) function to enable the necessary privileges.</span></span> <span data-ttu-id="d8d9d-124">請注意，您無法啟用尚未指派處理常式的許可權。</span><span class="sxs-lookup"><span data-stu-id="d8d9d-124">Note that you cannot enable a privilege that the process does not already have assigned to it.</span></span> <span data-ttu-id="d8d9d-125">如需詳細資訊，請參閱 [檢查私用物件的存取權](/windows/desktop/SecAuthZ/checking-access-to-private-objects)。</span><span class="sxs-lookup"><span data-stu-id="d8d9d-125">For more information, see [Checking Access to Private Objects](/windows/desktop/SecAuthZ/checking-access-to-private-objects).</span></span>

<span data-ttu-id="d8d9d-126">如需設定預設進程安全性等級的詳細資訊，請參閱使用 [c + + 設定預設進程安全性等級](setting-the-default-process-security-level-using-c-.md) 和 [使用 VBScript 設定預設進程安全性層](setting-the-default-process-security-level-using-vbscript.md)級。</span><span class="sxs-lookup"><span data-stu-id="d8d9d-126">For further information about setting the default process security level, see [Setting the Default Process Security Level Using C++](setting-the-default-process-security-level-using-c-.md) and [Setting the Default Process Security Level Using VBScript](setting-the-default-process-security-level-using-vbscript.md).</span></span>

 

 
