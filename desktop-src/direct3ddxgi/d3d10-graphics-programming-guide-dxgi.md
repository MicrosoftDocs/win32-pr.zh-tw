---
description: 本主題包含下列各節。
ms.assetid: 0522ccbf-e754-470a-8199-004fcbaa927d
title: DXGI 總覽
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 324a5be26aade17385a6ab0b7d347015497a2a3f
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/06/2021
ms.locfileid: "104467533"
---
# <a name="dxgi-overview"></a><span data-ttu-id="5d3a6-103">DXGI 總覽</span><span class="sxs-lookup"><span data-stu-id="5d3a6-103">DXGI overview</span></span>

<span data-ttu-id="5d3a6-104">Microsoft DirectX Graphic Infrastructure (DXGI) 可辨識圖形的某些部分會比其他部分慢得多。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-104">Microsoft DirectX Graphics Infrastructure (DXGI) recognizes that some parts of graphics evolve more slowly than others.</span></span> <span data-ttu-id="5d3a6-105">DXGI 的主要目標是管理可獨立于 DirectX graphics runtime 的低層級工作。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-105">The primary goal of DXGI is to manage low-level tasks that can be independent of the DirectX graphics runtime.</span></span> <span data-ttu-id="5d3a6-106">DXGI 提供適用于未來圖形元件的通用架構;利用 DXGI 的第一個元件是 Microsoft Direct3D 10。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-106">DXGI provides a common framework for future graphics components; the first component that takes advantage of DXGI is Microsoft Direct3D 10.</span></span>

<span data-ttu-id="5d3a6-107">在舊版的 Direct3D 中，像是硬體裝置的列舉、將轉譯的畫面格呈現至輸出、控制 gamma，以及管理全螢幕轉換等低層級工作，都包含在 Direct3D 執行時間中。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-107">In previous versions of Direct3D, low-level tasks like enumeration of hardware devices, presenting rendered frames to an output, controlling gamma, and managing a full-screen transition were included in the Direct3D runtime.</span></span> <span data-ttu-id="5d3a6-108">這些工作現在會在 DXGI 中執行。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-108">These tasks are now implemented in DXGI.</span></span>

<span data-ttu-id="5d3a6-109">DXGI 的用途是與核心模式驅動程式和系統硬體通訊，如下圖所示。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-109">DXGI's purpose is to communicate with the kernel mode driver and the system hardware, as shown in the following diagram.</span></span>

![應用程式、dxgi 和驅動程式和硬體之間的通訊圖表](images/dxgi-dll.png)

<span data-ttu-id="5d3a6-111">應用程式可以直接存取 DXGI，或呼叫 D3D11 \_ 1. h、D3D11 .h、D3D10 1 .h 或 D3D10 中的 Direct3D api， \_ 這會為您處理 DXGI 的通訊。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-111">An application can access DXGI directly, or call the Direct3D APIs in D3D11\_1.h, D3D11.h, D3D10\_1.h, or D3D10.h, which handles the communications with DXGI for you.</span></span> <span data-ttu-id="5d3a6-112">如果您的應用程式需要列舉裝置，或控制資料呈現給輸出的方式，您可能會想要直接使用 DXGI。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-112">You may want to work with DXGI directly if your application needs to enumerate devices or control how data is presented to an output.</span></span>

<span data-ttu-id="5d3a6-113">本主題包含下列各節。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-113">This topic contains the following sections.</span></span>

-   [<span data-ttu-id="5d3a6-114">列舉介面卡</span><span class="sxs-lookup"><span data-stu-id="5d3a6-114">Enumerating Adapters</span></span>](#enumerating-adapters)
    -   [<span data-ttu-id="5d3a6-115">列舉 Windows 8 的介面卡的新資訊</span><span class="sxs-lookup"><span data-stu-id="5d3a6-115">New info about enumerating adapters for Windows 8</span></span>](#new-info-about-enumerating-adapters-for-windows-8)
-   [<span data-ttu-id="5d3a6-116">展示</span><span class="sxs-lookup"><span data-stu-id="5d3a6-116">Presentation</span></span>](#presentation)
    -   [<span data-ttu-id="5d3a6-117">建立交換鏈</span><span class="sxs-lookup"><span data-stu-id="5d3a6-117">Create a Swap Chain</span></span>](#create-a-swap-chain)
    -   [<span data-ttu-id="5d3a6-118">交換鏈的護理和饋送</span><span class="sxs-lookup"><span data-stu-id="5d3a6-118">Care and Feeding of the Swap Chain</span></span>](#care-and-feeding-of-the-swap-chain)
    -   [<span data-ttu-id="5d3a6-119">處理視窗調整大小</span><span class="sxs-lookup"><span data-stu-id="5d3a6-119">Handling Window Resizing</span></span>](#handling-window-resizing)
    -   [<span data-ttu-id="5d3a6-120">選擇 DXGI 輸出和大小</span><span class="sxs-lookup"><span data-stu-id="5d3a6-120">Choosing the DXGI Output and Size</span></span>](#choosing-the-dxgi-output-and-size)
    -   [<span data-ttu-id="5d3a6-121">在 Full-Screen 模式中進行調試</span><span class="sxs-lookup"><span data-stu-id="5d3a6-121">Debugging in Full-Screen Mode</span></span>](#debugging-in-full-screen-mode)
    -   [<span data-ttu-id="5d3a6-122">終結交換鏈</span><span class="sxs-lookup"><span data-stu-id="5d3a6-122">Destroying a Swap Chain</span></span>](#destroying-a-swap-chain)
    -   [<span data-ttu-id="5d3a6-123">使用旋轉的監視器</span><span class="sxs-lookup"><span data-stu-id="5d3a6-123">Using a Rotated Monitor</span></span>](#using-a-rotated-monitor)
    -   [<span data-ttu-id="5d3a6-124">切換模式</span><span class="sxs-lookup"><span data-stu-id="5d3a6-124">Switching Modes</span></span>](#switching-modes)
    -   [<span data-ttu-id="5d3a6-125">全螢幕的效能秘訣</span><span class="sxs-lookup"><span data-stu-id="5d3a6-125">Full-Screen Performance Tip</span></span>](#full-screen-performance-tip)
    -   [<span data-ttu-id="5d3a6-126">多執行緒考慮</span><span class="sxs-lookup"><span data-stu-id="5d3a6-126">Multithread Considerations</span></span>](#multithread-considerations)
-   [<span data-ttu-id="5d3a6-127">DLLMain 的 DXGI 回應</span><span class="sxs-lookup"><span data-stu-id="5d3a6-127">DXGI Responses from DLLMain</span></span>](#dxgi-responses-from-dllmain)
-   [<span data-ttu-id="5d3a6-128">DXGI 1.1 變更</span><span class="sxs-lookup"><span data-stu-id="5d3a6-128">DXGI 1.1 Changes</span></span>](#dxgi-11-changes)
-   [<span data-ttu-id="5d3a6-129">DXGI 1.2 變更</span><span class="sxs-lookup"><span data-stu-id="5d3a6-129">DXGI 1.2 Changes</span></span>](#dxgi-12-changes)
-   [<span data-ttu-id="5d3a6-130">相關主題</span><span class="sxs-lookup"><span data-stu-id="5d3a6-130">Related topics</span></span>](#related-topics)

<span data-ttu-id="5d3a6-131">若要查看 Direct3D 11 硬體支援的格式：</span><span class="sxs-lookup"><span data-stu-id="5d3a6-131">To see which formats are supported by Direct3D 11 hardware:</span></span>

-   [<span data-ttu-id="5d3a6-132">Direct3D 功能等級12.1 硬體的 DXGI 格式支援</span><span class="sxs-lookup"><span data-stu-id="5d3a6-132">DXGI Format Support for Direct3D Feature Level 12.1 Hardware</span></span>](hardware-support-for-direct3d-12-1-formats.md)
-   [<span data-ttu-id="5d3a6-133">Direct3D 功能等級12.0 硬體的 DXGI 格式支援</span><span class="sxs-lookup"><span data-stu-id="5d3a6-133">DXGI Format Support for Direct3D Feature Level 12.0 Hardware</span></span>](hardware-support-for-direct3d-12-0-formats.md)
-   [<span data-ttu-id="5d3a6-134">Direct3D 功能等級11.1 硬體的 DXGI 格式支援</span><span class="sxs-lookup"><span data-stu-id="5d3a6-134">DXGI Format Support for Direct3D Feature Level 11.1 Hardware</span></span>](format-support-for-direct3d-11-1-feature-level-hardware.md)
-   [<span data-ttu-id="5d3a6-135">Direct3D 功能等級11.0 硬體的 DXGI 格式支援</span><span class="sxs-lookup"><span data-stu-id="5d3a6-135">DXGI Format Support for Direct3D Feature Level 11.0 Hardware</span></span>](format-support-for-direct3d-11-0-feature-level-hardware.md)
-   <span data-ttu-id="5d3a6-136">[Direct3D 10Level9 格式的硬體支援](/previous-versions//ff471324(v=vs.85))</span><span class="sxs-lookup"><span data-stu-id="5d3a6-136">[Hardware Support for Direct3D 10Level9 Formats](/previous-versions//ff471324(v=vs.85))</span></span>
-   <span data-ttu-id="5d3a6-137">[Direct3D 10.1 格式的硬體支援](/previous-versions//cc627091(v=vs.85))</span><span class="sxs-lookup"><span data-stu-id="5d3a6-137">[Hardware Support for Direct3D 10.1 Formats](/previous-versions//cc627091(v=vs.85))</span></span>
-   <span data-ttu-id="5d3a6-138">[適用于 Direct3D 10 格式的硬體支援](/previous-versions//cc627090(v=vs.85))</span><span class="sxs-lookup"><span data-stu-id="5d3a6-138">[Hardware Support for Direct3D 10 Formats](/previous-versions//cc627090(v=vs.85))</span></span>

## <a name="enumerating-adapters"></a><span data-ttu-id="5d3a6-139">列舉介面卡</span><span class="sxs-lookup"><span data-stu-id="5d3a6-139">Enumerating adapters</span></span>

<span data-ttu-id="5d3a6-140">介面卡是您電腦的硬體和軟體功能的抽象概念。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-140">An adapter is an abstraction of the hardware and the software capability of your computer.</span></span> <span data-ttu-id="5d3a6-141">您的電腦上通常會有許多介面卡。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-141">There are generally many adapters on your machine.</span></span> <span data-ttu-id="5d3a6-142">某些裝置會在硬體 (（像是您的視訊卡) ）中執行，而有些則是在軟體 (（例如 Direct3D 參考轉譯器) ）中執行。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-142">Some devices are implemented in hardware (like your video card) and some are implemented in software (like the Direct3D reference rasterizer).</span></span> <span data-ttu-id="5d3a6-143">介面卡會執行圖形應用程式所使用的功能。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-143">Adapters implement functionality used by a graphic application.</span></span> <span data-ttu-id="5d3a6-144">下圖顯示具有單一電腦的系統、兩張介面卡 (視訊卡) 和三個輸出監視器。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-144">The following diagram shows a system with a single computer, two adapters (video cards), and three output monitors.</span></span>

![具有兩張視訊卡和三部監視器的電腦圖表](images/dxgi-terms.png)

<span data-ttu-id="5d3a6-146">列舉這些硬體時，DXGI 會為每個輸出建立 [**IDXGIOutput1**](/windows/win32/api/DXGI1_2/nn-dxgi1_2-idxgioutput1) 介面 (或監視) 和每張視訊卡的 [**IDXGIAdapter2**](/windows/win32/api/DXGI1_2/nn-dxgi1_2-idxgiadapter2) 介面 (即使是內建于主機板) 的視訊卡。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-146">When enumerating these pieces of hardware, DXGI creates an [**IDXGIOutput1**](/windows/win32/api/DXGI1_2/nn-dxgi1_2-idxgioutput1) interface for each output (or monitor) and an [**IDXGIAdapter2**](/windows/win32/api/DXGI1_2/nn-dxgi1_2-idxgiadapter2) interface for each video card (even if it is a video card built into a motherboard).</span></span> <span data-ttu-id="5d3a6-147">列舉是藉由使用 [**IDXGIFactory**](/windows/win32/api/DXGI1_2/nn-dxgi1_2-idxgifactory2) 介面呼叫 [**IDXGIFactory：： EnumAdapters**](/windows/win32/api/DXGI/nf-dxgi-idxgifactory-enumadapters)來傳回一組代表影片硬體的 [**IDXGIAdapter**](/windows/win32/api/DXGI/nn-dxgi-idxgiadapter) 介面。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-147">Enumeration is done by using an [**IDXGIFactory**](/windows/win32/api/DXGI1_2/nn-dxgi1_2-idxgifactory2) interface call, [**IDXGIFactory::EnumAdapters**](/windows/win32/api/DXGI/nf-dxgi-idxgifactory-enumadapters), to return a set of [**IDXGIAdapter**](/windows/win32/api/DXGI/nn-dxgi-idxgiadapter) interfaces that represent the video hardware.</span></span>

<span data-ttu-id="5d3a6-148">DXGI 1.1 新增了 [**IDXGIFactory1**](/windows/win32/api/DXGI/nn-dxgi-idxgifactory1) 介面。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-148">DXGI 1.1 added the [**IDXGIFactory1**](/windows/win32/api/DXGI/nn-dxgi-idxgifactory1) interface.</span></span> <span data-ttu-id="5d3a6-149">[**IDXGIFactory1：： EnumAdapters1**](/windows/win32/api/DXGI/nf-dxgi-idxgifactory1-enumadapters1) 會傳回一組代表影片硬體的 [**IDXGIAdapter1**](/windows/win32/api/DXGI/nn-dxgi-idxgiadapter1) 介面。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-149">[**IDXGIFactory1::EnumAdapters1**](/windows/win32/api/DXGI/nf-dxgi-idxgifactory1-enumadapters1) returns a set of [**IDXGIAdapter1**](/windows/win32/api/DXGI/nn-dxgi-idxgiadapter1) interfaces that represents the video hardware.</span></span>

<span data-ttu-id="5d3a6-150">如果您想要在使用 Direct3D Api 時選取特定的影片硬體功能，建議您在每個介面卡控制碼和可能的硬體 [功能層級](../direct3d11/overviews-direct3d-11-devices-downlevel-intro.md)反復呼叫 [**D3D11CreateDevice**](/windows/win32/api/d3d11/nf-d3d11-d3d11createdevice)或 [**D3D11CreateDeviceAndSwapChain**](/windows/win32/api/d3d11/nf-d3d11-d3d11createdeviceandswapchain)函式。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-150">If you want to select specific video hardware capabilities when you use Direct3D APIs, we recommend that you iteratively call the [**D3D11CreateDevice**](/windows/win32/api/d3d11/nf-d3d11-d3d11createdevice) or [**D3D11CreateDeviceAndSwapChain**](/windows/win32/api/d3d11/nf-d3d11-d3d11createdeviceandswapchain) function with each adapter handle and possible hardware [feature level](../direct3d11/overviews-direct3d-11-devices-downlevel-intro.md).</span></span> <span data-ttu-id="5d3a6-151">如果指定的介面卡支援功能層級，則此函式會成功。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-151">This function succeeds if the feature level is supported by the specified adapter.</span></span>

### <a name="new-info-about-enumerating-adapters-for-windows-8"></a><span data-ttu-id="5d3a6-152">列舉 Windows 8 的介面卡的新資訊</span><span class="sxs-lookup"><span data-stu-id="5d3a6-152">New info about enumerating adapters for Windows 8</span></span>

<span data-ttu-id="5d3a6-153">從 Windows 8 開始，稱為「Microsoft 基本轉譯驅動程式」的介面卡一律會存在。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-153">Starting with Windows 8, an adapter called the "Microsoft Basic Render Driver" is always present.</span></span> <span data-ttu-id="5d3a6-154">此介面卡具有 **0x1414** 的 VendorId 以及 **0x8c** 的 DeviceID。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-154">This adapter has a VendorId of **0x1414** and a DeviceID of **0x8c**.</span></span> <span data-ttu-id="5d3a6-155">此介面卡也會在其 [**dxgi \_ 介面卡 \_ DESC2**](/windows/win32/api/DXGI1_2/ns-dxgi1_2-dxgi_adapter_desc2)結構的 **旗標** 成員中設定 [ [**dxgi \_ adapter \_ 旗 \_**](/windows/win32/api/dxgi/ne-dxgi-dxgi_adapter_flag)標] 軟體值。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-155">This adapter also has the [**DXGI\_ADAPTER\_FLAG\_SOFTWARE**](/windows/win32/api/dxgi/ne-dxgi-dxgi_adapter_flag) value set in the **Flags** member of its [**DXGI\_ADAPTER\_DESC2**](/windows/win32/api/DXGI1_2/ns-dxgi1_2-dxgi_adapter_desc2) structure.</span></span> <span data-ttu-id="5d3a6-156">此介面卡是僅限轉譯的裝置，沒有顯示輸出。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-156">This adapter is a render-only device that has no display outputs.</span></span> <span data-ttu-id="5d3a6-157">DXGI 永遠不會傳回此介面卡 [**移除的 dxgi \_ 錯誤 \_ 裝置 \_**](dxgi-error.md) 。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-157">DXGI never returns [**DXGI\_ERROR\_DEVICE\_REMOVED**](dxgi-error.md) for this adapter.</span></span>

<span data-ttu-id="5d3a6-158">如果電腦的顯示驅動程式無法運作或已停用，電腦的主要 (**Null**) 介面卡可能也稱為「Microsoft 基本轉譯驅動程式」。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-158">If a computer's display driver is not functioning or is disabled, the computer's primary (**NULL**) adapter might also be called "Microsoft Basic Render Driver."</span></span> <span data-ttu-id="5d3a6-159">但此介面卡有輸出，且未設定 [**DXGI \_ 介面卡 \_ 旗標 \_ 軟體**](/windows/win32/api/dxgi/ne-dxgi-dxgi_adapter_flag) 值。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-159">But this adapter has outputs and doesn't have the [**DXGI\_ADAPTER\_FLAG\_SOFTWARE**](/windows/win32/api/dxgi/ne-dxgi-dxgi_adapter_flag) value set.</span></span> <span data-ttu-id="5d3a6-160">作業系統和應用程式預設會使用此介面卡。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-160">The operating system and apps use this adapter by default.</span></span> <span data-ttu-id="5d3a6-161">如果已安裝或啟用顯示驅動程式，則應用程式可能會收到此介面卡 [**移除的 DXGI \_ 錯誤 \_ 裝置 \_**](dxgi-error.md) ，然後必須重新列舉介面卡。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-161">If a display driver is installed or enabled, apps can receive [**DXGI\_ERROR\_DEVICE\_REMOVED**](dxgi-error.md) for this adapter and then must re-enumerate adapters again.</span></span>

<span data-ttu-id="5d3a6-162">當電腦的主要顯示器介面卡是「Microsoft 基本顯示器介面卡」 ([變形](../direct3d11/overviews-direct3d-11-devices-create-warp.md) 介面卡) 時，該電腦也會有第二張介面卡。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-162">When a computer's primary display adapter is the "Microsoft Basic Display Adapter" ([WARP](../direct3d11/overviews-direct3d-11-devices-create-warp.md) adapter), that computer also has a second adapter.</span></span> <span data-ttu-id="5d3a6-163">第二張介面卡是僅限轉譯的裝置，沒有顯示輸出，而 DXGI 永遠不會傳回 [**dxgi \_ 錯誤 \_ 裝置 \_**](dxgi-error.md)。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-163">This second adapter is the render-only device that has no display outputs and for which DXGI never returns [**DXGI\_ERROR\_DEVICE\_REMOVED**](dxgi-error.md).</span></span>

<span data-ttu-id="5d3a6-164">如果您想要將變形用於轉譯、計算或其他長時間執行的工作，建議使用僅限轉譯的裝置。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-164">If you want to use WARP for rendering, compute, or other long running tasks, we recommend to use the render-only device.</span></span> <span data-ttu-id="5d3a6-165">您可以藉由呼叫 [**IDXGIFactory1：： EnumAdapters1**](/windows/win32/api/DXGI/nf-dxgi-idxgifactory1-enumadapters1) 方法，取得僅限轉譯裝置的指標。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-165">You can obtain a pointer to the render-only device by calling the [**IDXGIFactory1::EnumAdapters1**](/windows/win32/api/DXGI/nf-dxgi-idxgifactory1-enumadapters1) method.</span></span> <span data-ttu-id="5d3a6-166">當您在 [**D3D11CreateDevice**](/windows/win32/api/d3d11/nf-d3d11-d3d11createdevice)的 *DriverType* 參數中指定 [**D3D \_ 驅動程式 \_ 類型 \_ 變形**](/windows/win32/api/d3dcommon/ne-d3dcommon-d3d_driver_type)時，也會建立僅限轉譯的裝置，因為變形裝置也會使用僅呈現的變形介面卡。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-166">You also create the render-only device when you specify [**D3D\_DRIVER\_TYPE\_WARP**](/windows/win32/api/d3dcommon/ne-d3dcommon-d3d_driver_type) in the *DriverType* parameter of [**D3D11CreateDevice**](/windows/win32/api/d3d11/nf-d3d11-d3d11createdevice) because the WARP device also uses the render-only WARP adapter.</span></span>

## <a name="presentation"></a><span data-ttu-id="5d3a6-167">簡報</span><span class="sxs-lookup"><span data-stu-id="5d3a6-167">Presentation</span></span>

<span data-ttu-id="5d3a6-168">您應用程式的工作是轉譯畫面格，並要求 DXGI 將這些畫面呈現給輸出。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-168">Your application's job is to render frames and ask DXGI to present those frames to the output.</span></span> <span data-ttu-id="5d3a6-169">如果應用程式有兩個可用的緩衝區，它可以在呈現另一個緩衝區時轉譯一個緩衝區。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-169">If the application has two buffers available, it can render one buffer while presenting another one.</span></span> <span data-ttu-id="5d3a6-170">應用程式可能需要兩個以上的緩衝區，這取決於轉譯框架所需的時間，或呈現所需的畫面播放速率。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-170">The application might require more than two buffers depending on the time it takes to render a frame or the desired frame rate for presentation.</span></span> <span data-ttu-id="5d3a6-171">所建立的緩衝區集會稱為交換鏈，如下所示。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-171">The set of buffers created is called a swap chain, as shown here.</span></span>

![交換鏈的圖例](images/dxgi-swap-chain.png)

-   [<span data-ttu-id="5d3a6-173">建立交換鏈</span><span class="sxs-lookup"><span data-stu-id="5d3a6-173">Create a Swap Chain</span></span>](#create-a-swap-chain)
-   [<span data-ttu-id="5d3a6-174">交換鏈的護理和饋送</span><span class="sxs-lookup"><span data-stu-id="5d3a6-174">Care and Feeding of the Swap Chain</span></span>](#care-and-feeding-of-the-swap-chain)
-   [<span data-ttu-id="5d3a6-175">處理視窗調整大小</span><span class="sxs-lookup"><span data-stu-id="5d3a6-175">Handling Window Resizing</span></span>](#handling-window-resizing)
-   [<span data-ttu-id="5d3a6-176">選擇 DXGI 輸出和大小</span><span class="sxs-lookup"><span data-stu-id="5d3a6-176">Choosing the DXGI Output and Size</span></span>](#choosing-the-dxgi-output-and-size)
-   [<span data-ttu-id="5d3a6-177">在 Full-Screen 模式中進行調試</span><span class="sxs-lookup"><span data-stu-id="5d3a6-177">Debugging in Full-Screen Mode</span></span>](#debugging-in-full-screen-mode)
-   [<span data-ttu-id="5d3a6-178">終結交換鏈</span><span class="sxs-lookup"><span data-stu-id="5d3a6-178">Destroying a Swap Chain</span></span>](#destroying-a-swap-chain)
-   [<span data-ttu-id="5d3a6-179">使用旋轉的監視器</span><span class="sxs-lookup"><span data-stu-id="5d3a6-179">Using a Rotated Monitor</span></span>](#using-a-rotated-monitor)
-   [<span data-ttu-id="5d3a6-180">切換模式</span><span class="sxs-lookup"><span data-stu-id="5d3a6-180">Switching Modes</span></span>](#switching-modes)
-   [<span data-ttu-id="5d3a6-181">全螢幕的效能秘訣</span><span class="sxs-lookup"><span data-stu-id="5d3a6-181">Full-Screen Performance Tip</span></span>](#full-screen-performance-tip)
-   [<span data-ttu-id="5d3a6-182">多執行緒考慮</span><span class="sxs-lookup"><span data-stu-id="5d3a6-182">Multithread Considerations</span></span>](#multithread-considerations)

<span data-ttu-id="5d3a6-183">交換鏈有一個前端緩衝區和一或多個背景緩衝區。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-183">A swap chain has one front buffer and one or more back buffers.</span></span> <span data-ttu-id="5d3a6-184">每個應用程式都會建立自己的交換鏈。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-184">Each application creates its own swap chain.</span></span> <span data-ttu-id="5d3a6-185">為了將資料呈現的速度最大化到輸出，交換鏈幾乎一律會在顯示子系統的記憶體中建立，如下圖所示。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-185">To maximize the speed of the presentation of the data to an output, a swap chain is almost always created in the memory of a display sub-system, which is shown in the following illustration.</span></span>

![顯示子系統的圖例](images/dxgi-adapter.png)

<span data-ttu-id="5d3a6-187">顯示子系統 (通常是視訊卡，但可以在主機板上執行) 包含 GPU、數位轉類比轉換器 (DAC) 和記憶體。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-187">The display sub-system (which is often a video card but could be implemented on a motherboard) contains a GPU, a digital to analog converter (DAC), and memory.</span></span> <span data-ttu-id="5d3a6-188">交換鏈是在此記憶體內配置，以非常快速的方式進行呈現。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-188">The swap chain is allocated within this memory to make presentation very fast.</span></span> <span data-ttu-id="5d3a6-189">顯示子系統會將前端緩衝區中的資料呈現給輸出。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-189">The display sub-system presents the data in the front buffer to the output.</span></span>

<span data-ttu-id="5d3a6-190">交換鏈的設定是以全螢幕或視窗模式繪製，如此就不需要知道輸出是視窗型或全螢幕。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-190">A swap chain is set up to draw in full-screen or windowed mode, this eliminates the need to know whether an output is windowed or full screen.</span></span> <span data-ttu-id="5d3a6-191">全螢幕模式的交換鏈可以藉由切換顯示器解析度，來將效能優化。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-191">A full-screen mode swap chain can optimize performance by switching the display resolution.</span></span>

### <a name="create-a-swap-chain"></a><span data-ttu-id="5d3a6-192">建立交換鏈結</span><span class="sxs-lookup"><span data-stu-id="5d3a6-192">Create a swap chain</span></span>

<table>
<colgroup>
<col style="width: 100%" />
</colgroup>
<tbody>
<tr class="odd">
<td><span data-ttu-id="5d3a6-193">Direct3D 9 與 Direct3D 10 之間的差異： Direct3D 10 是使用 DXGI 的第一個圖形元件。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-193">Differences between Direct3D 9 and Direct3D 10: Direct3D 10 is the first graphics component to use DXGI.</span></span> <span data-ttu-id="5d3a6-194">DXGI 有一些不同的交換鏈行為。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-194">DXGI has some different swap chain behaviors.</span></span><br/>
<ul>
<li><span data-ttu-id="5d3a6-195">在 DXGI 中，交換鏈會在建立交換鏈時系結至視窗。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-195">In DXGI, a swap chain is tied to a window when the swap chain is created.</span></span> <span data-ttu-id="5d3a6-196">這種變更可改善效能並節省記憶體。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-196">This change improves performance and saves memory.</span></span> <span data-ttu-id="5d3a6-197">舊版 Direct3D 允許交換鏈變更交換鏈所系結的視窗。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-197">Previous versions of Direct3D allowed the swap chain to change the window that the swap chain is tied to.</span></span></li>
<li><span data-ttu-id="5d3a6-198">在 DXGI 中，交換鏈會在建立時系結至轉譯裝置。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-198">In DXGI, a swap chain is tied to a rendering device on creation.</span></span> <span data-ttu-id="5d3a6-199">Direct3D 建立的裝置函式傳回的裝置物件會執行 <a href="/windows/win32/api/unknwn/nn-unknwn-iunknown"><strong>IUnknown</strong></a> 介面。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-199">The device object that the Direct3D create device functions return implements the <a href="/windows/win32/api/unknwn/nn-unknwn-iunknown"><strong>IUnknown</strong></a> interface.</span></span> <span data-ttu-id="5d3a6-200">您可以呼叫 <a href="/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)"><strong>QueryInterface</strong></a> 來查詢裝置的對應 <a href="/windows/win32/api/DXGI1_2/nn-dxgi1_2-idxgidevice2"><strong>IDXGIDevice2</strong></a> 介面。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-200">You can call <a href="/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)"><strong>QueryInterface</strong></a> to query for the device's corresponding <a href="/windows/win32/api/DXGI1_2/nn-dxgi1_2-idxgidevice2"><strong>IDXGIDevice2</strong></a> interface.</span></span> <span data-ttu-id="5d3a6-201">變更轉譯裝置需要重新建立交換鏈。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-201">A change to the rendering device requires the swap chain to be recreated.</span></span></li>
<li><p><span data-ttu-id="5d3a6-202">在 DXGI 中，可用的交換效果是 DXGI_SWAP_EFFECT_DISCARD 並 DXGI_SWAP_EFFECT_SEQUENTIAL。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-202">In DXGI, the swap effects available are DXGI_SWAP_EFFECT_DISCARD and DXGI_SWAP_EFFECT_SEQUENTIAL.</span></span> <span data-ttu-id="5d3a6-203">從 Windows 8 開始也可以使用 DXGI_SWAP_EFFECT_FLIP_SEQUENTIAL 交換效果。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-203">Starting with Windows 8 the DXGI_SWAP_EFFECT_FLIP_SEQUENTIAL swap effect is also available.</span></span> <span data-ttu-id="5d3a6-204">下表顯示 Direct3D 9 至 DXGI swap 效果定義的對應。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-204">The following table shows a mapping of Direct3D 9 to DXGI swap effect defines.</span></span> </p>
<table>
<thead>
<tr class="header">
<th><span data-ttu-id="5d3a6-205">D3D9 交換效果</span><span class="sxs-lookup"><span data-stu-id="5d3a6-205">D3D9 Swap Effect</span></span></th>
<th><span data-ttu-id="5d3a6-206">DXGI 交換效果</span><span class="sxs-lookup"><span data-stu-id="5d3a6-206">DXGI Swap Effect</span></span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span data-ttu-id="5d3a6-207">D3DSWAPEFFECT_DISCARD</span><span class="sxs-lookup"><span data-stu-id="5d3a6-207">D3DSWAPEFFECT_DISCARD</span></span></td>
<td><span data-ttu-id="5d3a6-208">DXGI_SWAP_EFFECT_DISCARD</span><span class="sxs-lookup"><span data-stu-id="5d3a6-208">DXGI_SWAP_EFFECT_DISCARD</span></span></td>
</tr>
<tr class="even">
<td><span data-ttu-id="5d3a6-209">D3DSWAPEFFECT_COPY</span><span class="sxs-lookup"><span data-stu-id="5d3a6-209">D3DSWAPEFFECT_COPY</span></span></td>
<td><span data-ttu-id="5d3a6-210">具有1個緩衝區的 DXGI_SWAP_EFFECT_SEQUENTIAL</span><span class="sxs-lookup"><span data-stu-id="5d3a6-210">DXGI_SWAP_EFFECT_SEQUENTIAL with 1 buffer</span></span></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="5d3a6-211">D3DSWAPEFFECT_FLIP</span><span class="sxs-lookup"><span data-stu-id="5d3a6-211">D3DSWAPEFFECT_FLIP</span></span></td>
<td><span data-ttu-id="5d3a6-212">具有2個或多個緩衝區的 DXGI_SWAP_EFFECT_SEQUENTIAL</span><span class="sxs-lookup"><span data-stu-id="5d3a6-212">DXGI_SWAP_EFFECT_SEQUENTIAL with 2 or more buffers</span></span></td>
</tr>
<tr class="even">
<td><span data-ttu-id="5d3a6-213">D3DSWAPEFFECT_FLIPEX</span><span class="sxs-lookup"><span data-stu-id="5d3a6-213">D3DSWAPEFFECT_FLIPEX</span></span></td>
<td><span data-ttu-id="5d3a6-214">具有2個或多個緩衝區的 DXGI_SWAP_EFFECT_FLIP_SEQUENTIAL</span><span class="sxs-lookup"><span data-stu-id="5d3a6-214">DXGI_SWAP_EFFECT_FLIP_SEQUENTIAL with 2 or more buffers</span></span></td>
</tr>
</tbody>
</table>
<p></p>
<p> </p></li>
</ul></td>
</tr>
</tbody>
</table>



 

<span data-ttu-id="5d3a6-215">交換鏈的緩衝區會以特定的大小和特定格式建立。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-215">A swap chain's buffers are created at a particular size and in a particular format.</span></span> <span data-ttu-id="5d3a6-216">應用程式會指定這些值 (或您可以在啟動時繼承目標視窗) 的大小，然後視需要在視窗大小變更時加以修改，以回應使用者輸入或程式事件。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-216">The application specifies these values (or you can inherit the size from the target window) at startup, and can then optionally modify them as the window size changes in response to user input or program events.</span></span>

<span data-ttu-id="5d3a6-217">建立交換鏈之後，您通常會想要在其中呈現影像。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-217">After you create the swap chain, you will typically want to render images into it.</span></span> <span data-ttu-id="5d3a6-218">以下是設定 Direct3D 內容以轉譯成交換鏈的程式碼片段。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-218">Here's a code fragment that sets up a Direct3D context to render into a swap chain.</span></span> <span data-ttu-id="5d3a6-219">此程式碼會從交換鏈中解壓縮緩衝區、從該緩衝區建立轉譯目標視圖，然後在裝置上進行設定：</span><span class="sxs-lookup"><span data-stu-id="5d3a6-219">This code extracts a buffer from the swap chain, creates a render-target-view from that buffer, then sets it on the device:</span></span>


```
ID3D11Resource * pBB;
ThrowFailure( pSwapChain->GetBuffer(0, __uuidof(pBB),    
  reinterpret_cast<void**>(&pBB)), "Couldn't get back buffer");
ID3D11RenderTargetView * pView;
ThrowFailure( pD3D11Device->CreateRenderTargetView(pBB, NULL, &pView), 
  "Couldn't create view" );
pD3D11DeviceContext->OMSetRenderTargets(1, &pView, 0);
        
```



<span data-ttu-id="5d3a6-220">當您的應用程式將畫面格轉譯成交換鏈緩衝區之後，請呼叫 [**IDXGISwapChain1：:P resent1**](/windows/win32/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1)。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-220">After your application renders a frame into a swap-chain buffer, call [**IDXGISwapChain1::Present1**](/windows/win32/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1).</span></span> <span data-ttu-id="5d3a6-221">然後，應用程式就可以轉譯下一個影像。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-221">The application can then go render the next image.</span></span>

### <a name="care-and-feeding-of-the-swap-chain"></a><span data-ttu-id="5d3a6-222">交換鏈的護理和饋送</span><span class="sxs-lookup"><span data-stu-id="5d3a6-222">Care and feeding of the swap chain</span></span>

<span data-ttu-id="5d3a6-223">轉譯影像之後，請呼叫 [**IDXGISwapChain1：:P resent1**](/windows/win32/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) ，然後轉譯下一個影像。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-223">After you render your image, call [**IDXGISwapChain1::Present1**](/windows/win32/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) and go render the next image.</span></span> <span data-ttu-id="5d3a6-224">這是您責任的範圍。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-224">That is the extent of your responsibility.</span></span>

<span data-ttu-id="5d3a6-225">如果您先前已呼叫 [**IDXGIFactory：： MakeWindowAssociation**](/windows/win32/api/DXGI/nf-dxgi-idxgifactory-makewindowassociation)，使用者可以按 Alt-Enter 按鍵組合，而 DXGI 會在視窗模式和全螢幕模式之間轉換您的應用程式。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-225">If you previously called [**IDXGIFactory::MakeWindowAssociation**](/windows/win32/api/DXGI/nf-dxgi-idxgifactory-makewindowassociation), the user can press the Alt-Enter key combination and DXGI will transition your application between windowed and full-screen mode.</span></span> <span data-ttu-id="5d3a6-226">建議使用 **IDXGIFactory：： MakeWindowAssociation** ，因為強烈需要使用者的標準控制機制。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-226">**IDXGIFactory::MakeWindowAssociation** is recommended, because a standard control mechanism for the user is strongly desired.</span></span>

<span data-ttu-id="5d3a6-227">雖然您不需要撰寫超過所述的程式碼，但有幾個簡單的步驟可以讓您的應用程式更具回應性。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-227">While you don't have to write any more code than has been described, a few simple steps can make your application more responsive.</span></span> <span data-ttu-id="5d3a6-228">最重要的考慮是調整交換鏈的緩衝區大小，以回應輸出視窗的調整大小。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-228">The most important consideration is the resizing of the swap chain's buffers in response to the resizing of the output window.</span></span> <span data-ttu-id="5d3a6-229">應用程式的最佳路由當然是回應 WM 的 \_ 大小，然後呼叫 [**IDXGISwapChain：： ResizeBuffers**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-resizebuffers)，傳遞訊息參數中所包含的大小。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-229">Naturally, the application's best route is to respond to WM\_SIZE, and call [**IDXGISwapChain::ResizeBuffers**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-resizebuffers), passing the size contained in the message's parameters.</span></span> <span data-ttu-id="5d3a6-230">這種行為顯然讓您的應用程式在拖曳視窗的框線時，能夠適當地回應使用者，但這也是啟用平滑全螢幕轉換的確切功能。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-230">This behavior obviously makes your application respond well to the user when he or she drags the window's borders, but it is also exactly what enables a smooth full-screen transition.</span></span> <span data-ttu-id="5d3a6-231">\_當這類轉換發生時，您的視窗將會收到 WM 大小的訊息，而呼叫 **IDXGISwapChain：： ResizeBuffers** 是交換鏈的機會，可重新配置緩衝區的儲存體以進行最佳展示。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-231">Your window will receive a WM\_SIZE message whenever such a transition happens, and calling **IDXGISwapChain::ResizeBuffers** is the swap chain's chance to re-allocate the buffers' storage for optimal presentation.</span></span> <span data-ttu-id="5d3a6-232">這就是為什麼在呼叫 **IDXGISwapChain：： ResizeBuffers** 之前，應用程式必須釋放現有緩衝區上任何參考的原因。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-232">This is why the application is required to release any references it has on the existing buffers before it calls **IDXGISwapChain::ResizeBuffers**.</span></span>

<span data-ttu-id="5d3a6-233">無法呼叫 [**IDXGISwapChain：： ResizeBuffers**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-resizebuffers) 來回應切換至全螢幕模式 (最自然的原因是，為了回應 WM \_ 大小) ，可能會妨礙翻轉的優化，其中 DXGI 可以直接交換要顯示的緩衝區，而不是複製全螢幕的資料。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-233">Failure to call [**IDXGISwapChain::ResizeBuffers**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-resizebuffers) in response to switching to full-screen mode (most naturally, in response to WM\_SIZE), can preclude the optimization of flipping, wherein DXGI can simply swap which buffer is being displayed, rather than copying a full screen's worth of data around.</span></span>

<span data-ttu-id="5d3a6-234">[**IDXGISwapChain1：:P resent1**](/windows/win32/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) 將會通知您，您的輸出視窗是否透過 **DXGI \_ 狀態 \_ pixels occluded** 完全 pixels occluded。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-234">[**IDXGISwapChain1::Present1**](/windows/win32/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) will inform you if your output window is entirely occluded via **DXGI\_STATUS\_OCCLUDED**.</span></span> <span data-ttu-id="5d3a6-235">發生這種情況時，我們建議您藉由呼叫 **IDXGISwapChain1：:P resent1** 與 **DXGI \_ 目前的 \_ 測試**) 來進入待命模式 (，因為用來呈現框架的資源會浪費。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-235">When this occurs, we recommended that your application go into standby mode (by calling **IDXGISwapChain1::Present1** with **DXGI\_PRESENT\_TEST**) since resources used to render the frame are wasted.</span></span> <span data-ttu-id="5d3a6-236">使用 **DXGI \_ 現狀 \_ 測試** 可防止在仍執行遮蔽檢查時顯示任何資料。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-236">Using **DXGI\_PRESENT\_TEST** will prevent any data from being presented while still performing the occlusion check.</span></span> <span data-ttu-id="5d3a6-237">一旦 **IDXGISwapChain1 之後，:P resent1** 會傳回 S \_ OK，您應該結束待命模式; 請勿使用傳回碼來切換回待命模式，因為這樣可能會讓交換鏈無法進入全螢幕模式。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-237">Once **IDXGISwapChain1::Present1** returns S\_OK, you should exit standby mode; do not use the return code to switch to standby mode as doing so can leave the swap chain unable to relinquish full-screen mode.</span></span>

<span data-ttu-id="5d3a6-238">從 Windows 8 開始提供的 Direct3D 11.1 執行時間會提供翻轉模型交換鏈， (也就是具有 [**dxgi \_ 交換 \_ 效果 \_ \_**](/windows/win32/api/DXGI/ne-dxgi-dxgi_swap_effect)的交換鏈，會反轉在 [**dxgi \_ 交換 \_ 鏈 \_ DESC**](/windows/win32/api/DXGI/ns-dxgi-dxgi_swap_chain_desc)或 [**dxgi \_ 交換 \_ 鏈) \_ DESC1**](/windows/win32/api/DXGI1_2/ns-dxgi1_2-dxgi_swap_chain_desc1)的 **SwapEffect** 成員中設定的連續值。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-238">The Direct3D 11.1 runtime, which is available starting with Windows 8, provides a flip-model swap chain (that is, a swap chain that has the [**DXGI\_SWAP\_EFFECT\_FLIP\_SEQUENTIAL**](/windows/win32/api/DXGI/ne-dxgi-dxgi_swap_effect) value set in the **SwapEffect** member of [**DXGI\_SWAP\_CHAIN\_DESC**](/windows/win32/api/DXGI/ns-dxgi-dxgi_swap_chain_desc) or [**DXGI\_SWAP\_CHAIN\_DESC1**](/windows/win32/api/DXGI1_2/ns-dxgi1_2-dxgi_swap_chain_desc1)).</span></span> <span data-ttu-id="5d3a6-239">當您向翻轉模型交換鏈呈現輸出的畫面格時，DXGI 會將後置緩衝區從所有管線狀態位置（例如輸出合併轉譯目標）解除系結，以寫入回緩衝區0。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-239">When you present frames to an output with a flip-model swap chain, DXGI unbinds the back buffer from all pipeline state locations, like an output-merger render target, that write to back buffer 0.</span></span> <span data-ttu-id="5d3a6-240">因此，我們建議您在轉譯為背景緩衝區之前，立即呼叫 [**>id3d11devicecoNtext：： OMSetRenderTargets**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-omsetrendertargets) 。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-240">Therefore, we recommend that you call [**ID3D11DeviceContext::OMSetRenderTargets**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-omsetrendertargets) immediately before you render to the back buffer.</span></span> <span data-ttu-id="5d3a6-241">例如，請勿呼叫 **OMSetRenderTargets** ，然後執行計算著色器工作，而不會結束轉譯至資源。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-241">For example, don't call **OMSetRenderTargets** and then perform compute shader work that doesn't end up rendering to the resource.</span></span> <span data-ttu-id="5d3a6-242">如需翻轉模型交換鏈及其優點的詳細資訊，請參閱 [DXGI 翻轉模型](dxgi-flip-model.md)。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-242">For more info about flip-model swap chains and their benefits, see [DXGI Flip Model](dxgi-flip-model.md).</span></span>

> [!NOTE]  
> <span data-ttu-id="5d3a6-243">在 Direct3D 10 和 Direct3D 11 中，您不需要呼叫 [**IDXGISwapChain：： GetBuffer**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-getbuffer) ，就能在呼叫 [**IDXGISwapChain1：:P resent1**](/windows/win32/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) 之後取回緩衝區0，因為為了方便起見，後端緩衝區的身分識別會變更。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-243">In Direct3D 10 and Direct3D 11, you don't have to call [**IDXGISwapChain::GetBuffer**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-getbuffer) to retrieve back buffer 0 after you call [**IDXGISwapChain1::Present1**](/windows/win32/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) because for convenience the identities of back buffers change.</span></span> <span data-ttu-id="5d3a6-244">在 Direct3D 12 中不會發生這種情況，您的應用程式必須改為手動追蹤緩衝區索引。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-244">This doesn't happen in Direct3D 12, and your application must instead manually track back buffer indices.</span></span>

### <a name="handling-window-resizing"></a><span data-ttu-id="5d3a6-245">處理視窗調整大小</span><span class="sxs-lookup"><span data-stu-id="5d3a6-245">Handling window resizing</span></span>

<span data-ttu-id="5d3a6-246">您可以使用 [**IDXGISwapChain：： ResizeBuffers**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-resizebuffers) 方法來處理視窗調整大小。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-246">You can use the [**IDXGISwapChain::ResizeBuffers**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-resizebuffers) method to handle window resizing.</span></span> <span data-ttu-id="5d3a6-247">在呼叫 **ResizeBuffers** 之前，您必須釋放交換鏈緩衝區的所有未完成參考。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-247">Before you call **ResizeBuffers**, you must release all outstanding references to the swap chain's buffers.</span></span> <span data-ttu-id="5d3a6-248">通常保存交換鏈緩衝區之參考的物件是呈現目標視圖。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-248">The object that typically holds a reference to a swap chain's buffer is a render-target-view.</span></span>

<span data-ttu-id="5d3a6-249">下列範例程式碼示範如何從 WindowProc 處理常式內針對 WM 大小的訊息呼叫 [**ResizeBuffers**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-resizebuffers) \_ ：</span><span class="sxs-lookup"><span data-stu-id="5d3a6-249">The following example code shows how to call [**ResizeBuffers**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-resizebuffers) from within the WindowProc handler for WM\_SIZE messages:</span></span>


```
    case WM_SIZE:
        if (g_pSwapChain)
        {
            g_pd3dDeviceContext->OMSetRenderTargets(0, 0, 0);

            // Release all outstanding references to the swap chain's buffers.
            g_pRenderTargetView->Release();

            HRESULT hr;
            // Preserve the existing buffer count and format.
            // Automatically choose the width and height to match the client rect for HWNDs.
            hr = g_pSwapChain->ResizeBuffers(0, 0, 0, DXGI_FORMAT_UNKNOWN, 0);
                                            
            // Perform error handling here!

            // Get buffer and create a render-target-view.
            ID3D11Texture2D* pBuffer;
            hr = g_pSwapChain->GetBuffer(0, __uuidof( ID3D11Texture2D),
                                         (void**) &pBuffer );
            // Perform error handling here!

            hr = g_pd3dDevice->CreateRenderTargetView(pBuffer, NULL,
                                                     &g_pRenderTargetView);
            // Perform error handling here!
            pBuffer->Release();

            g_pd3dDeviceContext->OMSetRenderTargets(1, &g_pRenderTargetView, NULL );

            // Set up the viewport.
            D3D11_VIEWPORT vp;
            vp.Width = width;
            vp.Height = height;
            vp.MinDepth = 0.0f;
            vp.MaxDepth = 1.0f;
            vp.TopLeftX = 0;
            vp.TopLeftY = 0;
            g_pd3dDeviceContext->RSSetViewports( 1, &vp );
        }
        return 1;
```



### <a name="choosing-the-dxgi-output-and-size"></a><span data-ttu-id="5d3a6-250">選擇 DXGI 輸出和大小</span><span class="sxs-lookup"><span data-stu-id="5d3a6-250">Choosing the DXGI output and size</span></span>

<span data-ttu-id="5d3a6-251">根據預設，DXGI 會選擇包含視窗大部分工作區的輸出。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-251">By default, DXGI chooses the output that contains most of the client area of the window.</span></span> <span data-ttu-id="5d3a6-252">這是可用於 DXGI 的唯一選項，當它變成全螢幕本身以回應 alt 輸入時。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-252">This is the only option available to DXGI when it goes full-screen itself in response to alt-enter.</span></span> <span data-ttu-id="5d3a6-253">如果應用程式選擇移至全螢幕模式，則可以呼叫 [**IDXGISwapChain：： SetFullscreenState**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-setfullscreenstate) ，並傳遞明確的 [**IDXGIOutput1**](/windows/win32/api/DXGI1_2/nn-dxgi1_2-idxgioutput1) (或 **Null**（如果應用程式很高興讓 DXGI 決定) ）。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-253">If the application chooses to go to full-screen mode by itself, then it can call [**IDXGISwapChain::SetFullscreenState**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-setfullscreenstate) and pass an explicit [**IDXGIOutput1**](/windows/win32/api/DXGI1_2/nn-dxgi1_2-idxgioutput1) (or **NULL**, if the application is happy to let DXGI decide).</span></span>

<span data-ttu-id="5d3a6-254">若要在全螢幕或視窗視窗中調整輸出的大小，建議您呼叫 [**IDXGISwapChain：： ResizeTarget**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-resizetarget)，因為這個方法也會調整目標視窗的大小。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-254">To resize the output while either full screen or windowed, we recommend to call [**IDXGISwapChain::ResizeTarget**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-resizetarget), since this method resizes the target window also.</span></span> <span data-ttu-id="5d3a6-255">由於目標視窗經過調整大小，作業系統會傳送 **WM \_ 大小**，而您的程式碼會自然地呼叫 [**IDXGISwapChain：： ResizeBuffers**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-resizebuffers) 來回應。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-255">Since the target window is resized, the operating system sends **WM\_SIZE**, and your code will naturally call [**IDXGISwapChain::ResizeBuffers**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-resizebuffers) in response.</span></span> <span data-ttu-id="5d3a6-256">因此，重新調整緩衝區大小，然後再調整目標大小，會浪費精力。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-256">It's thus a waste of effort to resize your buffers, and then subsequently resize the target.</span></span>

### <a name="debugging-in-full-screen-mode"></a><span data-ttu-id="5d3a6-257">在全螢幕模式中進行調試</span><span class="sxs-lookup"><span data-stu-id="5d3a6-257">Debugging in full-screen mode</span></span>

<span data-ttu-id="5d3a6-258">只有在絕對必要時，才會會讓出全螢幕模式的 DXGI 交換鏈。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-258">A DXGI swap chain relinquishes full-screen mode only when absolutely necessary.</span></span> <span data-ttu-id="5d3a6-259">這表示您可以使用多個監視器來偵測全螢幕應用程式，只要 [偵錯工具] 視窗不會與交換鏈的目標視窗重迭。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-259">This means that you can debug a full-screen application using multiple monitors, as long as the debug window doesn't overlap the swap chain's target window.</span></span> <span data-ttu-id="5d3a6-260">或者，您也可以不設定 **DXGI \_ 交換 \_ 鏈 \_ 旗標 \_ 允許 \_ 模式 \_ 切換** 旗標，來防止整個模式切換。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-260">Alternatively, you can prevent mode switching altogether by not setting the **DXGI\_SWAP\_CHAIN\_FLAG\_ALLOW\_MODE\_SWITCH** flag.</span></span>

<span data-ttu-id="5d3a6-261">如果允許切換模式，當另一個視窗 pixels occluded 輸出視窗時，交換鏈將會放棄全螢幕模式。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-261">If mode switching is allowed, a swap chain will relinquish full-screen mode whenever its output window is occluded by another window.</span></span> <span data-ttu-id="5d3a6-262">遮蔽檢查是在 IDXGISwapChain1 期間執行 [**：:P resent1**](/windows/win32/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1)或個別的執行緒，其目的是要監看應用程式是否變得沒有回應 (而不會再呼叫 **IDXGISwapChain1：:P resent1**) 。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-262">The occlusion check is performed during [**IDXGISwapChain1::Present1**](/windows/win32/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1), or by a separate thread whose purpose is to watch to see if the application has becomes unresponsive (and no longer calls **IDXGISwapChain1::Present1**).</span></span> <span data-ttu-id="5d3a6-263">若要停用個別執行緒造成切換的能力，請將下列登錄機碼設定為任何非零的值。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-263">To disable the ability of the separate thread to cause a switch, set the following registry key to any non-zero value.</span></span>

<span data-ttu-id="5d3a6-264">**HKCU \\ Software \\ Microsoft \\ DXGI \\ DisableFullscreenWatchdog**</span><span class="sxs-lookup"><span data-stu-id="5d3a6-264">**HKCU\\Software\\Microsoft\\DXGI\\DisableFullscreenWatchdog**</span></span>

### <a name="destroying-a-swap-chain"></a><span data-ttu-id="5d3a6-265">終結交換鏈</span><span class="sxs-lookup"><span data-stu-id="5d3a6-265">Destroying a swap chain</span></span>

<span data-ttu-id="5d3a6-266">您不得以全螢幕模式釋放交換鏈，因為這樣做可能會產生執行緒爭用 (這會導致 DXGI 引發無法持續性的例外狀況) 。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-266">You may not release a swap chain in full-screen mode because doing so may create thread contention (which will cause DXGI to raise a non-continuable exception).</span></span> <span data-ttu-id="5d3a6-267">釋出交換鏈之前，請先切換至視窗模式 (使用 [**IDXGISwapChain：： SetFullscreenState**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-setfullscreenstate) ( **FALSE**， **Null** ) ) 然後呼叫 [**IUnknown：： Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release)。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-267">Before releasing a swap chain, first switch to windowed mode (using [**IDXGISwapChain::SetFullscreenState**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-setfullscreenstate)( **FALSE**, **NULL** )) and then call [**IUnknown::Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release).</span></span>

### <a name="using-a-rotated-monitor"></a><span data-ttu-id="5d3a6-268">使用旋轉的監視器</span><span class="sxs-lookup"><span data-stu-id="5d3a6-268">Using a rotated monitor</span></span>

<span data-ttu-id="5d3a6-269">應用程式不需要擔心監視器方向，而 DXGI 會在呈現期間旋轉交換鏈緩衝區（如有必要）。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-269">An application does not need to worry about monitor orientation, DXGI will rotate a swap-chain buffer during presentation, if necessary.</span></span> <span data-ttu-id="5d3a6-270">當然，這種額外的旋轉可能會影響效能。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-270">Of course, this additional rotation can impact performance.</span></span> <span data-ttu-id="5d3a6-271">為了達到最佳效能，請執行下列動作來處理應用程式中的旋轉：</span><span class="sxs-lookup"><span data-stu-id="5d3a6-271">For best performance, take care of the rotation in your application by doing the following:</span></span>

-   <span data-ttu-id="5d3a6-272">使用 **DXGI \_ 交換 \_ 鏈旗標 \_ \_ NONPREROTATED**。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-272">Use the **DXGI\_SWAP\_CHAIN\_FLAG\_NONPREROTATED**.</span></span> <span data-ttu-id="5d3a6-273">這會通知 DXGI，讓應用程式產生旋轉的影像 (例如，藉由改變其投影矩陣) 。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-273">This notifies DXGI that the application will produce a rotated image (for example, by altering its projection matrix).</span></span> <span data-ttu-id="5d3a6-274">要注意的是，這個旗標只有在全螢幕模式下才有效。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-274">One thing to note, this flag is only valid while in full-screen mode.</span></span>
-   <span data-ttu-id="5d3a6-275">配置每個交換鏈緩衝區的旋轉大小。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-275">Allocate each swap-chain buffer in its rotated size.</span></span> <span data-ttu-id="5d3a6-276">如有必要，請使用 [**IDXGIOutput：： GetDesc**](/windows/win32/api/DXGI/nf-dxgi-idxgioutput-getdesc) 來取得這些值。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-276">Use [**IDXGIOutput::GetDesc**](/windows/win32/api/DXGI/nf-dxgi-idxgioutput-getdesc) to get these values, if necessary.</span></span>

<span data-ttu-id="5d3a6-277">藉由在您的應用程式中執行旋轉，DXGI 只會進行複製，而不是複製和旋轉。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-277">By performing the rotation in your application, DXGI will simply do a copy instead of a copy and a rotate.</span></span>

<span data-ttu-id="5d3a6-278">從 Windows 8 開始提供的 Direct3D 11.1 執行時間會提供翻轉模型交換鏈， (也就是具有 [**dxgi \_ 交換 \_ 效果 \_ \_**](/windows/win32/api/DXGI/ne-dxgi-dxgi_swap_effect)的交換鏈會反轉在 [**dxgi \_ 交換 \_ 鏈 \_ DESC1**](/windows/win32/api/DXGI1_2/ns-dxgi1_2-dxgi_swap_chain_desc1)的 **SwapEffect** 成員中設定的順序值) 。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-278">The Direct3D 11.1 runtime, which is available starting with Windows 8, provides a flip-model swap chain (that is, a swap chain that has the [**DXGI\_SWAP\_EFFECT\_FLIP\_SEQUENTIAL**](/windows/win32/api/DXGI/ne-dxgi-dxgi_swap_effect) value set in the **SwapEffect** member of [**DXGI\_SWAP\_CHAIN\_DESC1**](/windows/win32/api/DXGI1_2/ns-dxgi1_2-dxgi_swap_chain_desc1)).</span></span> <span data-ttu-id="5d3a6-279">為了充分利用反轉模型交換鏈提供的展示優化，我們建議您讓應用程式將內容導向至內容，以符合內容所在的特定輸出（當內容完全佔用輸出時）。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-279">To maximize the presentation optimizations available with a flip-model swap chain, we recommend that you make your applications orient content to match the particular output on which the content resides when that content fully occupies the output.</span></span> <span data-ttu-id="5d3a6-280">如需翻轉模型交換鏈及其優點的詳細資訊，請參閱 [DXGI 翻轉模型](dxgi-flip-model.md)。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-280">For more info about flip-model swap chains and their benefits, see [DXGI Flip Model](dxgi-flip-model.md).</span></span>

### <a name="switching-modes"></a><span data-ttu-id="5d3a6-281">切換模式</span><span class="sxs-lookup"><span data-stu-id="5d3a6-281">Switching modes</span></span>

<span data-ttu-id="5d3a6-282">進行全螢幕的轉換時，DXGI 交換鏈可能會變更輸出的顯示模式。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-282">The DXGI swap chain might change the display mode of an output when making a full-screen transition.</span></span> <span data-ttu-id="5d3a6-283">若要啟用自動顯示模式變更，您必須在交換鏈描述中指定 **DXGI \_ 交換 \_ 鏈 \_ 旗標 \_ 允許 \_ 模式 \_ 切換** 。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-283">To enable the automatic display mode change, you must specify **DXGI\_SWAP\_CHAIN\_FLAG\_ALLOW\_MODE\_SWITCH** in the swap-chain description.</span></span> <span data-ttu-id="5d3a6-284">如果顯示模式自動變更，DXGI 將會選擇最適中的模式 (大小和解析度不會變更，但色彩深度可能會) 。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-284">If the display mode automatically changes, DXGI will choose the most modest mode (size and resolution will not change, but the color depth may).</span></span> <span data-ttu-id="5d3a6-285">調整交換鏈緩衝區的大小不會造成模式切換。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-285">Resizing swap chain buffers will not cause a mode switch.</span></span> <span data-ttu-id="5d3a6-286">如果您選擇的後置緩衝區完全符合目標輸出所支援的顯示模式，交換鏈就會進行隱含的承諾，然後在該輸出上輸入全螢幕模式時，切換至該顯示模式。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-286">The swap chain makes an implicit promise that if you choose a back buffer that exactly matches a display mode supported by the target output, then it will switch to that display mode when entering full-screen mode on that output.</span></span> <span data-ttu-id="5d3a6-287">因此，您可以選擇您的背景緩衝區大小和格式來選擇顯示模式。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-287">Consequently, you choose a display mode by choosing your back buffer size and format.</span></span>

### <a name="full-screen-performance-tip"></a><span data-ttu-id="5d3a6-288">全螢幕的效能秘訣</span><span class="sxs-lookup"><span data-stu-id="5d3a6-288">Full-screen performance tip</span></span>

<span data-ttu-id="5d3a6-289">當您在全螢幕應用程式上呼叫 [**IDXGISwapChain1：:P resent1**](/windows/win32/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) 時，交換鏈會翻轉 (，而不是 blits 將背景緩衝區的內容) 至前端緩衝區。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-289">When you call [**IDXGISwapChain1::Present1**](/windows/win32/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) on a full-screen application, the swap chain flips (as opposed to blits) the contents of the back buffer to the front buffer.</span></span> <span data-ttu-id="5d3a6-290">這需要使用 (在 [ [**DXGI \_ 交換 \_ 鏈] \_ DESC1**](/windows/win32/api/DXGI1_2/ns-dxgi1_2-dxgi_swap_chain_desc1)) 中指定的列舉顯示模式來建立交換鏈。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-290">This requires that the swap chain was created by using an enumerated display mode (specified in [**DXGI\_SWAP\_CHAIN\_DESC1**](/windows/win32/api/DXGI1_2/ns-dxgi1_2-dxgi_swap_chain_desc1)).</span></span> <span data-ttu-id="5d3a6-291">如果您無法列舉顯示模式，或在描述中不正確地指定顯示模式，交換鏈可能會改為執行位區塊傳輸 (bitblt) 。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-291">If you fail to enumerate display modes, or incorrectly specify the display mode in the description, the swap chain may perform a bit-block transfer (bitblt) instead.</span></span> <span data-ttu-id="5d3a6-292">Bitblt 會導致額外的延展複製以及某些提高的視頻記憶體使用量，而且難以偵測。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-292">The bitblt causes an extra stretching copy as well as some increased video memory usage, and is difficult to detect.</span></span> <span data-ttu-id="5d3a6-293">若要避免這個問題，請先列舉顯示模式，並正確地初始化交換鏈描述，再建立交換鏈。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-293">To avoid this problem, enumerate display modes, and initialize the swap chain description correctly before you create the swap chain.</span></span> <span data-ttu-id="5d3a6-294">這可確保在全螢幕模式中進行翻轉時的最大效能，並避免額外的記憶體額外負荷。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-294">This will ensure maximum performance when flipping in full-screen mode and avoid the extra memory overhead.</span></span>

### <a name="multithread-considerations"></a><span data-ttu-id="5d3a6-295">多執行緒考慮</span><span class="sxs-lookup"><span data-stu-id="5d3a6-295">Multithread considerations</span></span>

<span data-ttu-id="5d3a6-296">當您在具有多個執行緒的應用程式中使用 DXGI 時，您必須小心避免建立鎖死，而兩個不同的執行緒正在等候彼此完成。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-296">When you use DXGI in an application with multiple threads, you need to be careful to avoid creating a deadlock, where two different threads are waiting on each other to complete.</span></span> <span data-ttu-id="5d3a6-297">有兩種情況可能會發生這種情況。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-297">There are two situations where this can occur.</span></span>

-   <span data-ttu-id="5d3a6-298">轉譯執行緒不是訊息泵執行緒。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-298">The rendering thread is not the message-pump thread.</span></span>
-   <span data-ttu-id="5d3a6-299">執行 DXGI API 的執行緒與建立視窗的執行緒不同。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-299">The thread executing a DXGI API is not the same thread that created the window.</span></span>

<span data-ttu-id="5d3a6-300">當您使用全螢幕交換鏈時，請小心不要讓訊息泵執行緒在轉譯執行緒上等候。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-300">Be careful that you never have the message-pump thread wait on the render thread when you use full-screen swap chains.</span></span> <span data-ttu-id="5d3a6-301">比方說，從轉譯) 執行緒呼叫 [**IDXGISwapChain1：:P resent1**](/windows/win32/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) (可能會導致轉譯執行緒在訊息抽取執行緒上等候。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-301">For instance, calling [**IDXGISwapChain1::Present1**](/windows/win32/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) (from the render thread) may cause the render thread to wait on the message-pump thread.</span></span> <span data-ttu-id="5d3a6-302">當發生模式變更時，如果 **Present1** 呼叫：： SetWindowPos () 或：： SetWindowStyle () ，而且其中一個方法呼叫：： SendMessage () ，則可能會發生這種情況。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-302">When a mode change occurs, this scenario is possible if **Present1** calls ::SetWindowPos() or ::SetWindowStyle() and either of these methods call ::SendMessage().</span></span> <span data-ttu-id="5d3a6-303">在此案例中，如果訊息提取執行緒有重要的區段來保護它，或如果轉譯執行緒遭到封鎖，則這兩個執行緒將會鎖死。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-303">In this scenario, if the message-pump thread has a critical section guarding it or if the render thread is blocked, then the two threads will deadlock.</span></span>

<span data-ttu-id="5d3a6-304">如需搭配多個執行緒使用 DXGI 的詳細資訊，請參閱多 [執行緒和 DXGI](../direct3d11/overviews-direct3d-11-render-multi-thread-intro.md)。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-304">For more info about using DXGI with multiple threads, see [Multithreading and DXGI](../direct3d11/overviews-direct3d-11-render-multi-thread-intro.md).</span></span>

## <a name="dxgi-responses-from-dllmain"></a><span data-ttu-id="5d3a6-305">DLLMain 的 DXGI 回應</span><span class="sxs-lookup"><span data-stu-id="5d3a6-305">DXGI responses from DLLMain</span></span>

<span data-ttu-id="5d3a6-306">因為 [**DllMain**](../dlls/dllmain.md) 函式無法保證載入和卸載 dll 的順序，建議您應用程式的 **DllMain** 函式不會呼叫 Direct3D 或 DXGI 函數或方法，包括建立或釋放物件的函式或方法。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-306">Because a [**DllMain**](../dlls/dllmain.md) function can't guarantee the order in which it loads and unloads DLLs, we recommend that your app's **DllMain** function not call Direct3D or DXGI functions or methods, including functions or methods that create or release objects.</span></span> <span data-ttu-id="5d3a6-307">如果您的應用程式 **DllMain** 函式呼叫特定元件，該元件可能會呼叫作業系統上不存在的另一個 DLL，導致作業系統損毀。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-307">If your app's **DllMain** function calls into a particular component, that component might call another DLL that isn't present on the operating system, which causes the operating system to crash.</span></span> <span data-ttu-id="5d3a6-308">Direct3D 和 DXGI 可能會載入一組 Dll （通常是一組驅動程式），而這組驅動程式與電腦不同。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-308">Direct3D and DXGI might load a set of DLLs, typically a set of drivers, that differs from computer to computer.</span></span> <span data-ttu-id="5d3a6-309">因此，即使您的應用程式不會在您的開發和測試電腦上損毀，而其 **DllMain** 函式會呼叫 DIRECT3D 或 DXGI 函數或方法，但在另一部電腦上執行時可能會損毀。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-309">Therefore, even if your app doesn t crash on your development and test computers when its **DllMain** function calls Direct3D or DXGI functions or methods, it might crash when it runs on another computer.</span></span>

<span data-ttu-id="5d3a6-310">為了防止您建立可能導致作業系統損毀的應用程式，DXGI 在指定的情況下提供下列回應：</span><span class="sxs-lookup"><span data-stu-id="5d3a6-310">To prevent you from creating an app that might cause the operating system to crash, DXGI provides the following responses in the specified situations:</span></span>

-   <span data-ttu-id="5d3a6-311">如果您應用程式的 [**DllMain**](../dlls/dllmain.md) 函式釋放其對 DXGI factory 的最後一個參考，則 DXGI 會引發例外狀況。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-311">If your app's [**DllMain**](../dlls/dllmain.md) function releases its last reference to a DXGI factory, DXGI raises an exception.</span></span>
-   <span data-ttu-id="5d3a6-312">如果您的應用程式 [**DllMain**](../dlls/dllmain.md) 函式建立了 dxgi factory，則 dxgi 會傳回錯誤碼。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-312">If your app's [**DllMain**](../dlls/dllmain.md) function creates a DXGI factory, DXGI returns an error code.</span></span>

## <a name="dxgi-11-changes"></a><span data-ttu-id="5d3a6-313">DXGI 1.1 變更</span><span class="sxs-lookup"><span data-stu-id="5d3a6-313">DXGI 1.1 changes</span></span>

<span data-ttu-id="5d3a6-314">我們在 DXGI 1.1 中新增了下列功能。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-314">We added the following functionality in DXGI 1.1.</span></span>

-   <span data-ttu-id="5d3a6-315">同步處理的共用表面支援</span><span class="sxs-lookup"><span data-stu-id="5d3a6-315">Synchronized Shared Surfaces Support</span></span>

    <span data-ttu-id="5d3a6-316">適用于 Direct3D 10.1 和 Direct3D 11 的同步共用表面，可在多個 Direct3D 裝置之間進行有效率的讀取和寫入介面共用 (可) Direct3D 10 和 Direct3D 11 裝置之間的共用。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-316">Synchronized shared surfaces for Direct3D 10.1 and Direct3D 11 enables efficient read and write surface sharing between multiple Direct3D devices (sharing between Direct3D 10 and Direct3D 11 devices is possible).</span></span> <span data-ttu-id="5d3a6-317">請參閱 [**IDXGIKeyedMutex：： AcquireSync**](/windows/win32/api/DXGI/nf-dxgi-idxgikeyedmutex-acquiresync) 和 [**IDXGIKeyedMutex：： ReleaseSync**](/windows/win32/api/DXGI/nf-dxgi-idxgikeyedmutex-releasesync)。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-317">See [**IDXGIKeyedMutex::AcquireSync**](/windows/win32/api/DXGI/nf-dxgi-idxgikeyedmutex-acquiresync) and [**IDXGIKeyedMutex::ReleaseSync**](/windows/win32/api/DXGI/nf-dxgi-idxgikeyedmutex-releasesync).</span></span>

-   <span data-ttu-id="5d3a6-318">高彩支援</span><span class="sxs-lookup"><span data-stu-id="5d3a6-318">High Color Support</span></span>

    <span data-ttu-id="5d3a6-319">支援 DXGI \_ format \_ R10G10B10 \_ XR \_ 偏差 \_ A2 \_ UNORM 格式。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-319">Supports the DXGI\_FORMAT\_R10G10B10\_XR\_BIAS\_A2\_UNORM format.</span></span>

-   <span data-ttu-id="5d3a6-320">[**IDXGIDevice1：： SetMaximumFrameLatency**](/windows/win32/api/DXGI/nf-dxgi-idxgidevice1-setmaximumframelatency)和 [ **IDXGIDevice1：： GetMaximumFrameLatency**](/windows/win32/api/DXGI/nf-dxgi-idxgidevice1-getmaximumframelatency)</span><span class="sxs-lookup"><span data-stu-id="5d3a6-320">[**IDXGIDevice1::SetMaximumFrameLatency**](/windows/win32/api/DXGI/nf-dxgi-idxgidevice1-setmaximumframelatency) and [**IDXGIDevice1::GetMaximumFrameLatency**](/windows/win32/api/DXGI/nf-dxgi-idxgidevice1-getmaximumframelatency)</span></span>
-   <span data-ttu-id="5d3a6-321">[**IDXGIFactory1：： EnumAdapters1**](/windows/win32/api/DXGI/nf-dxgi-idxgifactory1-enumadapters1) 會列舉本機介面卡 (s) ，而不會連結任何監視器或輸出，以及已附加輸出) 的介面卡 (s。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-321">[**IDXGIFactory1::EnumAdapters1**](/windows/win32/api/DXGI/nf-dxgi-idxgifactory1-enumadapters1) enumerates local adapter(s) without any monitors or outputs attached, as well as adapters(s) with outputs attached.</span></span> <span data-ttu-id="5d3a6-322">第一個傳回的介面卡將是顯示桌面主要的本機介面卡。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-322">The first adapter returned will be the local adapter on which the Desktop primary is displayed.</span></span>
-   <span data-ttu-id="5d3a6-323">BGRA 格式支援</span><span class="sxs-lookup"><span data-stu-id="5d3a6-323">BGRA format support</span></span>

    <span data-ttu-id="5d3a6-324">DXGI \_ format \_ B8G8R8A8 \_ UNORM 和 dxgi \_ format \_ B8G8R8A8 \_ UNORM \_ SRGB，請參閱 [**IDXGISurface1：： GetDC**](/windows/win32/api/DXGI/nf-dxgi-idxgisurface1-getdc) 和 [**IDXGISurface1：： ReleaseDC**](/windows/win32/api/DXGI/nf-dxgi-idxgisurface1-releasedc)。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-324">DXGI\_FORMAT\_B8G8R8A8\_UNORM and DXGI\_FORMAT\_B8G8R8A8\_UNORM\_SRGB, see [**IDXGISurface1::GetDC**](/windows/win32/api/DXGI/nf-dxgi-idxgisurface1-getdc) and [**IDXGISurface1::ReleaseDC**](/windows/win32/api/DXGI/nf-dxgi-idxgisurface1-releasedc).</span></span>

## <a name="dxgi-12-changes"></a><span data-ttu-id="5d3a6-325">DXGI 1.2 變更</span><span class="sxs-lookup"><span data-stu-id="5d3a6-325">DXGI 1.2 changes</span></span>

<span data-ttu-id="5d3a6-326">我們在 DXGI 1.2 中新增了下列功能。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-326">We added the following functionality in DXGI 1.2.</span></span>

-   <span data-ttu-id="5d3a6-327">身歷聲交換鏈</span><span class="sxs-lookup"><span data-stu-id="5d3a6-327">Stereo swap chain</span></span>
-   [<span data-ttu-id="5d3a6-328">翻轉模型交換鏈</span><span class="sxs-lookup"><span data-stu-id="5d3a6-328">Flip-model swap chain</span></span>](dxgi-flip-model.md)
-   <span data-ttu-id="5d3a6-329">優化簡報 (滾動、中途矩形和旋轉) </span><span class="sxs-lookup"><span data-stu-id="5d3a6-329">Optimized presentation (scrolling, dirty rectangles, and rotation)</span></span>
-   <span data-ttu-id="5d3a6-330">改良的共用資源與同步處理</span><span class="sxs-lookup"><span data-stu-id="5d3a6-330">Improved shared resources and synchronization</span></span>
-   [<span data-ttu-id="5d3a6-331">桌面複製</span><span class="sxs-lookup"><span data-stu-id="5d3a6-331">Desktop Duplication</span></span>](desktop-dup-api.md)
-   <span data-ttu-id="5d3a6-332">優化視訊記憶體的使用</span><span class="sxs-lookup"><span data-stu-id="5d3a6-332">Optimized use of video memory</span></span>
-   <span data-ttu-id="5d3a6-333">支援每圖元16個位 (bpp) 格式 (DXGI \_ 格式 \_ B5G6R5 \_ UNORM、dxgi \_ FORMAT \_ B5G5R5A1 \_ UNORM、DXGI \_ format \_ B4G4R4A4 \_ UNORM) </span><span class="sxs-lookup"><span data-stu-id="5d3a6-333">Support for 16 bits per pixel (bpp) formats (DXGI\_FORMAT\_B5G6R5\_UNORM, DXGI\_FORMAT\_B5G5R5A1\_UNORM, DXGI\_FORMAT\_B4G4R4A4\_UNORM)</span></span>
-   <span data-ttu-id="5d3a6-334">調試 Api</span><span class="sxs-lookup"><span data-stu-id="5d3a6-334">Debugging APIs</span></span>

<span data-ttu-id="5d3a6-335">如需有關 DXGI 1.2 的詳細資訊，請參閱 [dxgi 1.2 增強功能](dxgi-1-2-improvements.md)。</span><span class="sxs-lookup"><span data-stu-id="5d3a6-335">For more info about DXGI 1.2, see [DXGI 1.2 Improvements](dxgi-1-2-improvements.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="5d3a6-336">相關主題</span><span class="sxs-lookup"><span data-stu-id="5d3a6-336">Related topics</span></span>

[<span data-ttu-id="5d3a6-337">DXGI 的程式設計指南</span><span class="sxs-lookup"><span data-stu-id="5d3a6-337">Programming Guide for DXGI</span></span>](dx-graphics-dxgi-overviews.md)
