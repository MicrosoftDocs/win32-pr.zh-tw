---
description: 控制呼叫函式行為的旗標。 由 SHCreateThread 和 SHCreateThreadWithHandle 使用。 在這些函數中，這些值會定義為 SHCT \_ 旗標的類型。
title: 'CTF 旗標 (Shlwapi .h) '
ms.topic: reference
ms.date: 05/31/2018
ms.assetid: 66cda866-7a39-4c5a-a795-a4c5c64cbab7
api_name:
- CTF_INSIST
- CTF_THREAD_REF
- CTF_PROCESS_REF
- CTF_COINIT_STA
- CTF_COINIT
- CTF_FREELIBANDEXIT
- CTF_REF_COUNTED
- CTF_WAIT_ALLOWCOM
- CTF_UNUSED
- CTF_INHERITWOW64
- CTF_WAIT_NO_REENTRANCY
- CTF_KEYBOARD_LOCALE
- CTF_OLEINITIALIZE
- CTF_COINIT_MTA
- CTF_NOADDREFLIB
api_type:
- HeaderDef
api_location:
- Shlwapi.h
topic_type:
- APIRef
- kbSyntax
ms.openlocfilehash: bfad2b2e662a80501d0f869d6f9e7849e01c5dcc3e949834b698a3c583fef3d6
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/11/2021
ms.locfileid: "118224842"
---
# <a name="ctf-flags"></a>CTF 旗標

控制呼叫函式行為的旗標。 由 [**SHCreateThread**](/windows/desktop/api/Shlwapi/nf-shlwapi-shcreatethread) 和 [**SHCreateThreadWithHandle**](/windows/desktop/api/Shlwapi/nf-shlwapi-shcreatethreadwithhandle)使用。 在這些函數中，這些值會定義為 SHCT \_ 旗標的類型。



| 常數/值                                                                                                                                                                                                                                             | 描述                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span id="CTF_INSIST"></span><span id="ctf_insist"></span><dl> <dt>**CTF \_堅持**</dt> <dt>0x00000001</dt> </dl>                                       | 0x00000001. 如果嘗試以 [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread) 建立執行緒失敗，設定這個旗標會導致 *pfnThreadProc* 所指向的函式，以同步方式從呼叫執行緒呼叫。 只有當 *pfnCallback* 為 **Null** 時，才能使用此旗標。<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| <span id="CTF_THREAD_REF"></span><span id="ctf_thread_ref"></span><dl> <dt>**CTF \_執行緒 \_ REF**</dt> <dt>0x00000002</dt> </dl>                          | 0x00000002. 在呼叫 *pfnThreadProc* 所指向的函式期間，保留建立執行緒的參考。 此參考必須已設定 [**SHSetThreadRef**](/windows/desktop/api/Shlwapi/nf-shlwapi-shsetthreadref)。<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| <span id="CTF_PROCESS_REF"></span><span id="ctf_process_ref"></span><dl> <dt>**CTF \_進程 \_ REF**</dt> <dt>0x00000004</dt> </dl>                       | 0x00000004. 在呼叫 *pfnThreadProc* 所指向的函式期間，保留對 Windows 檔案總管進程的參考。 此旗標適用于[Shell 延伸模組處理常式](handlers.md)，可能需要讓 Windows 檔案總管進程無法提前關閉。 在工作（例如在背景執行緒或複製檔案）時，這個動作很有用。 如需詳細資訊，請參閱 [**SHGetInstanceExplorer**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shgetinstanceexplorer)。<br/>                                                                                                                                                                                                                                                                                                                                                                                                                  |
| <span id="CTF_COINIT_STA"></span><span id="ctf_coinit_sta"></span><dl> <dt>**CTF \_COINIT \_ STA**</dt> <dt>0x00000008</dt> </dl>                          | 0x00000008. 在呼叫 *pfnCallback* 所指向的選擇性函式或 *pfnThreadProc* 所指向的函式之前，先將 COM 初始化為所建立執行緒的單一線程單元 (STA) 。 當 COM 需要針對執行緒初始化時，此旗標很有用。 COM 也會自動初始化。<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| <span id="CTF_COINIT"></span><span id="ctf_coinit"></span><dl> <dt>**CTF \_COINIT**</dt> <dt>0x00000008</dt> </dl>                                       | 相當於 CTF \_ COINIT \_ STA。<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| <span id="CTF_FREELIBANDEXIT"></span><span id="ctf_freelibandexit"></span><dl> <dt>**CTF \_FREELIBANDEXIT**</dt> <dt>0x00000010</dt> </dl>               | 0x00000010. **Internet Explorer 6 或更新版本。** 將會在包含 *pfnThreadProc* 函式的 DLL 上呼叫 [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) ，以防止其卸載。 *PfnThreadProc* 傳回之後，會使用 [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary)釋放 dll，藉此減少 dll 參考計數。 傳遞此旗標以防止 DLL 提前卸載;例如， [**CoFreeUnusedLibraries**](/windows/win32/api/combaseapi/nf-combaseapi-cofreeunusedlibraries)。 請注意，如果傳遞此旗標， *pfnThreadProc* 函式必須位於 DLL 中。 此旗標在 Windows Vista 和更新版本中是隱含的。<br/>                                                                                                                                                                                                                                                                   |
| <span id="CTF_REF_COUNTED"></span><span id="ctf_ref_counted"></span><dl> <dt>**CTF \_參考 \_ 計數**</dt> <dt>0x00000020</dt> </dl>                       | 0x00000020. **Internet Explorer 6 或更新版本。** 系統會自動為所建立的執行緒建立執行緒參考，並使用 [**SHSetThreadRef**](/windows/desktop/api/Shlwapi/nf-shlwapi-shsetthreadref)進行設定。 在 *pfnThreadProc* 傳回之後，會釋放執行緒參考並傳送訊息，直到執行緒參考上的參考計數降至零為止，也就是，直到相依于所建立執行緒的執行緒釋放其參考為止。<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| <span id="CTF_WAIT_ALLOWCOM"></span><span id="ctf_wait_allowcom"></span><dl> <dt>**CTF \_等候 \_ ALLOWCOM**</dt> <dt>0x00000040</dt> </dl>                 | 0x00000040. **Internet Explorer 6 或更新版本。** 呼叫執行緒會等待並提取 COM 和 [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage) 訊息。 如果同步程式嘗試將具有 **SendMessage** 的 Windows 訊息傳送至裝載于呼叫執行緒上的視窗，訊息將會成功抵達。 如果同步程式嘗試使用 COM 與裝載于呼叫執行緒上的 STA 物件進行通訊，則函式呼叫會成功抵達預定的物件。 呼叫端執行緒會開啟以重新進入脆弱數。 雖然呼叫執行緒可以處理 **SendMessage** 和 com 的同步程式，但如果其他執行緒使用 **SendMessage** 或 com 來與呼叫執行緒上裝載的物件進行通訊，則這些可能是未預期的訊息或在同步程式完成時處理的函式呼叫。<br/> |
| <span id="CTF_UNUSED"></span><span id="ctf_unused"></span><dl> <dt>**CTF \_未使用**</dt>的 <dt>0x00000080</dt> </dl>                                       | 0x00000080. **Internet Explorer 7 或更新版本。** 未使用。<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| <span id="CTF_INHERITWOW64"></span><span id="ctf_inheritwow64"></span><dl> <dt>**CTF \_INHERITWOW64**</dt> <dt>0x00000100</dt> </dl>                     | 0x00000100. **Internet Explorer 7 或更新版本。** 新的執行緒會繼承 Windows 64 位的 Windows (WOW64) 停用檔案系統重新導向器的狀態。<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| <span id="CTF_WAIT_NO_REENTRANCY"></span><span id="ctf_wait_no_reentrancy"></span><dl> <dt>**CTF \_等候 \_ 無 \_**</dt>重新進入 <dt>0x00000200</dt> </dl> | 0x00000200. **WindowsVista 或更新版本。** 呼叫執行緒會在等候同步程式在新執行緒上執行時，封鎖所有其他進程。 如果同步程式嘗試將具有 [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage)的 Windows 訊息傳送至裝載于呼叫執行緒上的視窗，這會導致同步程式鎖死。 如果同步程式嘗試使用 COM 來與裝載于呼叫執行緒上的 STA 物件通訊，這也會導致同步程式鎖死。 藉由指定此旗標，呼叫執行緒會受到保護，以防止所有重新進入的考慮。<br/>                                                                                                                                                                                                                                                                |
| <span id="CTF_KEYBOARD_LOCALE"></span><span id="ctf_keyboard_locale"></span><dl> <dt>**CTF \_鍵盤 \_ 地區**</dt>設定 <dt>0x00000400</dt> </dl>           | 0x00000400. **Windows 7 或更新版本。** 在它所產生的新執行緒中，使用來自原始執行緒的鍵盤地區設定。<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| <span id="CTF_OLEINITIALIZE"></span><span id="ctf_oleinitialize"></span><dl> <dt>**CTF \_OLEINITIALIZE**</dt> <dt>0x00000800</dt> </dl>                  | 0x00000800. **Windows 7 或更新版本。** 針對建立的執行緒，使用單一執行緒的單元 (STA) 模型初始化 COM。<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| <span id="CTF_COINIT_MTA"></span><span id="ctf_coinit_mta"></span><dl> <dt>**CTF \_COINIT \_ MTA**</dt> <dt>0x00001000</dt> </dl>                          | 0x00001000. **Windows 7 和更新版本**。 使用建立之執行緒的多執行緒單元 (MTA) 模型初始化 COM。<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| <span id="CTF_NOADDREFLIB"></span><span id="ctf_noaddreflib"></span><dl> <dt>**CTF \_NOADDREFLIB**</dt> <dt>0x00002000</dt> </dl>                        | 0x00002000. **Windows 7 或更新版本。** 此旗標基本上與 CTF FREELIBANDEXIT 相反 \_ 。 這 [](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) / 可避免可能導致載入器鎖定爭用的 LoadLibrary [**FreeLibraryAndExitThread**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibraryandexitthread)呼叫。 \_只有當新執行緒有方法可確保原始執行緒程式的程式碼仍會保持載入時，才使用 CTF NOADDREFLIB。 此值不應該用於 COM 物件的內容中，因為 COM 物件必須確保 DLL 會保持載入 (正常，COM 會將 Dll) 。<br/>                                                                                                                                                                                                                                                                                                                    |



## <a name="remarks"></a>備註

如果未 \_ 指定 CTF WAIT \_ 旗標，呼叫執行緒將會等候並傳送 [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage) 訊息。 如果同步程式嘗試將具有 **SendMessage** 的 Windows 訊息傳送至裝載于呼叫執行緒上的視窗，訊息將會進入預期的視窗。 如果同步程式嘗試使用 COM 來與裝載于呼叫執行緒上的 STA 物件通訊，同步程式將會鎖死。 呼叫端執行緒會開啟以重新進入脆弱數。 雖然呼叫執行緒可以處理同步程式使用 **SendMessage**，但如果其他執行緒使用 **SendMessage** 來與呼叫執行緒上裝載的視窗進行通訊，則這些訊息可能是非預期的。 這可能會在同步程式完成時進行處理。

## <a name="requirements"></a>規格需求



| 需求 | 值 |
|-------------------------------------|--------------------------------------------------------------------------------------|
| 最低支援的用戶端<br/> | Windows 2000 Professional、Windows XP、Windows 7 \[ 桌面應用程式\]<br/>    |
| 最低支援的伺服器<br/> | Windows 2000 Server \[僅限傳統型應用程式\]<br/>                                 |
| 標頭<br/>                   | <dl> <dt>Shlwapi。h</dt> </dl> |



 

 
