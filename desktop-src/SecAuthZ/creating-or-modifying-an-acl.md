---
description: Windows 支援一組函式來建立存取控制清單 (ACL) 或修改現有 ACL (Ace) 的存取控制專案。
ms.assetid: 71301aab-1040-4f61-855f-2b891c8b6077
title: 建立或修改 ACL
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a0deb72bcd1a1c805dd8524027601952dda0eac1
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "103848355"
---
# <a name="creating-or-modifying-an-acl"></a><span data-ttu-id="17d7d-103">建立或修改 ACL</span><span class="sxs-lookup"><span data-stu-id="17d7d-103">Creating or Modifying an ACL</span></span>

<span data-ttu-id="17d7d-104">Windows 支援一組函式來建立 [*存取控制清單*](/windows/desktop/SecGloss/a-gly) (ACL) 或修改現有 Acl (ace) 的 [*存取控制專案*](/windows/desktop/SecGloss/a-gly) 。</span><span class="sxs-lookup"><span data-stu-id="17d7d-104">Windows supports a set of functions that create an [*access control list*](/windows/desktop/SecGloss/a-gly) (ACL) or modify the [*access control entries*](/windows/desktop/SecGloss/a-gly) (ACEs) in an existing ACL.</span></span>

<span data-ttu-id="17d7d-105">[**SetEntriesInAcl**](/windows/desktop/api/Aclapi/nf-aclapi-setentriesinacla)函式會建立新的 ACL。</span><span class="sxs-lookup"><span data-stu-id="17d7d-105">The [**SetEntriesInAcl**](/windows/desktop/api/Aclapi/nf-aclapi-setentriesinacla) function creates a new ACL.</span></span> <span data-ttu-id="17d7d-106">**SetEntriesInAcl** 可以為 ACL 指定一組全新的 ace，也可以使用現有 ACL 的 ace 來合併一或多個新的 ace。</span><span class="sxs-lookup"><span data-stu-id="17d7d-106">**SetEntriesInAcl** can specify a completely new set of ACEs for the ACL, or it can merge one or more new ACEs with the ACEs of an existing ACL.</span></span> <span data-ttu-id="17d7d-107">**SetEntriesInAcl** 函數會使用 [**明確 \_ 存取**](/windows/desktop/api/AccCtrl/ns-accctrl-explicit_access_a)結構的陣列來指定新 ace 的資訊。</span><span class="sxs-lookup"><span data-stu-id="17d7d-107">The **SetEntriesInAcl** function uses an array of [**EXPLICIT\_ACCESS**](/windows/desktop/api/AccCtrl/ns-accctrl-explicit_access_a) structures to specify the information for the new ACEs.</span></span> <span data-ttu-id="17d7d-108">每個 **明確的 \_ 存取** 結構都會包含描述單一 ACE 的資訊。</span><span class="sxs-lookup"><span data-stu-id="17d7d-108">Each **EXPLICIT\_ACCESS** structure contains information that describes a single ACE.</span></span> <span data-ttu-id="17d7d-109">這項資訊包括存取權限、ACE 類型、控制 ACE 繼承的旗標，以及識別信任者的 [**信任**](/windows/desktop/api/AccCtrl/ns-accctrl-trustee_a) 結構。</span><span class="sxs-lookup"><span data-stu-id="17d7d-109">This information includes the access rights, the type of ACE, the flags that control ACE inheritance, and a [**TRUSTEE**](/windows/desktop/api/AccCtrl/ns-accctrl-trustee_a) structure that identifies the trustee.</span></span>

<span data-ttu-id="17d7d-110">**將新的 ACE 新增至現有的 ACL**</span><span class="sxs-lookup"><span data-stu-id="17d7d-110">**To add a new ACE to an existing ACL**</span></span>

1.  <span data-ttu-id="17d7d-111">使用 [**GetSecurityInfo**](/windows/desktop/api/Aclapi/nf-aclapi-getsecurityinfo) 或 [**GetNamedSecurityInfo**](/windows/desktop/api/Aclapi/nf-aclapi-getnamedsecurityinfoa) 函數，從物件的 [*安全描述項*](/windows/desktop/SecGloss/s-gly)取得現有的 DACL 或 SACL。</span><span class="sxs-lookup"><span data-stu-id="17d7d-111">Use the [**GetSecurityInfo**](/windows/desktop/api/Aclapi/nf-aclapi-getsecurityinfo) or [**GetNamedSecurityInfo**](/windows/desktop/api/Aclapi/nf-aclapi-getnamedsecurityinfoa) function to get the existing DACL or SACL from an object's [*security descriptor*](/windows/desktop/SecGloss/s-gly).</span></span>
2.  <span data-ttu-id="17d7d-112">針對每個新的 ACE 呼叫 [**BuildExplicitAccessWithName**](/windows/desktop/api/Aclapi/nf-aclapi-buildexplicitaccesswithnamea) 函式，以使用描述 ACE 的資訊來填滿 [**明確的 \_ 存取**](/windows/desktop/api/AccCtrl/ns-accctrl-explicit_access_a) 結構。</span><span class="sxs-lookup"><span data-stu-id="17d7d-112">For each new ACE, call the [**BuildExplicitAccessWithName**](/windows/desktop/api/Aclapi/nf-aclapi-buildexplicitaccesswithnamea) function to fill an [**EXPLICIT\_ACCESS**](/windows/desktop/api/AccCtrl/ns-accctrl-explicit_access_a) structure with the information that describes the ACE.</span></span>
3.  <span data-ttu-id="17d7d-113">呼叫 [**SetEntriesInAcl**](/windows/desktop/api/Aclapi/nf-aclapi-setentriesinacla)，為新的 ace 指定現有的 ACL 和 [**明確 \_ 存取**](/windows/desktop/api/AccCtrl/ns-accctrl-explicit_access_a) 結構的陣列。</span><span class="sxs-lookup"><span data-stu-id="17d7d-113">Call [**SetEntriesInAcl**](/windows/desktop/api/Aclapi/nf-aclapi-setentriesinacla), specifying the existing ACL and an array of [**EXPLICIT\_ACCESS**](/windows/desktop/api/AccCtrl/ns-accctrl-explicit_access_a) structures for the new ACEs.</span></span> <span data-ttu-id="17d7d-114">**SetEntriesInAcl** 函式會配置並初始化 ACL 及其 ace。</span><span class="sxs-lookup"><span data-stu-id="17d7d-114">The **SetEntriesInAcl** function allocates and initializes the ACL and its ACEs.</span></span>
4.  <span data-ttu-id="17d7d-115">呼叫 [**SetSecurityInfo**](/windows/desktop/api/Aclapi/nf-aclapi-setsecurityinfo) 或 [**SetNamedSecurityInfo**](/windows/desktop/api/Aclapi/nf-aclapi-setnamedsecurityinfoa) 函數，將新的 ACL 附加至物件的安全描述項。</span><span class="sxs-lookup"><span data-stu-id="17d7d-115">Call the [**SetSecurityInfo**](/windows/desktop/api/Aclapi/nf-aclapi-setsecurityinfo) or [**SetNamedSecurityInfo**](/windows/desktop/api/Aclapi/nf-aclapi-setnamedsecurityinfoa) function to attach the new ACL to the object's security descriptor.</span></span>

<span data-ttu-id="17d7d-116">如果呼叫端指定現有的 ACL， [**SetEntriesInAcl**](/windows/desktop/api/Aclapi/nf-aclapi-setentriesinacla) 會將新的 ace 資訊與 acl 中的現有 ace 合併。</span><span class="sxs-lookup"><span data-stu-id="17d7d-116">If the caller specifies an existing ACL, [**SetEntriesInAcl**](/windows/desktop/api/Aclapi/nf-aclapi-setentriesinacla) merges the new ACE information with the existing ACEs in the ACL.</span></span> <span data-ttu-id="17d7d-117">例如，假設現有的 ACL 會授與指定之受信任者的存取權，而 [**明確的 \_ 存取**](/windows/desktop/api/AccCtrl/ns-accctrl-explicit_access_a) 結構會拒絕對相同信任者的存取。</span><span class="sxs-lookup"><span data-stu-id="17d7d-117">Consider the case, for example, in which the existing ACL grants access to a specified trustee and an [**EXPLICIT\_ACCESS**](/windows/desktop/api/AccCtrl/ns-accctrl-explicit_access_a) structure denies access to the same trustee.</span></span> <span data-ttu-id="17d7d-118">在此情況下， **SetEntriesInAcl** 會為信任者新增拒絕存取拒絕的 ace，並刪除或修改受信任者的現有存取權允許 ace。</span><span class="sxs-lookup"><span data-stu-id="17d7d-118">In this case, **SetEntriesInAcl** adds a new access-denied ACE for the trustee and deletes or modifies the existing access-allowed ACE for the trustee.</span></span>

<span data-ttu-id="17d7d-119">如需將新的 ACE 合併至現有 ACL 的範例程式碼，請參閱 [使用 c + + 修改物件的 acl](modifying-the-acls-of-an-object-in-c--.md)。</span><span class="sxs-lookup"><span data-stu-id="17d7d-119">For sample code that merges a new ACE into an existing ACL, see [Modifying the ACLs of an Object in C++](modifying-the-acls-of-an-object-in-c--.md).</span></span>

 

 
