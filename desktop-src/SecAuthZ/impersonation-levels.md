---
description: 安全性 \_ \_ 模擬層級列舉會定義四個模擬等級，以決定伺服器可在用戶端內容中執行的作業。
ms.assetid: ae152dbf-44f0-417f-a85e-09bf60dcfcb0
title: " (授權) 的模擬層級"
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b91654f42a86e5c47069197bed084df56f5445dd
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "106984680"
---
# <a name="impersonation-levels-authorization"></a><span data-ttu-id="89a52-103"> (授權) 的模擬層級</span><span class="sxs-lookup"><span data-stu-id="89a52-103">Impersonation Levels (Authorization)</span></span>

<span data-ttu-id="89a52-104">[**安全性模擬 \_ \_ 層級**](/windows/desktop/api/Winnt/ne-winnt-security_impersonation_level)列舉會定義四個模擬等級，以決定伺服器可在用戶端內容中執行的作業。</span><span class="sxs-lookup"><span data-stu-id="89a52-104">The [**SECURITY\_IMPERSONATION\_LEVEL**](/windows/desktop/api/Winnt/ne-winnt-security_impersonation_level) enumeration defines four impersonation levels that determine the operations a server can perform in the client's context.</span></span>



| <span data-ttu-id="89a52-105">模擬等級</span><span class="sxs-lookup"><span data-stu-id="89a52-105">Impersonation level</span></span>    | <span data-ttu-id="89a52-106">Description</span><span class="sxs-lookup"><span data-stu-id="89a52-106">Description</span></span>                                                                                      |
|------------------------|--------------------------------------------------------------------------------------------------|
| <span data-ttu-id="89a52-107">SecurityAnonymous</span><span class="sxs-lookup"><span data-stu-id="89a52-107">SecurityAnonymous</span></span>      | <span data-ttu-id="89a52-108">伺服器無法模擬或識別用戶端。</span><span class="sxs-lookup"><span data-stu-id="89a52-108">The server cannot impersonate or identify the client.</span></span>                                            |
| <span data-ttu-id="89a52-109">SecurityIdentification</span><span class="sxs-lookup"><span data-stu-id="89a52-109">SecurityIdentification</span></span> | <span data-ttu-id="89a52-110">伺服器可以取得用戶端的身分識別和許可權，但無法模擬用戶端。</span><span class="sxs-lookup"><span data-stu-id="89a52-110">The server can get the identity and privileges of the client, but cannot impersonate the client.</span></span> |
| <span data-ttu-id="89a52-111">SecurityImpersonation</span><span class="sxs-lookup"><span data-stu-id="89a52-111">SecurityImpersonation</span></span>  | <span data-ttu-id="89a52-112">伺服器可以在本機系統上模擬用戶端的安全性內容。</span><span class="sxs-lookup"><span data-stu-id="89a52-112">The server can impersonate the client's security context on the local system.</span></span>                    |
| <span data-ttu-id="89a52-113">SecurityDelegation</span><span class="sxs-lookup"><span data-stu-id="89a52-113">SecurityDelegation</span></span>     | <span data-ttu-id="89a52-114">伺服器可以在遠端系統上模擬用戶端的安全性內容。</span><span class="sxs-lookup"><span data-stu-id="89a52-114">The server can impersonate the client's security context on remote systems.</span></span>                      |



 

<span data-ttu-id="89a52-115">具名管道、RPC 或 DDE 連接的用戶端可以控制模擬層級。</span><span class="sxs-lookup"><span data-stu-id="89a52-115">The client of a named pipe, RPC, or DDE connection can control the impersonation level.</span></span> <span data-ttu-id="89a52-116">例如，具名管道用戶端可以呼叫 [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) 函數來開啟具名管道的控制碼，並指定伺服器的模擬等級。</span><span class="sxs-lookup"><span data-stu-id="89a52-116">For example, a named pipe client can call the [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) function to open a handle to a named pipe and specify the server's impersonation level.</span></span>

<span data-ttu-id="89a52-117">當具名管道、RPC 或 DDE 連接是遠端時，會忽略傳遞至 [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) 以設定模擬等級的旗標。</span><span class="sxs-lookup"><span data-stu-id="89a52-117">When the named pipe, RPC, or DDE connection is remote, the flags passed to [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) to set the impersonation level are ignored.</span></span> <span data-ttu-id="89a52-118">在此情況下，用戶端的模擬層級取決於伺服器啟用的模擬等級，這是由目錄服務中伺服器帳戶上的旗標所設定。</span><span class="sxs-lookup"><span data-stu-id="89a52-118">In this case, the impersonation level of the client is determined by the impersonation levels enabled by the server, which is set by a flag on the server's account in the directory service.</span></span> <span data-ttu-id="89a52-119">例如，如果伺服器已啟用委派，即使傳遞給 **CreateFile** 的旗標指定了識別模擬等級，用戶端的模擬等級也會設定為委派。</span><span class="sxs-lookup"><span data-stu-id="89a52-119">For example, if the server is enabled for delegation, the client's impersonation level will also be set to delegation even if the flags passed to **CreateFile** specify the identification impersonation level.</span></span>

<span data-ttu-id="89a52-120">DDE 用戶端會使用 [**DdeSetQualityOfService**](/windows/win32/api/dde/nf-dde-ddesetqualityofservice) 函數搭配 [**\_ \_ \_ 服務結構的安全性品質**](/windows/desktop/api/Winnt/ns-winnt-security_quality_of_service) 來指定模擬等級。</span><span class="sxs-lookup"><span data-stu-id="89a52-120">DDE clients use the [**DdeSetQualityOfService**](/windows/win32/api/dde/nf-dde-ddesetqualityofservice) function with the [**SECURITY\_QUALITY\_OF\_SERVICE**](/windows/desktop/api/Winnt/ns-winnt-security_quality_of_service) structure to specify the impersonation level.</span></span> <span data-ttu-id="89a52-121">SecurityImpersonation 層級是具名管道、RPC 和 DDE 伺服器的預設值。</span><span class="sxs-lookup"><span data-stu-id="89a52-121">The SecurityImpersonation level is the default for named pipe, RPC, and DDE servers.</span></span> <span data-ttu-id="89a52-122">[**ImpersonateSelf**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-impersonateself)、 [**DuplicateToken**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-duplicatetoken)和 [**DuplicateTokenEx**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-duplicatetokenex)函數可讓呼叫者指定模擬層級。</span><span class="sxs-lookup"><span data-stu-id="89a52-122">The [**ImpersonateSelf**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-impersonateself), [**DuplicateToken**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-duplicatetoken), and [**DuplicateTokenEx**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-duplicatetokenex) functions allow the caller to specify an impersonation level.</span></span> <span data-ttu-id="89a52-123">使用 [**GetTokenInformation**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-gettokeninformation) 函式來取得 [*存取權杖*](/windows/desktop/SecGloss/a-gly)的模擬層級。</span><span class="sxs-lookup"><span data-stu-id="89a52-123">Use the [**GetTokenInformation**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-gettokeninformation) function to retrieve the impersonation level of an [*access token*](/windows/desktop/SecGloss/a-gly).</span></span>

<span data-ttu-id="89a52-124">在 SecurityImpersonation 層級，大部分執行緒的動作都會發生線上程模擬 [*權杖*](/windows/desktop/SecGloss/i-gly)的安全性內容中，而不是在擁有線程之 [*進程*](/windows/desktop/SecGloss/p-gly)的 [*主要權杖*](/windows/desktop/SecGloss/p-gly)中。</span><span class="sxs-lookup"><span data-stu-id="89a52-124">At the SecurityImpersonation level, most of the thread's actions occur in the security context of the thread's [*impersonation token*](/windows/desktop/SecGloss/i-gly) rather than in the [*primary token*](/windows/desktop/SecGloss/p-gly) of the [*process*](/windows/desktop/SecGloss/p-gly) that owns the thread.</span></span> <span data-ttu-id="89a52-125">例如，如果模擬執行緒開啟 [安全物件](securable-objects.md)，系統就會使用模擬權杖來檢查執行緒的存取。</span><span class="sxs-lookup"><span data-stu-id="89a52-125">For example, if an impersonating thread opens a [securable object](securable-objects.md), the system uses the impersonation token to check the thread's access.</span></span> <span data-ttu-id="89a52-126">同樣地，如果模擬執行緒建立新的物件，例如藉由呼叫 [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) 函式，新物件的擁有者就是用戶端 [*存取權杖*](/windows/desktop/SecGloss/a-gly)的預設擁有者。</span><span class="sxs-lookup"><span data-stu-id="89a52-126">Similarly, if an impersonating thread creates a new object, for example by calling the [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) function, the owner of the new object is the default owner from the client's [*access token*](/windows/desktop/SecGloss/a-gly).</span></span>

<span data-ttu-id="89a52-127">不過，在下列情況下，系統會使用進程的主要權杖，而不是呼叫執行緒的模擬權杖：</span><span class="sxs-lookup"><span data-stu-id="89a52-127">However, the system uses the primary token of the process rather than the impersonation token of the calling thread in the following situations:</span></span>

-   <span data-ttu-id="89a52-128">如果模擬執行緒呼叫 [**CreateProcess**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessa) 函數，則新的進程一律會繼承進程的主要 token。</span><span class="sxs-lookup"><span data-stu-id="89a52-128">If an impersonating thread calls the [**CreateProcess**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessa) function, the new process always inherits the primary token of the process.</span></span>
-   <span data-ttu-id="89a52-129">對於需要 SE TCB 名稱許可權的函式（ \_ \_ 例如 [**LogonUser**](/windows/desktop/api/winbase/nf-winbase-logonusera) 函數），系統一律會檢查進程主要權杖中的許可權。</span><span class="sxs-lookup"><span data-stu-id="89a52-129">For functions that require the SE\_TCB\_NAME privilege, such as the [**LogonUser**](/windows/desktop/api/winbase/nf-winbase-logonusera) function, the system always checks for the privilege in the primary token of the process.</span></span>
-   <span data-ttu-id="89a52-130">對於需要 SE AUDIT NAME 許可權的函式（ \_ \_ 例如 [**ObjectOpenAuditAlarm**](/windows/desktop/api/Winbase/nf-winbase-objectopenauditalarma) 函式），系統一律會檢查進程主要權杖中的許可權。</span><span class="sxs-lookup"><span data-stu-id="89a52-130">For functions that require the SE\_AUDIT\_NAME privilege, such as the [**ObjectOpenAuditAlarm**](/windows/desktop/api/Winbase/nf-winbase-objectopenauditalarma) function, the system always checks for the privilege in the primary token of the process.</span></span>
-   <span data-ttu-id="89a52-131">在 [**OpenThreadToken**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-openthreadtoken) 函式的呼叫中，執行緒可以指定函式是否使用模擬權杖或主要權杖來判斷是否要授與要求的存取權。</span><span class="sxs-lookup"><span data-stu-id="89a52-131">In a call to the [**OpenThreadToken**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-openthreadtoken) function, a thread can specify whether the function uses the impersonation token or the primary token to determine whether to grant the requested access.</span></span>

 

 
