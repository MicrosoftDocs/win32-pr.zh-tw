---
description: 提供機制來控制安全物件的存取。
ms.assetid: 5923cb4c-f663-40d2-989a-07d71ac475db
title: 認證相符控制
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c184ba01da0a55309fcb27ace9b0fe156edd6425
ms.sourcegitcommit: 4570ac533e129ff88b23f2c2b69e0140ead3a4a4
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/26/2021
ms.locfileid: "106995115"
---
# <a name="mandatory-integrity-control"></a><span data-ttu-id="09d2d-103">認證相符控制</span><span class="sxs-lookup"><span data-stu-id="09d2d-103">Mandatory Integrity Control</span></span>

<span data-ttu-id="09d2d-104">認證相符控制 (MIC) 提供一種機制來控制安全物件的存取。</span><span class="sxs-lookup"><span data-stu-id="09d2d-104">Mandatory Integrity Control (MIC) provides a mechanism for controlling access to securable objects.</span></span> <span data-ttu-id="09d2d-105">這項機制除了任意存取控制之外，還會評估存取權，然後再對物件的 [*任意存取控制清單*](/windows/desktop/SecGloss/d-gly) 進行存取檢查， (DACL) 會進行評估。</span><span class="sxs-lookup"><span data-stu-id="09d2d-105">This mechanism is in addition to discretionary access control and evaluates access before access checks against an object's [*discretionary access control list*](/windows/desktop/SecGloss/d-gly) (DACL) are evaluated.</span></span>

<span data-ttu-id="09d2d-106">MIC 使用完整性層級和強制性原則來評估存取權。</span><span class="sxs-lookup"><span data-stu-id="09d2d-106">MIC uses integrity levels and mandatory policy to evaluate access.</span></span> <span data-ttu-id="09d2d-107">[*安全性主體*](/windows/desktop/SecGloss/s-gly) 和安全物件會被指派完整性層級，以決定其保護或存取層級。</span><span class="sxs-lookup"><span data-stu-id="09d2d-107">[*Security principals*](/windows/desktop/SecGloss/s-gly) and securable objects are assigned integrity levels that determine their levels of protection or access.</span></span> <span data-ttu-id="09d2d-108">例如，低完整性層級的主體無法寫入具有中度完整性層級的物件，即使該物件的 DACL 允許主體的寫入存取權也一樣。</span><span class="sxs-lookup"><span data-stu-id="09d2d-108">For example, a principal with a low integrity level cannot write to an object with a medium integrity level, even if that object's DACL allows write access to the principal.</span></span>

<span data-ttu-id="09d2d-109">Windows 定義四個完整性層級：低、中、高和系統。</span><span class="sxs-lookup"><span data-stu-id="09d2d-109">Windows defines four integrity levels: low, medium, high, and system.</span></span> <span data-ttu-id="09d2d-110">標準使用者會收到中高許可權的使用者。</span><span class="sxs-lookup"><span data-stu-id="09d2d-110">Standard users receive medium, elevated users receive high.</span></span> <span data-ttu-id="09d2d-111">如果可執行檔的層級很低，您所建立的進程和您所建立的物件會收到您的完整性層級 (中或高) 或低;系統服務接收系統完整性。</span><span class="sxs-lookup"><span data-stu-id="09d2d-111">Processes you start and objects you create receive your integrity level (medium or high) or low if the executable file's level is low; system services receive system integrity.</span></span> <span data-ttu-id="09d2d-112">系統會將缺少完整性標籤的物件視為「中」，這可防止低完整性程式碼修改未標記的物件。</span><span class="sxs-lookup"><span data-stu-id="09d2d-112">Objects that lack an integrity label are treated as medium by the operating system; this prevents low-integrity code from modifying unlabeled objects.</span></span> <span data-ttu-id="09d2d-113">此外，Windows 還可確保以低完整性層級執行的進程無法取得與應用程式容器相關聯之進程的存取權。</span><span class="sxs-lookup"><span data-stu-id="09d2d-113">Additionally, Windows ensures that processes running with a low integrity level cannot obtain access to a process which is associated with an app container.</span></span>

## <a name="integrity-labels"></a><span data-ttu-id="09d2d-114">完整性標籤</span><span class="sxs-lookup"><span data-stu-id="09d2d-114">Integrity Labels</span></span>

<span data-ttu-id="09d2d-115">完整性標籤會指定安全物件和安全性主體的完整性層級。</span><span class="sxs-lookup"><span data-stu-id="09d2d-115">Integrity labels specify the integrity levels of securable objects and security principals.</span></span> <span data-ttu-id="09d2d-116">完整性標籤會以 [*完整性 sid*](/windows/desktop/SecGloss/i-gly)表示。</span><span class="sxs-lookup"><span data-stu-id="09d2d-116">Integrity labels are represented by [*integrity SIDs*](/windows/desktop/SecGloss/i-gly).</span></span> <span data-ttu-id="09d2d-117">安全物件的完整性 SID 會儲存在其 [*系統存取控制清單*](/windows/desktop/SecGloss/s-gly) 中， (SACL) 。</span><span class="sxs-lookup"><span data-stu-id="09d2d-117">The integrity SID for a securable object is stored in its [*system access control list*](/windows/desktop/SecGloss/s-gly) (SACL).</span></span> <span data-ttu-id="09d2d-118">SACL 包含 [**系統 \_ 強制 \_ 標籤 \_ ACE**](/windows/desktop/api/Winnt/ns-winnt-system_mandatory_label_ace) [*存取控制專案*](/windows/desktop/SecGloss/a-gly) (ACE) ，其中包含完整性 SID。</span><span class="sxs-lookup"><span data-stu-id="09d2d-118">The SACL contains a [**SYSTEM\_MANDATORY\_LABEL\_ACE**](/windows/desktop/api/Winnt/ns-winnt-system_mandatory_label_ace) [*access control entry*](/windows/desktop/SecGloss/a-gly) (ACE) that in turn contains the integrity SID.</span></span> <span data-ttu-id="09d2d-119">任何沒有完整性 SID 的物件都會被視為具有中完整性。</span><span class="sxs-lookup"><span data-stu-id="09d2d-119">Any object without an integrity SID is treated as if it had medium integrity.</span></span>

<span data-ttu-id="09d2d-120">安全性主體的完整性 SID 會儲存在其存取權杖中。</span><span class="sxs-lookup"><span data-stu-id="09d2d-120">The integrity SID for a security principal is stored in its access token.</span></span> <span data-ttu-id="09d2d-121">存取權杖可包含一或多個完整性 Sid。</span><span class="sxs-lookup"><span data-stu-id="09d2d-121">An access token may contain one or more integrity SIDs.</span></span>

<span data-ttu-id="09d2d-122">如需有關已定義完整性 Sid 的詳細資訊，請參閱 [知名的 sid](well-known-sids.md)。</span><span class="sxs-lookup"><span data-stu-id="09d2d-122">For detailed information about the defined integrity SIDs, see [Well-known SIDs](well-known-sids.md).</span></span>

## <a name="process-creation"></a><span data-ttu-id="09d2d-123">處理序建立</span><span class="sxs-lookup"><span data-stu-id="09d2d-123">Process Creation</span></span>

<span data-ttu-id="09d2d-124">當使用者嘗試啟動可執行檔時，系統會建立新的進程，並以最少的使用者完整性層級和檔案完整性層級建立。</span><span class="sxs-lookup"><span data-stu-id="09d2d-124">When a user attempts to launch an executable file, the new process is created with the minimum of the user integrity level and the file integrity level.</span></span> <span data-ttu-id="09d2d-125">這表示新的進程絕對不會以比可執行檔更高的完整性執行。</span><span class="sxs-lookup"><span data-stu-id="09d2d-125">This means that the new process will never execute with higher integrity than the executable file.</span></span> <span data-ttu-id="09d2d-126">如果系統管理員使用者執行低完整性程式，則新進程的權杖會在低完整性層級執行。</span><span class="sxs-lookup"><span data-stu-id="09d2d-126">If the administrator user executes a low integrity program, the token for the new process functions with the low integrity level.</span></span> <span data-ttu-id="09d2d-127">這有助於保護從該程式碼所執行的惡意行為啟動不信任程式碼的使用者。</span><span class="sxs-lookup"><span data-stu-id="09d2d-127">This helps protect a user who launches untrustworthy code from malicious acts performed by that code.</span></span> <span data-ttu-id="09d2d-128">使用者資料（在一般的使用者完整性層級）是針對這個新進程進行寫入保護。</span><span class="sxs-lookup"><span data-stu-id="09d2d-128">The user data, which is at the typical user integrity level, is write-protected against this new process.</span></span>

## <a name="mandatory-policy"></a><span data-ttu-id="09d2d-129">強制原則</span><span class="sxs-lookup"><span data-stu-id="09d2d-129">Mandatory Policy</span></span>

<span data-ttu-id="09d2d-130">安全物件之 SACL 中的 [**系統 \_ 強制 \_ 標籤 \_ ace**](/windows/desktop/api/Winnt/ns-winnt-system_mandatory_label_ace) ace 包含存取遮罩，可指定授與具有低於物件之完整性層級的主體存取權。</span><span class="sxs-lookup"><span data-stu-id="09d2d-130">The [**SYSTEM\_MANDATORY\_LABEL\_ACE**](/windows/desktop/api/Winnt/ns-winnt-system_mandatory_label_ace) ACE in the SACL of a securable object contains an access mask that specifies the access that principals with integrity levels lower than the object are granted.</span></span> <span data-ttu-id="09d2d-131">針對此存取遮罩定義的值為「 **系統 \_ 強制 \_ 標籤 \_ 否 \_ 寫入 \_**」、「 **系統 \_ 強制 \_ 標籤 \_ 否 \_ 讀取 \_**」和「 **系統 \_ 強制 \_ 標籤 \_ 不 \_ 執行 \_**」。</span><span class="sxs-lookup"><span data-stu-id="09d2d-131">The values defined for this access mask are **SYSTEM\_MANDATORY\_LABEL\_NO\_WRITE\_UP**, **SYSTEM\_MANDATORY\_LABEL\_NO\_READ\_UP**, and **SYSTEM\_MANDATORY\_LABEL\_NO\_EXECUTE\_UP**.</span></span> <span data-ttu-id="09d2d-132">根據預設，系統會建立每個具有「 **系統 \_ 強制 \_ 標籤 \_ 無 \_ 寫入 \_**」存取遮罩的物件。</span><span class="sxs-lookup"><span data-stu-id="09d2d-132">By default, the system creates every object with an access mask of **SYSTEM\_MANDATORY\_LABEL\_NO\_WRITE\_UP**.</span></span>

<span data-ttu-id="09d2d-133">每個存取權杖也會指定在建立權杖時，由 [*本地安全機構*](/windows/desktop/SecGloss/l-gly) (LSA) 所設定的強制原則。</span><span class="sxs-lookup"><span data-stu-id="09d2d-133">Every access token also specifies a mandatory policy that is set by the [*Local Security Authority*](/windows/desktop/SecGloss/l-gly) (LSA) when the token is created.</span></span> <span data-ttu-id="09d2d-134">此原則是由與權杖相關聯的 [**權杖 \_ 強制 \_ 原則**](/windows/desktop/api/Winnt/ns-winnt-token_mandatory_policy) 結構所指定。</span><span class="sxs-lookup"><span data-stu-id="09d2d-134">This policy is specified by a [**TOKEN\_MANDATORY\_POLICY**](/windows/desktop/api/Winnt/ns-winnt-token_mandatory_policy) structure associated with the token.</span></span> <span data-ttu-id="09d2d-135">藉由呼叫 [**GetTokenInformation**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-gettokeninformation) 函數，並將 *TokenInformationClass* 參數的值設定為 **TokenMandatoryPolicy**，即可查詢此結構。</span><span class="sxs-lookup"><span data-stu-id="09d2d-135">This structure can be queried by calling the [**GetTokenInformation**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-gettokeninformation) function with the value of the *TokenInformationClass* parameter set to **TokenMandatoryPolicy**.</span></span>

 

 
