---
description: 受保護的伺服器應用程式必須先檢查用戶端存取許可權，然後才允許用戶端存取受保護的私用物件。
ms.assetid: dce4dd10-1d5f-40a3-8a7e-ec708d3123c7
title: 檢查私用物件的存取權
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c6b7b3d8b2cd933b00be0be9f1f2b077f5c7a2d2
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "103943506"
---
# <a name="checking-access-to-private-objects"></a><span data-ttu-id="9c6e2-103">檢查私用物件的存取權</span><span class="sxs-lookup"><span data-stu-id="9c6e2-103">Checking Access to Private Objects</span></span>

<span data-ttu-id="9c6e2-104">受保護的伺服器應用程式必須先檢查用戶端的存取權限，然後才允許用戶端存取受保護的私用物件。</span><span class="sxs-lookup"><span data-stu-id="9c6e2-104">A protected server application must check a client's access rights before allowing the client to access a protected private object.</span></span> <span data-ttu-id="9c6e2-105">若要這樣做，伺服器會將模擬 [*權杖*](/windows/desktop/SecGloss/i-gly)、安全描述項，以及一組要求的存取權限傳遞給 [**AccessCheck**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-accesscheck)。</span><span class="sxs-lookup"><span data-stu-id="9c6e2-105">To do this, the server passes an [*impersonation token*](/windows/desktop/SecGloss/i-gly), a security descriptor, and a set of requested access rights to [**AccessCheck**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-accesscheck).</span></span> <span data-ttu-id="9c6e2-106">在 [*安全描述項的*](/windows/desktop/SecGloss/s-gly)DACL 中， (ace) 的 [*存取控制專案*](/windows/desktop/SecGloss/a-gly)會指定對各種受信者允許或拒絕的存取權限。</span><span class="sxs-lookup"><span data-stu-id="9c6e2-106">The [*access control entries*](/windows/desktop/SecGloss/a-gly) (ACEs) in the [*security descriptor's*](/windows/desktop/SecGloss/s-gly) DACL specify the access rights allowed or denied to various trustees.</span></span> <span data-ttu-id="9c6e2-107">**AccessCheck** 函式會比較每個 ACE 中的信任者與模擬權杖中識別的信任者。</span><span class="sxs-lookup"><span data-stu-id="9c6e2-107">The **AccessCheck** function compares the trustee in each ACE to the trustees identified in the impersonation token.</span></span> <span data-ttu-id="9c6e2-108">如需用來授與或拒絕存取權之演算法的描述，請參閱 [Dacl 如何控制物件的存取權](how-dacls-control-access-to-an-object.md)。</span><span class="sxs-lookup"><span data-stu-id="9c6e2-108">For a description of the algorithm used to grant or deny access, see [How DACLs Control Access to an Object](how-dacls-control-access-to-an-object.md).</span></span>

<span data-ttu-id="9c6e2-109">[**AccessCheckAndAuditAlarm**](/windows/desktop/api/Winbase/nf-winbase-accesscheckandauditalarma)函式會執行類似的存取檢查。</span><span class="sxs-lookup"><span data-stu-id="9c6e2-109">The [**AccessCheckAndAuditAlarm**](/windows/desktop/api/Winbase/nf-winbase-accesscheckandauditalarma) function performs a similar access check.</span></span> <span data-ttu-id="9c6e2-110">此外，它會根據安全描述項中的 SACL，在安全性事件記錄檔中產生審核記錄。</span><span class="sxs-lookup"><span data-stu-id="9c6e2-110">In addition, it generates audit records in the security event log depending on the SACL in the security descriptor.</span></span>

<span data-ttu-id="9c6e2-111">[**AccessCheckByType**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-accesscheckbytype)和 [**AccessCheckByTypeAndAuditAlarm**](/windows/desktop/api/Winbase/nf-winbase-accesscheckbytypeandauditalarma)函式類似于 [**AccessCheck**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-accesscheck)和 [**AccessCheckAndAuditAlarm**](/windows/desktop/api/Winbase/nf-winbase-accesscheckandauditalarma) ，只不過它們可讓您檢查物件的子物件（例如屬性集或屬性）的存取權。</span><span class="sxs-lookup"><span data-stu-id="9c6e2-111">The [**AccessCheckByType**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-accesscheckbytype) and [**AccessCheckByTypeAndAuditAlarm**](/windows/desktop/api/Winbase/nf-winbase-accesscheckbytypeandauditalarma) functions are similar to [**AccessCheck**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-accesscheck) and [**AccessCheckAndAuditAlarm**](/windows/desktop/api/Winbase/nf-winbase-accesscheckandauditalarma) except that they allow you to check access to the subobjects of an object, such as property sets or properties.</span></span> <span data-ttu-id="9c6e2-112">[**AccessCheckByTypeResultList**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-accesscheckbytyperesultlist)和 [**AccessCheckByTypeResultListAndAuditAlarm**](/windows/desktop/api/Winbase/nf-winbase-accesscheckbytyperesultlistandauditalarma)函式也類似于 **AccessCheck** ，不同之處在于它們會在物件的屬性和屬性集階層中提供每個子物件的存取檢查結果。</span><span class="sxs-lookup"><span data-stu-id="9c6e2-112">The [**AccessCheckByTypeResultList**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-accesscheckbytyperesultlist) and [**AccessCheckByTypeResultListAndAuditAlarm**](/windows/desktop/api/Winbase/nf-winbase-accesscheckbytyperesultlistandauditalarma) functions are also similar to **AccessCheck** except that they provide the access check results for each subobject in a hierarchy of the object's properties and property sets.</span></span> <span data-ttu-id="9c6e2-113">這些函式會使用 [**物件 \_ 類型 \_ 清單**](/windows/desktop/api/Winnt/ns-winnt-object_type_list) 結構來描述已檢查存取的物件階層。</span><span class="sxs-lookup"><span data-stu-id="9c6e2-113">These functions use the [**OBJECT\_TYPE\_LIST**](/windows/desktop/api/Winnt/ns-winnt-object_type_list) structure to describe the hierarchy of objects for which access is checked.</span></span> <span data-ttu-id="9c6e2-114">產生 audit 訊息的函式會使用 [**audit \_ 事件 \_ 類型**](/windows/desktop/api/Winnt/ne-winnt-audit_event_type) 列舉型別，來指出正在檢查的物件是否為目錄服務物件。</span><span class="sxs-lookup"><span data-stu-id="9c6e2-114">The functions that generate an audit message use the [**AUDIT\_EVENT\_TYPE**](/windows/desktop/api/Winnt/ne-winnt-audit_event_type) enumeration type to indicate whether the object being checked is a directory service object.</span></span> <span data-ttu-id="9c6e2-115">如需物件及其子物件階層的詳細資訊，請參閱 [ace 來控制物件屬性的存取](aces-to-control-access-to-an-object-s-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="9c6e2-115">For more information about the hierarchy of an object and its subobjects, see [ACEs to Control Access to an Object's Properties](aces-to-control-access-to-an-object-s-properties.md).</span></span>

<span data-ttu-id="9c6e2-116">傳遞給 [**AccessCheck**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-accesscheck) 和 [**AccessCheckAndAuditAlarm**](/windows/desktop/api/Winbase/nf-winbase-accesscheckandauditalarma) 函數的要求存取權限不能包含任何 [一般存取權限](generic-access-rights.md)。</span><span class="sxs-lookup"><span data-stu-id="9c6e2-116">The requested access rights passed to the [**AccessCheck**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-accesscheck) and [**AccessCheckAndAuditAlarm**](/windows/desktop/api/Winbase/nf-winbase-accesscheckandauditalarma) functions must not include any [generic access rights](generic-access-rights.md).</span></span> <span data-ttu-id="9c6e2-117">伺服器可以使用 [**MapGenericMask**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-mapgenericmask) 函式，根據泛型對應結構中指定的對應，將任何泛型存取權限轉換為對應的特定和 [**標準 \_**](/windows/desktop/api/Winnt/ns-winnt-generic_mapping) 許可權。</span><span class="sxs-lookup"><span data-stu-id="9c6e2-117">The server can use the [**MapGenericMask**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-mapgenericmask) function to convert any generic access rights to the corresponding specific and standard rights according to the mapping specified in the [**GENERIC\_MAPPING**](/windows/desktop/api/Winnt/ns-winnt-generic_mapping) structure.</span></span>

<span data-ttu-id="9c6e2-118">[**AreAllAccessesGranted**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-areallaccessesgranted)和 [**AreAnyAccessesGranted**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-areanyaccessesgranted)函式會比較所要求的 [*存取遮罩*](/windows/desktop/SecGloss/a-gly)與授與的存取遮罩。</span><span class="sxs-lookup"><span data-stu-id="9c6e2-118">The [**AreAllAccessesGranted**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-areallaccessesgranted) and [**AreAnyAccessesGranted**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-areanyaccessesgranted) functions compare a requested [*access mask*](/windows/desktop/SecGloss/a-gly) with a granted access mask.</span></span>

<span data-ttu-id="9c6e2-119">如需使用 [**AccessCheck**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-accesscheck) 函式的範例程式碼，請參閱使用 [c + + 的 Acl 來驗證用戶端存取](verifying-client-access-with-acls-in-c--.md)。</span><span class="sxs-lookup"><span data-stu-id="9c6e2-119">For sample code that uses the [**AccessCheck**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-accesscheck) function, see [Verifying Client Access with ACLs in C++](verifying-client-access-with-acls-in-c--.md).</span></span>

<span data-ttu-id="9c6e2-120">[**ConvertToAutoInheritPrivateObjectSecurity**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-converttoautoinheritprivateobjectsecurity)函式會以允許自動傳播可繼承 ace 的格式，建立並傳回安全描述項。</span><span class="sxs-lookup"><span data-stu-id="9c6e2-120">The [**ConvertToAutoInheritPrivateObjectSecurity**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-converttoautoinheritprivateobjectsecurity) function creates and returns a security descriptor in a format that allows the automatic propagation of inheritable ACEs.</span></span> <span data-ttu-id="9c6e2-121">此安全描述項包含目前安全描述項中的所有 Ace （繼承和 noninherited），而且是 [*自我相關*](/windows/desktop/SecGloss/s-gly) 的格式。</span><span class="sxs-lookup"><span data-stu-id="9c6e2-121">This security descriptor contains all of the ACEs, inherited and noninherited, in the current security descriptor and is in [*self-relative*](/windows/desktop/SecGloss/s-gly) format.</span></span> <span data-ttu-id="9c6e2-122">**ConvertToAutoInheritPrivateObjectSecurity** 函式會將目前安全描述項中的所有 ace 與父安全描述項中的所有 ace 進行比較，以決定是否要繼承或 noninherited ace。</span><span class="sxs-lookup"><span data-stu-id="9c6e2-122">The **ConvertToAutoInheritPrivateObjectSecurity** function determines whether the ACEs are inherited or noninherited by comparing all of the ACEs in the current security descriptor with all of the ACEs in its parent security descriptor.</span></span> <span data-ttu-id="9c6e2-123">兩組 Ace 之間可能不會有一對一的對應關係。</span><span class="sxs-lookup"><span data-stu-id="9c6e2-123">There may not be a one-to-one correspondence between the two groups of ACEs.</span></span> <span data-ttu-id="9c6e2-124">例如，允許讀取/寫入權限的 ACE 可以等同于兩個 Ace：允許讀取權限的 ace，以及允許寫入權限的 ACE。</span><span class="sxs-lookup"><span data-stu-id="9c6e2-124">For instance, an ACE that allows read/write permission can be equivalent to two ACEs: an ACE that allows read permission and an ACE that allows write permission.</span></span> <span data-ttu-id="9c6e2-125">當目前的安全描述項是父系時，可能無法提供父安全描述項。</span><span class="sxs-lookup"><span data-stu-id="9c6e2-125">A parent security descriptor may not be supplied when the current security descriptor is the parent.</span></span>

 

 
