---
description: 存取權杖是描述進程或執行緒之安全性內容的物件。
ms.assetid: 350159c9-2399-427a-ba44-c897a9664299
title: 存取權杖
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0993c1f5aebab797ab28e61b36f59507e4d2f1ab
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "103849887"
---
# <a name="access-tokens"></a><span data-ttu-id="8db23-103">存取權杖</span><span class="sxs-lookup"><span data-stu-id="8db23-103">Access Tokens</span></span>

<span data-ttu-id="8db23-104">[*存取權杖*](/windows/desktop/SecGloss/a-gly)是描述 [*進程*](/windows/desktop/SecGloss/p-gly)或執行緒之 [*安全性內容*](/windows/desktop/SecGloss/s-gly)的物件。</span><span class="sxs-lookup"><span data-stu-id="8db23-104">An [*access token*](/windows/desktop/SecGloss/a-gly) is an object that describes the [*security context*](/windows/desktop/SecGloss/s-gly) of a [*process*](/windows/desktop/SecGloss/p-gly) or thread.</span></span> <span data-ttu-id="8db23-105">權杖中的資訊包括與進程或執行緒相關聯之使用者帳戶的身分識別和許可權。</span><span class="sxs-lookup"><span data-stu-id="8db23-105">The information in a token includes the identity and privileges of the user account associated with the process or thread.</span></span> <span data-ttu-id="8db23-106">當使用者登入時，系統會將使用者的密碼與儲存在安全性資料庫中的資訊進行比較，以驗證該使用者的密碼。</span><span class="sxs-lookup"><span data-stu-id="8db23-106">When a user logs on, the system verifies the user's password by comparing it with information stored in a security database.</span></span> <span data-ttu-id="8db23-107">如果密碼 [*經過驗證*](/windows/desktop/SecGloss/a-gly)，系統會產生存取權杖。</span><span class="sxs-lookup"><span data-stu-id="8db23-107">If the password is [*authenticated*](/windows/desktop/SecGloss/a-gly), the system produces an access token.</span></span> <span data-ttu-id="8db23-108">代表此使用者執行的每個處理常式都有此存取權杖的複本。</span><span class="sxs-lookup"><span data-stu-id="8db23-108">Every process executed on behalf of this user has a copy of this access token.</span></span>

<span data-ttu-id="8db23-109">當執行緒與 [安全物件](securable-objects.md) 互動，或嘗試執行需要許可權的系統工作時，系統會使用存取權杖來識別使用者。</span><span class="sxs-lookup"><span data-stu-id="8db23-109">The system uses an access token to identify the user when a thread interacts with a [securable object](securable-objects.md) or tries to perform a system task that requires privileges.</span></span> <span data-ttu-id="8db23-110">存取權杖包含下列資訊：</span><span class="sxs-lookup"><span data-stu-id="8db23-110">Access tokens contain the following information:</span></span>

-   <span data-ttu-id="8db23-111">使用者帳戶 (SID) 的[安全識別碼](security-identifiers.md)</span><span class="sxs-lookup"><span data-stu-id="8db23-111">The [security identifier](security-identifiers.md) (SID) for the user's account</span></span>
-   <span data-ttu-id="8db23-112">使用者為其成員之群組的 Sid</span><span class="sxs-lookup"><span data-stu-id="8db23-112">SIDs for the groups of which the user is a member</span></span>
-   <span data-ttu-id="8db23-113">識別目前 [*登入會話*](/windows/desktop/SecGloss/l-gly)的 [*登入 SID*](/windows/desktop/SecGloss/l-gly)</span><span class="sxs-lookup"><span data-stu-id="8db23-113">A [*logon SID*](/windows/desktop/SecGloss/l-gly) that identifies the current [*logon session*](/windows/desktop/SecGloss/l-gly)</span></span>
-   <span data-ttu-id="8db23-114">使用者或使用者群組所持有的 [許可權](privileges.md) 清單</span><span class="sxs-lookup"><span data-stu-id="8db23-114">A list of the [privileges](privileges.md) held by either the user or the user's groups</span></span>
-   <span data-ttu-id="8db23-115">擁有者 SID</span><span class="sxs-lookup"><span data-stu-id="8db23-115">An owner SID</span></span>
-   <span data-ttu-id="8db23-116">主要群組的 SID</span><span class="sxs-lookup"><span data-stu-id="8db23-116">The SID for the primary group</span></span>
-   <span data-ttu-id="8db23-117">當使用者建立安全物件但未指定 [*安全描述項*](/windows/desktop/SecGloss/s-gly)時，系統所使用的預設 [DACL](access-control-lists.md)</span><span class="sxs-lookup"><span data-stu-id="8db23-117">The default [DACL](access-control-lists.md) that the system uses when the user creates a securable object without specifying a [*security descriptor*](/windows/desktop/SecGloss/s-gly)</span></span>
-   <span data-ttu-id="8db23-118">存取權杖的來源</span><span class="sxs-lookup"><span data-stu-id="8db23-118">The source of the access token</span></span>
-   <span data-ttu-id="8db23-119">權杖是否為 [*主要*](/windows/desktop/SecGloss/p-gly)[或模擬](client-impersonation.md)權杖</span><span class="sxs-lookup"><span data-stu-id="8db23-119">Whether the token is a [*primary*](/windows/desktop/SecGloss/p-gly) or [impersonation](client-impersonation.md) token</span></span>
-   <span data-ttu-id="8db23-120">[限制 sid](restricted-tokens.md)的選擇性清單</span><span class="sxs-lookup"><span data-stu-id="8db23-120">An optional list of [restricting SIDs](restricted-tokens.md)</span></span>
-   <span data-ttu-id="8db23-121">目前的模擬層級</span><span class="sxs-lookup"><span data-stu-id="8db23-121">Current impersonation levels</span></span>
-   <span data-ttu-id="8db23-122">其他統計資料</span><span class="sxs-lookup"><span data-stu-id="8db23-122">Other statistics</span></span>

<span data-ttu-id="8db23-123">每個處理常式都有一個 [*主要權杖*](/windows/desktop/SecGloss/p-gly) ，可描述與處理常式相關聯之使用者帳戶的 [*安全性內容*](/windows/desktop/SecGloss/s-gly) 。</span><span class="sxs-lookup"><span data-stu-id="8db23-123">Every process has a [*primary token*](/windows/desktop/SecGloss/p-gly) that describes the [*security context*](/windows/desktop/SecGloss/s-gly) of the user account associated with the process.</span></span> <span data-ttu-id="8db23-124">根據預設，當進程的執行緒與安全物件互動時，系統會使用主要權杖。</span><span class="sxs-lookup"><span data-stu-id="8db23-124">By default, the system uses the primary token when a thread of the process interacts with a securable object.</span></span> <span data-ttu-id="8db23-125">此外，執行緒也可以模擬用戶端帳戶。</span><span class="sxs-lookup"><span data-stu-id="8db23-125">Moreover, a thread can impersonate a client account.</span></span> <span data-ttu-id="8db23-126">模擬可讓執行緒使用用戶端的安全性內容，與安全物件互動。</span><span class="sxs-lookup"><span data-stu-id="8db23-126">Impersonation allows the thread to interact with securable objects using the client's security context.</span></span> <span data-ttu-id="8db23-127">模仿用戶端的執行緒同時具有主要權杖和模擬 [*權杖*](/windows/desktop/SecGloss/i-gly)。</span><span class="sxs-lookup"><span data-stu-id="8db23-127">A thread that is impersonating a client has both a primary token and an [*impersonation token*](/windows/desktop/SecGloss/i-gly).</span></span>

<span data-ttu-id="8db23-128">您可以使用 [**OpenProcessToken**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-openprocesstoken) 函式來抓取進程主要 token 的控制碼。</span><span class="sxs-lookup"><span data-stu-id="8db23-128">Use the [**OpenProcessToken**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-openprocesstoken) function to retrieve a handle to the primary token of a process.</span></span> <span data-ttu-id="8db23-129">您可以使用 [**OpenThreadToken**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-openthreadtoken) 函式來抓取執行緒模擬權杖的控制碼。</span><span class="sxs-lookup"><span data-stu-id="8db23-129">Use the [**OpenThreadToken**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-openthreadtoken) function to retrieve a handle to the impersonation token of a thread.</span></span> <span data-ttu-id="8db23-130">如需詳細資訊， [請參閱模擬](client-impersonation.md)。</span><span class="sxs-lookup"><span data-stu-id="8db23-130">For more information, see [Impersonation](client-impersonation.md).</span></span>

<span data-ttu-id="8db23-131">您可以使用下列函數來操作存取權杖。</span><span class="sxs-lookup"><span data-stu-id="8db23-131">You can use the following functions to manipulate access tokens.</span></span>



| <span data-ttu-id="8db23-132">函式</span><span class="sxs-lookup"><span data-stu-id="8db23-132">Function</span></span>                                               | <span data-ttu-id="8db23-133">描述</span><span class="sxs-lookup"><span data-stu-id="8db23-133">Description</span></span>                                                                                                                                                            |
|--------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="8db23-134">**AdjustTokenGroups**</span><span class="sxs-lookup"><span data-stu-id="8db23-134">**AdjustTokenGroups**</span></span>](/windows/win32/api/securitybaseapi/nf-securitybaseapi-adjusttokengroups)         | <span data-ttu-id="8db23-135">變更存取權杖中的群組資訊。</span><span class="sxs-lookup"><span data-stu-id="8db23-135">Changes the group information in an access token.</span></span>                                                                                                                      |
| [<span data-ttu-id="8db23-136">**AdjustTokenPrivileges**</span><span class="sxs-lookup"><span data-stu-id="8db23-136">**AdjustTokenPrivileges**</span></span>](/windows/win32/api/securitybaseapi/nf-securitybaseapi-adjusttokenprivileges) | <span data-ttu-id="8db23-137">啟用或停用存取權杖中的許可權。</span><span class="sxs-lookup"><span data-stu-id="8db23-137">Enables or disables the privileges in an access token.</span></span> <span data-ttu-id="8db23-138">它不會授與新的許可權或撤銷現有的許可權。</span><span class="sxs-lookup"><span data-stu-id="8db23-138">It does not grant new privileges or revoke existing ones.</span></span>                                                       |
| [<span data-ttu-id="8db23-139">**CheckTokenMembership**</span><span class="sxs-lookup"><span data-stu-id="8db23-139">**CheckTokenMembership**</span></span>](/windows/win32/api/securitybaseapi/nf-securitybaseapi-checktokenmembership)   | <span data-ttu-id="8db23-140">判斷指定的存取權杖中是否已啟用指定的 SID。</span><span class="sxs-lookup"><span data-stu-id="8db23-140">Determines whether a specified SID is enabled in a specified access token.</span></span>                                                                                             |
| [<span data-ttu-id="8db23-141">**CreateRestrictedToken**</span><span class="sxs-lookup"><span data-stu-id="8db23-141">**CreateRestrictedToken**</span></span>](/windows/win32/api/securitybaseapi/nf-securitybaseapi-createrestrictedtoken) | <span data-ttu-id="8db23-142">建立新的權杖，此權杖是現有權杖的受限制版本。</span><span class="sxs-lookup"><span data-stu-id="8db23-142">Creates a new token that is a restricted version of an existing token.</span></span> <span data-ttu-id="8db23-143">受限的權杖可以停用 Sid、已刪除的許可權，以及受限 Sid 的清單。</span><span class="sxs-lookup"><span data-stu-id="8db23-143">The restricted token can have disabled SIDs, deleted privileges, and a list of restricted SIDs.</span></span> |
| [<span data-ttu-id="8db23-144">**DuplicateToken**</span><span class="sxs-lookup"><span data-stu-id="8db23-144">**DuplicateToken**</span></span>](/windows/win32/api/securitybaseapi/nf-securitybaseapi-duplicatetoken)               | <span data-ttu-id="8db23-145">建立新的模擬權杖，以複製現有的權杖。</span><span class="sxs-lookup"><span data-stu-id="8db23-145">Creates a new impersonation token that duplicates an existing token.</span></span>                                                                                                   |
| [<span data-ttu-id="8db23-146">**DuplicateTokenEx**</span><span class="sxs-lookup"><span data-stu-id="8db23-146">**DuplicateTokenEx**</span></span>](/windows/win32/api/securitybaseapi/nf-securitybaseapi-duplicatetokenex)           | <span data-ttu-id="8db23-147">建立新的主要權杖或模擬權杖，以複製現有的權杖。</span><span class="sxs-lookup"><span data-stu-id="8db23-147">Creates a new primary token or impersonation token that duplicates an existing token.</span></span>                                                                                  |
| [<span data-ttu-id="8db23-148">**GetTokenInformation**</span><span class="sxs-lookup"><span data-stu-id="8db23-148">**GetTokenInformation**</span></span>](/windows/win32/api/securitybaseapi/nf-securitybaseapi-gettokeninformation)     | <span data-ttu-id="8db23-149">抓取權杖的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="8db23-149">Retrieves information about a token.</span></span>                                                                                                                                   |
| [<span data-ttu-id="8db23-150">**IsTokenRestricted**</span><span class="sxs-lookup"><span data-stu-id="8db23-150">**IsTokenRestricted**</span></span>](/windows/win32/api/securitybaseapi/nf-securitybaseapi-istokenrestricted)         | <span data-ttu-id="8db23-151">判斷權杖是否有限制 Sid 的清單。</span><span class="sxs-lookup"><span data-stu-id="8db23-151">Determines whether a token has a list of restricting SIDs.</span></span>                                                                                                             |
| [<span data-ttu-id="8db23-152">**OpenProcessToken**</span><span class="sxs-lookup"><span data-stu-id="8db23-152">**OpenProcessToken**</span></span>](/windows/win32/api/processthreadsapi/nf-processthreadsapi-openprocesstoken)           | <span data-ttu-id="8db23-153">抓取進程的主要存取權杖控制碼。</span><span class="sxs-lookup"><span data-stu-id="8db23-153">Retrieves a handle to the primary access token for a process.</span></span>                                                                                                          |
| [<span data-ttu-id="8db23-154">**OpenThreadToken**</span><span class="sxs-lookup"><span data-stu-id="8db23-154">**OpenThreadToken**</span></span>](/windows/win32/api/processthreadsapi/nf-processthreadsapi-openthreadtoken)             | <span data-ttu-id="8db23-155">抓取執行緒之模擬存取權杖的控制碼。</span><span class="sxs-lookup"><span data-stu-id="8db23-155">Retrieves a handle to the impersonation access token for a thread.</span></span>                                                                                                     |
| [<span data-ttu-id="8db23-156">**SetThreadToken**</span><span class="sxs-lookup"><span data-stu-id="8db23-156">**SetThreadToken**</span></span>](/windows/win32/api/processthreadsapi/nf-processthreadsapi-setthreadtoken)               | <span data-ttu-id="8db23-157">指派或移除執行緒的模擬權杖。</span><span class="sxs-lookup"><span data-stu-id="8db23-157">Assigns or removes an impersonation token for a thread.</span></span>                                                                                                                |
| [<span data-ttu-id="8db23-158">**SetTokenInformation**</span><span class="sxs-lookup"><span data-stu-id="8db23-158">**SetTokenInformation**</span></span>](/windows/win32/api/securitybaseapi/nf-securitybaseapi-settokeninformation)     | <span data-ttu-id="8db23-159">變更權杖的擁有者、主要群組或預設的 DACL。</span><span class="sxs-lookup"><span data-stu-id="8db23-159">Changes a token's owner, primary group, or default DACL.</span></span>                                                                                                               |



 

<span data-ttu-id="8db23-160">存取權杖函數會使用下列結構來描述存取權杖的部分。</span><span class="sxs-lookup"><span data-stu-id="8db23-160">The access token functions use the following structures to describe the parts of an access token.</span></span>



| <span data-ttu-id="8db23-161">結構</span><span class="sxs-lookup"><span data-stu-id="8db23-161">Structure</span></span>                                            | <span data-ttu-id="8db23-162">Description</span><span class="sxs-lookup"><span data-stu-id="8db23-162">Description</span></span>                                                                                           |
|------------------------------------------------------|-------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="8db23-163">**TOKEN \_ 控制項**</span><span class="sxs-lookup"><span data-stu-id="8db23-163">**TOKEN\_CONTROL**</span></span>](/windows/desktop/api/Winnt/ns-winnt-token_control)              | <span data-ttu-id="8db23-164">識別存取權杖的資訊。</span><span class="sxs-lookup"><span data-stu-id="8db23-164">Information that identifies an access token.</span></span>                                                          |
| [<span data-ttu-id="8db23-165">**TOKEN \_ 預設 \_ DACL**</span><span class="sxs-lookup"><span data-stu-id="8db23-165">**TOKEN\_DEFAULT\_DACL**</span></span>](/windows/desktop/api/Winnt/ns-winnt-token_default_dacl)   | <span data-ttu-id="8db23-166">系統線上程所建立之新物件的安全描述項中使用的預設 DACL。</span><span class="sxs-lookup"><span data-stu-id="8db23-166">The default DACL that the system uses in the security descriptors of new objects created by a thread.</span></span> |
| [<span data-ttu-id="8db23-167">**權杖 \_ 群組**</span><span class="sxs-lookup"><span data-stu-id="8db23-167">**TOKEN\_GROUPS**</span></span>](/windows/desktop/api/Winnt/ns-winnt-token_groups)                | <span data-ttu-id="8db23-168">指定存取權杖中群組 Sid 的 Sid 和屬性。</span><span class="sxs-lookup"><span data-stu-id="8db23-168">Specifies the SIDs and attributes of the group SIDs in an access token.</span></span>                               |
| [<span data-ttu-id="8db23-169">**權杖 \_ 擁有者**</span><span class="sxs-lookup"><span data-stu-id="8db23-169">**TOKEN\_OWNER**</span></span>](/windows/desktop/api/Winnt/ns-winnt-token_owner)                  | <span data-ttu-id="8db23-170">新物件之安全描述項的預設擁有者 SID。</span><span class="sxs-lookup"><span data-stu-id="8db23-170">The default owner SID for the security descriptors of new objects.</span></span>                                    |
| [<span data-ttu-id="8db23-171">**權杖 \_ 主要 \_ 群組**</span><span class="sxs-lookup"><span data-stu-id="8db23-171">**TOKEN\_PRIMARY\_GROUP**</span></span>](/windows/desktop/api/Winnt/ns-winnt-token_primary_group) | <span data-ttu-id="8db23-172">新物件之安全描述項的預設主要群組 SID。</span><span class="sxs-lookup"><span data-stu-id="8db23-172">The default primary group SID for the security descriptors of new objects.</span></span>                            |
| [<span data-ttu-id="8db23-173">**權杖 \_ 許可權**</span><span class="sxs-lookup"><span data-stu-id="8db23-173">**TOKEN\_PRIVILEGES**</span></span>](/windows/desktop/api/Winnt/ns-winnt-token_privileges)        | <span data-ttu-id="8db23-174">與存取權杖相關聯的許可權。</span><span class="sxs-lookup"><span data-stu-id="8db23-174">The privileges associated with an access token.</span></span> <span data-ttu-id="8db23-175">也可決定是否啟用許可權。</span><span class="sxs-lookup"><span data-stu-id="8db23-175">Also determines whether the privileges are enabled.</span></span>   |
| [<span data-ttu-id="8db23-176">**權杖 \_ 來源**</span><span class="sxs-lookup"><span data-stu-id="8db23-176">**TOKEN\_SOURCE**</span></span>](/windows/desktop/api/Winnt/ns-winnt-token_source)                | <span data-ttu-id="8db23-177">存取權杖的來源。</span><span class="sxs-lookup"><span data-stu-id="8db23-177">The source of an access token.</span></span>                                                                        |
| [<span data-ttu-id="8db23-178">**權杖 \_ 統計資料**</span><span class="sxs-lookup"><span data-stu-id="8db23-178">**TOKEN\_STATISTICS**</span></span>](/windows/desktop/api/Winnt/ns-winnt-token_statistics)        | <span data-ttu-id="8db23-179">與存取權杖相關聯的統計資料。</span><span class="sxs-lookup"><span data-stu-id="8db23-179">Statistics associated with an access token.</span></span>                                                           |
| [<span data-ttu-id="8db23-180">**權杖 \_ 使用者**</span><span class="sxs-lookup"><span data-stu-id="8db23-180">**TOKEN\_USER**</span></span>](/windows/desktop/api/Winnt/ns-winnt-token_user)                    | <span data-ttu-id="8db23-181">與存取權杖相關聯之使用者的 SID。</span><span class="sxs-lookup"><span data-stu-id="8db23-181">The SID of the user associated with an access token.</span></span>                                                  |



 

<span data-ttu-id="8db23-182">存取權杖函數會使用下列列舉類型。</span><span class="sxs-lookup"><span data-stu-id="8db23-182">The access token functions use the following enumeration types.</span></span>



| <span data-ttu-id="8db23-183">列舉類型</span><span class="sxs-lookup"><span data-stu-id="8db23-183">Enumeration type</span></span>                                             | <span data-ttu-id="8db23-184">指定</span><span class="sxs-lookup"><span data-stu-id="8db23-184">Specifies</span></span>                                                                       |
|--------------------------------------------------------------|---------------------------------------------------------------------------------|
| [<span data-ttu-id="8db23-185">**TOKEN \_ 資訊 \_ 類別**</span><span class="sxs-lookup"><span data-stu-id="8db23-185">**TOKEN\_INFORMATION\_CLASS**</span></span>](/windows/desktop/api/Winnt/ne-winnt-token_information_class) | <span data-ttu-id="8db23-186">識別要設定或從存取權杖中取出的資訊類型。</span><span class="sxs-lookup"><span data-stu-id="8db23-186">Identifies the type of information being set or retrieved from an access token.</span></span> |
| [<span data-ttu-id="8db23-187">**TOKEN \_ 類型**</span><span class="sxs-lookup"><span data-stu-id="8db23-187">**TOKEN\_TYPE**</span></span>](/windows/desktop/api/Winnt/ne-winnt-token_type)                            | <span data-ttu-id="8db23-188">將存取權杖識別為主要或模擬權杖。</span><span class="sxs-lookup"><span data-stu-id="8db23-188">Identifies an access token as a primary or impersonation token.</span></span>                 |



 

 

 
