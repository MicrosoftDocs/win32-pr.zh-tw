---
description: 本主題提供針對 IWordBreaker 和 IStemmer 的執行進行驗證和疑難排解的最佳作法和建議。
ms.assetid: b0e199b9-8d81-4445-92f7-de9b8a00a9cb
title: 疑難排解語言資源和最佳作法
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f63a0a8acda3fff1627b37f41c2d81a67b37d66a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "103689836"
---
# <a name="troubleshooting-language-resources-and-best-practices"></a><span data-ttu-id="007f5-103">疑難排解語言資源和最佳作法</span><span class="sxs-lookup"><span data-stu-id="007f5-103">Troubleshooting Language Resources and Best Practices</span></span>

<span data-ttu-id="007f5-104">本主題提供針對 [**IWordBreaker**](/windows/desktop/api/Indexsrv/nn-indexsrv-iwordbreaker) 和 [**IStemmer**](/windows/desktop/api/Indexsrv/nn-indexsrv-istemmer) 的執行進行驗證和疑難排解的最佳作法和建議。</span><span class="sxs-lookup"><span data-stu-id="007f5-104">This topic provides best practices and suggestions for validating and troubleshooting your [**IWordBreaker**](/windows/desktop/api/Indexsrv/nn-indexsrv-iwordbreaker) and [**IStemmer**](/windows/desktop/api/Indexsrv/nn-indexsrv-istemmer) implementations.</span></span>

<span data-ttu-id="007f5-105">本主題的組織方式如下：</span><span class="sxs-lookup"><span data-stu-id="007f5-105">This topic is organized as follows:</span></span>

-   [<span data-ttu-id="007f5-106">最佳作法</span><span class="sxs-lookup"><span data-stu-id="007f5-106">Best Practices</span></span>](#best-practices)
-   [<span data-ttu-id="007f5-107">測試詞幹分析器一致性</span><span class="sxs-lookup"><span data-stu-id="007f5-107">Testing Stemmer Consistency</span></span>](#testing-stemmer-consistency)
-   [<span data-ttu-id="007f5-108">在詞幹分析器中測試不正確輸入</span><span class="sxs-lookup"><span data-stu-id="007f5-108">Testing for Invalid Input in the Stemmer</span></span>](#testing-for-invalid-input-in-the-stemmer)
-   [<span data-ttu-id="007f5-109">測試斷詞工具一致性</span><span class="sxs-lookup"><span data-stu-id="007f5-109">Testing Word Breaker Consistency</span></span>](#testing-word-breaker-consistency)
-   [<span data-ttu-id="007f5-110">測試斷詞工具中是否有不正確輸入</span><span class="sxs-lookup"><span data-stu-id="007f5-110">Testing for Invalid Input in the Word Breaker</span></span>](#testing-for-invalid-input-in-the-word-breaker)

### <a name="best-practices"></a><span data-ttu-id="007f5-111">最佳做法</span><span class="sxs-lookup"><span data-stu-id="007f5-111">Best Practices</span></span>

-   <span data-ttu-id="007f5-112">確定 [語言資源] 的執行緒模型在登錄中設定為 [兩者]。</span><span class="sxs-lookup"><span data-stu-id="007f5-112">Ensure that the threading model for language resources is set to "both" in the registry.</span></span>
-   <span data-ttu-id="007f5-113">可能的話，請將語言資料放入 DLL 中的資源，而不是放在個別的檔案中。</span><span class="sxs-lookup"><span data-stu-id="007f5-113">Where possible, put language data in a resource in your DLL rather than in a separate file.</span></span> <span data-ttu-id="007f5-114">這樣可讓 DLL 更容易安裝且更安全。</span><span class="sxs-lookup"><span data-stu-id="007f5-114">This makes the DLL easier to install and more secure.</span></span> <span data-ttu-id="007f5-115">此外，將語言資料放入資源中，會導致該語言資源元件的效能提升。</span><span class="sxs-lookup"><span data-stu-id="007f5-115">Additionally, putting language data in a resource will result in improved performance for that language resource component.</span></span>
-   <span data-ttu-id="007f5-116">將語言資源元件使用的系統資源降至最低。</span><span class="sxs-lookup"><span data-stu-id="007f5-116">Minimize the system resources that language resource components use.</span></span> <span data-ttu-id="007f5-117">例如，如果語言資源物件的每個實例都需要字典的唯讀存取權，請考慮在所有實例之間共用該詞典。</span><span class="sxs-lookup"><span data-stu-id="007f5-117">For example, if each instance of a language resource object needs read-only access to a lexicon, consider sharing the lexicon across all instances.</span></span>
-   <span data-ttu-id="007f5-118">請考慮使用中性斷詞工具，來處理不在您的斷詞工具執行語言或地區設定中的文字。</span><span class="sxs-lookup"><span data-stu-id="007f5-118">Consider using the neutral word breaker to handle text that is not in the language or locale for your word breaker implementation.</span></span> <span data-ttu-id="007f5-119">這有助於確保在所有語言中都能一致地處理文字。</span><span class="sxs-lookup"><span data-stu-id="007f5-119">This will help ensure that text is processed consistently across all languages.</span></span>
-   <span data-ttu-id="007f5-120">檢查所有傳回碼，然後從 [**IStemmer：： GenerateWordForms**](/windows/desktop/api/Indexsrv/nf-indexsrv-istemmer-generatewordforms) 和 [**IWordBreaker：： BreakText**](/windows/desktop/api/Indexsrv/nf-indexsrv-iwordbreaker-breaktext)等函數傳回。</span><span class="sxs-lookup"><span data-stu-id="007f5-120">Check all return codes and return them from functions like [**IStemmer::GenerateWordForms**](/windows/desktop/api/Indexsrv/nf-indexsrv-istemmer-generatewordforms) and [**IWordBreaker::BreakText**](/windows/desktop/api/Indexsrv/nf-indexsrv-iwordbreaker-breaktext).</span></span> <span data-ttu-id="007f5-121">如果索引失敗，請務必傳遞錯誤，讓使用者收到已編制索引的檔。</span><span class="sxs-lookup"><span data-stu-id="007f5-121">If indexing fails, it is important to pass the error so that the user is notified which documents were indexed.</span></span>

### <a name="testing-stemmer-consistency"></a><span data-ttu-id="007f5-122">測試詞幹分析器一致性</span><span class="sxs-lookup"><span data-stu-id="007f5-122">Testing Stemmer Consistency</span></span>

<span data-ttu-id="007f5-123">建議您在下列情況下，監視 [**IStemmer**](/windows/desktop/api/Indexsrv/nn-indexsrv-istemmer) 執行的效能是否一致：</span><span class="sxs-lookup"><span data-stu-id="007f5-123">We recommend that you monitor the performance of an [**IStemmer**](/windows/desktop/api/Indexsrv/nn-indexsrv-istemmer) implementation for consistency under the following conditions:</span></span>

-   <span data-ttu-id="007f5-124">此字幹分析器會在 [**IStemmer：： Init**](/windows/desktop/api/Indexsrv/nf-indexsrv-istemmer-init)的多個呼叫中一致地執行。</span><span class="sxs-lookup"><span data-stu-id="007f5-124">The stemmer performs consistently across multiple calls to [**IStemmer::Init**](/windows/desktop/api/Indexsrv/nf-indexsrv-istemmer-init).</span></span> <span data-ttu-id="007f5-125">使用與先前的初始化相同的參數重新初始化分析器，而不釋放參數。</span><span class="sxs-lookup"><span data-stu-id="007f5-125">The stemmer reinitializes with the same parameters as in the previous initialization, without releasing the parameters.</span></span>
-   <span data-ttu-id="007f5-126">如果有相同的測試主體和重複相同的查詢， [**IStemmer：： GenerateWordForms**](/windows/desktop/api/Indexsrv/nf-indexsrv-istemmer-generatewordforms) 會產生相同的輸出，並且對 [**IWordFormSink**](/windows/desktop/api/Indexsrv/nn-indexsrv-iwordformsink) 物件的方法進行相同的呼叫。</span><span class="sxs-lookup"><span data-stu-id="007f5-126">Given the same test corpus, and repetitions of the same query, [**IStemmer::GenerateWordForms**](/windows/desktop/api/Indexsrv/nf-indexsrv-istemmer-generatewordforms) produces the identical output and makes identical calls to the methods of the [**IWordFormSink**](/windows/desktop/api/Indexsrv/nn-indexsrv-iwordformsink) object.</span></span>

### <a name="testing-for-invalid-input-in-the-stemmer"></a><span data-ttu-id="007f5-127">在詞幹分析器中測試不正確輸入</span><span class="sxs-lookup"><span data-stu-id="007f5-127">Testing for Invalid Input in the Stemmer</span></span>

<span data-ttu-id="007f5-128">建議您監視 [**IStemmer**](/windows/desktop/api/Indexsrv/nn-indexsrv-istemmer) 方法如何處理與無效參數相關的所有錯誤。</span><span class="sxs-lookup"><span data-stu-id="007f5-128">We recommend that you monitor how the [**IStemmer**](/windows/desktop/api/Indexsrv/nn-indexsrv-istemmer) methods handle all errors related to invalid parameters.</span></span> <span data-ttu-id="007f5-129">此外，我們建議您確定詞幹分析器方法不會引發未處理的例外狀況。</span><span class="sxs-lookup"><span data-stu-id="007f5-129">In addition, we recommend that you ensure that the stemmer methods do not raise unhandled exceptions.</span></span> <span data-ttu-id="007f5-130">此字幹分析器應該會處理下列錯誤：</span><span class="sxs-lookup"><span data-stu-id="007f5-130">The stemmer should handle the following errors:</span></span>

-   <span data-ttu-id="007f5-131">呼叫 [**IStemmer：： Init**](/windows/desktop/api/Indexsrv/nf-indexsrv-istemmer-init) ，並將 *PfLicense* 設定為 **Null**。</span><span class="sxs-lookup"><span data-stu-id="007f5-131">Call to [**IStemmer::Init**](/windows/desktop/api/Indexsrv/nf-indexsrv-istemmer-init) with *pfLicense* set to **NULL**.</span></span> <span data-ttu-id="007f5-132">Init 失敗，而且不會造成存取違規。</span><span class="sxs-lookup"><span data-stu-id="007f5-132">Init fails and does not result in an access violation.</span></span>
-   <span data-ttu-id="007f5-133">呼叫 [**IStemmer：： GetLicenseToUse**](/windows/desktop/api/Indexsrv/nf-indexsrv-istemmer-getlicensetouse) ，並將 *ppwcsLicense* 參數設定為 **Null**。</span><span class="sxs-lookup"><span data-stu-id="007f5-133">Call to [**IStemmer::GetLicenseToUse**](/windows/desktop/api/Indexsrv/nf-indexsrv-istemmer-getlicensetouse) with the *ppwcsLicense* parameter set to **NULL**.</span></span> <span data-ttu-id="007f5-134">**IStemmer：： GetLicenseToUse** 不會造成存取違規。</span><span class="sxs-lookup"><span data-stu-id="007f5-134">**IStemmer::GetLicenseToUse** does not result in an access violation.</span></span>
-   <span data-ttu-id="007f5-135">呼叫 [**IStemmer：： GenerateWordForms**](/windows/desktop/api/Indexsrv/nf-indexsrv-istemmer-generatewordforms) ，並將 *pwcInBuf* 參數設定為 **Null**。</span><span class="sxs-lookup"><span data-stu-id="007f5-135">Call to [**IStemmer::GenerateWordForms**](/windows/desktop/api/Indexsrv/nf-indexsrv-istemmer-generatewordforms) with the *pwcInBuf* parameter set to **NULL**.</span></span> <span data-ttu-id="007f5-136">**IStemmer：： GenerateWordForms** 失敗 (傳回 E \_) 失敗，而且不會造成存取違規。</span><span class="sxs-lookup"><span data-stu-id="007f5-136">**IStemmer::GenerateWordForms** fails (returns E\_FAIL) and does not result in an access violation.</span></span>
-   <span data-ttu-id="007f5-137">呼叫 [**IStemmer：： GenerateWordForms**](/windows/desktop/api/Indexsrv/nf-indexsrv-istemmer-generatewordforms) ，並將 *cwc* 參數等於0。</span><span class="sxs-lookup"><span data-stu-id="007f5-137">Call to [**IStemmer::GenerateWordForms**](/windows/desktop/api/Indexsrv/nf-indexsrv-istemmer-generatewordforms) with the *cwc* parameter equal to 0.</span></span> <span data-ttu-id="007f5-138">**IStemmer：： GenerateWordForms** 會成功傳回 (傳回 S \_ 確定) 而不會導致存取違規。</span><span class="sxs-lookup"><span data-stu-id="007f5-138">**IStemmer::GenerateWordForms** returns successfully (returns S\_OK) and does not result in an access violation.</span></span>
-   <span data-ttu-id="007f5-139">呼叫 [**IStemmer：： GenerateWordForms**](/windows/desktop/api/Indexsrv/nf-indexsrv-istemmer-generatewordforms) ，並將 *pwcInBuf* 參數設定為 **Null** ，而 *cwc* 參數等於0。</span><span class="sxs-lookup"><span data-stu-id="007f5-139">Call to [**IStemmer::GenerateWordForms**](/windows/desktop/api/Indexsrv/nf-indexsrv-istemmer-generatewordforms) with the *pwcInBuf* parameter set to **NULL** and the *cwc* parameter equal to 0.</span></span> <span data-ttu-id="007f5-140">**IStemmer：： GenerateWordForms** 失敗 (傳回 E \_) 失敗，而且不會造成存取違規。</span><span class="sxs-lookup"><span data-stu-id="007f5-140">**IStemmer::GenerateWordForms** fails (returns E\_FAIL) and does not result in an access violation.</span></span>

### <a name="testing-word-breaker-consistency"></a><span data-ttu-id="007f5-141">測試斷詞工具一致性</span><span class="sxs-lookup"><span data-stu-id="007f5-141">Testing Word Breaker Consistency</span></span>

<span data-ttu-id="007f5-142">建議您在下列情況下，確保 [**IWordBreaker**](/windows/desktop/api/Indexsrv/nn-indexsrv-iwordbreaker) 的執行持續一致：</span><span class="sxs-lookup"><span data-stu-id="007f5-142">We recommend that you ensure that the [**IWordBreaker**](/windows/desktop/api/Indexsrv/nn-indexsrv-iwordbreaker) implementation performs consistently under the following conditions:</span></span>

-   <span data-ttu-id="007f5-143">斷詞工具會在對其 [**IWordBreaker：： Init**](/windows/desktop/api/Indexsrv/nf-indexsrv-iwordbreaker-init) 方法的多個呼叫之間持續執行。</span><span class="sxs-lookup"><span data-stu-id="007f5-143">Word breaker performs consistently across multiple calls to its [**IWordBreaker::Init**](/windows/desktop/api/Indexsrv/nf-indexsrv-iwordbreaker-init) method.</span></span> <span data-ttu-id="007f5-144">斷詞工具會使用與先前初始化相同的參數重新初始化，而不會釋放參數。</span><span class="sxs-lookup"><span data-stu-id="007f5-144">The word breaker reinitializes with the same parameters as in the previous initialization, without releasing the parameters.</span></span>
-   <span data-ttu-id="007f5-145">針對相同的測試主體和重複相同的查詢， [**IWordBreaker：： BreakText**](/windows/desktop/api/Indexsrv/nf-indexsrv-iwordbreaker-breaktext) 方法會產生相同的輸出，並且對 [**IWordSink**](iwordsink.md) 和 [**IPhraseSink**](/windows/win32/api/indexsrv/nn-indexsrv-iphrasesink) 物件的方法進行相同的呼叫。</span><span class="sxs-lookup"><span data-stu-id="007f5-145">Given the same test corpus, and repetitions of the same query, the [**IWordBreaker::BreakText**](/windows/desktop/api/Indexsrv/nf-indexsrv-iwordbreaker-breaktext) method produces the identical output and makes identical calls to the methods of the [**IWordSink**](iwordsink.md) and [**IPhraseSink**](/windows/win32/api/indexsrv/nn-indexsrv-iphrasesink) objects.</span></span>

### <a name="testing-for-invalid-input-in-the-word-breaker"></a><span data-ttu-id="007f5-146">測試斷詞工具中是否有不正確輸入</span><span class="sxs-lookup"><span data-stu-id="007f5-146">Testing for Invalid Input in the Word Breaker</span></span>

<span data-ttu-id="007f5-147">建議您確保 [**IWordBreaker**](/windows/desktop/api/Indexsrv/nn-indexsrv-iwordbreaker) 方法會處理與無效參數相關的所有錯誤。</span><span class="sxs-lookup"><span data-stu-id="007f5-147">We recommend that you ensure that the [**IWordBreaker**](/windows/desktop/api/Indexsrv/nn-indexsrv-iwordbreaker) methods handle all errors related to invalid parameters.</span></span> <span data-ttu-id="007f5-148">此外，我們建議您確定斷詞工具方法不會引發未處理的例外狀況。</span><span class="sxs-lookup"><span data-stu-id="007f5-148">In addition, we recommend that you ensure that the word breaker methods do not raise unhandled exceptions.</span></span> <span data-ttu-id="007f5-149">斷詞工具應該執行下列功能，並處理下列錯誤：</span><span class="sxs-lookup"><span data-stu-id="007f5-149">The word breaker should perform the following functions and handle the following errors:</span></span>

-   <span data-ttu-id="007f5-150">呼叫 [**IWordBreaker：： Init**](/windows/desktop/api/Indexsrv/nf-indexsrv-iwordbreaker-init) 必須傳回 \_ 找不到 LANGUAGE E \_ 資料庫 \_ \_ 或 S \_ OK。</span><span class="sxs-lookup"><span data-stu-id="007f5-150">Call to [**IWordBreaker::Init**](/windows/desktop/api/Indexsrv/nf-indexsrv-iwordbreaker-init) must return either LANGUAGE\_E\_DATABASE\_NOT\_FOUND or S\_OK.</span></span>
-   <span data-ttu-id="007f5-151">呼叫 [**IWordBreaker：： Init**](/windows/desktop/api/Indexsrv/nf-indexsrv-iwordbreaker-init) 成功將 *pfLicense* 參數初始化為 **FALSE** ，並呼叫 [**IStemmer：： GetLicenseToUse**](/windows/desktop/api/Indexsrv/nf-indexsrv-istemmer-getlicensetouse) ，且不會造成存取違規。</span><span class="sxs-lookup"><span data-stu-id="007f5-151">Call to [**IWordBreaker::Init**](/windows/desktop/api/Indexsrv/nf-indexsrv-iwordbreaker-init) successfully initializes the *pfLicense* parameter to **FALSE** and calls [**IStemmer::GetLicenseToUse**](/windows/desktop/api/Indexsrv/nf-indexsrv-istemmer-getlicensetouse) and does not result in an access violation.</span></span>
-   <span data-ttu-id="007f5-152">斷詞工具不會讀取超過 [**IWordBreaker：： BreakText**](/windows/desktop/api/Indexsrv/nf-indexsrv-iwordbreaker-breaktext)方法中 *awcBuffer* 參數的結尾。</span><span class="sxs-lookup"><span data-stu-id="007f5-152">Word breaker does not read past the end of the *awcBuffer* parameter in the [**IWordBreaker::BreakText**](/windows/desktop/api/Indexsrv/nf-indexsrv-iwordbreaker-breaktext) method.</span></span>
-   <span data-ttu-id="007f5-153">呼叫 [**IWordBreaker：： BreakText**](/windows/desktop/api/Indexsrv/nf-indexsrv-iwordbreaker-breaktext) ，並將 *PwcInBuf* 設定為 **Null**。</span><span class="sxs-lookup"><span data-stu-id="007f5-153">Call to [**IWordBreaker::BreakText**](/windows/desktop/api/Indexsrv/nf-indexsrv-iwordbreaker-breaktext) with the *pwcInBuf* set to **NULL**.</span></span> <span data-ttu-id="007f5-154">**IWordBreaker：： BreakText** 失敗 (傳回 E \_) 失敗，而且不會造成存取違規。</span><span class="sxs-lookup"><span data-stu-id="007f5-154">**IWordBreaker::BreakText** fails (returns E\_FAIL) and does not result in an access violation.</span></span>
-   <span data-ttu-id="007f5-155">呼叫 [**IWordBreaker：： BreakText**](/windows/desktop/api/Indexsrv/nf-indexsrv-iwordbreaker-breaktext) ，並將 *cwc* 參數等於0。</span><span class="sxs-lookup"><span data-stu-id="007f5-155">Call to [**IWordBreaker::BreakText**](/windows/desktop/api/Indexsrv/nf-indexsrv-iwordbreaker-breaktext) with the *cwc* parameter equal to 0.</span></span> <span data-ttu-id="007f5-156">**IWordBreaker：： BreakText** 會成功傳回 (傳回 S \_ 確定) 而不會導致存取違規。</span><span class="sxs-lookup"><span data-stu-id="007f5-156">**IWordBreaker::BreakText** returns successfully (returns S\_OK) and does not result in an access violation.</span></span>
-   <span data-ttu-id="007f5-157">呼叫 [**IWordBreaker：： BreakText**](/windows/desktop/api/Indexsrv/nf-indexsrv-iwordbreaker-breaktext) 方法，並將 *pwcInBuf* 參數設定為 **Null** ，且 *cwc* 參數等於0。</span><span class="sxs-lookup"><span data-stu-id="007f5-157">Call to the [**IWordBreaker::BreakText**](/windows/desktop/api/Indexsrv/nf-indexsrv-iwordbreaker-breaktext) method with the *pwcInBuf* parameter set to **NULL** and the *cwc* parameter equal to 0.</span></span> <span data-ttu-id="007f5-158">**IWordBreaker：： BreakText** 失敗 (傳回 E \_) 失敗，而且不會造成存取違規。</span><span class="sxs-lookup"><span data-stu-id="007f5-158">**IWordBreaker::BreakText** fails (returns E\_FAIL) and does not result in an access violation.</span></span>
-   <span data-ttu-id="007f5-159">在索引建立期間產生的片語包含相同數目的文字。</span><span class="sxs-lookup"><span data-stu-id="007f5-159">Phrases generated during index creation contain the same number of words.</span></span>
-   <span data-ttu-id="007f5-160">在索引建立期間，會透過連續呼叫 [**IWordFormSink：:P utword**](iwordsink-putword.md) 和 [**IWordFormSink：:P utaltword**](iwordsink-putaltword.md) 方法來產生片語。</span><span class="sxs-lookup"><span data-stu-id="007f5-160">Phrases are generated during index creation through successive calls to the [**IWordFormSink::PutWord**](iwordsink-putword.md) and [**IWordFormSink::PutAltWord**](iwordsink-putaltword.md) methods.</span></span> <span data-ttu-id="007f5-161">斷詞工具在查詢時只會使用 [**IPhraseSink**](/windows/win32/api/indexsrv/nn-indexsrv-iphrasesink) 物件。</span><span class="sxs-lookup"><span data-stu-id="007f5-161">The word breaker uses only the [**IPhraseSink**](/windows/win32/api/indexsrv/nn-indexsrv-iphrasesink) object during query time.</span></span>

## <a name="related-topics"></a><span data-ttu-id="007f5-162">相關主題</span><span class="sxs-lookup"><span data-stu-id="007f5-162">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="007f5-163">擴充語言資源</span><span class="sxs-lookup"><span data-stu-id="007f5-163">Extending Language Resources</span></span>](extending-language-resources-in-windows-search.md)
</dt> <dt>

[<span data-ttu-id="007f5-164">瞭解語言資源元件</span><span class="sxs-lookup"><span data-stu-id="007f5-164">Understanding Language Resource Components</span></span>](understanding-language-resource-components.md)
</dt> <dt>

[<span data-ttu-id="007f5-165">執行斷詞工具和字幹分析器</span><span class="sxs-lookup"><span data-stu-id="007f5-165">Implementing a Word Breaker and Stemmer</span></span>](implementing-a-word-breaker-and-stemmer.md)
</dt> <dt>

[<span data-ttu-id="007f5-166">語言和 Unicode 考慮</span><span class="sxs-lookup"><span data-stu-id="007f5-166">Linguistic and Unicode Considerations</span></span>](linguistic-and-unicode-considerations.md)
</dt> </dl>

 

 
