---
description: 藉由使用通知 Api 元件，可通知索引子已變更、移動或刪除專案，並可將搜尋範圍新增至需要編制索引之 Url 的 Windows Search 索引子佇列。
ms.assetid: 817550e2-a256-48d5-9fa6-1ea04f8b8589
title: '通知索引變更 (Windows Search) '
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f5a89112da20c4010e1fc23fab16778309195d20
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104112485"
---
# <a name="notifying-the-index-of-changes-windows-search"></a><span data-ttu-id="1aa88-103">通知索引變更 (Windows Search) </span><span class="sxs-lookup"><span data-stu-id="1aa88-103">Notifying the Index of Changes (Windows Search)</span></span>

<span data-ttu-id="1aa88-104">藉由使用通知 Api 元件，可通知索引子已變更、移動或刪除專案，並可將搜尋範圍新增至需要編制索引之 Url 的 Windows Search 索引子佇列。</span><span class="sxs-lookup"><span data-stu-id="1aa88-104">By using the notification APIs components can notify the indexer that an item has been changed, moved or deleted, and can add search scopes to the Windows Search indexer's queue of URLs that require indexing.</span></span>

<span data-ttu-id="1aa88-105">元件可以通知 Windows Search 索引子，其存放區中的資料已變更。</span><span class="sxs-lookup"><span data-stu-id="1aa88-105">Components can notify the Windows Search indexer that data in their store has changed.</span></span> <span data-ttu-id="1aa88-106">一般而言，您可以依賴索引子的排程編目。</span><span class="sxs-lookup"><span data-stu-id="1aa88-106">Typically, you can rely on the indexer's scheduled crawls.</span></span> <span data-ttu-id="1aa88-107">不過，若要將通知提供給索引子，可以藉由確保索引子不會對增量索引的整個存放區進行編目，來改善效能。</span><span class="sxs-lookup"><span data-stu-id="1aa88-107">However, providing notifications to the indexer can improve performance by ensuring the indexer doesn't crawl the entire store on incremental indexes.</span></span> <span data-ttu-id="1aa88-108">例如，如果您預期您的資料存放區相當大且/或非常忙碌，例如電子郵件資料存放區，則建議您這樣做。</span><span class="sxs-lookup"><span data-stu-id="1aa88-108">For example, this might recommended if you expect your data store to be exceptionally large and/or exceptionally busy, such as an email data store for example.</span></span>

-   [<span data-ttu-id="1aa88-109">執行索引子管理的通知</span><span class="sxs-lookup"><span data-stu-id="1aa88-109">Implementing Indexer-managed Notifications</span></span>](#implementing-indexer-managed-notifications)
    -   [<span data-ttu-id="1aa88-110">通知佇列</span><span class="sxs-lookup"><span data-stu-id="1aa88-110">Notifications Queue</span></span>](#notifications-queue)
    -   [<span data-ttu-id="1aa88-111">ISearchPersistentItemsChangedSink</span><span class="sxs-lookup"><span data-stu-id="1aa88-111">ISearchPersistentItemsChangedSink</span></span>](#isearchpersistentitemschangedsink)
-   [<span data-ttu-id="1aa88-112">執行提供者管理的通知</span><span class="sxs-lookup"><span data-stu-id="1aa88-112">Implementing Provider-managed Notifications</span></span>](#implementing-provider-managed-notifications)
    -   [<span data-ttu-id="1aa88-113">通知佇列</span><span class="sxs-lookup"><span data-stu-id="1aa88-113">Notifications Queue</span></span>](#notifications-queue)
    -   [<span data-ttu-id="1aa88-114">ISearchItemsChangedSink</span><span class="sxs-lookup"><span data-stu-id="1aa88-114">ISearchItemsChangedSink</span></span>](#isearchitemschangedsink)
    -   [<span data-ttu-id="1aa88-115">ISearchNotifyInlineSite</span><span class="sxs-lookup"><span data-stu-id="1aa88-115">ISearchNotifyInlineSite</span></span>](#isearchnotifyinlinesite)
-   [<span data-ttu-id="1aa88-116">其他資源</span><span class="sxs-lookup"><span data-stu-id="1aa88-116">Additional Resources</span></span>](#additional-resources)
-   [<span data-ttu-id="1aa88-117">相關主題</span><span class="sxs-lookup"><span data-stu-id="1aa88-117">Related topics</span></span>](#related-topics)

## <a name="implementing-indexer-managed-notifications"></a><span data-ttu-id="1aa88-118">執行索引子管理的通知</span><span class="sxs-lookup"><span data-stu-id="1aa88-118">Implementing Indexer-managed Notifications</span></span>

<span data-ttu-id="1aa88-119">索引子管理的通知可讓您控制資料存放區的存取權，同時讓您能夠在整個編制索引過程中維護通知佇列。</span><span class="sxs-lookup"><span data-stu-id="1aa88-119">Indexer-managed notifications enable you to control access to your data store while freeing you of maintaining the notifications queue throughout the entire indexing process.</span></span> <span data-ttu-id="1aa88-120">您的通知提供者必須監視對資料存放區所做的變更，並建立通知佇列。</span><span class="sxs-lookup"><span data-stu-id="1aa88-120">Your notifications provider must monitor changes to the data store and create a notifications queue.</span></span> <span data-ttu-id="1aa88-121">您的提供者會定期將一批變更通知傳送至索引子。</span><span class="sxs-lookup"><span data-stu-id="1aa88-121">Periodically, your provider sends a batch of change notifications to the indexer.</span></span> <span data-ttu-id="1aa88-122">當索引子收到您的通知時，它會傳回確認，而且您可以從佇列中移除 () 的專案。</span><span class="sxs-lookup"><span data-stu-id="1aa88-122">When the indexer receives your notifications, it returns an acknowledgement and you can remove the item(s) from your queue.</span></span> <span data-ttu-id="1aa88-123">如果您在一段時間後未收到通知，您可以重新傳送通知。</span><span class="sxs-lookup"><span data-stu-id="1aa88-123">If after a period of time you do not receive an acknowledgement, you can re-send the notifications.</span></span> <span data-ttu-id="1aa88-124">如果發生失敗，索引子會重建其內部佇列的專案，以編目或執行存放區的增量編目。</span><span class="sxs-lookup"><span data-stu-id="1aa88-124">In case of failure, the indexer rebuilds its internal queue of items to crawl or performs an incremental crawl of the store.</span></span>

<span data-ttu-id="1aa88-125">若要執行索引子管理的通知，您需要執行下列動作：</span><span class="sxs-lookup"><span data-stu-id="1aa88-125">To implement indexer-managed notifications, you need to implement the following:</span></span>

-   <span data-ttu-id="1aa88-126">用於監視資料存放區中變更的機制。</span><span class="sxs-lookup"><span data-stu-id="1aa88-126">A mechanism for monitoring changes in your data store.</span></span>
-   <span data-ttu-id="1aa88-127">用來將資訊排入佇列的資料結構 (多個 [**搜尋 \_ 專案 \_ 持續 \_ 變更**](/windows/desktop/api/Searchapi/ns-searchapi-search_item_persistent_change) 結構) 這些變更。</span><span class="sxs-lookup"><span data-stu-id="1aa88-127">A data structure to queue up information (multiple [**SEARCH\_ITEM\_PERSISTENT\_CHANGE**](/windows/desktop/api/Searchapi/ns-searchapi-search_item_persistent_change) structures) about those changes.</span></span>
-   <span data-ttu-id="1aa88-128">[**ISearchPersistentItemsChangedSink**](/windows/desktop/api/Searchapi/nn-searchapi-isearchpersistentitemschangedsink) 介面，將您的通知傳送至索引子，並從索引子取得通知通知。</span><span class="sxs-lookup"><span data-stu-id="1aa88-128">[**ISearchPersistentItemsChangedSink**](/windows/desktop/api/Searchapi/nn-searchapi-isearchpersistentitemschangedsink) interface to send your notifications to the indexer and to get notification acknowledgements from the indexer.</span></span>

### <a name="notifications-queue"></a><span data-ttu-id="1aa88-129">通知佇列</span><span class="sxs-lookup"><span data-stu-id="1aa88-129">Notifications Queue</span></span>

<span data-ttu-id="1aa88-130">您必須監視並將資料存放區中的每個變更排入佇列，以傳送至索引子作為通知。</span><span class="sxs-lookup"><span data-stu-id="1aa88-130">You need to monitor and queue up every change in your data store to send to the indexer as a notification.</span></span> <span data-ttu-id="1aa88-131">您要排入佇列的通知數目，以及將它們傳送至索引子的頻率，取決於您的情況。</span><span class="sxs-lookup"><span data-stu-id="1aa88-131">How many notifications you queue up and how frequently you send them to the indexer depends on your circumstance.</span></span> <span data-ttu-id="1aa88-132">您可能會針對每隔 *n* 次的變更或在某個 *t* 時間間隔之後，或在其中兩者的組合，傳送一批通知。</span><span class="sxs-lookup"><span data-stu-id="1aa88-132">Perhaps you send a batch of notifications for every *n* number of changes or after some *t* time interval, or a combination of the two.</span></span>

<span data-ttu-id="1aa88-133">索引子預期通知會出現在 [**搜尋 \_ 專案 \_ 持續 \_ 變更**](/windows/desktop/api/Searchapi/ns-searchapi-search_item_persistent_change) 結構的陣列中，因此您可以選擇以同樣的方式來執行您的佇列。</span><span class="sxs-lookup"><span data-stu-id="1aa88-133">The indexer expects the notifications to come in an array of [**SEARCH\_ITEM\_PERSISTENT\_CHANGE**](/windows/desktop/api/Searchapi/ns-searchapi-search_item_persistent_change) structures, so you may choose to implement your queue similarly.</span></span>

### <a name="isearchpersistentitemschangedsink"></a><span data-ttu-id="1aa88-134">ISearchPersistentItemsChangedSink</span><span class="sxs-lookup"><span data-stu-id="1aa88-134">ISearchPersistentItemsChangedSink</span></span>

<span data-ttu-id="1aa88-135">若要存取此介面，您必須先具現化 [**ISearchManager**](/windows/desktop/api/Searchapi/nn-searchapi-isearchmanager) 物件，以取得 [**ISearchCatalogManager**](/windows/desktop/api/Searchapi/nn-searchapi-isearchcatalogmanager) 物件的存取權。</span><span class="sxs-lookup"><span data-stu-id="1aa88-135">To access this interface, you first instantiate an [**ISearchManager**](/windows/desktop/api/Searchapi/nn-searchapi-isearchmanager) object to gain access to an [**ISearchCatalogManager**](/windows/desktop/api/Searchapi/nn-searchapi-isearchcatalogmanager) object.</span></span> <span data-ttu-id="1aa88-136">從該 **ISearchCatalogManager** 物件，您可以具現化 [**ISearchPersistentItemsChangedSink**](/windows/desktop/api/Searchapi/nn-searchapi-isearchpersistentitemschangedsink) 物件，並使用 **OnItemsChanged** 方法的呼叫來通知索引子資料變更。</span><span class="sxs-lookup"><span data-stu-id="1aa88-136">From that **ISearchCatalogManager** object, you instantiate an [**ISearchPersistentItemsChangedSink**](/windows/desktop/api/Searchapi/nn-searchapi-isearchpersistentitemschangedsink) object and notify the indexer of the data changes with a call to the **OnItemsChanged** method.</span></span>

<span data-ttu-id="1aa88-137">在呼叫這個方法時，您會包含要報告的變更數目，以及 [**搜尋 \_ 專案 \_ 持續性 \_ 變更**](/windows/desktop/api/Searchapi/ns-searchapi-search_item_persistent_change) 結構的陣列。</span><span class="sxs-lookup"><span data-stu-id="1aa88-137">In the call to this method, you include the number of changes being reported and an array of [**SEARCH\_ITEM\_PERSISTENT\_CHANGE**](/windows/desktop/api/Searchapi/ns-searchapi-search_item_persistent_change) structures.</span></span> <span data-ttu-id="1aa88-138">您會取得 HR 完成代碼的陣列，指出是否接受每個 URL 來編制索引。</span><span class="sxs-lookup"><span data-stu-id="1aa88-138">You get back an array of HR completion codes indicating whether each URL was accepted for indexing.</span></span> <span data-ttu-id="1aa88-139">這是您從索引子收到的確認。</span><span class="sxs-lookup"><span data-stu-id="1aa88-139">This is your acknowledgement from the indexer.</span></span>

## <a name="implementing-provider-managed-notifications"></a><span data-ttu-id="1aa88-140">執行提供者管理的通知</span><span class="sxs-lookup"><span data-stu-id="1aa88-140">Implementing Provider-managed Notifications</span></span>

<span data-ttu-id="1aa88-141">提供者管理的通知可讓您控制資料存放區的存取權，並在更新 Windows Search 目錄時監視索引子的進度。</span><span class="sxs-lookup"><span data-stu-id="1aa88-141">Provider-managed notifications enable you to control access to your data store and to monitor the progress of the indexer as it updates the Windows Search catalog.</span></span> <span data-ttu-id="1aa88-142">您的提供者必須監視對資料存放區所做的變更，並建立通知佇列。</span><span class="sxs-lookup"><span data-stu-id="1aa88-142">Your provider must monitor changes to the data store and create a notifications queue.</span></span> <span data-ttu-id="1aa88-143">您的提供者會定期將一批變更通知傳送至索引子。</span><span class="sxs-lookup"><span data-stu-id="1aa88-143">Periodically, your provider sends a batch of change notifications to the indexer.</span></span> <span data-ttu-id="1aa88-144">當索引子收到通知時，它會傳回確認。</span><span class="sxs-lookup"><span data-stu-id="1aa88-144">When the indexer receives your notifications, it returns an acknowledgement.</span></span> <span data-ttu-id="1aa88-145">如果您在一段時間後未收到通知，您可以重新傳送通知。</span><span class="sxs-lookup"><span data-stu-id="1aa88-145">If after a period of time you do not receive an acknowledgement, you can re-send the notifications.</span></span> <span data-ttu-id="1aa88-146">當索引子編目資料存放區，並更新 Windows Search 目錄時，它會通知您每個目錄更新的提供者，而且您可以從佇列中移除 (s) 的專案。</span><span class="sxs-lookup"><span data-stu-id="1aa88-146">As the indexer crawls the data store and updates the Windows Search catalog, it notifies your provider of each catalog update and you can remove the item(s) from your queue.</span></span> <span data-ttu-id="1aa88-147">您的提供者會在此程式中維護其通知佇列，如果發生失敗，您可以重新傳送通知給索引子。</span><span class="sxs-lookup"><span data-stu-id="1aa88-147">Your provider maintains its notification queue throughout this process so that in case of failure, you can resend notifications to the indexer.</span></span>

<span data-ttu-id="1aa88-148">若要執行提供者管理的通知，您需要執行下列動作：</span><span class="sxs-lookup"><span data-stu-id="1aa88-148">To implement provider-managed notifications, you need to implement the following:</span></span>

-   <span data-ttu-id="1aa88-149">用於監視資料存放區中變更的機制。</span><span class="sxs-lookup"><span data-stu-id="1aa88-149">A mechanism for monitoring changes in your data store.</span></span>
-   <span data-ttu-id="1aa88-150">用來將資訊排入佇列的資料結構 (多個 [**搜尋 \_ 專案 \_ 變更**](/windows/desktop/api/Searchapi/ns-searchapi-search_item_change) 結構) 這些變更的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="1aa88-150">A data structure to queue up information (multiple [**SEARCH\_ITEM\_CHANGE**](/windows/desktop/api/Searchapi/ns-searchapi-search_item_change) structures) about those changes.</span></span>
-   <span data-ttu-id="1aa88-151">[**ISearchItemsChangedSink**](/windows/desktop/api/Searchapi/nn-searchapi-isearchitemschangedsink) 介面，將您的通知傳送至索引子，並從索引子取得通知通知。</span><span class="sxs-lookup"><span data-stu-id="1aa88-151">[**ISearchItemsChangedSink**](/windows/desktop/api/Searchapi/nn-searchapi-isearchitemschangedsink) interface to send your notifications to the indexer and to get notification acknowledgements from the indexer.</span></span>
-   <span data-ttu-id="1aa88-152">[**ISearchNotifyInlineSite**](/windows/desktop/api/Searchapi/nn-searchapi-isearchnotifyinlinesite) 介面，以接收有關索引狀態的更新。</span><span class="sxs-lookup"><span data-stu-id="1aa88-152">[**ISearchNotifyInlineSite**](/windows/desktop/api/Searchapi/nn-searchapi-isearchnotifyinlinesite) interface to receive updates about the status of indexing.</span></span>

### <a name="notifications-queue"></a><span data-ttu-id="1aa88-153">通知佇列</span><span class="sxs-lookup"><span data-stu-id="1aa88-153">Notifications Queue</span></span>

<span data-ttu-id="1aa88-154">您必須監視並將資料存放區中的每個變更排入佇列，以傳送至索引子作為通知。</span><span class="sxs-lookup"><span data-stu-id="1aa88-154">You need to monitor and queue up every change in your data store to send to the indexer as a notification.</span></span> <span data-ttu-id="1aa88-155">您要排入佇列的通知數目，以及將它們傳送至索引子的頻率，取決於您的情況。</span><span class="sxs-lookup"><span data-stu-id="1aa88-155">How many notifications you queue up and how frequently you send them to the indexer depends on your circumstance.</span></span> <span data-ttu-id="1aa88-156">您可能會針對每隔 *n* 次的變更或在某個 *t* 時間間隔之後，或在其中兩者的組合，傳送一批通知。</span><span class="sxs-lookup"><span data-stu-id="1aa88-156">Perhaps you send a batch of notifications for every *n* number of changes or after some *t* time interval, or a combination of the two.</span></span>

<span data-ttu-id="1aa88-157">索引子預期通知會出現在 [**搜尋 \_ 專案 \_ 變更**](/windows/desktop/api/Searchapi/ns-searchapi-search_item_change) 結構的陣列中，因此您可以選擇以類似的方式儲存變更資訊。</span><span class="sxs-lookup"><span data-stu-id="1aa88-157">The indexer expects the notifications to come in an array of [**SEARCH\_ITEM\_CHANGE**](/windows/desktop/api/Searchapi/ns-searchapi-search_item_change) structures, so you may choose to store change information similarly.</span></span> <span data-ttu-id="1aa88-158">不過，您也必須能夠比對您傳送的通知和索引子所傳回的更新。</span><span class="sxs-lookup"><span data-stu-id="1aa88-158">However, you also need to be able to match the notifications you send with the acknowledgements and updates returned by the indexer.</span></span> <span data-ttu-id="1aa88-159">您可能也想要能夠偵測取得通知所需的時間，以便您可以決定是否要重新傳送通知。</span><span class="sxs-lookup"><span data-stu-id="1aa88-159">You may also want to be able to detect how long it takes to get acknowledgements, so you can decide if/when to resend notifications.</span></span>

### <a name="isearchitemschangedsink"></a><span data-ttu-id="1aa88-160">ISearchItemsChangedSink</span><span class="sxs-lookup"><span data-stu-id="1aa88-160">ISearchItemsChangedSink</span></span>

<span data-ttu-id="1aa88-161">若要存取此介面，您必須先具現化 [**ISearchManager**](/windows/desktop/api/Searchapi/nn-searchapi-isearchmanager) 物件，以取得 [**ISearchCatalogManager**](/windows/desktop/api/Searchapi/nn-searchapi-isearchcatalogmanager) 物件的存取權。</span><span class="sxs-lookup"><span data-stu-id="1aa88-161">To access this interface, you first instantiate an [**ISearchManager**](/windows/desktop/api/Searchapi/nn-searchapi-isearchmanager) object to gain access to an [**ISearchCatalogManager**](/windows/desktop/api/Searchapi/nn-searchapi-isearchcatalogmanager) object.</span></span> <span data-ttu-id="1aa88-162">從該 **ISearchCatalogManager** 物件，您可以具現化 [**ISearchItemsChangedSink**](/windows/desktop/api/Searchapi/nn-searchapi-isearchitemschangedsink) 物件，並使用 **OnItemsChanged** 方法的呼叫來通知索引子資料變更。</span><span class="sxs-lookup"><span data-stu-id="1aa88-162">From that **ISearchCatalogManager** object, you instantiate an [**ISearchItemsChangedSink**](/windows/desktop/api/Searchapi/nn-searchapi-isearchitemschangedsink) object and notify the indexer of the data changes with a call to the **OnItemsChanged** method.</span></span>

<span data-ttu-id="1aa88-163">在呼叫這個方法時，您會包含要報告的變更數目，以及 [**搜尋 \_ 專案 \_ 變更**](/windows/desktop/api/Searchapi/ns-searchapi-search_item_change) 結構的陣列。</span><span class="sxs-lookup"><span data-stu-id="1aa88-163">In the call to this method, you include the number of changes being reported and an array of [**SEARCH\_ITEM\_CHANGE**](/windows/desktop/api/Searchapi/ns-searchapi-search_item_change) structures.</span></span> <span data-ttu-id="1aa88-164">您會取得代表每個變更的索引子指派 Docid 陣列，以及一組 HR 完成代碼陣列，指出是否接受每個 URL 來編制索引。</span><span class="sxs-lookup"><span data-stu-id="1aa88-164">You get back an array of indexer-assigned DocIds that represent each change as well as an array of HR completion codes indicating whether each URL was accepted for indexing.</span></span> <span data-ttu-id="1aa88-165">這是來自索引子的通知，指出它已收到您的通知，且正在準備索引項目目。</span><span class="sxs-lookup"><span data-stu-id="1aa88-165">This is your acknowledgement from the indexer that it has received your notifications and is preparing to index the items.</span></span>

<span data-ttu-id="1aa88-166">從這個位置開始，索引子會使用 [**ISearchNotifyInlineSite**](/windows/desktop/api/Searchapi/nn-searchapi-isearchnotifyinlinesite) 介面來傳送更新。</span><span class="sxs-lookup"><span data-stu-id="1aa88-166">From that point forward the indexer sends updates using the [**ISearchNotifyInlineSite**](/windows/desktop/api/Searchapi/nn-searchapi-isearchnotifyinlinesite) interface.</span></span>

### <a name="isearchnotifyinlinesite"></a><span data-ttu-id="1aa88-167">ISearchNotifyInlineSite</span><span class="sxs-lookup"><span data-stu-id="1aa88-167">ISearchNotifyInlineSite</span></span>

<span data-ttu-id="1aa88-168">若要取得您的專案和目錄之狀態的更新，您必須向索引子註冊 [**ISearchNotifyInlineSite**](/windows/desktop/api/Searchapi/nn-searchapi-isearchnotifyinlinesite) 介面，讓它可以將您的回呼傳送給您。</span><span class="sxs-lookup"><span data-stu-id="1aa88-168">In order to get updates about the status of both your items and the catalog, you must register your [**ISearchNotifyInlineSite**](/windows/desktop/api/Searchapi/nn-searchapi-isearchnotifyinlinesite) interface with the indexer so it can send you callbacks.</span></span> <span data-ttu-id="1aa88-169">使用 [**ISearchNotifyInlineSite：： OnItemIndexedStatusChange**](/windows/desktop/api/Searchapi/nf-searchapi-isearchnotifyinlinesite-onitemindexedstatuschange) 所傳送的每個更新都會依 DocId 來識別專案，每個專案的狀態 ([**搜尋 \_ 專案 \_ 編制索引 \_ 狀態**](/windows/desktop/api/Searchapi/ns-searchapi-search_item_indexing_status)) 和編制索引階段 ([**搜尋 \_ 索引 \_ 階段**](/windows/desktop/api/Searchapi/ne-searchapi-search_indexing_phase)) 專案所在。</span><span class="sxs-lookup"><span data-stu-id="1aa88-169">Each update sent using [**ISearchNotifyInlineSite::OnItemIndexedStatusChange**](/windows/desktop/api/Searchapi/nf-searchapi-isearchnotifyinlinesite-onitemindexedstatuschange) identifies the items by DocId, the status of each item ([**SEARCH\_ITEM\_INDEXING\_STATUS**](/windows/desktop/api/Searchapi/ns-searchapi-search_item_indexing_status)) and the indexing phase ([**SEARCH\_INDEXING\_PHASE**](/windows/desktop/api/Searchapi/ne-searchapi-search_indexing_phase)) the items are in.</span></span>

<span data-ttu-id="1aa88-170">您不只會收到每個專案狀態的更新，如先前所述，您也會取得有關目錄本身狀態的重要資訊。</span><span class="sxs-lookup"><span data-stu-id="1aa88-170">Not only do you receive updates on the status of each item, as described earlier, you also get important information about the status of the catalog itself.</span></span> <span data-ttu-id="1aa88-171">終端使用者、協力廠商應用程式或其他失敗可能會中斷或重新開機 Windows Search 服務。</span><span class="sxs-lookup"><span data-stu-id="1aa88-171">The Windows Search service can be interrupted or restarted by the end user, a third party application, or some other failure.</span></span> <span data-ttu-id="1aa88-172">發生這種情況時，您需要一種方式來判斷要 repush 至索引子的通知。</span><span class="sxs-lookup"><span data-stu-id="1aa88-172">When this happens, you need a way to determine what notifications to repush to the indexer.</span></span>

<span data-ttu-id="1aa88-173">Windows Search 服務所呼叫的 [**ISearchNotifyInlineSite：： OnCatalogStatusChange**](/windows/desktop/api/Searchapi/nf-searchapi-isearchnotifyinlinesite-oncatalogstatuschange) 方法會使用下表所述的參數，通知用戶端有關目錄的狀態。</span><span class="sxs-lookup"><span data-stu-id="1aa88-173">The [**ISearchNotifyInlineSite::OnCatalogStatusChange**](/windows/desktop/api/Searchapi/nf-searchapi-isearchnotifyinlinesite-oncatalogstatuschange) method, called by the Windows Search service, informs clients about the status of the catalog using the parameters described in the following table.</span></span>



| <span data-ttu-id="1aa88-174">參數</span><span class="sxs-lookup"><span data-stu-id="1aa88-174">Parameter</span></span>                 | <span data-ttu-id="1aa88-175">Description</span><span class="sxs-lookup"><span data-stu-id="1aa88-175">Description</span></span>                                                                                                                                           |
|---------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="1aa88-176">guidCatalogResetSignature</span><span class="sxs-lookup"><span data-stu-id="1aa88-176">guidCatalogResetSignature</span></span> | <span data-ttu-id="1aa88-177">代表目錄重設的 GUID。</span><span class="sxs-lookup"><span data-stu-id="1aa88-177">A GUID representing the catalog reset.</span></span> <span data-ttu-id="1aa88-178">如果此 GUID 有所變更，則必須重新傳送所有的通知。</span><span class="sxs-lookup"><span data-stu-id="1aa88-178">If this GUID changes, all notifications must be resent.</span></span>                                                        |
| <span data-ttu-id="1aa88-179">guidCheckPointSignature</span><span class="sxs-lookup"><span data-stu-id="1aa88-179">guidCheckPointSignature</span></span>   | <span data-ttu-id="1aa88-180">GUID，表示最後還原的檢查點。</span><span class="sxs-lookup"><span data-stu-id="1aa88-180">A GUID representing the last checkpoint restored.</span></span> <span data-ttu-id="1aa88-181">如果此 GUID 有所變更，則必須重新傳送上次儲存的檢查點之後累積的所有通知。</span><span class="sxs-lookup"><span data-stu-id="1aa88-181">If this GUID changes, all notifications accumulated since the last saved checkpoint must be resent.</span></span> |
| <span data-ttu-id="1aa88-182">dwLastCheckPointNumber</span><span class="sxs-lookup"><span data-stu-id="1aa88-182">dwLastCheckPointNumber</span></span>    | <span data-ttu-id="1aa88-183">表示已儲存最後一個檢查點的數位。</span><span class="sxs-lookup"><span data-stu-id="1aa88-183">A number indicating the last checkpoint saved.</span></span>                                                                                                        |



 

 

<span data-ttu-id="1aa88-184">當發生類別目錄檢查點時，搜尋服務會更新 *dwLastCheckPointNumber*，而在該檢查點之前傳送的所有通知都是安全且可在發生服務失敗時復原的。</span><span class="sxs-lookup"><span data-stu-id="1aa88-184">When a catalog checkpoint occurs, the search service updates the *dwLastCheckPointNumber*, and all notifications sent prior to that checkpoint are safe and recoverable in the event of a service failure.</span></span> <span data-ttu-id="1aa88-185">通知提供者只需要追蹤在類別目錄還原或重設時，檢查點和 repush 之間傳送的通知。</span><span class="sxs-lookup"><span data-stu-id="1aa88-185">Notifications providers need to track only those notifications sent between checkpoints and repush in case of a catalog restore or reset.</span></span>

<span data-ttu-id="1aa88-186">如果發生目錄還原，搜尋服務會將目錄回復到最後儲存的檢查點，並更新 *guidCheckPointSignature*。</span><span class="sxs-lookup"><span data-stu-id="1aa88-186">If a catalog restore occurs, the search service rolls back the catalog to the last saved checkpoint and updates the *guidCheckPointSignature*.</span></span> <span data-ttu-id="1aa88-187">在這種情況下，通知提供者必須 repush 由 *dwLastCheckPointNumber* 所識別的最新儲存檢查點以來累積的所有通知。</span><span class="sxs-lookup"><span data-stu-id="1aa88-187">In this situation, notifications providers must repush all notifications accumulated since the most recent saved checkpoint as identified by the *dwLastCheckPointNumber*.</span></span>

<span data-ttu-id="1aa88-188">如果應該重設目錄，搜尋服務會重設整個目錄，並更新 *guidCatalogResetSignature*。</span><span class="sxs-lookup"><span data-stu-id="1aa88-188">If a catalog reset should occur, the search service resets the entire catalog and updates the *guidCatalogResetSignature*.</span></span> <span data-ttu-id="1aa88-189">通知提供者必須再次 repush 其整個編目範圍。</span><span class="sxs-lookup"><span data-stu-id="1aa88-189">Notifications provider must repush its entire crawl scope again.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="1aa88-190">其他資源</span><span class="sxs-lookup"><span data-stu-id="1aa88-190">Additional Resources</span></span>

-   <span data-ttu-id="1aa88-191">如需索引編制程式的總覽，請參閱 [索引](-search-indexing-process-overview.md)程式。</span><span class="sxs-lookup"><span data-stu-id="1aa88-191">For an overview of the indexing process, see [The Indexing Process](-search-indexing-process-overview.md).</span></span>
-   <span data-ttu-id="1aa88-192">如需目錄管理員和目錄搜尋管理員 (CSM) 的總覽，請參閱 [使用目錄管理員](-search-3x-wds-mngidx-catalog-manager.md) 以及 [使用編目範圍管理員](-search-3x-wds-extidx-csm.md)。</span><span class="sxs-lookup"><span data-stu-id="1aa88-192">For overviews of the Catalog Manager and Catalog Search Manager (CSM), see [Using the Catalog Manager](-search-3x-wds-mngidx-catalog-manager.md) and [Using the Crawl Scope Manager](-search-3x-wds-extidx-csm.md).</span></span>
-   <span data-ttu-id="1aa88-193">如需建立 Shell 資料存放區的詳細資訊，請參閱 [執行基本資料夾物件介面](/previous-versions/windows/desktop/legacy/cc144093(v=vs.85))。</span><span class="sxs-lookup"><span data-stu-id="1aa88-193">For information about creating a Shell data store, see [Implementing the Basic Folder Object Interfaces](/previous-versions/windows/desktop/legacy/cc144093(v=vs.85)).</span></span>

## <a name="related-topics"></a><span data-ttu-id="1aa88-194">相關主題</span><span class="sxs-lookup"><span data-stu-id="1aa88-194">Related topics</span></span>

<dl> <dt>

<span data-ttu-id="1aa88-195">**概念**</span><span class="sxs-lookup"><span data-stu-id="1aa88-195">**Conceptual**</span></span>
</dt> <dt>

[<span data-ttu-id="1aa88-196">開發通訊協定處理常式</span><span class="sxs-lookup"><span data-stu-id="1aa88-196">Developing Protocol Handlers</span></span>](-search-3x-wds-phaddins.md)
</dt> <dt>

[<span data-ttu-id="1aa88-197">瞭解通訊協定處理常式</span><span class="sxs-lookup"><span data-stu-id="1aa88-197">Understanding Protocol Handlers</span></span>](-search-3x-wds-extidx-prot-implementing.md)
</dt> <dt>

[<span data-ttu-id="1aa88-198">新增圖示和快顯功能表</span><span class="sxs-lookup"><span data-stu-id="1aa88-198">Adding Icons and Context Menus</span></span>](-search-3x-wds-ph-ui-extensions.md)
</dt> <dt>

[<span data-ttu-id="1aa88-199">程式碼範例：通訊協定處理常式的 Shell 擴充功能</span><span class="sxs-lookup"><span data-stu-id="1aa88-199">Code Sample: Shell Extensions for Protocol Handlers</span></span>](-search-3x-wds-ph-ui-samplecode.md)
</dt> <dt>

[<span data-ttu-id="1aa88-200">安裝和註冊通訊協定處理常式</span><span class="sxs-lookup"><span data-stu-id="1aa88-200">Installing and Registering Protocol Handlers</span></span>](-search-3x-wds-ph-install-registration.md)
</dt> <dt>

[<span data-ttu-id="1aa88-201">建立通訊協定處理常式的搜尋連接器</span><span class="sxs-lookup"><span data-stu-id="1aa88-201">Creating a Search Connector for a Protocol Handler</span></span>](-search-3x-wds-ph-search-connector.md)
</dt> <dt>

[<span data-ttu-id="1aa88-202">偵錯工具通訊協定處理常式</span><span class="sxs-lookup"><span data-stu-id="1aa88-202">Debugging Protocol Handlers</span></span>](-search-ws-protocolhandlertesting.md)
</dt> </dl>

 

 
