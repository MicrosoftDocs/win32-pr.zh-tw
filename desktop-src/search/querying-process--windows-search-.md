---
description: .
ms.assetid: 0e5a633e-1703-4b72-8a04-6da71aec0ae2
title: 在 Windows Search 中查詢進程
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d92d868cb843e96b04d6b4bd575284638b6652ee
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "103689851"
---
# <a name="querying-process-in-windows-search"></a><span data-ttu-id="d48d7-103">在 Windows Search 中查詢進程</span><span class="sxs-lookup"><span data-stu-id="d48d7-103">Querying Process in Windows Search</span></span>

<span data-ttu-id="d48d7-104">本主題的組織方式如下：</span><span class="sxs-lookup"><span data-stu-id="d48d7-104">This topic is organized as follows:</span></span>

-   [<span data-ttu-id="d48d7-105">關於查詢 Windows Search</span><span class="sxs-lookup"><span data-stu-id="d48d7-105">About Querying in Windows Search</span></span>](#about-querying-in-windows-search)
    -   [<span data-ttu-id="d48d7-106">本機和遠端查詢</span><span class="sxs-lookup"><span data-stu-id="d48d7-106">Local and Remote Queries</span></span>](#local-and-remote-queries)
    -   [<span data-ttu-id="d48d7-107">結構化查詢 API 總覽</span><span class="sxs-lookup"><span data-stu-id="d48d7-107">Structured Query API Overview</span></span>](#structured-query-api-overview)
-   [<span data-ttu-id="d48d7-108">查詢案例</span><span class="sxs-lookup"><span data-stu-id="d48d7-108">Querying Scenarios</span></span>](#querying-scenarios)
    -   [<span data-ttu-id="d48d7-109">條件提取和查詢剖析</span><span class="sxs-lookup"><span data-stu-id="d48d7-109">Condition Extraction and Query Parsing</span></span>](#condition-extraction-and-query-parsing)
    -   [<span data-ttu-id="d48d7-110">查詢索引</span><span class="sxs-lookup"><span data-stu-id="d48d7-110">Querying the Index</span></span>](#querying-the-index)
-   [<span data-ttu-id="d48d7-111">相關主題</span><span class="sxs-lookup"><span data-stu-id="d48d7-111">Related topics</span></span>](#related-topics)

## <a name="about-querying-in-windows-search"></a><span data-ttu-id="d48d7-112">關於查詢 Windows Search</span><span class="sxs-lookup"><span data-stu-id="d48d7-112">About Querying in Windows Search</span></span>

<span data-ttu-id="d48d7-113">Windows Search 中的查詢是以下列四種方法為基礎：</span><span class="sxs-lookup"><span data-stu-id="d48d7-113">Querying in Windows Search is based on the following four approaches:</span></span>

-   <span data-ttu-id="d48d7-114">[Advanced Query 語法](-search-3x-advancedquerysyntax.md) (AQS) </span><span class="sxs-lookup"><span data-stu-id="d48d7-114">[Advanced Query Syntax](-search-3x-advancedquerysyntax.md) (AQS)</span></span>
-   <span data-ttu-id="d48d7-115">NQS) 的自然查詢語法 (</span><span class="sxs-lookup"><span data-stu-id="d48d7-115">Natural Query Syntax (NQS)</span></span>
-   <span data-ttu-id="d48d7-116">結構化查詢語言 (SQL) (Structured Query Language (SQL))</span><span class="sxs-lookup"><span data-stu-id="d48d7-116">Structured Query Language (SQL)</span></span>
-   <span data-ttu-id="d48d7-117">結構化查詢介面</span><span class="sxs-lookup"><span data-stu-id="d48d7-117">Structured query interfaces</span></span>

<span data-ttu-id="d48d7-118">AQS 是 Windows Search 用來查詢索引，以及精簡和縮小搜尋參數的預設查詢語法。</span><span class="sxs-lookup"><span data-stu-id="d48d7-118">AQS is the default query syntax used by Windows Search to query the index and to refine and narrow search parameters.</span></span> <span data-ttu-id="d48d7-119">AQS 主要是使用者面向的，可供使用者用來建立 AQS 查詢，但開發人員也可以使用它來以程式設計方式建立查詢。</span><span class="sxs-lookup"><span data-stu-id="d48d7-119">AQS is primarily user facing, and can be used by users to build AQS queries, but can also be used by developers to build queries programmatically.</span></span> <span data-ttu-id="d48d7-120">在 Windows 7 中，已引進標準 AQS，且必須用來以程式設計方式產生 AQS 查詢。</span><span class="sxs-lookup"><span data-stu-id="d48d7-120">In Windows 7, canonical AQS was introduced and must be used to programmatically generate AQS queries.</span></span> <span data-ttu-id="d48d7-121">在 Windows 7 （含）以後版本中，您可以根據是否符合 AQS 條件來使用快捷方式功能表選項。</span><span class="sxs-lookup"><span data-stu-id="d48d7-121">In Windows 7 and later, a shortcut menu option can be available based on whether an AQS condition is met.</span></span> <span data-ttu-id="d48d7-122">如需詳細資訊，請參閱 [建立快捷方式功能表處理常式](../shell/context-menu-handlers.md)中的「使用 Advanced Query 語法取得靜態動詞的動態行為」。</span><span class="sxs-lookup"><span data-stu-id="d48d7-122">For more information, see "Getting Dynamic Behavior for Static Verbs by Using Advanced Query Syntax" in [Creating Context Menu Handlers](../shell/context-menu-handlers.md).</span></span> <span data-ttu-id="d48d7-123">AQS 查詢可以限制為特定類型的檔案，也就是所謂的檔案類型。</span><span class="sxs-lookup"><span data-stu-id="d48d7-123">AQS queries can be limited to specific types of files, which are known as file kinds.</span></span> <span data-ttu-id="d48d7-124">如需詳細資訊，請參閱 [檔案類型和關聯](../shell/fa-intro.md)。</span><span class="sxs-lookup"><span data-stu-id="d48d7-124">For more information, see [File Types and Associations](../shell/fa-intro.md).</span></span> <span data-ttu-id="d48d7-125">如需相關屬性的參考 [檔，請參閱](../properties/props-system-kind.md) [KindText](../properties/props-system-kindtext.md)。</span><span class="sxs-lookup"><span data-stu-id="d48d7-125">For reference documentation on the relevant properties, see [System.Kind](../properties/props-system-kind.md), and [System.KindText](../properties/props-system-kindtext.md).</span></span>

<span data-ttu-id="d48d7-126">NQS 是比 AQS 更寬鬆的查詢語法，類似于人類語言。</span><span class="sxs-lookup"><span data-stu-id="d48d7-126">NQS is a query syntax that is more relaxed than AQS, and is similar to human language.</span></span> <span data-ttu-id="d48d7-127">如果選取 NQS，而不是預設的 AQS，Windows Search 可以使用 NQS 來查詢索引。</span><span class="sxs-lookup"><span data-stu-id="d48d7-127">NQS can be used by Windows Search to query the index if NQS is selected instead of the default, AQS.</span></span>

<span data-ttu-id="d48d7-128">SQL 是定義查詢的文字語言。</span><span class="sxs-lookup"><span data-stu-id="d48d7-128">SQL is a text language that defines queries.</span></span> <span data-ttu-id="d48d7-129">SQL 在許多不同的資料庫技術中都很常見。</span><span class="sxs-lookup"><span data-stu-id="d48d7-129">SQL is common across many different database technologies.</span></span> <span data-ttu-id="d48d7-130">Windows Search 會使用 SQL、執行它的子集，並藉由將專案加入至語言來延伸它。</span><span class="sxs-lookup"><span data-stu-id="d48d7-130">Windows Search uses SQL, implements a subset of it, and extends it by adding elements to the language.</span></span> <span data-ttu-id="d48d7-131">Windows Search SQL 會延伸標準的 SQL-92 和 SQL-99 資料庫查詢語法，以利用文字搜尋來增強它的實用性。</span><span class="sxs-lookup"><span data-stu-id="d48d7-131">Windows Search SQL extends the standard SQL-92 and SQL-99 database query syntax to enhance its usefulness with text-based searches.</span></span> <span data-ttu-id="d48d7-132">Windows Search SQL 的所有功能都與 Windows XP 和 Windows Server 2003 及更新版本上的 Windows Search 相容。</span><span class="sxs-lookup"><span data-stu-id="d48d7-132">All features of Windows Search SQL are compatible with Windows Search on Windows XP and Windows Server 2003, and later.</span></span> <span data-ttu-id="d48d7-133">如需 Windows Search SQL 的詳細資訊，請參閱 [查詢具有 WINDOWS SEARCH Sql 語法的索引](-search-sql-windowssearch-entry.md)，以及 [Windows Search SQL 語法的總覽](-search-sql-ovwofsearchquery.md)。</span><span class="sxs-lookup"><span data-stu-id="d48d7-133">For more information about Windows Search SQL, see [Querying the Index with Windows Search SQL Syntax](-search-sql-windowssearch-entry.md), and [Overview of Windows Search SQL Syntax](-search-sql-ovwofsearchquery.md).</span></span>

<span data-ttu-id="d48d7-134">本主題稍後會描述結構化查詢 Api。</span><span class="sxs-lookup"><span data-stu-id="d48d7-134">The structured query APIs are described later in this topic.</span></span> <span data-ttu-id="d48d7-135">如需結構化查詢 Api 的參考檔，請參閱 [查詢介面](-search-querying-interfaces-entry-page.md)。</span><span class="sxs-lookup"><span data-stu-id="d48d7-135">For reference documentation on the structured query APIs, see [Querying Interfaces](-search-querying-interfaces-entry-page.md).</span></span> <span data-ttu-id="d48d7-136">[**ISearchQueryHelper**](/windows/desktop/api/Searchapi/nn-searchapi-isearchqueryhelper)說明等介面可從一組輸入值來建立 SQL 字串。</span><span class="sxs-lookup"><span data-stu-id="d48d7-136">Interfaces such as [**ISearchQueryHelper**](/windows/desktop/api/Searchapi/nn-searchapi-isearchqueryhelper) help construct SQL strings from a set of input values.</span></span> <span data-ttu-id="d48d7-137">這個介面會將 AQS 的使用者查詢轉換成 Windows Search SQL，並指定可在 SQL 中表示但無法在 AQS 中表示的查詢限制。</span><span class="sxs-lookup"><span data-stu-id="d48d7-137">This interface converts AQS user queries to Windows Search SQL and specifies query restrictions that can be expressed in SQL but not in AQS.</span></span> <span data-ttu-id="d48d7-138">[**ISearchQueryHelper**](/windows/desktop/api/Searchapi/nn-searchapi-isearchqueryhelper) 也會取得連接到 Windows Search 資料庫 OLE DB 連接字串。</span><span class="sxs-lookup"><span data-stu-id="d48d7-138">[**ISearchQueryHelper**](/windows/desktop/api/Searchapi/nn-searchapi-isearchqueryhelper) also obtains an OLE DB connection string to connect to the Windows Search database.</span></span>

### <a name="local-and-remote-queries"></a><span data-ttu-id="d48d7-139">本機和遠端查詢</span><span class="sxs-lookup"><span data-stu-id="d48d7-139">Local and Remote Queries</span></span>

<span data-ttu-id="d48d7-140">您可以在本機或遠端執行查詢。</span><span class="sxs-lookup"><span data-stu-id="d48d7-140">You can execute your queries either locally or remotely.</span></span> <span data-ttu-id="d48d7-141">下列範例顯示使用 [FROM 子句](-search-sql-from.md) 的本機查詢。</span><span class="sxs-lookup"><span data-stu-id="d48d7-141">A local query using the [FROM clause](-search-sql-from.md) is shown in the following example.</span></span> <span data-ttu-id="d48d7-142">本機查詢只會查詢本機 SystemIndex 目錄。</span><span class="sxs-lookup"><span data-stu-id="d48d7-142">A local query queries the local SystemIndex catalog only.</span></span>


```
FROM SystemIndex
```



<span data-ttu-id="d48d7-143">下列範例顯示使用 [FROM 子句](-search-sql-from.md) 的遠端查詢。</span><span class="sxs-lookup"><span data-stu-id="d48d7-143">A remote query using the [FROM clause](-search-sql-from.md) is shown in the following example.</span></span> <span data-ttu-id="d48d7-144">加入 ComputerName 會將前一個範例轉換為遠端查詢。</span><span class="sxs-lookup"><span data-stu-id="d48d7-144">Adding ComputerName transforms the previous example into a remote query.</span></span>


```
FROM [<ComputerName>.]SystemIndex
```



<span data-ttu-id="d48d7-145">根據預設，Windows XP 和 Windows Server 2003 沒有安裝 Windows Search。</span><span class="sxs-lookup"><span data-stu-id="d48d7-145">By default, Windows XP and Windows Server 2003 do not have Windows Search installed.</span></span> <span data-ttu-id="d48d7-146">只有 Windows Search 4 (WS4) 提供遠端查詢支援。</span><span class="sxs-lookup"><span data-stu-id="d48d7-146">Only Windows Search 4 (WS4) provides remote query support.</span></span> <span data-ttu-id="d48d7-147">舊版的 Windows 桌面搜尋 (WDS) ，例如3.01 和更早版本，不支援遠端查詢。</span><span class="sxs-lookup"><span data-stu-id="d48d7-147">Previous versions of Windows Desktop Search (WDS), such as 3.01 and earlier, do not support remote querying.</span></span> <span data-ttu-id="d48d7-148">您可以使用 Windows 檔案總管來查詢遠端電腦的本機索引，以尋找 "file：" 通訊協定) 所處理的檔案系統專案 (專案。</span><span class="sxs-lookup"><span data-stu-id="d48d7-148">With Windows Explorer you can query the local index of a remote computer for file system items (items handled by the "file:" protocol).</span></span>

<span data-ttu-id="d48d7-149">若要透過遠端查詢取得專案，專案必須符合下列需求：</span><span class="sxs-lookup"><span data-stu-id="d48d7-149">To retrieve an item by remote query, the item must meet the following requirements:</span></span>

-   <span data-ttu-id="d48d7-150">可透過通用命名慣例 (UNC) 路徑來存取。</span><span class="sxs-lookup"><span data-stu-id="d48d7-150">Be accessible via Universal Naming Convention (UNC) path.</span></span>
-   <span data-ttu-id="d48d7-151">存在於用戶端可存取的遠端電腦上。</span><span class="sxs-lookup"><span data-stu-id="d48d7-151">Exist on the remote computer to which the client has access.</span></span>
-   <span data-ttu-id="d48d7-152">將其安全性設定為允許用戶端擁有讀取權限。</span><span class="sxs-lookup"><span data-stu-id="d48d7-152">Have its security set to allow the client to have Read access.</span></span>

<span data-ttu-id="d48d7-153">Windows 檔案總管具有共用專案的功能，包括網路和共用中心中的「公用」共用 (的「公用」共用 \\ \\ \\ \\ ... \*\*\*\*) ，以及「使用者」共用 (\\ \\ 電腦 \\ 使用者 \\ ... ) 透過共用嚮導共用的專案。</span><span class="sxs-lookup"><span data-stu-id="d48d7-153">Windows Explorer has features for sharing items, including a "Public" share (\\\\Machine\\Public\\...) in the **Network and Sharing Center**, and a "Users" share (\\\\Machine\\Users\\...) for items shared via the Sharing Wizard.</span></span> <span data-ttu-id="d48d7-154">在您共用 (s) 的資料夾之後，您可以在 FROM 子句中指定遠端電腦的電腦名稱稱，並在範圍子句中的遠端電腦上指定 UNC 路徑，藉以查詢本機索引。</span><span class="sxs-lookup"><span data-stu-id="d48d7-154">After you share the folder(s), you can query the local index by specifying the remote computer's machine name in the FROM clause, and a UNC path on the remote computer in the SCOPE clause.</span></span> <span data-ttu-id="d48d7-155">下列範例顯示使用 FROM 和 SCOPE 子句的遠端查詢。</span><span class="sxs-lookup"><span data-stu-id="d48d7-155">A remote query using the FROM and SCOPE clauses is shown in the following example.</span></span>


```
SELECT System.ItemName FROM MachineName.SystemIndex WHERE SCOPE='file://MachineName/<path>' 
```



<span data-ttu-id="d48d7-156">此處提供的範例會使用 SQL。</span><span class="sxs-lookup"><span data-stu-id="d48d7-156">The examples provided here use SQL.</span></span>

### <a name="structured-query-api-overview"></a><span data-ttu-id="d48d7-157">結構化查詢 API 總覽</span><span class="sxs-lookup"><span data-stu-id="d48d7-157">Structured Query API Overview</span></span>

<span data-ttu-id="d48d7-158">結構化查詢可讓您依個別屬性的查詢布林值組合來搜尋資訊。</span><span class="sxs-lookup"><span data-stu-id="d48d7-158">A structured query provides the ability to search for information by Boolean combinations of queries over individual properties.</span></span> <span data-ttu-id="d48d7-159">在本主題中，我們將概述最重要的結構化查詢 Api 和方法的功能。</span><span class="sxs-lookup"><span data-stu-id="d48d7-159">In this topic we outline the functionality of the most important structured query APIs and methods.</span></span> <span data-ttu-id="d48d7-160">如需結構化查詢 Api 的參考檔，請參閱 [查詢介面](-search-querying-interfaces-entry-page.md)。</span><span class="sxs-lookup"><span data-stu-id="d48d7-160">For reference documentation on the structured query APIs, see [Querying Interfaces](-search-querying-interfaces-entry-page.md).</span></span>

### <a name="iqueryparser"></a><span data-ttu-id="d48d7-161">IQueryParser</span><span class="sxs-lookup"><span data-stu-id="d48d7-161">IQueryParser</span></span>

<span data-ttu-id="d48d7-162">[**IQueryParser：:P arse**](/windows/desktop/api/Structuredquery/nf-structuredquery-iqueryparser-parse)方法會剖析使用者輸入字串，並以 [**IQuerySolution**](/windows/desktop/api/Structuredquery/nn-structuredquery-iquerysolution)的形式產生轉譯。</span><span class="sxs-lookup"><span data-stu-id="d48d7-162">The [**IQueryParser::Parse**](/windows/desktop/api/Structuredquery/nf-structuredquery-iqueryparser-parse) method parses a user input string, and produces an interpretation in the form of an [**IQuerySolution**](/windows/desktop/api/Structuredquery/nn-structuredquery-iquerysolution).</span></span> <span data-ttu-id="d48d7-163">如果該方法的 *pCustomProperties* 參數不是 null，則它是 [**IRichChunk**](/windows/desktop/api/Structuredquerycondition/nn-structuredquerycondition-irichchunk) 物件的列舉， (每一個可辨識的自訂屬性) 。</span><span class="sxs-lookup"><span data-stu-id="d48d7-163">If the *pCustomProperties* parameter of that method is not null, then it is an enumeration of [**IRichChunk**](/windows/desktop/api/Structuredquerycondition/nn-structuredquerycondition-irichchunk) objects(one for each recognized custom property).</span></span> <span data-ttu-id="d48d7-164">其他 [**IQueryParser**](/windows/desktop/api/Structuredquery/nn-structuredquery-iqueryparser) 方法可讓應用程式設定數個選項，例如地區設定、架構、斷詞工具，以及各種命名實體類型的處理常式。</span><span class="sxs-lookup"><span data-stu-id="d48d7-164">The other [**IQueryParser**](/windows/desktop/api/Structuredquery/nn-structuredquery-iqueryparser) methods permit the application to set several options, such as locale, a schema, a word breaker, and handlers for various types of named entities.</span></span> <span data-ttu-id="d48d7-165">[**IQueryParser：： GetSchemaProvider**](/windows/desktop/api/Structuredquery/nf-structuredquery-iqueryparser-getschemaprovider) 會傳回 [**ISchemaProvider**](/windows/desktop/api/Structuredquery/nn-structuredquery-ischemaprovider) 介面，以流覽已載入的架構。</span><span class="sxs-lookup"><span data-stu-id="d48d7-165">[**IQueryParser::GetSchemaProvider**](/windows/desktop/api/Structuredquery/nf-structuredquery-iqueryparser-getschemaprovider) returns an [**ISchemaProvider**](/windows/desktop/api/Structuredquery/nn-structuredquery-ischemaprovider) interface for browsing the loaded schema.</span></span>

### <a name="iquerysolution--iconditionfactory"></a><span data-ttu-id="d48d7-166">IQuerySolution : IConditionFactory</span><span class="sxs-lookup"><span data-stu-id="d48d7-166">IQuerySolution : IConditionFactory</span></span>

<span data-ttu-id="d48d7-167">[**IQuerySolution**](/windows/desktop/api/Structuredquery/nn-structuredquery-iquerysolution)介面提供有關剖析輸入字串之結果的所有資訊。</span><span class="sxs-lookup"><span data-stu-id="d48d7-167">The [**IQuerySolution**](/windows/desktop/api/Structuredquery/nn-structuredquery-iquerysolution) interface provides all information about the result of parsing an input string.</span></span> <span data-ttu-id="d48d7-168">由於 **IQuerySolution** 也是 [**IConditionFactory**](/windows/desktop/api/Structuredquery/nn-structuredquery-iconditionfactory) 介面，因此可以建立額外的條件樹狀節點。</span><span class="sxs-lookup"><span data-stu-id="d48d7-168">Because **IQuerySolution** is also an [**IConditionFactory**](/windows/desktop/api/Structuredquery/nn-structuredquery-iconditionfactory) interface, additional condition tree nodes can be created.</span></span> <span data-ttu-id="d48d7-169">[**IQuerySolution：： GetQuery**](/windows/desktop/api/Structuredquery/nf-structuredquery-iquerysolution-getquery)方法會產生轉譯的條件樹狀結構。</span><span class="sxs-lookup"><span data-stu-id="d48d7-169">The [**IQuerySolution::GetQuery**](/windows/desktop/api/Structuredquery/nf-structuredquery-iquerysolution-getquery) method produces a condition tree for the interpretation.</span></span> <span data-ttu-id="d48d7-170">**IQuerySolution：： GetQuery** 也會傳回語義型別。</span><span class="sxs-lookup"><span data-stu-id="d48d7-170">**IQuerySolution::GetQuery** also returns the semantic type.</span></span>

### <a name="iconditionfactory"></a><span data-ttu-id="d48d7-171">IConditionFactory</span><span class="sxs-lookup"><span data-stu-id="d48d7-171">IConditionFactory</span></span>

<span data-ttu-id="d48d7-172">[**IConditionFactory**](/windows/desktop/api/Structuredquery/nn-structuredquery-iconditionfactory) 會建立條件樹狀節點。</span><span class="sxs-lookup"><span data-stu-id="d48d7-172">[**IConditionFactory**](/windows/desktop/api/Structuredquery/nn-structuredquery-iconditionfactory) creates condition tree nodes.</span></span> <span data-ttu-id="d48d7-173">如果 [**IConditionFactory：： MakeNot**](/windows/desktop/api/Structuredquery/nf-structuredquery-iconditionfactory-makenot)的 *簡化* 參數為 **VARIANT \_ TRUE**，則產生的 [**ICondition**](/windows/desktop/api/Structuredquerycondition/nn-structuredquerycondition-icondition)會簡化，而且不需要是負的節點。</span><span class="sxs-lookup"><span data-stu-id="d48d7-173">If the *simplify* parameter of [**IConditionFactory::MakeNot**](/windows/desktop/api/Structuredquery/nf-structuredquery-iconditionfactory-makenot) is **VARIANT\_TRUE**, then the resulting [**ICondition**](/windows/desktop/api/Structuredquerycondition/nn-structuredquerycondition-icondition) is simplified, and need not be a negation node.</span></span> <span data-ttu-id="d48d7-174">如果 [**IConditionFactory：： MakeAndOr**](/windows/desktop/api/Structuredquery/nf-structuredquery-iconditionfactory-makeandor)的 *pSubConditions* 參數不是 null，則該參數應為 [**ICondition**](/windows/desktop/api/Structuredquerycondition/nn-structuredquerycondition-icondition)物件的列舉，並且成為子樹。[**IConditionFactory：： MakeLeaf**](/windows/desktop/api/Structuredquery/nf-structuredquery-iconditionfactory-makeleaf)會使用指定的屬性名稱、作業和值來建立分葉節點。</span><span class="sxs-lookup"><span data-stu-id="d48d7-174">If the *pSubConditions* parameter of [**IConditionFactory::MakeAndOr**](/windows/desktop/api/Structuredquery/nf-structuredquery-iconditionfactory-makeandor) is not null, then that parameter should be an enumeration of [**ICondition**](/windows/desktop/api/Structuredquerycondition/nn-structuredquerycondition-icondition) objects, and become subtrees.[**IConditionFactory::MakeLeaf**](/windows/desktop/api/Structuredquery/nf-structuredquery-iconditionfactory-makeleaf) constructs a leaf node with a specified property name, operation, and value.</span></span> <span data-ttu-id="d48d7-175">*PValueType* 參數中的字串應該是架構中的語義型別名稱。</span><span class="sxs-lookup"><span data-stu-id="d48d7-175">The string in the *pValueType* parameter should be the name of a semantic type from the schema.</span></span> <span data-ttu-id="d48d7-176">如果 *expand* 參數為 **VARIANT \_ TRUE** 且屬性為 virtual，則產生的條件樹狀結構通常是將屬性展開為其定義的子系所產生的分離結果。</span><span class="sxs-lookup"><span data-stu-id="d48d7-176">If the *expand* parameter is **VARIANT\_TRUE** and the property is virtual, the resulting condition tree is typically a disjunction resulting from expanding the property to its defined constituents.</span></span> <span data-ttu-id="d48d7-177">如果不是 null， *pPropertyNameTerm*、 *pOperatorTerm* 和 *pValueTerm* 參數應該識別指出屬性、作業和值的詞彙。</span><span class="sxs-lookup"><span data-stu-id="d48d7-177">If not null, the *pPropertyNameTerm*, *pOperatorTerm*, and *pValueTerm* parameters should identify terms indicating the property, operation, and value.</span></span>

### <a name="icondition--ipersiststream"></a><span data-ttu-id="d48d7-178">ICondition： IPersistStream</span><span class="sxs-lookup"><span data-stu-id="d48d7-178">ICondition : IPersistStream</span></span>

<span data-ttu-id="d48d7-179">[**ICondition**](/windows/desktop/api/Structuredquerycondition/nn-structuredquerycondition-icondition)介面是條件樹狀結構中的單一節點。</span><span class="sxs-lookup"><span data-stu-id="d48d7-179">The [**ICondition**](/windows/desktop/api/Structuredquerycondition/nn-structuredquerycondition-icondition) interface is a single node in a condition tree.</span></span> <span data-ttu-id="d48d7-180">節點可以是否定節點、節點、節點或分葉節點。</span><span class="sxs-lookup"><span data-stu-id="d48d7-180">The node can be a negation node, AND node, OR node, or a leaf node.</span></span> <span data-ttu-id="d48d7-181">非分葉節點的 [**ICondition：： GetSubConditions**](/windows/desktop/api/structuredquerycondition/nf-structuredquerycondition-icondition-getsubconditions) 會傳回子樹的列舉。</span><span class="sxs-lookup"><span data-stu-id="d48d7-181">For a non-leaf node [**ICondition::GetSubConditions**](/windows/desktop/api/structuredquerycondition/nf-structuredquerycondition-icondition-getsubconditions) returns an enumeration of the subtrees.</span></span> <span data-ttu-id="d48d7-182">若為分葉節點，下列 [**ICondition**](/windows/desktop/api/Structuredquerycondition/nn-structuredquerycondition-icondition) 方法會傳回下列值：</span><span class="sxs-lookup"><span data-stu-id="d48d7-182">For a leaf node the following methods of [**ICondition**](/windows/desktop/api/Structuredquerycondition/nn-structuredquerycondition-icondition) return the following values:</span></span>

-   <span data-ttu-id="d48d7-183">[**GetComparisonInfo**](/windows/desktop/api/structuredquerycondition/nf-structuredquerycondition-icondition-getcomparisoninfo) 會傳回屬性名稱、運算和值。</span><span class="sxs-lookup"><span data-stu-id="d48d7-183">[**GetComparisonInfo**](/windows/desktop/api/structuredquerycondition/nf-structuredquerycondition-icondition-getcomparisoninfo) returns the property name, operation, and value.</span></span>
-   <span data-ttu-id="d48d7-184">[**GetValueType**](/windows/desktop/api/structuredquerycondition/nf-structuredquerycondition-icondition-getvaluetype)會傳回值的語義型別，這個值是在 [**IConditionFactory：： MakeLeaf**](/windows/desktop/api/Structuredquery/nf-structuredquery-iconditionfactory-makeleaf)的 *pszValueType* 參數中 specificied 的。</span><span class="sxs-lookup"><span data-stu-id="d48d7-184">[**GetValueType**](/windows/desktop/api/structuredquerycondition/nf-structuredquerycondition-icondition-getvaluetype) returns the semantic type of the value, which was specificied in the *pszValueType* parameter of [**IConditionFactory::MakeLeaf**](/windows/desktop/api/Structuredquery/nf-structuredquery-iconditionfactory-makeleaf).</span></span>
-   <span data-ttu-id="d48d7-185">[**GetValueNormalization**](/windows/desktop/api/structuredquerycondition/nf-structuredquerycondition-icondition-getvaluenormalization) 會傳回值的字串形式。</span><span class="sxs-lookup"><span data-stu-id="d48d7-185">[**GetValueNormalization**](/windows/desktop/api/structuredquerycondition/nf-structuredquerycondition-icondition-getvaluenormalization) returns a string form of the value.</span></span> <span data-ttu-id="d48d7-186"> (如果值已是字串，此表單就會根據大小寫、重音等進行正規化。 ) </span><span class="sxs-lookup"><span data-stu-id="d48d7-186">(If the value was already a string, this form will be normalized with regard to case, accents, and so forth.)</span></span>
-   <span data-ttu-id="d48d7-187">[**GetInputTerms**](/windows/desktop/api/structuredquerycondition/nf-structuredquerycondition-icondition-getinputterms) 會傳回輸入句子中哪些部分產生屬性名稱、作業和值的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="d48d7-187">[**GetInputTerms**](/windows/desktop/api/structuredquerycondition/nf-structuredquerycondition-icondition-getinputterms) returns information about which parts of the input sentence generated the property name, the operation, and the value.</span></span>
-   <span data-ttu-id="d48d7-188">[**Clone**](/windows/desktop/api/structuredquerycondition/nf-structuredquerycondition-icondition-clone) 會傳回條件樹狀結構的深層複本。</span><span class="sxs-lookup"><span data-stu-id="d48d7-188">[**Clone**](/windows/desktop/api/structuredquerycondition/nf-structuredquerycondition-icondition-clone) returns a deep copy of a condition tree.</span></span>

### <a name="irichchunk"></a><span data-ttu-id="d48d7-189">IRichChunk</span><span class="sxs-lookup"><span data-stu-id="d48d7-189">IRichChunk</span></span>

<span data-ttu-id="d48d7-190">每個 [**IRichChunk**](/windows/desktop/api/Structuredquerycondition/nn-structuredquerycondition-irichchunk) 物件都會識別一個 token 範圍和一個字串。</span><span class="sxs-lookup"><span data-stu-id="d48d7-190">Each [**IRichChunk**](/windows/desktop/api/Structuredquerycondition/nn-structuredquerycondition-irichchunk) object identifies a token span and a string.</span></span> <span data-ttu-id="d48d7-191">**IRichChunk** 是公用程式介面，代表範圍的相關資訊， (通常是以起始位置和長度識別的權杖範圍) 。</span><span class="sxs-lookup"><span data-stu-id="d48d7-191">**IRichChunk** is a utility interface that represents information about a span (typically a span of tokens) identified by a starting position and length.</span></span> <span data-ttu-id="d48d7-192">此範圍資訊包括字串和/或 **變異**。</span><span class="sxs-lookup"><span data-stu-id="d48d7-192">This span information includes a string and/or a **VARIANT**.</span></span>

### <a name="iconditiongenerator"></a><span data-ttu-id="d48d7-193">IConditionGenerator</span><span class="sxs-lookup"><span data-stu-id="d48d7-193">IConditionGenerator</span></span>

<span data-ttu-id="d48d7-194">[**IConditionGenerator**](/windows/desktop/api/Structuredquery/nn-structuredquery-iconditiongenerator)介面是由應用程式提供，用來處理命名實體類型的辨識和條件樹狀結構產生。</span><span class="sxs-lookup"><span data-stu-id="d48d7-194">The [**IConditionGenerator**](/windows/desktop/api/Structuredquery/nn-structuredquery-iconditiongenerator) interface is provided by the application to handle recognition and condition tree generation for a named entity type.</span></span> <span data-ttu-id="d48d7-195">條件產生器會透過 [**IQueryParser：： SetMultiOption**](/windows/desktop/api/Structuredquery/nf-structuredquery-iqueryparser-setmultioption)提供給 [**IQueryParser**](/windows/desktop/api/Structuredquery/nn-structuredquery-iqueryparser) 。</span><span class="sxs-lookup"><span data-stu-id="d48d7-195">A condition generator is given to an [**IQueryParser**](/windows/desktop/api/Structuredquery/nn-structuredquery-iqueryparser) through [**IQueryParser::SetMultiOption**](/windows/desktop/api/Structuredquery/nf-structuredquery-iqueryparser-setmultioption).</span></span> <span data-ttu-id="d48d7-196">[**IQueryParser**](/windows/desktop/api/Structuredquery/nn-structuredquery-iqueryparser)會使用目前載入之架構的 [**ISchemaProvider**](/windows/desktop/api/Structuredquery/nn-structuredquery-ischemaprovider)來呼叫 [**IConditionGenerator：： Initialize**](/windows/desktop/api/Structuredquery/nf-structuredquery-iconditiongenerator-initialize) 。</span><span class="sxs-lookup"><span data-stu-id="d48d7-196">[**IQueryParser**](/windows/desktop/api/Structuredquery/nn-structuredquery-iqueryparser) calls [**IConditionGenerator::Initialize**](/windows/desktop/api/Structuredquery/nf-structuredquery-iconditiongenerator-initialize) with an [**ISchemaProvider**](/windows/desktop/api/Structuredquery/nn-structuredquery-ischemaprovider) for the currently loaded schema.</span></span> <span data-ttu-id="d48d7-197">這麼做可讓 [**IConditionGenerator**](/windows/desktop/api/Structuredquery/nn-structuredquery-iconditiongenerator) 取得所需的任何架構資訊。</span><span class="sxs-lookup"><span data-stu-id="d48d7-197">Doing so permits [**IConditionGenerator**](/windows/desktop/api/Structuredquery/nn-structuredquery-iconditiongenerator) to obtain any schema information that is required.</span></span> <span data-ttu-id="d48d7-198">剖析輸入字串時， **IQueryParser** 會呼叫每個 [**IConditionGenerator**](/windows/desktop/api/Structuredquery/nn-structuredquery-iconditiongenerator)的 [**IConditionGenerator：： RecognizeNamedEntities**](/windows/desktop/api/Structuredquery/nf-structuredquery-iconditiongenerator-recognizenamedentities)方法，如此一來，就可以報告在輸入字串中可辨識的已命名實體的出現次數。</span><span class="sxs-lookup"><span data-stu-id="d48d7-198">When parsing an input string, **IQueryParser** calls the [**IConditionGenerator::RecognizeNamedEntities**](/windows/desktop/api/Structuredquery/nf-structuredquery-iconditiongenerator-recognizenamedentities) method of each [**IConditionGenerator**](/windows/desktop/api/Structuredquery/nn-structuredquery-iconditiongenerator), so that the occurrence of named entities it recognizes in the input string can be reported.</span></span> <span data-ttu-id="d48d7-199">**IQueryParser** 可以使用目前的地區設定，而且應該使用輸入的 token 化，因為它需要報告任何命名實體的權杖範圍。</span><span class="sxs-lookup"><span data-stu-id="d48d7-199">**IQueryParser** can make use of the current locale and should make use of the tokenization of the input as it needs to report the token spans of any named entities.</span></span>

<span data-ttu-id="d48d7-200">當 [**IQueryParser**](/windows/desktop/api/Structuredquery/nn-structuredquery-iqueryparser) 即將發出分葉節點，而且值的語義型別符合 [**IConditionGenerator**](/windows/desktop/api/Structuredquery/nn-structuredquery-iconditiongenerator)的命名實體型別時， **IQueryParser** 會使用要產生之節點的資訊來呼叫 [**IConditionGenerator：： GenerateforLeaf**](/windows/desktop/api/Structuredquery/nf-structuredquery-iconditiongenerator-generateforleaf) 。</span><span class="sxs-lookup"><span data-stu-id="d48d7-200">When [**IQueryParser**](/windows/desktop/api/Structuredquery/nn-structuredquery-iqueryparser) is about to emit a leaf node, and the semantic type of the value matches the named entity type for an [**IConditionGenerator**](/windows/desktop/api/Structuredquery/nn-structuredquery-iconditiongenerator), **IQueryParser** calls [**IConditionGenerator::GenerateforLeaf**](/windows/desktop/api/Structuredquery/nf-structuredquery-iconditiongenerator-generateforleaf) with the information for the node to be generated.</span></span> <span data-ttu-id="d48d7-201">如果 [**IConditionGenerator**](/windows/desktop/api/Structuredquery/nn-structuredquery-iconditiongenerator) 傳回「 \_ 確定」，則應該傳回不需要是分葉節點的條件樹狀結構 () ，並通知 **IQueryParser** 是否要隱藏通常會產生的替代字串解釋以做為預防措施。</span><span class="sxs-lookup"><span data-stu-id="d48d7-201">If the [**IConditionGenerator**](/windows/desktop/api/Structuredquery/nn-structuredquery-iconditiongenerator) returns S\_OK, it should return a condition tree (which does not have to be a leaf node), and inform **IQueryParser** whether to suppress the alternative string interpretation that it would normally generate as a precaution.</span></span>

### <a name="itokencollection"></a><span data-ttu-id="d48d7-202">ITokenCollection</span><span class="sxs-lookup"><span data-stu-id="d48d7-202">ITokenCollection</span></span>

<span data-ttu-id="d48d7-203">[**ITokenCollection：： NumberOfTokens**](/windows/desktop/api/Structuredquery/nf-structuredquery-itokencollection-numberoftokens)方法會傳回權杖數目。[**ITokenCollection：： GetToken**](/windows/desktop/api/Structuredquery/nf-structuredquery-itokencollection-gettoken)會傳回關於我的第 *i* 個權杖的資訊。</span><span class="sxs-lookup"><span data-stu-id="d48d7-203">The [**ITokenCollection::NumberOfTokens**](/windows/desktop/api/Structuredquery/nf-structuredquery-itokencollection-numberoftokens) method returns the number of tokens.[**ITokenCollection::GetToken**](/windows/desktop/api/Structuredquery/nf-structuredquery-itokencollection-gettoken) returns information about the *i* th token.</span></span> <span data-ttu-id="d48d7-204">開頭和長度是輸入字串中的字元位置。</span><span class="sxs-lookup"><span data-stu-id="d48d7-204">The beginning and length are character positions in the input string.</span></span> <span data-ttu-id="d48d7-205">只有當有文字覆寫輸入字串中的字元時，傳回的文字才會是 null。</span><span class="sxs-lookup"><span data-stu-id="d48d7-205">The returned text will be non-null only if there is a text overriding the characters from the input string.</span></span> <span data-ttu-id="d48d7-206">例如，這是用來覆寫輸入字串中的虛線，而不是在應該將該虛線視為負的內容中。</span><span class="sxs-lookup"><span data-stu-id="d48d7-206">This is used, for example, to override a dash in the input string with NOT when that dash is in a context where it should be interpreted as a negation.</span></span>

### <a name="inamedentitycollector"></a><span data-ttu-id="d48d7-207">INamedEntityCollector</span><span class="sxs-lookup"><span data-stu-id="d48d7-207">INamedEntityCollector</span></span>

<span data-ttu-id="d48d7-208">針對每個已辨識的實體， [**IConditionGenerator**](/windows/desktop/api/Structuredquery/nn-structuredquery-iconditiongenerator)會呼叫 [**INamedEntityCollector：： Add**](/windows/desktop/api/Structuredquery/nf-structuredquery-inamedentitycollector-add) 。</span><span class="sxs-lookup"><span data-stu-id="d48d7-208">[**IConditionGenerator**](/windows/desktop/api/Structuredquery/nn-structuredquery-iconditiongenerator) calls [**INamedEntityCollector::Add**](/windows/desktop/api/Structuredquery/nf-structuredquery-inamedentitycollector-add) for each named entity it recognized.</span></span> <span data-ttu-id="d48d7-209">範圍是權杖範圍。</span><span class="sxs-lookup"><span data-stu-id="d48d7-209">The spans are token spans.</span></span> <span data-ttu-id="d48d7-210">它一定是 *beginSpan* 的情況？</span><span class="sxs-lookup"><span data-stu-id="d48d7-210">It must always be the case that *beginSpan* ?</span></span> <span data-ttu-id="d48d7-211">*beginActual*  < *endActual* 嗎？</span><span class="sxs-lookup"><span data-stu-id="d48d7-211">*beginActual* < *endActual* ?</span></span> <span data-ttu-id="d48d7-212">*endSpan*。</span><span class="sxs-lookup"><span data-stu-id="d48d7-212">*endSpan*.</span></span> <span data-ttu-id="d48d7-213">*beginSpan* 和 *endSpan* 可能會與 *beginActual* 和 *endActual* 不同，如果命名實體的開頭和/或結尾是以語義來說不重要的標記，例如引號 (，但已命名實體) 所涵蓋的標記。</span><span class="sxs-lookup"><span data-stu-id="d48d7-213">*beginSpan* and *endSpan* may differ from *beginActual* and *endActual* if the named entity begins and/or ends with semantically insignificant tokens such as quotation marks (that are nevertheless covered by the named entity).</span></span> <span data-ttu-id="d48d7-214">值必須以字串表示，之後會出現在 [**IConditionGenerator：： GenerateForLeaf**](/windows/desktop/api/Structuredquery/nf-structuredquery-iconditiongenerator-generateforleaf)的呼叫中。</span><span class="sxs-lookup"><span data-stu-id="d48d7-214">The value must be expressed as a string and will subsequently appear in a call to [**IConditionGenerator::GenerateForLeaf**](/windows/desktop/api/Structuredquery/nf-structuredquery-iconditiongenerator-generateforleaf).</span></span>

### <a name="ischemaprovider"></a><span data-ttu-id="d48d7-215">ISchemaProvider</span><span class="sxs-lookup"><span data-stu-id="d48d7-215">ISchemaProvider</span></span>

<span data-ttu-id="d48d7-216">[**ISchemaProvider**](/windows/desktop/api/Structuredquery/nn-structuredquery-ischemaprovider)介面可以用來流覽 (類型) 和關聯 (屬性) 的已載入架構。</span><span class="sxs-lookup"><span data-stu-id="d48d7-216">The [**ISchemaProvider**](/windows/desktop/api/Structuredquery/nn-structuredquery-ischemaprovider) interface can be used to browse a loaded schema for entities (types) and relations (properties).</span></span> <span data-ttu-id="d48d7-217">以下是其個別方法的用途：</span><span class="sxs-lookup"><span data-stu-id="d48d7-217">Here's what it's individual methods do:</span></span>

-   <span data-ttu-id="d48d7-218">[**實體**](/windows/desktop/api/Structuredquery/nf-structuredquery-ischemaprovider-entities) 會傳回架構中每個實體 ([**IEntity**](/windows/desktop/api/Structuredquery/nn-structuredquery-ientity)) 的列舉。</span><span class="sxs-lookup"><span data-stu-id="d48d7-218">[**Entities**](/windows/desktop/api/Structuredquery/nf-structuredquery-ischemaprovider-entities) returns an enumeration of every entity ([**IEntity**](/windows/desktop/api/Structuredquery/nn-structuredquery-ientity)) in the schema.</span></span>
-   <span data-ttu-id="d48d7-219">[**RootEntity**](/windows/desktop/api/Structuredquery/nf-structuredquery-ischemaprovider-rootentity) 會傳回架構的根實體。</span><span class="sxs-lookup"><span data-stu-id="d48d7-219">[**RootEntity**](/windows/desktop/api/Structuredquery/nf-structuredquery-ischemaprovider-rootentity) returns the root entity of the schema.</span></span> <span data-ttu-id="d48d7-220">針對一般架構，會傳回每個 [**IQuerySolution**](/windows/desktop/api/Structuredquery/nn-structuredquery-iquerysolution) 的主要類型。</span><span class="sxs-lookup"><span data-stu-id="d48d7-220">For a flat schema, the main type of every [**IQuerySolution**](/windows/desktop/api/Structuredquery/nn-structuredquery-iquerysolution) is returned.</span></span>
-   <span data-ttu-id="d48d7-221">[**GetEntity**](/windows/desktop/api/Structuredquery/nf-structuredquery-ischemaprovider-getentity) 會依名稱尋找實體， \_ 如果架構中沒有這類實體，就會傳回 FALSE。</span><span class="sxs-lookup"><span data-stu-id="d48d7-221">[**GetEntity**](/windows/desktop/api/Structuredquery/nf-structuredquery-ischemaprovider-getentity) finds an entity by name and returns S\_FALSE if there is no such entity in the schema.</span></span>
-   <span data-ttu-id="d48d7-222">[**中繼資料**](/windows/desktop/api/Structuredquery/nf-structuredquery-ischemaprovider-metadata) 會傳回 [**IMetaData**](/windows/desktop/api/Structuredquery/nn-structuredquery-imetadata) 介面的列舉。</span><span class="sxs-lookup"><span data-stu-id="d48d7-222">[**MetaData**](/windows/desktop/api/Structuredquery/nf-structuredquery-ischemaprovider-metadata) returns an enumeration of [**IMetaData**](/windows/desktop/api/Structuredquery/nn-structuredquery-imetadata) interfaces.</span></span>

### <a name="ientity"></a><span data-ttu-id="d48d7-223">IEntity</span><span class="sxs-lookup"><span data-stu-id="d48d7-223">IEntity</span></span>

<span data-ttu-id="d48d7-224">[**IEntity**](/windows/desktop/api/Structuredquery/nn-structuredquery-ientity)介面是一個架構實體，代表具有名稱的類型、有一些與其他類型的已命名關聯性 (屬性) ，並且衍生自基底實體。</span><span class="sxs-lookup"><span data-stu-id="d48d7-224">The [**IEntity**](/windows/desktop/api/Structuredquery/nn-structuredquery-ientity) interface is a schema entity that represents a type that has a name, has a number of named relationships to other types (properties), and derives from a base entity.</span></span> <span data-ttu-id="d48d7-225">以下是其個別方法的用途：</span><span class="sxs-lookup"><span data-stu-id="d48d7-225">Here's what its individual methods do:</span></span>

-   <span data-ttu-id="d48d7-226">[**IEntity：：關聯**](/windows/desktop/api/Structuredquery/nf-structuredquery-ientity-relationships) 性會傳回 [**IRelationship**](/windows/desktop/api/Structuredquery/nn-structuredquery-irelationship) 物件的列舉，此類型的每個外寄關聯都有一個列舉。</span><span class="sxs-lookup"><span data-stu-id="d48d7-226">[**IEntity::Relationships**](/windows/desktop/api/Structuredquery/nf-structuredquery-ientity-relationships) returns an enumeration of [**IRelationship**](/windows/desktop/api/Structuredquery/nn-structuredquery-irelationship) objects, one for each outgoing relation of this type.</span></span> <span data-ttu-id="d48d7-227">實體的每個外寄關聯都有一個名稱。</span><span class="sxs-lookup"><span data-stu-id="d48d7-227">Each outgoing relation of an entity has a name.</span></span>
-   <span data-ttu-id="d48d7-228">[**IEntity：： GetRelationship**](/windows/desktop/api/Structuredquery/nf-structuredquery-ientity-getrelationship) 會依名稱尋找關聯性， \_ 如果這個實體沒有這類關聯性，就會傳回 FALSE。</span><span class="sxs-lookup"><span data-stu-id="d48d7-228">[**IEntity::GetRelationship**](/windows/desktop/api/Structuredquery/nf-structuredquery-ientity-getrelationship) finds a relationship by name, and returns S\_FALSE if there is no such relationship for this entity.</span></span>
-   <span data-ttu-id="d48d7-229">[**IEntity：： MetaData**](/windows/desktop/api/Structuredquery/nf-structuredquery-ientity-metadata) 會傳回 [**IMetaData**](/windows/desktop/api/Structuredquery/nn-structuredquery-imetadata) 介面的列舉，此實體的每個中繼資料配對都有一個列舉。</span><span class="sxs-lookup"><span data-stu-id="d48d7-229">[**IEntity::MetaData**](/windows/desktop/api/Structuredquery/nf-structuredquery-ientity-metadata) returns an enumeration of [**IMetaData**](/windows/desktop/api/Structuredquery/nn-structuredquery-imetadata) interfaces, one for each metadata pair of this entity.</span></span>
-   <span data-ttu-id="d48d7-230">[**IEntity：:D efaultphrase**](/windows/desktop/api/Structuredquery/nf-structuredquery-ientity-defaultphrase) 會傳回預設片語，以協助產生條件樹狀結構的 AQS 或 NQS 重述。</span><span class="sxs-lookup"><span data-stu-id="d48d7-230">[**IEntity::DefaultPhrase**](/windows/desktop/api/Structuredquery/nf-structuredquery-ientity-defaultphrase) returns a default phrase to facilitate generating an AQS or NQS restatement of a condition tree.</span></span>

### <a name="irelationship"></a><span data-ttu-id="d48d7-231">IRelationship</span><span class="sxs-lookup"><span data-stu-id="d48d7-231">IRelationship</span></span>

<span data-ttu-id="d48d7-232">[**IRelationship**](/windows/desktop/api/Structuredquery/nn-structuredquery-irelationship)介面代表兩個實體之間的關聯性：來源和目的地。</span><span class="sxs-lookup"><span data-stu-id="d48d7-232">The [**IRelationship**](/windows/desktop/api/Structuredquery/nn-structuredquery-irelationship) interface represents a relationship between two entities: a source and a destination.</span></span> <span data-ttu-id="d48d7-233">以下是其個別方法的用途：</span><span class="sxs-lookup"><span data-stu-id="d48d7-233">Here's what it's individual methods do:</span></span>

-   <span data-ttu-id="d48d7-234">[**IRelationship：： IsReal**](/windows/desktop/api/Structuredquery/nf-structuredquery-irelationship-isreal) 報告關聯性是否為真實的。</span><span class="sxs-lookup"><span data-stu-id="d48d7-234">[**IRelationship::IsReal**](/windows/desktop/api/Structuredquery/nf-structuredquery-irelationship-isreal) reports whether a relationship is real.</span></span> <span data-ttu-id="d48d7-235">例如，如果實體 A 衍生自實體 B，並繼承名稱為 R 的關聯性，則可能仍有它自己的關聯性名稱 R。不過，關聯性 beween A 和 R 必須具有與 B 相同的目的地類型，而且它要存在的唯一原因是儲存 B 專屬的中繼資料。B 的關聯性雖不是真正的關聯性。</span><span class="sxs-lookup"><span data-stu-id="d48d7-235">For example, if entity A derives from entity B and inherits a relationship named R from it, A may still have its own relationship named R. However, the relationship beween A and R must have the same destination type as that of B, and the only reason for it to exist is to store metadata specific to B. Such a relationship of B is said not to be real.</span></span>
-   <span data-ttu-id="d48d7-236">[**IRelationship：： Medadata**](/windows/desktop/api/Structuredquery/nf-structuredquery-irelationship-metadata) 會傳回 [**IMetaData**](/windows/desktop/api/Structuredquery/nn-structuredquery-imetadata) 介面的列舉，此實體的每個中繼資料配對都有一個列舉。</span><span class="sxs-lookup"><span data-stu-id="d48d7-236">[**IRelationship::Medadata**](/windows/desktop/api/Structuredquery/nf-structuredquery-irelationship-metadata) returns an enumeration of [**IMetaData**](/windows/desktop/api/Structuredquery/nn-structuredquery-imetadata) interfaces, one for each metadata pair of this entity.</span></span>
-   <span data-ttu-id="d48d7-237">[**IRelationship：:D efaultphrase**](/windows/desktop/api/Structuredquery/nf-structuredquery-irelationship-defaultphrase) 會傳回在重述中用於此關聯性的預設片語。</span><span class="sxs-lookup"><span data-stu-id="d48d7-237">[**IRelationship::DefaultPhrase**](/windows/desktop/api/Structuredquery/nf-structuredquery-irelationship-defaultphrase) returns the default phrase to use for this relationship in restatements.</span></span> <span data-ttu-id="d48d7-238">每個關聯性都有一個預設片語，表示它有助於產生條件樹狀結構的 AQS 或 NQS 重述。</span><span class="sxs-lookup"><span data-stu-id="d48d7-238">Each relationship has a default phrase that denotes it to facilitate generating an AQS or NQS restatement of a condition tree.</span></span>

### <a name="imetadata"></a><span data-ttu-id="d48d7-239">IMetaData</span><span class="sxs-lookup"><span data-stu-id="d48d7-239">IMetaData</span></span>

<span data-ttu-id="d48d7-240">中繼資料是成對的索引鍵/值組，每個都與實體、關聯性或整個架構相關聯。</span><span class="sxs-lookup"><span data-stu-id="d48d7-240">Metadata are key-value pairs that are each associated with either an entity, a relationship, or the whole schema.</span></span> <span data-ttu-id="d48d7-241">因為索引鍵不一定是唯一的，所以可將中繼資料的集合視為多對應。</span><span class="sxs-lookup"><span data-stu-id="d48d7-241">Because keys are not necessarily unique, a collection of metadata can be thought of as a multi-map.</span></span> <span data-ttu-id="d48d7-242">呼叫 [**IMetaData：：**](/windows/desktop/api/Structuredquery/nf-structuredquery-imetadata-getdata)中繼資料，以取出組的索引鍵和值。</span><span class="sxs-lookup"><span data-stu-id="d48d7-242">[**IMetaData::GetData**](/windows/desktop/api/Structuredquery/nf-structuredquery-imetadata-getdata) is called to retrieve the key and value for a metatdata pair.</span></span>

## <a name="querying-scenarios"></a><span data-ttu-id="d48d7-243">查詢案例</span><span class="sxs-lookup"><span data-stu-id="d48d7-243">Querying Scenarios</span></span>

<span data-ttu-id="d48d7-244">下列案例說明一般查詢案例中 Windows Search 的結構化查詢 Api 用法，例如建立條件樹狀結構和查詢索引。</span><span class="sxs-lookup"><span data-stu-id="d48d7-244">The following scenarios describe the use of structured query APIs in Windows Search in common querying scenarios, such as creating a condition tree and querying the index.</span></span>

### <a name="condition-extraction-and-query-parsing"></a><span data-ttu-id="d48d7-245">條件提取和查詢剖析</span><span class="sxs-lookup"><span data-stu-id="d48d7-245">Condition Extraction and Query Parsing</span></span>

<span data-ttu-id="d48d7-246">建立查詢時，會藉由告訴系統要搜尋的位置來定義其範圍。</span><span class="sxs-lookup"><span data-stu-id="d48d7-246">When a query is created, its scope is defined by telling the system where to search.</span></span> <span data-ttu-id="d48d7-247">這會限制搜尋結果。</span><span class="sxs-lookup"><span data-stu-id="d48d7-247">This restricts the search results.</span></span> <span data-ttu-id="d48d7-248">定義範圍之後，會套用篩選，並傳回篩選器集合。</span><span class="sxs-lookup"><span data-stu-id="d48d7-248">After the scope is defined, a filter is applied, and a filter set is returned.</span></span> <span data-ttu-id="d48d7-249">藉由建立具有分葉節點的條件樹狀結構（類似于圖表）來限制搜尋結果。</span><span class="sxs-lookup"><span data-stu-id="d48d7-249">Search results are restricted by building a condition tree with leaf nodes, similar to a graph.</span></span> <span data-ttu-id="d48d7-250">然後會將這些條件解壓縮。</span><span class="sxs-lookup"><span data-stu-id="d48d7-250">Those conditions are then extracted.</span></span> <span data-ttu-id="d48d7-251">條件樹狀結構是一個布林值組合 (AND、OR、NOT) 的分葉條件，每個條件都會將某個屬性（property）與值產生關聯。</span><span class="sxs-lookup"><span data-stu-id="d48d7-251">A condition tree is a Boolean combination (AND, OR, NOT) of leaf conditions, each of which relates a property, through an operation, to a value.</span></span> <span data-ttu-id="d48d7-252">分葉節點代表透過某些作業對單一屬性進行值的限制。</span><span class="sxs-lookup"><span data-stu-id="d48d7-252">A leaf node represents a restriction on a single property to a value through some operations.</span></span>

<span data-ttu-id="d48d7-253">篩選準則限制需要描述限制的邏輯運算式。</span><span class="sxs-lookup"><span data-stu-id="d48d7-253">A filter restriction requires a logical expression that describes the restriction.</span></span> <span data-ttu-id="d48d7-254">定義此運算式的開頭是 [**ICondition**](/windows/desktop/api/Structuredquerycondition/nn-structuredquerycondition-icondition) 介面，此介面是用來在條件樹狀結構中建立單一節點。</span><span class="sxs-lookup"><span data-stu-id="d48d7-254">Defining this expression starts with the [**ICondition**](/windows/desktop/api/Structuredquerycondition/nn-structuredquerycondition-icondition) interface, which is used to create a single node in a condition tree.</span></span> <span data-ttu-id="d48d7-255">因為在下列範例中只有一個條件，所以樹狀結構不會變更。</span><span class="sxs-lookup"><span data-stu-id="d48d7-255">Because there is only one condition in the following example, the tree does not change.</span></span>


```C++
    
    [
        object,
        uuid(0FC988D4-C935-4b97-A973-46282EA175C8),
        pointer_default(unique)
    ]
    interface ICondition : IPersistStream
    {
        HRESULT GetConditionType([out, retval] CONDITION_TYPE* pNodeType);
        HRESULT GetSubConditions([in] REFIID riid, [out, retval, iid_is(riid)] void** ppv);
        [local] HRESULT GetComparisonInfo([out, annotation("__deref_opt_out")] LPWSTR *ppszPropertyName, [out, annotation("__out_opt")] CONDITION_OPERATION *pOperation, [out, annotation("__out_opt")] PROPVARIANT *pValue);
        HRESULT GetValueType([out, retval] LPWSTR* ppszValueTypeName);
        HRESULT GetValueNormalization([out, retval] LPWSTR* ppszNormalization);
        [local] HRESULT GetInputTerms([out, annotation("__out_opt")] IRichChunk** ppPropertyTerm, [out, annotation("__out_opt")] IRichChunk** ppOperationTerm, [out, annotation("__out_opt")] IRichChunk** ppValueTerm);
        HRESULT Clone([out, retval] ICondition** ppc);
    };


```



<span data-ttu-id="d48d7-256">如果有一個以上的篩選準則，則和和其他布林運算子會用來達成單一樹狀結構。</span><span class="sxs-lookup"><span data-stu-id="d48d7-256">If there is more than one filter condition, then AND and other Boolean operators are used to achieve a single tree.</span></span> <span data-ttu-id="d48d7-257">和-樹狀結構或樹狀結構代表其子樹的結合和 disjunctions。</span><span class="sxs-lookup"><span data-stu-id="d48d7-257">AND-trees and OR-trees represent conjunctions and disjunctions of their subtrees.</span></span> <span data-ttu-id="d48d7-258">非樹狀結構代表其單一子樹的否定。</span><span class="sxs-lookup"><span data-stu-id="d48d7-258">A NOT-tree represents the negation of its single subtree.</span></span> <span data-ttu-id="d48d7-259">AQS 提供使用布林運算子來達成邏輯運算式的文字方法，通常較為簡單。</span><span class="sxs-lookup"><span data-stu-id="d48d7-259">AQS provides a text approach to achieving logical expressions with Boolean operators, and is often simpler.</span></span>

<span data-ttu-id="d48d7-260">在下一個範例中，我們會將條件樹狀結構 ([**ICondition**](/windows/desktop/api/Structuredquerycondition/nn-structuredquerycondition-icondition)) 轉換成視覺化形式。</span><span class="sxs-lookup"><span data-stu-id="d48d7-260">In the next example we convert the condition tree ([**ICondition**](/windows/desktop/api/Structuredquerycondition/nn-structuredquerycondition-icondition)) into visual form.</span></span> <span data-ttu-id="d48d7-261">使用 [**IQueryParser**](/windows/desktop/api/Structuredquery/nn-structuredquery-iqueryparser) 介面的查詢剖析器會將 [**ICondition**](/windows/desktop/api/Structuredquerycondition/nn-structuredquerycondition-icondition) 轉換成格式化 (rtf) 查詢字串格式的 rtf 格式文字。</span><span class="sxs-lookup"><span data-stu-id="d48d7-261">The query parser, using the [**IQueryParser**](/windows/desktop/api/Structuredquery/nn-structuredquery-iqueryparser) interface, converts the [**ICondition**](/windows/desktop/api/Structuredquerycondition/nn-structuredquerycondition-icondition) into a rich text formatted (RTF) query string.</span></span> <span data-ttu-id="d48d7-262">[**IQueryParser：： RestateToString**](/windows/desktop/api/Structuredquery/nf-structuredquery-iqueryparser-restatetostring)方法會傳回查詢文字，而 [**IQueryParser：:P arse**](/windows/desktop/api/Structuredquery/nf-structuredquery-iqueryparser-parse)方法會產生 [**IQuerySolution**](/windows/desktop/api/Structuredquery/nn-structuredquery-iquerysolution)介面。</span><span class="sxs-lookup"><span data-stu-id="d48d7-262">The [**IQueryParser::RestateToString**](/windows/desktop/api/Structuredquery/nf-structuredquery-iqueryparser-restatetostring) method returns the query text, while the [**IQueryParser::Parse**](/windows/desktop/api/Structuredquery/nf-structuredquery-iqueryparser-parse) method produces an [**IQuerySolution**](/windows/desktop/api/Structuredquery/nn-structuredquery-iquerysolution) interface.</span></span> <span data-ttu-id="d48d7-263">下列範例示範如何執行所有動作。</span><span class="sxs-lookup"><span data-stu-id="d48d7-263">The following example shows how to do all that.</span></span>


```C++
    [
        object,
        uuid(2EBDEE67-3505-43f8-9946-EA44ABC8E5B0),
        pointer_default(unique)
    ]
    interface IQueryParser : IUnknown
    {
        HRESULT Parse([in] LPCWSTR pszInputString, [in] IEnumUnknown* pCustomProperties, [out, retval] IQuerySolution** ppSolution);
        HRESULT SetOption([in] STRUCTURED_QUERY_SINGLE_OPTION option, [in] PROPVARIANT const* pOptionValue);
        HRESULT GetOption([in] STRUCTURED_QUERY_SINGLE_OPTION option, [out, retval] PROPVARIANT* pOptionValue);
        HRESULT SetMultiOption([in] STRUCTURED_QUERY_MULTIOPTION option, [in] LPCWSTR pszOptionKey, [in] PROPVARIANT const* pOptionValue);
        HRESULT GetSchemaProvider([out, retval] ISchemaProvider** ppSchemaProvider);
        HRESULT RestateToString([in] ICondition* pCondition, [in] BOOL fUseEnglish, [out] LPWSTR* ppszQueryString);
        HRESULT ParsePropertyValue([in] LPCWSTR pszPropertyName, [in] LPCWSTR pszInputString, [out, retval] IQuerySolution** ppSolution);
        HRESULT RestatePropertyValueToString([in] ICondition* pCondition, [in] BOOL fUseEnglish, [out] LPWSTR* ppszPropertyName, [out] LPWSTR* ppszQueryString);
    };

```



<span data-ttu-id="d48d7-264">[**IQueryParser：:P arse**](/windows/desktop/api/Structuredquery/nf-structuredquery-iqueryparser-parse)的主要輸入是要剖析的使用者輸入字串，但應用程式也可以通知查詢剖析器，其在輸入 (從應用程式特定的語法) 中辨識的任何屬性。</span><span class="sxs-lookup"><span data-stu-id="d48d7-264">The main input of [**IQueryParser::Parse**](/windows/desktop/api/Structuredquery/nf-structuredquery-iqueryparser-parse) is a user input string to be parsed, but the application can also inform the query parser of any properties it has recognized in the input (from application-specific syntax).</span></span> <span data-ttu-id="d48d7-265">**IQueryParser：:P arse** 的輸出是一種 [**IQuerySolution**](/windows/desktop/api/Structuredquery/nn-structuredquery-iquerysolution)，可提供與該剖析調用相關的所有資訊。</span><span class="sxs-lookup"><span data-stu-id="d48d7-265">The output of **IQueryParser::Parse** is an [**IQuerySolution**](/windows/desktop/api/Structuredquery/nn-structuredquery-iquerysolution), which provides all information pertaining to that parse invocation.</span></span> <span data-ttu-id="d48d7-266">有一些方法可取得輸入字串、輸入字串的 token 化方式、任何剖析錯誤，以及剖析的查詢 as 條件樹狀結構（以 [**ICondition**](/windows/desktop/api/Structuredquerycondition/nn-structuredquerycondition-icondition)表示）。</span><span class="sxs-lookup"><span data-stu-id="d48d7-266">There are methods for obtaining the input string, how the input string was tokenized, any parse errors, and the parsed query as condition tree, represented by an [**ICondition**](/windows/desktop/api/Structuredquerycondition/nn-structuredquerycondition-icondition).</span></span> <span data-ttu-id="d48d7-267">下列範例顯示 .。。</span><span class="sxs-lookup"><span data-stu-id="d48d7-267">The following example shows ...</span></span>


```C++
    [
        object,
        uuid(D6EBC66B-8921-4193-AFDD-A1789FB7FF57),
        pointer_default(unique)
    ]
    interface IQuerySolution : IConditionFactory
    {
        [local] HRESULT GetQuery([out, annotation("__out_opt")] ICondition** ppQueryNode, [out, annotation("__out_opt")] IEntity** ppMainType);
        HRESULT GetErrors([in] REFIID riid, [out, retval, iid_is(riid)] void** ppParseErrors);
        [local] HRESULT GetLexicalData([out, annotation("__deref_opt_out")] LPWSTR* ppszInputString, [out, annotation("__out_opt")] ITokenCollection** ppTokens, [out, annotation("__out_opt")] LCID* pLocale, [out, annotation("__out_opt")] IUnknown** ppWordBreaker);
    }    

    

```



<span data-ttu-id="d48d7-268">在上述範例中， [**IQuerySolution：： GetQuery**](/windows/desktop/api/Structuredquery/nf-structuredquery-iquerysolution-getquery) 可以取得查詢的相關資訊，包括原始文字、組成文字的權杖或條件樹狀結構。</span><span class="sxs-lookup"><span data-stu-id="d48d7-268">In the previous example, [**IQuerySolution::GetQuery**](/windows/desktop/api/Structuredquery/nf-structuredquery-iquerysolution-getquery) could obtain any information about the query including the original text, tokens that comprise the text, or the condition tree.</span></span> <span data-ttu-id="d48d7-269">下表列出可能傳回查詢值的範例。</span><span class="sxs-lookup"><span data-stu-id="d48d7-269">Examples of possible returned query values are listed in the following table.</span></span>



| <span data-ttu-id="d48d7-270">傳回查詢值的範例</span><span class="sxs-lookup"><span data-stu-id="d48d7-270">Examples of returned query values</span></span>                        | <span data-ttu-id="d48d7-271">Description</span><span class="sxs-lookup"><span data-stu-id="d48d7-271">Description</span></span>                                                                                               |
|----------------------------------------------------------|-----------------------------------------------------------------------------------------------------------|
| `  author:relja OR author:tyler`                         | <span data-ttu-id="d48d7-272">[**IQueryParser：： RestateToString**](/windows/desktop/api/Structuredquery/nf-structuredquery-iqueryparser-restatetostring)傳回的查詢文字</span><span class="sxs-lookup"><span data-stu-id="d48d7-272">The query text that [**IQueryParser::RestateToString**](/windows/desktop/api/Structuredquery/nf-structuredquery-iqueryparser-restatetostring) returns</span></span> |
| `?author?, ?:?, ?relja?, ?OR?, ?author?, ?:?, ?tyler?`   | <span data-ttu-id="d48d7-273">標記的細分</span><span class="sxs-lookup"><span data-stu-id="d48d7-273">The break-down of tokens</span></span>                                                                                  |
| ![未解決的條件樹狀結構](images/queryvalues1.png) | <span data-ttu-id="d48d7-275">未解決的條件樹狀結構</span><span class="sxs-lookup"><span data-stu-id="d48d7-275">An unresolved condition tree</span></span>                                                                              |



 

<span data-ttu-id="d48d7-276">傳回的初始條件樹狀結構無法解析。</span><span class="sxs-lookup"><span data-stu-id="d48d7-276">The initial condition tree that is returned is unresolved.</span></span> <span data-ttu-id="d48d7-277">在無法解析的條件樹狀結構中，日期和時間的參考（例如 `date:yesterday` ）不會轉換為絕對時間。</span><span class="sxs-lookup"><span data-stu-id="d48d7-277">In an unresolved condition tree, date and time references, such as `date:yesterday`, are not converted to absolute time.</span></span> <span data-ttu-id="d48d7-278">此外，虛擬屬性不會展開。</span><span class="sxs-lookup"><span data-stu-id="d48d7-278">Also, virtual properties are not expanded.</span></span> <span data-ttu-id="d48d7-279">虛擬屬性是作為多個屬性匯總的屬性。</span><span class="sxs-lookup"><span data-stu-id="d48d7-279">Virtual properties are properties that act as aggregates of multiple properties.</span></span>

<span data-ttu-id="d48d7-280">例如，查詢會 `kind:email from:reljai` 產生下列未解決和已解決的條件樹狀結構。</span><span class="sxs-lookup"><span data-stu-id="d48d7-280">For example, the query `kind:email from:reljai` produces the following unresolved and resolved condition trees.</span></span> <span data-ttu-id="d48d7-281">無法解析的條件樹狀結構是在左邊，而已解決的條件樹狀結構是右邊。</span><span class="sxs-lookup"><span data-stu-id="d48d7-281">The unresolved condition tree is to the left, and the resolved condition tree is to the right.</span></span>

![未解決和已解決的條件樹狀結構](images/conditiontree.png)

<span data-ttu-id="d48d7-283">您可以藉由呼叫 [**IConditionFactory：： Resolve**](/windows/desktop/api/Structuredquery/nf-structuredquery-iconditionfactory-resolve)來取得已解析的樹狀結構。</span><span class="sxs-lookup"><span data-stu-id="d48d7-283">The resolved tree can be obtained by calling [**IConditionFactory::Resolve**](/windows/desktop/api/Structuredquery/nf-structuredquery-iconditionfactory-resolve).</span></span> <span data-ttu-id="d48d7-284">不過，傳遞 [**SQRO 不會 \_ \_ 解決 \_ DATETIME**](/windows/desktop/api/Structuredquery/ne-structuredquery-structured_query_resolve_option) ，無法解析日期和時間。</span><span class="sxs-lookup"><span data-stu-id="d48d7-284">However, passing [**SQRO\_DONT\_RESOLVE\_DATETIME**](/windows/desktop/api/Structuredquery/ne-structuredquery-structured_query_resolve_option) leaves the date and time unresolved.</span></span> <span data-ttu-id="d48d7-285">無法解析的條件樹狀結構有一些優點，因為未解決的條件樹狀結構包含查詢的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="d48d7-285">There are advantages to an unresolved condition tree, because an unresolved condition tree contains information about the query.</span></span> <span data-ttu-id="d48d7-286">每個分葉節點都會指向 [**IQuerySolution：： GetLexicalData**](/windows/desktop/api/Structuredquery/nf-structuredquery-iquerysolution-getlexicaldata)所傳回的標記，這會在使用 [**IRichChunk**](/windows/desktop/api/Structuredquerycondition/nn-structuredquerycondition-irichchunk) 介面時對應至屬性、運算子和值。</span><span class="sxs-lookup"><span data-stu-id="d48d7-286">Each leaf node points to the tokens returned by [**IQuerySolution::GetLexicalData**](/windows/desktop/api/Structuredquery/nf-structuredquery-iquerysolution-getlexicaldata), which correspond to the property, operator, and value when using the [**IRichChunk**](/windows/desktop/api/Structuredquerycondition/nn-structuredquerycondition-irichchunk) interface.</span></span> <span data-ttu-id="d48d7-287">下列範例顯示 .。。</span><span class="sxs-lookup"><span data-stu-id="d48d7-287">The following example shows ...</span></span>


```C++
    interface ITokenCollection : IUnknown
    {
        HRESULT NumberOfTokens(ULONG* pCount);
        HRESULT GetToken([in] ULONG i, [out, annotation("__out_opt")] ULONG* pBegin, [out, annotation("__out_opt")] ULONG* pLength, [out, annotation("__deref_opt_out")] LPWSTR* ppsz);
    };

ICondition:: GetInputTerms([out, annotation("__out_opt")] 
IRichChunk** ppPropertyTerm, [out, annotation("__out_opt")] 
IRichChunk** ppOperationTerm, [out, annotation("__out_opt")] 
IRichChunk** ppValueTerm);

    interface IRichChunk : IUnknown
    {
        HRESULT GetData([out, annotation("__out_opt")] ULONG* pFirstPos, [out, annotation("__out_opt")] ULONG* pLength, [out, annotation("__deref_opt_out")] LPWSTR* ppsz, [out, annotation("__out_opt")] PROPVARIANT* pValue);
    }
```



### <a name="querying-the-index"></a><span data-ttu-id="d48d7-288">查詢索引</span><span class="sxs-lookup"><span data-stu-id="d48d7-288">Querying the Index</span></span>

<span data-ttu-id="d48d7-289">有幾種方法可以查詢索引。</span><span class="sxs-lookup"><span data-stu-id="d48d7-289">There are several approaches to querying the index.</span></span> <span data-ttu-id="d48d7-290">有些是以 SQL 為基礎，其他則是以 AQS 為基礎。</span><span class="sxs-lookup"><span data-stu-id="d48d7-290">Some are based on the SQL and others are based on AQS.</span></span> <span data-ttu-id="d48d7-291">您也可以使用查詢 [介面](./-search-querying-interfaces-entry-page.md)，以程式設計方式查詢 Windows Search 索引。</span><span class="sxs-lookup"><span data-stu-id="d48d7-291">You can also query the Windows Search index programmatically by using [querying interfaces](./-search-querying-interfaces-entry-page.md).</span></span> <span data-ttu-id="d48d7-292">查詢索引有三個特定的介面： [**ISearchQueryHelper**](/windows/desktop/api/Searchapi/nn-searchapi-isearchqueryhelper)、 [**IRowsetPrioritization**](/windows/desktop/api/Searchapi/nn-searchapi-irowsetprioritization)和 [**IRowsetEvents**](/windows/desktop/api/Searchapi/nn-searchapi-irowsetevents)。</span><span class="sxs-lookup"><span data-stu-id="d48d7-292">There are three interfaces that are specific to querying the index: [**ISearchQueryHelper**](/windows/desktop/api/Searchapi/nn-searchapi-isearchqueryhelper), [**IRowsetPrioritization**](/windows/desktop/api/Searchapi/nn-searchapi-irowsetprioritization), and [**IRowsetEvents**](/windows/desktop/api/Searchapi/nn-searchapi-irowsetevents).</span></span> <span data-ttu-id="d48d7-293">如需概念性資訊，請參閱以程式設計 [方式查詢索引](-search-3x-wds-qryidx-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="d48d7-293">For conceptual information, see [Querying the Index Programmatically](-search-3x-wds-qryidx-overview.md).</span></span>

<span data-ttu-id="d48d7-294">您可以使用 [**ISearchQueryHelper**](/windows/desktop/api/Searchapi/nn-searchapi-isearchqueryhelper) 介面來開發元件或 helper 類別，以查詢索引。</span><span class="sxs-lookup"><span data-stu-id="d48d7-294">You can develop a component or helper class to query the index by using the [**ISearchQueryHelper**](/windows/desktop/api/Searchapi/nn-searchapi-isearchqueryhelper) interface.</span></span> <span data-ttu-id="d48d7-295">這個介面會實作為 helper 類別，以 [**ISearchCatalogManager**](/windows/desktop/api/Searchapi/nn-searchapi-isearchcatalogmanager) (和 [**ISearchCatalogManager2**](/windows/desktop/api/Searchapi/nn-searchapi-isearchcatalogmanager2)) ，而且是藉由呼叫 [**ISearchCatalogManager：： GetQueryHelper**](/windows/desktop/api/Searchapi/nf-searchapi-isearchcatalogmanager-getqueryhelper)取得。</span><span class="sxs-lookup"><span data-stu-id="d48d7-295">This interface is implemented as a helper class to [**ISearchCatalogManager**](/windows/desktop/api/Searchapi/nn-searchapi-isearchcatalogmanager) (and [**ISearchCatalogManager2**](/windows/desktop/api/Searchapi/nn-searchapi-isearchcatalogmanager2)), and is obtained by calling [**ISearchCatalogManager::GetQueryHelper**](/windows/desktop/api/Searchapi/nf-searchapi-isearchcatalogmanager-getqueryhelper).</span></span> <span data-ttu-id="d48d7-296">如需概念性資訊，請參閱 [使用 ISearchQueryHelper 查詢索引](-search-3x-wds-qryidx-searchqueryhelper.md)。</span><span class="sxs-lookup"><span data-stu-id="d48d7-296">For conceptual information, see [Querying the Index with ISearchQueryHelper](-search-3x-wds-qryidx-searchqueryhelper.md).</span></span>

<span data-ttu-id="d48d7-297">[**ISearchQueryHelper**](/windows/desktop/api/Searchapi/nn-searchapi-isearchqueryhelper) 可讓您：</span><span class="sxs-lookup"><span data-stu-id="d48d7-297">[**ISearchQueryHelper**](/windows/desktop/api/Searchapi/nn-searchapi-isearchqueryhelper) permits you to:</span></span>

-   <span data-ttu-id="d48d7-298">取得連接到 Windows Search 資料庫 OLE DB 連接字串。</span><span class="sxs-lookup"><span data-stu-id="d48d7-298">Obtain an OLE DB connection string to connect to the Windows Search database.</span></span>
-   <span data-ttu-id="d48d7-299">將 AQS 使用者查詢轉換成 Windows Search SQL。</span><span class="sxs-lookup"><span data-stu-id="d48d7-299">Convert AQS user queries to Windows Search SQL.</span></span>
-   <span data-ttu-id="d48d7-300">指定可在 SQL 中表示但無法在 AQS 中表示的查詢限制。</span><span class="sxs-lookup"><span data-stu-id="d48d7-300">Specify query restrictions that can be expressed in SQL but not in AQS.</span></span>

<span data-ttu-id="d48d7-301">Windows 7 和更新版本支援索引優先順序和資料列集事件。</span><span class="sxs-lookup"><span data-stu-id="d48d7-301">Indexing prioritization and rowset events are supported in Windows 7 and later.</span></span> <span data-ttu-id="d48d7-302">With [**IRowsetPrioritization**](/windows/desktop/api/Searchapi/nn-searchapi-irowsetprioritization) 有一個優先順序堆疊，可讓用戶端要求特定查詢中所使用的範圍高於一般優先順序。</span><span class="sxs-lookup"><span data-stu-id="d48d7-302">With [**IRowsetPrioritization**](/windows/desktop/api/Searchapi/nn-searchapi-irowsetprioritization) there is a priority stack that enables the client to request that the scopes used in a particular query be given higher than normal priority.</span></span> <span data-ttu-id="d48d7-303">[**IRowsetEvents**](/windows/desktop/api/Searchapi/nn-searchapi-irowsetevents) 會提供資料列集內專案變更的通知，包括新增專案、刪除專案，以及修改專案資料。</span><span class="sxs-lookup"><span data-stu-id="d48d7-303">[**IRowsetEvents**](/windows/desktop/api/Searchapi/nn-searchapi-irowsetevents) provides notification of changes to items in rowsets, including the addition of new items, the deletion of items, and the modification of item data.</span></span> <span data-ttu-id="d48d7-304">使用資料列集事件通知可確保常設查詢的結果盡可能保持最新狀態。</span><span class="sxs-lookup"><span data-stu-id="d48d7-304">Using rowset event notifications ensures that the results for existing queries are as up to date as possible.</span></span> <span data-ttu-id="d48d7-305">如需概念性資訊，請參閱 [在 Windows 7 中編制優先順序和資料列集事件的索引](indexing-prioritization-and-rowset-events.md)。</span><span class="sxs-lookup"><span data-stu-id="d48d7-305">For conceptual information, see [Indexing Prioritization and Rowset Events in Windows 7](indexing-prioritization-and-rowset-events.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="d48d7-306">相關主題</span><span class="sxs-lookup"><span data-stu-id="d48d7-306">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="d48d7-307">Windows Search 中的編制索引、查詢和通知</span><span class="sxs-lookup"><span data-stu-id="d48d7-307">Indexing, Querying and Notifications in Windows Search</span></span>](-search-3x-wds-included-in-index.md)
</dt> <dt>

[<span data-ttu-id="d48d7-308">索引中包含的內容</span><span class="sxs-lookup"><span data-stu-id="d48d7-308">What is Included in the Index</span></span>](-search-indexing-process-overview.md)
</dt> <dt>

[<span data-ttu-id="d48d7-309">Windows Search 中的編制索引進程</span><span class="sxs-lookup"><span data-stu-id="d48d7-309">Indexing Process in Windows Search</span></span>](-search-indexing-process-overview.md)
</dt> <dt>

[<span data-ttu-id="d48d7-310">Windows Search 中的通知處理</span><span class="sxs-lookup"><span data-stu-id="d48d7-310">Notifications Process in Windows Search</span></span>](-search-3x-wds-support.md)
</dt> <dt>

[<span data-ttu-id="d48d7-311">URL 格式設定需求</span><span class="sxs-lookup"><span data-stu-id="d48d7-311">URL Formatting Requirements</span></span>](url-formatting-requirements.md)
</dt> </dl>

 

 
