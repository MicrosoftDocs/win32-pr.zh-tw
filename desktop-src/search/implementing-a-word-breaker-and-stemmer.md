---
description: Microsoft 提供許多語言的斷詞工具和字幹分析器。 本主題說明如何針對語言使用自訂斷詞工具和字幹分析器，以及在 Microsoft 提供的地區設定以外的地區設定。
ms.assetid: 47768691-7071-440e-bfbf-975713880c00
title: 執行斷詞工具和字幹分析器
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4bd4f4e3210e7f4e17bb035115fd694656cc6e6d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104026114"
---
# <a name="implementing-a-word-breaker-and-stemmer"></a><span data-ttu-id="65e0b-104">執行斷詞工具和字幹分析器</span><span class="sxs-lookup"><span data-stu-id="65e0b-104">Implementing a Word Breaker and Stemmer</span></span>

<span data-ttu-id="65e0b-105">Microsoft 提供許多語言的斷詞工具和字幹分析器。</span><span class="sxs-lookup"><span data-stu-id="65e0b-105">Microsoft provides word breakers and stemmers for a number of languages.</span></span> <span data-ttu-id="65e0b-106">本主題說明如何針對語言使用自訂斷詞工具和字幹分析器，以及在 Microsoft 提供的地區設定以外的地區設定。</span><span class="sxs-lookup"><span data-stu-id="65e0b-106">This topic describes how to implement, and use custom word breakers and stemmers for languages, and locales beyond those provided by Microsoft.</span></span>

> [!Note]
> <span data-ttu-id="65e0b-107">從2018年7月起，Windows Server 2019 的安全性變更，可防止 SearchIndexer.exe 載入沒有 Microsoft 簽章的 Dll。</span><span class="sxs-lookup"><span data-stu-id="65e0b-107">As of July 2018 a security change was made to Windows Server 2019 that prevents DLLs without a Microsoft signature from being loaded by SearchIndexer.exe.</span></span> <span data-ttu-id="65e0b-108">因此，Windows Server 2019 不再支援非 Microsoft 簽署的自訂斷詞工具。</span><span class="sxs-lookup"><span data-stu-id="65e0b-108">As a result Windows Server 2019 no longer supports non-Microsoft signed custom word breakers.</span></span> 

<span data-ttu-id="65e0b-109">本主題的組織方式如下：</span><span class="sxs-lookup"><span data-stu-id="65e0b-109">This topic is organized as follows:</span></span>

-   [<span data-ttu-id="65e0b-110">註冊語言資源 DLL</span><span class="sxs-lookup"><span data-stu-id="65e0b-110">Registering a Language Resource DLL</span></span>](#registering-a-language-resource-dll)
-   [<span data-ttu-id="65e0b-111">註冊語言</span><span class="sxs-lookup"><span data-stu-id="65e0b-111">Registering a Language</span></span>](#registering-a-language-resource-dll)
-   [<span data-ttu-id="65e0b-112">執行單字小燒杯</span><span class="sxs-lookup"><span data-stu-id="65e0b-112">Implementing a Word Beaker</span></span>](#implementing-a-word-beaker)
    -   [<span data-ttu-id="65e0b-113">WordSink 和 PhraseSink</span><span class="sxs-lookup"><span data-stu-id="65e0b-113">WordSink and PhraseSink</span></span>](#wordsink-and-phrasesink)
    -   [<span data-ttu-id="65e0b-114">分隔設定</span><span class="sxs-lookup"><span data-stu-id="65e0b-114">Breaks</span></span>](#breaks)
    -   [<span data-ttu-id="65e0b-115">擴充性、Performancy 和安全性</span><span class="sxs-lookup"><span data-stu-id="65e0b-115">Scalability, Performancy, and Security</span></span>](#scalability-performancy-and-security)
-   [<span data-ttu-id="65e0b-116">執行字幹分析器</span><span class="sxs-lookup"><span data-stu-id="65e0b-116">Implementing a Stemmer</span></span>](#implementing-a-stemmer)
    -   [<span data-ttu-id="65e0b-117">擴充性、Performancy 和安全性</span><span class="sxs-lookup"><span data-stu-id="65e0b-117">Scalability, Performancy, and Security</span></span>](#scalability-performancy-and-security)
-   [<span data-ttu-id="65e0b-118">相關主題</span><span class="sxs-lookup"><span data-stu-id="65e0b-118">Related topics</span></span>](#related-topics)

## <a name="registering-a-language-resource-dll"></a><span data-ttu-id="65e0b-119">註冊語言資源 DLL</span><span class="sxs-lookup"><span data-stu-id="65e0b-119">Registering a Language Resource DLL</span></span>

<span data-ttu-id="65e0b-120">每個語言資源 DLL 都必須執行並匯出下列進入點。</span><span class="sxs-lookup"><span data-stu-id="65e0b-120">Each language resource DLL must implement and export the following entry points.</span></span> <span data-ttu-id="65e0b-121">DLL 可以註冊在任何資料夾中。</span><span class="sxs-lookup"><span data-stu-id="65e0b-121">The DLL can be registered to be in any folder.</span></span>

-   <span data-ttu-id="65e0b-122">DllMain 是 DLL 的標準進入點。</span><span class="sxs-lookup"><span data-stu-id="65e0b-122">DllMain is the standard entry point to DLL.</span></span>
-   <span data-ttu-id="65e0b-123">DllRegisterServer 會在登錄中註冊 DLL，例如 `regsvr32.exe %SystemRoot%\MyFolder\wordbreaker.dll`</span><span class="sxs-lookup"><span data-stu-id="65e0b-123">DllRegisterServer registers the DLL in the registry, such as `regsvr32.exe %SystemRoot%\MyFolder\wordbreaker.dll`</span></span>
-   <span data-ttu-id="65e0b-124">DllCanUnloadNow 可讓用戶端透過元件物件模型 (COM) 來呼叫這個進入點，以判斷是否可以卸載語言資源 DLL。</span><span class="sxs-lookup"><span data-stu-id="65e0b-124">DllCanUnloadNow enables clients to call this entry point through Component Object Model (COM) to determine whether it is possible to unload the language resource DLL.</span></span>
-   <span data-ttu-id="65e0b-125">DllUnRegisterServer 會將 DLL 從登錄中移除。</span><span class="sxs-lookup"><span data-stu-id="65e0b-125">DllUnRegisterServer removes the DLL from the registry.</span></span>

## <a name="registering-a-language"></a><span data-ttu-id="65e0b-126">註冊語言</span><span class="sxs-lookup"><span data-stu-id="65e0b-126">Registering a Language</span></span>

<span data-ttu-id="65e0b-127">登錄包含要編制索引之語言的特定語言專案，而這些專案會控制特定語言之索引和查詢程式的元件。</span><span class="sxs-lookup"><span data-stu-id="65e0b-127">The registry contains language-specific entries for the language being indexed, and these entries control the parts of the indexing and query processes that are language specific.</span></span> <span data-ttu-id="65e0b-128">您可以在下列登錄機碼下找到這些登錄專案。</span><span class="sxs-lookup"><span data-stu-id="65e0b-128">These registry entries can be found under the following registry key.</span></span>

```
HKEY_LOCAL_MACHINE
   SYSTEM
      CurrentControlSet
         ContentIndex
            Control
               Language
                  
```

## <a name="implementing-a-word-beaker"></a><span data-ttu-id="65e0b-129">執行單字小燒杯</span><span class="sxs-lookup"><span data-stu-id="65e0b-129">Implementing a Word Beaker</span></span>

<span data-ttu-id="65e0b-130">斷詞工具會執行 [**IWordBreaker**](/windows/desktop/api/Indexsrv/nn-indexsrv-iwordbreaker)。</span><span class="sxs-lookup"><span data-stu-id="65e0b-130">Word breakers implement [**IWordBreaker**](/windows/desktop/api/Indexsrv/nn-indexsrv-iwordbreaker).</span></span> <span data-ttu-id="65e0b-131">[**IWordBreaker：： BreakText**](/windows/desktop/api/Indexsrv/nf-indexsrv-iwordbreaker-breaktext)方法會執行所有文字處理和剖析。</span><span class="sxs-lookup"><span data-stu-id="65e0b-131">The [**IWordBreaker::BreakText**](/windows/desktop/api/Indexsrv/nf-indexsrv-iwordbreaker-breaktext) method performs all text processing and parsing.</span></span> <span data-ttu-id="65e0b-132">若要執行斷詞工具元件，您必須具有語言的語言啟發學習法。</span><span class="sxs-lookup"><span data-stu-id="65e0b-132">To implement a word breaker component, you must have language heuristics for your language.</span></span> <span data-ttu-id="65e0b-133">這包括語法和 morphology 的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="65e0b-133">This includes information about syntax and morphology.</span></span> <span data-ttu-id="65e0b-134">您也可能需要排除或包含的字詞清單。</span><span class="sxs-lookup"><span data-stu-id="65e0b-134">You may also need a list of words to exclude or include.</span></span> <span data-ttu-id="65e0b-135">您可以從排除字組清單中，為您的語言地區設定建立非搜尋字的檔。</span><span class="sxs-lookup"><span data-stu-id="65e0b-135">You build the file of noise words for your language locale from the list of excluded words.</span></span> <span data-ttu-id="65e0b-136">如需有關語言考慮以及這些考慮如何影響斷詞工具的詳細資訊，請參閱 [語言和 Unicode 考慮](linguistic-and-unicode-considerations.md)。</span><span class="sxs-lookup"><span data-stu-id="65e0b-136">For more information about linguistic considerations and how these considerations affect word breaker implementations, see [Linguistic and Unicode Considerations](linguistic-and-unicode-considerations.md).</span></span>

<span data-ttu-id="65e0b-137">[**IWordBreaker：： BreakText**](/windows/desktop/api/Indexsrv/nf-indexsrv-iwordbreaker-breaktext)的主要目的是要在所有文字都經過處理或斷詞工具遇到錯誤之前，從 [**文字 \_ 來源**](/windows/win32/api/indexsrv/ns-indexsrv-text_source)連續處理文字。</span><span class="sxs-lookup"><span data-stu-id="65e0b-137">The main purpose of [**IWordBreaker::BreakText**](/windows/desktop/api/Indexsrv/nf-indexsrv-iwordbreaker-breaktext) is to process text continuously from the [**TEXT\_SOURCE**](/windows/win32/api/indexsrv/ns-indexsrv-text_source) until all the text is processed, or until the word breaker encounters an error.</span></span> <span data-ttu-id="65e0b-138">在此資料處理迴圈中， **IWordBreaker：： BreakText** 會呼叫執行該處理常式之特定工作的剖析和公用程式方法。</span><span class="sxs-lookup"><span data-stu-id="65e0b-138">While in this data processing loop, **IWordBreaker::BreakText** calls parsing and utility methods that perform specific tasks for that process.</span></span> <span data-ttu-id="65e0b-139">例如，德文斷詞工具可能會處理複合字，而法文斷詞工具可能會處理變 [音符](surface-form-normalization.md) 號或 [clitics](surface-form-normalization.md)。</span><span class="sxs-lookup"><span data-stu-id="65e0b-139">For example, the German word breaker may handle compound words, whereas the French word breaker may process [diacritics](surface-form-normalization.md) or [clitics](surface-form-normalization.md).</span></span> <span data-ttu-id="65e0b-140">斷詞工具所執行的特定函式，以及它用來執行這些工作的策略完全取決於該語言的需求。</span><span class="sxs-lookup"><span data-stu-id="65e0b-140">The specific functions that the word breaker performs and the strategy that it uses in performing these tasks depend entirely on the requirements for that language.</span></span>

<span data-ttu-id="65e0b-141">當斷詞時，斷詞工具會針對可能具有多個表示的單字識別「替代」表單。</span><span class="sxs-lookup"><span data-stu-id="65e0b-141">When breaking text, word breakers identify "alternative" forms for words that may have multiple representations.</span></span> <span data-ttu-id="65e0b-142">產生的單字之間不會隱含任何語義關聯性。</span><span class="sxs-lookup"><span data-stu-id="65e0b-142">No semantic relationship is implied between the generated words.</span></span> <span data-ttu-id="65e0b-143">事實上，原始字組可能不會包含在替代專案清單中。</span><span class="sxs-lookup"><span data-stu-id="65e0b-143">In fact, the original word may not be included among the list of alternatives.</span></span> <span data-ttu-id="65e0b-144">替代形式會儲存在索引中的相同位置，以做為原始單字，表示兩者相同。</span><span class="sxs-lookup"><span data-stu-id="65e0b-144">The alternative forms are saved in the same position in the index as the original word to indicate that they are identical.</span></span>

<span data-ttu-id="65e0b-145">當檔包含在索引中時，每個單字都會被指派一個整數值，代表位移，或從檔開頭開始的單字距離。</span><span class="sxs-lookup"><span data-stu-id="65e0b-145">When a document is included in the index, each word is assigned an integer value that represents the offset, or the distance of the word from the beginning of a document.</span></span> <span data-ttu-id="65e0b-146">查詢中的單字之間的相對距離會與儲存在全文檢索索引中的位移進行比較。</span><span class="sxs-lookup"><span data-stu-id="65e0b-146">The relative distance between words in a query is compared against the offsets stored in the full-text index.</span></span> <span data-ttu-id="65e0b-147">「Kyle 的檔」查詢會比對任何包含 "Where" at offset n 的檔、"at" at n + 1、"Kyle's" at n + 2 和 "document" （n + 3）。</span><span class="sxs-lookup"><span data-stu-id="65e0b-147">The query "Where is Kyle's document" matches any document with "Where" at offset n, "is" at n+1, "Kyle's" at n+2, and "document" at n+3.</span></span> <span data-ttu-id="65e0b-148">「Kyle 的檔記載于資料基底？」</span><span class="sxs-lookup"><span data-stu-id="65e0b-148">"Where is Kyle's document filed in the data-base?"</span></span> <span data-ttu-id="65e0b-149">表示為：</span><span class="sxs-lookup"><span data-stu-id="65e0b-149">is represented as:</span></span>



|       |     |                        |          |       |     |     |                               |
|-------|-----|------------------------|----------|-------|-----|-----|-------------------------------|
| <span data-ttu-id="65e0b-150">Where</span><span class="sxs-lookup"><span data-stu-id="65e0b-150">Where</span></span> | <span data-ttu-id="65e0b-151">is</span><span class="sxs-lookup"><span data-stu-id="65e0b-151">is</span></span>  | <span data-ttu-id="65e0b-152">Kyle Kyle</span><span class="sxs-lookup"><span data-stu-id="65e0b-152">Kyle Kyle's</span></span><br/> | <span data-ttu-id="65e0b-153">文件</span><span class="sxs-lookup"><span data-stu-id="65e0b-153">document</span></span> | <span data-ttu-id="65e0b-154">提交</span><span class="sxs-lookup"><span data-stu-id="65e0b-154">filed</span></span> | <span data-ttu-id="65e0b-155">in</span><span class="sxs-lookup"><span data-stu-id="65e0b-155">in</span></span>  | <span data-ttu-id="65e0b-156">the</span><span class="sxs-lookup"><span data-stu-id="65e0b-156">the</span></span> | <span data-ttu-id="65e0b-157">資料庫資料基底</span><span class="sxs-lookup"><span data-stu-id="65e0b-157">database data base</span></span><br/> |



 

<span data-ttu-id="65e0b-158">在此範例中，斷詞工具會在索引中儲存 "Kyle" ( "Kyle" ) 和 "database" ( "data base" ) 的替代形式。</span><span class="sxs-lookup"><span data-stu-id="65e0b-158">In this example, the word breaker stores alternative forms for "Kyle" ("Kyle's") and "database" ("data base") in the index.</span></span> <span data-ttu-id="65e0b-159">在下列情況下，斷詞工具會在索引建立程式期間產生並儲存替代單字：</span><span class="sxs-lookup"><span data-stu-id="65e0b-159">The word breaker generates and stores alternative words during the index creation process under the following conditions:</span></span>

-   <span data-ttu-id="65e0b-160">如果另一個字可能會在查詢中顯示為單一單字</span><span class="sxs-lookup"><span data-stu-id="65e0b-160">If an alternative word is likely to appear as a single word in a query</span></span>
-   <span data-ttu-id="65e0b-161">如果字幹分析器不太可能從替代方式衍生原始單字</span><span class="sxs-lookup"><span data-stu-id="65e0b-161">If a stemmer is not likely to derive the original word from the alternative</span></span>

<span data-ttu-id="65e0b-162">產生替代的單字表單會增加查詢表示及符合句子的方式數目，如下列變化所示：</span><span class="sxs-lookup"><span data-stu-id="65e0b-162">Generating alternative word forms increases the number of ways that queries represent and match a sentence, as shown in the following variations:</span></span>

1.  <span data-ttu-id="65e0b-163">Kyle 檔在資料庫中的記錄位置</span><span class="sxs-lookup"><span data-stu-id="65e0b-163">Where is Kyle document filed in the database</span></span>
2.  <span data-ttu-id="65e0b-164">Kyle 在資料庫中的檔歸檔位置</span><span class="sxs-lookup"><span data-stu-id="65e0b-164">Where is Kyle's document filed in the database</span></span>
3.  <span data-ttu-id="65e0b-165">其中是 Kyle 檔在資料基底中的欄位</span><span class="sxs-lookup"><span data-stu-id="65e0b-165">Where is Kyle document filed in the data base</span></span>
4.  <span data-ttu-id="65e0b-166">Kyle 在資料基底中的檔歸檔位置</span><span class="sxs-lookup"><span data-stu-id="65e0b-166">Where is Kyle's document filed in the data base</span></span>

### <a name="wordsink-and-phrasesink"></a><span data-ttu-id="65e0b-167">WordSink 和 PhraseSink</span><span class="sxs-lookup"><span data-stu-id="65e0b-167">WordSink and PhraseSink</span></span>

<span data-ttu-id="65e0b-168">斷詞工具會使用 [**IWordSink**](iwordsink.md) 和 [**IPhraseSink**](/windows/win32/api/indexsrv/nn-indexsrv-iphrasesink) 物件來收集和儲存它們從文字中解壓縮的所有單字和片語。</span><span class="sxs-lookup"><span data-stu-id="65e0b-168">Word breakers use the [**IWordSink**](iwordsink.md) and [**IPhraseSink**](/windows/win32/api/indexsrv/nn-indexsrv-iphrasesink) objects to collect and store all words and phrases that they extract from text.</span></span> <span data-ttu-id="65e0b-169">斷詞工具會以盡可能接近檔中原始單字形式的形式來儲存文字。</span><span class="sxs-lookup"><span data-stu-id="65e0b-169">A word breaker stores words in a form that is as close as possible to the original word form in the document.</span></span> <span data-ttu-id="65e0b-170">**IPhraseSink** 會在查詢時儲存片語。</span><span class="sxs-lookup"><span data-stu-id="65e0b-170">**IPhraseSink** stores phrases at query time.</span></span> <span data-ttu-id="65e0b-171">片語可改善查詢結果的相關性，因為較長的單字序列是罕見，並提供比較小片語更大的差異。</span><span class="sxs-lookup"><span data-stu-id="65e0b-171">Phrases improve the relevance of query results because longer sequences of words are rarer and provide greater distinction than smaller phrases.</span></span> <span data-ttu-id="65e0b-172">當索引子在查詢時將片語放在 **IPhraseSink** 中時，它會建立斷詞工具的實例，以將片語分成單字。</span><span class="sxs-lookup"><span data-stu-id="65e0b-172">When the indexer places a phrase in the **IPhraseSink** at query time, it creates an instance of the word breaker to break the phrase into words.</span></span> <span data-ttu-id="65e0b-173">然後，索引子會藉由檢查片語中的單字是否出現在索引中彼此連續的方式來評估片語。</span><span class="sxs-lookup"><span data-stu-id="65e0b-173">The indexer then evaluates the phrase by checking whether the words in the phrase occur adjacent to one another in the index.</span></span> <span data-ttu-id="65e0b-174">例如，如果 "ABCD" 出現在索引中的位置 *x*、 *x*+ 1、 *x*+ 2 和 *x*+ 3，則如果在查詢中提交 "abcd" 的任何相鄰子字串，就會發生片語相符的情況。</span><span class="sxs-lookup"><span data-stu-id="65e0b-174">For example, if "ABCD" occurs in the index at positions *x*, *x*+1, *x*+2, and *x*+3, the phrase match will occur if any adjacent substring of "ABCD" is submitted in a query.</span></span> <span data-ttu-id="65e0b-175">這項策略適用于以字元為基礎的斷詞工具，可在索引建立期間分割片語和長字組，並在查詢期間產生片語。</span><span class="sxs-lookup"><span data-stu-id="65e0b-175">This strategy is effective for character-based word breakers that split phrases and long words during index creation and that generate phrases during query time.</span></span>

### <a name="breaks"></a><span data-ttu-id="65e0b-176">分隔設定</span><span class="sxs-lookup"><span data-stu-id="65e0b-176">Breaks</span></span>

<span data-ttu-id="65e0b-177">「中斷」是單字之間的空格。</span><span class="sxs-lookup"><span data-stu-id="65e0b-177">Breaks are the spaces between words.</span></span> <span data-ttu-id="65e0b-178">空白字元、標點符號、格式化或只是語言本身的本質可能會導致中斷。</span><span class="sxs-lookup"><span data-stu-id="65e0b-178">White space, punctuation, formatting, or just the nature of the language itself can cause breaks.</span></span> <span data-ttu-id="65e0b-179">索引子會使用四種不同類型的中斷：字尾 (EOW) 、句子結尾 (EOS) 、段落結尾 (EOP) 和 (的第一章) 。</span><span class="sxs-lookup"><span data-stu-id="65e0b-179">There are four different types of breaks that the indexer uses: end of word (EOW), end of sentence (EOS), end of paragraph (EOP) and end of chapter (EOC).</span></span> <span data-ttu-id="65e0b-180">EOW 中斷是預設中斷。</span><span class="sxs-lookup"><span data-stu-id="65e0b-180">The EOW break is the default break.</span></span> <span data-ttu-id="65e0b-181">在每個 token 之後，每個 break 都會指出任一邊單字之間的不同語義距離。</span><span class="sxs-lookup"><span data-stu-id="65e0b-181">After each token, each break indicates a different semantic distance between the words on either side.</span></span> <span data-ttu-id="65e0b-182">以 EOW 分隔的單字具有嚴謹語義連結，後面接著 EOS、EOP 和 EOC。</span><span class="sxs-lookup"><span data-stu-id="65e0b-182">Words separated by EOW have the tightest semantic link, followed by EOS, EOP, and EOC.</span></span> <span data-ttu-id="65e0b-183">多個 [**IWordSink 呼叫：:P utbreak**](iwordsink-putbreak.md) 是累計的，而且類似于插入 null 單字或句子。</span><span class="sxs-lookup"><span data-stu-id="65e0b-183">Multiple calls to [**IWordSink::PutBreak**](iwordsink-putbreak.md) are cumulative, and are analogous to inserting null words or sentences.</span></span>

### <a name="scalability-performancy-and-security"></a><span data-ttu-id="65e0b-184">擴充性、Performancy 和安全性</span><span class="sxs-lookup"><span data-stu-id="65e0b-184">Scalability, Performancy, and Security</span></span>

<span data-ttu-id="65e0b-185">斷詞工具回應同時呼叫的方式，主要取決於您選擇的執行緒模型。</span><span class="sxs-lookup"><span data-stu-id="65e0b-185">The way the word breaker responds to simultaneous calls is largely determined by your choice of threading model.</span></span> <span data-ttu-id="65e0b-186">索引子是單一執行緒應用程式。</span><span class="sxs-lookup"><span data-stu-id="65e0b-186">The indexer is a single-threaded application.</span></span> <span data-ttu-id="65e0b-187">若要讓斷詞工具在單一執行緒環境中運作，必須使用「免費」或「兩個」執行緒模型來撰寫斷詞工具。</span><span class="sxs-lookup"><span data-stu-id="65e0b-187">For word breakers to work in a single-threaded environment, word breakers must be written using a "free" or "both" threading model.</span></span> <span data-ttu-id="65e0b-188">斷詞工具不得使用「單元」執行緒模型向 COM 註冊。</span><span class="sxs-lookup"><span data-stu-id="65e0b-188">Word breakers must not register with COM by using the "apartment" threading model.</span></span>

<span data-ttu-id="65e0b-189">我們建議斷詞工具避免全域狀態，並將資料儲存在該斷詞工具的實例中。</span><span class="sxs-lookup"><span data-stu-id="65e0b-189">We recommend that word breakers avoid global states and store data in the instance for the word breaker.</span></span> <span data-ttu-id="65e0b-190">唯一應儲存在斷詞工具實作為參數 *fQuery* 和 *ulMaxTokenSize* 的內容。</span><span class="sxs-lookup"><span data-stu-id="65e0b-190">The only content that should be stored in the word breaker implementation are for the parameters *fQuery* and *ulMaxTokenSize*.</span></span> <span data-ttu-id="65e0b-191">斷詞工具的速度不應超過英文斷詞工具所建立的基準。</span><span class="sxs-lookup"><span data-stu-id="65e0b-191">Word breakers should be no more than two times slower than the benchmark established by the English word breaker.</span></span> <span data-ttu-id="65e0b-192">斷詞工具效能也應以增加的硬體功能來改善。</span><span class="sxs-lookup"><span data-stu-id="65e0b-192">Word breaker performance should also improve with increased hardware capability.</span></span>

<span data-ttu-id="65e0b-193">索引子在本機系統安全性內容中執行的斷詞工具。</span><span class="sxs-lookup"><span data-stu-id="65e0b-193">Word breakers for the indexer run in the Local System security context.</span></span> <span data-ttu-id="65e0b-194">它們應該寫入來管理緩衝區，並正確地堆疊。</span><span class="sxs-lookup"><span data-stu-id="65e0b-194">They should be written to manage buffers and to stack correctly.</span></span> <span data-ttu-id="65e0b-195">所有字串複本都必須有明確的檢查，以防止緩衝區溢位。</span><span class="sxs-lookup"><span data-stu-id="65e0b-195">All string copies must have explicit checks to guard against buffer overruns.</span></span> <span data-ttu-id="65e0b-196">您應該一律確認已配置的緩衝區大小，並根據緩衝區大小測試資料的大小。</span><span class="sxs-lookup"><span data-stu-id="65e0b-196">You should always verify the allocated size of the buffer and test the size of the data against the size of the buffer.</span></span> <span data-ttu-id="65e0b-197">斷詞工具無法假設傳遞給 [**IWordBreaker：： BreakText**](/windows/desktop/api/Indexsrv/nf-indexsrv-iwordbreaker-breaktext) 方法的文字格式正確。</span><span class="sxs-lookup"><span data-stu-id="65e0b-197">Word breakers cannot assume that the text passed to the [**IWordBreaker::BreakText**](/windows/desktop/api/Indexsrv/nf-indexsrv-iwordbreaker-breaktext) method is well formed.</span></span> <span data-ttu-id="65e0b-198">如需疑難排解斷詞工具的詳細資訊，請參閱 [疑難排解語言資源和最佳作法](troubleshooting-language-resources.md)。</span><span class="sxs-lookup"><span data-stu-id="65e0b-198">For more information about troubleshooting word breakers, see [Troubleshooting Language Resources and Best Practices](troubleshooting-language-resources.md).</span></span>

## <a name="implementing-a-stemmer"></a><span data-ttu-id="65e0b-199">執行字幹分析器</span><span class="sxs-lookup"><span data-stu-id="65e0b-199">Implementing a Stemmer</span></span>

<span data-ttu-id="65e0b-200">字幹分析器會執行 [**IStemmer**](/windows/desktop/api/Indexsrv/nn-indexsrv-istemmer) 介面。</span><span class="sxs-lookup"><span data-stu-id="65e0b-200">Stemmers implement the [**IStemmer**](/windows/desktop/api/Indexsrv/nn-indexsrv-istemmer) interface.</span></span> <span data-ttu-id="65e0b-201">[**IStemmer：： GenerateWordForms**](/windows/desktop/api/Indexsrv/nf-indexsrv-istemmer-generatewordforms)方法會產生特定輸入字組的屈折變化字表單清單。</span><span class="sxs-lookup"><span data-stu-id="65e0b-201">The [**IStemmer::GenerateWordForms**](/windows/desktop/api/Indexsrv/nf-indexsrv-istemmer-generatewordforms) method generates a list of inflected word forms for a particular input word.</span></span> <span data-ttu-id="65e0b-202">若要執行詞幹分析器元件，您必須具有語言的語言啟發學習法。</span><span class="sxs-lookup"><span data-stu-id="65e0b-202">To implement a stemmer component, you must have language heuristics for your language.</span></span> <span data-ttu-id="65e0b-203">這包括 morphology 的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="65e0b-203">This includes information about morphology.</span></span> <span data-ttu-id="65e0b-204">您也可能需要排除或包含的字詞清單。</span><span class="sxs-lookup"><span data-stu-id="65e0b-204">You may also need a list of words to exclude or include.</span></span> <span data-ttu-id="65e0b-205">如需有關語言考慮以及這些考慮如何影響字幹分析器的詳細資訊，請參閱 [語言和 Unicode 考慮](linguistic-and-unicode-considerations.md)。</span><span class="sxs-lookup"><span data-stu-id="65e0b-205">For more information about linguistic considerations and how these considerations affect stemmer implementations, see [Linguistic and Unicode Considerations](linguistic-and-unicode-considerations.md).</span></span>

<span data-ttu-id="65e0b-206">我們建議字幹分析器不應為單字產生所有格（或所有格）案例。</span><span class="sxs-lookup"><span data-stu-id="65e0b-206">We recommend that stemmers should not generate the genitive, or possessive, case for words.</span></span> <span data-ttu-id="65e0b-207">例如，"David" 不會產生為 "David" 的替代形式。</span><span class="sxs-lookup"><span data-stu-id="65e0b-207">For example, "David" is not generated as an alternative form for "David's."</span></span> <span data-ttu-id="65e0b-208">斷詞工具在剖析「David」時，會產生「David」和「David」。</span><span class="sxs-lookup"><span data-stu-id="65e0b-208">The word breaker generates both "David" and "David's" when it parses "David's."</span></span>

<span data-ttu-id="65e0b-209">詞幹分析器會使用 [IWordFormSink](/windows/desktop/api/Indexsrv/nn-indexsrv-iwordformsink) 物件來收集替代字的清單。</span><span class="sxs-lookup"><span data-stu-id="65e0b-209">The stemmer uses the [IWordFormSink](/windows/desktop/api/Indexsrv/nn-indexsrv-iwordformsink) object to gather the list of alternative words.</span></span> <span data-ttu-id="65e0b-210">[**IWordFormSink：:P utword**](iwordformsink-putword.md) 會從詞幹分析器產生最後一個字組。</span><span class="sxs-lookup"><span data-stu-id="65e0b-210">[**IWordFormSink::PutWord**](iwordformsink-putword.md) generates the final word from the stemmer.</span></span> <span data-ttu-id="65e0b-211">在所有情況下，這個最後的單字與 [**IStemmer：： GenerateWordForms**](/windows/desktop/api/Indexsrv/nf-indexsrv-istemmer-generatewordforms)的輸入字相同。</span><span class="sxs-lookup"><span data-stu-id="65e0b-211">In all cases, this final word is the same as the input word from [**IStemmer::GenerateWordForms**](/windows/desktop/api/Indexsrv/nf-indexsrv-istemmer-generatewordforms).</span></span> <span data-ttu-id="65e0b-212">例如，假設「泳道」一字，則字幹分析器會產生下列單字格式： "游泳"、"swimmer"、"游泳"、"swam" 和 "swum" （透過呼叫 [**IWordFormSink：:P utaltword**](iwordformsink-putphrase.md)）。</span><span class="sxs-lookup"><span data-stu-id="65e0b-212">For example, given the word "swim," the stemmer generates the following word forms: "swimming," "swimmer," "swims," "swam," and "swum," through calls to [**IWordFormSink::PutAltWord**](iwordformsink-putphrase.md).</span></span> <span data-ttu-id="65e0b-213">此字幹分析器會透過 **IWordFormSink：:P utword** 來產生「泳道」。</span><span class="sxs-lookup"><span data-stu-id="65e0b-213">The stemmer generates "swim" through **IWordFormSink::PutWord**.</span></span>

### <a name="scalability-performancy-and-security"></a><span data-ttu-id="65e0b-214">擴充性、Performancy 和安全性</span><span class="sxs-lookup"><span data-stu-id="65e0b-214">Scalability, Performancy, and Security</span></span>

<span data-ttu-id="65e0b-215">字幹分析器（例如斷詞工具）必須使用「免費」執行緒模型，並向 COM 註冊，其執行緒模型設定為「免費」或「兩者」。</span><span class="sxs-lookup"><span data-stu-id="65e0b-215">Stemmers, like word breakers, must use a "free" threading model and register with COM with their threading model set to "free" or "both."</span></span> <span data-ttu-id="65e0b-216">Windows Search 會同時從不同的執行緒呼叫不同的詞幹分析器實例。</span><span class="sxs-lookup"><span data-stu-id="65e0b-216">Windows Search calls separate instances of the stemmer from different threads at the same time.</span></span> <span data-ttu-id="65e0b-217">因此，字幹分析器應該會有基本的實例資料。</span><span class="sxs-lookup"><span data-stu-id="65e0b-217">Stemmers should therefore have minimal instance data.</span></span>

<span data-ttu-id="65e0b-218">分析器精確度對查詢相關性有顯著的影響。</span><span class="sxs-lookup"><span data-stu-id="65e0b-218">Stemmer accuracy has a significant impact on query relevance.</span></span> <span data-ttu-id="65e0b-219">如果字幹分析器不正確地詞幹文字，查詢可能會傳回無法預測且不正確的結果。</span><span class="sxs-lookup"><span data-stu-id="65e0b-219">If the stemmer stems the text incorrectly, queries may return unpredictable and inaccurate results.</span></span> <span data-ttu-id="65e0b-220">字幹分析器必須每秒處理數百個查詢，而不會對查詢效能產生負面影響。</span><span class="sxs-lookup"><span data-stu-id="65e0b-220">Stemmers must handle hundreds of queries per second without negatively affecting query performance.</span></span> <span data-ttu-id="65e0b-221">分析器效能應可利用增加的硬體功能來改善。</span><span class="sxs-lookup"><span data-stu-id="65e0b-221">Stemmer performance should improve with increased hardware capability.</span></span> <span data-ttu-id="65e0b-222">如需疑難排解字幹分析器的相關資訊，請參閱 [疑難排解語言資源和最佳作法](troubleshooting-language-resources.md)。</span><span class="sxs-lookup"><span data-stu-id="65e0b-222">For information about troubleshooting stemmers, see [Troubleshooting Language Resources and Best Practices](troubleshooting-language-resources.md).</span></span>

<span data-ttu-id="65e0b-223">Windows Search 在本機安全性內容中執行的字幹分析器。</span><span class="sxs-lookup"><span data-stu-id="65e0b-223">Stemmers for Windows Search run in the Local Security context.</span></span> <span data-ttu-id="65e0b-224">它們應該寫入來管理緩衝區，並正確地堆疊。</span><span class="sxs-lookup"><span data-stu-id="65e0b-224">They should be written to manage buffers and to stack correctly.</span></span> <span data-ttu-id="65e0b-225">所有字串複本都必須有明確的檢查，以防止緩衝區溢位。</span><span class="sxs-lookup"><span data-stu-id="65e0b-225">All string copies must have explicit checks to guard against buffer overruns.</span></span> <span data-ttu-id="65e0b-226">您應該一律確認已配置的緩衝區大小，並根據緩衝區大小測試資料的大小。</span><span class="sxs-lookup"><span data-stu-id="65e0b-226">You should always verify the allocated size of the buffer and test the size of the data against the size of the buffer.</span></span>

## <a name="related-topics"></a><span data-ttu-id="65e0b-227">相關主題</span><span class="sxs-lookup"><span data-stu-id="65e0b-227">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="65e0b-228">擴充語言資源</span><span class="sxs-lookup"><span data-stu-id="65e0b-228">Extending Language Resources</span></span>](extending-language-resources-in-windows-search.md)
</dt> <dt>

[<span data-ttu-id="65e0b-229">瞭解語言資源元件</span><span class="sxs-lookup"><span data-stu-id="65e0b-229">Understanding Language Resource Components</span></span>](understanding-language-resource-components.md)
</dt> <dt>

[<span data-ttu-id="65e0b-230">語言和 Unicode 考慮</span><span class="sxs-lookup"><span data-stu-id="65e0b-230">Linguistic and Unicode Considerations</span></span>](linguistic-and-unicode-considerations.md)
</dt> <dt>

[<span data-ttu-id="65e0b-231">疑難排解語言資源和最佳作法</span><span class="sxs-lookup"><span data-stu-id="65e0b-231">Troubleshooting Language Resources and Best Practices</span></span>](troubleshooting-language-resources.md)
</dt> </dl>

 

 
