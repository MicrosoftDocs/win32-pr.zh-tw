---
title: '自動維護 (工作排程器) '
description: 維護活動指的是有助於維護 Windows 電腦健全狀況和效能的應用程式或處理常式。
ms.assetid: 1D38341B-15AA-422F-AED1-647FCDE69E2E
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 456383eeb75c3b29bf575357d4b17d5f8a66234b
ms.sourcegitcommit: 857e701bbd35004661bb047e1f24622af9ff1dd7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/19/2020
ms.locfileid: "104383161"
---
# <a name="automatic-maintenance"></a><span data-ttu-id="6c9fd-103">自動維護</span><span class="sxs-lookup"><span data-stu-id="6c9fd-103">Automatic maintenance</span></span>

<span data-ttu-id="6c9fd-104">維護活動指的是有助於維護 Windows 電腦健全狀況和效能的應用程式或處理常式。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-104">Maintenance activity refers to an application or process that helps maintain the health and performance of a Windows PC.</span></span> <span data-ttu-id="6c9fd-105">維護包括讓 Windows 作業系統 (作業系統) 和應用程式保持最新狀態、檢查安全性，以及執行惡意程式碼掃描。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-105">Maintenance includes keeping the Windows operating system (OS) and applications up-to-date, checking security, and running scans for malware.</span></span> <span data-ttu-id="6c9fd-106">Windows 自動管理 (WAM) 是一組工作排程器 API 的增強功能，可讓您用來將應用程式連結到 Windows 維護排程。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-106">Windows Automatic Management (WAM) is a set of enhancements to the Task Scheduler API that you can use to link your applications into the Windows maintenance schedule.</span></span> <span data-ttu-id="6c9fd-107">具體來說，WAM 可讓您新增需要定期排程的活動，但這並沒有確切的時間需求。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-107">Specifically, WAM allows you to add activities that require regular scheduling, but that don't have exact time requirements.</span></span> <span data-ttu-id="6c9fd-108">相反地，WAM 會依賴作業系統來選擇適當的時間，以在一天內啟動工作。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-108">Instead, WAM relies on the operating system to choose the appropriate time to activate the task throughout the day.</span></span> <span data-ttu-id="6c9fd-109">系統會根據使用者、電腦效能和能源效率的最大影響，來選擇這些時間。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-109">The system chooses those times based on minimal impact to the user, PC performance, and energy efficiency.</span></span>

## <a name="how-scheduled-maintenance-works"></a><span data-ttu-id="6c9fd-110">排程維護的運作方式</span><span class="sxs-lookup"><span data-stu-id="6c9fd-110">How scheduled maintenance works</span></span>

<span data-ttu-id="6c9fd-111">工作排程器維護工作是在電腦閒置和 AC 電源時執行的隨機工作。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-111">Task Scheduler maintenance tasks are opportunistic tasks that run when the machine is idle and on AC power.</span></span> <span data-ttu-id="6c9fd-112">維護工作的主要目標之一，就是只在電腦插入 AC 電源和閒置 (也就是當您未使用或不在機器) 的情況下，才進行維護，以將對電腦的影響降到最低。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-112">One of the major goals of maintenance tasks is to minimize impact to the PC by scheduling maintenance only when the PC is plugged in to AC power and idle (that is, when you're not using, or have stepped away from, the machine).</span></span> <span data-ttu-id="6c9fd-113">今日維護的概念是讓機器能以最不中斷的方式處理使用者。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-113">The idea of maintenance today is for the machine to do work with the least disruption to the user.</span></span> <span data-ttu-id="6c9fd-114">因此，舊樣式的維護時間 (我們將在本主題稍後的「 **自動維護 &mdash; 每日喚醒** 」一節中詳細討論此內容) 已改善，以充分利用這些閒置時間。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-114">Hence the old-style maintenance hour (we talk more about this in the **Automatic maintenance&mdash;daily wakeup** section later in this topic) has been improved in order to take advantage of these idle periods.</span></span> <span data-ttu-id="6c9fd-115">雖然仍可利用維護時數，但執行隨機維護對系統健康情況是較好的。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-115">While the maintenance hour can still be leveraged, running opportunistic maintenance is better for system health.</span></span>

<span data-ttu-id="6c9fd-116">如果電腦未花費太多時間閒置和 AC 電源，您的工作可能會耗盡。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-116">Your task may be starved if a machine doesn't spend much time both idle and on AC power.</span></span> <span data-ttu-id="6c9fd-117">確定您的案例仍會提供值給使用者，即使它已延遲也一樣。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-117">Make sure that your scenario will still provide value to the user, even if it is delayed.</span></span> <span data-ttu-id="6c9fd-118">如果使用者正在使用電腦，則系統會延遲維護，直到稍後為止。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-118">If the user is actively using the machine, then the system defers maintenance until a later time.</span></span> <span data-ttu-id="6c9fd-119">如果使用者返回使用電腦，系統也會暫停任何正在執行的維護工作。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-119">The system also suspends any executing maintenance task if the user returns to using the PC.</span></span>

<span data-ttu-id="6c9fd-120">系統會在下一個閒置期間重新開機暫停的維護工作。但是，系統不會暫停任何標記為「重大」的工作。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-120">The system restarts a suspended maintenance task during the next idle period; however, the system won't suspend any task marked as critical.</span></span> <span data-ttu-id="6c9fd-121">相反地，系統會讓重要的工作完成，不論使用者的動作為何。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-121">Instead, the system allows a critical task to complete, regardless of user action.</span></span>

<span data-ttu-id="6c9fd-122">由於排程的本質，某些排程的工作可能無法完成：或許有太多的排程事件可納入1小時的維護期間，或可能是電腦未開啟。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-122">Due to the nature of scheduling, some scheduled tasks may not finish: perhaps there are too many scheduled events to fit into the 1-hour maintenance window, or maybe the computer was simply not turned on.</span></span> <span data-ttu-id="6c9fd-123">在這種情況下，您可以定義具有期限的工作。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-123">In such cases, you can define a task with a deadline.</span></span> <span data-ttu-id="6c9fd-124">期限定義為週期性時間範圍，系統至少必須成功執行一次工作。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-124">A deadline is defined as a recurring timeframe in which the system must successfully perform the task at least once.</span></span>

<span data-ttu-id="6c9fd-125">如果工作錯過期限，則維護排程器會繼續嘗試在維護期間執行工作。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-125">If a task misses a deadline, then the maintenance scheduler will continue to attempt to execute the task during the maintenance window.</span></span> <span data-ttu-id="6c9fd-126">此外，排程器不會將自己限制為一般1小時的時間限制。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-126">Further, the scheduler will not limit itself to the regular 1-hour time limit.</span></span> <span data-ttu-id="6c9fd-127">相反地，排程器會延長維護時段的持續時間，以便完成延遲的工作。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-127">Instead, the scheduler extends the duration of the maintenance window in order to complete the delayed task.</span></span>

<span data-ttu-id="6c9fd-128">當系統完成工作 (即使失敗的錯誤碼) ，也會將嘗試視為成功。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-128">Once the system completes the task (even with a failure error code), the attempt is considered successful.</span></span> <span data-ttu-id="6c9fd-129">成功嘗試之後，排程器會重設為一般維護排程，並在下一個期間嘗試工作。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-129">After a successful attempt, the scheduler resets to the regular maintenance schedule, and will attempt the task during the next period.</span></span>

## <a name="automatic-maintenancemdashdaily-wakeup"></a><span data-ttu-id="6c9fd-130">&mdash;每日自動維護喚醒</span><span class="sxs-lookup"><span data-stu-id="6c9fd-130">Automatic maintenance&mdash;daily wakeup</span></span>

<span data-ttu-id="6c9fd-131">在 Windows 7 上，維護工作會在 *維護* 期間專用執行，預設為上午3點，並可透過群組原則設定。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-131">On Windows 7, a maintenance task runs exclusively during *maintenance hour*, defaulting to 3 AM, and configurable via Group Policy.</span></span> <span data-ttu-id="6c9fd-132">電腦可以從待命喚醒、執行維護工作，然後回到睡眠狀態。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-132">The machine would wake up from standby, run maintenance tasks, and go back to sleep.</span></span> <span data-ttu-id="6c9fd-133">此每日會話限制為每次嘗試1小時的最長持續時間。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-133">This daily session was limited to a maximum duration of 1 hour per attempt.</span></span> <span data-ttu-id="6c9fd-134">這可讓系統每日執行維護，預設為上午3點開始。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-134">This would allow the system to perform maintenance daily, starting at 3 AM by default.</span></span> <span data-ttu-id="6c9fd-135">請注意，使用者可能會藉由設定這些設定來重新排程維護的觸發時間。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-135">Note that the user may re-schedule the time that the maintenance is triggered by configuring these settings.</span></span>

<span data-ttu-id="6c9fd-136">隨著膝上型電腦的推出以及繁重的電池壽命，電腦不再設定為在大部分的情況下允許 S3 喚醒，通常會儘快 Doze (休眠) ，以節省電池。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-136">With the advent of laptops, and the heavy focus on battery life, machines are no longer configured to allow S3 wakeup in most circumstances, and generally Doze-To-S4 (hibernate) as soon as possible, to save battery.</span></span> <span data-ttu-id="6c9fd-137">為了回應這些變更，工作排程器 (> Win7) 會在到期時執行維護工作，而且電腦會處於閒置狀態和 AC 電源。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-137">In response to these changes, Task Scheduler (> Win7) runs maintenance tasks whenever they are due, and the machine is idle and on AC power.</span></span>

<span data-ttu-id="6c9fd-138">這項設定可以在主控台中設定。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-138">This setting can be configured in Control Panel.</span></span>

<span data-ttu-id="6c9fd-139">開啟 **主控台**  >  **系統和安全性**  >  **安全性與維護**  >  **自動維護**。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-139">Open **Control Panel** > **System and Security** > **Security and Maintenance** > **Automatic Maintenance**.</span></span>

<span data-ttu-id="6c9fd-140">因此，根據您的機器和工作的設定方式，可能會因為這項新的設定而無法正常執行每日喚醒行為。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-140">So based on how your machines and your tasks are configured, the daily wakeup behavior may not occur today as expected because of this new configuration.</span></span> <span data-ttu-id="6c9fd-141">您可以先判斷您的電腦是否支援 S3，或有 CS (連接的待命) 可支援。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-141">You can first determine whether your machine is S3 capable or CS (Connected Standby) capable.</span></span>
<span data-ttu-id="6c9fd-142">您可以開啟提升許可權的 power shell 提示字元，然後執行下列命令來完成此動作。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-142">This can be done by opening an elevated power shell prompt, and running the following command.</span></span>

```console
powercfg /a
```

<span data-ttu-id="6c9fd-143">維護小時，如果電腦已正確設定，仍然可以運作，但如果沒有，</span><span class="sxs-lookup"><span data-stu-id="6c9fd-143">Maintenance hour, if the machine is configured correctly, still works, but if it doesn't,</span></span>
  - <span data-ttu-id="6c9fd-144">查看喚醒設定的 BIOS 設定。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-144">Check your BIOS settings for Wake settings.</span></span> 
  - <span data-ttu-id="6c9fd-145">檢查電源選項中是否已啟用 [允許喚醒計時器]。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-145">Check whether Allow Wake Timer is enabled in Power Options.</span></span>
    <span data-ttu-id="6c9fd-146">移至 [**主控台**  >  **硬體和音效**]  >  **電源選項**[  >  **編輯方案設定**]  >  **變更 [advanced 電源設定**]，> 按一下 [**睡眠**  >  **允許喚醒計時器**]。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-146">Go to **Control Panel** > **Hardware and Sound** > **Power Options** > **Edit Plan Settings** > **Change advanced power settings** > click **Sleep** > **Allow Wake Timer**.</span></span>
  - <span data-ttu-id="6c9fd-147">檢查您的排程工作是否已設定如下。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-147">Check whether your scheduled task is configured with following.</span></span>
      * <span data-ttu-id="6c9fd-148">MaintenanceSettings：應以期限、期限設定工作。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-148">MaintenanceSettings: Task should be configured with Period, Deadline.</span></span>
      * <span data-ttu-id="6c9fd-149">Enabled：應啟用工作。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-149">Enabled: Task should be enabled.</span></span>
      * <span data-ttu-id="6c9fd-150">WakeToRun：應該允許工作喚醒電腦。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-150">WakeToRun: Task should be allowed to wake the machine.</span></span>
  - <span data-ttu-id="6c9fd-151">針對從 CS 喚醒的排程，電腦應具備 AOAC 能力。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-151">For scheduling wakes from CS, the machine should be AOAC capable.</span></span>
  - <span data-ttu-id="6c9fd-152">若要在 S3 電腦中排程喚醒，</span><span class="sxs-lookup"><span data-stu-id="6c9fd-152">For scheduling wakes in S3 machines,</span></span>
      * <span data-ttu-id="6c9fd-153">檢查電腦的 AC 電源是否進入 S3。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-153">Check whether the machine went into S3 on AC Power.</span></span>
      * <span data-ttu-id="6c9fd-154">系統應該在群組原則中 **啟用喚醒** 以進行維護。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-154">The system should have **Wake Enabled** in Group Policy for Maintenance.</span></span>
 
<span data-ttu-id="6c9fd-155">連線待命是 AOAC 相容系統可以輸入的系統狀態。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-155">Connected Standby is the system state that an AOAC-compliant system can enter.</span></span>

<span data-ttu-id="6c9fd-156">請參閱 [新式](/windows-hardware/design/device-experiences/modern-standby-vs-s3)待命與 s3 主題中的新式待命與 s3 之間的差異。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-156">See differences between Modern Standby and S3 in the topic [Modern Standby vs S3](/windows-hardware/design/device-experiences/modern-standby-vs-s3).</span></span>

## <a name="defining-an-automatic-maintenance-task"></a><span data-ttu-id="6c9fd-157">定義自動維護工作</span><span class="sxs-lookup"><span data-stu-id="6c9fd-157">Defining an Automatic Maintenance Task</span></span>

<span data-ttu-id="6c9fd-158">您可以將任何工作排程器工作轉換成維護工作。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-158">You can convert any Task Scheduler task to a maintenance task.</span></span> <span data-ttu-id="6c9fd-159">若要這樣做，您必須確認您的應用程式可以暫止。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-159">To do so, you must confirm that your application can be suspended.</span></span> <span data-ttu-id="6c9fd-160">然後，您必須使用新的 [**MaintenanceSettings**](taskschedulerschema-maintenancesettings-maintenancesettingstype-element.md) 和 [**AllowStartOnDemand**](taskschedulerschema-allowstartondemand-settingstype-element.md) 元素來擴充工作定義。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-160">Then, you must extend the task definition with the new [**MaintenanceSettings**](taskschedulerschema-maintenancesettings-maintenancesettingstype-element.md) and [**AllowStartOnDemand**](taskschedulerschema-allowstartondemand-settingstype-element.md) elements.</span></span>

<span data-ttu-id="6c9fd-161">建立維護工作的主要考慮是確保系統可以暫停和重新開機工作。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-161">The main concern with creating a maintenance task is ensuring that the system can suspend and restart the task.</span></span> <span data-ttu-id="6c9fd-162">系統可能會暫停維護工作多次;因此，您必須確定您的應用程式能夠儲存自己的狀態，然後在任意時間繼續。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-162">The system will likely suspend a maintenance task multiple times; therefore, you need to ensure that your application is able to save its own state, and then resume at an arbitrary time.</span></span> <span data-ttu-id="6c9fd-163">如此可確保系統不會重複執行工作的相同部分。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-163">This ensures that the system does not perform the same part of your task repeatedly.</span></span>

<span data-ttu-id="6c9fd-164">確定您的應用程式可以正常地暫停和繼續，您可以使用 **MaintenanceSettings** 和 **AllowStartOnDemand** 元素來定義排程。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-164">Once you have ensured that your application can be suspended and resumed gracefully, you can use the **MaintenanceSettings** and **AllowStartOnDemand** elements to define the schedule.</span></span> <span data-ttu-id="6c9fd-165">**MaintenanceSettings** 會根據句點、期限和獨佔性來定義。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-165">**MaintenanceSettings** is defined according to the period, deadline, and exclusivity.</span></span>

-   <span data-ttu-id="6c9fd-166">**期限** 為強制性，並定義工作應該發生的頻率。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-166">The **period** is mandatory, and defines how often the task should occur.</span></span> <span data-ttu-id="6c9fd-167">通常，這是以多天週期來定義，例如「每隔5天一次」。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-167">Usually, this is defined in terms of a multi-day cycle, such as “once every 5 days”.</span></span> <span data-ttu-id="6c9fd-168">句號必須至少為一天，這表示您不能將工作排程在一天中發生多次。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-168">A period must be at least one day, meaning that you can't schedule a task to occur multiple times in a day.</span></span>
-   <span data-ttu-id="6c9fd-169">**期限** 是選擇性的，並定義排程器在通知使用者或執行緊急維護之前，無法完成工作的時間長度。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-169">The **deadline** is optional, and defines how long the scheduler can fail to complete the task before notifying the user or performing emergency maintenance.</span></span> <span data-ttu-id="6c9fd-170">期限必須晚于期間，這表示系統必須有機會在通知使用者前至少嘗試一次該工作。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-170">The deadline must be longer than the period, meaning that the system must have the opportunity to attempt the task at least once before notifying the user.</span></span>
-   <span data-ttu-id="6c9fd-171">此外，您可以選擇性地將維護工作定義為 *獨佔*。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-171">In addition, a maintenance task can optionally be defined as *exclusive*.</span></span> <span data-ttu-id="6c9fd-172">專屬的工作會與其他維護工作分開執行。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-172">An exclusive task runs separate from other maintenance tasks.</span></span> <span data-ttu-id="6c9fd-173">通常，專屬工作是指使用大量資源的工作，例如大量的 CPU 時間或資料庫的獨佔存取權。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-173">Usually, an exclusive task is one that uses a great deal of resources, such as a large amount of CPU time, or exclusive access to a database.</span></span> <span data-ttu-id="6c9fd-174">系統會在啟動專屬工作之前完成所有非獨佔的維護工作。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-174">The system completes all non-exclusive maintenance tasks before starting an exclusive task.</span></span> <span data-ttu-id="6c9fd-175">因此，您應該只在必要時將工作宣告為獨佔。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-175">Therefore, you should declare a task as exclusive only when necessary.</span></span>

<span data-ttu-id="6c9fd-176">相反地， **AllowStartOnDemand** 只表示系統或使用者可以隨時啟動該工作。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-176">In contrast, **AllowStartOnDemand** merely indicates that the system or the user can start the task at any time.</span></span> <span data-ttu-id="6c9fd-177">這可讓系統在正常維護期間啟動工作。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-177">This allows the system to start the task during regular maintenance.</span></span> <span data-ttu-id="6c9fd-178">否則，您必須設定工作的唯一觸發程式。</span><span class="sxs-lookup"><span data-stu-id="6c9fd-178">Otherwise, you would have to set a unique trigger for the task.</span></span>
