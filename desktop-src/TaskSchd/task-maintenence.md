---
title: '自動維護 (工作排程器) '
description: 維護活動指的是有助於維護 Windows 電腦健全狀況和效能的應用程式或處理常式。
ms.assetid: 1D38341B-15AA-422F-AED1-647FCDE69E2E
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 456383eeb75c3b29bf575357d4b17d5f8a66234b
ms.sourcegitcommit: 857e701bbd35004661bb047e1f24622af9ff1dd7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/19/2020
ms.locfileid: "104383161"
---
# <a name="automatic-maintenance"></a>自動維護

維護活動指的是有助於維護 Windows 電腦健全狀況和效能的應用程式或處理常式。 維護包括讓 Windows 作業系統 (作業系統) 和應用程式保持最新狀態、檢查安全性，以及執行惡意程式碼掃描。 Windows 自動管理 (WAM) 是一組工作排程器 API 的增強功能，可讓您用來將應用程式連結到 Windows 維護排程。 具體來說，WAM 可讓您新增需要定期排程的活動，但這並沒有確切的時間需求。 相反地，WAM 會依賴作業系統來選擇適當的時間，以在一天內啟動工作。 系統會根據使用者、電腦效能和能源效率的最大影響，來選擇這些時間。

## <a name="how-scheduled-maintenance-works"></a>排程維護的運作方式

工作排程器維護工作是在電腦閒置和 AC 電源時執行的隨機工作。 維護工作的主要目標之一，就是只在電腦插入 AC 電源和閒置 (也就是當您未使用或不在機器) 的情況下，才進行維護，以將對電腦的影響降到最低。 今日維護的概念是讓機器能以最不中斷的方式處理使用者。 因此，舊樣式的維護時間 (我們將在本主題稍後的「 **自動維護 &mdash; 每日喚醒** 」一節中詳細討論此內容) 已改善，以充分利用這些閒置時間。 雖然仍可利用維護時數，但執行隨機維護對系統健康情況是較好的。

如果電腦未花費太多時間閒置和 AC 電源，您的工作可能會耗盡。 確定您的案例仍會提供值給使用者，即使它已延遲也一樣。 如果使用者正在使用電腦，則系統會延遲維護，直到稍後為止。 如果使用者返回使用電腦，系統也會暫停任何正在執行的維護工作。

系統會在下一個閒置期間重新開機暫停的維護工作。但是，系統不會暫停任何標記為「重大」的工作。 相反地，系統會讓重要的工作完成，不論使用者的動作為何。

由於排程的本質，某些排程的工作可能無法完成：或許有太多的排程事件可納入1小時的維護期間，或可能是電腦未開啟。 在這種情況下，您可以定義具有期限的工作。 期限定義為週期性時間範圍，系統至少必須成功執行一次工作。

如果工作錯過期限，則維護排程器會繼續嘗試在維護期間執行工作。 此外，排程器不會將自己限制為一般1小時的時間限制。 相反地，排程器會延長維護時段的持續時間，以便完成延遲的工作。

當系統完成工作 (即使失敗的錯誤碼) ，也會將嘗試視為成功。 成功嘗試之後，排程器會重設為一般維護排程，並在下一個期間嘗試工作。

## <a name="automatic-maintenancemdashdaily-wakeup"></a>&mdash;每日自動維護喚醒

在 Windows 7 上，維護工作會在 *維護* 期間專用執行，預設為上午3點，並可透過群組原則設定。 電腦可以從待命喚醒、執行維護工作，然後回到睡眠狀態。 此每日會話限制為每次嘗試1小時的最長持續時間。 這可讓系統每日執行維護，預設為上午3點開始。 請注意，使用者可能會藉由設定這些設定來重新排程維護的觸發時間。

隨著膝上型電腦的推出以及繁重的電池壽命，電腦不再設定為在大部分的情況下允許 S3 喚醒，通常會儘快 Doze (休眠) ，以節省電池。 為了回應這些變更，工作排程器 (> Win7) 會在到期時執行維護工作，而且電腦會處於閒置狀態和 AC 電源。

這項設定可以在主控台中設定。

開啟 **主控台**  >  **系統和安全性**  >  **安全性與維護**  >  **自動維護**。

因此，根據您的機器和工作的設定方式，可能會因為這項新的設定而無法正常執行每日喚醒行為。 您可以先判斷您的電腦是否支援 S3，或有 CS (連接的待命) 可支援。
您可以開啟提升許可權的 power shell 提示字元，然後執行下列命令來完成此動作。

```console
powercfg /a
```

維護小時，如果電腦已正確設定，仍然可以運作，但如果沒有，
  - 查看喚醒設定的 BIOS 設定。 
  - 檢查電源選項中是否已啟用 [允許喚醒計時器]。
    移至 [**主控台**  >  **硬體和音效**]  >  **電源選項**[  >  **編輯方案設定**]  >  **變更 [advanced 電源設定**]，> 按一下 [**睡眠**  >  **允許喚醒計時器**]。
  - 檢查您的排程工作是否已設定如下。
      * MaintenanceSettings：應以期限、期限設定工作。
      * Enabled：應啟用工作。
      * WakeToRun：應該允許工作喚醒電腦。
  - 針對從 CS 喚醒的排程，電腦應具備 AOAC 能力。
  - 若要在 S3 電腦中排程喚醒，
      * 檢查電腦的 AC 電源是否進入 S3。
      * 系統應該在群組原則中 **啟用喚醒** 以進行維護。
 
連線待命是 AOAC 相容系統可以輸入的系統狀態。

請參閱 [新式](/windows-hardware/design/device-experiences/modern-standby-vs-s3)待命與 s3 主題中的新式待命與 s3 之間的差異。

## <a name="defining-an-automatic-maintenance-task"></a>定義自動維護工作

您可以將任何工作排程器工作轉換成維護工作。 若要這樣做，您必須確認您的應用程式可以暫止。 然後，您必須使用新的 [**MaintenanceSettings**](taskschedulerschema-maintenancesettings-maintenancesettingstype-element.md) 和 [**AllowStartOnDemand**](taskschedulerschema-allowstartondemand-settingstype-element.md) 元素來擴充工作定義。

建立維護工作的主要考慮是確保系統可以暫停和重新開機工作。 系統可能會暫停維護工作多次;因此，您必須確定您的應用程式能夠儲存自己的狀態，然後在任意時間繼續。 如此可確保系統不會重複執行工作的相同部分。

確定您的應用程式可以正常地暫停和繼續，您可以使用 **MaintenanceSettings** 和 **AllowStartOnDemand** 元素來定義排程。 **MaintenanceSettings** 會根據句點、期限和獨佔性來定義。

-   **期限** 為強制性，並定義工作應該發生的頻率。 通常，這是以多天週期來定義，例如「每隔5天一次」。 句號必須至少為一天，這表示您不能將工作排程在一天中發生多次。
-   **期限** 是選擇性的，並定義排程器在通知使用者或執行緊急維護之前，無法完成工作的時間長度。 期限必須晚于期間，這表示系統必須有機會在通知使用者前至少嘗試一次該工作。
-   此外，您可以選擇性地將維護工作定義為 *獨佔*。 專屬的工作會與其他維護工作分開執行。 通常，專屬工作是指使用大量資源的工作，例如大量的 CPU 時間或資料庫的獨佔存取權。 系統會在啟動專屬工作之前完成所有非獨佔的維護工作。 因此，您應該只在必要時將工作宣告為獨佔。

相反地， **AllowStartOnDemand** 只表示系統或使用者可以隨時啟動該工作。 這可讓系統在正常維護期間啟動工作。 否則，您必須設定工作的唯一觸發程式。
