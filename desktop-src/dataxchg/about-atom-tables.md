---
title: 關於 Atom 資料表
description: 本節討論 atom 資料表。
ms.assetid: 12114a3e-99a4-480f-9d1a-57c1942b7382
keywords:
- 原子
- atom 資料表
- atom 名稱
- 動態資料交換 (DDE) 、原子
- DDE (動態資料交換) 、原子
- 全域 atom 資料表
- 本機 atom 資料表
- 整數原子
- 字串原子
ms.topic: article
ms.date: 08/25/2020
ms.openlocfilehash: 27f7cdb4bb2dc2fd97b4dba6909022b297df1a1d
ms.sourcegitcommit: e985e0532f0f895ae418e8c2658dac819cdae3b1
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/26/2020
ms.locfileid: "104383029"
---
# <a name="about-atom-tables"></a><span data-ttu-id="b660e-112">關於 Atom 資料表</span><span class="sxs-lookup"><span data-stu-id="b660e-112">About Atom Tables</span></span>

<span data-ttu-id="b660e-113">*Atom 資料表* 是系統定義的資料表，可儲存字串和對應的識別碼。</span><span class="sxs-lookup"><span data-stu-id="b660e-113">An *atom table* is a system-defined table that stores strings and corresponding identifiers.</span></span> <span data-ttu-id="b660e-114">應用程式會將字串放在 atom 資料表中，並接收可用於存取字串的16位整數，稱為 *atom*。</span><span class="sxs-lookup"><span data-stu-id="b660e-114">An application places a string in an atom table and receives a 16-bit integer, called an *atom*, that can be used to access the string.</span></span> <span data-ttu-id="b660e-115">放在 atom 資料表中的字串稱為 *atom 名稱*。</span><span class="sxs-lookup"><span data-stu-id="b660e-115">A string that has been placed in an atom table is called an *atom name*.</span></span>

<span data-ttu-id="b660e-116">系統會提供一些 atom 資料表。</span><span class="sxs-lookup"><span data-stu-id="b660e-116">The system provides a number of atom tables.</span></span> <span data-ttu-id="b660e-117">每個 atom 資料表都有不同的用途。</span><span class="sxs-lookup"><span data-stu-id="b660e-117">Each atom table serves a different purpose.</span></span> <span data-ttu-id="b660e-118">例如，動態資料交換 (DDE) 應用程式會使用 [全域 atom 資料表](#global-atom-table) ，與其他應用程式共用專案名稱和主題名稱字串。</span><span class="sxs-lookup"><span data-stu-id="b660e-118">For example, Dynamic Data Exchange (DDE) applications use the [global atom table](#global-atom-table) to share item-name and topic-name strings with other applications.</span></span> <span data-ttu-id="b660e-119">DDE 應用程式不會傳遞實際的字串，而是會將全域原子傳遞給其夥伴應用程式。</span><span class="sxs-lookup"><span data-stu-id="b660e-119">Rather than passing actual strings, a DDE application passes global atoms to its partner application.</span></span> <span data-ttu-id="b660e-120">夥伴會使用原子來取得 atom 資料表中的字串。</span><span class="sxs-lookup"><span data-stu-id="b660e-120">The partner uses the atoms to obtain the strings from the atom table.</span></span>

<span data-ttu-id="b660e-121">應用程式可以使用本機 atom 資料表來儲存自己的專案名稱關聯。</span><span class="sxs-lookup"><span data-stu-id="b660e-121">Applications can use local atom tables to store their own item-name associations.</span></span>

<span data-ttu-id="b660e-122">系統使用的 atom 資料表無法直接存取應用程式。</span><span class="sxs-lookup"><span data-stu-id="b660e-122">The system uses atom tables that are not directly accessible to applications.</span></span> <span data-ttu-id="b660e-123">不過，應用程式在呼叫各種函式時，會使用這些原子。</span><span class="sxs-lookup"><span data-stu-id="b660e-123">However, the application uses these atoms when calling a variety of functions.</span></span> <span data-ttu-id="b660e-124">例如，已註冊的剪貼簿格式會儲存在系統所使用的內部 atom 資料表中。</span><span class="sxs-lookup"><span data-stu-id="b660e-124">For example, registered clipboard formats are stored in an internal atom table used by the system.</span></span> <span data-ttu-id="b660e-125">應用程式會使用 [**RegisterClipboardFormat**](/windows/desktop/api/Winuser/nf-winuser-registerclipboardformata) 函式，將原子新增至這個 atom 資料表。</span><span class="sxs-lookup"><span data-stu-id="b660e-125">An application adds atoms to this atom table using the [**RegisterClipboardFormat**](/windows/desktop/api/Winuser/nf-winuser-registerclipboardformata) function.</span></span> <span data-ttu-id="b660e-126">此外，已註冊的類別會儲存在系統所使用的內部 atom 資料表中。</span><span class="sxs-lookup"><span data-stu-id="b660e-126">Also, registered classes are stored in an internal atom table used by the system.</span></span> <span data-ttu-id="b660e-127">應用程式會使用 [**RegisterClass**](/windows/desktop/api/winuser/nf-winuser-registerclassa) 或 [**RegisterClassEx**](/windows/desktop/api/winuser/nf-winuser-registerclassexa) 函數，將原子加入這個 atom 資料表中。</span><span class="sxs-lookup"><span data-stu-id="b660e-127">An application adds atoms to this atom table using the [**RegisterClass**](/windows/desktop/api/winuser/nf-winuser-registerclassa) or [**RegisterClassEx**](/windows/desktop/api/winuser/nf-winuser-registerclassexa) function.</span></span>

<span data-ttu-id="b660e-128">本節將討論下列主題。</span><span class="sxs-lookup"><span data-stu-id="b660e-128">The following topics are discussed in this section.</span></span>

-   [<span data-ttu-id="b660e-129">全域 Atom 資料表</span><span class="sxs-lookup"><span data-stu-id="b660e-129">Global Atom Table</span></span>](#global-atom-table)
-   [<span data-ttu-id="b660e-130">使用者 Atom 資料表</span><span class="sxs-lookup"><span data-stu-id="b660e-130">User Atom Table</span></span>](#user-atom-table)
-   [<span data-ttu-id="b660e-131">本機 Atom 資料表</span><span class="sxs-lookup"><span data-stu-id="b660e-131">Local Atom Tables</span></span>](#local-atom-tables)
-   [<span data-ttu-id="b660e-132">Atom 類型</span><span class="sxs-lookup"><span data-stu-id="b660e-132">Atom Types</span></span>](#atom-types)
    -   [<span data-ttu-id="b660e-133">字串原子</span><span class="sxs-lookup"><span data-stu-id="b660e-133">String Atoms</span></span>](#string-atoms)
    -   [<span data-ttu-id="b660e-134">整數原子</span><span class="sxs-lookup"><span data-stu-id="b660e-134">Integer Atoms</span></span>](#integer-atoms)
-   [<span data-ttu-id="b660e-135">Atom 建立和使用計數</span><span class="sxs-lookup"><span data-stu-id="b660e-135">Atom Creation and Usage Count</span></span>](#atom-creation-and-usage-count)
-   [<span data-ttu-id="b660e-136">Atom 資料表查詢</span><span class="sxs-lookup"><span data-stu-id="b660e-136">Atom-Table Queries</span></span>](#atom-table-queries)
-   [<span data-ttu-id="b660e-137">Atom 字串格式</span><span class="sxs-lookup"><span data-stu-id="b660e-137">Atom String Formats</span></span>](#atom-string-formats)

## <a name="global-atom-table"></a><span data-ttu-id="b660e-138">全域 Atom 資料表</span><span class="sxs-lookup"><span data-stu-id="b660e-138">Global Atom Table</span></span>

<span data-ttu-id="b660e-139">全域 atom 資料表可供所有應用程式使用。</span><span class="sxs-lookup"><span data-stu-id="b660e-139">The global atom table is available to all applications.</span></span> <span data-ttu-id="b660e-140">當應用程式將字串放入全域 atom 資料表時，系統會產生在整個系統中都是唯一的 atom。</span><span class="sxs-lookup"><span data-stu-id="b660e-140">When an application places a string in the global atom table, the system generates an atom that is unique throughout the system.</span></span> <span data-ttu-id="b660e-141">任何具有 atom 的應用程式都可以藉由查詢全域 atom 資料表來取得它所識別的字串。</span><span class="sxs-lookup"><span data-stu-id="b660e-141">Any application that has the atom can obtain the string it identifies by querying the global atom table.</span></span>

<span data-ttu-id="b660e-142">定義私人 DDE 資料格式以與其他應用程式共用資料的應用程式，應該將格式名稱放置在全域 atom 資料表中。</span><span class="sxs-lookup"><span data-stu-id="b660e-142">An application that defines a private DDE-data format for sharing data with other applications should place the format name in the global atom table.</span></span> <span data-ttu-id="b660e-143">這項技術可避免與系統或其他應用程式所定義的格式名稱相衝突，並讓識別碼 (原子) ，以供其他應用程式使用的訊息或格式使用。</span><span class="sxs-lookup"><span data-stu-id="b660e-143">This technique prevents conflicts with the names of formats defined by the system or by other applications, and makes the identifiers (atoms) for the messages or formats available to the other applications.</span></span>

## <a name="user-atom-table"></a><span data-ttu-id="b660e-144">使用者 Atom 資料表</span><span class="sxs-lookup"><span data-stu-id="b660e-144">User Atom Table</span></span>

<span data-ttu-id="b660e-145">除了全域 atom 資料表之外，使用者 atom 資料表也是另一個系統 atom 資料表，也會在所有進程間共用。</span><span class="sxs-lookup"><span data-stu-id="b660e-145">In addition to the global atom table, the user atom table is another system atom table that is also shared across all processes.</span></span> <span data-ttu-id="b660e-146">使用者 atom 資料表用於 win32k 內部的少數案例;例如，windows 模組名稱、win32k 中已知的字串、OLE 格式等等。雖然應用程式不會直接與使用者 atom 資料表互動，但是它們會呼叫數個 Api （例如 [RegisterClass](/windows/win32/api/winuser/nf-winuser-registerclassexa)、 [RegisterWindowMessage](/windows/win32/api/winuser/nf-winuser-registerwindowmessagea)和 [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata)），以將專案加入至使用者 atom 資料表。</span><span class="sxs-lookup"><span data-stu-id="b660e-146">The user atom table is used for a small number of scenarios internal to win32k; for example, windows module names, well known strings in win32k, OLE formats, etc. Although applications do not interact with the user atom table directly, they call several APIs—such as [RegisterClass](/windows/win32/api/winuser/nf-winuser-registerclassexa), [RegisterWindowMessage](/windows/win32/api/winuser/nf-winuser-registerwindowmessagea), and [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata)—that add entries to the user atom table.</span></span> <span data-ttu-id="b660e-147">新增的專案 `RegisterClass` 可以由刪除 `UnregisterClass` 。</span><span class="sxs-lookup"><span data-stu-id="b660e-147">The entries added by `RegisterClass` can be deleted by `UnregisterClass`.</span></span> <span data-ttu-id="b660e-148">不過，在 `RegisterWindowMessage` `RegisterClipboardFormat` 會話結束之前，不會刪除和所新增的專案。</span><span class="sxs-lookup"><span data-stu-id="b660e-148">However, the entries added by `RegisterWindowMessage` and `RegisterClipboardFormat` do not get deleted until the session ends.</span></span> <span data-ttu-id="b660e-149">如果使用者 atom 資料表已沒有空間，而且傳入的字串尚未存在於資料表中，則呼叫會失敗。</span><span class="sxs-lookup"><span data-stu-id="b660e-149">If the user atom table has no more space and the string being passed in is not already in the table, the call will fail.</span></span> 

### <a name="atom-table-size"></a><span data-ttu-id="b660e-150">Atom 資料表大小</span><span class="sxs-lookup"><span data-stu-id="b660e-150">Atom Table Size</span></span>
 
<span data-ttu-id="b660e-151">許多重要的 Api （包括 [CreateWindow](/windows/win32/api/winuser/nf-winuser-createwindowa)）都依賴使用者原子。</span><span class="sxs-lookup"><span data-stu-id="b660e-151">Many critical APIs, including [CreateWindow](/windows/win32/api/winuser/nf-winuser-createwindowa), rely on user atoms.</span></span> <span data-ttu-id="b660e-152">因此，使用者 atom 資料表中的空間耗盡會導致嚴重的問題;例如，所有的應用程式可能無法啟動。</span><span class="sxs-lookup"><span data-stu-id="b660e-152">Therefore, space exhaustion in the user atom table will result in serious issues; for example, all applications may fail to launch.</span></span> <span data-ttu-id="b660e-153">以下是一些建議，以確保您的應用程式有效率地利用 atom 資料表，並保留應用程式和系統的可靠性和效能：</span><span class="sxs-lookup"><span data-stu-id="b660e-153">Here are some recommendations to ensure your application utilizes atom tables efficiently and preserves the reliability and performance of the application and system:</span></span>  

1. <span data-ttu-id="b660e-154">您應該限制應用程式使用者 atom 資料表的使用方式。</span><span class="sxs-lookup"><span data-stu-id="b660e-154">You should limit your app's usage of the user atom table.</span></span> <span data-ttu-id="b660e-155">使用、或之類的 Api 來儲存唯一字串 `RegisterClass` `RegisterWindowMessage` ，會 `RegisterClipboardFormat` 佔用使用者 atom 資料表中的空間，供其他應用程式用來使用字串來註冊視窗類別。</span><span class="sxs-lookup"><span data-stu-id="b660e-155">Storing unique strings using APIs like `RegisterClass`, `RegisterWindowMessage`, or `RegisterClipboardFormat` takes space in the user atom table, which is used globally by other apps to register window classes using strings.</span></span> <span data-ttu-id="b660e-156">如果有可能的話，您應該使用[AddAtom](/windows/desktop/api/Winbase/nf-winbase-addatomw) / [DeleteAtom](/windows/desktop/api/Winbase/nf-winbase-deleteatom)將字串儲存在本機 atom 資料表中， [](/windows/desktop/api/Winbase/nf-winbase-globaladdatoma) / 如果需要跨進程的原子，則使用 GlobalAddAtom[GlobalDeleteAtom](/windows/desktop/api/Winbase/nf-winbase-globaldeleteatom) 。</span><span class="sxs-lookup"><span data-stu-id="b660e-156">If at all possible, you should use [AddAtom](/windows/desktop/api/Winbase/nf-winbase-addatomw)/[DeleteAtom](/windows/desktop/api/Winbase/nf-winbase-deleteatom) to store strings in a local atom table, or  [GlobalAddAtom](/windows/desktop/api/Winbase/nf-winbase-globaladdatoma)/[GlobalDeleteAtom](/windows/desktop/api/Winbase/nf-winbase-globaldeleteatom) if the atoms are needed cross-process.</span></span>

1. <span data-ttu-id="b660e-157">如果有關于應用程式造成使用者 atom 資料表問題的考慮，您可以連接核心偵錯工具並中斷 () 呼叫的程式，以調查根本原因 `UserAddAtomEx` `bae1 win32kbase!UserAddAtomEx /p <eprocess> "kc10;g"` 。</span><span class="sxs-lookup"><span data-stu-id="b660e-157">If there is concern about the application causing user atom table issues, you can investigate the root cause by connecting the kernel debugger and breaking into the process on calls to `UserAddAtomEx` (`bae1 win32kbase!UserAddAtomEx /p <eprocess> "kc10;g"`).</span></span> <span data-ttu-id="b660e-158">查看 `user32!` 呼叫堆疊以查看正在呼叫的 API。</span><span class="sxs-lookup"><span data-stu-id="b660e-158">Look for `user32!` on the callstack to see which API is being called.</span></span> <span data-ttu-id="b660e-159">方法類似于全域 atom 資料表問題偵測，其中說明了 [識別全域 Atom 資料表](/archive/blogs/ntdebugging/identifying-global-atom-table-leaks)流失的問題。</span><span class="sxs-lookup"><span data-stu-id="b660e-159">The methodology is similar to the global atom table issue detection explained in [Identifying Global Atom Table Leaks](/archive/blogs/ntdebugging/identifying-global-atom-table-leaks).</span></span> <span data-ttu-id="b660e-160">傾印使用者 atom 資料表內容的另一種方式，是在可能的原子範圍（從0xC000 到0xFFFF）呼叫 [GetClipboardFormatName](/windows/win32/api/winuser/nf-winuser-getclipboardformatnamea) 。</span><span class="sxs-lookup"><span data-stu-id="b660e-160">Another way to dump the contents of the user atom table is by calling [GetClipboardFormatName](/windows/win32/api/winuser/nf-winuser-getclipboardformatnamea) over the range of possible atoms from 0xC000 to 0xFFFF.</span></span> <span data-ttu-id="b660e-161">如果應用程式正在執行時，總 atom 計數會穩定出現，或在應用程式關閉時不會回到基準，就會發生問題。</span><span class="sxs-lookup"><span data-stu-id="b660e-161">If the total atom count steadily goes up while the application is running or does not return to baseline when the app is closed, there is a problem.</span></span>

## <a name="local-atom-tables"></a><span data-ttu-id="b660e-162">本機 Atom 資料表</span><span class="sxs-lookup"><span data-stu-id="b660e-162">Local Atom Tables</span></span>

<span data-ttu-id="b660e-163">應用程式可以使用本機 atom 資料表，有效率地管理只在應用程式中使用的大量字串。</span><span class="sxs-lookup"><span data-stu-id="b660e-163">An application can use a local atom table to efficiently manage a large number of strings used only within the application.</span></span> <span data-ttu-id="b660e-164">這些字串和相關聯的原子只適用于建立資料表的應用程式。</span><span class="sxs-lookup"><span data-stu-id="b660e-164">These strings, and the associated atoms, are available only to the application that created the table.</span></span>

<span data-ttu-id="b660e-165">在許多結構中需要相同字串的應用程式，可以使用本機 atom 資料表來減少記憶體使用量。</span><span class="sxs-lookup"><span data-stu-id="b660e-165">An application requiring the same string in a number of structures can reduce memory usage by using a local atom table.</span></span> <span data-ttu-id="b660e-166">應用程式可以將字串放在 atom 資料表中，並將產生的 atom 包含在結構中，而不是將字串複製到每一個結構中。</span><span class="sxs-lookup"><span data-stu-id="b660e-166">Rather than copying the string into each structure, the application can place the string in the atom table and include the resulting atom in the structures.</span></span> <span data-ttu-id="b660e-167">如此一來，字串只會在記憶體中出現一次，但可以在應用程式中使用多次。</span><span class="sxs-lookup"><span data-stu-id="b660e-167">In this way, a string appears only once in memory but can be used many times in the application.</span></span>

<span data-ttu-id="b660e-168">應用程式也可以使用本機 atom 資料表來節省搜尋特定字串的時間。</span><span class="sxs-lookup"><span data-stu-id="b660e-168">Applications can also use local atom tables to save time when searching for a particular string.</span></span> <span data-ttu-id="b660e-169">若要執行搜尋，應用程式只需要將搜尋字串放在 atom 資料表中，並將產生的 atom 與相關結構中的原子進行比較。</span><span class="sxs-lookup"><span data-stu-id="b660e-169">To perform a search, an application need only place the search string in the atom table and compare the resulting atom with the atoms in the relevant structures.</span></span> <span data-ttu-id="b660e-170">比較原子通常比比較字串更快。</span><span class="sxs-lookup"><span data-stu-id="b660e-170">Comparing atoms is typically faster than comparing strings.</span></span>

<span data-ttu-id="b660e-171">Atom 資料表會實作為雜湊表。</span><span class="sxs-lookup"><span data-stu-id="b660e-171">Atom tables are implemented as hash tables.</span></span> <span data-ttu-id="b660e-172">根據預設，本機 atom 資料表會使用37值區作為雜湊表。</span><span class="sxs-lookup"><span data-stu-id="b660e-172">By default, a local atom table uses 37 buckets for its hash table.</span></span> <span data-ttu-id="b660e-173">不過，您可以變更呼叫 [**InitAtomTable**](/windows/desktop/api/Winbase/nf-winbase-initatomtable) 函式所使用的 bucket 數目。</span><span class="sxs-lookup"><span data-stu-id="b660e-173">However, you can change the number of buckets used by calling the [**InitAtomTable**](/windows/desktop/api/Winbase/nf-winbase-initatomtable) function.</span></span> <span data-ttu-id="b660e-174">但是，如果應用程式呼叫 **InitAtomTable**，則在呼叫任何其他 atom 管理函式之前，它必須先這麼做。</span><span class="sxs-lookup"><span data-stu-id="b660e-174">If the application calls **InitAtomTable**, however, it must do so before calling any other atom-management functions.</span></span>

## <a name="atom-types"></a><span data-ttu-id="b660e-175">Atom 類型</span><span class="sxs-lookup"><span data-stu-id="b660e-175">Atom Types</span></span>

<span data-ttu-id="b660e-176">應用程式可以建立兩種類型的原子：字串原子和整數原子。</span><span class="sxs-lookup"><span data-stu-id="b660e-176">Applications can create two types of atoms: string atoms and integer atoms.</span></span> <span data-ttu-id="b660e-177">整數原子和字串原子的值不會重迭，因此這兩種類型的原子都可在相同的程式碼區塊中使用。</span><span class="sxs-lookup"><span data-stu-id="b660e-177">The values of integer atoms and string atoms do not overlap, so both types of atoms can be used in the same block of code.</span></span>

<span data-ttu-id="b660e-178">有幾個函式接受字串或原子作為參數。</span><span class="sxs-lookup"><span data-stu-id="b660e-178">Several functions accept either strings or atoms as parameters.</span></span> <span data-ttu-id="b660e-179">將 atom 傳遞給這些函式時，應用程式可以使用 [**MAKEINTATOM**](/windows/desktop/api/Winbase/nf-winbase-makeintatom) 宏將 atom 轉換成可供函式使用的表單。</span><span class="sxs-lookup"><span data-stu-id="b660e-179">When passing an atom to these functions, an application can use the [**MAKEINTATOM**](/windows/desktop/api/Winbase/nf-winbase-makeintatom) macro to convert the atom into a form that can be used by the function.</span></span>

<span data-ttu-id="b660e-180">下列各節說明 atom 類型。</span><span class="sxs-lookup"><span data-stu-id="b660e-180">The following sections describe atom types.</span></span>

-   [<span data-ttu-id="b660e-181">字串原子</span><span class="sxs-lookup"><span data-stu-id="b660e-181">String Atoms</span></span>](#string-atoms)
-   [<span data-ttu-id="b660e-182">整數原子</span><span class="sxs-lookup"><span data-stu-id="b660e-182">Integer Atoms</span></span>](#integer-atoms)

### <a name="string-atoms"></a><span data-ttu-id="b660e-183">字串原子</span><span class="sxs-lookup"><span data-stu-id="b660e-183">String Atoms</span></span>

<span data-ttu-id="b660e-184">當應用程式將以 null 結束的字串傳遞至 [**GlobalAddAtom**](/windows/desktop/api/Winbase/nf-winbase-globaladdatoma)、 [**AddAtom**](/windows/desktop/api/Winbase/nf-winbase-addatomw)、 [**GlobalFindAtom**](/windows/desktop/api/Winbase/nf-winbase-globalfindatoma)和 [**FindAtom**](/windows/desktop/api/Winbase/nf-winbase-findatoma) 函式時，它們會接收 *字串原子* (16 位整數) 傳回。</span><span class="sxs-lookup"><span data-stu-id="b660e-184">When applications pass null-terminated strings to the [**GlobalAddAtom**](/windows/desktop/api/Winbase/nf-winbase-globaladdatoma), [**AddAtom**](/windows/desktop/api/Winbase/nf-winbase-addatomw), [**GlobalFindAtom**](/windows/desktop/api/Winbase/nf-winbase-globalfindatoma), and [**FindAtom**](/windows/desktop/api/Winbase/nf-winbase-findatoma) functions, they receive *string atoms* (16-bit integers) in return.</span></span> <span data-ttu-id="b660e-185">字串原子具有下列屬性：</span><span class="sxs-lookup"><span data-stu-id="b660e-185">String atoms have the following properties:</span></span>

-   <span data-ttu-id="b660e-186">字串原子的值位於範圍 0xC000 (MAXINTATOM) 到0xFFFF 之間。</span><span class="sxs-lookup"><span data-stu-id="b660e-186">The values of string atoms are in the range 0xC000 (MAXINTATOM) through 0xFFFF.</span></span>
-   <span data-ttu-id="b660e-187">在 atom 資料表中搜尋 atom 名稱時，大小寫並不重要。</span><span class="sxs-lookup"><span data-stu-id="b660e-187">Case is not significant in searches for an atom name in an atom table.</span></span> <span data-ttu-id="b660e-188">此外，搜尋作業中的整個字串必須相符;不會執行任何符合的子字串。</span><span class="sxs-lookup"><span data-stu-id="b660e-188">Also, the entire string must match in a search operation; no substring matching is performed.</span></span>
-   <span data-ttu-id="b660e-189">與字串 atom 相關聯的字串不能超過255個位元組大小。</span><span class="sxs-lookup"><span data-stu-id="b660e-189">The string associated with a string atom can be no more than 255 bytes in size.</span></span> <span data-ttu-id="b660e-190">這項限制適用于所有 atom 函數。</span><span class="sxs-lookup"><span data-stu-id="b660e-190">This limitation applies to all atom functions.</span></span>
-   <span data-ttu-id="b660e-191">*參考計數* 會與每個 atom 名稱相關聯。</span><span class="sxs-lookup"><span data-stu-id="b660e-191">A *reference count* is associated with each atom name.</span></span> <span data-ttu-id="b660e-192">每次將 atom 名稱加入資料表時，計數就會遞增，並在每次從 atom 名稱中刪除 atom 名稱時減少。</span><span class="sxs-lookup"><span data-stu-id="b660e-192">The count is incremented each time the atom name is added to the table and decremented each time the atom name is deleted from it.</span></span> <span data-ttu-id="b660e-193">這可防止相同字串 atom 的不同使用者終結彼此的 atom 名稱。</span><span class="sxs-lookup"><span data-stu-id="b660e-193">This prevents different users of the same string atom from destroying each other's atom names.</span></span> <span data-ttu-id="b660e-194">當 atom 名稱的參考計數等於零時，系統會從資料表中移除 atom 和 atom 名稱。</span><span class="sxs-lookup"><span data-stu-id="b660e-194">When the reference count for an atom name equals zero, the system removes the atom and the atom name from the table.</span></span>

### <a name="integer-atoms"></a><span data-ttu-id="b660e-195">整數原子</span><span class="sxs-lookup"><span data-stu-id="b660e-195">Integer Atoms</span></span>

<span data-ttu-id="b660e-196">整數原子與字串原子的差異有下列幾種：</span><span class="sxs-lookup"><span data-stu-id="b660e-196">Integer atoms differ from string atoms in the following ways:</span></span>

-   <span data-ttu-id="b660e-197">整數原子的值位於範圍0x0001 到 0xBFFF (**MAXINTATOM**– 1) 。</span><span class="sxs-lookup"><span data-stu-id="b660e-197">The values of integer atoms are in the range 0x0001 through 0xBFFF (**MAXINTATOM**– 1).</span></span>
-   <span data-ttu-id="b660e-198">整數 atom 的字串表示是 \# *dddd*，其中以 *dddd* 表示的值是十進位數。</span><span class="sxs-lookup"><span data-stu-id="b660e-198">The string representation of an integer atom is \#*dddd*, where the values represented by *dddd* are decimal digits.</span></span> <span data-ttu-id="b660e-199">系統會忽略前置零。</span><span class="sxs-lookup"><span data-stu-id="b660e-199">Leading zeros are ignored.</span></span>
-   <span data-ttu-id="b660e-200">沒有與整數 atom 相關聯的參考計數或儲存體額外負荷。</span><span class="sxs-lookup"><span data-stu-id="b660e-200">There is no reference count or storage overhead associated with an integer atom.</span></span>

## <a name="atom-creation-and-usage-count"></a><span data-ttu-id="b660e-201">Atom 建立和使用計數</span><span class="sxs-lookup"><span data-stu-id="b660e-201">Atom Creation and Usage Count</span></span>

<span data-ttu-id="b660e-202">應用程式會藉由呼叫 [**AddAtom**](/windows/desktop/api/Winbase/nf-winbase-addatomw) 函數來建立本機 atom;它會藉由呼叫 [**GlobalAddAtom**](/windows/desktop/api/Winbase/nf-winbase-globaladdatoma) 函數來建立全域 atom。</span><span class="sxs-lookup"><span data-stu-id="b660e-202">An application creates a local atom by calling the [**AddAtom**](/windows/desktop/api/Winbase/nf-winbase-addatomw) function; it creates a global atom by calling the [**GlobalAddAtom**](/windows/desktop/api/Winbase/nf-winbase-globaladdatoma) function.</span></span> <span data-ttu-id="b660e-203">這兩個函式都需要一個指向字串的指標。</span><span class="sxs-lookup"><span data-stu-id="b660e-203">Both functions require a pointer to a string.</span></span> <span data-ttu-id="b660e-204">系統會在適當的 atom 資料表中搜尋字串，並將對應的 atom 傳回給應用程式。</span><span class="sxs-lookup"><span data-stu-id="b660e-204">The system searches the appropriate atom table for the string and returns the corresponding atom to the application.</span></span> <span data-ttu-id="b660e-205">在字串 atom 的案例中，如果字串已經存在於 atom 資料表中，系統會在此程式期間遞增字串的參考計數。</span><span class="sxs-lookup"><span data-stu-id="b660e-205">In the case of a string atom, if the string already resides in the atom table, the system increments the reference count for the string during this process.</span></span>

<span data-ttu-id="b660e-206">新增相同 atom 名稱的重複呼叫會傳回相同的 atom。</span><span class="sxs-lookup"><span data-stu-id="b660e-206">Repeated calls to add the same atom name return the same atom.</span></span> <span data-ttu-id="b660e-207">如果在呼叫 [**AddAtom**](/windows/desktop/api/Winbase/nf-winbase-addatomw) 時，資料表中沒有 atom 名稱，atom 名稱就會加入至資料表，並傳回新的 atom。</span><span class="sxs-lookup"><span data-stu-id="b660e-207">If the atom name does not exist in the table when [**AddAtom**](/windows/desktop/api/Winbase/nf-winbase-addatomw) is called, the atom name is added to the table and a new atom is returned.</span></span> <span data-ttu-id="b660e-208">如果它是字串 atom，其參考計數也會設定為1。</span><span class="sxs-lookup"><span data-stu-id="b660e-208">If it is a string atom, its reference count is also set to one.</span></span>

<span data-ttu-id="b660e-209">當應用程式不再需要使用本機 atom 時，應呼叫 [**DeleteAtom**](/windows/desktop/api/Winbase/nf-winbase-deleteatom) 函式;它應該會在不再需要全域 atom 時呼叫 [**GlobalDeleteAtom**](/windows/desktop/api/Winbase/nf-winbase-globaldeleteatom) 函數。</span><span class="sxs-lookup"><span data-stu-id="b660e-209">An application should call the [**DeleteAtom**](/windows/desktop/api/Winbase/nf-winbase-deleteatom) function when it no longer needs to use a local atom; it should call the [**GlobalDeleteAtom**](/windows/desktop/api/Winbase/nf-winbase-globaldeleteatom) function when it no longer needs a global atom.</span></span> <span data-ttu-id="b660e-210">在字串 atom 的案例中，這兩個函式會將對應 atom 的參考計數減少一。</span><span class="sxs-lookup"><span data-stu-id="b660e-210">In the case of a string atom, either of these functions reduces the reference count of the corresponding atom by one.</span></span> <span data-ttu-id="b660e-211">當參考計數到達零時，系統會從資料表中刪除 atom 名稱。</span><span class="sxs-lookup"><span data-stu-id="b660e-211">When the reference count reaches zero, the system deletes the atom name from the table.</span></span>

<span data-ttu-id="b660e-212">字串 atom 的 atom 名稱會保留在全域 atom 資料表中，前提是它的參考計數大於零，即使在將它放置在資料表中的應用程式終止之後也是如此。</span><span class="sxs-lookup"><span data-stu-id="b660e-212">The atom name of a string atom remains in the global atom table as long as its reference count is greater than zero, even after the application that placed it in the table terminates.</span></span> <span data-ttu-id="b660e-213">當相關聯的應用程式終止時，無論資料表中原子的參考計數為何，都會終結本機 atom 資料表。</span><span class="sxs-lookup"><span data-stu-id="b660e-213">A local atom table is destroyed when the associated application terminates, regardless of the reference counts of the atoms in the table.</span></span>

## <a name="atom-table-queries"></a><span data-ttu-id="b660e-214">Atom-Table 查詢</span><span class="sxs-lookup"><span data-stu-id="b660e-214">Atom-Table Queries</span></span>

<span data-ttu-id="b660e-215">應用程式可以使用 [**FindAtom**](/windows/desktop/api/Winbase/nf-winbase-findatoma) 或 [**GlobalFindAtom**](/windows/desktop/api/Winbase/nf-winbase-globalfindatoma) 函數，判斷特定字串是否已存在於 atom 資料表中。</span><span class="sxs-lookup"><span data-stu-id="b660e-215">An application can determine whether a particular string is already in an atom table by using the [**FindAtom**](/windows/desktop/api/Winbase/nf-winbase-findatoma) or [**GlobalFindAtom**](/windows/desktop/api/Winbase/nf-winbase-globalfindatoma) function.</span></span> <span data-ttu-id="b660e-216">這些函式會在 atom 資料表中搜尋指定的字串，如果有字串，則會傳回對應的 atom。</span><span class="sxs-lookup"><span data-stu-id="b660e-216">These functions search an atom table for the specified string and, if the string is there, return the corresponding atom.</span></span>

<span data-ttu-id="b660e-217">應用程式可以使用 [**GetAtomName**](/windows/desktop/api/Winbase/nf-winbase-getatomnamea) 或 [**GlobalGetAtomName**](/windows/desktop/api/Winbase/nf-winbase-globalgetatomnamea) 函數，從 atom 資料表中取出 atom 名稱字串，前提是應用程式具有對應至所要搜尋之字串的 atom。</span><span class="sxs-lookup"><span data-stu-id="b660e-217">An application can use the [**GetAtomName**](/windows/desktop/api/Winbase/nf-winbase-getatomnamea) or [**GlobalGetAtomName**](/windows/desktop/api/Winbase/nf-winbase-globalgetatomnamea) function to retrieve an atom-name string from an atom table, provided the application has the atom corresponding to the string being sought.</span></span> <span data-ttu-id="b660e-218">這兩個函式會將指定之 atom 的 atom 名稱字串複製到緩衝區，並傳回所複製字串的長度。</span><span class="sxs-lookup"><span data-stu-id="b660e-218">Both functions copy the atom-name string of the specified atom to a buffer and return the length of the string that was copied.</span></span> <span data-ttu-id="b660e-219">**GetAtomName** 會從本機 atom 資料表抓取 atom 名稱字串，而 **GlobalGetAtomName** 會從全域 atom 資料表抓取 atom 名稱字串。</span><span class="sxs-lookup"><span data-stu-id="b660e-219">**GetAtomName** retrieves an atom-name string from a local atom table, and **GlobalGetAtomName** retrieves an atom-name string from the global atom table.</span></span>

## <a name="atom-string-formats"></a><span data-ttu-id="b660e-220">Atom 字串格式</span><span class="sxs-lookup"><span data-stu-id="b660e-220">Atom String Formats</span></span>

<span data-ttu-id="b660e-221">[**AddAtom**](/windows/desktop/api/Winbase/nf-winbase-addatomw)、 [**GlobalAddAtom**](/windows/desktop/api/Winbase/nf-winbase-globaladdatoma)、 [**FindAtom**](/windows/desktop/api/Winbase/nf-winbase-findatoma)和 [**GlobalFindAtom**](/windows/desktop/api/Winbase/nf-winbase-globalfindatoma)函式會採用以 null 終止之字串的指標。</span><span class="sxs-lookup"><span data-stu-id="b660e-221">The [**AddAtom**](/windows/desktop/api/Winbase/nf-winbase-addatomw), [**GlobalAddAtom**](/windows/desktop/api/Winbase/nf-winbase-globaladdatoma), [**FindAtom**](/windows/desktop/api/Winbase/nf-winbase-findatoma), and [**GlobalFindAtom**](/windows/desktop/api/Winbase/nf-winbase-globalfindatoma) functions take a pointer to a null-terminated string.</span></span> <span data-ttu-id="b660e-222">應用程式可以使用下列其中一種方式來指定此指標。</span><span class="sxs-lookup"><span data-stu-id="b660e-222">An application can specify this pointer in one of the following ways.</span></span>



|                    |                                                                                                    |
|--------------------|----------------------------------------------------------------------------------------------------|
| <span data-ttu-id="b660e-223">\#*dddd*</span><span class="sxs-lookup"><span data-stu-id="b660e-223">\#*dddd*</span></span>           | <span data-ttu-id="b660e-224">指定為十進位字串的整數。</span><span class="sxs-lookup"><span data-stu-id="b660e-224">An integer specified as a decimal string.</span></span> <span data-ttu-id="b660e-225">用來建立或尋找整數 atom。</span><span class="sxs-lookup"><span data-stu-id="b660e-225">Used to create or find an integer atom.</span></span>                  |
| <span data-ttu-id="b660e-226">*字串 atom 名稱*</span><span class="sxs-lookup"><span data-stu-id="b660e-226">*string atom name*</span></span> | <span data-ttu-id="b660e-227">字串 atom 名稱。</span><span class="sxs-lookup"><span data-stu-id="b660e-227">A string atom name.</span></span> <span data-ttu-id="b660e-228">用來將字串 atom 名稱加入 atom 資料表中，並接收傳回的 atom。</span><span class="sxs-lookup"><span data-stu-id="b660e-228">Used to add a string atom name to an atom table and receive an atom in return.</span></span> |



 

 

 
