---
title: '交易管理 (資料交換) '
description: 本主題討論用戶端如何傳送交易，以從伺服器取得資料和服務。
ms.assetid: 2d08ffa3-cbd7-4806-b94f-979938322c38
keywords:
- 'Windows 消費者介面，動態資料交換 (DDE) '
- 動態資料交換 (DDE) ，交易
- DDE (動態資料交換) ，交易
- '資料交換、動態資料交換 (DDE) '
- 'Windows 消費者介面、動態資料交換管理程式庫 (DDEML) '
- 動態資料交換管理程式庫 (DDEML) ，交易
- DDEML (動態資料交換管理程式庫) ，交易
- '資料交換、動態資料交換管理程式庫 (DDEML) '
- 動態資料交換 (DDE) ，要求交易
- DDE (動態資料交換) ，要求交易
- 動態資料交換管理程式庫 (DDEML) ，要求交易
- DDEML (動態資料交換管理程式庫) ，要求交易
- 動態資料交換 (DDE) ，請進行交易
- DDE (動態資料交換) ，進行交易
- 動態資料交換管理程式庫 (DDEML) ，請進行交易
- DDEML (動態資料交換管理程式庫) ，進行交易
- 動態資料交換 (DDE) ，建議交易
- DDE (動態資料交換) ，建議交易
- 動態資料交換管理程式庫 (DDEML) ，建議交易
- DDEML (動態資料交換管理程式庫) ，建議交易
- 動態資料交換 (DDE) ，執行交易
- DDE (動態資料交換) ，執行交易
- 動態資料交換管理程式庫 (DDEML) ，執行交易
- DDEML (動態資料交換管理程式庫) ，執行交易
- 動態資料交換 (DDE) ，同步交易
- DDE (動態資料交換) ，同步交易
- 動態資料交換管理程式庫 (DDEML) ，同步交易
- DDEML (動態資料交換管理程式庫) ，同步交易
- 動態資料交換 (DDE) 、非同步交易
- DDE (動態資料交換) 、非同步交易
- 動態資料交換管理程式庫 (DDEML) 、非同步交易
- DDEML (動態資料交換管理程式庫) 、非同步交易
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 570aa48b4dcdbb31855b3e1b15a091908feb2ba4
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/20/2020
ms.locfileid: "104023617"
---
# <a name="transaction-management-data-exchange"></a><span data-ttu-id="c4115-135">交易管理 (資料交換) </span><span class="sxs-lookup"><span data-stu-id="c4115-135">Transaction Management (Data Exchange)</span></span>

<span data-ttu-id="c4115-136">建立與伺服器的對話之後，用戶端就可以傳送交易來取得伺服器的資料和服務。</span><span class="sxs-lookup"><span data-stu-id="c4115-136">After establishing a conversation with a server, a client can send transactions to obtain data and services from the server.</span></span>

<span data-ttu-id="c4115-137">下列主題描述用戶端可以用來與伺服器互動的交易類型。</span><span class="sxs-lookup"><span data-stu-id="c4115-137">The following topics describe the types of transactions that clients can use to interact with a server.</span></span>

-   [<span data-ttu-id="c4115-138">要求交易</span><span class="sxs-lookup"><span data-stu-id="c4115-138">Request Transaction</span></span>](#request-transaction)
-   [<span data-ttu-id="c4115-139">進行交易</span><span class="sxs-lookup"><span data-stu-id="c4115-139">Poke Transaction</span></span>](#poke-transaction)
-   [<span data-ttu-id="c4115-140">建議交易</span><span class="sxs-lookup"><span data-stu-id="c4115-140">Advise Transaction</span></span>](#advise-transaction)
-   [<span data-ttu-id="c4115-141">執行交易</span><span class="sxs-lookup"><span data-stu-id="c4115-141">Execute Transaction</span></span>](#execute-transaction)
-   [<span data-ttu-id="c4115-142">同步和非同步交易</span><span class="sxs-lookup"><span data-stu-id="c4115-142">Synchronous and Asynchronous Transactions</span></span>](#synchronous-and-asynchronous-transactions)
-   [<span data-ttu-id="c4115-143">交易控制</span><span class="sxs-lookup"><span data-stu-id="c4115-143">Transaction Control</span></span>](#transaction-control)
-   [<span data-ttu-id="c4115-144">交易類別</span><span class="sxs-lookup"><span data-stu-id="c4115-144">Transaction Classes</span></span>](#transaction-classes)
-   [<span data-ttu-id="c4115-145">交易類型</span><span class="sxs-lookup"><span data-stu-id="c4115-145">Transaction Types</span></span>](#transaction-types)

## <a name="request-transaction"></a><span data-ttu-id="c4115-146">要求交易</span><span class="sxs-lookup"><span data-stu-id="c4115-146">Request Transaction</span></span>

<span data-ttu-id="c4115-147">用戶端應用程式可以使用 [**XTYP \_ 要求**](xtyp-request.md) 交易來要求伺服器應用程式中的資料項目。</span><span class="sxs-lookup"><span data-stu-id="c4115-147">A client application can use the [**XTYP\_REQUEST**](xtyp-request.md) transaction to request a data item from a server application.</span></span> <span data-ttu-id="c4115-148">用戶端會呼叫 [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction) 函式，並將 **XTYP \_ 要求** 指定為交易類型並指定應用程式所需的資料項目。</span><span class="sxs-lookup"><span data-stu-id="c4115-148">The client calls the [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction) function, specifying **XTYP\_REQUEST** as the transaction type and specifying the data item the application needs.</span></span>

<span data-ttu-id="c4115-149">動態資料交換管理程式庫 (DDEML) 會將 [**XTYP \_ 要求**](xtyp-request.md) 交易傳遞至伺服器，並指定用戶端所要求的主題名稱、專案名稱和資料格式。</span><span class="sxs-lookup"><span data-stu-id="c4115-149">The Dynamic Data Exchange Management Library (DDEML) passes the [**XTYP\_REQUEST**](xtyp-request.md) transaction to the server, specifying the topic name, item name, and data format requested by the client.</span></span> <span data-ttu-id="c4115-150">如果伺服器支援要求的主題、專案及格式，伺服器應該會傳回識別專案目前值的資料控制碼。</span><span class="sxs-lookup"><span data-stu-id="c4115-150">If the server supports the requested topic, item, and format, the server should return a data handle that identifies the current value of the item.</span></span> <span data-ttu-id="c4115-151">DDEML 會將這個控制碼傳遞給用戶端，做為 [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction)的傳回值。</span><span class="sxs-lookup"><span data-stu-id="c4115-151">The DDEML passes this handle to the client as the return value from [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction).</span></span> <span data-ttu-id="c4115-152">如果伺服器不支援所要求的主題、專案或格式，則應該傳回 **Null** 。</span><span class="sxs-lookup"><span data-stu-id="c4115-152">The server should return **NULL** if it does not support the topic, item, or format requested.</span></span>

<span data-ttu-id="c4115-153">[**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction) 使用 *lpdwResult* 參數將交易狀態旗標傳回至用戶端。</span><span class="sxs-lookup"><span data-stu-id="c4115-153">[**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction) uses the *lpdwResult* parameter to return a transaction-status flag to the client.</span></span> <span data-ttu-id="c4115-154">如果伺服器未處理 [**XTYP \_ 要求**](xtyp-request.md) 交易， **DdeClientTransaction** 會傳回 **Null**，而 *lpdwResult* 會指向 dde \_ FNOTPROCESSED 或 dde \_ FBUSY 旗標。</span><span class="sxs-lookup"><span data-stu-id="c4115-154">If the server does not process the [**XTYP\_REQUEST**](xtyp-request.md) transaction, **DdeClientTransaction** returns **NULL**, and *lpdwResult* points to the DDE\_FNOTPROCESSED or DDE\_FBUSY flag.</span></span> <span data-ttu-id="c4115-155">如果傳回了 DDE \_ FNOTPROCESSED 旗標，用戶端就無法判斷伺服器為何無法處理交易。</span><span class="sxs-lookup"><span data-stu-id="c4115-155">If the DDE\_FNOTPROCESSED flag is returned, the client cannot determine why the server did not process the transaction.</span></span>

<span data-ttu-id="c4115-156">如果伺服器不支援 [**XTYP \_ 要求**](xtyp-request.md)交易，則應該在 DdeInitialize 函式中指定 CBF \_ 失敗 \_ 要求篩選旗標 [](/windows/desktop/api/Ddeml/nf-ddeml-ddeinitializea) 。</span><span class="sxs-lookup"><span data-stu-id="c4115-156">If a server does not support the [**XTYP\_REQUEST**](xtyp-request.md) transaction, it should specify the CBF\_FAIL\_REQUESTS filter flag in the [**DdeInitialize**](/windows/desktop/api/Ddeml/nf-ddeml-ddeinitializea) function.</span></span> <span data-ttu-id="c4115-157">此旗標會防止 DDEML 將交易傳送到伺服器。</span><span class="sxs-lookup"><span data-stu-id="c4115-157">This flag prevents the DDEML from sending the transaction to the server.</span></span>

## <a name="poke-transaction"></a><span data-ttu-id="c4115-158">進行交易</span><span class="sxs-lookup"><span data-stu-id="c4115-158">Poke Transaction</span></span>

<span data-ttu-id="c4115-159">用戶端可以使用 [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction) 將未經要求的資料傳送到伺服器，以 [**將 \_ XTYP**](xtyp-poke.md) 的郵件傳送到伺服器的回呼函數。</span><span class="sxs-lookup"><span data-stu-id="c4115-159">A client can send unsolicited data to a server by using [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction) to send an [**XTYP\_POKE**](xtyp-poke.md) transaction to a server's callback function.</span></span>

<span data-ttu-id="c4115-160">用戶端應用程式會先建立一個緩衝區，其中包含要傳送至伺服器的資料，然後將緩衝區的指標以參數形式傳遞至 [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction)。</span><span class="sxs-lookup"><span data-stu-id="c4115-160">The client application first creates a buffer that contains the data to send to the server and then passes a pointer to the buffer as a parameter to [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction).</span></span> <span data-ttu-id="c4115-161">或者，用戶端可以使用 [**DdeCreateDataHandle**](/windows/desktop/api/Ddeml/nf-ddeml-ddecreatedatahandle) 函數來取得可識別資料的資料控制碼，然後將控制碼傳遞至 **DdeClientTransaction**。</span><span class="sxs-lookup"><span data-stu-id="c4115-161">Alternatively, the client can use the [**DdeCreateDataHandle**](/windows/desktop/api/Ddeml/nf-ddeml-ddecreatedatahandle) function to obtain a data handle that identifies the data and then pass the handle to **DdeClientTransaction**.</span></span> <span data-ttu-id="c4115-162">無論是哪一種情況，用戶端也會在呼叫 **DdeClientTransaction** 時指定主題名稱、專案名稱和資料格式。</span><span class="sxs-lookup"><span data-stu-id="c4115-162">In either case, the client also specifies the topic name, item name, and data format when it calls **DdeClientTransaction**.</span></span>

<span data-ttu-id="c4115-163">DDEML 會將 [**XTYP 的 \_**](xtyp-poke.md) 傳送交易傳遞給伺服器，並指定用戶端所要求的主題名稱、專案名稱和資料格式。</span><span class="sxs-lookup"><span data-stu-id="c4115-163">The DDEML passes the [**XTYP\_POKE**](xtyp-poke.md) transaction to the server, specifying the topic name, item name, and data format that the client requested.</span></span> <span data-ttu-id="c4115-164">若要接受資料項目和格式，伺服器應該傳回 DDE \_ FACK。</span><span class="sxs-lookup"><span data-stu-id="c4115-164">To accept the data item and format, the server should return DDE\_FACK.</span></span> <span data-ttu-id="c4115-165">若要拒絕資料，伺服器應該傳回 DDE \_ FNOTPROCESSED。</span><span class="sxs-lookup"><span data-stu-id="c4115-165">To reject the data, the server should return DDE\_FNOTPROCESSED.</span></span> <span data-ttu-id="c4115-166">如果伺服器太忙碌而無法接受資料，伺服器應該會傳回 DDE \_ FBUSY。</span><span class="sxs-lookup"><span data-stu-id="c4115-166">If the server is too busy to accept the data, the server should return DDE\_FBUSY.</span></span>

<span data-ttu-id="c4115-167">當 [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction) 傳回時，用戶端可以使用 *lpdwResult* 參數來存取交易狀態旗標。</span><span class="sxs-lookup"><span data-stu-id="c4115-167">When [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction) returns, the client can use the *lpdwResult* parameter to access the transaction-status flag.</span></span> <span data-ttu-id="c4115-168">如果旗標是 DDE \_ FBUSY，用戶端應該稍後再傳送交易。</span><span class="sxs-lookup"><span data-stu-id="c4115-168">If the flag is DDE\_FBUSY, the client should send the transaction again later.</span></span>

<span data-ttu-id="c4115-169">如果伺服器不支援 XTYP 伺服器的 [**交易 \_**](xtyp-poke.md) ，則應該 \_ 在 DdeInitialize 中指定 CBF FAIL \_ 友善篩選旗標 [](/windows/desktop/api/Ddeml/nf-ddeml-ddeinitializea)。</span><span class="sxs-lookup"><span data-stu-id="c4115-169">If a server does not support the [**XTYP\_POKE**](xtyp-poke.md) transaction, it should specify the CBF\_FAIL\_POKES filter flag in [**DdeInitialize**](/windows/desktop/api/Ddeml/nf-ddeml-ddeinitializea).</span></span> <span data-ttu-id="c4115-170">此旗標會防止 DDEML 將此交易傳送到伺服器。</span><span class="sxs-lookup"><span data-stu-id="c4115-170">This flag prevents the DDEML from sending this transaction to the server.</span></span>

## <a name="advise-transaction"></a><span data-ttu-id="c4115-171">建議交易</span><span class="sxs-lookup"><span data-stu-id="c4115-171">Advise Transaction</span></span>

<span data-ttu-id="c4115-172">用戶端應用程式可以使用 DDEML，在伺服器應用程式中建立專案的一個或多個連結。</span><span class="sxs-lookup"><span data-stu-id="c4115-172">A client application can use the DDEML to establish one or more links to items in a server application.</span></span> <span data-ttu-id="c4115-173">當您建立這類連結時，伺服器會定期將有關連結專案的更新傳送至用戶端 (一般而言，只要與伺服器應用程式相關聯的專案值變更) 。</span><span class="sxs-lookup"><span data-stu-id="c4115-173">When such a link has been established, the server sends periodic updates about the linked item to the client (typically, whenever the value of the item associated with the server application changes).</span></span> <span data-ttu-id="c4115-174">連結會在兩個保留位置的應用程式之間建立一個建議迴圈，直到用戶端結束為止。</span><span class="sxs-lookup"><span data-stu-id="c4115-174">Linking establishes an advise loop between the two applications that remains in place until the client ends it.</span></span>

<span data-ttu-id="c4115-175">有兩種類型的建議迴圈：「經常性存取」和「熱」。</span><span class="sxs-lookup"><span data-stu-id="c4115-175">There are two kinds of advise loops: "hot" and "warm."</span></span> <span data-ttu-id="c4115-176">在熱建議迴圈中，伺服器會立即傳送可識別變更值的資料控制碼。</span><span class="sxs-lookup"><span data-stu-id="c4115-176">In a hot advise loop, the server immediately sends a data handle that identifies the changed value.</span></span> <span data-ttu-id="c4115-177">在暖建議迴圈中，伺服器會通知用戶端專案的值已變更，但在用戶端要求之前，不會傳送資料控制碼。</span><span class="sxs-lookup"><span data-stu-id="c4115-177">In a warm advise loop, the server notifies the client that the value of the item has changed but does not send the data handle until the client requests it.</span></span>

<span data-ttu-id="c4115-178">用戶端可以在對 [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction)的呼叫中指定 [**XTYP \_ ADVSTART**](xtyp-advstart.md)交易類型，藉以向伺服器要求熱建議迴圈。</span><span class="sxs-lookup"><span data-stu-id="c4115-178">A client can request a hot advise loop with a server by specifying the [**XTYP\_ADVSTART**](xtyp-advstart.md) transaction type in a call to [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction).</span></span> <span data-ttu-id="c4115-179">若要要求暖建議迴圈，用戶端必須結合 XTYPF \_ NODATA 旗標與 **XTYP \_ ADVSTART** 交易類型。</span><span class="sxs-lookup"><span data-stu-id="c4115-179">To request a warm advise loop, the client must combine the XTYPF\_NODATA flag with the **XTYP\_ADVSTART** transaction type.</span></span> <span data-ttu-id="c4115-180">在任一事件中，DDEML 會將 **XTYP \_ ADVSTART** 交易傳遞給伺服器的動態資料交換 (DDE) 回呼函式。</span><span class="sxs-lookup"><span data-stu-id="c4115-180">In either event, the DDEML passes the **XTYP\_ADVSTART** transaction to the server's Dynamic Data Exchange (DDE) callback function.</span></span> <span data-ttu-id="c4115-181">伺服器的 DDE 回呼函數應該檢查 **XTYP \_ ADVSTART** transaction 伴隨的參數 (包括要求的格式、主題名稱和專案名稱) 然後傳回 **TRUE** 以允許建議迴圈或 **FALSE** 拒絕它。</span><span class="sxs-lookup"><span data-stu-id="c4115-181">The server's DDE callback function should examine the parameters that accompany the **XTYP\_ADVSTART** transaction (including the requested format, topic name, and item name) and then return **TRUE** to allow the advise loop or **FALSE** to deny it.</span></span>

<span data-ttu-id="c4115-182">在建立「建議」迴圈之後，每當與要求的專案名稱相關聯的專案值變更時，伺服器應用程式就應該呼叫 [**DdePostAdvise**](/windows/desktop/api/Ddeml/nf-ddeml-ddepostadvise) 函數。</span><span class="sxs-lookup"><span data-stu-id="c4115-182">After an advise loop has been established, the server application should call the [**DdePostAdvise**](/windows/desktop/api/Ddeml/nf-ddeml-ddepostadvise) function whenever the value of the item associated with the requested item name changes.</span></span> <span data-ttu-id="c4115-183">這項呼叫會導致將 [**XTYP \_ ADVREQ**](xtyp-advreq.md) 交易傳送到伺服器本身的 DDE 回呼函數。</span><span class="sxs-lookup"><span data-stu-id="c4115-183">This call results in an [**XTYP\_ADVREQ**](xtyp-advreq.md) transaction being sent to the server's own DDE callback function.</span></span> <span data-ttu-id="c4115-184">伺服器的 DDE 回呼函數應該會傳回識別資料項目新值的資料控制碼。</span><span class="sxs-lookup"><span data-stu-id="c4115-184">The server's DDE callback function should return a data handle that identifies the new value of the data item.</span></span> <span data-ttu-id="c4115-185">然後，DDEML 會將 [**XTYP \_ ADVDATA**](xtyp-advdata.md) 交易傳送至用戶端的 DDE 回呼函式，以通知用戶端指定的專案已經變更。</span><span class="sxs-lookup"><span data-stu-id="c4115-185">The DDEML then notifies the client that the specified item has changed by sending the [**XTYP\_ADVDATA**](xtyp-advdata.md) transaction to the client's DDE callback function.</span></span>

<span data-ttu-id="c4115-186">如果用戶端要求熱建議迴圈，DDEML 會在 [**XTYP \_ ADVDATA**](xtyp-advdata.md) 交易期間，將已變更的專案傳遞至用戶端。</span><span class="sxs-lookup"><span data-stu-id="c4115-186">If the client requested a hot advise loop, the DDEML passes the data handle to the changed item to the client during the [**XTYP\_ADVDATA**](xtyp-advdata.md) transaction.</span></span> <span data-ttu-id="c4115-187">否則，用戶端可以傳送 [**XTYP \_ 要求**](xtyp-request.md) 交易來取得資料控制碼。</span><span class="sxs-lookup"><span data-stu-id="c4115-187">Otherwise, the client can send an [**XTYP\_REQUEST**](xtyp-request.md) transaction to obtain the data handle.</span></span>

<span data-ttu-id="c4115-188">伺服器可以更快地傳送更新，而不是用戶端可以處理新資料。</span><span class="sxs-lookup"><span data-stu-id="c4115-188">It is possible for a server to send updates faster than a client can process the new data.</span></span> <span data-ttu-id="c4115-189">對於必須對資料執行冗長處理作業的用戶端而言，更新的速度可能會造成問題。</span><span class="sxs-lookup"><span data-stu-id="c4115-189">The speed of updates can be a problem for a client that must perform lengthy processing operations on the data.</span></span> <span data-ttu-id="c4115-190">在此情況下，用戶端應該在要求「建議」迴圈時，指定 XTYPF \_ ACKREQ 旗標。</span><span class="sxs-lookup"><span data-stu-id="c4115-190">In this case, the client should specify the XTYPF\_ACKREQ flag when it requests an advise loop.</span></span> <span data-ttu-id="c4115-191">此旗標會讓伺服器在伺服器傳送下一個資料項目之前，等待用戶端確認它已接收並處理資料項目。</span><span class="sxs-lookup"><span data-stu-id="c4115-191">This flag causes the server to wait for the client to acknowledge that it has received and processed a data item before the server sends the next data item.</span></span> <span data-ttu-id="c4115-192">使用 XTYPF ACKREQ 旗標所建立的建議迴圈， \_ 會比快速伺服器更健全，但偶爾會遺漏更新。</span><span class="sxs-lookup"><span data-stu-id="c4115-192">Advise loops that are established with the XTYPF\_ACKREQ flag are more robust with fast servers but can occasionally miss updates.</span></span> <span data-ttu-id="c4115-193">\_只要用戶端跟上伺服器，就不會遺漏 XTYPF ACKREQ 旗標所建立的建議迴圈。</span><span class="sxs-lookup"><span data-stu-id="c4115-193">Advise loops established without the XTYPF\_ACKREQ flag are guaranteed not to miss updates as long as the client keeps up with the server.</span></span>

<span data-ttu-id="c4115-194">用戶端可以在對 [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction)的呼叫中指定 [**XTYP \_ ADVSTOP**](xtyp-advstop.md)交易類型，藉以結束「建議」迴圈。</span><span class="sxs-lookup"><span data-stu-id="c4115-194">A client can end an advise loop by specifying the [**XTYP\_ADVSTOP**](xtyp-advstop.md) transaction type in a call to [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction).</span></span>

<span data-ttu-id="c4115-195">如果伺服器不支援「建議」迴圈，則應該在 DdeInitialize 函式中指定 CBF \_ 失敗 \_ 建議[](/windows/desktop/api/Ddeml/nf-ddeml-ddeinitializea)篩選旗標。</span><span class="sxs-lookup"><span data-stu-id="c4115-195">If a server does not support advise loops, it should specify the CBF\_FAIL\_ADVISES filter flag in the [**DdeInitialize**](/windows/desktop/api/Ddeml/nf-ddeml-ddeinitializea) function.</span></span> <span data-ttu-id="c4115-196">此旗標會防止 DDEML 將 [**XTYP \_ ADVSTART**](xtyp-advstart.md) 和 [**XTYP \_ ADVSTOP**](xtyp-advstop.md) 交易傳送到伺服器。</span><span class="sxs-lookup"><span data-stu-id="c4115-196">This flag prevents the DDEML from sending the [**XTYP\_ADVSTART**](xtyp-advstart.md) and [**XTYP\_ADVSTOP**](xtyp-advstop.md) transactions to the server.</span></span>

## <a name="execute-transaction"></a><span data-ttu-id="c4115-197">執行交易</span><span class="sxs-lookup"><span data-stu-id="c4115-197">Execute Transaction</span></span>

<span data-ttu-id="c4115-198">用戶端可以使用 [**XTYP \_ execute**](xtyp-execute.md) 交易，讓伺服器執行命令或一系列的命令。</span><span class="sxs-lookup"><span data-stu-id="c4115-198">A client can use the [**XTYP\_EXECUTE**](xtyp-execute.md) transaction to cause a server to execute a command or a series of commands.</span></span>

<span data-ttu-id="c4115-199">若要執行伺服器命令，用戶端會先建立一個緩衝區，其中包含要執行之伺服器的命令字串，然後在呼叫 [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction)時，將指標傳遞至緩衝區或識別緩衝區的資料控制碼。</span><span class="sxs-lookup"><span data-stu-id="c4115-199">To execute a server command, the client first creates a buffer that contains a command string for the server to execute and then passes either a pointer to the buffer or a data handle identifying the buffer when it calls [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction).</span></span> <span data-ttu-id="c4115-200">其他必要參數包括交談控制碼、專案名稱字串控制碼、格式規格，以及 [**XTYP \_ 執行**](xtyp-execute.md) 交易類型。</span><span class="sxs-lookup"><span data-stu-id="c4115-200">Other required parameters include the conversation handle, the item name string handle, the format specification, and the [**XTYP\_EXECUTE**](xtyp-execute.md) transaction type.</span></span> <span data-ttu-id="c4115-201">建立資料處理程式以傳遞執行資料的應用程式，必須針對 [**DdeCreateDataHandle**](/windows/desktop/api/Ddeml/nf-ddeml-ddecreatedatahandle)函式的 *HszItem* 參數指定 **Null** ，並針對 *uFmt* 參數指定為零。</span><span class="sxs-lookup"><span data-stu-id="c4115-201">An application that creates a data handle to passing execute data must specify **NULL** for the *hszItem* parameter of the [**DdeCreateDataHandle**](/windows/desktop/api/Ddeml/nf-ddeml-ddecreatedatahandle) function and zero for the *uFmt* parameter.</span></span>

<span data-ttu-id="c4115-202">DDEML 會將 [**XTYP \_ 執行**](xtyp-execute.md) 交易傳遞給伺服器的 DDE 回呼函式，並指定用來識別命令字串的格式名稱、對話控制碼、主題名稱和資料控制碼。</span><span class="sxs-lookup"><span data-stu-id="c4115-202">The DDEML passes the [**XTYP\_EXECUTE**](xtyp-execute.md) transaction to the server's DDE callback function and specifies the format name, conversation handle, topic name, and data handle identifying the command string.</span></span> <span data-ttu-id="c4115-203">如果伺服器支援命令，它應該使用 [**DdeAccessData**](/windows/desktop/api/Ddeml/nf-ddeml-ddeaccessdata) 函式來取得命令字串的指標，執行命令，然後傳回 DDE \_ FACK。</span><span class="sxs-lookup"><span data-stu-id="c4115-203">If the server supports the command, it should use the [**DdeAccessData**](/windows/desktop/api/Ddeml/nf-ddeml-ddeaccessdata) function to obtain a pointer to the command string, execute the command, and then return DDE\_FACK.</span></span> <span data-ttu-id="c4115-204">如果伺服器不支援命令或無法完成交易，它應該會傳回 DDE \_ FNOTPROCESSED。</span><span class="sxs-lookup"><span data-stu-id="c4115-204">If the server does not support the command or cannot complete the transaction, it should return DDE\_FNOTPROCESSED.</span></span> <span data-ttu-id="c4115-205">\_如果伺服器太忙碌而無法完成交易，伺服器應該會傳回 DDE FBUSY。</span><span class="sxs-lookup"><span data-stu-id="c4115-205">The server should return DDE\_FBUSY if it is too busy to complete the transaction.</span></span>

<span data-ttu-id="c4115-206">一般來說，伺服器的回呼函數應該先處理 [**XTYP \_ EXECUTE**](xtyp-execute.md) 交易，然後再傳回，但有下列例外狀況：</span><span class="sxs-lookup"><span data-stu-id="c4115-206">In general, a server's callback function should process the [**XTYP\_EXECUTE**](xtyp-execute.md) transaction before returning with the following exceptions:</span></span>

1.  <span data-ttu-id="c4115-207">當使用 [**XTYP \_ EXECUTE**](xtyp-execute.md) transaction 傳遞的命令要求伺服器終止時，伺服器不應終止，直到其回呼函數從處理 **XTYP \_ 執行** 傳回為止。</span><span class="sxs-lookup"><span data-stu-id="c4115-207">When the command passed with the [**XTYP\_EXECUTE**](xtyp-execute.md) transaction requests the server to terminate, the server should not terminate until its callback function returns from processing **XTYP\_EXECUTE**.</span></span>
2.  <span data-ttu-id="c4115-208">如果伺服器必須執行作業（例如處理對話方塊或可能造成 DDEML 遞迴問題的 DDE 交易），伺服器應該會傳回 CBR \_ 區塊傳回碼來封鎖執行交易、執行作業，然後繼續處理執行交易。</span><span class="sxs-lookup"><span data-stu-id="c4115-208">If the server must perform an operation, such as processing a dialog box or a DDE transaction that might cause DDEML recursion problems, the server should return the CBR\_BLOCK return code to block the execute transaction, perform the operation, and then resume processing the execute transaction.</span></span>

<span data-ttu-id="c4115-209">當 [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction) 傳回時，用戶端可以使用 *lpdwResult* 參數來存取交易狀態旗標。</span><span class="sxs-lookup"><span data-stu-id="c4115-209">When [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction) returns, the client can use the *lpdwResult* parameter to access the transaction status flag.</span></span> <span data-ttu-id="c4115-210">如果旗標是 DDE \_ FBUSY，用戶端應該稍後再傳送交易。</span><span class="sxs-lookup"><span data-stu-id="c4115-210">If the flag is DDE\_FBUSY, the client should send the transaction again later.</span></span>

<span data-ttu-id="c4115-211">如果伺服器不支援 [**XTYP \_ EXECUTE**](xtyp-execute.md) transaction，則應該 \_ \_ 在 [**DdeInitialize**](/windows/desktop/api/Ddeml/nf-ddeml-ddeinitializea) 函數中指定 CBF FAIL EXECUTE filter 旗標。</span><span class="sxs-lookup"><span data-stu-id="c4115-211">If a server does not support the [**XTYP\_EXECUTE**](xtyp-execute.md) transaction, it should specify the CBF\_FAIL\_EXECUTES filter flag in the [**DdeInitialize**](/windows/desktop/api/Ddeml/nf-ddeml-ddeinitializea) function.</span></span> <span data-ttu-id="c4115-212">這樣做可防止 DDEML 將交易傳送到伺服器。</span><span class="sxs-lookup"><span data-stu-id="c4115-212">Doing so prevents the DDEML from sending the transaction to the server.</span></span>

## <a name="synchronous-and-asynchronous-transactions"></a><span data-ttu-id="c4115-213">同步和非同步交易</span><span class="sxs-lookup"><span data-stu-id="c4115-213">Synchronous and Asynchronous Transactions</span></span>

<span data-ttu-id="c4115-214">用戶端可以傳送同步或非同步交易。</span><span class="sxs-lookup"><span data-stu-id="c4115-214">A client can send either synchronous or asynchronous transactions.</span></span> <span data-ttu-id="c4115-215">在同步交易中，用戶端會指定超時值，指出等候伺服器處理交易的最大時間量。</span><span class="sxs-lookup"><span data-stu-id="c4115-215">In a synchronous transaction, the client specifies a time-out value that indicates the maximum amount of time it will wait for the server to process the transaction.</span></span> <span data-ttu-id="c4115-216">除非伺服器處理交易、交易失敗或超時值過期，否則 [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction)不會傳回。</span><span class="sxs-lookup"><span data-stu-id="c4115-216">[**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction) does not return until the server processes the transaction, the transaction fails, or the time-out value expires.</span></span> <span data-ttu-id="c4115-217">用戶端會在呼叫 **DdeClientTransaction** 時指定超時值。</span><span class="sxs-lookup"><span data-stu-id="c4115-217">The client specifies the time-out value when it calls **DdeClientTransaction**.</span></span>

<span data-ttu-id="c4115-218">在同步交易期間，用戶端會在等候交易處理時進入強制回應迴圈。</span><span class="sxs-lookup"><span data-stu-id="c4115-218">During a synchronous transaction, the client enters a modal loop while waiting for the transaction to be processed.</span></span> <span data-ttu-id="c4115-219">用戶端仍然可以處理使用者輸入，但在 [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction) 傳回之前無法傳送另一個同步交易。</span><span class="sxs-lookup"><span data-stu-id="c4115-219">The client can still process user input but cannot send another synchronous transaction until [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction) returns.</span></span>

<span data-ttu-id="c4115-220">用戶端藉由 \_ 在 [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction)中指定 TIMEOUT ASYNC 旗標來傳送非同步交易。</span><span class="sxs-lookup"><span data-stu-id="c4115-220">A client sends an asynchronous transaction by specifying the TIMEOUT\_ASYNC flag in [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction).</span></span> <span data-ttu-id="c4115-221">此函數會在交易開始之後傳回，並將交易識別碼傳遞給用戶端。</span><span class="sxs-lookup"><span data-stu-id="c4115-221">The function returns after the transaction has begun, passing a transaction identifier to the client.</span></span> <span data-ttu-id="c4115-222">當伺服器完成非同步交易處理時，DDEML 會將 XTYP 的 [**交易 \_ \_ 完成**](xtyp-xact-complete.md) 交易傳送給用戶端。</span><span class="sxs-lookup"><span data-stu-id="c4115-222">When the server finishes processing the asynchronous transaction, the DDEML sends an [**XTYP\_XACT\_COMPLETE**](xtyp-xact-complete.md) transaction to the client.</span></span> <span data-ttu-id="c4115-223">DDEML 在 **XTYP 交易 \_ \_ 完成** 交易期間傳遞給用戶端的其中一個參數是交易識別碼。</span><span class="sxs-lookup"><span data-stu-id="c4115-223">One of the parameters that the DDEML passes to the client during the **XTYP\_XACT\_COMPLETE** transaction is the transaction identifier.</span></span> <span data-ttu-id="c4115-224">藉由比較此交易識別碼與 **DdeClientTransaction** 所傳回的識別碼，用戶端會識別伺服器已完成處理的非同步交易。</span><span class="sxs-lookup"><span data-stu-id="c4115-224">By comparing this transaction identifier with the identifier returned by **DdeClientTransaction**, the client identifies which asynchronous transaction the server has finished processing.</span></span>

<span data-ttu-id="c4115-225">用戶端可以使用 [**DdeSetUserHandle**](/windows/desktop/api/Ddeml/nf-ddeml-ddesetuserhandle) 函數來協助處理非同步交易。</span><span class="sxs-lookup"><span data-stu-id="c4115-225">A client can use the [**DdeSetUserHandle**](/windows/desktop/api/Ddeml/nf-ddeml-ddesetuserhandle) function as an aid in processing an asynchronous transaction.</span></span> <span data-ttu-id="c4115-226">此函數可讓用戶端將應用程式定義值與交談控制碼和交易識別碼產生關聯。</span><span class="sxs-lookup"><span data-stu-id="c4115-226">This function makes it possible for a client to associate an application-defined value with a conversation handle and a transaction identifier.</span></span> <span data-ttu-id="c4115-227">用戶端可以在 [**XTYP 交易 \_ \_ 完成**](xtyp-xact-complete.md)交易期間使用 [**DdeQueryConvInfo**](/windows/desktop/api/Ddeml/nf-ddeml-ddequeryconvinfo)函式，以取得應用程式定義的值。</span><span class="sxs-lookup"><span data-stu-id="c4115-227">The client can use the [**DdeQueryConvInfo**](/windows/desktop/api/Ddeml/nf-ddeml-ddequeryconvinfo) function during the [**XTYP\_XACT\_COMPLETE**](xtyp-xact-complete.md) transaction to obtain the application-defined value.</span></span> <span data-ttu-id="c4115-228">由於這個函式的原因，應用程式不需要維護使用中交易識別碼的清單。</span><span class="sxs-lookup"><span data-stu-id="c4115-228">Because of this function, an application need not maintain a list of active transaction identifiers.</span></span>

<span data-ttu-id="c4115-229">當用戶端使用同步交易成功完成資料的要求時，DDEML 無法分辨用戶端何時完成使用所收到的資料。</span><span class="sxs-lookup"><span data-stu-id="c4115-229">When a client successfully completes a request for data using a synchronous transaction, the DDEML has no way to tell when the client has finished using the data received.</span></span> <span data-ttu-id="c4115-230">用戶端應用程式必須將接收到的資料控制碼傳遞至 [**DdeFreeDataHandle**](/windows/desktop/api/Ddeml/nf-ddeml-ddefreedatahandle) 函式，以通知 DDEML 該控制碼將不再使用。</span><span class="sxs-lookup"><span data-stu-id="c4115-230">The client application must pass the data handle received to the [**DdeFreeDataHandle**](/windows/desktop/api/Ddeml/nf-ddeml-ddefreedatahandle) function, notifying the DDEML that the handle will no longer be used.</span></span> <span data-ttu-id="c4115-231">同步交易所傳回的資料控制碼實際上是由用戶端所擁有。</span><span class="sxs-lookup"><span data-stu-id="c4115-231">Data handles returned by synchronous transactions are effectively owned by the client.</span></span>

<span data-ttu-id="c4115-232">如果伺服器沒有及時處理非同步交易，用戶端可以藉由呼叫 [**DdeAbandonTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeabandontransaction) 函數來放棄交易。</span><span class="sxs-lookup"><span data-stu-id="c4115-232">If a server does not process an asynchronous transaction in a timely manner, the client can abandon the transaction by calling the [**DdeAbandonTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeabandontransaction) function.</span></span> <span data-ttu-id="c4115-233">DDEML 會釋放與交易相關聯的所有資源，並在伺服器完成處理時捨棄交易結果。</span><span class="sxs-lookup"><span data-stu-id="c4115-233">The DDEML releases all resources associated with the transaction and discards the results of the transaction when the server finishes processing it.</span></span> <span data-ttu-id="c4115-234">同步交易期間的超時時間會有效地取消交易。</span><span class="sxs-lookup"><span data-stu-id="c4115-234">A time-out during a synchronous transaction effectively cancels the transaction.</span></span>

<span data-ttu-id="c4115-235">非同步交易方法是針對必須傳送大量 DDE 交易的應用程式所提供，同時執行大量的處理，例如執行計算。</span><span class="sxs-lookup"><span data-stu-id="c4115-235">The asynchronous transaction method is provided for applications that must send a high volume of DDE transactions while simultaneously performing a substantial amount of processing, such as performing calculations.</span></span> <span data-ttu-id="c4115-236">非同步方法也適用于必須暫時停止處理 DDE 交易的應用程式，讓它們可以在不中斷的情況下完成其他工作。</span><span class="sxs-lookup"><span data-stu-id="c4115-236">The asynchronous method is also useful in applications that must stop processing DDE transactions temporarily so they can complete other tasks without interruption.</span></span> <span data-ttu-id="c4115-237">在大部分的其他情況下，應用程式應該使用同步方法。</span><span class="sxs-lookup"><span data-stu-id="c4115-237">In most other situations, an application should use the synchronous method.</span></span>

<span data-ttu-id="c4115-238">同步交易比較容易維護，而且速度比非同步交易更快。</span><span class="sxs-lookup"><span data-stu-id="c4115-238">Synchronous transactions are simpler to maintain and are faster than asynchronous transactions.</span></span> <span data-ttu-id="c4115-239">不過，一次只能執行一個同步交易，而許多非同步交易則可以同時執行。</span><span class="sxs-lookup"><span data-stu-id="c4115-239">However, only one synchronous transaction can be performed at a time, whereas many asynchronous transactions can be performed simultaneously.</span></span> <span data-ttu-id="c4115-240">使用同步交易時，緩慢的伺服器可能會導致用戶端在等候回應時保持閒置。</span><span class="sxs-lookup"><span data-stu-id="c4115-240">With synchronous transactions, a slow server can cause a client to remain idle while it is waiting for a response.</span></span> <span data-ttu-id="c4115-241">此外，同步交易也會導致用戶端進入強制回應迴圈，該迴圈可能會略過應用程式本身訊息迴圈中的訊息篩選。</span><span class="sxs-lookup"><span data-stu-id="c4115-241">Also, synchronous transactions cause the client to enter a modal loop that could bypass message filtering in the application's own message loop.</span></span>

<span data-ttu-id="c4115-242">如果用戶端已安裝攔截程式來篩選訊息 (也就是在 SetWindowsHookEx 函式的呼叫中指定了 WH \_ MSGFILTER 攔截[](/windows/desktop/api/winuser/nf-winuser-setwindowshookexa)類型) ，同步交易將不會造成系統略過攔截程式。</span><span class="sxs-lookup"><span data-stu-id="c4115-242">If the client has installed a hook procedure to filter messages (that is, specified the WH\_MSGFILTER hook type in a call to the [**SetWindowsHookEx**](/windows/desktop/api/winuser/nf-winuser-setwindowshookexa) function), a synchronous transaction will not cause the system to bypass the hook procedure.</span></span> <span data-ttu-id="c4115-243">當用戶端在等候同步交易結束時，如果發生輸入事件，攔截程式就會收到 MSGF DDEMGR 攔截程式 \_ 代碼。</span><span class="sxs-lookup"><span data-stu-id="c4115-243">When an input event occurs while the client is waiting for a synchronous transaction to end, the hook procedure receives an MSGF\_DDEMGR hook code.</span></span> <span data-ttu-id="c4115-244">使用同步交易強制回應迴圈的主要風險是，對話方塊所建立的強制回應迴圈可能會干擾其作業。</span><span class="sxs-lookup"><span data-stu-id="c4115-244">The main danger of using a synchronous transaction modal loop is that a modal loop created by a dialog box can interfere with its operation.</span></span> <span data-ttu-id="c4115-245">當 DLL 正在使用 DDEML 時，應該一律使用非同步交易。</span><span class="sxs-lookup"><span data-stu-id="c4115-245">Asynchronous transactions should always be used when the DDEML is being used by a DLL.</span></span>

## <a name="transaction-control"></a><span data-ttu-id="c4115-246">交易控制</span><span class="sxs-lookup"><span data-stu-id="c4115-246">Transaction Control</span></span>

<span data-ttu-id="c4115-247">無論對話控制碼為何，應用程式都可以將交易暫停至其 DDE 回呼函式，這些交易與特定對話控制碼或所有交易相關聯。</span><span class="sxs-lookup"><span data-stu-id="c4115-247">An application can suspend transactions to its DDE callback function   either those transactions associated with a specific conversation handle or all transactions regardless of the conversation handle.</span></span> <span data-ttu-id="c4115-248">當應用程式收到需要冗長處理的交易時，這項功能就很有用。</span><span class="sxs-lookup"><span data-stu-id="c4115-248">This capability is useful when an application receives a transaction that requires lengthy processing.</span></span> <span data-ttu-id="c4115-249">在這種情況下，應用程式可以傳回 CBR \_ 區塊傳回碼，以暫止與交易交談控制碼相關聯的未來交易，讓應用程式可以自由處理其他交談。</span><span class="sxs-lookup"><span data-stu-id="c4115-249">In such a case, the application can return the CBR\_BLOCK return code to suspend future transactions associated with the transaction's conversation handle, so that the application is free to process other conversations.</span></span>

<span data-ttu-id="c4115-250">當處理完成時，應用程式會呼叫 [**DdeEnableCallback**](/windows/desktop/api/Ddeml/nf-ddeml-ddeenablecallback) 函數來繼續與已暫停交談相關聯的交易。</span><span class="sxs-lookup"><span data-stu-id="c4115-250">When processing has been completed, the application calls the [**DdeEnableCallback**](/windows/desktop/api/Ddeml/nf-ddeml-ddeenablecallback) function to resume transactions associated with the suspended conversation.</span></span> <span data-ttu-id="c4115-251">呼叫 **DdeEnableCallback** 會導致 DDEML 重新傳送導致應用程式暫停交談的交易。</span><span class="sxs-lookup"><span data-stu-id="c4115-251">Calling **DdeEnableCallback** causes the DDEML to resend the transaction that resulted in the application suspending the conversation.</span></span> <span data-ttu-id="c4115-252">因此，應用程式應該儲存交易的結果，讓它可以取得並傳回結果，而不需要重新處理交易。</span><span class="sxs-lookup"><span data-stu-id="c4115-252">Therefore, the application should store the result of the transaction in such a way that it can obtain and return the result without reprocessing the transaction.</span></span>

<span data-ttu-id="c4115-253">應用程式可以藉由在 DdeEnableCallback 的呼叫中指定控制碼和 EC DISABLE 旗標，來暫停與特定對話控制碼相關聯的所有交易 \_ 。 [](/windows/desktop/api/Ddeml/nf-ddeml-ddeenablecallback)</span><span class="sxs-lookup"><span data-stu-id="c4115-253">An application can suspend all transactions associated with a specific conversation handle by specifying the handle and the EC\_DISABLE flag in a call to [**DdeEnableCallback**](/windows/desktop/api/Ddeml/nf-ddeml-ddeenablecallback).</span></span> <span data-ttu-id="c4115-254">藉由指定 **Null** 控制碼，應用程式可以暫止所有交談的所有交易。</span><span class="sxs-lookup"><span data-stu-id="c4115-254">By specifying a **NULL** handle, an application can suspend all transactions for all conversations.</span></span>

<span data-ttu-id="c4115-255">當交談暫停時，DDEML 會將交談的交易儲存在交易佇列中。</span><span class="sxs-lookup"><span data-stu-id="c4115-255">When a conversation has been suspended, the DDEML saves transactions for the conversation in a transaction queue.</span></span> <span data-ttu-id="c4115-256">當應用程式 reenables 交談時，DDEML 會從佇列中移除已儲存的交易，並將每個交易傳遞給適當的回呼函數。</span><span class="sxs-lookup"><span data-stu-id="c4115-256">When the application reenables the conversation, the DDEML removes the saved transactions from the queue and passes each transaction to the appropriate callback function.</span></span> <span data-ttu-id="c4115-257">交易佇列的容量很大，但應用程式應該儘快重新啟用暫停的交談，以避免遺失交易。</span><span class="sxs-lookup"><span data-stu-id="c4115-257">The capacity of the transaction queue is large, but an application should reenable a suspended conversation as soon as possible to avoid losing transactions.</span></span>

<span data-ttu-id="c4115-258">應用程式可以 \_ 在 [**DdeEnableCallback**](/windows/desktop/api/Ddeml/nf-ddeml-ddeenablecallback)中指定 EC ENABLEALL 旗標，以繼續正常交易處理。</span><span class="sxs-lookup"><span data-stu-id="c4115-258">An application can resume usual transaction processing by specifying the EC\_ENABLEALL flag in [**DdeEnableCallback**](/windows/desktop/api/Ddeml/nf-ddeml-ddeenablecallback).</span></span> <span data-ttu-id="c4115-259">針對更受控制的交易處理繼續，應用程式可以指定 EC \_ ENABLEONE 旗標。</span><span class="sxs-lookup"><span data-stu-id="c4115-259">For a more controlled resumption of transaction processing, the application can specify the EC\_ENABLEONE flag.</span></span> <span data-ttu-id="c4115-260">此旗標會移除交易佇列中的一筆交易，並將其傳遞至適當的回呼函式;交易經過處理之後，就會再次停用任何交談。</span><span class="sxs-lookup"><span data-stu-id="c4115-260">This flag removes one transaction from the transaction queue and passes it to the appropriate callback function; after that transaction has been processed, any conversations are again disabled.</span></span>

<span data-ttu-id="c4115-261">如果在 \_ 呼叫 [**DdeEnableCallback**](/windows/desktop/api/Ddeml/nf-ddeml-ddeenablecallback)時指定了 EC ENABLEONE 旗標和交談控制碼，只有在處理交易之後，才會封鎖該交談。</span><span class="sxs-lookup"><span data-stu-id="c4115-261">If the EC\_ENABLEONE flag and a conversation handle are specified in the call to [**DdeEnableCallback**](/windows/desktop/api/Ddeml/nf-ddeml-ddeenablecallback), only that conversation is blocked after the transaction has been processed.</span></span> <span data-ttu-id="c4115-262">如果指定了 **Null** 對話控制碼，則在任何交談中處理交易之後，會封鎖所有交談。</span><span class="sxs-lookup"><span data-stu-id="c4115-262">If a **NULL** conversation handle is specified, all conversations are blocked after a transaction has been processed in any conversation.</span></span>

## <a name="transaction-classes"></a><span data-ttu-id="c4115-263">交易類別</span><span class="sxs-lookup"><span data-stu-id="c4115-263">Transaction Classes</span></span>

<span data-ttu-id="c4115-264">DDEML 有四個類別的交易。</span><span class="sxs-lookup"><span data-stu-id="c4115-264">The DDEML has four classes of transactions.</span></span> <span data-ttu-id="c4115-265">每個類別都是由以 XCLASS 前置詞開頭的常數來識別 \_ 。</span><span class="sxs-lookup"><span data-stu-id="c4115-265">Each class is identified by a constant that begins with the XCLASS\_ prefix.</span></span> <span data-ttu-id="c4115-266">這些類別定義于 DDEML 標頭檔中。</span><span class="sxs-lookup"><span data-stu-id="c4115-266">The classes are defined in the DDEML header file.</span></span> <span data-ttu-id="c4115-267">類別值會與交易類型值結合，並傳遞至接收應用程式的 DDE 回呼函數。</span><span class="sxs-lookup"><span data-stu-id="c4115-267">The class value is combined with the transaction-type value and is passed to the DDE callback function of the receiving application.</span></span>

<span data-ttu-id="c4115-268">交易的類別會決定回呼函數在處理交易時預期會傳回的傳回值。</span><span class="sxs-lookup"><span data-stu-id="c4115-268">A transaction's class determines the return value that a callback function is expected to return if it processes the transaction.</span></span> <span data-ttu-id="c4115-269">下列傳回值和交易類型會與四個交易類別相關聯。</span><span class="sxs-lookup"><span data-stu-id="c4115-269">The following return values and transaction types are associated with each of the four transaction classes.</span></span>



| <span data-ttu-id="c4115-270">類別</span><span class="sxs-lookup"><span data-stu-id="c4115-270">Class</span></span>                | <span data-ttu-id="c4115-271">傳回值</span><span class="sxs-lookup"><span data-stu-id="c4115-271">Return value</span></span>                                                     | <span data-ttu-id="c4115-272">交易</span><span class="sxs-lookup"><span data-stu-id="c4115-272">Transaction</span></span>                                                                                                                                                                                                                                                                                                                                                                                    |
|----------------------|------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="c4115-273">XCLASS \_ BOOL</span><span class="sxs-lookup"><span data-stu-id="c4115-273">XCLASS\_BOOL</span></span>         | <span data-ttu-id="c4115-274">**TRUE** 或 **FALSE**</span><span class="sxs-lookup"><span data-stu-id="c4115-274">**TRUE** or **FALSE**</span></span>                                            | [<span data-ttu-id="c4115-275">**XTYP \_ ADVSTART**</span><span class="sxs-lookup"><span data-stu-id="c4115-275">**XTYP\_ADVSTART**</span></span>](xtyp-advstart.md)<br/> [<span data-ttu-id="c4115-276">**XTYP \_ 連接**</span><span class="sxs-lookup"><span data-stu-id="c4115-276">**XTYP\_CONNECT**</span></span>](xtyp-connect.md)<br/>                                                                                                                                                                                                                                                                                            |
| <span data-ttu-id="c4115-277">XCLASS \_ 資料</span><span class="sxs-lookup"><span data-stu-id="c4115-277">XCLASS\_DATA</span></span>         | <span data-ttu-id="c4115-278">資料控制碼、CBR \_ 區塊傳回碼或 **Null**</span><span class="sxs-lookup"><span data-stu-id="c4115-278">A data handle, the CBR\_BLOCK return code, or **NULL**</span></span>           | [<span data-ttu-id="c4115-279">**XTYP \_ ADVREQ**</span><span class="sxs-lookup"><span data-stu-id="c4115-279">**XTYP\_ADVREQ**</span></span>](xtyp-advreq.md)<br/> [<span data-ttu-id="c4115-280">**XTYP \_ 要求**</span><span class="sxs-lookup"><span data-stu-id="c4115-280">**XTYP\_REQUEST**</span></span>](xtyp-request.md)<br/> [<span data-ttu-id="c4115-281">**XTYP \_ WILDCONNECT**</span><span class="sxs-lookup"><span data-stu-id="c4115-281">**XTYP\_WILDCONNECT**</span></span>](xtyp-wildconnect.md)<br/>                                                                                                                                                                                                                                       |
| <span data-ttu-id="c4115-282">XCLASS \_ 旗標</span><span class="sxs-lookup"><span data-stu-id="c4115-282">XCLASS\_FLAGS</span></span>        | <span data-ttu-id="c4115-283">交易旗標： DDE \_ FACK、dde \_ FBUSY 或 dde \_ FNOTPROCESSED</span><span class="sxs-lookup"><span data-stu-id="c4115-283">A transaction flag: DDE\_FACK, DDE\_FBUSY, or DDE\_FNOTPROCESSED</span></span> | [<span data-ttu-id="c4115-284">**XTYP \_ ADVDATA**</span><span class="sxs-lookup"><span data-stu-id="c4115-284">**XTYP\_ADVDATA**</span></span>](xtyp-advdata.md)<br/> [<span data-ttu-id="c4115-285">**XTYP \_ EXECUTE**</span><span class="sxs-lookup"><span data-stu-id="c4115-285">**XTYP\_EXECUTE**</span></span>](xtyp-execute.md)<br/> [<span data-ttu-id="c4115-286">**XTYP \_**</span><span class="sxs-lookup"><span data-stu-id="c4115-286">**XTYP\_POKE**</span></span>](xtyp-poke.md)<br/>                                                                                                                                                                                                                                                   |
| <span data-ttu-id="c4115-287">XCLASS \_ 通知</span><span class="sxs-lookup"><span data-stu-id="c4115-287">XCLASS\_NOTIFICATION</span></span> | <span data-ttu-id="c4115-288">無</span><span class="sxs-lookup"><span data-stu-id="c4115-288">None</span></span>                                                             | [<span data-ttu-id="c4115-289">**XTYP \_ ADVSTOP**</span><span class="sxs-lookup"><span data-stu-id="c4115-289">**XTYP\_ADVSTOP**</span></span>](xtyp-advstop.md)<br/> [<span data-ttu-id="c4115-290">**XTYP \_ CONNECT \_ 確認**</span><span class="sxs-lookup"><span data-stu-id="c4115-290">**XTYP\_CONNECT\_CONFIRM**</span></span>](xtyp-connect-confirm.md)<br/> [<span data-ttu-id="c4115-291">**XTYP \_ 中斷連線**</span><span class="sxs-lookup"><span data-stu-id="c4115-291">**XTYP\_DISCONNECT**</span></span>](xtyp-disconnect.md)<br/> [<span data-ttu-id="c4115-292">**XTYP \_ 錯誤**</span><span class="sxs-lookup"><span data-stu-id="c4115-292">**XTYP\_ERROR**</span></span>](xtyp-error.md)<br/> [<span data-ttu-id="c4115-293">**XTYP \_ 註冊**</span><span class="sxs-lookup"><span data-stu-id="c4115-293">**XTYP\_REGISTER**</span></span>](xtyp-register.md)<br/> [<span data-ttu-id="c4115-294">**XTYP \_ 取消註冊**</span><span class="sxs-lookup"><span data-stu-id="c4115-294">**XTYP\_UNREGISTER**</span></span>](xtyp-unregister.md)<br/> [<span data-ttu-id="c4115-295">**XTYP \_ 交易 \_ 完成**</span><span class="sxs-lookup"><span data-stu-id="c4115-295">**XTYP\_XACT\_COMPLETE**</span></span>](xtyp-xact-complete.md)<br/> |



 

## <a name="transaction-types"></a><span data-ttu-id="c4115-296">交易類型</span><span class="sxs-lookup"><span data-stu-id="c4115-296">Transaction Types</span></span>

<span data-ttu-id="c4115-297">每個 DDE 交易類型都有接收者和相關聯的活動，可讓 DDEML 產生每個型別。</span><span class="sxs-lookup"><span data-stu-id="c4115-297">Each DDE transaction type has a receiver and an associated activity that causes the DDEML to generate each type.</span></span>



| <span data-ttu-id="c4115-298">交易類型</span><span class="sxs-lookup"><span data-stu-id="c4115-298">Transaction type</span></span>                                       | <span data-ttu-id="c4115-299">接收者</span><span class="sxs-lookup"><span data-stu-id="c4115-299">Receiver</span></span>                   | <span data-ttu-id="c4115-300">原因</span><span class="sxs-lookup"><span data-stu-id="c4115-300">Cause</span></span>                                                                                                                                                                         |
|--------------------------------------------------------|----------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="c4115-301">**XTYP \_ ADVDATA**</span><span class="sxs-lookup"><span data-stu-id="c4115-301">**XTYP\_ADVDATA**</span></span>](xtyp-advdata.md)                  | <span data-ttu-id="c4115-302">用戶端</span><span class="sxs-lookup"><span data-stu-id="c4115-302">Client</span></span>                     | <span data-ttu-id="c4115-303">伺服器藉由傳回資料處理程式來回應 [**XTYP \_ ADVREQ**](xtyp-advreq.md) 交易。</span><span class="sxs-lookup"><span data-stu-id="c4115-303">A server responded to an [**XTYP\_ADVREQ**](xtyp-advreq.md) transaction by returning a data handle.</span></span>                                                                          |
| [<span data-ttu-id="c4115-304">**XTYP \_ ADVREQ**</span><span class="sxs-lookup"><span data-stu-id="c4115-304">**XTYP\_ADVREQ**</span></span>](xtyp-advreq.md)                    | <span data-ttu-id="c4115-305">伺服器</span><span class="sxs-lookup"><span data-stu-id="c4115-305">Server</span></span>                     | <span data-ttu-id="c4115-306">稱為 [**DdePostAdvise**](/windows/desktop/api/Ddeml/nf-ddeml-ddepostadvise) 函數的伺服器，指出建議迴圈中資料項目的值已變更。</span><span class="sxs-lookup"><span data-stu-id="c4115-306">A server called the [**DdePostAdvise**](/windows/desktop/api/Ddeml/nf-ddeml-ddepostadvise) function, indicating that the value of a data item in an advise loop had changed.</span></span>                                  |
| [<span data-ttu-id="c4115-307">**XTYP \_ ADVSTART**</span><span class="sxs-lookup"><span data-stu-id="c4115-307">**XTYP\_ADVSTART**</span></span>](xtyp-advstart.md)                | <span data-ttu-id="c4115-308">伺服器</span><span class="sxs-lookup"><span data-stu-id="c4115-308">Server</span></span>                     | <span data-ttu-id="c4115-309">用戶端在 [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction)函數的呼叫中指定了 [**XTYP \_ ADVSTART**](xtyp-advstart.md)交易類型。</span><span class="sxs-lookup"><span data-stu-id="c4115-309">A client specified the [**XTYP\_ADVSTART**](xtyp-advstart.md) transaction type in a call to the [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction) function.</span></span>               |
| [<span data-ttu-id="c4115-310">**XTYP \_ ADVSTOP**</span><span class="sxs-lookup"><span data-stu-id="c4115-310">**XTYP\_ADVSTOP**</span></span>](xtyp-advstop.md)                  | <span data-ttu-id="c4115-311">伺服器</span><span class="sxs-lookup"><span data-stu-id="c4115-311">Server</span></span>                     | <span data-ttu-id="c4115-312">用戶端在對 [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction)的呼叫中指定了 [**XTYP \_ ADVSTOP**](xtyp-advstop.md)交易類型。</span><span class="sxs-lookup"><span data-stu-id="c4115-312">A client specified the [**XTYP\_ADVSTOP**](xtyp-advstop.md) transaction type in a call to [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction).</span></span>                              |
| [<span data-ttu-id="c4115-313">**XTYP \_ 連接**</span><span class="sxs-lookup"><span data-stu-id="c4115-313">**XTYP\_CONNECT**</span></span>](xtyp-connect.md)                  | <span data-ttu-id="c4115-314">伺服器</span><span class="sxs-lookup"><span data-stu-id="c4115-314">Server</span></span>                     | <span data-ttu-id="c4115-315">稱為 [**DdeConnect**](/windows/desktop/api/Ddeml/nf-ddeml-ddeconnect) 函式的用戶端，並指定伺服器所支援的服務名稱和主題名稱。</span><span class="sxs-lookup"><span data-stu-id="c4115-315">A client called the [**DdeConnect**](/windows/desktop/api/Ddeml/nf-ddeml-ddeconnect) function and specified a service name and topic name supported by the server.</span></span>                                            |
| [<span data-ttu-id="c4115-316">**XTYP \_ CONNECT \_ 確認**</span><span class="sxs-lookup"><span data-stu-id="c4115-316">**XTYP\_CONNECT\_CONFIRM**</span></span>](xtyp-connect-confirm.md) | <span data-ttu-id="c4115-317">伺服器</span><span class="sxs-lookup"><span data-stu-id="c4115-317">Server</span></span>                     | <span data-ttu-id="c4115-318">伺服器傳回 **TRUE** 以回應 [**XTYP \_ CONNECT**](xtyp-connect.md) 或 [**XTYP \_ WILDCONNECT**](xtyp-wildconnect.md) 交易。</span><span class="sxs-lookup"><span data-stu-id="c4115-318">The server returned **TRUE** in response to an [**XTYP\_CONNECT**](xtyp-connect.md) or [**XTYP\_WILDCONNECT**](xtyp-wildconnect.md) transaction.</span></span>                            |
| [<span data-ttu-id="c4115-319">**XTYP \_ 中斷連線**</span><span class="sxs-lookup"><span data-stu-id="c4115-319">**XTYP\_DISCONNECT**</span></span>](xtyp-disconnect.md)            | <span data-ttu-id="c4115-320">用戶端/伺服器</span><span class="sxs-lookup"><span data-stu-id="c4115-320">Client/Server</span></span>              | <span data-ttu-id="c4115-321">交談中名為 [**DdeDisconnect**](/windows/desktop/api/Ddeml/nf-ddeml-ddedisconnect) 函式的夥伴，會導致這兩個夥伴接收此交易。</span><span class="sxs-lookup"><span data-stu-id="c4115-321">A partner in a conversation called the [**DdeDisconnect**](/windows/desktop/api/Ddeml/nf-ddeml-ddedisconnect) function, causing both partners to receive this transaction.</span></span>                                    |
| [<span data-ttu-id="c4115-322">**XTYP \_ 錯誤**</span><span class="sxs-lookup"><span data-stu-id="c4115-322">**XTYP\_ERROR**</span></span>](xtyp-error.md)                      | <span data-ttu-id="c4115-323">用戶端/伺服器</span><span class="sxs-lookup"><span data-stu-id="c4115-323">Client/Server</span></span>              | <span data-ttu-id="c4115-324">發生嚴重錯誤。</span><span class="sxs-lookup"><span data-stu-id="c4115-324">A critical error has occurred.</span></span> <span data-ttu-id="c4115-325">DDEML 可能沒有足夠的資源可以繼續。</span><span class="sxs-lookup"><span data-stu-id="c4115-325">The DDEML may not have sufficient resources to continue.</span></span>                                                                                       |
| [<span data-ttu-id="c4115-326">**XTYP \_ EXECUTE**</span><span class="sxs-lookup"><span data-stu-id="c4115-326">**XTYP\_EXECUTE**</span></span>](xtyp-execute.md)                  | <span data-ttu-id="c4115-327">伺服器</span><span class="sxs-lookup"><span data-stu-id="c4115-327">Server</span></span>                     | <span data-ttu-id="c4115-328">用戶端在呼叫 [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction)時指定了 [**XTYP \_ EXECUTE**](xtyp-execute.md)交易類型。</span><span class="sxs-lookup"><span data-stu-id="c4115-328">A client specified the [**XTYP\_EXECUTE**](xtyp-execute.md) transaction type in a call to [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction).</span></span>                              |
| [<span data-ttu-id="c4115-329">**XTYP \_ 監視**</span><span class="sxs-lookup"><span data-stu-id="c4115-329">**XTYP\_MONITOR**</span></span>](xtyp-monitor.md)                  | <span data-ttu-id="c4115-330">DDE 監視應用程式</span><span class="sxs-lookup"><span data-stu-id="c4115-330">DDE monitoring application</span></span> | <span data-ttu-id="c4115-331">系統中發生 DDE 事件。</span><span class="sxs-lookup"><span data-stu-id="c4115-331">A DDE event occurred in the system.</span></span> <span data-ttu-id="c4115-332">如需有關 DDE 監視應用程式的詳細資訊，請參閱 [監視應用程式](monitoring-applications.md)。</span><span class="sxs-lookup"><span data-stu-id="c4115-332">For more information about DDE monitoring applications, see [Monitoring Applications](monitoring-applications.md).</span></span>                       |
| [<span data-ttu-id="c4115-333">**XTYP \_**</span><span class="sxs-lookup"><span data-stu-id="c4115-333">**XTYP\_POKE**</span></span>](xtyp-poke.md)                        | <span data-ttu-id="c4115-334">伺服器</span><span class="sxs-lookup"><span data-stu-id="c4115-334">Server</span></span>                     | <span data-ttu-id="c4115-335">用戶端在呼叫 [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction)時，指定了 [**XTYP \_**](xtyp-poke.md)的處理類型。</span><span class="sxs-lookup"><span data-stu-id="c4115-335">A client specified the [**XTYP\_POKE**](xtyp-poke.md) transaction type in a call to [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction).</span></span>                                    |
| [<span data-ttu-id="c4115-336">**XTYP \_ 註冊**</span><span class="sxs-lookup"><span data-stu-id="c4115-336">**XTYP\_REGISTER**</span></span>](xtyp-register.md)                | <span data-ttu-id="c4115-337">用戶端/伺服器</span><span class="sxs-lookup"><span data-stu-id="c4115-337">Client/Server</span></span>              | <span data-ttu-id="c4115-338">伺服器應用程式使用 [**DdeNameService**](/windows/desktop/api/Ddeml/nf-ddeml-ddenameservice) 函數來註冊服務名稱。</span><span class="sxs-lookup"><span data-stu-id="c4115-338">A server application used the [**DdeNameService**](/windows/desktop/api/Ddeml/nf-ddeml-ddenameservice) function to register a service name.</span></span>                                                                   |
| [<span data-ttu-id="c4115-339">**XTYP \_ 要求**</span><span class="sxs-lookup"><span data-stu-id="c4115-339">**XTYP\_REQUEST**</span></span>](xtyp-request.md)                  | <span data-ttu-id="c4115-340">伺服器</span><span class="sxs-lookup"><span data-stu-id="c4115-340">Server</span></span>                     | <span data-ttu-id="c4115-341">用戶端在呼叫 [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction)時指定了 [**XTYP \_ 要求**](xtyp-request.md)交易類型。</span><span class="sxs-lookup"><span data-stu-id="c4115-341">A client specified the [**XTYP\_REQUEST**](xtyp-request.md) transaction type in a call to [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction).</span></span>                              |
| [<span data-ttu-id="c4115-342">**XTYP \_ 取消註冊**</span><span class="sxs-lookup"><span data-stu-id="c4115-342">**XTYP\_UNREGISTER**</span></span>](xtyp-unregister.md)            | <span data-ttu-id="c4115-343">用戶端/伺服器</span><span class="sxs-lookup"><span data-stu-id="c4115-343">Client/Server</span></span>              | <span data-ttu-id="c4115-344">使用 [**DdeNameService**](/windows/desktop/api/Ddeml/nf-ddeml-ddenameservice) 取消註冊服務名稱的伺服器應用程式。</span><span class="sxs-lookup"><span data-stu-id="c4115-344">A server application used [**DdeNameService**](/windows/desktop/api/Ddeml/nf-ddeml-ddenameservice) to unregister a service name.</span></span>                                                                              |
| [<span data-ttu-id="c4115-345">**XTYP \_ WILDCONNECT**</span><span class="sxs-lookup"><span data-stu-id="c4115-345">**XTYP\_WILDCONNECT**</span></span>](xtyp-wildconnect.md)          | <span data-ttu-id="c4115-346">伺服器</span><span class="sxs-lookup"><span data-stu-id="c4115-346">Server</span></span>                     | <span data-ttu-id="c4115-347">稱為 [**DdeConnect**](/windows/desktop/api/Ddeml/nf-ddeml-ddeconnect) 或 [**DdeConnectList**](/windows/desktop/api/Ddeml/nf-ddeml-ddeconnectlist) 函式的用戶端，針對服務名稱指定 **Null** 、主題名稱或兩者。</span><span class="sxs-lookup"><span data-stu-id="c4115-347">A client called the [**DdeConnect**](/windows/desktop/api/Ddeml/nf-ddeml-ddeconnect) or [**DdeConnectList**](/windows/desktop/api/Ddeml/nf-ddeml-ddeconnectlist) function, specifying **NULL** for the service name, the topic name, or both.</span></span> |
| [<span data-ttu-id="c4115-348">**XTYP \_ 交易 \_ 完成**</span><span class="sxs-lookup"><span data-stu-id="c4115-348">**XTYP\_XACT\_COMPLETE**</span></span>](xtyp-xact-complete.md)     | <span data-ttu-id="c4115-349">用戶端</span><span class="sxs-lookup"><span data-stu-id="c4115-349">Client</span></span>                     | <span data-ttu-id="c4115-350">非同步交易（當用戶端在 \_ 呼叫 [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction)的呼叫中指定 TIMEOUT ASYNC 旗標時傳送）已結束。</span><span class="sxs-lookup"><span data-stu-id="c4115-350">An asynchronous transaction, sent when the client specified the TIMEOUT\_ASYNC flag in a call to [**DdeClientTransaction**](/windows/desktop/api/Ddeml/nf-ddeml-ddeclienttransaction), has concluded.</span></span>         |



 

 

