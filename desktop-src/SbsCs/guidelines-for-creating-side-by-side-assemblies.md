---
description: 下列指導方針討論如何撰寫您自己的 COM 或 Win32 並存元件。
ms.assetid: e10fe92c-bce8-420e-a84c-2748e929eb1b
title: 建立並存元件的指導方針
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: af8e8fd2bd31a65477b44d3afcf2156d5160a72a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104112713"
---
# <a name="guidelines-for-creating-side-by-side-assemblies"></a><span data-ttu-id="cecfe-103">建立並存元件的指導方針</span><span class="sxs-lookup"><span data-stu-id="cecfe-103">Guidelines for Creating Side-by-side Assemblies</span></span>

<span data-ttu-id="cecfe-104">下列指導方針討論如何撰寫您自己的 COM 或 Win32 並存元件。</span><span class="sxs-lookup"><span data-stu-id="cecfe-104">The following guidelines discuss how to author your own COM or Win32 side-by-side assemblies.</span></span> <span data-ttu-id="cecfe-105">如果所需的功能是由其中一個 [支援的 Microsoft 並存元件](supported-microsoft-side-by-side-assemblies.md)所提供，您可能不需要建立自己的並存元件。</span><span class="sxs-lookup"><span data-stu-id="cecfe-105">You may not need to create your own side-by-side assemblies if the functionality needed is provided by one of the [supported Microsoft side-by-side assemblies](supported-microsoft-side-by-side-assemblies.md).</span></span> <span data-ttu-id="cecfe-106">在此情況下，請使用 Microsoft 提供的元件，並遵循在 [使用隔離的應用程式和並存元件](using-isolated-applications-and-side-by-side-assemblies.md)中使用並存元件的程式。</span><span class="sxs-lookup"><span data-stu-id="cecfe-106">In this case, use the assemblies provided by Microsoft and follow the procedures for using side-by-side assemblies in [Using Isolated Applications and Side-by-side Assemblies](using-isolated-applications-and-side-by-side-assemblies.md).</span></span>

<span data-ttu-id="cecfe-107">首先，請考慮您的元件是否為並存元件提供合適的候選。</span><span class="sxs-lookup"><span data-stu-id="cecfe-107">First, consider whether your component makes a suitable candidate for a side-by-side assembly.</span></span> <span data-ttu-id="cecfe-108">如需詳細資訊，請參閱是否 [應將共用元件提供為並存元件？](should-you-provide-a-shared-component-as-a-side-by-side-assembly.md)</span><span class="sxs-lookup"><span data-stu-id="cecfe-108">For more information, see [Should you provide a shared component as a side-by-side assembly?](should-you-provide-a-shared-component-as-a-side-by-side-assembly.md)</span></span>

<span data-ttu-id="cecfe-109">若要建立並存元件，請遵循下列指導方針：</span><span class="sxs-lookup"><span data-stu-id="cecfe-109">To create a side-by-side assembly, follow these guidelines:</span></span>

-   <span data-ttu-id="cecfe-110">決定要包含在元件中的資源。</span><span class="sxs-lookup"><span data-stu-id="cecfe-110">Decide which resources to include in the assembly.</span></span> <span data-ttu-id="cecfe-111">請記住，元件是由一或多個永遠提供給應用程式和客戶的檔案所組成。</span><span class="sxs-lookup"><span data-stu-id="cecfe-111">Keep in mind that an assembly consists of one or more files that are always provided to applications and customers together.</span></span> <span data-ttu-id="cecfe-112">元件是用來命名、系結、版本控制、部署和 [預設](default-configuration.md)設定的基礎單位。</span><span class="sxs-lookup"><span data-stu-id="cecfe-112">The assembly serves as the fundamental unit used for naming, binding, versioning, deployment, and [default configuration](default-configuration.md).</span></span> <span data-ttu-id="cecfe-113">一般而言，如果不確定兩個資源是否屬於相同的元件，建議您將它們撰寫成可移至不同的元件。</span><span class="sxs-lookup"><span data-stu-id="cecfe-113">As a general rule, when uncertain about whether two resources belong in the same assembly, it is recommended that they be authored to go into separate assemblies.</span></span> <span data-ttu-id="cecfe-114">通常，並存元件是由單一 DLL 組成。</span><span class="sxs-lookup"><span data-stu-id="cecfe-114">Typically, a side-by-side assembly consists of a single DLL.</span></span>
-   <span data-ttu-id="cecfe-115">建立元件的程式集 [清單](manifests.md) 。</span><span class="sxs-lookup"><span data-stu-id="cecfe-115">Create an assembly [manifest](manifests.md) for the assembly.</span></span> <span data-ttu-id="cecfe-116">資訊清單應該描述元件中的 COM 物件或類型程式庫。</span><span class="sxs-lookup"><span data-stu-id="cecfe-116">The manifest should describe the COM object or type libraries in the assembly.</span></span> <span data-ttu-id="cecfe-117">如需有關要在組件資訊清單中編寫哪些內容的詳細資訊，請參閱 [程式集](assembly-manifests.md)清單。</span><span class="sxs-lookup"><span data-stu-id="cecfe-117">For more information about what should be authored into an assembly manifest, see [assembly manifests](assembly-manifests.md).</span></span>
-   <span data-ttu-id="cecfe-118">當您在系統上執行一個以上的元件版本時，請評估物件的使用方式。</span><span class="sxs-lookup"><span data-stu-id="cecfe-118">Evaluate the usage of objects when more than one version of your assembly is run on the system.</span></span> <span data-ttu-id="cecfe-119">判斷元件的不同版本是否需要個別的資料結構，例如記憶體對應檔、具名管道、已註冊的 Windows 訊息和類別、共用記憶體、信號、mutex 和硬體驅動程式。</span><span class="sxs-lookup"><span data-stu-id="cecfe-119">Determine whether different versions of the assembly require separate data structures, such as memory-mapped files, named pipes, registered Windows messages and classes, shared memory, semaphores, mutexes, and hardware drivers.</span></span> <span data-ttu-id="cecfe-120">跨元件版本使用的任何資料結構都必須是回溯相容的版本。</span><span class="sxs-lookup"><span data-stu-id="cecfe-120">Any data structures used across assembly versions must be backward-compatible versions.</span></span> <span data-ttu-id="cecfe-121">決定可在不同版本之間使用的資料結構，以及哪些資料結構必須是私用的版本。</span><span class="sxs-lookup"><span data-stu-id="cecfe-121">Decide which data structures can be used across versions and which data structures must be private to a version.</span></span> <span data-ttu-id="cecfe-122">判斷共用資料結構是否需要個別的同步處理物件，例如信號和 mutex。</span><span class="sxs-lookup"><span data-stu-id="cecfe-122">Determine whether shared data structures require separate synchronization objects such as semaphores and mutexes.</span></span>
-   <span data-ttu-id="cecfe-123">藉由遵循 [針對並存元件撰寫 DLL](authoring-a-dll-for-a-side-by-side-assembly.md)的指導方針，撰寫您的 DLL 以做為並存元件。</span><span class="sxs-lookup"><span data-stu-id="cecfe-123">Author your DLL to work well as a side-by-side assembly by adhering to the guidelines in [Authoring a DLL for a Side-by-Side Assembly](authoring-a-dll-for-a-side-by-side-assembly.md).</span></span>
-   <span data-ttu-id="cecfe-124">撰寫一組標頭檔和 helper 函式，以提供簡單的方式來將包含元件狀態的登錄機碼設定為版本。</span><span class="sxs-lookup"><span data-stu-id="cecfe-124">Author a set of header files and helper functions to provide an easy way to version registry keys containing the assembly state.</span></span> <span data-ttu-id="cecfe-125">元件通常會將其狀態設定儲存在登錄機碼中。</span><span class="sxs-lookup"><span data-stu-id="cecfe-125">Assemblies commonly save their state settings in registry keys.</span></span> <span data-ttu-id="cecfe-126">登錄設定必須以個別版本撰寫，以隔離可同時執行的多個元件版本。</span><span class="sxs-lookup"><span data-stu-id="cecfe-126">Registry settings must be written on an individual version basis to isolate multiple assembly versions that may be run at the same time.</span></span> <span data-ttu-id="cecfe-127">設計並存元件和 DLL，在並存共用案例期間，正確地儲存和處理元件的狀態。</span><span class="sxs-lookup"><span data-stu-id="cecfe-127">Design your side-by-side assembly and DLL to correctly store and handle the state of the assembly during side-by-side sharing scenarios.</span></span> <span data-ttu-id="cecfe-128">遵循 [針對並存元件撰寫狀態儲存體](authoring-state-storage-for-side-by-side-assemblies.md)中的指導方針。</span><span class="sxs-lookup"><span data-stu-id="cecfe-128">Follow the guidelines in [Authoring State Storage for Side-by-Side Assemblies](authoring-state-storage-for-side-by-side-assemblies.md).</span></span>
-   <span data-ttu-id="cecfe-129">使用 [私用元件](/windows/desktop/Msi/private-assemblies) 的應用程式開發人員應該保護應用程式目錄。</span><span class="sxs-lookup"><span data-stu-id="cecfe-129">Developers of applications that use [private assemblies](/windows/desktop/Msi/private-assemblies) should secure the application directory.</span></span> <span data-ttu-id="cecfe-130">如果使用 [Windows Installer](../msi/windows-installer-portal.md)安裝應用程式，則可以使用 LockPermissions 資料表來保護應用程式目錄。</span><span class="sxs-lookup"><span data-stu-id="cecfe-130">If the application is installed using the [Windows Installer](../msi/windows-installer-portal.md), then the application directory can be secured by using the LockPermissions table.</span></span> <span data-ttu-id="cecfe-131">一般而言，系統會提供私用元件的讀取、寫入和執行存取權;所有其他進程僅提供執行和讀取存取權。</span><span class="sxs-lookup"><span data-stu-id="cecfe-131">Typically, the system is given read, write, and execute access to private assemblies; all other processes are given only execute and read access.</span></span>
-   <span data-ttu-id="cecfe-132">使用並存共用的案例來測試元件，以確保它是有效的並存元件。</span><span class="sxs-lookup"><span data-stu-id="cecfe-132">Test the assembly using scenarios with side-by-side sharing to ensure that it is a valid side-by-side assembly.</span></span> <span data-ttu-id="cecfe-133">成功安裝元件並不足以保證它會如預期般運作。</span><span class="sxs-lookup"><span data-stu-id="cecfe-133">Successful installation of the assembly is not sufficient to guarantee that it will work as expected.</span></span>
-   <span data-ttu-id="cecfe-134">採用方法來為您的元件編號更新。</span><span class="sxs-lookup"><span data-stu-id="cecfe-134">Adopt a method for numbering updates for your assembly.</span></span> <span data-ttu-id="cecfe-135">每個元件都與四部分版本號碼相關聯。</span><span class="sxs-lookup"><span data-stu-id="cecfe-135">Each assembly is associated with a four-part version number.</span></span> <span data-ttu-id="cecfe-136">從左至右，主要、次要、組建和修訂部分會以句號分隔。</span><span class="sxs-lookup"><span data-stu-id="cecfe-136">Left-to-right, the major, minor, build, and revision parts are separated by periods.</span></span> <span data-ttu-id="cecfe-137">針對與舊版不相容的版本，變更元件的主要或次要數目。</span><span class="sxs-lookup"><span data-stu-id="cecfe-137">Change the major or minor number of an assembly for a version that is incompatible with earlier versions.</span></span> <span data-ttu-id="cecfe-138">只變更元件的回溯相容性變更的組建和修訂部分。</span><span class="sxs-lookup"><span data-stu-id="cecfe-138">Change only the build and revision parts for backward-compatible changes to the assembly.</span></span> <span data-ttu-id="cecfe-139">例如，開發人員可能會採用所有1.0.0 的編號方法。 \* 版本號碼指的是元件1.0.0.0 版的更新版本。</span><span class="sxs-lookup"><span data-stu-id="cecfe-139">For example, a developer might adopt a numbering method in which all 1.0.0.\* version numbers refer to update versions to assembly version 1.0.0.0.</span></span>

 

 
