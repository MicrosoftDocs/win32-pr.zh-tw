---
description: COM + CRM 疑難排解
ms.assetid: 4d2d9372-b540-4e08-9b57-8687802610b6
title: COM + CRM 疑難排解
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1b04e37d183dbf3df8d017e780917f955e14a033
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104510627"
---
# <a name="troubleshooting-the-com-crm"></a><span data-ttu-id="2e84f-103">COM + CRM 疑難排解</span><span class="sxs-lookup"><span data-stu-id="2e84f-103">Troubleshooting the COM+ CRM</span></span>

<span data-ttu-id="2e84f-104">以下是開發和使用 COM + CRM 時最常遇到的問題：</span><span class="sxs-lookup"><span data-stu-id="2e84f-104">Following are the most common problems encountered when developing and using the COM+ CRM:</span></span>

-   <span data-ttu-id="2e84f-105">**事件記錄檔訊息。**</span><span class="sxs-lookup"><span data-stu-id="2e84f-105">**Event log messages.**</span></span> <span data-ttu-id="2e84f-106">如果 CRM 伺服器應用程式遇到嚴重的內部錯誤，則會產生 failfast (終止 CRM 伺服器應用程式進程) 並將訊息寫入 Windows 事件記錄檔。</span><span class="sxs-lookup"><span data-stu-id="2e84f-106">If the CRM server application encounters a serious internal error, it will failfast (terminate the CRM server application process) and write a message to the Windows event log.</span></span> <span data-ttu-id="2e84f-107">如果遇到任何問題，請參閱事件記錄檔。</span><span class="sxs-lookup"><span data-stu-id="2e84f-107">Please refer to the event log if any problems are encountered.</span></span>

-   <span data-ttu-id="2e84f-108">**CRM 補償器的例外狀況。**</span><span class="sxs-lookup"><span data-stu-id="2e84f-108">**Exceptions from the CRM Compensator.**</span></span> <span data-ttu-id="2e84f-109">CRM 基礎結構會建立 CRM 補償器，並將交易結果通知和 CRM 背景工作所寫入的記錄檔記錄傳遞給它。</span><span class="sxs-lookup"><span data-stu-id="2e84f-109">The CRM infrastructure creates the CRM Compensator and passes it the transaction outcome notifications and the log records written by the CRM Worker.</span></span> <span data-ttu-id="2e84f-110">如果 CRM 補償器傳回錯誤或擲回例外狀況，則會由 CRM 基礎結構攔截，並造成 failfast。</span><span class="sxs-lookup"><span data-stu-id="2e84f-110">If the CRM Compensator returns an error or throws an exception, it is caught by the CRM infrastructure and causes a failfast.</span></span> <span data-ttu-id="2e84f-111">事件記錄檔中的訊息表示從 CRM 補償器收到例外狀況。</span><span class="sxs-lookup"><span data-stu-id="2e84f-111">A message in the event log indicates that an exception was received from the CRM Compensator.</span></span> <span data-ttu-id="2e84f-112">您可以強制忽略這些例外狀況。</span><span class="sxs-lookup"><span data-stu-id="2e84f-112">It is possible to force these exceptions to be ignored.</span></span> <span data-ttu-id="2e84f-113"> (，請參閱 [Com + CRM 登錄設定](com--crm-registry-settings.md)。從 crm 補償器 ) 例外狀況，很可能表示特定 crm 補償器元件中的問題，而不是在 crm 基礎結構本身。</span><span class="sxs-lookup"><span data-stu-id="2e84f-113">(See [COM+ CRM Registry Settings](com--crm-registry-settings.md).) Exceptions from the CRM Compensator most likely mean a problem in the specific CRM Compensator component and not in the CRM infrastructure itself.</span></span>

-   <span data-ttu-id="2e84f-114">**復原追蹤。**</span><span class="sxs-lookup"><span data-stu-id="2e84f-114">**Recovery trace.**</span></span> <span data-ttu-id="2e84f-115">復原追蹤有助於判斷復原期間的問題。</span><span class="sxs-lookup"><span data-stu-id="2e84f-115">The recovery trace can be very useful to determine problems during recovery.</span></span> <span data-ttu-id="2e84f-116">如需啟用修復追蹤的詳細資訊，請參閱 [Com + CRM 登錄設定](com--crm-registry-settings.md)。</span><span class="sxs-lookup"><span data-stu-id="2e84f-116">For information about enabling recovery trace, see [COM+ CRM Registry Settings](com--crm-registry-settings.md).</span></span>

-   <span data-ttu-id="2e84f-117">**嘗試在未啟用 CRM 的情況下執行。**</span><span class="sxs-lookup"><span data-stu-id="2e84f-117">**Trying to run with the CRM not enabled.**</span></span> <span data-ttu-id="2e84f-118">您只需將 CRM 工作者和 CRM 補償器元件放入 COM + 伺服器應用程式中即可。</span><span class="sxs-lookup"><span data-stu-id="2e84f-118">It is not sufficient simply to place the CRM Worker and CRM Compensator components into the COM+ server application.</span></span> <span data-ttu-id="2e84f-119">使用 COM + 應用程式屬性頁之 [ **Advanced** ] 索引標籤上的 [**啟用補償資源管理員**] 選項，就必須特別針對特定的 com + 伺服器應用程式啟用 crm 的支援。</span><span class="sxs-lookup"><span data-stu-id="2e84f-119">Support for CRMs must be specifically enabled for the specific COM+ server application using the **Enable compensating resource managers** option on the **Advanced** tab of the COM+ application's property pages.</span></span> <span data-ttu-id="2e84f-120"> (如需詳細資訊，請參閱設定 [COM + CRM 元件](configuring-com--crm-components.md) 。 ) 如果嘗試在未啟用 crm 的伺服器應用程式內使用 crm，錯誤碼會傳回給 Crm 背景工作。</span><span class="sxs-lookup"><span data-stu-id="2e84f-120">(See [Configuring COM+ CRM Components](configuring-com--crm-components.md) for more information.) If an attempt is made to use a CRM inside a server application that does not have the CRM enabled, an error code is returned to the CRM Worker.</span></span>

-   <span data-ttu-id="2e84f-121">**嘗試在用戶端進程中執行 Crm。**</span><span class="sxs-lookup"><span data-stu-id="2e84f-121">**Trying to run CRMs in client processes.**</span></span> <span data-ttu-id="2e84f-122">Crm 不會在用戶端進程中執行;它們必須在 COM + 伺服器應用程式進程中執行。</span><span class="sxs-lookup"><span data-stu-id="2e84f-122">CRMs do not run in client processes; they must run in a COM+ server application process.</span></span> <span data-ttu-id="2e84f-123">CRM 元件可以放在程式庫封裝中，供多個 COM + 伺服器應用程式使用，但無法在用戶端進程中使用。</span><span class="sxs-lookup"><span data-stu-id="2e84f-123">CRM components can be placed in a library package for use by multiple COM+ server applications, but they are not available for use within client processes.</span></span> <span data-ttu-id="2e84f-124">嘗試在用戶端進程內使用 CRM 介面，會將錯誤碼傳回給 CRM 背景工作。</span><span class="sxs-lookup"><span data-stu-id="2e84f-124">Attempting to use the CRM interfaces inside a client process returns an error code to the CRM Worker.</span></span>

-   <span data-ttu-id="2e84f-125">**正在復原。**</span><span class="sxs-lookup"><span data-stu-id="2e84f-125">**Recovery in progress.**</span></span> <span data-ttu-id="2e84f-126">當 CRM 伺服器應用程式啟動時，就會開始復原。</span><span class="sxs-lookup"><span data-stu-id="2e84f-126">Recovery starts when a CRM server application starts.</span></span> <span data-ttu-id="2e84f-127">不過，復原是在 CRM 伺服器應用程式正常處理期間的背景進行。</span><span class="sxs-lookup"><span data-stu-id="2e84f-127">However, recovery occurs in the background during the normal processing of the CRM server application.</span></span> <span data-ttu-id="2e84f-128">您可以在復原完成之前建立 CRM 背景工作角色。</span><span class="sxs-lookup"><span data-stu-id="2e84f-128">The CRM Worker can be created prior to recovery being completed.</span></span> <span data-ttu-id="2e84f-129">在成功完成復原之前，無法在 CRM 伺服器應用程式進程中使用 Crm。</span><span class="sxs-lookup"><span data-stu-id="2e84f-129">CRMs cannot be used in a CRM server application process until recovery has been successfully completed.</span></span> <span data-ttu-id="2e84f-130">在此情況下，當 CRM 工作者嘗試註冊 CRM 補償器時，會收到「正在復原」錯誤碼。</span><span class="sxs-lookup"><span data-stu-id="2e84f-130">In this case, the CRM Worker receives a "recovery in progress" error code as it tries to register the CRM Compensator.</span></span> <span data-ttu-id="2e84f-131">CRM 工作者應該輪詢或延遲，直到復原完成為止。</span><span class="sxs-lookup"><span data-stu-id="2e84f-131">The CRM Worker should poll or otherwise delay until recovery has been completed.</span></span> <span data-ttu-id="2e84f-132">復原時間是特定類型的 CRM 專屬的，而且在設計 CRM 時應考慮這一點。</span><span class="sxs-lookup"><span data-stu-id="2e84f-132">The recovery time is specific to a particular type of CRM, and this should be considered when designing the CRM.</span></span> <span data-ttu-id="2e84f-133">不需要長時間的復原。</span><span class="sxs-lookup"><span data-stu-id="2e84f-133">Long duration recoveries are not desirable.</span></span>

-   <span data-ttu-id="2e84f-134">**CRM 記錄檔的安全性。**</span><span class="sxs-lookup"><span data-stu-id="2e84f-134">**Security on the CRM log file.**</span></span> <span data-ttu-id="2e84f-135">如果拒絕存取 CRM 記錄檔，請參閱 [Com + Crm 安全性考慮](com--crm-security-considerations.md) ，以取得在 crm 記錄檔上設定安全性的說明。</span><span class="sxs-lookup"><span data-stu-id="2e84f-135">If access to the CRM log file is denied, please see [COM+ CRM Security Considerations](com--crm-security-considerations.md) for a description of how security is set on the CRM log file.</span></span>

-   <span data-ttu-id="2e84f-136">**不確定的交易。**</span><span class="sxs-lookup"><span data-stu-id="2e84f-136">**In-doubt transactions.**</span></span> <span data-ttu-id="2e84f-137">在罕見的情況下，DTC 交易可能會進入不確定狀態;也就是說，DTC 無法判斷交易結果。</span><span class="sxs-lookup"><span data-stu-id="2e84f-137">In rare cases, a DTC transaction might go into the in-doubt state; that is, the DTC cannot determine the transaction outcome.</span></span> <span data-ttu-id="2e84f-138">在這些情況下，在復原期間，CRM 會在 CRM 記錄檔中維護該交易的記錄檔記錄。</span><span class="sxs-lookup"><span data-stu-id="2e84f-138">For these cases, during recovery, the CRM maintains the log records for that transaction in the CRM log file.</span></span> <span data-ttu-id="2e84f-139">當 DTC 解決了不確定的交易時，執行另一個 CRM 復原就會完成交易。</span><span class="sxs-lookup"><span data-stu-id="2e84f-139">When the in-doubt transaction has been resolved by the DTC, performing another CRM recovery completes the transaction.</span></span>

-   <span data-ttu-id="2e84f-140">**CRM 補償器的建立和發行。**</span><span class="sxs-lookup"><span data-stu-id="2e84f-140">**Creation and release of CRM Compensator.**</span></span> <span data-ttu-id="2e84f-141">Crm 產生器第一次由 crm 工作者註冊時，它是由 CRM 基礎結構所建立，並會進行查詢以判斷其所支援的 CRM 補償器介面。</span><span class="sxs-lookup"><span data-stu-id="2e84f-141">The first time a CRM Compensator is registered by a CRM Worker, it is created by the CRM infrastructure and queried to determine which of the CRM Compensator interfaces it supports.</span></span> <span data-ttu-id="2e84f-142">然後立即發行。</span><span class="sxs-lookup"><span data-stu-id="2e84f-142">It is then immediately released.</span></span> <span data-ttu-id="2e84f-143">CRM Compensators 需要支援建立和發行的能力，而不需要任何中間的方法呼叫。</span><span class="sxs-lookup"><span data-stu-id="2e84f-143">CRM Compensators need to support the ability to be created and released without having had any intervening method calls.</span></span> <span data-ttu-id="2e84f-144">如果無法正確建立 CRM 補償器（可能是因為 COM 登錄不正確），或者如果它不支援至少一個正確的 CRM 補償器介面，則錯誤碼會傳回給 CRM 背景工作。</span><span class="sxs-lookup"><span data-stu-id="2e84f-144">If the CRM Compensator cannot be created correctly, perhaps due to incorrect COM registration, or if it does not support at least one of the correct CRM Compensator interfaces, an error code is returned to the CRM Worker.</span></span>

## <a name="related-topics"></a><span data-ttu-id="2e84f-145">相關主題</span><span class="sxs-lookup"><span data-stu-id="2e84f-145">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="2e84f-146">COM + 補償 Resource Manager 概念</span><span class="sxs-lookup"><span data-stu-id="2e84f-146">COM+ Compensating Resource Manager Concepts</span></span>](com--compensating-resource-manager-concepts.md)
</dt> </dl>

 

 



