---
description: COM + 追蹤
ms.assetid: ad3bdeb5-f303-411a-abfb-ccde3f9a86b9
title: COM + 追蹤
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 069d910f0c559776125342b861e71566fb20f45231f960b1c1dcb18262171926
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/11/2021
ms.locfileid: "120029488"
---
# <a name="com-tracking"></a>COM + 追蹤

COM + 追蹤服務可讓您建立自己的管理和診斷程式，以追蹤執行 COM + 應用程式的狀態和效能。 COM + 追蹤提供有關使用 COM + 應用程式的統計資訊，以及狀態資訊，例如 COM + 伺服器應用程式實例是否已暫停或已回收。 工具可以使用診斷監視中的追蹤資訊，或是基於顯示目的。 例如，「元件服務」系統管理工具會使用 COM + 追蹤，在 COM + 應用程式和執行中的進程資料夾中顯示 COM + 應用程式實例的狀態。

COM + 追蹤會計算並定期更新一組常用的計量，讓這項資訊可供需要的程式使用。 它類似于 COM + 檢測，因為這兩個服務都會自動從 COM + 應用程式實例收集資料，並將此資料提供給取用者使用。 不過，這些服務之間有一些重要的差異，包括提供的功能和一般使用方式。 下表摘要說明這些差異。



| COM + 檢測                                                                                                                                                                                                   | COM + 追蹤                                                                                                                                                     |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 更細微的資料。 COM + 檢測服務會通知個別個別事件的已註冊訂閱者 (例如，呼叫的方法、在 COM + 應用程式實例中發生的物件損毀) 。<br/> | 匯總的資料。 COM + 追蹤會計算和定期更新 COM + 應用程式實例狀態和效能的常用計量。<br/> |
| 事件訂閱者通常會使用特定演算法和原則，自行計算計量。<br/>                                                                                                           | COM + 追蹤服務會自動計算度量。 所有取用者都取得相同的資料，但不支援自訂計量。<br/>                |
| 註冊訂用帳戶之後，取用者不會收到任何 COM + 應用程式實例的相關資訊，直到發生事件為止。<br/>                                                                    | 您可以隨時抓取所有 COM + 應用程式實例的追蹤資料。<br/>                                                                         |
| 僅支援取用者以 COM + 事件為基礎的訂用帳戶機制。<br/>                                                                                                                                     | 支援以 COM + 事件為基礎的訂閱機制，以及在 COM 本機伺服器介面上輪詢。<br/>                                                  |
| 範例                                                                                                                                                                                                               |                                                                                                                                                                   |
| 呼叫或傳回方法時的通知。<br/>                                                                                                                                                           | 平均呼叫回應時間、最近一段時間內成功或失敗的方法呼叫數目、目前在方法呼叫中的物件數目。<br/>     |
| 在物件集區中加入或取得物件時的通知。<br/>                                                                                                                                  | 集區中的物件數目、物件的總數。<br/>                                                                                                |
| COM + 伺服器應用程式啟動、暫停或回收時的通知。<br/>                                                                                                                               | COM + 伺服器應用程式進程的狀態 (例如，是否已暫停或回收) 。<br/>                                                         |
| 交易啟動、準備、中止和認可事件的通知。<br/>                                                                                                                                      | 沒有同等項目。<br/>                                                                                                                                         |
| 成功和失敗的方法呼叫層級驗證嘗試的通知。<br/>                                                                                                                           | 沒有同等項目。<br/>                                                                                                                                         |



 

雖然 COM + 追蹤在資料範圍和計算度量方面有更大的彈性，但它所提供的計量應該足以滿足各式各樣的系統管理和診斷程式。 盡可能使用 COM + 追蹤，可以簡化這些程式的設計。 此外，在生產系統中使用 COM + 追蹤可能會大幅降低效能影響，使其更適合用於即時監視工具。

## <a name="how-com-tracking-collects-data"></a>COM + 追蹤如何收集資料

當 COM + 伺服器應用程式進程啟動時，COM + 會向 *追蹤器伺服器*（系統應用程式的元件）註冊處理常式。 COM + 程式庫應用程式和服務中沒有元件 (SWC 的元件) 內容也支援追蹤。 在進程中建立程式庫元件或 SWC 內容時，COM + 會向追蹤器伺服器註冊進程（如果尚未註冊的話）。

當進程中發生特定事件（例如建立物件或完成方法呼叫）時，COM + 會更新追蹤進程的統計資料。 更新的資料會定期提交給追蹤器伺服器，並可供取用者使用。 追蹤器伺服器也負責計算 COM + 應用程式回收和停止回應監視功能所使用的一些計量。 這項資料也可供取用者使用。

追蹤資料會依據產生資料的進程進行組織。 在程式中個別 COM + 應用程式或元件層級的資料，也適用于需要這項資訊的取用者。

## <a name="events-versus-polling"></a>事件與輪詢

COM + 追蹤支援兩種機制，可讓取用者從追蹤器伺服器（以 COM + 事件為基礎的訂閱機制和 COM 本機伺服器介面）取得追蹤資料。

需要定期使用更新的追蹤資料通知的程式，可以為 [**IComTrackingInfoEvents**](/windows/desktop/api/ComSvcs/nn-comsvcs-icomtrackinginfoevents) 事件介面註冊訂用帳戶。 追蹤器伺服器大約每隔三秒，會呼叫每個訂閱者的 [**IComTrackingInfoEvents：： OnNewTrackingInfo**](/windows/desktop/api/ComSvcs/nf-comsvcs-icomtrackinginfoevents-onnewtrackinginfo) 方法，以集合物件的形式傳送最新的追蹤資料。 這個物件會執行 [**IComTrackingInfoCollection**](/windows/desktop/api/ComSvcs/nn-comsvcs-icomtrackinginfocollection) 介面，而訂閱者可以導覽此集合來尋找他們感興趣的資料。

基於各種原因，程式可能更適合讓程式輪詢追蹤器伺服器以取得資料。 例如，監視工具可能需要更新的頻率，比在使用者介面中顯示狀態的程式更少。 此外，程式可能只會使用系統可用的一小部分追蹤資料 (例如，工具可能只會監視單一 COM + 應用程式) 實例的效能。 訂閱模型會將每個通知中所有 COM + 應用程式的追蹤資料傳送給每個訂閱者，而訂閱者必須負責尋找想要的資料。 最後，COM + 事件是最佳的事件通知機制。 未提供可靠的訊息傳遞服務，且沒有任何方法可讓訂閱者偵測追蹤器伺服器無法傳送通知給它。

需要更充分掌控追蹤資料的程式，可以使用追蹤器伺服器的 [**IGetAppTrackerData**](/windows/desktop/api/ComSvcs/nn-comsvcs-igetapptrackerdata) 介面。

 

 




