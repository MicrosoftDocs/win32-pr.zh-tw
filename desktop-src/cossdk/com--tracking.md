---
description: COM + 追蹤
ms.assetid: ad3bdeb5-f303-411a-abfb-ccde3f9a86b9
title: COM + 追蹤
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 828cc87b5a24363fd814d37c29e61a3ce204d988
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104468117"
---
# <a name="com-tracking"></a><span data-ttu-id="c1aed-103">COM + 追蹤</span><span class="sxs-lookup"><span data-stu-id="c1aed-103">COM+ Tracking</span></span>

<span data-ttu-id="c1aed-104">COM + 追蹤服務可讓您建立自己的管理和診斷程式，以追蹤執行 COM + 應用程式的狀態和效能。</span><span class="sxs-lookup"><span data-stu-id="c1aed-104">The COM+ tracking service enables you to build your own administrative and diagnostic programs that track the status and performance of running COM+ applications.</span></span> <span data-ttu-id="c1aed-105">COM + 追蹤提供有關使用 COM + 應用程式的統計資訊，以及狀態資訊，例如 COM + 伺服器應用程式實例是否已暫停或已回收。</span><span class="sxs-lookup"><span data-stu-id="c1aed-105">COM+ tracking provides statistical information about the use of COM+ applications as well as status information, such as whether a COM+ server application instance is paused or has been recycled.</span></span> <span data-ttu-id="c1aed-106">工具可以使用診斷監視中的追蹤資訊，或是基於顯示目的。</span><span class="sxs-lookup"><span data-stu-id="c1aed-106">Tools can use tracking information in diagnostic monitoring or for display purposes.</span></span> <span data-ttu-id="c1aed-107">例如，「元件服務」系統管理工具會使用 COM + 追蹤，在 COM + 應用程式和執行中的進程資料夾中顯示 COM + 應用程式實例的狀態。</span><span class="sxs-lookup"><span data-stu-id="c1aed-107">For example, the Component Services administrative tool uses COM+ tracking to display the status of COM+ application instances in the COM+ Applications and Running Processes folders.</span></span>

<span data-ttu-id="c1aed-108">COM + 追蹤會計算並定期更新一組常用的計量，讓這項資訊可供需要的程式使用。</span><span class="sxs-lookup"><span data-stu-id="c1aed-108">COM+ tracking calculates and periodically updates a set of commonly-used metrics, making this information available to programs that need it.</span></span> <span data-ttu-id="c1aed-109">它類似于 COM + 檢測，因為這兩個服務都會自動從 COM + 應用程式實例收集資料，並將此資料提供給取用者使用。</span><span class="sxs-lookup"><span data-stu-id="c1aed-109">It is similar to COM+ Instrumentation in that both services automatically collect data from COM+ application instances and make this data available to consumers.</span></span> <span data-ttu-id="c1aed-110">不過，這些服務之間有一些重要的差異，包括提供的功能和一般使用方式。</span><span class="sxs-lookup"><span data-stu-id="c1aed-110">However, there are some important differences between these services, both in the functionality provided and typical usage.</span></span> <span data-ttu-id="c1aed-111">下表摘要說明這些差異。</span><span class="sxs-lookup"><span data-stu-id="c1aed-111">The following table summarizes these differences.</span></span>



| <span data-ttu-id="c1aed-112">COM + 檢測</span><span class="sxs-lookup"><span data-stu-id="c1aed-112">COM+ Instrumentation</span></span>                                                                                                                                                                                                   | <span data-ttu-id="c1aed-113">COM + 追蹤</span><span class="sxs-lookup"><span data-stu-id="c1aed-113">COM+ Tracking</span></span>                                                                                                                                                     |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="c1aed-114">更細微的資料。</span><span class="sxs-lookup"><span data-stu-id="c1aed-114">Fine-grained data.</span></span> <span data-ttu-id="c1aed-115">COM + 檢測服務會通知個別個別事件的已註冊訂閱者 (例如，呼叫的方法、在 COM + 應用程式實例中發生的物件損毀) 。</span><span class="sxs-lookup"><span data-stu-id="c1aed-115">The COM+ instrumentation service notifies registered subscribers of individual discrete events (for example, method called, object destroyed) that occur in a COM+ application instance.</span></span><br/> | <span data-ttu-id="c1aed-116">匯總的資料。</span><span class="sxs-lookup"><span data-stu-id="c1aed-116">Aggregated data.</span></span> <span data-ttu-id="c1aed-117">COM + 追蹤會計算和定期更新 COM + 應用程式實例狀態和效能的常用計量。</span><span class="sxs-lookup"><span data-stu-id="c1aed-117">COM+ tracking calculates and periodically updates commonly-used metrics for the status and performance of COM+ application instances.</span></span><br/> |
| <span data-ttu-id="c1aed-118">事件訂閱者通常會使用特定演算法和原則，自行計算計量。</span><span class="sxs-lookup"><span data-stu-id="c1aed-118">Event subscribers typically calculate metrics on their own, using ad-hoc algorithms and policies.</span></span><br/>                                                                                                           | <span data-ttu-id="c1aed-119">COM + 追蹤服務會自動計算度量。</span><span class="sxs-lookup"><span data-stu-id="c1aed-119">Metrics are calculated automatically by the COM+ tracking service.</span></span> <span data-ttu-id="c1aed-120">所有取用者都取得相同的資料，但不支援自訂計量。</span><span class="sxs-lookup"><span data-stu-id="c1aed-120">All consumers get the same data, with no support for custom metrics.</span></span><br/>                |
| <span data-ttu-id="c1aed-121">註冊訂用帳戶之後，取用者不會收到任何 COM + 應用程式實例的相關資訊，直到發生事件為止。</span><span class="sxs-lookup"><span data-stu-id="c1aed-121">After registering a subscription, the consumer does not receive any information about a COM+ application instance until an event occurs.</span></span><br/>                                                                    | <span data-ttu-id="c1aed-122">您可以隨時抓取所有 COM + 應用程式實例的追蹤資料。</span><span class="sxs-lookup"><span data-stu-id="c1aed-122">Tracking data for all COM+ application instances may be retrieved at any time.</span></span><br/>                                                                         |
| <span data-ttu-id="c1aed-123">僅支援取用者以 COM + 事件為基礎的訂用帳戶機制。</span><span class="sxs-lookup"><span data-stu-id="c1aed-123">Supports only a COM+ events-based subscription mechanism for consumers.</span></span><br/>                                                                                                                                     | <span data-ttu-id="c1aed-124">支援以 COM + 事件為基礎的訂閱機制，以及在 COM 本機伺服器介面上輪詢。</span><span class="sxs-lookup"><span data-stu-id="c1aed-124">Supports both a COM+ events-based subscription mechanism and polling on a COM local server interface.</span></span><br/>                                                  |
| <span data-ttu-id="c1aed-125">範例</span><span class="sxs-lookup"><span data-stu-id="c1aed-125">Examples</span></span>                                                                                                                                                                                                               |                                                                                                                                                                   |
| <span data-ttu-id="c1aed-126">呼叫或傳回方法時的通知。</span><span class="sxs-lookup"><span data-stu-id="c1aed-126">Notifications when a method is called or returns.</span></span><br/>                                                                                                                                                           | <span data-ttu-id="c1aed-127">平均呼叫回應時間、最近一段時間內成功或失敗的方法呼叫數目、目前在方法呼叫中的物件數目。</span><span class="sxs-lookup"><span data-stu-id="c1aed-127">Average call response time, number of method calls that succeeded or failed in a recent time period, number of objects currently in a method call.</span></span><br/>     |
| <span data-ttu-id="c1aed-128">在物件集區中加入或取得物件時的通知。</span><span class="sxs-lookup"><span data-stu-id="c1aed-128">Notifications when an object is added to or obtained from the object pool.</span></span><br/>                                                                                                                                  | <span data-ttu-id="c1aed-129">集區中的物件數目、物件的總數。</span><span class="sxs-lookup"><span data-stu-id="c1aed-129">Number of objects in the pool, total number of objects.</span></span><br/>                                                                                                |
| <span data-ttu-id="c1aed-130">COM + 伺服器應用程式啟動、暫停或回收時的通知。</span><span class="sxs-lookup"><span data-stu-id="c1aed-130">Notifications when a COM+ server application is started, paused, or recycled.</span></span><br/>                                                                                                                               | <span data-ttu-id="c1aed-131">COM + 伺服器應用程式進程的狀態 (例如，是否已暫停或回收) 。</span><span class="sxs-lookup"><span data-stu-id="c1aed-131">Status of the COM+ server application process (for example, whether it is paused or recycled).</span></span><br/>                                                         |
| <span data-ttu-id="c1aed-132">交易啟動、準備、中止和認可事件的通知。</span><span class="sxs-lookup"><span data-stu-id="c1aed-132">Notifications of transaction start, prepare, abort, and commit events.</span></span><br/>                                                                                                                                      | <span data-ttu-id="c1aed-133">沒有同等項目。</span><span class="sxs-lookup"><span data-stu-id="c1aed-133">No equivalent.</span></span><br/>                                                                                                                                         |
| <span data-ttu-id="c1aed-134">成功和失敗的方法呼叫層級驗證嘗試的通知。</span><span class="sxs-lookup"><span data-stu-id="c1aed-134">Notifications of successful and failed method call level authentication attempts.</span></span><br/>                                                                                                                           | <span data-ttu-id="c1aed-135">沒有同等項目。</span><span class="sxs-lookup"><span data-stu-id="c1aed-135">No equivalent.</span></span><br/>                                                                                                                                         |



 

<span data-ttu-id="c1aed-136">雖然 COM + 追蹤在資料範圍和計算度量方面有更大的彈性，但它所提供的計量應該足以滿足各式各樣的系統管理和診斷程式。</span><span class="sxs-lookup"><span data-stu-id="c1aed-136">Although COM+ tracking is more limited in terms of data scope and flexibility for calculating metrics, the metrics it provides should be sufficient for a wide variety of administrative and diagnostic programs.</span></span> <span data-ttu-id="c1aed-137">盡可能使用 COM + 追蹤，可以簡化這些程式的設計。</span><span class="sxs-lookup"><span data-stu-id="c1aed-137">Using COM+ tracking, when possible, can simplify the design of these programs.</span></span> <span data-ttu-id="c1aed-138">此外，在生產系統中使用 COM + 追蹤可能會大幅降低效能影響，使其更適合用於即時監視工具。</span><span class="sxs-lookup"><span data-stu-id="c1aed-138">Additionally, using COM+ tracking in production systems can have a significantly lower performance impact, making it more appropriate for real-time monitoring tools.</span></span>

## <a name="how-com-tracking-collects-data"></a><span data-ttu-id="c1aed-139">COM + 追蹤如何收集資料</span><span class="sxs-lookup"><span data-stu-id="c1aed-139">How COM+ Tracking Collects Data</span></span>

<span data-ttu-id="c1aed-140">當 COM + 伺服器應用程式進程啟動時，COM + 會向 *追蹤器伺服器*（系統應用程式的元件）註冊處理常式。</span><span class="sxs-lookup"><span data-stu-id="c1aed-140">When a COM+ server application process is started, COM+ registers the process with the *tracker server*, a component of the system application.</span></span> <span data-ttu-id="c1aed-141">COM + 程式庫應用程式和服務中沒有元件 (SWC 的元件) 內容也支援追蹤。</span><span class="sxs-lookup"><span data-stu-id="c1aed-141">Components in COM+ library applications and services without components (SWC) contexts also support tracking.</span></span> <span data-ttu-id="c1aed-142">在進程中建立程式庫元件或 SWC 內容時，COM + 會向追蹤器伺服器註冊進程（如果尚未註冊的話）。</span><span class="sxs-lookup"><span data-stu-id="c1aed-142">When a library component or SWC context is created in a process, COM+ registers the process with the tracker server if it has not been registered already.</span></span>

<span data-ttu-id="c1aed-143">當進程中發生特定事件（例如建立物件或完成方法呼叫）時，COM + 會更新追蹤進程的統計資料。</span><span class="sxs-lookup"><span data-stu-id="c1aed-143">COM+ updates statistics for a tracked process when certain events occur in the process, such as the creation of an object or the completion of a method call.</span></span> <span data-ttu-id="c1aed-144">更新的資料會定期提交給追蹤器伺服器，並可供取用者使用。</span><span class="sxs-lookup"><span data-stu-id="c1aed-144">Updated data is periodically submitted to the tracker server, at which point it becomes available to consumers.</span></span> <span data-ttu-id="c1aed-145">追蹤器伺服器也負責計算 COM + 應用程式回收和停止回應監視功能所使用的一些計量。</span><span class="sxs-lookup"><span data-stu-id="c1aed-145">The tracker server is also responsible for calculating some of the metrics used by the COM+ application recycling and hang monitoring features.</span></span> <span data-ttu-id="c1aed-146">這項資料也可供取用者使用。</span><span class="sxs-lookup"><span data-stu-id="c1aed-146">This data is also available to consumers.</span></span>

<span data-ttu-id="c1aed-147">追蹤資料會依據產生資料的進程進行組織。</span><span class="sxs-lookup"><span data-stu-id="c1aed-147">Tracking data is organized according to the process that generated the data.</span></span> <span data-ttu-id="c1aed-148">在程式中個別 COM + 應用程式或元件層級的資料，也適用于需要這項資訊的取用者。</span><span class="sxs-lookup"><span data-stu-id="c1aed-148">Data at the level of individual COM+ applications or components in the process is also available for consumers that need this information.</span></span>

## <a name="events-versus-polling"></a><span data-ttu-id="c1aed-149">事件與輪詢</span><span class="sxs-lookup"><span data-stu-id="c1aed-149">Events versus Polling</span></span>

<span data-ttu-id="c1aed-150">COM + 追蹤支援兩種機制，可讓取用者從追蹤器伺服器（以 COM + 事件為基礎的訂閱機制和 COM 本機伺服器介面）取得追蹤資料。</span><span class="sxs-lookup"><span data-stu-id="c1aed-150">COM+ tracking supports two mechanisms for a consumer to obtain tracking data from the tracker server, a COM+ events-based subscription mechanism and a COM local server interface.</span></span>

<span data-ttu-id="c1aed-151">需要定期使用更新的追蹤資料通知的程式，可以為 [**IComTrackingInfoEvents**](/windows/desktop/api/ComSvcs/nn-comsvcs-icomtrackinginfoevents) 事件介面註冊訂用帳戶。</span><span class="sxs-lookup"><span data-stu-id="c1aed-151">Programs that need to be notified periodically with updated tracking data can register a subscription for the [**IComTrackingInfoEvents**](/windows/desktop/api/ComSvcs/nn-comsvcs-icomtrackinginfoevents) event interface.</span></span> <span data-ttu-id="c1aed-152">追蹤器伺服器大約每隔三秒，會呼叫每個訂閱者的 [**IComTrackingInfoEvents：： OnNewTrackingInfo**](/windows/desktop/api/ComSvcs/nf-comsvcs-icomtrackinginfoevents-onnewtrackinginfo) 方法，以集合物件的形式傳送最新的追蹤資料。</span><span class="sxs-lookup"><span data-stu-id="c1aed-152">Roughly every three seconds, the tracker server calls each subscriber's [**IComTrackingInfoEvents::OnNewTrackingInfo**](/windows/desktop/api/ComSvcs/nf-comsvcs-icomtrackinginfoevents-onnewtrackinginfo) method, sending the most recent tracking data in the form of a collection object.</span></span> <span data-ttu-id="c1aed-153">這個物件會執行 [**IComTrackingInfoCollection**](/windows/desktop/api/ComSvcs/nn-comsvcs-icomtrackinginfocollection) 介面，而訂閱者可以導覽此集合來尋找他們感興趣的資料。</span><span class="sxs-lookup"><span data-stu-id="c1aed-153">This object implements the [**IComTrackingInfoCollection**](/windows/desktop/api/ComSvcs/nn-comsvcs-icomtrackinginfocollection) interface, and subscribers can navigate this collection to find the data they are interested in.</span></span>

<span data-ttu-id="c1aed-154">基於各種原因，程式可能更適合讓程式輪詢追蹤器伺服器以取得資料。</span><span class="sxs-lookup"><span data-stu-id="c1aed-154">For various reasons, it might make more sense for a program to poll tracker server for data.</span></span> <span data-ttu-id="c1aed-155">例如，監視工具可能需要更新的頻率，比在使用者介面中顯示狀態的程式更少。</span><span class="sxs-lookup"><span data-stu-id="c1aed-155">For example, a monitoring tool may need updates much less frequently than a program that displays status in a user interface.</span></span> <span data-ttu-id="c1aed-156">此外，程式可能只會使用系統可用的一小部分追蹤資料 (例如，工具可能只會監視單一 COM + 應用程式) 實例的效能。</span><span class="sxs-lookup"><span data-stu-id="c1aed-156">Also, a program may use only a small portion of the tracking data available for the system (for example, a tool might only monitor the performance of instances of a single COM+ application).</span></span> <span data-ttu-id="c1aed-157">訂閱模型會將每個通知中所有 COM + 應用程式的追蹤資料傳送給每個訂閱者，而訂閱者必須負責尋找想要的資料。</span><span class="sxs-lookup"><span data-stu-id="c1aed-157">The subscription model sends each subscriber the tracking data for all COM+ applications in each notification, and it is the responsibility of the subscriber to find the data it wants.</span></span> <span data-ttu-id="c1aed-158">最後，COM + 事件是最佳的事件通知機制。</span><span class="sxs-lookup"><span data-stu-id="c1aed-158">Finally, COM+ events is a best-effort event notification mechanism.</span></span> <span data-ttu-id="c1aed-159">未提供可靠的訊息傳遞服務，且沒有任何方法可讓訂閱者偵測追蹤器伺服器無法傳送通知給它。</span><span class="sxs-lookup"><span data-stu-id="c1aed-159">Reliable message delivery services are not provided, and there is no way for a subscriber to detect that the tracker server failed to send it a notification.</span></span>

<span data-ttu-id="c1aed-160">需要更充分掌控追蹤資料的程式，可以使用追蹤器伺服器的 [**IGetAppTrackerData**](/windows/desktop/api/ComSvcs/nn-comsvcs-igetapptrackerdata) 介面。</span><span class="sxs-lookup"><span data-stu-id="c1aed-160">A program that needs greater control over its retrieval of tracking data can use the [**IGetAppTrackerData**](/windows/desktop/api/ComSvcs/nn-comsvcs-igetapptrackerdata) interface of the tracker server.</span></span>

 

 




