---
description: 設定一致且完成的旗標
ms.assetid: d9b6096d-f93c-4f8e-a4d9-ea8309b35f0f
title: 設定一致且完成的旗標
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: fd45d457828a222ce7f4ccbdc0080001b0f0b55f
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104468097"
---
# <a name="setting-the-consistent-and-done-flags"></a><span data-ttu-id="c4e53-103">設定一致且完成的旗標</span><span class="sxs-lookup"><span data-stu-id="c4e53-103">Setting the Consistent and Done Flags</span></span>

<span data-ttu-id="c4e53-104">您可以在 [**IObjectCoNtext**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontext) 或 [**ICoNtextState**](/windows/desktop/api/ComSvcs/nn-comsvcs-icontextstate) 介面上叫用方法，以設定一致和完成的旗標。</span><span class="sxs-lookup"><span data-stu-id="c4e53-104">You set the consistent and done flags by invoking methods on either the [**IObjectContext**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontext) or the [**IContextState**](/windows/desktop/api/ComSvcs/nn-comsvcs-icontextstate) interfaces.</span></span> <span data-ttu-id="c4e53-105">這兩個介面所使用的策略有很大的差異。</span><span class="sxs-lookup"><span data-stu-id="c4e53-105">The strategies used by these two interfaces differ significantly.</span></span> <span data-ttu-id="c4e53-106">**IObjectCoNtext** 有四種方法可將一致和完成的旗標系結在唯一組合中，而 **ICoNtextState** 有兩種方法可讓您個別設定每個旗標。</span><span class="sxs-lookup"><span data-stu-id="c4e53-106">**IObjectContext** has four methods that bind the consistent and done flags together in unique combinations, while **IContextState** has two methods that allow you to set each flag independently.</span></span> <span data-ttu-id="c4e53-107">**IObjectCoNtext** 的方法也會透過 [**ObjectCoNtext**](/windows/desktop/api/ComSvcs/nn-comsvcs-objectcontext)物件公開。</span><span class="sxs-lookup"><span data-stu-id="c4e53-107">The methods of **IObjectContext** are also exposed through the [**ObjectContext**](/windows/desktop/api/ComSvcs/nn-comsvcs-objectcontext) object.</span></span>

<span data-ttu-id="c4e53-108">針對每個旗標的獨立控制， [**ICoNtextState**](/windows/desktop/api/ComSvcs/nn-comsvcs-icontextstate) 會提供方法將一致旗標設定為 True 或 false，以及將完成旗標設為 True 或 false 的方法。</span><span class="sxs-lookup"><span data-stu-id="c4e53-108">For independent control of each flag, [**IContextState**](/windows/desktop/api/ComSvcs/nn-comsvcs-icontextstate) provides a method to set the consistent flag to True or False and a method to set the done flag to True or False.</span></span> <span data-ttu-id="c4e53-109">這些方法分別為 [**SetMyTransactionVote**](/windows/desktop/api/ComSvcs/nf-comsvcs-icontextstate-setmytransactionvote) 和 [**SetDeactivateOnReturn**](/windows/desktop/api/ComSvcs/nf-comsvcs-icontextstate-setdeactivateonreturn)。</span><span class="sxs-lookup"><span data-stu-id="c4e53-109">These methods are [**SetMyTransactionVote**](/windows/desktop/api/ComSvcs/nf-comsvcs-icontextstate-setmytransactionvote) and [**SetDeactivateOnReturn**](/windows/desktop/api/ComSvcs/nf-comsvcs-icontextstate-setdeactivateonreturn), respectively.</span></span> <span data-ttu-id="c4e53-110">**ICoNtextState** 介面也包含可取得每個旗標目前值的方法。</span><span class="sxs-lookup"><span data-stu-id="c4e53-110">The **IContextState** interface also includes methods to retrieve the current value of each flag.</span></span>

<span data-ttu-id="c4e53-111">當您將 [**SetMyTransactionVote**](/windows/desktop/api/ComSvcs/nf-comsvcs-icontextstate-setmytransactionvote) 方法值設定為 TxCommit 時，com + 會確認交易是否存在。</span><span class="sxs-lookup"><span data-stu-id="c4e53-111">When you set the [**SetMyTransactionVote**](/windows/desktop/api/ComSvcs/nf-comsvcs-icontextstate-setmytransactionvote) method value to TxCommit, COM+ verifies the presence of a transaction.</span></span> <span data-ttu-id="c4e53-112">如果 COM + 未偵測到交易，則會產生您可以在記錄檔中捕捉的錯誤。</span><span class="sxs-lookup"><span data-stu-id="c4e53-112">If COM+ does not detect a transaction, it generates an error that you can capture in a log file.</span></span> <span data-ttu-id="c4e53-113">例如，假設有人不慎將您元件的交易屬性設定為不受支援，但您預期會將它設定為 Required。</span><span class="sxs-lookup"><span data-stu-id="c4e53-113">For example, suppose someone inadvertently configures your component's transaction attribute to Not Supported but you expected it to be set to Required.</span></span> <span data-ttu-id="c4e53-114">藉由設定 **SetMyTransactionVote** = TxCommit，您可以識別衝突並採取動作。</span><span class="sxs-lookup"><span data-stu-id="c4e53-114">By setting **SetMyTransactionVote** = TxCommit, you can identify the conflict and take action.</span></span>

<span data-ttu-id="c4e53-115">下表說明可用於設定一致和完成旗標的方法呼叫。</span><span class="sxs-lookup"><span data-stu-id="c4e53-115">The following table describes the method calls that can be used to set the consistent and done flags.</span></span>



| <span data-ttu-id="c4e53-116">一致的旗標</span><span class="sxs-lookup"><span data-stu-id="c4e53-116">Consistent flag</span></span>  | <span data-ttu-id="c4e53-117">完成旗標</span><span class="sxs-lookup"><span data-stu-id="c4e53-117">Done flag</span></span>        | <span data-ttu-id="c4e53-118">IObjectCoNtext 方法</span><span class="sxs-lookup"><span data-stu-id="c4e53-118">IObjectContext method</span></span>                                            | <span data-ttu-id="c4e53-119">ICoNtextState 方法</span><span class="sxs-lookup"><span data-stu-id="c4e53-119">IContextState methods</span></span>                                                                                                                                                                                    |
|------------------|------------------|------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="c4e53-120">是</span><span class="sxs-lookup"><span data-stu-id="c4e53-120">True</span></span><br/>  | <span data-ttu-id="c4e53-121">否</span><span class="sxs-lookup"><span data-stu-id="c4e53-121">False</span></span><br/> | [<span data-ttu-id="c4e53-122">**EnableCommit**</span><span class="sxs-lookup"><span data-stu-id="c4e53-122">**EnableCommit**</span></span>](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-enablecommit)<br/>   | <span data-ttu-id="c4e53-123">[**SetMyTransactionVote**](/windows/desktop/api/ComSvcs/nf-comsvcs-icontextstate-setmytransactionvote) *txVote* = TxCommit</span><span class="sxs-lookup"><span data-stu-id="c4e53-123">[**SetMyTransactionVote**](/windows/desktop/api/ComSvcs/nf-comsvcs-icontextstate-setmytransactionvote) *txVote* = TxCommit</span></span> <br/> <span data-ttu-id="c4e53-124">[**SetDeactivateOnReturn**](/windows/desktop/api/ComSvcs/nf-comsvcs-icontextstate-setdeactivateonreturn) *bDeactivate* = False</span><span class="sxs-lookup"><span data-stu-id="c4e53-124">[**SetDeactivateOnReturn**](/windows/desktop/api/ComSvcs/nf-comsvcs-icontextstate-setdeactivateonreturn) *bDeactivate* = False</span></span><br/> |
| <span data-ttu-id="c4e53-125">False</span><span class="sxs-lookup"><span data-stu-id="c4e53-125">False</span></span><br/> | <span data-ttu-id="c4e53-126">False</span><span class="sxs-lookup"><span data-stu-id="c4e53-126">False</span></span><br/> | [<span data-ttu-id="c4e53-127">**DisableCommit**</span><span class="sxs-lookup"><span data-stu-id="c4e53-127">**DisableCommit**</span></span>](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-disablecommit)<br/> | <span data-ttu-id="c4e53-128">[**SetMyTransactionVote**](/windows/desktop/api/ComSvcs/nf-comsvcs-icontextstate-setmytransactionvote) *txVote* = TxAbort</span><span class="sxs-lookup"><span data-stu-id="c4e53-128">[**SetMyTransactionVote**](/windows/desktop/api/ComSvcs/nf-comsvcs-icontextstate-setmytransactionvote) *txVote* = TxAbort</span></span> <br/> <span data-ttu-id="c4e53-129">[**SetDeactivateOnReturn**](/windows/desktop/api/ComSvcs/nf-comsvcs-icontextstate-setdeactivateonreturn) *bDeactivate* = False</span><span class="sxs-lookup"><span data-stu-id="c4e53-129">[**SetDeactivateOnReturn**](/windows/desktop/api/ComSvcs/nf-comsvcs-icontextstate-setdeactivateonreturn) *bDeactivate* = False</span></span><br/>  |
| <span data-ttu-id="c4e53-130">False</span><span class="sxs-lookup"><span data-stu-id="c4e53-130">False</span></span><br/> | <span data-ttu-id="c4e53-131">True</span><span class="sxs-lookup"><span data-stu-id="c4e53-131">True</span></span><br/>  | [<span data-ttu-id="c4e53-132">**SetAbort**</span><span class="sxs-lookup"><span data-stu-id="c4e53-132">**SetAbort**</span></span>](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-setabort)<br/>           | <span data-ttu-id="c4e53-133">[**SetMyTransactionVote**](/windows/desktop/api/ComSvcs/nf-comsvcs-icontextstate-setmytransactionvote) *txVote* = TxAbort</span><span class="sxs-lookup"><span data-stu-id="c4e53-133">[**SetMyTransactionVote**](/windows/desktop/api/ComSvcs/nf-comsvcs-icontextstate-setmytransactionvote) *txVote* = TxAbort</span></span> <br/> <span data-ttu-id="c4e53-134">[**SetDeactivateOnReturn**](/windows/desktop/api/ComSvcs/nf-comsvcs-icontextstate-setdeactivateonreturn) *bDeactivate* = True</span><span class="sxs-lookup"><span data-stu-id="c4e53-134">[**SetDeactivateOnReturn**](/windows/desktop/api/ComSvcs/nf-comsvcs-icontextstate-setdeactivateonreturn) *bDeactivate* = True</span></span><br/>   |
| <span data-ttu-id="c4e53-135">True</span><span class="sxs-lookup"><span data-stu-id="c4e53-135">True</span></span><br/>  | <span data-ttu-id="c4e53-136">True</span><span class="sxs-lookup"><span data-stu-id="c4e53-136">True</span></span><br/>  | [<span data-ttu-id="c4e53-137">**SetComplete**</span><span class="sxs-lookup"><span data-stu-id="c4e53-137">**SetComplete**</span></span>](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-setcomplete)<br/>     | <span data-ttu-id="c4e53-138">[**SetMyTransactionVote**](/windows/desktop/api/ComSvcs/nf-comsvcs-icontextstate-setmytransactionvote) *txVote* = TxCommit</span><span class="sxs-lookup"><span data-stu-id="c4e53-138">[**SetMyTransactionVote**](/windows/desktop/api/ComSvcs/nf-comsvcs-icontextstate-setmytransactionvote) *txVote* = TxCommit</span></span> <br/><span data-ttu-id="c4e53-139">[**SetDeactivateOnReturn**](/windows/desktop/api/ComSvcs/nf-comsvcs-icontextstate-setdeactivateonreturn) *bDeactivate* = True</span><span class="sxs-lookup"><span data-stu-id="c4e53-139">[**SetDeactivateOnReturn**](/windows/desktop/api/ComSvcs/nf-comsvcs-icontextstate-setdeactivateonreturn) *bDeactivate* = True</span></span>              |



 

> [!Note]  
> <span data-ttu-id="c4e53-140">在方法層級設定的自動完成屬性，可能會影響一致和完成旗標的設定方式。</span><span class="sxs-lookup"><span data-stu-id="c4e53-140">The auto-done property, which is set at the method level, can affect how the consistent and done flags are set.</span></span> <span data-ttu-id="c4e53-141">如需有關自動完成屬性的詳細資訊，請參閱為 [方法啟用自動完成](enabling-auto-done-for-a-method.md) 和 [設定完成位](setting-the-done-bit.md)。</span><span class="sxs-lookup"><span data-stu-id="c4e53-141">For more information regarding the auto-done property, see [Enabling Auto-Done for a Method](enabling-auto-done-for-a-method.md) and [Setting the Done Bit](setting-the-done-bit.md).</span></span>

 

 

 




