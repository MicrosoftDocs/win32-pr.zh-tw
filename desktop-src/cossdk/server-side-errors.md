---
description: Server-Side 錯誤
ms.assetid: ce8ddb52-237c-4d46-a088-9f592afadcd2
title: Server-Side 錯誤
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f7946b8197553874b8da22d35f8fab5b83f14862
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "106977005"
---
# <a name="server-side-errors"></a>Server-Side 錯誤

接聽程式和播放程式會一起運作來處理有害訊息。 如果現正播放的交易失敗， [訊息佇列](/previous-versions/windows/desktop/legacy/ms711472(v=vs.85)) 會將輸入訊息移回輸入佇列。 如果播放程式從伺服器元件收到失敗的 HRESULT 或攔截到例外狀況，則會中止交易。 如果問題持續發生，接聽程式可能會以下列模式持續迴圈：

-   清除訊息
-   具現化物件
-   受到回復
-   將訊息放回佇列頂端

已排入佇列的元件服務會使用一系列的應用程式特定重試佇列來處理這項失敗。 在安裝元件時建立，每個應用程式都有七個佇列，如下所示：

1.  一般輸入佇列。 此佇列的名稱是 COM + 應用程式名稱。 這是訊息佇列公用佇列。

2.  第一個重試佇列。 如果在處理來自一般輸入佇列的訊息時，交易重複失敗，則會將訊息移至此處。 此佇列上的訊息會在一分鐘後處理。 您可以在此佇列上重試三次訊息，然後再移至第二個重試佇列的背面。 此佇列的名稱為 *ApplicationName* \_ 0。 此佇列是私用訊息佇列的佇列。

3.  第二次重試佇列。 如果在處理第一次重試佇列中的訊息時，交易重複失敗，則會將訊息移至此處。 此佇列上的訊息會在兩分鐘後處理。 您可以在此佇列上重試三次訊息，然後再移至第三個重試佇列的背面。 此佇列名為 *ApplicationName* \_ 1。 此佇列是私用訊息佇列的佇列。

4.  第三個重試佇列。 如果在處理第二次重試佇列中的訊息時，交易重複失敗，則會將訊息移至此處。 此佇列上的訊息會在四分鐘後處理。 您可以在此佇列上重試三次訊息，然後再移至第四個重試佇列的背面。 此佇列名為 *ApplicationName* \_ 2。 此佇列是私用訊息佇列的佇列。

5.  第四個重試佇列。 如果在處理第三個重試佇列中的訊息時，交易重複失敗，則會將訊息移至此處。 此佇列上的訊息會在八分鐘之後處理。 您可以在此佇列上重試三次訊息，然後再移到第五個重試佇列。 此佇列名為 *ApplicationName* \_ 3。 此佇列是私用訊息佇列的佇列。

6.  第五次重試佇列。 如果在處理第四個重試佇列中的訊息時，交易重複失敗，則會將訊息移至此處。 此佇列上的訊息會在十六分鐘之後處理。 您可以在此佇列上重試三次訊息，然後再移至最後的靜止佇列。 此佇列的名稱為 *ApplicationName* \_ 4。 這是私用訊息佇列的佇列。

7.  應用程式特定的最終靜止佇列。 如果交易在第五次重試佇列上嘗試時重複中止，則會在這裡移動訊息。 此佇列名為 *ApplicationName* \_ DeadQueue。 這是私用訊息佇列的佇列。 佇列接聽程式不會提供最後的靜止佇列。 訊息會一直留在這裡，直到以手動方式移動 (可能是由佇列元件的訊息移動器公用程式) ，或是訊息佇列 Explorer 已清除。

無法播放的訊息是因為清楚地，每次重試嘗試都會失敗，而不會透過所有重試層級進行前進。

播放程式會發出 COM + 事件，以通知有興趣的合作物件無法播放訊息。 COM + 事件會在下列情況下發出：

-   當交易中止時
-   當訊息從一個佇列移至另一個佇列時
-   將訊息存放到最後的靜止佇列時

您可以在從一個佇列移至另一個佇列之前修改訊息。 COM + 佇列的元件安全性機制允許將訊息移至重試佇列，然後重新插入應用程式的初始輸入佇列。 如需有關已排入佇列之元件安全性的詳細資訊，請參閱 [佇列元件安全性](queued-components-security.md)。

當應用程式被「元件服務」系統管理工具標示為已排入佇列，或使用 COM + 系統管理 SDK 函式時，會在主應用程式佇列中建立重試佇列。 已排入佇列的元件服務允許刪除重試佇列，以提供重試機制的彈性。 例如，如果刪除所有重試佇列，則會將持續中止的訊息直接從應用程式佇列移至應用程式特定的最終靜止佇列。 藉由移除一或多個重試佇列，可減少重試的次數和長度。 如果從重試順序中移除佇列，其餘佇列的時間會對應至重試佇列順序中的位置。 例如，如果您移除重試佇列 *ApplicationName* \_ 1、 *applicationname* \_ 2 和 *applicationname* \_ 3，則會處理 *ApplicationName* 4 上的訊息， \_ 就像佇列是第二次重試佇列一樣。

重試機制的設計目的是要盡可能完成訊息。 在某些情況下，訊息可能無法成功。 例如，用戶端可能會嘗試從資金不足的帳戶中提取金錢。 在這些情況下，您可以透過數種方式來處理錯誤，包括下列各項：

-   產生診斷併發出警告
-   建立補償交易
-   忽略問題並關閉訊息

如同用戶端持續失敗，佇列的元件服務可讓例外狀況類別與元件相關聯。 例外狀況類別是與元件相關聯，方法是使用 [元件服務管理工具] 之 [元件屬性] 頁面中的 [ **Advanced** ] 索引標籤，或使用 com + 系統管理功能。 例外狀況類別可讓開發人員在已重試訊息之後，以及將該訊息移至應用程式特定的最終靜止佇列之前，擁有控制權。 如需例外狀況類別的詳細資訊，請參閱 [持續性 Client-Side 失敗](persistent-client-side-failures.md)。

以下是伺服器端例外狀況處理的事件順序：

1.  訊息會透過可用的應用程式特定重試佇列來移動。
2.  最後一次重試佇列上的最後一次重試失敗。
3.  已排入佇列的元件服務執行時間會從訊息中取得目標群組件，並檢查是否有例外狀況類別。
4.  執行時間會具現化例外狀況類別。
5.  執行時間查詢會 [**IPlaybackControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol) 例外狀況類別。
6.  執行時間會在例外狀況類別中呼叫 [**IPlaybackControl：： FinalServerRetry**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalserverretry) 。
7.  執行時間會將訊息中的所有屬性和方法呼叫播放到例外狀況類別。
8.  如果步驟4到6不成功，則執行時間會將訊息移至應用程式特定的最終靜止佇列。

如果您需要介入以上所述的程式，或需要將有害訊息移出其最終的靜止佇列，請使用訊息移動器公用程式。 如需訊息移動器公用程式的詳細資訊，請參閱 [處理錯誤](handling-errors-in-queued-components.md)。

## <a name="related-topics"></a>相關主題

<dl> <dt>

[用戶端錯誤](client-side-errors.md)
</dt> <dt>

[持續性 Client-Side 失敗](persistent-client-side-failures.md)
</dt> </dl>

 

 



