---
description: 針對在 COM + 應用程式內執行的已設定元件，內容是提供 COM + 服務的基礎。
ms.assetid: 62a0bef2-c3c2-4a60-a5d1-6c038958e13e
title: COM + 內容
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5f0ae1228f89797f9124e817db07f11a23dbec12
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104385985"
---
# <a name="com-contexts"></a><span data-ttu-id="40208-103">COM + 內容</span><span class="sxs-lookup"><span data-stu-id="40208-103">COM+ Contexts</span></span>

<span data-ttu-id="40208-104">針對在 COM + 應用程式內執行的已設定 *元件，內容* 是提供 com + 服務的基礎。</span><span class="sxs-lookup"><span data-stu-id="40208-104">For configured components running within COM+ applications, *contexts* are the foundation on which COM+ services are provided.</span></span> <span data-ttu-id="40208-105">在 COM + 中，內容會定義為一組與一或多個 COM 物件相關聯的執行時間屬性，而這些物件是用來提供這些物件的服務。</span><span class="sxs-lookup"><span data-stu-id="40208-105">In COM+, a context is defined as set of run-time properties associated with one or more COM objects that are used to provide services for those objects.</span></span>

<span data-ttu-id="40208-106">在 COM + 中，每個 COM 物件會在執行 (也就是在其啟動和停用) 之間，以及每個內容都在一個 COM 單元內，精確地與一個內容相關聯。</span><span class="sxs-lookup"><span data-stu-id="40208-106">In COM+, every COM object is associated with precisely one context as it runs (that is, between its activation and deactivation), and every context resides within precisely one COM apartment.</span></span> <span data-ttu-id="40208-107">多個物件可在相同的內容中執行，而多個內容可以位於同一個單元內。</span><span class="sxs-lookup"><span data-stu-id="40208-107">Multiple objects can run within the same context, and multiple contexts can reside within the same apartment.</span></span> <span data-ttu-id="40208-108">當物件啟動時初始化、內容屬性，例如資訊安全內容屬性，代表物件的執行時間需求。</span><span class="sxs-lookup"><span data-stu-id="40208-108">Initialized when an object is activated, context properties, such as security context properties, represent the run-time needs of an object.</span></span>

> [!Note]  
> <span data-ttu-id="40208-109">如果未設定的元件不使用 COM + 服務，則內容大部分都會被忽略。</span><span class="sxs-lookup"><span data-stu-id="40208-109">For unconfigured components that do not use COM+ services, the context is, for the most part, ignored.</span></span>

 

<span data-ttu-id="40208-110">COM + 會使用內容屬性作為提供執行時間服務的基礎。</span><span class="sxs-lookup"><span data-stu-id="40208-110">COM+ uses context properties as the basis for providing run-time services.</span></span> <span data-ttu-id="40208-111">這些屬性會保存狀態，以決定執行環境如何針對內容中的物件執行服務。</span><span class="sxs-lookup"><span data-stu-id="40208-111">These properties hold state that determines how the execution environment performs services for objects within the context.</span></span> <span data-ttu-id="40208-112">在某些情況下，您可以直接與物件的內容屬性互動，以指出與提供給物件之服務相關的一些狀態。</span><span class="sxs-lookup"><span data-stu-id="40208-112">In some cases, you can interact directly with an object's context properties to indicate some state relevant to a service being provided for the object.</span></span> <span data-ttu-id="40208-113">例如，當參與自動交易的物件對交易的結果投票時，您會這麼做。</span><span class="sxs-lookup"><span data-stu-id="40208-113">For example, you would do this when an object that is participating in an automatic transaction votes on the outcome of the transaction.</span></span>

<span data-ttu-id="40208-114">如需這些概念的 COM 基礎詳細討論，請參閱 [進程、執行緒和單元](/windows/desktop/com/processes--threads--and-apartments)。</span><span class="sxs-lookup"><span data-stu-id="40208-114">For a detailed discussion of the COM foundation of these concepts, see [Processes, Threads, and Apartments](/windows/desktop/com/processes--threads--and-apartments).</span></span>

## <a name="programmatic-interaction-with-context-properties"></a><span data-ttu-id="40208-115">以程式設計方式與內容屬性互動</span><span class="sxs-lookup"><span data-stu-id="40208-115">Programmatic Interaction with Context Properties</span></span>

<span data-ttu-id="40208-116">每個內容都有相關聯的 [**ObjectCoNtext**](/windows/desktop/api/ComSvcs/nn-comsvcs-objectcontext) 物件，此物件會持續追蹤其屬性。</span><span class="sxs-lookup"><span data-stu-id="40208-116">Each context has an associated [**ObjectContext**](/windows/desktop/api/ComSvcs/nn-comsvcs-objectcontext) object that keeps track of its properties.</span></span> <span data-ttu-id="40208-117">您可以藉由呼叫 [**GetObjectCoNtext**](/windows/desktop/api/ComSvcs/nf-comsvcs-getobjectcontext)函數來存取 **ObjectCoNtext** 。</span><span class="sxs-lookup"><span data-stu-id="40208-117">You can access **ObjectContext** by calling the [**GetObjectContext**](/windows/desktop/api/ComSvcs/nf-comsvcs-getobjectcontext) function.</span></span> <span data-ttu-id="40208-118">存取 **ObjectCoNtext** 之後，您可以在其公開的 [**IObjectCoNtext**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontext) 介面上呼叫方法，以操作內容屬性。</span><span class="sxs-lookup"><span data-stu-id="40208-118">After you have accessed **ObjectContext**, you can call methods on the [**IObjectContext**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontext) interface it exposes to manipulate context properties.</span></span>

<span data-ttu-id="40208-119">例如，呼叫 [**IObjectCoNtext：： SetComplete**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-setcomplete) 的效果，是將交易一致性位設定為「一致」，並在與物件相關聯的內容上將 [JIT 啟用](com--just-in-time-activation.md) 完成的位設定為「完成」。</span><span class="sxs-lookup"><span data-stu-id="40208-119">For example, calling [**IObjectContext::SetComplete**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-setcomplete) has the effect of setting the transaction consistency bit to "consistent" and the [JIT-activation](com--just-in-time-activation.md) done bit to "done" on the context associated with the object.</span></span> <span data-ttu-id="40208-120">「一致」表示您投票認可交易的 COM +，而「完成」表示您的物件已準備好在方法傳回時停用。</span><span class="sxs-lookup"><span data-stu-id="40208-120">"Consistent" signals to COM+ that you vote to commit the transaction, and "done" indicates that your object is ready to be deactivated when the method returns.</span></span>

<span data-ttu-id="40208-121">除了 [**IObjectCoNtext**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontext)之外，其他提供內容屬性存取權的特殊介面為 [**IObjectCoNtextInfo**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontextinfo)、 [**ICoNtextState**](/windows/desktop/api/ComSvcs/nn-comsvcs-icontextstate)和 [**IObjectCoNtextActivity**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontextactivity)。</span><span class="sxs-lookup"><span data-stu-id="40208-121">In addition to [**IObjectContext**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontext), other specialized interfaces providing access to context properties are [**IObjectContextInfo**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontextinfo), [**IContextState**](/windows/desktop/api/ComSvcs/nn-comsvcs-icontextstate), and [**IObjectContextActivity**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontextactivity).</span></span> <span data-ttu-id="40208-122">在特定範圍內， [**ISecurityCallCoNtext**](/windows/desktop/api/ComSvcs/nn-comsvcs-isecuritycallcontext) 也會存取內容屬性。</span><span class="sxs-lookup"><span data-stu-id="40208-122">To a certain extent, [**ISecurityCallContext**](/windows/desktop/api/ComSvcs/nn-comsvcs-isecuritycallcontext) also accesses context properties.</span></span> <span data-ttu-id="40208-123">您可以使用 [**IGetSecurityCallCoNtext：： GetSecurityCallCoNtext**](/windows/desktop/api/ComSvcs/nf-comsvcs-igetsecuritycallcontext-getsecuritycallcontext) 來取得 **ISecurityCallCoNtext**。</span><span class="sxs-lookup"><span data-stu-id="40208-123">You can use [**IGetSecurityCallContext::GetSecurityCallContext**](/windows/desktop/api/ComSvcs/nf-comsvcs-igetsecuritycallcontext-getsecuritycallcontext) to obtain **ISecurityCallContext**.</span></span>

## <a name="understanding-activation-and-interception"></a><span data-ttu-id="40208-124">瞭解啟用與攔截</span><span class="sxs-lookup"><span data-stu-id="40208-124">Understanding Activation and Interception</span></span>

<span data-ttu-id="40208-125">一般來說，您只需要將內容考慮到它代表一些屬性的範圍，其中一些可設定或取得，可用來為您的元件提供 COM + 服務。</span><span class="sxs-lookup"><span data-stu-id="40208-125">Generally, you need to think about context only to the extent that it represents a number of properties, some of which you can set or get, that are used to provide COM+ services for your components.</span></span> <span data-ttu-id="40208-126">不過，在某些情況下，您可能需要更詳細地考慮下列兩個內容相關的 facet：</span><span class="sxs-lookup"><span data-stu-id="40208-126">In some circumstances, however, you might need to consider the following two interrelated facets of contexts in greater detail:</span></span>

-   <span data-ttu-id="40208-127">[內容啟用](context-activation.md)，或在適當的內容中初始化物件。</span><span class="sxs-lookup"><span data-stu-id="40208-127">[Context activation](context-activation.md), or the initialization of an object in an appropriate context.</span></span>
-   <span data-ttu-id="40208-128">[攔截](interception-of-cross-context-calls.md)，或 com + 在內容界限之間執行的呼叫。</span><span class="sxs-lookup"><span data-stu-id="40208-128">[Interception](interception-of-cross-context-calls.md), or what COM+ does on calls across a context boundary.</span></span>

## <a name="relation-to-mts-context-wrappers"></a><span data-ttu-id="40208-129">與 MTS 內容包裝函式的關聯</span><span class="sxs-lookup"><span data-stu-id="40208-129">Relation to MTS Context Wrappers</span></span>

<span data-ttu-id="40208-130">內容有效取代了 MTS 內容包裝函式。</span><span class="sxs-lookup"><span data-stu-id="40208-130">Contexts effectively replace the MTS context wrappers.</span></span> <span data-ttu-id="40208-131">他們所提供的目的（藉由陷印建立要求來提供自動服務）現在是 COM + 的整合功能。</span><span class="sxs-lookup"><span data-stu-id="40208-131">The purpose they served—providing automatic services by trapping creation requests—is now an integrated feature of COM+.</span></span> <span data-ttu-id="40208-132">因此，您不再需要使用 [**SafeRef**](/windows/desktop/api/ComSvcs/nf-comsvcs-saferef) 函數。</span><span class="sxs-lookup"><span data-stu-id="40208-132">As a result, you no longer need to use the [**SafeRef**](/windows/desktop/api/ComSvcs/nf-comsvcs-saferef) function.</span></span> <span data-ttu-id="40208-133">在 MTS 中， **SafeRef** 是用來取得物件的參考，該物件可在其內容包裝函式之外傳遞。</span><span class="sxs-lookup"><span data-stu-id="40208-133">In MTS, **SafeRef** was used to obtain a reference to your object which could be passed outside of its context wrapper.</span></span> <span data-ttu-id="40208-134">在 COM + 中，這是不必要的; (**這個** 指標) 工作的一般物件參考。</span><span class="sxs-lookup"><span data-stu-id="40208-134">In COM+, this is unnecessary; normal object references (**this** pointers) work.</span></span>

 

 
