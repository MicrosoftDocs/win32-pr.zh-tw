---
description: 交易屬性是一種宣告式屬性，會自動管理元件開發人員的交易。 藉由設定這個屬性，您就不必在您的元件中使用明確的交易控制項。
ms.assetid: ea0e4d7e-2598-4a42-993c-58815f2fa138
title: 設定交易
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b57f27d47836193dc5d23c44e3344cb2a81d5984
ms.sourcegitcommit: bf526e267d3991892733bdd229c66d5365cf244a
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 02/05/2021
ms.locfileid: "104569469"
---
# <a name="configuring-transactions"></a>設定交易

*交易屬性* 是一種宣告式屬性，會自動管理元件開發人員的交易。 藉由設定這個屬性，您就不必在您的元件中使用明確的交易控制項。

COM + 會使用元件的交易屬性，判斷其啟動的每一個物件所需的交易保護類型。 根據其需求，物件可以共用其呼叫端的交易、需要新的交易，或在沒有交易保護的情況下運作。

COM + 提供下列交易屬性值：

<dl> <dt>

<span id="Disabled"></span><span id="disabled"></span><span id="DISABLED"></span>禁用
</dt> <dd>

一般來說，只有當您確定元件永遠不會存取 resource manager 時，才應該設定此屬性值。 當您停用交易屬性時，COM + 會在判斷物件的內容位置時，忽略元件的交易需求。 因此，物件可以共用其呼叫端的內容 (和交易) 。 將 COM 元件遷移至 COM + 時，您必須停用交易屬性，以維護與未設定的 COM 元件相同的交易行為。

> [!Note]  
> 未設定的 *元件* 是未安裝在 com + 應用程式中的 com 元件。

 

</dd> <dt>

<span id="Not_Supported"></span><span id="not_supported"></span><span id="NOT_SUPPORTED"></span>不支援
</dt> <dd>

當您設定這個屬性值時，COM + 會確保從元件建立的任何物件都不會參與交易，不論其呼叫端的交易式狀態為何。 藉由宣告此值，您可以確定物件不會在其呼叫端的交易中進行投票，也無法開始本身的交易。 [不支援] 是所有元件的預設值。

</dd> <dt>

<span id="Supported"></span><span id="supported"></span><span id="SUPPORTED"></span>支援
</dt> <dd>

當您設定這個屬性值時，COM + 會確保從元件建立的任何物件都參與交易（如果有的話）。 當您想要讓物件在其呼叫端的交易中共用，而不需要自己的交易時，您可以宣告此值。

</dd> <dt>

<span id="Required"></span><span id="required"></span><span id="REQUIRED"></span>必填
</dt> <dd>

當您設定這個屬性值時，COM + 會確保從元件建立的任何物件都是交易式的。 當 COM + 以必要的設定啟始物件時，它會查看其呼叫端的交易狀態。 如果呼叫端有交易，新的物件就會包含在目前的交易中。 否則，COM + 會開始交易，讓新的物件成為交易的根。 這是執行資源活動之元件的慣用設定，因為它有助於提供這些活動的交易保護。

</dd> <dt>

<span id="Requires_New"></span><span id="requires_new"></span><span id="REQUIRES_NEW"></span>需要新的
</dt> <dd>

當您設定這個屬性值時，COM + 會確保從元件建立的任何物件都必須參與新交易做為交易的根，不論呼叫端的交易式狀態為何。 COM + 會自動起始與呼叫端交易不同的新交易。

> [!Note]  
> COM + 不支援嵌套交易。 當一個交易對象呼叫另一個標記為「需要新」的元件時，COM + 會為新啟用的物件建立獨立的交易式界限。 第二筆交易不會影響第一個交易，除非第一個交易明確注明第二筆交易的結果，並根據這些結果修改其投票。

 

</dd> </dl>

## <a name="transaction-attribute-dependencies"></a>交易屬性相依性

下表顯示每個 COM + 交易屬性值的特性，包括值對交易特性的影響。 COM + 會強制執行所有交易元件的 [JIT 啟用](com--just-in-time-activation.md) 和 [同步](com--synchronization.md) 處理。



| 屬性值          | 新增交易   | 用戶端的交易                 | 交易根目錄                        | JIT 啟用      | 同步處理     |
|--------------------------|-------------------|--------------------------------------|-----------------------------------------|---------------------|---------------------|
| Disabled<br/>      | 永不<br/>  | 可能<br/>                     | 永不<br/>                        | 選用<br/> | 選用<br/> |
| 不支援<br/> | 永不<br/>  | 永不<br/>                     | 永不<br/>                        | 選用<br/> | 選用<br/> |
| 支援<br/>     | 永不<br/>  | 如果用戶端有交易<br/> | 永不<br/>                        | 必要<br/> | 必要<br/> |
| 必要<br/>      | 可能<br/>  | 如果用戶端有交易<br/> | 如果用戶端沒有交易<br/> | 必要<br/> | 必要<br/> |
| 必須是新交易<br/>  | 一律<br/> | 永不<br/>                     | 一律<br/>                       | 必要<br/> | 必要<br/> |



 

## <a name="transaction-boundaries"></a>交易界限

交易具有開頭、結尾，而且只會發生一次。 在其執行期間，交易可能會對資源（例如資料庫或佇列）進行呼叫，以完成一或多個工作。 每個資源都落在 *交易界限* 內。 交易界限內的所有資源（可以跨多個進程和電腦界限）共用單一交易。 管理這些程式和電腦界限之間的一致性相當重要。

COM + 會根據您為每個元件設定的交易屬性值，自動管理交易界限以確保一致性。 COM + 交易會自動流向已指示參與交易的物件，並略過在交易外指示執行的物件。 COM + 不支援嵌套交易。 相反地，COM + 交易是不同的，而且存留期很短。

交易界限中的第一個物件是交易的特殊物件，稱為交易的 *根物件* 。 交易中只能有一個根物件。 在根物件下，交易式階層中的所有其他物件都稱為 *內建物件*。

## <a name="mapping-transactions"></a>對應交易

有一種方法可確保物件包含在正確的交易界限內，就是在開始撰寫元件之前，先對應您的交易。 您可以藉由對應交易，判斷每個所撰寫元件的最佳設定。 您可以更清楚地瞭解如何使用元件，選取正確的交易屬性值就越容易。

在執行時間，COM + 會查看交易屬性，以判斷物件是否應為新交易的根、在現有交易中建立，或建立為非交易式物件。

下圖顯示可能的交易對應。 在圖例中，用戶端會建立需要交易的物件1。 因為不存在交易，COM + 會建立交易1，並將物件1放在其中做為根物件。 物件1會建立支援交易的物件2，因此會放置在交易1中。 物件2會建立不支援交易的物件3，因此會放置在所有交易之外。 物件2也會建立需要交易的物件4，因此會放置在交易1中。 物件3會建立可支援交易的物件5。 不過，由於物件5是由交易內不存在的物件所建立，因此它也會置於所有交易之外。 物件4會建立需要新交易的物件6，因此 COM + 會建立交易2，並將物件6放在其中做為根物件。 物件6會建立支援交易的物件7，因此會放置在交易2中。

![顯示與交易1和交易2的用戶端互動的圖表。](images/fc7e2d03-94c2-40d9-a79b-1e05ca31dd80.png)

上圖顯示兩個潛在的問題區域。 首先，大部分的工作都是在兩個不同的交易之間分割。 如果在物件4建立物件6之後，交易1失敗，則交易2的執行不會受到交易1的結果影響。 如果這不是預期的結果，您可能會想要將這兩筆交易的作業折迭成單一交易，您可以將物件6的交易屬性變更為 Required 來完成這項交易。

對應圖也會顯示物件3和物件5為非交易式，並在交易1和2的範圍內完全執行。 如果物件5更新持續性資料，您可能會想要重新考慮其非交易狀態。 您可以藉由將物件5的交易屬性變更為 [必要]，將物件5置於交易內。

## <a name="related-topics"></a>相關主題

<dl> <dt>

[設定交易屬性](setting-the-transaction-attribute.md)
</dt> </dl>

 

 




