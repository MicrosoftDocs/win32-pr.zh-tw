---
description: 應用程式元件使用 COM + 資源配置器來存取和管理共用的非持久性狀態資訊，例如元件之間的連接，以及指定的資源管理員。
ms.assetid: 252c7180-61b1-485d-883d-36bf77357a29
title: COM + 資源配置器概念
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8f0fcf281d6d7b8ed0e087b6d77e4d686e28e1fa
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "103688711"
---
# <a name="com-resource-dispenser-concepts"></a><span data-ttu-id="6d3a7-103">COM + 資源配置器概念</span><span class="sxs-lookup"><span data-stu-id="6d3a7-103">COM+ Resource Dispenser Concepts</span></span>

<span data-ttu-id="6d3a7-104">應用程式元件使用 COM + 資源配置器來存取和管理共用的非持久性狀態資訊，例如元件之間的連接，以及指定的資源管理員。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-104">Application components use the COM+ resource dispenser to access and manage shared, nondurable state information, such as connections between components and a given resource manager.</span></span> <span data-ttu-id="6d3a7-105">在執行時間，資源配置器可使用動態資源集區，例如資料庫連接、網路連接、佇列、執行緒、物件和記憶體區塊的連接。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-105">At runtime, dynamic pools of resources, such as database connections, network connections, connections to queues, threads, objects, and memory blocks, are made available to the resource dispenser.</span></span> <span data-ttu-id="6d3a7-106">應用程式進程會使用最少的常用資源數目來達到高效能。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-106">The application process achieves high performance by using a minimum number of frequently used resources.</span></span> <span data-ttu-id="6d3a7-107">資源配置器也可以自動執行交易和回收。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-107">The resource dispenser can also automate transactions and reclamation.</span></span> <span data-ttu-id="6d3a7-108"> (如需此功能的詳細資訊，請參閱 [自動資源回收](automatic-resource-reclamation.md) 。 ) </span><span class="sxs-lookup"><span data-stu-id="6d3a7-108">(See [Automatic Resource Reclamation](automatic-resource-reclamation.md) for more information about this feature.)</span></span>

> [!Note]  
> <span data-ttu-id="6d3a7-109">資源是資源配置器所建立的任何 *資源* 。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-109">A *resource* is anything a resource dispenser creates.</span></span> <span data-ttu-id="6d3a7-110">例如，資源管理員的連接是常見的資源。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-110">For example, a connection to a resource manager is a common resource.</span></span> <span data-ttu-id="6d3a7-111">資源位於資源配置器的記憶體中，而且永遠不會複製到分配器管理員。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-111">Resources reside in the resource dispenser's memory and are never copied to the dispenser manager.</span></span> <span data-ttu-id="6d3a7-112">只有 (**RESID**) 的不透明控制碼知道資源，且不一定能夠執行交易。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-112">A resource is known only by an opaque handle (**RESID**) and may or may not be capable of performing transactions.</span></span> <span data-ttu-id="6d3a7-113">雖然受管理的資源通常可能會連接到管理持久狀態的元件，但連線本身並不是永久性的。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-113">Although the resources managed might often be connections to a component managing a durable state, the connections themselves are not durable.</span></span> <span data-ttu-id="6d3a7-114">資源配置器通常會使用相關的資源管理員來保留持久狀態。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-114">A resource dispenser often uses a related resource manager to retain the durable state.</span></span>

 

<span data-ttu-id="6d3a7-115">就架構而言，COM + 資源配置器系統包含資源機和分配器管理員。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-115">Architecturally, the COM+ resource dispenser system consists of resource dispensers and a dispenser manager.</span></span> <span data-ttu-id="6d3a7-116">資源機是使用者提供的元件，可為應用程式提供簡單的共用資源介面。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-116">Resource dispensers are user-supplied components that provide applications with simple interfaces to shared resources.</span></span> <span data-ttu-id="6d3a7-117">分配器管理員是 COM + 所提供的元件，可協調各種資源機的活動。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-117">The dispenser manager is a component provided by COM+ that coordinates the activities of the various resource dispensers.</span></span>

<span data-ttu-id="6d3a7-118">資源配置器是動態連結程式庫 (DLL) 元件，可提供至少兩個介面。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-118">A resource dispenser is a dynamic-link library (DLL) component that provides at least two interfaces.</span></span> <span data-ttu-id="6d3a7-119">第一個 [**IDispenserDriver**](/windows/desktop/api/ComSvcs/nn-comsvcs-idispenserdriver)會為分配器管理員提供有關如何建立、終結和登錄所管理資源的基本資訊。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-119">The first, [**IDispenserDriver**](/windows/desktop/api/ComSvcs/nn-comsvcs-idispenserdriver), provides the dispenser manager with basic information on how to create, destroy, and enlist the resources it manages.</span></span> <span data-ttu-id="6d3a7-120">第二個是公開給應用程式，可以是 COM 介面或一組介面，也可以是應用程式設計介面， (API) 透過匯入程式庫連結元件。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-120">The second is exposed to the applications and can be a COM interface or set of interfaces or can be an application programming interface (API) to which a component is linked via an import library.</span></span> <span data-ttu-id="6d3a7-121">應用程式可以呼叫任何資源配置器，進而將任何 API 提供給應用程式。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-121">An application can call any resource dispenser, which in turn may offer any API to the application.</span></span> <span data-ttu-id="6d3a7-122">如果資源配置器是自動化元件，則可以從 Microsoft Visual Basic 存取。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-122">If the resource dispenser is an Automation component, it can be accessed from Microsoft Visual Basic.</span></span> <span data-ttu-id="6d3a7-123">當應用程式元件參考資源配置器時，會將它具現化。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-123">A resource dispenser is instantiated when an application component refers to it.</span></span>

<span data-ttu-id="6d3a7-124">COM + 所提供的分配器管理員會追蹤資源機和它們之間的座標。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-124">The dispenser manager provided by COM+ tracks resource dispensers and coordinates among them.</span></span> <span data-ttu-id="6d3a7-125">它會執行兩個介面： [**IDispenserManager**](/windows/desktop/api/ComSvcs/nn-comsvcs-idispensermanager) 和 [**IHolder**](/windows/desktop/api/ComSvcs/nn-comsvcs-iholder)。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-125">It implements two interfaces: [**IDispenserManager**](/windows/desktop/api/ComSvcs/nn-comsvcs-idispensermanager) and [**IHolder**](/windows/desktop/api/ComSvcs/nn-comsvcs-iholder).</span></span> <span data-ttu-id="6d3a7-126">資源機會使用 **IDispenserManager** 介面自行註冊。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-126">resource dispensers register themselves using the **IDispenserManager** interface.</span></span> <span data-ttu-id="6d3a7-127">然後，分配器管理員會為其提供 **IHolder** 的指標，以用來通知其活動的分配器管理員。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-127">The dispenser manager then gives them a pointer to an **IHolder** that they use to notify the dispenser manager of their activities.</span></span>

<span data-ttu-id="6d3a7-128">交易式資源配置器必須登錄分散式交易協調器的 (DTC) 交易。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-128">A transactional resource dispenser must enlist in a Distributed Transaction Coordinator (DTC) transaction.</span></span> <span data-ttu-id="6d3a7-129">這表示使用內部或外部 (與與 OLE 交易相容的資源配置) 資源管理員。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-129">This implies use of either an internal or an external (to the resource dispenser) resource manager that is OLE transactions-compliant.</span></span>

> [!Note]  
> <span data-ttu-id="6d3a7-130">COM + 程式設計模型包含 *宣告式交易*，可協助保護應用程式物件在其存留期間所執行的工作。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-130">The COM+ programming model includes *declarative transactions*, which help protect the work performed by an application object during its lifetime.</span></span> <span data-ttu-id="6d3a7-131">當應用程式物件使用 COM + 資源配置器時，它所執行的工作會自動進行交易;也就是說，元件不需要明確宣告交易。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-131">When an application object uses a COM+ resource dispenser, the work it performs is automatically transactional; that is, the component doesn't have to explicitly declare transactions.</span></span> <span data-ttu-id="6d3a7-132">這些交易是在 OLE 交易規格中定義、由 DTC 所執行，並由 COM + 代表應用程式物件起始。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-132">These transactions are defined in the OLE Transactions specification, implemented by the DTC, and initiated on behalf of the application object by COM+.</span></span> <span data-ttu-id="6d3a7-133">如需詳細資訊，請參閱 DTC 開發指南。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-133">See the DTC Development Guide for more information.</span></span>

 

<span data-ttu-id="6d3a7-134">資源不需要交易。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-134">Resources need not be transactional.</span></span> <span data-ttu-id="6d3a7-135">將非交易式資源集區的資源配置器，仍然可以藉由讓應用程式物件存取這些資源的共用集區，來達到高效能。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-135">A resource dispenser that pools non-transactional resources can still achieve high performance by allowing application objects to access a shared pool of these resources.</span></span> <span data-ttu-id="6d3a7-136">這種類型的資源配置器 \_ 會從 [**IDispenserDriver：： EnlistResource**](/windows/desktop/api/ComSvcs/nf-comsvcs-idispenserdriver-enlistresource) 方法傳回 S FALSE，這表示資源配置器未登錄資源，因為資源不是交易式。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-136">This type of resource dispenser returns S\_FALSE from the [**IDispenserDriver::EnlistResource**](/windows/desktop/api/ComSvcs/nf-comsvcs-idispenserdriver-enlistresource) method, which means that the resource dispenser did not enlist the resource because the resource is not transactional.</span></span>

<span data-ttu-id="6d3a7-137">資源配置器也可以獨立于 COM + 運作，只提供資源分享功能。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-137">The resource dispenser can also function independently of COM+, providing only resource pooling capabilities.</span></span> <span data-ttu-id="6d3a7-138">例如，如果資源配置器公開 API (例如 ODBC) ，則資源配置器可能是透過匯入程式庫（ (）或使用 [**LoadLibrary**](/windows/desktop/api/libloaderapi/nf-libloaderapi-loadlibrarya) 和 [**GetProcAddress**](/windows/desktop/api/libloaderapi/nf-libloaderapi-getprocaddress) 函數) 所存取的 DLL。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-138">For example, if a resource dispenser exposes an API (such as ODBC), the resource dispenser might be a DLL that is accessed by the application through an import library (or using the [**LoadLibrary**](/windows/desktop/api/libloaderapi/nf-libloaderapi-loadlibrarya) and [**GetProcAddress**](/windows/desktop/api/libloaderapi/nf-libloaderapi-getprocaddress) functions).</span></span> <span data-ttu-id="6d3a7-139">資源配置器也可能是應用程式透過呼叫 [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance)來存取的 COM 元件。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-139">A resource dispenser might also be a COM component that an application accesses by calling [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance).</span></span> <span data-ttu-id="6d3a7-140">如果沒有 COM +，就永遠無法呼叫資源配置器的 [**EnlistResource**](/windows/desktop/api/ComSvcs/nf-comsvcs-idispenserdriver-enlistresource) 方法，因為分配器管理員不知道目前的元件交易。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-140">Without COM+, a resource dispenser's [**EnlistResource**](/windows/desktop/api/ComSvcs/nf-comsvcs-idispenserdriver-enlistresource) method can never be called because the dispenser manager has no knowledge of the current component transaction.</span></span>

<span data-ttu-id="6d3a7-141">在啟動時，資源配置程式 DLL 必須向分配器管理員註冊本身。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-141">On startup, a resource dispenser DLL must register itself with the dispenser manager.</span></span> <span data-ttu-id="6d3a7-142">分配器管理員是控制管理和卸載資源機、提供 COM + 內容，以及控制清查統計資料管理員的控制主管。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-142">The dispenser manager is the controlling executive that manages the loading and unloading of resource dispensers, provides the COM+ context, and controls the inventory statistics manager.</span></span> <span data-ttu-id="6d3a7-143"> (需詳細資訊，請參閱 [Com + 分配管理員](com--dispenser-manager.md)。 ) 資源配置器會先呼叫 [**GetDispenserManager**](/windows/desktop/api/MtxDM/nf-mtxdm-getdispensermanager) 函式，然後呼叫 [**IDispenserManager：： RegisterDispenser**](/windows/desktop/api/ComSvcs/nf-comsvcs-idispensermanager-registerdispenser) 方法，傳遞資源配置器所執行的 [**IDispenserDriver**](/windows/desktop/api/ComSvcs/nn-comsvcs-idispenserdriver) 指標。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-143">(For more information, see [COM+ Dispenser Manager](com--dispenser-manager.md).) The resource dispenser first calls the [**GetDispenserManager**](/windows/desktop/api/MtxDM/nf-mtxdm-getdispensermanager) function and then calls the [**IDispenserManager::RegisterDispenser**](/windows/desktop/api/ComSvcs/nf-comsvcs-idispensermanager-registerdispenser) method, passing the [**IDispenserDriver**](/windows/desktop/api/ComSvcs/nn-comsvcs-idispenserdriver) pointer that the resource dispenser implements.</span></span> <span data-ttu-id="6d3a7-144">此呼叫會傳回 [**IHolder**](/windows/desktop/api/ComSvcs/nn-comsvcs-iholder)的參考。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-144">This call returns a reference to [**IHolder**](/windows/desktop/api/ComSvcs/nn-comsvcs-iholder).</span></span>

<span data-ttu-id="6d3a7-145">為了關閉，資源配置器會呼叫 [**IHolder：： Close**](/windows/desktop/api/ComSvcs/nf-comsvcs-iholder-close)。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-145">To shut down, a resource dispenser calls [**IHolder::Close**](/windows/desktop/api/ComSvcs/nf-comsvcs-iholder-close).</span></span> <span data-ttu-id="6d3a7-146">為了確保乾淨的封裝關機，資源配置器必須能夠處理在 COM + 要求系統關閉之後，從商務物件呼叫繼續抵達的情況。</span><span class="sxs-lookup"><span data-stu-id="6d3a7-146">To ensure a clean package shutdown, a resource dispenser must be able to handle the situation when calls continue to arrive from business objects after COM+ has asked the dispenser to shut down.</span></span>

<span data-ttu-id="6d3a7-147">本節中的下列主題提供 COM + 資源配置器服務的詳細資訊：</span><span class="sxs-lookup"><span data-stu-id="6d3a7-147">The following topics in this section provide more detailed information about the COM+ resource dispenser service:</span></span>

-   [<span data-ttu-id="6d3a7-148">COM + 分配管理員</span><span class="sxs-lookup"><span data-stu-id="6d3a7-148">COM+ Dispenser Manager</span></span>](com--dispenser-manager.md)
-   [<span data-ttu-id="6d3a7-149">COM + 資源配置器執行緒類型</span><span class="sxs-lookup"><span data-stu-id="6d3a7-149">COM+ Resource Dispenser Thread Types</span></span>](com--resource-dispenser-thread-types.md)
-   [<span data-ttu-id="6d3a7-150">適用于 COM + 資源配置器的共用資源狀態</span><span class="sxs-lookup"><span data-stu-id="6d3a7-150">Pooled Resource States Available to COM+ Resource Dispenser</span></span>](pooled-resource-states-available-to-com--resource-dispenser.md)
-   [<span data-ttu-id="6d3a7-151">在交易中登記資源</span><span class="sxs-lookup"><span data-stu-id="6d3a7-151">Enlisting a Resource in a Transaction</span></span>](enlisting-a-resource-in-a-transaction.md)
-   [<span data-ttu-id="6d3a7-152">資源配置器資源配置進程</span><span class="sxs-lookup"><span data-stu-id="6d3a7-152">Resource Dispenser Resource Allocation Process</span></span>](resource-dispenser-resource-allocation-process.md)
-   [<span data-ttu-id="6d3a7-153">追蹤未配置的資源</span><span class="sxs-lookup"><span data-stu-id="6d3a7-153">Tracking Non-Allocated Resources</span></span>](tracking-non-allocated-resources.md)
-   [<span data-ttu-id="6d3a7-154">自動資源回收</span><span class="sxs-lookup"><span data-stu-id="6d3a7-154">Automatic Resource Reclamation</span></span>](automatic-resource-reclamation.md)
-   [<span data-ttu-id="6d3a7-155">COM + 資源配置器介面中使用的類型</span><span class="sxs-lookup"><span data-stu-id="6d3a7-155">Types Used in COM+ Resource Dispenser Interfaces</span></span>](types-used-in-com--resource-dispenser-interfaces.md)
-   [<span data-ttu-id="6d3a7-156">COM + 資源配置器介面</span><span class="sxs-lookup"><span data-stu-id="6d3a7-156">COM+ Resource Dispenser Interfaces</span></span>](com--resource-dispenser-interfaces.md)

## <a name="related-topics"></a><span data-ttu-id="6d3a7-157">相關主題</span><span class="sxs-lookup"><span data-stu-id="6d3a7-157">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="6d3a7-158">COM + 資源配置器工作</span><span class="sxs-lookup"><span data-stu-id="6d3a7-158">COM+ Resource Dispenser Tasks</span></span>](com--resource-dispenser-tasks.md)
</dt> </dl>

 

 
