---
description: 當您準備好要在 Microsoft Visual C++ 元件中進行 COM + 功能的偵錯工具時，您可以設定 Visual C++ 專案或 [元件服務] 系統管理工具來啟動偵錯工具。
ms.assetid: 206467ac-108a-49de-a884-66959dc77650
title: 調試 Visual C++ 中撰寫的元件
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a14e4b6324cc69531f09612c2af37fa03a036fd4
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "106970313"
---
# <a name="debugging-components-written-in-visual-c"></a>調試 Visual C++ 中撰寫的元件

當您準備好要在 Microsoft Visual C++ 元件中進行 COM + 功能的偵錯工具時，您可以設定 Visual C++ 專案或 [元件服務] 系統管理工具來啟動偵錯工具。 如果您使用 Visual C++，就可以使用 OLE RPC 和即時 (JIT) 的偵測，以遠端用戶端進行的調試。 如果您無法在偵錯工具下執行用戶端，或者用戶端是在另一部電腦上執行，您可以在 **偵錯工具設定中** 使用 Com + 啟動。 您可以在 [COM + 應用程式 **屬性**] 對話方塊的 [ **Advanced** ] 索引標籤上，于 [元件服務] 系統管理工具中找到這個核取方塊。

當您完成偵錯工具時，您應該關閉正在進行偵錯工具的 COM + 應用程式。 如果伺服器進程仍在執行中，當您下次嘗試在記憶體中載入現有的 DLL 時，當您嘗試建立 DLL 時，您可能會收到錯誤訊息。 若要關閉 COM + 應用程式，請在主控台樹中的應用程式上按一下滑鼠右鍵，然後按一下 [ **關閉**]。

> [!Note]  
> 如果您使用交易，您可能也會想要增加交易超時時間（預設為60秒）。 您也可以指定0的值，有效地指定無限的交易超時時間。 使用 [元件服務] 系統管理工具，變更 [**我的電腦屬性**] 視窗中 [**選項**] 索引標籤上的 [交易超時設定]。

 

## <a name="debugging-server-application-components-with-visual-c"></a>使用 Visual C++ 來調試伺服器應用程式元件

在偵測 COM + 伺服器應用程式時，您可能會想要將用戶端和伺服器應用程式同時載入至偵錯工具，以進行遠端呼叫的偵錯工具。 使用 Visual C++，您可以透過即時 (JIT) 和 OLE RPC 設定，來對元件進行遠端呼叫的偵測。 JIT 設定會導致編譯的元件在發生錯誤時啟動 Visual C++ 偵錯工具;當您逐步執行程式碼時，OLE RPC 設定可讓偵錯工具逐步執行用戶端與元件。

啟用這些功能時，您可以在偵錯工具下啟動您的用戶端。 當用戶端對您的元件進行呼叫時，偵錯工具會逐步執行伺服器進程中的元件程式碼，即使伺服器位於網路上的其他電腦上也一樣。 必要時，伺服器電腦上的偵錯工具會自動啟動。 同樣地，在元件程式碼中的 return 語句之後的單一逐步執行，將會傳回用戶端程式代碼中下一個語句的偵錯工具。

> [!Note]  
> 您可以使用 [COM + **啟動于偵錯工具** ] 設定來儲存幾個步驟。 這可讓您指定 Visual C++ (或其他) 偵錯工具，而不需要在 Visual C++ 環境中進行特殊的偵錯工具設定。 您可以在 [COM + 應用程式 **屬性**] 對話方塊的 [ **Advanced** ] 索引標籤上，于 [元件服務] 系統管理工具中找到這個核取方塊。 如需詳細資訊，請參閱本主題中的「不 Visual C++ 的偵錯工具」。

 

當包含元件的 COM + 應用程式是伺服器應用程式時，您必須先使用 [元件服務] 系統管理工具來關閉應用程式。 若要這樣做，請在主控台樹中的 COM + 應用程式上按一下滑鼠右鍵，然後按一下 [ **關閉**]。

**若要在 Visual C++ 中啟用 RPC 調試**

1.  在 Visual C++ 中，按一下 [ **工具** ] 功能表上的 [ **選項**]。

2.  在 [ **選項** ] 對話方塊的 [ **調試** ] 索引標籤上，選取 [ **OLE RPC 調試** 和 **即時調試** ] 核取方塊。

3.  按一下 [確定]  。

若要開始進行偵錯工具，請在偵錯工具中啟動您的用戶端專案。

您也可以在偵錯工具中不啟動用戶端的情況下，對元件進行偵錯工具。 在此情況下，您的元件必須自行啟動偵錯工具。 若要這樣做，您的元件專案必須針對 debug 會話指定可執行檔，以及 COM + 應用程式識別碼。

**若要啟用伺服器應用程式元件以啟動 Visual C++ 偵錯工具**

1.  在 [ **專案** ] 功能表上，按一下 [ **設定**]。

2.  在 [ **專案設定** ] 對話方塊的 [ **設定** ] 方塊中，選取 [ **Win32 Debug**]。

3.  在 [ **調試** ] 索引標籤的 [ **類別目錄** ] 方塊中，選取 **[一般**]。

4.  在 [ **用於偵錯工具的可執行檔** ] 方塊中，輸入 Dllhost.exe 的完整路徑，後面接著一個引數，指定包含元件的 com + 應用程式的應用程式識別碼。

    > [!Note]  
    > 您可以使用 [元件服務] 系統管理工具，在 [COM + 應用程式的 **屬性**] 對話方塊的 [**一般**] 索引標籤上找到應用程式識別碼。 以下是範例：

     

    > [!Note]  
    > C： \\ Winnt \\ System32 \\Dllhost.exe/ProcessID： {applicationID}

     

5.  按一下 [確定]  。

您現在可以設定中斷點、啟動偵錯工具，以及開始對您的元件進行呼叫。

## <a name="debugging-library-application-components-with-visual-c"></a>使用 Visual C++ 偵錯工具程式庫應用程式元件

若要在程式庫應用程式中進行元件的偵錯工具，您必須設定用戶端的專案，因為用戶端的進程將裝載程式庫應用程式。

**使用 Visual C++ 啟用程式庫應用程式偵錯工具**

1.  在 Visual C++ 的 [ **專案** ] 功能表上，按一下 [ **設定**]。

2.  在 [ **專案設定** ] 對話方塊的 [ **設定** ] 方塊中，按一下 [ **Win32 Debug**]。

3.  在 [ **調試** ] 索引標籤的 [ **類別目錄** ] 方塊中，按一下 [ **其他 dll**]。

4.  在 **模組** 清單中，在您的程式庫應用程式中新增元件 dll。 這可讓您在實際載入 DLL 之前設定中斷點。

5.  按一下 [確定]  。

## <a name="debugging-without-visual-c"></a>不 Visual C++ 的調試

無論您是否使用 Visual C++ 進行偵錯工具，都可以使用 [ **在偵錯工具中啟動** ] 設定來指定應在其中執行元件的偵錯工具。

**從元件服務系統管理工具指定偵錯工具**

1.  在主控台樹中，選取包含您想要進行偵錯工具之元件的 COM + 程式庫應用程式。

2.  以滑鼠右鍵按一下應用程式，然後按一下 [ **屬性**]。

3.  在應用程式的 [ **屬性** ] 對話方塊中，按一下 [ **Advanced （Advanced** ）] 索引標籤。

4.  在 [ **調試** 程式] 下，選取 [ **在偵錯工具中啟動** ] 核取方塊。

5.  在 [ **偵錯工具路徑** ] 方塊中，輸入您要使用之偵錯工具的路徑。 您也可以按一下 **[流覽]** 找出偵錯工具。 以下是範例： C： \\ Winnt \\ System32 \\Ntsd.exe。

6.  按一下 [確定]  。

## <a name="related-topics"></a>相關主題

<dl> <dt>

[調試 Visual Basic 中撰寫的元件](debugging-components-written-in-visual-basic.md)
</dt> </dl>

 

 



