---
description: 一般來說，分散式應用程式各層之間的延遲會有很大的差異。
ms.assetid: 4780a9fd-5940-4b10-a596-22214b17c033
title: 將 COM + 商務邏輯層和展示層之間的互動優化
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3ca519c6aa7f1585648b0def6530b7f224f12a98961193e4f6f7cc490a747b09
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/11/2021
ms.locfileid: "118306100"
---
# <a name="optimizing-interactions-between-the-com-business-logic-tier-and-the-presentation-tier"></a>將 COM + 商務邏輯層和展示層之間的互動優化

一般來說，分散式應用程式各層之間的延遲會有很大的差異。 展示層和商務邏輯層之間的呼叫通常會比商務層和資料層之間的呼叫速度慢很多。 因此，在呼叫商務邏輯層時，保持狀態的成本會更高。

下列主題討論在簡報和商務邏輯層之間傳遞資料的方式：

-   [傳遞參數](#passing-parameters)
-   [資料傳遞選項](#data-passing-options)
-   [使用 Factory 模式傳遞資料](#using-a-factory-pattern-to-pass-data)
-   [相關主題](#related-topics)

## <a name="passing-parameters"></a>傳遞參數

針對要在展示層和商務邏輯層之間傳遞的一組特定資訊，您可能會有單一資料列、多個資料列或單一資料列的組合 (例如標頭) 和多個詳細資料列的資料。 在各層之間傳遞這項資訊最有效率的方式，就是透過單一方法呼叫。 此單一呼叫會管理要傳遞的整個資訊集。 這是必要的，除非您選擇從展示層 (控制交易，並讓展示層中的所有交易處理都與函數) 相同。 Microsoft 不建議從展示層進行交易，因為這一層和商務邏輯層之間的呼叫通常是多層式應用程式中任何呼叫的最慢。

建立這類方法的其中一種方式，是將單一資料列的資訊當作參數傳遞，並將多個資料列傳遞為 ADO 記錄集。 記錄集是 Microsoft ADO 資料存取方法的核心，而使用 ADO 記錄集可讓您以單一步驟傳遞與單一交易相關的所有資訊。

## <a name="data-passing-options"></a>資料傳遞選項

傳遞資料時還有其他要考慮的選項。 這些包括使用參數清單和 ADO 記錄集 (如先前所述) 、ADO 記錄集、XML 編碼字串或結構的陣列。 本節將討論這些選項。

下表顯示使用四種不同的引數傳遞可能性時，需要特別注意的領域。 「X」代表需要瞭解和權衡各專案需求之取捨的領域。 請不要針對每個元件進行引數傳遞決策。 在整個專案中，一致程式設計模型的優點，遠遠超過了針對每個方法或每個元件進行優化的優點，但最極端的情況是如此。 資料表後面的清單中會說明這些資料行。



|     &nbsp;                  | 並行  | WAN          | 部署   | 複雜度   |
|-----------------------|--------------|--------------|--------------|--------------|
| 進入 | 值 |
| 集中<br/> |              | X<br/> | X<br/> | X<br/> |
| XML<br/>        | X<br/> |              | X<br/> | X<br/> |
| 陣列<br/>     | X<br/> |              | X<br/> | X<br/> |



 

四個數據行定義使用該選項來傳遞參數時要注意的區域。

-   **並行資料行** 代表需要撰寫程式碼或提供機制，以管理更新作業的鎖定條件。 由於執行儲存的方法可以代表更新，因此可能會發生並行問題。 有兩種類型的鎖定是普遍的開放式和封閉式。 封閉式鎖定可防止使用者取得資料進行更新，而另一位使用者則有可能執行更新。 開放式鎖定可針對任何兩位使用者同時更新相同檔的可能性進行交易，以支援更多使用者。 開放式鎖定呼叫，可檢查儲存的資料是否與存取資料複本以進行修改時的資料相符。 ADO 記錄集提供自動支援開放式鎖定。 包含單一資料列參數清單的更新案例無法提供足夠的並行檢查支援。 XML 有這個相同的問題，因為 XML 資料中沒有鎖定感知。
-   **Wan 資料行** 代表在廣域網路 (WAN ) 上可能會有傳輸爭用的狀況。 當 WAN 沒有足夠的容量來管理任何一次移動的資料時，應用程式使用者會遇到回應時間延遲。 為了支援開放式平行存取，已中斷連線的 ADO 記錄集會將兩份資料複本從伺服器傳遞至用戶端。 當認可變更時，用戶端會使用第二個複本來決定要傳回的最小更新資料列集。 雖然這會減少從展示層到資料的流量，但第二個複本的額外負載可能很重要。 使用記錄集作為傳遞所有資訊的唯一方法，因此會導致在各層之間傳遞兩倍的資料（如有需要），除非從展示層將更新資料列集傳回資料層。
-   **[部署** ] 資料行代表在網路呼叫端和元件端需要特殊技術時，與資料傳遞相關的問題。 例如，使用 ADO 記錄集時，用戶端和伺服器上都需要有 ADO 元件。 XML 剖析器也必須同時存在於兩端，以避免必須將剖析器編碼至您的應用程式。
-   **[複雜性** ] 資料行會針對所有四個選項來指出，而且是您的開發組織中可能已建立的喜好設定或先前的程式設計模型體驗。 某些人發現參數傳遞很麻煩，因此會增加太多複雜的程式設計問題。 追蹤您正在處理的參數，並將它們全部顯示在一個編輯視窗中，可以創造一些開發人員認為無法管理的物流複雜度。

參數傳遞方法也可以進行取捨，如下所示：

-   參數可以管理多個引數和引數類型，也必須決定何時適合讓記錄集成為參數。
-   ADO 記錄集可以將方法參數中的階層式關聯性剪下為一或兩個引數。 這可大幅簡化程式設計模型，並支援稍後新增資料行，但它也會隱藏資訊階層。 將資訊裝到 ADO 記錄集，並在稍後進行解壓縮，會牽涉到知道每個資料行的名稱，或知道資料行順序。 這種情況可能會增加專案上其他元件或應用程式開發人員的複雜度。
-   XML 是上面所述隱藏階層複雜的不同微調。 程式設計人員必須瞭解如何使用 XML 剖析器來取得資訊的存取權，而且通常必須知道資料集中每個專案的名稱，才能找到資料集。
-   結構的陣列導入了在呼叫端和元件的部分上傳遞資訊的一般需求。 這需要在兩個系統元素之間共用的對應，在處理不同版本的元件時可能會造成困難。 雖然方法簽章可能不會變更，但對預期資訊的變更可能會導致呼叫程式不相容。

因為與所有四個參數傳遞方法相關的複雜性問題都很類似，所以爭議有一個明顯的簡化機會與任何選取專案相關聯。

## <a name="using-a-factory-pattern-to-pass-data"></a>使用 Factory 模式傳遞資料

其中一個重要的設計點是很容易使用。 當您決定使用 ADO 記錄集將一組結構化的詳細資料傳回給展示層時，您會發現複雜性的問題。 展示層程式設計人員必須瞭解這些記錄集的結構。 當您需要在記錄集中傳遞一組資料的多個詳細資料時，可能會產生更複雜的問題。 若要簡化重要的工作，每當您想要要求以結構化 ADO 記錄集傳遞資料時，您應該考慮建立記錄集 factory 方法。

記錄集 factory 應該會傳回空白但可寫入的已中斷連接記錄集給呼叫者。 此記錄集應該具有適當的欄位 (名稱和資料類型) 已設定，如此呼叫的用戶端就不需要知道如何製造記錄集。 這種方法通常稱為 *factory 模式* ，是一種常見的解決方案模式，可解決需要建立特定複雜性物件的需求，而不需要知道建立物件的細節。

簡單的設計選擇，例如在傳遞資訊的每個方法中選擇相同資料片段的相同參數名稱，可讓您輕鬆地查看方法，並瞭解預期的結果。 確定傳遞引數的順序在整個方法系列中都是一致的，可提供強制執行一致模型的緩和點。

## <a name="related-topics"></a>相關主題

<dl> <dt>

[優化 COM + 商務邏輯層與資料層之間的互動](optimizing-interactions-between-the-com--business-logic-tier-and-the-data-tier.md)
</dt> </dl>

 

 




