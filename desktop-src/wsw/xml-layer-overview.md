---
title: XML 層總覽
description: WWSAPI 中的 XML API 是以 XML 讀取器和 XML 寫入器物件為基礎，允許以順向方式讀取或寫入 XML 檔。 XML 層可讓應用程式完整存取和控制訊息的內容。
ms.assetid: 938ca257-fbb8-4569-b791-2148abb1a5a5
keywords:
- XML 層級總覽 Web Services for Windows
- WWSAPI
- WWS
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d9b5d062754adea7b48bd42a6a501ce17d0e332b
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/16/2019
ms.locfileid: "103673339"
---
# <a name="xml-layer-overview"></a>XML 層總覽

WWSAPI 中的 XML API 是以 [Xml 讀取器](xml-reader.md) 和 [xml 寫入器](xml-writer.md) 物件為基礎，允許以順向方式讀取或寫入 xml 檔。 XML 層可讓應用程式完整存取和控制訊息的內容。

## <a name="encoding"></a>編碼

XML API 支援編碼為的檔：

-   文字 (UTF-8、UTF-16 UTF-16LE、UTF-16) 
-   Binary
-   MTOM

## <a name="storage"></a>儲存體

XML API 支援處理儲存為的檔：

-   編碼位元組的記憶體中緩衝區
-   資料流程
-   [XML 緩衝區](xml-buffer.md)

[Xml 緩衝區](xml-buffer.md)是 xml 檔的結構化記憶體中標記法。 這是比編碼為位元組的檔更有效率的標記法。 您可以流覽、讀取或寫入儲存在 XML 緩衝區中的 XML 檔。

## <a name="io"></a>I/O

除非特別要求，否則 XML API 永遠不會執行 i/o。 此外，任何 i/o 都可能以非同步方式起始。 如需有關使用 XML API 進行非同步處理的詳細資訊，請參閱 [**WsFillReader**](/windows/desktop/api/WebServices/nf-webservices-wsfillreader) 和 [**WsFlushWriter**](/windows/desktop/api/WebServices/nf-webservices-wsflushwriter) 。

## <a name="processing"></a>Processing

XML API 有三個不同的層級，可處理檔。

一次可以處理一個 [**節點**](/windows/desktop/api/WebServices/ns-webservices-ws_xml_node) 的檔。 這可提供最精細的 XML 內容處理，並提供檔完整的資料精確度。 在此層級，將會使用 [**WsReadNode**](/windows/desktop/api/WebServices/nf-webservices-wsreadnode) 和 [**WsWriteNode**](/windows/desktop/api/WebServices/nf-webservices-wswritenode) 和 [**WsCopyNode**](/windows/desktop/api/WebServices/nf-webservices-wscopynode) 函式。

下一個控制層級是 Api，例如 [**WsReadStartElement**](/windows/desktop/api/WebServices/nf-webservices-wsreadstartelement)、 [**WsReadValue**](/windows/desktop/api/WebServices/nf-webservices-wsreadvalue) 和 [**WsReadEndElement**](/windows/desktop/api/WebServices/nf-webservices-wsreadendelement)。 這些 Api 提供許多類型的驗證、略過空白字元和批註，以及將文字和 CDATA 標準化，讓取用者以更簡單的 xml 觀點呈現。

最高層級的控制是使用序列化 API。 這些 Api 是由 C 資料類型與 XML 之間的對應所驅動，而且可以使用單一函式（例如 [**WsWriteElement**](/windows/desktop/api/WebServices/nf-webservices-wswriteelement) 和 [**WsReadElement**](/windows/desktop/api/WebServices/nf-webservices-wsreadelement)），將複雜的記憶體內部結構讀取或寫入至 xml。

XML 正常化 Api 可用來產生標準格式的 XML，該格式可能會被用來透過 XML 內容產生密碼編譯簽章。

## <a name="creating-a-writer"></a>建立寫入器

若要建立並使用寫入器來寫入記憶體中的緩衝區：

``` syntax
WsCreateWriter              // Create an instance of a WS_XML_WRITER
// Initialize a WS_XML_WRITER_BUFFER_OUTPUT
WsSetOutput                 // Set the encoding and output of the writer along with any other writer properties
// Write Elements
WsGetWriterProperty(..., WS_XML_WRITER_PROPERTY_BYTES, ...)  // Get the generated bytes as a single byte array
// Use the generated bytes
WsFreeWriter                // Free the writer
```

若要建立並使用寫入器寫入資料流程：

``` syntax
WsCreateWriter              // Create an instance of a WS_XML_WRITER
// Initialize a WS_XML_WRITER_STREAM_OUTPUT
WsSetOutput                 // Set the encoding and output of the writer along with any other writer properties
// Write Elements
WsFlushWriter               // Force any buffered data to be written
WsFreeWriter                // Free the writer
```

若要建立並使用寫入器來寫入 [WS \_ XML \_ 緩衝區](ws-xml-buffer.md)：

``` syntax
WsCreateXmlBuffer           // Create the buffer to write to
WsCreateWriter              // Create an instance of a WS_XML_WRITER
WsSetOutputToBuffer         // Set the output buffer along with any other writer properties
// Write Elements
WsFreeWriter                // Free the writer
// The buffer has the generated document
```

在所有情況下，可能會包含屬性 [**WS \_ xml \_ 寫入器 \_ 屬性 \_ 縮排**](/windows/desktop/api/WebServices/ne-webservices-ws_xml_writer_property_id) 來格式化 XML。

## <a name="writing-elements"></a>寫入項目

若要將元素寫入寫入器：

``` syntax
WsWriteStartElement          // Write a start element
for each attribute
{
// Write an attribute using either
WsWriteStartAttribute    // Write a start attribute
// Write Content
WsWriteEndAttribute      // Write an end attribute
// Or one of the following
WsWriteXmlnsAttribute    // Write an explicit xmlns attribute
}
// Write Elements or Content
WsWriteEndElement
```

也可以使用下列各項：

``` syntax
WsWriteArray                 // Write an array of primitive values as a series of repeated elements
```

## <a name="writing-content"></a>寫入內容

若要將內容寫入專案或屬性，您可以使用下列專案：

``` syntax
WsWriteChars                 // Write unicode characters from memory
WsWriteCharsUtf8             // Write UTF-8 encoded characters from memory
WsWriteBytes                 // Write binary data encoded as base64
WsPushBytes                  // Direct the writer to request that bytes be written
WsPullBytes                  // Direct the writer to read the bytes to be written
WsWriteValue                 // Write primitive values such as ints and BOOLs
WsWriteText                  // Write an WS_XML_TEXT
WsWriteQualifiedName         // Write a qualified name
```

您可以使用下列程式寫入檔，但在屬性中時可能無法使用。

``` syntax
WsWriteNode                  // Write a single WS_XML_NODE
WsCopyNode                   // Copy a single node, or an entire WS_XML_ELEMENT_NODE and children from an WS_XML_READER
```

您可以使用下列內容在文字檔中撰寫 CDATA 區段：

``` syntax
WsWriteStartCData            // Start a CDATA section in a text encoding
// Write Content
WsWriteEndCData              // End a CDATA section in text encoding
```

## <a name="miscellaneous"></a>其他

``` syntax
WsGetPrefixFromNamespace     // Find a prefix bound to a namespace
```

## <a name="creating-a-reader"></a>建立讀取器

若要建立並使用讀取器來讀取記憶體中的緩衝區：

``` syntax
WsCreateReader              // Create an instance of a WS_XML_READER
// Initialize a WS_XML_READER_BUFFER_INPUT
WsSetInput                  // Set the encoding and input of the reader along with any other reader properties
// Read Elements
WsFreeReader                // Free the reader
```

若要從資料流程建立讀取器並使用讀取器：

``` syntax
WsCreateReader              // Create an instance of a WS_XML_READER
// Initialize a WS_XML_READER_STREAM_INPUT
WsSetInput                  // Set the encoding and input of the reader along with any other reader properties
WsFillReader                // Populate the reader with data from the underlying stream
// Read Elements
WsFreeReader                // Free the reader
```

若要建立及使用讀取器來讀取 [WS \_ XML \_ 緩衝區](ws-xml-buffer.md)：

``` syntax
WsCreateXmlBuffer           // Create the buffer to write to
WsCreateReader              // Create an instance of a WS_XML_READER
WsSetInputToBuffer          // Set the input buffer along with any other reader properties
// Read Elements
WsFreeReader                // Free the reader
```

## <a name="reading-elements"></a>讀取項目

從讀取器讀取元素：

``` syntax
WsReadToStartElement         // Skip whitespace and comments to position the reader on a specific element
for each attribute of interest
{
WsFindAttribute          // Try Locate the attribute
if (found)
{
WsReadStartAttribute // Set the reader to read the attribute
// Read Content
WsReadEndAttribute   // Return the reader to the element
}
}
WsReadStartElement           // Advance the reader past the current element
// Read Elements or Content
WsWriteEndElement            // Advance the reader past the corresponding end element
```

也可以使用下列各項：

``` syntax
WsReadArray                  // Read an array of primitive values as a series of repeated elements
```

## <a name="reading-content"></a>讀取內容

若要讀取元素或屬性中的內容，可以使用下列專案：

``` syntax
WsReadChars                 // Read characters to memory as unicode
WsReadCharsUtf8             // Read characters to memory encoded as UTF-8
WsReadBytes                 // Read binary data encoded as base64
WsReadValue                 // Read primitive values such as ints and BOOLs
WsReadQualifiedName         // Read a qualified name
```

您可以使用下列程式來檢查讀取器所在的目前節點：

``` syntax
WsGetReaderNode             // Get the current node
```

## <a name="using-a-buffer"></a>使用緩衝區

寫入至 [WS \_ XML \_ 緩衝區](ws-xml-buffer.md) 時，可能會使用下列各項：

``` syntax
WsGetWriterPosition          // Get the current position of the writer in the document
WsSetWriterPosition          // Set the current position of the writer in the document
WsMoveWriter                 // Move relative to the current position in the document
WsRemoveNode                 // Delete an element or text from a document
```

從 [WS \_ XML \_ 緩衝區](ws-xml-buffer.md) 讀取時，可能會使用下列各項：

``` syntax
WsGetReaderPosition          // Get the current position of the reader in the document
WsSetReaderPosition          // Set the current position of the reader in the document
WsMoveReader                 // Move relative to the current position in the document
```

您可以使用下列來修改 [WS \_ XML \_ 緩衝區](ws-xml-buffer.md)：

``` syntax

WsRemoveNode                 // Delete an element or text from a document
```

## <a name="other"></a>其他

``` syntax
WsGetNamespaceFromPrefix     // Find a namespace bound to a prefix
WsGetXmlAttribute            // Find an "xml:space" or "xml:lang" attribute in scope
```

 

 




