---
description: 會話磁片區控制項
ms.assetid: e6d112f9-08c9-4d95-b37b-267beebd0d7f
title: 會話磁片區控制項
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: add29b18b39c942c54926190ef9c0f85e447bb88
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "103847382"
---
# <a name="session-volume-controls"></a><span data-ttu-id="58d6e-103">會話磁片區控制項</span><span class="sxs-lookup"><span data-stu-id="58d6e-103">Session Volume Controls</span></span>

<span data-ttu-id="58d6e-104">如先前所述，WASAPI 用戶端可以個別控制每個 [音訊會話](audio-sessions.md)的音量層級。</span><span class="sxs-lookup"><span data-stu-id="58d6e-104">As explained previously, WASAPI clients can individually control the volume level of each [audio session](audio-sessions.md).</span></span> <span data-ttu-id="58d6e-105">WASAPI 會將會話的磁片區設定一致地套用到會話中的所有資料流程。</span><span class="sxs-lookup"><span data-stu-id="58d6e-105">WASAPI applies the volume setting for a session uniformly to all of the streams in the session.</span></span> <span data-ttu-id="58d6e-106">每個磁片區層級都是0.0 到1.0 範圍的值，其中0.0 表示無回應，而1.0 表示完整磁片區 (沒有衰減) 。</span><span class="sxs-lookup"><span data-stu-id="58d6e-106">Each volume level is a value in the range 0.0 to 1.0, where 0.0 indicates silence and 1.0 indicates full volume (no attenuation).</span></span>

<span data-ttu-id="58d6e-107">用戶端會將第一個資料流程指派給該會話，以隱含方式建立會話。</span><span class="sxs-lookup"><span data-stu-id="58d6e-107">A client implicitly creates a session by assigning the first stream to that session.</span></span> <span data-ttu-id="58d6e-108">新會話的預設磁片區層級為1.0。</span><span class="sxs-lookup"><span data-stu-id="58d6e-108">The default volume level of the new session is 1.0.</span></span> <span data-ttu-id="58d6e-109">如先前所述，使用者可以透過控制項程式的使用者介面來調整會話的音量層級 (例如，Sndvol) 是 WASAPI 用戶端。</span><span class="sxs-lookup"><span data-stu-id="58d6e-109">As discussed previously, the user can adjust the volume level of the session through the user interface of a control program (for example, Sndvol) that is a WASAPI client.</span></span> <span data-ttu-id="58d6e-110">控制項設定是持續性的。</span><span class="sxs-lookup"><span data-stu-id="58d6e-110">The control settings are persistent.</span></span>

<span data-ttu-id="58d6e-111">除了用戶端控制的磁片區設定以外，系統也會將自己的磁片區設定套用至會話。</span><span class="sxs-lookup"><span data-stu-id="58d6e-111">In addition to the client-controlled volume settings, the system applies its own volume settings to sessions.</span></span> <span data-ttu-id="58d6e-112">這些設定是以音訊原則為基礎，而且會動態變更，以回應組成全域音訊混合的資料流程變更。</span><span class="sxs-lookup"><span data-stu-id="58d6e-112">These settings are based on audio policy and change dynamically in response to changes in the streams that make up the global audio mix.</span></span> <span data-ttu-id="58d6e-113">如需有關音訊原則的詳細資訊，請參閱 [使用者模式音訊元件](user-mode-audio-components.md)。</span><span class="sxs-lookup"><span data-stu-id="58d6e-113">For more information about audio policy, see [User-Mode Audio Components](user-mode-audio-components.md).</span></span>

<span data-ttu-id="58d6e-114">針對每個串流執行磁片區控制的系統軟體會將串流中的 PCM 樣本與有效的磁片區層級相乘。</span><span class="sxs-lookup"><span data-stu-id="58d6e-114">The system software that implements the volume control for each stream multiplies the PCM samples in the stream by the effective volume level.</span></span> <span data-ttu-id="58d6e-115">有效的磁片區層級是將用戶端和系統磁片區設定相乘的結果。</span><span class="sxs-lookup"><span data-stu-id="58d6e-115">The effective volume level is the result of multiplying the client and system volume settings.</span></span> <span data-ttu-id="58d6e-116">因此，信號波幅的結果變更是用戶端和系統磁片區層級的線性組合。</span><span class="sxs-lookup"><span data-stu-id="58d6e-116">Thus, the resulting change in signal amplitude is a linear combination of the client and system volume levels.</span></span> <span data-ttu-id="58d6e-117">例如，如果用戶端磁片區層級是0.8，而系統磁碟區層級是0.5，則有效磁片區層級 (0.8) <sup>。</sup> (0.5) = 0.4。</span><span class="sxs-lookup"><span data-stu-id="58d6e-117">For example, if the client volume level is 0.8 and the system volume level is 0.5, the effective volume level is (0.8)<sup>.</sup>(0.5) = 0.4.</span></span>

<span data-ttu-id="58d6e-118">請注意，觀察到的音量對信號波幅而言並非線性的。</span><span class="sxs-lookup"><span data-stu-id="58d6e-118">Note that perceived loudness is not linear with respect to signal amplitude.</span></span> <span data-ttu-id="58d6e-119">相反地，音量的變化大約是磁片區層級 v 的對數：</span><span class="sxs-lookup"><span data-stu-id="58d6e-119">Instead, loudness varies approximately as the logarithm of the volume level v:</span></span>

<span data-ttu-id="58d6e-120">音量（分貝 = 20）<sup>。</sup>記錄₁₀ (v) </span><span class="sxs-lookup"><span data-stu-id="58d6e-120">loudness in decibels = 20<sup>.</sup>log₁₀(v)</span></span>

<span data-ttu-id="58d6e-121">因此，設定 v = 0.5 會 attenuates 原始信號的音量， (在將磁片區層級套用) 6 分貝之前的信號、設定 v = 0.25 attenuates 信號乘以12分貝等等。</span><span class="sxs-lookup"><span data-stu-id="58d6e-121">Thus, setting v = 0.5 attenuates the loudness of the original signal (the signal before the volume level is applied) by 6 decibels, setting v = 0.25 attenuates the signal by 12 decibels, and so on.</span></span> <span data-ttu-id="58d6e-122">磁片區層級 v = 1.0 （對應至0分貝）不會改變原始信號等級。</span><span class="sxs-lookup"><span data-stu-id="58d6e-122">A volume level v = 1.0, corresponding to 0 decibels, does not alter the original signal level.</span></span>

<span data-ttu-id="58d6e-123">具有用來控制音量層級之使用者介面的音訊應用程式，通常會顯示在認知音量中產生變更的滑杆，並以線性方式與滑杆位置的變化呈正比。</span><span class="sxs-lookup"><span data-stu-id="58d6e-123">Audio applications with user interfaces for controlling the volume level typically display sliders that generate changes in perceived loudness that are linearly proportional to changes in slider position.</span></span> <span data-ttu-id="58d6e-124">若要產生觀察到的音量和滑杆位置之間的線性關聯性，應用程式必須定義磁片區層級 v 和滑杆位置之間的非線性關聯性。</span><span class="sxs-lookup"><span data-stu-id="58d6e-124">To produce a linear relationship between perceived loudness and slider position, the application must define a nonlinear relationship between the volume level v and the slider position.</span></span> <span data-ttu-id="58d6e-125">如需詳細資訊，請參閱 [音訊-錐音量控制項](audio-tapered-volume-controls.md)。</span><span class="sxs-lookup"><span data-stu-id="58d6e-125">For more information, see [Audio-Tapered Volume Controls](audio-tapered-volume-controls.md).</span></span>

<span data-ttu-id="58d6e-126">如先前所述，系統音量控制程式 Sndvol 會顯示每個音訊轉譯裝置上播放之音訊會話的音量滑杆。</span><span class="sxs-lookup"><span data-stu-id="58d6e-126">As explained previously, the system volume-control program, Sndvol, displays volume sliders for the audio sessions that are playing on each audio rendering device.</span></span> <span data-ttu-id="58d6e-127">這些滑杆會顯示在 [SndVol] 視窗中標示為 [ **應用程式** ] 的群組方塊中。</span><span class="sxs-lookup"><span data-stu-id="58d6e-127">These sliders appear in the group box labeled **Applications** in the SndVol window.</span></span> <span data-ttu-id="58d6e-128">一般而言，每個會話都會包含特定應用程式視窗中的所有播放資料流程。</span><span class="sxs-lookup"><span data-stu-id="58d6e-128">Typically, each session contains all of the playback streams from a particular application window.</span></span> <span data-ttu-id="58d6e-129">透過 Sndvol 視窗中的滑杆，使用者控制個別音訊應用程式的音量層級。</span><span class="sxs-lookup"><span data-stu-id="58d6e-129">Through the sliders in the Sndvol window, users control the volume levels of individual audio applications.</span></span>

<span data-ttu-id="58d6e-130">一般來說，應用程式應該將所有的播放串流指派給相同的音訊會話。</span><span class="sxs-lookup"><span data-stu-id="58d6e-130">As a general rule, an application should assign all of its playback streams to the same audio session.</span></span> <span data-ttu-id="58d6e-131">WASAPI 不會防止應用程式在多個會話之間散發其播放資料流程。</span><span class="sxs-lookup"><span data-stu-id="58d6e-131">WASAPI does not prevent an application from distributing its playback streams among multiple sessions.</span></span> <span data-ttu-id="58d6e-132">不過，在 Sndvol 中產生的大量滑杆可能會使使用者混淆。</span><span class="sxs-lookup"><span data-stu-id="58d6e-132">However, the resulting proliferation of volume sliders in Sndvol might confuse users.</span></span>

<span data-ttu-id="58d6e-133">應用程式視窗可以選擇顯示音量滑杆。</span><span class="sxs-lookup"><span data-stu-id="58d6e-133">As an option, an application window can display a volume slider.</span></span> <span data-ttu-id="58d6e-134">應用程式滑杆應該隨時反映對應 Sndvol 滑杆的狀態。</span><span class="sxs-lookup"><span data-stu-id="58d6e-134">The application slider should reflect the state of the corresponding Sndvol slider at all times.</span></span> <span data-ttu-id="58d6e-135">因此，如果使用者在應用程式視窗中移動滑杆來變更音量層級，則 [Sndvol] 視窗中對應的滑杆應該與應用程式滑杆一致地移動。</span><span class="sxs-lookup"><span data-stu-id="58d6e-135">Thus, if the user changes the volume level by moving the slider in the application window, then the corresponding slider in the Sndvol window should move in unison with the application slider.</span></span> <span data-ttu-id="58d6e-136">同樣地，如果使用者移動 Sndvol 滑杆，則應用程式滑杆應該與 Sndvol 滑杆一致地移動。</span><span class="sxs-lookup"><span data-stu-id="58d6e-136">Similarly, if the user moves the Sndvol slider, then the application slider should move in unison with the Sndvol slider.</span></span>

<span data-ttu-id="58d6e-137">為了支援此行為，WASAPI 會執行 [**ISimpleAudioVolume**](/windows/desktop/api/Audioclient/nn-audioclient-isimpleaudiovolume) 介面。</span><span class="sxs-lookup"><span data-stu-id="58d6e-137">To support this behavior, WASAPI implements the [**ISimpleAudioVolume**](/windows/desktop/api/Audioclient/nn-audioclient-isimpleaudiovolume) interface.</span></span> <span data-ttu-id="58d6e-138">當使用者移動應用程式滑杆時，應用程式會呼叫 [**ISimpleAudioVolume：： SetMasterVolume**](/windows/desktop/api/Audioclient/nf-audioclient-isimpleaudiovolume-setmastervolume) 方法，據以調整會話音量層級。</span><span class="sxs-lookup"><span data-stu-id="58d6e-138">When the user moves the application slider, the application calls the [**ISimpleAudioVolume::SetMasterVolume**](/windows/desktop/api/Audioclient/nf-audioclient-isimpleaudiovolume-setmastervolume) method to adjust the session volume level accordingly.</span></span> <span data-ttu-id="58d6e-139">Sndvol 會監視透過此方法所進行的磁片區變更，並反映其顯示的音量滑杆變更。</span><span class="sxs-lookup"><span data-stu-id="58d6e-139">Sndvol monitors volume changes made through this method and reflects the changes in the volume sliders that it displays.</span></span> <span data-ttu-id="58d6e-140">此外，應用程式也可以接收使用者透過 Sndvol 進行之會話磁片區變更的通知。</span><span class="sxs-lookup"><span data-stu-id="58d6e-140">In addition, an application can receive notifications of session volume changes that the user makes through Sndvol.</span></span> <span data-ttu-id="58d6e-141">基於此目的，應用程式會執行 [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) 介面，並向 WASAPI 註冊介面。</span><span class="sxs-lookup"><span data-stu-id="58d6e-141">For this purpose, the application implements an [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) interface and registers the interface with WASAPI.</span></span> <span data-ttu-id="58d6e-142">之後，每次使用者透過 Sndvol 變更會話磁片區層級時，應用程式就會收到透過 [**IAudioSessionEvents：： OnSimpleVolumeChanged**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsimplevolumechanged) 方法發出的通知呼叫。</span><span class="sxs-lookup"><span data-stu-id="58d6e-142">Thereafter, each time the user changes the session volume level through Sndvol, the application receives a notification call through the [**IAudioSessionEvents::OnSimpleVolumeChanged**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsimplevolumechanged) method.</span></span> <span data-ttu-id="58d6e-143">如需執行 **IAudioSessionEvents** 介面的程式碼範例，請參閱 [音訊會話事件](audio-session-events.md)。</span><span class="sxs-lookup"><span data-stu-id="58d6e-143">For a code example that implements an **IAudioSessionEvents** interface, see [Audio Session Events](audio-session-events.md).</span></span> <span data-ttu-id="58d6e-144">如需註冊 **IAudioSessionEvents** 介面的程式碼範例，請參閱 [舊版音訊應用程式的音訊事件](audio-events-for-legacy-audio-applications.md)。</span><span class="sxs-lookup"><span data-stu-id="58d6e-144">For a code example that registers an **IAudioSessionEvents** interface, see [Audio Events for Legacy Audio Applications](audio-events-for-legacy-audio-applications.md).</span></span>

<span data-ttu-id="58d6e-145">**ISimpleAudioVolume** 介面會將相同的磁片區層級一致地套用到音訊會話中的所有通道。</span><span class="sxs-lookup"><span data-stu-id="58d6e-145">The **ISimpleAudioVolume** interface applies the same volume level uniformly to all of the channels in an audio session.</span></span> <span data-ttu-id="58d6e-146">雖然這個介面應該滿足大多數應用程式的磁片區控制需求，但有些應用程式可能需要更特製化的磁片區控制功能。</span><span class="sxs-lookup"><span data-stu-id="58d6e-146">Although this interface should satisfy the volume-control requirements of most applications, a few applications might require more specialized volume-control capabilities.</span></span> <span data-ttu-id="58d6e-147">[**IAudioStreamVolume**](/windows/desktop/api/Audioclient/nn-audioclient-iaudiostreamvolume)介面會控制會話中的個別資料流程相對於其他資料流程的量。</span><span class="sxs-lookup"><span data-stu-id="58d6e-147">The [**IAudioStreamVolume**](/windows/desktop/api/Audioclient/nn-audioclient-iaudiostreamvolume) interface controls the volume of an individual stream in a session relative to the other streams in the session.</span></span> <span data-ttu-id="58d6e-148">**IAudioStreamVolume** 也可讓用戶端個別控制串流中所有通道的磁片區層級。</span><span class="sxs-lookup"><span data-stu-id="58d6e-148">**IAudioStreamVolume** also enables a client to individually control the volume levels of all the channels in the stream.</span></span> <span data-ttu-id="58d6e-149">例如，應用程式可能會使用這項功能來達成音訊效果，例如透過從左至右移動來模擬音訊來源的空間移動。</span><span class="sxs-lookup"><span data-stu-id="58d6e-149">For example, an application might use this capability to achieve audio effects such as simulating spatial movement of an audio source by panning from left to right.</span></span> <span data-ttu-id="58d6e-150">另一個特製化介面 [**IChannelAudioVolume**](/windows/desktop/api/Audioclient/nn-audioclient-ichannelaudiovolume)，會控制會話中個別通道的音量層級。</span><span class="sxs-lookup"><span data-stu-id="58d6e-150">Another specialized interface, [**IChannelAudioVolume**](/windows/desktop/api/Audioclient/nn-audioclient-ichannelaudiovolume), controls the volume levels of the individual channels in a session.</span></span> <span data-ttu-id="58d6e-151">例如，應用程式可能會使用 **IChannelAudioVolume** 來執行 stereophonic 音效系統的平衡控制。</span><span class="sxs-lookup"><span data-stu-id="58d6e-151">For example, an application might use **IChannelAudioVolume** to implement balance controls for a stereophonic sound system.</span></span>

<span data-ttu-id="58d6e-152">Sndvol 中 [ **應用程式** ] 方塊中的 [音量] 滑杆只會反映透過 **ISimpleAudioVolume** 介面進行的磁片區變更。</span><span class="sxs-lookup"><span data-stu-id="58d6e-152">The volume sliders in the **Applications** box in Sndvol reflect only volume changes that are made through the **ISimpleAudioVolume** interface.</span></span> <span data-ttu-id="58d6e-153">它們不會反映透過 **IAudioStreamVolume** 和 **IChannelAudioVolume** 介面進行的磁片區變更。</span><span class="sxs-lookup"><span data-stu-id="58d6e-153">They do not reflect volume changes that are made through the **IAudioStreamVolume** and **IChannelAudioVolume** interfaces.</span></span> <span data-ttu-id="58d6e-154">雖然有些應用程式可讓使用者透過 **IAudioStreamVolume** 和 **IChannelAudioVolume** 直接或間接控制磁片區設定，但開發人員應避免呈現這些大量設定的應用程式滑杆，讓使用者可能會與 Sndvol 中的音量滑杆混淆。</span><span class="sxs-lookup"><span data-stu-id="58d6e-154">Although some applications might enable users to directly or indirectly control volume settings through **IAudioStreamVolume** and **IChannelAudioVolume**, developers should avoid presenting application sliders for these volume settings that users are likely to confuse with the volume sliders in Sndvol.</span></span> <span data-ttu-id="58d6e-155">否則，使用者可能會移動預期會看到變更反映在 Sndvol 滑杆中的應用程式滑杆，並在沒有這類變更時變成混淆。</span><span class="sxs-lookup"><span data-stu-id="58d6e-155">Otherwise, a user might move an application slider expecting to see the change reflected in a Sndvol slider and become confused when no such change occurs.</span></span> <span data-ttu-id="58d6e-156">開發人員可以透過謹慎的使用者介面設計來避免這個問題。</span><span class="sxs-lookup"><span data-stu-id="58d6e-156">Developers can avoid this problem through careful user interface design.</span></span>

<span data-ttu-id="58d6e-157">會話 submix 中任何頻道的有效磁片區層級（如喇叭所聽到）是下列四個磁片區層級因素的乘積：</span><span class="sxs-lookup"><span data-stu-id="58d6e-157">The effective volume level of any channel in the session submix, as heard at the speakers, is the product of the following four volume-level factors:</span></span>

-   <span data-ttu-id="58d6e-158">會話中資料流程的每個通道磁片區層級，用戶端可以透過 **IAudioStreamVolume** 介面中的方法來控制這些層級。</span><span class="sxs-lookup"><span data-stu-id="58d6e-158">The per-channel volume levels of the streams in the session, which clients can control through the methods in the **IAudioStreamVolume** interface.</span></span>
-   <span data-ttu-id="58d6e-159">會話的每個通道磁片區層級，用戶端可以透過 **IChannelAudioVolume** 介面中的方法來控制。</span><span class="sxs-lookup"><span data-stu-id="58d6e-159">The per-channel volume level of the session, which clients can control through the methods in the **IChannelAudioVolume** interface.</span></span>
-   <span data-ttu-id="58d6e-160">會話的主要磁片區層級，用戶端可以透過 **ISimpleAudioVolume** 介面中的方法來控制。</span><span class="sxs-lookup"><span data-stu-id="58d6e-160">The master volume level of the session, which clients can control through the methods in the **ISimpleAudioVolume** interface.</span></span>
-   <span data-ttu-id="58d6e-161">會話的以原則為基礎的磁片區層級，系統會以全域混合變更的方式進行動態修改。</span><span class="sxs-lookup"><span data-stu-id="58d6e-161">The policy-based volume level of the session, which the system dynamically modifies as the global mix changes.</span></span>

<span data-ttu-id="58d6e-162">上述清單中四個磁片區層級的每一個都是0.0 到1.0 範圍的值，其中0.0 表示無回應，而1.0 表示完整磁片區 (沒有衰減) 。</span><span class="sxs-lookup"><span data-stu-id="58d6e-162">Each of the four volume-level factors in the preceding list is a value in the range 0.0 to 1.0, where 0.0 indicates silence and 1.0 indicates full volume (no attenuation).</span></span> <span data-ttu-id="58d6e-163">有效的磁片區層級也是範圍0.0 到1.0 之間的值。</span><span class="sxs-lookup"><span data-stu-id="58d6e-163">The effective volume level is also a value in the range 0.0 to 1.0.</span></span>

<span data-ttu-id="58d6e-164">音訊引擎會將每個通道的有效磁片區層級套用至資料流程中的通道，然後將資料流程與音訊會話中的其他資料流程混合。</span><span class="sxs-lookup"><span data-stu-id="58d6e-164">The audio engine applies the effective volume level for each channel to the channels in a stream before mixing the stream with the other streams in the audio session.</span></span> <span data-ttu-id="58d6e-165">如果通道中的任何範例值在音訊引擎乘以有效的磁片區層級後超過0分貝，則引擎會先裁剪範例，再將它們新增至會話 submix。</span><span class="sxs-lookup"><span data-stu-id="58d6e-165">If any sample values in a channel exceed 0 decibels after the audio engine has multiplied them by the effective volume level, the engine clips the samples before adding them to the session submix.</span></span>

## <a name="related-topics"></a><span data-ttu-id="58d6e-166">相關主題</span><span class="sxs-lookup"><span data-stu-id="58d6e-166">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="58d6e-167">音量控制項</span><span class="sxs-lookup"><span data-stu-id="58d6e-167">Volume Controls</span></span>](volume-controls.md)
</dt> </dl>

 

 



