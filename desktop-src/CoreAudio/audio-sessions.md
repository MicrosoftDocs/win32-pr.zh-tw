---
description: 音訊會話
ms.assetid: b8a1b656-a582-4112-99e9-bd575719ebb3
title: 音訊會話
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 13d5b8cee0a3a53709d2c450bef36ae00e3a6f4d9323c75ff80e96b19550eb39
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/11/2021
ms.locfileid: "119929408"
---
# <a name="audio-sessions"></a>音訊會話

*音訊會話* 是 WASAPI 用戶端可以共同管理的一組相關音訊串流。 用戶端可以控制每個個別會話的音量層級和靜音狀態。 系統會將用戶端指定的磁片區和靜音設定統一套用到會話中的所有資料流程。

當用戶端初始化音訊串流時，它會將音訊串流指派給音訊會話。 如需詳細資訊，請參閱 [**IAudioClient：： Initialize**](/windows/desktop/api/Audioclient/nf-audioclient-iaudioclient-initialize)。

音訊會話包含轉譯資料流程或抓取資料流程，但不能同時包含兩者。 根據預設，轉譯會話的 [磁片區] 和 [靜音] 設定會在系統重新開機時持續進行。 捕捉會話的 [磁片區] 和 [靜音] 設定不是持續性。  (包含在回送模式下運作之資料流程的會話，會被視為與捕捉會話相同。 也就是說，會話設定不是持續性。 如需回送模式的詳細資訊，請參閱 [回送記錄](loopback-recording.md)。 ) 

每個音訊串流都只屬於一個會話。 用戶端會在初始化資料流程物件時，將音訊串流指派給特定的會話。 資料流程會在資料流程的存留期內保留其成員資格。 建立資料流程物件之後，物件會一直存在，直到用戶端釋出物件的最後一個計數參考，然後刪除該物件為止。

雖然用戶端無法變更已指派現有資料流程的會話，但它可以藉由釋出資料流程的所有參考來 (來達到類似的效果) 、建立新的資料流程來取代已刪除的資料流程，以及將新的資料流程指派給另一個會話。

每個轉譯會話都代表資料流程的子集，這些資料流程會形成透過特定 [音訊端點裝置](audio-endpoint-devices.md)播放的全域混合。 全域混合將所有的會話與共享裝置的所有應用程式結合在一起。

通常，具有數個數據流的應用程式會將其所有資料流程指派給相同的會話。 不過，應用程式可以選擇將不同的串流指派給不同的會話。 應用程式未明確指派給會話的任何資料流程都屬於預設的會話。

典型的音訊應用程式應該避免修改會話的音量和靜音設定。 相反地，使用者會透過控制項程式的使用者介面來控制這些設定。 例如，在 Windows Vista 中，系統提供的程式 Sndvol.exe 會針對系統中的每個作用中或最近使用中的轉譯會話，顯示音量控制項和靜音控制。 透過這些控制項，使用者可以調整系統中所有會話的音量和靜音設定。

Sndvol 程式目前只會顯示音訊轉譯端點裝置的音量控制項。 它不會顯示音訊捕獲裝置的音量控制項。

如果會話包含一或多個作用中的資料流程，則會話會處於作用中狀態。 作用中的資料流程處於執行中 *狀態*。 非作用中資料流程處於 *已停止狀態*。 當會話的第一個資料流程變成作用中時，會話就會變成作用中狀態。 當上一個作用中的資料流程變成非使用中時，會話會變成非使用中。 當會話在一段時間內處於非使用中狀態時，系統會將會話的狀態從非作用中變更為已過期。

Sndvol 會顯示所有作用中和非使用中轉譯會話的音量和靜音控制項。 當會話的狀態從非作用中變更為已過期，或當會話終止時，Sndvol 會移除會話的磁片區和靜音控制項。 當會話的最後一個資料流程被刪除時，會話就會終止 (;亦即，當用戶端釋出會話中最後一個剩餘資料流程物件的最後一個參考計數時，) 此規則的例外狀況。 無論這些音效的會話狀態為何，Sndvol 一律會顯示系統通知音效的音量和靜音控制項。

通常，資料流程屬於只跨越包含建立資料流程的應用程式之進程的會話。 不過，應用程式可以選擇定義跨進程會話，以結合來自兩個或多個進程的串流。

WASAPI 支援主要的跨進程會話，如此一來：

-   Sndvol 程式可以向使用者呈現單一的音量控制項，以管理所有應用程式的系統通知音效。
-   在一個進程中執行的 media player 可將受保護的內容串流至在另一個進程中執行的解密程式。

類似于進程特定轉譯會話的控制項設定，跨進程轉譯會話的控制項設定依預設會在系統重新開機時持續存在。 WASAPI 主要是為了讓系統通知音效的優點，而這種行為必須保留使用者的音量和靜音設定，因為應用程式混合會隨著時間而改變。

Sndvol 程式會為每個會話的音量控制項加上顯示名稱和圖示的標籤。 用戶端可以選擇將顯示名稱和圖示明確指派給會話。 如果用戶端未提供這些專案，則 Sndvol 會改為顯示預設名稱和預設圖示。 預設名稱會併入資訊，例如應用程式視窗的標題。 預設圖示是應用程式視窗的圖示。 只有在處理常式特定會話的情況下，這些預設值才會提供有意義的資訊給使用者。 請注意，跨進程會話可以與一個以上的應用程式相關聯。 在此情況下，只有用戶端提供的顯示名稱和圖示才有意義。

雖然轉譯會話的音量和靜音設定預設會在系統重新開機時持續，但用戶端提供的顯示名稱和圖示並不是。 為了確保 Sndvol 顯示用戶端提供的名稱和圖示，用戶端必須在用戶端將第一個串流指派給會話時，明確地將名稱和圖示指派給會話。 系統只會保留會話的顯示名稱和圖示，直到會話終止為止。

每個會話都是由會話 GUID 所識別。 當用戶端開啟串流時，用戶端會將該資料流程指派給特定的會話。 用戶端會提供下列兩項資訊來識別該會話：

-   會話 GUID。
-   無論會話是跨進程或進程特定的會話，進程特定的會話都只會包含來自用戶端進程的資料流程。

這項資訊就足以區別同一部電腦上所有其他會話的特定會話。 進程特定會話的會話 GUID 只會在擁有會話的處理常式範圍內唯一識別會話。 相反地，跨進程會話的會話 GUID 在電腦上執行的所有處理常式範圍內是唯一的。

如果是處理常式特定的會話，系統會使用會話 GUID 和處理序識別碼的組合來唯一識別電腦範圍內的會話。 因此，如果兩個不同進程中的用戶端將各自的串流指派給兩個具有相同會話 Guid 的進程特定會話，系統會將這些會話視為個別的會話，因為它們的處理序識別碼不同。 此外，如果跨進程會話使用與一或多個進程特定會話相同的會話 GUID，則系統會將跨進程會話視為與進程特定會話不同，即使它們共用相同的會話 GUID。

例如，在 Windows Vista 中，較高層級的 api （例如 Windows 多媒體 **waveOutXxx** 函式和 DirectSound）通常會將所建立的音訊串流指派給預設的流程 guid 值 guid Null 所識別的進程特定會話 \_ 。 針對這些 Api 的用戶端，每個用戶端進程的預設會話會與其他用戶端進程的預設會話分開，即使會話的會話 Guid 相同也是一樣。 此外，如果有一或多個應用程式將資料流程指派給以會話 GUID 值 GUID Null 識別的跨進程會話 \_ ，系統就會將此跨進程會話視為與共享相同會話 guid 之預設、進程特定會話的分隔。 因此，Sndvol 程式會針對每個用戶端的預設、進程特定會話顯示個別的音量控制項，並針對由會話 GUID 值 GUID Null 識別的跨進程會話顯示額外的音量控制項 \_ （如果該會話存在的話）。

每個會話只會與一個音訊端點裝置相關聯。 如果兩個會話具有相同的會話 Guid 和處理序識別碼，但與不同的裝置相關聯，則系統會將這兩個會話視為個別的。 會話永遠不能同時包含 capture 和轉譯資料流程，因為 capture 資料流程只能與 capture 裝置相關聯，而且轉譯資料流程只能與轉譯裝置產生關聯。

如先前所述，會話的磁片區和靜音設定會在系統重新開機時持續存在。 應用程式的兩個或多個實例可以使用相同的會話 Guid 來建立進程特定的會話。 透過 Sndvol 程式，使用者可以針對每個會話選取不同的磁片區和靜音設定。 這些會話終止之後，系統只會保留其中一個會話的控制項設定，也就是最後一個要結束的會話。 之後，如果應用程式的新實例使用與之前相同的會話 GUID 建立進程特定會話，該會話就會繼承先前儲存的磁片區和靜音設定。

應用程式不應該嘗試將資料流程新增至或控制另一個不相關的應用程式所擁有之會話的磁片區層級。 此外，應用程式不應該嘗試控制通知聲音之系統管理會話的磁片區層級。 不過，應用程式可以藉由呼叫 **PlaySound** 函式，在通知音效的系統會話播放音效。 如需詳細資訊，請參閱 [舊版音訊應用程式的通知](notification-sounds-for-legacy-audio-applications.md)音效。

應用程式可以註冊，以在會話狀態變更時接收通知。 如需詳細資訊，請參閱 [音訊會話事件](audio-session-events.md)。

在罕見的情況下，建立進程特定會話的應用程式可能需要在 Sndvol 的單一磁片區控制項下，合併兩個或多個應用程式實例的進程特定會話的控制。 如需詳細資訊，請參閱 [群組參數](grouping-parameters.md)。

## <a name="related-topics"></a>相關主題

<dl> <dt>

[程式設計指南](programming-guide.md)
</dt> </dl>

 

 



