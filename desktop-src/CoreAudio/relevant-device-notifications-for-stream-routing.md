---
description: 瞭解串流路由的通知。 Api 會藉由處理切換至新預設音訊端點的資料流程來執行串流路由。
ms.assetid: caf831bb-b8de-467f-bdb4-f9f8991dc7a8
title: 串流路由的相關通知
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d1a843c1d8b5cfd740ada5049cb9428e7745072d
ms.sourcegitcommit: 51ef825fb48f15e1aa30e8795988f10dc2b2155c
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/14/2021
ms.locfileid: "112068524"
---
# <a name="relevant-notifications-for-stream-routing"></a><span data-ttu-id="14abb-104">串流路由的相關通知</span><span class="sxs-lookup"><span data-stu-id="14abb-104">Relevant Notifications for Stream Routing</span></span>

<span data-ttu-id="14abb-105">在 Windows 7 中，使用核心音訊 Api 的高階平臺 Api （例如媒體基礎、DirectSound 和 Wave Api）會藉由處理從現有裝置切換至新的預設音訊端點來執行串流路由功能。</span><span class="sxs-lookup"><span data-stu-id="14abb-105">In Windows 7, high-level platform APIs that use Core Audio APIs, such as Media Foundation, DirectSound, and Wave APIs, implement the stream routing feature by handling stream switching from an existing device to a new default audio endpoint.</span></span> <span data-ttu-id="14abb-106">使用這些 Api 的媒體應用程式會使用串流路由行為，而不會對來源進行任何修改。</span><span class="sxs-lookup"><span data-stu-id="14abb-106">Media applications that use these APIs use the stream routing behavior without any modifications to the source.</span></span> <span data-ttu-id="14abb-107">Direct WASAPI 用戶端可以使用核心音訊元件所傳送的通知，並執行串流路由功能。</span><span class="sxs-lookup"><span data-stu-id="14abb-107">Direct WASAPI clients can use the notifications sent by Core Audio components and implement the stream routing feature.</span></span>

<span data-ttu-id="14abb-108">若要執行串流路由功能，用戶端必須接聽兩種類型的事件：裝置變更通知和會話中斷連線通知。</span><span class="sxs-lookup"><span data-stu-id="14abb-108">To implement the stream routing feature, a client must listen for two types of events: device change notifications and session disconnect notifications.</span></span> <span data-ttu-id="14abb-109">在高階 Api 提供的執行中，會針對藉由呼叫 [**IMMDeviceEnumerator：： GetDefaultAudioEndpoint**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint)建立的預設裝置端點傳送這些事件。</span><span class="sxs-lookup"><span data-stu-id="14abb-109">In the implementation provided by the high-level APIs, these events are sent for default device endpoints created by calling [**IMMDeviceEnumerator::GetDefaultAudioEndpoint**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint).</span></span> <span data-ttu-id="14abb-110">如需詳細資訊，請參閱 [取得串流路由的裝置端點](getting-the-default-device-endpoint-for-stream-routing.md)。</span><span class="sxs-lookup"><span data-stu-id="14abb-110">For more information, see [Getting the Device Endpoint for Stream Routing](getting-the-default-device-endpoint-for-stream-routing.md).</span></span>

<span data-ttu-id="14abb-111">新增、移除或修改音訊裝置時，核心音訊元件 MMDeviceAPI 會提供通知回呼。</span><span class="sxs-lookup"><span data-stu-id="14abb-111">The Core Audio component MMDeviceAPI delivers notification callbacks when audio devices are added, removed, or modified.</span></span> <span data-ttu-id="14abb-112">格式和音訊會話變更會透過 WASAPI 回報為事件。</span><span class="sxs-lookup"><span data-stu-id="14abb-112">The format and audio session changes are reported as events through WASAPI.</span></span>

## <a name="device-change-notifications"></a><span data-ttu-id="14abb-113">裝置變更通知</span><span class="sxs-lookup"><span data-stu-id="14abb-113">Device Change Notifications</span></span>

<span data-ttu-id="14abb-114">新增、移除或修改音訊裝置時，MMDeviceAPI 會引發事件。</span><span class="sxs-lookup"><span data-stu-id="14abb-114">MMDeviceAPI raises events when audio devices are added, removed, or modified.</span></span> <span data-ttu-id="14abb-115">如果用戶端是提供資料流程路由功能，則必須執行 [**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) 介面，並使用 MMDeviceAPI 註冊其實作為。</span><span class="sxs-lookup"><span data-stu-id="14abb-115">If the client is to provide stream routing functionality, it must implement the [**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) interface and register its implementation with MMDeviceAPI.</span></span>

<span data-ttu-id="14abb-116">若要取得裝置變更通知，用戶端必須執行下列工作：</span><span class="sxs-lookup"><span data-stu-id="14abb-116">To get device change notifications, the client must perform the following tasks:</span></span>

-   <span data-ttu-id="14abb-117">執行 [**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) 介面來處理 MMDeviceAPI 所傳送的裝置變更通知。</span><span class="sxs-lookup"><span data-stu-id="14abb-117">Implement the [**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) interface to handle device change notifications sent by MMDeviceAPI.</span></span>
-   <span data-ttu-id="14abb-118">藉由呼叫 [**IMMDeviceEnumerator：： RegisterEndpointNotificationCallback**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-registerendpointnotificationcallback)方法，透過 MMDeviceAPI 註冊 [**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient)執行。</span><span class="sxs-lookup"><span data-stu-id="14abb-118">Register the [**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) implementation with MMDeviceAPI by calling the [**IMMDeviceEnumerator::RegisterEndpointNotificationCallback**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-registerendpointnotificationcallback) method.</span></span>

<span data-ttu-id="14abb-119">在用戶端執行這些介面的程式之後，用戶端會透過這些介面的方法以回呼形式接收通知。</span><span class="sxs-lookup"><span data-stu-id="14abb-119">After the client's implementation of these interfaces is registered, the client receives notifications in the form of callbacks through the methods of these interfaces.</span></span> <span data-ttu-id="14abb-120">當 MMDeviceAPI 引發端點層級事件 (端點狀態變更、新的端點抵達、端點刪除、預設端點變更和端點屬性變更) 時，會呼叫 [**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient)方法。</span><span class="sxs-lookup"><span data-stu-id="14abb-120">[**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) methods are called by MMDeviceAPI when it raises endpoint-level events (endpoint state changes, new endpoint arrivals, endpoint deletions, default endpoint changes, and endpoint property changes).</span></span>

<span data-ttu-id="14abb-121">如果用戶端想要提供預設裝置的串流路由，用戶端必須在透過 [**IMMNotificationClient：： OnDefaultDeviceChanged**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immnotificationclient-ondefaultdevicechanged) 回呼接收通知時，執行裝置變更行為。</span><span class="sxs-lookup"><span data-stu-id="14abb-121">If the client wants to provide stream routing for the default device, the client must implement the device change behavior when it receives the notification through the [**IMMNotificationClient::OnDefaultDeviceChanged**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immnotificationclient-ondefaultdevicechanged) callback.</span></span>

## <a name="audio-session-change-notifications"></a><span data-ttu-id="14abb-122">音訊會話變更通知</span><span class="sxs-lookup"><span data-stu-id="14abb-122">Audio Session Change Notifications</span></span>

<span data-ttu-id="14abb-123">音訊會話變更和格式變更會透過 WASAPI 回報為音訊會話事件。</span><span class="sxs-lookup"><span data-stu-id="14abb-123">Audio session changes and format changes are reported as audio session events through WASAPI.</span></span> <span data-ttu-id="14abb-124">WASAPI 用戶端會執行 [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) 介面，並向 WASAPI 註冊該執行。</span><span class="sxs-lookup"><span data-stu-id="14abb-124">A WASAPI client implements the [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) interface and registers the implementation with WASAPI.</span></span>

<span data-ttu-id="14abb-125">若要取得音訊會話變更通知，用戶端必須執行下列工作：</span><span class="sxs-lookup"><span data-stu-id="14abb-125">To get audio session change notifications, the client must perform the following tasks:</span></span>

-   <span data-ttu-id="14abb-126">執行 [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) 介面來處理 WASAPI 所傳送的格式變更通知。</span><span class="sxs-lookup"><span data-stu-id="14abb-126">Implement the [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) interface to handle format change notifications sent by WASAPI.</span></span>
-   <span data-ttu-id="14abb-127">藉由呼叫 [**IAudioSessionControl：： RegisterAudioSessionNotification**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessioncontrol-registeraudiosessionnotification)方法，透過 WASAPI 註冊 [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents)執行。</span><span class="sxs-lookup"><span data-stu-id="14abb-127">Register the [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) implementation with WASAPI by calling the [**IAudioSessionControl::RegisterAudioSessionNotification**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessioncontrol-registeraudiosessionnotification) method.</span></span>

<span data-ttu-id="14abb-128">當音訊會話發生變更時，WASAPI 會呼叫 [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents)方法。</span><span class="sxs-lookup"><span data-stu-id="14abb-128">[**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) methods are called by WASAPI when audio session changes occur.</span></span> <span data-ttu-id="14abb-129">當會話的顯示名稱、圖示路徑、磁片區、群組參數或狀態變更時，就會引發這些事件。</span><span class="sxs-lookup"><span data-stu-id="14abb-129">These events are raised when the session's display name, icon path, volume, grouping parameter, or state changes.</span></span>

<span data-ttu-id="14abb-130">若要執行串流路由功能，用戶端必須等候會話中斷連線通知。</span><span class="sxs-lookup"><span data-stu-id="14abb-130">To implement the stream routing feature, the client must wait for the session-disconnect notification.</span></span> <span data-ttu-id="14abb-131">當音訊會話中斷連線或裝置的格式變更時，WASAPI 會透過 [**IAudioSessionEvents：： OnSessionDisconnected**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsessiondisconnected)以回呼的形式傳送用戶端通知。</span><span class="sxs-lookup"><span data-stu-id="14abb-131">When an audio session is disconnected or a device's format is changed, WASAPI sends the client notifications in the form of callbacks through [**IAudioSessionEvents::OnSessionDisconnected**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsessiondisconnected).</span></span> <span data-ttu-id="14abb-132">在中斷連線通知的情況下，WASAPI 也會傳送一個值，指出會話中斷連接的原因。</span><span class="sxs-lookup"><span data-stu-id="14abb-132">With the disconnection notification, WASAPI also sends a value that indicates why the session was disconnected.</span></span> <span data-ttu-id="14abb-133">發生這種情況的原因有好幾種，例如裝置已移除、伺服器已停止等等。</span><span class="sxs-lookup"><span data-stu-id="14abb-133">This can occur for several reasons, such as the device was removed, the server stopped, and so on.</span></span> <span data-ttu-id="14abb-134">如需完整的原因清單，請參閱 AudioPolicy 中定義的 **AudioSessionDisconnectReason** 列舉。</span><span class="sxs-lookup"><span data-stu-id="14abb-134">For the complete list of reasons, see the **AudioSessionDisconnectReason** enumeration defined in AudioPolicy.h.</span></span> <span data-ttu-id="14abb-135">如果預設裝置變更，用戶端必須等待通知 (如果尚未收到與 **DisconnectReasonDeviceRemoval** 值相關的) 。</span><span class="sxs-lookup"><span data-stu-id="14abb-135">If the default device changes, the client must wait for the notifications (if they have not already been received) that are accompanied with a **DisconnectReasonDeviceRemoval** value.</span></span> <span data-ttu-id="14abb-136">為了回應這類通知，用戶端可能會重新開啟新預設裝置上的資料流程。</span><span class="sxs-lookup"><span data-stu-id="14abb-136">In response to such notifications, the client might reopen the stream on the new default device.</span></span>

<span data-ttu-id="14abb-137">因為所有這些作業都是非同步，所以無法預測應用程式接收通知的順序。</span><span class="sxs-lookup"><span data-stu-id="14abb-137">Because all of these operations are asychronous, the order in which the application receives notifications cannnot be predicted.</span></span> <span data-ttu-id="14abb-138">不過，應用程式通常會在預設裝置變更通知之前收到 **AudioSessionDisconnect** 值。</span><span class="sxs-lookup"><span data-stu-id="14abb-138">However, typically, the application receives **AudioSessionDisconnect** value before the default device change notification.</span></span>

### <a name="format-change-notifications"></a><span data-ttu-id="14abb-139">格式化變更通知</span><span class="sxs-lookup"><span data-stu-id="14abb-139">Format Change Notifications</span></span>

<span data-ttu-id="14abb-140">當資料流程的格式變更時，就會發生音訊格式變更。</span><span class="sxs-lookup"><span data-stu-id="14abb-140">Audio format changes occur when the format of the stream changes.</span></span> <span data-ttu-id="14abb-141">當使用者在 [ **音效** 控制台] 中選取新格式，或新的預設裝置支援新的格式時，就會發生這種情況 (例如，HDMI 或特定的專業音訊介面與手動取樣率調整) 。</span><span class="sxs-lookup"><span data-stu-id="14abb-141">This can occur when the user selects a new format in the **Sound** control panel or the new default device supports a new format (for example, HDMI or certain professional audio interfaces with a manual sample-rate adjustment).</span></span> <span data-ttu-id="14abb-142">為了通知用戶端這些類型的格式變更，WASAPI 由 [**IAudioSessionEvents：： OnSessionDisconnected**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsessiondisconnected) 的已註冊實作為 **DisconnectReasonFormatChanged** 的中斷連接原因傳送會話通知。</span><span class="sxs-lookup"><span data-stu-id="14abb-142">To notify the client about these types of format changes, WASAPI sends a session notification by the registered implementation of [**IAudioSessionEvents::OnSessionDisconnected**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsessiondisconnected) with a disconnect reason of **DisconnectReasonFormatChanged**.</span></span> <span data-ttu-id="14abb-143">用戶端可以重新開啟新格式的資料流程來處理通知。</span><span class="sxs-lookup"><span data-stu-id="14abb-143">The client can handle the notification by reopening the stream in the new format.</span></span>

## <a name="related-topics"></a><span data-ttu-id="14abb-144">相關主題</span><span class="sxs-lookup"><span data-stu-id="14abb-144">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="14abb-145">關於 MMDevice API</span><span class="sxs-lookup"><span data-stu-id="14abb-145">About MMDevice API</span></span>](mmdevice-api.md)
</dt> <dt>

[<span data-ttu-id="14abb-146">關於 WASAPI</span><span class="sxs-lookup"><span data-stu-id="14abb-146">About WASAPI</span></span>](wasapi.md)
</dt> <dt>

[<span data-ttu-id="14abb-147">串流路由</span><span class="sxs-lookup"><span data-stu-id="14abb-147">Stream Routing</span></span>](stream-routing.md)
</dt> </dl>

 

 



