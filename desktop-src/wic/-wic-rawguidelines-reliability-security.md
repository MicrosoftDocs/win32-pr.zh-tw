---
description: 可靠性和安全性
ms.assetid: 1cbfabce-3d56-4e23-b9a7-02369c67e392
title: 可靠性和安全性
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4a4704b84d09698fd6fabcf2d190050063ec3b3190904aa669fa78799c5d0158
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/11/2021
ms.locfileid: "119441728"
---
# <a name="reliability-and-security"></a>可靠性和安全性

因為 Windows 影像處理元件 (wic) 編解碼器會從 Windows shell 和影像中心中叫用，所以編解碼器作者應盡全力確保其 WIC 編解碼器中有高等級的可靠性和安全性。

撰寫可靠的程式碼大多取決於良好的程式碼撰寫作法、有效的程式碼評論，以及完整的單元測試和案例測試。 此外，下列指導方針可協助確保編解碼器符合有關可靠性的 Windows Vista 原則。

-   啟用 i/o 取消。

    編解碼器作者應提供方法讓終端使用者取消任何長時間執行的作業。 WIC 編解碼器是藉由實 IWICBitmapProgressNotification 來支援。 這可讓呼叫的應用程式指定回呼函式，讓編解碼器在指定的間隔呼叫，以通知呼叫端目前作業的進度。 當應用程式傳回從回呼函式取消的錯誤時 \_ ，編解碼器必須取消正在進行中的任何作業，並將 HRESULT 傳播回呼叫端。 這對原始編解碼器而言特別重要，因為它可能需要幾秒鐘的時間來解碼完整大小的原始影像，而應用程式需要一種方法來中止這項處理。

-   請確定程式碼是在執行其函式所需的最小範圍內執行。

    編解碼器作者必須確保編解碼器不會取用超過所需的資源，或有比所需更大的範圍。 WIC 中的編解碼器範圍是單一影像檔案;當載入影像檔案時，會建立編解碼器，並在關閉映射時釋放編解碼器。 因為 WIC 是可延伸的元件平臺，所以 WIC 編解碼器會有重迭的載入和卸載，並且會啟動和停止，全都在相同的進程中。 如果編解碼器的基礎基礎結構需要在大於單一映射的範圍中啟動和停止作業，則可靠性將會受到影響。 Windows 檔案總管及其他應用程式會使用已啟用 WIC 的編解碼器。 因此，如果在進程的存留期內仍載入編解碼器，記憶體將不會有效率地釋出，而且編解碼器的失敗可能會使 Windows 檔案總管停止回應，而且可能需要重新開機電腦。  (請考慮每次在 Windows 檔案總管中 thumbnailed 映射時都會叫用編解碼器：這是輕量作業的關鍵。 ) 

-   使用靜態和動態程式碼分析工具。

    -   靜態分析工具：

        前置詞-用於偵測編譯時期的錯誤。

        PREfast-用於分析 bug 的程式碼。

    -   動態分析工具：

        AppVerifier-藉由模擬常見的真實世界軟體問題，有助於讓應用程式更具彈性。

-   確認程式碼審核中的所有輸入。

    所有匯出方法和所有檔案資料的參數都必須謹慎地經過驗證，以確保其有效性，並在發生錯誤時妥善拒絕，以防止緩衝區溢位和不足、算術溢位和下溢，以及非預期的類型。

-   使用檔案模糊化技術來探索潛在的當機和停止回應。

    檔案模糊化是以隨機排列的輸入來測試編解碼器的流程。

    有兩種形式的檔案模糊化： undirected (隨機) 模糊化和導向的模糊。 Undirected 模糊化會執行一些隨機的位，以查看隨機輸入是否可能會損毀編解碼器。 導向的模糊會根據檔案格式的某些知識 permutes 輸入。 例如，如果迴圈冗余檢查 (CRC) 在位元組位移32，則變更任何未更新 CRC 的位元組可能不會執行大部分的 codepaths。 在此範例中，當任何位元組遭到修改時，導向的 fuzzer 應該會修正 CRC。

    應建立檔案模糊化的影像輸入集，以便測試此解碼器支援的每個參數組合。 例如，如果此解碼器支援小位元組、大到小的檔案和三個壓縮設定，則映射的輸入集應該包含每個壓縮設定的位元組由小到大檔案，以及每個壓縮設定的位元組由大到小的檔案。 這種方法會產生一組大型但非常穩固的輸入影像來進行測試。 即使沒有任何相機會產生每個組合，但是編碼器支援這些理論組合，編解碼器作者應模糊這些輸入。

    在編解碼器開發期間定期執行影像檔案的模糊測試，可以大幅增強安全性。 編解碼器在格式不正確的要求或格式不正確的情況下，應該一律能夠偵測影像檔損毀並正常失敗。

-   將程式碼壓力。

    對編解碼器進行壓力測試，方法是在多個同時執行的程式中持續執行，並在各種不同大小的影像上，以所有可能的循序執行所有支援的作業， (包括每個支援相機) 的非常大型影像。

-   執行緒安全性。

    從 Windows 7，WIC 要求原始編解碼器必須是 COM 單元類型 "Both"。 這表示您必須在多執行緒案例中，進行適當的鎖定來處理跨單元呼叫端和呼叫端。 多執行緒單元內的物件 (MTA) 可由 MTA 內任意數目的執行緒同時呼叫，以在多核心系統和某些伺服器案例上提供更佳的效能。 此外，位於 MTA 內的 WIC 編解碼器可以呼叫位於 MTA 內的其他物件，而不需要在位於不同 STA 單元的執行緒之間呼叫的封送處理成本。 在 Windows 7 中，所有內建的 WIC 編解碼器都已更新為支援 mta，包括 JPEG、TIFF、PNG、GIF、.ico 和 BMP。 不支援 Mta 的協力廠商編解碼器會在多執行緒應用程式中造成顯著的效能成本，因為封送處理。 啟用 MTA 支援需要在協力廠商編解碼器中執行適當的同步處理。 這些同步處理技術的確切執行已超出本檔的範圍。 以下提供同步處理 COM 物件的一般參考。

    https://msdn.microsoft.com/library/ms809971.aspx

## <a name="related-topics"></a>相關主題

<dl> <dt>

**概念**
</dt> <dt>

[Windows映射處理元件總覽](-wic-about-windows-imaging-codec.md)
</dt> <dt>

[相機原始影像格式的 WIC 指導方針](-wic-rawguidelines.md)
</dt> <dt>

[如何撰寫 WIC-Enabled 編解碼器](-wic-howtowriteacodec.md)
</dt> </dl>

 

 



