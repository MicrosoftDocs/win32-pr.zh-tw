---
description: 序列化 IWICDevelopRaw 設定的實施指導方針
ms.assetid: 4ecff5cc-24f3-4b89-b681-85c867b053e7
title: 序列化 IWICDevelopRaw 設定的實施指導方針
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 48cdc78f68e6d63ee7870b9296ae4cfa4f85547a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "103694171"
---
# <a name="implementation-guidelines-for-serializing-iwicdevelopraw-settings"></a><span data-ttu-id="35775-103">序列化 IWICDevelopRaw 設定的實施指導方針</span><span class="sxs-lookup"><span data-stu-id="35775-103">Implementation Guidelines for Serializing IWICDevelopRaw Settings</span></span>

<span data-ttu-id="35775-104">[**IWICDevelopRaw**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw)介面會公開設定，讓應用程式用來修改原始影像的處理。</span><span class="sxs-lookup"><span data-stu-id="35775-104">The [**IWICDevelopRaw**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw) interface exposes settings that the application can use to modify the processing of the RAW image.</span></span> <span data-ttu-id="35775-105">這些設定應該能夠序列化，以便跨會話保存。</span><span class="sxs-lookup"><span data-stu-id="35775-105">The settings should be able to be serialized so that they persist across sessions.</span></span> <span data-ttu-id="35775-106">雖然這可以透過數種方式來完成，但建議您以與其他中繼資料一致的方式來編碼此資料。</span><span class="sxs-lookup"><span data-stu-id="35775-106">Although this can be done in several ways, it is recommended to encode this data in a manner that is consistent with other metadata.</span></span>

<span data-ttu-id="35775-107">以下是一些一般的執行指導方針：</span><span class="sxs-lookup"><span data-stu-id="35775-107">The following are some general implementation guidelines:</span></span>

-   <span data-ttu-id="35775-108">透過 [**IWICDevelopRaw**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw) 所做的任何設定 (例如旋轉或白色餘額) 應該避免覆寫相機設定或「以快照」的資料，除非此標記通常用來做為「目前的設定」。</span><span class="sxs-lookup"><span data-stu-id="35775-108">Any settings made via [**IWICDevelopRaw**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw) (such as rotation or white balance) should avoid overwriting camera setting or "as-shot" data unless the tag is commonly used as a "current setting."</span></span> <span data-ttu-id="35775-109">例如，您可以使用 EXIF 方向標記來保存旋轉。</span><span class="sxs-lookup"><span data-stu-id="35775-109">For example, EXIF orientation tags can be used to persist rotation.</span></span>
-   <span data-ttu-id="35775-110">最好不要將整個檔案儲存 (包括每次要求序列化 [**IWICDevelopRaw**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw) 設定時的馬賽克圖元資料) 。</span><span class="sxs-lookup"><span data-stu-id="35775-110">It is preferable not to have to save the entire file (including the mosaic pixel data) each time that the [**IWICDevelopRaw**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw) settings are asked to be serialized.</span></span>
-   <span data-ttu-id="35775-111">序列化 [**IWICDevelopRaw**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw) 設定的程式通常會遵循此事件順序。</span><span class="sxs-lookup"><span data-stu-id="35775-111">The process of serializing [**IWICDevelopRaw**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw) settings will generally follow this order of events.</span></span> <span data-ttu-id="35775-112">應用程式：</span><span class="sxs-lookup"><span data-stu-id="35775-112">The application:</span></span>

    1.  <span data-ttu-id="35775-113">具現化原始檔案上的 [**IWICBitmapDecoder**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapdecoder) 。</span><span class="sxs-lookup"><span data-stu-id="35775-113">Instantiates an [**IWICBitmapDecoder**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapdecoder) on a RAW file.</span></span>
    2.  <span data-ttu-id="35775-114">呼叫 [**IWICBitmapDecoder**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapdecoder)：：[**GETFRAME**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapdecoder-getframe) 來取得原始框架的 [**IWICBitmapFrameDecode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframedecode) 。</span><span class="sxs-lookup"><span data-stu-id="35775-114">Calls [**IWICBitmapDecoder**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapdecoder)::[**GetFrame**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapdecoder-getframe) to get an [**IWICBitmapFrameDecode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframedecode) for the RAW frame.</span></span>
    3.  <span data-ttu-id="35775-115">在 IWICBitmapFrameDecode 介面上呼叫 IWICDevelopRaw 介面的 QueryInterface。</span><span class="sxs-lookup"><span data-stu-id="35775-115">Calls QueryInterface on the IWICBitmapFrameDecode interface for the IWICDevelopRaw interface.</span></span>
    4.  <span data-ttu-id="35775-116">呼叫 [**IWICDevelopRaw**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw)：：[**GetCurrentParameterSet**](/windows/desktop/api/Wincodec/nf-wincodec-iwicdevelopraw-getcurrentparameterset)，它會傳回 IPropertyBag2 介面，其中包含所有目前儲存在其中的屬性。</span><span class="sxs-lookup"><span data-stu-id="35775-116">Calls [**IWICDevelopRaw**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw)::[**GetCurrentParameterSet**](/windows/desktop/api/Wincodec/nf-wincodec-iwicdevelopraw-getcurrentparameterset), which returns an IPropertyBag2 interface with all of the current properties stored in it.</span></span>

        <span data-ttu-id="35775-117">在這個過程中，目標是要將 IPropertyBag2 介面中的設定序列化為原始檔案。</span><span class="sxs-lookup"><span data-stu-id="35775-117">At this point of the process, the goal is to serialize the settings in the IPropertyBag2 interface into the RAW file.</span></span> <span data-ttu-id="35775-118">若要這樣做，需要啟動編碼器，依此類推，在下列步驟中會有詳細的說明。</span><span class="sxs-lookup"><span data-stu-id="35775-118">To do so requires spinning up an encoder and so on, which is detailed in the following steps.</span></span>

    5.  <span data-ttu-id="35775-119">建立原始檔案的 [**IWICBitmapEncoder**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapencoder) 。</span><span class="sxs-lookup"><span data-stu-id="35775-119">Creates an [**IWICBitmapEncoder**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapencoder) for the RAW file.</span></span>
    6.  <span data-ttu-id="35775-120">呼叫 [**IWICBitmapEncoder**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapencoder)：：[**Initialize**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapencoder-initialize)，傳入新的 (空白) 資料流程以進行編碼。</span><span class="sxs-lookup"><span data-stu-id="35775-120">Calls [**IWICBitmapEncoder**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapencoder)::[**Initialize**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapencoder-initialize), passing in a new (blank) stream to encode.</span></span>
    7.  <span data-ttu-id="35775-121">呼叫 [**IWICBitmapEncoder**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapencoder)：：[**CREATENEWFRAME**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapencoder-createnewframe) 來建立原始框架的新 IWICBitmapFrameEncode。</span><span class="sxs-lookup"><span data-stu-id="35775-121">Calls [**IWICBitmapEncoder**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapencoder)::[**CreateNewFrame**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapencoder-createnewframe) to create a new IWICBitmapFrameEncode for the RAW frame.</span></span>
    8.  <span data-ttu-id="35775-122">呼叫 [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode)：：[**Initialize**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapencoder-initialize)，然後在步驟4的 IPropertyBag2 介面中傳遞。</span><span class="sxs-lookup"><span data-stu-id="35775-122">Calls [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode)::[**Initialize**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapencoder-initialize), and passes in the IPropertyBag2 interface from step 4.</span></span>
    9.  <span data-ttu-id="35775-123">從解碼器的原始影像框架呼叫 [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode)：：[**WriteSource**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapframeencode-writesource) 與 [**IWICBitmapSource**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsource) 。</span><span class="sxs-lookup"><span data-stu-id="35775-123">Calls [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode)::[**WriteSource**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapframeencode-writesource) with [**IWICBitmapSource**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsource) from decoder's RAW image frame.</span></span>
    10. <span data-ttu-id="35775-124">呼叫 [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode)：：[**Commit**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapencoder-commit)。</span><span class="sxs-lookup"><span data-stu-id="35775-124">Calls [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode)::[**Commit**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapencoder-commit).</span></span> <span data-ttu-id="35775-125">然後，編解碼器會將步驟8中 IPropertyBag2 的屬性序列化為檔案。</span><span class="sxs-lookup"><span data-stu-id="35775-125">The codec then serializes the properties in the IPropertyBag2 from step 8 into the file.</span></span> <span data-ttu-id="35775-126">將屬性序列化的最常見方法是在檔案中將其寫出為中繼資料。</span><span class="sxs-lookup"><span data-stu-id="35775-126">The most common method of serializing the properties is assumed to be by writing them out as metadata in the file.</span></span>
    11. <span data-ttu-id="35775-127">呼叫 [**IWICBitmapEncoder**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapencoder)：：[**Commit**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapencoder-commit)。</span><span class="sxs-lookup"><span data-stu-id="35775-127">Calls [**IWICBitmapEncoder**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapencoder)::[**Commit**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapencoder-commit).</span></span>
    12. <span data-ttu-id="35775-128">在步驟6中的資料流程上呼叫 IStream：： Commit。</span><span class="sxs-lookup"><span data-stu-id="35775-128">Calls IStream::Commit on the stream in step 6.</span></span>

    <span data-ttu-id="35775-129">這些設定會在檔案中進行序列化。</span><span class="sxs-lookup"><span data-stu-id="35775-129">The settings are serialized in the file.</span></span>

    <span data-ttu-id="35775-130">這種方法會在每次序列化設定時，產生重寫整個原始檔案的成本。</span><span class="sxs-lookup"><span data-stu-id="35775-130">This method does incur the cost of rewriting the entire RAW file each time the settings are serialized.</span></span> <span data-ttu-id="35775-131">如果您執行 [**IWICFastMetadataEncoder**](/windows/desktop/api/Wincodec/nn-wincodec-iwicfastmetadataencoder) ，或您的圖像檔案格式支援 XMP 或 EXIF，則可以避免這種情況，因為 WIC 提供這兩種格式的 [**IWICFastMetadataEncoder**](/windows/desktop/api/Wincodec/nn-wincodec-iwicfastmetadataencoder) 。</span><span class="sxs-lookup"><span data-stu-id="35775-131">This can be avoided if you implement [**IWICFastMetadataEncoder**](/windows/desktop/api/Wincodec/nn-wincodec-iwicfastmetadataencoder) or if your image file format supports XMP or EXIF, as WIC provides [**IWICFastMetadataEncoder**](/windows/desktop/api/Wincodec/nn-wincodec-iwicfastmetadataencoder) for both of these formats.</span></span> <span data-ttu-id="35775-132">此外，如果您的編解碼器將變更寫入影像檔案的結尾，您就不會最後重寫整個影像檔案。</span><span class="sxs-lookup"><span data-stu-id="35775-132">Also, if your codec writes changes to the end of the image file, then you won't end up rewriting the entire image file.</span></span>

-   <span data-ttu-id="35775-133">當應用程式在 [**IWICDevelopRaw**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw)：：[**LoadParameterSet**](/windows/desktop/api/Wincodec/nf-wincodec-iwicdevelopraw-loadparameterset)方法上設定 [**WICRawParameterSet WICUserAdjustedParameterSet**](/windows/desktop/api/Wincodec/ne-wincodec-wicrawparameterset)列舉時，會從序列化狀態載入參數集。</span><span class="sxs-lookup"><span data-stu-id="35775-133">Parameter sets are loaded from the serialized state when the application sets the [**WICRawParameterSet.WICUserAdjustedParameterSet**](/windows/desktop/api/Wincodec/ne-wincodec-wicrawparameterset) enumeration on the [**IWICDevelopRaw**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw)::[**LoadParameterSet**](/windows/desktop/api/Wincodec/nf-wincodec-iwicdevelopraw-loadparameterset) method.</span></span> <span data-ttu-id="35775-134">[**WICRawParameterSet. WICUserAdjustedParameterSet**](/windows/desktop/api/Wincodec/ne-wincodec-wicrawparameterset)旗標指的是最後儲存的參數集，因此使用此旗標的負載應該會導致將參數還原到最後儲存的狀態。</span><span class="sxs-lookup"><span data-stu-id="35775-134">The [**WICRawParameterSet.WICUserAdjustedParameterSet**](/windows/desktop/api/Wincodec/ne-wincodec-wicrawparameterset) flag refers to the last-saved parameter set, so a load with this flag should result in restoring parameters to the last-saved state.</span></span>
-   <span data-ttu-id="35775-135">初始載入時，應該載入最後儲存的參數集（如果有的話）。</span><span class="sxs-lookup"><span data-stu-id="35775-135">Upon initial load, the last-saved parameter set should be loaded, if available.</span></span> <span data-ttu-id="35775-136">如果沒有，則應該使用「快照」設定做為 [**IWICDevelopRaw**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw) 介面變數上的預設值。</span><span class="sxs-lookup"><span data-stu-id="35775-136">If not, then the "as-shot" settings should be used as presets on the [**IWICDevelopRaw**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw) interface variables.</span></span> <span data-ttu-id="35775-137">您也可以使用 [**WICRawParameterSet. WICAsShotParameterSet**](/windows/desktop/api/Wincodec/ne-wincodec-wicrawparameterset) 旗標來載入這些進行中的設定。</span><span class="sxs-lookup"><span data-stu-id="35775-137">These as-shot settings can also be loaded by using the [**WICRawParameterSet.WICAsShotParameterSet**](/windows/desktop/api/Wincodec/ne-wincodec-wicrawparameterset) flag.</span></span>
-   <span data-ttu-id="35775-138">識別碼 [**WICRawParameterSet. WICAutoAdjustedParameterSet**](/windows/desktop/api/Wincodec/ne-wincodec-wicrawparameterset) 是用來表示「自動」設定。</span><span class="sxs-lookup"><span data-stu-id="35775-138">The identifier [**WICRawParameterSet.WICAutoAdjustedParameterSet**](/windows/desktop/api/Wincodec/ne-wincodec-wicrawparameterset) is meant to represent an "Auto" setting.</span></span> <span data-ttu-id="35775-139">編解碼器設計工具可以選擇下列任一方法，以瞭解如何在進行此設定時設定 [**IWICDevelopRaw**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw) 參數：</span><span class="sxs-lookup"><span data-stu-id="35775-139">The codec designer can elect any of the following approaches on how to set [**IWICDevelopRaw**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw) parameters when this setting is made:</span></span>

    -   <span data-ttu-id="35775-140">執行某些參數的演算法優化，例如曝光或色彩。</span><span class="sxs-lookup"><span data-stu-id="35775-140">Perform an algorithmic optimization of some parameters, such as exposure or color.</span></span> <span data-ttu-id="35775-141">這是典型影像編輯器中的自動函式，而且主要是以圖元資料分析為基礎。</span><span class="sxs-lookup"><span data-stu-id="35775-141">This is how Auto functions in typical image editors and is based primarily on pixel data analysis.</span></span>
    -   <span data-ttu-id="35775-142">設定攝影機設定，類似于自動設定的行為。</span><span class="sxs-lookup"><span data-stu-id="35775-142">Set camera settings similar to how an Auto setting would have behaved.</span></span> <span data-ttu-id="35775-143">如果影像是以手動設定為快照，並允許使用者覆寫手動設定，這就很有用。</span><span class="sxs-lookup"><span data-stu-id="35775-143">This is useful if the image was shot on a Manual setting and allows the user to override manual settings.</span></span>
    -   <span data-ttu-id="35775-144">不執行任何動作。</span><span class="sxs-lookup"><span data-stu-id="35775-144">Do nothing.</span></span> <span data-ttu-id="35775-145">當選取 [自動] 時，並非所有控制項都需要設定，而且不會讓設定保持不變。</span><span class="sxs-lookup"><span data-stu-id="35775-145">Not all controls need to be set when Auto is selected, and it is OK to leave settings unchanged.</span></span>

<span data-ttu-id="35775-146">當使用者針對所有一般編解碼器控制項調整（例如色彩和曝光）選取自動校正時，Windows Vista 影像中心和 Windows Live 影像中心編輯工具和其他編輯應用程式會使用 [**IWICDevelopRaw**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw) 自動參數載入來取得最佳結果。</span><span class="sxs-lookup"><span data-stu-id="35775-146">The Windows Vista Photo Gallery and Windows Live Photo Gallery editing tools and other editing applications use the [**IWICDevelopRaw**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw) Auto parameter load when the user selects Auto Correct for all normal codec control adjustments such as color and exposure to get the best results.</span></span>

## <a name="related-topics"></a><span data-ttu-id="35775-147">相關主題</span><span class="sxs-lookup"><span data-stu-id="35775-147">Related topics</span></span>

<dl> <dt>

<span data-ttu-id="35775-148">**概念**</span><span class="sxs-lookup"><span data-stu-id="35775-148">**Conceptual**</span></span>
</dt> <dt>

[<span data-ttu-id="35775-149">Windows 影像處理元件總覽</span><span class="sxs-lookup"><span data-stu-id="35775-149">Windows Imaging Component Overview</span></span>](-wic-about-windows-imaging-codec.md)
</dt> <dt>

[<span data-ttu-id="35775-150">相機原始影像格式的 WIC 指導方針</span><span class="sxs-lookup"><span data-stu-id="35775-150">WIC Guidelines for Camera RAW Image Formats</span></span>](-wic-rawguidelines.md)
</dt> <dt>

[<span data-ttu-id="35775-151">如何撰寫 WIC-Enabled 編解碼器</span><span class="sxs-lookup"><span data-stu-id="35775-151">How to Write a WIC-Enabled CODEC</span></span>](-wic-howtowriteacodec.md)
</dt> </dl>

 

 



