---
description: 會話或撥號狀態表示會話的目前狀態，例如 &\# 0034; 提供&\# 0034; 或 &\# 0034; connected. &\# 0034;適當處理狀態資訊對於大部分 TAPI 應用程式正常運作而言很重要。
ms.assetid: a6a49b77-4e9b-4f23-bfe6-26f26549b18f
title: 狀態
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 88fb9c482fcb9e432b5bfb5d36f77cd09f538086
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "106981684"
---
# <a name="state"></a><span data-ttu-id="7e445-103">狀態</span><span class="sxs-lookup"><span data-stu-id="7e445-103">State</span></span>

<span data-ttu-id="7e445-104">會話或撥號狀態表示會話的目前狀態，例如「供應」或「已連線」。</span><span class="sxs-lookup"><span data-stu-id="7e445-104">Session or call state indicates the current status of a session, such as "offering" or "connected."</span></span> <span data-ttu-id="7e445-105">適當處理狀態資訊對於大部分 TAPI 應用程式正常運作而言很重要。</span><span class="sxs-lookup"><span data-stu-id="7e445-105">Proper handling of state information is vital to the proper functioning of most TAPI applications.</span></span> <span data-ttu-id="7e445-106">例如，回應作業只能在提供的會話上執行，但是如果會話處於該狀態，則傳輸將會失敗。</span><span class="sxs-lookup"><span data-stu-id="7e445-106">For example, the answer operation can be performed only on an offered session, but a transfer will fail if the session is in that state.</span></span>

<span data-ttu-id="7e445-107">會話的狀態會因為事件的結果而變更。</span><span class="sxs-lookup"><span data-stu-id="7e445-107">A session's state changes as a result of events.</span></span> <span data-ttu-id="7e445-108">事件可以是要求或未經要求的。</span><span class="sxs-lookup"><span data-stu-id="7e445-108">Events can be solicited or unsolicited.</span></span> <span data-ttu-id="7e445-109">*請求事件* 是由控制會話的應用程式所造成，例如叫用 TAPI 會話操作時。</span><span class="sxs-lookup"><span data-stu-id="7e445-109">*Solicited events* are caused by the application controlling the session, such as when it invokes a TAPI session operation.</span></span> <span data-ttu-id="7e445-110">*未經* 要求的事件是由交換器、電話網絡、使用者按下本機電話上的按鈕，或是遠端方的動作所造成。</span><span class="sxs-lookup"><span data-stu-id="7e445-110">*Unsolicited events* are caused by the switch, the telephone network, the user pressing buttons on the local phone, or the actions of the remote party.</span></span>

<span data-ttu-id="7e445-111">每當服務提供者偵測到會話狀態變更時，就會報告 TAPI 和 TAPI 的變更，對所有擁有者和監視應用程式發出事件通知。</span><span class="sxs-lookup"><span data-stu-id="7e445-111">Whenever a service provider detects a session state change, it reports the change to TAPI and TAPI issues an event notification to all owner and monitor applications.</span></span> <span data-ttu-id="7e445-112">應用程式必須適當地回應這些通知。</span><span class="sxs-lookup"><span data-stu-id="7e445-112">The application must react to these notifications appropriately.</span></span> <span data-ttu-id="7e445-113">請參閱 [TAPI 初始化](tapi-initialization.md) 下的事件通知，以取得有關控制哪些事件會回報給應用程式的資訊。</span><span class="sxs-lookup"><span data-stu-id="7e445-113">Please see Event Notification under [TAPI Initialization](tapi-initialization.md) for information on controlling which events are reported to an application.</span></span>

<span data-ttu-id="7e445-114">應用程式應該一律處理狀態事件通知。</span><span class="sxs-lookup"><span data-stu-id="7e445-114">An application should always process state event notifications.</span></span> <span data-ttu-id="7e445-115">針對某個實體設定有效的狀態轉換可能對另一個實體設定無效。</span><span class="sxs-lookup"><span data-stu-id="7e445-115">State transitions valid for one physical configuration may be invalid for another.</span></span> <span data-ttu-id="7e445-116">例如，假設有一條線在電腦和不同的電話組上實際終止，在電腦與電話組間建立合作物件線設定。</span><span class="sxs-lookup"><span data-stu-id="7e445-116">For example, consider a line that physically terminates both at the computer and at a separate phone set, creating a party line configuration between the computer and the phone set.</span></span> <span data-ttu-id="7e445-117">在電腦上執行的應用程式可能不知道電話設定活動。</span><span class="sxs-lookup"><span data-stu-id="7e445-117">An application running on the computer may not know about phone set activities.</span></span> <span data-ttu-id="7e445-118">也就是說，在沒有服務提供者察覺的情況下，可能會使用這一行。</span><span class="sxs-lookup"><span data-stu-id="7e445-118">That is, the line may be in use without the service provider being aware of it.</span></span> <span data-ttu-id="7e445-119">嘗試撥出呼叫的應用程式將會成功從 TAPI 配置呼叫外觀，但這會導致在行上共用使用中的呼叫。</span><span class="sxs-lookup"><span data-stu-id="7e445-119">An application that attempts to make an outgoing call will succeed in allocating a call appearance from TAPI, but this results in sharing the active call on the line.</span></span> <span data-ttu-id="7e445-120">在不先檢查撥號音的情況下，盲目傳送 DTMF 撥號字串，可能不會導致預期的 (或有禮貌) 的行為。</span><span class="sxs-lookup"><span data-stu-id="7e445-120">Blindly sending a DTMF dial string without first checking for a dial tone may not result in intended (or polite) behavior.</span></span>

<span data-ttu-id="7e445-121">應用程式不應假設從某個狀態到另一個狀態的固定進展。</span><span class="sxs-lookup"><span data-stu-id="7e445-121">An application should not assume a rigid progression from one state to another.</span></span> <span data-ttu-id="7e445-122">狀態事件會抵達並以非同步方式轉送，且通知可能無法以可預測的順序接收。</span><span class="sxs-lookup"><span data-stu-id="7e445-122">State events arrive and are forwarded asynchronously and notifications may not be received in a predictable order.</span></span> <span data-ttu-id="7e445-123">因此，您應該將撥號狀態通知視為告知應用程式呼叫的新狀態，而不是報告兩個狀態之間的轉換。</span><span class="sxs-lookup"><span data-stu-id="7e445-123">Therefore, call-state notifications should be viewed as telling the application the call's new state instead of as reporting the transitions between two states.</span></span>

<span data-ttu-id="7e445-124">所有電話語音服務提供者都必須提供此資訊。</span><span class="sxs-lookup"><span data-stu-id="7e445-124">All telephony service providers must supply this information.</span></span>

<span data-ttu-id="7e445-125">\* \* TAPI 2.x： \* \*[**lineGetCallStatus**](/windows/win32/api/tapi/nf-tapi-linegetcallstatus)、 [**lineGetCallInfo**](/windows/win32/api/tapi/nf-tapi-linegetcallinfo)、 [**行 \_ CALLSTATE**](./line-callstate.md) 訊息、 [LINECALLSTATE \_ 常數](./linecallstate--constants.md)</span><span class="sxs-lookup"><span data-stu-id="7e445-125">\*\*TAPI 2.x:  \*\*[**lineGetCallStatus**](/windows/win32/api/tapi/nf-tapi-linegetcallstatus), [**lineGetCallInfo**](/windows/win32/api/tapi/nf-tapi-linegetcallinfo), [**LINE\_CALLSTATE**](./line-callstate.md) message, [LINECALLSTATE\_ Constants](./linecallstate--constants.md)</span></span>

<span data-ttu-id="7e445-126">**TAPI 3.x： **[**ITCallInfo：： get \_ CallInfoLong**](/windows/desktop/api/tapi3if/nf-tapi3if-itcallinfo-get_callinfolong) (** \_** [**CALLINFO \_ LONG**](/windows/desktop/api/Tapi3if/ne-tapi3if-callinfo_long)) 、 [**ITCallStateEvent**](/windows/desktop/api/tapi3if/nn-tapi3if-itcallstateevent) notification、 [**CALL \_ STATE**](/windows/desktop/api/Tapi3if/ne-tapi3if-call_state)列舉值的 CIL CALLID 成員</span><span class="sxs-lookup"><span data-stu-id="7e445-126">**TAPI 3.x:  **[**ITCallInfo::get\_CallInfoLong**](/windows/desktop/api/tapi3if/nf-tapi3if-itcallinfo-get_callinfolong) (** CIL\_CALLID** member of [**CALLINFO\_LONG**](/windows/desktop/api/Tapi3if/ne-tapi3if-callinfo_long)), [**ITCallStateEvent**](/windows/desktop/api/tapi3if/nn-tapi3if-itcallstateevent) notification, [**CALL\_STATE**](/windows/desktop/api/Tapi3if/ne-tapi3if-call_state) enumerator</span></span>

 

 
