---
description: 經過一段時間，可能會產生不同版本的 TAPI、應用程式和服務提供者。
ms.assetid: 994fad0e-5958-4d93-8952-9db2bbe01f44
title: TSPI 版本控制
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: dfe405a629ddc64f76535b33554509b1a6fca81d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104511869"
---
# <a name="tspi-versioning"></a><span data-ttu-id="98f81-103">TSPI 版本控制</span><span class="sxs-lookup"><span data-stu-id="98f81-103">TSPI Versioning</span></span>

<span data-ttu-id="98f81-104">經過一段時間，可能會產生不同版本的 TAPI、應用程式和服務提供者。</span><span class="sxs-lookup"><span data-stu-id="98f81-104">Over time, different versions of TAPI, applications, and service providers may be produced.</span></span> <span data-ttu-id="98f81-105">這些新版本可以建立新的定義，例如新功能、資料結構中的新成員，以及新的位欄位。</span><span class="sxs-lookup"><span data-stu-id="98f81-105">These new versions can make new definitions, such as for new features, new members in data structures, and new bit fields.</span></span> <span data-ttu-id="98f81-106">因此需要版本號碼來指出如何解讀各種資料結構。</span><span class="sxs-lookup"><span data-stu-id="98f81-106">Version numbers are therefore necessary to indicate how to interpret various data structures.</span></span>

<span data-ttu-id="98f81-107">為了讓不同的應用程式版本、TAPI 本身的版本，以及不同廠商的服務提供者版本獲得最佳互通性，Microsoft 電話語音為應用程式提供了一個簡單的版本協商機制。</span><span class="sxs-lookup"><span data-stu-id="98f81-107">To allow optimal interoperability of different versions of applications, versions of TAPI itself, and versions of service providers by different vendors, Microsoft Telephony provides a simple version negotiation mechanism for applications.</span></span> <span data-ttu-id="98f81-108">有兩個不同的版本需要由 TAPI 和每一行裝置的電話語音服務提供者來同意。</span><span class="sxs-lookup"><span data-stu-id="98f81-108">There are two different versions that need to be agreed on by TAPI and the telephony service provider for each line device.</span></span> <span data-ttu-id="98f81-109">第一個是基本和補充電話語音 SPI 的版本號碼，稱為 *TSPI 介面版本*。</span><span class="sxs-lookup"><span data-stu-id="98f81-109">The first is the version number for the Basic and Supplementary Telephony SPI, referred to as the *TSPI interface version*.</span></span> <span data-ttu-id="98f81-110">另一個則適用于提供者專屬的延伸模組（如果有的話），而且稱為 *延伸模組版本*。</span><span class="sxs-lookup"><span data-stu-id="98f81-110">The other is for provider-specific extensions, if any, and is referred to as the *extension version*.</span></span> <span data-ttu-id="98f81-111">TSPI 的基本和補充功能所使用的資料結構和資料類型的格式是由 TSPI 版本所定義，而延伸模組版本則決定由廠商專屬的延伸模組所定義的資料結構格式。</span><span class="sxs-lookup"><span data-stu-id="98f81-111">The format of the data structures and datatypes used by TSPI's Basic and Supplementary features is defined by the TSPI version, while the extension version determines the format of data structures defined by the vendor-specific extensions.</span></span>

<span data-ttu-id="98f81-112">這兩種版本的版本協商是由兩個不同的程式處理：使用 [**TSPI \_ lineNegotiateTSPIVersion**](/windows/win32/api/tspi/nf-tspi-tspi_linenegotiatetspiversion) 來協商 TSPI 介面版本，而使用 [**TSPI \_ lineNegotiateExtVersion**](/windows/win32/api/tspi/nf-tspi-tspi_linenegotiateextversion) 來協商延伸模組版本。</span><span class="sxs-lookup"><span data-stu-id="98f81-112">These two types of version negotiation are handled by two different procedures: [**TSPI\_lineNegotiateTSPIVersion**](/windows/win32/api/tspi/nf-tspi-tspi_linenegotiatetspiversion) is used to negotiate the TSPI interface version, and [**TSPI\_lineNegotiateExtVersion**](/windows/win32/api/tspi/nf-tspi-tspi_linenegotiateextversion) is used to negotiate the extension version.</span></span> <span data-ttu-id="98f81-113">如果不需要延伸模組，可以略過延伸模組版本協商。</span><span class="sxs-lookup"><span data-stu-id="98f81-113">Extension version negotiation can be skipped if extensions are not wanted.</span></span> <span data-ttu-id="98f81-114">如果這些範圍在協商期間輸入，服務提供者必須傳回範圍中重迭部分的值，以作為協商的結果。</span><span class="sxs-lookup"><span data-stu-id="98f81-114">If these ranges input during negotiation overlap, the service provider must return a value within the overlapping portion of the range as the result of the negotiation.</span></span> <span data-ttu-id="98f81-115">通常，這應該是最大的可能值。</span><span class="sxs-lookup"><span data-stu-id="98f81-115">Usually, this should be the highest possible value.</span></span> <span data-ttu-id="98f81-116">如果範圍不重迭，則這兩個合作物件不相容，且函數會傳回錯誤。</span><span class="sxs-lookup"><span data-stu-id="98f81-116">If the ranges do not overlap, the two parties are incompatible and the function returns an error.</span></span>

<span data-ttu-id="98f81-117">協商的結果只會指出服務提供者願意以特定版本號碼操作，但不會認可服務提供者。</span><span class="sxs-lookup"><span data-stu-id="98f81-117">Results of a negotiation simply indicate that the service provider is willing to operate at a particular version number, but do not commit the service provider to doing so.</span></span> <span data-ttu-id="98f81-118">例如，在協商可能的版本之後，TAPI 可以重新協商以判斷理想的版本。</span><span class="sxs-lookup"><span data-stu-id="98f81-118">For example, TAPI can renegotiate to determine an ideal version after having negotiated a possible version.</span></span> <span data-ttu-id="98f81-119">只有在使用 [**TSPI \_ lineOpen**](/windows/win32/api/tspi/nf-tspi-tspi_lineopen) 和繼續生存開啟行時，才會認可 TSPI 介面版本，直到裝置關閉為止。</span><span class="sxs-lookup"><span data-stu-id="98f81-119">The TSPI interface version is only committed when a line is opened using [**TSPI\_lineOpen**](/windows/win32/api/tspi/nf-tspi-tspi_lineopen) and survives until the device is closed.</span></span> <span data-ttu-id="98f81-120">呼叫 [**TSPI \_ lineSelectExtVersion**](/windows/win32/api/tspi/nf-tspi-tspi_lineselectextversion) 函式時，會認可延伸模組版本，並繼續生存直到選取擴充功能版本零來取消選取專案為止。</span><span class="sxs-lookup"><span data-stu-id="98f81-120">The extension version is committed when the [**TSPI\_lineSelectExtVersion**](/windows/win32/api/tspi/nf-tspi-tspi_lineselectextversion) function is called, and survives until the selection is canceled by selecting extension version zero.</span></span>

<span data-ttu-id="98f81-121">延伸模組版本選擇可能會發生多次，包括延伸模組版本生效。</span><span class="sxs-lookup"><span data-stu-id="98f81-121">Extension version selection can happen many times, including while an extension version is in effect.</span></span> <span data-ttu-id="98f81-122">因為服務提供者會認可至擴充功能版本，所以其支援版本範圍會縮減為該延伸模組的版本。</span><span class="sxs-lookup"><span data-stu-id="98f81-122">Because the service provider is committed to the extension version, its range of supported versions narrows to exactly that extension version.</span></span> <span data-ttu-id="98f81-123">例如，假設服務提供者通常與延伸模組版本1.0 至5.5 相容。</span><span class="sxs-lookup"><span data-stu-id="98f81-123">For example, consider a service provider that is normally compatible with extension versions 1.0 through 5.5.</span></span> <span data-ttu-id="98f81-124">當呼叫端嘗試協調範圍1.0 到5.5 之間的版本時，如果版本3.0 有效，則協商會傳回3.0。</span><span class="sxs-lookup"><span data-stu-id="98f81-124">If version 3.0 is in effect while a caller attempts to negotiate a version within the range 1.0 to 5.5, the negotiation returns 3.0.</span></span>

<span data-ttu-id="98f81-125">因為 TAPI 會協商版本，所以您可以將服務提供者升級為新版的介面，而不需要同時升級該 TAPI。</span><span class="sxs-lookup"><span data-stu-id="98f81-125">Because TAPI negotiates the version, you can upgrade a service provider to new versions of the interface without requiring that TAPI also be upgraded.</span></span> <span data-ttu-id="98f81-126">同樣地，TAPI 也可以升級，但仍可使用您較舊的服務提供者。</span><span class="sxs-lookup"><span data-stu-id="98f81-126">Similarly, TAPI can be upgraded, yet still use your older service provider.</span></span>

 

 
