---
description: 在 TSPI 所定義的電話裝置抽象中，TAPI 和服務提供者必須先進行基本初始化。
ms.assetid: cd8bb328-fbd0-409c-8471-34ad4c2c8d93
title: Phone SPI 初始化
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1d0c54e313c2be3846aeb604217f5324ec0d8a8d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "106984620"
---
# <a name="phone-spi-initialization"></a><span data-ttu-id="56e14-103">Phone SPI 初始化</span><span class="sxs-lookup"><span data-stu-id="56e14-103">Phone SPI Initialization</span></span>

<span data-ttu-id="56e14-104">在 TSPI 所定義的電話裝置抽象中，TAPI 和服務提供者必須先進行基本初始化。</span><span class="sxs-lookup"><span data-stu-id="56e14-104">As part of the phone device abstraction defined by TSPI, TAPI and the service provider must first undergo basic initialization.</span></span> <span data-ttu-id="56e14-105">這兩個基本初始化是針對介面的線條和電話部分，以相同的一組步驟來完成。</span><span class="sxs-lookup"><span data-stu-id="56e14-105">This basic initialization is accomplished both for the line and phone halves of the interface by the same set of steps.</span></span> <span data-ttu-id="56e14-106">這些步驟的第一個步驟是介面版本協商。</span><span class="sxs-lookup"><span data-stu-id="56e14-106">The first of these steps is interface version negotiation.</span></span> <span data-ttu-id="56e14-107">TAPI 藉由呼叫 [**TSPI \_ lineNegotiateTSPIVersion**](/windows/win32/api/tspi/nf-tspi-tspi_linenegotiatetspiversion) 函式來執行這項工作。</span><span class="sxs-lookup"><span data-stu-id="56e14-107">TAPI performs this by calling the [**TSPI\_lineNegotiateTSPIVersion**](/windows/win32/api/tspi/nf-tspi-tspi_linenegotiatetspiversion) function.</span></span> <span data-ttu-id="56e14-108">此函式通常用來代表個別線路裝置進行協商;相同服務提供者內的不同線路裝置可能會根據不同的介面版本運作。</span><span class="sxs-lookup"><span data-stu-id="56e14-108">This function is usually used to negotiate on behalf of an individual line device; different line devices within the same service provider may operate according to different interface versions.</span></span> <span data-ttu-id="56e14-109">TAPI 會傳遞特殊的保留裝置識別碼值（ [**初始化 \_ 協調**](initialize-negotiation.md)），表示它正在協商影響整個服務提供者的初始化函式的整體介面版本，這兩者都適用于線路和行動電話。</span><span class="sxs-lookup"><span data-stu-id="56e14-109">TAPI passes a special reserved device identifier value, [**INITIALIZE\_NEGOTIATION**](initialize-negotiation.md), to indicate that it is negotiating an overall interface version for initialization functions that affect the entire service provider, both for lines and phones.</span></span>

<span data-ttu-id="56e14-110">此協商的結果會傳遞至後續的程式，直到手機裝置開啟為止。</span><span class="sxs-lookup"><span data-stu-id="56e14-110">The result of this negotiation is passed to subsequent procedures until a phone device is opened.</span></span> <span data-ttu-id="56e14-111">屆時，手機裝置會認可至特定的介面版本。</span><span class="sxs-lookup"><span data-stu-id="56e14-111">At that time, the phone device becomes committed to a particular interface version.</span></span> <span data-ttu-id="56e14-112">這個介面版本在關閉電話之前是隱含的，而且不需要傳遞至在開啟的電話上操作的後續函式。</span><span class="sxs-lookup"><span data-stu-id="56e14-112">This interface version is implicit until the phone is closed, and does not need to be passed to subsequent functions that operate on an opened phone.</span></span>

<span data-ttu-id="56e14-113">在整體介面版本協商之後，TAPI 會呼叫 [**TSPI \_ providerInit**](/windows/win32/api/tspi/nf-tspi-tspi_providerinit) 函式。</span><span class="sxs-lookup"><span data-stu-id="56e14-113">Following overall interface version negotiation, TAPI calls the [**TSPI\_providerInit**](/windows/win32/api/tspi/nf-tspi-tspi_providerinit) function.</span></span> <span data-ttu-id="56e14-114">此函式會初始化服務提供者，同時提供後續作業所需的參數。</span><span class="sxs-lookup"><span data-stu-id="56e14-114">This function initializes the service provider, also giving it parameters required for subsequent operation.</span></span> <span data-ttu-id="56e14-115">這些參數包括下列各項：</span><span class="sxs-lookup"><span data-stu-id="56e14-115">These parameters include the following:</span></span>

-   <span data-ttu-id="56e14-116">*dwPermanentProviderID*：指定要初始化之服務提供者的永久識別碼，此識別碼在此系統的服務提供者內是唯一的。</span><span class="sxs-lookup"><span data-stu-id="56e14-116">*dwPermanentProviderID*: Specifies the permanent identifier of the service provider being initialized, unique within the service providers on this system.</span></span>
-   <span data-ttu-id="56e14-117">*dwLineDeviceIDBase*：指定此服務提供者所支援之線路裝置的最低裝置識別碼。</span><span class="sxs-lookup"><span data-stu-id="56e14-117">*dwLineDeviceIDBase*: Specifies the lowest device identifier for the line devices supported by this service provider.</span></span>
-   <span data-ttu-id="56e14-118">*dwPhoneDeviceIDBase*：指定此服務提供者所支援之電話裝置的最低裝置識別碼。</span><span class="sxs-lookup"><span data-stu-id="56e14-118">*dwPhoneDeviceIDBase*: Specifies the lowest device identifier for the phone devices supported by this service provider.</span></span> <span data-ttu-id="56e14-119">電話語音電話裝置類別的裝置是由從零開始的整數所識別。</span><span class="sxs-lookup"><span data-stu-id="56e14-119">Devices of the telephony phone device class are identified by integers starting from zero.</span></span> <span data-ttu-id="56e14-120">此範圍的識別碼在全系列電話裝置之間是連續的。</span><span class="sxs-lookup"><span data-stu-id="56e14-120">This range of identifiers is contiguous across the full range of phone devices.</span></span> <span data-ttu-id="56e14-121">由於可能有多個服務提供者在單一系統中管理電話裝置，因此每個服務提供者都會取得總範圍的連續部分。</span><span class="sxs-lookup"><span data-stu-id="56e14-121">Because there may be multiple service providers managing phone devices in a single system, each service provider gets a contiguous portion of the total range.</span></span> <span data-ttu-id="56e14-122">此參數會告知服務提供者其範圍部分的最小值。</span><span class="sxs-lookup"><span data-stu-id="56e14-122">This parameter tells the service provider the lowest value in its portion of the range.</span></span> <span data-ttu-id="56e14-123">服務提供者（而不是 TAPI）負責將此變數範圍對應至本身的內部裝置識別碼。</span><span class="sxs-lookup"><span data-stu-id="56e14-123">The service provider, rather than TAPI, is responsible for mapping this variable range to its own internal device identifiers.</span></span> <span data-ttu-id="56e14-124">這可讓服務提供者廠商有足夠的彈性，可在裝置專屬的延伸模組中使用裝置識別碼（如有需要）。</span><span class="sxs-lookup"><span data-stu-id="56e14-124">This gives the service-provider vendor sufficient flexibility to use device identifiers in device-specific extensions if it wants.</span></span> <span data-ttu-id="56e14-125">因為服務提供者知道哪些裝置識別碼會出現在 TAPI 定義的參數和資料結構中，所以它可以在裝置專屬的擴充參數和資料結構中使用一致的裝置識別碼。</span><span class="sxs-lookup"><span data-stu-id="56e14-125">Because the service provider knows what device identifiers appear in TAPI-defined parameters and data structures, it can use consistent device identifiers in device-specific extension parameters and data structures.</span></span>
-   <span data-ttu-id="56e14-126">*dwNumLines*：指定此服務提供者支援的行裝置數目。</span><span class="sxs-lookup"><span data-stu-id="56e14-126">*dwNumLines*: Specifies how many line devices this service provider supports.</span></span>
-   <span data-ttu-id="56e14-127">*dwNumPhones*：指定此服務提供者支援的電話裝置數目。</span><span class="sxs-lookup"><span data-stu-id="56e14-127">*dwNumPhones*: Specifies how many phone devices this service provider supports.</span></span>
-   <span data-ttu-id="56e14-128">*lpfnCompletionProc*：指定服務提供者呼叫的程式，以報告線路和手機裝置上所有非同步作業程式的完成。</span><span class="sxs-lookup"><span data-stu-id="56e14-128">*lpfnCompletionProc*: Specifies the procedure the service provider calls to report completion of all asynchronously operating procedures on line and phone devices.</span></span>

<span data-ttu-id="56e14-129">在 [**TSPI \_ providerInit**](/windows/win32/api/tspi/nf-tspi-tspi_providerinit)之後，就可以執行一般作業，例如開啟電話。</span><span class="sxs-lookup"><span data-stu-id="56e14-129">Following [**TSPI\_providerInit**](/windows/win32/api/tspi/nf-tspi-tspi_providerinit), normal operations such as opening phones can be carried out.</span></span>

 

 
