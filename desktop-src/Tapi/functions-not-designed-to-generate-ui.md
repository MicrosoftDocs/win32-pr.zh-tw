---
description: 假設服務提供者必須在處理 lineMakeCall 或 lineDial 期間，顯示 (像是 Unimodem 或 ATSP 交談/掛斷對話方塊) 的對話方塊。
ms.assetid: 46f87947-bfcd-48ad-8c33-7ea4d9caa34c
title: 未設計為產生 UI 的函式
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 70bd7ed1395136d1a2d2a31b060127395e8804ac
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104513372"
---
# <a name="functions-not-designed-to-generate-ui"></a><span data-ttu-id="bb5e5-103">未設計為產生 UI 的函式</span><span class="sxs-lookup"><span data-stu-id="bb5e5-103">Functions Not Designed to Generate UI</span></span>

<span data-ttu-id="bb5e5-104">假設服務提供者必須在處理 [**lineMakeCall**](/windows/win32/api/tapi/nf-tapi-linemakecall)或 [**lineDial**](/windows/win32/api/tapi/nf-tapi-linedial)期間，顯示 (像是 Unimodem 或 ATSP **交談/掛斷** 對話方塊) 的對話方塊。</span><span class="sxs-lookup"><span data-stu-id="bb5e5-104">Assume that the service provider must display a dialog box (like the Unimodem or ATSP **Talk/Hangup** dialog box) during the processing of [**lineMakeCall**](/windows/win32/api/tapi/nf-tapi-linemakecall) or [**lineDial**](/windows/win32/api/tapi/nf-tapi-linedial).</span></span> <span data-ttu-id="bb5e5-105">在此情況下，它是服務提供者，而不是應用程式，它會決定必須顯示 UI。</span><span class="sxs-lookup"><span data-stu-id="bb5e5-105">In this case, it is the service provider, not the application, that decides that UI must be displayed.</span></span>

<span data-ttu-id="bb5e5-106">為了在應用程式進程中叫用 UI DLL，服務提供者會呼叫 TSPI [*line \_ 事件*](/windows/win32/api/tspi/nc-tspi-lineevent) 回呼，以產生 [**一行 \_ CREATEDIALOGINSTANCE**](line-createdialoginstance.md) 訊息，將指標傳遞至 [**TUISPICREATEDIALOGINSTANCEPARAMS**](/windows/win32/api/tspi/ns-tspi-tuispicreatedialoginstanceparams)類型的結構。</span><span class="sxs-lookup"><span data-stu-id="bb5e5-106">To invoke the UI DLL in the application process, the service provider calls the TSPI [*Line\_Event*](/windows/win32/api/tspi/nc-tspi-lineevent) callback, generating a [**LINE\_CREATEDIALOGINSTANCE**](line-createdialoginstance.md) message, passing in a pointer to a structure of type [**TUISPICREATEDIALOGINSTANCEPARAMS**](/windows/win32/api/tspi/ns-tspi-tuispicreatedialoginstanceparams).</span></span> <span data-ttu-id="bb5e5-107">此結構包含與 UI 相關聯的函式 **dwRequestID** ，可讓 TAPISRV 識別要產生 ui 的用戶端應用程式。</span><span class="sxs-lookup"><span data-stu-id="bb5e5-107">This structure contains the **dwRequestID** of the function with which the UI is associated, allowing TAPISRV to identify the client application in which the UI is to be generated.</span></span>

<span data-ttu-id="bb5e5-108">TAPISRV 會要求正確的應用程式 TAPI 實例載入 UI DLL，並在應用程式的進程內建立 UI 的執行緒。</span><span class="sxs-lookup"><span data-stu-id="bb5e5-108">TAPISRV requests the correct application's instance of TAPI to load the UI DLL and create a thread for the UI within the application's process.</span></span> <span data-ttu-id="bb5e5-109">從這個新的 UI 執行緒，TAPI 會呼叫 UI DLL 的 [**TUISPI \_ providerGenericDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialog) 函式，並傳入傳入的結構中的電話語音服務提供者所指定的資料，並以 [**行 \_ CREATEDIALOGINSTANCE**](line-createdialoginstance.md) 訊息傳送; ui dll 會顯示適當的對話方塊， (這對 UI DLL 和電話語音服務提供者) 之間的私用設計而言很重要。</span><span class="sxs-lookup"><span data-stu-id="bb5e5-109">From this new UI thread, TAPI calls the UI DLL's [**TUISPI\_providerGenericDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialog) function, passing in data that was specified by the telephony service provider in the structure passed in with the [**LINE\_CREATEDIALOGINSTANCE**](line-createdialoginstance.md) message; the UI DLL displays the appropriate dialog box (which is a matter for private design between the UI DLL and the telephony service provider).</span></span> <span data-ttu-id="bb5e5-110">在對話方塊關閉之前，UI DLL 不會從 **TUISPI \_ providerGenericDialog** 傳回。</span><span class="sxs-lookup"><span data-stu-id="bb5e5-110">The UI DLL does not return from **TUISPI\_providerGenericDialog** until the dialog box is closed.</span></span>

<span data-ttu-id="bb5e5-111">電話語音服務提供者可以產生更新的資料，以便在對話方塊中顯示 (或者，如果已放棄呼叫，或藉由傳送 [**一行 \_ SENDDIALOGINSTANCEDATA**](line-senddialoginstancedata.md) 訊息) 其他事件發生，則指示對話方塊關閉。</span><span class="sxs-lookup"><span data-stu-id="bb5e5-111">The telephony service provider can generate updated data to display in the dialog box (or, for example, instruct the dialog box to be closed, if the call is abandoned or other events occur) by sending a [**LINE\_SENDDIALOGINSTANCEDATA**](line-senddialoginstancedata.md) message.</span></span> <span data-ttu-id="bb5e5-112">TAPISRV 會將資料傳達給 TAPI，以呼叫 UI DLL 的 [**TUISPI \_ providerGenericDialogData**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialogdata) 函式。</span><span class="sxs-lookup"><span data-stu-id="bb5e5-112">TAPISRV conveys the data to TAPI, which calls the UI DLL's [**TUISPI\_providerGenericDialogData**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialogdata) function.</span></span> <span data-ttu-id="bb5e5-113">這種機制提供單向的「傳送」至 UI DLL。</span><span class="sxs-lookup"><span data-stu-id="bb5e5-113">This mechanism provides a unidirectional "send" to the UI DLL.</span></span> <span data-ttu-id="bb5e5-114">如果 UI DLL 想要通知電話語音服務提供者該對話方塊的結果，或取得其他資料，則可以呼叫 [*DllCallbackProc*](/windows/win32/api/tspi/nc-tspi-tuispidllcallback) 函式 (在) 呼叫 [**TUISPI \_ providerGenericDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialog) 時所收到的指標。</span><span class="sxs-lookup"><span data-stu-id="bb5e5-114">If the UI DLL wants to inform the telephony service provider of the results of the dialog box or obtain other data, it can call the [*DllCallbackProc*](/windows/win32/api/tspi/nc-tspi-tuispidllcallback) function (a pointer to which it received when [**TUISPI\_providerGenericDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialog) was called).</span></span>

<span data-ttu-id="bb5e5-115">當對話方塊關閉時， [**TUISPI \_ providerGenericDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialog) 會返回 TAPI。</span><span class="sxs-lookup"><span data-stu-id="bb5e5-115">When the dialog box is dismissed, [**TUISPI\_providerGenericDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialog) returns to TAPI.</span></span> <span data-ttu-id="bb5e5-116">TAPI 會呼叫 [**FreeLibrary**](/windows/desktop/api/libloaderapi/nf-libloaderapi-freelibrary) 來釋放 ui DLL，並結束它在應用程式內容中建立的 ui 執行緒。</span><span class="sxs-lookup"><span data-stu-id="bb5e5-116">TAPI calls [**FreeLibrary**](/windows/desktop/api/libloaderapi/nf-libloaderapi-freelibrary) to release the UI DLL, and exits the UI thread it had created in the application context.</span></span> <span data-ttu-id="bb5e5-117">然後，它會要求 TAPISRV 呼叫電話語音服務提供者的 [**TSPI \_ providerFreeDialogInstance**](/windows/win32/api/tspi/nf-tspi-tspi_providerfreedialoginstance) 函式，以便在電話語音服務提供者最初傳送 [**該行 \_ CREATEDIALOGINSTANCE**](line-createdialoginstance.md) 訊息時，將建立的關聯解除系結。</span><span class="sxs-lookup"><span data-stu-id="bb5e5-117">It then requests TAPISRV to call the telephony service provider's [**TSPI\_providerFreeDialogInstance**](/windows/win32/api/tspi/nf-tspi-tspi_providerfreedialoginstance) function to unbind the association created when the telephony service provider originally sent the [**LINE\_CREATEDIALOGINSTANCE**](line-createdialoginstance.md) message.</span></span> <span data-ttu-id="bb5e5-118">如果應用程式進程在 **TUISPI \_ providerGenericDialog** 傳回之前未預期地終止，也會呼叫此函式。</span><span class="sxs-lookup"><span data-stu-id="bb5e5-118">This function is also called if the application process terminates unexpectedly before **TUISPI\_providerGenericDialog** returns.</span></span>

 

 
