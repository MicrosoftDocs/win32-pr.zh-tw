---
description: 應用程式提供來起始通訊會話的主要資訊片段包括網址類別型、媒體類型或類型，以及目的地位址。
ms.assetid: 65e53587-0e40-411b-8d6c-d6adfc9d1e6c
title: 起始會話
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9e925ba90460b88c85a9aab1624923acdbc4572a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "103848660"
---
# <a name="initiate-a-session"></a><span data-ttu-id="1189e-103">起始會話</span><span class="sxs-lookup"><span data-stu-id="1189e-103">Initiate a Session</span></span>

<span data-ttu-id="1189e-104">應用程式提供來起始通訊會話的主要資訊片段包括 [網址類別型](address-type-ovr.md)、 [媒體類型](media-type-ovr.md) 或類型，以及目的地 [位址](address-ovr.md)。</span><span class="sxs-lookup"><span data-stu-id="1189e-104">The primary pieces of information an application supplies to initiate a communications session are the [address type](address-type-ovr.md), the [media type](media-type-ovr.md) or types, and the destination [address](address-ovr.md).</span></span>

<span data-ttu-id="1189e-105">目的地位址可能需要 [位址轉譯](#address-translation) ，才能將使用者輸入的資訊放入指定網址類別型的適當格式。</span><span class="sxs-lookup"><span data-stu-id="1189e-105">The destination address may require [address translation](#address-translation) to put the information entered by a user into the proper format for a given address type.</span></span> <span data-ttu-id="1189e-106">例如，位於 [標準](address-ovr.md) 格式電子通訊錄中的電話號碼，將需要翻譯成可 [撥](address-ovr.md) 出的格式。</span><span class="sxs-lookup"><span data-stu-id="1189e-106">For example, a phone number that was in an electronic address book in [canonical](address-ovr.md) format will require translation to [dialable](address-ovr.md) format.</span></span>

<span data-ttu-id="1189e-107">某些會話可能需要特殊的安裝參數（如果服務提供者支援的話）。</span><span class="sxs-lookup"><span data-stu-id="1189e-107">Some sessions may require special setup parameters, if supported by the service provider.</span></span> <span data-ttu-id="1189e-108">例如，ISDN TSP 可以傳輸使用者的資訊，而某些 Msp 需要媒體資料流程方向的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="1189e-108">For example, an ISDN TSP can transmit user-user information, and some MSPs require information about media stream direction.</span></span> <span data-ttu-id="1189e-109">請參閱 [會話資訊](session-information-ovr.md) ，以取得可針對會話設定或取得之資料的評論。</span><span class="sxs-lookup"><span data-stu-id="1189e-109">Please see [Session Information](session-information-ovr.md) for a review of data that may be set or obtained concerning a session.</span></span>

<span data-ttu-id="1189e-110">一旦啟動會話之後，TAPI 會使用初始化期間設定的事件通知機制，通知應用程式呼叫進度。</span><span class="sxs-lookup"><span data-stu-id="1189e-110">Once a session has been initiated, TAPI will inform the application of call progress using the event notification mechanism set up during initialization.</span></span>

<span data-ttu-id="1189e-111">**TAPI 2.x：** 應用程式會使用 [**lineMakeCall**](/windows/win32/api/tapi/nf-tapi-linemakecall) 函式來初始化會話。</span><span class="sxs-lookup"><span data-stu-id="1189e-111">**TAPI 2.x:** Applications initiate a session using the [**lineMakeCall**](/windows/win32/api/tapi/nf-tapi-linemakecall) function.</span></span> <span data-ttu-id="1189e-112">[**LineTranslateAddress**](/windows/win32/api/tapi/nf-tapi-linetranslateaddress)函式可用來執行位址轉譯（如有需要）。</span><span class="sxs-lookup"><span data-stu-id="1189e-112">The [**lineTranslateAddress**](/windows/win32/api/tapi/nf-tapi-linetranslateaddress) function is used to perform address translation, if required.</span></span>

<span data-ttu-id="1189e-113">呼叫安裝程式參數可以儲存在 [**LINECALLPARAMS**](/windows/win32/api/tapi/ns-tapi-linecallparams) 資料結構中，然後將此結構的指標當做 [**lineMakeCall**](/windows/win32/api/tapi/nf-tapi-linemakecall)的參數使用。</span><span class="sxs-lookup"><span data-stu-id="1189e-113">Call setup parameters can be stored in the [**LINECALLPARAMS**](/windows/win32/api/tapi/ns-tapi-linecallparams) data structure, and a pointer to this structure is then used as a parameter of [**lineMakeCall**](/windows/win32/api/tapi/nf-tapi-linemakecall).</span></span> <span data-ttu-id="1189e-114">如果未提供 **LINECALLPARAMS** 結構給 **lineMakeCall**，則會以一組預設值要求預設的 POTS 語音等級通話。</span><span class="sxs-lookup"><span data-stu-id="1189e-114">If no **LINECALLPARAMS** structure is supplied to **lineMakeCall**, a default POTS voice-grade call is requested with a set of default values.</span></span>

<span data-ttu-id="1189e-115">如果會話已成功設定，則會將具有擁有者 [許可權](privilege-ovr.md)的呼叫控制碼傳回給應用程式，而 TAPI 會傳送應用程式 [**行 \_ CALLSTATE**](./line-callstate.md)訊息，其中包含有關呼叫進度的資訊。</span><span class="sxs-lookup"><span data-stu-id="1189e-115">If the session is set up successfully, a call handle with *owner* [privileges](privilege-ovr.md) is returned to the application and TAPI sends the application [**LINE\_CALLSTATE**](./line-callstate.md) messages with information concerning the call's progress.</span></span> <span data-ttu-id="1189e-116">應用程式通常會使用這些訊息來顯示狀態報表給使用者。</span><span class="sxs-lookup"><span data-stu-id="1189e-116">Applications typically use these messages to display status reports to the user.</span></span>

<span data-ttu-id="1189e-117">**TAPI 3.x：** 應用程式會叫用 [**ITAddress：： CreateCall**](/windows/desktop/api/tapi3if/nf-tapi3if-itaddress-createcall) 方法，在能夠處理所需的網址類別型和媒體類型的位址上叫用通訊會話。</span><span class="sxs-lookup"><span data-stu-id="1189e-117">**TAPI 3.x:** Applications initiate a communications session by invoking the [**ITAddress::CreateCall**](/windows/desktop/api/tapi3if/nf-tapi3if-itaddress-createcall) method on an address capable of handling the address type and media type required.</span></span> <span data-ttu-id="1189e-118">如果位址公開 [**ITTerminalSupport**](/windows/win32/api/tapi3if/nn-tapi3if-itterminalsupport) 介面，則會在呼叫物件的媒體資料流程上選取終端機。</span><span class="sxs-lookup"><span data-stu-id="1189e-118">If the address exposes the [**ITTerminalSupport**](/windows/win32/api/tapi3if/nn-tapi3if-itterminalsupport) interface, terminals are selected onto the media streams of the call object.</span></span> <span data-ttu-id="1189e-119">如需此程式的圖例，請參閱「 [提出通話](make-a-call.md) 程式碼」範例。</span><span class="sxs-lookup"><span data-stu-id="1189e-119">See the [Make a Call](make-a-call.md) code example for an illustration of this process.</span></span>

<span data-ttu-id="1189e-120">呼叫安裝程式參數可以使用 [**ITCallInfo**](/windows/desktop/api/tapi3if/nn-tapi3if-itcallinfo) 介面所公開的方法來儲存或變更。</span><span class="sxs-lookup"><span data-stu-id="1189e-120">Call setup parameters can be stored or changed using methods exposed by the [**ITCallInfo**](/windows/desktop/api/tapi3if/nn-tapi3if-itcallinfo) interface.</span></span>

<span data-ttu-id="1189e-121">如果成功設定會話，TAPI 會傳回 [**ITBasicCallControl**](/windows/desktop/api/tapi3if/nn-tapi3if-itbasiccallcontrol) 介面指標，以供進一步的會話作業使用，或取得可用來取得其他會話資訊的 [**ITCallInfo**](/windows/desktop/api/tapi3if/nn-tapi3if-itcallinfo) 介面指標。</span><span class="sxs-lookup"><span data-stu-id="1189e-121">If the session is set up successfully, TAPI returns an [**ITBasicCallControl**](/windows/desktop/api/tapi3if/nn-tapi3if-itbasiccallcontrol) interface pointer that can be used for further session operations, or to obtain an [**ITCallInfo**](/windows/desktop/api/tapi3if/nn-tapi3if-itcallinfo) interface pointer that can be used to acquire additional session information.</span></span> <span data-ttu-id="1189e-122">[**ITCallStateEvent**](/windows/desktop/api/tapi3if/nn-tapi3if-itcallstateevent)介面會處理 TAPI 通話狀態事件。</span><span class="sxs-lookup"><span data-stu-id="1189e-122">The [**ITCallStateEvent**](/windows/desktop/api/tapi3if/nn-tapi3if-itcallstateevent) interface processes TAPI call state events.</span></span>

> [!Note]  
> <span data-ttu-id="1189e-123">TAPI 不應用於傳真傳輸。</span><span class="sxs-lookup"><span data-stu-id="1189e-123">TAPI should not be used for fax transmissions.</span></span> <span data-ttu-id="1189e-124">相反地，請使用可透過 MAPI 取得的函式，Microsoft 訊息中心 API。</span><span class="sxs-lookup"><span data-stu-id="1189e-124">Instead, use the functions available through MAPI, the Microsoft Messaging API.</span></span>

 

## <a name="address-translation"></a><span data-ttu-id="1189e-125">位址轉譯</span><span class="sxs-lookup"><span data-stu-id="1189e-125">Address Translation</span></span>

<span data-ttu-id="1189e-126">使用者或伺服器應用程式可能會使用與指定服務提供者的需求不相容的格式來儲存位址。</span><span class="sxs-lookup"><span data-stu-id="1189e-126">An end-user or server application may store addresses in a format that is not compatible with the needs of a given service provider.</span></span> <span data-ttu-id="1189e-127">例如，電話號碼可能會以 [標準格式](address-ovr.md)儲存在電子通訊錄中，但處理電話號碼的大部分服務提供者都需要可 [撥打的格式](address-ovr.md)。</span><span class="sxs-lookup"><span data-stu-id="1189e-127">For example, a phone number may be stored in an electronic address book in [canonical format](address-ovr.md), but most service providers that handle phone numbers require the [dialable format](address-ovr.md).</span></span>

<span data-ttu-id="1189e-128">TAPI 提供位址轉譯作業，可協助應用程式向 TSP 呈現正確的網址類別型。</span><span class="sxs-lookup"><span data-stu-id="1189e-128">TAPI supplies address translation operations that assist an application in presenting the correct address type to a TSP.</span></span> <span data-ttu-id="1189e-129">服務提供者會指定 TAPI 所支援的網址類別型，而且不需要包含任何形式的位址轉譯。</span><span class="sxs-lookup"><span data-stu-id="1189e-129">The service provider specifies to TAPI which address types it supports, and need not include any form of address translation.</span></span>

<span data-ttu-id="1189e-130">**TAPI 2.x：** 請參閱 [**lineTranslateAddress**](/windows/win32/api/tapi/nf-tapi-linetranslateaddress)。</span><span class="sxs-lookup"><span data-stu-id="1189e-130">**TAPI 2.x:** See [**lineTranslateAddress**](/windows/win32/api/tapi/nf-tapi-linetranslateaddress).</span></span>

<span data-ttu-id="1189e-131">**TAPI 3：** 請參閱 [**ITAddressTranslation**](/windows/desktop/api/tapi3if/nn-tapi3if-itaddresstranslation)、 [**ITAddressTranslationInfo**](/windows/desktop/api/tapi3if/nn-tapi3if-itaddresstranslationinfo)。</span><span class="sxs-lookup"><span data-stu-id="1189e-131">**TAPI 3:** See [**ITAddressTranslation**](/windows/desktop/api/tapi3if/nn-tapi3if-itaddresstranslation), [**ITAddressTranslationInfo**](/windows/desktop/api/tapi3if/nn-tapi3if-itaddresstranslationinfo).</span></span>

## <a name="toll-lists"></a><span data-ttu-id="1189e-132">收費清單</span><span class="sxs-lookup"><span data-stu-id="1189e-132">Toll Lists</span></span>

<span data-ttu-id="1189e-133">在北美洲的某些位置中，放到本地區域程式碼的所有電話都是本機電話。</span><span class="sxs-lookup"><span data-stu-id="1189e-133">In some locations in North America, all telephone calls placed to the local area code are local calls.</span></span> <span data-ttu-id="1189e-134">在其他位置中，放到區域程式碼的某些呼叫是很長的距離，而且需要撥出 "1" 前置詞。</span><span class="sxs-lookup"><span data-stu-id="1189e-134">In other locations, some calls placed to the local area code are long distance, and need a "1" prefix to be dialed.</span></span> <span data-ttu-id="1189e-135">位址 (前置詞的前三位數) 判斷局域程式碼中的呼叫是否為收費電話。</span><span class="sxs-lookup"><span data-stu-id="1189e-135">The first three digits of the address (the prefix) determine whether or not a call within the local area code is a toll call.</span></span>

<span data-ttu-id="1189e-136">*收費清單* 是區域程式碼中的前置詞清單，其位址必須以長途電話位址的形式撥接，並經過評估的長途電話費用。</span><span class="sxs-lookup"><span data-stu-id="1189e-136">A *toll list* is a list of prefixes in the local area code whose addresses must be dialed as long-distance addresses, and are assessed long-distance charges.</span></span>

<span data-ttu-id="1189e-137">收費清單與服務提供者或未存取電話網絡的應用程式無關。</span><span class="sxs-lookup"><span data-stu-id="1189e-137">Toll lists are not relevant to service providers, or to applications that do not access a telephone network.</span></span>

<span data-ttu-id="1189e-138">**TAPI 2.x：** 請 [](/windows/win32/api/tapi/nf-tapi-linetranslateaddress)參閱 \_ NOTINTOLLLIST 結構中的 lineTranslateAddress (LINETRANSLATERESULT INTOLLLIST 和 LINETRANSLATERESULT \_ LINETRANSLATEOUTPUT 位) ， [**lineSetTollList**](/windows/win32/api/tapi/nf-tapi-linesettolllist)。 [](/windows/win32/api/tapi/ns-tapi-linetranslateoutput)</span><span class="sxs-lookup"><span data-stu-id="1189e-138">**TAPI 2.x:** See [**lineTranslateAddress**](/windows/win32/api/tapi/nf-tapi-linetranslateaddress) (LINETRANSLATERESULT\_INTOLLLIST and LINETRANSLATERESULT\_NOTINTOLLLIST bits in the [**LINETRANSLATEOUTPUT**](/windows/win32/api/tapi/ns-tapi-linetranslateoutput) structure), [**lineSetTollList**](/windows/win32/api/tapi/nf-tapi-linesettolllist).</span></span>

<span data-ttu-id="1189e-139">**TAPI 3：** 請參閱 [**ITAddressTranslation：： TranslateAddress**](/windows/desktop/api/tapi3if/nf-tapi3if-itaddresstranslation-translateaddress)， [**ITAddressTranslationInfo：： get \_ TranslationResults**](/windows/desktop/api/tapi3if/nf-tapi3if-itaddresstranslationinfo-get_translationresults)。</span><span class="sxs-lookup"><span data-stu-id="1189e-139">**TAPI 3:** See [**ITAddressTranslation::TranslateAddress**](/windows/desktop/api/tapi3if/nf-tapi3if-itaddresstranslation-translateaddress), [**ITAddressTranslationInfo::get\_TranslationResults**](/windows/desktop/api/tapi3if/nf-tapi3if-itaddresstranslationinfo-get_translationresults).</span></span>

 

 
