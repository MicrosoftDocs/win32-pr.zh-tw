---
description: 下圖顯示電話語音服務提供者的一般架構，以及其相關聯的使用者介面動態連結程式庫 (UI Dll) 。
ms.assetid: b5efe57a-19b8-49c5-810f-180633ed50d2
title: " (電話語音 API) 的架構"
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 14423dba77af1ded38af4a6f2b896e76d28ca2cd
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "106977314"
---
# <a name="architecture-telephony-api"></a><span data-ttu-id="6db5e-103"> (電話語音 API) 的架構</span><span class="sxs-lookup"><span data-stu-id="6db5e-103">Architecture (Telephony API)</span></span>

<span data-ttu-id="6db5e-104">下圖顯示電話語音服務提供者的一般架構，以及其相關聯的使用者介面動態連結程式庫 (UI Dll) 。</span><span class="sxs-lookup"><span data-stu-id="6db5e-104">The following illustration shows the general architecture of telephony service providers and their associated user interface dynamic-link libraries (UI DLLs).</span></span>

![tsp 和相關聯的 ui dll](images/spuidl01.png)

<span data-ttu-id="6db5e-106">服務提供者至少包含兩個元件。</span><span class="sxs-lookup"><span data-stu-id="6db5e-106">The service provider consists of a minimum of two components.</span></span> <span data-ttu-id="6db5e-107">服務提供者 DLL (在圖例中指定為 MAIN。TSP) 會在 TAPISRV 流程的內容中執行，並執行服務提供者的所有工作，這些工作與特定應用程式的裝置使用方式相關聯的使用者介面元素並不相關 (最有可能的情況是結合圖) 中未顯示的較低層級元件。</span><span class="sxs-lookup"><span data-stu-id="6db5e-107">The service provider DLL (designated in the illustration as MAIN.TSP) executes in the context of the TAPISRV process, and performs all of the tasks of the service provider that are not related to user interface elements associated with a particular application's use of the device (most likely, in conjunction with lower-level components not shown in the illustration).</span></span> <span data-ttu-id="6db5e-108">但與舊版 TAPI 不同的是，使用者介面程式碼已整合到服務提供者 (並執行，因為先前的架構在應用程式) 的內容中，因此服務提供者現在必須包含可執行使用者介面元素的個別元件。</span><span class="sxs-lookup"><span data-stu-id="6db5e-108">But unlike previous versions of TAPI in which the user interface code was integrated into the service provider (and executed, because of the previous architecture, within the context of the application), the service provider must now include a separate component that implements the user interface elements.</span></span>

<span data-ttu-id="6db5e-109">當應用程式呼叫產生 UI 的 TAPI 功能時，服務提供者 UI DLL 必須匯出由 TAPI 呼叫的函式： [**TUISPI \_ lineConfigDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_lineconfigdialog)、 [**TUISPI \_ lineConfigDialogEdit**](/windows/win32/api/tspi/nf-tspi-tuispi_lineconfigdialogedit)、 [**TUISPI \_ PhoneConfigDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_phoneconfigdialog)、 [**TUISPI \_ providerConfig**](/windows/win32/api/tspi/nf-tspi-tuispi_providerconfig)、 [**TUISPI \_ providerInstall**](/windows/win32/api/tspi/nf-tspi-tuispi_providerinstall)和 [**TUISPI \_ providerRemove**](/windows/win32/api/tspi/nf-tspi-tuispi_providerremove)。</span><span class="sxs-lookup"><span data-stu-id="6db5e-109">The service provider UI DLL must export functions that are called by TAPI when the application calls TAPI functions that generate UI: [**TUISPI\_lineConfigDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_lineconfigdialog), [**TUISPI\_lineConfigDialogEdit**](/windows/win32/api/tspi/nf-tspi-tuispi_lineconfigdialogedit), [**TUISPI\_phoneConfigDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_phoneconfigdialog), [**TUISPI\_providerConfig**](/windows/win32/api/tspi/nf-tspi-tuispi_providerconfig), [**TUISPI\_providerInstall**](/windows/win32/api/tspi/nf-tspi-tuispi_providerinstall), and [**TUISPI\_providerRemove**](/windows/win32/api/tspi/nf-tspi-tuispi_providerremove).</span></span> <span data-ttu-id="6db5e-110">這些函式中的每一個都是以參數的形式包含在 TAPI 的回呼函式的指標，其型別為 [**TUISPIDLLCALLBACK**](/windows/win32/api/tspi/nc-tspi-tuispidllcallback)，UI DLL 可用來傳達雙向 (傳送和接收資料) ，以及在 TAPISRV 進程中執行的服務提供者 DLL。</span><span class="sxs-lookup"><span data-stu-id="6db5e-110">Each of these functions includes as a parameter a pointer to a callback function in TAPI, of type [**TUISPIDLLCALLBACK**](/windows/win32/api/tspi/nc-tspi-tuispidllcallback), which the UI DLL can use to communicate bidirectionally (both send and receive data) with the service provider DLL executing in the TAPISRV process.</span></span> <span data-ttu-id="6db5e-111">如果服務提供者曾產生自發的 UI （例如 [Unimodem **交談/掛斷** ] 對話方塊），並搭配任何不需要 UI 的 TSPI 函式 (例如，任何沒有 *hwnd* 參數) 的函式，則 UI DLL 必須匯出 [**TUISPI \_ providerGenericDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialog) 和 [**TUISPI \_ providerGenericDialogData**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialogdata)。</span><span class="sxs-lookup"><span data-stu-id="6db5e-111">If the service provider ever generates spontaneous UI, such as the Unimodem **Talk/Hangup** dialog box, in conjunction with any TSPI function for which UI is not expected (for example, any function that does not have an *hwnd* parameter), then the UI DLL must export [**TUISPI\_providerGenericDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialog) and [**TUISPI\_providerGenericDialogData**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialogdata).</span></span>

> [!Note]  
> <span data-ttu-id="6db5e-112">原始 TSPI UI 產生的函式 ( [**TSPI \_ lineConfigDialog**](/windows/win32/api/tspi/nf-tspi-tspi_lineconfigdialog)、 [**TSPI \_ lineConfigDialogEdit**](/windows/win32/api/tspi/nf-tspi-tspi_lineconfigdialogedit)、 [**TSPI \_ PhoneConfigDialog**](/windows/win32/api/tspi/nf-tspi-tspi_phoneconfigdialog)、 [**TSPI \_ providerConfig**](/windows/win32/api/tspi/nf-tspi-tspi_providerconfig)、 [**TSPI \_ providerInstall**](/windows/win32/api/tspi/nf-tspi-tspi_providerinstall)和 [**TSPI providerRemove \_**](/windows/win32/api/tspi/nf-tspi-tspi_providerremove)) 已淘汰，且不會被 TAPI 呼叫。</span><span class="sxs-lookup"><span data-stu-id="6db5e-112">The original TSPI UI-generating functions ( [**TSPI\_lineConfigDialog**](/windows/win32/api/tspi/nf-tspi-tspi_lineconfigdialog), [**TSPI\_lineConfigDialogEdit**](/windows/win32/api/tspi/nf-tspi-tspi_lineconfigdialogedit), [**TSPI\_phoneConfigDialog**](/windows/win32/api/tspi/nf-tspi-tspi_phoneconfigdialog), [**TSPI\_providerConfig**](/windows/win32/api/tspi/nf-tspi-tspi_providerconfig), [**TSPI\_providerInstall**](/windows/win32/api/tspi/nf-tspi-tspi_providerinstall), and [**TSPI\_providerRemove**](/windows/win32/api/tspi/nf-tspi-tspi_providerremove)) are obsolete and never called by TAPI.</span></span> <span data-ttu-id="6db5e-113">因此，服務提供者 DLL 不需要匯出這些參數。</span><span class="sxs-lookup"><span data-stu-id="6db5e-113">Therefore, these are not required to be exported by the service provider DLL.</span></span> <span data-ttu-id="6db5e-114">但是，如果服務提供者想要列為可由電話語音主控台新增的服務提供者，Windows 電話在1.4 版和更舊版本中提供的公用程式，必須匯出 **TSPI \_ providerInstall**; 如果它想要在電話語音主控台中啟用 [ [**移除**](/windows/win32/api/tapi3if/nn-tapi3if-itcollection2) ] 按鈕，則必須匯出 **TSPI \_ ProviderRemove**; 如果它想要在電話語音主控台中啟用 [ **安裝** ] 按鈕，則必須匯出 **TSPI \_ providerConfig**。</span><span class="sxs-lookup"><span data-stu-id="6db5e-114">However, if the service provider wants to be listed as one that can be added by the Telephony Control Panel, a utility supplied with Windows Telephony in versions 1.4 and earlier, it must export **TSPI\_providerInstall**; if it wants to have the [**Remove**](/windows/win32/api/tapi3if/nn-tapi3if-itcollection2) button enabled in the Telephony Control Panel when it is selected, it must export **TSPI\_providerRemove**; and if it wants the **Setup** button to be enabled in the Telephony Control Panel when it is selected, it must export **TSPI\_providerConfig**.</span></span> <span data-ttu-id="6db5e-115">電話語音主控台會檢查服務提供者 TSP 檔案中是否有這些函式，以調整其使用者介面，以反映可執行檔作業。</span><span class="sxs-lookup"><span data-stu-id="6db5e-115">The Telephony Control Panel checks for the presence of these functions in the service provider TSP file to adjust its user interface to reflect which operations can be performed.</span></span>

 

<span data-ttu-id="6db5e-116">服務提供者 DLL 必須匯出 TAPISRV 進程使用的 [**TSPI \_ providerUIIdentify**](/windows/win32/api/tspi/nf-tspi-tspi_provideruiidentify) 函式，以取得要在應用程式進程中載入的 UI DLL 名稱。</span><span class="sxs-lookup"><span data-stu-id="6db5e-116">The service provider DLL must export the [**TSPI\_providerUIIdentify**](/windows/win32/api/tspi/nf-tspi-tspi_provideruiidentify) function that TAPISRV process uses to obtain the name of the UI DLL to load in the application process.</span></span> <span data-ttu-id="6db5e-117">它必須匯出 [**TSPI \_ providerGenericDialogData**](/windows/win32/api/tspi/nf-tspi-tspi_providergenericdialogdata) 函式，以接收和回應 UI DLL 中要顯示的要求，而且它必須匯出 [**TSPI \_ providerFreeDialogInstance**](/windows/win32/api/tspi/nf-tspi-tspi_providerfreedialoginstance) for TAPISRV 進程，以告知服務提供者何時釋放為了產生自發 ui 而建立的關聯，以搭配未定義為向使用者呈現 UI 的函式。</span><span class="sxs-lookup"><span data-stu-id="6db5e-117">It must export the [**TSPI\_providerGenericDialogData**](/windows/win32/api/tspi/nf-tspi-tspi_providergenericdialogdata) function to receive and respond to requests from the UI DLL for data to display, and it must export [**TSPI\_providerFreeDialogInstance**](/windows/win32/api/tspi/nf-tspi-tspi_providerfreedialoginstance) for TAPISRV process to tell the service provider when to release an association established for the purpose of generating spontaneous UI in conjunction with a function that is not defined as presenting UI to the user.</span></span> <span data-ttu-id="6db5e-118">服務提供者 DLL 可以使用新的 TSPI 消息 [**行 \_ SENDDIALOGINSTANCEDATA**](line-senddialoginstancedata.md)，unidirectionally 傳送資料至 UI DLL。</span><span class="sxs-lookup"><span data-stu-id="6db5e-118">The service provider DLL can unidirectionally send data to the UI DLL by using the new TSPI message [**LINE\_SENDDIALOGINSTANCEDATA**](line-senddialoginstancedata.md).</span></span>

<span data-ttu-id="6db5e-119">因為 TSPI 和 TUISPI 函式的名稱刻意定義為不同，所以服務提供者 DLL 和 UI DLL 可以是相同的 DLL 檔案（如有需要）。</span><span class="sxs-lookup"><span data-stu-id="6db5e-119">Because the names of the TSPI and TUISPI functions are intentionally defined to be different, the service provider DLL and the UI DLL can be the same DLL file, if desired.</span></span> <span data-ttu-id="6db5e-120">在適當分割的情況下，這不一定會導致應用程式內容中不必要的記憶體使用量，而且可以簡化目前可在單一 DLL 中執行之服務提供者的安裝程式。</span><span class="sxs-lookup"><span data-stu-id="6db5e-120">With proper segmentation, this does not necessarily result in any unnecessary usage of memory in the application context, and can simplify the installation process for service providers that can currently be implemented in a single DLL.</span></span> <span data-ttu-id="6db5e-121">TAPI 只會呼叫使用 DLL 之內容適用的函式。</span><span class="sxs-lookup"><span data-stu-id="6db5e-121">TAPI calls only the functions that are appropriate for the context in which the DLL is being used.</span></span>

<span data-ttu-id="6db5e-122">電話語音服務提供者和 UI DLL 都必須設計成必須記住，UI 函數可以同時從多個應用程式進程叫用。</span><span class="sxs-lookup"><span data-stu-id="6db5e-122">The telephony service provider and the UI DLL must both be designed with the requirement in mind that the UI functions can be invoked from multiple application processes simultaneously.</span></span> <span data-ttu-id="6db5e-123">他們也必須考慮到執行電話語音服務提供者的應用程式和 TAPI 服務可以位於 LAN 的不同電腦上。</span><span class="sxs-lookup"><span data-stu-id="6db5e-123">They must also consider that the application and the TAPI service under which the telephony service provider is executing can be on separate computers on a LAN.</span></span>

 

 
