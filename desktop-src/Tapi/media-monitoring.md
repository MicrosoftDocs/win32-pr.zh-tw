---
description: 當呼叫處於連接狀態時，可以透過呼叫來傳輸資料。 呼叫媒體類型會指出資料類型 (例如，其資料類型或此媒體資料流程的較高層級通訊協定) 。
ms.assetid: 3281387e-3f72-4fda-8199-b3ce6e45e910
title: 媒體監視
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: fb54989306fd80c48c0b99c9f8285a83b40bed25
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/03/2021
ms.locfileid: "106985813"
---
# <a name="media-monitoring"></a><span data-ttu-id="469fb-104">媒體監視</span><span class="sxs-lookup"><span data-stu-id="469fb-104">Media Monitoring</span></span>

<span data-ttu-id="469fb-105">當呼叫處於 *連接* 狀態時，可以透過呼叫來傳輸資料。</span><span class="sxs-lookup"><span data-stu-id="469fb-105">When a call is in the *connected* state, data can be transported over the call.</span></span> <span data-ttu-id="469fb-106">呼叫媒體類型會指出資料類型 (例如，其資料類型或此媒體資料流程的較高層級通訊協定) 。</span><span class="sxs-lookup"><span data-stu-id="469fb-106">The call media type provides an indication of the type of data (for example, its datatype, or higher-level protocol) of this media stream.</span></span>

<span data-ttu-id="469fb-107">TAPI 可讓應用程式提供有關通話媒體類型變更的通知。</span><span class="sxs-lookup"><span data-stu-id="469fb-107">TAPI allows applications to be provided with a notification about changes in a call's media type.</span></span> <span data-ttu-id="469fb-108">通知會提供呼叫的新媒體類型的指示。</span><span class="sxs-lookup"><span data-stu-id="469fb-108">The notification provides an indication of the call's new media type.</span></span> <span data-ttu-id="469fb-109">服務提供者會決定它要如何進行這項判斷。</span><span class="sxs-lookup"><span data-stu-id="469fb-109">The service provider decides how it wants to make this determination.</span></span> <span data-ttu-id="469fb-110">例如，服務提供者可以使用媒體資料流程的信號處理來決定媒體類型，也可以依賴指派給不同媒體串流的特殊響鈴模式，或是在頻外信號通訊協定中傳遞的資訊元素上。</span><span class="sxs-lookup"><span data-stu-id="469fb-110">For example, the service provider could use signal processing of the media stream to determine the media type, or it could rely on distinctive ringing patterns assigned to different media streams, or on information elements passed in an out-of-band signaling protocol.</span></span> <span data-ttu-id="469fb-111">與媒體類型判斷的達成方式無關，應用程式只會收到關於現有呼叫的媒體類型變更。</span><span class="sxs-lookup"><span data-stu-id="469fb-111">Independent of how the media type determination is achieved, the application is simply informed about media type changes on an existing call.</span></span>

<span data-ttu-id="469fb-112">如需詳細資訊以及目前定義之 TAPI 媒體類型或模式的清單，請參閱 [LINEMEDIAMODE \_ 常數](linemediamode--constants.md)。</span><span class="sxs-lookup"><span data-stu-id="469fb-112">For more information and a list of currently defined TAPI media types or modes, see [LINEMEDIAMODE\_ Constants](linemediamode--constants.md).</span></span> <span data-ttu-id="469fb-113">服務提供者可能會針對高度特製化的裝置，執行提供者特定的媒體類型。</span><span class="sxs-lookup"><span data-stu-id="469fb-113">Service providers may implement provider-specific media types for highly specialized devices.</span></span> <span data-ttu-id="469fb-114">這些資訊會在裝置檔中找到。</span><span class="sxs-lookup"><span data-stu-id="469fb-114">Information on these will be found in device documentation.</span></span>

<span data-ttu-id="469fb-115">TAPI 定義的媒體類型包括：</span><span class="sxs-lookup"><span data-stu-id="469fb-115">The media types defined by TAPI include:</span></span>

-   <span data-ttu-id="469fb-116">不明。</span><span class="sxs-lookup"><span data-stu-id="469fb-116">Unknown.</span></span> <span data-ttu-id="469fb-117">呼叫的媒體類型目前不是已知的，此呼叫不會分類。</span><span class="sxs-lookup"><span data-stu-id="469fb-117">The media type of the call is not currently known—the call is unclassified.</span></span>
-   <span data-ttu-id="469fb-118">互動式語音。</span><span class="sxs-lookup"><span data-stu-id="469fb-118">Interactive voice.</span></span> <span data-ttu-id="469fb-119">在通話上偵測到語音能源，並以應用程式端的人的互動語音通話來處理通話。</span><span class="sxs-lookup"><span data-stu-id="469fb-119">Voice energy was detected on the call, and the call is handled as an interactive voice call with a person at the application's end.</span></span>
-   <span data-ttu-id="469fb-120">自動語音。</span><span class="sxs-lookup"><span data-stu-id="469fb-120">Automated voice.</span></span> <span data-ttu-id="469fb-121">在通話中偵測到語音能源，呼叫會以語音通話的方式處理，但不會有任何人在應用程式結束時，例如透過回應機器應用程式。</span><span class="sxs-lookup"><span data-stu-id="469fb-121">Voice energy was detected on the call, and the call is handled as a voice call but with no person at the application's end, such as with an answering machine application.</span></span>
-   <span data-ttu-id="469fb-122">資料數據機。</span><span class="sxs-lookup"><span data-stu-id="469fb-122">Data modem.</span></span> <span data-ttu-id="469fb-123">呼叫上的數據機會話。</span><span class="sxs-lookup"><span data-stu-id="469fb-123">A modem session on the call.</span></span> <span data-ttu-id="469fb-124">目前的數據機通訊協定需要被呼叫的工作站起始交握。</span><span class="sxs-lookup"><span data-stu-id="469fb-124">Current modem protocols require the called station to initiate the handshake.</span></span> <span data-ttu-id="469fb-125">針對傳入的資料數據機呼叫，應用程式通常不會進行正面的偵測。</span><span class="sxs-lookup"><span data-stu-id="469fb-125">For an incoming data modem call, the application can typically make no positive detection.</span></span> <span data-ttu-id="469fb-126">服務提供者如何做出這項決定。</span><span class="sxs-lookup"><span data-stu-id="469fb-126">How the service provider makes this determination is its choice.</span></span> <span data-ttu-id="469fb-127">例如，在接聽撥入電話之後的一段時間，就可以用來做為判斷這可能是資料數據機呼叫的啟發式。</span><span class="sxs-lookup"><span data-stu-id="469fb-127">For example, a period of silence just after answering an incoming call can be used as a heuristic to decide that this might be a data modem call.</span></span>
-   <span data-ttu-id="469fb-128">G3 傳真。</span><span class="sxs-lookup"><span data-stu-id="469fb-128">G3 fax.</span></span> <span data-ttu-id="469fb-129">通話上的群組3傳真會話。</span><span class="sxs-lookup"><span data-stu-id="469fb-129">A group 3 fax session on the call.</span></span>
-   <span data-ttu-id="469fb-130">4代傳真。</span><span class="sxs-lookup"><span data-stu-id="469fb-130">G4 fax.</span></span> <span data-ttu-id="469fb-131">通話上的群組4傳真會話。</span><span class="sxs-lookup"><span data-stu-id="469fb-131">A group 4 fax session on the call.</span></span>
-   <span data-ttu-id="469fb-132">Tdd。</span><span class="sxs-lookup"><span data-stu-id="469fb-132">TDD.</span></span> <span data-ttu-id="469fb-133">通話的媒體串流會針對失聰通訊協定使用電話語音裝置。</span><span class="sxs-lookup"><span data-stu-id="469fb-133">The call's media stream uses the Telephony Devices for the Deaf protocol.</span></span>
-   <span data-ttu-id="469fb-134">數位資料。</span><span class="sxs-lookup"><span data-stu-id="469fb-134">Digital data.</span></span> <span data-ttu-id="469fb-135">未指定格式的數位資料流程。</span><span class="sxs-lookup"><span data-stu-id="469fb-135">A digital data stream of unspecified format.</span></span>
-   <span data-ttu-id="469fb-136">Teletex、Videotex、電傳、Mixed。</span><span class="sxs-lookup"><span data-stu-id="469fb-136">Teletex, Videotex, Telex, Mixed.</span></span> <span data-ttu-id="469fb-137">這些會對應至相同名稱的 telematic 服務。</span><span class="sxs-lookup"><span data-stu-id="469fb-137">These correspond to the telematic services of the same names.</span></span>
-   <span data-ttu-id="469fb-138">編輯器.</span><span class="sxs-lookup"><span data-stu-id="469fb-138">ADSI.</span></span> <span data-ttu-id="469fb-139">呼叫上的類比顯示服務介面會話。</span><span class="sxs-lookup"><span data-stu-id="469fb-139">An Analog Display Services Interface session on the call.</span></span> <span data-ttu-id="469fb-140">ADSI 會使用下載至手機的英數位元資訊，以及在手機上使用軟按鈕的方式來增強語音通話。</span><span class="sxs-lookup"><span data-stu-id="469fb-140">ADSI enhances voice calls with alphanumeric information downloaded to the phone and the use of soft buttons on the phone.</span></span>

<span data-ttu-id="469fb-141">應用程式可以使用 [**lineMonitorMedia**](/windows/desktop/api/Tapi/nf-tapi-linemonitormedia)來啟用或停用指定之呼叫的媒體監視。</span><span class="sxs-lookup"><span data-stu-id="469fb-141">An application can enable or disable media monitoring on a specified call with [**lineMonitorMedia**](/windows/desktop/api/Tapi/nf-tapi-linemonitormedia).</span></span> <span data-ttu-id="469fb-142">應用程式會指定其有興趣監視的媒體類型，以及啟用媒體監視時，媒體類型變更的偵測會導致應用程式收到 [**行 \_ MONITORMEDIA**](line-monitormedia.md) 訊息的通知。</span><span class="sxs-lookup"><span data-stu-id="469fb-142">The application specifies which media types it is interested in monitoring, and when media monitoring is enabled, the detection of a media type change causes the application to be notified with the [**LINE\_MONITORMEDIA**](line-monitormedia.md) message.</span></span> <span data-ttu-id="469fb-143">此訊息提供偵測到媒體類型變更的呼叫控制碼，以及新的媒體類型。</span><span class="sxs-lookup"><span data-stu-id="469fb-143">This message provides the call handle on which the media type change was detected as well as the new media type.</span></span>

<span data-ttu-id="469fb-144">[**LineGetCallInfo**](/windows/desktop/api/Tapi/nf-tapi-linegetcallinfo)所報告之通話的媒體類型與媒體類型附隨報告是依行 \_ MONITORMEDIA 訊息來區分。</span><span class="sxs-lookup"><span data-stu-id="469fb-144">There is a distinction between the media type of a call as reported by [**lineGetCallInfo**](/windows/desktop/api/Tapi/nf-tapi-linegetcallinfo) and the media type event reports by LINE\_MONITORMEDIA messages.</span></span> <span data-ttu-id="469fb-145">呼叫的媒體類型是由呼叫的擁有者應用程式專用的，且不會由媒體監視事件自動變更。</span><span class="sxs-lookup"><span data-stu-id="469fb-145">A call's media type is determined exclusively by owner applications of the call and is not automatically changed by media monitoring events.</span></span> <span data-ttu-id="469fb-146">唯一的例外是可由 TAPI 動態連結程式庫執行的初始媒體類型判斷，以選取第一個呼叫的擁有者。</span><span class="sxs-lookup"><span data-stu-id="469fb-146">The one exception is the initial media type determination that can be performed by the TAPI dynamic-link library to select the first owner of a call.</span></span> <span data-ttu-id="469fb-147">在此情況下，您可能會認為程式庫是呼叫的擁有者。</span><span class="sxs-lookup"><span data-stu-id="469fb-147">One could argue that in this case, the library is the owner of the call.</span></span>

<span data-ttu-id="469fb-148">針對已開啟線路裝置的媒體類型，會執行預設媒體類型監視。</span><span class="sxs-lookup"><span data-stu-id="469fb-148">Default media type monitoring is performed for the media types for which the line device has been opened.</span></span> <span data-ttu-id="469fb-149">這可在根據應用程式所要求的內容將呼叫遞交給應用程式之前，先判斷撥入電話的媒體類型。</span><span class="sxs-lookup"><span data-stu-id="469fb-149">This allows an incoming call's media type to be determined before the call is handed to an application based on what the application demands.</span></span> <span data-ttu-id="469fb-150">呼叫的媒體監視範圍是由呼叫的存留期所系結。</span><span class="sxs-lookup"><span data-stu-id="469fb-150">The scope of the media monitoring of a call is bound by the lifetime of the call.</span></span> <span data-ttu-id="469fb-151">呼叫 *中斷* 連線或 *閒置* 時，呼叫上的媒體監視就會結束。</span><span class="sxs-lookup"><span data-stu-id="469fb-151">Media monitoring on a call ends as soon as the call *disconnects* or goes *idle*.</span></span>

<span data-ttu-id="469fb-152">應用程式可以藉由呼叫 [**lineGetID**](/windows/desktop/api/Tapi/nf-tapi-linegetid)，取得與已開啟行相關聯之各種裝置類別的裝置識別碼。</span><span class="sxs-lookup"><span data-stu-id="469fb-152">An application can obtain device identifiers for various device classes associated with an opened line by calling [**lineGetID**](/windows/desktop/api/Tapi/nf-tapi-linegetid).</span></span> <span data-ttu-id="469fb-153">此函式會採用行控制碼、位址或呼叫控制碼和裝置類別描述。</span><span class="sxs-lookup"><span data-stu-id="469fb-153">This function takes a line handle, address, or call handle and a device class description.</span></span> <span data-ttu-id="469fb-154">它會傳回與開放線路裝置、位址或呼叫相關聯之指定裝置類別之裝置的裝置識別碼。</span><span class="sxs-lookup"><span data-stu-id="469fb-154">It returns the device identifier for the device of the given device class that is associated with the open line device, address, or call.</span></span> <span data-ttu-id="469fb-155">如果裝置類別是「tapi/線路」，則會傳回線路裝置的裝置識別碼。</span><span class="sxs-lookup"><span data-stu-id="469fb-155">If the device class is "tapi/line," then the device identifier of the line device is returned.</span></span> <span data-ttu-id="469fb-156">如果裝置類別為「mci/wave」，則會在支援的)  (傳回 mci waveaudio 裝置的裝置識別碼，以允許錄製或播放音訊的程式列上的電話。</span><span class="sxs-lookup"><span data-stu-id="469fb-156">If the device class is "mci/wave," then the device identifier of an mci waveaudio device is returned (if supported), which allows activities such as the recording or playback of audio over the call on the line.</span></span>

<span data-ttu-id="469fb-157">應用程式可以使用傳回的裝置識別碼搭配對應的媒體 API 來查詢裝置的功能，並隨後開啟媒體裝置。</span><span class="sxs-lookup"><span data-stu-id="469fb-157">The application can use the returned device identifier with the corresponding media API to query the device's capabilities and subsequently open the media device.</span></span> <span data-ttu-id="469fb-158">例如，如果您的應用程式需要使用這一行做為波形裝置，則必須先呼叫 [**waveInGetDevCaps**](/windows/win32/api/mmeapi/nf-mmeapi-waveingetdevcaps) 和/或 [**waveOutGetDevCaps**](/windows/win32/api/mmeapi/nf-mmeapi-waveoutgetdevcaps) 來判斷裝置的波形功能。</span><span class="sxs-lookup"><span data-stu-id="469fb-158">For example, if your application needs to use the line as a waveform device, it must first call [**waveInGetDevCaps**](/windows/win32/api/mmeapi/nf-mmeapi-waveingetdevcaps) and/or [**waveOutGetDevCaps**](/windows/win32/api/mmeapi/nf-mmeapi-waveoutgetdevcaps) to determine the waveform capabilities of the device.</span></span> <span data-ttu-id="469fb-159">北美洲中的電話語音所支援的一般波形資料格式為8位 m-每秒8000個樣本的定律，不過 wave 設備磁碟機可以將此取樣率和 companding 轉換成其他更常見的多媒體音訊格式。</span><span class="sxs-lookup"><span data-stu-id="469fb-159">The typical waveform data format supported by telephony in North America is 8-bit m-law at 8000 samples per second, although the wave device driver can convert this sample rate and companding to other more common multimedia audio formats.</span></span>

<span data-ttu-id="469fb-160">若要接著使用波形 API 來開啟音訊播放的線路裝置，應用程式會呼叫 [**waveOutOpen**](/windows/win32/api/mmeapi/nf-mmeapi-waveoutopen)。</span><span class="sxs-lookup"><span data-stu-id="469fb-160">To subsequently open a line device for audio playback using the waveform API, an application calls [**waveOutOpen**](/windows/win32/api/mmeapi/nf-mmeapi-waveoutopen).</span></span> <span data-ttu-id="469fb-161">**WaveOutOpen** 的執行是裝置專屬的，而且有各種不同的選項可供您用來執行此功能。</span><span class="sxs-lookup"><span data-stu-id="469fb-161">The implementation of **waveOutOpen** is device specific, and there are a variety of options for implementing this function.</span></span>

 

 
