---
description: 經過一段時間後，TAPI、應用程式和服務提供者的線路或電話可能會有不同的版本。
ms.assetid: 36a17ae8-31db-4db9-a401-097d47aa26ad
title: TAPI 版本協商
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f41f4ca6f12862d6fc19f982c48b90bdafe2aaa2
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "106978053"
---
# <a name="tapi-version-negotiation"></a><span data-ttu-id="9d9f7-103">TAPI 版本協商</span><span class="sxs-lookup"><span data-stu-id="9d9f7-103">TAPI Version Negotiation</span></span>

<span data-ttu-id="9d9f7-104">經過一段時間後，TAPI、應用程式和服務提供者的線路或電話可能會有不同的版本。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-104">Over time, different versions may exist for TAPI, applications, and service providers for a line or phone.</span></span> <span data-ttu-id="9d9f7-105">新版本可能會定義新功能、資料結構的新欄位等等。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-105">New versions may define new features, new fields to data structures, and so on.</span></span> <span data-ttu-id="9d9f7-106">因此，版本號碼會指出如何解讀不同的資料結構。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-106">Version numbers therefore indicate how to interpret various data structures.</span></span>

<span data-ttu-id="9d9f7-107">為了讓不同的應用程式版本、TAPI 本身的版本，以及不同廠商的服務提供者版本達到最佳互通性，TAPI 為應用程式提供簡單、雙步驟的版本協商機制。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-107">To allow optimal interoperability of different versions of applications, versions of TAPI itself, and versions of service providers by different vendors, TAPI provides a simple, two-step version negotiation mechanism for applications.</span></span> <span data-ttu-id="9d9f7-108">每個線路裝置的應用程式、TAPI 和服務提供者必須同意兩個不同的版本。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-108">Two different versions must be agreed on by the application, TAPI, and the service provider for each line device.</span></span> <span data-ttu-id="9d9f7-109">第一個是「基本」和「補充電話語音」的版本號碼，稱為「API 版本」。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-109">The first is the version number for Basic and Supplementary Telephony and is referred to as the API version.</span></span> <span data-ttu-id="9d9f7-110">另一個則適用于提供者專屬的延伸模組（如果有的話），而且稱為延伸模組版本。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-110">The other is for provider-specific extensions, if any, and is referred to as the extension version.</span></span> <span data-ttu-id="9d9f7-111">TAPI 的基本和增補功能所使用的資料結構和資料類型的格式是由 API 版本所定義，而延伸模組版本則決定由廠商專屬的延伸模組所定義的資料結構格式。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-111">The format of the data structures and datatypes used by TAPI's basic and supplementary features is defined by the API version, while the extension version determines the format of the data structures defined by the vendor-specific extensions.</span></span>

<span data-ttu-id="9d9f7-112">版本協商會在兩個階段中繼續進行。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-112">Version negotiation proceeds in two phases.</span></span> <span data-ttu-id="9d9f7-113">在第一個階段中，會協商 API 版本號碼，並取得與裝置上支援之任何廠商專屬延伸模組相關聯的延伸模組識別碼。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-113">In the first phase, the API version number is negotiated and the extension identifier associated with any vendor-specific extensions supported on the device is obtained.</span></span> <span data-ttu-id="9d9f7-114">在第二個階段中，會協商延伸模組版本。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-114">In the second phase, the extension version is negotiated.</span></span> <span data-ttu-id="9d9f7-115">如果應用程式未使用任何 API 擴充功能，則會略過第二個階段，且服務提供者不會啟用延伸模組。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-115">If the application does not use any API extensions, it skips the second phase and extensions are not activated by the service provider.</span></span> <span data-ttu-id="9d9f7-116">如果應用程式想要使用擴充功能，但應用程式無法辨識擴充功能識別碼 (的服務提供者延伸模組) ，則應用程式也應該略過延伸模組版本的協商。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-116">If the application does want to use extensions, but the service provider's extensions (the extension identifier) are not recognized by the application, the application should skip the negotiation for extension version as well.</span></span> <span data-ttu-id="9d9f7-117">每個廠商都有自己的一組合法 (可辨識的每一組延伸模組規格的) 版本。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-117">Each vendor has its own set of legal (recognized) versions for each set of extension specifications it distributes.</span></span>

<span data-ttu-id="9d9f7-118">[**LineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion)函式是用來協調要使用的 API 版本號碼。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-118">The [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion) function is used to negotiate the API version number to use.</span></span> <span data-ttu-id="9d9f7-119">它也會抓取線路裝置所支援的延伸模組識別碼，如果沒有支援延伸模組，則會傳回零。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-119">It also retrieves the extension identifier supported by the line device, returning zeros if no extensions are supported.</span></span> <span data-ttu-id="9d9f7-120">透過此函式呼叫，應用程式會提供與相容的 API 版本範圍。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-120">With this function call, the application provides the API version range it is compatible with.</span></span> <span data-ttu-id="9d9f7-121">TAPI 接著會與該行的服務提供者協調，以判斷它支援的 API 版本範圍。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-121">TAPI in turn negotiates with the line's service provider to determine which API version range it supports.</span></span> <span data-ttu-id="9d9f7-122">接下來，TAPI 會選取版本號碼 (通常（但不一定）在應用程式、DLL 和服務提供者所提供的重迭版本範圍中) 最高版本號碼。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-122">TAPI next selects a version number (typically, although not necessarily, the highest version number) in the overlapping version range that the application, the DLL, and the service provider have supplied.</span></span> <span data-ttu-id="9d9f7-123">此數位會傳回至應用程式，以及定義該行服務提供者所提供之延伸模組的延伸模組識別碼。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-123">This number is returned to the application, along with the extension identifier that defines the extensions available from that line's service provider.</span></span>

<span data-ttu-id="9d9f7-124">如果應用程式想要使用由傳回的延伸模組識別碼定義的延伸模組，則必須先呼叫 [**lineNegotiateExtVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateextversion) 來協商延伸模組版本。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-124">If the application wants to use the extensions defined by the returned extension identifier, it must first call [**lineNegotiateExtVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateextversion) to negotiate the extension version.</span></span> <span data-ttu-id="9d9f7-125">在類似的協商階段中，應用程式會指定已同意的 API 版本，以及其支援的延伸模組版本範圍。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-125">In a similar negotiation phase, the application specifies the already agreed-upon API version and the extension version range it supports.</span></span> <span data-ttu-id="9d9f7-126">TAPI 會將此資訊傳遞給該行的服務提供者。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-126">TAPI passes this information to the service provider for the line.</span></span> <span data-ttu-id="9d9f7-127">服務提供者會針對其本身檢查 API 版本和延伸模組版本範圍，並選取適當的延伸模組版本號碼（如果有的話）。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-127">The service provider checks the API version and the extension version range against its own, and selects the appropriate extension version number, if one exists.</span></span>

<span data-ttu-id="9d9f7-128">當應用程式稍後呼叫 [**lineGetDevCaps**](/windows/desktop/api/Tapi/nf-tapi-linegetdevcaps)時，它會針對對應至版本協商結果的行，傳回一組裝置功能。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-128">When the application later calls [**lineGetDevCaps**](/windows/desktop/api/Tapi/nf-tapi-linegetdevcaps), it returns a set of device capabilities for the line that correspond to the results of version negotiation.</span></span> <span data-ttu-id="9d9f7-129">這些功能包括與 API 版本一致的行裝置功能，以及與延伸模組版本一致的行裝置特定功能。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-129">These include the line's device capabilities consistent with the API version and the line's device-specific capabilities consistent with the extension version.</span></span> <span data-ttu-id="9d9f7-130">應用程式在開啟一行時，必須同時指定這兩個版本號碼。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-130">The application must specify both of these version numbers when it opens a line.</span></span> <span data-ttu-id="9d9f7-131">在該時間點，應用程式、DLL 和服務提供者會使用同意的版本進行認可。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-131">At that point, the application, the DLL, and the service provider are committed to using the agreed-upon versions.</span></span> <span data-ttu-id="9d9f7-132">如果不使用裝置專屬的延伸模組，則應該將擴充功能版本指定為零。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-132">If device-specific extensions are not to be used, the extension version should be specified as zero.</span></span>

<span data-ttu-id="9d9f7-133">在多個應用程式開啟相同線路裝置的環境中，開啟線路裝置的第一個應用程式會針對想要使用該行 (服務提供者不支援多個版本的未來應用程式，選取版本 ) 。同樣地，開啟多行裝置的應用程式可能會發現，在相同的 API 版本號碼下，能更輕鬆地操作所有線路裝置。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-133">In an environment where multiple applications open the same line device, the first application to open the line device selects the versions for all future applications that want to use the line (service providers do not support multiple versions simultaneously.) Similarly, an application that opens multiple line devices may find it easier to operate all line devices under the same API version number.</span></span>

<span data-ttu-id="9d9f7-134">採用 *dwAPIVersion* 或類似參數的每個函式都必須將此參數設定為應用程式所支援的最高 api 版本，或在特定裝置上使用 [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion) 或 [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion) 函式進行協商的 api 版本。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-134">Every function that takes a *dwAPIVersion* or similar parameter must set this parameter to either the highest API version supported by the application or the API version negotiated using the [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion) or [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion) function on a particular device.</span></span> <span data-ttu-id="9d9f7-135">使用下表做為指南：</span><span class="sxs-lookup"><span data-stu-id="9d9f7-135">Use the following table as a guide:</span></span>



| <span data-ttu-id="9d9f7-136">函式</span><span class="sxs-lookup"><span data-stu-id="9d9f7-136">Function</span></span>                                                     | <span data-ttu-id="9d9f7-137">意義</span><span class="sxs-lookup"><span data-stu-id="9d9f7-137">Meaning</span></span>                                                                               |
|--------------------------------------------------------------|---------------------------------------------------------------------------------------|
| [<span data-ttu-id="9d9f7-138">**lineGetAddressCaps**</span><span class="sxs-lookup"><span data-stu-id="9d9f7-138">**lineGetAddressCaps**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linegetaddresscaps)             | <span data-ttu-id="9d9f7-139">使用 [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion)所傳回的版本。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-139">Use version returned by [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span></span>   |
| [<span data-ttu-id="9d9f7-140">**lineGetCountry**</span><span class="sxs-lookup"><span data-stu-id="9d9f7-140">**lineGetCountry**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linegetcountry)                     | <span data-ttu-id="9d9f7-141">使用應用程式所支援的最高版本。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-141">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="9d9f7-142">**lineGetDevCaps**</span><span class="sxs-lookup"><span data-stu-id="9d9f7-142">**lineGetDevCaps**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linegetdevcaps)                     | <span data-ttu-id="9d9f7-143">使用 [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion)所傳回的版本。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-143">Use version returned by [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span></span>   |
| [<span data-ttu-id="9d9f7-144">**lineGetProviderList**</span><span class="sxs-lookup"><span data-stu-id="9d9f7-144">**lineGetProviderList**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linegetproviderlist)           | <span data-ttu-id="9d9f7-145">使用應用程式所支援的最高版本。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-145">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="9d9f7-146">**lineGetTranslateCaps**</span><span class="sxs-lookup"><span data-stu-id="9d9f7-146">**lineGetTranslateCaps**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linegettranslatecaps)         | <span data-ttu-id="9d9f7-147">使用應用程式所支援的最高版本。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-147">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="9d9f7-148">**lineNegotiateAPIVersion**</span><span class="sxs-lookup"><span data-stu-id="9d9f7-148">**lineNegotiateAPIVersion**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion)   | <span data-ttu-id="9d9f7-149">使用應用程式所支援的最高版本。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-149">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="9d9f7-150">**lineNegotiateExtVersion**</span><span class="sxs-lookup"><span data-stu-id="9d9f7-150">**lineNegotiateExtVersion**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linenegotiateextversion)   | <span data-ttu-id="9d9f7-151">使用 [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion)所傳回的版本。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-151">Use version returned by [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span></span>   |
| [<span data-ttu-id="9d9f7-152">**lineOpen**</span><span class="sxs-lookup"><span data-stu-id="9d9f7-152">**lineOpen**</span></span>](/windows/desktop/api/Tapi/nf-tapi-lineopen)                                 | <span data-ttu-id="9d9f7-153">使用 [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion)所傳回的版本。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-153">Use version returned by [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span></span>   |
| [<span data-ttu-id="9d9f7-154">**lineTranslateAddress**</span><span class="sxs-lookup"><span data-stu-id="9d9f7-154">**lineTranslateAddress**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linetranslateaddress)         | <span data-ttu-id="9d9f7-155">使用應用程式所支援的最高版本。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-155">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="9d9f7-156">**lineTranslateDialog**</span><span class="sxs-lookup"><span data-stu-id="9d9f7-156">**lineTranslateDialog**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linetranslatedialog)           | <span data-ttu-id="9d9f7-157">使用應用程式所支援的最高版本。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-157">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="9d9f7-158">**phoneGetDevCaps**</span><span class="sxs-lookup"><span data-stu-id="9d9f7-158">**phoneGetDevCaps**</span></span>](/windows/desktop/api/Tapi/nf-tapi-phonegetdevcaps)                   | <span data-ttu-id="9d9f7-159">使用 [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion)所傳回的版本。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-159">Use version returned by [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion).</span></span> |
| [<span data-ttu-id="9d9f7-160">**phoneNegotiateAPIVersion**</span><span class="sxs-lookup"><span data-stu-id="9d9f7-160">**phoneNegotiateAPIVersion**</span></span>](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion) | <span data-ttu-id="9d9f7-161">使用應用程式所支援的最高版本。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-161">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="9d9f7-162">**phoneNegotiateExtVersion**</span><span class="sxs-lookup"><span data-stu-id="9d9f7-162">**phoneNegotiateExtVersion**</span></span>](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateextversion) | <span data-ttu-id="9d9f7-163">使用 [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion)所傳回的版本。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-163">Use version returned by [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion).</span></span> |
| [<span data-ttu-id="9d9f7-164">**phoneOpen**</span><span class="sxs-lookup"><span data-stu-id="9d9f7-164">**phoneOpen**</span></span>](/windows/desktop/api/Tapi/nf-tapi-phoneopen)                               | <span data-ttu-id="9d9f7-165">使用 [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion)所傳回的版本。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-165">Use version returned by [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion).</span></span> |



 

> [!IMPORTANT]
> <span data-ttu-id="9d9f7-166">當您協商 API 版本時，請一律將最高和最低版本號碼設定為您的應用程式可支援的版本範圍。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-166">When negotiating an API version, always set the high and low version numbers to the range of versions that your application can support.</span></span> <span data-ttu-id="9d9f7-167">例如，絕對不能使用較低版本的0x00000000 或0xFFFFFFFF，因為這些值需要您的應用程式支援所有的 TAPI 版本，包括過去和未來。</span><span class="sxs-lookup"><span data-stu-id="9d9f7-167">For example, never use 0x00000000 for the low version or 0xFFFFFFFF for the high because these values require that your application support all versions of TAPI, both past and future.</span></span>

 

 

 



