---
description: 當應用程式使用一或多個未完成的非同步作業來呼叫 lineClose 函式時，TAPI 可能會指示服務提供者終止與呼叫相關聯的非同步作業。
ms.assetid: b26ce074-76dc-4a50-8c17-d3412c336d59
title: 非同步作業終止
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f8ed2acb0f442e5f4f07427f0e224d7a288087d6
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "106998010"
---
# <a name="termination-of-asynchronous-operations"></a><span data-ttu-id="8bb51-103">非同步作業終止</span><span class="sxs-lookup"><span data-stu-id="8bb51-103">Termination of Asynchronous Operations</span></span>

<span data-ttu-id="8bb51-104">當應用程式使用一或多個未完成的非同步作業來呼叫 [**lineClose**](/windows/win32/api/tapi/nf-tapi-lineclose) 函式時，TAPI 可能會指示服務提供者終止與呼叫相關聯的非同步作業，這取決於應用程式是否為呼叫的唯一擁有者，而且只有呼叫的控制碼。</span><span class="sxs-lookup"><span data-stu-id="8bb51-104">When an application calls the [**lineClose**](/windows/win32/api/tapi/nf-tapi-lineclose) function with one or more outstanding asynchronous operations, TAPI may direct the service provider to terminate asynchronous operations associated with a call, depending on whether the application is the sole owner of the call and has the only handle to the call.</span></span>

<span data-ttu-id="8bb51-105">如果應用程式是呼叫的唯一擁有者，則 TAPI 會根據每個這類呼叫的提供者) ，呼叫 [**TSPI \_ LineDropOnClose**](./tspi-linedroponclose.md) 或 [**TSPI \_ lineDrop**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop) (。</span><span class="sxs-lookup"><span data-stu-id="8bb51-105">If the application is the sole owner of a call, TAPI calls [**TSPI\_lineDropOnClose**](./tspi-linedroponclose.md) or [**TSPI\_lineDrop**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop) (depending on the provider) for each such call.</span></span> <span data-ttu-id="8bb51-106">服務提供者應該檢查是否有任何與中斷的呼叫相關聯的暫止非同步作業。</span><span class="sxs-lookup"><span data-stu-id="8bb51-106">The service provider should check for any pending asynchronous operations associated with the call being dropped.</span></span> <span data-ttu-id="8bb51-107">如果有暫止的作業存在，服務提供者應該採取適當的動作，可能會終止正在進行的作業。</span><span class="sxs-lookup"><span data-stu-id="8bb51-107">If a pending operation exists, the service provider should take the appropriate action, possibly terminating the operation in progress.</span></span>

<span data-ttu-id="8bb51-108">如果應用程式只有呼叫的控制碼 (也就是沒有任何其他擁有者或監視器) ，TAPI 會呼叫 [**TSPI \_ lineCloseCall**](/windows/win32/api/tspi/nf-tspi-tspi_lineclosecall) 函式。</span><span class="sxs-lookup"><span data-stu-id="8bb51-108">If the application has the only handle to a call (that is, there are no other owners or monitors), TAPI calls the [**TSPI\_lineCloseCall**](/windows/win32/api/tspi/nf-tspi-tspi_lineclosecall) function.</span></span> <span data-ttu-id="8bb51-109">服務提供者必須將此呼叫視為絕對表示必須放棄暫止的非同步作業。</span><span class="sxs-lookup"><span data-stu-id="8bb51-109">The service provider must consider this call to be the absolute indication that pending asynchronous operations must be abandoned.</span></span> <span data-ttu-id="8bb51-110">服務提供者必須確保呼叫的順序完成，而且必須針對所有未完成的非同步作業呼叫 [**非同步 \_ 完成**](/windows/win32/api/tspi/nc-tspi-async_completion) 回呼函數，並指定 LINEERR \_ OPERATIONFAILED 錯誤值。</span><span class="sxs-lookup"><span data-stu-id="8bb51-110">The service provider must ensure an orderly completion of the call, and must call the [**ASYNC\_COMPLETION**](/windows/win32/api/tspi/nc-tspi-async_completion) callback function for all outstanding asynchronous operations, specifying the LINEERR\_OPERATIONFAILED error value.</span></span> <span data-ttu-id="8bb51-111">如果 TAPI 先前稱為 [**TSPI \_ LineDropOnClose**](./tspi-linedroponclose.md) 或 [**TSPI \_ lineDrop**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop) 函式，它會在服務提供者從另一個呼叫傳回之後立即呼叫 **TSPI \_ lineCloseCall** ，而不會等候與 **TSPI \_ lineDrop** 函式相關聯的非同步作業完成。</span><span class="sxs-lookup"><span data-stu-id="8bb51-111">If TAPI previously called the [**TSPI\_lineDropOnClose**](./tspi-linedroponclose.md) or [**TSPI\_lineDrop**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop) function, it calls **TSPI\_lineCloseCall** immediately after the service provider returns from the other call; it does not wait for the asynchronous operation associated with the **TSPI\_lineDrop** function to complete.</span></span>

<span data-ttu-id="8bb51-112">如果應用程式不是呼叫的唯一擁有者，則 TAPI 不會呼叫 [**TSPI \_ LineDropOnClose**](./tspi-linedroponclose.md) 或 [**TSPI \_ lineDrop**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop)。</span><span class="sxs-lookup"><span data-stu-id="8bb51-112">If the application is not the sole owner of the call, TAPI does not call [**TSPI\_lineDropOnClose**](./tspi-linedroponclose.md) or [**TSPI\_lineDrop**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop).</span></span> <span data-ttu-id="8bb51-113">如果應用程式沒有呼叫的唯一控制碼，則 TAPI 不會呼叫 [**TSPI \_ lineCloseCall**](/windows/win32/api/tspi/nf-tspi-tspi_lineclosecall) 函式。</span><span class="sxs-lookup"><span data-stu-id="8bb51-113">If the application does not have the only handle to the call, TAPI does not call the [**TSPI\_lineCloseCall**](/windows/win32/api/tspi/nf-tspi-tspi_lineclosecall) function.</span></span> <span data-ttu-id="8bb51-114">如果應用程式不是唯一的擁有者，也不是呼叫之控制碼的唯一私密金鑰擁有人，則 TAPI 不會傳送通知給服務提供者，因此任何擱置中的非同步作業都會保持不變。</span><span class="sxs-lookup"><span data-stu-id="8bb51-114">If the application is neither the sole owner nor the sole possessor of a handle to the call, TAPI sends no notification to the service provider, and therefore, any pending asynchronous operations remain intact.</span></span> <span data-ttu-id="8bb51-115">這表示這類應用程式無法終止使用 [**lineClose**](/windows/win32/api/tapi/nf-tapi-lineclose) 函數啟動的非同步作業。</span><span class="sxs-lookup"><span data-stu-id="8bb51-115">This means that such applications cannot terminate asynchronous operations that they have started by using the [**lineClose**](/windows/win32/api/tapi/nf-tapi-lineclose) function.</span></span> <span data-ttu-id="8bb51-116">不過，因為每個非同步作業都需要叫用應用程式為呼叫的擁有者，所以應用程式不能終止非同步作業的可能性非常罕見。</span><span class="sxs-lookup"><span data-stu-id="8bb51-116">However, because every asynchronous operation requires the invoking application to be an owner of the call, the likelihood of an application not being able to terminate asynchronous operations is very rare.</span></span> <span data-ttu-id="8bb51-117">如果發生這種情況，則 (的另一個擁有者) 呼叫 (s) 必須負責處置 () 的呼叫。</span><span class="sxs-lookup"><span data-stu-id="8bb51-117">If it does occur, the other owner(s) of the call(s) must take responsibility for the disposition of the call(s).</span></span>

<span data-ttu-id="8bb51-118">如果 TAPI 呼叫 [**TSPI \_ LineDropOnClose**](./tspi-linedroponclose.md) 或 [**TSPI \_ lineDrop**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop)，則服務提供者最後必須 \_ 針對相關聯的呼叫傳送 LINECALLSTATE 閒置訊息 (除非) 先呼叫 [**TSPI \_ lineCloseCall**](/windows/win32/api/tspi/nf-tspi-tspi_lineclosecall) ，才能讓呼叫上的監視器進行清除。</span><span class="sxs-lookup"><span data-stu-id="8bb51-118">If TAPI calls [**TSPI\_lineDropOnClose**](./tspi-linedroponclose.md) or [**TSPI\_lineDrop**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop), the service provider must eventually send a LINECALLSTATE\_IDLE message for the associated call (unless [**TSPI\_lineCloseCall**](/windows/win32/api/tspi/nf-tspi-tspi_lineclosecall) is called first) so that monitors on the call can clean up.</span></span> <span data-ttu-id="8bb51-119">當最後一個監視器已呼叫 [**lineDeallocateCall**](/windows/win32/api/tapi/nf-tapi-linedeallocatecall) 函式時，TAPI 會呼叫 **TSPI \_ lineCloseCall** 函式; 任何擱置中的作業都必須完成或終止，並如先前所述呼叫 [**非同步 \_ 完成**](/windows/win32/api/tspi/nc-tspi-async_completion) 。</span><span class="sxs-lookup"><span data-stu-id="8bb51-119">When the last monitor has called the [**lineDeallocateCall**](/windows/win32/api/tapi/nf-tapi-linedeallocatecall) function, TAPI calls the **TSPI\_lineCloseCall** function; any pending operations must be completed or terminated and [**ASYNC\_COMPLETION**](/windows/win32/api/tspi/nc-tspi-async_completion) called, as described earlier.</span></span>

 

 
