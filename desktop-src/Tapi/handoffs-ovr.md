---
description: 當應用程式具有通訊會話的擁有者許可權時，應用程式可能會選擇將擁有權遞交給另一個應用程式。
ms.assetid: d6d188c9-9cbd-45af-93f0-b78850374919
title: 遞交
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 343815e35f1fc331c57c4aa2d9d311697cab7022
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "106971461"
---
# <a name="handoffs"></a><span data-ttu-id="a3819-103">遞交</span><span class="sxs-lookup"><span data-stu-id="a3819-103">Handoffs</span></span>

<span data-ttu-id="a3819-104">當應用程式具有通訊會話的擁有者 [許可權](privilege-ovr.md) 時，應用程式可能會選擇將擁有權遞交給另一個應用程式。</span><span class="sxs-lookup"><span data-stu-id="a3819-104">When an application has owner [privilege](privilege-ovr.md) for a communications session, the application may choose to hand off ownership to another application.</span></span> <span data-ttu-id="a3819-105">交付作業通常用來允許變更呼叫的媒體類型。</span><span class="sxs-lookup"><span data-stu-id="a3819-105">The handoff operation is normally used to allow the call's media type to be changed.</span></span> <span data-ttu-id="a3819-106">新媒體類型的最高優先順序應用程式應該採用並處理呼叫。</span><span class="sxs-lookup"><span data-stu-id="a3819-106">The highest-priority application for the new media type should take and handle the call.</span></span> <span data-ttu-id="a3819-107">通常會發生下列其中一個原因的媒體類型變更。</span><span class="sxs-lookup"><span data-stu-id="a3819-107">Media type changing usually occurs for one of the following reasons.</span></span>

<span data-ttu-id="a3819-108">**使用者命令：** 透過使用者介面或透過視窗訊息，應用程式會學習本機使用者想要變更媒體類型。</span><span class="sxs-lookup"><span data-stu-id="a3819-108">**User command:** Through a user interface or through window messages, the application learns that the local user wants to change media type.</span></span> <span data-ttu-id="a3819-109">例如，使用者已告訴新的目標應用程式 (該應用程式還不是擁有者) 取得用於傳輸資料的現有語音通話。</span><span class="sxs-lookup"><span data-stu-id="a3819-109">For example, the user has told the new target application (which is not yet an owner) to obtain an existing voice call for transmitting data.</span></span> <span data-ttu-id="a3819-110">目標應用程式現在必須取得呼叫的控制權。</span><span class="sxs-lookup"><span data-stu-id="a3819-110">The target application must now take control of the call.</span></span> <span data-ttu-id="a3819-111">在此情況下，目前的擁有者會注意到擁有者的人數增加，然後會讓出其通話的控制權。</span><span class="sxs-lookup"><span data-stu-id="a3819-111">In this case, the current owner notices the number of owners increase, and then relinquishes its control of the call.</span></span> <span data-ttu-id="a3819-112">或者，使用者可以指示目前的呼叫擁有者將它交給可處理新媒體類型的應用程式。</span><span class="sxs-lookup"><span data-stu-id="a3819-112">Alternatively, the user could instruct the current owner of the call to hand it off to an application that can handle the new media type.</span></span>

<span data-ttu-id="a3819-113">**媒體類型變更：** 服務提供者可以偵測到媒體類型變更。</span><span class="sxs-lookup"><span data-stu-id="a3819-113">**Media type change:** The service provider can detect a media type change.</span></span> <span data-ttu-id="a3819-114">例如，本機應用程式現正播放錄製的語音訊息給呼叫者。</span><span class="sxs-lookup"><span data-stu-id="a3819-114">For example, the local application is playing a recorded voice message to the caller.</span></span> <span data-ttu-id="a3819-115">在此訊息中，呼叫者會自發地決定傳送傳真通話音，而本機應用程式可以藉由將媒體類型變更為 [傳真]，並視需要將通話傳送至傳真應用程式，以回應。</span><span class="sxs-lookup"><span data-stu-id="a3819-115">During this message, the caller spontaneously decides to transmit a fax calling tone, and the local application can respond accordingly by changing the media type to fax and, if necessary, handing the call off to a fax application.</span></span> <span data-ttu-id="a3819-116">這項作業的另一種方式是讓監視應用程式啟用媒體類型監視，並在呼叫上偵測到有興趣的媒體類型時，可要求呼叫的擁有權。</span><span class="sxs-lookup"><span data-stu-id="a3819-116">Another way this can work is for a monitoring application to enable media type monitoring, and, when the media type in which it is interested is detected on a call, it can request ownership of the call.</span></span> <span data-ttu-id="a3819-117">這種機制讓每個應用程式都不需要監視每個媒體類型的每個呼叫。</span><span class="sxs-lookup"><span data-stu-id="a3819-117">This mechanism makes it unnecessary for every application to monitor every call for every media type.</span></span>

<span data-ttu-id="a3819-118">**遠端方命令：** 遠端方可以在現有的呼叫期間以互動方式指出媒體類型的變更，例如，本機應用程式是否監視遠端呼叫端的 DTMF 輸入。</span><span class="sxs-lookup"><span data-stu-id="a3819-118">**Remote party command:** The remote party can interactively indicate a change in media types during an existing call, such as if the local application is monitoring DTMF input by the remote caller.</span></span> <span data-ttu-id="a3819-119">例如，在此監視中，呼叫端會指出即將傳送傳真。</span><span class="sxs-lookup"><span data-stu-id="a3819-119">Through this monitoring, the caller indicates, for example, that a fax is about to be sent.</span></span> <span data-ttu-id="a3819-120">呼叫者可以控制本機應用程式的其他方式，就是使用在其他資料連線上收到的命令，以及透過 ISDN 使用者的資訊訊息。</span><span class="sxs-lookup"><span data-stu-id="a3819-120">Other ways the caller can control local applications are with commands received on other data connections and through ISDN user-user information messages.</span></span>

<span data-ttu-id="a3819-121">來電交付將會有下列其中一項結果：</span><span class="sxs-lookup"><span data-stu-id="a3819-121">A call handoff will have one of these outcomes:</span></span>

-   <span data-ttu-id="a3819-122">呼叫會提供給另一個應用程式 (成功) 。</span><span class="sxs-lookup"><span data-stu-id="a3819-122">The call is given to another application (SUCCESS).</span></span>
-   <span data-ttu-id="a3819-123">處理應用程式本身就是目標 (TARGETSELF) 。</span><span class="sxs-lookup"><span data-stu-id="a3819-123">The handing-off application is itself the target (TARGETSELF).</span></span>
-   <span data-ttu-id="a3819-124"> (的 TARGETNOTFOUND) ，提交失敗。</span><span class="sxs-lookup"><span data-stu-id="a3819-124">The handoff fails (TARGETNOTFOUND).</span></span>

<span data-ttu-id="a3819-125">如果接收移交呼叫的應用程式已經有呼叫的呼叫控制碼，則會使用這個舊的呼叫控制碼。</span><span class="sxs-lookup"><span data-stu-id="a3819-125">If the application that is receiving the handed-off call already has a call handle to the call, this old call handle is used.</span></span> <span data-ttu-id="a3819-126">否則會建立新的呼叫控制碼。</span><span class="sxs-lookup"><span data-stu-id="a3819-126">Otherwise, a new call handle is created.</span></span> <span data-ttu-id="a3819-127">無論是哪一種情況，應用程式最後都會有呼叫的擁有者許可權。</span><span class="sxs-lookup"><span data-stu-id="a3819-127">In either case, the application ends up with owner privileges to the call.</span></span> <span data-ttu-id="a3819-128">只要處理常式的應用程式與目標應用程式不同，就會通知目標會話狀態訊息中的交付，如同收到新的呼叫。</span><span class="sxs-lookup"><span data-stu-id="a3819-128">Whenever the handing-off application is not the same as the target application, the target is informed about the handoff in a session state message as if it were receiving a new call.</span></span>

<span data-ttu-id="a3819-129">如果通知目前的擁有者應用程式要變更媒體類型，它會藉由將對目標媒體類型所使用的應用程式呼叫進行處理。</span><span class="sxs-lookup"><span data-stu-id="a3819-129">If the current owner application is told to change media types, it does so by handing off the call to an application used for the target media type.</span></span> <span data-ttu-id="a3819-130">這兩種類型的呼叫遞交會以 [導向的遞交](#directed-handoffs) 和 [媒體類型遞交](#media-type-handoffs)來描述。</span><span class="sxs-lookup"><span data-stu-id="a3819-130">The two types of call handoffs are described in [Directed Handoffs](#directed-handoffs) and [Media type Handoffs](#media-type-handoffs).</span></span>

<span data-ttu-id="a3819-131">並非所有服務提供者都支援使用這項作業。</span><span class="sxs-lookup"><span data-stu-id="a3819-131">Not all service providers support use of this operation.</span></span>

<span data-ttu-id="a3819-132">**TAPI 2.x：** 請參閱 [**lineHandoff**](/windows/win32/api/tapi/nf-tapi-linehandoff)，並將 *lpszFileName* 設定為直接遞交的應用程式名稱，或針對間接交付將 *dwMediaMode* 設定為一種媒體類型。</span><span class="sxs-lookup"><span data-stu-id="a3819-132">**TAPI 2.x:** See [**lineHandoff**](/windows/win32/api/tapi/nf-tapi-linehandoff), with *lpszFileName* set to the application name for a direct handoff or *dwMediaMode* set to one media type for an indirect handoff.</span></span>

<span data-ttu-id="a3819-133">**TAPI 3.x：** 請參閱 [**ITBasicCallControl：： HandoffDirect**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-handoffdirect)， [**ITBasicCallControl：： HandoffIndirect**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-handoffindirect)。</span><span class="sxs-lookup"><span data-stu-id="a3819-133">**TAPI 3.x:** See [**ITBasicCallControl::HandoffDirect**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-handoffdirect), [**ITBasicCallControl::HandoffIndirect**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-handoffindirect).</span></span>

## <a name="directed-handoffs"></a><span data-ttu-id="a3819-134">導向遞交</span><span class="sxs-lookup"><span data-stu-id="a3819-134">Directed Handoffs</span></span>

<span data-ttu-id="a3819-135">當目標應用程式由原始應用程式的名稱得知時，即會發生 *導向的交付* 。</span><span class="sxs-lookup"><span data-stu-id="a3819-135">A *directed handoff* takes place when the target application is known by name to the original application.</span></span> <span data-ttu-id="a3819-136">例如，這種情況會發生在同一家廠商所撰寫的一組應用程式中。</span><span class="sxs-lookup"><span data-stu-id="a3819-136">This situation would occur, for example, among a set of applications written by the same vendor.</span></span> <span data-ttu-id="a3819-137">使用者通常可以設定導向遞交的控制權。</span><span class="sxs-lookup"><span data-stu-id="a3819-137">The user can usually configure control of directed handoffs.</span></span> <span data-ttu-id="a3819-138">使用這類的交付時，如果指定的應用程式已開啟呼叫所在的行，就會將呼叫提供給該應用程式。</span><span class="sxs-lookup"><span data-stu-id="a3819-138">With such a handoff, the call is given to the specified application if it has opened the line on which the call exists.</span></span> <span data-ttu-id="a3819-139">在應用程式開啟行時指定的媒體類型會被忽略。</span><span class="sxs-lookup"><span data-stu-id="a3819-139">The media type specified at the time the application opened the line is ignored.</span></span> <span data-ttu-id="a3819-140">其中一個常見的範例是語音電話，後面接著相同呼叫中的傳真傳輸。</span><span class="sxs-lookup"><span data-stu-id="a3819-140">One common example is a voice call followed by a fax transmission in the same call.</span></span> <span data-ttu-id="a3819-141">導向的交付最常由相同開發人員（也就是以其他方式連結）中的應用程式使用。</span><span class="sxs-lookup"><span data-stu-id="a3819-141">Directed handoff would most often be used by applications from the same developer that are linked in other ways as well.</span></span>

<span data-ttu-id="a3819-142">在仲裁多個應用程式來等候相同媒體類型的來電時，也可以在未來的版本中使用導向的交付，並選取應用程式來處理以資料連結或更高層級通訊協定偵測為基礎的呼叫，而不是媒體類型。</span><span class="sxs-lookup"><span data-stu-id="a3819-142">Directed handoff may also be used in future versions as part of the process of arbitrating multiple applications waiting for incoming calls of the same media type, with the selection of the application to handle the call being based on data-link or higher-level protocol detection rather than media type.</span></span> <span data-ttu-id="a3819-143">其中一個使用範例是內含應用程式的連入資料數據機線路，例如遠端接管、佈告欄、遠端網路存取，以及遠端電子郵件存取，全都會同時等候呼叫。</span><span class="sxs-lookup"><span data-stu-id="a3819-143">An example of its use would be an incoming data modem line with applications such as remote takeover, bulletin board, remote network access, and remote e-mail access all waiting for calls simultaneously.</span></span>

## <a name="media-type-handoffs"></a><span data-ttu-id="a3819-144">媒體類型遞交</span><span class="sxs-lookup"><span data-stu-id="a3819-144">Media Type Handoffs</span></span>

<span data-ttu-id="a3819-145">當有新的目標媒體類型時，通常會在擁有應用程式判斷呼叫所需的媒體類型不存在或即將變更時，進行 *媒體類型的切換* 。</span><span class="sxs-lookup"><span data-stu-id="a3819-145">A *media type handoff* takes place when there is a new, targeted media type, usually when the owning application determines that the media type needed for the call is not present or is about to change.</span></span>

<span data-ttu-id="a3819-146">媒體相依的交付程式可以是探查進程（如果媒體類型不明）。</span><span class="sxs-lookup"><span data-stu-id="a3819-146">The process for a media-dependent handoff can be a probing process if the media type UNKNOWN bit is on.</span></span> <span data-ttu-id="a3819-147">擁有應用程式必須負責迴圈媒體類型，以找出最高優先順序的應用程式。</span><span class="sxs-lookup"><span data-stu-id="a3819-147">It is the responsibility of the owning application to cycle through media types to find the highest-priority application.</span></span> <span data-ttu-id="a3819-148">TAPI 只會在初始的連入呼叫上進行迴圈，以找出第一個擁有者。</span><span class="sxs-lookup"><span data-stu-id="a3819-148">TAPI does this cycling only on the initial incoming call to find the first owner.</span></span> <span data-ttu-id="a3819-149">它不會對提交作業執行此動作。</span><span class="sxs-lookup"><span data-stu-id="a3819-149">It does not do this for a handoff operation.</span></span> <span data-ttu-id="a3819-150">否則，與應用程式呼叫的初始指派幾乎相同。</span><span class="sxs-lookup"><span data-stu-id="a3819-150">Otherwise, a handoff is virtually the same as for the initial assignment of a call to an application.</span></span> <span data-ttu-id="a3819-151">差別在於，只有一種媒體類型可以設定) 遞交的間接 (媒體類型。</span><span class="sxs-lookup"><span data-stu-id="a3819-151">The difference is the fact that only one media type can be set for an indirect (media type) handoff.</span></span>

<span data-ttu-id="a3819-152">因為只能指定單一媒體類型位，所以會對該媒體類型的最高優先順序應用程式提供呼叫。</span><span class="sxs-lookup"><span data-stu-id="a3819-152">Because only a single media type bit can be specified, the call is given to the highest priority application for that media type.</span></span> <span data-ttu-id="a3819-153">不過，可能會有一種以上的媒體類型要作為交付的考慮。</span><span class="sxs-lookup"><span data-stu-id="a3819-153">However, it is possible that more than one media type is to be considered for the handoff.</span></span> <span data-ttu-id="a3819-154">在此情況下，處理應用程式應該將可能媒體類型的最高優先權指定為參數。</span><span class="sxs-lookup"><span data-stu-id="a3819-154">In this case, the handing-off application should specify the highest priority of the possible media types as a parameter.</span></span>

<span data-ttu-id="a3819-155">如果應用程式在執行媒體類型的切換時指定了未知的位，而提交失敗，則表示目前未執行可執行媒體類型判斷的未知應用程式。</span><span class="sxs-lookup"><span data-stu-id="a3819-155">If an application specifies the UNKNOWN bit when performing a media-type handoff and the handoff fails, this means that an unknown application capable of performing media type determination is not currently running.</span></span> <span data-ttu-id="a3819-156">接下來要處理的應用程式應該嘗試將呼叫交給針對下一個較高的媒體類型註冊的最高優先順序應用程式。</span><span class="sxs-lookup"><span data-stu-id="a3819-156">The application that is handing off should then try to hand the call off to the highest-priority application registered for the next-higher media type.</span></span>

<span data-ttu-id="a3819-157">接收應用程式現在負責呼叫。</span><span class="sxs-lookup"><span data-stu-id="a3819-157">The receiving application is now responsible for the call.</span></span> <span data-ttu-id="a3819-158">它現在會探查通話的實際媒體類型。</span><span class="sxs-lookup"><span data-stu-id="a3819-158">It now probes for the call's actual media type.</span></span> <span data-ttu-id="a3819-159">如果應用程式可以處理呼叫的媒體類型，則必須確定它是針對該媒體類型註冊的最高優先順序應用程式。</span><span class="sxs-lookup"><span data-stu-id="a3819-159">If the application can handle the call's media type, it must ensure that it is the highest-priority application registered for that media type.</span></span> <span data-ttu-id="a3819-160">如果是的話，它會保留呼叫並正常處理。</span><span class="sxs-lookup"><span data-stu-id="a3819-160">If so, it keeps the call and processes it normally.</span></span> <span data-ttu-id="a3819-161">如果沒有，則會將呼叫交給另一個針對該媒體類型註冊的應用程式。</span><span class="sxs-lookup"><span data-stu-id="a3819-161">If not, it hands the call off to another application registered for that media type.</span></span>

<span data-ttu-id="a3819-162">但是，如果該媒體類型的探查失敗，應用程式會再次探查，以嘗試剩餘的媒體模式可能性。</span><span class="sxs-lookup"><span data-stu-id="a3819-162">If, however, the probe for that media type fails, the application probes again, attempting the remaining media-mode possibilities.</span></span> <span data-ttu-id="a3819-163">它必須先關閉目前的媒體類型位，然後再嘗試另一個不同類型的切換。</span><span class="sxs-lookup"><span data-stu-id="a3819-163">It must first turn off the current media type bit, then try another handoff with a different type.</span></span>

<span data-ttu-id="a3819-164">此探查和關閉程式會繼續進行，而其餘的媒體類型則會一併刪除。</span><span class="sxs-lookup"><span data-stu-id="a3819-164">This process of probing and handing off continues, and the remaining media types are eliminated one by one.</span></span> <span data-ttu-id="a3819-165">在過程中，其中一個應用程式可能會看到它所處理的媒體類型是在通話中，而且遞交成功。</span><span class="sxs-lookup"><span data-stu-id="a3819-165">Along the way, one of the applications may see that the media type it handles is on the call, and the handoff is successful.</span></span>

<span data-ttu-id="a3819-166">然後，應用程式應該設定正確的媒體類型，並清除所有其他媒體類型的位。</span><span class="sxs-lookup"><span data-stu-id="a3819-166">The application should then set the correct media type and clear all other media-type bits.</span></span> <span data-ttu-id="a3819-167">這會通知其他感興趣的媒體類型應用程式。</span><span class="sxs-lookup"><span data-stu-id="a3819-167">This informs other interested applications of the correct media type.</span></span> <span data-ttu-id="a3819-168">這些其他應用程式會收到事件通知訊息，指出呼叫的媒體類型已變更。</span><span class="sxs-lookup"><span data-stu-id="a3819-168">These other applications receive an event notification message stating that the call's media type has changed.</span></span>

 

 
