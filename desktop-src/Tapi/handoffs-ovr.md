---
description: 當應用程式具有通訊會話的擁有者許可權時，應用程式可能會選擇將擁有權遞交給另一個應用程式。
ms.assetid: d6d188c9-9cbd-45af-93f0-b78850374919
title: 遞交
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 343815e35f1fc331c57c4aa2d9d311697cab7022
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "106971461"
---
# <a name="handoffs"></a>遞交

當應用程式具有通訊會話的擁有者 [許可權](privilege-ovr.md) 時，應用程式可能會選擇將擁有權遞交給另一個應用程式。 交付作業通常用來允許變更呼叫的媒體類型。 新媒體類型的最高優先順序應用程式應該採用並處理呼叫。 通常會發生下列其中一個原因的媒體類型變更。

**使用者命令：** 透過使用者介面或透過視窗訊息，應用程式會學習本機使用者想要變更媒體類型。 例如，使用者已告訴新的目標應用程式 (該應用程式還不是擁有者) 取得用於傳輸資料的現有語音通話。 目標應用程式現在必須取得呼叫的控制權。 在此情況下，目前的擁有者會注意到擁有者的人數增加，然後會讓出其通話的控制權。 或者，使用者可以指示目前的呼叫擁有者將它交給可處理新媒體類型的應用程式。

**媒體類型變更：** 服務提供者可以偵測到媒體類型變更。 例如，本機應用程式現正播放錄製的語音訊息給呼叫者。 在此訊息中，呼叫者會自發地決定傳送傳真通話音，而本機應用程式可以藉由將媒體類型變更為 [傳真]，並視需要將通話傳送至傳真應用程式，以回應。 這項作業的另一種方式是讓監視應用程式啟用媒體類型監視，並在呼叫上偵測到有興趣的媒體類型時，可要求呼叫的擁有權。 這種機制讓每個應用程式都不需要監視每個媒體類型的每個呼叫。

**遠端方命令：** 遠端方可以在現有的呼叫期間以互動方式指出媒體類型的變更，例如，本機應用程式是否監視遠端呼叫端的 DTMF 輸入。 例如，在此監視中，呼叫端會指出即將傳送傳真。 呼叫者可以控制本機應用程式的其他方式，就是使用在其他資料連線上收到的命令，以及透過 ISDN 使用者的資訊訊息。

來電交付將會有下列其中一項結果：

-   呼叫會提供給另一個應用程式 (成功) 。
-   處理應用程式本身就是目標 (TARGETSELF) 。
-    (的 TARGETNOTFOUND) ，提交失敗。

如果接收移交呼叫的應用程式已經有呼叫的呼叫控制碼，則會使用這個舊的呼叫控制碼。 否則會建立新的呼叫控制碼。 無論是哪一種情況，應用程式最後都會有呼叫的擁有者許可權。 只要處理常式的應用程式與目標應用程式不同，就會通知目標會話狀態訊息中的交付，如同收到新的呼叫。

如果通知目前的擁有者應用程式要變更媒體類型，它會藉由將對目標媒體類型所使用的應用程式呼叫進行處理。 這兩種類型的呼叫遞交會以 [導向的遞交](#directed-handoffs) 和 [媒體類型遞交](#media-type-handoffs)來描述。

並非所有服務提供者都支援使用這項作業。

**TAPI 2.x：** 請參閱 [**lineHandoff**](/windows/win32/api/tapi/nf-tapi-linehandoff)，並將 *lpszFileName* 設定為直接遞交的應用程式名稱，或針對間接交付將 *dwMediaMode* 設定為一種媒體類型。

**TAPI 3.x：** 請參閱 [**ITBasicCallControl：： HandoffDirect**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-handoffdirect)， [**ITBasicCallControl：： HandoffIndirect**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-handoffindirect)。

## <a name="directed-handoffs"></a>導向遞交

當目標應用程式由原始應用程式的名稱得知時，即會發生 *導向的交付* 。 例如，這種情況會發生在同一家廠商所撰寫的一組應用程式中。 使用者通常可以設定導向遞交的控制權。 使用這類的交付時，如果指定的應用程式已開啟呼叫所在的行，就會將呼叫提供給該應用程式。 在應用程式開啟行時指定的媒體類型會被忽略。 其中一個常見的範例是語音電話，後面接著相同呼叫中的傳真傳輸。 導向的交付最常由相同開發人員（也就是以其他方式連結）中的應用程式使用。

在仲裁多個應用程式來等候相同媒體類型的來電時，也可以在未來的版本中使用導向的交付，並選取應用程式來處理以資料連結或更高層級通訊協定偵測為基礎的呼叫，而不是媒體類型。 其中一個使用範例是內含應用程式的連入資料數據機線路，例如遠端接管、佈告欄、遠端網路存取，以及遠端電子郵件存取，全都會同時等候呼叫。

## <a name="media-type-handoffs"></a>媒體類型遞交

當有新的目標媒體類型時，通常會在擁有應用程式判斷呼叫所需的媒體類型不存在或即將變更時，進行 *媒體類型的切換* 。

媒體相依的交付程式可以是探查進程（如果媒體類型不明）。 擁有應用程式必須負責迴圈媒體類型，以找出最高優先順序的應用程式。 TAPI 只會在初始的連入呼叫上進行迴圈，以找出第一個擁有者。 它不會對提交作業執行此動作。 否則，與應用程式呼叫的初始指派幾乎相同。 差別在於，只有一種媒體類型可以設定) 遞交的間接 (媒體類型。

因為只能指定單一媒體類型位，所以會對該媒體類型的最高優先順序應用程式提供呼叫。 不過，可能會有一種以上的媒體類型要作為交付的考慮。 在此情況下，處理應用程式應該將可能媒體類型的最高優先權指定為參數。

如果應用程式在執行媒體類型的切換時指定了未知的位，而提交失敗，則表示目前未執行可執行媒體類型判斷的未知應用程式。 接下來要處理的應用程式應該嘗試將呼叫交給針對下一個較高的媒體類型註冊的最高優先順序應用程式。

接收應用程式現在負責呼叫。 它現在會探查通話的實際媒體類型。 如果應用程式可以處理呼叫的媒體類型，則必須確定它是針對該媒體類型註冊的最高優先順序應用程式。 如果是的話，它會保留呼叫並正常處理。 如果沒有，則會將呼叫交給另一個針對該媒體類型註冊的應用程式。

但是，如果該媒體類型的探查失敗，應用程式會再次探查，以嘗試剩餘的媒體模式可能性。 它必須先關閉目前的媒體類型位，然後再嘗試另一個不同類型的切換。

此探查和關閉程式會繼續進行，而其餘的媒體類型則會一併刪除。 在過程中，其中一個應用程式可能會看到它所處理的媒體類型是在通話中，而且遞交成功。

然後，應用程式應該設定正確的媒體類型，並清除所有其他媒體類型的位。 這會通知其他感興趣的媒體類型應用程式。 這些其他應用程式會收到事件通知訊息，指出呼叫的媒體類型已變更。

 

 
