---
description: 以非同步方式完成的作業會在應用程式所進行的函式呼叫中執行部分處理，並在 TAPI 2.x 從函式呼叫傳回之後，在獨立的執行執行緒中執行它的其餘部分。
ms.assetid: 37b544e4-6413-4741-b8b6-ec676ce4ca97
title: 非同步函式
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 135e792a4b1d6a25a4f49fbb2abe2c19ce3071ad
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "106983726"
---
# <a name="asynchronous-functions"></a><span data-ttu-id="3e2d0-103">非同步函式</span><span class="sxs-lookup"><span data-stu-id="3e2d0-103">Asynchronous Functions</span></span>

<span data-ttu-id="3e2d0-104">以非同步方式完成的作業會在應用程式所進行的函式呼叫中執行部分處理，並在 TAPI 2.x 從函式呼叫傳回之後，在獨立的執行執行緒中執行它的其餘部分。</span><span class="sxs-lookup"><span data-stu-id="3e2d0-104">An operation that completes asynchronously performs part of its processing in the function call made by the application and the remainder of it in an independent execution thread after TAPI 2.x has returned from the function call.</span></span> <span data-ttu-id="3e2d0-105">為了確保呼叫的處理完成，服務提供者會將要求向量化至系統中的另一個作用中實體，例如 LAN 伺服器、增益集硬體、交換器或網路，然後返回應用程式。</span><span class="sxs-lookup"><span data-stu-id="3e2d0-105">To ensure completion of the call's processing, the service provider vectors the request to another active entity in the system—such as a LAN server, add-in hardware, a switch, or a network—and then returns to the application.</span></span> <span data-ttu-id="3e2d0-106">目前，負的錯誤結果或正面的要求識別碼會傳回給應用程式。</span><span class="sxs-lookup"><span data-stu-id="3e2d0-106">At this time, either a negative error result or a positive request identifier is returned to the application.</span></span>

<span data-ttu-id="3e2d0-107">在非同步完成時 (服務提供者已從硬體收到插斷，表示訊息必須傳遞) ，服務提供者會呼叫 TAPISRV 和「事件 *X* 剛剛發生的報告」。</span><span class="sxs-lookup"><span data-stu-id="3e2d0-107">At the time of asynchronous completion (the service provider has received an interrupt from the hardware, meaning that a message must be delivered), the service provider calls TAPISRV and reports that "Event *X* has just taken place.</span></span> <span data-ttu-id="3e2d0-108">傳遞適當的訊息給所有相關的應用程式。」</span><span class="sxs-lookup"><span data-stu-id="3e2d0-108">Deliver an appropriate message to all concerned applications."</span></span> <span data-ttu-id="3e2d0-109">當 TAPISRV 接收到此訊息時，它會將訊息轉送至 TAPI 動態連結程式庫，在應用程式的進程中，接著會根據 [**lineInitializeEx**](/windows/win32/api/tapi/nf-tapi-lineinitializeexa) 或 [**phoneInitializeEx**](/windows/win32/api/tapi/nf-tapi-phoneinitializeexa)中的應用程式所選取的訊息通知配置，張貼視窗訊息、通知事件控制碼或張貼至 i/o 完成埠。</span><span class="sxs-lookup"><span data-stu-id="3e2d0-109">When TAPISRV receives this message, it forwards the message to the TAPI dynamic-link library, in the application's process, which in turn posts a window message, signals an event handle, or posts to an I/O completion port, according to the message notification scheme selected by the application in [**lineInitializeEx**](/windows/win32/api/tapi/nf-tapi-lineinitializeexa) or [**phoneInitializeEx**](/windows/win32/api/tapi/nf-tapi-phoneinitializeexa).</span></span>

<span data-ttu-id="3e2d0-110">當作業的非同步部分完成時，會將 [**行 \_ 回復**](./line-reply.md) (或 [**電話 \_ 回復**](./phone-reply.md)) 訊息傳送至應用程式。</span><span class="sxs-lookup"><span data-stu-id="3e2d0-110">When the asynchronous portion of the operation completes, a [**LINE\_REPLY**](./line-reply.md) (or [**PHONE\_REPLY**](./phone-reply.md)) message is sent to the application.</span></span> <span data-ttu-id="3e2d0-111">此訊息包含了函式呼叫所傳回的要求識別碼，做為它的其中一個參數。</span><span class="sxs-lookup"><span data-stu-id="3e2d0-111">This message contains, as one of its parameters, the request identifier returned by the function call.</span></span> <span data-ttu-id="3e2d0-112">此要求識別碼可讓應用程式判斷已完成的原始要求。</span><span class="sxs-lookup"><span data-stu-id="3e2d0-112">This request identifier allows the application to determine which original request has completed.</span></span> <span data-ttu-id="3e2d0-113"> (的應用程式應該記得所有進行中要求的要求識別碼，以便能夠正確處理回復訊息。 ) 第二個參數換行 \_ 回復 (或電話 \_ 回復) 訊息是非同步傳回值。</span><span class="sxs-lookup"><span data-stu-id="3e2d0-113">(Applications should remember the request identifiers of all their requests in progress so that reply messages can be properly handled.) A second parameter to the LINE\_REPLY (or PHONE\_REPLY) message is the asynchronous return value.</span></span> <span data-ttu-id="3e2d0-114">這是錯誤 (的負數值) 如果作業順利完成，則為零。</span><span class="sxs-lookup"><span data-stu-id="3e2d0-114">This is either a negative value (for an error) or zero if the operation completed successfully.</span></span> <span data-ttu-id="3e2d0-115">若為非同步作業，任何傳回值可能會傳回做為函式傳回的一部分，或做為行 \_ 回復或電話回復訊息中的 dwParam2 參數 \_ 。</span><span class="sxs-lookup"><span data-stu-id="3e2d0-115">For asynchronous operations, any of the return values may be returned as part of the function return or as the *dwParam2* parameter in the LINE\_REPLY or PHONE\_REPLY message.</span></span> <span data-ttu-id="3e2d0-116">值0表示成功，只會傳回在行 \_ 回復訊息中，而絕不會傳回給函數的傳回值。</span><span class="sxs-lookup"><span data-stu-id="3e2d0-116">The value 0, which indicates success, will only be returned in the LINE\_REPLY message, and never as the function's return value.</span></span>

<span data-ttu-id="3e2d0-117">Initialize 函數 ( [**lineInitializeEx**](/windows/win32/api/tapi/nf-tapi-lineinitializeexa) 和 [**PHONEINITIALIZEEX**](/windows/win32/api/tapi/nf-tapi-phoneinitializeexa)) 告知 TAPI 如何將這些訊息傳送至應用程式。</span><span class="sxs-lookup"><span data-stu-id="3e2d0-117">The initialize functions ( [**lineInitializeEx**](/windows/win32/api/tapi/nf-tapi-lineinitializeexa) and [**phoneInitializeEx**](/windows/win32/api/tapi/nf-tapi-phoneinitializeexa)) tell TAPI how to send these messages to the application.</span></span>

> [!Note]  
> <span data-ttu-id="3e2d0-118">在某些情況下，如果多執行緒應用程式從應用程式初始化線路或電話裝置的執行緒以外的執行緒呼叫非同步函式，則應用程式可能會在非同步函式傳回之前，收到 [**行 \_ 回復**](./line-reply.md) 或 [**電話 \_ 回復**](./phone-reply.md) 訊息。</span><span class="sxs-lookup"><span data-stu-id="3e2d0-118">In some cases, if a multithreaded application calls an asynchronous function from a thread other than the thread from which the application initialized the line or phone device, the application may receive the [**LINE\_REPLY**](./line-reply.md) or [**PHONE\_REPLY**](./phone-reply.md) message before the asynchronous function has returned.</span></span> <span data-ttu-id="3e2d0-119">在這種情況下，應用程式應該儲存訊息參數並等候非同步函式傳回，而且在處理訊息之前，要求識別碼是已知的。</span><span class="sxs-lookup"><span data-stu-id="3e2d0-119">In such cases, the application should save the message parameters and wait until the asynchronous function returns and the request identifier is known before processing the message.</span></span>

 

 

 
