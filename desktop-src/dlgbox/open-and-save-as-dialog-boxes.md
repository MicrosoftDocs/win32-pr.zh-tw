---
title: 開啟並另存新檔對話方塊
description: '[開啟] 對話方塊可讓使用者指定要開啟之檔案或檔案集合的磁片磁碟機、目錄和名稱。'
ms.assetid: 5676ca9d-daca-40bf-8881-def2ff841c58
keywords:
- 通用對話方塊程式庫
- 通用對話方塊
- 開啟對話方塊
- '[另存新檔] 對話方塊'
- 自訂開啟對話方塊
- 自訂另存新檔] 對話方塊
- 對話方塊、開啟
- 對話方塊，另存新檔
ms.topic: article
ms.date: 05/31/2018
ms.custom: project-verbatim
ms.openlocfilehash: be957276f0d5a6370bb53aca4b1af5052b422011
ms.sourcegitcommit: f848119a8faa29b27585f4df53f6e50ee9666684
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 05/27/2021
ms.locfileid: "110548883"
---
# <a name="open-and-save-as-dialog-boxes"></a><span data-ttu-id="efa74-111">開啟並另存新檔對話方塊</span><span class="sxs-lookup"><span data-stu-id="efa74-111">Open and Save As Dialog Boxes</span></span>

> [!NOTE]
> <span data-ttu-id="efa74-112">[**GetOpenFileName**](/windows/desktop/api/Commdlg/nf-commdlg-getopenfilenamea)函式會在檔案 [使用範例](https://github.com/microsoft/Windows-classic-samples/tree/master/Samples/Win7Samples/winui/shell/appplatform/fileisinuse)中示範。</span><span class="sxs-lookup"><span data-stu-id="efa74-112">The [**GetOpenFileName**](/windows/desktop/api/Commdlg/nf-commdlg-getopenfilenamea) function is demonstrated in the [File is in use sample](https://github.com/microsoft/Windows-classic-samples/tree/master/Samples/Win7Samples/winui/shell/appplatform/fileisinuse).</span></span>

<span data-ttu-id="efa74-113">\[從 Windows Vista 開始，[[一般專案] 對話方塊](../shell/common-file-dialog.md)已取代 [**開啟**] 和 [**另存** 新檔] 對話方塊。</span><span class="sxs-lookup"><span data-stu-id="efa74-113">\[Starting with Windows Vista, the **Open** and **Save As** common dialog boxes have been superseded by the [Common Item Dialog](../shell/common-file-dialog.md).</span></span> <span data-ttu-id="efa74-114">我們建議您從通用對話方塊程式庫使用通用專案對話方塊 API，而不是這些對話方塊。\]</span><span class="sxs-lookup"><span data-stu-id="efa74-114">We recommended that you use the Common Item Dialog API instead of these dialog boxes from the Common Dialog Box Library.\]</span></span>

<span data-ttu-id="efa74-115">[ **開啟** ] 對話方塊可讓使用者指定要開啟之檔案或檔案集合的磁片磁碟機、目錄和名稱。</span><span class="sxs-lookup"><span data-stu-id="efa74-115">The **Open** dialog box lets the user specify the drive, directory, and the name of a file or set of files to open.</span></span> <span data-ttu-id="efa74-116">您可以藉由初始化 [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea)結構並將結構傳遞至 [**GetOpenFileName**](/windows/desktop/api/Commdlg/nf-commdlg-getopenfilenamea)函式，來建立和顯示 **開啟** 的對話方塊。</span><span class="sxs-lookup"><span data-stu-id="efa74-116">You create and display an **Open** dialog box by initializing an [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) structure and passing the structure to the [**GetOpenFileName**](/windows/desktop/api/Commdlg/nf-commdlg-getopenfilenamea) function.</span></span>

<span data-ttu-id="efa74-117">[ **另存** 新檔] 對話方塊可讓使用者指定要儲存的磁片磁碟機、目錄和檔案名。</span><span class="sxs-lookup"><span data-stu-id="efa74-117">The **Save As** dialog box lets the user specify the drive, directory, and name of a file to save.</span></span> <span data-ttu-id="efa74-118">您可以藉由初始化 [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea)結構並將結構傳遞給 [**GetSaveFileName**](/windows/desktop/api/Commdlg/nf-commdlg-getsavefilenamea)函數，來建立並顯示 [**另存** 新檔] 對話方塊。</span><span class="sxs-lookup"><span data-stu-id="efa74-118">You create and display a **Save As** dialog box by initializing an [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) structure and passing the structure to the [**GetSaveFileName**](/windows/desktop/api/Commdlg/nf-commdlg-getsavefilenamea) function.</span></span>

<span data-ttu-id="efa74-119">Explorer 樣式 [ **開啟** ] 和 [ **另存** 新檔] 對話方塊提供類似于 Windows 檔案總管的使用者介面功能。</span><span class="sxs-lookup"><span data-stu-id="efa74-119">Explorer-style **Open** and **Save As** dialog boxes provide user-interface features that are similar to the Windows Explorer.</span></span> <span data-ttu-id="efa74-120">不過，系統會繼續支援舊版樣式的 [ **開啟** ] 和 [ **另存** 新檔] 對話方塊，適用于必須與舊樣式使用者介面一致的應用程式。</span><span class="sxs-lookup"><span data-stu-id="efa74-120">However, the system continues to support old-style **Open** and **Save As** dialog boxes for applications that must be consistent with the old-style user interface.</span></span>

<span data-ttu-id="efa74-121">除了外觀上的差異以外，Explorer 樣式和舊樣式的對話方塊在使用自訂範本和攔截程式以自訂對話方塊時不同。</span><span class="sxs-lookup"><span data-stu-id="efa74-121">In addition to the difference in appearance, the Explorer-style and old-style dialog boxes differ in their use of custom templates and hook procedures for customizing the dialog boxes.</span></span> <span data-ttu-id="efa74-122">不過，Explorer 樣式和舊樣式的對話方塊對於大部分基本作業都具有相同的行為，例如指定檔案名篩選、驗證使用者的輸入，以及取得使用者指定的檔案名。</span><span class="sxs-lookup"><span data-stu-id="efa74-122">However, the Explorer-style and old-style dialog boxes have the same behavior for most basic operations, such as specifying a file name filter, validating the user's input, and getting the file name specified by the user.</span></span> <span data-ttu-id="efa74-123">如需有關 Explorer 樣式和舊樣式對話方塊的詳細資訊，請參閱 [開啟和另存](#open-and-save-as-dialog-box-customization)新檔對話方塊的自訂。</span><span class="sxs-lookup"><span data-stu-id="efa74-123">For more information about the Explorer-style and old-style dialog boxes, see [Open and Save As Dialog Box Customization](#open-and-save-as-dialog-box-customization).</span></span>

<span data-ttu-id="efa74-124">下圖顯示一般 Explorer 樣式的 **開啟** 對話方塊。</span><span class="sxs-lookup"><span data-stu-id="efa74-124">The following illustration shows a typical Explorer-style **Open** dialog box.</span></span>

![開啟檔案對話方塊](images/opendialogboxxp.png)

<span data-ttu-id="efa74-126">下圖顯示典型的 Explorer 樣式 [ **另存** 新檔] 對話方塊。</span><span class="sxs-lookup"><span data-stu-id="efa74-126">The following illustration shows a typical Explorer-style **Save As** dialog box.</span></span>

![[儲存檔案] 對話方塊](images/saveasdialogboxxp.png)

<span data-ttu-id="efa74-128">如果使用者指定檔案名，然後按一下 [ **確定]** 按鈕， [**GetOpenFileName**](/windows/desktop/api/Commdlg/nf-commdlg-getopenfilenamea) 或 [**GetSaveFileName**](/windows/desktop/api/Commdlg/nf-commdlg-getsavefilenamea) 會傳回 **TRUE**。</span><span class="sxs-lookup"><span data-stu-id="efa74-128">If the user specifies a file name and clicks the **OK** button, [**GetOpenFileName**](/windows/desktop/api/Commdlg/nf-commdlg-getopenfilenamea) or [**GetSaveFileName**](/windows/desktop/api/Commdlg/nf-commdlg-getsavefilenamea) returns **TRUE**.</span></span> <span data-ttu-id="efa74-129">[**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea)結構的 **lpstrFile** 成員所指向的緩衝區包含使用者所指定的完整路徑和檔案名。</span><span class="sxs-lookup"><span data-stu-id="efa74-129">The buffer pointed to by the **lpstrFile** member of the [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) structure contains the full path and file name specified by the user.</span></span>

<span data-ttu-id="efa74-130">如果使用者取消 [ **開啟** ] 或 [ **另存** 新檔] 對話方塊或發生錯誤，函數會傳回 **FALSE**。</span><span class="sxs-lookup"><span data-stu-id="efa74-130">If the user cancels the **Open** or **Save As** dialog box or an error occurs, the function returns **FALSE**.</span></span> <span data-ttu-id="efa74-131">若要判斷錯誤的原因，請呼叫 [**CommDlgExtendedError**](/windows/desktop/api/Commdlg/nf-commdlg-commdlgextendederror) 函式來取出擴充的錯誤值。</span><span class="sxs-lookup"><span data-stu-id="efa74-131">To determine the cause of the error, call the [**CommDlgExtendedError**](/windows/desktop/api/Commdlg/nf-commdlg-commdlgextendederror) function to retrieve the extended error value.</span></span> <span data-ttu-id="efa74-132">如果 **lpstrFile** 緩衝區太小而無法接收完整名稱， **CommDlgExtendedError** 會傳回 **FNERR \_ BUFFERTOOSMALL** ，而且 **lpstrFile** 成員指向之緩衝區的前2個位元組會設定為整數值，以指定接收完整名稱所需的大小。</span><span class="sxs-lookup"><span data-stu-id="efa74-132">If the **lpstrFile** buffer is too small to receive the full name, **CommDlgExtendedError** returns **FNERR\_BUFFERTOOSMALL** and the first 2 bytes of the buffer pointed to by the **lpstrFile** member are set to an integer value specifying the size required to receive the full name.</span></span>

<span data-ttu-id="efa74-133">本節將討論下列主題。</span><span class="sxs-lookup"><span data-stu-id="efa74-133">The following topics are discussed in this section.</span></span>

-   [<span data-ttu-id="efa74-134">檔案名和目錄</span><span class="sxs-lookup"><span data-stu-id="efa74-134">File Names and Directories</span></span>](#file-names-and-directories)
-   [<span data-ttu-id="efa74-135">篩選條件</span><span class="sxs-lookup"><span data-stu-id="efa74-135">Filters</span></span>](#filters)
-   [<span data-ttu-id="efa74-136">檔案和目錄驗證</span><span class="sxs-lookup"><span data-stu-id="efa74-136">File and Directory Validation</span></span>](#file-and-directory-validation)
-   [<span data-ttu-id="efa74-137">開啟並另存新檔對話方塊自訂</span><span class="sxs-lookup"><span data-stu-id="efa74-137">Open and Save As Dialog Box Customization</span></span>](#open-and-save-as-dialog-box-customization)
-   [<span data-ttu-id="efa74-138">Explorer 樣式的勾點程式</span><span class="sxs-lookup"><span data-stu-id="efa74-138">Explorer-Style Hook Procedures</span></span>](#explorer-style-hook-procedures)
-   [<span data-ttu-id="efa74-139">Explorer 樣式的自訂範本</span><span class="sxs-lookup"><span data-stu-id="efa74-139">Explorer-Style Custom Templates</span></span>](#explorer-style-custom-templates)
-   [<span data-ttu-id="efa74-140">Explorer 樣式控制項識別碼</span><span class="sxs-lookup"><span data-stu-id="efa74-140">Explorer-Style Control Identifiers</span></span>](#explorer-style-control-identifiers)
-   [<span data-ttu-id="efa74-141">自訂 Old-Style 對話方塊</span><span class="sxs-lookup"><span data-stu-id="efa74-141">Customizing Old-Style Dialog Boxes</span></span>](#customizing-old-style-dialog-boxes)

## <a name="file-names-and-directories"></a><span data-ttu-id="efa74-142">檔案名和目錄</span><span class="sxs-lookup"><span data-stu-id="efa74-142">File Names and Directories</span></span>

<span data-ttu-id="efa74-143">本節中的資訊適用于 Explorer 樣式和舊樣式的 [ **開啟** ] 和 [ **另存** 新檔] 對話方塊。</span><span class="sxs-lookup"><span data-stu-id="efa74-143">The information in this section applies to both Explorer-style and old-style **Open** and **Save As** dialog boxes.</span></span>

<span data-ttu-id="efa74-144">在呼叫 [**GetOpenFileName**](/windows/desktop/api/Commdlg/nf-commdlg-getopenfilenamea)或 [**GetSaveFileName**](/windows/desktop/api/Commdlg/nf-commdlg-getsavefilenamea)函式之前， [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea)結構的 **lpstrFile** 成員必須指向緩衝區才能接收檔案名。</span><span class="sxs-lookup"><span data-stu-id="efa74-144">Before calling the [**GetOpenFileName**](/windows/desktop/api/Commdlg/nf-commdlg-getopenfilenamea) or [**GetSaveFileName**](/windows/desktop/api/Commdlg/nf-commdlg-getsavefilenamea) functions, the **lpstrFile** member of the [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) structure must point to the buffer to receive the file name.</span></span> <span data-ttu-id="efa74-145">**NMaxFile** 成員必須指定 **lpstrFile** 緩衝區的大小（以字元為單位）。</span><span class="sxs-lookup"><span data-stu-id="efa74-145">The **nMaxFile** member must specify the size, in characters, of the **lpstrFile** buffer.</span></span> <span data-ttu-id="efa74-146">若為 ANSI 函數，這是位元組的數目，但對於 Unicode 函式，這是字元數。</span><span class="sxs-lookup"><span data-stu-id="efa74-146">For an ANSI function this is the number of bytes, but for a Unicode function this is the number of characters.</span></span>

<span data-ttu-id="efa74-147">如果使用者指定檔案名，然後按一下 [ **確定]** 按鈕，此對話方塊會將選取的磁片磁碟機、目錄和檔案名複製到 **lpstrFile** 緩衝區。</span><span class="sxs-lookup"><span data-stu-id="efa74-147">If the user specifies a file name and clicks the **OK** button, the dialog box copies the selected drive, directory, and file name to the **lpstrFile** buffer.</span></span> <span data-ttu-id="efa74-148">函式也會將 **nFileOffset** 和 **nFileExtension** 成員分別設定為從緩衝區開頭到檔案名和副檔名的位移（以字元為單位）。</span><span class="sxs-lookup"><span data-stu-id="efa74-148">The function also sets the **nFileOffset** and **nFileExtension** members to the offsets, in characters, from the start of the buffer to the file name and to the file name extension, respectively.</span></span>

<span data-ttu-id="efa74-149">若只取出檔案名和副檔名，請將 **lpstrFileTitle** 成員設定為指向緩衝區，並將 **nMaxFileTitle** 成員設定為緩衝區的大小（以字元為單位）。</span><span class="sxs-lookup"><span data-stu-id="efa74-149">To retrieve just the file name and extension, set the **lpstrFileTitle** member to point to a buffer and set the **nMaxFileTitle** member to the size, in characters, of the buffer.</span></span> <span data-ttu-id="efa74-150">或者，您可以在 [**GetFileTitle**](/windows/desktop/api/Commdlg/nf-commdlg-getfiletitlea)函式的呼叫中傳遞 **lpstrFile** 緩衝區，以取得所選檔案的顯示名稱。</span><span class="sxs-lookup"><span data-stu-id="efa74-150">Alternatively, you can pass the **lpstrFile** buffer in a call to the [**GetFileTitle**](/windows/desktop/api/Commdlg/nf-commdlg-getfiletitlea) function to get the display name of the selected file.</span></span> <span data-ttu-id="efa74-151">不過請注意， **GetFileTitle** 傳回的檔案名只有在使用者偏好顯示檔案名時，才會包含副檔名。</span><span class="sxs-lookup"><span data-stu-id="efa74-151">Note, however, that the file name that **GetFileTitle** returns includes an extension only if that is the user's preference for displaying file names.</span></span>

<span data-ttu-id="efa74-152">對話方塊會使用目前目錄做為呼叫進程的初始目錄，以從中顯示檔案和目錄。</span><span class="sxs-lookup"><span data-stu-id="efa74-152">The dialog box uses the current directory for the calling process as the initial directory from which to display files and directories.</span></span> <span data-ttu-id="efa74-153">您可以使用 [**GetCurrentDirectory**](/windows/desktop/api/winbase/nf-winbase-getcurrentdirectory) 和 [**>setcurrentdirectory**](/windows/desktop/api/winbase/nf-winbase-setcurrentdirectory) 函數來取得和變更進程的目前的目錄。</span><span class="sxs-lookup"><span data-stu-id="efa74-153">Use the [**GetCurrentDirectory**](/windows/desktop/api/winbase/nf-winbase-getcurrentdirectory) and [**SetCurrentDirectory**](/windows/desktop/api/winbase/nf-winbase-setcurrentdirectory) functions to get and change the current directory of a process.</span></span> <span data-ttu-id="efa74-154">若要指定不同的初始目錄，而不變更您目前的目錄，請使用 **lpstrInitialDir** 成員指定目錄的名稱。</span><span class="sxs-lookup"><span data-stu-id="efa74-154">To specify a different initial directory without changing your current directory, use the **lpstrInitialDir** member to specify the name of a directory.</span></span> <span data-ttu-id="efa74-155">當使用者選取不同的磁片磁碟機或目錄時，對話方塊會自動變更您目前的目錄。</span><span class="sxs-lookup"><span data-stu-id="efa74-155">The dialog box automatically changes your current directory when the user selects a different drive or directory.</span></span> <span data-ttu-id="efa74-156">若要防止對話方塊變更您目前的目錄，請設定 **OFN \_ NOCHANGEDIR** 旗標。</span><span class="sxs-lookup"><span data-stu-id="efa74-156">To prevent the dialog box from changing your current directory, set the **OFN\_NOCHANGEDIR** flag.</span></span> <span data-ttu-id="efa74-157">此旗標不會防止使用者變更目錄以尋找檔案。</span><span class="sxs-lookup"><span data-stu-id="efa74-157">This flag does not prevent the user from changing directories to find a file.</span></span>

<span data-ttu-id="efa74-158">若要指定預設副檔名，請使用 **lpstrDefExt** 成員。</span><span class="sxs-lookup"><span data-stu-id="efa74-158">To specify a default file name extension, use the **lpstrDefExt** member.</span></span> <span data-ttu-id="efa74-159">如果使用者指定的檔案名沒有副檔名，對話方塊會加入您的預設副檔名。</span><span class="sxs-lookup"><span data-stu-id="efa74-159">If the user specifies a file name that does not have an extension, the dialog box adds your default extension.</span></span> <span data-ttu-id="efa74-160">如果您指定了預設副檔名，而使用者指定副檔名不同的檔案名，則對話方塊會設定 **OFN \_ EXTENSIONDIFFERENT** 旗標。</span><span class="sxs-lookup"><span data-stu-id="efa74-160">If you specify a default extension and the user specifies a file name with a different extension, the dialog box sets the **OFN\_EXTENSIONDIFFERENT** flag.</span></span>

<span data-ttu-id="efa74-161">若要讓使用者從目錄中選取一個以上的檔案，請設定 **OFN \_ ALLOWMULTISELECT** 旗標。</span><span class="sxs-lookup"><span data-stu-id="efa74-161">To let the user select more than one file from a directory, set the **OFN\_ALLOWMULTISELECT** flag.</span></span> <span data-ttu-id="efa74-162">為了與繼承應用程式相容，預設的多重選取對話方塊會使用舊樣式的使用者介面。</span><span class="sxs-lookup"><span data-stu-id="efa74-162">For compatibility with older applications, the default multiple selection dialog box uses the old-style user interface.</span></span> <span data-ttu-id="efa74-163">若要顯示 [Explorer 樣式的多重選取專案] 對話方塊，您也必須設定 **OFN \_ Explorer** 旗標。</span><span class="sxs-lookup"><span data-stu-id="efa74-163">To display an Explorer-style multiple selection dialog box, you must also set the **OFN\_EXPLORER** flag.</span></span>

<span data-ttu-id="efa74-164">如果使用者選取一個以上的檔案， **lpstrFile** 成員指向的緩衝區會傳回目前目錄的路徑，後面接著所選檔案的檔案名。</span><span class="sxs-lookup"><span data-stu-id="efa74-164">If the user selects more than one file, the buffer pointed to by the **lpstrFile** member returns the path to the current directory followed by the file names of the selected files.</span></span> <span data-ttu-id="efa74-165">**NFileOffset** 成員是第一個檔案名的位移，且不會使用 **nFileExtension** 成員。</span><span class="sxs-lookup"><span data-stu-id="efa74-165">The **nFileOffset** member is the offset to the first file name, and the **nFileExtension** member is not used.</span></span> <span data-ttu-id="efa74-166">下表描述在傳回多個檔案名時，Explorer 樣式和舊樣式對話方塊之間的差異。</span><span class="sxs-lookup"><span data-stu-id="efa74-166">The following table describes the difference between Explorer-style and old-style dialog boxes in returning multiple file names.</span></span>



| <span data-ttu-id="efa74-167">對話方塊樣式</span><span class="sxs-lookup"><span data-stu-id="efa74-167">Dialog box style</span></span>            | <span data-ttu-id="efa74-168">Description</span><span class="sxs-lookup"><span data-stu-id="efa74-168">Description</span></span>                                                                                                                                                                                                               |
|-----------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="efa74-169">Explorer 樣式對話方塊</span><span class="sxs-lookup"><span data-stu-id="efa74-169">Explorer-style dialog boxes</span></span> | <span data-ttu-id="efa74-170">目錄和檔案名字串會以 **null** 分隔，並在最後一個檔案名之後加上額外的 **Null** 字元。</span><span class="sxs-lookup"><span data-stu-id="efa74-170">The directory and file name strings are **NULL** separated, with an extra **NULL** character after the last file name.</span></span> <span data-ttu-id="efa74-171">此格式可讓 Explorer 樣式的對話方塊傳回包含空格的長檔名。</span><span class="sxs-lookup"><span data-stu-id="efa74-171">This format enables the Explorer-style dialog boxes to return long file names that include spaces.</span></span> |
| <span data-ttu-id="efa74-172">舊樣式對話方塊</span><span class="sxs-lookup"><span data-stu-id="efa74-172">Old-style dialog boxes</span></span>      | <span data-ttu-id="efa74-173">目錄和檔案名字串會以空格分隔。</span><span class="sxs-lookup"><span data-stu-id="efa74-173">The directory and file name strings are separated by spaces.</span></span> <span data-ttu-id="efa74-174">對於具有空格的檔案名，此函式會使用簡短的檔案名。</span><span class="sxs-lookup"><span data-stu-id="efa74-174">For file names with spaces, the function uses short file names.</span></span>                                                                                              |



 

<span data-ttu-id="efa74-175">您可以使用 [**FindFirstFile**](/windows/desktop/api/fileapi/nf-fileapi-findfirstfilea) 函數，在 long 和 short 檔案名之間進行轉換。</span><span class="sxs-lookup"><span data-stu-id="efa74-175">You can use the [**FindFirstFile**](/windows/desktop/api/fileapi/nf-fileapi-findfirstfilea) function to convert between long and short file names.</span></span>

<span data-ttu-id="efa74-176">如果您指定 **OFN \_ ALLOWMULTISELECT** ，而使用者只選取一個檔案，則 **lpstrFile** 字串的路徑和檔案名之間沒有分隔符號。</span><span class="sxs-lookup"><span data-stu-id="efa74-176">If you specify **OFN\_ALLOWMULTISELECT** and the user selects only one file, the **lpstrFile** string does not have a separator between the path and file name.</span></span>

## <a name="filters"></a><span data-ttu-id="efa74-177">篩選</span><span class="sxs-lookup"><span data-stu-id="efa74-177">Filters</span></span>

<span data-ttu-id="efa74-178">本節中的資訊適用于 Explorer 樣式和舊樣式的 [ **開啟** ] 和 [ **另存** 新檔] 對話方塊。</span><span class="sxs-lookup"><span data-stu-id="efa74-178">The information in this section applies to both Explorer-style and old style **Open** and **Save As** dialog boxes.</span></span>

<span data-ttu-id="efa74-179">您可以提供檔案名篩選器，協助使用者限制對話方塊所顯示的檔案名。</span><span class="sxs-lookup"><span data-stu-id="efa74-179">You can provide file name filters to assist the user in limiting the file names that the dialog box displays.</span></span> <span data-ttu-id="efa74-180">檔案名篩選器是由一對以 null 終止的字串、描述和模式所組成，其中一個會串連至另一個。</span><span class="sxs-lookup"><span data-stu-id="efa74-180">A file name filter consists of a pair of null-terminated strings, a description and a pattern, one concatenated to the other.</span></span> <span data-ttu-id="efa74-181">對話方塊會顯示描述，讓使用者挑選要使用的篩選準則;它會使用模式來選取要顯示的檔案。</span><span class="sxs-lookup"><span data-stu-id="efa74-181">The dialog box displays the description to let the user pick which filter to use; and it uses the pattern to select the files to display.</span></span>

<span data-ttu-id="efa74-182">若要指定篩選，請將 [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea)結構的 **lpstrFilter** 成員設定為指向包含篩選字串組陣列的緩衝區。</span><span class="sxs-lookup"><span data-stu-id="efa74-182">To specify the filters, set the **lpstrFilter** member of the [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) structure to point to a buffer that contains an array of filter string pairs.</span></span> <span data-ttu-id="efa74-183">陣列中的最後一個字串後面必須接著額外的 null 字元。</span><span class="sxs-lookup"><span data-stu-id="efa74-183">The last string in the array must be followed by an extra null character.</span></span>

<span data-ttu-id="efa74-184">模式字串可以是有效檔案名字元和星號 () 的組合 \* 。</span><span class="sxs-lookup"><span data-stu-id="efa74-184">A pattern string can be a combination of valid file name characters and the asterisk (\*).</span></span> <span data-ttu-id="efa74-185">星號是萬用字元，代表有效檔案名字元的任何組合。</span><span class="sxs-lookup"><span data-stu-id="efa74-185">The asterisk is a wildcard that represents any combination of valid file name characters.</span></span> <span data-ttu-id="efa74-186">對話方塊只會顯示符合模式的檔案。</span><span class="sxs-lookup"><span data-stu-id="efa74-186">The dialog box displays only those files that match the pattern.</span></span> <span data-ttu-id="efa74-187">若要為相同的描述指定多個模式，您必須使用分號 (; ) 來分隔模式。</span><span class="sxs-lookup"><span data-stu-id="efa74-187">To specify multiple patterns for the same description, you must use a semicolon (;) to separate the patterns.</span></span> <span data-ttu-id="efa74-188">請注意，模式字串中的空白字元可能會產生非預期的結果。</span><span class="sxs-lookup"><span data-stu-id="efa74-188">Note that space characters in the pattern string can produce unexpected results.</span></span>

<span data-ttu-id="efa74-189">下列程式碼片段會指定兩個篩選準則。</span><span class="sxs-lookup"><span data-stu-id="efa74-189">The following code fragment specifies two filters.</span></span> <span data-ttu-id="efa74-190">具有「來源」描述的篩選具有兩種模式。</span><span class="sxs-lookup"><span data-stu-id="efa74-190">The filter with the "Source" description has two patterns.</span></span> <span data-ttu-id="efa74-191">如果使用者選取此篩選準則，對話方塊只會顯示具有的檔案。C 和。CXX 延伸模組。</span><span class="sxs-lookup"><span data-stu-id="efa74-191">If the user selects this filter, the dialog box displays only files that have the .C and .CXX extensions.</span></span> <span data-ttu-id="efa74-192">請注意，在 C 程式設計語言中，以雙引號括住的字串會以 null 終止。</span><span class="sxs-lookup"><span data-stu-id="efa74-192">Note, in the C programming language, a string enclosed in double quotes is null-terminated.</span></span>


```
OPENFILENAME ofn;       // common dialog box structure

ofn.lpstrFilter = "Source\0*.C;*.CXX\0All\0*.*\0"
ofn.nFilterIndex = 1;
```



<span data-ttu-id="efa74-193">[**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea)結構的 **nFilterIndex** 成員會指定索引，以指出對話方塊一開始所使用的篩選準則。</span><span class="sxs-lookup"><span data-stu-id="efa74-193">The **nFilterIndex** member of the [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) structure specifies an index that indicates which filter the dialog box initially uses.</span></span> <span data-ttu-id="efa74-194">緩衝區中的第一個篩選具有索引1，第二個則是2，依此類推。</span><span class="sxs-lookup"><span data-stu-id="efa74-194">The first filter in the buffer has index 1, the second 2, and so on.</span></span> <span data-ttu-id="efa74-195">如果使用者在使用對話方塊時變更篩選， **nFilterIndex** 成員就會在傳回時設定為所選篩選準則的索引。</span><span class="sxs-lookup"><span data-stu-id="efa74-195">If the user changes the filter while using the dialog box, the **nFilterIndex** member is set to the index of the selected filter on return.</span></span>

<span data-ttu-id="efa74-196">您可以建立自訂篩選，方法是將 **lpstrCustomFilter** 成員設定為包含單一篩選的緩衝區位址，並將 **nMaxCustFilter** 成員設定為緩衝區的大小（以字元或位元組為單位）。</span><span class="sxs-lookup"><span data-stu-id="efa74-196">You can create a custom filter by setting the **lpstrCustomFilter** member to the address of a buffer that contains a single filter, and by setting the **nMaxCustFilter** member to the size of the buffer, in characters or bytes.</span></span> <span data-ttu-id="efa74-197">對話方塊一律會將自訂篩選準則放在篩選清單的開頭，而在傳回時，一律會以使用者選取之篩選準則的模式來更新篩選的模式部分。</span><span class="sxs-lookup"><span data-stu-id="efa74-197">The dialog box always places the custom filter at the beginning of the list of filters and, on return, always updates the pattern part of the filter with the pattern from the filter selected by the user.</span></span>

<span data-ttu-id="efa74-198">若為 Explorer 樣式的對話方塊，當使用者選取不同的篩選時，預設的擴充功能可能會變更。</span><span class="sxs-lookup"><span data-stu-id="efa74-198">For Explorer-style dialog boxes, the default extension may change if the user selects a different filter.</span></span> <span data-ttu-id="efa74-199">如果使用者選取的篩選器的第一個模式是表單 \* 。*xxx* (也就是，延伸不包含萬用字元) ，此對話方塊會使用 *xxx* 作為預設副檔名。</span><span class="sxs-lookup"><span data-stu-id="efa74-199">If the user selects a filter whose first pattern is of the form \*.*xxx* (that is, the extension does not include a wildcard character), the dialog box uses *xxx* as the default extension.</span></span> <span data-ttu-id="efa74-200">只有當您在 [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea)結構的 **lpstrDefExt** 成員中指定了預設副檔名時，才會發生這種情況。</span><span class="sxs-lookup"><span data-stu-id="efa74-200">This occurs only if you specified a default extension in the **lpstrDefExt** member of the [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) structure.</span></span> <span data-ttu-id="efa74-201">例如，如果使用者選取 [來源 \\ 0] \* 。C; \* 。CXX \\ 0 "filter，預設延伸模組會變更為" C "。</span><span class="sxs-lookup"><span data-stu-id="efa74-201">For example, if the user selects the "Source\\0\*.C;\*.CXX\\0" filter, the default extension changes to "C".</span></span> <span data-ttu-id="efa74-202">但是，如果您已經將篩選定義為「來源 \\ 0」 \* 。C \* \\ 0」，預設擴充功能不會變更，因為擴充功能包含萬用字元。</span><span class="sxs-lookup"><span data-stu-id="efa74-202">However, if you had defined the filter as "Source\\0\*.C\*\\0", the default extension would not change because the extension includes a wildcard.</span></span>

<span data-ttu-id="efa74-203">[**CDN \_ INCLUDEITEM**](cdn-includeitem.md)通知訊息提供另一種方式來篩選對話方塊所顯示的名稱。</span><span class="sxs-lookup"><span data-stu-id="efa74-203">The [**CDN\_INCLUDEITEM**](cdn-includeitem.md) notification message provides another way to filter the names that the dialog box displays.</span></span> <span data-ttu-id="efa74-204">若要使用此訊息，請在建立對話方塊時，提供 [**OFNHookProc**](/windows/win32/api/commdlg/nc-commdlg-lpofnhookproc)攔截程式，並在 [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea)結構中指定 **OFN \_ ENABLEINCLUDENOTIFY** 旗標。</span><span class="sxs-lookup"><span data-stu-id="efa74-204">To use this message, provide an [**OFNHookProc**](/windows/win32/api/commdlg/nc-commdlg-lpofnhookproc) hook procedure and specify the **OFN\_ENABLEINCLUDENOTIFY** flag in the [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) structure when you create the dialog box.</span></span> <span data-ttu-id="efa74-205">每次使用者開啟資料夾時，對話方塊都會針對新開啟之資料夾中的每個專案，將 **CDN \_ INCLUDEITEM** 通知傳送至您的勾點程式。</span><span class="sxs-lookup"><span data-stu-id="efa74-205">Each time the user opens a folder, the dialog box sends a **CDN\_INCLUDEITEM** notification to your hook procedure for each item in the newly opened folder.</span></span> <span data-ttu-id="efa74-206">攔截程式的傳回值指出對話方塊是否應該在資料夾的專案清單中顯示專案。</span><span class="sxs-lookup"><span data-stu-id="efa74-206">The return value of the hook procedure indicates whether the dialog box should display the item in the folder's item list.</span></span>

## <a name="file-and-directory-validation"></a><span data-ttu-id="efa74-207">檔案和目錄驗證</span><span class="sxs-lookup"><span data-stu-id="efa74-207">File and Directory Validation</span></span>

<span data-ttu-id="efa74-208">除了所述，本節中的資訊也適用于 Explorer 樣式和舊樣式的 [ **開啟** ] 和 [ **另存** 新檔] 對話方塊。</span><span class="sxs-lookup"><span data-stu-id="efa74-208">Except as noted, the information in this section applies to both Explorer-style and old-style **Open** and **Save As** dialog boxes.</span></span>

<span data-ttu-id="efa74-209">對話方塊會自動驗證使用者輸入的檔案名，以確保名稱只包含有效的字元。</span><span class="sxs-lookup"><span data-stu-id="efa74-209">The dialog box automatically validates file names typed by the user to ensure that the names contain only valid characters.</span></span> <span data-ttu-id="efa74-210">若要覆寫檔案名字元驗證，請設定 **OFN \_ NOVALIDATE** 旗標。</span><span class="sxs-lookup"><span data-stu-id="efa74-210">To override the file name character validation, set the **OFN\_NOVALIDATE** flag.</span></span>

<span data-ttu-id="efa74-211">若要強制對話方塊確認使用者是否指定了現有檔案的名稱，請設定 **OFN \_ FILEMUSTEXIST** 旗標。</span><span class="sxs-lookup"><span data-stu-id="efa74-211">To force the dialog box to verify that the user specified the name of an existing file, set the **OFN\_FILEMUSTEXIST** flag.</span></span> <span data-ttu-id="efa74-212">若要強制驗證指定的路徑存在，請設定 **OFN \_ PATHMUSTEXIST** 旗標。</span><span class="sxs-lookup"><span data-stu-id="efa74-212">To force verification that the specified path exists, set the **OFN\_PATHMUSTEXIST** flag.</span></span> <span data-ttu-id="efa74-213">如果您設定 **OFN \_ CREATEPROMPT** 旗標，對話方塊會提示使用者建立不存在的檔案的許可權。</span><span class="sxs-lookup"><span data-stu-id="efa74-213">If you set the **OFN\_CREATEPROMPT** flag, the dialog box prompts the user for permission to create a nonexistent file.</span></span> <span data-ttu-id="efa74-214">如果設定此旗標，且使用者選擇建立新的檔案，則會關閉對話方塊，而且此函式會傳回指定的名稱。</span><span class="sxs-lookup"><span data-stu-id="efa74-214">If this flag is set and the user chooses to create a new file, the dialog box closes, and the function returns the specified name.</span></span> <span data-ttu-id="efa74-215">否則，對話方塊會保持開啟狀態。</span><span class="sxs-lookup"><span data-stu-id="efa74-215">Otherwise, the dialog box remains open.</span></span>

<span data-ttu-id="efa74-216">當您使用 [ **另存** 新檔] 對話方塊時，可以指示對話方塊提示使用者透過設定 **OFN \_ OVERWRITEPROMPT** 旗標來覆寫現有檔案的許可權。</span><span class="sxs-lookup"><span data-stu-id="efa74-216">When using the **Save As** dialog box, you can direct the dialog box to prompt the user for permission to overwrite an existing file by setting the **OFN\_OVERWRITEPROMPT** flag.</span></span>

<span data-ttu-id="efa74-217">根據預設，對話方塊會建立長度為零的測試檔案，以判斷是否可以在選取的目錄中建立新檔案。</span><span class="sxs-lookup"><span data-stu-id="efa74-217">By default, the dialog box creates a zero-length test file to determine whether a new file can be created in the selected directory.</span></span> <span data-ttu-id="efa74-218">若要避免建立此測試檔案，請設定 **OFN \_ NOTESTFILECREATE** 旗標。</span><span class="sxs-lookup"><span data-stu-id="efa74-218">To prevent the creation of this test file, set the **OFN\_NOTESTFILECREATE** flag.</span></span>

<span data-ttu-id="efa74-219">如果您啟用攔截程式，此對話方塊會在使用者指定的檔案名發生網路共用違規時，通知您的攔截程式。</span><span class="sxs-lookup"><span data-stu-id="efa74-219">If you enable a hook procedure, the dialog box notifies your hook procedure when a network sharing violation occurs for the file name specified by the user.</span></span> <span data-ttu-id="efa74-220">如果您設定 **OFN \_ EXPLORER** 旗標，此對話方塊會將 [**CDN \_ SHAREVIOLATION**](cdn-shareviolation.md) 訊息傳送到攔截程式。</span><span class="sxs-lookup"><span data-stu-id="efa74-220">If you set the **OFN\_EXPLORER** flag, the dialog box sends the [**CDN\_SHAREVIOLATION**](cdn-shareviolation.md) message to the hook procedure.</span></span> <span data-ttu-id="efa74-221">如果您未設定 **OFN \_ EXPLORER**，此對話方塊會將已註冊的 [**SHAREVISTRING**](sharevistring.md) 訊息傳送到攔截程式。</span><span class="sxs-lookup"><span data-stu-id="efa74-221">If you do not set **OFN\_EXPLORER**, the dialog box sends the [**SHAREVISTRING**](sharevistring.md) registered message to the hook procedure.</span></span> <span data-ttu-id="efa74-222">若要防止對話方塊傳送任何共用違規通知，請設定 **OFN \_ SHAREAWARE** 旗標。</span><span class="sxs-lookup"><span data-stu-id="efa74-222">To prevent the dialog box from sending any notifications for sharing violations, set the **OFN\_SHAREAWARE** flag.</span></span>

<span data-ttu-id="efa74-223">如果使用者選取 [唯讀] 核取方塊，對話方塊會在傳回時設定 **OFN \_ READONLY** 旗標。</span><span class="sxs-lookup"><span data-stu-id="efa74-223">If the user selects the read-only check box, the dialog box sets the **OFN\_READONLY** flag on return.</span></span> <span data-ttu-id="efa74-224">若要隱藏 [ **開啟為唯讀** ] 核取方塊，請 **設定 \_ OFN HIDEREADONLY** 旗標。</span><span class="sxs-lookup"><span data-stu-id="efa74-224">To hide the **Open As Read Only** check box, set the **OFN\_HIDEREADONLY** flag.</span></span> <span data-ttu-id="efa74-225">若要防止對話方塊傳回具有唯讀屬性之現有檔案的名稱，請設定 **OFN \_ NOREADONLYRETURN** 旗標。</span><span class="sxs-lookup"><span data-stu-id="efa74-225">To prevent the dialog box from returning names of existing files that have the read-only attribute, set the **OFN\_NOREADONLYRETURN** flag.</span></span>

<span data-ttu-id="efa74-226">若要防止對話方塊參考連結檔，請設定 **OFN \_ NODEREFERENCELINKS** 值。</span><span class="sxs-lookup"><span data-stu-id="efa74-226">To prevent the dialog box from dereferencing link files, set the **OFN\_NODEREFERENCELINKS** value.</span></span> <span data-ttu-id="efa74-227">在此情況下，對話方塊會傳回連結檔案的名稱，而不是連結檔案所參考的檔案名。</span><span class="sxs-lookup"><span data-stu-id="efa74-227">In this case, the dialog box returns the name of the link file rather than the name of the file referenced by the link file.</span></span>

## <a name="open-and-save-as-dialog-box-customization"></a><span data-ttu-id="efa74-228">開啟並另存新檔對話方塊自訂</span><span class="sxs-lookup"><span data-stu-id="efa74-228">Open and Save As Dialog Box Customization</span></span>

<span data-ttu-id="efa74-229">您可以藉由提供攔截程式、自訂範本或兩者來自訂 [ **開啟** ] 或 [ **另存** 新檔] 對話方塊。</span><span class="sxs-lookup"><span data-stu-id="efa74-229">You can customize an **Open** or **Save As** dialog box by providing a hook procedure, a custom template, or both.</span></span> <span data-ttu-id="efa74-230">不過，Explorer 樣式和舊樣式版本的對話方塊在使用自訂範本和攔截程式時不同。</span><span class="sxs-lookup"><span data-stu-id="efa74-230">However, the Explorer-style and old-style versions of the dialog boxes differ in their use of custom templates and hook procedures.</span></span>

<span data-ttu-id="efa74-231">如需自訂 Explorer 樣式對話方塊的詳細資訊，請參閱 [Explorer 樣式](#explorer-style-hook-procedures)的攔截程式、 [Explorer 樣式的自訂範本](#explorer-style-custom-templates)，以及 [explorer 樣式的控制項識別碼](#explorer-style-control-identifiers)。</span><span class="sxs-lookup"><span data-stu-id="efa74-231">For information about customizing an Explorer-style dialog box, see [Explorer-Style Hook Procedures](#explorer-style-hook-procedures), [Explorer-Style Custom Templates](#explorer-style-custom-templates), and [Explorer-Style Control Identifiers](#explorer-style-control-identifiers).</span></span> <span data-ttu-id="efa74-232">如需自訂舊樣式對話方塊的詳細資訊，請參閱 [自訂 Old-Style 對話方塊](#customizing-old-style-dialog-boxes)。</span><span class="sxs-lookup"><span data-stu-id="efa74-232">For information about customizing an old-style dialog box, see [Customizing Old-Style Dialog Boxes](#customizing-old-style-dialog-boxes).</span></span>

<span data-ttu-id="efa74-233">下表摘要說明這兩種樣式之間的差異。</span><span class="sxs-lookup"><span data-stu-id="efa74-233">The following table summarizes the differences between the two styles.</span></span>



| <span data-ttu-id="efa74-234">自訂</span><span class="sxs-lookup"><span data-stu-id="efa74-234">Customization</span></span>                  | <span data-ttu-id="efa74-235">Description</span><span class="sxs-lookup"><span data-stu-id="efa74-235">Description</span></span>                                                                                                                                                                                                                                                                          |
|--------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="efa74-236">Explorer 樣式的掛勾程式</span><span class="sxs-lookup"><span data-stu-id="efa74-236">Explorer-style Hook procedure</span></span>  | <span data-ttu-id="efa74-237">攔截程式會接收從通用對話方塊傳送的通知訊息，以及您藉由指定子對話方塊範本所定義之任何其他控制項的訊息。</span><span class="sxs-lookup"><span data-stu-id="efa74-237">The hook procedure receives notification messages sent from the common dialog box and messages for any additional controls that you defined by specifying a child dialog template.</span></span> <span data-ttu-id="efa74-238">攔截程式不會接收預設對話方塊之標準控制項的訊息。</span><span class="sxs-lookup"><span data-stu-id="efa74-238">The hook procedure does not receive messages for the standard controls of the default dialog box.</span></span> |
| <span data-ttu-id="efa74-239">Explorer 樣式的自訂範本</span><span class="sxs-lookup"><span data-stu-id="efa74-239">Explorer-style Custom template</span></span> | <span data-ttu-id="efa74-240">系統會使用自訂範本來建立子對話方塊。</span><span class="sxs-lookup"><span data-stu-id="efa74-240">The system uses the custom template to create a child dialog box.</span></span> <span data-ttu-id="efa74-241">範本可以定義其他控制項，也可以指定標準控制項叢集的位置。</span><span class="sxs-lookup"><span data-stu-id="efa74-241">The template can define additional controls, and can specify the location of the cluster of standard controls.</span></span> <span data-ttu-id="efa74-242">自訂範本不會取代預設範本。</span><span class="sxs-lookup"><span data-stu-id="efa74-242">The custom template does not replace the default template.</span></span>                                          |
| <span data-ttu-id="efa74-243">舊樣式的勾點程式</span><span class="sxs-lookup"><span data-stu-id="efa74-243">Old-style Hook procedure</span></span>       | <span data-ttu-id="efa74-244">攔截程式會接收所有傳送至對話方塊的訊息，包括標準控制項和任何自訂控制項的訊息。</span><span class="sxs-lookup"><span data-stu-id="efa74-244">The hook procedure receives all messages sent to the dialog box, including messages for the standard controls and any custom controls.</span></span> <span data-ttu-id="efa74-245">攔截程式也會接收從通用對話方塊傳送的已註冊訊息。</span><span class="sxs-lookup"><span data-stu-id="efa74-245">The hook procedure also receives registered messages sent from the common dialog box.</span></span>                                                         |
| <span data-ttu-id="efa74-246">舊樣式的自訂範本</span><span class="sxs-lookup"><span data-stu-id="efa74-246">Old-style Custom template</span></span>      | <span data-ttu-id="efa74-247">自訂範本會取代預設範本。</span><span class="sxs-lookup"><span data-stu-id="efa74-247">The custom template replaces the default template.</span></span> <span data-ttu-id="efa74-248">藉由修改 Fileopen 檔案中指定的預設範本來建立自訂範本。</span><span class="sxs-lookup"><span data-stu-id="efa74-248">Create the custom template by modifying the default template specified in the Fileopen.dlg file.</span></span>                                                                                                                                  |



 

<span data-ttu-id="efa74-249">Explorer 樣式和舊樣式對話方塊的預設標題為 [**開啟**] 或 [**另存** 新檔]。</span><span class="sxs-lookup"><span data-stu-id="efa74-249">The default title for both Explorer-style and old-style dialog boxes is either "**Open**" or "**Save As**."</span></span> <span data-ttu-id="efa74-250">若要變更標題，請在 [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea)結構的 **lpstrTitle** 成員中指定新的標題。</span><span class="sxs-lookup"><span data-stu-id="efa74-250">To change the title, specify the new title in the **lpstrTitle** member of the [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) structure.</span></span>

<span data-ttu-id="efa74-251">使用者的 **HKEY \_ 目前 \_ 使用者** 登錄 hive 可以包含值，這些值會自訂 Explorer 樣式 [ **開啟** ] 和 [ **另存** 新檔] 對話方塊的內容。</span><span class="sxs-lookup"><span data-stu-id="efa74-251">A user's **HKEY\_CURRENT\_USER** registry hive can contain values that customize the contents of the Explorer-style **Open** and **Save As** dialog boxes.</span></span> <span data-ttu-id="efa74-252">這些登錄專案只會影響與登錄 hive 相關聯的使用者所顯示的對話方塊。</span><span class="sxs-lookup"><span data-stu-id="efa74-252">These registry entries affect only the dialog boxes displayed for the user associated with the registry hive.</span></span>

<span data-ttu-id="efa74-253">若要隱藏 Explorer 樣式 [ **開啟** ] 和 [ **另存** 新檔] 對話方塊的功能，系統管理員可以在下列子機碼底下設定下表中的值：</span><span class="sxs-lookup"><span data-stu-id="efa74-253">To hide features of Explorer-style **Open** and **Save As** dialog boxes, an administrator can set the values in the following table under this subkey:</span></span>

```
HKEY_CURRENT_USER
   Software
      Microsoft
         Windows
            CurrentVersion
               Policies
                  Comdlg32
```



| <span data-ttu-id="efa74-254">值名稱</span><span class="sxs-lookup"><span data-stu-id="efa74-254">Value name</span></span>       | <span data-ttu-id="efa74-255">值</span><span class="sxs-lookup"><span data-stu-id="efa74-255">Value</span></span> | <span data-ttu-id="efa74-256">意義</span><span class="sxs-lookup"><span data-stu-id="efa74-256">Meaning</span></span>                                  |
|------------------|-------|------------------------------------------|
| <span data-ttu-id="efa74-257">**NoPlacesBar**</span><span class="sxs-lookup"><span data-stu-id="efa74-257">**NoPlacesBar**</span></span>  | <span data-ttu-id="efa74-258">1</span><span class="sxs-lookup"><span data-stu-id="efa74-258">1</span></span>     | <span data-ttu-id="efa74-259">隱藏位置列。</span><span class="sxs-lookup"><span data-stu-id="efa74-259">Hides the places bar.</span></span>                    |
| <span data-ttu-id="efa74-260">**NoFileMRU**</span><span class="sxs-lookup"><span data-stu-id="efa74-260">**NoFileMRU**</span></span>    | <span data-ttu-id="efa74-261">1</span><span class="sxs-lookup"><span data-stu-id="efa74-261">1</span></span>     | <span data-ttu-id="efa74-262">隱藏最近使用的 (MRU) 清單。</span><span class="sxs-lookup"><span data-stu-id="efa74-262">Hides the Most Recently Used (MRU) list.</span></span> |
| <span data-ttu-id="efa74-263">**NoBackButton**</span><span class="sxs-lookup"><span data-stu-id="efa74-263">**NoBackButton**</span></span> | <span data-ttu-id="efa74-264">1</span><span class="sxs-lookup"><span data-stu-id="efa74-264">1</span></span>     | <span data-ttu-id="efa74-265">隱藏 [ **上一步** ] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="efa74-265">Hides the **Back** button.</span></span>               |



 

<span data-ttu-id="efa74-266">**位置** 列的內容取決於下列子機碼的內容：</span><span class="sxs-lookup"><span data-stu-id="efa74-266">The contents of the **Places** bar are determined by the contents of the following subkey:</span></span>

```
HKEY_CURRENT_USER
   Software
      Microsoft
         Windows
            CurrentVersion
               Policies
                  Comdlg32
                     Placesbar
```

<span data-ttu-id="efa74-267">目前，此機碼下只能有五個專案，而值/名稱索引是以零為基底。</span><span class="sxs-lookup"><span data-stu-id="efa74-267">Currently, there can only be five entries under this key, and the value/name index is zero-based.</span></span> <span data-ttu-id="efa74-268">專案的名稱應為 Place0、Place1、Place2、Place3 和 Place4。</span><span class="sxs-lookup"><span data-stu-id="efa74-268">The names for the entries should be Place0, Place1, Place2,Place3, and Place4.</span></span> <span data-ttu-id="efa74-269">專案的值可以是 **REG \_ DWORD**、 **reg \_ SZ** 或 **reg \_ 展開 \_ SZ** 值，以識別要包含在位置列的位置。</span><span class="sxs-lookup"><span data-stu-id="efa74-269">The values of the entries can be **REG\_DWORD**, **REG\_SZ**, or **REG\_EXPAND\_SZ** values that identify locations to include in the places bar.</span></span>



| <span data-ttu-id="efa74-270">值類型</span><span class="sxs-lookup"><span data-stu-id="efa74-270">Value type</span></span>                         | <span data-ttu-id="efa74-271">意義</span><span class="sxs-lookup"><span data-stu-id="efa74-271">Meaning</span></span>                                                                                                   |
|------------------------------------|-----------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="efa74-272">**REG \_ DWORD**</span><span class="sxs-lookup"><span data-stu-id="efa74-272">**REG\_DWORD**</span></span>                     | <span data-ttu-id="efa74-273">識別資料夾的 CSIDL 值。</span><span class="sxs-lookup"><span data-stu-id="efa74-273">A CSIDL value that identifies a folder.</span></span> <span data-ttu-id="efa74-274">如需 CSIDL 值的清單，請參閱 [**CSIDL 值**](../shell/csidl.md)。</span><span class="sxs-lookup"><span data-stu-id="efa74-274">For a list of CSIDL values, see [**CSIDL values**](../shell/csidl.md).</span></span> |
| <span data-ttu-id="efa74-275">**REG \_SZ** 或 **REG \_ EXPAND \_ sz**</span><span class="sxs-lookup"><span data-stu-id="efa74-275">**REG\_SZ** or **REG\_EXPAND\_SZ**</span></span> | <span data-ttu-id="efa74-276">以 null 終止的字串，指定有效的路徑。</span><span class="sxs-lookup"><span data-stu-id="efa74-276">A null-terminated string that specifies a valid path.</span></span>                                                     |



 

## <a name="explorer-style-hook-procedures"></a><span data-ttu-id="efa74-277">Explorer-Style 攔截程式</span><span class="sxs-lookup"><span data-stu-id="efa74-277">Explorer-Style Hook Procedures</span></span>

<span data-ttu-id="efa74-278">您可以藉由提供攔截程式、自訂範本或兩者來自訂 Explorer 樣式的 [ **開啟** ] 或 [ **另存** 新檔] 對話方塊。</span><span class="sxs-lookup"><span data-stu-id="efa74-278">You can customize an Explorer-style **Open** or **Save As** dialog box by providing a hook procedure, a custom template, or both.</span></span> <span data-ttu-id="efa74-279">如果您為 Explorer 樣式的對話方塊提供攔截程式，系統會建立一個對話方塊，做為預設對話方塊的子系。</span><span class="sxs-lookup"><span data-stu-id="efa74-279">If you provide a hook procedure for an Explorer-style dialog box, the system creates a dialog box that is a child of the default dialog box.</span></span> <span data-ttu-id="efa74-280">攔截程式可作為子對話方塊的對話方塊程式。</span><span class="sxs-lookup"><span data-stu-id="efa74-280">The hook procedure acts as the dialog procedure for the child dialog box.</span></span> <span data-ttu-id="efa74-281">這個子對話方塊是以自訂範本為基礎，如果未提供則為預設範本。</span><span class="sxs-lookup"><span data-stu-id="efa74-281">This child dialog box is based on the custom template, or on a default template if none is provided.</span></span> <span data-ttu-id="efa74-282">如需詳細資訊，請參閱 [Explorer 樣式的自訂範本](#explorer-style-custom-templates)。</span><span class="sxs-lookup"><span data-stu-id="efa74-282">For more information, see [Explorer-Style Custom Templates](#explorer-style-custom-templates).</span></span>

<span data-ttu-id="efa74-283">若要啟用 Explorer 樣式 [ **開啟** ] 或 [ **另存** 新檔] 對話方塊的攔截程式，請在建立對話方塊時使用 [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) 結構。</span><span class="sxs-lookup"><span data-stu-id="efa74-283">To enable a hook procedure for an Explorer-style **Open** or **Save As** dialog box, use the [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) structure when you create the dialog box.</span></span> <span data-ttu-id="efa74-284">在 **旗標** 成員中設定 **OFN \_ ENABLEHOOK** 和 **OFN \_ EXPLORER** 旗標，並在 **lpfnHook** 成員中指定 [**OFNHookProc**](/windows/win32/api/commdlg/nc-commdlg-lpofnhookproc)攔截程式的位址。</span><span class="sxs-lookup"><span data-stu-id="efa74-284">Set the **OFN\_ENABLEHOOK** and **OFN\_EXPLORER** flags in the **Flags** member and specify the address of an [**OFNHookProc**](/windows/win32/api/commdlg/nc-commdlg-lpofnhookproc) hook procedure in the **lpfnHook** member.</span></span> <span data-ttu-id="efa74-285">如果您提供攔截程式並省略 **OFN \_ EXPLORER** 旗標，則必須使用 [**OFNHookProcOldStyle**](/previous-versions/windows/desktop/legacy/ms646932(v=vs.85)) 攔截程式，而您將會取得舊樣式的使用者介面。</span><span class="sxs-lookup"><span data-stu-id="efa74-285">If you provide a hook procedure and omit the **OFN\_EXPLORER** flag, you must use an [**OFNHookProcOldStyle**](/previous-versions/windows/desktop/legacy/ms646932(v=vs.85)) hook procedure and you will get the old-style user-interface.</span></span> <span data-ttu-id="efa74-286">如需詳細資訊，請參閱 [自訂 Old-Style 對話方塊](#customizing-old-style-dialog-boxes)。</span><span class="sxs-lookup"><span data-stu-id="efa74-286">For more information, see [Customizing Old-Style Dialog Boxes](#customizing-old-style-dialog-boxes).</span></span>

<span data-ttu-id="efa74-287">當對話方塊開啟時，Explorer 樣式的勾點程式會收到各種訊息。</span><span class="sxs-lookup"><span data-stu-id="efa74-287">An Explorer-style hook procedure receives a variety of messages while the dialog box is open.</span></span> <span data-ttu-id="efa74-288">這些選項包括：</span><span class="sxs-lookup"><span data-stu-id="efa74-288">These include the following:</span></span>

-   <span data-ttu-id="efa74-289">[**Wm \_ INITDIALOG**](wm-initdialog.md)訊息和其他標準對話方塊訊息，例如 [**wm \_ CTLCOLORDLG**](wm-ctlcolordlg.md) control color message。</span><span class="sxs-lookup"><span data-stu-id="efa74-289">The [**WM\_INITDIALOG**](wm-initdialog.md) message and other standard dialog box messages such as the [**WM\_CTLCOLORDLG**](wm-ctlcolordlg.md) control color message.</span></span>
-   <span data-ttu-id="efa74-290">一組 [**WM \_ 通知**](../controls/wm-notify.md) 通知訊息，表示使用者或其他對話方塊事件所採取的動作。</span><span class="sxs-lookup"><span data-stu-id="efa74-290">A set of [**WM\_NOTIFY**](../controls/wm-notify.md) notification messages indicating actions taken by the user or other dialog box events.</span></span>
-   <span data-ttu-id="efa74-291">您藉由指定子對話方塊範本所定義之任何其他控制項的訊息。</span><span class="sxs-lookup"><span data-stu-id="efa74-291">Messages for any additional controls that you defined by specifying a child dialog template.</span></span>

<span data-ttu-id="efa74-292">此外，也有一組訊息可傳送至 Explorer 樣式的對話方塊，以取得資訊或控制對話方塊的行為和外觀。</span><span class="sxs-lookup"><span data-stu-id="efa74-292">In addition, there is a set of messages that you can send to an Explorer-style dialog box to get information or to control the behavior and appearance of the dialog box.</span></span>

<span data-ttu-id="efa74-293">如果您為 [Explorer 樣式] 對話方塊提供攔截程式，則預設對話方塊程式在處理其 [**WM \_ INITDIALOG**](wm-initdialog.md) 訊息時，會建立子對話方塊。</span><span class="sxs-lookup"><span data-stu-id="efa74-293">If you provide a hook procedure for an Explorer-style dialog box, the default dialog box procedure creates a child dialog box when the default dialog procedure is processing its [**WM\_INITDIALOG**](wm-initdialog.md) message.</span></span> <span data-ttu-id="efa74-294">攔截程式可作為子對話方塊的對話方塊程式。</span><span class="sxs-lookup"><span data-stu-id="efa74-294">The hook procedure acts as the dialog procedure for the child dialog box.</span></span> <span data-ttu-id="efa74-295">此時，攔截程式會收到自己的 **WM \_ INITDIALOG** 訊息，並將 *lParam* 參數設定為用來初始化對話方塊的 [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) 結構位址。</span><span class="sxs-lookup"><span data-stu-id="efa74-295">At this time, the hook procedure receives its own **WM\_INITDIALOG** message with the *lParam* parameter set to the address of the [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) structure used to initialize the dialog box.</span></span> <span data-ttu-id="efa74-296">在子對話方塊完成處理自己的 **WM \_ INITDIALOG** 訊息之後，預設的對話方塊程式會視需要移動標準控制項，以騰出空間給子對話方塊的任何其他控制項。</span><span class="sxs-lookup"><span data-stu-id="efa74-296">After the child dialog finishes processing its own **WM\_INITDIALOG** message, the default dialog procedure moves the standard controls, if necessary, to make room for any additional controls of the child dialog box.</span></span> <span data-ttu-id="efa74-297">接著，預設的對話方塊程式會將 [**CDN \_ INITDONE**](cdn-initdone.md) 通知訊息傳送到攔截程式。</span><span class="sxs-lookup"><span data-stu-id="efa74-297">The default dialog procedure then sends the [**CDN\_INITDONE**](cdn-initdone.md) notification message to the hook procedure.</span></span>

<span data-ttu-id="efa74-298">攔截程式會收到 [**WM \_ 通知**](../controls/wm-notify.md) 通知訊息，指出使用者在對話方塊中採取的動作。</span><span class="sxs-lookup"><span data-stu-id="efa74-298">The hook procedure receives [**WM\_NOTIFY**](../controls/wm-notify.md) notification messages indicating actions taken by the user in the dialog box.</span></span> <span data-ttu-id="efa74-299">您可以使用其中一些訊息來控制對話方塊的行為。</span><span class="sxs-lookup"><span data-stu-id="efa74-299">You can use some of these messages to control the behavior of the dialog box.</span></span> <span data-ttu-id="efa74-300">例如，當使用者選擇檔案名，然後按一下 [**確定]** 按鈕時，攔截程式就會收到 [**CDN \_ FILEOK**](cdn-fileok.md)訊息。</span><span class="sxs-lookup"><span data-stu-id="efa74-300">For example, the hook procedure receives the [**CDN\_FILEOK**](cdn-fileok.md) message when the user chooses a file name and clicks the **OK** button.</span></span> <span data-ttu-id="efa74-301">為了回應此訊息，攔截程式可以使用 [**SetWindowLong**](/windows/desktop/api/winuser/nf-winuser-setwindowlonga) 函式來拒絕選取的名稱，並強制對話方塊維持開啟狀態。</span><span class="sxs-lookup"><span data-stu-id="efa74-301">In response to this message, the hook procedure can use the [**SetWindowLong**](/windows/desktop/api/winuser/nf-winuser-setwindowlonga) function to reject the selected name and force the dialog box to remain open.</span></span>

<span data-ttu-id="efa74-302">每個 [**WM \_ 通知**](../controls/wm-notify.md)訊息的 *lParam* 參數都是定義動作之 [**OFNOTIFY**](/windows/desktop/api/Commdlg/ns-commdlg-ofnotifya)或 [**OFNOTIFYEX**](/windows/desktop/api/Commdlg/ns-commdlg-ofnotifyexa)結構的指標。</span><span class="sxs-lookup"><span data-stu-id="efa74-302">The *lParam* parameter for each [**WM\_NOTIFY**](../controls/wm-notify.md) message is a pointer to an [**OFNOTIFY**](/windows/desktop/api/Commdlg/ns-commdlg-ofnotifya) or [**OFNOTIFYEX**](/windows/desktop/api/Commdlg/ns-commdlg-ofnotifyexa) structure that defines the action.</span></span> <span data-ttu-id="efa74-303">此結構的標頭中的程式 **代碼** 成員包含下列其中一項通知訊息。</span><span class="sxs-lookup"><span data-stu-id="efa74-303">The **code** member in the header of this structure contains one of the following notification messages.</span></span>



| <span data-ttu-id="efa74-304">訊息</span><span class="sxs-lookup"><span data-stu-id="efa74-304">Message</span></span>                                           | <span data-ttu-id="efa74-305">意義</span><span class="sxs-lookup"><span data-stu-id="efa74-305">Meaning</span></span>                                                                                                                                                                                                                                                                                        |
|---------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="efa74-306">**CDN \_ FILEOK**</span><span class="sxs-lookup"><span data-stu-id="efa74-306">**CDN\_FILEOK**</span></span>](cdn-fileok.md)                 | <span data-ttu-id="efa74-307">使用者按一下 [ **確定]** 按鈕;對話方塊即將關閉。</span><span class="sxs-lookup"><span data-stu-id="efa74-307">The user clicked the **OK** button; the dialog box is about to close.</span></span>                                                                                                                                                                                                                          |
| [<span data-ttu-id="efa74-308">**CDN \_ FOLDERCHANGE**</span><span class="sxs-lookup"><span data-stu-id="efa74-308">**CDN\_FOLDERCHANGE**</span></span>](cdn-folderchange.md)     | <span data-ttu-id="efa74-309">使用者開啟了新的資料夾或目錄。</span><span class="sxs-lookup"><span data-stu-id="efa74-309">The user opened a new folder or directory.</span></span>                                                                                                                                                                                                                                                     |
| [<span data-ttu-id="efa74-310">**CDN \_ 說明**</span><span class="sxs-lookup"><span data-stu-id="efa74-310">**CDN\_HELP**</span></span>](cdn-help.md)                     | <span data-ttu-id="efa74-311">使用者按一下 [說明 **] 按鈕。**</span><span class="sxs-lookup"><span data-stu-id="efa74-311">The user clicked the **Help** button.</span></span>                                                                                                                                                                                                                                                          |
| [<span data-ttu-id="efa74-312">**CDN \_ INCLUDEITEM**</span><span class="sxs-lookup"><span data-stu-id="efa74-312">**CDN\_INCLUDEITEM**</span></span>](cdn-includeitem.md)       | <span data-ttu-id="efa74-313">決定是否應該顯示專案。</span><span class="sxs-lookup"><span data-stu-id="efa74-313">Determines whether an item should be displayed.</span></span> <span data-ttu-id="efa74-314">當使用者開啟新的資料夾或目錄時，系統會傳送此通知給資料夾或目錄中的每個專案。</span><span class="sxs-lookup"><span data-stu-id="efa74-314">When the user opens a new folder or directory, the system sends this notification for each item in the folder or directory.</span></span> <span data-ttu-id="efa74-315">只有在已設定 **OFN \_ ENABLEINCLUDENOTIFY** 旗標的情況下，系統才會傳送此通知。</span><span class="sxs-lookup"><span data-stu-id="efa74-315">The system sends this notification only if the **OFN\_ENABLEINCLUDENOTIFY** flag was set.</span></span>                          |
| [<span data-ttu-id="efa74-316">**CDN \_ INITDONE**</span><span class="sxs-lookup"><span data-stu-id="efa74-316">**CDN\_INITDONE**</span></span>](cdn-initdone.md)             | <span data-ttu-id="efa74-317">系統已完成對話方塊的初始化，而對話方塊已完成了 [**WM \_ INITDIALOG**](wm-initdialog.md) 訊息的處理。</span><span class="sxs-lookup"><span data-stu-id="efa74-317">The system has finished initializing the dialog box, and the dialog box has finished processing the [**WM\_INITDIALOG**](wm-initdialog.md) message.</span></span> <span data-ttu-id="efa74-318">此外，系統已完成在 [通用] 對話方塊中排列控制項，以騰出空間給子對話方塊的控制項， (是否有任何) 。</span><span class="sxs-lookup"><span data-stu-id="efa74-318">Also, the system has finished arranging controls in the common dialog box to make room for the controls of the child dialog box (if any).</span></span> |
| [<span data-ttu-id="efa74-319">**CDN \_ SELCHANGE**</span><span class="sxs-lookup"><span data-stu-id="efa74-319">**CDN\_SELCHANGE**</span></span>](cdn-selchange.md)           | <span data-ttu-id="efa74-320">使用者從檔案清單中選取了新的檔案或資料夾。</span><span class="sxs-lookup"><span data-stu-id="efa74-320">The user selected a new file or folder from the file list.</span></span>                                                                                                                                                                                                                                     |
| [<span data-ttu-id="efa74-321">**CDN \_ SHAREVIOLATION**</span><span class="sxs-lookup"><span data-stu-id="efa74-321">**CDN\_SHAREVIOLATION**</span></span>](cdn-shareviolation.md) | <span data-ttu-id="efa74-322">[一般] 對話方塊在要傳回的檔案上發生共用違規。</span><span class="sxs-lookup"><span data-stu-id="efa74-322">The common dialog box encountered a sharing violation on the file about to be returned.</span></span>                                                                                                                                                                                                        |
| [<span data-ttu-id="efa74-323">**CDN \_ TYPECHANGE**</span><span class="sxs-lookup"><span data-stu-id="efa74-323">**CDN\_TYPECHANGE**</span></span>](cdn-typechange.md)         | <span data-ttu-id="efa74-324">使用者從檔案類型清單中選取了新的檔案類型。</span><span class="sxs-lookup"><span data-stu-id="efa74-324">The user selected a new file type from the list of file types.</span></span>                                                                                                                                                                                                                                 |



 

<span data-ttu-id="efa74-325">這些 [**WM \_ 通知**](../controls/wm-notify.md)訊息會取代舊版 [**開啟**] 和 [**另存** 新檔] 對話方塊所使用的 [**FILEOKSTRING**](fileokstring.md)、 [**LBSELCHSTRING**](lbselchstring.md)、 [**SHAREVISTRING**](sharevistring.md)和 [**HELPMSGSTRING**](helpmsgstring.md)註冊的訊息。</span><span class="sxs-lookup"><span data-stu-id="efa74-325">These [**WM\_NOTIFY**](../controls/wm-notify.md) messages supersede the [**FILEOKSTRING**](fileokstring.md), [**LBSELCHSTRING**](lbselchstring.md), [**SHAREVISTRING**](sharevistring.md), and [**HELPMSGSTRING**](helpmsgstring.md) registered messages used by previous versions of the **Open** and **Save As** dialog boxes.</span></span> <span data-ttu-id="efa74-326">但是，如果 **wm \_ 通知** 處理未使用 [**SetWindowLong**](/windows/desktop/api/winuser/nf-winuser-setwindowlonga)來設定非零的 **DWL \_ MSGRESULT** 值，則攔截程式也會在 **wm \_ 通知** 訊息之後收到被取代的訊息。</span><span class="sxs-lookup"><span data-stu-id="efa74-326">However, the hook procedure also receives the superseded message after the **WM\_NOTIFY** message if the **WM\_NOTIFY** processing does not use [**SetWindowLong**](/windows/desktop/api/winuser/nf-winuser-setwindowlonga) to set a nonzero **DWL\_MSGRESULT** value.</span></span>

<span data-ttu-id="efa74-327">若要抓取對話方塊狀態的相關資訊，或控制對話方塊的行為和外觀，攔截程式可以將下列訊息傳送至對話方塊。</span><span class="sxs-lookup"><span data-stu-id="efa74-327">To retrieve information about the status of the dialog box or to control the behavior and appearance of the dialog box, the hook procedure can send the following messages to the dialog box.</span></span>



| <span data-ttu-id="efa74-328">訊息</span><span class="sxs-lookup"><span data-stu-id="efa74-328">Message</span></span>                                             | <span data-ttu-id="efa74-329">意義</span><span class="sxs-lookup"><span data-stu-id="efa74-329">Meaning</span></span>                                                                                                                                                                                                                  |
|-----------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="efa74-330">**CDM \_ GETFILEPATH**</span><span class="sxs-lookup"><span data-stu-id="efa74-330">**CDM\_GETFILEPATH**</span></span>](cdm-getfilepath.md)         | <span data-ttu-id="efa74-331">抓取所選取檔案的路徑和檔案名。</span><span class="sxs-lookup"><span data-stu-id="efa74-331">Retrieves the path and file name of the selected file.</span></span>                                                                                                                                                                   |
| [<span data-ttu-id="efa74-332">**CDM \_ GETFOLDERIDLIST**</span><span class="sxs-lookup"><span data-stu-id="efa74-332">**CDM\_GETFOLDERIDLIST**</span></span>](cdm-getfolderidlist.md) | <span data-ttu-id="efa74-333">抓取對應至對話方塊已開啟之目前資料夾的專案識別碼清單。</span><span class="sxs-lookup"><span data-stu-id="efa74-333">Retrieves the item identifier list corresponding to the current folder that the dialog box has open.</span></span> <span data-ttu-id="efa74-334">如需專案識別碼清單的詳細資訊，請參閱 [Shell 命名空間的簡介](/windows/desktop/shell/namespace-intro)。</span><span class="sxs-lookup"><span data-stu-id="efa74-334">For more information about item identifier lists, see [Introduction to the Shell Namespace](/windows/desktop/shell/namespace-intro).</span></span> |
| [<span data-ttu-id="efa74-335">**CDM \_ GETFOLDERPATH**</span><span class="sxs-lookup"><span data-stu-id="efa74-335">**CDM\_GETFOLDERPATH**</span></span>](cdm-getfolderpath.md)     | <span data-ttu-id="efa74-336">抓取對話方塊的目前資料夾或目錄的路徑。</span><span class="sxs-lookup"><span data-stu-id="efa74-336">Retrieves the path of the current folder or directory for the dialog box.</span></span>                                                                                                                                                |
| [<span data-ttu-id="efa74-337">**CDM \_ GETSPEC**</span><span class="sxs-lookup"><span data-stu-id="efa74-337">**CDM\_GETSPEC**</span></span>](cdm-getspec.md)                 | <span data-ttu-id="efa74-338">抓取檔案名 (不包含目前在對話方塊中選取之檔案的路徑) 。</span><span class="sxs-lookup"><span data-stu-id="efa74-338">Retrieves the file name (not including the path) of the file currently selected in the dialog box.</span></span>                                                                                                                       |
| [<span data-ttu-id="efa74-339">**CDM \_ HIDECONTROL**</span><span class="sxs-lookup"><span data-stu-id="efa74-339">**CDM\_HIDECONTROL**</span></span>](cdm-hidecontrol.md)         | <span data-ttu-id="efa74-340">隱藏指定的控制項。</span><span class="sxs-lookup"><span data-stu-id="efa74-340">Hides the specified control.</span></span>                                                                                                                                                                                             |
| [<span data-ttu-id="efa74-341">**CDM \_ SETCONTROLTEXT**</span><span class="sxs-lookup"><span data-stu-id="efa74-341">**CDM\_SETCONTROLTEXT**</span></span>](cdm-setcontroltext.md)   | <span data-ttu-id="efa74-342">設定指定之控制項中的文字。</span><span class="sxs-lookup"><span data-stu-id="efa74-342">Sets the text in the specified control.</span></span>                                                                                                                                                                                  |
| [<span data-ttu-id="efa74-343">**CDM \_ SETDEFEXT**</span><span class="sxs-lookup"><span data-stu-id="efa74-343">**CDM\_SETDEFEXT**</span></span>](cdm-setdefext.md)             | <span data-ttu-id="efa74-344">設定對話方塊的預設副檔名。</span><span class="sxs-lookup"><span data-stu-id="efa74-344">Sets the default file name extension for the dialog box.</span></span>                                                                                                                                                                 |



 

## <a name="explorer-style-custom-templates"></a><span data-ttu-id="efa74-345">Explorer-Style 自訂範本</span><span class="sxs-lookup"><span data-stu-id="efa74-345">Explorer-Style Custom Templates</span></span>

<span data-ttu-id="efa74-346">若要定義 Explorer 樣式 [ **開啟** ] 或 [ **另存** 新檔] 對話方塊的其他控制項，請使用 [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) 結構來指定子對話方塊的範本，其中包含其他控制項。</span><span class="sxs-lookup"><span data-stu-id="efa74-346">To define additional controls for an Explorer-style **Open** or **Save As** dialog box, use the [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) structure to specify a template for a child dialog box that contains the additional controls.</span></span> <span data-ttu-id="efa74-347">如果您的子對話方塊範本是應用程式或動態連結程式庫中的資源，請在 **旗標** 成員中設定 **OFN \_ ENABLETEMPLATE** 旗標，並使用該結構的 **hInstance** 和 **lpTemplateName** 成員來識別模組和資源名稱。</span><span class="sxs-lookup"><span data-stu-id="efa74-347">If your child dialog template is a resource in an application or dynamic-link library, set the **OFN\_ENABLETEMPLATE** flag in the **Flags** member and use the **hInstance** and **lpTemplateName** members of the structure to identify the module and resource name.</span></span> <span data-ttu-id="efa74-348">如果範本已在記憶體中，請設定 **OFN \_ ENABLETEMPLATEHANDLE** 旗標，並使用 **hInstance** 成員識別包含範本的記憶體物件。</span><span class="sxs-lookup"><span data-stu-id="efa74-348">If the template is already in memory, set the **OFN\_ENABLETEMPLATEHANDLE** flag and use the **hInstance** member to identify the memory object that contains the template.</span></span> <span data-ttu-id="efa74-349">提供 [Explorer 樣式] 對話方塊的子對話方塊範本時，您也必須設定 **OFN \_ explorer** 旗標; 否則，系統會假設您要提供舊樣式對話方塊的取代範本。</span><span class="sxs-lookup"><span data-stu-id="efa74-349">When providing a child dialog template for an Explorer-style dialog box, you must also set the **OFN\_EXPLORER** flag; otherwise, the system assumes you are providing a replacement template for an old-style dialog box.</span></span> <span data-ttu-id="efa74-350">一般而言，如果您提供其他控制項，您也必須提供 [Explorer 樣式的勾點程式](#explorer-style-hook-procedures) 來處理新控制項的訊息。</span><span class="sxs-lookup"><span data-stu-id="efa74-350">Typically, if you provide additional controls, you must also provide an [Explorer-style hook procedure](#explorer-style-hook-procedures) to process messages for the new controls.</span></span>

<span data-ttu-id="efa74-351">您可以建立子對話方塊範本，就像您對任何其他範本一樣，不同的是，您必須指定 **ws \_ 子** 系和 **ws \_ CLIPSIBLINGS** 樣式，而且應指定 **ds \_ 3DLOOK** 和 **ds \_ 控制項** 樣式。</span><span class="sxs-lookup"><span data-stu-id="efa74-351">You can create your child dialog box template as you do any other template, except that you must specify the **WS\_CHILD** and **WS\_CLIPSIBLINGS** styles and should specify the **DS\_3DLOOK** and **DS\_CONTROL** styles.</span></span> <span data-ttu-id="efa74-352">系統需要 **WS \_ 子** 樣式，因為您的範本定義了預設 [ **開啟** ] 或 [ **另存** 新檔] 對話方塊的子對話方塊。</span><span class="sxs-lookup"><span data-stu-id="efa74-352">The system requires the **WS\_CHILD** style because your template defines a child dialog of the default **Open** or **Save As** dialog box.</span></span> <span data-ttu-id="efa74-353">**WS \_ CLIPSIBLINGS** 樣式可確保子對話方塊不會在 [預設] 對話方塊中的任何控制項上繪製。</span><span class="sxs-lookup"><span data-stu-id="efa74-353">The **WS\_CLIPSIBLINGS** style ensures that the child dialog box does not paint over any of the controls in the default dialog box.</span></span> <span data-ttu-id="efa74-354">**DS \_ 3DLOOK** 樣式可確保子對話方塊中控制項的外觀，與 [預設] 對話方塊中的控制項一致。</span><span class="sxs-lookup"><span data-stu-id="efa74-354">The **DS\_3DLOOK** style makes sure that the appearance of the controls in the child dialog box is consistent with the controls in the default dialog box.</span></span> <span data-ttu-id="efa74-355">**DS \_ 控制項** 樣式可確保使用者可以使用索引標籤和其他流覽鍵，在自訂對話方塊中的所有控制項（預設或自訂）之間移動。</span><span class="sxs-lookup"><span data-stu-id="efa74-355">The **DS\_CONTROL** style makes sure that the user can use the TAB and other navigation keys to move between all controls, default or custom, in the customized dialog box.</span></span>

<span data-ttu-id="efa74-356">為了騰出空間給新的控制項，系統會依自訂對話方塊的寬度和高度來展開預設對話方塊。</span><span class="sxs-lookup"><span data-stu-id="efa74-356">To make room for the new controls, the system expands the default dialog box by the width and height of the custom dialog box.</span></span> <span data-ttu-id="efa74-357">根據預設，自訂對話方塊中的所有控制項都位於 [預設] 對話方塊的控制項底下。</span><span class="sxs-lookup"><span data-stu-id="efa74-357">By default, all controls from the custom dialog box are positioned below the controls in the default dialog box.</span></span> <span data-ttu-id="efa74-358">不過，您可以覆寫這個預設位置，方法是在自訂對話方塊範本中包含靜態文字控制項，並為其指派 **stc32** 的控制項識別碼值。</span><span class="sxs-lookup"><span data-stu-id="efa74-358">However, you can override this default positioning by including a static text control in your custom dialog box template and assigning it the control identifier value of **stc32**.</span></span> <span data-ttu-id="efa74-359"> (此值定義于 Dlgs .h 標頭檔中。 ) 在此情況下，系統會使用控制項作為參考點，以決定要在何處放置新的控制項。</span><span class="sxs-lookup"><span data-stu-id="efa74-359">(This value is defined in the Dlgs.h header file.) In this case, the system uses the control as the point of reference for determining where to position the new controls.</span></span> <span data-ttu-id="efa74-360">**Stc32** 控制項上方和左邊的所有新控制項，都位於 [預設] 對話方塊中控制項的上方和左邊。</span><span class="sxs-lookup"><span data-stu-id="efa74-360">All new controls above and to the left of the **stc32** control are positioned the same amount above and to the left of the controls in the default dialog box.</span></span> <span data-ttu-id="efa74-361">**Stc32** 控制項右邊和右邊的新控制項位於預設控制項的下方和右邊。</span><span class="sxs-lookup"><span data-stu-id="efa74-361">New controls below and to the right of the **stc32** control are positioned below and to the right of the default controls.</span></span> <span data-ttu-id="efa74-362">一般情況下，每個新控制項都位於相同的位置，使其具有與 **stc32** 控制項相同的預設控制項位置。</span><span class="sxs-lookup"><span data-stu-id="efa74-362">In general, each new control is positioned so that it has the same position relative to the default controls as it had to the **stc32** control.</span></span> <span data-ttu-id="efa74-363">為了為這些新的控制項騰出空間，系統會視需要在預設對話方塊的左邊、右邊、底端和頂端加上空格。</span><span class="sxs-lookup"><span data-stu-id="efa74-363">To make room for these new controls, the system adds space to the left, right, bottom, and top of the default dialog box as needed.</span></span>

<span data-ttu-id="efa74-364">系統會要求攔截程式處理所有適用于自訂對話方塊的訊息，因此會將相同的視窗訊息傳送至與其他任何對話方塊程式相同的攔截程式。</span><span class="sxs-lookup"><span data-stu-id="efa74-364">The system requires the hook procedure to process all messages intended for the custom dialog box and therefore sends the same window messages to the hook procedure as to any other dialog box procedure.</span></span> <span data-ttu-id="efa74-365">例如，當使用者按一下 [自訂] 對話方塊中的按鈕控制項時，攔截程式就會收到 [**WM \_ 命令**](/windows/desktop/menurc/wm-command) 訊息。</span><span class="sxs-lookup"><span data-stu-id="efa74-365">For example, the hook procedure receives [**WM\_COMMAND**](/windows/desktop/menurc/wm-command) messages when the user clicks on button controls in the custom dialog box.</span></span> <span data-ttu-id="efa74-366">當對話方塊關閉時，攔截程式會負責初始化這些控制項，以及從控制項中取出值。</span><span class="sxs-lookup"><span data-stu-id="efa74-366">The hook procedure is responsible for initializing these controls and retrieving values from the controls when the dialog box is closed.</span></span> <span data-ttu-id="efa74-367">請注意，當攔截程式收到 [**WM \_ INITDIALOG**](wm-initdialog.md) 訊息時，系統尚未將控制項移至其最終位置。</span><span class="sxs-lookup"><span data-stu-id="efa74-367">Note that when the hook procedure receives the [**WM\_INITDIALOG**](wm-initdialog.md) message, the system has not yet moved the controls to their final positions.</span></span>

<span data-ttu-id="efa74-368">預設對話方塊程式會處理 [預設] 對話方塊中所有控制項的訊息，但是攔截程式會接收這些控制項上使用者動作的通知訊息，如 [Explorer 樣式](#explorer-style-hook-procedures)的攔截程式中所述。</span><span class="sxs-lookup"><span data-stu-id="efa74-368">The default dialog box procedure handles messages for all the controls in the default dialog box, but the hook procedure receives the notification messages for user actions on these controls as described in [Explorer-Style Hook Procedures](#explorer-style-hook-procedures).</span></span>

## <a name="explorer-style-control-identifiers"></a><span data-ttu-id="efa74-369">Explorer-Style 控制項識別碼</span><span class="sxs-lookup"><span data-stu-id="efa74-369">Explorer-Style Control Identifiers</span></span>

<span data-ttu-id="efa74-370">Windows 軟體開發套件 (SDK) 提供舊樣式對話方塊的預設對話方塊範本，但不包含 Explorer 樣式對話方塊的預設範本。</span><span class="sxs-lookup"><span data-stu-id="efa74-370">The Windows Software Development Kit (SDK) provides the default dialog box template for the old-style dialog boxes, but does not include the default template for the Explorer-style dialog boxes.</span></span> <span data-ttu-id="efa74-371">這是因為 [Explorer 樣式] 對話方塊可讓您加入自己的控制項，但不支援修改標準控制項的範本。</span><span class="sxs-lookup"><span data-stu-id="efa74-371">This is because the Explorer-style dialog boxes allow you to add your own controls but do not support modifying the template for the standard controls.</span></span> <span data-ttu-id="efa74-372">不過，在某些情況下，您可能需要知道預設範本中所使用的控制項識別碼。</span><span class="sxs-lookup"><span data-stu-id="efa74-372">However, in some cases, you may need to know the control identifiers used in the default templates.</span></span> <span data-ttu-id="efa74-373">例如， [**CDM \_ HIDECONTROL**](cdm-hidecontrol.md) 和 [**CDM \_ SETCONTROLTEXT**](cdm-setcontroltext.md) 訊息需要控制項識別碼。</span><span class="sxs-lookup"><span data-stu-id="efa74-373">For example, the [**CDM\_HIDECONTROL**](cdm-hidecontrol.md) and [**CDM\_SETCONTROLTEXT**](cdm-setcontroltext.md) messages require a control identifier.</span></span>

<span data-ttu-id="efa74-374">下表顯示 [Explorer] 樣式 [ **開啟** ] 和 [ **另存** 新檔] 對話方塊中標準控制項的識別碼。</span><span class="sxs-lookup"><span data-stu-id="efa74-374">The following table shows the identifiers of the standard controls in the Explorer-style **Open** and **Save As** dialog boxes.</span></span> <span data-ttu-id="efa74-375">識別碼是定義于 Dlgs .h 和 Winuser 中的常數。</span><span class="sxs-lookup"><span data-stu-id="efa74-375">The identifiers are constants defined in Dlgs.h and Winuser.h.</span></span>



| <span data-ttu-id="efa74-376">控制項識別碼</span><span class="sxs-lookup"><span data-stu-id="efa74-376">Control identifier</span></span> | <span data-ttu-id="efa74-377">控制項描述</span><span class="sxs-lookup"><span data-stu-id="efa74-377">Control description</span></span>                                                                                                                                                                                                                                                                        |
|--------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="efa74-378">**chx1**</span><span class="sxs-lookup"><span data-stu-id="efa74-378">**chx1**</span></span>           | <span data-ttu-id="efa74-379">唯讀核取方塊</span><span class="sxs-lookup"><span data-stu-id="efa74-379">The read-only check box</span></span>                                                                                                                                                                                                                                                                    |
| <span data-ttu-id="efa74-380">**cmb1**</span><span class="sxs-lookup"><span data-stu-id="efa74-380">**cmb1**</span></span>           | <span data-ttu-id="efa74-381">顯示檔案類型篩選清單的下拉式清單方塊</span><span class="sxs-lookup"><span data-stu-id="efa74-381">Drop-down combo box that displays the list of file type filters</span></span>                                                                                                                                                                                                                            |
| <span data-ttu-id="efa74-382">**stc2**</span><span class="sxs-lookup"><span data-stu-id="efa74-382">**stc2**</span></span>           | <span data-ttu-id="efa74-383">**Cmb1** 下拉式方塊的標籤</span><span class="sxs-lookup"><span data-stu-id="efa74-383">Label for the **cmb1** combo box</span></span>                                                                                                                                                                                                                                                           |
| <span data-ttu-id="efa74-384">**cmb2**</span><span class="sxs-lookup"><span data-stu-id="efa74-384">**cmb2**</span></span>           | <span data-ttu-id="efa74-385">顯示目前磁片磁碟機或資料夾的下拉式方塊，可讓使用者選取要開啟的磁片磁碟機或資料夾</span><span class="sxs-lookup"><span data-stu-id="efa74-385">Drop-down combo box that displays the current drive or folder, and that allows the user to select a drive or folder to open</span></span>                                                                                                                                                                |
| <span data-ttu-id="efa74-386">**stc4**</span><span class="sxs-lookup"><span data-stu-id="efa74-386">**stc4**</span></span>           | <span data-ttu-id="efa74-387">**Cmb2** 下拉式方塊的標籤</span><span class="sxs-lookup"><span data-stu-id="efa74-387">Label for the **cmb2** combo box</span></span>                                                                                                                                                                                                                                                           |
| <span data-ttu-id="efa74-388">**cmb13**</span><span class="sxs-lookup"><span data-stu-id="efa74-388">**cmb13**</span></span>          | <span data-ttu-id="efa74-389">下拉式方塊中顯示目前檔案的名稱，可讓使用者輸入要開啟的檔案名，然後選取最近開啟或儲存的檔案中的檔案名。</span><span class="sxs-lookup"><span data-stu-id="efa74-389">Drop-down combo box that displays the name of the current file, allows the user to type the name of a file to open, and select a file that has been opened or saved recently.</span></span> <span data-ttu-id="efa74-390">這適用于不含攔截器或對話方塊範本的舊版瀏覽器相容應用程式。</span><span class="sxs-lookup"><span data-stu-id="efa74-390">This is for earlier Explorer-compatible applications without hook or dialog template.</span></span> <span data-ttu-id="efa74-391">與 **edt1** 比較。</span><span class="sxs-lookup"><span data-stu-id="efa74-391">Compare with **edt1**.</span></span> |
| <span data-ttu-id="efa74-392">**edt1**</span><span class="sxs-lookup"><span data-stu-id="efa74-392">**edt1**</span></span>           | <span data-ttu-id="efa74-393">編輯控制項，以顯示目前檔案的名稱，或允許使用者輸入要開啟的檔案名。</span><span class="sxs-lookup"><span data-stu-id="efa74-393">Edit control that displays the name of the current file, or allows the user to type the name of the file to open.</span></span> <span data-ttu-id="efa74-394">與 **cmb13** 比較。</span><span class="sxs-lookup"><span data-stu-id="efa74-394">Compare with **cmb13**.</span></span>                                                                                                                                                  |
| <span data-ttu-id="efa74-395">**stc3**</span><span class="sxs-lookup"><span data-stu-id="efa74-395">**stc3**</span></span>           | <span data-ttu-id="efa74-396">**Cmb13** 下拉式方塊和 edt1 編輯控制項的標籤</span><span class="sxs-lookup"><span data-stu-id="efa74-396">Label for the **cmb13** combo box and the edt1 edit control</span></span>                                                                                                                                                                                                                                |
| <span data-ttu-id="efa74-397">**lst1**</span><span class="sxs-lookup"><span data-stu-id="efa74-397">**lst1**</span></span>           | <span data-ttu-id="efa74-398">顯示目前磁片磁碟機或資料夾內容的清單方塊</span><span class="sxs-lookup"><span data-stu-id="efa74-398">List box that displays the contents of the current drive or folder</span></span>                                                                                                                                                                                                                         |
| <span data-ttu-id="efa74-399">**stc1**</span><span class="sxs-lookup"><span data-stu-id="efa74-399">**stc1**</span></span>           | <span data-ttu-id="efa74-400">**Lst1** 清單方塊的標籤</span><span class="sxs-lookup"><span data-stu-id="efa74-400">Label for the **lst1** list box</span></span>                                                                                                                                                                                                                                                            |
| <span data-ttu-id="efa74-401">**IDOK**</span><span class="sxs-lookup"><span data-stu-id="efa74-401">**IDOK**</span></span>           | <span data-ttu-id="efa74-402">[ **確定]** 命令按鈕 (push 按鈕) </span><span class="sxs-lookup"><span data-stu-id="efa74-402">The **OK** command button (push button)</span></span>                                                                                                                                                                                                                                                    |
| <span data-ttu-id="efa74-403">**IDCANCEL**</span><span class="sxs-lookup"><span data-stu-id="efa74-403">**IDCANCEL**</span></span>       | <span data-ttu-id="efa74-404">[ **取消** ] 命令按鈕 (推入按鈕) </span><span class="sxs-lookup"><span data-stu-id="efa74-404">The **Cancel** command button (push button)</span></span>                                                                                                                                                                                                                                                |
| <span data-ttu-id="efa74-405">**pshHelp**</span><span class="sxs-lookup"><span data-stu-id="efa74-405">**pshHelp**</span></span>        | <span data-ttu-id="efa74-406">[ **說明** ] 命令按鈕 (push 按鈕) </span><span class="sxs-lookup"><span data-stu-id="efa74-406">The **Help** command button (push button)</span></span>                                                                                                                                                                                                                                                  |



 

## <a name="customizing-old-style-dialog-boxes"></a><span data-ttu-id="efa74-407">自訂 Old-Style 對話方塊</span><span class="sxs-lookup"><span data-stu-id="efa74-407">Customizing Old-Style Dialog Boxes</span></span>

<span data-ttu-id="efa74-408">您可以藉由提供 [*OFNHookProcOldStyle*](/previous-versions/windows/desktop/legacy/ms646932(v=vs.85))攔截程式來自訂舊樣式的 [**開啟**] 或 [**另存** 新檔] 對話方塊，以接收適用于預設對話方塊程式的訊息或通知。</span><span class="sxs-lookup"><span data-stu-id="efa74-408">You can customize an old-style **Open** or **Save As** dialog box by providing an [*OFNHookProcOldStyle*](/previous-versions/windows/desktop/legacy/ms646932(v=vs.85)) hook procedure that receives messages or notifications intended for the default dialog box procedure.</span></span> <span data-ttu-id="efa74-409">您也可以提供用來取代預設範本的自訂範本。</span><span class="sxs-lookup"><span data-stu-id="efa74-409">You can also provide a custom template to use in place of the default template.</span></span> <span data-ttu-id="efa74-410">與舊樣式對話方塊搭配使用的攔截程式和範本，類似于與其他通用對話方塊搭配使用的連結。</span><span class="sxs-lookup"><span data-stu-id="efa74-410">The hook procedures and templates used with the old-style dialog boxes are similar to those used with the other common dialog boxes.</span></span> <span data-ttu-id="efa74-411">如需詳細資訊，請參閱 [一般對話方塊](customizing-common-dialog-boxes.md) 和 [自訂範本](customizing-common-dialog-boxes.md)的攔截程式。</span><span class="sxs-lookup"><span data-stu-id="efa74-411">For more information, see [Hook Procedures for Common Dialog Boxes](customizing-common-dialog-boxes.md) and [Custom Templates](customizing-common-dialog-boxes.md).</span></span>

<span data-ttu-id="efa74-412">若要針對舊版樣式的 [ **開啟** ] 或 [ **另存** 新檔] 對話方塊啟用攔截程式，請在建立對話方塊時使用 [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) 結構。</span><span class="sxs-lookup"><span data-stu-id="efa74-412">To enable a hook procedure for an old-style **Open** or **Save As** dialog box, use the [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) structure when you create the dialog box.</span></span> <span data-ttu-id="efa74-413">在 **旗標** 成員中設定 **OFN \_ ENABLEHOOK** 旗標，並在 **lpfnHook** 成員中指定 [*OFNHookProcOldStyle*](/previous-versions/windows/desktop/legacy/ms646932(v=vs.85))攔截程式的位址。</span><span class="sxs-lookup"><span data-stu-id="efa74-413">Set the **OFN\_ENABLEHOOK** flag in the **Flags** member and specify the address of an [*OFNHookProcOldStyle*](/previous-versions/windows/desktop/legacy/ms646932(v=vs.85)) hook procedure in the **lpfnHook** member.</span></span> <span data-ttu-id="efa74-414">對話方塊程式會將 [**WM \_ INITDIALOG**](wm-initdialog.md) 訊息傳送至攔截程式，並將 *Param* 參數設定為用來初始化對話方塊的 **OPENFILENAME** 結構位址。</span><span class="sxs-lookup"><span data-stu-id="efa74-414">The dialog box procedure sends a [**WM\_INITDIALOG**](wm-initdialog.md) message to the hook procedure with the *Param* parameter set to the address of the **OPENFILENAME** structure used to initialize the dialog box.</span></span>

<span data-ttu-id="efa74-415">您可以使用 [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) 結構來指定 [ **開啟** ] 或 [ **另存** 新檔] 對話方塊的自訂範本，以用來取代預設範本。</span><span class="sxs-lookup"><span data-stu-id="efa74-415">You can use the [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) structure to specify a custom template for the **Open** or **Save As** dialog box to use in place of the default template.</span></span> <span data-ttu-id="efa74-416">如果您的自訂範本是應用程式或動態連結程式庫中的資源，請在 **旗標** 成員中設定 **OFN \_ ENABLETEMPLATE** 旗標，並使用該結構的 **hInstance** 和 **lpTemplateName** 成員來識別模組和資源名稱。</span><span class="sxs-lookup"><span data-stu-id="efa74-416">If your custom template is a resource in an application or dynamic-link library, set the **OFN\_ENABLETEMPLATE** flag in the **Flags** member and use the **hInstance** and **lpTemplateName** members of the structure to identify the module and resource name.</span></span> <span data-ttu-id="efa74-417">如果您的自訂範本已在記憶體中，請設定 **OFN \_ ENABLETEMPLATEHANDLE** 旗標，並使用 **hInstance** 成員來識別包含範本的記憶體物件。</span><span class="sxs-lookup"><span data-stu-id="efa74-417">If your custom template is already in memory, set the **OFN\_ENABLETEMPLATEHANDLE** flag and use the **hInstance** member to identify the memory object that contains the template.</span></span> <span data-ttu-id="efa74-418">藉由修改 Fileopen 檔案中指定的預設範本來建立自訂範本。</span><span class="sxs-lookup"><span data-stu-id="efa74-418">Create the custom template by modifying the default template specified in the Fileopen.dlg file.</span></span> <span data-ttu-id="efa74-419">在 [預設尋找和取代] 對話方塊範本中使用的控制項識別碼是在 Dlgs 檔案中定義。</span><span class="sxs-lookup"><span data-stu-id="efa74-419">The control identifiers used in the default Find and Replace dialog templates are defined in the Dlgs.h file.</span></span>

<span data-ttu-id="efa74-420">根據預設， [**GetOpenFileName**](/windows/desktop/api/Commdlg/nf-commdlg-getopenfilenamea) 和 [**GetSaveFileName**](/windows/desktop/api/Commdlg/nf-commdlg-getsavefilenamea) 函式會顯示 Explorer 樣式的對話方塊。</span><span class="sxs-lookup"><span data-stu-id="efa74-420">By default, the [**GetOpenFileName**](/windows/desktop/api/Commdlg/nf-commdlg-getopenfilenamea) and [**GetSaveFileName**](/windows/desktop/api/Commdlg/nf-commdlg-getsavefilenamea) functions display the Explorer-style dialog boxes.</span></span> <span data-ttu-id="efa74-421">如果您想要顯示舊樣式的對話方塊，您必須提供 [**OFNHookProcOldStyle**](/previous-versions/windows/desktop/legacy/ms646932(v=vs.85))的攔截程式，並確定未在 [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea)結構的 **旗標** 成員中設定 **OFN \_ EXPLORER** 旗標。</span><span class="sxs-lookup"><span data-stu-id="efa74-421">If you want to display an old-style dialog box, you must provide an [**OFNHookProcOldStyle**](/previous-versions/windows/desktop/legacy/ms646932(v=vs.85)) hook procedure and ensure that the **OFN\_EXPLORER** flag is not set in the **Flags** member of the [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) structure.</span></span>

<span data-ttu-id="efa74-422">如果您設定 **OFN \_ explorer** 旗標，系統會將攔截程式或自訂範本視為 EXPLORER 樣式的自訂。</span><span class="sxs-lookup"><span data-stu-id="efa74-422">If you set the **OFN\_EXPLORER** flag, the system treats a hook procedure or custom template as an Explorer-style customization.</span></span> <span data-ttu-id="efa74-423">如需自訂 Explorer 樣式對話方塊的詳細資訊，請參閱 [Explorer 樣式的自訂範本](#explorer-style-custom-templates)。</span><span class="sxs-lookup"><span data-stu-id="efa74-423">For information about customizing an Explorer-style dialog box, see [Explorer-Style Custom Templates](#explorer-style-custom-templates).</span></span>

## <a name="see-also"></a><span data-ttu-id="efa74-424">另請參閱</span><span class="sxs-lookup"><span data-stu-id="efa74-424">See also</span></span>

* [<span data-ttu-id="efa74-425">檔案使用中範例</span><span class="sxs-lookup"><span data-stu-id="efa74-425">File is in use sample</span></span>](https://github.com/microsoft/Windows-classic-samples/tree/master/Samples/Win7Samples/winui/shell/appplatform/fileisinuse)