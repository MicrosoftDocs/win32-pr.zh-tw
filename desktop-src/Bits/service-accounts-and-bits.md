---
title: 服務帳戶和 BITS
description: 您可以使用 BITS 從服務傳輸檔案。 服務必須使用 LocalSystem、LocalService 或 NetworkService 系統帳戶。 這些帳戶一律會登入;因此，使用這些帳戶的服務所提交的作業一律會執行。
ms.assetid: 43fb58d6-3a99-488f-ab43-dbb4a794fc2f
keywords:
- 服務帳戶位
- 傳送作業位、擁有權、服務帳戶
- proxy 位，服務帳戶
- 傳送工作 BITS 的認證
ms.topic: article
ms.date: 10/04/2018
ms.openlocfilehash: 475a623e6b105d3ef2bdc6586db613c010fe8923
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/20/2020
ms.locfileid: "104092815"
---
# <a name="service-accounts-and-bits"></a><span data-ttu-id="f2f83-109">服務帳戶和 BITS</span><span class="sxs-lookup"><span data-stu-id="f2f83-109">Service Accounts and BITS</span></span>

<span data-ttu-id="f2f83-110">您可以使用 BITS 從服務傳輸檔案。</span><span class="sxs-lookup"><span data-stu-id="f2f83-110">You can use BITS to transfer files from a service.</span></span> <span data-ttu-id="f2f83-111">服務必須使用 LocalSystem、LocalService 或 NetworkService 系統帳戶。</span><span class="sxs-lookup"><span data-stu-id="f2f83-111">The service must use the LocalSystem, LocalService, or NetworkService system account.</span></span> <span data-ttu-id="f2f83-112">這些帳戶一律會登入;因此，使用這些帳戶的服務所提交的作業一律會執行。</span><span class="sxs-lookup"><span data-stu-id="f2f83-112">These accounts are always logged on; therefore, jobs submitted by a service using these accounts always run.</span></span>

<span data-ttu-id="f2f83-113">如果在系統帳戶下執行的服務在呼叫 BITS 之前先模擬使用者，則 BITS 會回應任何使用者帳戶 (例如，使用者必須登入電腦，才能進行傳輸) 。</span><span class="sxs-lookup"><span data-stu-id="f2f83-113">If a service running under a system account impersonates the user before calling BITS, BITS responds as it would for any user account (for example, the user needs to be logged on to the computer for the transfer to occur).</span></span> <span data-ttu-id="f2f83-114">在模擬使用者時，服務也應該使用動態掩蓋搭配 BITS 介面指標。</span><span class="sxs-lookup"><span data-stu-id="f2f83-114">The service should also use dynamic cloaking with the BITS interface pointers when impersonating the user.</span></span> <span data-ttu-id="f2f83-115">不會繼承掩蓋，因此您必須在每個從 BITS 收到的介面指標上呼叫 [**CoSetProxyBlanket**](/windows/win32/api/combaseapi/nf-combaseapi-cosetproxyblanket) 函式 (例如，呼叫 [**IBackgroundCopyManager：： >batchclient.joboperations.createjob**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopymanager-createjob) 方法所傳回的工作指標) ;在管理員介面指標上設定掩蓋並不夠。</span><span class="sxs-lookup"><span data-stu-id="f2f83-115">Cloaking is not inherited, therefore you must call the [**CoSetProxyBlanket**](/windows/win32/api/combaseapi/nf-combaseapi-cosetproxyblanket) function on each interface pointer that you receive from BITS (for example, the job pointer returned from calling the [**IBackgroundCopyManager::CreateJob**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopymanager-createjob) method); it is not enough to set cloaking on the manager interface pointer.</span></span> <span data-ttu-id="f2f83-116">您也可以呼叫進程的 [**CoInitializeSecurity**](/windows/win32/api/combaseapi/nf-combaseapi-coinitializesecurity) 函式，而不是在每個介面指標上呼叫 **CoSetProxyBlanket** 函數。</span><span class="sxs-lookup"><span data-stu-id="f2f83-116">You can also call the [**CoInitializeSecurity**](/windows/win32/api/combaseapi/nf-combaseapi-coinitializesecurity) function for the process instead of calling the **CoSetProxyBlanket** function on each interface pointer.</span></span>

<span data-ttu-id="f2f83-117">但是，如果服務未模擬使用者，則適用下列行為：</span><span class="sxs-lookup"><span data-stu-id="f2f83-117">However, if the service does not impersonate the user, the following behaviors apply:</span></span>

- <span data-ttu-id="f2f83-118">服務帳戶所建立的工作是由該帳戶所擁有。</span><span class="sxs-lookup"><span data-stu-id="f2f83-118">Jobs created by the service account are owned by that account.</span></span> <span data-ttu-id="f2f83-119">由於系統帳戶一律會登入，因此 BITS 會傳輸檔案，只要電腦正在執行且有網路連線。</span><span class="sxs-lookup"><span data-stu-id="f2f83-119">Because system accounts are always logged on, BITS transfers the files as long as the computer is running and there is a network connection.</span></span>
- <span data-ttu-id="f2f83-120">系統帳戶不應使用對應的網路磁碟機號，因為磁碟機號是會話特有的磁碟機號，而且在電腦重新開機之後，可能會遺失對應。</span><span class="sxs-lookup"><span data-stu-id="f2f83-120">System accounts should not use mapped network drive letters because the drive letters are specific to a session and the mapping may be lost after a computer restart.</span></span>
- <span data-ttu-id="f2f83-121">如果沒有協助程式 [權杖](helper-tokens-for-bits-transfer-jobs.md)，網路驗證會針對 LocalSystem 和 NetworkService 帳戶使用電腦認證，並針對 LocalService 帳戶使用匿名認證。</span><span class="sxs-lookup"><span data-stu-id="f2f83-121">In the absence of a [Helper Token](helper-tokens-for-bits-transfer-jobs.md), network authentication uses computer credentials for LocalSystem and NetworkService accounts and anonymous credentials for the LocalService account.</span></span> <span data-ttu-id="f2f83-122">如果來源檔案 (ACL) 的存取控制清單會限制使用者帳戶的存取權，則 BITS 會傳回「拒絕存取」。</span><span class="sxs-lookup"><span data-stu-id="f2f83-122">BITS returns "access denied" if the access control list (ACL) for the source file limits access to a user account.</span></span>
- <span data-ttu-id="f2f83-123">如需有關在有協助程式 [權杖](helper-tokens-for-bits-transfer-jobs.md)存在時驗證如何運作的詳細資訊，請參閱 [驗證](authentication.md)。</span><span class="sxs-lookup"><span data-stu-id="f2f83-123">For details on how authentication works in the presence of a [Helper Token](helper-tokens-for-bits-transfer-jobs.md), see [Authentication](authentication.md).</span></span>
- <span data-ttu-id="f2f83-124">Microsoft Internet Explorer 的 proxy 設定會依使用者儲存，而且不會針對系統帳戶進行設定。</span><span class="sxs-lookup"><span data-stu-id="f2f83-124">Microsoft Internet Explorer proxy settings are stored per-user and are not set for system accounts.</span></span> <span data-ttu-id="f2f83-125">請考慮在 BITS 工作上設定協助程式權杖，或呼叫 [**IBackgroundCopyJob：： SetProxySettings**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-setproxysettings) 與 **BG \_ 工作 \_ proxy \_ 使用 \_** 方式覆寫來明確設定正確的 proxy 設定。</span><span class="sxs-lookup"><span data-stu-id="f2f83-125">Consider configuring a helper token on your BITS jobs, or explicitly setting the correct proxy settings by calling [**IBackgroundCopyJob::SetProxySettings**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-setproxysettings) with **BG\_JOB\_PROXY\_USAGE\_OVERRIDE**.</span></span> <span data-ttu-id="f2f83-126">或者，您可以使用 BitsAdmin.exe 的 **/Util/SetIEProxy** 交換器來設定 LocalSystem、LocalService 或 NetworkService 系統帳戶 Internet Explorer proxy 設定。</span><span class="sxs-lookup"><span data-stu-id="f2f83-126">Alternatively, you can use the **/Util /SetIEProxy** switches of BitsAdmin.exe to set Internet Explorer proxy settings for the LocalSystem, LocalService, or NetworkService system account.</span></span> <span data-ttu-id="f2f83-127">如需詳細資訊，請參閱 [BitsAdmin 工具](bitsadmin-tool.md)。</span><span class="sxs-lookup"><span data-stu-id="f2f83-127">For details, see [BitsAdmin Tool](bitsadmin-tool.md).</span></span>

<span data-ttu-id="f2f83-128">請注意，BITS 無法辨識使用 Proxycfg.exe 檔案設定的 proxy 設定。</span><span class="sxs-lookup"><span data-stu-id="f2f83-128">Note that BITS does not recognize the proxy settings that are set using the Proxycfg.exe file.</span></span>