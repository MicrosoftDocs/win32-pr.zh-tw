---
title: 使用者帳戶控制和位
description: 當系統管理員使用者登入電腦時，會建立兩個存取權杖。 其中一個是篩選的標準使用者存取權杖，另一個則是完整的系統管理員存取權杖。
ms.assetid: 02439ab3-b885-4a2f-b507-0c48d2b30b76
ms.topic: article
ms.date: 7/12/2019
ms.openlocfilehash: 3017b3a0d816ba393d1427c5c1d2315a68b2dcc0
ms.sourcegitcommit: be77ed1f97d3be57a2f42070589de21b66034adf
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 05/29/2020
ms.locfileid: "103933011"
---
# <a name="bits-security-tokens-and-administrator-accounts"></a><span data-ttu-id="9caf5-104">BITS 安全性、權杖和系統管理員帳戶</span><span class="sxs-lookup"><span data-stu-id="9caf5-104">BITS Security, Tokens, and Administrator Accounts</span></span>

## <a name="http-server-certificate-callbacks"></a><span data-ttu-id="9caf5-105">HTTP 伺服器證書回呼</span><span class="sxs-lookup"><span data-stu-id="9caf5-105">HTTP Server certificate callbacks</span></span>
<span data-ttu-id="9caf5-106">正確驗證伺服器憑證是維護 HTTPS 安全性的重要部分。</span><span class="sxs-lookup"><span data-stu-id="9caf5-106">Correctly validating server certificates is a key part of maintaining HTTPS security.</span></span> <span data-ttu-id="9caf5-107">BITS 有助於根據 [**SetSecurityFlags**](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setsecurityflags)所指定的需求清單，一律驗證伺服器憑證。</span><span class="sxs-lookup"><span data-stu-id="9caf5-107">BITS helps by always validating server certificates against a list of requirements specified by [**SetSecurityFlags**](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setsecurityflags).</span></span> <span data-ttu-id="9caf5-108">依預設，BITS 會使用「瀏覽器」樣式憑證驗證。</span><span class="sxs-lookup"><span data-stu-id="9caf5-108">By default, BITS uses "browser" style certificate validation.</span></span>

<span data-ttu-id="9caf5-109">您也可以指定要呼叫的自訂函數，以便進一步驗證憑證。</span><span class="sxs-lookup"><span data-stu-id="9caf5-109">You can also specify a custom function to call in order to further validate the certificate.</span></span> <span data-ttu-id="9caf5-110">使用 [**SetServerCertificateValidationInterface**](/windows/desktop/api/Bits10_3/nf-bits10_3-ibackgroundcopyjobhttpoptions3-setservercertificatevalidationinterface) 方法來設定伺服器憑證回呼。</span><span class="sxs-lookup"><span data-stu-id="9caf5-110">Set the server certificate callback with the [**SetServerCertificateValidationInterface**](/windows/desktop/api/Bits10_3/nf-bits10_3-ibackgroundcopyjobhttpoptions3-setservercertificatevalidationinterface) method.</span></span> <span data-ttu-id="9caf5-111">只有在作業系統已根據 [ **SetSecurityFlag**](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setsecurityflags)的呼叫驗證憑證之後，才會呼叫您的方法。</span><span class="sxs-lookup"><span data-stu-id="9caf5-111">Your method will only be called after the operating system has validated the certificate based on the [**SetSecurityFlag** s](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setsecurityflags) call.</span></span> 

## <a name="http-client-certificates"></a><span data-ttu-id="9caf5-112">HTTP 用戶端憑證</span><span class="sxs-lookup"><span data-stu-id="9caf5-112">HTTP Client certificates</span></span>
<span data-ttu-id="9caf5-113">您可以使用兩種不同的憑證設定方法，在 HTTP 作業上設定用戶端憑證。</span><span class="sxs-lookup"><span data-stu-id="9caf5-113">You can set a client certificate on an HTTP job with two different certificate settings methods.</span></span> <span data-ttu-id="9caf5-114">您可以依 [識別碼](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setclientcertificatebyid) 或憑證 [主體名稱](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setclientcertificatebyname)來設定憑證。</span><span class="sxs-lookup"><span data-stu-id="9caf5-114">You can set a certificate either by [ID](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setclientcertificatebyid) or by the certificate [subject name](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setclientcertificatebyname).</span></span> <span data-ttu-id="9caf5-115">如果伺服器需要用戶端驗證，則會在 TLS 協商期間使用用戶端憑證 (或重新協商) 。</span><span class="sxs-lookup"><span data-stu-id="9caf5-115">The client certificate will be used during TLS negotiation (or renegotiation) if the server requires client authentication.</span></span>

## <a name="write-only-http-headers"></a><span data-ttu-id="9caf5-116">僅限寫入的 HTTP 標頭</span><span class="sxs-lookup"><span data-stu-id="9caf5-116">Write-only HTTP headers</span></span>
<span data-ttu-id="9caf5-117">BITS 可協助您保護 HTTP 驗證權杖免于不必要的存取。</span><span class="sxs-lookup"><span data-stu-id="9caf5-117">BITS helps you protect HTTP authentication tokens from unwanted access.</span></span> <span data-ttu-id="9caf5-118">HTTP 伺服器通常會在下載檔案或將檔案上傳至 HTTP 伺服器時，需要某種類型的安全性權杖或字串。</span><span class="sxs-lookup"><span data-stu-id="9caf5-118">Often an HTTP server will need some kind of security token or string when downloading or uploading a file to HTTP servers.</span></span>

<span data-ttu-id="9caf5-119">BITS 會以數種方式保護這些驗證權杖。</span><span class="sxs-lookup"><span data-stu-id="9caf5-119">BITS protects these authentication tokens in several ways.</span></span>
* <span data-ttu-id="9caf5-120">BITS 可讓您藉由指定 HTTPS URL 來使用 TLS 和受 SSL 保護的 HTTP 連接。</span><span class="sxs-lookup"><span data-stu-id="9caf5-120">BITS lets you use TLS- and SSL-protected HTTP connections by specifying an HTTPS URL.</span></span>
* <span data-ttu-id="9caf5-121">自訂標頭一律會以加密格式保存在磁片上。</span><span class="sxs-lookup"><span data-stu-id="9caf5-121">Custom headers are always persisted in an encrypted format on disk.</span></span>
* <span data-ttu-id="9caf5-122">您可以使用 [**IBackgroundCopyJobHttpOptions3：： MakeCustomHeadersWriteOnly**](/windows/win32/api/Bits10_3/nf-bits10_3-ibackgroundcopyjobhttpoptions3-makecustomheaderswriteonly) 方法，防止客戶標頭傳回其他程式。</span><span class="sxs-lookup"><span data-stu-id="9caf5-122">You can prevent customer headers from being returned to other programs with the [**IBackgroundCopyJobHttpOptions3::MakeCustomHeadersWriteOnly**](/windows/win32/api/Bits10_3/nf-bits10_3-ibackgroundcopyjobhttpoptions3-makecustomheaderswriteonly) method.</span></span>


## <a name="standard-and-administrator-users"></a><span data-ttu-id="9caf5-123">標準和系統管理員使用者</span><span class="sxs-lookup"><span data-stu-id="9caf5-123">Standard and Administrator users</span></span>
<span data-ttu-id="9caf5-124">系統管理員群組中的使用者可以使用系統管理員許可權) ，以標準使用者存取權或提高許可權的狀態 (處理常式。</span><span class="sxs-lookup"><span data-stu-id="9caf5-124">A user who is in the administrator group can run a process with standard user access or in an elevated state (with administrator privileges).</span></span> <span data-ttu-id="9caf5-125">只要使用者登入電腦，BITS 就會以任一狀態執行工作。</span><span class="sxs-lookup"><span data-stu-id="9caf5-125">BITS will run the job in either state as long as the user is logged onto the computer.</span></span> <span data-ttu-id="9caf5-126">不過，如果使用者建立工作或取得工作的擁有權（以提高許可權狀態），則使用者必須處於提升的狀態才能抓取或修改作業 (否則，呼叫會失敗，並會拒絕存取 (0x80070005) ) 。</span><span class="sxs-lookup"><span data-stu-id="9caf5-126">However, if the user created the job or took ownership of the job in an elevated state, the user must be in the elevated state to retrieve or modify the job (otherwise, the call fails with Access Denied (0x80070005)).</span></span> <span data-ttu-id="9caf5-127">若要判斷作業的提升狀態，請呼叫 [**IBackgroundCopyJob4：： GetOwnerElevationState**](/windows/desktop/api/Bits3_0/nf-bits3_0-ibackgroundcopyjob4-getownerelevationstate) 方法。</span><span class="sxs-lookup"><span data-stu-id="9caf5-127">To determine the elevated state of a job, call the [**IBackgroundCopyJob4::GetOwnerElevationState**](/windows/desktop/api/Bits3_0/nf-bits3_0-ibackgroundcopyjob4-getownerelevationstate) method.</span></span>

<span data-ttu-id="9caf5-128">標準使用者無法列舉或修改其他使用者所擁有的作業。</span><span class="sxs-lookup"><span data-stu-id="9caf5-128">A standard user cannot enumerate or modify jobs owned by other users.</span></span>

## <a name="integrity-level"></a><span data-ttu-id="9caf5-129">完整性層級</span><span class="sxs-lookup"><span data-stu-id="9caf5-129">Integrity level</span></span>
<span data-ttu-id="9caf5-130">除了提升的狀態之外，權杖的完整性層級還可以判斷使用者是否可以修改作業。</span><span class="sxs-lookup"><span data-stu-id="9caf5-130">In addition to the elevated state, the integrity level of the token can determine if the user can modify a job.</span></span> <span data-ttu-id="9caf5-131">用戶端無法修改具有較高完整性層級的權杖所建立的工作。</span><span class="sxs-lookup"><span data-stu-id="9caf5-131">A client cannot modify jobs created by a token with a higher integrity level.</span></span> <span data-ttu-id="9caf5-132">尤其是許多本機系統權杖的完整性層級高於提高許可權之視窗的完整性層級，因此系統管理員無法從一般提高許可權的命令視窗修改它們。</span><span class="sxs-lookup"><span data-stu-id="9caf5-132">In particular, many local-system tokens carry an integrity level higher than the integrity level of an elevated window, and so they cannot be modified by an administrator from an ordinary elevated command window.</span></span> <span data-ttu-id="9caf5-133">例如，Windows Update 和 SMS 作業以 LocalSystem 的身分執行，其完整性層級高於提高許可權的權杖，因此系統管理員無法修改或刪除這些作業。</span><span class="sxs-lookup"><span data-stu-id="9caf5-133">For example, Windows Update and SMS jobs run as LocalSystem which has a higher integrity level than an elevated token so an administrator cannot modify or delete these jobs.</span></span> <span data-ttu-id="9caf5-134">若要修改這些作業，請建立以本機系統的形式執行工作排程器工作。</span><span class="sxs-lookup"><span data-stu-id="9caf5-134">To modify these job, create a Task Scheduler task that runs as local system.</span></span> <span data-ttu-id="9caf5-135">工作可以執行使用 BITS API 的主控台應用程式，或者工作可以執行呼叫 BitsAdmin.exe 的腳本。</span><span class="sxs-lookup"><span data-stu-id="9caf5-135">The task can execute a console application that uses the BITS API, or the task could execute a script that calls BitsAdmin.exe.</span></span> <span data-ttu-id="9caf5-136">若要判斷使用的完整性層級，請呼叫 [**IBackgroundCopyJob4：： GetOwnerIntegrityLevel**](/windows/desktop/api/Bits3_0/nf-bits3_0-ibackgroundcopyjob4-getownerintegritylevel) 方法。</span><span class="sxs-lookup"><span data-stu-id="9caf5-136">To determine the integrity level used, call the [**IBackgroundCopyJob4::GetOwnerIntegrityLevel**](/windows/desktop/api/Bits3_0/nf-bits3_0-ibackgroundcopyjob4-getownerintegritylevel) method.</span></span>

## <a name="service-identity"></a><span data-ttu-id="9caf5-137">服務身分識別</span><span class="sxs-lookup"><span data-stu-id="9caf5-137">Service identity</span></span>
<span data-ttu-id="9caf5-138">從 Windows 10 2019 年5月更新 (10.0;組建 18362) ，從服務啟動的 BITS 作業將會維護服務身分識別。</span><span class="sxs-lookup"><span data-stu-id="9caf5-138">Starting in the Windows 10 May 2019 Update (10.0; Build 18362), BITS jobs started from a service will maintain the service identity.</span></span> <span data-ttu-id="9caf5-139">這可讓想要使用 BITS 的服務，將檔案從其許可權系結至服務 SID 的目錄中下載檔案或上傳檔案。</span><span class="sxs-lookup"><span data-stu-id="9caf5-139">This allows for services that wish to use BITS to download files to or upload files from a directory whose permissions are tied to the service SID.</span></span> <span data-ttu-id="9caf5-140">此外，網路流量將會正確地設定為要求 BITS 工作的服務，而不是以位為的屬性。</span><span class="sxs-lookup"><span data-stu-id="9caf5-140">Additionally, network traffic will be correctly attributed to the service that requested the BITS job instead of being attributed to BITS.</span></span>

 




