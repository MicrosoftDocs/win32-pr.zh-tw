---
description: 服務 (或在不同的安全性內容中執行的任何進程) 必須存取遠端資源，則應該使用通用命名慣例 (UNC) 名稱來存取資源。
ms.assetid: 2582259d-077c-4089-9a87-1a377994f0bd
title: 服務和重新導向的磁片磁碟機
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a3b1435e69ded3bf13a0869a0b9ad2b90bb4682c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "103945124"
---
# <a name="services-and-redirected-drives"></a><span data-ttu-id="5b156-103">服務和重新導向的磁片磁碟機</span><span class="sxs-lookup"><span data-stu-id="5b156-103">Services and Redirected Drives</span></span>

<span data-ttu-id="5b156-104">服務 (或在不同的安全性內容中執行的任何進程) 必須存取遠端資源，則應該使用通用命名慣例 (UNC) 名稱來存取資源。</span><span class="sxs-lookup"><span data-stu-id="5b156-104">A service (or any process running in a different security context) that must access a remote resource should use the Universal Naming Convention (UNC) name to access the resource.</span></span> <span data-ttu-id="5b156-105">服務必須具有適當的許可權才能存取資源。</span><span class="sxs-lookup"><span data-stu-id="5b156-105">The service must have appropriate privileges to access the resource.</span></span> <span data-ttu-id="5b156-106">如果伺服器端服務使用 RPC 連接，則必須在遠端伺服器上啟用委派。</span><span class="sxs-lookup"><span data-stu-id="5b156-106">If a server-side service uses an RPC connection, delegation must be enabled on the remote server.</span></span>

<span data-ttu-id="5b156-107">磁碟機號對系統而言不是全域的。</span><span class="sxs-lookup"><span data-stu-id="5b156-107">Drive letters are not global to the system.</span></span> <span data-ttu-id="5b156-108">每個登入會話都會收到一組來自 A 至 Z 的磁碟機號。因此，在不同的使用者帳戶下執行的進程之間無法共用重新導向的磁片磁碟機。</span><span class="sxs-lookup"><span data-stu-id="5b156-108">Each logon session receives its own set of drive letters from A to Z. Therefore, redirected drives cannot be shared between processes running under different user accounts.</span></span> <span data-ttu-id="5b156-109">此外，服務 (或在自己的登入會話中執行的任何進程) 無法存取在不同登入會話中建立的磁碟機號。</span><span class="sxs-lookup"><span data-stu-id="5b156-109">Moreover, a service (or any process running within its own logon session) cannot access the drive letters that were established within a different logon session.</span></span>

<span data-ttu-id="5b156-110">服務不應該透過對應的磁碟機號直接存取本機或網路資源，也不應該在執行時間呼叫 **net use** 命令來對應磁碟機號。</span><span class="sxs-lookup"><span data-stu-id="5b156-110">A service should not directly access local or network resources through mapped drive letters, nor should it call the **net use** command to map drive letters at run time.</span></span> <span data-ttu-id="5b156-111">基於下列原因，不建議 **使用 net use** 命令：</span><span class="sxs-lookup"><span data-stu-id="5b156-111">The **net use** command is not recommended for several reasons:</span></span>

-   <span data-ttu-id="5b156-112">磁片磁碟機對應存在於所有登入內容中，因此，如果應用程式是在 [LocalService 帳戶](localservice-account.md)的內容中執行，則在該內容中執行的任何其他服務都可以存取對應的磁片磁碟機。</span><span class="sxs-lookup"><span data-stu-id="5b156-112">Drive mappings exist across logon contexts, so if an application is running in the context of the [LocalService account](localservice-account.md), then any other service running in that context may have access to the mapped drive.</span></span>
-   <span data-ttu-id="5b156-113">如果服務將明確的認證提供給 **net use** 命令，這些認證可能不會在服務界限之外不慎共用。</span><span class="sxs-lookup"><span data-stu-id="5b156-113">If the service provides explicit credentials to a **net use** command, those credentials might be inadvertently shared outside of the service boundaries.</span></span> <span data-ttu-id="5b156-114">相反地，服務應該使用 [用戶端](/windows/desktop/SecAuthZ/client-impersonation) 模擬來模擬使用者。</span><span class="sxs-lookup"><span data-stu-id="5b156-114">Instead, the service should use [client impersonation](/windows/desktop/SecAuthZ/client-impersonation) to impersonate the user.</span></span>
-   <span data-ttu-id="5b156-115">在相同內容中執行的多個服務可能會互相干擾。</span><span class="sxs-lookup"><span data-stu-id="5b156-115">Multiple services running in the same context may interfere with each other.</span></span> <span data-ttu-id="5b156-116">如果這兩個服務都執行明確的 **網路使用** ，並同時提供相同的認證，則其中一個服務會失敗，並出現「已連線」錯誤。</span><span class="sxs-lookup"><span data-stu-id="5b156-116">If both services perform an explicit **net use** and provide the same credentials at the same time, one service will fail with an "already connected" error.</span></span>

<span data-ttu-id="5b156-117">此外，服務不應該使用 [Windows 網路功能](/windows/desktop/WNet/windows-networking-functions) 來管理對應的磁碟機號。</span><span class="sxs-lookup"><span data-stu-id="5b156-117">Additionally, a service should not use the [Windows Networking Functions](/windows/desktop/WNet/windows-networking-functions) to manage mapped drive letters.</span></span> <span data-ttu-id="5b156-118">雖然 WNet 函式可能會傳回成功，但產生的行為並不是預期的行為。</span><span class="sxs-lookup"><span data-stu-id="5b156-118">Although the WNet functions may return successfully, the resulting behavior is not as intended.</span></span> <span data-ttu-id="5b156-119">當系統建立重新導向的磁片磁碟機時，它會以每個使用者為基礎來儲存。</span><span class="sxs-lookup"><span data-stu-id="5b156-119">When the system establishes a redirected drive, it is stored on a per-user basis.</span></span> <span data-ttu-id="5b156-120">只有使用者能夠管理重新導向的磁片磁碟機。</span><span class="sxs-lookup"><span data-stu-id="5b156-120">Only the user is able to manage the redirected drive.</span></span> <span data-ttu-id="5b156-121">系統會根據使用者的登入安全識別碼 (SID) 來追蹤重新導向的磁片磁碟機。</span><span class="sxs-lookup"><span data-stu-id="5b156-121">The system keeps track of redirected drives based on the user's logon security identifier (SID).</span></span> <span data-ttu-id="5b156-122">登入 SID 是使用者登入會話的唯一識別碼。</span><span class="sxs-lookup"><span data-stu-id="5b156-122">The logon SID is a unique identifier for the user's logon session.</span></span> <span data-ttu-id="5b156-123">單一使用者在系統上可以有多個同時登入會話。</span><span class="sxs-lookup"><span data-stu-id="5b156-123">A single user can have multiple, simultaneous logon sessions on the system.</span></span>

<span data-ttu-id="5b156-124">如果服務設定為在使用者帳戶下執行，系統一律會為使用者建立新的登入會話，並在該新的登入會話中啟動該服務。</span><span class="sxs-lookup"><span data-stu-id="5b156-124">If a service is configured to run under a user account, the system always creates a new logon session for the user and starts the service in that new logon session.</span></span> <span data-ttu-id="5b156-125">因此，服務無法管理在使用者的其他會話中建立的磁片磁碟機對應。</span><span class="sxs-lookup"><span data-stu-id="5b156-125">Therefore, a service cannot manage the drive mappings established within the user's other sessions.</span></span>

<span data-ttu-id="5b156-126">**Windows Server 2003：** 在具有多個網路介面 (也就是) 的多重主機電腦上的電腦上，使用 UNC 路徑來存取儲存在遠端伺服器訊息區 (SMB) 伺服器上的檔案時，可能會延遲最多60秒。</span><span class="sxs-lookup"><span data-stu-id="5b156-126">**Windows Server 2003:** On a computer that has multiple network interfaces (that is, a multihomed computer), delays up to 60 seconds may occur when using UNC paths to access files that are stored on a remote server message block (SMB) server.</span></span> <span data-ttu-id="5b156-127">如需詳細資訊，請參閱說明及支援知識庫中的 [文章 890553](https://support.microsoft.com/kb/890553) 。</span><span class="sxs-lookup"><span data-stu-id="5b156-127">For more information, see [article 890553](https://support.microsoft.com/kb/890553) in the Help and Support Knowledge Base.</span></span>

 

 
