---
description: 服務模型已有重大變更，可改善服務的效能、可靠性、安全性、管理及管理。
ms.assetid: b1c09468-51e1-4ffd-bf07-6faa9f9336dd
title: Windows Vista 的服務變更
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e6ba96cc0c69e2bda4e19e7d093098c578e31c4b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "103847925"
---
# <a name="service-changes-for-windows-vista"></a><span data-ttu-id="28f6c-103">Windows Vista 的服務變更</span><span class="sxs-lookup"><span data-stu-id="28f6c-103">Service Changes for Windows Vista</span></span>

<span data-ttu-id="28f6c-104">服務模型已有重大變更，可改善服務的效能、可靠性、安全性、管理及管理。</span><span class="sxs-lookup"><span data-stu-id="28f6c-104">There have been significant changes to the services model to improve performance, reliability, security, management, and administration of services.</span></span>

<span data-ttu-id="28f6c-105">下表摘要說明 Windows Vista 服務的增強功能。</span><span class="sxs-lookup"><span data-stu-id="28f6c-105">The following table summarizes the enhancements to services for Windows Vista.</span></span>



| <span data-ttu-id="28f6c-106">增強功能</span><span class="sxs-lookup"><span data-stu-id="28f6c-106">Enhancement</span></span>                                                                                                                                                                                                  | <span data-ttu-id="28f6c-107">Description</span><span class="sxs-lookup"><span data-stu-id="28f6c-107">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="28f6c-108"><span id="Delayed_Auto-Start"></span><span id="delayed_auto-start"></span><span id="DELAYED_AUTO-START"></span>延遲的自動啟動</span><span class="sxs-lookup"><span data-stu-id="28f6c-108"><span id="Delayed_Auto-Start"></span><span id="delayed_auto-start"></span><span id="DELAYED_AUTO-START"></span>Delayed Auto-Start</span></span><br/>                                                                 | <span data-ttu-id="28f6c-109">延遲的自動啟動服務會在系統啟動之後立即啟動。</span><span class="sxs-lookup"><span data-stu-id="28f6c-109">Delayed auto-start services are started shortly after the system has started.</span></span> <span data-ttu-id="28f6c-110">這可改善系統啟動效能，同時仍提供這些服務的自動啟動。</span><span class="sxs-lookup"><span data-stu-id="28f6c-110">This improves system startup performance while still providing automatic startup for these services.</span></span> <span data-ttu-id="28f6c-111">若要設定延遲的自動啟動旗標，請使用服務設定 **\_ 延遲的 \_ \_ 自動 \_ 啟動 \_ 資訊** 來呼叫 [**ChangeServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-changeserviceconfig2a)函數。</span><span class="sxs-lookup"><span data-stu-id="28f6c-111">To set the delayed auto-start flag, call the [**ChangeServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-changeserviceconfig2a) function with **SERVICE\_CONFIG\_DELAYED\_AUTO\_START\_INFO**.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| <span data-ttu-id="28f6c-112"><span id="Failure_Detection_and_Recovery"></span><span id="failure_detection_and_recovery"></span><span id="FAILURE_DETECTION_AND_RECOVERY"></span>失敗偵測和復原</span><span class="sxs-lookup"><span data-stu-id="28f6c-112"><span id="Failure_Detection_and_Recovery"></span><span id="failure_detection_and_recovery"></span><span id="FAILURE_DETECTION_AND_RECOVERY"></span>Failure Detection and Recovery</span></span><br/>                 | <span data-ttu-id="28f6c-113">如果服務失敗，服務控制管理員 (SCM) 可能會執行失敗的動作，例如重新開機服務，以嘗試從該失敗中復原。</span><span class="sxs-lookup"><span data-stu-id="28f6c-113">If a service fails, the service control manager (SCM) can perform a failure action, such as restarting the service in an attempt to recover from that failure.</span></span> <span data-ttu-id="28f6c-114">若要設定失敗動作，請使用 **服務設定 \_ \_ 失敗 \_ 動作** 來呼叫 [**ChangeServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-changeserviceconfig2a) 。</span><span class="sxs-lookup"><span data-stu-id="28f6c-114">To configure a failure action, call [**ChangeServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-changeserviceconfig2a) with **SERVICE\_CONFIG\_FAILURE\_ACTIONS**.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| <span data-ttu-id="28f6c-115"><span id="Preshutdown_Notifications"></span><span id="preshutdown_notifications"></span><span id="PRESHUTDOWN_NOTIFICATIONS"></span>Preshutdown 通知</span><span class="sxs-lookup"><span data-stu-id="28f6c-115"><span id="Preshutdown_Notifications"></span><span id="preshutdown_notifications"></span><span id="PRESHUTDOWN_NOTIFICATIONS"></span>Preshutdown Notifications</span></span><br/>                                     | <span data-ttu-id="28f6c-116">服務可以在接收實際的關機通知之前註冊，以在其 [*HandlerEx*](/windows/desktop/api/WinSvc/nc-winsvc-lphandler_function_ex)函數中接收 **服務 \_ 控制項 \_ PRESHUTDOWN** 通知。</span><span class="sxs-lookup"><span data-stu-id="28f6c-116">A service can register to receive a **SERVICE\_CONTROL\_PRESHUTDOWN** notification in its [*HandlerEx*](/windows/desktop/api/WinSvc/nc-winsvc-lphandler_function_ex) function before it receives the actual shutdown notification.</span></span> <span data-ttu-id="28f6c-117">這可為服務提供冗長的關機程式，使其正常關機的時間更長。</span><span class="sxs-lookup"><span data-stu-id="28f6c-117">This provides services with a lengthy shutdown procedure more time to shut down gracefully.</span></span> <span data-ttu-id="28f6c-118">若要設定超時值，請使用 **服務設定 \_ \_ PRESHUTDOWN \_ 資訊** 來呼叫 [**ChangeServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-changeserviceconfig2a) 。</span><span class="sxs-lookup"><span data-stu-id="28f6c-118">To set the time-out value, call [**ChangeServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-changeserviceconfig2a) with **SERVICE\_CONFIG\_PRESHUTDOWN\_INFO**.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                      |
| <span data-ttu-id="28f6c-119"><span id="Restricted_Network_Access"></span><span id="restricted_network_access"></span><span id="RESTRICTED_NETWORK_ACCESS"></span>限制的網路存取</span><span class="sxs-lookup"><span data-stu-id="28f6c-119"><span id="Restricted_Network_Access"></span><span id="restricted_network_access"></span><span id="RESTRICTED_NETWORK_ACCESS"></span>Restricted Network Access</span></span><br/>                                     | <span data-ttu-id="28f6c-120">您可以使用服務 Sid 來限制對埠、通訊協定或網路流量方向的存取。</span><span class="sxs-lookup"><span data-stu-id="28f6c-120">You can use service SIDs to restrict access to ports, protocols, or the direction of network traffic.</span></span> <span data-ttu-id="28f6c-121">若要限制服務的網路存取權，請使用 [**INetFwServiceRestriction**](/windows/desktop/api/netfw/nn-netfw-inetfwservicerestriction) 介面。</span><span class="sxs-lookup"><span data-stu-id="28f6c-121">To restrict a service's access to the network, use the [**INetFwServiceRestriction**](/windows/desktop/api/netfw/nn-netfw-inetfwservicerestriction) interface.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| <span data-ttu-id="28f6c-122"><span id="Running_with_Least_Privilege"></span><span id="running_with_least_privilege"></span><span id="RUNNING_WITH_LEAST_PRIVILEGE"></span>以最低許可權執行</span><span class="sxs-lookup"><span data-stu-id="28f6c-122"><span id="Running_with_Least_Privilege"></span><span id="running_with_least_privilege"></span><span id="RUNNING_WITH_LEAST_PRIVILEGE"></span>Running with Least Privilege</span></span><br/>                         | <span data-ttu-id="28f6c-123">服務可以在包含必要許可權的任何帳戶下執行 (LocalService、NetworkService、LocalSystem、網域帳戶或本機帳戶) ，以及藉由呼叫 [**ChangeServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-changeserviceconfig2a) 與 **服務設定 \_ \_ 所需的 \_ 許可權 \_ 資訊** 來指出所需的許可權。</span><span class="sxs-lookup"><span data-stu-id="28f6c-123">Services can run under any account that contains the required privileges (LocalService, NetworkService, LocalSystem, a domain account, or a local account) and indicate the required privileges by calling [**ChangeServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-changeserviceconfig2a) with **SERVICE\_CONFIG\_REQUIRED\_PRIVILEGES\_INFO**.</span></span> <span data-ttu-id="28f6c-124">SCM 會移除任何不需要的許可權。</span><span class="sxs-lookup"><span data-stu-id="28f6c-124">The SCM removes any privileges that are not required.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| <span data-ttu-id="28f6c-125"><span id="Service_Isolation"></span><span id="service_isolation"></span><span id="SERVICE_ISOLATION"></span>服務隔離</span><span class="sxs-lookup"><span data-stu-id="28f6c-125"><span id="Service_Isolation"></span><span id="service_isolation"></span><span id="SERVICE_ISOLATION"></span>Service Isolation</span></span><br/>                                                                     | <span data-ttu-id="28f6c-126">服務可以隔離物件（例如檔案或登錄機碼），以使用包含服務 SID 的存取控制專案來保護它們的專屬用途。</span><span class="sxs-lookup"><span data-stu-id="28f6c-126">A service can isolate objects, such as files or registry keys, for its exclusive use by securing them with an access control entry that contains a service SID.</span></span> <span data-ttu-id="28f6c-127">將此 SID 指派給服務之後，服務擁有者可以修改物件的存取控制清單，以授與 SID 的存取權。</span><span class="sxs-lookup"><span data-stu-id="28f6c-127">After this SID has been assigned to a service, the service owner can modify the objects' access control lists to grant access to the SID.</span></span> <span data-ttu-id="28f6c-128">這可讓服務存取特定物件，而不需以高許可權帳戶執行或降低物件的安全性。</span><span class="sxs-lookup"><span data-stu-id="28f6c-128">This enables a service to access specific objects without running under a high-privilege account or lowering the security on the objects.</span></span> <span data-ttu-id="28f6c-129">若要設定服務 SID，請使用 **服務設定 \_ \_ 服務 \_ Sid \_ 資訊** 來呼叫 [**ChangeServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-changeserviceconfig2a) 。</span><span class="sxs-lookup"><span data-stu-id="28f6c-129">To set the service SID, call [**ChangeServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-changeserviceconfig2a) with **SERVICE\_CONFIG\_SERVICE\_SID\_INFO**.</span></span><br/>                                                                                                                                                                                                                                     |
| <span data-ttu-id="28f6c-130"><span id="Service_State_Change_Notifications"></span><span id="service_state_change_notifications"></span><span id="SERVICE_STATE_CHANGE_NOTIFICATIONS"></span>服務狀態變更通知</span><span class="sxs-lookup"><span data-stu-id="28f6c-130"><span id="Service_State_Change_Notifications"></span><span id="service_state_change_notifications"></span><span id="SERVICE_STATE_CHANGE_NOTIFICATIONS"></span>Service State Change Notifications</span></span><br/> | <span data-ttu-id="28f6c-131">服務可以註冊，以便在服務建立、刪除或變更狀態時收到通知，方法是使用 [**NotifyServiceStatusChange**](/windows/desktop/api/Winsvc/nf-winsvc-notifyservicestatuschangea) 函數。</span><span class="sxs-lookup"><span data-stu-id="28f6c-131">Services can register to be notified when a service is created, deleted, or has a change in status by using the [**NotifyServiceStatusChange**](/windows/desktop/api/Winsvc/nf-winsvc-notifyservicestatuschangea) function.</span></span> <span data-ttu-id="28f6c-132">這比在迴圈中呼叫 [**QueryServiceStatusEx**](/windows/desktop/api/Winsvc/nf-winsvc-queryservicestatusex) 函數來輪詢狀態更有效率。</span><span class="sxs-lookup"><span data-stu-id="28f6c-132">This is more efficient than calling the [**QueryServiceStatusEx**](/windows/desktop/api/Winsvc/nf-winsvc-queryservicestatusex) function in a loop to poll for status.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| <span data-ttu-id="28f6c-133"><span id="Session_0_Isolation"></span><span id="session_0_isolation"></span><span id="SESSION_0_ISOLATION"></span>會話0隔離</span><span class="sxs-lookup"><span data-stu-id="28f6c-133"><span id="Session_0_Isolation"></span><span id="session_0_isolation"></span><span id="SESSION_0_ISOLATION"></span>Session 0 Isolation</span></span><br/>                                                             | <span data-ttu-id="28f6c-134">服務一律在會話0中執行。</span><span class="sxs-lookup"><span data-stu-id="28f6c-134">Services have always run in session 0.</span></span> <span data-ttu-id="28f6c-135">在 Windows Vista 之前，第一個登入的使用者也會指派給會話0。</span><span class="sxs-lookup"><span data-stu-id="28f6c-135">Before Windows Vista, the first user to log on was also assigned to session 0.</span></span> <span data-ttu-id="28f6c-136">現在，會話0是專門針對未與互動式使用者會話相關聯的服務和其他應用程式所保留。</span><span class="sxs-lookup"><span data-stu-id="28f6c-136">Now, session 0 is reserved exclusively for services and other applications not associated with an interactive user session.</span></span> <span data-ttu-id="28f6c-137"> (第一位登入的使用者連接到會話1時，登入的第二位使用者會連線到會話2，依此類推。 ) 會話0不支援與使用者互動的進程。</span><span class="sxs-lookup"><span data-stu-id="28f6c-137">(The first user to log on is connected to session 1, the second user to log on is connected to session 2, and so on.) Session 0 does not support processes that interact with the user.</span></span><br/> <span data-ttu-id="28f6c-138">這種變更表示服務無法張貼或傳送訊息至應用程式，且應用程式無法將訊息傳送或張貼至服務。</span><span class="sxs-lookup"><span data-stu-id="28f6c-138">This change means that a service cannot post or send a message to an application and an application cannot send or post a message to a service.</span></span> <span data-ttu-id="28f6c-139">此外，服務也無法直接顯示使用者介面專案，例如對話方塊。</span><span class="sxs-lookup"><span data-stu-id="28f6c-139">In addition, services cannot display a user interface item such as a dialog box directly.</span></span> <span data-ttu-id="28f6c-140">服務可以使用 [**WTSSendMessage**](/windows/desktop/api/wtsapi32/nf-wtsapi32-wtssendmessagea) 函數，在另一個會話中顯示對話方塊。</span><span class="sxs-lookup"><span data-stu-id="28f6c-140">A service can use the [**WTSSendMessage**](/windows/desktop/api/wtsapi32/nf-wtsapi32-wtssendmessagea) function to display a dialog box in another session.</span></span><br/> |



 

## <a name="related-topics"></a><span data-ttu-id="28f6c-141">相關主題</span><span class="sxs-lookup"><span data-stu-id="28f6c-141">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="28f6c-142">服務</span><span class="sxs-lookup"><span data-stu-id="28f6c-142">Services</span></span>](services.md)
</dt> </dl>

 

