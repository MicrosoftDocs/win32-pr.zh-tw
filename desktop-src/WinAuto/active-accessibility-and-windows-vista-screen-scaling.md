---
title: Active Accessibility 和 Windows Vista 螢幕縮放比例
description: Windows Vista 可讓使用者變更每英寸 (DPI) 設定，讓螢幕上大部分的 UI 元素顯示較大。
ms.assetid: c781fefd-09f0-4340-b3d3-f4e57308f392
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6db8e192dc01d4c7d75f19741cdfac7b3b08d22c
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/20/2020
ms.locfileid: "104463480"
---
# <a name="active-accessibility-and-windows-vista-screen-scaling"></a><span data-ttu-id="fc6be-103">Active Accessibility 和 Windows Vista 螢幕縮放比例</span><span class="sxs-lookup"><span data-stu-id="fc6be-103">Active Accessibility and Windows Vista Screen Scaling</span></span>

<span data-ttu-id="fc6be-104">Windows Vista 可讓使用者變更每英寸 (DPI) 設定，讓螢幕上大部分的 UI 元素顯示較大。</span><span class="sxs-lookup"><span data-stu-id="fc6be-104">Windows Vista enables users to change the dots-per-inch (dpi) setting so that most UI elements on the screen appear larger.</span></span> <span data-ttu-id="fc6be-105">雖然這項功能已在 Microsoft Windows 中提供，但在舊版中，調整必須由應用程式執行。</span><span class="sxs-lookup"><span data-stu-id="fc6be-105">Although this feature has long been available in Microsoft Windows, in previous versions the scaling had to be implemented by applications.</span></span> <span data-ttu-id="fc6be-106">在 Windows Vista 中，桌面視窗管理員會對所有不會處理自己調整規模的應用程式執行預設調整。</span><span class="sxs-lookup"><span data-stu-id="fc6be-106">In Windows Vista, the Desktop Window Manager performs default scaling for all applications that do not handle their own scaling.</span></span> <span data-ttu-id="fc6be-107">Microsoft Active Accessibility 用戶端應用程式必須將這項功能納入考慮。</span><span class="sxs-lookup"><span data-stu-id="fc6be-107">Microsoft Active Accessibility client applications must take this feature into account.</span></span>

## <a name="scaling-in-windows-vista"></a><span data-ttu-id="fc6be-108">Windows Vista 中的縮放比例</span><span class="sxs-lookup"><span data-stu-id="fc6be-108">Scaling in Windows Vista</span></span>

<span data-ttu-id="fc6be-109">預設的 DPI 設定為96，這表示96圖元佔用一個名義英寸的寬度或高度。</span><span class="sxs-lookup"><span data-stu-id="fc6be-109">The default dpi setting is 96, which means that 96 pixels occupy a width or height of one notional inch.</span></span> <span data-ttu-id="fc6be-110">「英吋」的確切測量值取決於監視器的大小和實體解析度。</span><span class="sxs-lookup"><span data-stu-id="fc6be-110">The exact measure of an "inch" depends on the size and physical resolution of the monitor.</span></span> <span data-ttu-id="fc6be-111">例如，在 12 英吋寬、1280 像素水平解析度的監視器上，96 像素的水平線長度約一英吋的 9/10。</span><span class="sxs-lookup"><span data-stu-id="fc6be-111">For example, on a monitor 12 inches wide, at a horizontal resolution of 1280 pixels, a horizontal line of 96 pixels extends about 9/10 of an inch.</span></span>

<span data-ttu-id="fc6be-112">變更 DPI 設定與變更螢幕解析度不同。</span><span class="sxs-lookup"><span data-stu-id="fc6be-112">Changing the dpi setting is not the same as changing the screen resolution.</span></span> <span data-ttu-id="fc6be-113">在 DPI 縮放比例中，螢幕上的實體圖元數目會維持不變。</span><span class="sxs-lookup"><span data-stu-id="fc6be-113">With dpi scaling, the number of physical pixels on the screen remains the same.</span></span> <span data-ttu-id="fc6be-114">不過，縮放比例會套用至 UI 元素的大小和位置。</span><span class="sxs-lookup"><span data-stu-id="fc6be-114">However, scaling is applied to the size and location of UI elements.</span></span> <span data-ttu-id="fc6be-115">針對未明確要求不縮放的桌面和應用程式，桌面視窗管理員 (DWM) 會自動執行縮放。</span><span class="sxs-lookup"><span data-stu-id="fc6be-115">This scaling can be performed automatically by the Desktop Window Manager (DWM) for the desktop and for applications that do not explicitly ask not to be scaled.</span></span>

<span data-ttu-id="fc6be-116">實際上，當使用者將縮放比例設定為 120 DPI 時，螢幕上的垂直或水準英寸會變大25%。</span><span class="sxs-lookup"><span data-stu-id="fc6be-116">In effect, when the user sets the scale factor to 120 dpi, a vertical or horizontal inch on the screen becomes bigger by 25 percent.</span></span> <span data-ttu-id="fc6be-117">所有維度都會因此調整。</span><span class="sxs-lookup"><span data-stu-id="fc6be-117">All dimensions are scaled accordingly.</span></span> <span data-ttu-id="fc6be-118">視窗的上邊緣和左邊緣的位移會增加25%。</span><span class="sxs-lookup"><span data-stu-id="fc6be-118">The offset of a window from the top and left edges of the screen increases by 25 percent.</span></span> <span data-ttu-id="fc6be-119">視窗的大小會以相同比例增加，以及它所包含之所有 UI 元素的位移和大小。</span><span class="sxs-lookup"><span data-stu-id="fc6be-119">The size of the window increases in the same proportion, along with the offsets and sizes of all UI elements it contains.</span></span>

<span data-ttu-id="fc6be-120">根據預設，當使用者將 DPI 設定為120時，DWM 不會執行非 DPI 感知應用程式的縮放比例，但當 DPI 設定為自訂值144或更高時，則會執行此工作。</span><span class="sxs-lookup"><span data-stu-id="fc6be-120">By default, the DWM does not perform scaling for non-dpi-aware applications when the user sets the dpi to 120, but does perform it when the dpi is set to a custom value of 144 or higher.</span></span> <span data-ttu-id="fc6be-121">不過，使用者可以覆寫此預設行為。</span><span class="sxs-lookup"><span data-stu-id="fc6be-121">However, the user can override the default behavior.</span></span>

<span data-ttu-id="fc6be-122">針對重視畫面座標的應用程式，畫面縮放比例會產生新挑戰。</span><span class="sxs-lookup"><span data-stu-id="fc6be-122">Screen scaling creates new challenges for applications that are concerned in any way with screen coordinates.</span></span> <span data-ttu-id="fc6be-123">畫面現在包含兩個座標系統：實體和邏輯。</span><span class="sxs-lookup"><span data-stu-id="fc6be-123">The screen now contains two coordinate systems: physical and logical.</span></span> <span data-ttu-id="fc6be-124">點的實體座標是來自原點左上方的實際位移 (以像素為單位)。</span><span class="sxs-lookup"><span data-stu-id="fc6be-124">The physical coordinates of a point are the actual offset in pixels from the top left of the origin.</span></span> <span data-ttu-id="fc6be-125">邏輯座標則是像素本身縮放時，跟著縮放的位移。</span><span class="sxs-lookup"><span data-stu-id="fc6be-125">The logical coordinates are the offsets as they would be if the pixels themselves were scaled.</span></span>

<span data-ttu-id="fc6be-126">假設您設計的對話方塊在座標 (100, 48) 上有一個按鈕。</span><span class="sxs-lookup"><span data-stu-id="fc6be-126">Suppose you design a dialog box with a button at coordinates (100, 48).</span></span> <span data-ttu-id="fc6be-127">當此對話方塊顯示為預設 96 DPI 時，此按鈕會位於 (100，48) 的實體座標。</span><span class="sxs-lookup"><span data-stu-id="fc6be-127">When this dialog box is displayed at the default 96 dpi, the button is located at physical coordinates of (100, 48).</span></span> <span data-ttu-id="fc6be-128">以 120 DPI 為單位，位於 (125，60) 的實體座標。</span><span class="sxs-lookup"><span data-stu-id="fc6be-128">At 120 dpi, it is located at physical coordinates of (125, 60).</span></span> <span data-ttu-id="fc6be-129">但是在任何 DPI 設定中，邏輯座標都相同： (100、48) 。</span><span class="sxs-lookup"><span data-stu-id="fc6be-129">But the logical coordinates are the same at any dpi setting: (100, 48).</span></span>

<span data-ttu-id="fc6be-130">邏輯座標很重要，因為它們會讓作業系統和應用程式的行為保持一致，而不論 DPI 設定為何。</span><span class="sxs-lookup"><span data-stu-id="fc6be-130">Logical coordinates are important, because they make the behavior of the operating system and applications consistent regardless of the dpi setting.</span></span> <span data-ttu-id="fc6be-131">例如， **system.object** 通常會傳回邏輯座標，。</span><span class="sxs-lookup"><span data-stu-id="fc6be-131">For example, **System.Windows.Forms.Cursor.Position** normally returns the logical coordinates.</span></span> <span data-ttu-id="fc6be-132">如果您將游標移到對話方塊中的專案上方，則會傳回相同的座標，不論 DPI 設定為何。</span><span class="sxs-lookup"><span data-stu-id="fc6be-132">If you move the cursor over an element in a dialog box, the same coordinates are returned regardless of the dpi setting.</span></span> <span data-ttu-id="fc6be-133">如果您在 (100、100) 繪製控制項，則會將它繪製至這些邏輯座標，而且會佔用與任何 DPI 設定相同的相對位置。</span><span class="sxs-lookup"><span data-stu-id="fc6be-133">If you draw a control at (100, 100), it is drawn to those logical coordinates, and will occupy the same relative position at any dpi setting.</span></span>

## <a name="scaling-in-active-accessibility-clients"></a><span data-ttu-id="fc6be-134">Active Accessibility 用戶端進行調整</span><span class="sxs-lookup"><span data-stu-id="fc6be-134">Scaling in Active Accessibility Clients</span></span>

<span data-ttu-id="fc6be-135">Microsoft Active Accessibility 不會使用邏輯座標。</span><span class="sxs-lookup"><span data-stu-id="fc6be-135">Microsoft Active Accessibility does not use logical coordinates.</span></span> <span data-ttu-id="fc6be-136">下列方法和函式會傳回實體座標或將它們視為參數。</span><span class="sxs-lookup"><span data-stu-id="fc6be-136">The following methods and functions either return physical coordinates or take them as parameters.</span></span>

-   [<span data-ttu-id="fc6be-137">**IAccessible：： accHitTest**</span><span class="sxs-lookup"><span data-stu-id="fc6be-137">**IAccessible::accHitTest**</span></span>](/windows/desktop/api/Oleacc/nf-oleacc-iaccessible-acchittest)
-   [<span data-ttu-id="fc6be-138">**IAccessible：： accLocation**</span><span class="sxs-lookup"><span data-stu-id="fc6be-138">**IAccessible::accLocation**</span></span>](/windows/desktop/api/Oleacc/nf-oleacc-iaccessible-acclocation)
-   [<span data-ttu-id="fc6be-139">**AccessibleObjectFromPoint**</span><span class="sxs-lookup"><span data-stu-id="fc6be-139">**AccessibleObjectFromPoint**</span></span>](/windows/desktop/api/Oleacc/nf-oleacc-accessibleobjectfrompoint)

<span data-ttu-id="fc6be-140">根據預設，在非 96 DPI 環境中執行的 Microsoft Active Accessibility 用戶端應用程式將無法從這些呼叫取得正確的結果。</span><span class="sxs-lookup"><span data-stu-id="fc6be-140">By default, an Microsoft Active Accessibility client application running in a non-96-dpi environment will not be able to obtain correct results from these calls.</span></span> <span data-ttu-id="fc6be-141">例如，因為游標位置是以邏輯座標為單位，所以用戶端無法直接將這些座標傳遞給 [**AccessibleObjectFromPoint**](/windows/desktop/api/Oleacc/nf-oleacc-accessibleobjectfrompoint) ，以取得游標下的元素。</span><span class="sxs-lookup"><span data-stu-id="fc6be-141">For example, because the cursor position is in logical coordinates, the client cannot simply pass these coordinates to [**AccessibleObjectFromPoint**](/windows/desktop/api/Oleacc/nf-oleacc-accessibleobjectfrompoint) to obtain the element that is under the cursor.</span></span>

<span data-ttu-id="fc6be-142">此外，在其工作區之外建立視窗的應用程式（例如強調焦點 UI 元素的協助工具應用程式）將不會在正確的畫面位置上建立視窗，因為視窗將放置於邏輯座標，而不是 [**IAccessible：： accLocation**](/windows/desktop/api/Oleacc/nf-oleacc-iaccessible-acclocation)所傳回的實體座標。</span><span class="sxs-lookup"><span data-stu-id="fc6be-142">In addition, an application that creates a window outside its client area, such as an accessibility application that highlights focused UI elements, will not create the window at the correct screen location, because the window will be placed at the logical coordinates, not the physical coordinates returned by [**IAccessible::accLocation**](/windows/desktop/api/Oleacc/nf-oleacc-iaccessible-acclocation).</span></span>

<span data-ttu-id="fc6be-143">解決方案分為兩個部分：</span><span class="sxs-lookup"><span data-stu-id="fc6be-143">The solution is in two parts:</span></span>

-   <span data-ttu-id="fc6be-144">將用戶端應用程式設為「DPI 感知」。</span><span class="sxs-lookup"><span data-stu-id="fc6be-144">Make the client application "dpi-aware".</span></span> <span data-ttu-id="fc6be-145">若要這樣做，請在啟動時呼叫 [**SetProcessDPIAware**](/windows/win32/api/winuser/nf-winuser-setprocessdpiaware) 函數。</span><span class="sxs-lookup"><span data-stu-id="fc6be-145">To do this, call the [**SetProcessDPIAware**](/windows/win32/api/winuser/nf-winuser-setprocessdpiaware) function at startup.</span></span> <span data-ttu-id="fc6be-146">這個函式會讓整個進程具有 DPI 感知，這表示所有屬於進程的視窗都是無比例的。</span><span class="sxs-lookup"><span data-stu-id="fc6be-146">This function makes the entire process dpi-aware, meaning that all windows that belong to the process are unscaled.</span></span>
-   <span data-ttu-id="fc6be-147">使用可感知 DPI 的函式。</span><span class="sxs-lookup"><span data-stu-id="fc6be-147">Use functions that are dpi-aware.</span></span> <span data-ttu-id="fc6be-148">例如，若要取得資料指標座標，請呼叫 [**GetPhysicalCursorPos**](/windows/win32/api/winuser/nf-winuser-getphysicalcursorpos) 函數。</span><span class="sxs-lookup"><span data-stu-id="fc6be-148">For example, to get cursor coordinates, call the [**GetPhysicalCursorPos**](/windows/win32/api/winuser/nf-winuser-getphysicalcursorpos) function.</span></span> <span data-ttu-id="fc6be-149">請勿使用 [**GetCursorPos**](/windows/win32/api/winuser/nf-winuser-getcursorpos);在 DPI 感知的應用程式中，其行為是未定義的。</span><span class="sxs-lookup"><span data-stu-id="fc6be-149">Do not use [**GetCursorPos**](/windows/win32/api/winuser/nf-winuser-getcursorpos); its behavior in dpi-aware applications is undefined.</span></span>

<span data-ttu-id="fc6be-150">如果您的應用程式執行與非 DPI 感知應用程式的直接跨進程通訊，您可能會使用 [**PhysicalToLogicalPoint**](/windows/win32/api/winuser/nf-winuser-physicaltologicalpoint) 和 [**LogicalToPhysicalPoint**](/windows/win32/api/winuser/nf-winuser-logicaltophysicalpoint) 函式，在邏輯和實體座標之間進行轉換。</span><span class="sxs-lookup"><span data-stu-id="fc6be-150">If your application performs direct cross-process communication with non-dpi-aware applications, you may have convert between logical and physical coordinates by using the [**PhysicalToLogicalPoint**](/windows/win32/api/winuser/nf-winuser-physicaltologicalpoint) and [**LogicalToPhysicalPoint**](/windows/win32/api/winuser/nf-winuser-logicaltophysicalpoint) functions.</span></span>

 

 