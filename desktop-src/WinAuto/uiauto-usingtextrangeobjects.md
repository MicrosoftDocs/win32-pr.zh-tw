---
title: 使用文字範圍
description: 本主題說明如何使用 IUIAutomationTextRange 介面的屬性和方法，來存取和操作以文字為基礎之控制項的文字內容。
ms.assetid: 66BC7324-5322-4996-AF62-766936559F0E
keywords:
- 用戶端，使用文字範圍物件
- 以文字為基礎的控制項
- 用戶端、文字範圍
- 用戶端、TextRange 控制項模式
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6a2aef7c23db6903e3492fec7c83ba7c14599c63
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/20/2020
ms.locfileid: "104375805"
---
# <a name="using-text-ranges"></a><span data-ttu-id="a4beb-107">使用文字範圍</span><span class="sxs-lookup"><span data-stu-id="a4beb-107">Using Text Ranges</span></span>

<span data-ttu-id="a4beb-108">本主題說明如何使用 [**IUIAutomationTextRange**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationtextrange) 介面的屬性和方法，來存取和操作以文字為基礎之控制項的文字內容。</span><span class="sxs-lookup"><span data-stu-id="a4beb-108">This topic describes how to use the properties and methods of the [**IUIAutomationTextRange**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationtextrange) interface to access and manipulate the textual content of a text-based control.</span></span> <span data-ttu-id="a4beb-109">它包含下列區段：</span><span class="sxs-lookup"><span data-stu-id="a4beb-109">It contains the following sections:</span></span>

-   [<span data-ttu-id="a4beb-110">什麼是文字範圍？</span><span class="sxs-lookup"><span data-stu-id="a4beb-110">What is a Text Range?</span></span>](#using-text-ranges)
-   [<span data-ttu-id="a4beb-111">取得文字範圍物件</span><span class="sxs-lookup"><span data-stu-id="a4beb-111">Acquiring Text Range Objects</span></span>](#acquiring-text-range-objects)
-   [<span data-ttu-id="a4beb-112">選取文字範圍中的文字</span><span class="sxs-lookup"><span data-stu-id="a4beb-112">Selecting Text in a Text Range</span></span>](#selecting-text-in-a-text-range)
-   [<span data-ttu-id="a4beb-113">從文字範圍中取出文字</span><span class="sxs-lookup"><span data-stu-id="a4beb-113">Retrieving Text from a Text Range</span></span>](#retrieving-text-from-a-text-range)
-   [<span data-ttu-id="a4beb-114">從文字範圍中取出文字屬性</span><span class="sxs-lookup"><span data-stu-id="a4beb-114">Retrieving Text Attributes from a Text Range</span></span>](#retrieving-text-attributes-from-a-text-range)
-   [<span data-ttu-id="a4beb-115">從文字範圍中取出内嵌物件</span><span class="sxs-lookup"><span data-stu-id="a4beb-115">Retrieving Embedded Objects from a Text Range</span></span>](#retrieving-embedded-objects-from-a-text-range)
-   [<span data-ttu-id="a4beb-116">操作文字範圍</span><span class="sxs-lookup"><span data-stu-id="a4beb-116">Manipulating a Text Range</span></span>](#manipulating-a-text-range)
-   [<span data-ttu-id="a4beb-117">將文字範圍滾動至視野</span><span class="sxs-lookup"><span data-stu-id="a4beb-117">Scrolling a Text Range into View</span></span>](#scrolling-a-text-range-into-view)
-   [<span data-ttu-id="a4beb-118">取出文字範圍的封閉元素</span><span class="sxs-lookup"><span data-stu-id="a4beb-118">Retrieving the Enclosing Element of a Text Range</span></span>](#retrieving-the-enclosing-element-of-a-text-range)
-   [<span data-ttu-id="a4beb-119">比較和複製文字範圍</span><span class="sxs-lookup"><span data-stu-id="a4beb-119">Comparing and Cloning Text Ranges</span></span>](#comparing-and-cloning-text-ranges)
-   [<span data-ttu-id="a4beb-120">正在抓取注釋</span><span class="sxs-lookup"><span data-stu-id="a4beb-120">Retrieving Annotations</span></span>](#retrieving-annotations)
    -   [<span data-ttu-id="a4beb-121">從文字範圍中取出批註類型</span><span class="sxs-lookup"><span data-stu-id="a4beb-121">Retrieving Annotations Types from a Text Range</span></span>](#retrieving-annotations-types-from-a-text-range)
    -   [<span data-ttu-id="a4beb-122">從文字範圍中取出所有批註</span><span class="sxs-lookup"><span data-stu-id="a4beb-122">Retrieving All Annotations from a Text Range</span></span>](#retrieving-all-annotations-from-a-text-range)
    -   [<span data-ttu-id="a4beb-123">抓取特定注釋的相關資訊</span><span class="sxs-lookup"><span data-stu-id="a4beb-123">Retrieving Information About a Particular Annotation</span></span>](#retrieving-information-about-a-particular-annotation)
    -   [<span data-ttu-id="a4beb-124">正在抓取注釋目標文字</span><span class="sxs-lookup"><span data-stu-id="a4beb-124">Retrieving the Annotation Target Text</span></span>](#retrieving-the-annotation-target-text)
-   [<span data-ttu-id="a4beb-125">正在抓取視覺化樣式</span><span class="sxs-lookup"><span data-stu-id="a4beb-125">Retrieving Visual Styles</span></span>](#retrieving-visual-styles)
-   [<span data-ttu-id="a4beb-126">從文字範圍叫用內容功能表</span><span class="sxs-lookup"><span data-stu-id="a4beb-126">Invoking Context Menus From Text Ranges</span></span>](#invoking-context-menus-from-text-ranges)
-   [<span data-ttu-id="a4beb-127">相關主題</span><span class="sxs-lookup"><span data-stu-id="a4beb-127">Related topics</span></span>](#related-topics)

## <a name="what-is-a-text-range"></a><span data-ttu-id="a4beb-128">什麼是文字範圍？</span><span class="sxs-lookup"><span data-stu-id="a4beb-128">What is a Text Range?</span></span>

<span data-ttu-id="a4beb-129">Microsoft 消費者介面自動化 text 物件模型是以 *文字範圍* 的概念為基礎。</span><span class="sxs-lookup"><span data-stu-id="a4beb-129">The Microsoft UI Automation text object model is based on the concept of the *text range*.</span></span> <span data-ttu-id="a4beb-130">文字範圍是公開 [**IUIAutomationTextRange**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationtextrange) 介面的物件，代表以文字為基礎之控制項中的連續文字範圍。</span><span class="sxs-lookup"><span data-stu-id="a4beb-130">A text range is an object that exposes the [**IUIAutomationTextRange**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationtextrange) interface, and represents a contiguous span of text in a text-based control.</span></span> <span data-ttu-id="a4beb-131">每個文字範圍都有起始端點和結束端點，而兩個端點之間的所有文字內容都被視為範圍的一部分。</span><span class="sxs-lookup"><span data-stu-id="a4beb-131">Each text range has both a starting endpoint and an ending endpoint, and all textual content between the two endpoints is considered part of the range.</span></span> <span data-ttu-id="a4beb-132">起始端點和結束端點位於相同位置的文字範圍稱為「 *退化* (」或「空的) 文字範圍。</span><span class="sxs-lookup"><span data-stu-id="a4beb-132">A text range whose starting endpoint and ending endpoint are at the same location is called a *degenerate* (or empty) text range.</span></span> <span data-ttu-id="a4beb-133">退化文字範圍用來標示控制項文字內的特定位置，例如文字插入點的位置。</span><span class="sxs-lookup"><span data-stu-id="a4beb-133">A degenerate text range is used to mark a specific location within the text of a control, such as the location of the text insertion point.</span></span>

## <a name="acquiring-text-range-objects"></a><span data-ttu-id="a4beb-134">取得文字範圍物件</span><span class="sxs-lookup"><span data-stu-id="a4beb-134">Acquiring Text Range Objects</span></span>

<span data-ttu-id="a4beb-135">用戶端應用程式會使用 [**IUIAutomationTextPattern**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationtextpattern) 介面的屬性和方法，取得文字範圍物件。</span><span class="sxs-lookup"><span data-stu-id="a4beb-135">Client applications acquire text range objects by using the properties and methods of the [**IUIAutomationTextPattern**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationtextpattern) interface.</span></span> <span data-ttu-id="a4beb-136">[**IUIAutomationTextRangePattern：:D ocumentrange**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextpattern-get_documentrange)屬性會抓取表示以文字為基礎之控制項之整個文字內容的文字範圍，而其他方法則會取得代表部分內容的文字範圍，例如選取的文字、可見的文字，或內嵌在文字中的物件。</span><span class="sxs-lookup"><span data-stu-id="a4beb-136">The [**IUIAutomationTextRangePattern::DocumentRange**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextpattern-get_documentrange) property retrieves a text range that represents the entire textual content of a text-based control, while other methods acquire text ranges that represent some portion of the content, such as the selected text, the visible text, or an object embedded in the text.</span></span>

<span data-ttu-id="a4beb-137">[**IUIAutomationTextRangePattern：： GetVisibleRanges**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextpattern-getvisibleranges)和 [**GetSelection**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextpattern-getselection)方法可以取出文字範圍物件的陣列。</span><span class="sxs-lookup"><span data-stu-id="a4beb-137">The [**IUIAutomationTextRangePattern::GetVisibleRanges**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextpattern-getvisibleranges) and [**GetSelection**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextpattern-getselection) methods can retrieve arrays of text range objects.</span></span> <span data-ttu-id="a4beb-138">如果控制項以重迭的視窗或其他物件部分遮蔽， **GetVisibleRanges** 會傳回陣列，其中包含每個部分可見文字行的文字範圍物件。</span><span class="sxs-lookup"><span data-stu-id="a4beb-138">If a control is partially obscured by an overlapping window or other object, **GetVisibleRanges** returns an array containing a text range object for each partially visible line of text.</span></span> <span data-ttu-id="a4beb-139">同樣地，如果以文字為基礎的控制項支援選取多個不連續的文字範圍， **GetSelection** 會傳回陣列，其中包含每個所選範圍的文字範圍物件。</span><span class="sxs-lookup"><span data-stu-id="a4beb-139">Similarly, if a text-based control supports the selection of multiple, disjoint spans of text, **GetSelection** returns an array that contains a text range object for each selected span.</span></span>

<span data-ttu-id="a4beb-140">[**IUIAutomationTextRangePattern：： RangeFromChild**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextpattern-rangefromchild)方法可讓用戶端應用程式取出內嵌于文字內容中之物件的文字範圍。</span><span class="sxs-lookup"><span data-stu-id="a4beb-140">The [**IUIAutomationTextRangePattern::RangeFromChild**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextpattern-rangefromchild) method enables a client application to retrieve a text range that encloses an object that is embedded in the textual content.</span></span> <span data-ttu-id="a4beb-141">用戶端會指定内嵌物件的 [**IUIAutomationElement**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationelement) 介面指標（例如影像、資料表或超連結），而且方法會傳回包含物件的文字範圍。</span><span class="sxs-lookup"><span data-stu-id="a4beb-141">The client specifies the [**IUIAutomationElement**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationelement) interface pointer of an embedded object, such as an image, a table, or a hyperlink, and the method returns a text range that encloses the object.</span></span> <span data-ttu-id="a4beb-142">但是，如果内嵌物件沒有相關聯的文字，則方法會傳回一個退化文字範圍。</span><span class="sxs-lookup"><span data-stu-id="a4beb-142">However, if the embedded object has no text associated with it, the method returns a degenerate text range.</span></span>

<span data-ttu-id="a4beb-143">用戶端應用程式可以使用 [**IUIAutomationTextRangePattern：： RangeFromPoint**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextprovider-rangefrompoint) 方法，以取得最接近指定螢幕座標的可見文字或内嵌物件的文字範圍。</span><span class="sxs-lookup"><span data-stu-id="a4beb-143">A client application can use the [**IUIAutomationTextRangePattern::RangeFromPoint**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextprovider-rangefrompoint) method to retrieve a text range for the visible text or embedded object that is nearest to the specified screen coordinates.</span></span>

## <a name="selecting-text-in-a-text-range"></a><span data-ttu-id="a4beb-144">選取文字範圍中的文字</span><span class="sxs-lookup"><span data-stu-id="a4beb-144">Selecting Text in a Text Range</span></span>

<span data-ttu-id="a4beb-145">[**IUIAutomationTextRange**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationtextrange)介面包含一些方法，可讓用戶端應用程式控制以文字為基礎之控制項中的文字選取範圍。</span><span class="sxs-lookup"><span data-stu-id="a4beb-145">The [**IUIAutomationTextRange**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationtextrange) interface includes a number of methods that enable a client application to control the selection of text in a text-based control.</span></span>

<span data-ttu-id="a4beb-146">用戶端應用程式可以使用 [**IUIAutomationTextRange：： select**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-select) 方法來選取對應至文字範圍的文字，以及從文字控制項移除先前的選取專案（如果有的話）。</span><span class="sxs-lookup"><span data-stu-id="a4beb-146">Client applications can use the [**IUIAutomationTextRange::Select**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-select) method to select the text that corresponds to a text range, and to remove the previous selection, if any, from the text control.</span></span> <span data-ttu-id="a4beb-147">使用退化文字範圍呼叫 **Select** ，會將插入點移至文字範圍的位置，而不會選取任何文字。</span><span class="sxs-lookup"><span data-stu-id="a4beb-147">Calling **Select** with a degenerate text range moves the insertion point to the location of the text range without selecting any text.</span></span>

<span data-ttu-id="a4beb-148">如果控制項支援選取多個不連續的文字範圍，用戶端可以使用 [**IUIAutomationTextRange：： AddToSelection**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-addtoselection) 和 [**RemoveFromSelection**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-removefromselection) 方法，將文字範圍加入至所選文字範圍的集合，並將其從集合中移除。</span><span class="sxs-lookup"><span data-stu-id="a4beb-148">If a control supports the selection of multiple, disjoint spans of text, a client can use the [**IUIAutomationTextRange::AddToSelection**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-addtoselection) and [**RemoveFromSelection**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-removefromselection) methods to add text ranges to, and remove them from, the collection of selected text ranges.</span></span> <span data-ttu-id="a4beb-149">如果控制項一次只支援一個選取的文字範圍，但是選取作業會導致選取多個不連續的文字範圍，則方法會傳回 **電子 \_ INVALIDOPERATION** 錯誤，或擴充或截斷目前的選取範圍。</span><span class="sxs-lookup"><span data-stu-id="a4beb-149">If the control supports only one selected text range at a time, but the selection operation would result in the selection of multiple disjoint text ranges, the method returns either an **E\_INVALIDOPERATION** error, or extends or truncates the current selection.</span></span> <span data-ttu-id="a4beb-150">用戶端應用程式可以檢查 [**IUIAutomationTextPattern：： SupportedTextSelection**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextpattern-get_supportedtextselection) 屬性，以探索控制項是否支援選取單一或多個文字範圍，或完全無。</span><span class="sxs-lookup"><span data-stu-id="a4beb-150">A client application can discover whether a control supports the selection of single or multiple spans of text, or none at all, by checking the [**IUIAutomationTextPattern::SupportedTextSelection**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextpattern-get_supportedtextselection) property.</span></span>

<span data-ttu-id="a4beb-151">如果以文字為基礎的控制項支援文字插入，則在控制項中的退化文字範圍上呼叫 [**IUIAutomationTextRange：： AddToSelection**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-addtoselection) 或 [**RemoveFromSelection**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-removefromselection) 會移動插入點，但不會選取任何文字。</span><span class="sxs-lookup"><span data-stu-id="a4beb-151">If a text-based control supports text insertions, calling [**IUIAutomationTextRange::AddToSelection**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-addtoselection) or [**RemoveFromSelection**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-removefromselection) on a degenerate text range in the control moves the insertion point but does not select any text.</span></span>

## <a name="retrieving-text-from-a-text-range"></a><span data-ttu-id="a4beb-152">從文字範圍中取出文字</span><span class="sxs-lookup"><span data-stu-id="a4beb-152">Retrieving Text from a Text Range</span></span>

<span data-ttu-id="a4beb-153">用戶端應用程式可以使用 [**IUIAutomationTextRange：： GetText**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-gettext) 方法來取出文字範圍的純文字。</span><span class="sxs-lookup"><span data-stu-id="a4beb-153">Client applications can use the [**IUIAutomationTextRange::GetText**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-gettext) method to retrieve the plain text of a text range.</span></span> <span data-ttu-id="a4beb-154">純文字包含在來源文字中找到的所有控制字元，例如，換行字元和 Unicode 從左至右的標記 (LRM) 。</span><span class="sxs-lookup"><span data-stu-id="a4beb-154">The plain text includes all control characters found in the source text, such as carriage returns and the Unicode left-to-right mark (LRM).</span></span> <span data-ttu-id="a4beb-155">純文字不包含任何可能存在於來源文字中的標記標記，例如 HTML。</span><span class="sxs-lookup"><span data-stu-id="a4beb-155">The plain text does not include any markup tags such as HTML that may be present in the source text.</span></span> <span data-ttu-id="a4beb-156">此外，來源文字中的任何轉義碼都會轉換成純文字對應專案。</span><span class="sxs-lookup"><span data-stu-id="a4beb-156">Also, any escape codes in the source text are converted to the plain text equivalents.</span></span> <span data-ttu-id="a4beb-157">例如，" &nbsp; " 會轉換成簡單的空白字元。</span><span class="sxs-lookup"><span data-stu-id="a4beb-157">For example, "&nbsp;" is converted to a simple space character.</span></span>

<span data-ttu-id="a4beb-158">如果內嵌的物件跨越某個範圍的文字，則純文字會包含物件的內部文字，但不會包含 (内嵌物件之 [名稱] 屬性) 的替代文字。</span><span class="sxs-lookup"><span data-stu-id="a4beb-158">If an embedded object spans a range of text, the plain text includes the inner text of the object, but not the alternative text (the name property of the embedded object).</span></span> <span data-ttu-id="a4beb-159">如需詳細資訊，請參閱 [消費者介面自動化如何公開内嵌物件](uiauto-textpattern-and-embedded-objects-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="a4beb-159">For more information, see [How UI Automation Exposes Embedded Objects](uiauto-textpattern-and-embedded-objects-overview.md).</span></span>

<span data-ttu-id="a4beb-160">[**IUIAutomationTextRange：： FindText**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-findtext)方法會搜尋特定字串的文字範圍，如果找到的話，則會傳回包含字串的新文字範圍。</span><span class="sxs-lookup"><span data-stu-id="a4beb-160">The [**IUIAutomationTextRange::FindText**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-findtext) method searches a text range for a particular string and, if it is found, returns a new text range that encompasses the string.</span></span>

## <a name="retrieving-text-attributes-from-a-text-range"></a><span data-ttu-id="a4beb-161">從文字範圍中取出文字屬性</span><span class="sxs-lookup"><span data-stu-id="a4beb-161">Retrieving Text Attributes from a Text Range</span></span>

<span data-ttu-id="a4beb-162">Text 屬性會決定文字型控制項中文字的格式化樣式，並包含前景色彩、專案符號樣式、字型大小等專案。</span><span class="sxs-lookup"><span data-stu-id="a4beb-162">Text attributes determine the formatting style of the text in a text-based control, and include such things as foreground color, bullet style, font size, and so on.</span></span> <span data-ttu-id="a4beb-163">消費者介面自動化支援一些 text 屬性，並為每個支援的屬性定義識別碼。</span><span class="sxs-lookup"><span data-stu-id="a4beb-163">UI Automation supports a number of text attributes, and defines an identifier for each supported attribute.</span></span> <span data-ttu-id="a4beb-164">用戶端應用程式可以在 [**IUIAutomationTextRange：： GetAttributeValue**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-getattributevalue) 方法的呼叫中指定屬性識別碼，以及接收屬性值的 [**變異**](/windows/win32/api/oaidl/ns-oaidl-variant) 結構指標，藉以查詢特定文字屬性值的文字範圍。</span><span class="sxs-lookup"><span data-stu-id="a4beb-164">A client application can query a text range for the value of a particular text attribute by specifying an attribute identifier in a call to the [**IUIAutomationTextRange::GetAttributeValue**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-getattributevalue) method, along with a pointer to a [**VARIANT**](/windows/win32/api/oaidl/ns-oaidl-variant) structure that receives the attribute value.</span></span> <span data-ttu-id="a4beb-165">如需消費者介面自動化支援的每個 text 屬性的詳細資訊，請參閱 [文字屬性識別碼](uiauto-textattribute-ids.md)。</span><span class="sxs-lookup"><span data-stu-id="a4beb-165">For detailed information about each text attribute that UI Automation supports, see [Text Attribute Identifiers](uiauto-textattribute-ids.md).</span></span>

<span data-ttu-id="a4beb-166">[**GetAttributeValue**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-getattributevalue)抓取的值代表整個文字範圍內的屬性值。</span><span class="sxs-lookup"><span data-stu-id="a4beb-166">The value retrieved by [**GetAttributeValue**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-getattributevalue) represents the value of the attribute across the entire text range.</span></span> <span data-ttu-id="a4beb-167">如果範圍內的所有文字都共用指定之屬性的相同值，則 **GetAttributeValue** 會傳回該值。</span><span class="sxs-lookup"><span data-stu-id="a4beb-167">If all text in the range shares the same value for the specified attribute, that value is returned by **GetAttributeValue**.</span></span> <span data-ttu-id="a4beb-168">但是，如果屬性值在整個文字範圍中不同， **GetAttributeValue** 會將 [**IUnknown**](/windows/desktop/api/unknwn/nn-unknwn-iunknown) 指標傳回給名為 **ReservedMixedAttribute** 物件的靜態權杖物件。</span><span class="sxs-lookup"><span data-stu-id="a4beb-168">However, if the value of the attribute varies across the text range, **GetAttributeValue** returns an [**IUnknown**](/windows/desktop/api/unknwn/nn-unknwn-iunknown) pointer to a static token object called the **ReservedMixedAttribute** object.</span></span> <span data-ttu-id="a4beb-169">若要探索屬性值是否會在文字範圍內改變，用戶端應用程式應將 **GetAttributeValue** 的結果與從 [**IUIAutomation：： ReservedMixedAttributeValue**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-get_reservedmixedattributevalue)屬性抓取的 **ReservedMixedAttribute** 物件進行比較。</span><span class="sxs-lookup"><span data-stu-id="a4beb-169">To discover whether the value of an attribute varies across a text range, a client application should compare the results of **GetAttributeValue** with the **ReservedMixedAttribute** object retrieved from the [**IUIAutomation::ReservedMixedAttributeValue**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-get_reservedmixedattributevalue) property.</span></span>

<span data-ttu-id="a4beb-170">不需要以文字為基礎的控制項，就能支援所有消費者介面自動化的 text 屬性。</span><span class="sxs-lookup"><span data-stu-id="a4beb-170">A text-based control is not required to support all UI Automation text attributes.</span></span> <span data-ttu-id="a4beb-171">如果用戶端呼叫 [**IUIAutomationTextRange：： GetAttributeValue**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-getattributevalue) 方法，並傳遞不支援屬性的識別碼，則方法會將 [**IUnknown**](/windows/desktop/api/unknwn/nn-unknwn-iunknown) 指標傳回給稱為 **ReservedNotSupported** 物件的靜態權杖物件。</span><span class="sxs-lookup"><span data-stu-id="a4beb-171">If a client calls the [**IUIAutomationTextRange::GetAttributeValue**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-getattributevalue) method and passes the identifier of an unsupported attribute, the method returns an [**IUnknown**](/windows/desktop/api/unknwn/nn-unknwn-iunknown) pointer to a static token object called the **ReservedNotSupported** object.</span></span> <span data-ttu-id="a4beb-172">若要探索是否支援特定屬性，用戶端應用程式應將 **GetAttributeValue** 的結果與從 [**IUIAutomation：： ReservedNotSupportedValue**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-get_reservednotsupportedvalue)屬性抓取的 **ReservedNotSupported** 物件進行比較。</span><span class="sxs-lookup"><span data-stu-id="a4beb-172">To discover whether a particular attribute is supported, a client application should compare the results of **GetAttributeValue** with the **ReservedNotSupported** object retrieved from the [**IUIAutomation::ReservedNotSupportedValue**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-get_reservednotsupportedvalue) property.</span></span>

<span data-ttu-id="a4beb-173">用戶端應用程式可以使用 [**IUIAutomationTextRange：： FindAttribute**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-findattribute) 方法，在文字範圍中搜尋具有特定文字屬性的文字。</span><span class="sxs-lookup"><span data-stu-id="a4beb-173">Client applications can use the [**IUIAutomationTextRange::FindAttribute**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-findattribute) method to search a text range for text that has a particular text attribute.</span></span> <span data-ttu-id="a4beb-174">如果找到，則方法會傳回包含相符文字的新文字範圍。</span><span class="sxs-lookup"><span data-stu-id="a4beb-174">If found, the method returns a new text range that encompasses the matching text.</span></span> <span data-ttu-id="a4beb-175">請注意，即使沒有顯示文字， **FindAttribute** 也會傳回相符文字的文字範圍。</span><span class="sxs-lookup"><span data-stu-id="a4beb-175">Note that **FindAttribute** returns a text range for matching text even if the text is not visible.</span></span>

## <a name="retrieving-embedded-objects-from-a-text-range"></a><span data-ttu-id="a4beb-176">從文字範圍中取出内嵌物件</span><span class="sxs-lookup"><span data-stu-id="a4beb-176">Retrieving Embedded Objects from a Text Range</span></span>

<span data-ttu-id="a4beb-177">文字範圍可以包含内嵌物件，例如資料表、影像、超連結等等。</span><span class="sxs-lookup"><span data-stu-id="a4beb-177">A text range can include embedded objects such as tables, images, hyperlinks, and so on.</span></span> <span data-ttu-id="a4beb-178">用戶端應用程式可以藉由呼叫 [**IUIAutomationTextRange：： GetChildren**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-getchildren) 方法，來取得範圍中所有内嵌物件的集合。</span><span class="sxs-lookup"><span data-stu-id="a4beb-178">A client application can retrieve a collection of all embedded objects in a range by calling the [**IUIAutomationTextRange::GetChildren**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-getchildren) method.</span></span> <span data-ttu-id="a4beb-179">與範圍重迭但未完全括住的内嵌物件也會包含在集合中。</span><span class="sxs-lookup"><span data-stu-id="a4beb-179">Embedded objects that overlap with the range but are not entirely enclosed by it are also included in the collection.</span></span> <span data-ttu-id="a4beb-180">如果範圍未包含任何内嵌物件， **GetChildren** 會抓取空集合。</span><span class="sxs-lookup"><span data-stu-id="a4beb-180">If the range contains no embedded objects, **GetChildren** retrieves an empty collection.</span></span>

<span data-ttu-id="a4beb-181">雖然它相依于以文字為基礎之控制項的提供者，但 [**GetChildren**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-getchildren) 方法通常不會傳回任何內嵌元素的子系。</span><span class="sxs-lookup"><span data-stu-id="a4beb-181">Although it depends on the provider of the text-based control, the [**GetChildren**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-getchildren) method typically does not return any children of the embedded elements.</span></span> <span data-ttu-id="a4beb-182">例如，如果文字範圍包含的資料表具有多個子儲存格，則 **GetChildren** 方法通常只會傳回 table 元素而非資料格元素。</span><span class="sxs-lookup"><span data-stu-id="a4beb-182">For example, if a text range contains a table that has a number of child cells, the **GetChildren** method typically returns just the table element and not the cell elements.</span></span>

<span data-ttu-id="a4beb-183">基於效能或架構原因， [**GetChildren**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-getchildren) 可能無法針對文字範圍中的所有内嵌物件取得 [**IUIAutomationElement**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationelement) 物件。</span><span class="sxs-lookup"><span data-stu-id="a4beb-183">For performance or architectural reasons, [**GetChildren**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-getchildren) may not be able to retrieve [**IUIAutomationElement**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationelement) objects for all embedded objects in a text range.</span></span> <span data-ttu-id="a4beb-184">相反地，提供者可能會傳回包含虛擬化專案的集合。</span><span class="sxs-lookup"><span data-stu-id="a4beb-184">Instead, the provider might return a collection that includes virtualized items.</span></span> <span data-ttu-id="a4beb-185">如需詳細資訊，請參閱 [使用虛擬化專案](uiauto-workingwithvirtualizeditems.md)。</span><span class="sxs-lookup"><span data-stu-id="a4beb-185">For more information, see [Working with Virtualized Items](uiauto-workingwithvirtualizeditems.md).</span></span>

## <a name="manipulating-a-text-range"></a><span data-ttu-id="a4beb-186">操作文字範圍</span><span class="sxs-lookup"><span data-stu-id="a4beb-186">Manipulating a Text Range</span></span>

<span data-ttu-id="a4beb-187">[**IUIAutomationTextRange**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationtextrange)介面提供數種方法，可在以文字為基礎的控制項中操作和導覽文字範圍。</span><span class="sxs-lookup"><span data-stu-id="a4beb-187">The [**IUIAutomationTextRange**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationtextrange) interface provides several methods for manipulating and navigating text ranges in a text-based control.</span></span> <span data-ttu-id="a4beb-188">[**IUIAutomationTextRange：： Move**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-move)、 [**MoveEndpointByUnit**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-moveendpointbyunit)和 [**ExpandToEnclosingUnit**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-expandtoenclosingunit)方法會依據指定的文字單位（例如字元、字、段落等等）移動文字範圍或其中一個端點。</span><span class="sxs-lookup"><span data-stu-id="a4beb-188">The [**IUIAutomationTextRange::Move**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-move), [**MoveEndpointByUnit**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-moveendpointbyunit), and [**ExpandToEnclosingUnit**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-expandtoenclosingunit) methods move a text range or one of its endpoints by the specified text unit, such as character, word, paragraph, and so on.</span></span> <span data-ttu-id="a4beb-189">如需詳細資訊，請參閱 [消費者介面自動化文字單位](/windows/desktop/WinAuto/uiauto-uiautomationtextunits)。</span><span class="sxs-lookup"><span data-stu-id="a4beb-189">For more information, see [UI Automation Text Units](/windows/desktop/WinAuto/uiauto-uiautomationtextunits).</span></span>

<span data-ttu-id="a4beb-190">雖然 [**ExpandToEnclosingUnit**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-expandtoenclosingunit) 方法的名稱不一定要展開文字範圍。</span><span class="sxs-lookup"><span data-stu-id="a4beb-190">Despite its name, the [**ExpandToEnclosingUnit**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-expandtoenclosingunit) method does not necessarily expand a text range.</span></span> <span data-ttu-id="a4beb-191">相反地，它會藉由移動端點來「正規化」文字範圍，讓範圍完全包含指定的文字單位。</span><span class="sxs-lookup"><span data-stu-id="a4beb-191">Instead, it "normalizes" a text range by moving the endpoints so that the range encompasses the specified text unit exactly.</span></span> <span data-ttu-id="a4beb-192">如果範圍小於指定的單位，則範圍會展開，如果超過指定的單位，則會縮短。</span><span class="sxs-lookup"><span data-stu-id="a4beb-192">The range is expanded if it is smaller than the specified unit, or shortened if it is longer than the specified unit.</span></span> <span data-ttu-id="a4beb-193">下圖顯示 **ExpandToEnclosingUnit** 如何藉由移動範圍的端點，將文字範圍標準化。</span><span class="sxs-lookup"><span data-stu-id="a4beb-193">The following diagram shows how **ExpandToEnclosingUnit** normalizes a text range by moving the endpoints of the range.</span></span>

![顯示呼叫 expandtoenclosingunit 前後端點位置的圖表](images/expandtoenclosingunit.jpg)

<span data-ttu-id="a4beb-195">如果文字範圍是從文字單位的開頭開始，而且在下一個文字單位界限的開頭或之前結束，則結束端點會移至下一個文字單位界限 (請參閱上圖中的1和 2) 。</span><span class="sxs-lookup"><span data-stu-id="a4beb-195">If the text range starts at the beginning of a text unit and ends at the beginning of, or before, the next text unit boundary, the ending endpoint is moved to the next text unit boundary (see 1 and 2 in the previous illustration).</span></span>

<span data-ttu-id="a4beb-196">如果文字範圍是從文字單位的開頭開始，並在下一個單位界限結束或之後結束，則結束端點會維持或移至下一個單元界限之後的起點 (請參閱上圖中的3和 4) 。</span><span class="sxs-lookup"><span data-stu-id="a4beb-196">If the text range starts at the beginning of a text unit and ends at, or after, the next unit boundary, the ending endpoint stays or is moved backward to the next unit boundary after the starting endpoint (see 3 and 4 in the previous illustration).</span></span> <span data-ttu-id="a4beb-197">如果開始與結束端點之間有多個文字單位界限，結束端點就會向後移至起始端點之後的下一個單位界限，而產生長度為一個文字單位的文字範圍。</span><span class="sxs-lookup"><span data-stu-id="a4beb-197">If there is more than one text unit boundary between the starting and ending endpoints, the ending endpoint is moved backward to the next unit boundary after the starting endpoint, resulting in a text range that is one text unit in length.</span></span>

<span data-ttu-id="a4beb-198">如果文字範圍是從文字單位的中間開始，則起始端點會往回移至文字單元的開頭，而結束端點則會視需要向後移或往後移動至起始端點之後的下一個單位界限 (在上圖中看到5到8的) 。</span><span class="sxs-lookup"><span data-stu-id="a4beb-198">If the text range starts in the middle of a text unit, the starting endpoint is moved backward to the beginning of the text unit, and the ending endpoint is moved forward or backward, as necessary, to the next unit boundary after the starting endpoint (see 5 through 8 in the previous illustration).</span></span>

<span data-ttu-id="a4beb-199">呼叫 [**IUIAutomationTextRange：： Move**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-move) 方法時，提供者會根據指定的文字單位來將文字範圍標準化。</span><span class="sxs-lookup"><span data-stu-id="a4beb-199">When the [**IUIAutomationTextRange::Move**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-move) method is called, the provider normalizes the text range by the specified text unit.</span></span> <span data-ttu-id="a4beb-200">然後，提供者會將範圍向後或向前移動指定的文字單位數目。</span><span class="sxs-lookup"><span data-stu-id="a4beb-200">Then, the provider moves the range backward or forward by the specified number of text units.</span></span> <span data-ttu-id="a4beb-201">移動範圍時，提供者會忽略文字中任何内嵌物件的界限。</span><span class="sxs-lookup"><span data-stu-id="a4beb-201">When moving the range, the provider ignores the boundaries of any embedded objects in the text.</span></span> <span data-ttu-id="a4beb-202"> (不過，單位界限本身可能會受到内嵌物件) 的影響。</span><span class="sxs-lookup"><span data-stu-id="a4beb-202">(However, the unit boundary itself may be affected by the existence of an embedded object).</span></span> <span data-ttu-id="a4beb-203">下圖將示範 **Move** 方法如何在内嵌物件和文字單位界限之間移動文字範圍（單位為單位）。</span><span class="sxs-lookup"><span data-stu-id="a4beb-203">The following diagram demonstrates how the **Move** method moves a text range, unit by unit, across embedded objects and text unit boundaries.</span></span>

![顯示移動方法如何跨物件和文字單位界限移動端點範圍的圖表](images/move.jpg)

<span data-ttu-id="a4beb-205">[**IUIAutomationTextRange：： MoveEndpointByUnit**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-moveendpointbyunit)方法會依指定的文字單位，向前或向後移動其中一個端點。</span><span class="sxs-lookup"><span data-stu-id="a4beb-205">The [**IUIAutomationTextRange::MoveEndpointByUnit**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-moveendpointbyunit) method moves one of the endpoints forward or backward by specified text unit.</span></span> <span data-ttu-id="a4beb-206">下圖顯示端點如何向前移動。</span><span class="sxs-lookup"><span data-stu-id="a4beb-206">The following illustration shows how an endpoint moves forward.</span></span>

![顯示 moveendpointbyunit 如何移動範圍端點的圖表](images/moveendpointbyunit.gif)

<span data-ttu-id="a4beb-208">[**IUIAutomationTextRange：： MoveEndpointByRange**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-moveendpointbyrange)方法可讓用戶端應用程式將文字範圍的一個端點設定為與第二個文字範圍之指定端點相同的位置。</span><span class="sxs-lookup"><span data-stu-id="a4beb-208">The [**IUIAutomationTextRange::MoveEndpointByRange**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-moveendpointbyrange) method enables a client application to set one endpoint of a text range to same location as the specified endpoint of a second text range.</span></span>

## <a name="scrolling-a-text-range-into-view"></a><span data-ttu-id="a4beb-209">將文字範圍滾動至視野</span><span class="sxs-lookup"><span data-stu-id="a4beb-209">Scrolling a Text Range into View</span></span>

<span data-ttu-id="a4beb-210">[**IUIAutomationTextRange：： ScrollIntoView**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-scrollintoview)方法會滾動文字範圍，讓文字可以顯示在以文字為基礎之控制項的視口中。</span><span class="sxs-lookup"><span data-stu-id="a4beb-210">The [**IUIAutomationTextRange::ScrollIntoView**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-scrollintoview) method scrolls a text range so that the text is visible in the viewport of the text-based control.</span></span> <span data-ttu-id="a4beb-211">當呼叫 **ScrollIntoView** 時，用戶端可以指定文字是否應該與區首或底部對齊。</span><span class="sxs-lookup"><span data-stu-id="a4beb-211">When calling **ScrollIntoView**, a client can specify whether the text should be aligned with the top or bottom of the viewport.</span></span>

## <a name="retrieving-the-enclosing-element-of-a-text-range"></a><span data-ttu-id="a4beb-212">取出文字範圍的封閉元素</span><span class="sxs-lookup"><span data-stu-id="a4beb-212">Retrieving the Enclosing Element of a Text Range</span></span>

<span data-ttu-id="a4beb-213">用戶端應用程式可以使用 [**IUIAutomationTextRange：： GetEnclosingElement**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-getenclosingelement) 方法，來抓取括住文字範圍之最內層元素的 [**IUIAutomation**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomation) 介面指標。</span><span class="sxs-lookup"><span data-stu-id="a4beb-213">A client application can use the [**IUIAutomationTextRange::GetEnclosingElement**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-getenclosingelement) method to retrieve the [**IUIAutomation**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomation) interface pointer of the innermost element that encloses a text range.</span></span> <span data-ttu-id="a4beb-214">封閉元素通常是提供文字範圍的文字提供者。</span><span class="sxs-lookup"><span data-stu-id="a4beb-214">The enclosing element is typically the text provider that supplies the text range.</span></span> <span data-ttu-id="a4beb-215">但是，如果文字提供者支援子項目（例如資料表或超連結），封入專案可以是文字提供者的子系。</span><span class="sxs-lookup"><span data-stu-id="a4beb-215">However, if the text provider supports child elements such as tables or hyperlinks, the enclosing element could be a descendant of the text provider.</span></span>

## <a name="comparing-and-cloning-text-ranges"></a><span data-ttu-id="a4beb-216">比較和複製文字範圍</span><span class="sxs-lookup"><span data-stu-id="a4beb-216">Comparing and Cloning Text Ranges</span></span>

<span data-ttu-id="a4beb-217">[**IUIAutomationTextRange**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationtextrange)介面包含兩種比較文字範圍的方法。</span><span class="sxs-lookup"><span data-stu-id="a4beb-217">The [**IUIAutomationTextRange**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationtextrange) interface includes two methods for comparing text ranges.</span></span> <span data-ttu-id="a4beb-218">[**IUIAutomationTextRange：： Compare**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-compareendpoints)方法會比較兩個文字範圍的開始與結束端點，如果兩個端點相同，則傳回 **TRUE** 。</span><span class="sxs-lookup"><span data-stu-id="a4beb-218">The [**IUIAutomationTextRange::Compare**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-compareendpoints) method compares the starting and ending endpoints of two text ranges and returns **TRUE** if both endpoints are the same.</span></span> <span data-ttu-id="a4beb-219">**IUIAutomationTextRange：： CompareEndpoints** 方法會比較兩個範圍的開始或結束端點。</span><span class="sxs-lookup"><span data-stu-id="a4beb-219">The **IUIAutomationTextRange::CompareEndpoints** method compares either the start or the ending endpoint of the two ranges.</span></span> <span data-ttu-id="a4beb-220">如果端點相同，則傳回值為零，或是指出兩個端點之相對位置的正值或負數值。</span><span class="sxs-lookup"><span data-stu-id="a4beb-220">The return value is zero if the endpoints are the same, or a positive value or negative value that indicates the relative positions of the two endpoints.</span></span>

<span data-ttu-id="a4beb-221">用戶端應用程式可以使用 [**IUIAutomationTextRange：： Clone**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-clone) 方法來建立完整的文字範圍複本。</span><span class="sxs-lookup"><span data-stu-id="a4beb-221">Client applications can use the [**IUIAutomationTextRange::Clone**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-clone) method to create an exact copy of text range.</span></span> <span data-ttu-id="a4beb-222">新的文字範圍可以與原始文字範圍分開操作。</span><span class="sxs-lookup"><span data-stu-id="a4beb-222">The new text range can be manipulated independently of the original text range.</span></span>

## <a name="retrieving-annotations"></a><span data-ttu-id="a4beb-223">正在抓取注釋</span><span class="sxs-lookup"><span data-stu-id="a4beb-223">Retrieving Annotations</span></span>

<span data-ttu-id="a4beb-224">文字範圍可包含批註（如果以文字為基礎的控制項支援的話）。</span><span class="sxs-lookup"><span data-stu-id="a4beb-224">A text range can include annotations if the text-based control supports them.</span></span> <span data-ttu-id="a4beb-225">有許多不同類型的批註。</span><span class="sxs-lookup"><span data-stu-id="a4beb-225">There are many different kinds of annotations.</span></span> <span data-ttu-id="a4beb-226">Uiautomationclient.dll 標頭檔會定義一組命名的常數值，以識別消費者介面自動化支援的批註類型。</span><span class="sxs-lookup"><span data-stu-id="a4beb-226">The UIAutomationClient.h header file defines a set of named constant values that identify the types of annotations that UI Automation supports.</span></span> <span data-ttu-id="a4beb-227">如需詳細資訊，請參閱 [**批註類型識別碼**](uiauto-annotation-type-identifiers.md)。</span><span class="sxs-lookup"><span data-stu-id="a4beb-227">For more information, see [**Annotation Type Identifiers**](uiauto-annotation-type-identifiers.md).</span></span>

<span data-ttu-id="a4beb-228">某些類型的注釋是以支援 [Annotation](uiauto-implementingannotation.md) 控制項模式 ([**IUIAutomationAnnotationPattern**](/windows/desktop/api/uiautomationclient/nn-uiautomationclient-iuiautomationannotationpattern) 介面) 的 automation 元素表示。</span><span class="sxs-lookup"><span data-stu-id="a4beb-228">Some kinds of annotations are represented by an automation element that supports the [Annotation](uiauto-implementingannotation.md) control pattern ([**IUIAutomationAnnotationPattern**](/windows/desktop/api/uiautomationclient/nn-uiautomationclient-iuiautomationannotationpattern) interface).</span></span> <span data-ttu-id="a4beb-229">其他類型的注釋會透過 [TextRange](uiauto-about-text-and-textrange-patterns.md) 控制項模式公開。</span><span class="sxs-lookup"><span data-stu-id="a4beb-229">Other kinds of annotations are exposed through the [TextRange](uiauto-about-text-and-textrange-patterns.md) control pattern.</span></span> <span data-ttu-id="a4beb-230">例如，提供者可能會藉由讓 [**IUIAutomationTextRange：： GetAttributeValue**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-getattributevalue)方法傳回 [**AnnotationType \_ SpellingError**](uiauto-annotation-type-identifiers.md)的 [**AnnotationTypes**](uiauto-textattribute-ids.md) text 屬性，以及 [**AnnotationObjects**](uiauto-textattribute-ids.md) text 屬性的 null 值，來公開簡單的拼寫錯誤指標。</span><span class="sxs-lookup"><span data-stu-id="a4beb-230">For example, a provider could expose a simple spelling-error indicator by having the [**IUIAutomationTextRange::GetAttributeValue**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-getattributevalue) method return an [**AnnotationTypes**](uiauto-textattribute-ids.md) text attribute of [**AnnotationType\_SpellingError**](uiauto-annotation-type-identifiers.md), and a null value for the [**AnnotationObjects**](uiauto-textattribute-ids.md) text attribute.</span></span>

### <a name="retrieving-annotations-types-from-a-text-range"></a><span data-ttu-id="a4beb-231">從文字範圍中取出批註類型</span><span class="sxs-lookup"><span data-stu-id="a4beb-231">Retrieving Annotations Types from a Text Range</span></span>

<span data-ttu-id="a4beb-232">您可以使用 [**IUIAutomationTextRange：： GetAttributeValue**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-getattributevalue) 方法，來取得文字範圍中出現的批註類型清單。</span><span class="sxs-lookup"><span data-stu-id="a4beb-232">You can retrieve a list of the types of annotations that are present in a text range by using the [**IUIAutomationTextRange::GetAttributeValue**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-getattributevalue) method.</span></span> <span data-ttu-id="a4beb-233">當呼叫方法時，請指定 [**UIA \_ AnnotationTypesAttributeId**](uiauto-textattribute-ids.md) 的文字屬性識別碼和 [**變數**](/windows/win32/api/oaidl/ns-oaidl-variant)型別的指標。</span><span class="sxs-lookup"><span data-stu-id="a4beb-233">When calling the method, specify a text attribute ID of [**UIA\_AnnotationTypesAttributeId**](uiauto-textattribute-ids.md) and a pointer to a parameter of type [**VARIANT**](/windows/win32/api/oaidl/ns-oaidl-variant).</span></span> <span data-ttu-id="a4beb-234">當方法傳回時， **VARIANT** 參數會包含批註類型識別碼的清單，這是文字範圍中每一個批註類型的清單。</span><span class="sxs-lookup"><span data-stu-id="a4beb-234">When the method returns, the **VARIANT** parameter contains a list of annotation type identifiers, one for each type of annotation in the text range.</span></span> <span data-ttu-id="a4beb-235">如需詳細資訊，請參閱 [**批註類型識別碼**](uiauto-annotation-type-identifiers.md)。</span><span class="sxs-lookup"><span data-stu-id="a4beb-235">For more information, see [**Annotation Type Identifiers**](uiauto-annotation-type-identifiers.md).</span></span>

### <a name="retrieving-all-annotations-from-a-text-range"></a><span data-ttu-id="a4beb-236">從文字範圍中取出所有批註</span><span class="sxs-lookup"><span data-stu-id="a4beb-236">Retrieving All Annotations from a Text Range</span></span>

<span data-ttu-id="a4beb-237">若要從文字範圍中取出批註，請呼叫 [**IUIAutomationTextRange：： GetAttributeValue**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-getattributevalue) 方法，並指定 [**UIA \_ ANNOTATIONOBJECTSATTRIBUTEID**](uiauto-textattribute-ids.md) 的文字屬性識別碼和類型 [**VARIANT**](/windows/win32/api/oaidl/ns-oaidl-variant)的參數指標。</span><span class="sxs-lookup"><span data-stu-id="a4beb-237">To retrieve the annotations from a text range, call the [**IUIAutomationTextRange::GetAttributeValue**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-getattributevalue) method, specifying a text attribute ID of [**UIA\_AnnotationObjectsAttributeId**](uiauto-textattribute-ids.md) and a pointer to a parameter of type [**VARIANT**](/windows/win32/api/oaidl/ns-oaidl-variant).</span></span> <span data-ttu-id="a4beb-238">當方法傳回時， **VARIANT** 參數會包含代表 automation 元素陣列的 [**IUIAutomationElementArray**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationelementarray) 介面，文字範圍中的每個批註各一個。</span><span class="sxs-lookup"><span data-stu-id="a4beb-238">When the method returns, the **VARIANT** parameter contains an [**IUIAutomationElementArray**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationelementarray) interface that represents an array of automation elements, one for each annotation in the text range.</span></span> <span data-ttu-id="a4beb-239">[**IUIAutomationElementArray：： Length**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationelementarray-get_length)屬性指出陣列中的元素數目，而 [**IUIAutomationElementArray：： GetElement**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationelementarray-getelement)方法會抓取特定元素的 [**IUIAutomationElement**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationelement)介面。</span><span class="sxs-lookup"><span data-stu-id="a4beb-239">The [**IUIAutomationElementArray::Length**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationelementarray-get_length) property indicates the number of elements in the array, and the [**IUIAutomationElementArray::GetElement**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationelementarray-getelement) method retrieves the [**IUIAutomationElement**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationelement) interface for a particular element.</span></span>

### <a name="retrieving-information-about-a-particular-annotation"></a><span data-ttu-id="a4beb-240">抓取特定注釋的相關資訊</span><span class="sxs-lookup"><span data-stu-id="a4beb-240">Retrieving Information About a Particular Annotation</span></span>

<span data-ttu-id="a4beb-241">若要抓取特定批註的相關資訊，請先依照上一節所述，取得 annotation 元素的 [**IUIAutomationElement**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationelement) 介面。</span><span class="sxs-lookup"><span data-stu-id="a4beb-241">To retrieve information about a particular annotation, first retrieve the [**IUIAutomationElement**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationelement) interface for the annotation element as described in the previous section.</span></span> <span data-ttu-id="a4beb-242">接下來，藉由呼叫 [**IUIAutomationElement：： GetCurrentPatternAs**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationelement-getcurrentpatternas)方法和 [**UIA \_ AnnotationPatternId**](uiauto-controlpattern-ids.md)的控制項模式識別碼、IID IUIAutomationAnnotationPattern 的介面識別碼 [](/windows/desktop/api/uiautomationclient/nn-uiautomationclient-iuiautomationannotationpattern) \_ ，以及接收批註之 **IUIAutomationAnnotation** 指標的變數位址，來取得注釋的 IUIAutomationAnnotationPattern 介面。</span><span class="sxs-lookup"><span data-stu-id="a4beb-242">Next, retrieve the [**IUIAutomationAnnotationPattern**](/windows/desktop/api/uiautomationclient/nn-uiautomationclient-iuiautomationannotationpattern) interface for the annotation by calling the [**IUIAutomationElement::GetCurrentPatternAs**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationelement-getcurrentpatternas) method with a control pattern ID of [**UIA\_AnnotationPatternId**](uiauto-controlpattern-ids.md), an interface identifier of IID\_IUIAutomationAnnotationPattern, and the address of a variable that receives the **IUIAutomationAnnotation** pointer for the annotation.</span></span> <span data-ttu-id="a4beb-243">查詢 **IUIAutomationAnnotation** 介面的屬性，以抓取注釋型別名稱和類型識別碼、注釋作者的名稱、批註的日期和時間，以及要標注之元素的 **IUIAutomationElement** 介面。</span><span class="sxs-lookup"><span data-stu-id="a4beb-243">Query the properties of the **IUIAutomationAnnotation** interface to retrieve the annotation type name and type ID, the name of the annotation author, the date and time of the annotation, and the **IUIAutomationElement** interface for the element that is being annotated.</span></span>

### <a name="retrieving-the-annotation-target-text"></a><span data-ttu-id="a4beb-244">正在抓取注釋目標文字</span><span class="sxs-lookup"><span data-stu-id="a4beb-244">Retrieving the Annotation Target Text</span></span>

<span data-ttu-id="a4beb-245">批註通常會套用至文字範圍中某個文字的子集。</span><span class="sxs-lookup"><span data-stu-id="a4beb-245">Typically, an annotation applies to some subset of the text in a text range.</span></span> <span data-ttu-id="a4beb-246">在您取得批註的 [**IUIAutomationElement**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationelement) 介面之後，您可以將介面傳遞至 [**IUIAutomationTextRange2：： RangeFromAnnotation**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextprovider2-rangefromannotation) 方法，以抓取包含批註目標文字的文字範圍。</span><span class="sxs-lookup"><span data-stu-id="a4beb-246">After you retrieve the [**IUIAutomationElement**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationelement) interface for an annotation, you can pass the interface to the [**IUIAutomationTextRange2::RangeFromAnnotation**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextprovider2-rangefromannotation) method to retrieve a text range that contains the text that is the target of the annotation.</span></span>

## <a name="retrieving-visual-styles"></a><span data-ttu-id="a4beb-247">正在抓取視覺化樣式</span><span class="sxs-lookup"><span data-stu-id="a4beb-247">Retrieving Visual Styles</span></span>

<span data-ttu-id="a4beb-248">提供者會實 [樣式](/windows/desktop/WinAuto/uiauto-implementingstyles) 控制項模式來描述具有特定樣式、填滿色彩、填滿模式或圖形的 UI 元素。</span><span class="sxs-lookup"><span data-stu-id="a4beb-248">A provider implements the [Styles](/windows/desktop/WinAuto/uiauto-implementingstyles) control pattern to describe a UI element that has a specific style, fill color, fill pattern, or shape.</span></span> <span data-ttu-id="a4beb-249">這在描述檔中的專案時特別有用，因為這類樣式經常會有這類樣式。</span><span class="sxs-lookup"><span data-stu-id="a4beb-249">This is especially useful when describing elements in a document, which frequently have such styles.</span></span> <span data-ttu-id="a4beb-250">像這樣的樣式通常會攜帶適用于殘障客戶的資訊;例如，樣式可以將特定字串描述為檔的標題，或是將特定流程圖物件描述為鑽石或圓形。</span><span class="sxs-lookup"><span data-stu-id="a4beb-250">Styles like this often carry information that is useful for customers with disabilities; for example, styles can describe a certain string as the title of a document, or a certain flowchart object as a diamond or a circle.</span></span>

<span data-ttu-id="a4beb-251">您可以使用 [**IUIAutomationTextRange：： GetAttributeValue**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-getattributevalue) 方法來抓取文字範圍中所使用之視覺化樣式的名稱和識別碼。</span><span class="sxs-lookup"><span data-stu-id="a4beb-251">You can use the [**IUIAutomationTextRange::GetAttributeValue**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-getattributevalue) method to retrieve the names and identifiers of the visual styles that are used in a text range.</span></span> <span data-ttu-id="a4beb-252">您可以使用 [**UIA \_ StyleNameAttributeId**](uiauto-textattribute-ids.md) text 屬性來取得樣式名稱，並使用 [**UIA \_ StyleIdAttributeId**](uiauto-textattribute-ids.md) 來取得樣式識別碼。</span><span class="sxs-lookup"><span data-stu-id="a4beb-252">Use the [**UIA\_StyleNameAttributeId**](uiauto-textattribute-ids.md) text attribute to retrieve the style names, and [**UIA\_StyleIdAttributeId**](uiauto-textattribute-ids.md) to retrieve the style identifiers.</span></span>

<span data-ttu-id="a4beb-253">支援視覺效果樣式的文字型控制項可以執行 [樣式](/windows/desktop/WinAuto/uiauto-implementingstyles) 控制項模式，讓用戶端存取控制項所使用之視覺化樣式的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="a4beb-253">A text-based control that supports visual styles can implement the [Styles](/windows/desktop/WinAuto/uiauto-implementingstyles) control pattern to enable clients to access information about a visual style used by the control.</span></span> <span data-ttu-id="a4beb-254">用戶端會透過 [**IUIAutomationStylesPattern**](/windows/desktop/api/uiautomationclient/nn-uiautomationclient-iuiautomationstylespattern) 介面存取樣式控制項模式。</span><span class="sxs-lookup"><span data-stu-id="a4beb-254">Clients access the Styles control pattern through the [**IUIAutomationStylesPattern**](/windows/desktop/api/uiautomationclient/nn-uiautomationclient-iuiautomationstylespattern) interface.</span></span> <span data-ttu-id="a4beb-255">您可以藉由呼叫 [**IUIAutomationElement：： GetCurrentPattern**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationelement-getcurrentpattern) 或 [**GetCurrentPatternAs**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationelement-getcurrentpatternas) 方法來取得這個介面，並指定 [**UIA \_ StylesPatternId**](uiauto-controlpattern-ids.md) 做為控制項模式識別碼。</span><span class="sxs-lookup"><span data-stu-id="a4beb-255">You can retrieve this interface by calling the [**IUIAutomationElement::GetCurrentPattern**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationelement-getcurrentpattern) or [**GetCurrentPatternAs**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationelement-getcurrentpatternas) method, specifying [**UIA\_StylesPatternId**](uiauto-controlpattern-ids.md) as the control pattern identifier.</span></span>

<span data-ttu-id="a4beb-256">[**IUIAutomationStylesPattern**](/windows/desktop/api/uiautomationclient/nn-uiautomationclient-iuiautomationstylespattern)介面包含屬性和方法，可提供視覺化樣式的下列資訊：</span><span class="sxs-lookup"><span data-stu-id="a4beb-256">The [**IUIAutomationStylesPattern**](/windows/desktop/api/uiautomationclient/nn-uiautomationclient-iuiautomationstylespattern) interface includes properties and methods that provide the following information about a visual style:</span></span>

-   <span data-ttu-id="a4beb-257">視覺化樣式的名稱，例如「一般」或「標題1」。</span><span class="sxs-lookup"><span data-stu-id="a4beb-257">The name of the visual style, such as "Normal" or "Heading 1".</span></span>
-   <span data-ttu-id="a4beb-258">視覺化樣式的識別碼。</span><span class="sxs-lookup"><span data-stu-id="a4beb-258">The identifier of the visual style.</span></span> <span data-ttu-id="a4beb-259">如需詳細資訊，請參閱 [**樣式識別碼**](uiauto-style-identifiers.md)。</span><span class="sxs-lookup"><span data-stu-id="a4beb-259">For more information, see [**Style Identifiers**](uiauto-style-identifiers.md).</span></span>
-   <span data-ttu-id="a4beb-260">用來填滿以文字為基礎之控制項的色彩。</span><span class="sxs-lookup"><span data-stu-id="a4beb-260">The color used to fill the text-based control.</span></span>
-   <span data-ttu-id="a4beb-261">用來填滿以文字為基礎之控制項的模式色彩。</span><span class="sxs-lookup"><span data-stu-id="a4beb-261">The color of the pattern used to fill the text-based control.</span></span>
-   <span data-ttu-id="a4beb-262">以文字為基礎之控制項的圖形。</span><span class="sxs-lookup"><span data-stu-id="a4beb-262">The shape of the text-based control.</span></span>
-   <span data-ttu-id="a4beb-263">擴充屬性;也就是控制項特定樣式名稱和值的清單。</span><span class="sxs-lookup"><span data-stu-id="a4beb-263">The extended properties; that is, a list of control-specific style names and values.</span></span>

## <a name="invoking-context-menus-from-text-ranges"></a><span data-ttu-id="a4beb-264">從文字範圍叫用內容功能表</span><span class="sxs-lookup"><span data-stu-id="a4beb-264">Invoking Context Menus From Text Ranges</span></span>

<span data-ttu-id="a4beb-265">從 Windows 8.1 開始，文字範圍可能會支援 [**IUIAutomationTextRange2**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationtextrange2) 介面。</span><span class="sxs-lookup"><span data-stu-id="a4beb-265">Starting with Windows 8.1, text ranges may support the [**IUIAutomationTextRange2**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationtextrange2) interface.</span></span> <span data-ttu-id="a4beb-266">此介面支援 [**ShowCoNtextMenu**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange2-showcontextmenu) 方法。</span><span class="sxs-lookup"><span data-stu-id="a4beb-266">This interface supports the [**ShowContextMenu**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange2-showcontextmenu) method.</span></span> <span data-ttu-id="a4beb-267">您可以呼叫這個方法來叫用任何與文字範圍相關聯的內容功能表。</span><span class="sxs-lookup"><span data-stu-id="a4beb-267">You can call this method to invoke any context menu that is associated with a text range.</span></span> <span data-ttu-id="a4beb-268">這種情況的案例是文字範圍或 IME 候選選取專案的自動校正。</span><span class="sxs-lookup"><span data-stu-id="a4beb-268">The scenario for this is autocorrection of text ranges or IME candidate selection.</span></span> <span data-ttu-id="a4beb-269">在這些情況下，會出現支援使用者互動的內容功能表。</span><span class="sxs-lookup"><span data-stu-id="a4beb-269">In these cases a context menu appears that supports user interaction.</span></span>

## <a name="related-topics"></a><span data-ttu-id="a4beb-270">相關主題</span><span class="sxs-lookup"><span data-stu-id="a4beb-270">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="a4beb-271">Text 和 TextRange 控制項模式</span><span class="sxs-lookup"><span data-stu-id="a4beb-271">Text and TextRange Control Patterns</span></span>](uiauto-implementingtextandtextrange.md)
</dt> <dt>

[<span data-ttu-id="a4beb-272">消費者介面自動化文字內容的支援</span><span class="sxs-lookup"><span data-stu-id="a4beb-272">UI Automation Support for Textual Content</span></span>](uiauto-ui-automation-textpattern-overview.md)
</dt> <dt>

[<span data-ttu-id="a4beb-273">使用以文字為基礎的控制項</span><span class="sxs-lookup"><span data-stu-id="a4beb-273">Working with Text-based Controls</span></span>](uiauto-workingwithtextbasedcontrols.md)
</dt> </dl>

 

 