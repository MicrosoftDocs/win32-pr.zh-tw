---
description: 當您呼叫 CreateNamedPipe 函式時，可以指定具名管道的安全描述項。 安全描述項可控制具名管道的用戶端和伺服器端的存取。
ms.assetid: f9ea97c9-9a97-4083-82d8-29ffb8be5a77
title: 具名管道安全性和存取權限
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 11cada606d8197ac2f64943aa742bbfd614fa4ef
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "106987569"
---
# <a name="named-pipe-security-and-access-rights"></a><span data-ttu-id="4362c-104">具名管道安全性和存取權限</span><span class="sxs-lookup"><span data-stu-id="4362c-104">Named Pipe Security and Access Rights</span></span>

<span data-ttu-id="4362c-105">Windows 安全性可讓您控制具名管道的存取。</span><span class="sxs-lookup"><span data-stu-id="4362c-105">Windows security enables you to control access to named pipes.</span></span> <span data-ttu-id="4362c-106">如需安全性的詳細資訊，請參閱 [存取控制模型](/windows/desktop/SecAuthZ/access-control-model)。</span><span class="sxs-lookup"><span data-stu-id="4362c-106">For more information about security, see [Access-Control Model](/windows/desktop/SecAuthZ/access-control-model).</span></span>

<span data-ttu-id="4362c-107">當您呼叫 [**CreateNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-createnamedpipea)函式時，可以指定具名管道的 [安全描述項](/windows/desktop/SecAuthZ/security-descriptors)。</span><span class="sxs-lookup"><span data-stu-id="4362c-107">You can specify a [security descriptor](/windows/desktop/SecAuthZ/security-descriptors) for a named pipe when you call the [**CreateNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-createnamedpipea) function.</span></span> <span data-ttu-id="4362c-108">安全描述項可控制具名管道的用戶端和伺服器端的存取。</span><span class="sxs-lookup"><span data-stu-id="4362c-108">The security descriptor controls access to both client and server ends of the named pipe.</span></span> <span data-ttu-id="4362c-109">如果您指定 **Null**，具名管道會取得預設安全描述項。</span><span class="sxs-lookup"><span data-stu-id="4362c-109">If you specify **NULL**, the named pipe gets a default security descriptor.</span></span> <span data-ttu-id="4362c-110">具名管道之預設安全描述項中的 Acl 會授與 LocalSystem 帳戶、系統管理員和 creator 擁有者的完全控制權。</span><span class="sxs-lookup"><span data-stu-id="4362c-110">The ACLs in the default security descriptor for a named pipe grant full control to the LocalSystem account, administrators, and the creator owner.</span></span> <span data-ttu-id="4362c-111">他們也會將讀取權限授與 Everyone 群組和匿名帳戶的成員。</span><span class="sxs-lookup"><span data-stu-id="4362c-111">They also grant read access to members of the Everyone group and the anonymous account.</span></span>

<span data-ttu-id="4362c-112">若要取出具名管道的安全描述項，請呼叫 [**GetSecurityInfo**](/windows/desktop/api/aclapi/nf-aclapi-getsecurityinfo) 函數。</span><span class="sxs-lookup"><span data-stu-id="4362c-112">To retrieve a named pipe's security descriptor, call the [**GetSecurityInfo**](/windows/desktop/api/aclapi/nf-aclapi-getsecurityinfo) function.</span></span> <span data-ttu-id="4362c-113">若要變更具名管道的安全描述項，請呼叫 [**SetSecurityInfo**](/windows/desktop/api/aclapi/nf-aclapi-setsecurityinfo) 函數。</span><span class="sxs-lookup"><span data-stu-id="4362c-113">To change the security descriptor of a named pipe, call the [**SetSecurityInfo**](/windows/desktop/api/aclapi/nf-aclapi-setsecurityinfo) function.</span></span>

<span data-ttu-id="4362c-114">當執行緒呼叫 [**CreateNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-createnamedpipea) 開啟現有具名管道之伺服器端的控制碼時，系統會先執行存取檢查，再傳回控制碼。</span><span class="sxs-lookup"><span data-stu-id="4362c-114">When a thread calls [**CreateNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-createnamedpipea) to open a handle to the server end of an existing named pipe, the system performs an access check before returning the handle.</span></span> <span data-ttu-id="4362c-115">存取檢查會根據具名管道的安全描述項中的 DACL 來比較執行緒的存取權杖和要求的 [存取權限](/windows/desktop/SecAuthZ/access-rights-and-access-masks) 。</span><span class="sxs-lookup"><span data-stu-id="4362c-115">The access check compares the thread's access token and the requested [access rights](/windows/desktop/SecAuthZ/access-rights-and-access-masks) against the DACL in the named pipe's security descriptor.</span></span> <span data-ttu-id="4362c-116">除了要求的存取權限之外，DACL 還必須允許呼叫的執行緒檔案 \_ 建立 \_ 管道 \_ 實例存取具名管道。</span><span class="sxs-lookup"><span data-stu-id="4362c-116">In addition to the requested access rights, the DACL must allow the calling thread FILE\_CREATE\_PIPE\_INSTANCE access to the named pipe.</span></span>

<span data-ttu-id="4362c-117">同樣地，當用戶端呼叫 [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) 或 [**CallNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-callnamedpipea) 函式來連接至具名管道的用戶端時，系統會先執行存取檢查，再授與用戶端的存取權。</span><span class="sxs-lookup"><span data-stu-id="4362c-117">Similarly, when a client calls the [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) or [**CallNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-callnamedpipea) function to connect to the client end of a named pipe, the system performs an access check before granting access to the client.</span></span>

<span data-ttu-id="4362c-118">[**CreateNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-createnamedpipea)函式所傳回的控制碼一律具有同步存取。</span><span class="sxs-lookup"><span data-stu-id="4362c-118">The handle returned by the [**CreateNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-createnamedpipea) function always has SYNCHRONIZE access.</span></span> <span data-ttu-id="4362c-119">它也具有泛型 \_ 讀取、一般 \_ 寫入或兩者（視管道的開啟模式而定）。</span><span class="sxs-lookup"><span data-stu-id="4362c-119">It also has GENERIC\_READ, GENERIC\_WRITE, or both, depending on the open mode of the pipe.</span></span> <span data-ttu-id="4362c-120">以下是每個開啟模式的存取權限。</span><span class="sxs-lookup"><span data-stu-id="4362c-120">The following are the access rights for each open mode.</span></span>



| <span data-ttu-id="4362c-121">開啟模式</span><span class="sxs-lookup"><span data-stu-id="4362c-121">Open mode</span></span>                           | <span data-ttu-id="4362c-122">存取權限</span><span class="sxs-lookup"><span data-stu-id="4362c-122">Access rights</span></span>                                              |
|-------------------------------------|------------------------------------------------------------|
| <span data-ttu-id="4362c-123">管道 \_ 存取 \_ 雙工 (0x00000003) </span><span class="sxs-lookup"><span data-stu-id="4362c-123">PIPE\_ACCESS\_DUPLEX (0x00000003)</span></span>   | <span data-ttu-id="4362c-124">檔案 \_ 一般 \_ 讀取、檔案 \_ 一般 \_ 寫入和同步處理</span><span class="sxs-lookup"><span data-stu-id="4362c-124">FILE\_GENERIC\_READ, FILE\_GENERIC\_WRITE, and SYNCHRONIZE</span></span> |
| <span data-ttu-id="4362c-125">管道 \_ 存取 \_ 輸入 (0x00000001) </span><span class="sxs-lookup"><span data-stu-id="4362c-125">PIPE\_ACCESS\_INBOUND (0x00000001)</span></span>  | <span data-ttu-id="4362c-126">檔案 \_ 一般 \_ 讀取和同步處理</span><span class="sxs-lookup"><span data-stu-id="4362c-126">FILE\_GENERIC\_READ and SYNCHRONIZE</span></span>                        |
| <span data-ttu-id="4362c-127">管道 \_ 存取 \_ 輸出 (0x00000002) </span><span class="sxs-lookup"><span data-stu-id="4362c-127">PIPE\_ACCESS\_OUTBOUND (0x00000002)</span></span> | <span data-ttu-id="4362c-128">檔案 \_ 一般 \_ 寫入和同步處理</span><span class="sxs-lookup"><span data-stu-id="4362c-128">FILE\_GENERIC\_WRITE and SYNCHRONIZE</span></span>                       |



 

<span data-ttu-id="4362c-129">\_具名管道的檔案一般 \_ 讀取存取結合了從管道讀取資料、讀取管道屬性、讀取擴充屬性，以及讀取管線的 DACL 的許可權。</span><span class="sxs-lookup"><span data-stu-id="4362c-129">FILE\_GENERIC\_READ access for a named pipe combines the rights to read data from the pipe, read pipe attributes, read extended attributes, and read the pipe's DACL.</span></span>

<span data-ttu-id="4362c-130">\_具名管道的檔案一般 \_ 寫入存取結合了將資料寫入管道的許可權、將資料附加至管線、寫入管道屬性、寫入擴充屬性，以及讀取管線的 DACL。</span><span class="sxs-lookup"><span data-stu-id="4362c-130">FILE\_GENERIC\_WRITE access for a named pipe combines the rights to write data to the pipe, append data to it, write pipe attributes, write extended attributes, and read the pipe's DACL.</span></span> <span data-ttu-id="4362c-131">由於 FILE \_ 附加 \_ 資料和檔案 \_ 建立 \_ 管道 \_ 實例具有相同的定義，因此檔案 \_ 一般 \_ 寫入會啟用建立管道的許可權。</span><span class="sxs-lookup"><span data-stu-id="4362c-131">Because FILE\_APPEND\_DATA and FILE\_CREATE\_PIPE\_INSTANCE have the same definition, so FILE\_GENERIC\_WRITE enables permission to create the pipe.</span></span> <span data-ttu-id="4362c-132">若要避免這個問題，請使用個別的許可權，而不要使用檔案 \_ 一般 \_ 寫入。</span><span class="sxs-lookup"><span data-stu-id="4362c-132">To avoid this problem, use the individual rights instead of using FILE\_GENERIC\_WRITE.</span></span>

<span data-ttu-id="4362c-133">\_ \_ 如果您想要讀取或寫入物件的 SACL，您可以向具名管道物件要求存取系統安全性存取權。</span><span class="sxs-lookup"><span data-stu-id="4362c-133">You can request the ACCESS\_SYSTEM\_SECURITY access right to a named pipe object if you want to read or write the object's SACL.</span></span> <span data-ttu-id="4362c-134">如需詳細資訊，請參閱 (Acl) 和[SACL 訪問](/windows/desktop/SecAuthZ/sacl-access-right)許可權[的存取控制清單](/windows/desktop/SecAuthZ/access-control-lists)。</span><span class="sxs-lookup"><span data-stu-id="4362c-134">For more information, see [Access-Control Lists (ACLs)](/windows/desktop/SecAuthZ/access-control-lists) and [SACL Access Right](/windows/desktop/SecAuthZ/sacl-access-right).</span></span>

<span data-ttu-id="4362c-135">若要防止不同的終端機服務會話上的遠端使用者或使用者存取具名管道，請在該管道的 DACL 上使用登入 SID。</span><span class="sxs-lookup"><span data-stu-id="4362c-135">To prevent remote users or users on a different terminal services session from accessing a named pipe, use the logon SID on the DACL for the pipe.</span></span> <span data-ttu-id="4362c-136">登入 SID 也會在執行為登入中使用;它是用來保護每個會話物件命名空間的 SID。</span><span class="sxs-lookup"><span data-stu-id="4362c-136">The logon SID is used in run-as logons as well; it is the SID used to protect the per-session object namespace.</span></span> <span data-ttu-id="4362c-137">如需詳細資訊，請參閱 [在 c + + 中取得登入 SID](/previous-versions//aa446670(v=vs.85))。</span><span class="sxs-lookup"><span data-stu-id="4362c-137">For more information, see [Getting the Logon SID in C++](/previous-versions//aa446670(v=vs.85)).</span></span>

 

 
