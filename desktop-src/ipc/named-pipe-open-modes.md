---
description: 管道伺服器會在 CreateNamedPipe 函數的 dwOpenMode 參數中，指定管道存取、重迭和寫入模式。 管道用戶端可以使用 CreateFile 函式，為管道控制碼指定這些開啟模式。
ms.assetid: 88824566-93c7-4941-a4fc-3a7ae9a332a4
title: 具名管道開啟模式
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 97f51d41ea98a47a269634b06ccdad869bd649fa
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "103945170"
---
# <a name="named-pipe-open-modes"></a><span data-ttu-id="e44cc-104">具名管道開啟模式</span><span class="sxs-lookup"><span data-stu-id="e44cc-104">Named Pipe Open Modes</span></span>

<span data-ttu-id="e44cc-105">管道伺服器會在 [**CreateNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-createnamedpipea)函數的 *dwOpenMode* 參數中，指定管道存取、重迭和寫入模式。</span><span class="sxs-lookup"><span data-stu-id="e44cc-105">The pipe server specifies the pipe access, overlap, and write-through modes in the *dwOpenMode* parameter of the [**CreateNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-createnamedpipea) function.</span></span> <span data-ttu-id="e44cc-106">管道用戶端可以使用 [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) 函式，為管道控制碼指定這些開啟模式。</span><span class="sxs-lookup"><span data-stu-id="e44cc-106">The pipe clients can specify these open modes for their pipe handles using the [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) function.</span></span>

## <a name="access-mode"></a><span data-ttu-id="e44cc-107">存取模式</span><span class="sxs-lookup"><span data-stu-id="e44cc-107">Access Mode</span></span>

<span data-ttu-id="e44cc-108">設定管道存取模式相當於指定與管道伺服器控制碼相關聯的讀取或寫入存取權。</span><span class="sxs-lookup"><span data-stu-id="e44cc-108">Setting the pipe access mode is equivalent to specifying read or write access associated with the pipe server's handles.</span></span> <span data-ttu-id="e44cc-109">下錶針對您可以使用 [**CreateNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-createnamedpipea)指定的每個存取模式，顯示對等的一般存取許可權。</span><span class="sxs-lookup"><span data-stu-id="e44cc-109">The following table shows the equivalent generic access right for each access mode you can specify with [**CreateNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-createnamedpipea).</span></span>



| <span data-ttu-id="e44cc-110">存取模式</span><span class="sxs-lookup"><span data-stu-id="e44cc-110">Access mode</span></span>            | <span data-ttu-id="e44cc-111">對等的一般存取權限</span><span class="sxs-lookup"><span data-stu-id="e44cc-111">Equivalent generic access right</span></span> |
|------------------------|---------------------------------|
| <span data-ttu-id="e44cc-112">管道 \_ 存取 \_ 輸入</span><span class="sxs-lookup"><span data-stu-id="e44cc-112">PIPE\_ACCESS\_INBOUND</span></span>  | <span data-ttu-id="e44cc-113">一般 \_ 讀取</span><span class="sxs-lookup"><span data-stu-id="e44cc-113">GENERIC\_READ</span></span>                   |
| <span data-ttu-id="e44cc-114">管道 \_ 存取 \_ 輸出</span><span class="sxs-lookup"><span data-stu-id="e44cc-114">PIPE\_ACCESS\_OUTBOUND</span></span> | <span data-ttu-id="e44cc-115">一般 \_ 寫入</span><span class="sxs-lookup"><span data-stu-id="e44cc-115">GENERIC\_WRITE</span></span>                  |
| <span data-ttu-id="e44cc-116">管道 \_ 存取 \_ 雙工</span><span class="sxs-lookup"><span data-stu-id="e44cc-116">PIPE\_ACCESS\_DUPLEX</span></span>   | <span data-ttu-id="e44cc-117">泛型 \_ 讀取 \| 一般 \_ 寫入</span><span class="sxs-lookup"><span data-stu-id="e44cc-117">GENERIC\_READ \| GENERIC\_WRITE</span></span> |



 

<span data-ttu-id="e44cc-118">如果管道伺服器使用管道存取輸入建立管道 \_ \_ ，管道伺服器的管道會是唯讀的，而管道用戶端的管道則是唯讀的。</span><span class="sxs-lookup"><span data-stu-id="e44cc-118">If the pipe server creates a pipe with PIPE\_ACCESS\_INBOUND, the pipe is read-only for the pipe server and write-only for the pipe client.</span></span> <span data-ttu-id="e44cc-119">如果管道伺服器建立了具有管道存取輸出的管道，則管道 \_ \_ 是僅針對管道伺服器的寫入，而管道用戶端的唯讀。</span><span class="sxs-lookup"><span data-stu-id="e44cc-119">If the pipe server creates a pipe with PIPE\_ACCESS\_OUTBOUND, the pipe is write-only for the pipe server and read-only for the pipe client.</span></span> <span data-ttu-id="e44cc-120">使用管道 \_ 存取雙工建立的管道 \_ 是管道伺服器和管道用戶端的讀取/寫入。</span><span class="sxs-lookup"><span data-stu-id="e44cc-120">A pipe created with PIPE\_ACCESS\_DUPLEX is read/write for both the pipe server and the pipe client.</span></span>

<span data-ttu-id="e44cc-121">使用 [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) 連接到具名管道的管道用戶端，必須在 *dwDesiredAccess* 參數中指定與管道伺服器所指定之存取模式相容的存取權限。</span><span class="sxs-lookup"><span data-stu-id="e44cc-121">Pipe clients using [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) to connect to a named pipe must specify an access right in the *dwDesiredAccess* parameter that is compatible with the access mode specified by the pipe server.</span></span> <span data-ttu-id="e44cc-122">例如，用戶端必須指定一般 \_ 讀取權限，才能開啟管道伺服器使用 [管道存取輸出] 建立的管道句 \_ 柄 \_ 。</span><span class="sxs-lookup"><span data-stu-id="e44cc-122">For example, a client must specify GENERIC\_READ access to open a handle for a pipe that the pipe server created with PIPE\_ACCESS\_OUTBOUND.</span></span> <span data-ttu-id="e44cc-123">所有管道實例的存取模式都必須相同。</span><span class="sxs-lookup"><span data-stu-id="e44cc-123">The access modes must be the same for all instances of a pipe.</span></span>

<span data-ttu-id="e44cc-124">若要讀取管道屬性（例如讀取模式或封鎖模式），管道控制碼必須具有 [檔案 \_ 讀取 \_ 屬性] 存取權限; 若要寫入管道屬性，管道控制碼必須有 [檔案 \_ 寫入屬性] 存取權限 \_ 。</span><span class="sxs-lookup"><span data-stu-id="e44cc-124">To read pipe attributes such as the read mode or blocking mode, the pipe handle must have the FILE\_READ\_ATTRIBUTES access right; to write pipe attributes, the pipe handle must have the FILE\_WRITE\_ATTRIBUTES access right.</span></span> <span data-ttu-id="e44cc-125">這些存取權限可以與適用于管道的一般存取權限結合：適用于 \_ 唯讀管道的一般讀取和檔案 \_ 寫入 \_ 屬性，或 \_ \_ \_ 僅限寫入管道的一般寫入與檔案讀取屬性。</span><span class="sxs-lookup"><span data-stu-id="e44cc-125">These access rights can be combined with the generic access right that is appropriate for the pipe: GENERIC\_READ with FILE\_WRITE\_ATTRIBUTES for a read-only pipe, or GENERIC\_WRITE with FILE\_READ\_ATTRIBUTES for a write-only pipe.</span></span> <span data-ttu-id="e44cc-126">以這種方式限制存取權限可提供更佳的管道安全性。</span><span class="sxs-lookup"><span data-stu-id="e44cc-126">Restricting access rights in this way provides better security for the pipe.</span></span>

## <a name="overlapped-mode"></a><span data-ttu-id="e44cc-127">重迭模式</span><span class="sxs-lookup"><span data-stu-id="e44cc-127">Overlapped Mode</span></span>

<span data-ttu-id="e44cc-128">在重迭模式中，執行長時間讀取、寫入和連接作業的函式可能會立即返回。</span><span class="sxs-lookup"><span data-stu-id="e44cc-128">In overlapped mode, functions performing lengthy read, write, and connect operations can return immediately.</span></span> <span data-ttu-id="e44cc-129">這可讓執行緒在背景中執行耗時的作業時，執行其他作業。</span><span class="sxs-lookup"><span data-stu-id="e44cc-129">This enables the thread to perform other operations while a time-consuming operation is executing in the background.</span></span> <span data-ttu-id="e44cc-130">若要指定重迭模式，請使用檔案旗標重迭 \_ \_ 旗標。</span><span class="sxs-lookup"><span data-stu-id="e44cc-130">To specify overlapped mode, use the FILE\_FLAG\_OVERLAPPED flag.</span></span> <span data-ttu-id="e44cc-131">如需詳細資訊，請參閱 [同步和重迭的輸入和輸出](synchronous-and-overlapped-input-and-output.md)。</span><span class="sxs-lookup"><span data-stu-id="e44cc-131">For more information, see [Synchronous and Overlapped Input and Output](synchronous-and-overlapped-input-and-output.md).</span></span>

<span data-ttu-id="e44cc-132">[**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea)函式可讓管道用戶端 \_ \_ 使用 *dwFlagsAndAttributes* 參數，為其管道控制碼設定重迭模式 (檔旗標重迭) 。</span><span class="sxs-lookup"><span data-stu-id="e44cc-132">The [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) function allows the pipe client to set overlapped mode (FILE\_FLAG\_OVERLAPPED) for its pipe handles using the *dwFlagsAndAttributes* parameter.</span></span>

## <a name="write-through-mode"></a><span data-ttu-id="e44cc-133">Write-Through 模式</span><span class="sxs-lookup"><span data-stu-id="e44cc-133">Write-Through Mode</span></span>

<span data-ttu-id="e44cc-134">\_透過檔案旗標 \_ 寫入來指定寫入模式 \_ 。</span><span class="sxs-lookup"><span data-stu-id="e44cc-134">Specify write-through mode with FILE\_FLAG\_WRITE\_THROUGH.</span></span> <span data-ttu-id="e44cc-135">此模式只會影響在不同電腦上的管道用戶端與管道伺服器之間的位元組類型管道的寫入作業。</span><span class="sxs-lookup"><span data-stu-id="e44cc-135">This mode affects only write operations to byte-type pipes between pipe clients and pipe servers on different computers.</span></span> <span data-ttu-id="e44cc-136">在寫入模式中，寫入具名管道的函式不會傳回，直到資料透過網路傳輸到遠端電腦上的管道緩衝區為止。</span><span class="sxs-lookup"><span data-stu-id="e44cc-136">In write-through mode, the functions that write to a named pipe do not return until the data is transmitted across the network and into the pipe's buffer on the remote computer.</span></span> <span data-ttu-id="e44cc-137">寫入模式適用于需要每次寫入作業進行同步處理的應用程式。</span><span class="sxs-lookup"><span data-stu-id="e44cc-137">Write-through mode is useful for applications that require synchronization for every write operation.</span></span>

<span data-ttu-id="e44cc-138">如果未啟用寫入模式，系統會緩衝處理資料，以增強網路作業的效率，直到最小的位元組數目已累積，或直到最大時間週期經過為止。</span><span class="sxs-lookup"><span data-stu-id="e44cc-138">If write-through mode is not enabled, the system enhances the efficiency of network operations by buffering data until a minimum number of bytes have accumulated or until a maximum time period has elapsed.</span></span> <span data-ttu-id="e44cc-139">緩衝可讓系統將多個寫入作業結合成單一網路傳輸。</span><span class="sxs-lookup"><span data-stu-id="e44cc-139">Buffering enables the system to combine multiple write operations into a single network transmission.</span></span> <span data-ttu-id="e44cc-140">這表示當系統將資料放在輸出緩衝區中，但在系統將資料傳輸到網路上之前，寫入作業可以順利完成。</span><span class="sxs-lookup"><span data-stu-id="e44cc-140">This means that a write operation can be successfully completed after the system puts the data in the outbound buffer, but before the system transmits it across the network.</span></span>

<span data-ttu-id="e44cc-141">[**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea)函式可讓管道用戶端使用 dwFlagsAndAttributes 參數，將寫入模式 (檔案 \_ 旗標 \_ 寫入 \_ 至其管道控制碼的) 。</span><span class="sxs-lookup"><span data-stu-id="e44cc-141">The [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) function allows the pipe client to set write-through mode (FILE\_FLAG\_WRITE\_THROUGH) for its pipe handles using the *dwFlagsAndAttributes* parameter.</span></span> <span data-ttu-id="e44cc-142">建立管道控制碼之後，無法變更管道控制碼的寫入模式。</span><span class="sxs-lookup"><span data-stu-id="e44cc-142">The write-through mode of a pipe handle cannot be changed after the pipe handle has been created.</span></span> <span data-ttu-id="e44cc-143">針對相同管道實例的伺服器和用戶端控制碼，寫入模式可能會不同。</span><span class="sxs-lookup"><span data-stu-id="e44cc-143">The write-through mode can be different for server and client handles to the same pipe instance.</span></span>

<span data-ttu-id="e44cc-144">管道用戶端可以使用 [**SetNamedPipeHandleState**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-setnamedpipehandlestate) 函式來控制已停用寫入模式之管道的傳輸之前的位元組數和超時時間。</span><span class="sxs-lookup"><span data-stu-id="e44cc-144">A pipe client can use the [**SetNamedPipeHandleState**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-setnamedpipehandlestate) function to control the number of bytes and the time-out period before transmission for a pipe on which write-through mode is disabled.</span></span> <span data-ttu-id="e44cc-145">若為唯讀管道，必須以「一般讀取」和「檔案 \_ \_ 寫入屬性」存取權限開啟管道控制碼 \_ 。</span><span class="sxs-lookup"><span data-stu-id="e44cc-145">For a read-only pipe, the pipe handle must be opened with the GENERIC\_READ and FILE\_WRITE\_ATTRIBUTES access rights.</span></span>

 

 
