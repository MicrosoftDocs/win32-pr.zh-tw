---
title: 裝置提供者
description: 裝置提供者是電腦在每次系統啟動時啟動的註冊物件。
ms.assetid: 80c08993-0a8b-4ee9-93cd-bcc3c00e843b
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 67fac270342830045fc3bac9f0573f283d87dc6a
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/20/2020
ms.locfileid: "104092787"
---
# <a name="device-providers"></a><span data-ttu-id="fda79-103">裝置提供者</span><span class="sxs-lookup"><span data-stu-id="fda79-103">Device Providers</span></span>

<span data-ttu-id="fda79-104">裝置提供者是電腦在每次系統啟動時啟動的註冊物件。</span><span class="sxs-lookup"><span data-stu-id="fda79-104">Device providers are registered objects that the computer starts on every system startup.</span></span> <span data-ttu-id="fda79-105">裝置提供者會向裝置主機註冊及取消註冊執行中的裝置，以回應某個事件。</span><span class="sxs-lookup"><span data-stu-id="fda79-105">Device providers register and unregister running devices with the device host in response to some event.</span></span> <span data-ttu-id="fda79-106">這些裝置是系統啟動時自動啟動的裝置。</span><span class="sxs-lookup"><span data-stu-id="fda79-106">These devices are devices that have been automatically started at system startup time.</span></span> <span data-ttu-id="fda79-107">基於安全性理由，裝置提供者通常會以 [LocalService](/windows/desktop/Services/localservice-account)的形式執行，而不是 [LocalSystem](/windows/desktop/Services/localsystem-account)。</span><span class="sxs-lookup"><span data-stu-id="fda79-107">For security reasons, a device provider should generally run as [LocalService](/windows/desktop/Services/localservice-account), rather than [LocalSystem](/windows/desktop/Services/localsystem-account).</span></span>

<span data-ttu-id="fda79-108">裝置提供者可用於暫時性裝置。</span><span class="sxs-lookup"><span data-stu-id="fda79-108">Device providers can be used for transient devices.</span></span> <span data-ttu-id="fda79-109">裝置提供者也可以用來將裝置橋接到輪詢的媒體。</span><span class="sxs-lookup"><span data-stu-id="fda79-109">Device providers can also be used to bridge devices to polled media.</span></span> <span data-ttu-id="fda79-110">例如，像是數位音樂播放機的周邊裝置，會透過序列埠連接到電腦。</span><span class="sxs-lookup"><span data-stu-id="fda79-110">For example, a peripheral device such as a digital music player is connected to a computer via a serial port.</span></span> <span data-ttu-id="fda79-111">若要以 UPnP 型裝置的形式公開音樂播放機，則需要裝置控制物件和一組服務物件。</span><span class="sxs-lookup"><span data-stu-id="fda79-111">To expose the music player as a UPnP-based device, a device control object and a set of service objects are required.</span></span> <span data-ttu-id="fda79-112">這些物件會以序列命令的形式來執行以 UPnP 為基礎的音樂播放機動作。</span><span class="sxs-lookup"><span data-stu-id="fda79-112">These objects implement the UPnP-based music player actions as serial commands.</span></span> <span data-ttu-id="fda79-113">不過，在註冊這些物件之前，必須先將音樂播放機插入序列埠，並可進行控制。</span><span class="sxs-lookup"><span data-stu-id="fda79-113">However, the music player must be plugged into the serial port and available for control before these objects are registered.</span></span>

<span data-ttu-id="fda79-114">由於序列埠在裝置連線時不會提供明確的通知機制，因此需要輪詢程式碼。</span><span class="sxs-lookup"><span data-stu-id="fda79-114">Because the serial port does not offer an explicit notification mechanism when devices are connected, polling code is required.</span></span> <span data-ttu-id="fda79-115">此程式碼可以在裝置提供者物件、服務或獨立應用程式中執行。</span><span class="sxs-lookup"><span data-stu-id="fda79-115">This code can be implemented in a device provider object, a service, or in a standalone application.</span></span> <span data-ttu-id="fda79-116">當電腦啟動時，裝置主機會將裝置提供者物件具現化，然後再叫用其 [**Start**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpdeviceprovider-start) 方法。</span><span class="sxs-lookup"><span data-stu-id="fda79-116">When the computer is started, the device host instantiates the device provider object, and then invokes its [**Start**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpdeviceprovider-start) method.</span></span> <span data-ttu-id="fda79-117">當裝置提供者偵測到有音樂播放機裝置時，它會具現化適當的裝置控制物件，並藉由呼叫 [**IUPnPRegistrar：： RegisterRunningDevice**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpregistrar-registerrunningdevice)來註冊它。</span><span class="sxs-lookup"><span data-stu-id="fda79-117">When the device provider detects the presence of a music player device, it instantiates the appropriate device control object and registers it by calling [**IUPnPRegistrar::RegisterRunningDevice**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpregistrar-registerrunningdevice).</span></span> <span data-ttu-id="fda79-118">此方法會發佈裝置，並將其發佈至以 UPnP 為基礎的網路。</span><span class="sxs-lookup"><span data-stu-id="fda79-118">This method publishes the device and announces it to the UPnP-based network.</span></span>

<span data-ttu-id="fda79-119">您也可以藉由執行輪詢序列埠的服務來達成相同的功能。</span><span class="sxs-lookup"><span data-stu-id="fda79-119">The same functionality can also be achieved by implementing a service that polls the serial port.</span></span> <span data-ttu-id="fda79-120">不過，裝置提供者只需要執行核心功能（輪詢）來簡化專案，因為裝置提供者依賴裝置主機來啟動和停止它們。</span><span class="sxs-lookup"><span data-stu-id="fda79-120">However, device providers simplify things by requiring only the core functionality—the polling—to be implemented because device providers rely on the device host to start and stop them.</span></span> <span data-ttu-id="fda79-121">使用裝置提供者比執行服務更簡單。</span><span class="sxs-lookup"><span data-stu-id="fda79-121">Using device providers is simpler than implementing a service.</span></span>

<span data-ttu-id="fda79-122">在註冊期間，以及每次後續的系統啟動時，電腦會將裝置提供者物件具現化，然後再叫用其 [**IUPnPDeviceProvider：： Start**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpdeviceprovider-start) 方法，並將註冊期間指定的初始化字串傳遞給它。</span><span class="sxs-lookup"><span data-stu-id="fda79-122">At registration time, and on every subsequent system startup, the computer instantiates the device provider object, and then invokes its [**IUPnPDeviceProvider::Start**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpdeviceprovider-start) method, passing it the initialization string specified during registration.</span></span>

<span data-ttu-id="fda79-123">一旦呼叫 [**Start**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpdeviceprovider-start) 方法，裝置提供者會執行任何必要的處理，並在必要時，藉由呼叫 [**IUPnPRegistrar：： RegisterRunningDevice**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpregistrar-registerrunningdevice)來註冊裝置，如向 [裝置主機註冊託管裝置](registering-a-hosted-device-with-the-device-host.md)一節中所述。</span><span class="sxs-lookup"><span data-stu-id="fda79-123">Once the [**Start**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpdeviceprovider-start) method is called, the device provider performs any necessary processing, and when necessary, the device provider registers devices by calling [**IUPnPRegistrar::RegisterRunningDevice**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpregistrar-registerrunningdevice), as described in the section [Registering a Hosted Device with the Device Host](registering-a-hosted-device-with-the-device-host.md).</span></span>

<span data-ttu-id="fda79-124">當電腦關機時，裝置主機會叫用 [**IUPnPDeviceProvider：： Stop**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpdeviceprovider-stop) 方法，以指出裝置提供者終止其作業。</span><span class="sxs-lookup"><span data-stu-id="fda79-124">When the computer is shut down, the device host invokes the [**IUPnPDeviceProvider::Stop**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpdeviceprovider-stop) method to indicate that the device provider terminate its operations.</span></span>

 

 