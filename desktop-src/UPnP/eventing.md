---
title: 事件
description: 如果託管服務具有 evented 狀態變數，則必須執行 IUPnPEventSource 介面。
ms.assetid: 7558496d-c909-4602-bfaa-d21108392fed
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 68a6382ee88d2ca5168c94eac20727bbfee4a598
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/16/2019
ms.locfileid: "103840155"
---
# <a name="eventing"></a><span data-ttu-id="2d922-103">事件</span><span class="sxs-lookup"><span data-stu-id="2d922-103">Eventing</span></span>

<span data-ttu-id="2d922-104">如果託管服務具有 evented 狀態變數，則必須執行 [**IUPnPEventSource**](/windows/desktop/api/Upnphost/nn-upnphost-iupnpeventsource) 介面。</span><span class="sxs-lookup"><span data-stu-id="2d922-104">A hosted service must implement the [**IUPnPEventSource**](/windows/desktop/api/Upnphost/nn-upnphost-iupnpeventsource) interface if it has evented state variables.</span></span> <span data-ttu-id="2d922-105">這個介面有兩種方法： [ [**建議**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpeventsource-advise) ] 和 [ [**Unadvise**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpeventsource-unadvise)]。</span><span class="sxs-lookup"><span data-stu-id="2d922-105">This interface has two methods: [**Advise**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpeventsource-advise) and [**Unadvise**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpeventsource-unadvise).</span></span> <span data-ttu-id="2d922-106">此介面提供一種機制，讓裝置主機訂閱託管服務所產生的事件通知。</span><span class="sxs-lookup"><span data-stu-id="2d922-106">This interface provides a mechanism for the device host to subscribe to event notifications generated by the hosted service.</span></span> <span data-ttu-id="2d922-107">一次只會註冊一個以上的事件接收器。</span><span class="sxs-lookup"><span data-stu-id="2d922-107">There will be no more than one event sink registered at a time.</span></span>

<span data-ttu-id="2d922-108">託管服務必須藉由保留 [**IUPnPEventSink**](/windows/desktop/api/Upnphost/nn-upnphost-iupnpeventsink)介面（以參數形式傳遞）的參考，來執行 [**建議**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpeventsource-advise)方法。</span><span class="sxs-lookup"><span data-stu-id="2d922-108">A hosted service must implement the [**Advise**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpeventsource-advise) method by holding a reference to the [**IUPnPEventSink**](/windows/desktop/api/Upnphost/nn-upnphost-iupnpeventsink) interface, which was passed as a parameter.</span></span> <span data-ttu-id="2d922-109">如果找到介面， **建議** 方法會保存該介面的參考，直到叫用 [**Unadvise**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpeventsource-unadvise) 或移除託管服務物件為止。</span><span class="sxs-lookup"><span data-stu-id="2d922-109">If the interface is found, the **Advise** method holds a reference to that interface until [**Unadvise**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpeventsource-unadvise) is invoked, or until the hosted service object is removed.</span></span> <span data-ttu-id="2d922-110">**建議** 只呼叫一次。</span><span class="sxs-lookup"><span data-stu-id="2d922-110">**Advise** is called only once.</span></span>

<span data-ttu-id="2d922-111">若要移除訂用帳戶，裝置主機會叫用 [**Unadvise**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpeventsource-unadvise) ，並在呼叫「 [**建議**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpeventsource-advise)」時，于所使用的物件指標中傳遞。</span><span class="sxs-lookup"><span data-stu-id="2d922-111">To remove the subscription, the device host invokes [**Unadvise**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpeventsource-unadvise) and passes in the object pointer used when it called [**Advise**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpeventsource-advise).</span></span> <span data-ttu-id="2d922-112">如果指標與傳遞給 **建議** 的指標相同，則會移除訂用帳戶。</span><span class="sxs-lookup"><span data-stu-id="2d922-112">The hosted service removes the subscription if the pointer is the same as the one passed to **Advise**.</span></span>

<span data-ttu-id="2d922-113">當狀態變數的值變更時，託管服務必須通知事件已發生。</span><span class="sxs-lookup"><span data-stu-id="2d922-113">When a state variable's value changes, the hosted service must signal that an event has occurred.</span></span> <span data-ttu-id="2d922-114">這些服務會藉由叫用 [**IUPnPEventSink：： OnStateChanged**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpeventsink-onstatechanged) 方法來執行此動作。</span><span class="sxs-lookup"><span data-stu-id="2d922-114">The services does this by invoking the [**IUPnPEventSink::OnStateChanged**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpeventsink-onstatechanged) method.</span></span>

<span data-ttu-id="2d922-115">當裝置主機不再需要從託管服務接收通知時，它會叫用 [**IUPnPEventSource：： Unadvise**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpeventsource-unadvise)，並傳入從「 [**建議**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpeventsource-advise)」接收的相同物件指標。</span><span class="sxs-lookup"><span data-stu-id="2d922-115">When the device host no longer needs to receive notifications from the hosted service, it invokes [**IUPnPEventSource::Unadvise**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpeventsource-unadvise), passing in the same object pointer that it received from [**Advise**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpeventsource-advise).</span></span> <span data-ttu-id="2d922-116">裝置主機不再位於網路時，會叫用此方法。</span><span class="sxs-lookup"><span data-stu-id="2d922-116">The device host invokes this method when the device is no longer going to be on the network.</span></span>

 

 




