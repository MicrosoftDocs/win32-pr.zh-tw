---
description: Authenticode 時間戳記是以標準 PKCS \# 7 副署為基礎。 Microsoft 簽署的工具可讓開發人員在貼上 Authenticode 簽章時，同時貼上時間戳記。
ms.assetid: d0bd3e2f-1eee-4f71-9467-974994f720d5
title: 時間戳記 Authenticode 簽章
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0232853441d2c11d331c175ac7e8dfd120b341ff
ms.sourcegitcommit: dc2f43e0f23f4a4ce239118cf9a5180f3ff0dd1d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/30/2021
ms.locfileid: "108327183"
---
# <a name="time-stamping-authenticode-signatures"></a><span data-ttu-id="a656e-104">時間戳記 Authenticode 簽章</span><span class="sxs-lookup"><span data-stu-id="a656e-104">Time Stamping Authenticode Signatures</span></span>

<span data-ttu-id="a656e-105">Microsoft Authenticode 簽章提供二進位資料的作品和完整性保證。</span><span class="sxs-lookup"><span data-stu-id="a656e-105">Microsoft Authenticode signatures provide authorship and integrity guarantees for binary data.</span></span> <span data-ttu-id="a656e-106">Authenticode 時間戳記是以標準 PKCS \# 7 副署為基礎。</span><span class="sxs-lookup"><span data-stu-id="a656e-106">Authenticode time stamping is based on standard PKCS \#7 countersignatures.</span></span> <span data-ttu-id="a656e-107">Microsoft 簽署的工具可讓開發人員在貼上 Authenticode 簽章時，同時貼上時間戳記。</span><span class="sxs-lookup"><span data-stu-id="a656e-107">Signing tools from Microsoft allow developers to affix time stamps at the same time as they affix Authenticode signatures.</span></span> <span data-ttu-id="a656e-108">時間戳記允許驗證 Authenticode 簽章，即使在用於簽章的憑證過期之後也是如此。</span><span class="sxs-lookup"><span data-stu-id="a656e-108">Time stamping allows Authenticode signatures to be verifiable even after the certificates used for signature have expired.</span></span>

## <a name="a-brief-introduction-to-authenticode"></a><span data-ttu-id="a656e-109">Authenticode 的簡介</span><span class="sxs-lookup"><span data-stu-id="a656e-109">A Brief Introduction to Authenticode</span></span>

<span data-ttu-id="a656e-110">[*Authenticode*](../secgloss/a-gly.md) 套用數位簽章技術，以保證二進位資料（如可安裝的軟體）的作品和完整性。</span><span class="sxs-lookup"><span data-stu-id="a656e-110">[*Authenticode*](../secgloss/a-gly.md) applies digital signature technology to guarantee the authorship and integrity of binary data such as installable software.</span></span> <span data-ttu-id="a656e-111">用戶端網頁瀏覽器（或其他系統元件）可以使用 Authenticode 簽章來確認下載或安裝軟體時的資料完整性。</span><span class="sxs-lookup"><span data-stu-id="a656e-111">A client web browser, or other system components, can use the Authenticode signatures to verify the integrity of the data when the software is downloaded or installed.</span></span> <span data-ttu-id="a656e-112">Authenticode 簽章可以搭配許多軟體格式使用，包括 .cab、.exe、.ocx 和 .dll。</span><span class="sxs-lookup"><span data-stu-id="a656e-112">Authenticode signatures can be used with many software formats, including .cab, .exe, .ocx, and .dll.</span></span>

<span data-ttu-id="a656e-113">Microsoft 會維護公開憑證發行 [*機構*](/security/trusted-root/participants-list) 單位清單， (CAs) 。</span><span class="sxs-lookup"><span data-stu-id="a656e-113">Microsoft maintains a list of public [*certification authorities*](/security/trusted-root/participants-list) (CAs).</span></span> <span data-ttu-id="a656e-114">Authenticode 憑證的簽發者目前包含 [SSL.com](https://www.ssl.com/)、 [Digicert](https://www.digicert.com/)、 [Sectigo certificate (Comodo) ](https://www.sectigo.com/)和 [GlobalSign](https://www.globalsign.com/)。</span><span class="sxs-lookup"><span data-stu-id="a656e-114">Issuers of Authenticode certificates currently include [SSL.com](https://www.ssl.com/), [Digicert](https://www.digicert.com/), [Sectigo(Comodo)](https://www.sectigo.com/), and [GlobalSign](https://www.globalsign.com/).</span></span>

## <a name="about-cryptographic-time-stamping"></a><span data-ttu-id="a656e-115">關於密碼編譯時間戳</span><span class="sxs-lookup"><span data-stu-id="a656e-115">About Cryptographic Time Stamping</span></span>

<span data-ttu-id="a656e-116">在過去，已建議各種不同的密碼編譯時間戳方法。</span><span class="sxs-lookup"><span data-stu-id="a656e-116">In the past, a variety of cryptographic time stamping methods have been proposed.</span></span> <span data-ttu-id="a656e-117">如需 Haber 和 Stornetta Cryptology 中的「如何 Time-Stamp 數位檔」，請參閱 (1991) 和 Benaloh 與 de 請「單向累加器：「數位簽章的非集中式替代」 Springer link *-Verlag 的課程附注（位於電腦科學* 音量 765 (EUROCRYPT ' 93) ）。</span><span class="sxs-lookup"><span data-stu-id="a656e-117">See, for example, Haber and Stornetta "How to Time-Stamp a Digital Document" in the *Journal of Cryptology* (1991) and Benaloh and de Mare "One-Way Accumulators: A Decentralized Alternative to Digital Signatures" in *Springer-Verlag Lecture Notes in Computer Science* vol. 765 (EUROCRYPT '93).</span></span> <span data-ttu-id="a656e-118">您可以從 [Microsoft Research](https://research.microsoft.com/research/pubs/view.aspx?id=233&type=Publication&0sr=a)取得本文的擴充摘要。</span><span class="sxs-lookup"><span data-stu-id="a656e-118">An extended abstract of this article is available from [Microsoft Research](https://research.microsoft.com/research/pubs/view.aspx?id=233&type=Publication&0sr=a).</span></span> <span data-ttu-id="a656e-119"> (這些資源可能無法在某些語言及國家/地區中使用。 ) 由於時間是實體，而不是數學數量，因此這些方法通常會考慮如何連結化物件，以判斷其建立順序，或如何有效率地將所有可描述的物件視為同時建立。</span><span class="sxs-lookup"><span data-stu-id="a656e-119">(These resources may not be available in some languages and countries or regions.) Because time is a physical, rather than a mathematical, quantity, these methods generally concern how to link objects so that their order of creation can be determined or how to efficiently group objects that can all be described as having been created concurrently.</span></span>

<span data-ttu-id="a656e-120">據稱以數量來驗證時間的系統一律需要某種形式的信任。</span><span class="sxs-lookup"><span data-stu-id="a656e-120">Systems that purport to authenticate time as a quantity always require some form of trust.</span></span> <span data-ttu-id="a656e-121">在強形成對立設定中，您可以使用複雜的通訊協定來確保某種程度的同步。</span><span class="sxs-lookup"><span data-stu-id="a656e-121">In a strongly adversarial setting, complex protocols can be used to ensure some degree of synchrony.</span></span> <span data-ttu-id="a656e-122">不過，這些通訊協定需要在受影響的合作物件之間進行廣泛的互動。</span><span class="sxs-lookup"><span data-stu-id="a656e-122">However, these protocols require extensive interaction between affected parties.</span></span> <span data-ttu-id="a656e-123">在實務上，如果其中一項只需要來自信任來源的認證，則會提供簽署的語句 (認證) ，在指定的時間為簽章提供物件。</span><span class="sxs-lookup"><span data-stu-id="a656e-123">In practice, if one only needs certification of time from a trusted source, the source can simply act as a notary by providing a signed statement (certification) that the object was presented for signature at the indicated time.</span></span>

<span data-ttu-id="a656e-124">下列所實行之時間戳記的副署方法，即使簽署憑證已過期或已撤銷，也可以驗證簽章。</span><span class="sxs-lookup"><span data-stu-id="a656e-124">The countersignature method of time stamping implemented below allows for signatures to be verified even after the signing certificate has expired or been revoked.</span></span> <span data-ttu-id="a656e-125">時間戳記可讓驗證器可靠地知道簽署簽章的時間，並藉此在當時有效時信任簽章。</span><span class="sxs-lookup"><span data-stu-id="a656e-125">The time stamp allows the verifier to reliably know the time that the signature was affixed and thereby trust the signature if it was valid at that time.</span></span> <span data-ttu-id="a656e-126">時間戳記程式應該有可靠且受保護的時間來源。</span><span class="sxs-lookup"><span data-stu-id="a656e-126">The time stamper should have a reliable and protected time source.</span></span>

## <a name="pkcs-7-signed-documents-and-countersignatures"></a><span data-ttu-id="a656e-127">PKCS \# 7 簽署的檔和副署</span><span class="sxs-lookup"><span data-stu-id="a656e-127">PKCS \#7 Signed Documents and Countersignatures</span></span>

<span data-ttu-id="a656e-128">PKCS \# 7 是密碼編譯資料的標準格式，包括簽署的資料、憑證，以及 (crl) 的 [*憑證撤銷清單*](../secgloss/c-gly.md) 。</span><span class="sxs-lookup"><span data-stu-id="a656e-128">PKCS \#7 is a standard format for cryptographic data, including signed data, certificates, and [*certificate revocation lists*](../secgloss/c-gly.md) (CRLs).</span></span> <span data-ttu-id="a656e-129">\#時間戳記內容中的特定 PKCS 7 類型是簽署的資料，對應至 PKCS \# 7 定義的 [**SignedData**](signeddata.md)內容類型。</span><span class="sxs-lookup"><span data-stu-id="a656e-129">The particular PKCS \#7 type of interest in the context of time stamping is signed data, corresponding to the PKCS \#7 defined [**SignedData**](signeddata.md) content type.</span></span>

<span data-ttu-id="a656e-130">PKCS \# 7 套件包含可識別實際內容的 [**SignedData**](signeddata.md) ，以及有關它和 SignerInfo 簽章區塊的特定資訊。</span><span class="sxs-lookup"><span data-stu-id="a656e-130">The PKCS \#7 package consists of [**SignedData**](signeddata.md) that identifies the actual content and certain information about it and SignerInfo signature blocks.</span></span> <span data-ttu-id="a656e-131">SignerInfo 本身可能包含副署，以遞迴方式為另一個 SignerInfo。</span><span class="sxs-lookup"><span data-stu-id="a656e-131">A SignerInfo may itself contain a countersignature, which recursively is another SignerInfo.</span></span> <span data-ttu-id="a656e-132">在主體中，可能會有這類副署的順序。</span><span class="sxs-lookup"><span data-stu-id="a656e-132">In principle, a sequence of such countersignatures may be present.</span></span> <span data-ttu-id="a656e-133">副署是與 SignerInfo 中簽章相關的未經驗證屬性;亦即，它可能會在原始簽章的後面貼上。</span><span class="sxs-lookup"><span data-stu-id="a656e-133">The countersignature is an unauthenticated attribute with respect to the signature in the SignerInfo; that is, it may be affixed subsequent to the original signature.</span></span> <span data-ttu-id="a656e-134">以大綱形式：</span><span class="sxs-lookup"><span data-stu-id="a656e-134">In outline form:</span></span>

<span data-ttu-id="a656e-135">[**SignedData**](signeddata.md) (PKCS \# 7) </span><span class="sxs-lookup"><span data-stu-id="a656e-135">[**SignedData**](signeddata.md) (PKCS \#7)</span></span>

-   <span data-ttu-id="a656e-136">PKCS 7 的版本 (\# ，通常是第1版) </span><span class="sxs-lookup"><span data-stu-id="a656e-136">Version (of PKCS \#7, generally version 1)</span></span>
-   <span data-ttu-id="a656e-137">DigestAlgorithms SignerInfo 簽章區塊所使用的所有演算法的 (集合，以進行優化處理) </span><span class="sxs-lookup"><span data-stu-id="a656e-137">DigestAlgorithms (collection of all algorithms used by SignerInfo signature blocks, for optimized processing)</span></span>
-   <span data-ttu-id="a656e-138">ContentInfo (contentType 等於 [**SignedData**](signeddata.md)，加上內容或內容的參考) </span><span class="sxs-lookup"><span data-stu-id="a656e-138">ContentInfo (contentType equals [**SignedData**](signeddata.md), plus content or reference to content)</span></span>
-   <span data-ttu-id="a656e-139">選用的憑證 (所有使用的憑證集合) </span><span class="sxs-lookup"><span data-stu-id="a656e-139">OPTIONAL Certificates (collection of all certificates used)</span></span>
-   <span data-ttu-id="a656e-140">選用 Crl (所有 Crl 的集合) </span><span class="sxs-lookup"><span data-stu-id="a656e-140">OPTIONAL CRLs (collection of all CRLs)</span></span>
-   <span data-ttu-id="a656e-141">SignerInfo 簽章區塊 (實際的簽章，由一或多個 SignerInfo 簽章區塊所組成) </span><span class="sxs-lookup"><span data-stu-id="a656e-141">SignerInfo signature blocks (the actual signature, composed of one or more SignerInfo signature blocks)</span></span>

<span data-ttu-id="a656e-142">SignerInfo (簽章區塊) </span><span class="sxs-lookup"><span data-stu-id="a656e-142">SignerInfo (the signature block)</span></span>

-   <span data-ttu-id="a656e-143">PKCS 7 的版本 (\# ，通常是第1版) </span><span class="sxs-lookup"><span data-stu-id="a656e-143">Version (of PKCS \#7, generally version 1)</span></span>
-   <span data-ttu-id="a656e-144">憑證 (簽發者和序號來唯一識別簽署者在 [**SignedData**](signeddata.md) 中的憑證) </span><span class="sxs-lookup"><span data-stu-id="a656e-144">Certificate (issuer and serial number to uniquely identify of signer's certificate in [**SignedData**](signeddata.md))</span></span>
-   <span data-ttu-id="a656e-145">DigestAlgorithm 加上 DigestEncryptionAlgorithm 加上摘要 (雜湊) ，再加上 EncryptedDigest (實際的簽章) </span><span class="sxs-lookup"><span data-stu-id="a656e-145">DigestAlgorithm plus the DigestEncryptionAlgorithm plus the Digest (hash), plus the EncryptedDigest (actual signature)</span></span>
-   <span data-ttu-id="a656e-146">選擇性 AuthenticatedAttributes (例如，由這個簽署者簽署) </span><span class="sxs-lookup"><span data-stu-id="a656e-146">OPTIONAL AuthenticatedAttributes (for example, signed by this signer)</span></span>
-   <span data-ttu-id="a656e-147">選擇性 UnauthenticatedAttributes (例如，此簽署者未簽署) </span><span class="sxs-lookup"><span data-stu-id="a656e-147">OPTIONAL UnauthenticatedAttributes (for example, not signed by this signer)</span></span>

<span data-ttu-id="a656e-148">驗證屬性的範例是 (OID 1.2.840.113549.1.9.5) 的簽署時間，因為它是時間戳記服務簽署的一部分。</span><span class="sxs-lookup"><span data-stu-id="a656e-148">An example of an authenticated attribute is the signing time (OID 1.2.840.113549.1.9.5) because it is part of what the time stamp service signs.</span></span> <span data-ttu-id="a656e-149">未經驗證的屬性範例是「副署 (OID 1.2.840.113549.1.9.6) ，因為它可以在簽署後貼上。</span><span class="sxs-lookup"><span data-stu-id="a656e-149">An example of an unauthenticated attribute is the countersignature (OID 1.2.840.113549.1.9.6) because it can be affixed after signing.</span></span> <span data-ttu-id="a656e-150">在此情況下，SignerInfo 本身會包含 SignerInfo (副署) 。</span><span class="sxs-lookup"><span data-stu-id="a656e-150">In this case, the SignerInfo itself contains a SignerInfo (the Countersignature).</span></span>

> [!Note]  
> <span data-ttu-id="a656e-151">在副署中簽署的物件是原始的簽章 (也就是原始 SignerInfo) 的 EncryptedDigest。</span><span class="sxs-lookup"><span data-stu-id="a656e-151">The object that is signed in the countersignature is the original signature (that is, the EncryptedDigest of the original SignerInfo).</span></span>

 

## <a name="signtool-and-the-authenticode-process"></a><span data-ttu-id="a656e-152">SignTool 和 Authenticode 流程</span><span class="sxs-lookup"><span data-stu-id="a656e-152">SignTool and the Authenticode Process</span></span>

<span data-ttu-id="a656e-153">[SignTool](signtool.md) 適用于 Authenticode 簽署和時間戳記的二進位資料。</span><span class="sxs-lookup"><span data-stu-id="a656e-153">[SignTool](signtool.md) is available for Authenticode signing and time stamping binary data.</span></span> <span data-ttu-id="a656e-154">此工具會安裝在 \\ Microsoft Windows 軟體開發套件 (SDK) 安裝路徑的 Bin 資料夾中。</span><span class="sxs-lookup"><span data-stu-id="a656e-154">The tool is installed in the \\Bin folder of the Microsoft Windows Software Development Kit (SDK) installation path.</span></span>

<span data-ttu-id="a656e-155">簽署和時間戳記的二進位資料在使用 [SignTool](signtool.md)時相當簡單。</span><span class="sxs-lookup"><span data-stu-id="a656e-155">Signing and time stamping binary data is relatively straightforward using [SignTool](signtool.md).</span></span> <span data-ttu-id="a656e-156">發行者必須從商務程式碼簽署 CA 取得程式碼簽署憑證。</span><span class="sxs-lookup"><span data-stu-id="a656e-156">The publisher must get a code signing certificate from a commercial code signing CA.</span></span> <span data-ttu-id="a656e-157">為了方便起見，Microsoft 會發佈並更新公用 Ca 清單，包括發出 Authenticode 憑證的 Ca。</span><span class="sxs-lookup"><span data-stu-id="a656e-157">For convenience, Microsoft publishes and updates a list of public CAs, including those that issue Authenticode certificates.</span></span> <span data-ttu-id="a656e-158">準備發行時，會使用適當的命令列參數搭配 SignTool 工具來簽署物件檔案和時間戳記。</span><span class="sxs-lookup"><span data-stu-id="a656e-158">When ready to publish, the object files are signed and time stamped using appropriate command line parameters with the SignTool tool.</span></span> <span data-ttu-id="a656e-159">任何 SignTool 作業的結果一律是 PKCS \# 7 格式 [**SignedData**](signeddata.md)。</span><span class="sxs-lookup"><span data-stu-id="a656e-159">The result of any SignTool operation is always a PKCS \#7 format [**SignedData**](signeddata.md).</span></span>

<span data-ttu-id="a656e-160">SignTool 會接受要簽署的原始二進位資料和時間戳記，或先前帶正負號的二進位資料要加上時間戳記。</span><span class="sxs-lookup"><span data-stu-id="a656e-160">SignTool accepts as input either raw binary data to be signed and time stamped, or previously signed binary data to be time stamped.</span></span> <span data-ttu-id="a656e-161">先前已簽署的資料可以使用 **signtool timestamp** 命令來加上時間戳記。</span><span class="sxs-lookup"><span data-stu-id="a656e-161">Data that has previously been signed can be time stamped by using the **signtool timestamp** command.</span></span>



| <span data-ttu-id="a656e-162">引數</span><span class="sxs-lookup"><span data-stu-id="a656e-162">Argument</span></span>             | <span data-ttu-id="a656e-163">描述</span><span class="sxs-lookup"><span data-stu-id="a656e-163">Description</span></span>                                                                                                                                                                                                    |
|----------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="a656e-164">**/T** *HTTPAddress*</span><span class="sxs-lookup"><span data-stu-id="a656e-164">**/t** *HTTPAddress*</span></span> | <span data-ttu-id="a656e-165">指出檔案是加上時間戳記。</span><span class="sxs-lookup"><span data-stu-id="a656e-165">Indicates that the file is to be time stamped.</span></span> <span data-ttu-id="a656e-166">指定必須提供時間戳記伺服器位址的 URL。</span><span class="sxs-lookup"><span data-stu-id="a656e-166">A URL that specifies an address of a time stamping server must be provided.</span></span> <span data-ttu-id="a656e-167">**/t** 可搭配 **signtool sign** 和 **signtool timestamp** 命令使用。</span><span class="sxs-lookup"><span data-stu-id="a656e-167">**/t** can be used with both **signtool sign** and **signtool timestamp** commands.</span></span> |



 

<span data-ttu-id="a656e-168">如需有關在此內容中可能有用之工具的詳細資訊，請參閱 [加密工具](cryptography-tools.md) 和 [SignTool](signtool.md)。</span><span class="sxs-lookup"><span data-stu-id="a656e-168">For more information about tools that may be useful in this context, see [Cryptography Tools](cryptography-tools.md) and [SignTool](signtool.md).</span></span>

## <a name="implementation-details-and-wire-format"></a><span data-ttu-id="a656e-169">執行詳細資料和電傳格式</span><span class="sxs-lookup"><span data-stu-id="a656e-169">Implementation Details and Wire Format</span></span>

<span data-ttu-id="a656e-170">[SignTool](signtool.md) 依賴 Windows Authenticode 實行來建立和時間戳記簽章。</span><span class="sxs-lookup"><span data-stu-id="a656e-170">[SignTool](signtool.md) relies on the Windows Authenticode implementation to create and time stamp signatures.</span></span> <span data-ttu-id="a656e-171">[*Authenticode*](../secgloss/a-gly.md) 會在二進位檔案上運作，例如 .cab、.exe、.dll 或 .ocx。</span><span class="sxs-lookup"><span data-stu-id="a656e-171">[*Authenticode*](../secgloss/a-gly.md) operates on binary files, for example .cab, .exe, .dll, or .ocx.</span></span> <span data-ttu-id="a656e-172">Authenticode 會先建立簽章，產生 PKCS \# 7 [**SignedData**](signeddata.md)。</span><span class="sxs-lookup"><span data-stu-id="a656e-172">Authenticode first creates the signature, producing a PKCS \#7 [**SignedData**](signeddata.md).</span></span> <span data-ttu-id="a656e-173">這是必須副署的 **SignedData** ，如 PKCS 9 所述 \# 。</span><span class="sxs-lookup"><span data-stu-id="a656e-173">It is this **SignedData** that must be countersigned, as described in PKCS \#9.</span></span>

<span data-ttu-id="a656e-174">副署進程會以四個步驟進行：</span><span class="sxs-lookup"><span data-stu-id="a656e-174">The countersignature process takes place in four steps:</span></span>

1.  <span data-ttu-id="a656e-175">從 PKCS 7 SignedData 的 SignerInfo 中複製簽章 (也就是 encryptedDigest) \# 。 [](signeddata.md)</span><span class="sxs-lookup"><span data-stu-id="a656e-175">Copy the signature (that is, the encryptedDigest) from the SignerInfo of the PKCS \#7 [**SignedData**](signeddata.md).</span></span>
2.  <span data-ttu-id="a656e-176">建立其內容為原始簽章的時間戳記要求。</span><span class="sxs-lookup"><span data-stu-id="a656e-176">Construct a time stamp request whose content is the original signature.</span></span> <span data-ttu-id="a656e-177">將此傳送到時間戳記伺服器 [*抽象語法標記法 (一)*](../secgloss/a-gly.md) (asn.1) 編碼為 TimeStampRequest。</span><span class="sxs-lookup"><span data-stu-id="a656e-177">Send this to the time stamp server [*Abstract Syntax Notation One*](../secgloss/a-gly.md) (ASN.1) encoded as a TimeStampRequest.</span></span>
3.  <span data-ttu-id="a656e-178">接收時間戳記伺服器所傳回的時間戳記，格式為第二個 PKCS \# 7 [**SignedData**](signeddata.md)。</span><span class="sxs-lookup"><span data-stu-id="a656e-178">Receive a time stamp, formatted as a second PKCS \#7 [**SignedData**](signeddata.md), returned from the time stamp server.</span></span>
4.  <span data-ttu-id="a656e-179">將 SignerInfo 從時間戳記直接複製到原始 PKCS \# 7 [**SignedData**](signeddata.md)，如 PKCS \# 9 副署 (也就是在原始) 的 SignerInfo 中未經驗證的屬性。</span><span class="sxs-lookup"><span data-stu-id="a656e-179">Copy the SignerInfo from the time stamp directly into the original PKCS \#7 [**SignedData**](signeddata.md), as a PKCS \#9 countersignature (that is, an unauthenticated attribute in the SignerInfo of the original).</span></span>

## <a name="time-stamp-request"></a><span data-ttu-id="a656e-180">時間戳記要求</span><span class="sxs-lookup"><span data-stu-id="a656e-180">Time Stamp Request</span></span>

<span data-ttu-id="a656e-181">時間戳記要求會在 HTTP 1.1 POST 訊息中傳送。</span><span class="sxs-lookup"><span data-stu-id="a656e-181">The time stamp request is sent within an HTTP 1.1 POST message.</span></span> <span data-ttu-id="a656e-182">在 HTTP 標頭中，CacheControl 指示詞設定為 [無快取]，並將 [Content-type] 指示詞設定為 [應用程式/八位資料流程]。</span><span class="sxs-lookup"><span data-stu-id="a656e-182">In the HTTP header, the CacheControl directive is set to no-cache, and the Content-Type directive is set to application/octet-stream.</span></span> <span data-ttu-id="a656e-183">HTTP 訊息的本文是 [*可辨別編碼規則*](../secgloss/d-gly.md) 的 base64 編碼， (DER) 時間戳記要求的編碼方式。</span><span class="sxs-lookup"><span data-stu-id="a656e-183">The body of the HTTP message is a base64 encoding of [*Distinguished Encoding Rules*](../secgloss/d-gly.md) (DER) encoding of the time stamp request.</span></span>

<span data-ttu-id="a656e-184">雖然目前未使用，但內容長度指示詞也應該用於建立 HTTP 訊息，因為它可協助時間戳記伺服器找出要求在 HTTP POST 內的位置。</span><span class="sxs-lookup"><span data-stu-id="a656e-184">Although not currently used, the Content-Length directive should also be used in constructing the HTTP message because it helps the time stamp server locate where the request is within the HTTP POST.</span></span>

<span data-ttu-id="a656e-185">其他 HTTP 標頭也可能存在，如果要求者或時間戳記伺服器無法理解這些標頭，則應該予以忽略。</span><span class="sxs-lookup"><span data-stu-id="a656e-185">Other HTTP headers may also be present and should be ignored if they are not understood by the requestor or time stamp server.</span></span>

<span data-ttu-id="a656e-186">時間戳記要求是一種 asn.1 編碼訊息。</span><span class="sxs-lookup"><span data-stu-id="a656e-186">The time stamp request is an ASN.1 encoded message.</span></span> <span data-ttu-id="a656e-187">要求的格式如下所示。</span><span class="sxs-lookup"><span data-stu-id="a656e-187">The format of the request is as follows.</span></span>

``` syntax
TimeStampRequest ::= SEQUENCE {
   countersignatureType OBJECT IDENTIFIER,
   attributes Attributes OPTIONAL, 
   content  ContentInfo
}
```

<span data-ttu-id="a656e-188">CountersignatureType 是 (OID) 的 [*物件識別碼*](../secgloss/o-gly.md) ，可將此識別碼識別為時間戳記副署，而且應該是確切的 OID 1.3.6.1.4.1.311.3.2.1。</span><span class="sxs-lookup"><span data-stu-id="a656e-188">The countersignatureType is the [*object identifier*](../secgloss/o-gly.md) (OID) that identifies this as a time stamp countersignature and should be the exact OID 1.3.6.1.4.1.311.3.2.1.</span></span>

<span data-ttu-id="a656e-189">時間戳記要求中目前未包含任何屬性。</span><span class="sxs-lookup"><span data-stu-id="a656e-189">No attributes are currently included in the time stamp request.</span></span>

<span data-ttu-id="a656e-190">內容是由 PKCS 7 所定義的 ContentInfo \# 。</span><span class="sxs-lookup"><span data-stu-id="a656e-190">The content is a ContentInfo as defined by PKCS \#7.</span></span> <span data-ttu-id="a656e-191">內容是要簽署的資料。</span><span class="sxs-lookup"><span data-stu-id="a656e-191">The content is the data to be signed.</span></span> <span data-ttu-id="a656e-192">針對簽章時間戳記，ContentType 應該是資料，而內容應該是 encryptedDigest (簽章) 從 PKCS 7 內容的 SignerInfo，再加上 \# 時間戳記。</span><span class="sxs-lookup"><span data-stu-id="a656e-192">For signature time stamping, the ContentType should be Data, and the content should be the encryptedDigest (signature) from the SignerInfo of the PKCS \#7 content to be time stamped.</span></span>

## <a name="time-stamp-response"></a><span data-ttu-id="a656e-193">時間戳記回應</span><span class="sxs-lookup"><span data-stu-id="a656e-193">Time Stamp Response</span></span>

<span data-ttu-id="a656e-194">時間戳記回應也會在 HTTP 1.1 訊息中傳送。</span><span class="sxs-lookup"><span data-stu-id="a656e-194">The time stamp response is also sent within an HTTP 1.1 message.</span></span> <span data-ttu-id="a656e-195">在 HTTP 標頭中，Content-type 指示詞也會設定為 application/八進位-stream。</span><span class="sxs-lookup"><span data-stu-id="a656e-195">In the HTTP header, the Content-Type directive is also set to application/octet-stream.</span></span> <span data-ttu-id="a656e-196">HTTP 訊息的本文是一種 base64 編碼的時間戳記回應的 DER 編碼。</span><span class="sxs-lookup"><span data-stu-id="a656e-196">The body of the HTTP message is a base64 encoding of DER encoding of the time stamp response.</span></span>

<span data-ttu-id="a656e-197">時間戳記回應是 \# 由時間戳記程式所簽署的 PKCS 7 簽署訊息。</span><span class="sxs-lookup"><span data-stu-id="a656e-197">The time stamp response is a PKCS \#7 signed message signed by the time stamper.</span></span> <span data-ttu-id="a656e-198">PKCS 7 訊息的 ContentInfo 與 \# 時間戳記中收到的 ContentInfo 相同。</span><span class="sxs-lookup"><span data-stu-id="a656e-198">The ContentInfo of the PKCS \#7 message is identical to the ContentInfo received in the time stamp.</span></span> <span data-ttu-id="a656e-199">PKCS \# 7 內容包含「簽署時間驗證」屬性 (在 PKCS \# 99、OID 1.2.840.113549.9.5) 中定義。</span><span class="sxs-lookup"><span data-stu-id="a656e-199">The PKCS \#7 content contains the signing time authenticated attribute (defined in PKCS \#99, OID 1.2.840.113549.9.5).</span></span>

<span data-ttu-id="a656e-200">在 Authenticode 從伺服器接收時間戳記之後，Authenticode 會將時間戳記併入原始 PKCS \# 7 [**SignedData**](signeddata.md) 中作為副署。</span><span class="sxs-lookup"><span data-stu-id="a656e-200">After Authenticode receives the time stamp from the server, Authenticode incorporates the time stamp into the original PKCS \#7 [**SignedData**](signeddata.md) as a countersignature.</span></span> <span data-ttu-id="a656e-201">為了達成此目的，會捨棄傳回之 PKCS \# 7 **SignedData** 的 ContentInfo，並將傳回時間戳記的 SignerInfo 複製到原始 PKCS 7 SignedData SignerInfo 中的副署 \# 。 </span><span class="sxs-lookup"><span data-stu-id="a656e-201">To accomplish this, the ContentInfo of the returned PKCS \#7 **SignedData** is discarded, and the SignerInfo of the returned time stamp is copied as a countersignature into the SignerInfo of the original PKCS \#7 **SignedData**.</span></span> <span data-ttu-id="a656e-202">時間戳記程式的憑證鏈也會複製到原始 PKCS 7 SignedData 中的憑證 \# ， 做為原始簽署者未經驗證的屬性。</span><span class="sxs-lookup"><span data-stu-id="a656e-202">The certificate chain of the time stamper is also copied into Certificates in the original PKCS \#7 **SignedData** as an unauthenticated attribute of the original signer.</span></span>

<span data-ttu-id="a656e-203">如需有關 PKCS 和其他安全性主體的詳細資訊，請參閱 [RSA 網站的內容庫](https://www.rsa.com/content_library.aspx)。</span><span class="sxs-lookup"><span data-stu-id="a656e-203">For more information about PKCS and other security subjects, see the [content library of the RSA website](https://www.rsa.com/content_library.aspx).</span></span>

 

 
