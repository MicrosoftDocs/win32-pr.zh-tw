---
description: 從 x.509 憑證格式第3版開始，憑證可能會包含憑證延伸。
ms.assetid: fb106cab-8a61-4a83-8fb4-7c045d905575
title: 延伸模組處理常式
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cfcf1b47fcc97b87f5956f4584aee07acce04222
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "106978381"
---
# <a name="extension-handlers"></a><span data-ttu-id="1643f-103">延伸模組處理常式</span><span class="sxs-lookup"><span data-stu-id="1643f-103">Extension Handlers</span></span>

<span data-ttu-id="1643f-104">從 [*X.509*](../secgloss/x-gly.md) 憑證格式第3版開始，憑證可能會包含憑證延伸。</span><span class="sxs-lookup"><span data-stu-id="1643f-104">Beginning with [*X.509*](../secgloss/x-gly.md) Certificate format Version 3, a certificate may contain certificate extensions.</span></span> <span data-ttu-id="1643f-105"> (x.509 憑證的內容，請參閱 [憑證屬性](certificate-properties.md)。 ) 這些延伸模組表示其他資訊。</span><span class="sxs-lookup"><span data-stu-id="1643f-105">(For the contents of an X.509 Certificate, see [Certificate Properties](certificate-properties.md).) These extensions indicate additional information.</span></span> <span data-ttu-id="1643f-106">例如，延伸模組可以表示其他的主體識別資訊，也可以表示金鑰使用方式資訊，以指定可使用金鑰的 (例如簽章或加密) 。</span><span class="sxs-lookup"><span data-stu-id="1643f-106">For example, an extension can indicate additional subject identification information, or it can indicate key usage information, which specifies the tasks (such as signature or encryption) for which a key can be used.</span></span> <span data-ttu-id="1643f-107">針對應用程式使用定義了一組標準延伸模組，而且也可以自訂擴充功能。</span><span class="sxs-lookup"><span data-stu-id="1643f-107">A set of standard extensions is defined for application use, and extensions may also be customized.</span></span>

<span data-ttu-id="1643f-108">每個擴充功能都有相關聯的物件識別碼字串，可識別其他資訊的類型，以及包含這項資訊的資料結構。</span><span class="sxs-lookup"><span data-stu-id="1643f-108">Each extension has an associated object identifier string that identifies the type of additional information and a data structure that contains this information.</span></span> <span data-ttu-id="1643f-109">例如，金鑰使用方式物件識別碼為 "2.5.29.15"，表示金鑰使用方式資訊。</span><span class="sxs-lookup"><span data-stu-id="1643f-109">For example, the key usage object identifier is "2.5.29.15", which indicates key usage information.</span></span> <span data-ttu-id="1643f-110">其相關聯的資料結構是 [**CRYPT \_ 位 \_ BLOB (位**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_bit_blob)) 指定如何使用金鑰。</span><span class="sxs-lookup"><span data-stu-id="1643f-110">Its associated data structure is a [**CRYPT\_BIT\_BLOB**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_bit_blob) (bitfield) specifying how the key can be used.</span></span>

<span data-ttu-id="1643f-111">擴充功能可以在發行之前新增至憑證。</span><span class="sxs-lookup"><span data-stu-id="1643f-111">An extension can be added to a certificate before it is issued.</span></span> <span data-ttu-id="1643f-112">發出憑證時，任何啟用的延伸模組都是憑證的一部分。</span><span class="sxs-lookup"><span data-stu-id="1643f-112">When the certificate is issued, any enabled extensions are part of the certificate.</span></span> <span data-ttu-id="1643f-113">如果擴充功能標示為「重大」，則使用應用程式必須知道其使用方式，而且應用程式必須遵守延伸模組的意圖或值。</span><span class="sxs-lookup"><span data-stu-id="1643f-113">If an extension is marked critical, its use must be known by the using application, and the application must adhere to the intent or value of the extension.</span></span> <span data-ttu-id="1643f-114">憑證服務允許透過 [**ICertAdmin**](/windows/desktop/api/Certadm/nn-certadm-icertadmin) 和 [**ICertServerPolicy**](/windows/desktop/api/Certif/nn-certif-icertserverpolicy)所提供的方法，在非發行的憑證上設定延伸模組。</span><span class="sxs-lookup"><span data-stu-id="1643f-114">Certificate Services allows extensions to be set on a non-issued certificate through methods provided by [**ICertAdmin**](/windows/desktop/api/Certadm/nn-certadm-icertadmin) and [**ICertServerPolicy**](/windows/desktop/api/Certif/nn-certif-icertserverpolicy).</span></span> <span data-ttu-id="1643f-115">如需憑證延伸的詳細資訊，請參閱 CryptoAPI 檔中的憑證 [**\_ 延伸**](/windows/desktop/api/Wincrypt/ns-wincrypt-cert_extension) 。</span><span class="sxs-lookup"><span data-stu-id="1643f-115">For details about certificate extensions, see [**CERT\_EXTENSION**](/windows/desktop/api/Wincrypt/ns-wincrypt-cert_extension) in the CryptoAPI documentation.</span></span> <span data-ttu-id="1643f-116">如需一般憑證延伸模組資料結構的詳細資訊，請參閱 [X.509 憑證延伸結構](cryptography-structures.md)。</span><span class="sxs-lookup"><span data-stu-id="1643f-116">For information about common certificate extension data structures, see [X.509 Certificate Extension Structures](cryptography-structures.md).</span></span>

<span data-ttu-id="1643f-117">延伸模組處理常式是一個 COM 物件，它提供了更複雜但常用的延伸模組和資料類型（例如 IA5String 或 PrintableString）編碼的常式。</span><span class="sxs-lookup"><span data-stu-id="1643f-117">The extension handler is a COM object that provides routines for encoding the more complex, but commonly used extensions and data types, such as IA5String or PrintableString.</span></span>

<span data-ttu-id="1643f-118">具有 **DATE**、 **LONG** 和 **BSTR** 資料類型的延伸模組不需要擴充處理常式。</span><span class="sxs-lookup"><span data-stu-id="1643f-118">Extensions that have the data types **DATE**, **LONG**, and **BSTR** do not require an extension handler.</span></span> <span data-ttu-id="1643f-119">原則模組只會呼叫 [**ICertServerPolicy：： SetCertificateExtension**](/windows/desktop/api/Certif/nf-certif-icertserverpolicy-setcertificateextension) ，並將 *類型* 參數設定為代表延伸資料類型的值： PROPTYPE \_ DATE、PROPTYPE \_ LONG 或 PROPTYPE \_ STRING。</span><span class="sxs-lookup"><span data-stu-id="1643f-119">The policy module simply calls [**ICertServerPolicy::SetCertificateExtension**](/windows/desktop/api/Certif/nf-certif-icertserverpolicy-setcertificateextension) with the *Type* parameter set to a value representing the extension data type: PROPTYPE\_DATE, PROPTYPE\_LONG, or PROPTYPE\_STRING.</span></span> <span data-ttu-id="1643f-120">然後，它會將擴充傳遞給伺服器引擎。</span><span class="sxs-lookup"><span data-stu-id="1643f-120">It then passes the extension to the server engine.</span></span> <span data-ttu-id="1643f-121">伺服器引擎接著會執行 [*抽象語法標記法 (一)*](../secgloss/a-gly.md) (asn.1) 編碼，然後再將擴充功能儲存在憑證中。</span><span class="sxs-lookup"><span data-stu-id="1643f-121">The server engine, in turn, performs the [*Abstract Syntax Notation One*](../secgloss/a-gly.md) (ASN.1) encoding before storing the extension in the certificate.</span></span>

<span data-ttu-id="1643f-122">不過，具有非這些預設類型之資料類型的延伸模組必須是由擴充處理常式編碼的，然後原則模組才會將它們傳遞給伺服器引擎。</span><span class="sxs-lookup"><span data-stu-id="1643f-122">However, extensions that have data types other than these default types must be ASN.1 encoded by an extension handler before the policy module passes them to the server engine.</span></span> <span data-ttu-id="1643f-123">當原則模組呼叫 [**ICertServerPolicy：： SetCertificateExtension**](/windows/desktop/api/Certif/nf-certif-icertserverpolicy-setcertificateextension) 傳遞 asn.1 編碼的延伸至伺服器引擎時，它必須將 *型* 別參數設定為 PROPTYPE \_ BINARY。</span><span class="sxs-lookup"><span data-stu-id="1643f-123">When the policy module calls [**ICertServerPolicy::SetCertificateExtension**](/windows/desktop/api/Certif/nf-certif-icertserverpolicy-setcertificateextension) to pass an ASN.1-encoded extension to the server engine, it must set the *Type* parameter to PROPTYPE\_BINARY.</span></span> <span data-ttu-id="1643f-124">然後，伺服器引擎只會將此編碼的延伸模組儲存在憑證中。</span><span class="sxs-lookup"><span data-stu-id="1643f-124">The server engine then simply stores this encoded extension in the certificate.</span></span>

<span data-ttu-id="1643f-125">預設的擴充處理常式 Certenc.dll 會匯出許多 **ICertEncodeXXX** 介面，並且可由原則模組呼叫。</span><span class="sxs-lookup"><span data-stu-id="1643f-125">The default extension handler, Certenc.dll, exports a number of **ICertEncodeXXX** interfaces and can be called by the policy module.</span></span> <span data-ttu-id="1643f-126">必要的類型資訊也包含在平臺軟體發展工具組 (SDK) 提供的 Certencl.dll 中。</span><span class="sxs-lookup"><span data-stu-id="1643f-126">The necessary type information is also contained in Certencl.dll which is supplied in the Platform Software Development Kit (SDK).</span></span> <span data-ttu-id="1643f-127">每個介面都會提供 **編碼** 方法，以二進位格式傳回原則模組的 asn.1 編碼憑證延伸。</span><span class="sxs-lookup"><span data-stu-id="1643f-127">Each interface provides an **Encode** method that returns an ASN.1-encoded certificate extension to the policy module in a binary format.</span></span> <span data-ttu-id="1643f-128">然後，您可以藉由呼叫 [**ICertServerPolicy：： SetCertificateExtension**](/windows/desktop/api/Certif/nf-certif-icertserverpolicy-setcertificateextension) 方法，在憑證中設定延伸模組。</span><span class="sxs-lookup"><span data-stu-id="1643f-128">The policy module can then set the extension in a certificate by calling the [**ICertServerPolicy::SetCertificateExtension**](/windows/desktop/api/Certif/nf-certif-icertserverpolicy-setcertificateextension) method.</span></span>

<span data-ttu-id="1643f-129">如需詳細資訊，請參閱 [撰寫自訂延伸模組處理常式](writing-custom-extension-handlers.md)。</span><span class="sxs-lookup"><span data-stu-id="1643f-129">For more information, see [Writing Custom Extension Handlers](writing-custom-extension-handlers.md).</span></span>

 

 
