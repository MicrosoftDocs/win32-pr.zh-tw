---
description: 如何產生、取出和匯出 RSA/Schannel 金鑰。
ms.assetid: 3069232f-d016-4973-ae39-89b0e2a03cd7
title: RSA/Schannel 金鑰
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 93c9d23de40f32a499013928086ccb52fc1d1e67
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104511545"
---
# <a name="rsaschannel-keys"></a><span data-ttu-id="4e401-103">RSA/Schannel 金鑰</span><span class="sxs-lookup"><span data-stu-id="4e401-103">RSA/Schannel Keys</span></span>

## <a name="generating-and-retrieving-rsaschannel-keys"></a><span data-ttu-id="4e401-104">產生和取出 RSA/Schannel 金鑰</span><span class="sxs-lookup"><span data-stu-id="4e401-104">Generating and Retrieving RSA/Schannel Keys</span></span>

<span data-ttu-id="4e401-105">[*RSA*](../secgloss/r-gly.md) /您可以藉由呼叫 [**CryptGenKey**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptgenkey)函數來產生 [*Schannel*](../secgloss/s-gly.md)金鑰。</span><span class="sxs-lookup"><span data-stu-id="4e401-105">[*RSA*](../secgloss/r-gly.md)/[*Schannel*](../secgloss/s-gly.md) keys can be generated by calling the [**CryptGenKey**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptgenkey) function.</span></span> <span data-ttu-id="4e401-106">呼叫 **CryptGenKey** 需要在 \_ *Algid* 參數中傳遞的 KEYEXCHANGE 演算法識別碼。</span><span class="sxs-lookup"><span data-stu-id="4e401-106">The call to **CryptGenKey** requires an AT\_KEYEXCHANGE algorithm identifier passed in the *Algid* parameter.</span></span>

<span data-ttu-id="4e401-107">**產生 RSA/Schannel 公開/私密金鑰組**</span><span class="sxs-lookup"><span data-stu-id="4e401-107">**To generate an RSA/Schannel public/private key pair**</span></span>

1.  <span data-ttu-id="4e401-108">呼叫 [**CryptAcquireCoNtext**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptacquirecontexta) 函式，以取得 [Microsoft RSA/Schannel 密碼編譯提供者](microsoft-rsa-schannel-cryptographic-provider.md)的控制碼。</span><span class="sxs-lookup"><span data-stu-id="4e401-108">Call the [**CryptAcquireContext**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptacquirecontexta) function to get a handle to the [Microsoft RSA/Schannel Cryptographic Provider](microsoft-rsa-schannel-cryptographic-provider.md).</span></span>
2.  <span data-ttu-id="4e401-109">呼叫 [**CryptGenKey**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptgenkey) 函數來產生金鑰。</span><span class="sxs-lookup"><span data-stu-id="4e401-109">Call the [**CryptGenKey**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptgenkey) function to generate the keys.</span></span> <span data-ttu-id="4e401-110">\_必須針對 *Algid* 參數傳入 KEYEXCHANGE，而且 *dwFlags* 參數的上16位必須設定為所需的金鑰大小 (512 位) 。</span><span class="sxs-lookup"><span data-stu-id="4e401-110">AT\_KEYEXCHANGE must be passed in for the *Algid* parameter, and the upper 16 bits of the *dwFlags* parameter must be set to the desired key size (512 bits).</span></span> <span data-ttu-id="4e401-111">*HKey* 參數中會傳回 [**HCRYPTKEY**](hcryptkey.md)結構控制碼。</span><span class="sxs-lookup"><span data-stu-id="4e401-111">An [**HCRYPTKEY**](hcryptkey.md) structure handle is returned in the *hKey* parameter.</span></span>

<span data-ttu-id="4e401-112">**取出先前產生的 RSA/Schannel 使用者金鑰的指標**</span><span class="sxs-lookup"><span data-stu-id="4e401-112">**To retrieve a pointer to previously generated RSA/Schannel user keys**</span></span>

1.  <span data-ttu-id="4e401-113">呼叫 [**CryptAcquireCoNtext**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptacquirecontexta) 函式，以取得 [Microsoft RSA/Schannel 密碼編譯提供者](microsoft-rsa-schannel-cryptographic-provider.md)的控制碼。</span><span class="sxs-lookup"><span data-stu-id="4e401-113">Call the [**CryptAcquireContext**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptacquirecontexta) function to get a handle to the [Microsoft RSA/Schannel Cryptographic Provider](microsoft-rsa-schannel-cryptographic-provider.md).</span></span>
2.  <span data-ttu-id="4e401-114">呼叫 [**CryptGetUserKey**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptgetuserkey) 函數，並將 *dwKeySpec* 參數設定為 \_ KEYEXCHANGE。</span><span class="sxs-lookup"><span data-stu-id="4e401-114">Call the [**CryptGetUserKey**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptgetuserkey) function, with the *dwKeySpec* parameter set to AT\_KEYEXCHANGE.</span></span>

## <a name="exporting-rsaschannel-keys"></a><span data-ttu-id="4e401-115">匯出 RSA/Schannel 金鑰</span><span class="sxs-lookup"><span data-stu-id="4e401-115">Exporting RSA/Schannel Keys</span></span>

<span data-ttu-id="4e401-116">您可以將 [*主要金鑰*](../secgloss/m-gly.md)匯出至簡單的金鑰 BLOB 結構。</span><span class="sxs-lookup"><span data-stu-id="4e401-116">[*Master keys*](../secgloss/m-gly.md) can be exported into simple key BLOB structures.</span></span> <span data-ttu-id="4e401-117">這應該與匯出一般 [*RC4*](../secgloss/r-gly.md) 或 [*資料加密標準*](../secgloss/d-gly.md) (DES) [*大量加密金鑰*](../secgloss/b-gly.md)（如 [簡單金鑰 BLOB](https://www.bing.com/search?q=Simple+Key+BLOB)中所述）的相同方式執行。</span><span class="sxs-lookup"><span data-stu-id="4e401-117">This should be implemented the same way as the export of normal [*RC4*](../secgloss/r-gly.md) or [*Data Encryption Standard*](../secgloss/d-gly.md) (DES) [*bulk encryption keys*](../secgloss/b-gly.md), as described in [Simple Key BLOB](https://www.bing.com/search?q=Simple+Key+BLOB).</span></span> <span data-ttu-id="4e401-118">[**PUBLICKEYSTRUC**](/windows/desktop/api/Wincrypt/ns-wincrypt-publickeystruc)結構的 **aiKeyAlg** 成員會設定為主要金鑰 (CALG \_ PCT1 \_ MASTER、CALG \_ SSL2 \_ master、CALG \_ SSL3 \_ master 或 CALG \_ TLS1 \_ master) 的演算法識別碼。</span><span class="sxs-lookup"><span data-stu-id="4e401-118">The **aiKeyAlg** member of the [**PUBLICKEYSTRUC**](/windows/desktop/api/Wincrypt/ns-wincrypt-publickeystruc) structure is set to the algorithm identifier of the master key (CALG\_PCT1\_MASTER, CALG\_SSL2\_MASTER, CALG\_SSL3\_MASTER, or CALG\_TLS1\_MASTER).</span></span>

<span data-ttu-id="4e401-119">如果 [**CPExportKey**](https://www.bing.com/search?q=**CPExportKey**) 函式正在匯出 SSL2 主要金鑰，且 \_ \_ 已設定 CRYPT SSL2 FALLBACK 旗標，則為了協助防止版本復原攻擊，請將加密區塊 [*填補*](../secgloss/p-gly.md) 的前八個位元組設定為0x03，而不是亂數據。</span><span class="sxs-lookup"><span data-stu-id="4e401-119">If the [**CPExportKey**](https://www.bing.com/search?q=**CPExportKey**) function is exporting an SSL2 master key and the CRYPT\_SSL2\_FALLBACK flag is set, then, to help prevent version rollback attacks, set the first eight bytes of the encryption block [*padding*](../secgloss/p-gly.md) to 0x03 rather than to random data.</span></span>

<span data-ttu-id="4e401-120">如果在 [**CPExportKey**](https://www.bing.com/search?q=**CPExportKey**)函式的 *dwFlags* 參數中指定了 **CRYPT \_ DESTROYKEY** 常數，則 CSP 會在匯出金鑰之後終結機碼或金鑰控制碼。</span><span class="sxs-lookup"><span data-stu-id="4e401-120">If the **CRYPT\_DESTROYKEY** constant is specified in the *dwFlags* parameter of the [**CPExportKey**](https://www.bing.com/search?q=**CPExportKey**) function, the CSP destroys the key or key handle after exporting the key.</span></span> <span data-ttu-id="4e401-121">此旗標僅適用于不 [*透明的 blob*](../secgloss/o-gly.md)。</span><span class="sxs-lookup"><span data-stu-id="4e401-121">This flag is intended for use only with [*opaque BLOBs*](../secgloss/o-gly.md).</span></span>

 

 
