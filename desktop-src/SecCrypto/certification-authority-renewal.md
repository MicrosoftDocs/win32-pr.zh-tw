---
description: 憑證服務支援 (CA) 更新憑證授權單位單位。
ms.assetid: b6c76642-9a23-471e-af08-58e91d778f09
title: 憑證授權單位單位更新
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: de57cd16ae6fc4c90bfeea411a06efcb14d028b7
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "103943706"
---
# <a name="certification-authority-renewal"></a><span data-ttu-id="d9ef9-103">憑證授權單位單位更新</span><span class="sxs-lookup"><span data-stu-id="d9ef9-103">Certification Authority Renewal</span></span>

<span data-ttu-id="d9ef9-104">[*憑證服務*](../secgloss/c-gly.md) 支援 (CA) 更新 [*憑證授權單位*](../secgloss/c-gly.md) 單位。</span><span class="sxs-lookup"><span data-stu-id="d9ef9-104">[*Certificate Services*](../secgloss/c-gly.md) supports the renewal of a [*certification authority*](../secgloss/c-gly.md) (CA).</span></span> <span data-ttu-id="d9ef9-105">續約是簽發新憑證，讓 CA 將 CA 的存留期延長至其原始憑證的結束日期之外。</span><span class="sxs-lookup"><span data-stu-id="d9ef9-105">Renewal is the issuing of a new certificate for the CA to extend the CA's life beyond the end date of its original certificate.</span></span> <span data-ttu-id="d9ef9-106">您可以使用 [憑證授權單位單位] MMC 嵌入式管理單元中的工作來更新 CA，或使用 Certutil.exe 工具 (搭配 **-renewCert** 命令) 。</span><span class="sxs-lookup"><span data-stu-id="d9ef9-106">You can renew a CA as a task within the Certificate Authority MMC snap-in or by using the Certutil.exe tool (with the **-renewCert** command).</span></span>

<span data-ttu-id="d9ef9-107">每次更新都會產生新的 CA 憑證;不過，系統管理員可以產生新的公開/私密金鑰組，或重複使用 CA 憑證的現有公開/私密金鑰組。</span><span class="sxs-lookup"><span data-stu-id="d9ef9-107">Each renewal results in a new CA certificate; however, the administrator can either generate a new public/private key pair or reuse the existing public/private key pair for the CA certificate.</span></span> <span data-ttu-id="d9ef9-108">基於一致性和完整性，ca 憑證和 [*憑證撤銷清單*](../secgloss/c-gly.md) (CRL) ，在 ca 更新後才可供使用。</span><span class="sxs-lookup"><span data-stu-id="d9ef9-108">For consistency and integrity, CA certificates and [*certificate revocation lists*](../secgloss/c-gly.md) (CRL) issued by the CA before its renewal will be available after the CA has been renewed.</span></span> <span data-ttu-id="d9ef9-109">憑證服務會維護 CA 憑證、Crl 和金鑰的索引，使其可供使用。</span><span class="sxs-lookup"><span data-stu-id="d9ef9-109">To make these available, Certificate Services maintains an index of CA certificates, CRLs, and keys.</span></span>

<span data-ttu-id="d9ef9-110">在不同的 CA 更新作業期間，CA 憑證和 Crl 的索引和尾碼名稱如下所示。</span><span class="sxs-lookup"><span data-stu-id="d9ef9-110">The indexes and suffix names of CA certificates and CRLs during various CA renewal operations are as follows.</span></span>



| <span data-ttu-id="d9ef9-111">作業</span><span class="sxs-lookup"><span data-stu-id="d9ef9-111">Operation</span></span>                | <span data-ttu-id="d9ef9-112">CA 憑證索引</span><span class="sxs-lookup"><span data-stu-id="d9ef9-112">CA certificate index</span></span> | <span data-ttu-id="d9ef9-113">CA 憑證檔案名尾碼</span><span class="sxs-lookup"><span data-stu-id="d9ef9-113">CA certificate file name suffix</span></span> | <span data-ttu-id="d9ef9-114">CRL 和金鑰索引</span><span class="sxs-lookup"><span data-stu-id="d9ef9-114">CRL and key index</span></span> | <span data-ttu-id="d9ef9-115">CRL 和金鑰容器名稱尾碼</span><span class="sxs-lookup"><span data-stu-id="d9ef9-115">CRL and key container name suffix</span></span> |
|--------------------------|----------------------|---------------------------------|-------------------|-----------------------------------|
| <span data-ttu-id="d9ef9-116">原始 CA 安裝</span><span class="sxs-lookup"><span data-stu-id="d9ef9-116">Original CA installation</span></span> | <span data-ttu-id="d9ef9-117">0</span><span class="sxs-lookup"><span data-stu-id="d9ef9-117">0</span></span>                    | <span data-ttu-id="d9ef9-118">""</span><span class="sxs-lookup"><span data-stu-id="d9ef9-118">""</span></span>                              | <span data-ttu-id="d9ef9-119">0</span><span class="sxs-lookup"><span data-stu-id="d9ef9-119">0</span></span>                 | <span data-ttu-id="d9ef9-120">""</span><span class="sxs-lookup"><span data-stu-id="d9ef9-120">""</span></span>                                |
| <span data-ttu-id="d9ef9-121">以新的金鑰更新</span><span class="sxs-lookup"><span data-stu-id="d9ef9-121">Renewal with new key</span></span>     | <span data-ttu-id="d9ef9-122">1</span><span class="sxs-lookup"><span data-stu-id="d9ef9-122">1</span></span>                    | <span data-ttu-id="d9ef9-123">" (1) "</span><span class="sxs-lookup"><span data-stu-id="d9ef9-123">"(1)"</span></span>                           | <span data-ttu-id="d9ef9-124">1</span><span class="sxs-lookup"><span data-stu-id="d9ef9-124">1</span></span>                 | <span data-ttu-id="d9ef9-125">" (1) "</span><span class="sxs-lookup"><span data-stu-id="d9ef9-125">"(1)"</span></span>                             |
| <span data-ttu-id="d9ef9-126">續約重複使用金鑰</span><span class="sxs-lookup"><span data-stu-id="d9ef9-126">Renewal reusing key</span></span>      | <span data-ttu-id="d9ef9-127">2</span><span class="sxs-lookup"><span data-stu-id="d9ef9-127">2</span></span>                    | <span data-ttu-id="d9ef9-128">" (2) "</span><span class="sxs-lookup"><span data-stu-id="d9ef9-128">"(2)"</span></span>                           | <span data-ttu-id="d9ef9-129">1</span><span class="sxs-lookup"><span data-stu-id="d9ef9-129">1</span></span>                 | <span data-ttu-id="d9ef9-130">" (1) "</span><span class="sxs-lookup"><span data-stu-id="d9ef9-130">"(1)"</span></span>                             |
| <span data-ttu-id="d9ef9-131">續約重複使用金鑰</span><span class="sxs-lookup"><span data-stu-id="d9ef9-131">Renewal reusing key</span></span>      | <span data-ttu-id="d9ef9-132">3</span><span class="sxs-lookup"><span data-stu-id="d9ef9-132">3</span></span>                    | <span data-ttu-id="d9ef9-133">" (3) "</span><span class="sxs-lookup"><span data-stu-id="d9ef9-133">"(3)"</span></span>                           | <span data-ttu-id="d9ef9-134">1</span><span class="sxs-lookup"><span data-stu-id="d9ef9-134">1</span></span>                 | <span data-ttu-id="d9ef9-135">" (1) "</span><span class="sxs-lookup"><span data-stu-id="d9ef9-135">"(1)"</span></span>                             |
| <span data-ttu-id="d9ef9-136">以新的金鑰更新</span><span class="sxs-lookup"><span data-stu-id="d9ef9-136">Renewal with new key</span></span>     | <span data-ttu-id="d9ef9-137">4</span><span class="sxs-lookup"><span data-stu-id="d9ef9-137">4</span></span>                    | <span data-ttu-id="d9ef9-138">" (4) "</span><span class="sxs-lookup"><span data-stu-id="d9ef9-138">"(4)"</span></span>                           | <span data-ttu-id="d9ef9-139">4</span><span class="sxs-lookup"><span data-stu-id="d9ef9-139">4</span></span>                 | <span data-ttu-id="d9ef9-140">" (4) "</span><span class="sxs-lookup"><span data-stu-id="d9ef9-140">"(4)"</span></span>                             |
| <span data-ttu-id="d9ef9-141">續約重複使用金鑰</span><span class="sxs-lookup"><span data-stu-id="d9ef9-141">Renewal reusing key</span></span>      | <span data-ttu-id="d9ef9-142">5</span><span class="sxs-lookup"><span data-stu-id="d9ef9-142">5</span></span>                    | <span data-ttu-id="d9ef9-143">" (5) "</span><span class="sxs-lookup"><span data-stu-id="d9ef9-143">"(5)"</span></span>                           | <span data-ttu-id="d9ef9-144">4</span><span class="sxs-lookup"><span data-stu-id="d9ef9-144">4</span></span>                 | <span data-ttu-id="d9ef9-145">" (4) "</span><span class="sxs-lookup"><span data-stu-id="d9ef9-145">"(4)"</span></span>                             |
| <span data-ttu-id="d9ef9-146">以新的金鑰更新</span><span class="sxs-lookup"><span data-stu-id="d9ef9-146">Renewal with new key</span></span>     | <span data-ttu-id="d9ef9-147">6</span><span class="sxs-lookup"><span data-stu-id="d9ef9-147">6</span></span>                    | <span data-ttu-id="d9ef9-148">" (6) "</span><span class="sxs-lookup"><span data-stu-id="d9ef9-148">"(6)"</span></span>                           | <span data-ttu-id="d9ef9-149">6</span><span class="sxs-lookup"><span data-stu-id="d9ef9-149">6</span></span>                 | <span data-ttu-id="d9ef9-150">" (6) "</span><span class="sxs-lookup"><span data-stu-id="d9ef9-150">"(6)"</span></span>                             |
| <span data-ttu-id="d9ef9-151">續約重複使用金鑰</span><span class="sxs-lookup"><span data-stu-id="d9ef9-151">Renewal reusing key</span></span>      | <span data-ttu-id="d9ef9-152">7</span><span class="sxs-lookup"><span data-stu-id="d9ef9-152">7</span></span>                    | <span data-ttu-id="d9ef9-153">" (7) "</span><span class="sxs-lookup"><span data-stu-id="d9ef9-153">"(7)"</span></span>                           | <span data-ttu-id="d9ef9-154">6</span><span class="sxs-lookup"><span data-stu-id="d9ef9-154">6</span></span>                 | <span data-ttu-id="d9ef9-155">" (6) "</span><span class="sxs-lookup"><span data-stu-id="d9ef9-155">"(6)"</span></span>                             |



 

<span data-ttu-id="d9ef9-156">安裝 CA 時，憑證索引為零，且憑證尾碼為 "" (空的字串) 。</span><span class="sxs-lookup"><span data-stu-id="d9ef9-156">When a CA is installed, the certificate index is zero and the certificate suffix is "" (an empty string).</span></span> <span data-ttu-id="d9ef9-157">每次更新憑證時 (是否重複使用金鑰) ，憑證索引會以1遞增，而憑證檔案名尾碼會變成 " (*n*) " 格式的字串，其中 *n* 代表已更新 CA 憑證的次數。</span><span class="sxs-lookup"><span data-stu-id="d9ef9-157">Each time the certificate is renewed (whether or not keys are reused), the certificate index is incremented by one, and the certificate file name suffix becomes a string of the form "(*n*)", where *n* represents the number of times the CA certificate has been renewed.</span></span> <span data-ttu-id="d9ef9-158">第一次更新之後，憑證索引為1，憑證檔案名尾碼為 " (1) "。</span><span class="sxs-lookup"><span data-stu-id="d9ef9-158">After the first renewal, the certificate index is 1 and the certificate file name suffix is "(1)".</span></span> <span data-ttu-id="d9ef9-159">第二次更新之後，憑證索引為2，憑證檔案名尾碼為 " (2) " 等等。</span><span class="sxs-lookup"><span data-stu-id="d9ef9-159">After the second renewal, the certificate index is 2 and the certificate file name suffix is "(2)", and so on.</span></span>

<span data-ttu-id="d9ef9-160">雖然 CA 憑證索引和尾碼會在每次更新 CA 時遞增一次，但只有在更新程式封裝含新的公開/私密金鑰組時，才會將 CRL 和金鑰索引和檔案名尾碼設定為 CA 憑證索引。</span><span class="sxs-lookup"><span data-stu-id="d9ef9-160">Although the CA certificate index and suffix are incremented by one each time the CA is renewed, the CRL and key indexes and the file name suffixes are set to the CA certificate index only if the renewal process includes a new public/private key pair.</span></span> <span data-ttu-id="d9ef9-161">如果沒有，這些索引和尾碼的值會維持與最後一個索引相同。</span><span class="sxs-lookup"><span data-stu-id="d9ef9-161">If it does not, the values of these indexes and suffixes remain the same as they were for the last index.</span></span> <span data-ttu-id="d9ef9-162">在更新期間，系統管理員會指定是否要產生新的金鑰組，或使用現有的金鑰組。</span><span class="sxs-lookup"><span data-stu-id="d9ef9-162">During renewal, an administrator specifies whether a new key pair is generated or the existing key pair is used.</span></span> <span data-ttu-id="d9ef9-163"> (在 [憑證授權單位單位] MMC 嵌入式管理單元中，使用者介面中的選項會指定新的或現有的金鑰組;在 Certutil.exe 工具中，命令 **certutil-renewCert** 會使用新的金鑰組來更新 ca，而 **renewCert ReuseKeys** 會以現有的金鑰組更新 ca。 ) </span><span class="sxs-lookup"><span data-stu-id="d9ef9-163">(In the Certificate Authority MMC snap-in, an option in the user interface specifies a new or an existing key pair; in the Certutil.exe tool, the command **certutil -renewCert** renews the CA with a new key pair, while the command **certutil -renewCert ReuseKeys** renews the CA with the existing key pair.)</span></span>

<span data-ttu-id="d9ef9-164">CRL 索引直接系結至索引鍵索引，只有在新的金鑰組用於更新時，才會設定為 CA 憑證索引。</span><span class="sxs-lookup"><span data-stu-id="d9ef9-164">The CRL index is directly tied to the key index, which is set to the CA certificate index only when a new key pair is used for the renewal.</span></span> <span data-ttu-id="d9ef9-165">在第一次更新 (使用新的金鑰組) 之後，CRL 和金鑰的索引會設定為1，且 CRL 和金鑰容器名稱尾碼為 " (1) "。</span><span class="sxs-lookup"><span data-stu-id="d9ef9-165">After the first renewal (which used a new key pair), the index of the CRL and key is set to 1, and the CRL and key container name suffix is "(1)".</span></span> <span data-ttu-id="d9ef9-166">不過，在第二次更新之後，CRL 和金鑰的索引會維持為1，而且 CRL 和金鑰容器名稱尾碼也會維持「 (1) 」;這是因為第二個更新使用現有的金鑰組，而且每個 CA 金鑰組只會發出一個 CRL。</span><span class="sxs-lookup"><span data-stu-id="d9ef9-166">After the second renewal, however, the index of the CRL and key remains 1, and the CRL and key container name suffix also remains "(1)"; this is because the second renewal used the existing key pair and only one CRL is issued for each CA key pair.</span></span>

<span data-ttu-id="d9ef9-167">您可以藉由呼叫 [**ICertServerExit**](/windows/desktop/api/Certif/nn-certif-icertserverexit)和 [**ICertServerPolicy**](/windows/desktop/api/Certif/nn-certif-icertserverpolicy)介面中的 **GetCertificateProperty** 方法 (，來取得已編制索引的 CA 憑證和 crl) 。</span><span class="sxs-lookup"><span data-stu-id="d9ef9-167">You can retrieve the indexed CA certificates and CRLs by calling the **GetCertificateProperty** method (in both the [**ICertServerExit**](/windows/desktop/api/Certif/nn-certif-icertserverexit) and [**ICertServerPolicy**](/windows/desktop/api/Certif/nn-certif-icertserverpolicy) interfaces).</span></span> <span data-ttu-id="d9ef9-168">當您取得與 CA 憑證或 CRL 相關的特定屬性時，您可以將 CA 憑證的以零為基底的索引附加至屬性名稱。</span><span class="sxs-lookup"><span data-stu-id="d9ef9-168">When you retrieve certain properties related to the CA certificate or CRL, you can append the CA certificate's zero-based index to the property names.</span></span> <span data-ttu-id="d9ef9-169">例如，若要取得對應至 CA 第三個憑證的 CRL 索引，請將 "CRLIndex" 屬性傳遞至 [**ICertServerPolicy：： GetCertificateProperty**](/windows/desktop/api/Certif/nf-certif-icertserverpolicy-getcertificateproperty);若為數據表，則抓取的 "CRLIndex. 2" 屬性值會是1。</span><span class="sxs-lookup"><span data-stu-id="d9ef9-169">For example, to retrieve the CRL index that corresponds to the CA's third certificate, pass the property "CRLIndex.2" to [**ICertServerPolicy::GetCertificateProperty**](/windows/desktop/api/Certif/nf-certif-icertserverpolicy-getcertificateproperty); for the table, the retrieved "CRLIndex.2" property value would be 1.</span></span> <span data-ttu-id="d9ef9-170">名為 "CertCount" 的屬性可以用來判斷 CA 已發出 CA 憑證的次數。</span><span class="sxs-lookup"><span data-stu-id="d9ef9-170">A property called "CertCount" can be used to determine the number of times the CA has been issued a CA certificate.</span></span>

<span data-ttu-id="d9ef9-171">CA 憑證和 Crl 包含的延伸模組可提供憑證和金鑰索引的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="d9ef9-171">CA certificates and CRLs contain an extension that provides information about the certificate and key index.</span></span> <span data-ttu-id="d9ef9-172">此延伸模組是在 Wincrypt 中定義為 szOID \_ CERTSRV \_ CA \_ 版本，其值為 "1.3.6.1.4.1.311.21.1"。</span><span class="sxs-lookup"><span data-stu-id="d9ef9-172">The extension is defined in Wincrypt.h as szOID\_CERTSRV\_CA\_VERSION with a value of "1.3.6.1.4.1.311.21.1".</span></span> <span data-ttu-id="d9ef9-173">延伸模組資料是 **DWORD** 值， (編碼為 \_ 延伸) 中的 X509 整數; 低16位是憑證索引，而高16位是索引鍵索引。</span><span class="sxs-lookup"><span data-stu-id="d9ef9-173">The extension data is a **DWORD** value (encoded as X509\_INTEGER in the extension); the low 16 bits are the certificate index, and the high 16 bits are the key index.</span></span>

<span data-ttu-id="d9ef9-174">CA 的初始安裝會產生零的憑證索引和索引鍵索引零。</span><span class="sxs-lookup"><span data-stu-id="d9ef9-174">The initial installation of a CA produces a certificate index of zero and a key index of zero.</span></span> <span data-ttu-id="d9ef9-175">更新 CA 憑證將會導致憑證索引遞增。</span><span class="sxs-lookup"><span data-stu-id="d9ef9-175">Renewal of a CA certificate will cause the certificate index to be incremented.</span></span> <span data-ttu-id="d9ef9-176">如果金鑰是在續約中重複使用，索引鍵索引會與先前的金鑰索引相同。</span><span class="sxs-lookup"><span data-stu-id="d9ef9-176">If the key is reused in the renewal, the key index will be the same as the previous key index.</span></span> <span data-ttu-id="d9ef9-177">如果未重複使用索引鍵，索引鍵索引會與新的憑證索引相符。</span><span class="sxs-lookup"><span data-stu-id="d9ef9-177">If the key is not reused, the key index will match the new certificate index.</span></span>

## <a name="related-topics"></a><span data-ttu-id="d9ef9-178">相關主題</span><span class="sxs-lookup"><span data-stu-id="d9ef9-178">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="d9ef9-179">**ICertServerPolicy::GetCertificateProperty**</span><span class="sxs-lookup"><span data-stu-id="d9ef9-179">**ICertServerPolicy::GetCertificateProperty**</span></span>](/windows/desktop/api/Certif/nf-certif-icertserverpolicy-getcertificateproperty)
</dt> <dt>

[<span data-ttu-id="d9ef9-180">**ICertServerExit::GetCertificateProperty**</span><span class="sxs-lookup"><span data-stu-id="d9ef9-180">**ICertServerExit::GetCertificateProperty**</span></span>](/windows/desktop/api/Certif/nf-certif-icertserverexit-getcertificateproperty)
</dt> </dl>

 

 
