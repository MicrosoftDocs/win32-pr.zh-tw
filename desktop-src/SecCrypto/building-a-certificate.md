---
description: 說明建立憑證所需的呼叫。
ms.assetid: 74154b3b-75fc-412f-835c-1a6f54e688c6
title: 建立憑證
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b8f237fd729499aa5153f12f68657e2ce227da7b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "103852683"
---
# <a name="building-a-certificate"></a><span data-ttu-id="050de-103">建立憑證</span><span class="sxs-lookup"><span data-stu-id="050de-103">Building a Certificate</span></span>

<span data-ttu-id="050de-104">建立憑證的呼叫順序如下所示：</span><span class="sxs-lookup"><span data-stu-id="050de-104">The order of calls in building a certificate is as follows:</span></span>

1.  <span data-ttu-id="050de-105">[*憑證授權單位*](../secgloss/c-gly.md) 單位 (CA) 透過對 [**ICertPolicy**](/windows/desktop/api/Certpol/nn-certpol-icertpolicy) 和 [**ICertExit**](/windows/desktop/api/Certexit/nn-certexit-icertexit) 的呼叫來初始化模組， (會在伺服器初始化) 上進行一次。</span><span class="sxs-lookup"><span data-stu-id="050de-105">[*Certification authority*](../secgloss/c-gly.md) (CA) initializes modules through calls to [**ICertPolicy**](/windows/desktop/api/Certpol/nn-certpol-icertpolicy) and [**ICertExit**](/windows/desktop/api/Certexit/nn-certexit-icertexit) (happens once on server initialization).</span></span> <span data-ttu-id="050de-106">CA 會藉由呼叫 [**ICertPolicy2：： initialize**](/windows/desktop/api/Certpol/nf-certpol-icertpolicy-initialize) 和 [**ICertExit：： initialize**](/windows/desktop/api/Certexit/nf-certexit-icertexit-initialize)來初始化原則和結束模組。</span><span class="sxs-lookup"><span data-stu-id="050de-106">The CA will initialize the policy and exit modules by calling [**ICertPolicy2::Initialize**](/windows/desktop/api/Certpol/nf-certpol-icertpolicy-initialize) and [**ICertExit::Initialize**](/windows/desktop/api/Certexit/nf-certexit-icertexit-initialize).</span></span>
2.  <span data-ttu-id="050de-107">中繼會透過 [**ICertConfig**](/windows/desktop/api/Certcli/nn-certcli-icertconfig) 呼叫 CA， (每個中繼初始化) 都會發生一次。</span><span class="sxs-lookup"><span data-stu-id="050de-107">Intermediary calls the CA through [**ICertConfig**](/windows/desktop/api/Certcli/nn-certcli-icertconfig) (happens once per intermediary initialization).</span></span> <span data-ttu-id="050de-108">媒介會藉由呼叫 [**ICertConfig：： GetConfig**](/windows/desktop/api/Certcli/nf-certcli-icertconfig-getconfig)來尋找所需的設定字串。</span><span class="sxs-lookup"><span data-stu-id="050de-108">The intermediary finds the needed configuration string by calling [**ICertConfig::GetConfig**](/windows/desktop/api/Certcli/nf-certcli-icertconfig-getconfig).</span></span>
3.  <span data-ttu-id="050de-109">用戶端會透過每個要求) ，在中繼 (特定的介面中呼叫中繼。</span><span class="sxs-lookup"><span data-stu-id="050de-109">Client calls the intermediary through an interface specific to the intermediary (happens once per request).</span></span> <span data-ttu-id="050de-110">用戶端會將 [*憑證要求*](../secgloss/c-gly.md) 傳送給媒介。</span><span class="sxs-lookup"><span data-stu-id="050de-110">The client sends a [*certificate request*](../secgloss/c-gly.md) to the intermediary.</span></span> <span data-ttu-id="050de-111">例如，Microsoft Internet Explorer 透過 [憑證註冊控制項](certificate-enrollment-control.md) 將要求傳送至 Microsoft Internet Information Services。</span><span class="sxs-lookup"><span data-stu-id="050de-111">This can be, for example, Microsoft Internet Explorer sending a request through [Certificate Enrollment Control](certificate-enrollment-control.md) to Microsoft Internet Information Services.</span></span>
4.  <span data-ttu-id="050de-112">透過 [**ICertRequest**](/windows/desktop/api/Certcli/nn-certcli-icertrequest) (的中繼至 CA 會在每個要求) 發生一次。</span><span class="sxs-lookup"><span data-stu-id="050de-112">Intermediary to CA through [**ICertRequest**](/windows/desktop/api/Certcli/nn-certcli-icertrequest) (happens once per request).</span></span> <span data-ttu-id="050de-113">媒介會透過 [**ICertRequest：： Submit**](/windows/desktop/api/Certcli/nf-certcli-icertrequest-submit)將憑證要求傳送給 CA。</span><span class="sxs-lookup"><span data-stu-id="050de-113">The intermediary sends the certificate request to the CA through [**ICertRequest::Submit**](/windows/desktop/api/Certcli/nf-certcli-icertrequest-submit).</span></span> <span data-ttu-id="050de-114">在 Internet Information Services 的案例中，這可以透過使用中的伺服器頁面腳本來完成。</span><span class="sxs-lookup"><span data-stu-id="050de-114">In the case of Internet Information Services, this could be done through Active Server Pages scripts.</span></span>
5.  <span data-ttu-id="050de-115">CA 會透過 [**ICertPolicy**](/windows/desktop/api/Certpol/nn-certpol-icertpolicy) 介面呼叫原則模組， (會在每個要求) 發生一次。</span><span class="sxs-lookup"><span data-stu-id="050de-115">The CA calls the Policy Module through the [**ICertPolicy**](/windows/desktop/api/Certpol/nn-certpol-icertpolicy) interface (happens once per request).</span></span> <span data-ttu-id="050de-116">CA 會呼叫 [**ICertPolicy：： verifyrequest 已**](/windows/desktop/api/Certpol/nf-certpol-icertpolicy-verifyrequest)，以通知原則模組要求已到達。</span><span class="sxs-lookup"><span data-stu-id="050de-116">The CA notifies the policy module that a request has arrived by calling [**ICertPolicy::VerifyRequest**](/windows/desktop/api/Certpol/nf-certpol-icertpolicy-verifyrequest).</span></span> <span data-ttu-id="050de-117">原則模組可以藉由呼叫 [**ICertServerPolicy**](/windows/desktop/api/Certif/nn-certif-icertserverpolicy) 介面的方法，檢查要求並變更憑證。</span><span class="sxs-lookup"><span data-stu-id="050de-117">The policy module can examine the request and change the certificate by calling methods of the [**ICertServerPolicy**](/windows/desktop/api/Certif/nn-certif-icertserverpolicy) interface.</span></span> <span data-ttu-id="050de-118">然後，原則模組可以指出要求是正常的 (如果是，就會在此時建立憑證) 、要求遭到拒絕，或是應該暫停要求。</span><span class="sxs-lookup"><span data-stu-id="050de-118">The policy module can then indicate that the request is OK (if so, the certificate is built at this point), the request is to be denied, or the request should be suspended.</span></span>
6.  <span data-ttu-id="050de-119"> (選擇性的) 系統管理員透過 [**ICertAdmin**](/windows/desktop/api/Certadm/nn-certadm-icertadmin) 介面呼叫 CA。</span><span class="sxs-lookup"><span data-stu-id="050de-119">(Optional) Administrator calls the CA through the [**ICertAdmin**](/windows/desktop/api/Certadm/nn-certadm-icertadmin) interface.</span></span> <span data-ttu-id="050de-120">如果要求已暫停，系統管理員可以重新提交或拒絕要求，或修改要求屬性和延伸模組。</span><span class="sxs-lookup"><span data-stu-id="050de-120">If the request is suspended, the administrator can resubmit or deny the request, or modify request attributes and extensions.</span></span> <span data-ttu-id="050de-121">請注意，如果重新提交要求，原則模組將會有另一個機會處理要求 (，因為呼叫 [**ICertPolicy：： verifyrequest 已**](/windows/desktop/api/Certpol/nf-certpol-icertpolicy-verifyrequest)) 。</span><span class="sxs-lookup"><span data-stu-id="050de-121">Note that if the request is resubmitted, the Policy Module will have another opportunity to process the request (as a result of a call to [**ICertPolicy::VerifyRequest**](/windows/desktop/api/Certpol/nf-certpol-icertpolicy-verifyrequest)).</span></span> <span data-ttu-id="050de-122">重新提交或拒絕要求的工作可以透過「憑證授權單位單位」 MMC 嵌入式管理單元，或使用 **ICertAdmin** 的另一個應用程式來執行。</span><span class="sxs-lookup"><span data-stu-id="050de-122">The task of resubmitting or denying the request can be performed by means of the Certification Authority MMC snap-in, or another application that uses **ICertAdmin**.</span></span>
7.  <span data-ttu-id="050de-123">CA 會透過 [**ICertExit**](/windows/desktop/api/Certexit/nn-certexit-icertexit) 介面呼叫 exit 模組。</span><span class="sxs-lookup"><span data-stu-id="050de-123">The CA calls the exit module through the [**ICertExit**](/windows/desktop/api/Certexit/nn-certexit-icertexit) interface.</span></span> <span data-ttu-id="050de-124">如果結束模組在呼叫 [**ICertExit：： Initialize**](/windows/desktop/api/Certexit/nf-certexit-icertexit-initialize) 時指出 (，請在步驟 1) 有興趣查看所發出的憑證或擱置擱置的要求，CA 將會呼叫 [**ICertExit：： Notify**](/windows/desktop/api/Certexit/nf-certexit-icertexit-notify)。</span><span class="sxs-lookup"><span data-stu-id="050de-124">If the exit module has indicated (when [**ICertExit::Initialize**](/windows/desktop/api/Certexit/nf-certexit-icertexit-initialize) was called, in step 1) that it is interested in seeing certificates issued or requests held pending, the CA will call [**ICertExit::Notify**](/windows/desktop/api/Certexit/nf-certexit-icertexit-notify).</span></span>
8.  <span data-ttu-id="050de-125">Exit 模組會透過 [**ICertServerExit**](/windows/desktop/api/Certif/nn-certif-icertserverexit) 介面呼叫 CA。</span><span class="sxs-lookup"><span data-stu-id="050de-125">The exit module calls the CA through the [**ICertServerExit**](/windows/desktop/api/Certif/nn-certif-icertserverexit) interface.</span></span> <span data-ttu-id="050de-126">結束模組可以藉由呼叫 **ICertServerExit** 的方法，檢查要求和新的憑證。</span><span class="sxs-lookup"><span data-stu-id="050de-126">The exit module can examine the request and the new certificate by calling methods of **ICertServerExit**.</span></span>

 

 
