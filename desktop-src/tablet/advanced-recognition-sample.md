---
description: Advanced 辨識範例示範 Microsoft Tablet PC Automation 應用程式開發介面的 advanced 功能， (API) 用於手寫辨識。
ms.assetid: 4c9b9f31-c317-43fd-8404-35295b41d093
title: Advanced 辨認範例
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7e23a078ded9c6967f8e45780f8cb3a739b246f6
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "103689236"
---
# <a name="advanced-recognition-sample"></a><span data-ttu-id="1966b-103">Advanced 辨認範例</span><span class="sxs-lookup"><span data-stu-id="1966b-103">Advanced Recognition Sample</span></span>

<span data-ttu-id="1966b-104">Advanced 辨識範例示範 Microsoft Tablet PC Automation 應用程式開發介面的 advanced 功能， (API) 用於手寫辨識。</span><span class="sxs-lookup"><span data-stu-id="1966b-104">The advanced recognition sample demonstrates advanced features of the Microsoft Tablet PC Automation application programming interface (API) used for handwriting recognition.</span></span>

<span data-ttu-id="1966b-105">其中包含下列功能：</span><span class="sxs-lookup"><span data-stu-id="1966b-105">It includes the following features:</span></span>

-   <span data-ttu-id="1966b-106">列舉已安裝的辨識器</span><span class="sxs-lookup"><span data-stu-id="1966b-106">Enumerating the installed recognizer</span></span>
-   <span data-ttu-id="1966b-107">使用特定語言建立辨識器內容</span><span class="sxs-lookup"><span data-stu-id="1966b-107">Creating a recognizer context with a specific language</span></span>
-   <span data-ttu-id="1966b-108">使用辨識器物件</span><span class="sxs-lookup"><span data-stu-id="1966b-108">Using the recognizer object</span></span>
-   <span data-ttu-id="1966b-109">設定辨識的智慧標籤和字組清單</span><span class="sxs-lookup"><span data-stu-id="1966b-109">Setting recognition factoid and word lists</span></span>
-   <span data-ttu-id="1966b-110">使用指南改善辨識品質</span><span class="sxs-lookup"><span data-stu-id="1966b-110">Using guides to improve the recognition quality</span></span>
-   <span data-ttu-id="1966b-111">動態背景識別</span><span class="sxs-lookup"><span data-stu-id="1966b-111">Dynamic background recognition</span></span>
-   <span data-ttu-id="1966b-112">手勢辨識</span><span class="sxs-lookup"><span data-stu-id="1966b-112">Gesture recognition</span></span>

<span data-ttu-id="1966b-113">使用的介面為： [**IInkRecognizer**](/windows/desktop/api/msinkaut/nn-msinkaut-iinkrecognizer)、 **IInkRecoCoNtext**、 [**IInkRecognitionResult**](/windows/desktop/api/msinkaut/nn-msinkaut-iinkrecognitionresult)、 **IInkRecognitionGuide**、 **IInkWordList**、 [**IInkGesture**](/windows/desktop/api/msinkaut/nn-msinkaut-iinkgesture)、 **IInkCollector**、 **IInkDisp**、 **IInkRenderer**、 **IInkDrawingAttributes**、 **IInkStrokes** 和 **IInkStroke**。</span><span class="sxs-lookup"><span data-stu-id="1966b-113">The interfaces used are: [**IInkRecognizer**](/windows/desktop/api/msinkaut/nn-msinkaut-iinkrecognizer), **IInkRecoContext**, [**IInkRecognitionResult**](/windows/desktop/api/msinkaut/nn-msinkaut-iinkrecognitionresult), **IInkRecognitionGuide**, **IInkWordList**, [**IInkGesture**](/windows/desktop/api/msinkaut/nn-msinkaut-iinkgesture), **IInkCollector**, **IInkDisp**, **IInkRenderer**, **IInkDrawingAttributes**, **IInkStrokes**, and **IInkStroke**.</span></span>

## <a name="ink-and-project-headers"></a><span data-ttu-id="1966b-114">筆跡和專案標題</span><span class="sxs-lookup"><span data-stu-id="1966b-114">Ink and Project Headers</span></span>

<span data-ttu-id="1966b-115">首先，請加入 Tablet PC 自動化介面的標頭。</span><span class="sxs-lookup"><span data-stu-id="1966b-115">First, include the headers for Tablet PC Automation interfaces.</span></span> <span data-ttu-id="1966b-116">這些會隨 Tablet PC Platform SDK 一起安裝。</span><span class="sxs-lookup"><span data-stu-id="1966b-116">These are installed with the Tablet PC Platform SDK.</span></span> <span data-ttu-id="1966b-117">TpcError 檔案包含 Tablet PC API 錯誤碼定義。</span><span class="sxs-lookup"><span data-stu-id="1966b-117">The TpcError.h file contains the Tablet PC API Error Code definitions.</span></span>


```C++
#include <msinkaut.h>
#include <msinkaut_i.c>
#include <TpcError.h>
```



<span data-ttu-id="1966b-118">EventSinks .h 檔案會定義 **IInkEventsImpl** 和 **IInkRecognitionEventsImpl** 介面，並設定 [**RecognitionWithAlternates**](inkrecognizercontext-recognitionwithalternates.md)、 [**筆劃**](inkcollector-stroke.md)和 [**手勢**](inkcollector-gesture.md) 事件。</span><span class="sxs-lookup"><span data-stu-id="1966b-118">The EventSinks.h file defines the **IInkEventsImpl** and **IInkRecognitionEventsImpl** interfaces, and sets up the [**RecognitionWithAlternates**](inkrecognizercontext-recognitionwithalternates.md), [**Stroke**](inkcollector-stroke.md), and [**Gesture**](inkcollector-gesture.md) events.</span></span>


```C++
#include "EventSinks.h"
```



<span data-ttu-id="1966b-119">ChildWnds 檔案包含 **CInkInputWnd** 和 **CRecoOutputWnd** 類別的定義，這些類別衍生自 ATL 的 CWindowImpl，並用於建立範例的子視窗。</span><span class="sxs-lookup"><span data-stu-id="1966b-119">The ChildWnds.h file contains the definitions of the classes **CInkInputWnd** and **CRecoOutputWnd**, which are derived from the ATL's CWindowImpl and used for creating the sample's child windows.</span></span>


```C++
#include "ChildWnds.h"
```



<span data-ttu-id="1966b-120">AdvReco 檔案會宣告 **CAdvRecoApp** 類別，這是此範例的應用程式視窗類別。</span><span class="sxs-lookup"><span data-stu-id="1966b-120">The AdvReco.h file declares the **CAdvRecoApp** class, which is the application window class for this sample.</span></span>


```C++
#include "AdvReco.h"
```



## <a name="initializing-the-application-window"></a><span data-ttu-id="1966b-121">初始化應用程式視窗</span><span class="sxs-lookup"><span data-stu-id="1966b-121">Initializing the Application Window</span></span>

<span data-ttu-id="1966b-122">視窗的 `Run` 方法會設定 **CAdvRecoApp** 物件、載入視窗的功能表和圖示、建立預設辨識器的 [**InkRecognizerCoNtext**](inkrecognizercontext-class.md) 物件，以及啟動視窗的訊息迴圈。</span><span class="sxs-lookup"><span data-stu-id="1966b-122">The window's `Run` method sets up the **CAdvRecoApp** object, loads the menu and icon for the window, creates an [**InkRecognizerContext**](inkrecognizercontext-class.md) object for the default recognizer, and starts the window's message loop.</span></span>

<span data-ttu-id="1966b-123">視窗的 **>oncreate** 方法會處理 **WM \_ 建立** 事件並建立子視窗。</span><span class="sxs-lookup"><span data-stu-id="1966b-123">The window's **OnCreate** method handles the **WM\_CREATE** event and creates the child windows.</span></span> <span data-ttu-id="1966b-124">[**InkCollector**](inkcollector-class.md)物件會連接至筆墨收集器的事件來源，並啟用輸入視窗的筆墨輸入。</span><span class="sxs-lookup"><span data-stu-id="1966b-124">An [**InkCollector**](inkcollector-class.md) object connects to the ink collector's event source, and enables ink input on the input window.</span></span> <span data-ttu-id="1966b-125">然後，它會建立 [**InkRecognizerGuide**](inkrecognizerguide-class.md) 物件，並使用筆墨收集 [**器的轉譯**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkcollector-get_renderer) 器屬性將辨識指南方塊矩形轉換成筆墨空間。</span><span class="sxs-lookup"><span data-stu-id="1966b-125">Then it creates an [**InkRecognizerGuide**](inkrecognizerguide-class.md) object and uses the ink collector's [**Renderer**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkcollector-get_renderer) property to convert the recognition guide box rectangles to ink space.</span></span> <span data-ttu-id="1966b-126">最後， **>oncreate** 方法會建立 [**InkWordList**](inkwordlist-class.md) 物件。</span><span class="sxs-lookup"><span data-stu-id="1966b-126">Finally, the **OnCreate** method creates an [**InkWordList**](inkwordlist-class.md) object.</span></span>

## <a name="handling-ink-collector-events"></a><span data-ttu-id="1966b-127">處理筆墨收集器事件</span><span class="sxs-lookup"><span data-stu-id="1966b-127">Handling Ink Collector Events</span></span>

<span data-ttu-id="1966b-128">視窗的 **OnStroke** 方法會處理筆墨收集器的 [**筆劃**](inkcollector-stroke.md) 事件。</span><span class="sxs-lookup"><span data-stu-id="1966b-128">The window's **OnStroke** method handles the ink collector's [**Stroke**](inkcollector-stroke.md) event.</span></span> <span data-ttu-id="1966b-129">新的 [**IInkStrokeDisp**](/windows/desktop/api/msinkaut/nn-msinkaut-iinkstrokedisp)物件會加入至筆墨收集器的 [**筆墨**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkcollector-get_ink)屬性 [InkStrokes](/previous-versions/windows/desktop/legacy/ms703293(v=vs.85))中。</span><span class="sxs-lookup"><span data-stu-id="1966b-129">The new [**IInkStrokeDisp**](/windows/desktop/api/msinkaut/nn-msinkaut-iinkstrokedisp) object is added to the [InkStrokes](/previous-versions/windows/desktop/legacy/ms703293(v=vs.85)) of the ink collector's [**Ink**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkcollector-get_ink) property.</span></span>

<span data-ttu-id="1966b-130">視窗的 **OnGesture** 方法會處理筆墨收集器的 [**手勢**](inkcollector-gesture.md) 事件。</span><span class="sxs-lookup"><span data-stu-id="1966b-130">The window's **OnGesture** method handles the ink collector's [**Gesture**](inkcollector-gesture.md) event.</span></span> <span data-ttu-id="1966b-131">**OnGesture** 方法會先使用最高的信賴度手勢來識別手勢，並檢查視窗是否支援這個特定的手勢。</span><span class="sxs-lookup"><span data-stu-id="1966b-131">The **OnGesture** method identifies the gesture, using the highest confidence gesture first, and checks if the window supports this particular gesture.</span></span> <span data-ttu-id="1966b-132">如果支援手勢，手勢的周框方塊會失效，因為手勢會從筆劃集合中移除。</span><span class="sxs-lookup"><span data-stu-id="1966b-132">If the gesture is supported, the gesture's bounding box is invalidated, as the gesture is removed from the strokes collection.</span></span> <span data-ttu-id="1966b-133">如果不支援筆勢， **手勢** 事件會取消，而導致筆墨收集器引發 [**筆劃**](inkcollector-stroke.md) 事件。</span><span class="sxs-lookup"><span data-stu-id="1966b-133">If the gesture is not supported, the **Gesture** event is canceled, which causes the ink collector to raise a [**Stroke**](inkcollector-stroke.md) event.</span></span> <span data-ttu-id="1966b-134">最後，會更新結果視窗。</span><span class="sxs-lookup"><span data-stu-id="1966b-134">Finally, the results window is updated.</span></span>

## <a name="handling-recognizer-context-events"></a><span data-ttu-id="1966b-135">處理辨識器內容事件</span><span class="sxs-lookup"><span data-stu-id="1966b-135">Handling Recognizer Context Events</span></span>

<span data-ttu-id="1966b-136">視窗的 **OnRecognitionWithAlternates** 方法會處理辨識器內容的 [**RecognitionWithAlternates**](inkrecognizercontext-recognitionwithalternates.md) 事件。</span><span class="sxs-lookup"><span data-stu-id="1966b-136">The window's **OnRecognitionWithAlternates** method handles the recognizer context's [**RecognitionWithAlternates**](inkrecognizercontext-recognitionwithalternates.md) event.</span></span> <span data-ttu-id="1966b-137">**OnRecognitionWithAlternates** 方法會在 [結果] 視窗中顯示辨識結果。</span><span class="sxs-lookup"><span data-stu-id="1966b-137">The **OnRecognitionWithAlternates** method displays the recognition results in the results window.</span></span>

## <a name="handling-menu-commands"></a><span data-ttu-id="1966b-138">處理功能表命令</span><span class="sxs-lookup"><span data-stu-id="1966b-138">Handling Menu Commands</span></span>

<span data-ttu-id="1966b-139">視窗的 **OnRecognizer** 方法會處理辨識器功能表上的命令。</span><span class="sxs-lookup"><span data-stu-id="1966b-139">The window's **OnRecognizer** method handles the commands on the Recognizer menu.</span></span> <span data-ttu-id="1966b-140">如果選取了 **預設** 的命令，則會使用 [InkRecognizers](/previous-versions/windows/desktop/legacy/ms702438(v=vs.85))的 [**GetDefaultRecognizer**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizers-getdefaultrecognizer)方法來取出預設辨識器;否則，就會取出選取的辨識器。</span><span class="sxs-lookup"><span data-stu-id="1966b-140">If the **Default** command was selected, the [**GetDefaultRecognizer**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizers-getdefaultrecognizer) method of the [InkRecognizers](/previous-versions/windows/desktop/legacy/ms702438(v=vs.85)) is used to retrieve the default recognizer; otherwise, the selected recognizer is retrieved.</span></span> <span data-ttu-id="1966b-141">然後會建立並使用辨識器內容，並更新功能表和狀態列。</span><span class="sxs-lookup"><span data-stu-id="1966b-141">Then, a recognizer context is created and used, and menu and status bar are updated.</span></span>

<span data-ttu-id="1966b-142">視窗的 **OnFactoidWordlist** 方法會處理 **模擬** 功能表上的 [**使用單詞表**] 命令。</span><span class="sxs-lookup"><span data-stu-id="1966b-142">The window's **OnFactoidWordlist** method handles the **Use Wordlist** command on the **Factoid** menu.</span></span> <span data-ttu-id="1966b-143">辨識器內容的 [ [**筆劃**](/windows/desktop/api/msinkaut15/nf-msinkaut15-iinkdivisionresult-get_strokes) ] 屬性會設定為 **Null** ，以重設辨識器內容。</span><span class="sxs-lookup"><span data-stu-id="1966b-143">The recognizer context's [**Strokes**](/windows/desktop/api/msinkaut15/nf-msinkaut15-iinkdivisionresult-get_strokes) property is set to **NULL** to reset the recognizer context.</span></span> <span data-ttu-id="1966b-144">如果已關閉 [**使用單詞表**] 選項，辨識器內容的 [**單詞表**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-get_wordlist)屬性會設定為 **Null**;否則，辨識器內容的 **單詞表** 屬性會設定為在 **>oncreate** 方法中建立的 [**InkWordList**](inkwordlist-class.md) 。</span><span class="sxs-lookup"><span data-stu-id="1966b-144">If the **Use Wordlist** option is turned off, the recognizer context's [**WordList**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-get_wordlist) property is set to **NULL**; otherwise, the recognizer context's **WordList** property is set to the [**InkWordList**](inkwordlist-class.md) that was created in the **OnCreate** method.</span></span> <span data-ttu-id="1966b-145">最後，筆墨收集器的 [InkStrokes](/previous-versions/windows/desktop/legacy/ms703293(v=vs.85)) 會重新附加至辨識器內容，並呼叫辨識器內容的 [**BackgroundRecognizeWithAlternates**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-backgroundrecognizewithalternates) 方法，並更新功能表。</span><span class="sxs-lookup"><span data-stu-id="1966b-145">Finally, the [InkStrokes](/previous-versions/windows/desktop/legacy/ms703293(v=vs.85)) of the ink collector is reattached to the recognizer context, the recognizer context's [**BackgroundRecognizeWithAlternates**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-backgroundrecognizewithalternates) method is called, and the menu is updated.</span></span>

<span data-ttu-id="1966b-146">視窗的 **OnFactoid** 方法會處理 **模擬** 功能表上的模擬命令。</span><span class="sxs-lookup"><span data-stu-id="1966b-146">The window's **OnFactoid** method handles the factoid commands on the **Factoid** menu.</span></span> <span data-ttu-id="1966b-147">它會先將辨識器內容的 [ [**筆劃**](/windows/desktop/api/msinkaut15/nf-msinkaut15-iinkdivisionresult-get_strokes) ] 屬性設定為 **Null**、將辨識器內容的 [ [**模擬**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-get_factoid) ] 屬性設定為選取的模擬，然後將筆墨收集器的 [InkStrokes](/previous-versions/windows/desktop/legacy/ms703293(v=vs.85)) 重新指派給辨識器內容。</span><span class="sxs-lookup"><span data-stu-id="1966b-147">It first sets the recognizer context's [**Strokes**](/windows/desktop/api/msinkaut15/nf-msinkaut15-iinkdivisionresult-get_strokes) property to **NULL**, sets the recognizer context's [**Factoid**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-get_factoid) property to the selected factoid, and reassigns the [InkStrokes](/previous-versions/windows/desktop/legacy/ms703293(v=vs.85)) of the ink collector to the recognizer context.</span></span> <span data-ttu-id="1966b-148">如果辨識器內容支援 [模擬](factoid-constants.md) 物件，則會呼叫辨識器內容的 [**BackgroundRecognizeWithAlternates**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-backgroundrecognizewithalternates) 方法;否則，就會顯示錯誤訊息。</span><span class="sxs-lookup"><span data-stu-id="1966b-148">If the [Factoid](factoid-constants.md) object is supported by the recognizer context, the recognizer context's [**BackgroundRecognizeWithAlternates**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-backgroundrecognizewithalternates) method is called; otherwise, an error message is displayed.</span></span> <span data-ttu-id="1966b-149">最後，會更新功能表和狀態列。</span><span class="sxs-lookup"><span data-stu-id="1966b-149">Finally, the menu and status bar are updated.</span></span>

<span data-ttu-id="1966b-150">視窗的 **OnGuide** 方法會處理 [ **節目表** ] 功能表上的命令。</span><span class="sxs-lookup"><span data-stu-id="1966b-150">The window's **OnGuide** method handles the commands on the **Guide** menu.</span></span> <span data-ttu-id="1966b-151">如果辨識器內容支援節目表選項， **OnGuide** 方法會將辨識器內容的 [ [**筆劃**](/windows/desktop/api/msinkaut15/nf-msinkaut15-iinkdivisionresult-get_strokes) ] 屬性設定為 **Null**、將 [辨識器內容 [**指南**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-get_guide) ] 屬性設定為 [選取的指南] 設定、將筆墨收集器的 [InkStrokes](/previous-versions/windows/desktop/legacy/ms703293(v=vs.85)) 重新指派給辨識器內容，然後呼叫辨識器內容的 [**BackgroundRecognizeWithAlternates**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-backgroundrecognizewithalternates) 方法。</span><span class="sxs-lookup"><span data-stu-id="1966b-151">If the recognizer context supports the guide options, the **OnGuide** method sets the recognizer context's [**Strokes**](/windows/desktop/api/msinkaut15/nf-msinkaut15-iinkdivisionresult-get_strokes) property to **NULL**, sets the recognizer context's [**Guide**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-get_guide) property to the selected guide setting, reassigns the [InkStrokes](/previous-versions/windows/desktop/legacy/ms703293(v=vs.85)) of the ink collector to the recognizer context, and calls the recognizer context's [**BackgroundRecognizeWithAlternates**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-backgroundrecognizewithalternates) method.</span></span> <span data-ttu-id="1966b-152">否則，就會顯示錯誤訊息。</span><span class="sxs-lookup"><span data-stu-id="1966b-152">Otherwise, an error message is displayed.</span></span> <span data-ttu-id="1966b-153">最後，會更新輸入視窗、功能表和狀態列。</span><span class="sxs-lookup"><span data-stu-id="1966b-153">Finally, the input window, menu, and status bar are updated.</span></span>

<span data-ttu-id="1966b-154">視窗的 **OnMode** 方法會處理 **模式** 功能表上的命令。</span><span class="sxs-lookup"><span data-stu-id="1966b-154">The window's **OnMode** method handles the commands on the **Mode** menu.</span></span> <span data-ttu-id="1966b-155">它會停用筆墨收集器、更新筆墨收集器的 [**CollectionMode**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkcollector-get_collectionmode) 屬性、更新功能表，以及顯示或隱藏手勢清單。</span><span class="sxs-lookup"><span data-stu-id="1966b-155">It disables the ink collector, updates the ink collector's [**CollectionMode**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkcollector-get_collectionmode) property, updates the menu, and shows or hides the gesture lists.</span></span> <span data-ttu-id="1966b-156">最後，會啟用筆墨收集器。</span><span class="sxs-lookup"><span data-stu-id="1966b-156">Finally, the ink collector is enabled.</span></span>

<span data-ttu-id="1966b-157">視窗的 **OnRecognize** 方法會處理筆墨功能表上的 [ **辨識** ] 命令。</span><span class="sxs-lookup"><span data-stu-id="1966b-157">The window's **OnRecognize** method handles the **Recognize** command on the Ink menu.</span></span> <span data-ttu-id="1966b-158">它會呼叫辨識器內容的 [**EndInkInput**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-endinkinput) 方法，以防止筆墨新增至辨識器內容。</span><span class="sxs-lookup"><span data-stu-id="1966b-158">It calls the recognizer context's [**EndInkInput**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-endinkinput) method to keep ink from being added to the recognizer context.</span></span> <span data-ttu-id="1966b-159">這有時是必要的，因為並非所有辨識器都支援部分辨識。</span><span class="sxs-lookup"><span data-stu-id="1966b-159">This is sometimes necessary, as not all recognizers support partial recognition.</span></span> <span data-ttu-id="1966b-160">然後，它會呼叫辨識器內容的 [**辨識**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-recognize) 方法，並將結果傳遞給視窗的 **OnRecognitionWithAlternates** 方法。</span><span class="sxs-lookup"><span data-stu-id="1966b-160">Then it calls the recognizer context's [**Recognize**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-recognize) method, and passes the results to the window's **OnRecognitionWithAlternates** method.</span></span> <span data-ttu-id="1966b-161">最後，筆墨收集器的 [InkStrokes](/previous-versions/windows/desktop/legacy/ms703293(v=vs.85)) 會重新指派給辨識器內容。</span><span class="sxs-lookup"><span data-stu-id="1966b-161">Finally, the [InkStrokes](/previous-versions/windows/desktop/legacy/ms703293(v=vs.85)) of the ink collector is reassigned to the recognizer context.</span></span>

<span data-ttu-id="1966b-162">視窗的 **OnClear** 方法會處理 [**筆跡**] 功能表上的 [**清除**] 命令。</span><span class="sxs-lookup"><span data-stu-id="1966b-162">The window's **OnClear** method handles the **Clear** command on the **Ink** menu.</span></span> <span data-ttu-id="1966b-163">它會從筆墨收集器的 [**筆墨**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkcollector-get_ink) 屬性刪除筆劃、釋出舊的筆觸集合，並為筆墨收集器的 **筆墨** 屬性建立新的筆劃集合，並將新的筆劃集合附加至辨識器內容。</span><span class="sxs-lookup"><span data-stu-id="1966b-163">It deletes the strokes from the ink collector's [**Ink**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkcollector-get_ink) property, releases the old strokes collection and creates a new one for the ink collector's **Ink** property, and attaches the new strokes collection to the recognizer context.</span></span>

<span data-ttu-id="1966b-164">視窗的 **OnExit** 方法會處理 **筆墨** 功能表上的 **EXIT** 命令，並引發 WM \_ CLOSE 事件。</span><span class="sxs-lookup"><span data-stu-id="1966b-164">The window's **OnExit** method handles the **Exit** command on the **Ink** menu, and raises the WM\_CLOSE event.</span></span>

## <a name="helper-methods"></a><span data-ttu-id="1966b-165">Helper 方法</span><span class="sxs-lookup"><span data-stu-id="1966b-165">Helper Methods</span></span>

<span data-ttu-id="1966b-166">視窗的 **LoadMenu** 方法是從視窗的 **Run** 方法呼叫，並將支援的辨識器清單和支援的 factoids 清單新增至功能表中。</span><span class="sxs-lookup"><span data-stu-id="1966b-166">The window's **LoadMenu** method is called from the window's **Run** method, and adds the list of supported recognizers and the list of supported factoids to the menu.</span></span> <span data-ttu-id="1966b-167">首先，它會抓取 [InkRecognizers](/previous-versions/windows/desktop/legacy/ms702438(v=vs.85))。</span><span class="sxs-lookup"><span data-stu-id="1966b-167">First, it retrieves the [InkRecognizers](/previous-versions/windows/desktop/legacy/ms702438(v=vs.85)).</span></span> <span data-ttu-id="1966b-168">然後，它會逐一查看可用的辨識器，並只選取在 [ **語言** ] 屬性中有語言清單的專案，這會新增至 [辨識 **器** ] 功能表。</span><span class="sxs-lookup"><span data-stu-id="1966b-168">Then it iterates through the available recognizers and only selects ones that have a list of languages in the **Languages** property, which it adds to the **Recognizer** menu.</span></span> <span data-ttu-id="1966b-169">最後，它會在 [ **模擬** ] 功能表中填入定義為全域常數的 factoids 清單。</span><span class="sxs-lookup"><span data-stu-id="1966b-169">Finally, it populates the **Factoid** menu with the list of factoids defined as a global constant.</span></span>

<span data-ttu-id="1966b-170">當使用者選取新的辨識器時，會從視窗的 **OnRecognizer** 方法呼叫視窗的 **UseRecognizer** 方法。</span><span class="sxs-lookup"><span data-stu-id="1966b-170">The window's **UseRecognizer** method is called from the window's **OnRecognizer** method when the user selects a new recognizer.</span></span> <span data-ttu-id="1966b-171">它會建立辨識器內容、從辨識器事件接收器卸離舊的內容、清除和釋放舊的內容，並將新的內容附加至辨識器事件接收器。</span><span class="sxs-lookup"><span data-stu-id="1966b-171">It creates a recognizer context, detaches the old context from the recognizer event sink, clears and releases the old context, and attaches the new context to the recognizer event sink.</span></span>

<span data-ttu-id="1966b-172">然後， **UseRecognizer** 方法會檢查辨識器的 [**功能**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizer-get_capabilities) 屬性，它會傳回 [**InkRecognizerCapabilities**](/windows/desktop/api/msinkaut/ne-msinkaut-inkrecognizercapabilities) 值。</span><span class="sxs-lookup"><span data-stu-id="1966b-172">Then, the **UseRecognizer** method checks the recognizer's [**Capabilities**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizer-get_capabilities) property, which returns an [**InkRecognizerCapabilities**](/windows/desktop/api/msinkaut/ne-msinkaut-inkrecognizercapabilities) value.</span></span> <span data-ttu-id="1966b-173">如果辨識器支援線條輸入，則會啟用 [**節目表**] 功能表上的 [**線條**] 命令。</span><span class="sxs-lookup"><span data-stu-id="1966b-173">If the recognizer supports lined input, the **Lines** command on the **Guide** menu is enabled.</span></span> <span data-ttu-id="1966b-174">如果辨識器支援已裝箱的輸入，則會啟用 [ **方塊** ] 命令。</span><span class="sxs-lookup"><span data-stu-id="1966b-174">If the recognizer supports boxed input, the **Boxes** command is enabled.</span></span> <span data-ttu-id="1966b-175">如果辨識器不支援可用的輸入，則會停用 [ **無** ] 命令。</span><span class="sxs-lookup"><span data-stu-id="1966b-175">If the recognizer does not support free input, the **None** command is disabled.</span></span> <span data-ttu-id="1966b-176">如果不支援目前的節目表選取專案，則會更新辨識器內容和功能表的 [ [**節目表**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-get_guide) ] 屬性。</span><span class="sxs-lookup"><span data-stu-id="1966b-176">If the current guide selection is not supported, both the [**Guide**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-get_guide) property of the recognizer context and the menu are updated.</span></span>

<span data-ttu-id="1966b-177">然後， **UseRecognizer** 方法會嘗試設定辨識器內容的 [**單詞表**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-get_wordlist) 和 [**模擬**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-get_factoid) 屬性。</span><span class="sxs-lookup"><span data-stu-id="1966b-177">Then, the **UseRecognizer** method attempts to set the [**WordList**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-get_wordlist) and [**Factoid**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-get_factoid) properties of the recognizer context.</span></span> <span data-ttu-id="1966b-178">如果辨識器不支援其中一項設定，則會使用預設值，並更新功能表。</span><span class="sxs-lookup"><span data-stu-id="1966b-178">If either setting is not supported by the recognizer, then the default value is used and the menu is updated.</span></span>

<span data-ttu-id="1966b-179">最後， **UseRecognizer** 方法會將筆墨收集器之 [**InkDisp**](inkdisp-class.md)物件的 [**筆觸**](/windows/desktop/api/msinkaut15/nf-msinkaut15-iinkdivisionresult-get_strokes)屬性附加至辨識器內容、將輸出視窗的字型變更為辨識器的語言所支援的字型、重設輸出視窗，以及藉由呼叫辨識器內容的 [**BackgroundRecognizeWithAlternates**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-backgroundrecognizewithalternates)方法來更新辨識結果。</span><span class="sxs-lookup"><span data-stu-id="1966b-179">Finally, the **UseRecognizer** method attaches the [**Strokes**](/windows/desktop/api/msinkaut15/nf-msinkaut15-iinkdivisionresult-get_strokes) property of the ink collector's [**InkDisp**](inkdisp-class.md) object to the recognizer context, changes the output window's font to one supported by the language of the recognizer, resets the output window, and updates the recognition results by calling the recognizer context's [**BackgroundRecognizeWithAlternates**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-backgroundrecognizewithalternates) method.</span></span>

<span data-ttu-id="1966b-180">視窗的 **GetGestureName** 方法是從視窗的 **OnGesture** 方法中呼叫。</span><span class="sxs-lookup"><span data-stu-id="1966b-180">The window's **GetGestureName** method is called from the window's **OnGesture** method.</span></span> <span data-ttu-id="1966b-181">它會搜尋手勢，並將索引傳回至手勢的名稱，該名稱會儲存在 AdvReco .rc 檔的字串資料表中。</span><span class="sxs-lookup"><span data-stu-id="1966b-181">It searches for the gesture and returns an index to the gesture's name, which is stored in a string table in the AdvReco.rc file.</span></span>

 

 
